{"home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.None.setup.readme": [[7, 11], ["open", "f.read"], "function", ["None"], ["def", "readme", "(", ")", ":", "\n", "    ", "with", "open", "(", "'README.md'", ",", "encoding", "=", "'utf-8'", ")", "as", "f", ":", "\n", "        ", "content", "=", "f", ".", "read", "(", ")", "\n", "", "return", "content", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.None.setup.get_git_hash": [[22, 46], ["setup.get_git_hash._minimal_ext_cmd"], "function", ["None"], ["def", "get_git_hash", "(", ")", ":", "\n", "\n", "    ", "def", "_minimal_ext_cmd", "(", "cmd", ")", ":", "\n", "# construct minimal environment", "\n", "        ", "env", "=", "{", "}", "\n", "for", "k", "in", "[", "'SYSTEMROOT'", ",", "'PATH'", ",", "'HOME'", "]", ":", "\n", "            ", "v", "=", "os", ".", "environ", ".", "get", "(", "k", ")", "\n", "if", "v", "is", "not", "None", ":", "\n", "                ", "env", "[", "k", "]", "=", "v", "\n", "# LANGUAGE is used on win32", "\n", "", "", "env", "[", "'LANGUAGE'", "]", "=", "'C'", "\n", "env", "[", "'LANG'", "]", "=", "'C'", "\n", "env", "[", "'LC_ALL'", "]", "=", "'C'", "\n", "out", "=", "subprocess", ".", "Popen", "(", "\n", "cmd", ",", "stdout", "=", "subprocess", ".", "PIPE", ",", "env", "=", "env", ")", ".", "communicate", "(", ")", "[", "0", "]", "\n", "return", "out", "\n", "\n", "", "try", ":", "\n", "        ", "out", "=", "_minimal_ext_cmd", "(", "[", "'git'", ",", "'rev-parse'", ",", "'HEAD'", "]", ")", "\n", "sha", "=", "out", ".", "strip", "(", ")", ".", "decode", "(", "'ascii'", ")", "\n", "", "except", "OSError", ":", "\n", "        ", "sha", "=", "'unknown'", "\n", "\n", "", "return", "sha", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.None.setup.get_hash": [[48, 61], ["os.path.exists", "os.path.exists", "setup.get_git_hash", "__version__.split", "ImportError"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.None.setup.get_git_hash"], ["", "def", "get_hash", "(", ")", ":", "\n", "    ", "if", "os", ".", "path", ".", "exists", "(", "'.git'", ")", ":", "\n", "        ", "sha", "=", "get_git_hash", "(", ")", "[", ":", "7", "]", "\n", "", "elif", "os", ".", "path", ".", "exists", "(", "version_file", ")", ":", "\n", "        ", "try", ":", "\n", "            ", "from", "mmdet", ".", "version", "import", "__version__", "\n", "sha", "=", "__version__", ".", "split", "(", "'+'", ")", "[", "-", "1", "]", "\n", "", "except", "ImportError", ":", "\n", "            ", "raise", "ImportError", "(", "'Unable to get git version'", ")", "\n", "", "", "else", ":", "\n", "        ", "sha", "=", "'unknown'", "\n", "\n", "", "return", "sha", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.None.setup.write_version_py": [[63, 75], ["setup.get_hash", "open", "f.write", "content.format", "time.asctime"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.None.setup.get_hash"], ["", "def", "write_version_py", "(", ")", ":", "\n", "    ", "content", "=", "\"\"\"# GENERATED VERSION FILE\n# TIME: {}\n\n__version__ = '{}'\nshort_version = '{}'\n\"\"\"", "\n", "sha", "=", "get_hash", "(", ")", "\n", "VERSION", "=", "SHORT_VERSION", "+", "'+'", "+", "sha", "\n", "\n", "with", "open", "(", "version_file", ",", "'w'", ")", "as", "f", ":", "\n", "        ", "f", ".", "write", "(", "content", ".", "format", "(", "time", ".", "asctime", "(", ")", ",", "VERSION", ",", "SHORT_VERSION", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.None.setup.get_version": [[77, 81], ["open", "exec", "locals", "compile", "f.read"], "function", ["None"], ["", "", "def", "get_version", "(", ")", ":", "\n", "    ", "with", "open", "(", "version_file", ",", "'r'", ")", "as", "f", ":", "\n", "        ", "exec", "(", "compile", "(", "f", ".", "read", "(", ")", ",", "version_file", ",", "'exec'", ")", ")", "\n", "", "return", "locals", "(", ")", "[", "'__version__'", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.custom.CustomDataset.__init__": [[38, 128], ["custom.CustomDataset.load_annotations", "mmcv.is_list_of", "transforms.ImageTransform", "transforms.BboxTransform", "transforms.MaskTransform", "transforms.SegMapTransform", "transforms.Numpy2Tensor", "custom.CustomDataset.load_proposals", "custom.CustomDataset._filter_imgs", "isinstance", "custom.CustomDataset._set_group_flag", "extra_aug.ExtraAugmentation"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.augmentation_dataset.AugmentationDataset.load_annotations", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.custom.CustomDataset.load_proposals", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.augmentation_dataset.AugmentationDataset._filter_imgs", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.custom.CustomDataset._set_group_flag"], ["def", "__init__", "(", "self", ",", "\n", "ann_file", ",", "\n", "img_prefix", ",", "\n", "img_scale", ",", "\n", "img_norm_cfg", ",", "\n", "multiscale_mode", "=", "'value'", ",", "\n", "size_divisor", "=", "None", ",", "\n", "proposal_file", "=", "None", ",", "\n", "num_max_proposals", "=", "1000", ",", "\n", "flip_ratio", "=", "0", ",", "\n", "with_mask", "=", "True", ",", "\n", "with_crowd", "=", "True", ",", "\n", "with_label", "=", "True", ",", "\n", "with_semantic_seg", "=", "False", ",", "\n", "seg_prefix", "=", "None", ",", "\n", "seg_scale_factor", "=", "1", ",", "\n", "extra_aug", "=", "None", ",", "\n", "resize_keep_ratio", "=", "True", ",", "\n", "test_mode", "=", "False", ")", ":", "\n", "# prefix of images path", "\n", "        ", "self", ".", "img_prefix", "=", "img_prefix", "\n", "\n", "# load annotations (and proposals)", "\n", "self", ".", "img_infos", "=", "self", ".", "load_annotations", "(", "ann_file", ")", "\n", "if", "proposal_file", "is", "not", "None", ":", "\n", "            ", "self", ".", "proposals", "=", "self", ".", "load_proposals", "(", "proposal_file", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "proposals", "=", "None", "\n", "# filter images with no annotation during training", "\n", "", "if", "not", "test_mode", ":", "\n", "            ", "valid_inds", "=", "self", ".", "_filter_imgs", "(", ")", "\n", "self", ".", "img_infos", "=", "[", "self", ".", "img_infos", "[", "i", "]", "for", "i", "in", "valid_inds", "]", "\n", "if", "self", ".", "proposals", "is", "not", "None", ":", "\n", "                ", "self", ".", "proposals", "=", "[", "self", ".", "proposals", "[", "i", "]", "for", "i", "in", "valid_inds", "]", "\n", "\n", "# (long_edge, short_edge) or [(long1, short1), (long2, short2), ...]", "\n", "", "", "self", ".", "img_scales", "=", "img_scale", "if", "isinstance", "(", "img_scale", ",", "\n", "list", ")", "else", "[", "img_scale", "]", "\n", "assert", "mmcv", ".", "is_list_of", "(", "self", ".", "img_scales", ",", "tuple", ")", "\n", "# normalization configs", "\n", "self", ".", "img_norm_cfg", "=", "img_norm_cfg", "\n", "\n", "# multi-scale mode (only applicable for multi-scale training)", "\n", "self", ".", "multiscale_mode", "=", "multiscale_mode", "\n", "assert", "multiscale_mode", "in", "[", "'value'", ",", "'range'", "]", "\n", "\n", "# max proposals per image", "\n", "self", ".", "num_max_proposals", "=", "num_max_proposals", "\n", "# flip ratio", "\n", "self", ".", "flip_ratio", "=", "flip_ratio", "\n", "assert", "flip_ratio", ">=", "0", "and", "flip_ratio", "<=", "1", "\n", "# padding border to ensure the image size can be divided by", "\n", "# size_divisor (used for FPN)", "\n", "self", ".", "size_divisor", "=", "size_divisor", "\n", "\n", "# with mask or not (reserved field, takes no effect)", "\n", "self", ".", "with_mask", "=", "with_mask", "\n", "# some datasets provide bbox annotations as ignore/crowd/difficult,", "\n", "# if `with_crowd` is True, then these info is returned.", "\n", "self", ".", "with_crowd", "=", "with_crowd", "\n", "# with label is False for RPN", "\n", "self", ".", "with_label", "=", "with_label", "\n", "# with semantic segmentation (stuff) annotation or not", "\n", "self", ".", "with_seg", "=", "with_semantic_seg", "\n", "# prefix of semantic segmentation map path", "\n", "self", ".", "seg_prefix", "=", "seg_prefix", "\n", "# rescale factor for segmentation maps", "\n", "self", ".", "seg_scale_factor", "=", "seg_scale_factor", "\n", "# in test mode or not", "\n", "self", ".", "test_mode", "=", "test_mode", "\n", "\n", "# set group flag for the sampler", "\n", "if", "not", "self", ".", "test_mode", ":", "\n", "            ", "self", ".", "_set_group_flag", "(", ")", "\n", "# transforms", "\n", "", "self", ".", "img_transform", "=", "ImageTransform", "(", "\n", "size_divisor", "=", "self", ".", "size_divisor", ",", "**", "self", ".", "img_norm_cfg", ")", "\n", "self", ".", "bbox_transform", "=", "BboxTransform", "(", ")", "\n", "self", ".", "mask_transform", "=", "MaskTransform", "(", ")", "\n", "self", ".", "seg_transform", "=", "SegMapTransform", "(", "self", ".", "size_divisor", ")", "\n", "self", ".", "numpy2tensor", "=", "Numpy2Tensor", "(", ")", "\n", "\n", "# if use extra augmentation", "\n", "if", "extra_aug", "is", "not", "None", ":", "\n", "            ", "self", ".", "extra_aug", "=", "ExtraAugmentation", "(", "**", "extra_aug", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "extra_aug", "=", "None", "\n", "\n", "# image rescale if keep ratio", "\n", "", "self", ".", "resize_keep_ratio", "=", "resize_keep_ratio", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.custom.CustomDataset.__len__": [[129, 131], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "img_infos", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.custom.CustomDataset.load_annotations": [[132, 134], ["mmcv.load"], "methods", ["None"], ["", "def", "load_annotations", "(", "self", ",", "ann_file", ")", ":", "\n", "        ", "return", "mmcv", ".", "load", "(", "ann_file", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.custom.CustomDataset.load_proposals": [[135, 137], ["mmcv.load"], "methods", ["None"], ["", "def", "load_proposals", "(", "self", ",", "proposal_file", ")", ":", "\n", "        ", "return", "mmcv", ".", "load", "(", "proposal_file", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.custom.CustomDataset.get_ann_info": [[138, 140], ["None"], "methods", ["None"], ["", "def", "get_ann_info", "(", "self", ",", "idx", ")", ":", "\n", "        ", "return", "self", ".", "img_infos", "[", "idx", "]", "[", "'ann'", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.custom.CustomDataset._filter_imgs": [[141, 148], ["enumerate", "min", "valid_inds.append"], "methods", ["None"], ["", "def", "_filter_imgs", "(", "self", ",", "min_size", "=", "32", ")", ":", "\n", "        ", "\"\"\"Filter images too small.\"\"\"", "\n", "valid_inds", "=", "[", "]", "\n", "for", "i", ",", "img_info", "in", "enumerate", "(", "self", ".", "img_infos", ")", ":", "\n", "            ", "if", "min", "(", "img_info", "[", "'width'", "]", ",", "img_info", "[", "'height'", "]", ")", ">=", "min_size", ":", "\n", "                ", "valid_inds", ".", "append", "(", "i", ")", "\n", "", "", "return", "valid_inds", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.custom.CustomDataset._set_group_flag": [[149, 160], ["numpy.zeros", "range", "len", "len"], "methods", ["None"], ["", "def", "_set_group_flag", "(", "self", ")", ":", "\n", "        ", "\"\"\"Set flag according to image aspect ratio.\n\n        Images with aspect ratio greater than 1 will be set as group 1,\n        otherwise group 0.\n        \"\"\"", "\n", "self", ".", "flag", "=", "np", ".", "zeros", "(", "len", "(", "self", ")", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "self", ")", ")", ":", "\n", "            ", "img_info", "=", "self", ".", "img_infos", "[", "i", "]", "\n", "if", "img_info", "[", "'width'", "]", "/", "img_info", "[", "'height'", "]", ">", "1", ":", "\n", "                ", "self", ".", "flag", "[", "i", "]", "=", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.custom.CustomDataset._rand_another": [[161, 164], ["numpy.random.choice", "numpy.where"], "methods", ["None"], ["", "", "", "def", "_rand_another", "(", "self", ",", "idx", ")", ":", "\n", "        ", "pool", "=", "np", ".", "where", "(", "self", ".", "flag", "==", "self", ".", "flag", "[", "idx", "]", ")", "[", "0", "]", "\n", "return", "np", ".", "random", ".", "choice", "(", "pool", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.custom.CustomDataset.__getitem__": [[165, 179], ["custom.CustomDataset.prepare_test_img", "custom.CustomDataset.prepare_train_img", "custom.CustomDataset._rand_another"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.custom.CustomDataset.prepare_test_img", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.custom.CustomDataset.prepare_train_img", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.custom.CustomDataset._rand_another"], ["", "def", "__getitem__", "(", "self", ",", "idx", ")", ":", "\n", "        ", "\"\"\"\n        This function may be called when model is formard.\n        :param idx:\n        :return:\n        \"\"\"", "\n", "if", "self", ".", "test_mode", ":", "\n", "            ", "return", "self", ".", "prepare_test_img", "(", "idx", ")", "\n", "", "while", "True", ":", "\n", "            ", "data", "=", "self", ".", "prepare_train_img", "(", "idx", ")", "\n", "if", "data", "is", "None", ":", "\n", "                ", "idx", "=", "self", ".", "_rand_another", "(", "idx", ")", "\n", "continue", "\n", "", "return", "data", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.custom.CustomDataset.prepare_train_img": [[180, 282], ["mmcv.imread", "custom.CustomDataset.get_ann_info", "utils.random_scale", "custom.CustomDataset.img_transform", "img.copy.copy.copy", "custom.CustomDataset.bbox_transform", "dict", "dict", "os.join", "len", "custom.CustomDataset.extra_aug", "mmcv.imread", "custom.CustomDataset.seg_transform", "mmcv.imrescale", "custom.CustomDataset.bbox_transform", "custom.CustomDataset.bbox_transform", "custom.CustomDataset.mask_transform", "mmcv.parallel.DataContainer", "mmcv.parallel.DataContainer", "mmcv.parallel.DataContainer", "mmcv.parallel.DataContainer", "mmcv.parallel.DataContainer", "len", "AssertionError", "numpy.random.rand", "os.join", "mmcv.imrescale.squeeze", "numpy.hstack", "mmcv.parallel.DataContainer", "mmcv.parallel.DataContainer", "mmcv.parallel.DataContainer", "utils.to_tensor", "utils.to_tensor", "utils.to_tensor", "utils.to_tensor", "img_info[].replace", "utils.to_tensor", "utils.to_tensor"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.augmentation_dataset.AugmentationDataset.get_ann_info", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.utils.random_scale", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.utils.to_tensor", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.utils.to_tensor", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.utils.to_tensor", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.utils.to_tensor", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.utils.to_tensor", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.utils.to_tensor"], ["", "", "def", "prepare_train_img", "(", "self", ",", "idx", ")", ":", "\n", "        ", "\"\"\"\n\n        :param idx: the index of a image\n        :return:\n        \"\"\"", "\n", "img_info", "=", "self", ".", "img_infos", "[", "idx", "]", "\n", "# load image", "\n", "img", "=", "mmcv", ".", "imread", "(", "osp", ".", "join", "(", "self", ".", "img_prefix", ",", "img_info", "[", "'filename'", "]", ")", ")", "\n", "# load proposals if necessary", "\n", "if", "self", ".", "proposals", "is", "not", "None", ":", "\n", "            ", "proposals", "=", "self", ".", "proposals", "[", "idx", "]", "[", ":", "self", ".", "num_max_proposals", "]", "\n", "# TODO: Handle empty proposals properly. Currently images with", "\n", "# no proposals are just ignored, but they can be used for", "\n", "# training in concept.", "\n", "if", "len", "(", "proposals", ")", "==", "0", ":", "\n", "                ", "return", "None", "\n", "", "if", "not", "(", "proposals", ".", "shape", "[", "1", "]", "==", "4", "or", "proposals", ".", "shape", "[", "1", "]", "==", "5", ")", ":", "\n", "                ", "raise", "AssertionError", "(", "\n", "'proposals should have shapes (n, 4) or (n, 5), '", "\n", "'but found {}'", ".", "format", "(", "proposals", ".", "shape", ")", ")", "\n", "", "if", "proposals", ".", "shape", "[", "1", "]", "==", "5", ":", "\n", "                ", "scores", "=", "proposals", "[", ":", ",", "4", ",", "None", "]", "\n", "proposals", "=", "proposals", "[", ":", ",", ":", "4", "]", "\n", "", "else", ":", "\n", "                ", "scores", "=", "None", "\n", "\n", "", "", "ann", "=", "self", ".", "get_ann_info", "(", "idx", ")", "\n", "gt_bboxes", "=", "ann", "[", "'bboxes'", "]", "# the coordinates of top-left and bottom-right corners", "\n", "gt_labels", "=", "ann", "[", "'labels'", "]", "\n", "if", "self", ".", "with_crowd", ":", "\n", "            ", "gt_bboxes_ignore", "=", "ann", "[", "'bboxes_ignore'", "]", "\n", "\n", "# skip the image if there is no valid gt bbox", "\n", "", "if", "len", "(", "gt_bboxes", ")", "==", "0", ":", "\n", "            ", "return", "None", "\n", "\n", "# extra augmentation", "\n", "", "if", "self", ".", "extra_aug", "is", "not", "None", ":", "\n", "            ", "img", ",", "gt_bboxes", ",", "gt_labels", "=", "self", ".", "extra_aug", "(", "img", ",", "gt_bboxes", ",", "\n", "gt_labels", ")", "\n", "\n", "# apply transforms", "\n", "", "flip", "=", "True", "if", "np", ".", "random", ".", "rand", "(", ")", "<", "self", ".", "flip_ratio", "else", "False", "\n", "# randomly sample a scale", "\n", "img_scale", "=", "random_scale", "(", "self", ".", "img_scales", ",", "self", ".", "multiscale_mode", ")", "\n", "# get the image_shape with scale_factor. pad_shape such that both width and height", "\n", "# can be divided by size_divisor", "\n", "img", ",", "img_shape", ",", "pad_shape", ",", "scale_factor", "=", "self", ".", "img_transform", "(", "\n", "img", ",", "img_scale", ",", "flip", ",", "keep_ratio", "=", "self", ".", "resize_keep_ratio", ")", "\n", "img", "=", "img", ".", "copy", "(", ")", "\n", "if", "self", ".", "with_seg", ":", "\n", "            ", "gt_seg", "=", "mmcv", ".", "imread", "(", "\n", "osp", ".", "join", "(", "self", ".", "seg_prefix", ",", "img_info", "[", "'file_name'", "]", ".", "replace", "(", "\n", "'jpg'", ",", "'png'", ")", ")", ",", "\n", "flag", "=", "'unchanged'", ")", "\n", "gt_seg", "=", "self", ".", "seg_transform", "(", "gt_seg", ".", "squeeze", "(", ")", ",", "img_scale", ",", "flip", ")", "\n", "gt_seg", "=", "mmcv", ".", "imrescale", "(", "\n", "gt_seg", ",", "self", ".", "seg_scale_factor", ",", "interpolation", "=", "'nearest'", ")", "\n", "gt_seg", "=", "gt_seg", "[", "None", ",", "...", "]", "\n", "", "if", "self", ".", "proposals", "is", "not", "None", ":", "\n", "            ", "proposals", "=", "self", ".", "bbox_transform", "(", "proposals", ",", "img_shape", ",", "scale_factor", ",", "\n", "flip", ")", "\n", "proposals", "=", "np", ".", "hstack", "(", "\n", "[", "proposals", ",", "scores", "]", ")", "if", "scores", "is", "not", "None", "else", "proposals", "\n", "", "gt_bboxes", "=", "self", ".", "bbox_transform", "(", "gt_bboxes", ",", "img_shape", ",", "scale_factor", ",", "\n", "flip", ")", "\n", "if", "self", ".", "with_crowd", ":", "\n", "            ", "gt_bboxes_ignore", "=", "self", ".", "bbox_transform", "(", "gt_bboxes_ignore", ",", "img_shape", ",", "\n", "scale_factor", ",", "flip", ")", "\n", "", "if", "self", ".", "with_mask", ":", "\n", "            ", "gt_masks", "=", "self", ".", "mask_transform", "(", "ann", "[", "'masks'", "]", ",", "pad_shape", ",", "\n", "scale_factor", ",", "flip", ")", "\n", "\n", "", "ori_shape", "=", "(", "img_info", "[", "'height'", "]", ",", "img_info", "[", "'width'", "]", ",", "3", ")", "\n", "# img_meta store the infomation of image:", "\n", "# ori_shape:the original shape of images;", "\n", "# img_shape: resale the image with scale_factor such that the short and long side", "\n", "# are no longer than (max_short, max_long)", "\n", "# pad_shape: pad the image such that both the side can be divided by size_divisor", "\n", "img_meta", "=", "dict", "(", "\n", "ori_shape", "=", "ori_shape", ",", "\n", "img_shape", "=", "img_shape", ",", "\n", "pad_shape", "=", "pad_shape", ",", "\n", "scale_factor", "=", "scale_factor", ",", "\n", "flip", "=", "flip", ")", "\n", "\n", "data", "=", "dict", "(", "\n", "img", "=", "DC", "(", "to_tensor", "(", "img", ")", ",", "stack", "=", "True", ")", ",", "\n", "img_meta", "=", "DC", "(", "img_meta", ",", "cpu_only", "=", "True", ")", ",", "\n", "gt_bboxes", "=", "DC", "(", "to_tensor", "(", "gt_bboxes", ")", ")", ")", "\n", "if", "self", ".", "proposals", "is", "not", "None", ":", "\n", "            ", "data", "[", "'proposals'", "]", "=", "DC", "(", "to_tensor", "(", "proposals", ")", ")", "\n", "", "if", "self", ".", "with_label", ":", "\n", "            ", "data", "[", "'gt_labels'", "]", "=", "DC", "(", "to_tensor", "(", "gt_labels", ")", ")", "\n", "", "if", "self", ".", "with_crowd", ":", "\n", "            ", "data", "[", "'gt_bboxes_ignore'", "]", "=", "DC", "(", "to_tensor", "(", "gt_bboxes_ignore", ")", ")", "\n", "", "if", "self", ".", "with_mask", ":", "\n", "            ", "data", "[", "'gt_masks'", "]", "=", "DC", "(", "gt_masks", ",", "cpu_only", "=", "True", ")", "\n", "", "if", "self", ".", "with_seg", ":", "\n", "            ", "data", "[", "'gt_semantic_seg'", "]", "=", "DC", "(", "to_tensor", "(", "gt_seg", ")", ",", "stack", "=", "True", ")", "\n", "", "return", "data", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.custom.CustomDataset.prepare_test_img": [[283, 360], ["mmcv.imread", "custom.CustomDataset.get_ann_info", "dict", "os.join", "custom.CustomDataset.img_transform", "utils.to_tensor", "dict", "custom.CustomDataset.prepare_test_img.prepare_single"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.augmentation_dataset.AugmentationDataset.get_ann_info", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.utils.to_tensor"], ["", "def", "prepare_test_img", "(", "self", ",", "idx", ")", ":", "\n", "        ", "\"\"\"Prepare an image for testing (multi-scale and flipping)\"\"\"", "\n", "img_info", "=", "self", ".", "img_infos", "[", "idx", "]", "\n", "img", "=", "mmcv", ".", "imread", "(", "osp", ".", "join", "(", "self", ".", "img_prefix", ",", "img_info", "[", "'filename'", "]", ")", ")", "\n", "if", "self", ".", "proposals", "is", "not", "None", ":", "\n", "            ", "proposal", "=", "self", ".", "proposals", "[", "idx", "]", "[", ":", "self", ".", "num_max_proposals", "]", "\n", "if", "not", "(", "proposal", ".", "shape", "[", "1", "]", "==", "4", "or", "proposal", ".", "shape", "[", "1", "]", "==", "5", ")", ":", "\n", "                ", "raise", "AssertionError", "(", "\n", "'proposals should have shapes (n, 4) or (n, 5), '", "\n", "'but found {}'", ".", "format", "(", "proposal", ".", "shape", ")", ")", "\n", "", "", "else", ":", "\n", "            ", "proposal", "=", "None", "\n", "\n", "", "def", "prepare_single", "(", "img", ",", "scale", ",", "flip", ",", "proposal", "=", "None", ")", ":", "\n", "            ", "_img", ",", "img_shape", ",", "pad_shape", ",", "scale_factor", "=", "self", ".", "img_transform", "(", "\n", "img", ",", "scale", ",", "flip", ",", "keep_ratio", "=", "self", ".", "resize_keep_ratio", ")", "\n", "_img", "=", "to_tensor", "(", "_img", ")", "\n", "_img_meta", "=", "dict", "(", "\n", "ori_shape", "=", "(", "img_info", "[", "'height'", "]", ",", "img_info", "[", "'width'", "]", ",", "3", ")", ",", "\n", "img_shape", "=", "img_shape", ",", "\n", "pad_shape", "=", "pad_shape", ",", "\n", "scale_factor", "=", "scale_factor", ",", "\n", "flip", "=", "flip", ")", "\n", "if", "proposal", "is", "not", "None", ":", "\n", "                ", "if", "proposal", ".", "shape", "[", "1", "]", "==", "5", ":", "\n", "                    ", "score", "=", "proposal", "[", ":", ",", "4", ",", "None", "]", "\n", "proposal", "=", "proposal", "[", ":", ",", ":", "4", "]", "\n", "", "else", ":", "\n", "                    ", "score", "=", "None", "\n", "", "_proposal", "=", "self", ".", "bbox_transform", "(", "proposal", ",", "img_shape", ",", "\n", "scale_factor", ",", "flip", ")", "\n", "_proposal", "=", "np", ".", "hstack", "(", "\n", "[", "_proposal", ",", "score", "]", ")", "if", "score", "is", "not", "None", "else", "_proposal", "\n", "_proposal", "=", "to_tensor", "(", "_proposal", ")", "\n", "", "else", ":", "\n", "                ", "_proposal", "=", "None", "\n", "", "return", "_img", ",", "_img_meta", ",", "_proposal", "\n", "\n", "", "imgs", "=", "[", "]", "\n", "img_metas", "=", "[", "]", "\n", "proposals", "=", "[", "]", "\n", "\n", "# added by WSK", "\n", "gt_bboxes_list", "=", "[", "]", "\n", "gt_labels_list", "=", "[", "]", "\n", "ann", "=", "self", ".", "get_ann_info", "(", "idx", ")", "\n", "gt_bboxes", "=", "ann", "[", "'bboxes'", "]", "\n", "gt_labels", "=", "ann", "[", "'labels'", "]", "\n", "\n", "# (long_edge, short_edge) or [(long1, short1), (long2, short2), ...]", "\n", "for", "scale", "in", "self", ".", "img_scales", ":", "\n", "            ", "_img", ",", "_img_meta", ",", "_proposal", "=", "prepare_single", "(", "\n", "img", ",", "scale", ",", "False", ",", "proposal", ")", "\n", "\n", "# added by WSK", "\n", "gt_bboxes", "=", "self", ".", "bbox_transform", "(", "gt_bboxes", ",", "_img_meta", "[", "'img_shape'", "]", ",", "_img_meta", "[", "'scale_factor'", "]", ",", "\n", "flip", "=", "False", ")", "\n", "gt_bboxes_list", ".", "append", "(", "DC", "(", "to_tensor", "(", "gt_bboxes", ")", ")", ")", "\n", "gt_labels_list", ".", "append", "(", "DC", "(", "to_tensor", "(", "gt_labels", ")", ")", ")", "\n", "\n", "imgs", ".", "append", "(", "_img", ")", "\n", "img_metas", ".", "append", "(", "DC", "(", "_img_meta", ",", "cpu_only", "=", "True", ")", ")", "\n", "proposals", ".", "append", "(", "_proposal", ")", "\n", "if", "self", ".", "flip_ratio", ">", "0", ":", "\n", "                ", "_img", ",", "_img_meta", ",", "_proposal", "=", "prepare_single", "(", "\n", "img", ",", "scale", ",", "True", ",", "proposal", ")", "\n", "imgs", ".", "append", "(", "_img", ")", "\n", "img_metas", ".", "append", "(", "DC", "(", "_img_meta", ",", "cpu_only", "=", "True", ")", ")", "\n", "proposals", ".", "append", "(", "_proposal", ")", "\n", "", "", "data", "=", "dict", "(", "img", "=", "imgs", ",", "\n", "img_meta", "=", "img_metas", ",", "\n", "gt_bboxes", "=", "gt_bboxes_list", ",", "\n", "gt_labels", "=", "gt_labels_list", "\n", ")", "\n", "if", "self", ".", "proposals", "is", "not", "None", ":", "\n", "            ", "data", "[", "'proposals'", "]", "=", "proposals", "\n", "", "return", "data", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.transforms.ImageTransform.__init__": [[21, 30], ["numpy.array", "numpy.array"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "\n", "mean", "=", "(", "0", ",", "0", ",", "0", ")", ",", "\n", "std", "=", "(", "1", ",", "1", ",", "1", ")", ",", "\n", "to_rgb", "=", "True", ",", "\n", "size_divisor", "=", "None", ")", ":", "\n", "        ", "self", ".", "mean", "=", "np", ".", "array", "(", "mean", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "self", ".", "std", "=", "np", ".", "array", "(", "std", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "self", ".", "to_rgb", "=", "to_rgb", "\n", "self", ".", "size_divisor", "=", "size_divisor", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.transforms.ImageTransform.__call__": [[31, 51], ["mmcv.imnormalize", "mmcv.impad_to_multiple.transpose", "mmcv.imrescale", "mmcv.imresize", "numpy.array", "mmcv.imflip", "mmcv.impad_to_multiple"], "methods", ["None"], ["", "def", "__call__", "(", "self", ",", "img", ",", "scale", ",", "flip", "=", "False", ",", "keep_ratio", "=", "True", ")", ":", "\n", "        ", "if", "keep_ratio", ":", "\n", "            ", "img", ",", "scale_factor", "=", "mmcv", ".", "imrescale", "(", "img", ",", "scale", ",", "return_scale", "=", "True", ")", "\n", "", "else", ":", "\n", "            ", "img", ",", "w_scale", ",", "h_scale", "=", "mmcv", ".", "imresize", "(", "\n", "img", ",", "scale", ",", "return_scale", "=", "True", ")", "\n", "scale_factor", "=", "np", ".", "array", "(", "\n", "[", "w_scale", ",", "h_scale", ",", "w_scale", ",", "h_scale", "]", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "", "img_shape", "=", "img", ".", "shape", "\n", "img", "=", "mmcv", ".", "imnormalize", "(", "img", ",", "self", ".", "mean", ",", "self", ".", "std", ",", "self", ".", "to_rgb", ")", "\n", "if", "flip", ":", "\n", "            ", "img", "=", "mmcv", ".", "imflip", "(", "img", ")", "\n", "", "if", "self", ".", "size_divisor", "is", "not", "None", ":", "\n", "# Pad an image to ensure each edge to be multiple to size_divisor", "\n", "            ", "img", "=", "mmcv", ".", "impad_to_multiple", "(", "img", ",", "self", ".", "size_divisor", ")", "\n", "pad_shape", "=", "img", ".", "shape", "\n", "", "else", ":", "\n", "            ", "pad_shape", "=", "img_shape", "\n", "", "img", "=", "img", ".", "transpose", "(", "2", ",", "0", ",", "1", ")", "\n", "return", "img", ",", "img_shape", ",", "pad_shape", ",", "scale_factor", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.transforms.BboxTransform.__init__": [[76, 78], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "max_num_gts", "=", "None", ")", ":", "\n", "        ", "self", ".", "max_num_gts", "=", "max_num_gts", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.transforms.BboxTransform.__call__": [[79, 101], ["numpy.clip", "numpy.clip", "transforms.bbox_flip", "numpy.zeros"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox_flip"], ["", "def", "__call__", "(", "self", ",", "bboxes", ",", "img_shape", ",", "scale_factor", ",", "flip", "=", "False", ")", ":", "\n", "        ", "\"\"\"\n\n        :param bboxes: (num_gt, 4), store the coordinates of gt boxes: (x_tl, y_tl, x_br, y_br)\n                for each image. (w is the direction of x, and h is the direction of y.)\n        :param img_shape: (h,w)\n        :param scale_factor:\n        :param flip:\n        :return:\n        \"\"\"", "\n", "gt_bboxes", "=", "bboxes", "*", "scale_factor", "\n", "if", "flip", ":", "\n", "            ", "gt_bboxes", "=", "bbox_flip", "(", "gt_bboxes", ",", "img_shape", ")", "\n", "", "gt_bboxes", "[", ":", ",", "0", ":", ":", "2", "]", "=", "np", ".", "clip", "(", "gt_bboxes", "[", ":", ",", "0", ":", ":", "2", "]", ",", "0", ",", "img_shape", "[", "1", "]", "-", "1", ")", "\n", "gt_bboxes", "[", ":", ",", "1", ":", ":", "2", "]", "=", "np", ".", "clip", "(", "gt_bboxes", "[", ":", ",", "1", ":", ":", "2", "]", ",", "0", ",", "img_shape", "[", "0", "]", "-", "1", ")", "\n", "if", "self", ".", "max_num_gts", "is", "None", ":", "\n", "            ", "return", "gt_bboxes", "\n", "", "else", ":", "\n", "            ", "num_gts", "=", "gt_bboxes", ".", "shape", "[", "0", "]", "\n", "padded_bboxes", "=", "np", ".", "zeros", "(", "(", "self", ".", "max_num_gts", ",", "4", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "padded_bboxes", "[", ":", "num_gts", ",", ":", "]", "=", "gt_bboxes", "\n", "return", "padded_bboxes", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.transforms.MaskTransform.__call__": [[111, 123], ["numpy.stack", "mmcv.imrescale", "mmcv.impad"], "methods", ["None"], ["def", "__call__", "(", "self", ",", "masks", ",", "pad_shape", ",", "scale_factor", ",", "flip", "=", "False", ")", ":", "\n", "        ", "masks", "=", "[", "\n", "mmcv", ".", "imrescale", "(", "mask", ",", "scale_factor", ",", "interpolation", "=", "'nearest'", ")", "\n", "for", "mask", "in", "masks", "\n", "]", "\n", "if", "flip", ":", "\n", "            ", "masks", "=", "[", "mask", "[", ":", ",", ":", ":", "-", "1", "]", "for", "mask", "in", "masks", "]", "\n", "", "padded_masks", "=", "[", "\n", "mmcv", ".", "impad", "(", "mask", ",", "pad_shape", "[", ":", "2", "]", ",", "pad_val", "=", "0", ")", "for", "mask", "in", "masks", "\n", "]", "\n", "padded_masks", "=", "np", ".", "stack", "(", "padded_masks", ",", "axis", "=", "0", ")", "\n", "return", "padded_masks", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.transforms.SegMapTransform.__init__": [[133, 135], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "size_divisor", "=", "None", ")", ":", "\n", "        ", "self", ".", "size_divisor", "=", "size_divisor", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.transforms.SegMapTransform.__call__": [[136, 146], ["mmcv.imrescale", "mmcv.imresize", "mmcv.imflip", "mmcv.impad_to_multiple"], "methods", ["None"], ["", "def", "__call__", "(", "self", ",", "img", ",", "scale", ",", "flip", "=", "False", ",", "keep_ratio", "=", "True", ")", ":", "\n", "        ", "if", "keep_ratio", ":", "\n", "            ", "img", "=", "mmcv", ".", "imrescale", "(", "img", ",", "scale", ",", "interpolation", "=", "'nearest'", ")", "\n", "", "else", ":", "\n", "            ", "img", "=", "mmcv", ".", "imresize", "(", "img", ",", "scale", ",", "interpolation", "=", "'nearest'", ")", "\n", "", "if", "flip", ":", "\n", "            ", "img", "=", "mmcv", ".", "imflip", "(", "img", ")", "\n", "", "if", "self", ".", "size_divisor", "is", "not", "None", ":", "\n", "            ", "img", "=", "mmcv", ".", "impad_to_multiple", "(", "img", ",", "self", ".", "size_divisor", ")", "\n", "", "return", "img", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.transforms.Numpy2Tensor.__init__": [[150, 152], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.transforms.Numpy2Tensor.__call__": [[153, 158], ["len", "torch.from_numpy", "tuple", "torch.from_numpy", "numpy.array"], "methods", ["None"], ["", "def", "__call__", "(", "self", ",", "*", "args", ")", ":", "\n", "        ", "if", "len", "(", "args", ")", "==", "1", ":", "\n", "            ", "return", "torch", ".", "from_numpy", "(", "args", "[", "0", "]", ")", "\n", "", "else", ":", "\n", "            ", "return", "tuple", "(", "[", "torch", ".", "from_numpy", "(", "np", ".", "array", "(", "array", ")", ")", "for", "array", "in", "args", "]", ")", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.transforms.bbox_flip": [[53, 66], ["bboxes.copy"], "function", ["None"], ["", "", "def", "bbox_flip", "(", "bboxes", ",", "img_shape", ")", ":", "\n", "    ", "\"\"\"Flip bboxes horizontally.\n\n    Args:\n        bboxes(ndarray): shape (..., 4*k)\n        img_shape(tuple): (height, width)\n    \"\"\"", "\n", "assert", "bboxes", ".", "shape", "[", "-", "1", "]", "%", "4", "==", "0", "\n", "w", "=", "img_shape", "[", "1", "]", "\n", "flipped", "=", "bboxes", ".", "copy", "(", ")", "\n", "flipped", "[", "...", ",", "0", ":", ":", "4", "]", "=", "w", "-", "bboxes", "[", "...", ",", "2", ":", ":", "4", "]", "-", "1", "\n", "flipped", "[", "...", ",", "2", ":", ":", "4", "]", "=", "w", "-", "bboxes", "[", "...", ",", "0", ":", ":", "4", "]", "-", "1", "\n", "return", "flipped", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.coco.CocoDataset.load_annotations": [[25, 39], ["pycocotools.coco.COCO", "coco.CocoDataset.coco.getCatIds", "coco.CocoDataset.coco.getImgIds", "img_infos.append", "enumerate", "coco.CocoDataset.coco.loadImgs"], "methods", ["None"], ["def", "load_annotations", "(", "self", ",", "ann_file", ")", ":", "\n", "        ", "self", ".", "coco", "=", "COCO", "(", "ann_file", ")", "\n", "self", ".", "cat_ids", "=", "self", ".", "coco", ".", "getCatIds", "(", ")", "\n", "self", ".", "cat2label", "=", "{", "\n", "cat_id", ":", "i", "+", "1", "\n", "for", "i", ",", "cat_id", "in", "enumerate", "(", "self", ".", "cat_ids", ")", "\n", "}", "\n", "self", ".", "img_ids", "=", "self", ".", "coco", ".", "getImgIds", "(", ")", "\n", "img_infos", "=", "[", "]", "\n", "for", "i", "in", "self", ".", "img_ids", ":", "\n", "            ", "info", "=", "self", ".", "coco", ".", "loadImgs", "(", "[", "i", "]", ")", "[", "0", "]", "\n", "info", "[", "'filename'", "]", "=", "info", "[", "'file_name'", "]", "\n", "img_infos", ".", "append", "(", "info", ")", "\n", "", "return", "img_infos", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.coco.CocoDataset.get_ann_info": [[40, 54], ["coco.CocoDataset.coco.getAnnIds", "coco.CocoDataset.coco.loadAnns", "coco.CocoDataset._parse_ann_info"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.augmentation_dataset.AugmentationDataset._parse_ann_info"], ["", "def", "get_ann_info", "(", "self", ",", "idx", ")", ":", "\n", "        ", "\"\"\"\n        get the annotation information(bboxes, bboxes_ignore, labels, masks and so on)\n        for the image with index idx\n        :param idx:\n        :return: dict: A dict containing the following keys: bboxes, bboxes_ignore,\n                labels, masks, mask_polys, poly_lens for one image with index idx\n                bboxes: list of list, bbox[i, :] represents the coordinates of\n                        top-left and bottom-right corner.\n        \"\"\"", "\n", "img_id", "=", "self", ".", "img_infos", "[", "idx", "]", "[", "'id'", "]", "\n", "ann_ids", "=", "self", ".", "coco", ".", "getAnnIds", "(", "imgIds", "=", "[", "img_id", "]", ")", "\n", "ann_info", "=", "self", ".", "coco", ".", "loadAnns", "(", "ann_ids", ")", "\n", "return", "self", ".", "_parse_ann_info", "(", "ann_info", ",", "self", ".", "with_mask", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.coco.CocoDataset._filter_imgs": [[55, 65], ["set", "enumerate", "min", "valid_inds.append", "coco.CocoDataset.coco.anns.values"], "methods", ["None"], ["", "def", "_filter_imgs", "(", "self", ",", "min_size", "=", "32", ")", ":", "\n", "        ", "\"\"\"Filter images too small or without ground truths.\"\"\"", "\n", "valid_inds", "=", "[", "]", "\n", "ids_with_ann", "=", "set", "(", "_", "[", "'image_id'", "]", "for", "_", "in", "self", ".", "coco", ".", "anns", ".", "values", "(", ")", ")", "\n", "for", "i", ",", "img_info", "in", "enumerate", "(", "self", ".", "img_infos", ")", ":", "\n", "            ", "if", "self", ".", "img_ids", "[", "i", "]", "not", "in", "ids_with_ann", ":", "\n", "                ", "continue", "\n", "", "if", "min", "(", "img_info", "[", "'width'", "]", ",", "img_info", "[", "'height'", "]", ")", ">=", "min_size", ":", "\n", "                ", "valid_inds", ".", "append", "(", "i", ")", "\n", "", "", "return", "valid_inds", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.coco.CocoDataset._parse_ann_info": [[66, 131], ["enumerate", "dict", "dict.get", "numpy.array", "numpy.array", "numpy.zeros", "numpy.array", "numpy.array", "numpy.zeros", "numpy.zeros.append", "numpy.zeros.append", "numpy.array.append", "gt_masks.append", "gt_mask_polys.append", "gt_poly_lens.extend", "coco.CocoDataset.coco.annToMask", "len", "len"], "methods", ["None"], ["", "def", "_parse_ann_info", "(", "self", ",", "ann_info", ",", "with_mask", "=", "True", ")", ":", "\n", "        ", "\"\"\"Parse bbox and mask annotation.\n\n        Args:\n            ann_info (list[dict]): Annotation info of an image.\n            with_mask (bool): Whether to parse mask annotations.\n\n        Returns:\n            dict: A dict containing the following keys: bboxes, bboxes_ignore,\n                labels, masks, mask_polys, poly_lens.\n                bboxes: list of list, bbox[i, :] represents the coordinates of\n                        top-left and bottom-right corner.\n        \"\"\"", "\n", "gt_bboxes", "=", "[", "]", "\n", "gt_labels", "=", "[", "]", "\n", "gt_bboxes_ignore", "=", "[", "]", "\n", "# Two formats are provided.", "\n", "# 1. mask: a binary map of the same size of the image.", "\n", "# 2. polys: each mask consists of one or several polys, each poly is a", "\n", "# list of float.", "\n", "if", "with_mask", ":", "\n", "            ", "gt_masks", "=", "[", "]", "\n", "gt_mask_polys", "=", "[", "]", "\n", "gt_poly_lens", "=", "[", "]", "\n", "", "for", "i", ",", "ann", "in", "enumerate", "(", "ann_info", ")", ":", "\n", "            ", "if", "ann", ".", "get", "(", "'ignore'", ",", "False", ")", ":", "\n", "                ", "continue", "\n", "", "x1", ",", "y1", ",", "w", ",", "h", "=", "ann", "[", "'bbox'", "]", "\n", "if", "ann", "[", "'area'", "]", "<=", "0", "or", "w", "<", "1", "or", "h", "<", "1", ":", "\n", "                ", "continue", "\n", "", "bbox", "=", "[", "x1", ",", "y1", ",", "x1", "+", "w", "-", "1", ",", "y1", "+", "h", "-", "1", "]", "\n", "if", "ann", "[", "'iscrowd'", "]", ":", "\n", "                ", "gt_bboxes_ignore", ".", "append", "(", "bbox", ")", "\n", "", "else", ":", "\n", "                ", "gt_bboxes", ".", "append", "(", "bbox", ")", "\n", "gt_labels", ".", "append", "(", "self", ".", "cat2label", "[", "ann", "[", "'category_id'", "]", "]", ")", "\n", "", "if", "with_mask", ":", "\n", "                ", "gt_masks", ".", "append", "(", "self", ".", "coco", ".", "annToMask", "(", "ann", ")", ")", "\n", "mask_polys", "=", "[", "\n", "p", "for", "p", "in", "ann", "[", "'segmentation'", "]", "if", "len", "(", "p", ")", ">=", "6", "\n", "]", "# valid polygons have >= 3 points (6 coordinates)", "\n", "poly_lens", "=", "[", "len", "(", "p", ")", "for", "p", "in", "mask_polys", "]", "\n", "gt_mask_polys", ".", "append", "(", "mask_polys", ")", "\n", "gt_poly_lens", ".", "extend", "(", "poly_lens", ")", "\n", "", "", "if", "gt_bboxes", ":", "\n", "            ", "gt_bboxes", "=", "np", ".", "array", "(", "gt_bboxes", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "gt_labels", "=", "np", ".", "array", "(", "gt_labels", ",", "dtype", "=", "np", ".", "int64", ")", "\n", "", "else", ":", "\n", "            ", "gt_bboxes", "=", "np", ".", "zeros", "(", "(", "0", ",", "4", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "gt_labels", "=", "np", ".", "array", "(", "[", "]", ",", "dtype", "=", "np", ".", "int64", ")", "\n", "\n", "", "if", "gt_bboxes_ignore", ":", "\n", "            ", "gt_bboxes_ignore", "=", "np", ".", "array", "(", "gt_bboxes_ignore", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "", "else", ":", "\n", "            ", "gt_bboxes_ignore", "=", "np", ".", "zeros", "(", "(", "0", ",", "4", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "\n", "", "ann", "=", "dict", "(", "\n", "bboxes", "=", "gt_bboxes", ",", "labels", "=", "gt_labels", ",", "bboxes_ignore", "=", "gt_bboxes_ignore", ")", "\n", "\n", "if", "with_mask", ":", "\n", "            ", "ann", "[", "'masks'", "]", "=", "gt_masks", "\n", "# poly format is not used in the current implementation", "\n", "ann", "[", "'mask_polys'", "]", "=", "gt_mask_polys", "\n", "ann", "[", "'poly_lens'", "]", "=", "gt_poly_lens", "\n", "", "return", "ann", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.xml_style.XMLDataset.__init__": [[12, 15], ["custom.CustomDataset.__init__", "enumerate"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "XMLDataset", ",", "self", ")", ".", "__init__", "(", "**", "kwargs", ")", "\n", "self", ".", "cat2label", "=", "{", "cat", ":", "i", "+", "1", "for", "i", ",", "cat", "in", "enumerate", "(", "self", ".", "CLASSES", ")", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.xml_style.XMLDataset.load_annotations": [[16, 31], ["mmcv.list_from_file", "os.join", "xml.parse", "xml.parse.getroot", "ET.parse.getroot.find", "int", "int", "img_infos.append", "dict", "tree.getroot.find.find", "tree.getroot.find.find"], "methods", ["None"], ["", "def", "load_annotations", "(", "self", ",", "ann_file", ")", ":", "\n", "        ", "img_infos", "=", "[", "]", "\n", "img_ids", "=", "mmcv", ".", "list_from_file", "(", "ann_file", ")", "\n", "for", "img_id", "in", "img_ids", ":", "\n", "            ", "filename", "=", "'JPEGImages/{}.jpg'", ".", "format", "(", "img_id", ")", "\n", "xml_path", "=", "osp", ".", "join", "(", "self", ".", "img_prefix", ",", "'Annotations'", ",", "\n", "'{}.xml'", ".", "format", "(", "img_id", ")", ")", "\n", "tree", "=", "ET", ".", "parse", "(", "xml_path", ")", "\n", "root", "=", "tree", ".", "getroot", "(", ")", "\n", "size", "=", "root", ".", "find", "(", "'size'", ")", "\n", "width", "=", "int", "(", "size", ".", "find", "(", "'width'", ")", ".", "text", ")", "\n", "height", "=", "int", "(", "size", ".", "find", "(", "'height'", ")", ".", "text", ")", "\n", "img_infos", ".", "append", "(", "\n", "dict", "(", "id", "=", "img_id", ",", "filename", "=", "filename", ",", "width", "=", "width", ",", "height", "=", "height", ")", ")", "\n", "", "return", "img_infos", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.xml_style.XMLDataset.get_ann_info": [[32, 77], ["os.join", "xml.parse", "xml.parse.getroot", "ET.parse.getroot.findall", "dict", "int", "obj.find", "numpy.zeros", "numpy.zeros", "numpy.array", "numpy.zeros", "numpy.zeros", "numpy.array", "obj.find", "int", "int", "int", "int", "numpy.zeros.append", "numpy.array.append", "numpy.zeros.append", "numpy.array.append", "numpy.array", "numpy.array", "numpy.zeros.astype", "numpy.array.astype", "numpy.zeros.astype", "numpy.array.astype", "obj.find", "obj.find.find", "obj.find.find", "obj.find.find", "obj.find.find"], "methods", ["None"], ["", "def", "get_ann_info", "(", "self", ",", "idx", ")", ":", "\n", "        ", "img_id", "=", "self", ".", "img_infos", "[", "idx", "]", "[", "'id'", "]", "\n", "xml_path", "=", "osp", ".", "join", "(", "self", ".", "img_prefix", ",", "'Annotations'", ",", "\n", "'{}.xml'", ".", "format", "(", "img_id", ")", ")", "\n", "tree", "=", "ET", ".", "parse", "(", "xml_path", ")", "\n", "root", "=", "tree", ".", "getroot", "(", ")", "\n", "bboxes", "=", "[", "]", "\n", "labels", "=", "[", "]", "\n", "bboxes_ignore", "=", "[", "]", "\n", "labels_ignore", "=", "[", "]", "\n", "for", "obj", "in", "root", ".", "findall", "(", "'object'", ")", ":", "\n", "            ", "name", "=", "obj", ".", "find", "(", "'name'", ")", ".", "text", "\n", "label", "=", "self", ".", "cat2label", "[", "name", "]", "\n", "difficult", "=", "int", "(", "obj", ".", "find", "(", "'difficult'", ")", ".", "text", ")", "\n", "bnd_box", "=", "obj", ".", "find", "(", "'bndbox'", ")", "\n", "bbox", "=", "[", "\n", "int", "(", "bnd_box", ".", "find", "(", "'xmin'", ")", ".", "text", ")", ",", "\n", "int", "(", "bnd_box", ".", "find", "(", "'ymin'", ")", ".", "text", ")", ",", "\n", "int", "(", "bnd_box", ".", "find", "(", "'xmax'", ")", ".", "text", ")", ",", "\n", "int", "(", "bnd_box", ".", "find", "(", "'ymax'", ")", ".", "text", ")", "\n", "]", "\n", "if", "difficult", ":", "\n", "                ", "bboxes_ignore", ".", "append", "(", "bbox", ")", "\n", "labels_ignore", ".", "append", "(", "label", ")", "\n", "", "else", ":", "\n", "                ", "bboxes", ".", "append", "(", "bbox", ")", "\n", "labels", ".", "append", "(", "label", ")", "\n", "", "", "if", "not", "bboxes", ":", "\n", "            ", "bboxes", "=", "np", ".", "zeros", "(", "(", "0", ",", "4", ")", ")", "\n", "labels", "=", "np", ".", "zeros", "(", "(", "0", ",", ")", ")", "\n", "", "else", ":", "\n", "            ", "bboxes", "=", "np", ".", "array", "(", "bboxes", ",", "ndmin", "=", "2", ")", "-", "1", "\n", "labels", "=", "np", ".", "array", "(", "labels", ")", "\n", "", "if", "not", "bboxes_ignore", ":", "\n", "            ", "bboxes_ignore", "=", "np", ".", "zeros", "(", "(", "0", ",", "4", ")", ")", "\n", "labels_ignore", "=", "np", ".", "zeros", "(", "(", "0", ",", ")", ")", "\n", "", "else", ":", "\n", "            ", "bboxes_ignore", "=", "np", ".", "array", "(", "bboxes_ignore", ",", "ndmin", "=", "2", ")", "-", "1", "\n", "labels_ignore", "=", "np", ".", "array", "(", "labels_ignore", ")", "\n", "", "ann", "=", "dict", "(", "\n", "bboxes", "=", "bboxes", ".", "astype", "(", "np", ".", "float32", ")", ",", "\n", "labels", "=", "labels", ".", "astype", "(", "np", ".", "int64", ")", ",", "\n", "bboxes_ignore", "=", "bboxes_ignore", ".", "astype", "(", "np", ".", "float32", ")", ",", "\n", "labels_ignore", "=", "labels_ignore", ".", "astype", "(", "np", ".", "int64", ")", ")", "\n", "return", "ann", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.extra_aug.PhotoMetricDistortion.__init__": [[10, 19], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "\n", "brightness_delta", "=", "32", ",", "\n", "contrast_range", "=", "(", "0.5", ",", "1.5", ")", ",", "\n", "saturation_range", "=", "(", "0.5", ",", "1.5", ")", ",", "\n", "hue_delta", "=", "18", ")", ":", "\n", "        ", "self", ".", "brightness_delta", "=", "brightness_delta", "\n", "self", ".", "contrast_lower", ",", "self", ".", "contrast_upper", "=", "contrast_range", "\n", "self", ".", "saturation_lower", ",", "self", ".", "saturation_upper", "=", "saturation_range", "\n", "self", ".", "hue_delta", "=", "hue_delta", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.extra_aug.PhotoMetricDistortion.__call__": [[20, 65], ["numpy.random.randint", "numpy.random.randint", "mmcv.bgr2hsv", "numpy.random.randint", "numpy.random.randint", "mmcv.hsv2bgr", "numpy.random.randint", "numpy.random.uniform", "numpy.random.randint", "numpy.random.uniform", "numpy.random.uniform", "numpy.random.randint", "numpy.random.uniform", "numpy.random.uniform", "numpy.random.permutation"], "methods", ["None"], ["", "def", "__call__", "(", "self", ",", "img", ",", "boxes", ",", "labels", ")", ":", "\n", "# random brightness", "\n", "        ", "if", "random", ".", "randint", "(", "2", ")", ":", "\n", "            ", "delta", "=", "random", ".", "uniform", "(", "-", "self", ".", "brightness_delta", ",", "\n", "self", ".", "brightness_delta", ")", "\n", "img", "+=", "delta", "\n", "\n", "# mode == 0 --> do random contrast first", "\n", "# mode == 1 --> do random contrast last", "\n", "", "mode", "=", "random", ".", "randint", "(", "2", ")", "\n", "if", "mode", "==", "1", ":", "\n", "            ", "if", "random", ".", "randint", "(", "2", ")", ":", "\n", "                ", "alpha", "=", "random", ".", "uniform", "(", "self", ".", "contrast_lower", ",", "\n", "self", ".", "contrast_upper", ")", "\n", "img", "*=", "alpha", "\n", "\n", "# convert color from BGR to HSV", "\n", "", "", "img", "=", "mmcv", ".", "bgr2hsv", "(", "img", ")", "\n", "\n", "# random saturation", "\n", "if", "random", ".", "randint", "(", "2", ")", ":", "\n", "            ", "img", "[", "...", ",", "1", "]", "*=", "random", ".", "uniform", "(", "self", ".", "saturation_lower", ",", "\n", "self", ".", "saturation_upper", ")", "\n", "\n", "# random hue", "\n", "", "if", "random", ".", "randint", "(", "2", ")", ":", "\n", "            ", "img", "[", "...", ",", "0", "]", "+=", "random", ".", "uniform", "(", "-", "self", ".", "hue_delta", ",", "self", ".", "hue_delta", ")", "\n", "img", "[", "...", ",", "0", "]", "[", "img", "[", "...", ",", "0", "]", ">", "360", "]", "-=", "360", "\n", "img", "[", "...", ",", "0", "]", "[", "img", "[", "...", ",", "0", "]", "<", "0", "]", "+=", "360", "\n", "\n", "# convert color from HSV to BGR", "\n", "", "img", "=", "mmcv", ".", "hsv2bgr", "(", "img", ")", "\n", "\n", "# random contrast", "\n", "if", "mode", "==", "0", ":", "\n", "            ", "if", "random", ".", "randint", "(", "2", ")", ":", "\n", "                ", "alpha", "=", "random", ".", "uniform", "(", "self", ".", "contrast_lower", ",", "\n", "self", ".", "contrast_upper", ")", "\n", "img", "*=", "alpha", "\n", "\n", "# randomly swap channels", "\n", "", "", "if", "random", ".", "randint", "(", "2", ")", ":", "\n", "            ", "img", "=", "img", "[", "...", ",", "random", ".", "permutation", "(", "3", ")", "]", "\n", "\n", "", "return", "img", ",", "boxes", ",", "labels", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.extra_aug.Expand.__init__": [[69, 75], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "mean", "=", "(", "0", ",", "0", ",", "0", ")", ",", "to_rgb", "=", "True", ",", "ratio_range", "=", "(", "1", ",", "4", ")", ")", ":", "\n", "        ", "if", "to_rgb", ":", "\n", "            ", "self", ".", "mean", "=", "mean", "[", ":", ":", "-", "1", "]", "\n", "", "else", ":", "\n", "            ", "self", ".", "mean", "=", "mean", "\n", "", "self", ".", "min_ratio", ",", "self", ".", "max_ratio", "=", "ratio_range", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.extra_aug.Expand.__call__": [[76, 90], ["numpy.random.randint", "numpy.random.uniform", "numpy.full().astype", "int", "int", "numpy.tile", "numpy.random.uniform", "numpy.random.uniform", "numpy.full", "int", "int"], "methods", ["None"], ["", "def", "__call__", "(", "self", ",", "img", ",", "boxes", ",", "labels", ")", ":", "\n", "        ", "if", "random", ".", "randint", "(", "2", ")", ":", "\n", "            ", "return", "img", ",", "boxes", ",", "labels", "\n", "\n", "", "h", ",", "w", ",", "c", "=", "img", ".", "shape", "\n", "ratio", "=", "random", ".", "uniform", "(", "self", ".", "min_ratio", ",", "self", ".", "max_ratio", ")", "\n", "expand_img", "=", "np", ".", "full", "(", "(", "int", "(", "h", "*", "ratio", ")", ",", "int", "(", "w", "*", "ratio", ")", ",", "c", ")", ",", "\n", "self", ".", "mean", ")", ".", "astype", "(", "img", ".", "dtype", ")", "\n", "left", "=", "int", "(", "random", ".", "uniform", "(", "0", ",", "w", "*", "ratio", "-", "w", ")", ")", "\n", "top", "=", "int", "(", "random", ".", "uniform", "(", "0", ",", "h", "*", "ratio", "-", "h", ")", ")", "\n", "expand_img", "[", "top", ":", "top", "+", "h", ",", "left", ":", "left", "+", "w", "]", "=", "img", "\n", "img", "=", "expand_img", "\n", "boxes", "+=", "np", ".", "tile", "(", "(", "left", ",", "top", ")", ",", "2", ")", "\n", "return", "img", ",", "boxes", ",", "labels", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.extra_aug.RandomCrop.__init__": [[94, 98], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "min_ious", "=", "(", "0.1", ",", "0.3", ",", "0.5", ",", "0.7", ",", "0.9", ")", ",", "min_crop_size", "=", "0.3", ")", ":", "\n", "# 1: return ori img", "\n", "        ", "self", ".", "sample_mode", "=", "(", "1", ",", "*", "min_ious", ",", "0", ")", "\n", "self", ".", "min_crop_size", "=", "min_crop_size", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.extra_aug.RandomCrop.__call__": [[99, 142], ["numpy.random.choice", "range", "numpy.random.uniform", "numpy.random.uniform", "numpy.random.uniform", "numpy.random.uniform", "numpy.array", "mmdet.core.evaluation.bbox_overlaps.bbox_overlaps().reshape", "boxes[].clip", "boxes[].clip", "numpy.tile", "mmdet.core.evaluation.bbox_overlaps.bbox_overlaps().reshape.min", "mask.any", "int", "int", "int", "int", "mmdet.core.evaluation.bbox_overlaps.bbox_overlaps", "numpy.array.reshape", "boxes.reshape"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps"], ["", "def", "__call__", "(", "self", ",", "img", ",", "boxes", ",", "labels", ")", ":", "\n", "        ", "h", ",", "w", ",", "c", "=", "img", ".", "shape", "\n", "while", "True", ":", "\n", "            ", "mode", "=", "random", ".", "choice", "(", "self", ".", "sample_mode", ")", "\n", "if", "mode", "==", "1", ":", "\n", "                ", "return", "img", ",", "boxes", ",", "labels", "\n", "\n", "", "min_iou", "=", "mode", "\n", "for", "i", "in", "range", "(", "50", ")", ":", "\n", "                ", "new_w", "=", "random", ".", "uniform", "(", "self", ".", "min_crop_size", "*", "w", ",", "w", ")", "\n", "new_h", "=", "random", ".", "uniform", "(", "self", ".", "min_crop_size", "*", "h", ",", "h", ")", "\n", "\n", "# h / w in [0.5, 2]", "\n", "if", "new_h", "/", "new_w", "<", "0.5", "or", "new_h", "/", "new_w", ">", "2", ":", "\n", "                    ", "continue", "\n", "\n", "", "left", "=", "random", ".", "uniform", "(", "w", "-", "new_w", ")", "\n", "top", "=", "random", ".", "uniform", "(", "h", "-", "new_h", ")", "\n", "\n", "patch", "=", "np", ".", "array", "(", "(", "int", "(", "left", ")", ",", "int", "(", "top", ")", ",", "int", "(", "left", "+", "new_w", ")", ",", "\n", "int", "(", "top", "+", "new_h", ")", ")", ")", "\n", "overlaps", "=", "bbox_overlaps", "(", "\n", "patch", ".", "reshape", "(", "-", "1", ",", "4", ")", ",", "boxes", ".", "reshape", "(", "-", "1", ",", "4", ")", ")", ".", "reshape", "(", "-", "1", ")", "\n", "if", "overlaps", ".", "min", "(", ")", "<", "min_iou", ":", "\n", "                    ", "continue", "\n", "\n", "# center of boxes should inside the crop img", "\n", "", "center", "=", "(", "boxes", "[", ":", ",", ":", "2", "]", "+", "boxes", "[", ":", ",", "2", ":", "]", ")", "/", "2", "\n", "mask", "=", "(", "center", "[", ":", ",", "0", "]", ">", "patch", "[", "0", "]", ")", "*", "(", "\n", "center", "[", ":", ",", "1", "]", ">", "patch", "[", "1", "]", ")", "*", "(", "center", "[", ":", ",", "0", "]", "<", "patch", "[", "2", "]", ")", "*", "(", "\n", "center", "[", ":", ",", "1", "]", "<", "patch", "[", "3", "]", ")", "\n", "if", "not", "mask", ".", "any", "(", ")", ":", "\n", "                    ", "continue", "\n", "", "boxes", "=", "boxes", "[", "mask", "]", "\n", "labels", "=", "labels", "[", "mask", "]", "\n", "\n", "# adjust boxes", "\n", "img", "=", "img", "[", "patch", "[", "1", "]", ":", "patch", "[", "3", "]", ",", "patch", "[", "0", "]", ":", "patch", "[", "2", "]", "]", "\n", "boxes", "[", ":", ",", "2", ":", "]", "=", "boxes", "[", ":", ",", "2", ":", "]", ".", "clip", "(", "max", "=", "patch", "[", "2", ":", "]", ")", "\n", "boxes", "[", ":", ",", ":", "2", "]", "=", "boxes", "[", ":", ",", ":", "2", "]", ".", "clip", "(", "min", "=", "patch", "[", ":", "2", "]", ")", "\n", "boxes", "-=", "np", ".", "tile", "(", "patch", "[", ":", "2", "]", ",", "2", ")", "\n", "\n", "return", "img", ",", "boxes", ",", "labels", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.extra_aug.ExtraAugmentation.__init__": [[146, 158], ["extra_aug.ExtraAugmentation.transforms.append", "extra_aug.ExtraAugmentation.transforms.append", "extra_aug.ExtraAugmentation.transforms.append", "extra_aug.PhotoMetricDistortion", "extra_aug.Expand", "extra_aug.RandomCrop"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "\n", "photo_metric_distortion", "=", "None", ",", "\n", "expand", "=", "None", ",", "\n", "random_crop", "=", "None", ")", ":", "\n", "        ", "self", ".", "transforms", "=", "[", "]", "\n", "if", "photo_metric_distortion", "is", "not", "None", ":", "\n", "            ", "self", ".", "transforms", ".", "append", "(", "\n", "PhotoMetricDistortion", "(", "**", "photo_metric_distortion", ")", ")", "\n", "", "if", "expand", "is", "not", "None", ":", "\n", "            ", "self", ".", "transforms", ".", "append", "(", "Expand", "(", "**", "expand", ")", ")", "\n", "", "if", "random_crop", "is", "not", "None", ":", "\n", "            ", "self", ".", "transforms", ".", "append", "(", "RandomCrop", "(", "**", "random_crop", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.extra_aug.ExtraAugmentation.__call__": [[159, 164], ["img.astype.astype.astype", "transform"], "methods", ["None"], ["", "", "def", "__call__", "(", "self", ",", "img", ",", "boxes", ",", "labels", ")", ":", "\n", "        ", "img", "=", "img", ".", "astype", "(", "np", ".", "float32", ")", "\n", "for", "transform", "in", "self", ".", "transforms", ":", "\n", "            ", "img", ",", "boxes", ",", "labels", "=", "transform", "(", "img", ",", "boxes", ",", "labels", ")", "\n", "", "return", "img", ",", "boxes", ",", "labels", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.concat_dataset.ConcatDataset.__init__": [[15, 23], ["torch.utils.data.dataset.ConcatDataset.__init__", "hasattr", "range", "numpy.concatenate", "len", "flags.append"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["def", "__init__", "(", "self", ",", "datasets", ")", ":", "\n", "        ", "super", "(", "ConcatDataset", ",", "self", ")", ".", "__init__", "(", "datasets", ")", "\n", "self", ".", "CLASSES", "=", "datasets", "[", "0", "]", ".", "CLASSES", "\n", "if", "hasattr", "(", "datasets", "[", "0", "]", ",", "'flag'", ")", ":", "\n", "            ", "flags", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "0", ",", "len", "(", "datasets", ")", ")", ":", "\n", "                ", "flags", ".", "append", "(", "datasets", "[", "i", "]", ".", "flag", ")", "\n", "", "self", ".", "flag", "=", "np", ".", "concatenate", "(", "flags", ")", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.repeat_dataset.RepeatDataset.__init__": [[6, 14], ["hasattr", "len", "numpy.tile"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "dataset", ",", "times", ")", ":", "\n", "        ", "self", ".", "dataset", "=", "dataset", "\n", "self", ".", "times", "=", "times", "\n", "self", ".", "CLASSES", "=", "dataset", ".", "CLASSES", "\n", "if", "hasattr", "(", "self", ".", "dataset", ",", "'flag'", ")", ":", "\n", "            ", "self", ".", "flag", "=", "np", ".", "tile", "(", "self", ".", "dataset", ".", "flag", ",", "times", ")", "\n", "\n", "", "self", ".", "_ori_len", "=", "len", "(", "self", ".", "dataset", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.repeat_dataset.RepeatDataset.__getitem__": [[15, 17], ["None"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "idx", ")", ":", "\n", "        ", "return", "self", ".", "dataset", "[", "idx", "%", "self", ".", "_ori_len", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.repeat_dataset.RepeatDataset.__len__": [[18, 20], ["None"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "times", "*", "self", ".", "_ori_len", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.utils.to_tensor": [[15, 34], ["isinstance", "isinstance", "torch.from_numpy", "isinstance", "torch.tensor", "isinstance", "mmcv.is_str", "torch.LongTensor", "isinstance", "torch.FloatTensor", "TypeError", "type"], "function", ["None"], ["def", "to_tensor", "(", "data", ")", ":", "\n", "    ", "\"\"\"Convert objects of various python types to :obj:`torch.Tensor`.\n\n    Supported types are: :class:`numpy.ndarray`, :class:`torch.Tensor`,\n    :class:`Sequence`, :class:`int` and :class:`float`.\n    \"\"\"", "\n", "if", "isinstance", "(", "data", ",", "torch", ".", "Tensor", ")", ":", "\n", "        ", "return", "data", "\n", "", "elif", "isinstance", "(", "data", ",", "np", ".", "ndarray", ")", ":", "\n", "        ", "return", "torch", ".", "from_numpy", "(", "data", ")", "\n", "", "elif", "isinstance", "(", "data", ",", "Sequence", ")", "and", "not", "mmcv", ".", "is_str", "(", "data", ")", ":", "\n", "        ", "return", "torch", ".", "tensor", "(", "data", ")", "\n", "", "elif", "isinstance", "(", "data", ",", "int", ")", ":", "\n", "        ", "return", "torch", ".", "LongTensor", "(", "[", "data", "]", ")", "\n", "", "elif", "isinstance", "(", "data", ",", "float", ")", ":", "\n", "        ", "return", "torch", ".", "FloatTensor", "(", "[", "data", "]", ")", "\n", "", "else", ":", "\n", "        ", "raise", "TypeError", "(", "'type {} cannot be converted to tensor.'", ".", "format", "(", "\n", "type", "(", "data", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.utils.random_scale": [[36, 68], ["len", "numpy.random.randint", "numpy.random.randint", "ValueError", "max", "min", "min", "min", "numpy.random.randint", "max", "max", "numpy.random.randint"], "function", ["None"], ["", "", "def", "random_scale", "(", "img_scales", ",", "mode", "=", "'range'", ")", ":", "\n", "    ", "\"\"\"Randomly select a scale from a list of scales or scale ranges.\n\n    Args:\n        img_scales (list[tuple]): Image scale or scale range.\n        mode (str): \"range\" or \"value\".\n\n    Returns:\n        tuple: Sampled image scale.\n    \"\"\"", "\n", "num_scales", "=", "len", "(", "img_scales", ")", "\n", "if", "num_scales", "==", "1", ":", "# fixed scale is specified", "\n", "        ", "img_scale", "=", "img_scales", "[", "0", "]", "\n", "", "elif", "num_scales", "==", "2", ":", "# randomly sample a scale", "\n", "        ", "if", "mode", "==", "'range'", ":", "\n", "            ", "img_scale_long", "=", "[", "max", "(", "s", ")", "for", "s", "in", "img_scales", "]", "\n", "img_scale_short", "=", "[", "min", "(", "s", ")", "for", "s", "in", "img_scales", "]", "\n", "long_edge", "=", "np", ".", "random", ".", "randint", "(", "\n", "min", "(", "img_scale_long", ")", ",", "\n", "max", "(", "img_scale_long", ")", "+", "1", ")", "\n", "short_edge", "=", "np", ".", "random", ".", "randint", "(", "\n", "min", "(", "img_scale_short", ")", ",", "\n", "max", "(", "img_scale_short", ")", "+", "1", ")", "\n", "img_scale", "=", "(", "long_edge", ",", "short_edge", ")", "\n", "", "elif", "mode", "==", "'value'", ":", "\n", "            ", "img_scale", "=", "img_scales", "[", "np", ".", "random", ".", "randint", "(", "num_scales", ")", "]", "\n", "", "", "else", ":", "\n", "        ", "if", "mode", "!=", "'value'", ":", "\n", "            ", "raise", "ValueError", "(", "\n", "'Only \"value\" mode supports more than 2 image scales'", ")", "\n", "", "img_scale", "=", "img_scales", "[", "np", ".", "random", ".", "randint", "(", "num_scales", ")", "]", "\n", "", "return", "img_scale", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.utils.show_ann": [[70, 75], ["matplotlib.imshow", "matplotlib.axis", "coco.showAnns", "matplotlib.show", "mmcv.bgr2rgb"], "function", ["None"], ["", "def", "show_ann", "(", "coco", ",", "img", ",", "ann_info", ")", ":", "\n", "    ", "plt", ".", "imshow", "(", "mmcv", ".", "bgr2rgb", "(", "img", ")", ")", "\n", "plt", ".", "axis", "(", "'off'", ")", "\n", "coco", ".", "showAnns", "(", "ann_info", ")", "\n", "plt", ".", "show", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.utils.get_dataset": [[77, 123], ["isinstance", "isinstance", "range", "repeat_dataset.RepeatDataset", "len", "data_cfg.keys", "isinstance", "len", "len", "copy.deepcopy", "mmcv.runner.obj_from_dict", "dsets.append", "len", "concat_dataset.ConcatDataset", "utils.get_dataset"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.utils.get_dataset"], ["", "def", "get_dataset", "(", "data_cfg", ")", ":", "\n", "    ", "\"\"\"\n    return the dataset object such as CocoDataset, VOCDataset. this object has been\n    instantiated by the data_info in the following function obj_from_dict(data_info, datasets)\n    :param data_cfg:\n    :return:\n    \"\"\"", "\n", "if", "data_cfg", "[", "'type'", "]", "==", "'RepeatDataset'", ":", "\n", "        ", "return", "RepeatDataset", "(", "\n", "get_dataset", "(", "data_cfg", "[", "'dataset'", "]", ")", ",", "data_cfg", "[", "'times'", "]", ")", "\n", "\n", "", "if", "isinstance", "(", "data_cfg", "[", "'ann_file'", "]", ",", "(", "list", ",", "tuple", ")", ")", ":", "\n", "        ", "ann_files", "=", "data_cfg", "[", "'ann_file'", "]", "\n", "num_dset", "=", "len", "(", "ann_files", ")", "\n", "", "else", ":", "\n", "        ", "ann_files", "=", "[", "data_cfg", "[", "'ann_file'", "]", "]", "\n", "num_dset", "=", "1", "\n", "\n", "", "if", "'proposal_file'", "in", "data_cfg", ".", "keys", "(", ")", ":", "\n", "        ", "if", "isinstance", "(", "data_cfg", "[", "'proposal_file'", "]", ",", "(", "list", ",", "tuple", ")", ")", ":", "\n", "            ", "proposal_files", "=", "data_cfg", "[", "'proposal_file'", "]", "\n", "", "else", ":", "\n", "            ", "proposal_files", "=", "[", "data_cfg", "[", "'proposal_file'", "]", "]", "\n", "", "", "else", ":", "\n", "        ", "proposal_files", "=", "[", "None", "]", "*", "num_dset", "\n", "", "assert", "len", "(", "proposal_files", ")", "==", "num_dset", "\n", "\n", "if", "isinstance", "(", "data_cfg", "[", "'img_prefix'", "]", ",", "(", "list", ",", "tuple", ")", ")", ":", "\n", "        ", "img_prefixes", "=", "data_cfg", "[", "'img_prefix'", "]", "\n", "", "else", ":", "\n", "        ", "img_prefixes", "=", "[", "data_cfg", "[", "'img_prefix'", "]", "]", "*", "num_dset", "\n", "", "assert", "len", "(", "img_prefixes", ")", "==", "num_dset", "\n", "\n", "dsets", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "num_dset", ")", ":", "\n", "        ", "data_info", "=", "copy", ".", "deepcopy", "(", "data_cfg", ")", "\n", "data_info", "[", "'ann_file'", "]", "=", "ann_files", "[", "i", "]", "\n", "data_info", "[", "'proposal_file'", "]", "=", "proposal_files", "[", "i", "]", "\n", "data_info", "[", "'img_prefix'", "]", "=", "img_prefixes", "[", "i", "]", "\n", "dset", "=", "obj_from_dict", "(", "data_info", ",", "datasets", ")", "\n", "dsets", ".", "append", "(", "dset", ")", "\n", "", "if", "len", "(", "dsets", ")", ">", "1", ":", "\n", "        ", "dset", "=", "ConcatDataset", "(", "dsets", ")", "\n", "", "else", ":", "\n", "        ", "dset", "=", "dsets", "[", "0", "]", "\n", "", "return", "dset", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.augmentation_dataset.AugmentationDataset.load_annotations": [[11, 25], ["pycocotools.coco.COCO", "augmentation_dataset.AugmentationDataset.coco.getCatIds", "augmentation_dataset.AugmentationDataset.coco.getImgIds", "img_infos.append", "enumerate", "augmentation_dataset.AugmentationDataset.coco.loadImgs"], "methods", ["None"], ["def", "load_annotations", "(", "self", ",", "ann_file", ")", ":", "\n", "        ", "self", ".", "coco", "=", "COCO", "(", "ann_file", ")", "\n", "self", ".", "cat_ids", "=", "self", ".", "coco", ".", "getCatIds", "(", ")", "\n", "self", ".", "cat2label", "=", "{", "\n", "cat_id", ":", "i", "+", "1", "\n", "for", "i", ",", "cat_id", "in", "enumerate", "(", "self", ".", "cat_ids", ")", "\n", "}", "\n", "self", ".", "img_ids", "=", "self", ".", "coco", ".", "getImgIds", "(", ")", "\n", "img_infos", "=", "[", "]", "\n", "for", "i", "in", "self", ".", "img_ids", ":", "\n", "            ", "info", "=", "self", ".", "coco", ".", "loadImgs", "(", "[", "i", "]", ")", "[", "0", "]", "\n", "info", "[", "'filename'", "]", "=", "info", "[", "'file_name'", "]", "\n", "img_infos", ".", "append", "(", "info", ")", "\n", "", "return", "img_infos", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.augmentation_dataset.AugmentationDataset.get_ann_info": [[26, 31], ["augmentation_dataset.AugmentationDataset.coco.getAnnIds", "augmentation_dataset.AugmentationDataset.coco.loadAnns", "augmentation_dataset.AugmentationDataset._parse_ann_info"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.augmentation_dataset.AugmentationDataset._parse_ann_info"], ["", "def", "get_ann_info", "(", "self", ",", "idx", ")", ":", "\n", "        ", "img_id", "=", "self", ".", "img_infos", "[", "idx", "]", "[", "'id'", "]", "\n", "ann_ids", "=", "self", ".", "coco", ".", "getAnnIds", "(", "imgIds", "=", "[", "img_id", "]", ")", "\n", "ann_info", "=", "self", ".", "coco", ".", "loadAnns", "(", "ann_ids", ")", "\n", "return", "self", ".", "_parse_ann_info", "(", "ann_info", ",", "self", ".", "with_mask", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.augmentation_dataset.AugmentationDataset._filter_imgs": [[32, 42], ["set", "enumerate", "min", "valid_inds.append", "augmentation_dataset.AugmentationDataset.coco.anns.values"], "methods", ["None"], ["", "def", "_filter_imgs", "(", "self", ",", "min_size", "=", "32", ")", ":", "\n", "        ", "\"\"\"Filter images too small or without ground truths.\"\"\"", "\n", "valid_inds", "=", "[", "]", "\n", "ids_with_ann", "=", "set", "(", "_", "[", "'image_id'", "]", "for", "_", "in", "self", ".", "coco", ".", "anns", ".", "values", "(", ")", ")", "\n", "for", "i", ",", "img_info", "in", "enumerate", "(", "self", ".", "img_infos", ")", ":", "\n", "            ", "if", "self", ".", "img_ids", "[", "i", "]", "not", "in", "ids_with_ann", ":", "\n", "                ", "continue", "\n", "", "if", "min", "(", "img_info", "[", "'width'", "]", ",", "img_info", "[", "'height'", "]", ")", ">=", "min_size", ":", "\n", "                ", "valid_inds", ".", "append", "(", "i", ")", "\n", "", "", "return", "valid_inds", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.augmentation_dataset.AugmentationDataset._parse_ann_info": [[43, 106], ["enumerate", "dict", "dict.get", "numpy.array", "numpy.array", "numpy.zeros", "numpy.array", "numpy.array", "numpy.zeros", "numpy.zeros.append", "numpy.zeros.append", "numpy.array.append", "gt_masks.append", "gt_mask_polys.append", "gt_poly_lens.extend", "augmentation_dataset.AugmentationDataset.coco.annToMask", "len", "len"], "methods", ["None"], ["", "def", "_parse_ann_info", "(", "self", ",", "ann_info", ",", "with_mask", "=", "True", ")", ":", "\n", "        ", "\"\"\"Parse bbox and mask annotation.\n\n        Args:\n            ann_info (list[dict]): Annotation info of an image.\n            with_mask (bool): Whether to parse mask annotations.\n\n        Returns:\n            dict: A dict containing the following keys: bboxes, bboxes_ignore,\n                labels, masks, mask_polys, poly_lens.\n        \"\"\"", "\n", "gt_bboxes", "=", "[", "]", "\n", "gt_labels", "=", "[", "]", "\n", "gt_bboxes_ignore", "=", "[", "]", "\n", "# Two formats are provided.", "\n", "# 1. mask: a binary map of the same size of the image.", "\n", "# 2. polys: each mask consists of one or several polys, each poly is a", "\n", "# list of float.", "\n", "if", "with_mask", ":", "\n", "            ", "gt_masks", "=", "[", "]", "\n", "gt_mask_polys", "=", "[", "]", "\n", "gt_poly_lens", "=", "[", "]", "\n", "", "for", "i", ",", "ann", "in", "enumerate", "(", "ann_info", ")", ":", "\n", "            ", "if", "ann", ".", "get", "(", "'ignore'", ",", "False", ")", ":", "\n", "                ", "continue", "\n", "", "x1", ",", "y1", ",", "w", ",", "h", "=", "ann", "[", "'bbox'", "]", "\n", "if", "ann", "[", "'area'", "]", "<=", "0", "or", "w", "<", "1", "or", "h", "<", "1", ":", "\n", "                ", "continue", "\n", "", "bbox", "=", "[", "x1", ",", "y1", ",", "x1", "+", "w", "-", "1", ",", "y1", "+", "h", "-", "1", "]", "\n", "if", "ann", "[", "'iscrowd'", "]", ":", "\n", "                ", "gt_bboxes_ignore", ".", "append", "(", "bbox", ")", "\n", "", "else", ":", "\n", "                ", "gt_bboxes", ".", "append", "(", "bbox", ")", "\n", "gt_labels", ".", "append", "(", "self", ".", "cat2label", "[", "ann", "[", "'category_id'", "]", "]", ")", "\n", "", "if", "with_mask", ":", "\n", "                ", "gt_masks", ".", "append", "(", "self", ".", "coco", ".", "annToMask", "(", "ann", ")", ")", "\n", "mask_polys", "=", "[", "\n", "p", "for", "p", "in", "ann", "[", "'segmentation'", "]", "if", "len", "(", "p", ")", ">=", "6", "\n", "]", "# valid polygons have >= 3 points (6 coordinates)", "\n", "poly_lens", "=", "[", "len", "(", "p", ")", "for", "p", "in", "mask_polys", "]", "\n", "gt_mask_polys", ".", "append", "(", "mask_polys", ")", "\n", "gt_poly_lens", ".", "extend", "(", "poly_lens", ")", "\n", "", "", "if", "gt_bboxes", ":", "\n", "            ", "gt_bboxes", "=", "np", ".", "array", "(", "gt_bboxes", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "gt_labels", "=", "np", ".", "array", "(", "gt_labels", ",", "dtype", "=", "np", ".", "int64", ")", "\n", "", "else", ":", "\n", "            ", "gt_bboxes", "=", "np", ".", "zeros", "(", "(", "0", ",", "4", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "gt_labels", "=", "np", ".", "array", "(", "[", "]", ",", "dtype", "=", "np", ".", "int64", ")", "\n", "\n", "", "if", "gt_bboxes_ignore", ":", "\n", "            ", "gt_bboxes_ignore", "=", "np", ".", "array", "(", "gt_bboxes_ignore", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "", "else", ":", "\n", "            ", "gt_bboxes_ignore", "=", "np", ".", "zeros", "(", "(", "0", ",", "4", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "\n", "", "ann", "=", "dict", "(", "\n", "bboxes", "=", "gt_bboxes", ",", "labels", "=", "gt_labels", ",", "bboxes_ignore", "=", "gt_bboxes_ignore", ")", "\n", "\n", "if", "with_mask", ":", "\n", "            ", "ann", "[", "'masks'", "]", "=", "gt_masks", "\n", "# poly format is not used in the current implementation", "\n", "ann", "[", "'mask_polys'", "]", "=", "gt_mask_polys", "\n", "ann", "[", "'poly_lens'", "]", "=", "gt_poly_lens", "\n", "", "return", "ann", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.voc.VOCDataset.__init__": [[11, 19], ["xml_style.XMLDataset.__init__", "ValueError"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["def", "__init__", "(", "self", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "VOCDataset", ",", "self", ")", ".", "__init__", "(", "**", "kwargs", ")", "\n", "if", "'VOC2007'", "in", "self", ".", "img_prefix", ":", "\n", "            ", "self", ".", "year", "=", "2007", "\n", "", "elif", "'VOC2012'", "in", "self", ".", "img_prefix", ":", "\n", "            ", "self", ".", "year", "=", "2012", "\n", "", "else", ":", "\n", "            ", "raise", "ValueError", "(", "'Cannot infer dataset year from img_prefix'", ")", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loader.sampler.DistributedSampler.__init__": [[14, 17], ["torch.utils.data.DistributedSampler.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "dataset", ",", "num_replicas", "=", "None", ",", "rank", "=", "None", ",", "shuffle", "=", "True", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "dataset", ",", "num_replicas", "=", "num_replicas", ",", "rank", "=", "rank", ")", "\n", "self", ".", "shuffle", "=", "shuffle", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loader.sampler.DistributedSampler.__iter__": [[18, 36], ["iter", "torch.Generator", "torch.Generator.manual_seed", "torch.randperm().tolist", "torch.arange().tolist", "len", "len", "torch.randperm", "torch.arange", "len", "len", "len"], "methods", ["None"], ["", "def", "__iter__", "(", "self", ")", ":", "\n", "# deterministically shuffle based on epoch", "\n", "        ", "if", "self", ".", "shuffle", ":", "\n", "            ", "g", "=", "torch", ".", "Generator", "(", ")", "\n", "g", ".", "manual_seed", "(", "self", ".", "epoch", ")", "\n", "indices", "=", "torch", ".", "randperm", "(", "len", "(", "self", ".", "dataset", ")", ",", "generator", "=", "g", ")", ".", "tolist", "(", ")", "\n", "", "else", ":", "\n", "            ", "indices", "=", "torch", ".", "arange", "(", "len", "(", "self", ".", "dataset", ")", ")", ".", "tolist", "(", ")", "\n", "\n", "# add extra samples to make it evenly divisible", "\n", "", "indices", "+=", "indices", "[", ":", "(", "self", ".", "total_size", "-", "len", "(", "indices", ")", ")", "]", "\n", "assert", "len", "(", "indices", ")", "==", "self", ".", "total_size", "\n", "\n", "# subsample", "\n", "indices", "=", "indices", "[", "self", ".", "rank", ":", "self", ".", "total_size", ":", "self", ".", "num_replicas", "]", "\n", "assert", "len", "(", "indices", ")", "==", "self", ".", "num_samples", "\n", "\n", "return", "iter", "(", "indices", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loader.sampler.GroupSampler.__init__": [[40, 50], ["hasattr", "dataset.flag.astype", "numpy.bincount", "enumerate", "int", "numpy.ceil"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "dataset", ",", "samples_per_gpu", "=", "1", ")", ":", "\n", "        ", "assert", "hasattr", "(", "dataset", ",", "'flag'", ")", "\n", "self", ".", "dataset", "=", "dataset", "\n", "self", ".", "samples_per_gpu", "=", "samples_per_gpu", "\n", "self", ".", "flag", "=", "dataset", ".", "flag", ".", "astype", "(", "np", ".", "int64", ")", "\n", "self", ".", "group_sizes", "=", "np", ".", "bincount", "(", "self", ".", "flag", ")", "\n", "self", ".", "num_samples", "=", "0", "\n", "for", "i", ",", "size", "in", "enumerate", "(", "self", ".", "group_sizes", ")", ":", "\n", "            ", "self", ".", "num_samples", "+=", "int", "(", "np", ".", "ceil", "(", "\n", "size", "/", "self", ".", "samples_per_gpu", ")", ")", "*", "self", ".", "samples_per_gpu", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loader.sampler.GroupSampler.__iter__": [[51, 73], ["enumerate", "numpy.concatenate", "numpy.concatenate", "torch.from_numpy().long", "iter", "numpy.random.shuffle", "numpy.concatenate", "torch.from_numpy().long.append", "len", "numpy.where", "len", "len", "numpy.random.permutation", "torch.from_numpy", "int", "range", "numpy.ceil", "len"], "methods", ["None"], ["", "", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "indices", "=", "[", "]", "\n", "for", "i", ",", "size", "in", "enumerate", "(", "self", ".", "group_sizes", ")", ":", "\n", "            ", "if", "size", "==", "0", ":", "\n", "                ", "continue", "\n", "", "indice", "=", "np", ".", "where", "(", "self", ".", "flag", "==", "i", ")", "[", "0", "]", "\n", "assert", "len", "(", "indice", ")", "==", "size", "\n", "np", ".", "random", ".", "shuffle", "(", "indice", ")", "\n", "num_extra", "=", "int", "(", "np", ".", "ceil", "(", "size", "/", "self", ".", "samples_per_gpu", ")", "\n", ")", "*", "self", ".", "samples_per_gpu", "-", "len", "(", "indice", ")", "\n", "indice", "=", "np", ".", "concatenate", "(", "[", "indice", ",", "indice", "[", ":", "num_extra", "]", "]", ")", "\n", "indices", ".", "append", "(", "indice", ")", "\n", "", "indices", "=", "np", ".", "concatenate", "(", "indices", ")", "\n", "indices", "=", "[", "\n", "indices", "[", "i", "*", "self", ".", "samples_per_gpu", ":", "(", "i", "+", "1", ")", "*", "self", ".", "samples_per_gpu", "]", "\n", "for", "i", "in", "np", ".", "random", ".", "permutation", "(", "\n", "range", "(", "len", "(", "indices", ")", "//", "self", ".", "samples_per_gpu", ")", ")", "\n", "]", "\n", "indices", "=", "np", ".", "concatenate", "(", "indices", ")", "\n", "indices", "=", "torch", ".", "from_numpy", "(", "indices", ")", ".", "long", "(", ")", "\n", "assert", "len", "(", "indices", ")", "==", "self", ".", "num_samples", "\n", "return", "iter", "(", "indices", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loader.sampler.GroupSampler.__len__": [[74, 76], ["None"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "num_samples", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loader.sampler.DistributedGroupSampler.__init__": [[93, 118], ["hasattr", "numpy.bincount", "enumerate", "torch.distributed.get_world_size", "torch.distributed.get_rank", "int", "math.ceil"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "\n", "dataset", ",", "\n", "samples_per_gpu", "=", "1", ",", "\n", "num_replicas", "=", "None", ",", "\n", "rank", "=", "None", ")", ":", "\n", "        ", "if", "num_replicas", "is", "None", ":", "\n", "            ", "num_replicas", "=", "get_world_size", "(", ")", "\n", "", "if", "rank", "is", "None", ":", "\n", "            ", "rank", "=", "get_rank", "(", ")", "\n", "", "self", ".", "dataset", "=", "dataset", "\n", "self", ".", "samples_per_gpu", "=", "samples_per_gpu", "\n", "self", ".", "num_replicas", "=", "num_replicas", "\n", "self", ".", "rank", "=", "rank", "\n", "self", ".", "epoch", "=", "0", "\n", "\n", "assert", "hasattr", "(", "self", ".", "dataset", ",", "'flag'", ")", "\n", "self", ".", "flag", "=", "self", ".", "dataset", ".", "flag", "\n", "self", ".", "group_sizes", "=", "np", ".", "bincount", "(", "self", ".", "flag", ")", "\n", "\n", "self", ".", "num_samples", "=", "0", "\n", "for", "i", ",", "j", "in", "enumerate", "(", "self", ".", "group_sizes", ")", ":", "\n", "            ", "self", ".", "num_samples", "+=", "int", "(", "\n", "math", ".", "ceil", "(", "self", ".", "group_sizes", "[", "i", "]", "*", "1.0", "/", "self", ".", "samples_per_gpu", "/", "\n", "self", ".", "num_replicas", ")", ")", "*", "self", ".", "samples_per_gpu", "\n", "", "self", ".", "total_size", "=", "self", ".", "num_samples", "*", "self", ".", "num_replicas", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loader.sampler.DistributedGroupSampler.__iter__": [[119, 154], ["torch.Generator", "torch.Generator.manual_seed", "enumerate", "iter", "len", "len", "indice[].tolist", "list", "range", "numpy.where", "len", "len", "torch.randperm", "int", "len", "list", "math.ceil", "torch.randperm", "int"], "methods", ["None"], ["", "def", "__iter__", "(", "self", ")", ":", "\n", "# deterministically shuffle based on epoch", "\n", "        ", "g", "=", "torch", ".", "Generator", "(", ")", "\n", "g", ".", "manual_seed", "(", "self", ".", "epoch", ")", "\n", "\n", "indices", "=", "[", "]", "\n", "for", "i", ",", "size", "in", "enumerate", "(", "self", ".", "group_sizes", ")", ":", "\n", "            ", "if", "size", ">", "0", ":", "\n", "                ", "indice", "=", "np", ".", "where", "(", "self", ".", "flag", "==", "i", ")", "[", "0", "]", "\n", "assert", "len", "(", "indice", ")", "==", "size", "\n", "indice", "=", "indice", "[", "list", "(", "torch", ".", "randperm", "(", "int", "(", "size", ")", ",", "\n", "generator", "=", "g", ")", ")", "]", ".", "tolist", "(", ")", "\n", "extra", "=", "int", "(", "\n", "math", ".", "ceil", "(", "\n", "size", "*", "1.0", "/", "self", ".", "samples_per_gpu", "/", "self", ".", "num_replicas", ")", "\n", ")", "*", "self", ".", "samples_per_gpu", "*", "self", ".", "num_replicas", "-", "len", "(", "indice", ")", "\n", "indice", "+=", "indice", "[", ":", "extra", "]", "\n", "indices", "+=", "indice", "\n", "\n", "", "", "assert", "len", "(", "indices", ")", "==", "self", ".", "total_size", "\n", "\n", "indices", "=", "[", "\n", "indices", "[", "j", "]", "for", "i", "in", "list", "(", "\n", "torch", ".", "randperm", "(", "\n", "len", "(", "indices", ")", "//", "self", ".", "samples_per_gpu", ",", "generator", "=", "g", ")", ")", "\n", "for", "j", "in", "range", "(", "i", "*", "self", ".", "samples_per_gpu", ",", "(", "i", "+", "1", ")", "*", "\n", "self", ".", "samples_per_gpu", ")", "\n", "]", "\n", "\n", "# subsample", "\n", "offset", "=", "self", ".", "num_samples", "*", "self", ".", "rank", "\n", "indices", "=", "indices", "[", "offset", ":", "offset", "+", "self", ".", "num_samples", "]", "\n", "assert", "len", "(", "indices", ")", "==", "self", ".", "num_samples", "\n", "\n", "return", "iter", "(", "indices", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loader.sampler.DistributedGroupSampler.__len__": [[155, 157], ["None"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "num_samples", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loader.sampler.DistributedGroupSampler.set_epoch": [[158, 160], ["None"], "methods", ["None"], ["", "def", "set_epoch", "(", "self", ",", "epoch", ")", ":", "\n", "        ", "self", ".", "epoch", "=", "epoch", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loader.build_loader.build_dataloader": [[15, 48], ["kwargs.get", "torch.utils.data.DataLoader", "mmcv.runner.get_dist_info", "sampler.DistributedGroupSampler", "sampler.DistributedSampler", "sampler.GroupSampler", "functools.partial"], "function", ["None"], ["def", "build_dataloader", "(", "dataset", ",", "\n", "imgs_per_gpu", ",", "\n", "workers_per_gpu", ",", "\n", "num_gpus", "=", "1", ",", "\n", "dist", "=", "True", ",", "\n", "**", "kwargs", ")", ":", "\n", "    ", "shuffle", "=", "kwargs", ".", "get", "(", "'shuffle'", ",", "True", ")", "\n", "if", "dist", ":", "\n", "        ", "rank", ",", "world_size", "=", "get_dist_info", "(", ")", "\n", "if", "shuffle", ":", "\n", "            ", "sampler", "=", "DistributedGroupSampler", "(", "dataset", ",", "imgs_per_gpu", ",", "\n", "world_size", ",", "rank", ")", "\n", "", "else", ":", "\n", "            ", "sampler", "=", "DistributedSampler", "(", "\n", "dataset", ",", "world_size", ",", "rank", ",", "shuffle", "=", "False", ")", "\n", "", "batch_size", "=", "imgs_per_gpu", "\n", "num_workers", "=", "workers_per_gpu", "\n", "", "else", ":", "\n", "        ", "sampler", "=", "GroupSampler", "(", "dataset", ",", "imgs_per_gpu", ")", "if", "shuffle", "else", "None", "\n", "batch_size", "=", "num_gpus", "*", "imgs_per_gpu", "\n", "num_workers", "=", "num_gpus", "*", "workers_per_gpu", "\n", "\n", "", "data_loader", "=", "DataLoader", "(", "\n", "dataset", ",", "\n", "batch_size", "=", "batch_size", ",", "\n", "sampler", "=", "sampler", ",", "\n", "num_workers", "=", "num_workers", ",", "\n", "collate_fn", "=", "partial", "(", "collate", ",", "samples_per_gpu", "=", "imgs_per_gpu", ")", ",", "\n", "pin_memory", "=", "False", ",", "\n", "# pin_memory=True,", "\n", "**", "kwargs", ")", "\n", "\n", "return", "data_loader", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.inference.init_detector": [[15, 46], ["isinstance", "mmdet.models.build_detector", "mmdet.models.build_detector.to", "mmdet.models.build_detector.eval", "mmcv.Config.fromfile", "mmcv.runner.load_checkpoint", "isinstance", "TypeError", "warnings.warn", "mmdet.core.get_classes", "type"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_detector", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.class_names.get_classes"], ["def", "init_detector", "(", "config", ",", "checkpoint", "=", "None", ",", "device", "=", "'cuda:0'", ")", ":", "\n", "    ", "\"\"\"Initialize a detector from config file.\n\n    Args:\n        config (str or :obj:`mmcv.Config`): Config file path or the config\n            object.\n        checkpoint (str, optional): Checkpoint path. If left as None, the model\n            will not load any weights.\n\n    Returns:\n        nn.Module: The constructed detector.\n    \"\"\"", "\n", "if", "isinstance", "(", "config", ",", "str", ")", ":", "\n", "        ", "config", "=", "mmcv", ".", "Config", ".", "fromfile", "(", "config", ")", "\n", "", "elif", "not", "isinstance", "(", "config", ",", "mmcv", ".", "Config", ")", ":", "\n", "        ", "raise", "TypeError", "(", "'config must be a filename or Config object, '", "\n", "'but got {}'", ".", "format", "(", "type", "(", "config", ")", ")", ")", "\n", "", "config", ".", "model", ".", "pretrained", "=", "None", "\n", "model", "=", "build_detector", "(", "config", ".", "model", ",", "test_cfg", "=", "config", ".", "test_cfg", ")", "\n", "if", "checkpoint", "is", "not", "None", ":", "\n", "        ", "checkpoint", "=", "load_checkpoint", "(", "model", ",", "checkpoint", ")", "\n", "if", "'CLASSES'", "in", "checkpoint", "[", "'meta'", "]", ":", "\n", "            ", "model", ".", "CLASSES", "=", "checkpoint", "[", "'meta'", "]", "[", "'CLASSES'", "]", "\n", "", "else", ":", "\n", "            ", "warnings", ".", "warn", "(", "'Class names are not saved in the checkpoint\\'s '", "\n", "'meta data, use COCO classes by default.'", ")", "\n", "model", ".", "CLASSES", "=", "get_classes", "(", "'coco'", ")", "\n", "", "", "model", ".", "cfg", "=", "config", "# save the config in the model for convenience", "\n", "model", ".", "to", "(", "device", ")", "\n", "model", ".", "eval", "(", ")", "\n", "return", "model", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.inference.inference_detector": [[48, 69], ["mmdet.datasets.transforms.ImageTransform", "next", "isinstance", "inference._inference_single", "inference._inference_generator", "model.parameters"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.inference._inference_single", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.inference._inference_generator"], ["", "def", "inference_detector", "(", "model", ",", "imgs", ")", ":", "\n", "    ", "\"\"\"Inference image(s) with the detector.\n\n    Args:\n        model (nn.Module): The loaded detector.\n        imgs (str/ndarray or list[str/ndarray]): Either image files or loaded\n            images.\n\n    Returns:\n        If imgs is a str, a generator will be returned, otherwise return the\n        detection results directly.\n    \"\"\"", "\n", "cfg", "=", "model", ".", "cfg", "\n", "img_transform", "=", "ImageTransform", "(", "\n", "size_divisor", "=", "cfg", ".", "data", ".", "test", ".", "size_divisor", ",", "**", "cfg", ".", "img_norm_cfg", ")", "\n", "\n", "device", "=", "next", "(", "model", ".", "parameters", "(", ")", ")", ".", "device", "# model device", "\n", "if", "not", "isinstance", "(", "imgs", ",", "list", ")", ":", "\n", "        ", "return", "_inference_single", "(", "model", ",", "imgs", ",", "img_transform", ",", "device", ")", "\n", "", "else", ":", "\n", "        ", "return", "_inference_generator", "(", "model", ",", "imgs", ",", "img_transform", ",", "device", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.inference._prepare_data": [[71, 87], ["img_transform", "mmdet.datasets.to_tensor().to().unsqueeze", "dict", "dict", "cfg.data.test.get", "mmdet.datasets.to_tensor().to", "mmdet.datasets.to_tensor"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.utils.to_tensor"], ["", "", "def", "_prepare_data", "(", "img", ",", "img_transform", ",", "cfg", ",", "device", ")", ":", "\n", "    ", "ori_shape", "=", "img", ".", "shape", "\n", "img", ",", "img_shape", ",", "pad_shape", ",", "scale_factor", "=", "img_transform", "(", "\n", "img", ",", "\n", "scale", "=", "cfg", ".", "data", ".", "test", ".", "img_scale", ",", "\n", "keep_ratio", "=", "cfg", ".", "data", ".", "test", ".", "get", "(", "'resize_keep_ratio'", ",", "True", ")", ")", "\n", "img", "=", "to_tensor", "(", "img", ")", ".", "to", "(", "device", ")", ".", "unsqueeze", "(", "0", ")", "\n", "img_meta", "=", "[", "\n", "dict", "(", "\n", "ori_shape", "=", "ori_shape", ",", "\n", "img_shape", "=", "img_shape", ",", "\n", "pad_shape", "=", "pad_shape", ",", "\n", "scale_factor", "=", "scale_factor", ",", "\n", "flip", "=", "False", ")", "\n", "]", "\n", "return", "dict", "(", "img", "=", "[", "img", "]", ",", "img_meta", "=", "[", "img_meta", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.inference._inference_single": [[89, 95], ["mmcv.imread", "inference._prepare_data", "torch.no_grad", "model"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.inference._prepare_data"], ["", "def", "_inference_single", "(", "model", ",", "img", ",", "img_transform", ",", "device", ")", ":", "\n", "    ", "img", "=", "mmcv", ".", "imread", "(", "img", ")", "\n", "data", "=", "_prepare_data", "(", "img", ",", "img_transform", ",", "model", ".", "cfg", ",", "device", ")", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "        ", "result", "=", "model", "(", "return_loss", "=", "False", ",", "rescale", "=", "True", ",", "**", "data", ")", "\n", "", "return", "result", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.inference._inference_generator": [[97, 100], ["inference._inference_single"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.inference._inference_single"], ["", "def", "_inference_generator", "(", "model", ",", "imgs", ",", "img_transform", ",", "device", ")", ":", "\n", "    ", "for", "img", "in", "imgs", ":", "\n", "        ", "yield", "_inference_single", "(", "model", ",", "img", ",", "img_transform", ",", "device", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.inference.show_result": [[103, 144], ["isinstance", "mmcv.imread", "isinstance", "numpy.vstack", "numpy.concatenate", "mmcv.imshow_det_bboxes", "mmcv.concat_list", "numpy.full", "mmcv.imread.copy", "numpy.where", "numpy.random.randint", "pycocotools.decode().astype", "enumerate", "pycocotools.decode"], "function", ["None"], ["", "", "def", "show_result", "(", "img", ",", "result", ",", "class_names", ",", "score_thr", "=", "0.3", ",", "out_file", "=", "None", ")", ":", "\n", "    ", "\"\"\"Visualize the detection results on the image.\n\n    Args:\n        img (str or np.ndarray): Image filename or loaded image.\n        result (tuple[list] or list): The detection result, can be either\n            (bbox, segm) or just bbox.\n        class_names (list[str] or tuple[str]): A list of class names.\n        score_thr (float): The threshold to visualize the bboxes and masks.\n        out_file (str, optional): If specified, the visualization result will\n            be written to the out file instead of shown in a window.\n    \"\"\"", "\n", "assert", "isinstance", "(", "class_names", ",", "(", "tuple", ",", "list", ")", ")", "\n", "img", "=", "mmcv", ".", "imread", "(", "img", ")", "\n", "if", "isinstance", "(", "result", ",", "tuple", ")", ":", "\n", "        ", "bbox_result", ",", "segm_result", "=", "result", "\n", "", "else", ":", "\n", "        ", "bbox_result", ",", "segm_result", "=", "result", ",", "None", "\n", "", "bboxes", "=", "np", ".", "vstack", "(", "bbox_result", ")", "\n", "# draw segmentation masks", "\n", "if", "segm_result", "is", "not", "None", ":", "\n", "        ", "segms", "=", "mmcv", ".", "concat_list", "(", "segm_result", ")", "\n", "inds", "=", "np", ".", "where", "(", "bboxes", "[", ":", ",", "-", "1", "]", ">", "score_thr", ")", "[", "0", "]", "\n", "for", "i", "in", "inds", ":", "\n", "            ", "color_mask", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "256", ",", "(", "1", ",", "3", ")", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "mask", "=", "maskUtils", ".", "decode", "(", "segms", "[", "i", "]", ")", ".", "astype", "(", "np", ".", "bool", ")", "\n", "img", "[", "mask", "]", "=", "img", "[", "mask", "]", "*", "0.5", "+", "color_mask", "*", "0.5", "\n", "# draw bounding boxes", "\n", "", "", "labels", "=", "[", "\n", "np", ".", "full", "(", "bbox", ".", "shape", "[", "0", "]", ",", "i", ",", "dtype", "=", "np", ".", "int32", ")", "\n", "for", "i", ",", "bbox", "in", "enumerate", "(", "bbox_result", ")", "\n", "]", "\n", "labels", "=", "np", ".", "concatenate", "(", "labels", ")", "\n", "mmcv", ".", "imshow_det_bboxes", "(", "\n", "img", ".", "copy", "(", ")", ",", "\n", "bboxes", ",", "\n", "labels", ",", "\n", "class_names", "=", "class_names", ",", "\n", "score_thr", "=", "score_thr", ",", "\n", "show", "=", "out_file", "is", "None", ",", "\n", "out_file", "=", "out_file", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.train.parse_losses": [[18, 36], ["collections.OrderedDict", "losses.items", "sum", "isinstance", "log_vars[].item", "loss_value.mean", "isinstance", "sum", "TypeError", "collections.OrderedDict.items", "_loss.mean"], "function", ["None"], ["def", "parse_losses", "(", "losses", ")", ":", "\n", "    ", "log_vars", "=", "OrderedDict", "(", ")", "\n", "for", "loss_name", ",", "loss_value", "in", "losses", ".", "items", "(", ")", ":", "\n", "        ", "if", "isinstance", "(", "loss_value", ",", "torch", ".", "Tensor", ")", ":", "\n", "            ", "log_vars", "[", "loss_name", "]", "=", "loss_value", ".", "mean", "(", ")", "\n", "", "elif", "isinstance", "(", "loss_value", ",", "list", ")", ":", "\n", "            ", "log_vars", "[", "loss_name", "]", "=", "sum", "(", "_loss", ".", "mean", "(", ")", "for", "_loss", "in", "loss_value", ")", "\n", "", "else", ":", "\n", "            ", "raise", "TypeError", "(", "\n", "'{} is not a tensor or list of tensors'", ".", "format", "(", "loss_name", ")", ")", "\n", "\n", "", "", "loss", "=", "sum", "(", "_value", "for", "_key", ",", "_value", "in", "log_vars", ".", "items", "(", ")", "if", "'loss'", "in", "_key", ")", "\n", "\n", "log_vars", "[", "'loss'", "]", "=", "loss", "\n", "for", "name", "in", "log_vars", ":", "\n", "        ", "log_vars", "[", "name", "]", "=", "log_vars", "[", "name", "]", ".", "item", "(", ")", "\n", "\n", "", "return", "loss", ",", "log_vars", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.train.batch_processor": [[38, 46], ["model", "train.parse_losses", "dict", "len"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.train.parse_losses"], ["", "def", "batch_processor", "(", "model", ",", "data", ",", "train_mode", ")", ":", "\n", "    ", "losses", "=", "model", "(", "**", "data", ")", "\n", "loss", ",", "log_vars", "=", "parse_losses", "(", "losses", ")", "\n", "\n", "outputs", "=", "dict", "(", "\n", "loss", "=", "loss", ",", "log_vars", "=", "log_vars", ",", "num_samples", "=", "len", "(", "data", "[", "'img'", "]", ".", "data", ")", ")", "\n", "\n", "return", "outputs", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.train.train_detector": [[48, 62], ["env.get_root_logger", "train._dist_train", "train._non_dist_train"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.env.get_root_logger", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.train._dist_train", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.train._non_dist_train"], ["", "def", "train_detector", "(", "model", ",", "\n", "dataset", ",", "\n", "cfg", ",", "\n", "distributed", "=", "False", ",", "\n", "validate", "=", "False", ",", "\n", "logger", "=", "None", ")", ":", "\n", "    ", "if", "logger", "is", "None", ":", "\n", "        ", "logger", "=", "get_root_logger", "(", "cfg", ".", "log_level", ")", "\n", "\n", "# start training", "\n", "", "if", "distributed", ":", "\n", "        ", "_dist_train", "(", "model", ",", "dataset", ",", "cfg", ",", "validate", "=", "validate", ")", "\n", "", "else", ":", "\n", "        ", "_non_dist_train", "(", "model", ",", "dataset", ",", "cfg", ",", "validate", "=", "validate", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.train.build_optimizer": [[64, 132], ["hasattr", "optimizer_cfg.copy.copy", "optimizer_cfg.copy.pop", "mmcv.runner.obj_from_dict", "isinstance", "optimizer_cfg.copy.get", "optimizer_cfg.pop.get", "optimizer_cfg.pop.get", "optimizer_cfg.pop.get", "model.named_parameters", "getattr", "getattr.", "dict", "re.search", "params.append", "optimizer_cfg.copy.pop", "name.endswith", "model.parameters"], "function", ["None"], ["", "", "def", "build_optimizer", "(", "model", ",", "optimizer_cfg", ")", ":", "\n", "    ", "\"\"\"Build optimizer from configs.\n\n    Args:\n        model (:obj:`nn.Module`): The model with parameters to be optimized.\n        optimizer_cfg (dict): The config dict of the optimizer.\n            Positional fields are:\n                - type: class name of the optimizer.\n                - lr: base learning rate.\n            Optional fields are:\n                - any arguments of the corresponding optimizer type, e.g.,\n                  weight_decay, momentum, etc.\n                - paramwise_options: a dict with 3 accepted fileds\n                  (bias_lr_mult, bias_decay_mult, norm_decay_mult).\n                  `bias_lr_mult` and `bias_decay_mult` will be multiplied to\n                  the lr and weight decay respectively for all bias parameters\n                  (except for the normalization layers), and\n                  `norm_decay_mult` will be multiplied to the weight decay\n                  for all weight and bias parameters of normalization layers.\n\n    Returns:\n        torch.optim.Optimizer: The initialized optimizer.\n    \"\"\"", "\n", "if", "hasattr", "(", "model", ",", "'module'", ")", ":", "\n", "        ", "model", "=", "model", ".", "module", "\n", "\n", "", "optimizer_cfg", "=", "optimizer_cfg", ".", "copy", "(", ")", "\n", "paramwise_options", "=", "optimizer_cfg", ".", "pop", "(", "'paramwise_options'", ",", "None", ")", "\n", "# if no paramwise option is specified, just use the global setting", "\n", "if", "paramwise_options", "is", "None", ":", "\n", "        ", "return", "obj_from_dict", "(", "\n", "optimizer_cfg", ",", "torch", ".", "optim", ",", "dict", "(", "params", "=", "model", ".", "parameters", "(", ")", ")", ")", "\n", "", "else", ":", "\n", "        ", "assert", "isinstance", "(", "paramwise_options", ",", "dict", ")", "\n", "# get base lr and weight decay", "\n", "base_lr", "=", "optimizer_cfg", "[", "'lr'", "]", "\n", "base_wd", "=", "optimizer_cfg", ".", "get", "(", "'weight_decay'", ",", "None", ")", "\n", "# weight_decay must be explicitly specified if mult is specified", "\n", "if", "(", "'bias_decay_mult'", "in", "paramwise_options", "\n", "or", "'norm_decay_mult'", "in", "paramwise_options", ")", ":", "\n", "            ", "assert", "base_wd", "is", "not", "None", "\n", "# get param-wise options", "\n", "", "bias_lr_mult", "=", "paramwise_options", ".", "get", "(", "'bias_lr_mult'", ",", "1.", ")", "\n", "bias_decay_mult", "=", "paramwise_options", ".", "get", "(", "'bias_decay_mult'", ",", "1.", ")", "\n", "norm_decay_mult", "=", "paramwise_options", ".", "get", "(", "'norm_decay_mult'", ",", "1.", ")", "\n", "# set param-wise lr and weight decay", "\n", "params", "=", "[", "]", "\n", "for", "name", ",", "param", "in", "model", ".", "named_parameters", "(", ")", ":", "\n", "            ", "if", "not", "param", ".", "requires_grad", ":", "\n", "                ", "continue", "\n", "\n", "", "param_group", "=", "{", "'params'", ":", "[", "param", "]", "}", "\n", "# for norm layers, overwrite the weight decay of weight and bias", "\n", "# TODO: obtain the norm layer prefixes dynamically", "\n", "if", "re", ".", "search", "(", "r'(bn|gn)(\\d+)?.(weight|bias)'", ",", "name", ")", ":", "\n", "                ", "if", "base_wd", "is", "not", "None", ":", "\n", "                    ", "param_group", "[", "'weight_decay'", "]", "=", "base_wd", "*", "norm_decay_mult", "\n", "# for other layers, overwrite both lr and weight decay of bias", "\n", "", "", "elif", "name", ".", "endswith", "(", "'.bias'", ")", ":", "\n", "                ", "param_group", "[", "'lr'", "]", "=", "base_lr", "*", "bias_lr_mult", "\n", "if", "base_wd", "is", "not", "None", ":", "\n", "                    ", "param_group", "[", "'weight_decay'", "]", "=", "base_wd", "*", "bias_decay_mult", "\n", "# otherwise use the global settings", "\n", "\n", "", "", "params", ".", "append", "(", "param_group", ")", "\n", "\n", "", "optimizer_cls", "=", "getattr", "(", "torch", ".", "optim", ",", "optimizer_cfg", ".", "pop", "(", "'type'", ")", ")", "\n", "return", "optimizer_cls", "(", "params", ",", "**", "optimizer_cfg", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.train._dist_train": [[134, 172], ["mmcv.parallel.MMDistributedDataParallel", "train.build_optimizer", "mmcv.runner.Runner", "mmdet.core.DistOptimizerHook", "mmcv.runner.Runner.register_training_hooks", "mmcv.runner.Runner.register_hook", "mmcv.runner.Runner.run", "mmdet.datasets.build_dataloader", "mmcv.parallel.MMDistributedDataParallel.cuda", "mmcv.runner.DistSamplerSeedHook", "isinstance", "mmcv.runner.Runner.resume", "mmcv.runner.Runner.register_hook", "getattr", "issubclass", "mmcv.runner.Runner.load_checkpoint", "mmdet.core.CocoDistEvalRecallHook", "mmcv.runner.Runner.register_hook", "mmcv.runner.Runner.register_hook", "mmdet.core.CocoDistEvalmAPHook", "mmdet.core.DistEvalmAPHook"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.train.build_optimizer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loader.build_loader.build_dataloader"], ["", "", "def", "_dist_train", "(", "model", ",", "dataset", ",", "cfg", ",", "validate", "=", "False", ")", ":", "\n", "# prepare data loaders", "\n", "    ", "data_loaders", "=", "[", "\n", "build_dataloader", "(", "\n", "dataset", ",", "\n", "cfg", ".", "data", ".", "imgs_per_gpu", ",", "\n", "cfg", ".", "data", ".", "workers_per_gpu", ",", "\n", "dist", "=", "True", ")", "\n", "]", "\n", "# put model on gpus", "\n", "model", "=", "MMDistributedDataParallel", "(", "model", ".", "cuda", "(", ")", ")", "\n", "# build runner", "\n", "optimizer", "=", "build_optimizer", "(", "model", ",", "cfg", ".", "optimizer", ")", "\n", "runner", "=", "Runner", "(", "model", ",", "batch_processor", ",", "optimizer", ",", "cfg", ".", "work_dir", ",", "\n", "cfg", ".", "log_level", ")", "\n", "# register hooks", "\n", "optimizer_config", "=", "DistOptimizerHook", "(", "**", "cfg", ".", "optimizer_config", ")", "\n", "runner", ".", "register_training_hooks", "(", "cfg", ".", "lr_config", ",", "optimizer_config", ",", "\n", "cfg", ".", "checkpoint_config", ",", "cfg", ".", "log_config", ")", "\n", "runner", ".", "register_hook", "(", "DistSamplerSeedHook", "(", ")", ")", "\n", "# register eval hooks", "\n", "if", "validate", ":", "\n", "        ", "val_dataset_cfg", "=", "cfg", ".", "data", ".", "val", "\n", "if", "isinstance", "(", "model", ".", "module", ",", "RPN", ")", ":", "\n", "# TODO: implement recall hooks for other datasets", "\n", "            ", "runner", ".", "register_hook", "(", "CocoDistEvalRecallHook", "(", "val_dataset_cfg", ")", ")", "\n", "", "else", ":", "\n", "            ", "dataset_type", "=", "getattr", "(", "datasets", ",", "val_dataset_cfg", ".", "type", ")", "\n", "if", "issubclass", "(", "dataset_type", ",", "datasets", ".", "CocoDataset", ")", ":", "\n", "                ", "runner", ".", "register_hook", "(", "CocoDistEvalmAPHook", "(", "val_dataset_cfg", ")", ")", "\n", "", "else", ":", "\n", "                ", "runner", ".", "register_hook", "(", "DistEvalmAPHook", "(", "val_dataset_cfg", ")", ")", "\n", "\n", "", "", "", "if", "cfg", ".", "resume_from", ":", "\n", "        ", "runner", ".", "resume", "(", "cfg", ".", "resume_from", ")", "\n", "", "elif", "cfg", ".", "load_from", ":", "\n", "        ", "runner", ".", "load_checkpoint", "(", "cfg", ".", "load_from", ")", "\n", "", "runner", ".", "run", "(", "data_loaders", ",", "cfg", ".", "workflow", ",", "cfg", ".", "total_epochs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.train._non_dist_train": [[174, 198], ["mmcv.parallel.MMDataParallel().cuda", "train.build_optimizer", "mmcv.runner.Runner", "mmcv.runner.Runner.register_training_hooks", "mmcv.runner.Runner.run", "mmdet.datasets.build_dataloader", "mmcv.runner.Runner.resume", "mmcv.parallel.MMDataParallel", "mmcv.runner.Runner.load_checkpoint", "range"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.train.build_optimizer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loader.build_loader.build_dataloader"], ["", "def", "_non_dist_train", "(", "model", ",", "dataset", ",", "cfg", ",", "validate", "=", "False", ")", ":", "\n", "# prepare data loaders", "\n", "    ", "data_loaders", "=", "[", "\n", "build_dataloader", "(", "\n", "dataset", ",", "\n", "cfg", ".", "data", ".", "imgs_per_gpu", ",", "\n", "cfg", ".", "data", ".", "workers_per_gpu", ",", "\n", "cfg", ".", "gpus", ",", "\n", "dist", "=", "False", ")", "\n", "]", "\n", "# put model on gpus", "\n", "model", "=", "MMDataParallel", "(", "model", ",", "device_ids", "=", "range", "(", "cfg", ".", "gpus", ")", ")", ".", "cuda", "(", ")", "\n", "# build runner", "\n", "optimizer", "=", "build_optimizer", "(", "model", ",", "cfg", ".", "optimizer", ")", "\n", "runner", "=", "Runner", "(", "model", ",", "batch_processor", ",", "optimizer", ",", "cfg", ".", "work_dir", ",", "\n", "cfg", ".", "log_level", ")", "\n", "runner", ".", "register_training_hooks", "(", "cfg", ".", "lr_config", ",", "cfg", ".", "optimizer_config", ",", "\n", "cfg", ".", "checkpoint_config", ",", "cfg", ".", "log_config", ")", "\n", "\n", "if", "cfg", ".", "resume_from", ":", "\n", "        ", "runner", ".", "resume", "(", "cfg", ".", "resume_from", ")", "\n", "", "elif", "cfg", ".", "load_from", ":", "\n", "        ", "runner", ".", "load_checkpoint", "(", "cfg", ".", "load_from", ")", "\n", "", "runner", ".", "run", "(", "data_loaders", ",", "cfg", ".", "workflow", ",", "cfg", ".", "total_epochs", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.env.init_dist": [[13, 24], ["torch.get_start_method", "torch.set_start_method", "env._init_dist_pytorch", "env._init_dist_mpi", "env._init_dist_slurm", "ValueError"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.env._init_dist_pytorch", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.env._init_dist_mpi", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.env._init_dist_slurm"], ["def", "init_dist", "(", "launcher", ",", "backend", "=", "'nccl'", ",", "**", "kwargs", ")", ":", "\n", "    ", "if", "mp", ".", "get_start_method", "(", "allow_none", "=", "True", ")", "is", "None", ":", "\n", "        ", "mp", ".", "set_start_method", "(", "'spawn'", ")", "\n", "", "if", "launcher", "==", "'pytorch'", ":", "\n", "        ", "_init_dist_pytorch", "(", "backend", ",", "**", "kwargs", ")", "\n", "", "elif", "launcher", "==", "'mpi'", ":", "\n", "        ", "_init_dist_mpi", "(", "backend", ",", "**", "kwargs", ")", "\n", "", "elif", "launcher", "==", "'slurm'", ":", "\n", "        ", "_init_dist_slurm", "(", "backend", ",", "**", "kwargs", ")", "\n", "", "else", ":", "\n", "        ", "raise", "ValueError", "(", "'Invalid launcher type: {}'", ".", "format", "(", "launcher", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.env._init_dist_pytorch": [[26, 32], ["int", "torch.cuda.device_count", "torch.cuda.device_count", "torch.cuda.device_count", "torch.cuda.set_device", "torch.cuda.set_device", "torch.cuda.set_device", "torch.init_process_group"], "function", ["None"], ["", "", "def", "_init_dist_pytorch", "(", "backend", ",", "**", "kwargs", ")", ":", "\n", "# TODO: use local_rank instead of rank % num_gpus", "\n", "    ", "rank", "=", "int", "(", "os", ".", "environ", "[", "'RANK'", "]", ")", "\n", "num_gpus", "=", "torch", ".", "cuda", ".", "device_count", "(", ")", "\n", "torch", ".", "cuda", ".", "set_device", "(", "rank", "%", "num_gpus", ")", "\n", "dist", ".", "init_process_group", "(", "backend", "=", "backend", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.env._init_dist_mpi": [[34, 36], ["None"], "function", ["None"], ["", "def", "_init_dist_mpi", "(", "backend", ",", "**", "kwargs", ")", ":", "\n", "    ", "raise", "NotImplementedError", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.env._init_dist_slurm": [[38, 51], ["int", "int", "torch.cuda.device_count", "torch.cuda.device_count", "torch.cuda.device_count", "torch.cuda.set_device", "torch.cuda.set_device", "torch.cuda.set_device", "subprocess.getoutput", "str", "str", "str", "torch.init_process_group"], "function", ["None"], ["", "def", "_init_dist_slurm", "(", "backend", ",", "port", "=", "29500", ",", "**", "kwargs", ")", ":", "\n", "    ", "proc_id", "=", "int", "(", "os", ".", "environ", "[", "'SLURM_PROCID'", "]", ")", "\n", "ntasks", "=", "int", "(", "os", ".", "environ", "[", "'SLURM_NTASKS'", "]", ")", "\n", "node_list", "=", "os", ".", "environ", "[", "'SLURM_NODELIST'", "]", "\n", "num_gpus", "=", "torch", ".", "cuda", ".", "device_count", "(", ")", "\n", "torch", ".", "cuda", ".", "set_device", "(", "proc_id", "%", "num_gpus", ")", "\n", "addr", "=", "subprocess", ".", "getoutput", "(", "\n", "'scontrol show hostname {} | head -n1'", ".", "format", "(", "node_list", ")", ")", "\n", "os", ".", "environ", "[", "'MASTER_PORT'", "]", "=", "str", "(", "port", ")", "\n", "os", ".", "environ", "[", "'MASTER_ADDR'", "]", "=", "addr", "\n", "os", ".", "environ", "[", "'WORLD_SIZE'", "]", "=", "str", "(", "ntasks", ")", "\n", "os", ".", "environ", "[", "'RANK'", "]", "=", "str", "(", "proc_id", ")", "\n", "dist", ".", "init_process_group", "(", "backend", "=", "backend", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.env.set_random_seed": [[53, 58], ["random.seed", "numpy.random.seed", "torch.manual_seed", "torch.manual_seed", "torch.manual_seed", "torch.cuda.manual_seed_all", "torch.cuda.manual_seed_all", "torch.cuda.manual_seed_all"], "function", ["None"], ["", "def", "set_random_seed", "(", "seed", ")", ":", "\n", "    ", "random", ".", "seed", "(", "seed", ")", "\n", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "torch", ".", "manual_seed", "(", "seed", ")", "\n", "torch", ".", "cuda", ".", "manual_seed_all", "(", "seed", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.env.get_root_logger": [[60, 70], ["logging.getLogger", "mmcv.runner.get_dist_info", "logging.getLogger.hasHandlers", "logging.basicConfig", "logging.getLogger.setLevel"], "function", ["None"], ["", "def", "get_root_logger", "(", "log_level", "=", "logging", ".", "INFO", ")", ":", "\n", "    ", "logger", "=", "logging", ".", "getLogger", "(", ")", "\n", "if", "not", "logger", ".", "hasHandlers", "(", ")", ":", "\n", "        ", "logging", ".", "basicConfig", "(", "\n", "format", "=", "'%(asctime)s - %(levelname)s - %(message)s'", ",", "\n", "level", "=", "log_level", ")", "\n", "", "rank", ",", "_", "=", "get_dist_info", "(", ")", "\n", "if", "rank", "!=", "0", ":", "\n", "        ", "logger", ".", "setLevel", "(", "'ERROR'", ")", "\n", "", "return", "logger", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.masked_conv.MaskedConv2dFunction.forward": [[10, 50], ["torch.nn.modules.utils._pair", "torch.nn.modules.utils._pair", "weight.size", "features.size", "int", "int", "torch.nonzero", "features.new_zeros", "ValueError", "math.floor", "math.floor", "torch.nonzero.numel", "mask_inds[].contiguous", "mask_inds[].contiguous", "features.new_zeros", "masked_conv2d_cuda.masked_im2col_forward", "torch.addmm", "masked_conv2d_cuda.masked_col2im_forward", "mask.dim", "mask.size", "features.dim", "features.size", "features.size", "mask.size", "torch.nonzero.size", "weight.view", "features.size", "features.size"], "methods", ["None"], ["    ", "@", "staticmethod", "\n", "def", "forward", "(", "ctx", ",", "features", ",", "mask", ",", "weight", ",", "bias", ",", "padding", "=", "0", ",", "stride", "=", "1", ")", ":", "\n", "        ", "assert", "mask", ".", "dim", "(", ")", "==", "3", "and", "mask", ".", "size", "(", "0", ")", "==", "1", "\n", "assert", "features", ".", "dim", "(", ")", "==", "4", "and", "features", ".", "size", "(", "0", ")", "==", "1", "\n", "assert", "features", ".", "size", "(", ")", "[", "2", ":", "]", "==", "mask", ".", "size", "(", ")", "[", "1", ":", "]", "\n", "pad_h", ",", "pad_w", "=", "_pair", "(", "padding", ")", "\n", "stride_h", ",", "stride_w", "=", "_pair", "(", "stride", ")", "\n", "if", "stride_h", "!=", "1", "or", "stride_w", "!=", "1", ":", "\n", "            ", "raise", "ValueError", "(", "\n", "'Stride could not only be 1 in masked_conv2d currently.'", ")", "\n", "", "if", "not", "features", ".", "is_cuda", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "\n", "", "out_channel", ",", "in_channel", ",", "kernel_h", ",", "kernel_w", "=", "weight", ".", "size", "(", ")", "\n", "\n", "batch_size", "=", "features", ".", "size", "(", "0", ")", "\n", "out_h", "=", "int", "(", "\n", "math", ".", "floor", "(", "(", "features", ".", "size", "(", "2", ")", "+", "2", "*", "pad_h", "-", "\n", "(", "kernel_h", "-", "1", ")", "-", "1", ")", "/", "stride_h", "+", "1", ")", ")", "\n", "out_w", "=", "int", "(", "\n", "math", ".", "floor", "(", "(", "features", ".", "size", "(", "3", ")", "+", "2", "*", "pad_w", "-", "\n", "(", "kernel_h", "-", "1", ")", "-", "1", ")", "/", "stride_w", "+", "1", ")", ")", "\n", "mask_inds", "=", "torch", ".", "nonzero", "(", "mask", "[", "0", "]", ">", "0", ")", "\n", "output", "=", "features", ".", "new_zeros", "(", "batch_size", ",", "out_channel", ",", "out_h", ",", "out_w", ")", "\n", "if", "mask_inds", ".", "numel", "(", ")", ">", "0", ":", "\n", "            ", "mask_h_idx", "=", "mask_inds", "[", ":", ",", "0", "]", ".", "contiguous", "(", ")", "\n", "mask_w_idx", "=", "mask_inds", "[", ":", ",", "1", "]", ".", "contiguous", "(", ")", "\n", "data_col", "=", "features", ".", "new_zeros", "(", "in_channel", "*", "kernel_h", "*", "kernel_w", ",", "\n", "mask_inds", ".", "size", "(", "0", ")", ")", "\n", "masked_conv2d_cuda", ".", "masked_im2col_forward", "(", "features", ",", "mask_h_idx", ",", "\n", "mask_w_idx", ",", "kernel_h", ",", "\n", "kernel_w", ",", "pad_h", ",", "pad_w", ",", "\n", "data_col", ")", "\n", "\n", "masked_output", "=", "torch", ".", "addmm", "(", "1", ",", "bias", "[", ":", ",", "None", "]", ",", "1", ",", "\n", "weight", ".", "view", "(", "out_channel", ",", "-", "1", ")", ",", "data_col", ")", "\n", "masked_conv2d_cuda", ".", "masked_col2im_forward", "(", "masked_output", ",", "mask_h_idx", ",", "\n", "mask_w_idx", ",", "out_h", ",", "out_w", ",", "\n", "out_channel", ",", "output", ")", "\n", "", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.masked_conv.MaskedConv2dFunction.backward": [[51, 54], ["None"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "backward", "(", "ctx", ",", "grad_output", ")", ":", "\n", "        ", "return", "(", "None", ",", ")", "*", "5", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.roi_pool.RoIPoolFunction.forward": [[9, 36], ["isinstance", "ctx.save_for_backward", "features.size", "rois.size", "features.new_zeros", "features.new_zeros", "roi_pool_cuda.forward", "features.size", "isinstance", "isinstance", "isinstance", "TypeError", "len"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.smooth_l1_loss.SmoothL1Loss.forward"], ["    ", "@", "staticmethod", "\n", "def", "forward", "(", "ctx", ",", "features", ",", "rois", ",", "out_size", ",", "spatial_scale", ")", ":", "\n", "        ", "if", "isinstance", "(", "out_size", ",", "int", ")", ":", "\n", "            ", "out_h", "=", "out_size", "\n", "out_w", "=", "out_size", "\n", "", "elif", "isinstance", "(", "out_size", ",", "tuple", ")", ":", "\n", "            ", "assert", "len", "(", "out_size", ")", "==", "2", "\n", "assert", "isinstance", "(", "out_size", "[", "0", "]", ",", "int", ")", "\n", "assert", "isinstance", "(", "out_size", "[", "1", "]", ",", "int", ")", "\n", "out_h", ",", "out_w", "=", "out_size", "\n", "", "else", ":", "\n", "            ", "raise", "TypeError", "(", "\n", "'\"out_size\" must be an integer or tuple of integers'", ")", "\n", "", "assert", "features", ".", "is_cuda", "\n", "ctx", ".", "save_for_backward", "(", "rois", ")", "\n", "num_channels", "=", "features", ".", "size", "(", "1", ")", "\n", "num_rois", "=", "rois", ".", "size", "(", "0", ")", "\n", "out_size", "=", "(", "num_rois", ",", "num_channels", ",", "out_h", ",", "out_w", ")", "\n", "output", "=", "features", ".", "new_zeros", "(", "out_size", ")", "\n", "argmax", "=", "features", ".", "new_zeros", "(", "out_size", ",", "dtype", "=", "torch", ".", "int", ")", "\n", "roi_pool_cuda", ".", "forward", "(", "features", ",", "rois", ",", "out_h", ",", "out_w", ",", "spatial_scale", ",", "\n", "output", ",", "argmax", ")", "\n", "ctx", ".", "spatial_scale", "=", "spatial_scale", "\n", "ctx", ".", "feature_size", "=", "features", ".", "size", "(", ")", "\n", "ctx", ".", "argmax", "=", "argmax", "\n", "\n", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.roi_pool.RoIPoolFunction.backward": [[37, 53], ["grad_output.new_zeros", "roi_pool_cuda.backward", "grad_output.contiguous"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.roi_align.RoIAlignFunction.backward"], ["", "@", "staticmethod", "\n", "def", "backward", "(", "ctx", ",", "grad_output", ")", ":", "\n", "        ", "assert", "grad_output", ".", "is_cuda", "\n", "spatial_scale", "=", "ctx", ".", "spatial_scale", "\n", "feature_size", "=", "ctx", ".", "feature_size", "\n", "argmax", "=", "ctx", ".", "argmax", "\n", "rois", "=", "ctx", ".", "saved_tensors", "[", "0", "]", "\n", "assert", "feature_size", "is", "not", "None", "\n", "\n", "grad_input", "=", "grad_rois", "=", "None", "\n", "if", "ctx", ".", "needs_input_grad", "[", "0", "]", ":", "\n", "            ", "grad_input", "=", "grad_output", ".", "new_zeros", "(", "feature_size", ")", "\n", "roi_pool_cuda", ".", "backward", "(", "grad_output", ".", "contiguous", "(", ")", ",", "rois", ",", "argmax", ",", "\n", "spatial_scale", ",", "grad_input", ")", "\n", "\n", "", "return", "grad_input", ",", "grad_rois", ",", "None", ",", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.deform_conv.DeformConvFunction.forward": [[10, 53], ["torch.nn.modules.utils._pair", "torch.nn.modules.utils._pair", "torch.nn.modules.utils._pair", "ctx.save_for_backward", "input.new_empty", "ValueError", "deform_conv.DeformConvFunction._output_size", "input.new_empty", "input.new_empty", "min", "deform_conv_cuda.deform_conv_forward_cuda", "input.dim", "weight.size", "weight.size", "input.dim"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.deform_conv.DeformConvFunction._output_size"], ["    ", "@", "staticmethod", "\n", "def", "forward", "(", "ctx", ",", "\n", "input", ",", "\n", "offset", ",", "\n", "weight", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "0", ",", "\n", "dilation", "=", "1", ",", "\n", "groups", "=", "1", ",", "\n", "deformable_groups", "=", "1", ",", "\n", "im2col_step", "=", "64", ")", ":", "\n", "        ", "if", "input", "is", "not", "None", "and", "input", ".", "dim", "(", ")", "!=", "4", ":", "\n", "            ", "raise", "ValueError", "(", "\n", "\"Expected 4D tensor as input, got {}D tensor instead.\"", ".", "format", "(", "\n", "input", ".", "dim", "(", ")", ")", ")", "\n", "", "ctx", ".", "stride", "=", "_pair", "(", "stride", ")", "\n", "ctx", ".", "padding", "=", "_pair", "(", "padding", ")", "\n", "ctx", ".", "dilation", "=", "_pair", "(", "dilation", ")", "\n", "ctx", ".", "groups", "=", "groups", "\n", "ctx", ".", "deformable_groups", "=", "deformable_groups", "\n", "ctx", ".", "im2col_step", "=", "im2col_step", "\n", "\n", "ctx", ".", "save_for_backward", "(", "input", ",", "offset", ",", "weight", ")", "\n", "\n", "output", "=", "input", ".", "new_empty", "(", "\n", "DeformConvFunction", ".", "_output_size", "(", "input", ",", "weight", ",", "ctx", ".", "padding", ",", "\n", "ctx", ".", "dilation", ",", "ctx", ".", "stride", ")", ")", "\n", "\n", "ctx", ".", "bufs_", "=", "[", "input", ".", "new_empty", "(", "0", ")", ",", "input", ".", "new_empty", "(", "0", ")", "]", "# columns, ones", "\n", "\n", "if", "not", "input", ".", "is_cuda", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "", "else", ":", "\n", "            ", "cur_im2col_step", "=", "min", "(", "ctx", ".", "im2col_step", ",", "input", ".", "shape", "[", "0", "]", ")", "\n", "assert", "(", "input", ".", "shape", "[", "0", "]", "%", "\n", "cur_im2col_step", ")", "==", "0", ",", "'im2col step must divide batchsize'", "\n", "deform_conv_cuda", ".", "deform_conv_forward_cuda", "(", "\n", "input", ",", "weight", ",", "offset", ",", "output", ",", "ctx", ".", "bufs_", "[", "0", "]", ",", "ctx", ".", "bufs_", "[", "1", "]", ",", "\n", "weight", ".", "size", "(", "3", ")", ",", "weight", ".", "size", "(", "2", ")", ",", "ctx", ".", "stride", "[", "1", "]", ",", "ctx", ".", "stride", "[", "0", "]", ",", "\n", "ctx", ".", "padding", "[", "1", "]", ",", "ctx", ".", "padding", "[", "0", "]", ",", "ctx", ".", "dilation", "[", "1", "]", ",", "\n", "ctx", ".", "dilation", "[", "0", "]", ",", "ctx", ".", "groups", ",", "ctx", ".", "deformable_groups", ",", "\n", "cur_im2col_step", ")", "\n", "", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.deform_conv.DeformConvFunction.backward": [[54, 90], ["min", "torch.zeros_like", "torch.zeros_like", "deform_conv_cuda.deform_conv_backward_input_cuda", "torch.zeros_like", "deform_conv_cuda.deform_conv_backward_parameters_cuda", "weight.size", "weight.size", "weight.size", "weight.size"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "backward", "(", "ctx", ",", "grad_output", ")", ":", "\n", "        ", "input", ",", "offset", ",", "weight", "=", "ctx", ".", "saved_tensors", "\n", "\n", "grad_input", "=", "grad_offset", "=", "grad_weight", "=", "None", "\n", "\n", "if", "not", "grad_output", ".", "is_cuda", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "", "else", ":", "\n", "            ", "cur_im2col_step", "=", "min", "(", "ctx", ".", "im2col_step", ",", "input", ".", "shape", "[", "0", "]", ")", "\n", "assert", "(", "input", ".", "shape", "[", "0", "]", "%", "\n", "cur_im2col_step", ")", "==", "0", ",", "'im2col step must divide batchsize'", "\n", "\n", "if", "ctx", ".", "needs_input_grad", "[", "0", "]", "or", "ctx", ".", "needs_input_grad", "[", "1", "]", ":", "\n", "                ", "grad_input", "=", "torch", ".", "zeros_like", "(", "input", ")", "\n", "grad_offset", "=", "torch", ".", "zeros_like", "(", "offset", ")", "\n", "deform_conv_cuda", ".", "deform_conv_backward_input_cuda", "(", "\n", "input", ",", "offset", ",", "grad_output", ",", "grad_input", ",", "\n", "grad_offset", ",", "weight", ",", "ctx", ".", "bufs_", "[", "0", "]", ",", "weight", ".", "size", "(", "3", ")", ",", "\n", "weight", ".", "size", "(", "2", ")", ",", "ctx", ".", "stride", "[", "1", "]", ",", "ctx", ".", "stride", "[", "0", "]", ",", "\n", "ctx", ".", "padding", "[", "1", "]", ",", "ctx", ".", "padding", "[", "0", "]", ",", "ctx", ".", "dilation", "[", "1", "]", ",", "\n", "ctx", ".", "dilation", "[", "0", "]", ",", "ctx", ".", "groups", ",", "ctx", ".", "deformable_groups", ",", "\n", "cur_im2col_step", ")", "\n", "\n", "", "if", "ctx", ".", "needs_input_grad", "[", "2", "]", ":", "\n", "                ", "grad_weight", "=", "torch", ".", "zeros_like", "(", "weight", ")", "\n", "deform_conv_cuda", ".", "deform_conv_backward_parameters_cuda", "(", "\n", "input", ",", "offset", ",", "grad_output", ",", "\n", "grad_weight", ",", "ctx", ".", "bufs_", "[", "0", "]", ",", "ctx", ".", "bufs_", "[", "1", "]", ",", "weight", ".", "size", "(", "3", ")", ",", "\n", "weight", ".", "size", "(", "2", ")", ",", "ctx", ".", "stride", "[", "1", "]", ",", "ctx", ".", "stride", "[", "0", "]", ",", "\n", "ctx", ".", "padding", "[", "1", "]", ",", "ctx", ".", "padding", "[", "0", "]", ",", "ctx", ".", "dilation", "[", "1", "]", ",", "\n", "ctx", ".", "dilation", "[", "0", "]", ",", "ctx", ".", "groups", ",", "ctx", ".", "deformable_groups", ",", "1", ",", "\n", "cur_im2col_step", ")", "\n", "\n", "", "", "return", "(", "grad_input", ",", "grad_offset", ",", "grad_weight", ",", "None", ",", "None", ",", "None", ",", "None", ",", "\n", "None", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.deform_conv.DeformConvFunction._output_size": [[91, 106], ["weight.size", "range", "input.size", "input.size", "all", "ValueError", "input.dim", "map", "weight.size", "map"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "_output_size", "(", "input", ",", "weight", ",", "padding", ",", "dilation", ",", "stride", ")", ":", "\n", "        ", "channels", "=", "weight", ".", "size", "(", "0", ")", "\n", "output_size", "=", "(", "input", ".", "size", "(", "0", ")", ",", "channels", ")", "\n", "for", "d", "in", "range", "(", "input", ".", "dim", "(", ")", "-", "2", ")", ":", "\n", "            ", "in_size", "=", "input", ".", "size", "(", "d", "+", "2", ")", "\n", "pad", "=", "padding", "[", "d", "]", "\n", "kernel", "=", "dilation", "[", "d", "]", "*", "(", "weight", ".", "size", "(", "d", "+", "2", ")", "-", "1", ")", "+", "1", "\n", "stride_", "=", "stride", "[", "d", "]", "\n", "output_size", "+=", "(", "(", "in_size", "+", "(", "2", "*", "pad", ")", "-", "kernel", ")", "//", "stride_", "+", "1", ",", ")", "\n", "", "if", "not", "all", "(", "map", "(", "lambda", "s", ":", "s", ">", "0", ",", "output_size", ")", ")", ":", "\n", "            ", "raise", "ValueError", "(", "\n", "\"convolution input is too small (output would be {})\"", ".", "format", "(", "\n", "'x'", ".", "join", "(", "map", "(", "str", ",", "output_size", ")", ")", ")", ")", "\n", "", "return", "output_size", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.deform_conv.ModulatedDeformConvFunction.forward": [[110, 144], ["input.new_empty", "deform_conv_cuda.modulated_deform_conv_cuda_forward", "input.new_empty", "ctx.save_for_backward", "deform_conv.ModulatedDeformConvFunction._infer_shape", "input.new_empty", "input.new_empty"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.deform_conv.ModulatedDeformConvFunction._infer_shape"], ["    ", "@", "staticmethod", "\n", "def", "forward", "(", "ctx", ",", "\n", "input", ",", "\n", "offset", ",", "\n", "mask", ",", "\n", "weight", ",", "\n", "bias", "=", "None", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "0", ",", "\n", "dilation", "=", "1", ",", "\n", "groups", "=", "1", ",", "\n", "deformable_groups", "=", "1", ")", ":", "\n", "        ", "ctx", ".", "stride", "=", "stride", "\n", "ctx", ".", "padding", "=", "padding", "\n", "ctx", ".", "dilation", "=", "dilation", "\n", "ctx", ".", "groups", "=", "groups", "\n", "ctx", ".", "deformable_groups", "=", "deformable_groups", "\n", "ctx", ".", "with_bias", "=", "bias", "is", "not", "None", "\n", "if", "not", "ctx", ".", "with_bias", ":", "\n", "            ", "bias", "=", "input", ".", "new_empty", "(", "1", ")", "# fake tensor", "\n", "", "if", "not", "input", ".", "is_cuda", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "", "if", "weight", ".", "requires_grad", "or", "mask", ".", "requires_grad", "or", "offset", ".", "requires_grad", "or", "input", ".", "requires_grad", ":", "\n", "            ", "ctx", ".", "save_for_backward", "(", "input", ",", "offset", ",", "mask", ",", "weight", ",", "bias", ")", "\n", "", "output", "=", "input", ".", "new_empty", "(", "\n", "ModulatedDeformConvFunction", ".", "_infer_shape", "(", "ctx", ",", "input", ",", "weight", ")", ")", "\n", "ctx", ".", "_bufs", "=", "[", "input", ".", "new_empty", "(", "0", ")", ",", "input", ".", "new_empty", "(", "0", ")", "]", "\n", "deform_conv_cuda", ".", "modulated_deform_conv_cuda_forward", "(", "\n", "input", ",", "weight", ",", "bias", ",", "ctx", ".", "_bufs", "[", "0", "]", ",", "offset", ",", "mask", ",", "output", ",", "\n", "ctx", ".", "_bufs", "[", "1", "]", ",", "weight", ".", "shape", "[", "2", "]", ",", "weight", ".", "shape", "[", "3", "]", ",", "ctx", ".", "stride", ",", "\n", "ctx", ".", "stride", ",", "ctx", ".", "padding", ",", "ctx", ".", "padding", ",", "ctx", ".", "dilation", ",", "ctx", ".", "dilation", ",", "\n", "ctx", ".", "groups", ",", "ctx", ".", "deformable_groups", ",", "ctx", ".", "with_bias", ")", "\n", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.deform_conv.ModulatedDeformConvFunction.backward": [[145, 166], ["torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "deform_conv_cuda.modulated_deform_conv_cuda_backward"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "backward", "(", "ctx", ",", "grad_output", ")", ":", "\n", "        ", "if", "not", "grad_output", ".", "is_cuda", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "", "input", ",", "offset", ",", "mask", ",", "weight", ",", "bias", "=", "ctx", ".", "saved_tensors", "\n", "grad_input", "=", "torch", ".", "zeros_like", "(", "input", ")", "\n", "grad_offset", "=", "torch", ".", "zeros_like", "(", "offset", ")", "\n", "grad_mask", "=", "torch", ".", "zeros_like", "(", "mask", ")", "\n", "grad_weight", "=", "torch", ".", "zeros_like", "(", "weight", ")", "\n", "grad_bias", "=", "torch", ".", "zeros_like", "(", "bias", ")", "\n", "deform_conv_cuda", ".", "modulated_deform_conv_cuda_backward", "(", "\n", "input", ",", "weight", ",", "bias", ",", "ctx", ".", "_bufs", "[", "0", "]", ",", "offset", ",", "mask", ",", "ctx", ".", "_bufs", "[", "1", "]", ",", "\n", "grad_input", ",", "grad_weight", ",", "grad_bias", ",", "grad_offset", ",", "grad_mask", ",", "\n", "grad_output", ",", "weight", ".", "shape", "[", "2", "]", ",", "weight", ".", "shape", "[", "3", "]", ",", "ctx", ".", "stride", ",", "\n", "ctx", ".", "stride", ",", "ctx", ".", "padding", ",", "ctx", ".", "padding", ",", "ctx", ".", "dilation", ",", "ctx", ".", "dilation", ",", "\n", "ctx", ".", "groups", ",", "ctx", ".", "deformable_groups", ",", "ctx", ".", "with_bias", ")", "\n", "if", "not", "ctx", ".", "with_bias", ":", "\n", "            ", "grad_bias", "=", "None", "\n", "\n", "", "return", "(", "grad_input", ",", "grad_offset", ",", "grad_mask", ",", "grad_weight", ",", "grad_bias", ",", "\n", "None", ",", "None", ",", "None", ",", "None", ",", "None", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.deform_conv.ModulatedDeformConvFunction._infer_shape": [[167, 178], ["input.size", "weight.size"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "_infer_shape", "(", "ctx", ",", "input", ",", "weight", ")", ":", "\n", "        ", "n", "=", "input", ".", "size", "(", "0", ")", "\n", "channels_out", "=", "weight", ".", "size", "(", "0", ")", "\n", "height", ",", "width", "=", "input", ".", "shape", "[", "2", ":", "4", "]", "\n", "kernel_h", ",", "kernel_w", "=", "weight", ".", "shape", "[", "2", ":", "4", "]", "\n", "height_out", "=", "(", "height", "+", "2", "*", "ctx", ".", "padding", "-", "\n", "(", "ctx", ".", "dilation", "*", "(", "kernel_h", "-", "1", ")", "+", "1", ")", ")", "//", "ctx", ".", "stride", "+", "1", "\n", "width_out", "=", "(", "width", "+", "2", "*", "ctx", ".", "padding", "-", "\n", "(", "ctx", ".", "dilation", "*", "(", "kernel_w", "-", "1", ")", "+", "1", ")", ")", "//", "ctx", ".", "stride", "+", "1", "\n", "return", "n", ",", "channels_out", ",", "height_out", ",", "width_out", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.deform_pool.DeformRoIPoolingFunction.forward": [[9, 48], ["data.new_empty", "data.new_empty", "deform_pool_cuda.deform_psroi_pooling_cuda_forward", "ctx.save_for_backward"], "methods", ["None"], ["    ", "@", "staticmethod", "\n", "def", "forward", "(", "ctx", ",", "\n", "data", ",", "\n", "rois", ",", "\n", "offset", ",", "\n", "spatial_scale", ",", "\n", "out_size", ",", "\n", "out_channels", ",", "\n", "no_trans", ",", "\n", "group_size", "=", "1", ",", "\n", "part_size", "=", "None", ",", "\n", "sample_per_part", "=", "4", ",", "\n", "trans_std", "=", ".0", ")", ":", "\n", "        ", "ctx", ".", "spatial_scale", "=", "spatial_scale", "\n", "ctx", ".", "out_size", "=", "out_size", "\n", "ctx", ".", "out_channels", "=", "out_channels", "\n", "ctx", ".", "no_trans", "=", "no_trans", "\n", "ctx", ".", "group_size", "=", "group_size", "\n", "ctx", ".", "part_size", "=", "out_size", "if", "part_size", "is", "None", "else", "part_size", "\n", "ctx", ".", "sample_per_part", "=", "sample_per_part", "\n", "ctx", ".", "trans_std", "=", "trans_std", "\n", "\n", "assert", "0.0", "<=", "ctx", ".", "trans_std", "<=", "1.0", "\n", "if", "not", "data", ".", "is_cuda", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "\n", "", "n", "=", "rois", ".", "shape", "[", "0", "]", "\n", "output", "=", "data", ".", "new_empty", "(", "n", ",", "out_channels", ",", "out_size", ",", "out_size", ")", "\n", "output_count", "=", "data", ".", "new_empty", "(", "n", ",", "out_channels", ",", "out_size", ",", "out_size", ")", "\n", "deform_pool_cuda", ".", "deform_psroi_pooling_cuda_forward", "(", "\n", "data", ",", "rois", ",", "offset", ",", "output", ",", "output_count", ",", "ctx", ".", "no_trans", ",", "\n", "ctx", ".", "spatial_scale", ",", "ctx", ".", "out_channels", ",", "ctx", ".", "group_size", ",", "ctx", ".", "out_size", ",", "\n", "ctx", ".", "part_size", ",", "ctx", ".", "sample_per_part", ",", "ctx", ".", "trans_std", ")", "\n", "\n", "if", "data", ".", "requires_grad", "or", "rois", ".", "requires_grad", "or", "offset", ".", "requires_grad", ":", "\n", "            ", "ctx", ".", "save_for_backward", "(", "data", ",", "rois", ",", "offset", ")", "\n", "", "ctx", ".", "output_count", "=", "output_count", "\n", "\n", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.deform_pool.DeformRoIPoolingFunction.backward": [[49, 67], ["torch.zeros_like", "torch.zeros_like", "deform_pool_cuda.deform_psroi_pooling_cuda_backward"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "backward", "(", "ctx", ",", "grad_output", ")", ":", "\n", "        ", "if", "not", "grad_output", ".", "is_cuda", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "\n", "", "data", ",", "rois", ",", "offset", "=", "ctx", ".", "saved_tensors", "\n", "output_count", "=", "ctx", ".", "output_count", "\n", "grad_input", "=", "torch", ".", "zeros_like", "(", "data", ")", "\n", "grad_rois", "=", "None", "\n", "grad_offset", "=", "torch", ".", "zeros_like", "(", "offset", ")", "\n", "\n", "deform_pool_cuda", ".", "deform_psroi_pooling_cuda_backward", "(", "\n", "grad_output", ",", "data", ",", "rois", ",", "offset", ",", "output_count", ",", "grad_input", ",", "\n", "grad_offset", ",", "ctx", ".", "no_trans", ",", "ctx", ".", "spatial_scale", ",", "ctx", ".", "out_channels", ",", "\n", "ctx", ".", "group_size", ",", "ctx", ".", "out_size", ",", "ctx", ".", "part_size", ",", "ctx", ".", "sample_per_part", ",", "\n", "ctx", ".", "trans_std", ")", "\n", "return", "(", "grad_input", ",", "grad_rois", ",", "grad_offset", ",", "None", ",", "None", ",", "None", ",", "None", ",", "\n", "None", ",", "None", ",", "None", ",", "None", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.sigmoid_focal_loss.SigmoidFocalLossFunction.forward": [[10, 28], ["ctx.save_for_backward", "sigmoid_focal_loss_cuda.forward", "torch._Reduction.get_enum", "sigmoid_focal_loss_cuda.forward.mean", "sigmoid_focal_loss_cuda.forward.sum"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.smooth_l1_loss.SmoothL1Loss.forward"], ["    ", "@", "staticmethod", "\n", "def", "forward", "(", "ctx", ",", "input", ",", "target", ",", "gamma", "=", "2.0", ",", "alpha", "=", "0.25", ",", "reduction", "=", "'mean'", ")", ":", "\n", "        ", "ctx", ".", "save_for_backward", "(", "input", ",", "target", ")", "\n", "num_classes", "=", "input", ".", "shape", "[", "1", "]", "\n", "ctx", ".", "num_classes", "=", "num_classes", "\n", "ctx", ".", "gamma", "=", "gamma", "\n", "ctx", ".", "alpha", "=", "alpha", "\n", "\n", "loss", "=", "sigmoid_focal_loss_cuda", ".", "forward", "(", "input", ",", "target", ",", "num_classes", ",", "\n", "gamma", ",", "alpha", ")", "\n", "reduction_enum", "=", "F", ".", "_Reduction", ".", "get_enum", "(", "reduction", ")", "\n", "# none: 0, mean:1, sum: 2", "\n", "if", "reduction_enum", "==", "0", ":", "\n", "            ", "return", "loss", "\n", "", "elif", "reduction_enum", "==", "1", ":", "\n", "            ", "return", "loss", ".", "mean", "(", ")", "\n", "", "elif", "reduction_enum", "==", "2", ":", "\n", "            ", "return", "loss", ".", "sum", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.sigmoid_focal_loss.SigmoidFocalLossFunction.backward": [[29, 40], ["d_loss.contiguous.contiguous.contiguous", "sigmoid_focal_loss_cuda.backward"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.roi_align.RoIAlignFunction.backward"], ["", "", "@", "staticmethod", "\n", "@", "once_differentiable", "\n", "def", "backward", "(", "ctx", ",", "d_loss", ")", ":", "\n", "        ", "input", ",", "target", "=", "ctx", ".", "saved_tensors", "\n", "num_classes", "=", "ctx", ".", "num_classes", "\n", "gamma", "=", "ctx", ".", "gamma", "\n", "alpha", "=", "ctx", ".", "alpha", "\n", "d_loss", "=", "d_loss", ".", "contiguous", "(", ")", "\n", "d_input", "=", "sigmoid_focal_loss_cuda", ".", "backward", "(", "input", ",", "target", ",", "d_loss", ",", "\n", "num_classes", ",", "gamma", ",", "alpha", ")", "\n", "return", "d_input", ",", "None", ",", "None", ",", "None", ",", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.roi_align.RoIAlignFunction.forward": [[8, 37], ["isinstance", "ctx.save_for_backward", "features.size", "features.size", "rois.size", "features.new_zeros", "isinstance", "roi_align_cuda.forward", "isinstance", "isinstance", "TypeError", "len"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.smooth_l1_loss.SmoothL1Loss.forward"], ["    ", "@", "staticmethod", "\n", "def", "forward", "(", "ctx", ",", "features", ",", "rois", ",", "out_size", ",", "spatial_scale", ",", "sample_num", "=", "0", ")", ":", "\n", "        ", "if", "isinstance", "(", "out_size", ",", "int", ")", ":", "\n", "            ", "out_h", "=", "out_size", "\n", "out_w", "=", "out_size", "\n", "", "elif", "isinstance", "(", "out_size", ",", "tuple", ")", ":", "\n", "            ", "assert", "len", "(", "out_size", ")", "==", "2", "\n", "assert", "isinstance", "(", "out_size", "[", "0", "]", ",", "int", ")", "\n", "assert", "isinstance", "(", "out_size", "[", "1", "]", ",", "int", ")", "\n", "out_h", ",", "out_w", "=", "out_size", "\n", "", "else", ":", "\n", "            ", "raise", "TypeError", "(", "\n", "'\"out_size\" must be an integer or tuple of integers'", ")", "\n", "", "ctx", ".", "spatial_scale", "=", "spatial_scale", "\n", "ctx", ".", "sample_num", "=", "sample_num", "\n", "ctx", ".", "save_for_backward", "(", "rois", ")", "\n", "ctx", ".", "feature_size", "=", "features", ".", "size", "(", ")", "\n", "\n", "batch_size", ",", "num_channels", ",", "data_height", ",", "data_width", "=", "features", ".", "size", "(", ")", "\n", "num_rois", "=", "rois", ".", "size", "(", "0", ")", "\n", "\n", "output", "=", "features", ".", "new_zeros", "(", "num_rois", ",", "num_channels", ",", "out_h", ",", "out_w", ")", "\n", "if", "features", ".", "is_cuda", ":", "\n", "            ", "roi_align_cuda", ".", "forward", "(", "features", ",", "rois", ",", "out_h", ",", "out_w", ",", "spatial_scale", ",", "\n", "sample_num", ",", "output", ")", "\n", "", "else", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "\n", "", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.roi_align.RoIAlignFunction.backward": [[38, 59], ["grad_output.size", "grad_output.size", "rois.new_zeros", "roi_align_cuda.backward", "grad_output.contiguous"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.roi_align.RoIAlignFunction.backward"], ["", "@", "staticmethod", "\n", "def", "backward", "(", "ctx", ",", "grad_output", ")", ":", "\n", "        ", "feature_size", "=", "ctx", ".", "feature_size", "\n", "spatial_scale", "=", "ctx", ".", "spatial_scale", "\n", "sample_num", "=", "ctx", ".", "sample_num", "\n", "rois", "=", "ctx", ".", "saved_tensors", "[", "0", "]", "\n", "assert", "(", "feature_size", "is", "not", "None", "and", "grad_output", ".", "is_cuda", ")", "\n", "\n", "batch_size", ",", "num_channels", ",", "data_height", ",", "data_width", "=", "feature_size", "\n", "out_w", "=", "grad_output", ".", "size", "(", "3", ")", "\n", "out_h", "=", "grad_output", ".", "size", "(", "2", ")", "\n", "\n", "grad_input", "=", "grad_rois", "=", "None", "\n", "if", "ctx", ".", "needs_input_grad", "[", "0", "]", ":", "\n", "            ", "grad_input", "=", "rois", ".", "new_zeros", "(", "batch_size", ",", "num_channels", ",", "data_height", ",", "\n", "data_width", ")", "\n", "roi_align_cuda", ".", "backward", "(", "grad_output", ".", "contiguous", "(", ")", ",", "rois", ",", "out_h", ",", "\n", "out_w", ",", "spatial_scale", ",", "sample_num", ",", "\n", "grad_input", ")", "\n", "\n", "", "return", "grad_input", ",", "grad_rois", ",", "None", ",", "None", ",", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.masked_conv.MaskedConv2d.__init__": [[12, 24], ["torch.Conv2d.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["        ", "assert", "mask", ".", "dim", "(", ")", "==", "3", "and", "mask", ".", "size", "(", "0", ")", "==", "1", "\n", "assert", "features", ".", "dim", "(", ")", "==", "4", "and", "features", ".", "size", "(", "0", ")", "==", "1", "\n", "assert", "features", ".", "size", "(", ")", "[", "2", ":", "]", "==", "mask", ".", "size", "(", ")", "[", "1", ":", "]", "\n", "pad_h", ",", "pad_w", "=", "_pair", "(", "padding", ")", "\n", "stride_h", ",", "stride_w", "=", "_pair", "(", "stride", ")", "\n", "if", "stride_h", "!=", "1", "or", "stride_w", "!=", "1", ":", "\n", "            ", "raise", "ValueError", "(", "\n", "'Stride could not only be 1 in masked_conv2d currently.'", ")", "\n", "", "if", "not", "features", ".", "is_cuda", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "\n", "", "out_channel", ",", "in_channel", ",", "kernel_h", ",", "kernel_w", "=", "weight", ".", "size", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.masked_conv.MaskedConv2d.forward": [[25, 31], ["super().forward", "functions.masked_conv.masked_conv2d"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.smooth_l1_loss.SmoothL1Loss.forward"], ["batch_size", "=", "features", ".", "size", "(", "0", ")", "\n", "out_h", "=", "int", "(", "\n", "math", ".", "floor", "(", "(", "features", ".", "size", "(", "2", ")", "+", "2", "*", "pad_h", "-", "\n", "(", "kernel_h", "-", "1", ")", "-", "1", ")", "/", "stride_h", "+", "1", ")", ")", "\n", "out_w", "=", "int", "(", "\n", "math", ".", "floor", "(", "(", "features", ".", "size", "(", "3", ")", "+", "2", "*", "pad_w", "-", "\n", "(", "kernel_h", "-", "1", ")", "-", "1", ")", "/", "stride_w", "+", "1", ")", ")", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.roi_pool.RoIPool.__init__": [[7, 12], ["torch.nn.modules.module.Module.__init__", "float"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["class", "RoIPoolFunction", "(", "Function", ")", ":", "\n", "\n", "    ", "@", "staticmethod", "\n", "def", "forward", "(", "ctx", ",", "features", ",", "rois", ",", "out_size", ",", "spatial_scale", ")", ":", "\n", "        ", "if", "isinstance", "(", "out_size", ",", "int", ")", ":", "\n", "            ", "out_h", "=", "out_size", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.roi_pool.RoIPool.forward": [[13, 15], ["functions.roi_pool.roi_pool"], "methods", ["None"], ["out_w", "=", "out_size", "\n", "", "elif", "isinstance", "(", "out_size", ",", "tuple", ")", ":", "\n", "            ", "assert", "len", "(", "out_size", ")", "==", "2", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_conv.DeformConv.__init__": [[12, 46], ["torch.Module.__init__", "torch.nn.modules.utils._pair", "torch.nn.modules.utils._pair", "torch.nn.modules.utils._pair", "torch.nn.modules.utils._pair", "torch.nn.modules.utils._pair", "torch.nn.modules.utils._pair", "torch.nn.modules.utils._pair", "torch.nn.modules.utils._pair", "torch.Parameter", "torch.Parameter", "functions.deform_conv.deform_conv.DeformConv.reset_parameters", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.gcb.context_block.ContextBlock.reset_parameters"], ["input", ",", "\n", "offset", ",", "\n", "weight", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "0", ",", "\n", "dilation", "=", "1", ",", "\n", "groups", "=", "1", ",", "\n", "deformable_groups", "=", "1", ",", "\n", "im2col_step", "=", "64", ")", ":", "\n", "        ", "if", "input", "is", "not", "None", "and", "input", ".", "dim", "(", ")", "!=", "4", ":", "\n", "            ", "raise", "ValueError", "(", "\n", "\"Expected 4D tensor as input, got {}D tensor instead.\"", ".", "format", "(", "\n", "input", ".", "dim", "(", ")", ")", ")", "\n", "", "ctx", ".", "stride", "=", "_pair", "(", "stride", ")", "\n", "ctx", ".", "padding", "=", "_pair", "(", "padding", ")", "\n", "ctx", ".", "dilation", "=", "_pair", "(", "dilation", ")", "\n", "ctx", ".", "groups", "=", "groups", "\n", "ctx", ".", "deformable_groups", "=", "deformable_groups", "\n", "ctx", ".", "im2col_step", "=", "im2col_step", "\n", "\n", "ctx", ".", "save_for_backward", "(", "input", ",", "offset", ",", "weight", ")", "\n", "\n", "output", "=", "input", ".", "new_empty", "(", "\n", "DeformConvFunction", ".", "_output_size", "(", "input", ",", "weight", ",", "ctx", ".", "padding", ",", "\n", "ctx", ".", "dilation", ",", "ctx", ".", "stride", ")", ")", "\n", "\n", "ctx", ".", "bufs_", "=", "[", "input", ".", "new_empty", "(", "0", ")", ",", "input", ".", "new_empty", "(", "0", ")", "]", "# columns, ones", "\n", "\n", "if", "not", "input", ".", "is_cuda", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "", "else", ":", "\n", "            ", "cur_im2col_step", "=", "min", "(", "ctx", ".", "im2col_step", ",", "input", ".", "shape", "[", "0", "]", ")", "\n", "assert", "(", "input", ".", "shape", "[", "0", "]", "%", "\n", "cur_im2col_step", ")", "==", "0", ",", "'im2col step must divide batchsize'", "\n", "deform_conv_cuda", ".", "deform_conv_forward_cuda", "(", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_conv.DeformConv.reset_parameters": [[47, 53], ["functions.deform_conv.deform_conv.DeformConv.weight.data.uniform_", "math.sqrt"], "methods", ["None"], ["input", ",", "weight", ",", "offset", ",", "output", ",", "ctx", ".", "bufs_", "[", "0", "]", ",", "ctx", ".", "bufs_", "[", "1", "]", ",", "\n", "weight", ".", "size", "(", "3", ")", ",", "weight", ".", "size", "(", "2", ")", ",", "ctx", ".", "stride", "[", "1", "]", ",", "ctx", ".", "stride", "[", "0", "]", ",", "\n", "ctx", ".", "padding", "[", "1", "]", ",", "ctx", ".", "padding", "[", "0", "]", ",", "ctx", ".", "dilation", "[", "1", "]", ",", "\n", "ctx", ".", "dilation", "[", "0", "]", ",", "ctx", ".", "groups", ",", "ctx", ".", "deformable_groups", ",", "\n", "cur_im2col_step", ")", "\n", "", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_conv.DeformConv.forward": [[54, 57], ["functions.deform_conv.deform_conv"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "backward", "(", "ctx", ",", "grad_output", ")", ":", "\n", "        ", "input", ",", "offset", ",", "weight", "=", "ctx", ".", "saved_tensors", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_conv.DeformConvPack.__init__": [[61, 73], ["functions.deform_conv.deform_conv.DeformConv.__init__", "torch.Conv2d", "torch.Conv2d", "functions.deform_conv.deform_conv.DeformConvPack.init_offset", "torch.nn.modules.utils._pair", "torch.nn.modules.utils._pair", "torch.nn.modules.utils._pair", "torch.nn.modules.utils._pair"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_conv.ModulatedDeformConvPack.init_offset"], ["            ", "raise", "NotImplementedError", "\n", "", "else", ":", "\n", "            ", "cur_im2col_step", "=", "min", "(", "ctx", ".", "im2col_step", ",", "input", ".", "shape", "[", "0", "]", ")", "\n", "assert", "(", "input", ".", "shape", "[", "0", "]", "%", "\n", "cur_im2col_step", ")", "==", "0", ",", "'im2col step must divide batchsize'", "\n", "\n", "if", "ctx", ".", "needs_input_grad", "[", "0", "]", "or", "ctx", ".", "needs_input_grad", "[", "1", "]", ":", "\n", "                ", "grad_input", "=", "torch", ".", "zeros_like", "(", "input", ")", "\n", "grad_offset", "=", "torch", ".", "zeros_like", "(", "offset", ")", "\n", "deform_conv_cuda", ".", "deform_conv_backward_input_cuda", "(", "\n", "input", ",", "offset", ",", "grad_output", ",", "grad_input", ",", "\n", "grad_offset", ",", "weight", ",", "ctx", ".", "bufs_", "[", "0", "]", ",", "weight", ".", "size", "(", "3", ")", ",", "\n", "weight", ".", "size", "(", "2", ")", ",", "ctx", ".", "stride", "[", "1", "]", ",", "ctx", ".", "stride", "[", "0", "]", ",", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_conv.DeformConvPack.init_offset": [[74, 77], ["functions.deform_conv.deform_conv.DeformConvPack.conv_offset.weight.data.zero_", "functions.deform_conv.deform_conv.DeformConvPack.conv_offset.bias.data.zero_"], "methods", ["None"], ["ctx", ".", "padding", "[", "1", "]", ",", "ctx", ".", "padding", "[", "0", "]", ",", "ctx", ".", "dilation", "[", "1", "]", ",", "\n", "ctx", ".", "dilation", "[", "0", "]", ",", "ctx", ".", "groups", ",", "ctx", ".", "deformable_groups", ",", "\n", "cur_im2col_step", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_conv.DeformConvPack.forward": [[78, 82], ["functions.deform_conv.deform_conv.DeformConvPack.conv_offset", "functions.deform_conv.deform_conv"], "methods", ["None"], ["", "if", "ctx", ".", "needs_input_grad", "[", "2", "]", ":", "\n", "                ", "grad_weight", "=", "torch", ".", "zeros_like", "(", "weight", ")", "\n", "deform_conv_cuda", ".", "deform_conv_backward_parameters_cuda", "(", "\n", "input", ",", "offset", ",", "grad_output", ",", "\n", "grad_weight", ",", "ctx", ".", "bufs_", "[", "0", "]", ",", "ctx", ".", "bufs_", "[", "1", "]", ",", "weight", ".", "size", "(", "3", ")", ",", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_conv.ModulatedDeformConv.__init__": [[86, 115], ["torch.Module.__init__", "torch.nn.modules.utils._pair", "torch.nn.modules.utils._pair", "torch.Parameter", "torch.Parameter", "functions.deform_conv.deform_conv.ModulatedDeformConv.reset_parameters", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Parameter", "torch.Parameter", "functions.deform_conv.deform_conv.ModulatedDeformConv.register_parameter", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.gcb.context_block.ContextBlock.reset_parameters"], ["cur_im2col_step", ")", "\n", "\n", "", "", "return", "(", "grad_input", ",", "grad_offset", ",", "grad_weight", ",", "None", ",", "None", ",", "None", ",", "None", ",", "\n", "None", ")", "\n", "\n", "", "@", "staticmethod", "\n", "def", "_output_size", "(", "input", ",", "weight", ",", "padding", ",", "dilation", ",", "stride", ")", ":", "\n", "        ", "channels", "=", "weight", ".", "size", "(", "0", ")", "\n", "output_size", "=", "(", "input", ".", "size", "(", "0", ")", ",", "channels", ")", "\n", "for", "d", "in", "range", "(", "input", ".", "dim", "(", ")", "-", "2", ")", ":", "\n", "            ", "in_size", "=", "input", ".", "size", "(", "d", "+", "2", ")", "\n", "pad", "=", "padding", "[", "d", "]", "\n", "kernel", "=", "dilation", "[", "d", "]", "*", "(", "weight", ".", "size", "(", "d", "+", "2", ")", "-", "1", ")", "+", "1", "\n", "stride_", "=", "stride", "[", "d", "]", "\n", "output_size", "+=", "(", "(", "in_size", "+", "(", "2", "*", "pad", ")", "-", "kernel", ")", "//", "stride_", "+", "1", ",", ")", "\n", "", "if", "not", "all", "(", "map", "(", "lambda", "s", ":", "s", ">", "0", ",", "output_size", ")", ")", ":", "\n", "            ", "raise", "ValueError", "(", "\n", "\"convolution input is too small (output would be {})\"", ".", "format", "(", "\n", "'x'", ".", "join", "(", "map", "(", "str", ",", "output_size", ")", ")", ")", ")", "\n", "", "return", "output_size", "\n", "\n", "\n", "", "", "class", "ModulatedDeformConvFunction", "(", "Function", ")", ":", "\n", "\n", "    ", "@", "staticmethod", "\n", "def", "forward", "(", "ctx", ",", "\n", "input", ",", "\n", "offset", ",", "\n", "mask", ",", "\n", "weight", ",", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_conv.ModulatedDeformConv.reset_parameters": [[116, 124], ["functions.deform_conv.deform_conv.ModulatedDeformConv.weight.data.uniform_", "math.sqrt", "functions.deform_conv.deform_conv.ModulatedDeformConv.bias.data.zero_"], "methods", ["None"], ["bias", "=", "None", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "0", ",", "\n", "dilation", "=", "1", ",", "\n", "groups", "=", "1", ",", "\n", "deformable_groups", "=", "1", ")", ":", "\n", "        ", "ctx", ".", "stride", "=", "stride", "\n", "ctx", ".", "padding", "=", "padding", "\n", "ctx", ".", "dilation", "=", "dilation", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_conv.ModulatedDeformConv.forward": [[125, 129], ["functions.deform_conv.modulated_deform_conv"], "methods", ["None"], ["ctx", ".", "groups", "=", "groups", "\n", "ctx", ".", "deformable_groups", "=", "deformable_groups", "\n", "ctx", ".", "with_bias", "=", "bias", "is", "not", "None", "\n", "if", "not", "ctx", ".", "with_bias", ":", "\n", "            ", "bias", "=", "input", ".", "new_empty", "(", "1", ")", "# fake tensor", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_conv.ModulatedDeformConvPack.__init__": [[133, 145], ["functions.deform_conv.deform_conv.ModulatedDeformConv.__init__", "torch.Conv2d", "torch.Conv2d", "functions.deform_conv.deform_conv.ModulatedDeformConvPack.init_offset", "torch.nn.modules.utils._pair", "torch.nn.modules.utils._pair", "torch.nn.modules.utils._pair", "torch.nn.modules.utils._pair"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_conv.ModulatedDeformConvPack.init_offset"], ["or", "input", ".", "requires_grad", ":", "\n", "            ", "ctx", ".", "save_for_backward", "(", "input", ",", "offset", ",", "mask", ",", "weight", ",", "bias", ")", "\n", "", "output", "=", "input", ".", "new_empty", "(", "\n", "ModulatedDeformConvFunction", ".", "_infer_shape", "(", "ctx", ",", "input", ",", "weight", ")", ")", "\n", "ctx", ".", "_bufs", "=", "[", "input", ".", "new_empty", "(", "0", ")", ",", "input", ".", "new_empty", "(", "0", ")", "]", "\n", "deform_conv_cuda", ".", "modulated_deform_conv_cuda_forward", "(", "\n", "input", ",", "weight", ",", "bias", ",", "ctx", ".", "_bufs", "[", "0", "]", ",", "offset", ",", "mask", ",", "output", ",", "\n", "ctx", ".", "_bufs", "[", "1", "]", ",", "weight", ".", "shape", "[", "2", "]", ",", "weight", ".", "shape", "[", "3", "]", ",", "ctx", ".", "stride", ",", "\n", "ctx", ".", "stride", ",", "ctx", ".", "padding", ",", "ctx", ".", "padding", ",", "ctx", ".", "dilation", ",", "ctx", ".", "dilation", ",", "\n", "ctx", ".", "groups", ",", "ctx", ".", "deformable_groups", ",", "ctx", ".", "with_bias", ")", "\n", "return", "output", "\n", "\n", "", "@", "staticmethod", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_conv.ModulatedDeformConvPack.init_offset": [[146, 149], ["functions.deform_conv.deform_conv.ModulatedDeformConvPack.conv_offset_mask.weight.data.zero_", "functions.deform_conv.deform_conv.ModulatedDeformConvPack.conv_offset_mask.bias.data.zero_"], "methods", ["None"], ["def", "backward", "(", "ctx", ",", "grad_output", ")", ":", "\n", "        ", "if", "not", "grad_output", ".", "is_cuda", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "", "input", ",", "offset", ",", "mask", ",", "weight", ",", "bias", "=", "ctx", ".", "saved_tensors", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_conv.ModulatedDeformConvPack.forward": [[150, 158], ["functions.deform_conv.deform_conv.ModulatedDeformConvPack.conv_offset_mask", "torch.chunk", "torch.chunk", "torch.chunk", "torch.chunk", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.sigmoid", "torch.sigmoid", "torch.sigmoid", "torch.sigmoid", "functions.deform_conv.modulated_deform_conv"], "methods", ["None"], ["grad_input", "=", "torch", ".", "zeros_like", "(", "input", ")", "\n", "grad_offset", "=", "torch", ".", "zeros_like", "(", "offset", ")", "\n", "grad_mask", "=", "torch", ".", "zeros_like", "(", "mask", ")", "\n", "grad_weight", "=", "torch", ".", "zeros_like", "(", "weight", ")", "\n", "grad_bias", "=", "torch", ".", "zeros_like", "(", "bias", ")", "\n", "deform_conv_cuda", ".", "modulated_deform_conv_cuda_backward", "(", "\n", "input", ",", "weight", ",", "bias", ",", "ctx", ".", "_bufs", "[", "0", "]", ",", "offset", ",", "mask", ",", "ctx", ".", "_bufs", "[", "1", "]", ",", "\n", "grad_input", ",", "grad_weight", ",", "grad_bias", ",", "grad_offset", ",", "grad_mask", ",", "\n", "grad_output", ",", "weight", ".", "shape", "[", "2", "]", ",", "weight", ".", "shape", "[", "3", "]", ",", "ctx", ".", "stride", ",", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_pool.DeformRoIPooling.__init__": [[8, 26], ["torch.nn.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["\n", "    ", "@", "staticmethod", "\n", "def", "forward", "(", "ctx", ",", "\n", "data", ",", "\n", "rois", ",", "\n", "offset", ",", "\n", "spatial_scale", ",", "\n", "out_size", ",", "\n", "out_channels", ",", "\n", "no_trans", ",", "\n", "group_size", "=", "1", ",", "\n", "part_size", "=", "None", ",", "\n", "sample_per_part", "=", "4", ",", "\n", "trans_std", "=", ".0", ")", ":", "\n", "        ", "ctx", ".", "spatial_scale", "=", "spatial_scale", "\n", "ctx", ".", "out_size", "=", "out_size", "\n", "ctx", ".", "out_channels", "=", "out_channels", "\n", "ctx", ".", "no_trans", "=", "no_trans", "\n", "ctx", ".", "group_size", "=", "group_size", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_pool.DeformRoIPooling.forward": [[27, 34], ["functions.deform_pool.deform_roi_pooling", "data.new_empty"], "methods", ["None"], ["ctx", ".", "part_size", "=", "out_size", "if", "part_size", "is", "None", "else", "part_size", "\n", "ctx", ".", "sample_per_part", "=", "sample_per_part", "\n", "ctx", ".", "trans_std", "=", "trans_std", "\n", "\n", "assert", "0.0", "<=", "ctx", ".", "trans_std", "<=", "1.0", "\n", "if", "not", "data", ".", "is_cuda", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_pool.DeformRoIPoolingPack.__init__": [[38, 71], ["deform_pool.DeformRoIPooling.__init__", "range", "torch.nn.Sequential", "deform_pool.DeformRoIPoolingPack.offset_fc[].weight.data.zero_", "deform_pool.DeformRoIPoolingPack.offset_fc[].bias.data.zero_", "seq.append", "torch.nn.Linear", "seq.append", "torch.nn.ReLU"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["deform_pool_cuda", ".", "deform_psroi_pooling_cuda_forward", "(", "\n", "data", ",", "rois", ",", "offset", ",", "output", ",", "output_count", ",", "ctx", ".", "no_trans", ",", "\n", "ctx", ".", "spatial_scale", ",", "ctx", ".", "out_channels", ",", "ctx", ".", "group_size", ",", "ctx", ".", "out_size", ",", "\n", "ctx", ".", "part_size", ",", "ctx", ".", "sample_per_part", ",", "ctx", ".", "trans_std", ")", "\n", "\n", "if", "data", ".", "requires_grad", "or", "rois", ".", "requires_grad", "or", "offset", ".", "requires_grad", ":", "\n", "            ", "ctx", ".", "save_for_backward", "(", "data", ",", "rois", ",", "offset", ")", "\n", "", "ctx", ".", "output_count", "=", "output_count", "\n", "\n", "return", "output", "\n", "\n", "", "@", "staticmethod", "\n", "def", "backward", "(", "ctx", ",", "grad_output", ")", ":", "\n", "        ", "if", "not", "grad_output", ".", "is_cuda", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "\n", "", "data", ",", "rois", ",", "offset", "=", "ctx", ".", "saved_tensors", "\n", "output_count", "=", "ctx", ".", "output_count", "\n", "grad_input", "=", "torch", ".", "zeros_like", "(", "data", ")", "\n", "grad_rois", "=", "None", "\n", "grad_offset", "=", "torch", ".", "zeros_like", "(", "offset", ")", "\n", "\n", "deform_pool_cuda", ".", "deform_psroi_pooling_cuda_backward", "(", "\n", "grad_output", ",", "data", ",", "rois", ",", "offset", ",", "output_count", ",", "grad_input", ",", "\n", "grad_offset", ",", "ctx", ".", "no_trans", ",", "ctx", ".", "spatial_scale", ",", "ctx", ".", "out_channels", ",", "\n", "ctx", ".", "group_size", ",", "ctx", ".", "out_size", ",", "ctx", ".", "part_size", ",", "ctx", ".", "sample_per_part", ",", "\n", "ctx", ".", "trans_std", ")", "\n", "return", "(", "grad_input", ",", "grad_rois", ",", "grad_offset", ",", "None", ",", "None", ",", "None", ",", "None", ",", "\n", "None", ",", "None", ",", "None", ",", "None", ")", "\n", "\n", "\n", "", "", "deform_roi_pooling", "=", "DeformRoIPoolingFunction", ".", "apply", "\n", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_pool.DeformRoIPoolingPack.forward": [[72, 93], ["data.size", "data.new_empty", "functions.deform_pool.deform_roi_pooling", "data.new_empty", "functions.deform_pool.deform_roi_pooling", "deform_pool.DeformRoIPoolingPack.offset_fc", "offset.view.view.view", "functions.deform_pool.deform_roi_pooling", "functions.deform_pool.deform_roi_pooling.view"], "methods", ["None"], []], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_pool.ModulatedDeformRoIPoolingPack.__init__": [[97, 149], ["deform_pool.DeformRoIPooling.__init__", "range", "torch.nn.Sequential", "deform_pool.ModulatedDeformRoIPoolingPack.offset_fc[].weight.data.zero_", "deform_pool.ModulatedDeformRoIPoolingPack.offset_fc[].bias.data.zero_", "range", "torch.nn.Sequential", "deform_pool.ModulatedDeformRoIPoolingPack.mask_fc[].weight.data.zero_", "deform_pool.ModulatedDeformRoIPoolingPack.mask_fc[].bias.data.zero_", "offset_fc_seq.append", "mask_fc_seq.append", "torch.nn.Linear", "offset_fc_seq.append", "torch.nn.Linear", "mask_fc_seq.append", "mask_fc_seq.append", "torch.nn.ReLU", "torch.nn.ReLU", "torch.nn.Sigmoid"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], []], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.deform_pool.ModulatedDeformRoIPoolingPack.forward": [[150, 173], ["data.size", "data.new_empty", "functions.deform_pool.deform_roi_pooling", "data.new_empty", "functions.deform_pool.deform_roi_pooling", "deform_pool.ModulatedDeformRoIPoolingPack.offset_fc", "offset.view.view.view", "deform_pool.ModulatedDeformRoIPoolingPack.mask_fc", "mask.view.view.view", "functions.deform_pool.deform_roi_pooling.view", "functions.deform_pool.deform_roi_pooling.view", "functions.deform_pool.deform_roi_pooling"], "methods", ["None"], []], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.sigmoid_focal_loss.SigmoidFocalLoss.__init__": [[8, 12], ["torch.nn.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["class", "SigmoidFocalLossFunction", "(", "Function", ")", ":", "\n", "\n", "    ", "@", "staticmethod", "\n", "def", "forward", "(", "ctx", ",", "input", ",", "target", ",", "gamma", "=", "2.0", ",", "alpha", "=", "0.25", ",", "reduction", "=", "'mean'", ")", ":", "\n", "        ", "ctx", ".", "save_for_backward", "(", "input", ",", "target", ")", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.sigmoid_focal_loss.SigmoidFocalLoss.forward": [[13, 17], ["functions.sigmoid_focal_loss.sigmoid_focal_loss", "functions.sigmoid_focal_loss.sigmoid_focal_loss.sum"], "methods", ["None"], ["num_classes", "=", "input", ".", "shape", "[", "1", "]", "\n", "ctx", ".", "num_classes", "=", "num_classes", "\n", "ctx", ".", "gamma", "=", "gamma", "\n", "ctx", ".", "alpha", "=", "alpha", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.sigmoid_focal_loss.SigmoidFocalLoss.__repr__": [[18, 24], ["str", "str"], "methods", ["None"], ["loss", "=", "sigmoid_focal_loss_cuda", ".", "forward", "(", "input", ",", "target", ",", "num_classes", ",", "\n", "gamma", ",", "alpha", ")", "\n", "reduction_enum", "=", "F", ".", "_Reduction", ".", "get_enum", "(", "reduction", ")", "\n", "# none: 0, mean:1, sum: 2", "\n", "if", "reduction_enum", "==", "0", ":", "\n", "            ", "return", "loss", "\n", "", "elif", "reduction_enum", "==", "1", ":", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.roi_align.RoIAlign.__init__": [[7, 13], ["torch.nn.modules.module.Module.__init__", "float", "int"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["\n", "    ", "@", "staticmethod", "\n", "def", "forward", "(", "ctx", ",", "features", ",", "rois", ",", "out_size", ",", "spatial_scale", ",", "sample_num", "=", "0", ")", ":", "\n", "        ", "if", "isinstance", "(", "out_size", ",", "int", ")", ":", "\n", "            ", "out_h", "=", "out_size", "\n", "out_w", "=", "out_size", "\n", "", "elif", "isinstance", "(", "out_size", ",", "tuple", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.modules.roi_align.RoIAlign.forward": [[14, 17], ["functions.roi_align.RoIAlignFunction.apply"], "methods", ["None"], ["            ", "assert", "len", "(", "out_size", ")", "==", "2", "\n", "assert", "isinstance", "(", "out_size", "[", "0", "]", ",", "int", ")", "\n", "assert", "isinstance", "(", "out_size", "[", "1", "]", ",", "int", ")", "\n", "out_h", ",", "out_w", "=", "out_size", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.nms.setup.custom_build_ext.build_extensions": [[62, 65], ["setup.customize_compiler_for_nvcc", "Cython.Distutils.build_ext.build_extensions"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.nms.setup.customize_compiler_for_nvcc", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.nms.setup.custom_build_ext.build_extensions"], ["\n", "", "def", "write_version_py", "(", ")", ":", "\n", "    ", "content", "="]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.nms.setup.customize_compiler_for_nvcc": [[23, 58], ["setup..src_extensions.append", "setup..set_executable", "os.splitext"], "function", ["None"], ["\n", "    ", "def", "_minimal_ext_cmd", "(", "cmd", ")", ":", "\n", "# construct minimal environment", "\n", "        ", "env", "=", "{", "}", "\n", "for", "k", "in", "[", "'SYSTEMROOT'", ",", "'PATH'", ",", "'HOME'", "]", ":", "\n", "            ", "v", "=", "os", ".", "environ", ".", "get", "(", "k", ")", "\n", "if", "v", "is", "not", "None", ":", "\n", "                ", "env", "[", "k", "]", "=", "v", "\n", "# LANGUAGE is used on win32", "\n", "", "", "env", "[", "'LANGUAGE'", "]", "=", "'C'", "\n", "env", "[", "'LANG'", "]", "=", "'C'", "\n", "env", "[", "'LC_ALL'", "]", "=", "'C'", "\n", "out", "=", "subprocess", ".", "Popen", "(", "\n", "cmd", ",", "stdout", "=", "subprocess", ".", "PIPE", ",", "env", "=", "env", ")", ".", "communicate", "(", ")", "[", "0", "]", "\n", "return", "out", "\n", "\n", "", "try", ":", "\n", "        ", "out", "=", "_minimal_ext_cmd", "(", "[", "'git'", ",", "'rev-parse'", ",", "'HEAD'", "]", ")", "\n", "sha", "=", "out", ".", "strip", "(", ")", ".", "decode", "(", "'ascii'", ")", "\n", "", "except", "OSError", ":", "\n", "        ", "sha", "=", "'unknown'", "\n", "\n", "", "return", "sha", "\n", "\n", "\n", "", "def", "get_hash", "(", ")", ":", "\n", "    ", "if", "os", ".", "path", ".", "exists", "(", "'.git'", ")", ":", "\n", "        ", "sha", "=", "get_git_hash", "(", ")", "[", ":", "7", "]", "\n", "", "elif", "os", ".", "path", ".", "exists", "(", "version_file", ")", ":", "\n", "        ", "try", ":", "\n", "            ", "from", "mmdet", ".", "version", "import", "__version__", "\n", "sha", "=", "__version__", ".", "split", "(", "'+'", ")", "[", "-", "1", "]", "\n", "", "except", "ImportError", ":", "\n", "            ", "raise", "ImportError", "(", "'Unable to get git version'", ")", "\n", "", "", "else", ":", "\n", "        ", "sha", "=", "'unknown'", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.nms.nms_wrapper.nms": [[8, 50], ["isinstance", "isinstance", "torch.from_numpy().to.new_zeros", "nms_cpu.nms.cpu().numpy", "torch.from_numpy().to", "TypeError", "nms_cuda.nms", "nms_cpu.nms", "nms_cpu.nms.cpu", "torch.from_numpy", "type"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.nms.nms_wrapper.nms", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.nms.nms_wrapper.nms"], ["def", "nms", "(", "dets", ",", "iou_thr", ",", "device_id", "=", "None", ")", ":", "\n", "    ", "\"\"\"Dispatch to either CPU or GPU NMS implementations.\n\n    The input can be either a torch tensor or numpy array. GPU NMS will be used\n    if the input is a gpu tensor or device_id is specified, otherwise CPU NMS\n    will be used. The returned type will always be the same as inputs.\n\n    Arguments:\n        dets (torch.Tensor or np.ndarray): bboxes with scores.\n        iou_thr (float): IoU threshold for NMS.\n        device_id (int, optional): when `dets` is a numpy array, if `device_id`\n            is None, then cpu nms is used, otherwise gpu_nms will be used.\n\n    Returns:\n        tuple: kept bboxes and indice, which is always the same data type as\n            the input.\n    \"\"\"", "\n", "# convert dets (tensor or numpy array) to tensor", "\n", "if", "isinstance", "(", "dets", ",", "torch", ".", "Tensor", ")", ":", "\n", "        ", "is_numpy", "=", "False", "\n", "dets_th", "=", "dets", "\n", "", "elif", "isinstance", "(", "dets", ",", "np", ".", "ndarray", ")", ":", "\n", "        ", "is_numpy", "=", "True", "\n", "device", "=", "'cpu'", "if", "device_id", "is", "None", "else", "'cuda:{}'", ".", "format", "(", "device_id", ")", "\n", "dets_th", "=", "torch", ".", "from_numpy", "(", "dets", ")", ".", "to", "(", "device", ")", "\n", "", "else", ":", "\n", "        ", "raise", "TypeError", "(", "\n", "'dets must be either a Tensor or numpy array, but got {}'", ".", "format", "(", "\n", "type", "(", "dets", ")", ")", ")", "\n", "\n", "# execute cpu or cuda nms", "\n", "", "if", "dets_th", ".", "shape", "[", "0", "]", "==", "0", ":", "\n", "        ", "inds", "=", "dets_th", ".", "new_zeros", "(", "0", ",", "dtype", "=", "torch", ".", "long", ")", "\n", "", "else", ":", "\n", "        ", "if", "dets_th", ".", "is_cuda", ":", "\n", "            ", "inds", "=", "nms_cuda", ".", "nms", "(", "dets_th", ",", "iou_thr", ")", "\n", "", "else", ":", "\n", "            ", "inds", "=", "nms_cpu", ".", "nms", "(", "dets_th", ",", "iou_thr", ")", "\n", "\n", "", "", "if", "is_numpy", ":", "\n", "        ", "inds", "=", "inds", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "", "return", "dets", "[", "inds", ",", ":", "]", ",", "inds", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.nms.nms_wrapper.soft_nms": [[52, 79], ["isinstance", "soft_nms_cpu.soft_nms_cpu", "dets.detach().cpu().numpy", "isinstance", "ValueError", "TypeError", "dets.new_tensor", "dets.new_tensor", "new_dets.astype", "inds.astype", "dets.detach().cpu", "type", "dets.detach"], "function", ["None"], ["", "def", "soft_nms", "(", "dets", ",", "iou_thr", ",", "method", "=", "'linear'", ",", "sigma", "=", "0.5", ",", "min_score", "=", "1e-3", ")", ":", "\n", "    ", "if", "isinstance", "(", "dets", ",", "torch", ".", "Tensor", ")", ":", "\n", "        ", "is_tensor", "=", "True", "\n", "dets_np", "=", "dets", ".", "detach", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "", "elif", "isinstance", "(", "dets", ",", "np", ".", "ndarray", ")", ":", "\n", "        ", "is_tensor", "=", "False", "\n", "dets_np", "=", "dets", "\n", "", "else", ":", "\n", "        ", "raise", "TypeError", "(", "\n", "'dets must be either a Tensor or numpy array, but got {}'", ".", "format", "(", "\n", "type", "(", "dets", ")", ")", ")", "\n", "\n", "", "method_codes", "=", "{", "'linear'", ":", "1", ",", "'gaussian'", ":", "2", "}", "\n", "if", "method", "not", "in", "method_codes", ":", "\n", "        ", "raise", "ValueError", "(", "'Invalid method for SoftNMS: {}'", ".", "format", "(", "method", ")", ")", "\n", "", "new_dets", ",", "inds", "=", "soft_nms_cpu", "(", "\n", "dets_np", ",", "\n", "iou_thr", ",", "\n", "method", "=", "method_codes", "[", "method", "]", ",", "\n", "sigma", "=", "sigma", ",", "\n", "min_score", "=", "min_score", ")", "\n", "\n", "if", "is_tensor", ":", "\n", "        ", "return", "dets", ".", "new_tensor", "(", "new_dets", ")", ",", "dets", ".", "new_tensor", "(", "\n", "inds", ",", "dtype", "=", "torch", ".", "long", ")", "\n", "", "else", ":", "\n", "        ", "return", "new_dets", ".", "astype", "(", "np", ".", "float32", ")", ",", "inds", ".", "astype", "(", "np", ".", "int64", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.gcb.context_block.ContextBlock.__init__": [[15, 53], ["torch.nn.Module.__init__", "isinstance", "all", "int", "context_block.ContextBlock.reset_parameters", "len", "torch.nn.Conv2d", "torch.nn.Softmax", "torch.nn.AdaptiveAvgPool2d", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Conv2d", "torch.nn.LayerNorm", "torch.nn.ReLU", "torch.nn.Conv2d", "torch.nn.Conv2d", "torch.nn.LayerNorm", "torch.nn.ReLU", "torch.nn.Conv2d"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.gcb.context_block.ContextBlock.reset_parameters"], ["    ", "def", "__init__", "(", "self", ",", "\n", "inplanes", ",", "\n", "ratio", ",", "\n", "pooling_type", "=", "'att'", ",", "\n", "fusion_types", "=", "(", "'channel_add'", ",", ")", ")", ":", "\n", "        ", "super", "(", "ContextBlock", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "pooling_type", "in", "[", "'avg'", ",", "'att'", "]", "\n", "assert", "isinstance", "(", "fusion_types", ",", "(", "list", ",", "tuple", ")", ")", "\n", "valid_fusion_types", "=", "[", "'channel_add'", ",", "'channel_mul'", "]", "\n", "assert", "all", "(", "[", "f", "in", "valid_fusion_types", "for", "f", "in", "fusion_types", "]", ")", "\n", "assert", "len", "(", "fusion_types", ")", ">", "0", ",", "'at least one fusion should be used'", "\n", "self", ".", "inplanes", "=", "inplanes", "\n", "self", ".", "ratio", "=", "ratio", "\n", "self", ".", "planes", "=", "int", "(", "inplanes", "*", "ratio", ")", "\n", "self", ".", "pooling_type", "=", "pooling_type", "\n", "self", ".", "fusion_types", "=", "fusion_types", "\n", "if", "pooling_type", "==", "'att'", ":", "\n", "            ", "self", ".", "conv_mask", "=", "nn", ".", "Conv2d", "(", "inplanes", ",", "1", ",", "kernel_size", "=", "1", ")", "\n", "self", ".", "softmax", "=", "nn", ".", "Softmax", "(", "dim", "=", "2", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "avg_pool", "=", "nn", ".", "AdaptiveAvgPool2d", "(", "1", ")", "\n", "", "if", "'channel_add'", "in", "fusion_types", ":", "\n", "            ", "self", ".", "channel_add_conv", "=", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Conv2d", "(", "self", ".", "inplanes", ",", "self", ".", "planes", ",", "kernel_size", "=", "1", ")", ",", "\n", "nn", ".", "LayerNorm", "(", "[", "self", ".", "planes", ",", "1", ",", "1", "]", ")", ",", "\n", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", ",", "# yapf: disable", "\n", "nn", ".", "Conv2d", "(", "self", ".", "planes", ",", "self", ".", "inplanes", ",", "kernel_size", "=", "1", ")", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "channel_add_conv", "=", "None", "\n", "", "if", "'channel_mul'", "in", "fusion_types", ":", "\n", "            ", "self", ".", "channel_mul_conv", "=", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Conv2d", "(", "self", ".", "inplanes", ",", "self", ".", "planes", ",", "kernel_size", "=", "1", ")", ",", "\n", "nn", ".", "LayerNorm", "(", "[", "self", ".", "planes", ",", "1", ",", "1", "]", ")", ",", "\n", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", ",", "# yapf: disable", "\n", "nn", ".", "Conv2d", "(", "self", ".", "planes", ",", "self", ".", "inplanes", ",", "kernel_size", "=", "1", ")", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "channel_mul_conv", "=", "None", "\n", "", "self", ".", "reset_parameters", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.gcb.context_block.ContextBlock.reset_parameters": [[54, 63], ["mmcv.cnn.kaiming_init", "context_block.last_zero_init", "context_block.last_zero_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.kaiming_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.gcb.context_block.last_zero_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.gcb.context_block.last_zero_init"], ["", "def", "reset_parameters", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "pooling_type", "==", "'att'", ":", "\n", "            ", "kaiming_init", "(", "self", ".", "conv_mask", ",", "mode", "=", "'fan_in'", ")", "\n", "self", ".", "conv_mask", ".", "inited", "=", "True", "\n", "\n", "", "if", "self", ".", "channel_add_conv", "is", "not", "None", ":", "\n", "            ", "last_zero_init", "(", "self", ".", "channel_add_conv", ")", "\n", "", "if", "self", ".", "channel_mul_conv", "is", "not", "None", ":", "\n", "            ", "last_zero_init", "(", "self", ".", "channel_mul_conv", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.gcb.context_block.ContextBlock.spatial_pool": [[64, 89], ["x.size", "input_x.unsqueeze.unsqueeze.view", "input_x.unsqueeze.unsqueeze.unsqueeze", "context_block.ContextBlock.conv_mask", "context_mask.unsqueeze.unsqueeze.view", "context_block.ContextBlock.softmax", "context_mask.unsqueeze.unsqueeze.unsqueeze", "torch.matmul", "context_block.ContextBlock.view", "context_block.ContextBlock.avg_pool"], "methods", ["None"], ["", "", "def", "spatial_pool", "(", "self", ",", "x", ")", ":", "\n", "        ", "batch", ",", "channel", ",", "height", ",", "width", "=", "x", ".", "size", "(", ")", "\n", "if", "self", ".", "pooling_type", "==", "'att'", ":", "\n", "            ", "input_x", "=", "x", "\n", "# [N, C, H * W]", "\n", "input_x", "=", "input_x", ".", "view", "(", "batch", ",", "channel", ",", "height", "*", "width", ")", "\n", "# [N, 1, C, H * W]", "\n", "input_x", "=", "input_x", ".", "unsqueeze", "(", "1", ")", "\n", "# [N, 1, H, W]", "\n", "context_mask", "=", "self", ".", "conv_mask", "(", "x", ")", "\n", "# [N, 1, H * W]", "\n", "context_mask", "=", "context_mask", ".", "view", "(", "batch", ",", "1", ",", "height", "*", "width", ")", "\n", "# [N, 1, H * W]", "\n", "context_mask", "=", "self", ".", "softmax", "(", "context_mask", ")", "\n", "# [N, 1, H * W, 1]", "\n", "context_mask", "=", "context_mask", ".", "unsqueeze", "(", "-", "1", ")", "\n", "# [N, 1, C, 1]", "\n", "context", "=", "torch", ".", "matmul", "(", "input_x", ",", "context_mask", ")", "\n", "# [N, C, 1, 1]", "\n", "context", "=", "context", ".", "view", "(", "batch", ",", "channel", ",", "1", ",", "1", ")", "\n", "", "else", ":", "\n", "# [N, C, 1, 1]", "\n", "            ", "context", "=", "self", ".", "avg_pool", "(", "x", ")", "\n", "\n", "", "return", "context", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.gcb.context_block.ContextBlock.forward": [[90, 105], ["context_block.ContextBlock.spatial_pool", "torch.sigmoid", "context_block.ContextBlock.channel_add_conv", "context_block.ContextBlock.channel_mul_conv"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.gcb.context_block.ContextBlock.spatial_pool"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "# [N, C, 1, 1]", "\n", "        ", "context", "=", "self", ".", "spatial_pool", "(", "x", ")", "\n", "\n", "out", "=", "x", "\n", "if", "self", ".", "channel_mul_conv", "is", "not", "None", ":", "\n", "# [N, C, 1, 1]", "\n", "            ", "channel_mul_term", "=", "torch", ".", "sigmoid", "(", "self", ".", "channel_mul_conv", "(", "context", ")", ")", "\n", "out", "=", "out", "*", "channel_mul_term", "\n", "", "if", "self", ".", "channel_add_conv", "is", "not", "None", ":", "\n", "# [N, C, 1, 1]", "\n", "            ", "channel_add_term", "=", "self", ".", "channel_add_conv", "(", "context", ")", "\n", "out", "=", "out", "+", "channel_add_term", "\n", "\n", "", "return", "out", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.gcb.context_block.last_zero_init": [[6, 11], ["isinstance", "mmcv.cnn.constant_init", "mmcv.cnn.constant_init"], "function", ["None"], ["def", "last_zero_init", "(", "m", ")", ":", "\n", "    ", "if", "isinstance", "(", "m", ",", "nn", ".", "Sequential", ")", ":", "\n", "        ", "constant_init", "(", "m", "[", "-", "1", "]", ",", "val", "=", "0", ")", "\n", "", "else", ":", "\n", "        ", "constant_init", "(", "m", ",", "val", "=", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.registry.Registry.__init__": [[6, 9], ["dict"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "name", ")", ":", "\n", "        ", "self", ".", "_name", "=", "name", "\n", "self", ".", "_module_dict", "=", "dict", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.registry.Registry.name": [[10, 13], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "name", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_name", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.registry.Registry.module_dict": [[14, 17], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "module_dict", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_module_dict", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.registry.Registry._register_module": [[18, 33], ["issubclass", "TypeError", "KeyError"], "methods", ["None"], ["", "def", "_register_module", "(", "self", ",", "module_class", ")", ":", "\n", "        ", "\"\"\"Register a module.\n\n        Args:\n            module (:obj:`nn.Module`): Module to be registered.\n        \"\"\"", "\n", "if", "not", "issubclass", "(", "module_class", ",", "nn", ".", "Module", ")", ":", "\n", "            ", "raise", "TypeError", "(", "\n", "'module must be a child of nn.Module, but got {}'", ".", "format", "(", "\n", "module_class", ")", ")", "\n", "", "module_name", "=", "module_class", ".", "__name__", "\n", "if", "module_name", "in", "self", ".", "_module_dict", ":", "\n", "            ", "raise", "KeyError", "(", "'{} is already registered in {}'", ".", "format", "(", "\n", "module_name", ",", "self", ".", "name", ")", ")", "\n", "", "self", ".", "_module_dict", "[", "module_name", "]", "=", "module_class", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.registry.Registry.register_module": [[34, 37], ["registry.Registry._register_module"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.registry.Registry._register_module"], ["", "def", "register_module", "(", "self", ",", "cls", ")", ":", "\n", "        ", "self", ".", "_register_module", "(", "cls", ")", "\n", "return", "cls", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder._build_module": [[8, 25], ["cfg.copy", "cfg.copy.pop", "mmcv.is_str", "args.pop.", "isinstance", "isinstance", "default_args.items", "KeyError", "isinstance", "TypeError", "cfg.copy.setdefault", "type"], "function", ["None"], ["def", "_build_module", "(", "cfg", ",", "registry", ",", "default_args", ")", ":", "\n", "    ", "assert", "isinstance", "(", "cfg", ",", "dict", ")", "and", "'type'", "in", "cfg", "\n", "assert", "isinstance", "(", "default_args", ",", "dict", ")", "or", "default_args", "is", "None", "\n", "args", "=", "cfg", ".", "copy", "(", ")", "\n", "obj_type", "=", "args", ".", "pop", "(", "'type'", ")", "\n", "if", "mmcv", ".", "is_str", "(", "obj_type", ")", ":", "\n", "        ", "if", "obj_type", "not", "in", "registry", ".", "module_dict", ":", "\n", "            ", "raise", "KeyError", "(", "'{} is not in the {} registry'", ".", "format", "(", "\n", "obj_type", ",", "registry", ".", "name", ")", ")", "\n", "", "obj_type", "=", "registry", ".", "module_dict", "[", "obj_type", "]", "\n", "", "elif", "not", "isinstance", "(", "obj_type", ",", "type", ")", ":", "\n", "        ", "raise", "TypeError", "(", "'type must be a str or valid type, but got {}'", ".", "format", "(", "\n", "type", "(", "obj_type", ")", ")", ")", "\n", "", "if", "default_args", "is", "not", "None", ":", "\n", "        ", "for", "name", ",", "value", "in", "default_args", ".", "items", "(", ")", ":", "\n", "            ", "args", ".", "setdefault", "(", "name", ",", "value", ")", "\n", "", "", "return", "obj_type", "(", "**", "args", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build": [[27, 33], ["isinstance", "torch.nn.Sequential", "builder._build_module", "builder._build_module", "registry.BACKBONES", "registry.NECKS", "registry.ROI_EXTRACTORS", "registry.SHARED_HEADS", "registry.HEADS", "registry.LOSSES", "registry.DETECTORS"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder._build_module", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder._build_module"], ["", "def", "build", "(", "cfg", ",", "registry", ",", "default_args", "=", "None", ")", ":", "\n", "    ", "if", "isinstance", "(", "cfg", ",", "list", ")", ":", "\n", "        ", "modules", "=", "[", "_build_module", "(", "cfg_", ",", "registry", ",", "default_args", ")", "for", "cfg_", "in", "cfg", "]", "\n", "return", "nn", ".", "Sequential", "(", "*", "modules", ")", "\n", "", "else", ":", "\n", "        ", "return", "_build_module", "(", "cfg", ",", "registry", ",", "default_args", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_backbone": [[35, 37], ["builder.build"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build"], ["", "", "def", "build_backbone", "(", "cfg", ")", ":", "\n", "    ", "return", "build", "(", "cfg", ",", "BACKBONES", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_neck": [[39, 41], ["builder.build"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build"], ["", "def", "build_neck", "(", "cfg", ")", ":", "\n", "    ", "return", "build", "(", "cfg", ",", "NECKS", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_roi_extractor": [[43, 45], ["builder.build"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build"], ["", "def", "build_roi_extractor", "(", "cfg", ")", ":", "\n", "    ", "return", "build", "(", "cfg", ",", "ROI_EXTRACTORS", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_shared_head": [[47, 49], ["builder.build"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build"], ["", "def", "build_shared_head", "(", "cfg", ")", ":", "\n", "    ", "return", "build", "(", "cfg", ",", "SHARED_HEADS", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_head": [[51, 53], ["builder.build"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build"], ["", "def", "build_head", "(", "cfg", ")", ":", "\n", "    ", "return", "build", "(", "cfg", ",", "HEADS", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_loss": [[55, 57], ["builder.build"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build"], ["", "def", "build_loss", "(", "cfg", ")", ":", "\n", "    ", "return", "build", "(", "cfg", ",", "LOSSES", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_detector": [[59, 61], ["builder.build", "dict"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build"], ["", "def", "build_detector", "(", "cfg", ",", "train_cfg", "=", "None", ",", "test_cfg", "=", "None", ")", ":", "\n", "    ", "return", "build", "(", "cfg", ",", "DETECTORS", ",", "dict", "(", "train_cfg", "=", "train_cfg", ",", "test_cfg", "=", "test_cfg", ")", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer": [[12, 56], ["cfg.copy", "cfg.copy.pop", "isinstance", "cfg.copy.pop", "cfg.copy.setdefault", "norm_layer.parameters", "isinstance", "KeyError", "str", "norm_layer", "norm_layer", "norm_layer._specify_ddp_gpu_num"], "function", ["None"], ["def", "build_norm_layer", "(", "cfg", ",", "num_features", ",", "postfix", "=", "''", ")", ":", "\n", "    ", "\"\"\" Build normalization layer\n\n    Args:\n        cfg (dict): cfg should contain:\n            type (str): identify norm layer type.\n            layer args: args needed to instantiate a norm layer.\n            requires_grad (bool): [optional] whether stop gradient updates\n        num_features (int): number of channels from input.\n        postfix (int, str): appended into norm abbreviation to\n            create named layer.\n\n    Returns:\n        name (str): abbreviation + postfix\n        layer (nn.Module): created norm layer\n    \"\"\"", "\n", "assert", "isinstance", "(", "cfg", ",", "dict", ")", "and", "'type'", "in", "cfg", "\n", "cfg_", "=", "cfg", ".", "copy", "(", ")", "\n", "\n", "layer_type", "=", "cfg_", ".", "pop", "(", "'type'", ")", "\n", "if", "layer_type", "not", "in", "norm_cfg", ":", "\n", "        ", "raise", "KeyError", "(", "'Unrecognized norm type {}'", ".", "format", "(", "layer_type", ")", ")", "\n", "", "else", ":", "\n", "        ", "abbr", ",", "norm_layer", "=", "norm_cfg", "[", "layer_type", "]", "\n", "if", "norm_layer", "is", "None", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "\n", "", "", "assert", "isinstance", "(", "postfix", ",", "(", "int", ",", "str", ")", ")", "\n", "name", "=", "abbr", "+", "str", "(", "postfix", ")", "\n", "\n", "requires_grad", "=", "cfg_", ".", "pop", "(", "'requires_grad'", ",", "True", ")", "\n", "cfg_", ".", "setdefault", "(", "'eps'", ",", "1e-5", ")", "\n", "if", "layer_type", "!=", "'GN'", ":", "\n", "        ", "layer", "=", "norm_layer", "(", "num_features", ",", "**", "cfg_", ")", "\n", "if", "layer_type", "==", "'SyncBN'", ":", "\n", "            ", "layer", ".", "_specify_ddp_gpu_num", "(", "1", ")", "\n", "", "", "else", ":", "\n", "        ", "assert", "'num_groups'", "in", "cfg_", "\n", "layer", "=", "norm_layer", "(", "num_channels", "=", "num_features", ",", "**", "cfg_", ")", "\n", "\n", "", "for", "param", "in", "layer", ".", "parameters", "(", ")", ":", "\n", "        ", "param", ".", "requires_grad", "=", "requires_grad", "\n", "\n", "", "return", "name", ",", "layer", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.scale.Scale.__init__": [[7, 10], ["torch.Module.__init__", "torch.Parameter", "torch.Parameter", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "scale", "=", "1.0", ")", ":", "\n", "        ", "super", "(", "Scale", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "scale", "=", "nn", ".", "Parameter", "(", "torch", ".", "tensor", "(", "scale", ",", "dtype", "=", "torch", ".", "float", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.scale.Scale.forward": [[11, 13], ["None"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "x", "*", "self", ".", "scale", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.ConvModule.__init__": [[67, 138], ["torch.Module.__init__", "conv_module.build_conv_layer", "conv_module.ConvModule.init_weights", "isinstance", "isinstance", "warnings.warn", "norm.build_norm_layer", "conv_module.ConvModule.add_module", "ValueError", "torch.ReLU"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer"], ["def", "__init__", "(", "self", ",", "\n", "in_channels", ",", "\n", "out_channels", ",", "\n", "kernel_size", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "0", ",", "\n", "dilation", "=", "1", ",", "\n", "groups", "=", "1", ",", "\n", "bias", "=", "'auto'", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "None", ",", "\n", "activation", "=", "'relu'", ",", "\n", "inplace", "=", "True", ",", "\n", "activate_last", "=", "True", ")", ":", "\n", "        ", "super", "(", "ConvModule", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "conv_cfg", "is", "None", "or", "isinstance", "(", "conv_cfg", ",", "dict", ")", "\n", "assert", "norm_cfg", "is", "None", "or", "isinstance", "(", "norm_cfg", ",", "dict", ")", "\n", "self", ".", "conv_cfg", "=", "conv_cfg", "\n", "self", ".", "norm_cfg", "=", "norm_cfg", "\n", "self", ".", "activation", "=", "activation", "\n", "self", ".", "inplace", "=", "inplace", "\n", "self", ".", "activate_last", "=", "activate_last", "\n", "\n", "self", ".", "with_norm", "=", "norm_cfg", "is", "not", "None", "\n", "self", ".", "with_activatation", "=", "activation", "is", "not", "None", "\n", "# if the conv layer is before a norm layer, bias is unnecessary.", "\n", "if", "bias", "==", "'auto'", ":", "\n", "            ", "bias", "=", "False", "if", "self", ".", "with_norm", "else", "True", "\n", "", "self", ".", "with_bias", "=", "bias", "\n", "\n", "if", "self", ".", "with_norm", "and", "self", ".", "with_bias", ":", "\n", "            ", "warnings", ".", "warn", "(", "'ConvModule has norm and bias at the same time'", ")", "\n", "\n", "# build convolution layer", "\n", "", "self", ".", "conv", "=", "build_conv_layer", "(", "\n", "conv_cfg", ",", "\n", "in_channels", ",", "\n", "out_channels", ",", "\n", "kernel_size", ",", "\n", "stride", "=", "stride", ",", "\n", "padding", "=", "padding", ",", "\n", "dilation", "=", "dilation", ",", "\n", "groups", "=", "groups", ",", "\n", "bias", "=", "bias", ")", "\n", "# export the attributes of self.conv to a higher level for convenience", "\n", "self", ".", "in_channels", "=", "self", ".", "conv", ".", "in_channels", "\n", "self", ".", "out_channels", "=", "self", ".", "conv", ".", "out_channels", "\n", "self", ".", "kernel_size", "=", "self", ".", "conv", ".", "kernel_size", "\n", "self", ".", "stride", "=", "self", ".", "conv", ".", "stride", "\n", "self", ".", "padding", "=", "self", ".", "conv", ".", "padding", "\n", "self", ".", "dilation", "=", "self", ".", "conv", ".", "dilation", "\n", "self", ".", "transposed", "=", "self", ".", "conv", ".", "transposed", "\n", "self", ".", "output_padding", "=", "self", ".", "conv", ".", "output_padding", "\n", "self", ".", "groups", "=", "self", ".", "conv", ".", "groups", "\n", "\n", "# build normalization layers", "\n", "if", "self", ".", "with_norm", ":", "\n", "            ", "norm_channels", "=", "out_channels", "if", "self", ".", "activate_last", "else", "in_channels", "\n", "self", ".", "norm_name", ",", "norm", "=", "build_norm_layer", "(", "norm_cfg", ",", "norm_channels", ")", "\n", "self", ".", "add_module", "(", "self", ".", "norm_name", ",", "norm", ")", "\n", "\n", "# build activation layer", "\n", "", "if", "self", ".", "with_activatation", ":", "\n", "            ", "if", "self", ".", "activation", "not", "in", "[", "'relu'", "]", ":", "\n", "                ", "raise", "ValueError", "(", "'{} is currently not supported.'", ".", "format", "(", "\n", "self", ".", "activation", ")", ")", "\n", "", "if", "self", ".", "activation", "==", "'relu'", ":", "\n", "                ", "self", ".", "activate", "=", "nn", ".", "ReLU", "(", "inplace", "=", "inplace", ")", "\n", "\n", "# Use msra init by default", "\n", "", "", "self", ".", "init_weights", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.ConvModule.norm": [[139, 142], ["getattr"], "methods", ["None"], ["", "@", "property", "\n", "def", "norm", "(", "self", ")", ":", "\n", "        ", "return", "getattr", "(", "self", ",", "self", ".", "norm_name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.ConvModule.init_weights": [[143, 148], ["mmcv.cnn.kaiming_init", "mmcv.cnn.constant_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.kaiming_init"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "nonlinearity", "=", "'relu'", "if", "self", ".", "activation", "is", "None", "else", "self", ".", "activation", "\n", "kaiming_init", "(", "self", ".", "conv", ",", "nonlinearity", "=", "nonlinearity", ")", "\n", "if", "self", ".", "with_norm", ":", "\n", "            ", "constant_init", "(", "self", ".", "norm", ",", "1", ",", "bias", "=", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.ConvModule.forward": [[149, 164], ["conv_module.ConvModule.conv", "conv_module.ConvModule.conv", "conv_module.ConvModule.norm", "conv_module.ConvModule.activate", "conv_module.ConvModule.norm", "conv_module.ConvModule.activate"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.ConvModule.norm", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.ConvModule.norm"], ["", "", "def", "forward", "(", "self", ",", "x", ",", "activate", "=", "True", ",", "norm", "=", "True", ")", ":", "\n", "        ", "if", "self", ".", "activate_last", ":", "\n", "            ", "x", "=", "self", ".", "conv", "(", "x", ")", "\n", "if", "norm", "and", "self", ".", "with_norm", ":", "\n", "                ", "x", "=", "self", ".", "norm", "(", "x", ")", "\n", "", "if", "activate", "and", "self", ".", "with_activatation", ":", "\n", "                ", "x", "=", "self", ".", "activate", "(", "x", ")", "\n", "", "", "else", ":", "\n", "# WARN: this may be removed or modified", "\n", "            ", "if", "norm", "and", "self", ".", "with_norm", ":", "\n", "                ", "x", "=", "self", ".", "norm", "(", "x", ")", "\n", "", "if", "activate", "and", "self", ".", "with_activatation", ":", "\n", "                ", "x", "=", "self", ".", "activate", "(", "x", ")", "\n", "", "x", "=", "self", ".", "conv", "(", "x", ")", "\n", "", "return", "x", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer": [[16, 42], ["cfg.copy.pop", "conv_layer", "dict", "cfg.copy", "KeyError", "isinstance"], "function", ["None"], ["def", "build_conv_layer", "(", "cfg", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "    ", "\"\"\" Build convolution layer\n\n    Args:\n        cfg (None or dict): cfg should contain:\n            type (str): identify conv layer type.\n            layer args: args needed to instantiate a conv layer.\n\n    Returns:\n        layer (nn.Module): created conv layer\n    \"\"\"", "\n", "if", "cfg", "is", "None", ":", "\n", "        ", "cfg_", "=", "dict", "(", "type", "=", "'Conv'", ")", "\n", "", "else", ":", "\n", "        ", "assert", "isinstance", "(", "cfg", ",", "dict", ")", "and", "'type'", "in", "cfg", "\n", "cfg_", "=", "cfg", ".", "copy", "(", ")", "\n", "\n", "", "layer_type", "=", "cfg_", ".", "pop", "(", "'type'", ")", "\n", "if", "layer_type", "not", "in", "conv_cfg", ":", "\n", "        ", "raise", "KeyError", "(", "'Unrecognized norm type {}'", ".", "format", "(", "layer_type", ")", ")", "\n", "", "else", ":", "\n", "        ", "conv_layer", "=", "conv_cfg", "[", "layer_type", "]", "\n", "\n", "", "layer", "=", "conv_layer", "(", "*", "args", ",", "**", "kwargs", ",", "**", "cfg_", ")", "\n", "\n", "return", "layer", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.xavier_init": [[5, 13], ["hasattr", "torch.init.xavier_uniform_", "torch.init.xavier_normal_", "torch.init.constant_"], "function", ["None"], ["def", "xavier_init", "(", "module", ",", "gain", "=", "1", ",", "bias", "=", "0", ",", "distribution", "=", "'normal'", ")", ":", "\n", "    ", "assert", "distribution", "in", "[", "'uniform'", ",", "'normal'", "]", "\n", "if", "distribution", "==", "'uniform'", ":", "\n", "        ", "nn", ".", "init", ".", "xavier_uniform_", "(", "module", ".", "weight", ",", "gain", "=", "gain", ")", "\n", "", "else", ":", "\n", "        ", "nn", ".", "init", ".", "xavier_normal_", "(", "module", ".", "weight", ",", "gain", "=", "gain", ")", "\n", "", "if", "hasattr", "(", "module", ",", "'bias'", ")", ":", "\n", "        ", "nn", ".", "init", ".", "constant_", "(", "module", ".", "bias", ",", "bias", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init": [[15, 19], ["torch.init.normal_", "hasattr", "torch.init.constant_"], "function", ["None"], ["", "", "def", "normal_init", "(", "module", ",", "mean", "=", "0", ",", "std", "=", "1", ",", "bias", "=", "0", ")", ":", "\n", "    ", "nn", ".", "init", ".", "normal_", "(", "module", ".", "weight", ",", "mean", ",", "std", ")", "\n", "if", "hasattr", "(", "module", ",", "'bias'", ")", ":", "\n", "        ", "nn", ".", "init", ".", "constant_", "(", "module", ".", "bias", ",", "bias", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.uniform_init": [[21, 25], ["torch.init.uniform_", "hasattr", "torch.init.constant_"], "function", ["None"], ["", "", "def", "uniform_init", "(", "module", ",", "a", "=", "0", ",", "b", "=", "1", ",", "bias", "=", "0", ")", ":", "\n", "    ", "nn", ".", "init", ".", "uniform_", "(", "module", ".", "weight", ",", "a", ",", "b", ")", "\n", "if", "hasattr", "(", "module", ",", "'bias'", ")", ":", "\n", "        ", "nn", ".", "init", ".", "constant_", "(", "module", ".", "bias", ",", "bias", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.kaiming_init": [[27, 41], ["hasattr", "torch.init.kaiming_uniform_", "torch.init.kaiming_normal_", "torch.init.constant_"], "function", ["None"], ["", "", "def", "kaiming_init", "(", "module", ",", "\n", "mode", "=", "'fan_out'", ",", "\n", "nonlinearity", "=", "'relu'", ",", "\n", "bias", "=", "0", ",", "\n", "distribution", "=", "'normal'", ")", ":", "\n", "    ", "assert", "distribution", "in", "[", "'uniform'", ",", "'normal'", "]", "\n", "if", "distribution", "==", "'uniform'", ":", "\n", "        ", "nn", ".", "init", ".", "kaiming_uniform_", "(", "\n", "module", ".", "weight", ",", "mode", "=", "mode", ",", "nonlinearity", "=", "nonlinearity", ")", "\n", "", "else", ":", "\n", "        ", "nn", ".", "init", ".", "kaiming_normal_", "(", "\n", "module", ".", "weight", ",", "mode", "=", "mode", ",", "nonlinearity", "=", "nonlinearity", ")", "\n", "", "if", "hasattr", "(", "module", ",", "'bias'", ")", ":", "\n", "        ", "nn", ".", "init", ".", "constant_", "(", "module", ".", "bias", ",", "bias", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.bias_init_with_prob": [[43, 47], ["float", "numpy.log"], "function", ["None"], ["", "", "def", "bias_init_with_prob", "(", "prior_prob", ")", ":", "\n", "    ", "\"\"\" initialize conv/fc bias value according to giving probablity\"\"\"", "\n", "bias_init", "=", "float", "(", "-", "np", ".", "log", "(", "(", "1", "-", "prior_prob", ")", "/", "prior_prob", ")", ")", "\n", "return", "bias_init", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_ws.ConvWS2d.__init__": [[23, 43], ["torch.Conv2d.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "\n", "in_channels", ",", "\n", "out_channels", ",", "\n", "kernel_size", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "0", ",", "\n", "dilation", "=", "1", ",", "\n", "groups", "=", "1", ",", "\n", "bias", "=", "True", ",", "\n", "eps", "=", "1e-5", ")", ":", "\n", "        ", "super", "(", "ConvWS2d", ",", "self", ")", ".", "__init__", "(", "\n", "in_channels", ",", "\n", "out_channels", ",", "\n", "kernel_size", ",", "\n", "stride", "=", "stride", ",", "\n", "padding", "=", "padding", ",", "\n", "dilation", "=", "dilation", ",", "\n", "groups", "=", "groups", ",", "\n", "bias", "=", "bias", ")", "\n", "self", ".", "eps", "=", "eps", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_ws.ConvWS2d.forward": [[44, 47], ["conv_ws.conv_ws_2d"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_ws.conv_ws_2d"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "conv_ws_2d", "(", "x", ",", "self", ".", "weight", ",", "self", ".", "bias", ",", "self", ".", "stride", ",", "self", ".", "padding", ",", "\n", "self", ".", "dilation", ",", "self", ".", "groups", ",", "self", ".", "eps", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_ws.conv_ws_2d": [[5, 19], ["weight.size", "weight.view", "weight.view.mean().view", "weight.view.std().view", "torch.conv2d", "weight.view.mean", "weight.view.std"], "function", ["None"], ["def", "conv_ws_2d", "(", "input", ",", "\n", "weight", ",", "\n", "bias", "=", "None", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "0", ",", "\n", "dilation", "=", "1", ",", "\n", "groups", "=", "1", ",", "\n", "eps", "=", "1e-5", ")", ":", "\n", "    ", "c_in", "=", "weight", ".", "size", "(", "0", ")", "\n", "weight_flat", "=", "weight", ".", "view", "(", "c_in", ",", "-", "1", ")", "\n", "mean", "=", "weight_flat", ".", "mean", "(", "dim", "=", "1", ",", "keepdim", "=", "True", ")", ".", "view", "(", "c_in", ",", "1", ",", "1", ",", "1", ")", "\n", "std", "=", "weight_flat", ".", "std", "(", "dim", "=", "1", ",", "keepdim", "=", "True", ")", ".", "view", "(", "c_in", ",", "1", ",", "1", ",", "1", ")", "\n", "weight", "=", "(", "weight", "-", "mean", ")", "/", "(", "std", "+", "eps", ")", "\n", "return", "F", ".", "conv2d", "(", "input", ",", "weight", ",", "bias", ",", "stride", ",", "padding", ",", "dilation", ",", "groups", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.dist_utils.DistOptimizerHook.__init__": [[46, 50], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "grad_clip", "=", "None", ",", "coalesce", "=", "True", ",", "bucket_size_mb", "=", "-", "1", ")", ":", "\n", "        ", "self", ".", "grad_clip", "=", "grad_clip", "\n", "self", ".", "coalesce", "=", "coalesce", "\n", "self", ".", "bucket_size_mb", "=", "bucket_size_mb", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.dist_utils.DistOptimizerHook.after_train_iter": [[51, 58], ["runner.optimizer.zero_grad", "runner.outputs[].backward", "dist_utils.allreduce_grads", "runner.optimizer.step", "dist_utils.DistOptimizerHook.clip_grads", "runner.model.parameters"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.functions.roi_align.RoIAlignFunction.backward", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.dist_utils.allreduce_grads"], ["", "def", "after_train_iter", "(", "self", ",", "runner", ")", ":", "\n", "        ", "runner", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "runner", ".", "outputs", "[", "'loss'", "]", ".", "backward", "(", ")", "\n", "allreduce_grads", "(", "runner", ".", "model", ",", "self", ".", "coalesce", ",", "self", ".", "bucket_size_mb", ")", "\n", "if", "self", ".", "grad_clip", "is", "not", "None", ":", "\n", "            ", "self", ".", "clip_grads", "(", "runner", ".", "model", ".", "parameters", "(", ")", ")", "\n", "", "runner", ".", "optimizer", ".", "step", "(", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.dist_utils._allreduce_coalesced": [[9, 29], ["torch._utils._take_tensors", "collections.OrderedDict", "buckets.values.values", "torch._utils._flatten_dense_tensors", "torch.all_reduce", "torch._utils._flatten_dense_tensors.div_", "zip", "tensor.type", "buckets[].append", "torch._utils._unflatten_dense_tensors", "tensor.copy_"], "function", ["None"], ["def", "_allreduce_coalesced", "(", "tensors", ",", "world_size", ",", "bucket_size_mb", "=", "-", "1", ")", ":", "\n", "    ", "if", "bucket_size_mb", ">", "0", ":", "\n", "        ", "bucket_size_bytes", "=", "bucket_size_mb", "*", "1024", "*", "1024", "\n", "buckets", "=", "_take_tensors", "(", "tensors", ",", "bucket_size_bytes", ")", "\n", "", "else", ":", "\n", "        ", "buckets", "=", "OrderedDict", "(", ")", "\n", "for", "tensor", "in", "tensors", ":", "\n", "            ", "tp", "=", "tensor", ".", "type", "(", ")", "\n", "if", "tp", "not", "in", "buckets", ":", "\n", "                ", "buckets", "[", "tp", "]", "=", "[", "]", "\n", "", "buckets", "[", "tp", "]", ".", "append", "(", "tensor", ")", "\n", "", "buckets", "=", "buckets", ".", "values", "(", ")", "\n", "\n", "", "for", "bucket", "in", "buckets", ":", "\n", "        ", "flat_tensors", "=", "_flatten_dense_tensors", "(", "bucket", ")", "\n", "dist", ".", "all_reduce", "(", "flat_tensors", ")", "\n", "flat_tensors", ".", "div_", "(", "world_size", ")", "\n", "for", "tensor", ",", "synced", "in", "zip", "(", "\n", "bucket", ",", "_unflatten_dense_tensors", "(", "flat_tensors", ",", "bucket", ")", ")", ":", "\n", "            ", "tensor", ".", "copy_", "(", "synced", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.dist_utils.allreduce_grads": [[31, 42], ["torch.get_world_size", "dist_utils._allreduce_coalesced", "model.parameters", "torch.all_reduce", "tensor.div_"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.dist_utils._allreduce_coalesced"], ["", "", "", "def", "allreduce_grads", "(", "model", ",", "coalesce", "=", "True", ",", "bucket_size_mb", "=", "-", "1", ")", ":", "\n", "    ", "grads", "=", "[", "\n", "param", ".", "grad", ".", "data", "for", "param", "in", "model", ".", "parameters", "(", ")", "\n", "if", "param", ".", "requires_grad", "and", "param", ".", "grad", "is", "not", "None", "\n", "]", "\n", "world_size", "=", "dist", ".", "get_world_size", "(", ")", "\n", "if", "coalesce", ":", "\n", "        ", "_allreduce_coalesced", "(", "grads", ",", "world_size", ",", "bucket_size_mb", ")", "\n", "", "else", ":", "\n", "        ", "for", "tensor", "in", "grads", ":", "\n", "            ", "dist", ".", "all_reduce", "(", "tensor", ".", "div_", "(", "world_size", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.tensor2imgs": [[8, 19], ["tensor.size", "numpy.array", "numpy.array", "range", "tensor[].cpu().numpy().transpose", "mmcv.imdenormalize().astype", "imgs.append", "numpy.ascontiguousarray", "tensor[].cpu().numpy", "mmcv.imdenormalize", "tensor[].cpu"], "function", ["None"], ["def", "tensor2imgs", "(", "tensor", ",", "mean", "=", "(", "0", ",", "0", ",", "0", ")", ",", "std", "=", "(", "1", ",", "1", ",", "1", ")", ",", "to_rgb", "=", "True", ")", ":", "\n", "    ", "num_imgs", "=", "tensor", ".", "size", "(", "0", ")", "\n", "mean", "=", "np", ".", "array", "(", "mean", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "std", "=", "np", ".", "array", "(", "std", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "imgs", "=", "[", "]", "\n", "for", "img_id", "in", "range", "(", "num_imgs", ")", ":", "\n", "        ", "img", "=", "tensor", "[", "img_id", ",", "...", "]", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ".", "transpose", "(", "1", ",", "2", ",", "0", ")", "\n", "img", "=", "mmcv", ".", "imdenormalize", "(", "\n", "img", ",", "mean", ",", "std", ",", "to_bgr", "=", "to_rgb", ")", ".", "astype", "(", "np", ".", "uint8", ")", "\n", "imgs", ".", "append", "(", "np", ".", "ascontiguousarray", "(", "img", ")", ")", "\n", "", "return", "imgs", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.multi_apply": [[21, 25], ["six.moves.map", "tuple", "functools.partial", "six.moves.map", "six.moves.zip"], "function", ["None"], ["", "def", "multi_apply", "(", "func", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "    ", "pfunc", "=", "partial", "(", "func", ",", "**", "kwargs", ")", "if", "kwargs", "else", "func", "\n", "map_results", "=", "map", "(", "pfunc", ",", "*", "args", ")", "# a list of the results of pfunc for each iterable item.", "\n", "return", "tuple", "(", "map", "(", "list", ",", "zip", "(", "*", "map_results", ")", ")", ")", "# tuple of list", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.unmap": [[27, 38], ["data.dim", "data.new_full", "data.new_full", "data.size"], "function", ["None"], ["", "def", "unmap", "(", "data", ",", "count", ",", "inds", ",", "fill", "=", "0", ")", ":", "\n", "    ", "\"\"\" Unmap a subset of item (data) back to the original set of items (of\n    size count) \"\"\"", "\n", "if", "data", ".", "dim", "(", ")", "==", "1", ":", "\n", "        ", "ret", "=", "data", ".", "new_full", "(", "(", "count", ",", ")", ",", "fill", ")", "\n", "ret", "[", "inds", "]", "=", "data", "\n", "", "else", ":", "\n", "        ", "new_size", "=", "(", "count", ",", ")", "+", "data", ".", "size", "(", ")", "[", "1", ":", "]", "\n", "ret", "=", "data", ".", "new_full", "(", "new_size", ",", "fill", ")", "\n", "ret", "[", "inds", ",", ":", "]", "=", "data", "\n", "", "return", "ret", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.necks.fpn.FPN.__init__": [[12, 90], ["torch.Module.__init__", "isinstance", "len", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "range", "utils.ConvModule", "utils.ConvModule", "fpn.FPN.lateral_convs.append", "fpn.FPN.fpn_convs.append", "range", "len", "utils.ConvModule", "fpn.FPN.fpn_convs.append"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "\n", "in_channels", ",", "\n", "out_channels", ",", "\n", "num_outs", ",", "\n", "start_level", "=", "0", ",", "\n", "end_level", "=", "-", "1", ",", "\n", "add_extra_convs", "=", "False", ",", "\n", "extra_convs_on_inputs", "=", "True", ",", "\n", "relu_before_extra_convs", "=", "False", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "None", ",", "\n", "activation", "=", "None", ")", ":", "\n", "        ", "super", "(", "FPN", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "isinstance", "(", "in_channels", ",", "list", ")", "\n", "self", ".", "in_channels", "=", "in_channels", "\n", "self", ".", "out_channels", "=", "out_channels", "\n", "self", ".", "num_ins", "=", "len", "(", "in_channels", ")", "\n", "self", ".", "num_outs", "=", "num_outs", "\n", "self", ".", "activation", "=", "activation", "\n", "self", ".", "relu_before_extra_convs", "=", "relu_before_extra_convs", "\n", "\n", "if", "end_level", "==", "-", "1", ":", "\n", "            ", "self", ".", "backbone_end_level", "=", "self", ".", "num_ins", "\n", "assert", "num_outs", ">=", "self", ".", "num_ins", "-", "start_level", "\n", "", "else", ":", "\n", "# if end_level < inputs, no extra level is allowed", "\n", "            ", "self", ".", "backbone_end_level", "=", "end_level", "\n", "assert", "end_level", "<=", "len", "(", "in_channels", ")", "\n", "assert", "num_outs", "==", "end_level", "-", "start_level", "\n", "", "self", ".", "start_level", "=", "start_level", "\n", "self", ".", "end_level", "=", "end_level", "\n", "self", ".", "add_extra_convs", "=", "add_extra_convs", "\n", "self", ".", "extra_convs_on_inputs", "=", "extra_convs_on_inputs", "\n", "\n", "self", ".", "lateral_convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "self", ".", "fpn_convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "\n", "for", "i", "in", "range", "(", "self", ".", "start_level", ",", "self", ".", "backbone_end_level", ")", ":", "\n", "            ", "l_conv", "=", "ConvModule", "(", "\n", "in_channels", "[", "i", "]", ",", "\n", "out_channels", ",", "\n", "1", ",", "\n", "conv_cfg", "=", "conv_cfg", ",", "\n", "norm_cfg", "=", "norm_cfg", ",", "\n", "activation", "=", "self", ".", "activation", ",", "\n", "inplace", "=", "False", ")", "\n", "fpn_conv", "=", "ConvModule", "(", "\n", "out_channels", ",", "\n", "out_channels", ",", "\n", "3", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "conv_cfg", ",", "\n", "norm_cfg", "=", "norm_cfg", ",", "\n", "activation", "=", "self", ".", "activation", ",", "\n", "inplace", "=", "False", ")", "\n", "\n", "self", ".", "lateral_convs", ".", "append", "(", "l_conv", ")", "\n", "self", ".", "fpn_convs", ".", "append", "(", "fpn_conv", ")", "\n", "\n", "# add extra conv layers (e.g., RetinaNet)", "\n", "", "extra_levels", "=", "num_outs", "-", "self", ".", "backbone_end_level", "+", "self", ".", "start_level", "\n", "if", "add_extra_convs", "and", "extra_levels", ">=", "1", ":", "\n", "            ", "for", "i", "in", "range", "(", "extra_levels", ")", ":", "\n", "                ", "if", "i", "==", "0", "and", "self", ".", "extra_convs_on_inputs", ":", "\n", "                    ", "in_channels", "=", "self", ".", "in_channels", "[", "self", ".", "backbone_end_level", "-", "1", "]", "\n", "", "else", ":", "\n", "                    ", "in_channels", "=", "out_channels", "\n", "", "extra_fpn_conv", "=", "ConvModule", "(", "\n", "in_channels", ",", "\n", "out_channels", ",", "\n", "3", ",", "\n", "stride", "=", "2", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "conv_cfg", ",", "\n", "norm_cfg", "=", "norm_cfg", ",", "\n", "activation", "=", "self", ".", "activation", ",", "\n", "inplace", "=", "False", ")", "\n", "self", ".", "fpn_convs", ".", "append", "(", "extra_fpn_conv", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.necks.fpn.FPN.init_weights": [[92, 96], ["fpn.FPN.modules", "isinstance", "mmcv.cnn.xavier_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.xavier_init"], ["", "", "", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "for", "m", "in", "self", ".", "modules", "(", ")", ":", "\n", "            ", "if", "isinstance", "(", "m", ",", "nn", ".", "Conv2d", ")", ":", "\n", "                ", "xavier_init", "(", "m", ",", "distribution", "=", "'uniform'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.necks.fpn.FPN.forward": [[97, 137], ["len", "range", "tuple", "len", "len", "lateral_conv", "torch.interpolate", "torch.interpolate", "len", "enumerate", "range", "range", "range", "outs.append", "outs.append", "outs.append", "torch.max_pool2d", "torch.max_pool2d", "outs.append", "outs.append", "torch.relu", "torch.relu"], "methods", ["None"], ["", "", "", "def", "forward", "(", "self", ",", "inputs", ")", ":", "\n", "        ", "assert", "len", "(", "inputs", ")", "==", "len", "(", "self", ".", "in_channels", ")", "\n", "\n", "# build laterals", "\n", "laterals", "=", "[", "\n", "lateral_conv", "(", "inputs", "[", "i", "+", "self", ".", "start_level", "]", ")", "\n", "for", "i", ",", "lateral_conv", "in", "enumerate", "(", "self", ".", "lateral_convs", ")", "\n", "]", "\n", "\n", "# build top-down path", "\n", "used_backbone_levels", "=", "len", "(", "laterals", ")", "\n", "for", "i", "in", "range", "(", "used_backbone_levels", "-", "1", ",", "0", ",", "-", "1", ")", ":", "\n", "            ", "laterals", "[", "i", "-", "1", "]", "+=", "F", ".", "interpolate", "(", "\n", "laterals", "[", "i", "]", ",", "scale_factor", "=", "2", ",", "mode", "=", "'nearest'", ")", "\n", "\n", "# build outputs", "\n", "# part 1: from original levels", "\n", "", "outs", "=", "[", "\n", "self", ".", "fpn_convs", "[", "i", "]", "(", "laterals", "[", "i", "]", ")", "for", "i", "in", "range", "(", "used_backbone_levels", ")", "\n", "]", "\n", "# part 2: add extra levels", "\n", "if", "self", ".", "num_outs", ">", "len", "(", "outs", ")", ":", "\n", "# use max pool to get more levels on top of outputs", "\n", "# (e.g., Faster R-CNN, Mask R-CNN)", "\n", "            ", "if", "not", "self", ".", "add_extra_convs", ":", "\n", "                ", "for", "i", "in", "range", "(", "self", ".", "num_outs", "-", "used_backbone_levels", ")", ":", "\n", "                    ", "outs", ".", "append", "(", "F", ".", "max_pool2d", "(", "outs", "[", "-", "1", "]", ",", "1", ",", "stride", "=", "2", ")", ")", "\n", "# add conv layers on top of original feature maps (RetinaNet)", "\n", "", "", "else", ":", "\n", "                ", "if", "self", ".", "extra_convs_on_inputs", ":", "\n", "                    ", "orig", "=", "inputs", "[", "self", ".", "backbone_end_level", "-", "1", "]", "\n", "outs", ".", "append", "(", "self", ".", "fpn_convs", "[", "used_backbone_levels", "]", "(", "orig", ")", ")", "\n", "", "else", ":", "\n", "                    ", "outs", ".", "append", "(", "self", ".", "fpn_convs", "[", "used_backbone_levels", "]", "(", "outs", "[", "-", "1", "]", ")", ")", "\n", "", "for", "i", "in", "range", "(", "used_backbone_levels", "+", "1", ",", "self", ".", "num_outs", ")", ":", "\n", "                    ", "if", "self", ".", "relu_before_extra_convs", ":", "\n", "                        ", "outs", ".", "append", "(", "self", ".", "fpn_convs", "[", "i", "]", "(", "F", ".", "relu", "(", "outs", "[", "-", "1", "]", ")", ")", ")", "\n", "", "else", ":", "\n", "                        ", "outs", ".", "append", "(", "self", ".", "fpn_convs", "[", "i", "]", "(", "outs", "[", "-", "1", "]", ")", ")", "\n", "", "", "", "", "return", "tuple", "(", "outs", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.necks.hrfpn.HRFPN.__init__": [[29, 69], ["torch.Module.__init__", "isinstance", "len", "utils.ConvModule", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "range", "sum", "hrfpn.HRFPN.fpn_convs.append", "utils.ConvModule"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["def", "__init__", "(", "self", ",", "\n", "in_channels", ",", "\n", "out_channels", ",", "\n", "num_outs", "=", "5", ",", "\n", "pooling_type", "=", "'AVG'", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "None", ",", "\n", "with_cp", "=", "False", ")", ":", "\n", "        ", "super", "(", "HRFPN", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "isinstance", "(", "in_channels", ",", "list", ")", "\n", "self", ".", "in_channels", "=", "in_channels", "\n", "self", ".", "out_channels", "=", "out_channels", "\n", "self", ".", "num_ins", "=", "len", "(", "in_channels", ")", "\n", "self", ".", "num_outs", "=", "num_outs", "\n", "self", ".", "with_cp", "=", "with_cp", "\n", "self", ".", "conv_cfg", "=", "conv_cfg", "\n", "self", ".", "norm_cfg", "=", "norm_cfg", "\n", "\n", "self", ".", "reduction_conv", "=", "ConvModule", "(", "\n", "sum", "(", "in_channels", ")", ",", "\n", "out_channels", ",", "\n", "kernel_size", "=", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "activation", "=", "None", ")", "\n", "\n", "self", ".", "fpn_convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "for", "i", "in", "range", "(", "self", ".", "num_outs", ")", ":", "\n", "            ", "self", ".", "fpn_convs", ".", "append", "(", "\n", "ConvModule", "(", "\n", "out_channels", ",", "\n", "out_channels", ",", "\n", "kernel_size", "=", "3", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "activation", "=", "None", ")", ")", "\n", "\n", "", "if", "pooling_type", "==", "'MAX'", ":", "\n", "            ", "self", ".", "pooling", "=", "F", ".", "max_pool2d", "\n", "", "else", ":", "\n", "            ", "self", ".", "pooling", "=", "F", ".", "avg_pool2d", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.necks.hrfpn.HRFPN.init_weights": [[70, 74], ["hrfpn.HRFPN.modules", "isinstance", "mmcv.cnn.weight_init.caffe2_xavier_init"], "methods", ["None"], ["", "", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "for", "m", "in", "self", ".", "modules", "(", ")", ":", "\n", "            ", "if", "isinstance", "(", "m", ",", "nn", ".", "Conv2d", ")", ":", "\n", "                ", "caffe2_xavier_init", "(", "m", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.necks.hrfpn.HRFPN.forward": [[75, 98], ["range", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "range", "range", "tuple", "len", "outs.append", "torch.utils.checkpoint.checkpoint", "torch.utils.checkpoint.checkpoint", "torch.utils.checkpoint.checkpoint", "hrfpn.HRFPN.reduction_conv", "outs.append", "outputs.append", "torch.interpolate", "torch.interpolate", "torch.interpolate", "hrfpn.HRFPN.pooling", "torch.utils.checkpoint.checkpoint", "torch.utils.checkpoint.checkpoint", "torch.utils.checkpoint.checkpoint"], "methods", ["None"], ["", "", "", "def", "forward", "(", "self", ",", "inputs", ")", ":", "\n", "        ", "assert", "len", "(", "inputs", ")", "==", "self", ".", "num_ins", "\n", "outs", "=", "[", "inputs", "[", "0", "]", "]", "\n", "for", "i", "in", "range", "(", "1", ",", "self", ".", "num_ins", ")", ":", "\n", "            ", "outs", ".", "append", "(", "\n", "F", ".", "interpolate", "(", "inputs", "[", "i", "]", ",", "scale_factor", "=", "2", "**", "i", ",", "mode", "=", "'bilinear'", ")", ")", "\n", "", "out", "=", "torch", ".", "cat", "(", "outs", ",", "dim", "=", "1", ")", "\n", "if", "out", ".", "requires_grad", "and", "self", ".", "with_cp", ":", "\n", "            ", "out", "=", "checkpoint", "(", "self", ".", "reduction_conv", ",", "out", ")", "\n", "", "else", ":", "\n", "            ", "out", "=", "self", ".", "reduction_conv", "(", "out", ")", "\n", "", "outs", "=", "[", "out", "]", "\n", "for", "i", "in", "range", "(", "1", ",", "self", ".", "num_outs", ")", ":", "\n", "            ", "outs", ".", "append", "(", "self", ".", "pooling", "(", "out", ",", "kernel_size", "=", "2", "**", "i", ",", "stride", "=", "2", "**", "i", ")", ")", "\n", "", "outputs", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "self", ".", "num_outs", ")", ":", "\n", "            ", "if", "outs", "[", "i", "]", ".", "requires_grad", "and", "self", ".", "with_cp", ":", "\n", "                ", "tmp_out", "=", "checkpoint", "(", "self", ".", "fpn_convs", "[", "i", "]", ",", "outs", "[", "i", "]", ")", "\n", "", "else", ":", "\n", "                ", "tmp_out", "=", "self", ".", "fpn_convs", "[", "i", "]", "(", "outs", "[", "i", "]", ")", "\n", "", "outputs", ".", "append", "(", "tmp_out", ")", "\n", "", "return", "tuple", "(", "outputs", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.necks.bfp.BFP.__init__": [[31, 65], ["torch.Module.__init__", "utils.ConvModule", "plugins.NonLocal2D"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["def", "__init__", "(", "self", ",", "\n", "in_channels", ",", "\n", "num_levels", ",", "\n", "refine_level", "=", "2", ",", "\n", "refine_type", "=", "None", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "None", ")", ":", "\n", "        ", "super", "(", "BFP", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "refine_type", "in", "[", "None", ",", "'conv'", ",", "'non_local'", "]", "\n", "\n", "self", ".", "in_channels", "=", "in_channels", "\n", "self", ".", "num_levels", "=", "num_levels", "\n", "self", ".", "conv_cfg", "=", "conv_cfg", "\n", "self", ".", "norm_cfg", "=", "norm_cfg", "\n", "\n", "self", ".", "refine_level", "=", "refine_level", "\n", "self", ".", "refine_type", "=", "refine_type", "\n", "assert", "0", "<=", "self", ".", "refine_level", "<", "self", ".", "num_levels", "\n", "\n", "if", "self", ".", "refine_type", "==", "'conv'", ":", "\n", "            ", "self", ".", "refine", "=", "ConvModule", "(", "\n", "self", ".", "in_channels", ",", "\n", "self", ".", "in_channels", ",", "\n", "3", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ")", "\n", "", "elif", "self", ".", "refine_type", "==", "'non_local'", ":", "\n", "            ", "self", ".", "refine", "=", "NonLocal2D", "(", "\n", "self", ".", "in_channels", ",", "\n", "reduction", "=", "1", ",", "\n", "use_scale", "=", "False", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.necks.bfp.BFP.init_weights": [[66, 70], ["bfp.BFP.modules", "isinstance", "mmcv.cnn.xavier_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.xavier_init"], ["", "", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "for", "m", "in", "self", ".", "modules", "(", ")", ":", "\n", "            ", "if", "isinstance", "(", "m", ",", "nn", ".", "Conv2d", ")", ":", "\n", "                ", "xavier_init", "(", "m", ",", "distribution", "=", "'uniform'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.necks.bfp.BFP.forward": [[71, 103], ["range", "range", "tuple", "len", "inputs[].size", "feats.append", "sum", "len", "bfp.BFP.refine", "outs.append", "torch.adaptive_max_pool2d", "torch.adaptive_max_pool2d", "torch.interpolate", "torch.interpolate", "inputs[].size", "torch.interpolate", "torch.interpolate", "torch.adaptive_max_pool2d", "torch.adaptive_max_pool2d"], "methods", ["None"], ["", "", "", "def", "forward", "(", "self", ",", "inputs", ")", ":", "\n", "        ", "assert", "len", "(", "inputs", ")", "==", "self", ".", "num_levels", "\n", "\n", "# step 1: gather multi-level features by resize and average", "\n", "feats", "=", "[", "]", "\n", "gather_size", "=", "inputs", "[", "self", ".", "refine_level", "]", ".", "size", "(", ")", "[", "2", ":", "]", "\n", "for", "i", "in", "range", "(", "self", ".", "num_levels", ")", ":", "\n", "            ", "if", "i", "<", "self", ".", "refine_level", ":", "\n", "                ", "gathered", "=", "F", ".", "adaptive_max_pool2d", "(", "\n", "inputs", "[", "i", "]", ",", "output_size", "=", "gather_size", ")", "\n", "", "else", ":", "\n", "                ", "gathered", "=", "F", ".", "interpolate", "(", "\n", "inputs", "[", "i", "]", ",", "size", "=", "gather_size", ",", "mode", "=", "'nearest'", ")", "\n", "", "feats", ".", "append", "(", "gathered", ")", "\n", "\n", "", "bsf", "=", "sum", "(", "feats", ")", "/", "len", "(", "feats", ")", "\n", "\n", "# step 2: refine gathered features", "\n", "if", "self", ".", "refine_type", "is", "not", "None", ":", "\n", "            ", "bsf", "=", "self", ".", "refine", "(", "bsf", ")", "\n", "\n", "# step 3: scatter refined features to multi-levels by a residual path", "\n", "", "outs", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "self", ".", "num_levels", ")", ":", "\n", "            ", "out_size", "=", "inputs", "[", "i", "]", ".", "size", "(", ")", "[", "2", ":", "]", "\n", "if", "i", "<", "self", ".", "refine_level", ":", "\n", "                ", "residual", "=", "F", ".", "interpolate", "(", "bsf", ",", "size", "=", "out_size", ",", "mode", "=", "'nearest'", ")", "\n", "", "else", ":", "\n", "                ", "residual", "=", "F", ".", "adaptive_max_pool2d", "(", "bsf", ",", "output_size", "=", "out_size", ")", "\n", "", "outs", ".", "append", "(", "residual", "+", "inputs", "[", "i", "]", ")", "\n", "\n", "", "return", "tuple", "(", "outs", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.fused_semantic_head.FusedSemanticHead.__init__": [[24, 78], ["torch.Module.__init__", "torch.ModuleList", "torch.ModuleList", "range", "torch.ModuleList", "torch.ModuleList", "range", "utils.ConvModule", "torch.Conv2d", "torch.Conv2d", "torch.CrossEntropyLoss", "torch.CrossEntropyLoss", "fused_semantic_head.FusedSemanticHead.lateral_convs.append", "fused_semantic_head.FusedSemanticHead.convs.append", "utils.ConvModule", "utils.ConvModule"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["def", "__init__", "(", "self", ",", "\n", "num_ins", ",", "\n", "fusion_level", ",", "\n", "num_convs", "=", "4", ",", "\n", "in_channels", "=", "256", ",", "\n", "conv_out_channels", "=", "256", ",", "\n", "num_classes", "=", "183", ",", "\n", "ignore_label", "=", "255", ",", "\n", "loss_weight", "=", "0.2", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "None", ")", ":", "\n", "        ", "super", "(", "FusedSemanticHead", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "num_ins", "=", "num_ins", "\n", "self", ".", "fusion_level", "=", "fusion_level", "\n", "self", ".", "num_convs", "=", "num_convs", "\n", "self", ".", "in_channels", "=", "in_channels", "\n", "self", ".", "conv_out_channels", "=", "conv_out_channels", "\n", "self", ".", "num_classes", "=", "num_classes", "\n", "self", ".", "ignore_label", "=", "ignore_label", "\n", "self", ".", "loss_weight", "=", "loss_weight", "\n", "self", ".", "conv_cfg", "=", "conv_cfg", "\n", "self", ".", "norm_cfg", "=", "norm_cfg", "\n", "\n", "self", ".", "lateral_convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "for", "i", "in", "range", "(", "self", ".", "num_ins", ")", ":", "\n", "            ", "self", ".", "lateral_convs", ".", "append", "(", "\n", "ConvModule", "(", "\n", "self", ".", "in_channels", ",", "\n", "self", ".", "in_channels", ",", "\n", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ",", "\n", "inplace", "=", "False", ")", ")", "\n", "\n", "", "self", ".", "convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "for", "i", "in", "range", "(", "self", ".", "num_convs", ")", ":", "\n", "            ", "in_channels", "=", "self", ".", "in_channels", "if", "i", "==", "0", "else", "conv_out_channels", "\n", "self", ".", "convs", ".", "append", "(", "\n", "ConvModule", "(", "\n", "in_channels", ",", "\n", "conv_out_channels", ",", "\n", "3", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ")", ")", "\n", "", "self", ".", "conv_embedding", "=", "ConvModule", "(", "\n", "conv_out_channels", ",", "\n", "conv_out_channels", ",", "\n", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ")", "\n", "self", ".", "conv_logits", "=", "nn", ".", "Conv2d", "(", "conv_out_channels", ",", "self", ".", "num_classes", ",", "1", ")", "\n", "\n", "self", ".", "criterion", "=", "nn", ".", "CrossEntropyLoss", "(", "ignore_index", "=", "ignore_label", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.fused_semantic_head.FusedSemanticHead.init_weights": [[79, 81], ["mmcv.cnn.kaiming_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.kaiming_init"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "kaiming_init", "(", "self", ".", "conv_logits", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.fused_semantic_head.FusedSemanticHead.forward": [[82, 97], ["tuple", "enumerate", "range", "fused_semantic_head.FusedSemanticHead.conv_logits", "fused_semantic_head.FusedSemanticHead.conv_embedding", "torch.interpolate", "torch.interpolate"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "feats", ")", ":", "\n", "        ", "x", "=", "self", ".", "lateral_convs", "[", "self", ".", "fusion_level", "]", "(", "feats", "[", "self", ".", "fusion_level", "]", ")", "\n", "fused_size", "=", "tuple", "(", "x", ".", "shape", "[", "-", "2", ":", "]", ")", "\n", "for", "i", ",", "feat", "in", "enumerate", "(", "feats", ")", ":", "\n", "            ", "if", "i", "!=", "self", ".", "fusion_level", ":", "\n", "                ", "feat", "=", "F", ".", "interpolate", "(", "\n", "feat", ",", "size", "=", "fused_size", ",", "mode", "=", "'bilinear'", ",", "align_corners", "=", "True", ")", "\n", "x", "+=", "self", ".", "lateral_convs", "[", "i", "]", "(", "feat", ")", "\n", "\n", "", "", "for", "i", "in", "range", "(", "self", ".", "num_convs", ")", ":", "\n", "            ", "x", "=", "self", ".", "convs", "[", "i", "]", "(", "x", ")", "\n", "\n", "", "mask_pred", "=", "self", ".", "conv_logits", "(", "x", ")", "\n", "x", "=", "self", ".", "conv_embedding", "(", "x", ")", "\n", "return", "mask_pred", ",", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.fused_semantic_head.FusedSemanticHead.loss": [[98, 103], ["labels.squeeze().long.squeeze().long.squeeze().long", "fused_semantic_head.FusedSemanticHead.criterion", "labels.squeeze().long.squeeze().long.squeeze"], "methods", ["None"], ["", "def", "loss", "(", "self", ",", "mask_pred", ",", "labels", ")", ":", "\n", "        ", "labels", "=", "labels", ".", "squeeze", "(", "1", ")", ".", "long", "(", ")", "\n", "loss_semantic_seg", "=", "self", ".", "criterion", "(", "mask_pred", ",", "labels", ")", "\n", "loss_semantic_seg", "*=", "self", ".", "loss_weight", "\n", "return", "loss_semantic_seg", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.fcn_mask_head.FCNMaskHead.__init__": [[16, 82], ["dict", "torch.Module.__init__", "builder.build_loss", "torch.ModuleList", "torch.ModuleList", "range", "torch.Conv2d", "torch.Conv2d", "torch.ReLU", "torch.ReLU", "ValueError", "fcn_mask_head.FCNMaskHead.convs.append", "utils.ConvModule", "torch.ConvTranspose2d", "torch.ConvTranspose2d", "torch.Upsample", "torch.Upsample"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_loss"], ["    ", "def", "__init__", "(", "self", ",", "\n", "num_convs", "=", "4", ",", "\n", "roi_feat_size", "=", "14", ",", "\n", "in_channels", "=", "256", ",", "\n", "conv_kernel_size", "=", "3", ",", "\n", "conv_out_channels", "=", "256", ",", "\n", "upsample_method", "=", "'deconv'", ",", "\n", "upsample_ratio", "=", "2", ",", "\n", "num_classes", "=", "81", ",", "\n", "class_agnostic", "=", "False", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "None", ",", "\n", "loss_mask", "=", "dict", "(", "\n", "type", "=", "'CrossEntropyLoss'", ",", "use_mask", "=", "True", ",", "loss_weight", "=", "1.0", ")", ")", ":", "\n", "        ", "super", "(", "FCNMaskHead", ",", "self", ")", ".", "__init__", "(", ")", "\n", "if", "upsample_method", "not", "in", "[", "None", ",", "'deconv'", ",", "'nearest'", ",", "'bilinear'", "]", ":", "\n", "            ", "raise", "ValueError", "(", "\n", "'Invalid upsample method {}, accepted methods '", "\n", "'are \"deconv\", \"nearest\", \"bilinear\"'", ".", "format", "(", "upsample_method", ")", ")", "\n", "", "self", ".", "num_convs", "=", "num_convs", "\n", "self", ".", "roi_feat_size", "=", "roi_feat_size", "# WARN: not used and reserved", "\n", "self", ".", "in_channels", "=", "in_channels", "\n", "self", ".", "conv_kernel_size", "=", "conv_kernel_size", "\n", "self", ".", "conv_out_channels", "=", "conv_out_channels", "\n", "self", ".", "upsample_method", "=", "upsample_method", "\n", "self", ".", "upsample_ratio", "=", "upsample_ratio", "\n", "self", ".", "num_classes", "=", "num_classes", "\n", "self", ".", "class_agnostic", "=", "class_agnostic", "\n", "self", ".", "conv_cfg", "=", "conv_cfg", "\n", "self", ".", "norm_cfg", "=", "norm_cfg", "\n", "self", ".", "loss_mask", "=", "build_loss", "(", "loss_mask", ")", "\n", "\n", "self", ".", "convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "for", "i", "in", "range", "(", "self", ".", "num_convs", ")", ":", "\n", "            ", "in_channels", "=", "(", "\n", "self", ".", "in_channels", "if", "i", "==", "0", "else", "self", ".", "conv_out_channels", ")", "\n", "padding", "=", "(", "self", ".", "conv_kernel_size", "-", "1", ")", "//", "2", "\n", "self", ".", "convs", ".", "append", "(", "\n", "ConvModule", "(", "\n", "in_channels", ",", "\n", "self", ".", "conv_out_channels", ",", "\n", "self", ".", "conv_kernel_size", ",", "\n", "padding", "=", "padding", ",", "\n", "conv_cfg", "=", "conv_cfg", ",", "\n", "norm_cfg", "=", "norm_cfg", ")", ")", "\n", "", "upsample_in_channels", "=", "(", "\n", "self", ".", "conv_out_channels", "if", "self", ".", "num_convs", ">", "0", "else", "in_channels", ")", "\n", "if", "self", ".", "upsample_method", "is", "None", ":", "\n", "            ", "self", ".", "upsample", "=", "None", "\n", "", "elif", "self", ".", "upsample_method", "==", "'deconv'", ":", "\n", "            ", "self", ".", "upsample", "=", "nn", ".", "ConvTranspose2d", "(", "\n", "upsample_in_channels", ",", "\n", "self", ".", "conv_out_channels", ",", "\n", "self", ".", "upsample_ratio", ",", "\n", "stride", "=", "self", ".", "upsample_ratio", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "upsample", "=", "nn", ".", "Upsample", "(", "\n", "scale_factor", "=", "self", ".", "upsample_ratio", ",", "mode", "=", "self", ".", "upsample_method", ")", "\n", "\n", "", "out_channels", "=", "1", "if", "self", ".", "class_agnostic", "else", "self", ".", "num_classes", "\n", "logits_in_channel", "=", "(", "\n", "self", ".", "conv_out_channels", "\n", "if", "self", ".", "upsample_method", "==", "'deconv'", "else", "upsample_in_channels", ")", "\n", "self", ".", "conv_logits", "=", "nn", ".", "Conv2d", "(", "logits_in_channel", ",", "out_channels", ",", "1", ")", "\n", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "self", ".", "debug_imgs", "=", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.fcn_mask_head.FCNMaskHead.init_weights": [[83, 90], ["torch.init.kaiming_normal_", "torch.init.kaiming_normal_", "torch.init.constant_", "torch.init.constant_"], "methods", ["None"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "for", "m", "in", "[", "self", ".", "upsample", ",", "self", ".", "conv_logits", "]", ":", "\n", "            ", "if", "m", "is", "None", ":", "\n", "                ", "continue", "\n", "", "nn", ".", "init", ".", "kaiming_normal_", "(", "\n", "m", ".", "weight", ",", "mode", "=", "'fan_out'", ",", "nonlinearity", "=", "'relu'", ")", "\n", "nn", ".", "init", ".", "constant_", "(", "m", ".", "bias", ",", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.fcn_mask_head.FCNMaskHead.forward": [[91, 100], ["fcn_mask_head.FCNMaskHead.conv_logits", "conv", "fcn_mask_head.FCNMaskHead.upsample", "fcn_mask_head.FCNMaskHead.relu"], "methods", ["None"], ["", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "for", "conv", "in", "self", ".", "convs", ":", "\n", "            ", "x", "=", "conv", "(", "x", ")", "\n", "", "if", "self", ".", "upsample", "is", "not", "None", ":", "\n", "            ", "x", "=", "self", ".", "upsample", "(", "x", ")", "\n", "if", "self", ".", "upsample_method", "==", "'deconv'", ":", "\n", "                ", "x", "=", "self", ".", "relu", "(", "x", ")", "\n", "", "", "mask_pred", "=", "self", ".", "conv_logits", "(", "x", ")", "\n", "return", "mask_pred", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.fcn_mask_head.FCNMaskHead.get_target": [[101, 109], ["mmdet.core.mask_target"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask.mask_target.mask_target"], ["", "def", "get_target", "(", "self", ",", "sampling_results", ",", "gt_masks", ",", "rcnn_train_cfg", ")", ":", "\n", "        ", "pos_proposals", "=", "[", "res", ".", "pos_bboxes", "for", "res", "in", "sampling_results", "]", "\n", "pos_assigned_gt_inds", "=", "[", "\n", "res", ".", "pos_assigned_gt_inds", "for", "res", "in", "sampling_results", "\n", "]", "\n", "mask_targets", "=", "mask_target", "(", "pos_proposals", ",", "pos_assigned_gt_inds", ",", "\n", "gt_masks", ",", "rcnn_train_cfg", ")", "\n", "return", "mask_targets", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.fcn_mask_head.FCNMaskHead.loss": [[110, 119], ["dict", "fcn_mask_head.FCNMaskHead.loss_mask", "fcn_mask_head.FCNMaskHead.loss_mask", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like"], "methods", ["None"], ["", "def", "loss", "(", "self", ",", "mask_pred", ",", "mask_targets", ",", "labels", ")", ":", "\n", "        ", "loss", "=", "dict", "(", ")", "\n", "if", "self", ".", "class_agnostic", ":", "\n", "            ", "loss_mask", "=", "self", ".", "loss_mask", "(", "mask_pred", ",", "mask_targets", ",", "\n", "torch", ".", "zeros_like", "(", "labels", ")", ")", "\n", "", "else", ":", "\n", "            ", "loss_mask", "=", "self", ".", "loss_mask", "(", "mask_pred", ",", "mask_targets", ",", "labels", ")", "\n", "", "loss", "[", "'loss_mask'", "]", "=", "loss_mask", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.fcn_mask_head.FCNMaskHead.get_seg_masks": [[120, 174], ["isinstance", "isinstance", "range", "mask_pred.sigmoid().cpu().numpy.sigmoid().cpu().numpy.sigmoid().cpu().numpy", "det_bboxes.cpu().numpy", "det_labels.cpu().numpy", "numpy.round().astype", "numpy.round().astype", "max", "max", "numpy.zeros", "mmcv.imresize", "cls_segms[].append", "range", "pycocotools.encode", "mask_pred.sigmoid().cpu().numpy.sigmoid().cpu().numpy.sigmoid().cpu", "det_bboxes.cpu", "det_labels.cpu", "numpy.round", "numpy.round", "numpy.array", "mask_pred.sigmoid().cpu().numpy.sigmoid().cpu().numpy.sigmoid"], "methods", ["None"], ["", "def", "get_seg_masks", "(", "self", ",", "mask_pred", ",", "det_bboxes", ",", "det_labels", ",", "rcnn_test_cfg", ",", "\n", "ori_shape", ",", "scale_factor", ",", "rescale", ")", ":", "\n", "        ", "\"\"\"Get segmentation masks from mask_pred and bboxes.\n\n        Args:\n            mask_pred (Tensor or ndarray): shape (n, #class+1, h, w).\n                For single-scale testing, mask_pred is the direct output of\n                model, whose type is Tensor, while for multi-scale testing,\n                it will be converted to numpy array outside of this method.\n            det_bboxes (Tensor): shape (n, 4/5)\n            det_labels (Tensor): shape (n, )\n            img_shape (Tensor): shape (3, )\n            rcnn_test_cfg (dict): rcnn testing config\n            ori_shape: original image size\n\n        Returns:\n            list[list]: encoded masks\n        \"\"\"", "\n", "if", "isinstance", "(", "mask_pred", ",", "torch", ".", "Tensor", ")", ":", "\n", "            ", "mask_pred", "=", "mask_pred", ".", "sigmoid", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "", "assert", "isinstance", "(", "mask_pred", ",", "np", ".", "ndarray", ")", "\n", "\n", "cls_segms", "=", "[", "[", "]", "for", "_", "in", "range", "(", "self", ".", "num_classes", "-", "1", ")", "]", "\n", "bboxes", "=", "det_bboxes", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", ":", ",", ":", "4", "]", "\n", "labels", "=", "det_labels", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "+", "1", "\n", "\n", "if", "rescale", ":", "\n", "            ", "img_h", ",", "img_w", "=", "ori_shape", "[", ":", "2", "]", "\n", "", "else", ":", "\n", "            ", "img_h", "=", "np", ".", "round", "(", "ori_shape", "[", "0", "]", "*", "scale_factor", ")", ".", "astype", "(", "np", ".", "int32", ")", "\n", "img_w", "=", "np", ".", "round", "(", "ori_shape", "[", "1", "]", "*", "scale_factor", ")", ".", "astype", "(", "np", ".", "int32", ")", "\n", "scale_factor", "=", "1.0", "\n", "\n", "", "for", "i", "in", "range", "(", "bboxes", ".", "shape", "[", "0", "]", ")", ":", "\n", "            ", "bbox", "=", "(", "bboxes", "[", "i", ",", ":", "]", "/", "scale_factor", ")", ".", "astype", "(", "np", ".", "int32", ")", "\n", "label", "=", "labels", "[", "i", "]", "\n", "w", "=", "max", "(", "bbox", "[", "2", "]", "-", "bbox", "[", "0", "]", "+", "1", ",", "1", ")", "\n", "h", "=", "max", "(", "bbox", "[", "3", "]", "-", "bbox", "[", "1", "]", "+", "1", ",", "1", ")", "\n", "\n", "if", "not", "self", ".", "class_agnostic", ":", "\n", "                ", "mask_pred_", "=", "mask_pred", "[", "i", ",", "label", ",", ":", ",", ":", "]", "\n", "", "else", ":", "\n", "                ", "mask_pred_", "=", "mask_pred", "[", "i", ",", "0", ",", ":", ",", ":", "]", "\n", "", "im_mask", "=", "np", ".", "zeros", "(", "(", "img_h", ",", "img_w", ")", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "\n", "bbox_mask", "=", "mmcv", ".", "imresize", "(", "mask_pred_", ",", "(", "w", ",", "h", ")", ")", "\n", "bbox_mask", "=", "(", "bbox_mask", ">", "rcnn_test_cfg", ".", "mask_thr_binary", ")", ".", "astype", "(", "\n", "np", ".", "uint8", ")", "\n", "im_mask", "[", "bbox", "[", "1", "]", ":", "bbox", "[", "1", "]", "+", "h", ",", "bbox", "[", "0", "]", ":", "bbox", "[", "0", "]", "+", "w", "]", "=", "bbox_mask", "\n", "rle", "=", "mask_util", ".", "encode", "(", "\n", "np", ".", "array", "(", "im_mask", "[", ":", ",", ":", ",", "np", ".", "newaxis", "]", ",", "order", "=", "'F'", ")", ")", "[", "0", "]", "\n", "cls_segms", "[", "label", "-", "1", "]", ".", "append", "(", "rle", ")", "\n", "\n", "", "return", "cls_segms", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.htc_mask_head.HTCMaskHead.__init__": [[9, 17], ["fcn_mask_head.FCNMaskHead.__init__", "utils.ConvModule"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "HTCMaskHead", ",", "self", ")", ".", "__init__", "(", "*", "args", ",", "**", "kwargs", ")", "\n", "self", ".", "conv_res", "=", "ConvModule", "(", "\n", "self", ".", "conv_out_channels", ",", "\n", "self", ".", "conv_out_channels", ",", "\n", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.htc_mask_head.HTCMaskHead.init_weights": [[18, 21], ["super().init_weights", "htc_mask_head.HTCMaskHead.conv_res.init_weights"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "super", "(", "HTCMaskHead", ",", "self", ")", ".", "init_weights", "(", ")", "\n", "self", ".", "conv_res", ".", "init_weights", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.htc_mask_head.HTCMaskHead.forward": [[22, 39], ["htc_mask_head.HTCMaskHead.conv_res", "conv", "htc_mask_head.HTCMaskHead.upsample", "htc_mask_head.HTCMaskHead.conv_logits", "outs.append", "outs.append", "htc_mask_head.HTCMaskHead.relu", "len"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "res_feat", "=", "None", ",", "return_logits", "=", "True", ",", "return_feat", "=", "True", ")", ":", "\n", "        ", "if", "res_feat", "is", "not", "None", ":", "\n", "            ", "res_feat", "=", "self", ".", "conv_res", "(", "res_feat", ")", "\n", "x", "=", "x", "+", "res_feat", "\n", "", "for", "conv", "in", "self", ".", "convs", ":", "\n", "            ", "x", "=", "conv", "(", "x", ")", "\n", "", "res_feat", "=", "x", "\n", "outs", "=", "[", "]", "\n", "if", "return_logits", ":", "\n", "            ", "x", "=", "self", ".", "upsample", "(", "x", ")", "\n", "if", "self", ".", "upsample_method", "==", "'deconv'", ":", "\n", "                ", "x", "=", "self", ".", "relu", "(", "x", ")", "\n", "", "mask_pred", "=", "self", ".", "conv_logits", "(", "x", ")", "\n", "outs", ".", "append", "(", "mask_pred", ")", "\n", "", "if", "return_feat", ":", "\n", "            ", "outs", ".", "append", "(", "res_feat", ")", "\n", "", "return", "outs", "if", "len", "(", "outs", ")", ">", "1", "else", "outs", "[", "0", "]", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.shared_heads.res_layer.ResLayer.__init__": [[14, 45], ["dict", "torch.Module.__init__", "backbones.make_res_layer", "backbones.make_res_layer.ResLayer.add_module"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnext.make_res_layer"], ["    ", "def", "__init__", "(", "self", ",", "\n", "depth", ",", "\n", "stage", "=", "3", ",", "\n", "stride", "=", "2", ",", "\n", "dilation", "=", "1", ",", "\n", "style", "=", "'pytorch'", ",", "\n", "norm_cfg", "=", "dict", "(", "type", "=", "'BN'", ",", "requires_grad", "=", "True", ")", ",", "\n", "norm_eval", "=", "True", ",", "\n", "with_cp", "=", "False", ",", "\n", "dcn", "=", "None", ")", ":", "\n", "        ", "super", "(", "ResLayer", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "norm_eval", "=", "norm_eval", "\n", "self", ".", "norm_cfg", "=", "norm_cfg", "\n", "self", ".", "stage", "=", "stage", "\n", "block", ",", "stage_blocks", "=", "ResNet", ".", "arch_settings", "[", "depth", "]", "\n", "stage_block", "=", "stage_blocks", "[", "stage", "]", "\n", "planes", "=", "64", "*", "2", "**", "stage", "\n", "inplanes", "=", "64", "*", "2", "**", "(", "stage", "-", "1", ")", "*", "block", ".", "expansion", "\n", "\n", "res_layer", "=", "make_res_layer", "(", "\n", "block", ",", "\n", "inplanes", ",", "\n", "planes", ",", "\n", "stage_block", ",", "\n", "stride", "=", "stride", ",", "\n", "dilation", "=", "dilation", ",", "\n", "style", "=", "style", ",", "\n", "with_cp", "=", "with_cp", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ",", "\n", "dcn", "=", "dcn", ")", "\n", "self", ".", "add_module", "(", "'layer{}'", ".", "format", "(", "stage", "+", "1", ")", ",", "res_layer", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.shared_heads.res_layer.ResLayer.init_weights": [[46, 58], ["isinstance", "logging.getLogger", "mmcv.runner.load_checkpoint", "res_layer.ResLayer.modules", "TypeError", "isinstance", "mmcv.cnn.kaiming_init", "isinstance", "mmcv.cnn.constant_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.kaiming_init"], ["", "def", "init_weights", "(", "self", ",", "pretrained", "=", "None", ")", ":", "\n", "        ", "if", "isinstance", "(", "pretrained", ",", "str", ")", ":", "\n", "            ", "logger", "=", "logging", ".", "getLogger", "(", ")", "\n", "load_checkpoint", "(", "self", ",", "pretrained", ",", "strict", "=", "False", ",", "logger", "=", "logger", ")", "\n", "", "elif", "pretrained", "is", "None", ":", "\n", "            ", "for", "m", "in", "self", ".", "modules", "(", ")", ":", "\n", "                ", "if", "isinstance", "(", "m", ",", "nn", ".", "Conv2d", ")", ":", "\n", "                    ", "kaiming_init", "(", "m", ")", "\n", "", "elif", "isinstance", "(", "m", ",", "nn", ".", "BatchNorm2d", ")", ":", "\n", "                    ", "constant_init", "(", "m", ",", "1", ")", "\n", "", "", "", "else", ":", "\n", "            ", "raise", "TypeError", "(", "'pretrained must be a str or None'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.shared_heads.res_layer.ResLayer.forward": [[59, 63], ["getattr", "getattr."], "methods", ["None"], ["", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "res_layer", "=", "getattr", "(", "self", ",", "'layer{}'", ".", "format", "(", "self", ".", "stage", "+", "1", ")", ")", "\n", "out", "=", "res_layer", "(", "x", ")", "\n", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.shared_heads.res_layer.ResLayer.train": [[64, 70], ["super().train", "res_layer.ResLayer.modules", "isinstance", "m.eval"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.ResNet.train"], ["", "def", "train", "(", "self", ",", "mode", "=", "True", ")", ":", "\n", "        ", "super", "(", "ResLayer", ",", "self", ")", ".", "train", "(", "mode", ")", "\n", "if", "self", ".", "norm_eval", ":", "\n", "            ", "for", "m", "in", "self", ".", "modules", "(", ")", ":", "\n", "                ", "if", "isinstance", "(", "m", ",", "nn", ".", "BatchNorm2d", ")", ":", "\n", "                    ", "m", ".", "eval", "(", ")", "\n", "", "", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_fcos_head.IoUawareFCOSHead.__init__": [[17, 40], ["dict", "torch.Module.__init__", "iou_aware_fcos_head.IoUawareFCOSHead._init_layers"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead._init_layers"], ["    ", "def", "__init__", "(", "self", ",", "\n", "num_classes", ",", "\n", "in_channels", ",", "\n", "feat_channels", "=", "256", ",", "\n", "stacked_convs", "=", "4", ",", "\n", "strides", "=", "(", "4", ",", "8", ",", "16", ",", "32", ",", "64", ")", ",", "\n", "regress_ranges", "=", "(", "(", "-", "1", ",", "64", ")", ",", "(", "64", ",", "128", ")", ",", "(", "128", ",", "256", ")", ",", "(", "256", ",", "512", ")", ",", "\n", "(", "512", ",", "INF", ")", ")", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "dict", "(", "type", "=", "'GN'", ",", "num_groups", "=", "32", ",", "requires_grad", "=", "True", ")", ")", ":", "\n", "        ", "super", "(", "IoUawareFCOSHead", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "num_classes", "=", "num_classes", "\n", "self", ".", "cls_out_channels", "=", "num_classes", "-", "1", "\n", "self", ".", "in_channels", "=", "in_channels", "\n", "self", ".", "feat_channels", "=", "feat_channels", "\n", "self", ".", "stacked_convs", "=", "stacked_convs", "\n", "self", ".", "strides", "=", "strides", "\n", "self", ".", "regress_ranges", "=", "regress_ranges", "\n", "self", ".", "conv_cfg", "=", "conv_cfg", "\n", "self", ".", "norm_cfg", "=", "norm_cfg", "\n", "\n", "self", ".", "_init_layers", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_fcos_head.IoUawareFCOSHead._init_layers": [[41, 74], ["torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "range", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "iou_aware_fcos_head.IoUawareFCOSHead.cls_convs.append", "iou_aware_fcos_head.IoUawareFCOSHead.reg_convs.append", "utils.ConvModule", "utils.ConvModule", "utils.Scale"], "methods", ["None"], ["", "def", "_init_layers", "(", "self", ")", ":", "\n", "        ", "self", ".", "cls_convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "self", ".", "reg_convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "for", "i", "in", "range", "(", "self", ".", "stacked_convs", ")", ":", "\n", "            ", "chn", "=", "self", ".", "in_channels", "if", "i", "==", "0", "else", "self", ".", "feat_channels", "\n", "self", ".", "cls_convs", ".", "append", "(", "\n", "ConvModule", "(", "\n", "chn", ",", "\n", "self", ".", "feat_channels", ",", "\n", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ",", "\n", "bias", "=", "self", ".", "norm_cfg", "is", "None", ")", ")", "\n", "self", ".", "reg_convs", ".", "append", "(", "\n", "ConvModule", "(", "\n", "chn", ",", "\n", "self", ".", "feat_channels", ",", "\n", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ",", "\n", "bias", "=", "self", ".", "norm_cfg", "is", "None", ")", ")", "\n", "", "self", ".", "fcos_cls", "=", "nn", ".", "Conv2d", "(", "\n", "self", ".", "feat_channels", ",", "self", ".", "cls_out_channels", ",", "3", ",", "padding", "=", "1", ")", "\n", "self", ".", "fcos_centerness", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "1", ",", "3", ",", "padding", "=", "1", ")", "\n", "self", ".", "fcos_reg", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "4", ",", "3", ",", "padding", "=", "1", ")", "\n", "\n", "# added by WSK", "\n", "self", ".", "fcos_iou", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "1", ",", "3", ",", "padding", "=", "1", ")", "\n", "self", ".", "scales", "=", "nn", ".", "ModuleList", "(", "[", "Scale", "(", "1.0", ")", "for", "_", "in", "self", ".", "strides", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_fcos_head.IoUawareFCOSHead.init_weights": [[75, 87], ["utils.bias_init_with_prob", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.bias_init_with_prob", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "for", "m", "in", "self", ".", "cls_convs", ":", "\n", "            ", "normal_init", "(", "m", ".", "conv", ",", "std", "=", "0.01", ")", "\n", "", "for", "m", "in", "self", ".", "reg_convs", ":", "\n", "            ", "normal_init", "(", "m", ".", "conv", ",", "std", "=", "0.01", ")", "\n", "", "bias_cls", "=", "bias_init_with_prob", "(", "0.01", ")", "\n", "normal_init", "(", "self", ".", "fcos_cls", ",", "std", "=", "0.01", ",", "bias", "=", "bias_cls", ")", "\n", "normal_init", "(", "self", ".", "fcos_reg", ",", "std", "=", "0.01", ")", "\n", "normal_init", "(", "self", ".", "fcos_centerness", ",", "std", "=", "0.01", ")", "\n", "\n", "# added by WSK", "\n", "normal_init", "(", "self", ".", "fcos_iou", ",", "std", "=", "0.01", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_fcos_head.IoUawareFCOSHead.forward": [[89, 91], ["mmdet.core.multi_apply"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.multi_apply"], ["", "def", "forward", "(", "self", ",", "feats", ")", ":", "\n", "        ", "return", "multi_apply", "(", "self", ".", "forward_single", ",", "feats", ",", "self", ".", "scales", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_fcos_head.IoUawareFCOSHead.forward_single": [[92, 111], ["iou_aware_fcos_head.IoUawareFCOSHead.fcos_cls", "iou_aware_fcos_head.IoUawareFCOSHead.fcos_centerness", "scale().exp", "iou_aware_fcos_head.IoUawareFCOSHead.fcos_iou", "cls_layer", "reg_layer", "scale", "iou_aware_fcos_head.IoUawareFCOSHead.fcos_reg"], "methods", ["None"], ["", "def", "forward_single", "(", "self", ",", "x", ",", "scale", ")", ":", "\n", "        ", "cls_feat", "=", "x", "\n", "reg_feat", "=", "x", "\n", "\n", "for", "cls_layer", "in", "self", ".", "cls_convs", ":", "\n", "            ", "cls_feat", "=", "cls_layer", "(", "cls_feat", ")", "\n", "", "cls_score", "=", "self", ".", "fcos_cls", "(", "cls_feat", ")", "\n", "centerness", "=", "self", ".", "fcos_centerness", "(", "cls_feat", ")", "\n", "\n", "for", "reg_layer", "in", "self", ".", "reg_convs", ":", "\n", "            ", "reg_feat", "=", "reg_layer", "(", "reg_feat", ")", "\n", "\n", "# scale the bbox_pred of different level", "\n", "", "bbox_pred", "=", "scale", "(", "self", ".", "fcos_reg", "(", "reg_feat", ")", ")", ".", "exp", "(", ")", "\n", "\n", "# added by WSK", "\n", "iou", "=", "self", ".", "fcos_iou", "(", "reg_feat", ")", "\n", "\n", "return", "cls_score", ",", "bbox_pred", ",", "centerness", ",", "iou", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_fcos_head.IoUawareFCOSHead.loss": [[112, 226], ["iou_aware_fcos_head.IoUawareFCOSHead.get_points", "iou_aware_fcos_head.IoUawareFCOSHead.fcos_target", "cls_scores[].size", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat.nonzero().reshape", "torch.cat.nonzero().reshape", "torch.cat.nonzero().reshape", "len", "iou_aware_fcos_head.IoUawareFCOSHead.centerness_target", "dict", "len", "len", "len", "len", "cls_score.permute().reshape", "bbox_pred.permute().reshape", "centerness.permute().reshape", "iou.permute().reshape", "mmdet.core.distance2bbox", "mmdet.core.distance2bbox", "mmdet.core.bbox_overlaps", "featmap.size", "points.repeat", "torch.cat.nonzero", "torch.cat.nonzero", "torch.cat.nonzero", "mmdet.core.sigmoid_focal_loss().sum", "torch.binary_cross_entropy_with_logits", "torch.binary_cross_entropy_with_logits", "torch.binary_cross_entropy_with_logits", "torch.binary_cross_entropy_with_logits", "torch.binary_cross_entropy_with_logits", "torch.binary_cross_entropy_with_logits", "pos_bbox_preds.sum", "pos_centerness.sum", "pos_iou.sum", "cls_score.permute", "bbox_pred.permute", "centerness.permute", "iou.permute", "iou_aware_fcos_head.IoUawareFCOSHead.sum", "mmdet.core.sigmoid_focal_loss", "mmdet.core.iou_loss"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.get_points", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.fcos_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.centerness_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.distance2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.distance2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.iou_loss"], ["", "def", "loss", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "centernesses", ",", "\n", "ious", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "img_metas", ",", "\n", "cfg", ",", "\n", "gt_bboxes_ignore", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n\n        :param cls_scores: list of tensor. cls_scores[i].size() = (batch, num_class, width_i, height_i) for\n              the i-th level of FPN.\n        :param bbox_preds: list of tensor. bbox_preds[i].size() = (batch, 4, width_i, height_i) for\n              the i-th level of FPN.\n        :param centernesses: list of tensor. centernesses[i].size() = (batch, 1, width_i, height_i) for\n              the i-th level of FPN.\n        :param iou: list of tensor. centernesses[i].size() = (batch, 1, width_i, height_i) for\n              the i-th level of FPN.\n        :param gt_bboxes:\n        :param gt_labels:\n        :param img_metas:\n        :param cfg:\n        :param gt_bboxes_ignore:\n        :return:\n        \"\"\"", "\n", "assert", "len", "(", "cls_scores", ")", "==", "len", "(", "bbox_preds", ")", "==", "len", "(", "centernesses", ")", "==", "len", "(", "ious", ")", "\n", "featmap_sizes", "=", "[", "featmap", ".", "size", "(", ")", "[", "-", "2", ":", "]", "for", "featmap", "in", "cls_scores", "]", "\n", "all_level_points", "=", "self", ".", "get_points", "(", "featmap_sizes", ",", "bbox_preds", "[", "0", "]", ".", "dtype", ",", "\n", "bbox_preds", "[", "0", "]", ".", "device", ")", "\n", "labels", ",", "bbox_targets", "=", "self", ".", "fcos_target", "(", "all_level_points", ",", "gt_bboxes", ",", "\n", "gt_labels", ")", "\n", "\n", "num_imgs", "=", "cls_scores", "[", "0", "]", ".", "size", "(", "0", ")", "\n", "# flatten cls_scores, bbox_preds and centerness", "\n", "flatten_cls_scores", "=", "[", "\n", "cls_score", ".", "permute", "(", "0", ",", "2", ",", "3", ",", "1", ")", ".", "reshape", "(", "-", "1", ",", "self", ".", "cls_out_channels", ")", "\n", "for", "cls_score", "in", "cls_scores", "\n", "]", "\n", "flatten_bbox_preds", "=", "[", "\n", "bbox_pred", ".", "permute", "(", "0", ",", "2", ",", "3", ",", "1", ")", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "for", "bbox_pred", "in", "bbox_preds", "\n", "]", "\n", "flatten_centerness", "=", "[", "\n", "centerness", ".", "permute", "(", "0", ",", "2", ",", "3", ",", "1", ")", ".", "reshape", "(", "-", "1", ")", "\n", "for", "centerness", "in", "centernesses", "\n", "]", "\n", "\n", "# added by WSK", "\n", "flatten_iou", "=", "[", "\n", "iou", ".", "permute", "(", "0", ",", "2", ",", "3", ",", "1", ")", ".", "reshape", "(", "-", "1", ")", "\n", "for", "iou", "in", "ious", "\n", "]", "\n", "flatten_iou", "=", "torch", ".", "cat", "(", "flatten_iou", ")", "# (num_all)", "\n", "\n", "\n", "flatten_cls_scores", "=", "torch", ".", "cat", "(", "flatten_cls_scores", ")", "# (num_all, num_class)", "\n", "flatten_bbox_preds", "=", "torch", ".", "cat", "(", "flatten_bbox_preds", ")", "# (num_all, 4)", "\n", "flatten_centerness", "=", "torch", ".", "cat", "(", "flatten_centerness", ")", "# (num_all)", "\n", "flatten_labels", "=", "torch", ".", "cat", "(", "labels", ")", "# (num_all)", "\n", "flatten_bbox_targets", "=", "torch", ".", "cat", "(", "bbox_targets", ")", "# (num_all, 4)", "\n", "# repeat points to align with bbox_preds", "\n", "flatten_points", "=", "torch", ".", "cat", "(", "\n", "[", "points", ".", "repeat", "(", "num_imgs", ",", "1", ")", "for", "points", "in", "all_level_points", "]", ")", "\n", "\n", "pos_inds", "=", "flatten_labels", ".", "nonzero", "(", ")", ".", "reshape", "(", "-", "1", ")", "\n", "num_pos", "=", "len", "(", "pos_inds", ")", "\n", "loss_cls", "=", "sigmoid_focal_loss", "(", "\n", "flatten_cls_scores", ",", "flatten_labels", ",", "cfg", ".", "gamma", ",", "cfg", ".", "alpha", ",", "\n", "'none'", ")", ".", "sum", "(", ")", "[", "None", "]", "/", "(", "num_pos", "+", "num_imgs", ")", "# avoid num_pos is 0", "\n", "\n", "pos_bbox_preds", "=", "flatten_bbox_preds", "[", "pos_inds", "]", "# (num_pos, 4)", "\n", "pos_bbox_targets", "=", "flatten_bbox_targets", "[", "pos_inds", "]", "# (num_pos, 4)", "\n", "pos_centerness", "=", "flatten_centerness", "[", "pos_inds", "]", "# (num_pos)", "\n", "pos_centerness_targets", "=", "self", ".", "centerness_target", "(", "pos_bbox_targets", ")", "# (num_pos)", "\n", "\n", "# added by WSK", "\n", "pos_iou", "=", "flatten_iou", "[", "pos_inds", "]", "# (num_pos)", "\n", "\n", "\n", "if", "num_pos", ">", "0", ":", "\n", "            ", "pos_points", "=", "flatten_points", "[", "pos_inds", "]", "\n", "pos_decoded_bbox_preds", "=", "distance2bbox", "(", "pos_points", ",", "pos_bbox_preds", ")", "# (num_pos, 4)", "\n", "pos_decoded_target_preds", "=", "distance2bbox", "(", "pos_points", ",", "\n", "pos_bbox_targets", ")", "# (num_pos, 4)", "\n", "# centerness weighted iou loss", "\n", "loss_reg", "=", "(", "(", "iou_loss", "(", "\n", "pos_decoded_bbox_preds", ",", "\n", "pos_decoded_target_preds", ",", "\n", "reduction", "=", "'none'", ")", "*", "pos_centerness_targets", ")", ".", "sum", "(", ")", "/", "\n", "pos_centerness_targets", ".", "sum", "(", ")", ")", "[", "None", "]", "\n", "loss_centerness", "=", "F", ".", "binary_cross_entropy_with_logits", "(", "\n", "pos_centerness", ",", "pos_centerness_targets", ",", "reduction", "=", "'mean'", ")", "[", "None", "]", "\n", "\n", "# added by WSK", "\n", "pos_iou_target", "=", "bbox_overlaps", "(", "pos_decoded_target_preds", ",", "pos_decoded_bbox_preds", ",", "is_aligned", "=", "True", ")", "\n", "# pos_iou_target = pos_iou_target.detach()", "\n", "loss_iou", "=", "F", ".", "binary_cross_entropy_with_logits", "(", "\n", "pos_iou", ",", "pos_iou_target", ",", "reduction", "=", "'mean'", ")", "[", "None", "]", "\n", "\n", "", "else", ":", "\n", "            ", "loss_reg", "=", "pos_bbox_preds", ".", "sum", "(", ")", "[", "None", "]", "\n", "loss_centerness", "=", "pos_centerness", ".", "sum", "(", ")", "[", "None", "]", "\n", "\n", "# added by WSK", "\n", "loss_iou", "=", "pos_iou", ".", "sum", "(", ")", "[", "None", "]", "\n", "\n", "\n", "", "return", "dict", "(", "\n", "loss_cls", "=", "loss_cls", ",", "\n", "loss_reg", "=", "loss_reg", ",", "\n", "loss_centerness", "=", "loss_centerness", ",", "\n", "loss_iou", "=", "loss_iou", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_fcos_head.IoUawareFCOSHead.get_bboxes": [[229, 269], ["len", "iou_aware_fcos_head.IoUawareFCOSHead.get_points", "range", "len", "len", "len", "iou_aware_fcos_head.IoUawareFCOSHead.get_bboxes_single", "result_list.append", "featmap.size", "[].detach", "[].detach", "[].detach", "[].detach", "range", "range", "range", "range"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.get_points", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.get_bboxes_single"], ["", "def", "get_bboxes", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "centernesses", ",", "\n", "ious", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "img_metas", ",", "\n", "cfg", ",", "\n", "rescale", "=", "None", ")", ":", "\n", "        ", "assert", "len", "(", "cls_scores", ")", "==", "len", "(", "bbox_preds", ")", "\n", "num_levels", "=", "len", "(", "cls_scores", ")", "\n", "\n", "featmap_sizes", "=", "[", "featmap", ".", "size", "(", ")", "[", "-", "2", ":", "]", "for", "featmap", "in", "cls_scores", "]", "\n", "mlvl_points", "=", "self", ".", "get_points", "(", "featmap_sizes", ",", "bbox_preds", "[", "0", "]", ".", "dtype", ",", "\n", "bbox_preds", "[", "0", "]", ".", "device", ")", "\n", "result_list", "=", "[", "]", "\n", "for", "img_id", "in", "range", "(", "len", "(", "img_metas", ")", ")", ":", "\n", "            ", "cls_score_list", "=", "[", "\n", "cls_scores", "[", "i", "]", "[", "img_id", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "bbox_pred_list", "=", "[", "\n", "bbox_preds", "[", "i", "]", "[", "img_id", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "centerness_pred_list", "=", "[", "\n", "centernesses", "[", "i", "]", "[", "img_id", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "\n", "#added by WSK", "\n", "iou_pred_list", "=", "[", "\n", "ious", "[", "i", "]", "[", "img_id", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "\n", "img_shape", "=", "img_metas", "[", "img_id", "]", "[", "'img_shape'", "]", "\n", "scale_factor", "=", "img_metas", "[", "img_id", "]", "[", "'scale_factor'", "]", "\n", "det_bboxes", "=", "self", ".", "get_bboxes_single", "(", "\n", "cls_score_list", ",", "bbox_pred_list", ",", "centerness_pred_list", ",", "iou_pred_list", ",", "\n", "mlvl_points", ",", "img_shape", ",", "scale_factor", ",", "cfg", ",", "rescale", ")", "\n", "result_list", ".", "append", "(", "det_bboxes", ")", "\n", "", "return", "result_list", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_fcos_head.IoUawareFCOSHead.get_bboxes_single": [[270, 374], ["zip", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat.new_zeros", "torch.cat.new_zeros", "torch.cat.new_zeros", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "mmdet.core.multiclass_nms", "len", "len", "len", "cls_score.permute().reshape().sigmoid", "centerness.permute().reshape().sigmoid.permute().reshape().sigmoid.permute().reshape().sigmoid", "iou.permute().reshape().sigmoid.permute().reshape().sigmoid.permute().reshape().sigmoid", "iou.permute().reshape().sigmoid.permute().reshape().sigmoid.view().expand", "bbox_pred.permute().reshape.permute().reshape.permute().reshape", "cfg.get", "mmdet.core.distance2bbox", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.new_tensor", "torch.cat.new_tensor", "torch.cat.new_tensor", "cls_score.permute().reshape().sigmoid.size", "cls_score.permute().reshape().sigmoid.pow", "iou.permute().reshape().sigmoid.view().expand.pow", "cls_score.permute().reshape().sigmoid.max", "max_scores.topk", "cls_score.size", "bbox_pred.permute().reshape.permute().reshape.size", "cls_score.permute().reshape", "centerness.permute().reshape().sigmoid.permute().reshape().sigmoid.permute().reshape", "iou.permute().reshape().sigmoid.permute().reshape().sigmoid.permute().reshape", "iou.permute().reshape().sigmoid.permute().reshape().sigmoid.view", "bbox_pred.permute().reshape.permute().reshape.permute", "cls_score.permute", "centerness.permute().reshape().sigmoid.permute().reshape().sigmoid.permute", "iou.permute().reshape().sigmoid.permute().reshape().sigmoid.permute"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.post_processing.bbox_nms.multiclass_nms", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.distance2bbox"], ["", "def", "get_bboxes_single", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "centernesses", ",", "\n", "ious", ",", "\n", "mlvl_points", ",", "\n", "img_shape", ",", "\n", "scale_factor", ",", "\n", "cfg", ",", "\n", "rescale", "=", "False", ")", ":", "\n", "        ", "\"\"\"\n\n        :param cls_scores: list[Tensor]. len(cls_score) equals to the number of feature map levels.\n              and cls_scores[i].size() is (C, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param bbox_preds: list[Tensor]. len(bbox_preds) equals to the number of feature map levels.\n              and bbox_preds[i].size() is (4, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param centernesses: list[Tensor]. len(centernesses) equals to the number of feature map levels.\n              and centernesses[i].size() is (1, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param ious: list[Tensor]. len(ious) equals to the number of feature map levels.\n              and ious[i].size() is (1, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param mlvl_points:\n        :param img_shape:\n        :param scale_factor:\n        :param cfg:\n        :param rescale:\n        :return:\n        \"\"\"", "\n", "assert", "len", "(", "cls_scores", ")", "==", "len", "(", "bbox_preds", ")", "==", "len", "(", "mlvl_points", ")", "\n", "mlvl_bboxes", "=", "[", "]", "\n", "mlvl_scores", "=", "[", "]", "\n", "mlvl_centerness", "=", "[", "]", "\n", "mlvl_iou", "=", "[", "]", "\n", "for", "cls_score", ",", "bbox_pred", ",", "centerness", ",", "iou", ",", "points", "in", "zip", "(", "\n", "cls_scores", ",", "bbox_preds", ",", "centernesses", ",", "ious", ",", "mlvl_points", ")", ":", "\n", "            ", "assert", "cls_score", ".", "size", "(", ")", "[", "-", "2", ":", "]", "==", "bbox_pred", ".", "size", "(", ")", "[", "-", "2", ":", "]", "\n", "scores", "=", "cls_score", ".", "permute", "(", "1", ",", "2", ",", "0", ")", ".", "reshape", "(", "\n", "-", "1", ",", "self", ".", "cls_out_channels", ")", ".", "sigmoid", "(", ")", "\n", "centerness", "=", "centerness", ".", "permute", "(", "1", ",", "2", ",", "0", ")", ".", "reshape", "(", "-", "1", ")", ".", "sigmoid", "(", ")", "\n", "\n", "# added by WSK", "\n", "alpha", "=", "0.3", "\n", "iou", "=", "iou", ".", "permute", "(", "1", ",", "2", ",", "0", ")", ".", "reshape", "(", "-", "1", ")", ".", "sigmoid", "(", ")", "\n", "iou_expanded", "=", "iou", ".", "view", "(", "-", "1", ",", "1", ")", ".", "expand", "(", "-", "1", ",", "scores", ".", "size", "(", "-", "1", ")", ")", "\n", "# scores = scores * iou_expanded", "\n", "scores", "=", "scores", ".", "pow", "(", "alpha", ")", "*", "iou_expanded", ".", "pow", "(", "1", "-", "alpha", ")", "\n", "\n", "\n", "\n", "bbox_pred", "=", "bbox_pred", ".", "permute", "(", "1", ",", "2", ",", "0", ")", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "nms_pre", "=", "cfg", ".", "get", "(", "'nms_pre'", ",", "-", "1", ")", "\n", "if", "nms_pre", ">", "0", "and", "scores", ".", "shape", "[", "0", "]", ">", "nms_pre", ":", "\n", "# max_scores, _ = (scores * centerness[:, None]).max(dim=1)", "\n", "# max_scores, _ = (scores * iou[:, None]).max(dim=1)", "\n", "                ", "max_scores", ",", "_", "=", "scores", ".", "max", "(", "dim", "=", "1", ")", "\n", "_", ",", "topk_inds", "=", "max_scores", ".", "topk", "(", "nms_pre", ")", "\n", "points", "=", "points", "[", "topk_inds", ",", ":", "]", "\n", "bbox_pred", "=", "bbox_pred", "[", "topk_inds", ",", ":", "]", "\n", "scores", "=", "scores", "[", "topk_inds", ",", ":", "]", "\n", "centerness", "=", "centerness", "[", "topk_inds", "]", "\n", "iou", "=", "iou", "[", "topk_inds", "]", "\n", "", "bboxes", "=", "distance2bbox", "(", "points", ",", "bbox_pred", ",", "max_shape", "=", "img_shape", ")", "\n", "mlvl_bboxes", ".", "append", "(", "bboxes", ")", "\n", "mlvl_scores", ".", "append", "(", "scores", ")", "\n", "mlvl_centerness", ".", "append", "(", "centerness", ")", "\n", "mlvl_iou", ".", "append", "(", "iou", ")", "\n", "", "mlvl_bboxes", "=", "torch", ".", "cat", "(", "mlvl_bboxes", ")", "\n", "if", "rescale", ":", "\n", "            ", "mlvl_bboxes", "/=", "mlvl_bboxes", ".", "new_tensor", "(", "scale_factor", ")", "\n", "", "mlvl_scores", "=", "torch", ".", "cat", "(", "mlvl_scores", ")", "\n", "padding", "=", "mlvl_scores", ".", "new_zeros", "(", "mlvl_scores", ".", "shape", "[", "0", "]", ",", "1", ")", "\n", "mlvl_scores", "=", "torch", ".", "cat", "(", "[", "padding", ",", "mlvl_scores", "]", ",", "dim", "=", "1", ")", "\n", "mlvl_centerness", "=", "torch", ".", "cat", "(", "mlvl_centerness", ")", "\n", "mlvl_iou", "=", "torch", ".", "cat", "(", "mlvl_iou", ")", "\n", "\n", "det_bboxes", ",", "det_labels", "=", "multiclass_nms", "(", "\n", "mlvl_bboxes", ",", "\n", "mlvl_scores", ",", "\n", "cfg", ".", "score_thr", ",", "\n", "cfg", ".", "nms", ",", "\n", "cfg", ".", "max_per_img", ")", "\n", "\n", "# det_bboxes, det_labels = multiclass_nms(", "\n", "#     mlvl_bboxes,", "\n", "#     mlvl_scores,", "\n", "#     cfg.score_thr,", "\n", "#     cfg.nms,", "\n", "#     cfg.max_per_img,", "\n", "#     score_factors=mlvl_iou", "\n", "# )", "\n", "\n", "\n", "# det_bboxes, det_labels = multiclass_nms(", "\n", "#     mlvl_bboxes,", "\n", "#     mlvl_scores,", "\n", "#     cfg.score_thr,", "\n", "#     cfg.nms,", "\n", "#     cfg.max_per_img,", "\n", "#     score_factors=mlvl_centerness)", "\n", "\n", "return", "det_bboxes", ",", "det_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_fcos_head.IoUawareFCOSHead.get_points": [[375, 392], ["range", "len", "mlvl_points.append", "iou_aware_fcos_head.IoUawareFCOSHead.get_points_single"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.get_points_single"], ["", "def", "get_points", "(", "self", ",", "featmap_sizes", ",", "dtype", ",", "device", ")", ":", "\n", "        ", "\"\"\"Get points according to feature map sizes.\n\n        Args:\n            featmap_sizes (list[tuple]): Multi-level feature map sizes.\n            dtype (torch.dtype): Type of points.\n            device (torch.device): Device of points.\n\n        Returns:\n            tuple: points of each image.\n        \"\"\"", "\n", "mlvl_points", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "featmap_sizes", ")", ")", ":", "\n", "            ", "mlvl_points", ".", "append", "(", "\n", "self", ".", "get_points_single", "(", "featmap_sizes", "[", "i", "]", ",", "self", ".", "strides", "[", "i", "]", ",", "\n", "dtype", ",", "device", ")", ")", "\n", "", "return", "mlvl_points", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_fcos_head.IoUawareFCOSHead.get_points_single": [[393, 403], ["torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "x.reshape", "y.reshape"], "methods", ["None"], ["", "def", "get_points_single", "(", "self", ",", "featmap_size", ",", "stride", ",", "dtype", ",", "device", ")", ":", "\n", "        ", "h", ",", "w", "=", "featmap_size", "\n", "x_range", "=", "torch", ".", "arange", "(", "\n", "0", ",", "w", "*", "stride", ",", "stride", ",", "dtype", "=", "dtype", ",", "device", "=", "device", ")", "\n", "y_range", "=", "torch", ".", "arange", "(", "\n", "0", ",", "h", "*", "stride", ",", "stride", ",", "dtype", "=", "dtype", ",", "device", "=", "device", ")", "\n", "y", ",", "x", "=", "torch", ".", "meshgrid", "(", "y_range", ",", "x_range", ")", "\n", "points", "=", "torch", ".", "stack", "(", "\n", "(", "x", ".", "reshape", "(", "-", "1", ")", ",", "y", ".", "reshape", "(", "-", "1", ")", ")", ",", "dim", "=", "-", "1", ")", "+", "stride", "//", "2", "\n", "return", "points", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_fcos_head.IoUawareFCOSHead.fcos_target": [[404, 441], ["len", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "mmdet.core.multi_apply", "range", "len", "len", "[].expand_as", "center.size", "labels.split", "bbox_targets.split", "concat_lvl_labels.append", "concat_lvl_bbox_targets.append", "range", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "points[].new_tensor"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.multi_apply"], ["", "def", "fcos_target", "(", "self", ",", "points", ",", "gt_bboxes_list", ",", "gt_labels_list", ")", ":", "\n", "        ", "assert", "len", "(", "points", ")", "==", "len", "(", "self", ".", "regress_ranges", ")", "\n", "num_levels", "=", "len", "(", "points", ")", "\n", "# expand regress ranges to align with points", "\n", "expanded_regress_ranges", "=", "[", "\n", "points", "[", "i", "]", ".", "new_tensor", "(", "self", ".", "regress_ranges", "[", "i", "]", ")", "[", "None", "]", ".", "expand_as", "(", "\n", "points", "[", "i", "]", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "# concat all levels points and regress ranges", "\n", "concat_regress_ranges", "=", "torch", ".", "cat", "(", "expanded_regress_ranges", ",", "dim", "=", "0", ")", "\n", "concat_points", "=", "torch", ".", "cat", "(", "points", ",", "dim", "=", "0", ")", "\n", "# get labels and bbox_targets of each image", "\n", "labels_list", ",", "bbox_targets_list", "=", "multi_apply", "(", "\n", "self", ".", "fcos_target_single", ",", "\n", "gt_bboxes_list", ",", "\n", "gt_labels_list", ",", "\n", "points", "=", "concat_points", ",", "\n", "regress_ranges", "=", "concat_regress_ranges", ")", "\n", "\n", "# split to per img, per level", "\n", "num_points", "=", "[", "center", ".", "size", "(", "0", ")", "for", "center", "in", "points", "]", "\n", "labels_list", "=", "[", "labels", ".", "split", "(", "num_points", ",", "0", ")", "for", "labels", "in", "labels_list", "]", "\n", "bbox_targets_list", "=", "[", "\n", "bbox_targets", ".", "split", "(", "num_points", ",", "0", ")", "\n", "for", "bbox_targets", "in", "bbox_targets_list", "\n", "]", "\n", "\n", "# concat per level image", "\n", "concat_lvl_labels", "=", "[", "]", "\n", "concat_lvl_bbox_targets", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "num_levels", ")", ":", "\n", "            ", "concat_lvl_labels", ".", "append", "(", "\n", "torch", ".", "cat", "(", "[", "labels", "[", "i", "]", "for", "labels", "in", "labels_list", "]", ")", ")", "\n", "concat_lvl_bbox_targets", ".", "append", "(", "\n", "torch", ".", "cat", "(", "\n", "[", "bbox_targets", "[", "i", "]", "for", "bbox_targets", "in", "bbox_targets_list", "]", ")", ")", "\n", "", "return", "concat_lvl_labels", ",", "concat_lvl_bbox_targets", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_fcos_head.IoUawareFCOSHead.fcos_target_single": [[442, 484], ["points.size", "gt_labels.size", "areas[].repeat", "regress_ranges[].expand", "gt_bboxes[].expand", "xs[].expand", "ys[].expand", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "areas[].repeat.min", "torch.stack.max", "torch.stack.max", "torch.stack.max", "torch.stack.min", "torch.stack.min", "torch.stack.min", "range"], "methods", ["None"], ["", "def", "fcos_target_single", "(", "self", ",", "gt_bboxes", ",", "gt_labels", ",", "points", ",", "regress_ranges", ")", ":", "\n", "        ", "num_points", "=", "points", ".", "size", "(", "0", ")", "\n", "num_gts", "=", "gt_labels", ".", "size", "(", "0", ")", "\n", "\n", "areas", "=", "(", "gt_bboxes", "[", ":", ",", "2", "]", "-", "gt_bboxes", "[", ":", ",", "0", "]", "+", "1", ")", "*", "(", "\n", "gt_bboxes", "[", ":", ",", "3", "]", "-", "gt_bboxes", "[", ":", ",", "1", "]", "+", "1", ")", "\n", "# TODO: figure out why these two are different", "\n", "# areas = areas[None].expand(num_points, num_gts)", "\n", "areas", "=", "areas", "[", "None", "]", ".", "repeat", "(", "num_points", ",", "1", ")", "\n", "regress_ranges", "=", "regress_ranges", "[", ":", ",", "None", ",", ":", "]", ".", "expand", "(", "\n", "num_points", ",", "num_gts", ",", "2", ")", "\n", "gt_bboxes", "=", "gt_bboxes", "[", "None", "]", ".", "expand", "(", "num_points", ",", "num_gts", ",", "4", ")", "\n", "xs", ",", "ys", "=", "points", "[", ":", ",", "0", "]", ",", "points", "[", ":", ",", "1", "]", "\n", "xs", "=", "xs", "[", ":", ",", "None", "]", ".", "expand", "(", "num_points", ",", "num_gts", ")", "\n", "ys", "=", "ys", "[", ":", ",", "None", "]", ".", "expand", "(", "num_points", ",", "num_gts", ")", "\n", "\n", "left", "=", "xs", "-", "gt_bboxes", "[", "...", ",", "0", "]", "\n", "right", "=", "gt_bboxes", "[", "...", ",", "2", "]", "-", "xs", "\n", "top", "=", "ys", "-", "gt_bboxes", "[", "...", ",", "1", "]", "\n", "bottom", "=", "gt_bboxes", "[", "...", ",", "3", "]", "-", "ys", "\n", "bbox_targets", "=", "torch", ".", "stack", "(", "(", "left", ",", "top", ",", "right", ",", "bottom", ")", ",", "-", "1", ")", "\n", "\n", "# condition1: inside a gt bbox", "\n", "inside_gt_bbox_mask", "=", "bbox_targets", ".", "min", "(", "-", "1", ")", "[", "0", "]", ">", "0", "\n", "\n", "# condition2: limit the regression range for each location", "\n", "max_regress_distance", "=", "bbox_targets", ".", "max", "(", "-", "1", ")", "[", "0", "]", "\n", "inside_regress_range", "=", "(", "\n", "max_regress_distance", ">=", "regress_ranges", "[", "...", ",", "0", "]", ")", "&", "(", "\n", "max_regress_distance", "<=", "regress_ranges", "[", "...", ",", "1", "]", ")", "\n", "\n", "# if there are still more than one objects for a location,", "\n", "# we choose the one with minimal area", "\n", "areas", "[", "inside_gt_bbox_mask", "==", "0", "]", "=", "INF", "\n", "areas", "[", "inside_regress_range", "==", "0", "]", "=", "INF", "\n", "min_area", ",", "min_area_inds", "=", "areas", ".", "min", "(", "dim", "=", "1", ")", "\n", "\n", "labels", "=", "gt_labels", "[", "min_area_inds", "]", "\n", "labels", "[", "min_area", "==", "INF", "]", "=", "0", "\n", "bbox_targets", "=", "bbox_targets", "[", "range", "(", "num_points", ")", ",", "min_area_inds", "]", "\n", "\n", "return", "labels", ",", "bbox_targets", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_fcos_head.IoUawareFCOSHead.centerness_target": [[485, 499], ["torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "left_right.min", "left_right.max", "top_bottom.min", "top_bottom.max"], "methods", ["None"], ["", "def", "centerness_target", "(", "self", ",", "pos_bbox_targets", ")", ":", "\n", "        ", "\"\"\"\n\n        :param pos_bbox_targets: tensor of shape (num, 4), store the top-left and bottom-right\n              corner of the corresponding ground truth boxes for the positives.\n        :return:\n        \"\"\"", "\n", "# only calculate pos centerness targets, otherwise there may be nan", "\n", "left_right", "=", "pos_bbox_targets", "[", ":", ",", "[", "0", ",", "2", "]", "]", "#(num, 2)", "\n", "top_bottom", "=", "pos_bbox_targets", "[", ":", ",", "[", "1", ",", "3", "]", "]", "#(num, 2)", "\n", "centerness_targets", "=", "(", "\n", "left_right", ".", "min", "(", "dim", "=", "-", "1", ")", "[", "0", "]", "/", "left_right", ".", "max", "(", "dim", "=", "-", "1", ")", "[", "0", "]", ")", "*", "(", "\n", "top_bottom", ".", "min", "(", "dim", "=", "-", "1", ")", "[", "0", "]", "/", "top_bottom", ".", "max", "(", "dim", "=", "-", "1", ")", "[", "0", "]", ")", "\n", "return", "torch", ".", "sqrt", "(", "centerness_targets", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.ga_retina_head.GARetinaHead.__init__": [[14, 25], ["guided_anchor_head.GuidedAnchorHead.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["def", "__init__", "(", "self", ",", "\n", "num_classes", ",", "\n", "in_channels", ",", "\n", "stacked_convs", "=", "4", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "None", ",", "\n", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "stacked_convs", "=", "stacked_convs", "\n", "self", ".", "conv_cfg", "=", "conv_cfg", "\n", "self", ".", "norm_cfg", "=", "norm_cfg", "\n", "super", "(", "GARetinaHead", ",", "self", ")", ".", "__init__", "(", "num_classes", ",", "in_channels", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.ga_retina_head.GARetinaHead._init_layers": [[26, 71], ["torch.ReLU", "torch.ModuleList", "torch.ModuleList", "range", "torch.Conv2d", "torch.Conv2d", "guided_anchor_head.FeatureAdaption", "guided_anchor_head.FeatureAdaption", "mmdet.ops.MaskedConv2d", "mmdet.ops.MaskedConv2d", "ga_retina_head.GARetinaHead.cls_convs.append", "ga_retina_head.GARetinaHead.reg_convs.append", "utils.ConvModule", "utils.ConvModule"], "methods", ["None"], ["", "def", "_init_layers", "(", "self", ")", ":", "\n", "        ", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "self", ".", "cls_convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "self", ".", "reg_convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "for", "i", "in", "range", "(", "self", ".", "stacked_convs", ")", ":", "\n", "            ", "chn", "=", "self", ".", "in_channels", "if", "i", "==", "0", "else", "self", ".", "feat_channels", "\n", "self", ".", "cls_convs", ".", "append", "(", "\n", "ConvModule", "(", "chn", ",", "\n", "self", ".", "feat_channels", ",", "\n", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ")", ")", "\n", "self", ".", "reg_convs", ".", "append", "(", "\n", "ConvModule", "(", "chn", ",", "\n", "self", ".", "feat_channels", ",", "\n", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ")", ")", "\n", "\n", "", "self", ".", "conv_loc", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "1", ",", "1", ")", "\n", "self", ".", "conv_shape", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "self", ".", "num_anchors", "*", "2", ",", "\n", "1", ")", "\n", "self", ".", "feature_adaption_cls", "=", "FeatureAdaption", "(", "\n", "self", ".", "feat_channels", ",", "\n", "self", ".", "feat_channels", ",", "\n", "kernel_size", "=", "3", ",", "\n", "deformable_groups", "=", "self", ".", "deformable_groups", ")", "\n", "self", ".", "feature_adaption_reg", "=", "FeatureAdaption", "(", "\n", "self", ".", "feat_channels", ",", "\n", "self", ".", "feat_channels", ",", "\n", "kernel_size", "=", "3", ",", "\n", "deformable_groups", "=", "self", ".", "deformable_groups", ")", "\n", "self", ".", "retina_cls", "=", "MaskedConv2d", "(", "self", ".", "feat_channels", ",", "\n", "self", ".", "num_anchors", "*", "\n", "self", ".", "cls_out_channels", ",", "\n", "3", ",", "\n", "padding", "=", "1", ")", "\n", "self", ".", "retina_reg", "=", "MaskedConv2d", "(", "self", ".", "feat_channels", ",", "\n", "self", ".", "num_anchors", "*", "4", ",", "\n", "3", ",", "\n", "padding", "=", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.ga_retina_head.GARetinaHead.init_weights": [[72, 86], ["ga_retina_head.GARetinaHead.feature_adaption_cls.init_weights", "ga_retina_head.GARetinaHead.feature_adaption_reg.init_weights", "utils.bias_init_with_prob", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.bias_init_with_prob", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "for", "m", "in", "self", ".", "cls_convs", ":", "\n", "            ", "normal_init", "(", "m", ".", "conv", ",", "std", "=", "0.01", ")", "\n", "", "for", "m", "in", "self", ".", "reg_convs", ":", "\n", "            ", "normal_init", "(", "m", ".", "conv", ",", "std", "=", "0.01", ")", "\n", "\n", "", "self", ".", "feature_adaption_cls", ".", "init_weights", "(", ")", "\n", "self", ".", "feature_adaption_reg", ".", "init_weights", "(", ")", "\n", "\n", "bias_cls", "=", "bias_init_with_prob", "(", "0.01", ")", "\n", "normal_init", "(", "self", ".", "conv_loc", ",", "std", "=", "0.01", ",", "bias", "=", "bias_cls", ")", "\n", "normal_init", "(", "self", ".", "conv_shape", ",", "std", "=", "0.01", ")", "\n", "normal_init", "(", "self", ".", "retina_cls", ",", "std", "=", "0.01", ",", "bias", "=", "bias_cls", ")", "\n", "normal_init", "(", "self", ".", "retina_reg", ",", "std", "=", "0.01", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.ga_retina_head.GARetinaHead.forward_single": [[87, 108], ["ga_retina_head.GARetinaHead.conv_loc", "ga_retina_head.GARetinaHead.conv_shape", "ga_retina_head.GARetinaHead.feature_adaption_cls", "ga_retina_head.GARetinaHead.feature_adaption_reg", "ga_retina_head.GARetinaHead.retina_cls", "ga_retina_head.GARetinaHead.retina_reg", "cls_conv", "reg_conv", "ga_retina_head.GARetinaHead.sigmoid"], "methods", ["None"], ["", "def", "forward_single", "(", "self", ",", "x", ")", ":", "\n", "        ", "cls_feat", "=", "x", "\n", "reg_feat", "=", "x", "\n", "for", "cls_conv", "in", "self", ".", "cls_convs", ":", "\n", "            ", "cls_feat", "=", "cls_conv", "(", "cls_feat", ")", "\n", "", "for", "reg_conv", "in", "self", ".", "reg_convs", ":", "\n", "            ", "reg_feat", "=", "reg_conv", "(", "reg_feat", ")", "\n", "\n", "", "loc_pred", "=", "self", ".", "conv_loc", "(", "cls_feat", ")", "\n", "shape_pred", "=", "self", ".", "conv_shape", "(", "reg_feat", ")", "\n", "\n", "cls_feat", "=", "self", ".", "feature_adaption_cls", "(", "cls_feat", ",", "shape_pred", ")", "\n", "reg_feat", "=", "self", ".", "feature_adaption_reg", "(", "reg_feat", ",", "shape_pred", ")", "\n", "\n", "if", "not", "self", ".", "training", ":", "\n", "            ", "mask", "=", "loc_pred", ".", "sigmoid", "(", ")", "[", "0", "]", ">=", "self", ".", "loc_filter_thr", "\n", "", "else", ":", "\n", "            ", "mask", "=", "None", "\n", "", "cls_score", "=", "self", ".", "retina_cls", "(", "cls_feat", ",", "mask", ")", "\n", "bbox_pred", "=", "self", ".", "retina_reg", "(", "reg_feat", ",", "mask", ")", "\n", "return", "cls_score", ",", "bbox_pred", ",", "shape_pred", ",", "loc_pred", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_ga_retina_head.IoUawareGARetinaHead.__init__": [[23, 34], ["guided_anchor_head.GuidedAnchorHead.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["def", "__init__", "(", "self", ",", "\n", "num_classes", ",", "\n", "in_channels", ",", "\n", "stacked_convs", "=", "4", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "None", ",", "\n", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "stacked_convs", "=", "stacked_convs", "\n", "self", ".", "conv_cfg", "=", "conv_cfg", "\n", "self", ".", "norm_cfg", "=", "norm_cfg", "\n", "super", "(", "IoUawareGARetinaHead", ",", "self", ")", ".", "__init__", "(", "num_classes", ",", "in_channels", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_ga_retina_head.IoUawareGARetinaHead._init_layers": [[35, 86], ["torch.ReLU", "torch.ReLU", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "range", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "guided_anchor_head.FeatureAdaption", "guided_anchor_head.FeatureAdaption", "mmdet.ops.MaskedConv2d", "mmdet.ops.MaskedConv2d", "mmdet.ops.MaskedConv2d", "iou_aware_ga_retina_head.IoUawareGARetinaHead.cls_convs.append", "iou_aware_ga_retina_head.IoUawareGARetinaHead.reg_convs.append", "utils.ConvModule", "utils.ConvModule"], "methods", ["None"], ["", "def", "_init_layers", "(", "self", ")", ":", "\n", "        ", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "self", ".", "cls_convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "self", ".", "reg_convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "for", "i", "in", "range", "(", "self", ".", "stacked_convs", ")", ":", "\n", "            ", "chn", "=", "self", ".", "in_channels", "if", "i", "==", "0", "else", "self", ".", "feat_channels", "\n", "self", ".", "cls_convs", ".", "append", "(", "\n", "ConvModule", "(", "chn", ",", "\n", "self", ".", "feat_channels", ",", "\n", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ")", ")", "\n", "self", ".", "reg_convs", ".", "append", "(", "\n", "ConvModule", "(", "chn", ",", "\n", "self", ".", "feat_channels", ",", "\n", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ")", ")", "\n", "\n", "", "self", ".", "conv_loc", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "1", ",", "1", ")", "\n", "self", ".", "conv_shape", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "self", ".", "num_anchors", "*", "2", ",", "\n", "1", ")", "\n", "self", ".", "feature_adaption_cls", "=", "FeatureAdaption", "(", "\n", "self", ".", "feat_channels", ",", "\n", "self", ".", "feat_channels", ",", "\n", "kernel_size", "=", "3", ",", "\n", "deformable_groups", "=", "self", ".", "deformable_groups", ")", "\n", "self", ".", "feature_adaption_reg", "=", "FeatureAdaption", "(", "\n", "self", ".", "feat_channels", ",", "\n", "self", ".", "feat_channels", ",", "\n", "kernel_size", "=", "3", ",", "\n", "deformable_groups", "=", "self", ".", "deformable_groups", ")", "\n", "self", ".", "retina_cls", "=", "MaskedConv2d", "(", "self", ".", "feat_channels", ",", "\n", "self", ".", "num_anchors", "*", "\n", "self", ".", "cls_out_channels", ",", "\n", "3", ",", "\n", "padding", "=", "1", ")", "\n", "self", ".", "retina_reg", "=", "MaskedConv2d", "(", "self", ".", "feat_channels", ",", "\n", "self", ".", "num_anchors", "*", "4", ",", "\n", "3", ",", "\n", "padding", "=", "1", ")", "\n", "\n", "# added by WSK", "\n", "self", ".", "retina_iou", "=", "MaskedConv2d", "(", "self", ".", "feat_channels", ",", "\n", "self", ".", "num_anchors", ",", "\n", "3", ",", "\n", "padding", "=", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_ga_retina_head.IoUawareGARetinaHead.init_weights": [[88, 105], ["iou_aware_ga_retina_head.IoUawareGARetinaHead.feature_adaption_cls.init_weights", "iou_aware_ga_retina_head.IoUawareGARetinaHead.feature_adaption_reg.init_weights", "utils.bias_init_with_prob", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.bias_init_with_prob", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "for", "m", "in", "self", ".", "cls_convs", ":", "\n", "            ", "normal_init", "(", "m", ".", "conv", ",", "std", "=", "0.01", ")", "\n", "", "for", "m", "in", "self", ".", "reg_convs", ":", "\n", "            ", "normal_init", "(", "m", ".", "conv", ",", "std", "=", "0.01", ")", "\n", "\n", "", "self", ".", "feature_adaption_cls", ".", "init_weights", "(", ")", "\n", "self", ".", "feature_adaption_reg", ".", "init_weights", "(", ")", "\n", "\n", "bias_cls", "=", "bias_init_with_prob", "(", "0.01", ")", "\n", "normal_init", "(", "self", ".", "conv_loc", ",", "std", "=", "0.01", ",", "bias", "=", "bias_cls", ")", "\n", "normal_init", "(", "self", ".", "conv_shape", ",", "std", "=", "0.01", ")", "\n", "normal_init", "(", "self", ".", "retina_cls", ",", "std", "=", "0.01", ",", "bias", "=", "bias_cls", ")", "\n", "normal_init", "(", "self", ".", "retina_reg", ",", "std", "=", "0.01", ")", "\n", "\n", "# added by WSK", "\n", "normal_init", "(", "self", ".", "retina_iou", ",", "std", "=", "0.01", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_ga_retina_head.IoUawareGARetinaHead.forward_single": [[106, 131], ["iou_aware_ga_retina_head.IoUawareGARetinaHead.conv_loc", "iou_aware_ga_retina_head.IoUawareGARetinaHead.conv_shape", "iou_aware_ga_retina_head.IoUawareGARetinaHead.feature_adaption_cls", "iou_aware_ga_retina_head.IoUawareGARetinaHead.feature_adaption_reg", "iou_aware_ga_retina_head.IoUawareGARetinaHead.retina_cls", "iou_aware_ga_retina_head.IoUawareGARetinaHead.retina_reg", "iou_aware_ga_retina_head.IoUawareGARetinaHead.retina_iou", "cls_conv", "reg_conv", "iou_aware_ga_retina_head.IoUawareGARetinaHead.sigmoid"], "methods", ["None"], ["", "def", "forward_single", "(", "self", ",", "x", ")", ":", "\n", "        ", "cls_feat", "=", "x", "\n", "reg_feat", "=", "x", "\n", "for", "cls_conv", "in", "self", ".", "cls_convs", ":", "\n", "            ", "cls_feat", "=", "cls_conv", "(", "cls_feat", ")", "\n", "", "for", "reg_conv", "in", "self", ".", "reg_convs", ":", "\n", "            ", "reg_feat", "=", "reg_conv", "(", "reg_feat", ")", "\n", "\n", "", "loc_pred", "=", "self", ".", "conv_loc", "(", "cls_feat", ")", "\n", "shape_pred", "=", "self", ".", "conv_shape", "(", "reg_feat", ")", "\n", "\n", "cls_feat", "=", "self", ".", "feature_adaption_cls", "(", "cls_feat", ",", "shape_pred", ")", "\n", "reg_feat", "=", "self", ".", "feature_adaption_reg", "(", "reg_feat", ",", "shape_pred", ")", "\n", "\n", "if", "not", "self", ".", "training", ":", "\n", "            ", "mask", "=", "loc_pred", ".", "sigmoid", "(", ")", "[", "0", "]", ">=", "self", ".", "loc_filter_thr", "\n", "", "else", ":", "\n", "            ", "mask", "=", "None", "\n", "", "cls_score", "=", "self", ".", "retina_cls", "(", "cls_feat", ",", "mask", ")", "\n", "bbox_pred", "=", "self", ".", "retina_reg", "(", "reg_feat", ",", "mask", ")", "\n", "\n", "# added by WSK", "\n", "iou_pred", "=", "self", ".", "retina_iou", "(", "reg_feat", ",", "mask", ")", "\n", "\n", "return", "cls_score", ",", "bbox_pred", ",", "iou_pred", ",", "shape_pred", ",", "loc_pred", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_ga_retina_head.IoUawareGARetinaHead.loss_single": [[133, 249], ["level_anchor.reshape.reshape.size", "bbox_targets.reshape.reshape.reshape", "bbox_weights.reshape.reshape.reshape", "level_anchor.reshape.reshape.reshape", "bbox_pred.permute().reshape.permute().reshape.permute().reshape", "mmdet.core.delta2bbox", "mmdet.core.delta2bbox", "mmdet.core.bbox_overlaps", "iou_pred.permute().reshape.permute().reshape.permute().reshape", "torch.split", "torch.split", "torch.split", "torch.split", "torch.squeeze", "torch.squeeze", "torch.squeeze", "torch.squeeze", "labels.reshape.reshape.reshape", "label_weights.reshape.reshape.reshape", "cls_score.permute().reshape.permute().reshape.permute().reshape", "iou_aware_ga_retina_head.IoUawareGARetinaHead.loss_bbox", "iou_aware_ga_retina_head.IoUawareGARetinaHead.loss_bbox", "mmdet.core.loss.weighted_iou_regression_loss", "mmdet.core.anchor.anchor_target.expand_binary_labels", "iou_aware_ga_retina_head.IoUawareGARetinaHead.loss_cls", "iou_aware_ga_retina_head.IoUawareGARetinaHead.loss_cls", "bbox_pred.permute().reshape.permute().reshape.permute", "iou_pred.permute().reshape.permute().reshape.permute", "cls_score.permute().reshape.permute().reshape.permute"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.weighted_iou_regression_loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.expand_binary_labels"], ["", "def", "loss_single", "(", "self", ",", "cls_score", ",", "bbox_pred", ",", "iou_pred", ",", "\n", "labels", ",", "label_weights", ",", "bbox_targets", ",", "bbox_weights", ",", "\n", "level_anchor", ",", "\n", "num_total_samples", ",", "\n", "gt_bboxes", ",", "# added by Shengkai Wu", "\n", "cfg", ")", ":", "\n", "        ", "\"\"\"\n        compute loss for a single layer of the prediction pyramid.\n        :param cls_score: tensor of shape (batch, A*num_class, width_i, height_i)\n        :param bbox_pred: tensor of shape (batch, A*4, width_i, height_i)\n        :param iou_pred: tensor of shape (batch, A, width_i, height_i), sigmoid layer has not been applied.\n        :param labels: For RetinaNet, tensor of shape (batch, A*width*height) storing gt labels such as 1, 2, 80 for\n              positive examples and 0 for negatives or others.\n        :param label_weights: the same as labels. 1 for positive and negative examples, 0 for invalid anchors and neutrals.\n        :param bbox_targets: tensor of shape (batch, A*width*height, 4). Store the parametrized coordinates of\n              targets for positives and 0 for negatives and others.\n        :param bbox_weights: tensor of shape (batch, A*width*height, 4). 1 for positives and 0 for negatives and others.\n        :param level_anchor: tensor of shape (batch, A*width*height, 4)\n        :param num_total_samples:\n        :param gt_bboxes: list of tensor. gt_boxes[i].size() = (num_truth_i, 4), store the top-left and bottom-right corner of\n              truth boxes for the i-th image.\n        :param cfg:\n        :return:\n        \"\"\"", "\n", "\n", "batch_size", "=", "level_anchor", ".", "size", "(", "0", ")", "\n", "bbox_targets", "=", "bbox_targets", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "bbox_weights", "=", "bbox_weights", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "# added by Shengkai Wu", "\n", "level_anchor", "=", "level_anchor", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "\n", "\n", "\n", "# compute the target for the IoU prediction head.", "\n", "# bbox_pred_1 = bbox_pred.permute(0, 2, 3, 1).reshape(batch_size, -1, 4)  # (batch, A*width_i*height_i, 4)", "\n", "# level_anchor_1 = level_anchor.reshape(batch_size, -1, 4) # (batch, A*width_i*height_i, 4)", "\n", "# max_iou_list = []", "\n", "# for i in range(batch_size):", "\n", "#     level_anchor_i = level_anchor_1[i, :, :].reshape(-1, 4)  # (A*width_i*height_i, 4)", "\n", "#     bbox_pred__i = bbox_pred_1[i, :, :].reshape(-1, 4)  # (A*width_i*height_i, 4)", "\n", "#     pred_bbox_i = delta2bbox(level_anchor_i, bbox_pred__i, self.target_means, self.target_stds)", "\n", "#     regressed_iou = bbox_overlaps(gt_bboxes[i], pred_bbox_i)  # (num_truth, A*width_i*height_i)", "\n", "#     # max_overlaps.size() = (A*width_i*height_i)", "\n", "#     max_iou, argmax_overlaps = regressed_iou.max(dim=0)", "\n", "#     max_iou_list.append(max_iou)", "\n", "# max_iou_target = torch.cat(max_iou_list, dim=0)  # (batch*A*width_i*height_i)", "\n", "\n", "bbox_pred", "=", "bbox_pred", ".", "permute", "(", "0", ",", "2", ",", "3", ",", "1", ")", ".", "reshape", "(", "-", "1", ",", "4", ")", "# (batch*A*width_i*height_i, 4)", "\n", "\n", "IoU_balanced_Cls", "=", "self", ".", "IoU_balanced_Cls", "\n", "IoU_balanced_Loc", "=", "self", ".", "IoU_balanced_Loc", "\n", "# if IoU_balanced_Loc or IoU_balanced_Cls:", "\n", "\n", "pred_box", "=", "delta2bbox", "(", "level_anchor", ",", "bbox_pred", ",", "self", ".", "target_means", ",", "self", ".", "target_stds", ")", "\n", "# the negatives will stores the anchors information(x, y, w, h)", "\n", "target_box", "=", "delta2bbox", "(", "level_anchor", ",", "bbox_targets", ",", "self", ".", "target_means", ",", "self", ".", "target_stds", ")", "\n", "iou", "=", "bbox_overlaps", "(", "target_box", ",", "pred_box", ",", "is_aligned", "=", "True", ")", "# (batch*width_i*height_i*A)", "\n", "\n", "if", "IoU_balanced_Loc", ":", "\n", "            ", "loss_bbox", "=", "self", ".", "loss_bbox", "(", "\n", "bbox_pred", ",", "\n", "bbox_targets", ",", "\n", "iou", ",", "\n", "bbox_weights", ",", "\n", "avg_factor", "=", "num_total_samples", ")", "\n", "", "else", ":", "\n", "            ", "loss_bbox", "=", "self", ".", "loss_bbox", "(", "\n", "bbox_pred", ",", "\n", "bbox_targets", ",", "\n", "bbox_weights", ",", "\n", "avg_factor", "=", "num_total_samples", ")", "\n", "\n", "# added by WSK", "\n", "", "iou_pred", "=", "iou_pred", ".", "permute", "(", "0", ",", "2", ",", "3", ",", "1", ")", ".", "reshape", "(", "-", "1", ")", "# (batch*width_i*height_i*A)", "\n", "bbox_weight_list", "=", "torch", ".", "split", "(", "bbox_weights", ",", "1", ",", "-", "1", ")", "\n", "bbox_weight", "=", "bbox_weight_list", "[", "0", "]", "\n", "bbox_weight", "=", "torch", ".", "squeeze", "(", "bbox_weight", ")", "# (batch*A*width_i*height_i)", "\n", "# for the positives, use the iou between each pos and its corresponding truth; for negatives and neutrals,", "\n", "# use the iou between each example and its nearest(with max iou) truth.", "\n", "# iou_target = iou*bbox_weight + max_iou_target*(1-bbox_weight)", "\n", "\n", "weight_iou", "=", "1.0", "\n", "loss_iou", "=", "weight_iou", "*", "weighted_iou_regression_loss", "(", "iou_pred", ",", "iou", ",", "bbox_weight", ",", "avg_factor", "=", "num_total_samples", ")", "\n", "# GHM for IoU prediction loss", "\n", "# loss_iou = self.loss_iou(iou_pred, iou, bbox_weight, avg_factor=num_total_samples)", "\n", "\n", "# classification loss: focal loss for positive and negative examples", "\n", "labels", "=", "labels", ".", "reshape", "(", "-", "1", ")", "\n", "label_weights", "=", "label_weights", ".", "reshape", "(", "-", "1", ")", "\n", "# # added by Shengkai Wu", "\n", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "# transform tensor 'label' from size (batch*A*width*height) to size (batch*A*width*height, num_class)", "\n", "#  and the same as tensor 'label_weights'. may be wrong for rpn", "\n", "            ", "labels", ",", "label_weights", "=", "expand_binary_labels", "(", "labels", ",", "label_weights", ",", "self", ".", "cls_out_channels", ")", "\n", "\n", "", "cls_score", "=", "cls_score", ".", "permute", "(", "0", ",", "2", ",", "3", ",", "\n", "1", ")", ".", "reshape", "(", "-", "1", ",", "self", ".", "cls_out_channels", ")", "\n", "if", "IoU_balanced_Cls", ":", "\n", "\n", "            ", "loss_cls", "=", "self", ".", "loss_cls", "(", "\n", "cls_score", ",", "\n", "labels", ",", "\n", "label_weights", ",", "\n", "iou", ",", "\n", "#", "\n", "avg_factor", "=", "num_total_samples", ")", "\n", "# print('test')", "\n", "\n", "", "else", ":", "\n", "            ", "loss_cls", "=", "self", ".", "loss_cls", "(", "\n", "cls_score", ",", "\n", "labels", ",", "\n", "label_weights", ",", "\n", "avg_factor", "=", "num_total_samples", ")", "\n", "\n", "", "return", "loss_cls", ",", "loss_bbox", ",", "loss_iou", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_ga_retina_head.IoUawareGARetinaHead.loss": [[252, 371], ["mmdet.core.ga_loc_target", "iou_aware_ga_retina_head.IoUawareGARetinaHead.get_sampled_approxs", "iou_aware_ga_retina_head.IoUawareGARetinaHead.get_anchors", "mmdet.core.ga_shape_target", "mmdet.core.anchor_target", "mmdet.core.multi_apply", "range", "range", "dict", "len", "len", "len", "iou_aware_ga_retina_head.IoUawareGARetinaHead.loss_loc_single", "losses_loc.append", "len", "iou_aware_ga_retina_head.IoUawareGARetinaHead.loss_shape_single", "losses_shape.append", "featmap.size", "hasattr"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.ga_loc_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.get_sampled_approxs", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.anchor_head.AnchorHead.get_anchors", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.ga_shape_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.anchor_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.multi_apply", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.loss_loc_single", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.loss_shape_single"], ["", "def", "loss", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "iou_preds", ",", "\n", "shape_preds", ",", "\n", "loc_preds", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "img_metas", ",", "\n", "cfg", ",", "\n", "gt_bboxes_ignore", "=", "None", ")", ":", "\n", "        ", "featmap_sizes", "=", "[", "featmap", ".", "size", "(", ")", "[", "-", "2", ":", "]", "for", "featmap", "in", "cls_scores", "]", "\n", "assert", "len", "(", "featmap_sizes", ")", "==", "len", "(", "self", ".", "approx_generators", ")", "\n", "\n", "# get loc targets", "\n", "loc_targets", ",", "loc_weights", ",", "loc_avg_factor", "=", "ga_loc_target", "(", "\n", "gt_bboxes", ",", "\n", "featmap_sizes", ",", "\n", "self", ".", "octave_base_scale", ",", "\n", "self", ".", "anchor_strides", ",", "\n", "center_ratio", "=", "cfg", ".", "center_ratio", ",", "\n", "ignore_ratio", "=", "cfg", ".", "ignore_ratio", ")", "\n", "\n", "# get sampled approxes", "\n", "approxs_list", ",", "inside_flag_list", "=", "self", ".", "get_sampled_approxs", "(", "\n", "featmap_sizes", ",", "img_metas", ",", "cfg", ")", "\n", "# get squares and guided anchors", "\n", "squares_list", ",", "guided_anchors_list", ",", "_", "=", "self", ".", "get_anchors", "(", "\n", "featmap_sizes", ",", "shape_preds", ",", "loc_preds", ",", "img_metas", ")", "\n", "\n", "# get shape targets", "\n", "sampling", "=", "False", "if", "not", "hasattr", "(", "cfg", ",", "'ga_sampler'", ")", "else", "True", "\n", "shape_targets", "=", "ga_shape_target", "(", "\n", "approxs_list", ",", "\n", "inside_flag_list", ",", "\n", "squares_list", ",", "\n", "gt_bboxes", ",", "\n", "img_metas", ",", "\n", "self", ".", "approxs_per_octave", ",", "\n", "cfg", ",", "\n", "sampling", "=", "sampling", ")", "\n", "if", "shape_targets", "is", "None", ":", "\n", "            ", "return", "None", "\n", "", "(", "bbox_anchors_list", ",", "bbox_gts_list", ",", "anchor_weights_list", ",", "anchor_fg_num", ",", "\n", "anchor_bg_num", ")", "=", "shape_targets", "\n", "anchor_total_num", "=", "(", "\n", "anchor_fg_num", "if", "not", "sampling", "else", "anchor_fg_num", "+", "anchor_bg_num", ")", "\n", "\n", "# get anchor targets", "\n", "sampling", "=", "False", "if", "self", ".", "cls_focal_loss", "else", "True", "\n", "label_channels", "=", "self", ".", "cls_out_channels", "if", "self", ".", "use_sigmoid_cls", "else", "1", "\n", "cls_reg_targets", "=", "anchor_target", "(", "\n", "guided_anchors_list", ",", "\n", "inside_flag_list", ",", "\n", "gt_bboxes", ",", "\n", "img_metas", ",", "\n", "self", ".", "target_means", ",", "\n", "self", ".", "target_stds", ",", "\n", "cfg", ",", "\n", "gt_bboxes_ignore_list", "=", "gt_bboxes_ignore", ",", "\n", "gt_labels_list", "=", "gt_labels", ",", "\n", "label_channels", "=", "label_channels", ",", "\n", "sampling", "=", "sampling", ")", "\n", "if", "cls_reg_targets", "is", "None", ":", "\n", "            ", "return", "None", "\n", "# (labels_list, label_weights_list, bbox_targets_list, bbox_weights_list,", "\n", "#  num_total_pos, num_total_neg) = cls_reg_targets", "\n", "\n", "", "(", "labels_list", ",", "label_weights_list", ",", "bbox_targets_list", ",", "bbox_weights_list", ",", "num_total_pos", ",", "num_total_neg", ",", "\n", "level_anchor_list", ")", "=", "cls_reg_targets", "\n", "\n", "\n", "num_total_samples", "=", "(", "\n", "num_total_pos", "if", "self", ".", "cls_focal_loss", "else", "num_total_pos", "+", "\n", "num_total_neg", ")", "\n", "\n", "# get classification and bbox regression losses", "\n", "losses_cls", ",", "losses_bbox", ",", "losses_iou", "=", "multi_apply", "(", "\n", "self", ".", "loss_single", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "iou_preds", ",", "\n", "labels_list", ",", "\n", "label_weights_list", ",", "\n", "bbox_targets_list", ",", "\n", "bbox_weights_list", ",", "\n", "level_anchor_list", ",", "# added by Shengkai Wu", "\n", "num_total_samples", "=", "num_total_samples", ",", "\n", "gt_bboxes", "=", "gt_bboxes", ",", "# added by Shengkai Wu", "\n", "cfg", "=", "cfg", ")", "\n", "\n", "# get anchor location loss", "\n", "losses_loc", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "loc_preds", ")", ")", ":", "\n", "            ", "loss_loc", "=", "self", ".", "loss_loc_single", "(", "\n", "loc_preds", "[", "i", "]", ",", "\n", "loc_targets", "[", "i", "]", ",", "\n", "loc_weights", "[", "i", "]", ",", "\n", "loc_avg_factor", "=", "loc_avg_factor", ",", "\n", "cfg", "=", "cfg", ")", "\n", "losses_loc", ".", "append", "(", "loss_loc", ")", "\n", "\n", "# get anchor shape loss", "\n", "", "losses_shape", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "shape_preds", ")", ")", ":", "\n", "            ", "loss_shape", "=", "self", ".", "loss_shape_single", "(", "\n", "shape_preds", "[", "i", "]", ",", "\n", "bbox_anchors_list", "[", "i", "]", ",", "\n", "bbox_gts_list", "[", "i", "]", ",", "\n", "anchor_weights_list", "[", "i", "]", ",", "\n", "anchor_total_num", "=", "anchor_total_num", ")", "\n", "losses_shape", ".", "append", "(", "loss_shape", ")", "\n", "\n", "", "return", "dict", "(", "\n", "loss_cls", "=", "losses_cls", ",", "\n", "loss_bbox", "=", "losses_bbox", ",", "\n", "loss_iou", "=", "losses_iou", ",", "\n", "loss_shape", "=", "losses_shape", ",", "\n", "loss_loc", "=", "losses_loc", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_ga_retina_head.IoUawareGARetinaHead.get_bboxes": [[372, 457], ["len", "iou_aware_ga_retina_head.IoUawareGARetinaHead.get_anchors", "range", "len", "len", "len", "len", "len", "len", "iou_aware_ga_retina_head.IoUawareGARetinaHead.get_bboxes_single", "result_list.append", "featmap.size", "[].detach", "[].detach", "[].detach", "[].detach", "[].detach", "range", "range", "range", "range", "range"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.anchor_head.AnchorHead.get_anchors", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.get_bboxes_single"], ["", "def", "get_bboxes", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "iou_preds", ",", "\n", "shape_preds", ",", "\n", "loc_preds", ",", "\n", "gt_bboxes", ",", "# added by WSK", "\n", "gt_labels", ",", "# aded by WSK", "\n", "img_metas", ",", "\n", "cfg", ",", "\n", "rescale", "=", "False", ")", ":", "\n", "        ", "\"\"\"\n\n        :param cls_scores: list[Tensor]. len(cls_scores) equals to the number of feature map levels.\n              and cls_scores[i].size() is (batch, A*C, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param bbox_preds: list[Tensor]. len(bbox_preds) equals to the number of feature map levels.\n              and bbox_preds[i].size() is (batch, A*4, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param iou_preds: list[Tensor]. len(iou_preds) equals to the number of feature map levels.\n              and iou_preds[i].size() is (batch, A, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param shape_preds:\n        :param loc_preds:\n        :param gt_bboxes: DC(mmcv.parallel.DataContainer), tensor of shape (num_gts, 4),represent\n             the coordinates of top-left and bottom-right corner for each gt box,  (x_tl, y_tl, x_br, y_br)\n        :param gt_labels: DC(mmcv.parallel.DataContainer), tensor of shape\n        :param img_metas: list[dict], Meta info of each image. DC(mmcv.parallel.DataContainer), the imformation about one image\n            dict{\n            ori_shape=ori_shape,\n            img_shape=img_shape,\n            pad_shape=pad_shape,\n            scale_factor=scale_factor,\n            flip=flip}\n        :param cfg: test.cfg\n        :param rescale:\n        :return:\n        \"\"\"", "\n", "assert", "len", "(", "cls_scores", ")", "==", "len", "(", "bbox_preds", ")", "==", "len", "(", "iou_preds", ")", "==", "len", "(", "shape_preds", ")", "==", "len", "(", "loc_preds", ")", "\n", "num_levels", "=", "len", "(", "cls_scores", ")", "\n", "featmap_sizes", "=", "[", "featmap", ".", "size", "(", ")", "[", "-", "2", ":", "]", "for", "featmap", "in", "cls_scores", "]", "\n", "# get guided anchors", "\n", "_", ",", "guided_anchors", ",", "loc_masks", "=", "self", ".", "get_anchors", "(", "\n", "featmap_sizes", ",", "\n", "shape_preds", ",", "\n", "loc_preds", ",", "\n", "img_metas", ",", "\n", "use_loc_filter", "=", "not", "self", ".", "training", ")", "\n", "result_list", "=", "[", "]", "\n", "for", "img_id", "in", "range", "(", "len", "(", "img_metas", ")", ")", ":", "\n", "            ", "cls_score_list", "=", "[", "\n", "cls_scores", "[", "i", "]", "[", "img_id", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "bbox_pred_list", "=", "[", "\n", "bbox_preds", "[", "i", "]", "[", "img_id", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "\n", "# added by WSK", "\n", "iou_pred_list", "=", "[", "\n", "iou_preds", "[", "i", "]", "[", "img_id", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "\n", "guided_anchor_list", "=", "[", "\n", "guided_anchors", "[", "img_id", "]", "[", "i", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "loc_mask_list", "=", "[", "\n", "loc_masks", "[", "img_id", "]", "[", "i", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "img_shape", "=", "img_metas", "[", "img_id", "]", "[", "'img_shape'", "]", "\n", "scale_factor", "=", "img_metas", "[", "img_id", "]", "[", "'scale_factor'", "]", "\n", "\n", "# added by WSK", "\n", "gt_bboxes_oneimg", "=", "gt_bboxes", "[", "img_id", "]", "\n", "gt_labels_oneimg", "=", "gt_labels", "[", "img_id", "]", "\n", "\n", "proposals", "=", "self", ".", "get_bboxes_single", "(", "cls_score_list", ",", "bbox_pred_list", ",", "\n", "iou_pred_list", ",", "# added by WSK", "\n", "guided_anchor_list", ",", "\n", "loc_mask_list", ",", "img_shape", ",", "\n", "scale_factor", ",", "\n", "gt_bboxes_oneimg", ",", "gt_labels_oneimg", ",", "# added by WSK", "\n", "cfg", ",", "rescale", ")", "\n", "result_list", ".", "append", "(", "proposals", ")", "\n", "", "return", "result_list", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_ga_retina_head.IoUawareGARetinaHead.get_bboxes_single": [[458, 559], ["zip", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "mmdet.core.multiclass_nms", "len", "len", "len", "len", "cls_score.permute().reshape.permute().reshape.permute().reshape", "bbox_pred.unsqueeze.unsqueeze.permute().reshape", "iou_pred.sigmoid.sigmoid.permute().reshape", "iou_pred.sigmoid.sigmoid.sigmoid", "iou_pred.sigmoid.sigmoid.view().expand", "cfg.get", "mmdet.core.delta2bbox", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.new_tensor", "torch.cat.new_tensor", "torch.cat.new_zeros", "torch.cat.new_zeros", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "mask.sum", "cls_score.permute().reshape.permute().reshape.sigmoid", "cls_score.permute().reshape.permute().reshape.softmax", "scores.unsqueeze.unsqueeze.size", "scores.unsqueeze.unsqueeze.dim", "anchors.unsqueeze.unsqueeze.unsqueeze", "scores.unsqueeze.unsqueeze.unsqueeze", "bbox_pred.unsqueeze.unsqueeze.unsqueeze", "max_scores.topk", "cls_score.permute().reshape.permute().reshape.size", "bbox_pred.unsqueeze.unsqueeze.size", "iou_pred.sigmoid.sigmoid.size", "cls_score.permute().reshape.permute().reshape.permute", "bbox_pred.unsqueeze.unsqueeze.permute", "iou_pred.sigmoid.sigmoid.permute", "iou_pred.sigmoid.sigmoid.view", "scores.unsqueeze.unsqueeze.max", "scores[].max"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.post_processing.bbox_nms.multiclass_nms", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox"], ["", "def", "get_bboxes_single", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "iou_preds", ",", "\n", "mlvl_anchors", ",", "\n", "mlvl_masks", ",", "\n", "img_shape", ",", "\n", "scale_factor", ",", "\n", "gt_bboxes", ",", "# added by WSK", "\n", "gt_labels", ",", "# added by WSK", "\n", "cfg", ",", "\n", "rescale", "=", "False", ")", ":", "\n", "        ", "\"\"\"\n\n        :param cls_scores: list[Tensor]. len(cls_scores) equals to the number of feature map levels.\n              and cls_scores[i].size() is (A*C, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param bbox_preds: list[Tensor]. len(bbox_preds) equals to the number of feature map levels.\n              and bbox_preds[i].size() is (A*4, width_i, height_i).\n        :param iou_preds: list[Tensor]. len(iou_preds) equals to the number of feature map levels.\n              and bbox_preds[i].size() is (A, width_i, height_i).\n        :param mlvl_anchors: list[Tensor]. len(mlvl_anchors) equals to the number of feature map levels.\n              and mlvl_anchors[i].size() is (width_i*height_i*A, 4).\n        :param mlvl_masks: list[Tensor]. len(mlvl_anchors) equals to the number of feature map levels.\n              and mlvl_anchors[i].size() is (width_i*height_i*A).\n        :param img_shape:\n        :param scale_factor:\n        :param gt_bboxes: tensor of shape (num_gts, 4), the coordinates of top-left and bottom-right corners\n        :param gt_labels:\n        :param cfg:\n        :param rescale:\n        :return:\n        \"\"\"", "\n", "assert", "len", "(", "cls_scores", ")", "==", "len", "(", "bbox_preds", ")", "==", "len", "(", "iou_preds", ")", "==", "len", "(", "mlvl_anchors", ")", "\n", "mlvl_bboxes", "=", "[", "]", "\n", "mlvl_scores", "=", "[", "]", "\n", "for", "cls_score", ",", "bbox_pred", ",", "iou_pred", ",", "anchors", ",", "mask", "in", "zip", "(", "cls_scores", ",", "bbox_preds", ",", "\n", "iou_preds", ",", "# added by WSK", "\n", "mlvl_anchors", ",", "\n", "mlvl_masks", ")", ":", "\n", "            ", "assert", "cls_score", ".", "size", "(", ")", "[", "-", "2", ":", "]", "==", "bbox_pred", ".", "size", "(", ")", "[", "-", "2", ":", "]", "==", "iou_pred", ".", "size", "(", ")", "[", "-", "2", ":", "]", "\n", "# if no location is kept, end.", "\n", "if", "mask", ".", "sum", "(", ")", "==", "0", ":", "\n", "                ", "continue", "\n", "# reshape scores and bbox_pred", "\n", "", "cls_score", "=", "cls_score", ".", "permute", "(", "1", ",", "2", ",", "\n", "0", ")", ".", "reshape", "(", "-", "1", ",", "self", ".", "cls_out_channels", ")", "\n", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "                ", "scores", "=", "cls_score", ".", "sigmoid", "(", ")", "\n", "", "else", ":", "\n", "                ", "scores", "=", "cls_score", ".", "softmax", "(", "-", "1", ")", "\n", "", "bbox_pred", "=", "bbox_pred", ".", "permute", "(", "1", ",", "2", ",", "0", ")", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "# added by WSK", "\n", "iou_pred", "=", "iou_pred", ".", "permute", "(", "1", ",", "2", ",", "0", ")", ".", "reshape", "(", "-", "1", ")", "\n", "iou_pred", "=", "iou_pred", ".", "sigmoid", "(", ")", "\n", "# filter scores, bbox_pred w.r.t. mask.", "\n", "# anchors are filtered in get_anchors() beforehand.", "\n", "scores", "=", "scores", "[", "mask", ",", ":", "]", "\n", "bbox_pred", "=", "bbox_pred", "[", "mask", ",", ":", "]", "\n", "# added by WSK", "\n", "iou_pred", "=", "iou_pred", "[", "mask", "]", "\n", "\n", "# multiply classification score with the class-agnostic IoU to compute the final", "\n", "# detection confidence", "\n", "alpha", "=", "1.0", "\n", "iou_expanded", "=", "iou_pred", ".", "view", "(", "-", "1", ",", "1", ")", ".", "expand", "(", "-", "1", ",", "scores", ".", "size", "(", "-", "1", ")", ")", "\n", "scores", "=", "scores", "*", "iou_expanded", "\n", "# scores = scores.pow(alpha) * iou_expanded.pow(1 - alpha)", "\n", "\n", "if", "scores", ".", "dim", "(", ")", "==", "0", ":", "\n", "                ", "anchors", "=", "anchors", ".", "unsqueeze", "(", "0", ")", "\n", "scores", "=", "scores", ".", "unsqueeze", "(", "0", ")", "\n", "bbox_pred", "=", "bbox_pred", ".", "unsqueeze", "(", "0", ")", "\n", "\n", "# filter anchors, bbox_pred, scores w.r.t. scores", "\n", "", "nms_pre", "=", "cfg", ".", "get", "(", "'nms_pre'", ",", "-", "1", ")", "\n", "if", "nms_pre", ">", "0", "and", "scores", ".", "shape", "[", "0", "]", ">", "nms_pre", ":", "\n", "                ", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "                    ", "max_scores", ",", "_", "=", "scores", ".", "max", "(", "dim", "=", "1", ")", "\n", "", "else", ":", "\n", "                    ", "max_scores", ",", "_", "=", "scores", "[", ":", ",", "1", ":", "]", ".", "max", "(", "dim", "=", "1", ")", "\n", "", "_", ",", "topk_inds", "=", "max_scores", ".", "topk", "(", "nms_pre", ")", "\n", "anchors", "=", "anchors", "[", "topk_inds", ",", ":", "]", "\n", "bbox_pred", "=", "bbox_pred", "[", "topk_inds", ",", ":", "]", "\n", "scores", "=", "scores", "[", "topk_inds", ",", ":", "]", "\n", "", "bboxes", "=", "delta2bbox", "(", "anchors", ",", "bbox_pred", ",", "self", ".", "target_means", ",", "\n", "self", ".", "target_stds", ",", "img_shape", ")", "\n", "mlvl_bboxes", ".", "append", "(", "bboxes", ")", "\n", "mlvl_scores", ".", "append", "(", "scores", ")", "\n", "", "mlvl_bboxes", "=", "torch", ".", "cat", "(", "mlvl_bboxes", ")", "\n", "if", "rescale", ":", "\n", "            ", "mlvl_bboxes", "/=", "mlvl_bboxes", ".", "new_tensor", "(", "scale_factor", ")", "\n", "", "mlvl_scores", "=", "torch", ".", "cat", "(", "mlvl_scores", ")", "\n", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "            ", "padding", "=", "mlvl_scores", ".", "new_zeros", "(", "mlvl_scores", ".", "shape", "[", "0", "]", ",", "1", ")", "\n", "mlvl_scores", "=", "torch", ".", "cat", "(", "[", "padding", ",", "mlvl_scores", "]", ",", "dim", "=", "1", ")", "\n", "# multi class NMS", "\n", "", "det_bboxes", ",", "det_labels", "=", "multiclass_nms", "(", "mlvl_bboxes", ",", "mlvl_scores", ",", "\n", "cfg", ".", "score_thr", ",", "cfg", ".", "nms", ",", "\n", "cfg", ".", "max_per_img", ")", "\n", "return", "det_bboxes", ",", "det_labels", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.ssd_head.SSDHead.__init__": [[18, 97], ["anchor_head.AnchorHead.__init__", "range", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "int", "int", "int", "range", "range", "len", "reg_convs.append", "cls_convs.append", "int", "min_sizes.append", "max_sizes.append", "len", "mmdet.core.AnchorGenerator", "list", "list.insert", "torch.index_select", "torch.index_select", "torch.index_select", "torch.index_select", "torch.index_select", "torch.index_select", "torch.index_select", "torch.index_select", "torch.index_select", "ssd_head.SSDHead.anchor_generators.append", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "numpy.floor", "int", "int", "int", "min_sizes.insert", "max_sizes.insert", "numpy.sqrt", "range", "len", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "len", "len", "int", "int", "min_sizes.insert", "max_sizes.insert", "min_sizes.insert", "max_sizes.insert", "len", "int", "int", "int", "int", "min_sizes.insert", "max_sizes.insert", "int", "int"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "\n", "input_size", "=", "300", ",", "\n", "num_classes", "=", "81", ",", "\n", "in_channels", "=", "(", "512", ",", "1024", ",", "512", ",", "256", ",", "256", ",", "256", ")", ",", "\n", "anchor_strides", "=", "(", "8", ",", "16", ",", "32", ",", "64", ",", "100", ",", "300", ")", ",", "\n", "basesize_ratio_range", "=", "(", "0.1", ",", "0.9", ")", ",", "\n", "anchor_ratios", "=", "(", "[", "2", "]", ",", "[", "2", ",", "3", "]", ",", "[", "2", ",", "3", "]", ",", "[", "2", ",", "3", "]", ",", "[", "2", "]", ",", "[", "2", "]", ")", ",", "\n", "target_means", "=", "(", ".0", ",", ".0", ",", ".0", ",", ".0", ")", ",", "\n", "target_stds", "=", "(", "1.0", ",", "1.0", ",", "1.0", ",", "1.0", ")", ")", ":", "\n", "        ", "super", "(", "AnchorHead", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "input_size", "=", "input_size", "\n", "self", ".", "num_classes", "=", "num_classes", "\n", "self", ".", "in_channels", "=", "in_channels", "\n", "self", ".", "cls_out_channels", "=", "num_classes", "\n", "\n", "num_anchors", "=", "[", "len", "(", "ratios", ")", "*", "2", "+", "2", "for", "ratios", "in", "anchor_ratios", "]", "\n", "reg_convs", "=", "[", "]", "\n", "cls_convs", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "in_channels", ")", ")", ":", "\n", "            ", "reg_convs", ".", "append", "(", "\n", "nn", ".", "Conv2d", "(", "\n", "in_channels", "[", "i", "]", ",", "\n", "num_anchors", "[", "i", "]", "*", "4", ",", "\n", "kernel_size", "=", "3", ",", "\n", "padding", "=", "1", ")", ")", "\n", "cls_convs", ".", "append", "(", "\n", "nn", ".", "Conv2d", "(", "\n", "in_channels", "[", "i", "]", ",", "\n", "num_anchors", "[", "i", "]", "*", "num_classes", ",", "\n", "kernel_size", "=", "3", ",", "\n", "padding", "=", "1", ")", ")", "\n", "", "self", ".", "reg_convs", "=", "nn", ".", "ModuleList", "(", "reg_convs", ")", "\n", "self", ".", "cls_convs", "=", "nn", ".", "ModuleList", "(", "cls_convs", ")", "\n", "\n", "min_ratio", ",", "max_ratio", "=", "basesize_ratio_range", "\n", "min_ratio", "=", "int", "(", "min_ratio", "*", "100", ")", "\n", "max_ratio", "=", "int", "(", "max_ratio", "*", "100", ")", "\n", "step", "=", "int", "(", "np", ".", "floor", "(", "max_ratio", "-", "min_ratio", ")", "/", "(", "len", "(", "in_channels", ")", "-", "2", ")", ")", "\n", "min_sizes", "=", "[", "]", "\n", "max_sizes", "=", "[", "]", "\n", "for", "r", "in", "range", "(", "int", "(", "min_ratio", ")", ",", "int", "(", "max_ratio", ")", "+", "1", ",", "step", ")", ":", "\n", "            ", "min_sizes", ".", "append", "(", "int", "(", "input_size", "*", "r", "/", "100", ")", ")", "\n", "max_sizes", ".", "append", "(", "int", "(", "input_size", "*", "(", "r", "+", "step", ")", "/", "100", ")", ")", "\n", "", "if", "input_size", "==", "300", ":", "\n", "            ", "if", "basesize_ratio_range", "[", "0", "]", "==", "0.15", ":", "# SSD300 COCO", "\n", "                ", "min_sizes", ".", "insert", "(", "0", ",", "int", "(", "input_size", "*", "7", "/", "100", ")", ")", "\n", "max_sizes", ".", "insert", "(", "0", ",", "int", "(", "input_size", "*", "15", "/", "100", ")", ")", "\n", "", "elif", "basesize_ratio_range", "[", "0", "]", "==", "0.2", ":", "# SSD300 VOC", "\n", "                ", "min_sizes", ".", "insert", "(", "0", ",", "int", "(", "input_size", "*", "10", "/", "100", ")", ")", "\n", "max_sizes", ".", "insert", "(", "0", ",", "int", "(", "input_size", "*", "20", "/", "100", ")", ")", "\n", "", "", "elif", "input_size", "==", "512", ":", "\n", "            ", "if", "basesize_ratio_range", "[", "0", "]", "==", "0.1", ":", "# SSD512 COCO", "\n", "                ", "min_sizes", ".", "insert", "(", "0", ",", "int", "(", "input_size", "*", "4", "/", "100", ")", ")", "\n", "max_sizes", ".", "insert", "(", "0", ",", "int", "(", "input_size", "*", "10", "/", "100", ")", ")", "\n", "", "elif", "basesize_ratio_range", "[", "0", "]", "==", "0.15", ":", "# SSD512 VOC", "\n", "                ", "min_sizes", ".", "insert", "(", "0", ",", "int", "(", "input_size", "*", "7", "/", "100", ")", ")", "\n", "max_sizes", ".", "insert", "(", "0", ",", "int", "(", "input_size", "*", "15", "/", "100", ")", ")", "\n", "", "", "self", ".", "anchor_generators", "=", "[", "]", "\n", "self", ".", "anchor_strides", "=", "anchor_strides", "\n", "for", "k", "in", "range", "(", "len", "(", "anchor_strides", ")", ")", ":", "\n", "            ", "base_size", "=", "min_sizes", "[", "k", "]", "\n", "stride", "=", "anchor_strides", "[", "k", "]", "\n", "ctr", "=", "(", "(", "stride", "-", "1", ")", "/", "2.", ",", "(", "stride", "-", "1", ")", "/", "2.", ")", "\n", "scales", "=", "[", "1.", ",", "np", ".", "sqrt", "(", "max_sizes", "[", "k", "]", "/", "min_sizes", "[", "k", "]", ")", "]", "\n", "ratios", "=", "[", "1.", "]", "\n", "for", "r", "in", "anchor_ratios", "[", "k", "]", ":", "\n", "                ", "ratios", "+=", "[", "1", "/", "r", ",", "r", "]", "# 4 or 6 ratio", "\n", "", "anchor_generator", "=", "AnchorGenerator", "(", "\n", "base_size", ",", "scales", ",", "ratios", ",", "scale_major", "=", "False", ",", "ctr", "=", "ctr", ")", "\n", "indices", "=", "list", "(", "range", "(", "len", "(", "ratios", ")", ")", ")", "\n", "indices", ".", "insert", "(", "1", ",", "len", "(", "indices", ")", ")", "\n", "anchor_generator", ".", "base_anchors", "=", "torch", ".", "index_select", "(", "\n", "anchor_generator", ".", "base_anchors", ",", "0", ",", "torch", ".", "LongTensor", "(", "indices", ")", ")", "\n", "self", ".", "anchor_generators", ".", "append", "(", "anchor_generator", ")", "\n", "\n", "", "self", ".", "target_means", "=", "target_means", "\n", "self", ".", "target_stds", "=", "target_stds", "\n", "self", ".", "use_sigmoid_cls", "=", "False", "\n", "self", ".", "cls_focal_loss", "=", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.ssd_head.SSDHead.init_weights": [[98, 102], ["ssd_head.SSDHead.modules", "isinstance", "mmcv.cnn.xavier_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.xavier_init"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "for", "m", "in", "self", ".", "modules", "(", ")", ":", "\n", "            ", "if", "isinstance", "(", "m", ",", "nn", ".", "Conv2d", ")", ":", "\n", "                ", "xavier_init", "(", "m", ",", "distribution", "=", "'uniform'", ",", "bias", "=", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.ssd_head.SSDHead.forward": [[103, 111], ["zip", "cls_scores.append", "bbox_preds.append", "cls_conv", "reg_conv"], "methods", ["None"], ["", "", "", "def", "forward", "(", "self", ",", "feats", ")", ":", "\n", "        ", "cls_scores", "=", "[", "]", "\n", "bbox_preds", "=", "[", "]", "\n", "for", "feat", ",", "reg_conv", ",", "cls_conv", "in", "zip", "(", "feats", ",", "self", ".", "reg_convs", ",", "\n", "self", ".", "cls_convs", ")", ":", "\n", "            ", "cls_scores", ".", "append", "(", "cls_conv", "(", "feat", ")", ")", "\n", "bbox_preds", ".", "append", "(", "reg_conv", "(", "feat", ")", ")", "\n", "", "return", "cls_scores", ",", "bbox_preds", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.ssd_head.SSDHead.loss_single": [[112, 189], ["pos_inds.size", "loss_cls_all[].topk", "loss_cls_all[].sum", "topk_loss_cls_neg.sum", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "mmdet.core.delta2bbox", "mmdet.core.delta2bbox", "mmdet.core.bbox_overlaps", "mmdet.core.bbox_overlaps.new_zeros", "normalized_iou_weights.detach.detach.detach", "neg_inds.size", "neg_inds.size", "mmdet.core.weighted_smoothl1", "mmdet.core.bbox_overlaps.size", "mmdet.core.weighted_iou_balanced_smoothl1"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.weighted_smoothl1", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.weighted_iou_balanced_smoothl1"], ["", "def", "loss_single", "(", "self", ",", "cls_score", ",", "bbox_pred", ",", "labels", ",", "label_weights", ",", "\n", "bbox_targets", ",", "bbox_weights", ",", "anchors", ",", "num_total_samples", ",", "cfg", ")", ":", "\n", "        ", "\"\"\"\n        compute the losses for one image\n        :param cls_score: tensor of shape [num_total_examples, cls_out_channels]\n        :param bbox_pred: tensor of shape [num_total_examples, 4] or [num_total_examples, 5]\n        :param labels: tensor os shape [num_total_examples] storing gt labels such as\n               0, 1, 2, 80 for corresponding class.\n        :param label_weights: tensor of shape [num_total_examples]\n        :param bbox_targets: tensor of shape [num_total_examples, 4], Store the parametrized\n               coordinates of targets for positives and 0 for negatives.\n        :param bbox_weights: tensor of shape [num_total_examples, 4], 1 for positives and 0 for negatives and neutrals.\n        :param anchors: tensor of shape [num_total_examples, 4]\n        :param num_total_samples: the number of positive examples.\n        :param cfg:\n        :return:\n        \"\"\"", "\n", "loss_cls_all", "=", "F", ".", "cross_entropy", "(", "\n", "cls_score", ",", "labels", ",", "reduction", "=", "'none'", ")", "*", "label_weights", "\n", "# index tensor of shape (Pos, 1), each row is a index for a non-zero element.", "\n", "pos_inds", "=", "(", "labels", ">", "0", ")", ".", "nonzero", "(", ")", ".", "view", "(", "-", "1", ")", "\n", "neg_inds", "=", "(", "labels", "==", "0", ")", ".", "nonzero", "(", ")", ".", "view", "(", "-", "1", ")", "# (Neg, 1)", "\n", "\n", "# added by Shengkai Wu", "\n", "IoU_balanced_Cls", "=", "False", "\n", "IoU_balanced_Loc", "=", "False", "\n", "eta", "=", "1.5", "\n", "delta", "=", "1.5", "\n", "cls_loss_weight", "=", "1.0", "\n", "bbox_loss_weight", "=", "1.0", "\n", "\n", "if", "IoU_balanced_Cls", "or", "IoU_balanced_Loc", ":", "\n", "            ", "pred_box", "=", "delta2bbox", "(", "anchors", ",", "bbox_pred", ",", "self", ".", "target_means", ",", "self", ".", "target_stds", ")", "\n", "# the negatives will stores the anchors information(x, y, w, h)", "\n", "target_box", "=", "delta2bbox", "(", "anchors", ",", "bbox_targets", ",", "self", ".", "target_means", ",", "self", ".", "target_stds", ")", "\n", "# iou between the regressed positive example and the corresponding ground truth box or", "\n", "# iou between the regressed negative example and the original negative example.", "\n", "iou", "=", "bbox_overlaps", "(", "target_box", ",", "pred_box", ",", "is_aligned", "=", "True", ")", "\n", "\n", "", "if", "IoU_balanced_Cls", ":", "\n", "            ", "target", "=", "iou", ".", "new_zeros", "(", "iou", ".", "size", "(", "0", ")", ")", "\n", "target", "[", "pos_inds", "]", "=", "1", "\n", "# target = target.type_as(cls_score)", "\n", "iou_weights", "=", "(", "1", "-", "target", ")", "+", "(", "target", "*", "iou", ")", ".", "pow", "(", "eta", ")", "\n", "raw2", "=", "loss_cls_all", "*", "iou_weights", "\n", "normalizer", "=", "(", "loss_cls_all", "*", "target", ")", ".", "sum", "(", ")", "/", "(", "(", "raw2", "*", "target", ")", ".", "sum", "(", ")", "+", "1e-6", ")", "\n", "normalized_iou_weights", "=", "(", "1", "-", "target", ")", "+", "(", "target", "*", "iou", ")", ".", "pow", "(", "eta", ")", "*", "normalizer", "\n", "normalized_iou_weights", "=", "normalized_iou_weights", ".", "detach", "(", ")", "\n", "loss_cls_all", "=", "loss_cls_all", "*", "normalized_iou_weights", "\n", "\n", "", "num_pos_samples", "=", "pos_inds", ".", "size", "(", "0", ")", "\n", "num_neg_samples", "=", "cfg", ".", "neg_pos_ratio", "*", "num_pos_samples", "\n", "if", "num_neg_samples", ">", "neg_inds", ".", "size", "(", "0", ")", ":", "\n", "            ", "num_neg_samples", "=", "neg_inds", ".", "size", "(", "0", ")", "\n", "", "topk_loss_cls_neg", ",", "_", "=", "loss_cls_all", "[", "neg_inds", "]", ".", "topk", "(", "num_neg_samples", ")", "\n", "loss_cls_pos", "=", "loss_cls_all", "[", "pos_inds", "]", ".", "sum", "(", ")", "\n", "loss_cls_neg", "=", "topk_loss_cls_neg", ".", "sum", "(", ")", "\n", "loss_cls", "=", "(", "loss_cls_pos", "+", "loss_cls_neg", ")", "/", "num_total_samples", "\n", "\n", "if", "IoU_balanced_Loc", ":", "\n", "            ", "loss_bbox", "=", "bbox_loss_weight", "*", "weighted_iou_balanced_smoothl1", "(", "\n", "bbox_pred", ",", "\n", "bbox_targets", ",", "\n", "iou", ",", "\n", "bbox_weights", ",", "\n", "beta", "=", "cfg", ".", "smoothl1_beta", ",", "\n", "delta", "=", "delta", ",", "\n", "avg_factor", "=", "num_total_samples", ")", "\n", "", "else", ":", "\n", "            ", "loss_bbox", "=", "weighted_smoothl1", "(", "\n", "bbox_pred", ",", "\n", "bbox_targets", ",", "\n", "bbox_weights", ",", "\n", "beta", "=", "cfg", ".", "smoothl1_beta", ",", "\n", "avg_factor", "=", "num_total_samples", ")", "\n", "\n", "", "return", "loss_cls", "[", "None", "]", ",", "loss_bbox", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.ssd_head.SSDHead.loss": [[190, 277], ["ssd_head.SSDHead.get_anchors", "mmdet.core.anchor_target", "len", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "torch.cat().view", "mmdet.core.multi_apply", "dict", "len", "len", "featmap.size", "s.permute().reshape", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "b.permute().reshape", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "s.permute", "b.permute"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.anchor_head.AnchorHead.get_anchors", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.anchor_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.multi_apply"], ["", "def", "loss", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "img_metas", ",", "\n", "cfg", ",", "\n", "gt_bboxes_ignore", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n\n        :param cls_scores: list of tensors. len(cls_scores) is the number of levels for the feature pyramid.\n          cls_scores[i].size() = [num_images, A*cls_out_channels, width_i, height_i]\n        :param bbox_preds: list of tensors. len(bbox_preds) is the number of levels for the feature pyramid.\n              bbox_preds[i].size() = [num_images, A*4, width_i, height_i] or [num_images, A*5, width_i, height_i]\n        :param gt_bboxes:\n        :param gt_labels:\n        :param img_metas:\n        :param cfg:\n        :param gt_bboxes_ignore:\n        :return:\n        \"\"\"", "\n", "featmap_sizes", "=", "[", "featmap", ".", "size", "(", ")", "[", "-", "2", ":", "]", "for", "featmap", "in", "cls_scores", "]", "\n", "assert", "len", "(", "featmap_sizes", ")", "==", "len", "(", "self", ".", "anchor_generators", ")", "\n", "\n", "anchor_list", ",", "valid_flag_list", "=", "self", ".", "get_anchors", "(", "\n", "featmap_sizes", ",", "img_metas", ")", "\n", "cls_reg_targets", "=", "anchor_target", "(", "\n", "anchor_list", ",", "\n", "valid_flag_list", ",", "\n", "gt_bboxes", ",", "\n", "img_metas", ",", "\n", "self", ".", "target_means", ",", "\n", "self", ".", "target_stds", ",", "\n", "cfg", ",", "\n", "gt_bboxes_ignore_list", "=", "gt_bboxes_ignore", ",", "\n", "gt_labels_list", "=", "gt_labels", ",", "\n", "label_channels", "=", "1", ",", "\n", "sampling", "=", "False", ",", "\n", "unmap_outputs", "=", "False", ")", "\n", "if", "cls_reg_targets", "is", "None", ":", "\n", "            ", "return", "None", "\n", "# modifyied by Shengkai Wu", "\n", "", "(", "labels_list", ",", "label_weights_list", ",", "bbox_targets_list", ",", "bbox_weights_list", ",", "\n", "num_total_pos", ",", "num_total_neg", ",", "level_anchor_list", ")", "=", "cls_reg_targets", "\n", "\n", "num_images", "=", "len", "(", "img_metas", ")", "\n", "all_cls_scores", "=", "torch", ".", "cat", "(", "[", "\n", "s", ".", "permute", "(", "0", ",", "2", ",", "3", ",", "1", ")", ".", "reshape", "(", "\n", "num_images", ",", "-", "1", ",", "self", ".", "cls_out_channels", ")", "for", "s", "in", "cls_scores", "\n", "]", ",", "1", ")", "\n", "all_labels", "=", "torch", ".", "cat", "(", "labels_list", ",", "-", "1", ")", ".", "view", "(", "num_images", ",", "-", "1", ")", "\n", "all_label_weights", "=", "torch", ".", "cat", "(", "label_weights_list", ",", "\n", "-", "1", ")", ".", "view", "(", "num_images", ",", "-", "1", ")", "\n", "\n", "\n", "all_bbox_preds", "=", "torch", ".", "cat", "(", "[", "\n", "b", ".", "permute", "(", "0", ",", "2", ",", "3", ",", "1", ")", ".", "reshape", "(", "num_images", ",", "-", "1", ",", "4", ")", "\n", "for", "b", "in", "bbox_preds", "\n", "]", ",", "-", "2", ")", "\n", "\n", "all_bbox_targets", "=", "torch", ".", "cat", "(", "bbox_targets_list", ",", "\n", "-", "2", ")", ".", "view", "(", "num_images", ",", "-", "1", ",", "4", ")", "\n", "all_bbox_weights", "=", "torch", ".", "cat", "(", "bbox_weights_list", ",", "\n", "-", "2", ")", ".", "view", "(", "num_images", ",", "-", "1", ",", "4", ")", "\n", "# added by Shengkai Wu", "\n", "all_anchors", "=", "torch", ".", "cat", "(", "level_anchor_list", ",", "-", "2", ")", ".", "view", "(", "num_images", ",", "-", "1", ",", "4", ")", "\n", "# num_total_examples = num_total_pos + num_total_neg", "\n", "# all_cls_scores.size() = [num_images,num_total_examples , cls_out_channels]", "\n", "# all_bbox_preds.size() = [num_image, num_total_examples, 4]", "\n", "# all_labels.size() = [num_images, num_total_examples]", "\n", "# all_label_weights.size() = [num_images, num_total_examples]", "\n", "# all_bbox_preds.size() = [num_images, num_total_examples, 4]", "\n", "# all_bbox_targets.size() = [num_images, num_total_examples, 4]", "\n", "# all_bbox_weights.size() = [num_images, num_total_examples, 4]", "\n", "\n", "losses_cls", ",", "losses_bbox", "=", "multi_apply", "(", "\n", "self", ".", "loss_single", ",", "\n", "all_cls_scores", ",", "\n", "all_bbox_preds", ",", "\n", "all_labels", ",", "\n", "all_label_weights", ",", "\n", "all_bbox_targets", ",", "\n", "all_bbox_weights", ",", "\n", "all_anchors", ",", "#added by Shengkai Wu", "\n", "num_total_samples", "=", "num_total_pos", ",", "\n", "cfg", "=", "cfg", ")", "\n", "return", "dict", "(", "loss_cls", "=", "losses_cls", ",", "loss_bbox", "=", "losses_bbox", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.FeatureAdaption.__init__": [[32, 48], ["torch.Module.__init__", "torch.Conv2d", "torch.Conv2d", "mmdet.ops.DeformConv", "torch.ReLU", "torch.ReLU"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["def", "__init__", "(", "self", ",", "\n", "in_channels", ",", "\n", "out_channels", ",", "\n", "kernel_size", "=", "3", ",", "\n", "deformable_groups", "=", "4", ")", ":", "\n", "        ", "super", "(", "FeatureAdaption", ",", "self", ")", ".", "__init__", "(", ")", "\n", "offset_channels", "=", "kernel_size", "*", "kernel_size", "*", "2", "\n", "self", ".", "conv_offset", "=", "nn", ".", "Conv2d", "(", "\n", "2", ",", "deformable_groups", "*", "offset_channels", ",", "1", ",", "bias", "=", "False", ")", "\n", "self", ".", "conv_adaption", "=", "DeformConv", "(", "\n", "in_channels", ",", "\n", "out_channels", ",", "\n", "kernel_size", "=", "kernel_size", ",", "\n", "padding", "=", "(", "kernel_size", "-", "1", ")", "//", "2", ",", "\n", "deformable_groups", "=", "deformable_groups", ")", "\n", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.FeatureAdaption.init_weights": [[49, 52], ["mmcv.cnn.normal_init", "mmcv.cnn.normal_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "normal_init", "(", "self", ".", "conv_offset", ",", "std", "=", "0.1", ")", "\n", "normal_init", "(", "self", ".", "conv_adaption", ",", "std", "=", "0.01", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.FeatureAdaption.forward": [[53, 57], ["guided_anchor_head.FeatureAdaption.conv_offset", "guided_anchor_head.FeatureAdaption.relu", "shape.detach", "guided_anchor_head.FeatureAdaption.conv_adaption"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "shape", ")", ":", "\n", "        ", "offset", "=", "self", ".", "conv_offset", "(", "shape", ".", "detach", "(", ")", ")", "\n", "x", "=", "self", ".", "relu", "(", "self", ".", "conv_adaption", "(", "x", ",", "offset", ")", ")", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.__init__": [[96, 178], ["dict", "dict", "dict", "dict", "anchor_head.AnchorHead.__init__", "loss_cls.get", "builder.build_loss", "builder.build_loss", "builder.build_loss", "builder.build_loss", "guided_anchor_head.GuidedAnchorHead._init_layers", "numpy.array", "len", "len", "list", "guided_anchor_head.GuidedAnchorHead.approx_generators.append", "guided_anchor_head.GuidedAnchorHead.square_generators.append", "mmdet.core.AnchorGenerator", "mmdet.core.AnchorGenerator", "range"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead._init_layers"], ["def", "__init__", "(", "self", ",", "\n", "num_classes", ",", "\n", "in_channels", ",", "\n", "feat_channels", "=", "256", ",", "\n", "octave_base_scale", "=", "8", ",", "\n", "scales_per_octave", "=", "3", ",", "\n", "octave_ratios", "=", "[", "0.5", ",", "1.0", ",", "2.0", "]", ",", "\n", "anchor_strides", "=", "[", "4", ",", "8", ",", "16", ",", "32", ",", "64", "]", ",", "\n", "anchor_base_sizes", "=", "None", ",", "\n", "anchoring_means", "=", "(", ".0", ",", ".0", ",", ".0", ",", ".0", ")", ",", "\n", "anchoring_stds", "=", "(", "1.0", ",", "1.0", ",", "1.0", ",", "1.0", ")", ",", "\n", "target_means", "=", "(", ".0", ",", ".0", ",", ".0", ",", ".0", ")", ",", "\n", "target_stds", "=", "(", "1.0", ",", "1.0", ",", "1.0", ",", "1.0", ")", ",", "\n", "deformable_groups", "=", "4", ",", "\n", "loc_filter_thr", "=", "0.01", ",", "\n", "loss_loc", "=", "dict", "(", "\n", "type", "=", "'FocalLoss'", ",", "\n", "use_sigmoid", "=", "True", ",", "\n", "gamma", "=", "2.0", ",", "\n", "alpha", "=", "0.25", ",", "\n", "loss_weight", "=", "1.0", ")", ",", "\n", "loss_shape", "=", "dict", "(", "\n", "type", "=", "'IoULoss'", ",", "\n", "style", "=", "'bounded'", ",", "\n", "beta", "=", "0.2", ",", "\n", "loss_weight", "=", "1.0", ")", ",", "\n", "loss_cls", "=", "dict", "(", "\n", "type", "=", "'CrossEntropyLoss'", ",", "\n", "use_sigmoid", "=", "True", ",", "\n", "loss_weight", "=", "1.0", ")", ",", "\n", "loss_bbox", "=", "dict", "(", "\n", "type", "=", "'SmoothL1Loss'", ",", "beta", "=", "1.0", ",", "loss_weight", "=", "1.0", ")", ")", ":", "\n", "        ", "super", "(", "AnchorHead", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "in_channels", "=", "in_channels", "\n", "self", ".", "num_classes", "=", "num_classes", "\n", "self", ".", "feat_channels", "=", "feat_channels", "\n", "self", ".", "octave_base_scale", "=", "octave_base_scale", "\n", "self", ".", "scales_per_octave", "=", "scales_per_octave", "\n", "self", ".", "octave_scales", "=", "octave_base_scale", "*", "np", ".", "array", "(", "\n", "[", "2", "**", "(", "i", "/", "scales_per_octave", ")", "for", "i", "in", "range", "(", "scales_per_octave", ")", "]", ")", "\n", "self", ".", "approxs_per_octave", "=", "len", "(", "self", ".", "octave_scales", ")", "*", "len", "(", "octave_ratios", ")", "\n", "self", ".", "octave_ratios", "=", "octave_ratios", "\n", "self", ".", "anchor_strides", "=", "anchor_strides", "\n", "self", ".", "anchor_base_sizes", "=", "list", "(", "\n", "anchor_strides", ")", "if", "anchor_base_sizes", "is", "None", "else", "anchor_base_sizes", "\n", "self", ".", "anchoring_means", "=", "anchoring_means", "\n", "self", ".", "anchoring_stds", "=", "anchoring_stds", "\n", "self", ".", "target_means", "=", "target_means", "\n", "self", ".", "target_stds", "=", "target_stds", "\n", "self", ".", "deformable_groups", "=", "deformable_groups", "\n", "self", ".", "loc_filter_thr", "=", "loc_filter_thr", "\n", "self", ".", "approx_generators", "=", "[", "]", "\n", "self", ".", "square_generators", "=", "[", "]", "\n", "for", "anchor_base", "in", "self", ".", "anchor_base_sizes", ":", "\n", "# Generators for approxs", "\n", "            ", "self", ".", "approx_generators", ".", "append", "(", "\n", "AnchorGenerator", "(", "anchor_base", ",", "self", ".", "octave_scales", ",", "\n", "self", ".", "octave_ratios", ")", ")", "\n", "# Generators for squares", "\n", "self", ".", "square_generators", ".", "append", "(", "\n", "AnchorGenerator", "(", "anchor_base", ",", "[", "self", ".", "octave_base_scale", "]", ",", "[", "1.0", "]", ")", ")", "\n", "# one anchor per location", "\n", "", "self", ".", "num_anchors", "=", "1", "\n", "self", ".", "use_sigmoid_cls", "=", "loss_cls", ".", "get", "(", "'use_sigmoid'", ",", "False", ")", "\n", "self", ".", "cls_focal_loss", "=", "loss_cls", "[", "'type'", "]", "in", "[", "'FocalLoss'", "]", "\n", "self", ".", "loc_focal_loss", "=", "loss_loc", "[", "'type'", "]", "in", "[", "'FocalLoss'", "]", "\n", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "            ", "self", ".", "cls_out_channels", "=", "self", ".", "num_classes", "-", "1", "\n", "", "else", ":", "\n", "            ", "self", ".", "cls_out_channels", "=", "self", ".", "num_classes", "\n", "\n", "# build losses", "\n", "", "self", ".", "loss_loc", "=", "build_loss", "(", "loss_loc", ")", "\n", "self", ".", "loss_shape", "=", "build_loss", "(", "loss_shape", ")", "\n", "self", ".", "loss_cls", "=", "build_loss", "(", "loss_cls", ")", "\n", "self", ".", "loss_bbox", "=", "build_loss", "(", "loss_bbox", ")", "\n", "\n", "self", ".", "_init_layers", "(", ")", "\n", "\n", "# added by Shengkai Wu", "\n", "self", ".", "IoU_balanced_Cls", "=", "loss_cls", "[", "'type'", "]", "in", "[", "'IOUbalancedCrossEntropyLoss'", ",", "'IOUbalancedSigmoidFocalLoss'", "]", "\n", "self", ".", "IoU_balanced_Loc", "=", "loss_bbox", "[", "'type'", "]", "in", "[", "'IoUbalancedSmoothL1Loss'", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead._init_layers": [[179, 194], ["torch.ReLU", "torch.ReLU", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "guided_anchor_head.FeatureAdaption", "mmdet.ops.MaskedConv2d", "mmdet.ops.MaskedConv2d"], "methods", ["None"], ["", "def", "_init_layers", "(", "self", ")", ":", "\n", "        ", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "self", ".", "conv_loc", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "1", ",", "1", ")", "\n", "self", ".", "conv_shape", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "self", ".", "num_anchors", "*", "2", ",", "\n", "1", ")", "\n", "self", ".", "feature_adaption", "=", "FeatureAdaption", "(", "\n", "self", ".", "feat_channels", ",", "\n", "self", ".", "feat_channels", ",", "\n", "kernel_size", "=", "3", ",", "\n", "deformable_groups", "=", "self", ".", "deformable_groups", ")", "\n", "self", ".", "conv_cls", "=", "MaskedConv2d", "(", "self", ".", "feat_channels", ",", "\n", "self", ".", "num_anchors", "*", "self", ".", "cls_out_channels", ",", "\n", "1", ")", "\n", "self", ".", "conv_reg", "=", "MaskedConv2d", "(", "self", ".", "feat_channels", ",", "self", ".", "num_anchors", "*", "4", ",", "\n", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.init_weights": [[195, 204], ["mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "utils.bias_init_with_prob", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "guided_anchor_head.GuidedAnchorHead.feature_adaption.init_weights"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.bias_init_with_prob", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "normal_init", "(", "self", ".", "conv_cls", ",", "std", "=", "0.01", ")", "\n", "normal_init", "(", "self", ".", "conv_reg", ",", "std", "=", "0.01", ")", "\n", "\n", "bias_cls", "=", "bias_init_with_prob", "(", "0.01", ")", "\n", "normal_init", "(", "self", ".", "conv_loc", ",", "std", "=", "0.01", ",", "bias", "=", "bias_cls", ")", "\n", "normal_init", "(", "self", ".", "conv_shape", ",", "std", "=", "0.01", ")", "\n", "\n", "self", ".", "feature_adaption", ".", "init_weights", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.forward_single": [[205, 222], ["guided_anchor_head.GuidedAnchorHead.conv_loc", "guided_anchor_head.GuidedAnchorHead.conv_shape", "guided_anchor_head.GuidedAnchorHead.feature_adaption", "guided_anchor_head.GuidedAnchorHead.conv_cls", "guided_anchor_head.GuidedAnchorHead.conv_reg", "guided_anchor_head.GuidedAnchorHead.sigmoid"], "methods", ["None"], ["", "def", "forward_single", "(", "self", ",", "x", ")", ":", "\n", "        ", "\"\"\"\n\n        :param x: (H, W, 256)\n        :return:\n        \"\"\"", "\n", "loc_pred", "=", "self", ".", "conv_loc", "(", "x", ")", "# (H, W, 1)", "\n", "shape_pred", "=", "self", ".", "conv_shape", "(", "x", ")", "# (H, W, 2)", "\n", "x", "=", "self", ".", "feature_adaption", "(", "x", ",", "shape_pred", ")", "\n", "# masked conv is only used during inference for speed-up", "\n", "if", "not", "self", ".", "training", ":", "\n", "            ", "mask", "=", "loc_pred", ".", "sigmoid", "(", ")", "[", "0", "]", ">=", "self", ".", "loc_filter_thr", "\n", "", "else", ":", "\n", "            ", "mask", "=", "None", "\n", "", "cls_score", "=", "self", ".", "conv_cls", "(", "x", ",", "mask", ")", "\n", "bbox_pred", "=", "self", ".", "conv_reg", "(", "x", ",", "mask", ")", "\n", "return", "cls_score", ",", "bbox_pred", ",", "shape_pred", ",", "loc_pred", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.forward": [[223, 225], ["mmdet.core.multi_apply"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.multi_apply"], ["", "def", "forward", "(", "self", ",", "feats", ")", ":", "\n", "        ", "return", "multi_apply", "(", "self", ".", "forward_single", ",", "feats", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.get_sampled_approxs": [[226, 277], ["len", "len", "range", "enumerate", "guided_anchor_head.GuidedAnchorHead.approx_generators[].grid_anchors", "multi_level_approxs.append", "range", "inside_flag_list.append", "range", "min", "min", "guided_anchor_head.GuidedAnchorHead.approx_generators[].valid_flags", "range", "multi_level_flags.append", "int", "int", "mmdet.core.anchor_inside_flags", "inside_flags_list.append", "torch.stack().sum", "torch.stack().sum", "torch.stack().sum", "torch.stack().sum", "numpy.ceil", "numpy.ceil", "torch.stack", "torch.stack", "torch.stack", "torch.stack"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_generator.AnchorGenerator.grid_anchors", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_generator.AnchorGenerator.valid_flags", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.anchor_inside_flags"], ["", "def", "get_sampled_approxs", "(", "self", ",", "featmap_sizes", ",", "img_metas", ",", "cfg", ")", ":", "\n", "        ", "\"\"\"Get sampled approxs and inside flags according to feature map sizes.\n\n        Args:\n            featmap_sizes (list[tuple]): Multi-level feature map sizes.\n            img_metas (list[dict]): Image meta info.\n\n        Returns:\n            tuple: approxes of each image, inside flags of each image\n        \"\"\"", "\n", "num_imgs", "=", "len", "(", "img_metas", ")", "\n", "num_levels", "=", "len", "(", "featmap_sizes", ")", "\n", "\n", "# since feature map sizes of all images are the same, we only compute", "\n", "# approxes for one time", "\n", "multi_level_approxs", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "num_levels", ")", ":", "\n", "            ", "approxs", "=", "self", ".", "approx_generators", "[", "i", "]", ".", "grid_anchors", "(", "\n", "featmap_sizes", "[", "i", "]", ",", "self", ".", "anchor_strides", "[", "i", "]", ")", "\n", "multi_level_approxs", ".", "append", "(", "approxs", ")", "\n", "", "approxs_list", "=", "[", "multi_level_approxs", "for", "_", "in", "range", "(", "num_imgs", ")", "]", "\n", "\n", "# for each image, we compute inside flags of multi level approxes", "\n", "inside_flag_list", "=", "[", "]", "\n", "for", "img_id", ",", "img_meta", "in", "enumerate", "(", "img_metas", ")", ":", "\n", "            ", "multi_level_flags", "=", "[", "]", "\n", "multi_level_approxs", "=", "approxs_list", "[", "img_id", "]", "\n", "for", "i", "in", "range", "(", "num_levels", ")", ":", "\n", "                ", "approxs", "=", "multi_level_approxs", "[", "i", "]", "\n", "anchor_stride", "=", "self", ".", "anchor_strides", "[", "i", "]", "\n", "feat_h", ",", "feat_w", "=", "featmap_sizes", "[", "i", "]", "\n", "h", ",", "w", ",", "_", "=", "img_meta", "[", "'pad_shape'", "]", "\n", "valid_feat_h", "=", "min", "(", "int", "(", "np", ".", "ceil", "(", "h", "/", "anchor_stride", ")", ")", ",", "feat_h", ")", "\n", "valid_feat_w", "=", "min", "(", "int", "(", "np", ".", "ceil", "(", "w", "/", "anchor_stride", ")", ")", ",", "feat_w", ")", "\n", "flags", "=", "self", ".", "approx_generators", "[", "i", "]", ".", "valid_flags", "(", "\n", "(", "feat_h", ",", "feat_w", ")", ",", "(", "valid_feat_h", ",", "valid_feat_w", ")", ")", "\n", "inside_flags_list", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "self", ".", "approxs_per_octave", ")", ":", "\n", "                    ", "split_valid_flags", "=", "flags", "[", "i", ":", ":", "self", ".", "approxs_per_octave", "]", "\n", "split_approxs", "=", "approxs", "[", "i", ":", ":", "self", ".", "approxs_per_octave", ",", ":", "]", "\n", "inside_flags", "=", "anchor_inside_flags", "(", "\n", "split_approxs", ",", "split_valid_flags", ",", "\n", "img_meta", "[", "'img_shape'", "]", "[", ":", "2", "]", ",", "cfg", ".", "allowed_border", ")", "\n", "inside_flags_list", ".", "append", "(", "inside_flags", ")", "\n", "# inside_flag for a position is true if any anchor in this", "\n", "# position is true", "\n", "", "inside_flags", "=", "(", "\n", "torch", ".", "stack", "(", "inside_flags_list", ",", "0", ")", ".", "sum", "(", "dim", "=", "0", ")", ">", "0", ")", "\n", "multi_level_flags", ".", "append", "(", "inside_flags", ")", "\n", "", "inside_flag_list", ".", "append", "(", "multi_level_flags", ")", "\n", "", "return", "approxs_list", ",", "inside_flag_list", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.get_anchors": [[278, 330], ["len", "len", "range", "enumerate", "guided_anchor_head.GuidedAnchorHead.square_generators[].grid_anchors", "multi_level_squares.append", "range", "guided_anchors_list.append", "loc_mask_list.append", "range", "guided_anchor_head.GuidedAnchorHead.get_guided_anchors_single", "multi_level_guided_anchors.append", "multi_level_loc_mask.append"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_generator.AnchorGenerator.grid_anchors", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.get_guided_anchors_single"], ["", "def", "get_anchors", "(", "self", ",", "\n", "featmap_sizes", ",", "\n", "shape_preds", ",", "\n", "loc_preds", ",", "\n", "img_metas", ",", "\n", "use_loc_filter", "=", "False", ")", ":", "\n", "        ", "\"\"\"Get squares according to feature map sizes and guided\n        anchors.\n\n        Args:\n            featmap_sizes (list[tuple]): Multi-level feature map sizes.\n            shape_preds (list[tensor]): Multi-level shape predictions.\n            loc_preds (list[tensor]): Multi-level location predictions.\n            img_metas (list[dict]): Image meta info.\n            use_loc_filter (bool): Use loc filter or not.\n\n        Returns:\n            tuple: square approxs of each image, guided anchors of each image,\n                loc masks of each image\n        \"\"\"", "\n", "num_imgs", "=", "len", "(", "img_metas", ")", "\n", "num_levels", "=", "len", "(", "featmap_sizes", ")", "\n", "\n", "# since feature map sizes of all images are the same, we only compute", "\n", "# squares for one time", "\n", "multi_level_squares", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "num_levels", ")", ":", "\n", "            ", "squares", "=", "self", ".", "square_generators", "[", "i", "]", ".", "grid_anchors", "(", "\n", "featmap_sizes", "[", "i", "]", ",", "self", ".", "anchor_strides", "[", "i", "]", ")", "\n", "multi_level_squares", ".", "append", "(", "squares", ")", "\n", "", "squares_list", "=", "[", "multi_level_squares", "for", "_", "in", "range", "(", "num_imgs", ")", "]", "\n", "\n", "# for each image, we compute multi level guided anchors", "\n", "guided_anchors_list", "=", "[", "]", "\n", "loc_mask_list", "=", "[", "]", "\n", "for", "img_id", ",", "img_meta", "in", "enumerate", "(", "img_metas", ")", ":", "\n", "            ", "multi_level_guided_anchors", "=", "[", "]", "\n", "multi_level_loc_mask", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "num_levels", ")", ":", "\n", "                ", "squares", "=", "squares_list", "[", "img_id", "]", "[", "i", "]", "\n", "shape_pred", "=", "shape_preds", "[", "i", "]", "[", "img_id", "]", "\n", "loc_pred", "=", "loc_preds", "[", "i", "]", "[", "img_id", "]", "\n", "guided_anchors", ",", "loc_mask", "=", "self", ".", "get_guided_anchors_single", "(", "\n", "squares", ",", "\n", "shape_pred", ",", "\n", "loc_pred", ",", "\n", "use_loc_filter", "=", "use_loc_filter", ")", "\n", "multi_level_guided_anchors", ".", "append", "(", "guided_anchors", ")", "\n", "multi_level_loc_mask", ".", "append", "(", "loc_mask", ")", "\n", "", "guided_anchors_list", ".", "append", "(", "multi_level_guided_anchors", ")", "\n", "loc_mask_list", ".", "append", "(", "multi_level_loc_mask", ")", "\n", "", "return", "squares_list", ",", "guided_anchors_list", ",", "loc_mask_list", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.get_guided_anchors_single": [[331, 368], ["loc_pred.sigmoid().detach.sigmoid().detach.sigmoid().detach", "loc_mask.permute().expand", "mask.contiguous().view.contiguous().view.contiguous().view", "anchor_deltas.new_full", "mmdet.core.delta2bbox", "shape_pred.permute().contiguous().view().detach", "squares.size", "loc_pred.sigmoid().detach.sigmoid().detach.sigmoid", "loc_mask.permute", "mask.contiguous().view.contiguous().view.contiguous", "shape_pred.permute().contiguous().view", "shape_pred.permute().contiguous", "shape_pred.permute"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox"], ["", "def", "get_guided_anchors_single", "(", "self", ",", "\n", "squares", ",", "\n", "shape_pred", ",", "\n", "loc_pred", ",", "\n", "use_loc_filter", "=", "False", ")", ":", "\n", "        ", "\"\"\"Get guided anchors and loc masks for a single level.\n\n        Args:\n            square (tensor): Squares of a single level.\n            shape_pred (tensor): Shape predections of a single level.\n            loc_pred (tensor): Loc predections of a single level.\n            use_loc_filter (list[tensor]): Use loc filter or not.\n\n        Returns:\n            tuple: guided anchors, location masks\n        \"\"\"", "\n", "# calculate location filtering mask", "\n", "loc_pred", "=", "loc_pred", ".", "sigmoid", "(", ")", ".", "detach", "(", ")", "\n", "if", "use_loc_filter", ":", "\n", "            ", "loc_mask", "=", "loc_pred", ">=", "self", ".", "loc_filter_thr", "\n", "", "else", ":", "\n", "            ", "loc_mask", "=", "loc_pred", ">=", "0.0", "\n", "", "mask", "=", "loc_mask", ".", "permute", "(", "1", ",", "2", ",", "0", ")", ".", "expand", "(", "-", "1", ",", "-", "1", ",", "self", ".", "num_anchors", ")", "\n", "mask", "=", "mask", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ")", "\n", "# calculate guided anchors", "\n", "squares", "=", "squares", "[", "mask", "]", "\n", "anchor_deltas", "=", "shape_pred", ".", "permute", "(", "1", ",", "2", ",", "0", ")", ".", "contiguous", "(", ")", ".", "view", "(", "\n", "-", "1", ",", "2", ")", ".", "detach", "(", ")", "[", "mask", "]", "\n", "bbox_deltas", "=", "anchor_deltas", ".", "new_full", "(", "squares", ".", "size", "(", ")", ",", "0", ")", "\n", "bbox_deltas", "[", ":", ",", "2", ":", "]", "=", "anchor_deltas", "\n", "guided_anchors", "=", "delta2bbox", "(", "\n", "squares", ",", "\n", "bbox_deltas", ",", "\n", "self", ".", "anchoring_means", ",", "\n", "self", ".", "anchoring_stds", ",", "\n", "wh_ratio_clip", "=", "1e-6", ")", "\n", "return", "guided_anchors", ",", "mask", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.loss_shape_single": [[369, 395], ["shape_pred.permute().contiguous().view.permute().contiguous().view.permute().contiguous().view", "bbox_anchors.contiguous().view.contiguous().view.contiguous().view", "bbox_gts.contiguous().view.contiguous().view.contiguous().view", "anchor_weights.contiguous().view.contiguous().view.contiguous().view", "bbox_anchors.contiguous().view.contiguous().view.new_full", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "mmdet.core.delta2bbox", "guided_anchor_head.GuidedAnchorHead.loss_shape", "bbox_anchors.contiguous().view.contiguous().view.size", "shape_pred.permute().contiguous().view.permute().contiguous().view.permute().contiguous", "bbox_anchors.contiguous().view.contiguous().view.contiguous", "bbox_gts.contiguous().view.contiguous().view.contiguous", "anchor_weights.contiguous().view.contiguous().view.contiguous", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero", "shape_pred.permute().contiguous().view.permute().contiguous().view.permute"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox"], ["", "def", "loss_shape_single", "(", "self", ",", "shape_pred", ",", "bbox_anchors", ",", "bbox_gts", ",", "\n", "anchor_weights", ",", "anchor_total_num", ")", ":", "\n", "        ", "shape_pred", "=", "shape_pred", ".", "permute", "(", "0", ",", "2", ",", "3", ",", "1", ")", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ",", "2", ")", "\n", "bbox_anchors", "=", "bbox_anchors", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ",", "4", ")", "\n", "bbox_gts", "=", "bbox_gts", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ",", "4", ")", "\n", "anchor_weights", "=", "anchor_weights", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ",", "4", ")", "\n", "bbox_deltas", "=", "bbox_anchors", ".", "new_full", "(", "bbox_anchors", ".", "size", "(", ")", ",", "0", ")", "\n", "bbox_deltas", "[", ":", ",", "2", ":", "]", "+=", "shape_pred", "\n", "# filter out negative samples to speed-up weighted_bounded_iou_loss", "\n", "inds", "=", "torch", ".", "nonzero", "(", "anchor_weights", "[", ":", ",", "0", "]", ">", "0", ")", ".", "squeeze", "(", "1", ")", "\n", "bbox_deltas_", "=", "bbox_deltas", "[", "inds", "]", "\n", "bbox_anchors_", "=", "bbox_anchors", "[", "inds", "]", "\n", "bbox_gts_", "=", "bbox_gts", "[", "inds", "]", "\n", "anchor_weights_", "=", "anchor_weights", "[", "inds", "]", "\n", "pred_anchors_", "=", "delta2bbox", "(", "\n", "bbox_anchors_", ",", "\n", "bbox_deltas_", ",", "\n", "self", ".", "anchoring_means", ",", "\n", "self", ".", "anchoring_stds", ",", "\n", "wh_ratio_clip", "=", "1e-6", ")", "\n", "loss_shape", "=", "self", ".", "loss_shape", "(", "\n", "pred_anchors_", ",", "\n", "bbox_gts_", ",", "\n", "anchor_weights_", ",", "\n", "avg_factor", "=", "anchor_total_num", ")", "\n", "return", "loss_shape", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.loss_loc_single": [[396, 404], ["guided_anchor_head.GuidedAnchorHead.loss_loc", "loc_pred.reshape", "loc_target.reshape().long", "loc_weight.reshape", "loc_target.reshape"], "methods", ["None"], ["", "def", "loss_loc_single", "(", "self", ",", "loc_pred", ",", "loc_target", ",", "loc_weight", ",", "loc_avg_factor", ",", "\n", "cfg", ")", ":", "\n", "        ", "loss_loc", "=", "self", ".", "loss_loc", "(", "\n", "loc_pred", ".", "reshape", "(", "-", "1", ",", "1", ")", ",", "\n", "loc_target", ".", "reshape", "(", "-", "1", ",", "1", ")", ".", "long", "(", ")", ",", "\n", "loc_weight", ".", "reshape", "(", "-", "1", ",", "1", ")", ",", "\n", "avg_factor", "=", "loc_avg_factor", ")", "\n", "return", "loss_loc", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.loss": [[405, 530], ["mmdet.core.ga_loc_target", "guided_anchor_head.GuidedAnchorHead.get_sampled_approxs", "guided_anchor_head.GuidedAnchorHead.get_anchors", "mmdet.core.ga_shape_target", "mmdet.core.anchor_target", "mmdet.core.multi_apply", "range", "range", "dict", "len", "len", "len", "guided_anchor_head.GuidedAnchorHead.loss_loc_single", "losses_loc.append", "len", "guided_anchor_head.GuidedAnchorHead.loss_shape_single", "losses_shape.append", "featmap.size", "hasattr"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.ga_loc_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.get_sampled_approxs", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.anchor_head.AnchorHead.get_anchors", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.ga_shape_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.anchor_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.multi_apply", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.loss_loc_single", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.loss_shape_single"], ["", "def", "loss", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "shape_preds", ",", "\n", "loc_preds", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "img_metas", ",", "\n", "cfg", ",", "\n", "gt_bboxes_ignore", "=", "None", ")", ":", "\n", "        ", "featmap_sizes", "=", "[", "featmap", ".", "size", "(", ")", "[", "-", "2", ":", "]", "for", "featmap", "in", "cls_scores", "]", "\n", "assert", "len", "(", "featmap_sizes", ")", "==", "len", "(", "self", ".", "approx_generators", ")", "\n", "\n", "# get loc targets", "\n", "loc_targets", ",", "loc_weights", ",", "loc_avg_factor", "=", "ga_loc_target", "(", "\n", "gt_bboxes", ",", "\n", "featmap_sizes", ",", "\n", "self", ".", "octave_base_scale", ",", "\n", "self", ".", "anchor_strides", ",", "\n", "center_ratio", "=", "cfg", ".", "center_ratio", ",", "\n", "ignore_ratio", "=", "cfg", ".", "ignore_ratio", ")", "\n", "\n", "# get sampled approxes", "\n", "approxs_list", ",", "inside_flag_list", "=", "self", ".", "get_sampled_approxs", "(", "\n", "featmap_sizes", ",", "img_metas", ",", "cfg", ")", "\n", "# get squares and guided anchors", "\n", "squares_list", ",", "guided_anchors_list", ",", "_", "=", "self", ".", "get_anchors", "(", "\n", "featmap_sizes", ",", "shape_preds", ",", "loc_preds", ",", "img_metas", ")", "\n", "\n", "# get shape targets", "\n", "sampling", "=", "False", "if", "not", "hasattr", "(", "cfg", ",", "'ga_sampler'", ")", "else", "True", "\n", "shape_targets", "=", "ga_shape_target", "(", "\n", "approxs_list", ",", "\n", "inside_flag_list", ",", "\n", "squares_list", ",", "\n", "gt_bboxes", ",", "\n", "img_metas", ",", "\n", "self", ".", "approxs_per_octave", ",", "\n", "cfg", ",", "\n", "sampling", "=", "sampling", ")", "\n", "if", "shape_targets", "is", "None", ":", "\n", "            ", "return", "None", "\n", "", "(", "bbox_anchors_list", ",", "bbox_gts_list", ",", "anchor_weights_list", ",", "anchor_fg_num", ",", "\n", "anchor_bg_num", ")", "=", "shape_targets", "\n", "anchor_total_num", "=", "(", "\n", "anchor_fg_num", "if", "not", "sampling", "else", "anchor_fg_num", "+", "anchor_bg_num", ")", "\n", "\n", "# get anchor targets", "\n", "sampling", "=", "False", "if", "self", ".", "cls_focal_loss", "else", "True", "\n", "label_channels", "=", "self", ".", "cls_out_channels", "if", "self", ".", "use_sigmoid_cls", "else", "1", "\n", "cls_reg_targets", "=", "anchor_target", "(", "\n", "guided_anchors_list", ",", "\n", "inside_flag_list", ",", "\n", "gt_bboxes", ",", "\n", "img_metas", ",", "\n", "self", ".", "target_means", ",", "\n", "self", ".", "target_stds", ",", "\n", "cfg", ",", "\n", "gt_bboxes_ignore_list", "=", "gt_bboxes_ignore", ",", "\n", "gt_labels_list", "=", "gt_labels", ",", "\n", "label_channels", "=", "label_channels", ",", "\n", "sampling", "=", "sampling", ")", "\n", "if", "cls_reg_targets", "is", "None", ":", "\n", "            ", "return", "None", "\n", "# (labels_list, label_weights_list, bbox_targets_list, bbox_weights_list,", "\n", "#  num_total_pos, num_total_neg) = cls_reg_targets", "\n", "\n", "", "(", "labels_list", ",", "label_weights_list", ",", "bbox_targets_list", ",", "bbox_weights_list", ",", "num_total_pos", ",", "num_total_neg", ",", "\n", "level_anchor_list", ")", "=", "cls_reg_targets", "\n", "\n", "\n", "num_total_samples", "=", "(", "\n", "num_total_pos", "if", "self", ".", "cls_focal_loss", "else", "num_total_pos", "+", "\n", "num_total_neg", ")", "\n", "# added by WSK", "\n", "num_total_samples_cls", "=", "(", "\n", "num_total_pos_cls", "if", "self", ".", "cls_focal_loss", "else", "num_total_pos_cls", "+", "\n", "num_total_neg_cls", ")", "\n", "\n", "\n", "\n", "# get classification and bbox regression losses", "\n", "losses_cls", ",", "losses_bbox", "=", "multi_apply", "(", "\n", "self", ".", "loss_single", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "labels_list", ",", "\n", "label_weights_list", ",", "\n", "bbox_targets_list", ",", "\n", "bbox_weights_list", ",", "\n", "level_anchor_list", ",", "# added by Shengkai Wu", "\n", "bbox_targets_cls_list", ",", "# added by Shengkai Wu", "\n", "bbox_weights_cls_list", ",", "# added by Shengkai Wu", "\n", "num_total_samples_cls", "=", "num_total_samples_cls", ",", "# added by Shengkai Wu", "\n", "num_total_samples", "=", "num_total_samples", ",", "\n", "gt_bboxes", "=", "gt_bboxes", ",", "# added by Shengkai Wu", "\n", "cfg", "=", "cfg", ")", "\n", "\n", "# get anchor location loss", "\n", "losses_loc", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "loc_preds", ")", ")", ":", "\n", "            ", "loss_loc", "=", "self", ".", "loss_loc_single", "(", "\n", "loc_preds", "[", "i", "]", ",", "\n", "loc_targets", "[", "i", "]", ",", "\n", "loc_weights", "[", "i", "]", ",", "\n", "loc_avg_factor", "=", "loc_avg_factor", ",", "\n", "cfg", "=", "cfg", ")", "\n", "losses_loc", ".", "append", "(", "loss_loc", ")", "\n", "\n", "# get anchor shape loss", "\n", "", "losses_shape", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "shape_preds", ")", ")", ":", "\n", "            ", "loss_shape", "=", "self", ".", "loss_shape_single", "(", "\n", "shape_preds", "[", "i", "]", ",", "\n", "bbox_anchors_list", "[", "i", "]", ",", "\n", "bbox_gts_list", "[", "i", "]", ",", "\n", "anchor_weights_list", "[", "i", "]", ",", "\n", "anchor_total_num", "=", "anchor_total_num", ")", "\n", "losses_shape", ".", "append", "(", "loss_shape", ")", "\n", "\n", "", "return", "dict", "(", "\n", "loss_cls", "=", "losses_cls", ",", "\n", "loss_bbox", "=", "losses_bbox", ",", "\n", "loss_shape", "=", "losses_shape", ",", "\n", "loss_loc", "=", "losses_loc", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.get_bboxes": [[531, 574], ["len", "guided_anchor_head.GuidedAnchorHead.get_anchors", "range", "len", "len", "len", "len", "len", "guided_anchor_head.GuidedAnchorHead.get_bboxes_single", "result_list.append", "featmap.size", "[].detach", "[].detach", "[].detach", "[].detach", "range", "range", "range", "range"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.anchor_head.AnchorHead.get_anchors", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.get_bboxes_single"], ["", "def", "get_bboxes", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "shape_preds", ",", "\n", "loc_preds", ",", "\n", "gt_bboxes", ",", "# added by WSK", "\n", "gt_labels", ",", "# aded by WSK", "\n", "img_metas", ",", "\n", "cfg", ",", "\n", "rescale", "=", "False", ")", ":", "\n", "        ", "assert", "len", "(", "cls_scores", ")", "==", "len", "(", "bbox_preds", ")", "==", "len", "(", "shape_preds", ")", "==", "len", "(", "\n", "loc_preds", ")", "\n", "num_levels", "=", "len", "(", "cls_scores", ")", "\n", "featmap_sizes", "=", "[", "featmap", ".", "size", "(", ")", "[", "-", "2", ":", "]", "for", "featmap", "in", "cls_scores", "]", "\n", "# get guided anchors", "\n", "_", ",", "guided_anchors", ",", "loc_masks", "=", "self", ".", "get_anchors", "(", "\n", "featmap_sizes", ",", "\n", "shape_preds", ",", "\n", "loc_preds", ",", "\n", "img_metas", ",", "\n", "use_loc_filter", "=", "not", "self", ".", "training", ")", "\n", "result_list", "=", "[", "]", "\n", "for", "img_id", "in", "range", "(", "len", "(", "img_metas", ")", ")", ":", "\n", "            ", "cls_score_list", "=", "[", "\n", "cls_scores", "[", "i", "]", "[", "img_id", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "bbox_pred_list", "=", "[", "\n", "bbox_preds", "[", "i", "]", "[", "img_id", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "guided_anchor_list", "=", "[", "\n", "guided_anchors", "[", "img_id", "]", "[", "i", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "loc_mask_list", "=", "[", "\n", "loc_masks", "[", "img_id", "]", "[", "i", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "img_shape", "=", "img_metas", "[", "img_id", "]", "[", "'img_shape'", "]", "\n", "scale_factor", "=", "img_metas", "[", "img_id", "]", "[", "'scale_factor'", "]", "\n", "proposals", "=", "self", ".", "get_bboxes_single", "(", "cls_score_list", ",", "bbox_pred_list", ",", "\n", "guided_anchor_list", ",", "\n", "loc_mask_list", ",", "img_shape", ",", "\n", "scale_factor", ",", "cfg", ",", "rescale", ")", "\n", "result_list", ".", "append", "(", "proposals", ")", "\n", "", "return", "result_list", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.guided_anchor_head.GuidedAnchorHead.get_bboxes_single": [[575, 637], ["zip", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "mmdet.core.multiclass_nms", "len", "len", "len", "cls_score.permute().reshape.permute().reshape.permute().reshape", "bbox_pred.unsqueeze.unsqueeze.permute().reshape", "cfg.get", "mmdet.core.delta2bbox", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.new_tensor", "torch.cat.new_tensor", "torch.cat.new_zeros", "torch.cat.new_zeros", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "mask.sum", "cls_score.permute().reshape.permute().reshape.sigmoid", "cls_score.permute().reshape.permute().reshape.softmax", "scores.unsqueeze.unsqueeze.dim", "anchors.unsqueeze.unsqueeze.unsqueeze", "scores.unsqueeze.unsqueeze.unsqueeze", "bbox_pred.unsqueeze.unsqueeze.unsqueeze", "max_scores.topk", "cls_score.permute().reshape.permute().reshape.size", "bbox_pred.unsqueeze.unsqueeze.size", "cls_score.permute().reshape.permute().reshape.permute", "bbox_pred.unsqueeze.unsqueeze.permute", "scores.unsqueeze.unsqueeze.max", "scores[].max"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.post_processing.bbox_nms.multiclass_nms", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox"], ["", "def", "get_bboxes_single", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "mlvl_anchors", ",", "\n", "mlvl_masks", ",", "\n", "img_shape", ",", "\n", "scale_factor", ",", "\n", "cfg", ",", "\n", "rescale", "=", "False", ")", ":", "\n", "        ", "assert", "len", "(", "cls_scores", ")", "==", "len", "(", "bbox_preds", ")", "==", "len", "(", "mlvl_anchors", ")", "\n", "mlvl_bboxes", "=", "[", "]", "\n", "mlvl_scores", "=", "[", "]", "\n", "for", "cls_score", ",", "bbox_pred", ",", "anchors", ",", "mask", "in", "zip", "(", "cls_scores", ",", "bbox_preds", ",", "\n", "mlvl_anchors", ",", "\n", "mlvl_masks", ")", ":", "\n", "            ", "assert", "cls_score", ".", "size", "(", ")", "[", "-", "2", ":", "]", "==", "bbox_pred", ".", "size", "(", ")", "[", "-", "2", ":", "]", "\n", "# if no location is kept, end.", "\n", "if", "mask", ".", "sum", "(", ")", "==", "0", ":", "\n", "                ", "continue", "\n", "# reshape scores and bbox_pred", "\n", "", "cls_score", "=", "cls_score", ".", "permute", "(", "1", ",", "2", ",", "\n", "0", ")", ".", "reshape", "(", "-", "1", ",", "self", ".", "cls_out_channels", ")", "\n", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "                ", "scores", "=", "cls_score", ".", "sigmoid", "(", ")", "\n", "", "else", ":", "\n", "                ", "scores", "=", "cls_score", ".", "softmax", "(", "-", "1", ")", "\n", "", "bbox_pred", "=", "bbox_pred", ".", "permute", "(", "1", ",", "2", ",", "0", ")", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "# filter scores, bbox_pred w.r.t. mask.", "\n", "# anchors are filtered in get_anchors() beforehand.", "\n", "scores", "=", "scores", "[", "mask", ",", ":", "]", "\n", "bbox_pred", "=", "bbox_pred", "[", "mask", ",", ":", "]", "\n", "if", "scores", ".", "dim", "(", ")", "==", "0", ":", "\n", "                ", "anchors", "=", "anchors", ".", "unsqueeze", "(", "0", ")", "\n", "scores", "=", "scores", ".", "unsqueeze", "(", "0", ")", "\n", "bbox_pred", "=", "bbox_pred", ".", "unsqueeze", "(", "0", ")", "\n", "# filter anchors, bbox_pred, scores w.r.t. scores", "\n", "", "nms_pre", "=", "cfg", ".", "get", "(", "'nms_pre'", ",", "-", "1", ")", "\n", "if", "nms_pre", ">", "0", "and", "scores", ".", "shape", "[", "0", "]", ">", "nms_pre", ":", "\n", "                ", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "                    ", "max_scores", ",", "_", "=", "scores", ".", "max", "(", "dim", "=", "1", ")", "\n", "", "else", ":", "\n", "                    ", "max_scores", ",", "_", "=", "scores", "[", ":", ",", "1", ":", "]", ".", "max", "(", "dim", "=", "1", ")", "\n", "", "_", ",", "topk_inds", "=", "max_scores", ".", "topk", "(", "nms_pre", ")", "\n", "anchors", "=", "anchors", "[", "topk_inds", ",", ":", "]", "\n", "bbox_pred", "=", "bbox_pred", "[", "topk_inds", ",", ":", "]", "\n", "scores", "=", "scores", "[", "topk_inds", ",", ":", "]", "\n", "", "bboxes", "=", "delta2bbox", "(", "anchors", ",", "bbox_pred", ",", "self", ".", "target_means", ",", "\n", "self", ".", "target_stds", ",", "img_shape", ")", "\n", "mlvl_bboxes", ".", "append", "(", "bboxes", ")", "\n", "mlvl_scores", ".", "append", "(", "scores", ")", "\n", "", "mlvl_bboxes", "=", "torch", ".", "cat", "(", "mlvl_bboxes", ")", "\n", "if", "rescale", ":", "\n", "            ", "mlvl_bboxes", "/=", "mlvl_bboxes", ".", "new_tensor", "(", "scale_factor", ")", "\n", "", "mlvl_scores", "=", "torch", ".", "cat", "(", "mlvl_scores", ")", "\n", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "            ", "padding", "=", "mlvl_scores", ".", "new_zeros", "(", "mlvl_scores", ".", "shape", "[", "0", "]", ",", "1", ")", "\n", "mlvl_scores", "=", "torch", ".", "cat", "(", "[", "padding", ",", "mlvl_scores", "]", ",", "dim", "=", "1", ")", "\n", "# multi class NMS", "\n", "", "det_bboxes", ",", "det_labels", "=", "multiclass_nms", "(", "mlvl_bboxes", ",", "mlvl_scores", ",", "\n", "cfg", ".", "score_thr", ",", "cfg", ".", "nms", ",", "\n", "cfg", ".", "max_per_img", ")", "\n", "return", "det_bboxes", ",", "det_labels", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.__init__": [[17, 40], ["dict", "torch.Module.__init__", "fcos_head.FCOSHead._init_layers"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead._init_layers"], ["    ", "def", "__init__", "(", "self", ",", "\n", "num_classes", ",", "\n", "in_channels", ",", "\n", "feat_channels", "=", "256", ",", "\n", "stacked_convs", "=", "4", ",", "\n", "strides", "=", "(", "4", ",", "8", ",", "16", ",", "32", ",", "64", ")", ",", "\n", "regress_ranges", "=", "(", "(", "-", "1", ",", "64", ")", ",", "(", "64", ",", "128", ")", ",", "(", "128", ",", "256", ")", ",", "(", "256", ",", "512", ")", ",", "\n", "(", "512", ",", "INF", ")", ")", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "dict", "(", "type", "=", "'GN'", ",", "num_groups", "=", "32", ",", "requires_grad", "=", "True", ")", ")", ":", "\n", "        ", "super", "(", "FCOSHead", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "num_classes", "=", "num_classes", "\n", "self", ".", "cls_out_channels", "=", "num_classes", "-", "1", "\n", "self", ".", "in_channels", "=", "in_channels", "\n", "self", ".", "feat_channels", "=", "feat_channels", "\n", "self", ".", "stacked_convs", "=", "stacked_convs", "\n", "self", ".", "strides", "=", "strides", "\n", "self", ".", "regress_ranges", "=", "regress_ranges", "\n", "self", ".", "conv_cfg", "=", "conv_cfg", "\n", "self", ".", "norm_cfg", "=", "norm_cfg", "\n", "\n", "self", ".", "_init_layers", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead._init_layers": [[41, 73], ["torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "range", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "fcos_head.FCOSHead.cls_convs.append", "fcos_head.FCOSHead.reg_convs.append", "utils.ConvModule", "utils.ConvModule", "utils.Scale"], "methods", ["None"], ["", "def", "_init_layers", "(", "self", ")", ":", "\n", "        ", "self", ".", "cls_convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "self", ".", "reg_convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "for", "i", "in", "range", "(", "self", ".", "stacked_convs", ")", ":", "\n", "            ", "chn", "=", "self", ".", "in_channels", "if", "i", "==", "0", "else", "self", ".", "feat_channels", "\n", "self", ".", "cls_convs", ".", "append", "(", "\n", "ConvModule", "(", "\n", "chn", ",", "\n", "self", ".", "feat_channels", ",", "\n", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ",", "\n", "bias", "=", "self", ".", "norm_cfg", "is", "None", ")", ")", "\n", "self", ".", "reg_convs", ".", "append", "(", "\n", "ConvModule", "(", "\n", "chn", ",", "\n", "self", ".", "feat_channels", ",", "\n", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ",", "\n", "bias", "=", "self", ".", "norm_cfg", "is", "None", ")", ")", "\n", "", "self", ".", "fcos_cls", "=", "nn", ".", "Conv2d", "(", "\n", "self", ".", "feat_channels", ",", "self", ".", "cls_out_channels", ",", "3", ",", "padding", "=", "1", ")", "\n", "self", ".", "fcos_centerness", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "1", ",", "3", ",", "padding", "=", "1", ")", "\n", "self", ".", "fcos_reg", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "4", ",", "3", ",", "padding", "=", "1", ")", "\n", "\n", "\n", "self", ".", "scales", "=", "nn", ".", "ModuleList", "(", "[", "Scale", "(", "1.0", ")", "for", "_", "in", "self", ".", "strides", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.init_weights": [[74, 83], ["utils.bias_init_with_prob", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.bias_init_with_prob", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "for", "m", "in", "self", ".", "cls_convs", ":", "\n", "            ", "normal_init", "(", "m", ".", "conv", ",", "std", "=", "0.01", ")", "\n", "", "for", "m", "in", "self", ".", "reg_convs", ":", "\n", "            ", "normal_init", "(", "m", ".", "conv", ",", "std", "=", "0.01", ")", "\n", "", "bias_cls", "=", "bias_init_with_prob", "(", "0.01", ")", "\n", "normal_init", "(", "self", ".", "fcos_cls", ",", "std", "=", "0.01", ",", "bias", "=", "bias_cls", ")", "\n", "normal_init", "(", "self", ".", "fcos_reg", ",", "std", "=", "0.01", ")", "\n", "normal_init", "(", "self", ".", "fcos_centerness", ",", "std", "=", "0.01", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.forward": [[85, 87], ["mmdet.core.multi_apply"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.multi_apply"], ["", "def", "forward", "(", "self", ",", "feats", ")", ":", "\n", "        ", "return", "multi_apply", "(", "self", ".", "forward_single", ",", "feats", ",", "self", ".", "scales", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.forward_single": [[88, 104], ["fcos_head.FCOSHead.fcos_cls", "fcos_head.FCOSHead.fcos_centerness", "scale().exp", "cls_layer", "reg_layer", "scale", "fcos_head.FCOSHead.fcos_reg"], "methods", ["None"], ["", "def", "forward_single", "(", "self", ",", "x", ",", "scale", ")", ":", "\n", "        ", "cls_feat", "=", "x", "\n", "reg_feat", "=", "x", "\n", "\n", "for", "cls_layer", "in", "self", ".", "cls_convs", ":", "\n", "            ", "cls_feat", "=", "cls_layer", "(", "cls_feat", ")", "\n", "", "cls_score", "=", "self", ".", "fcos_cls", "(", "cls_feat", ")", "\n", "centerness", "=", "self", ".", "fcos_centerness", "(", "cls_feat", ")", "\n", "\n", "for", "reg_layer", "in", "self", ".", "reg_convs", ":", "\n", "            ", "reg_feat", "=", "reg_layer", "(", "reg_feat", ")", "\n", "\n", "# scale the bbox_pred of different level", "\n", "", "bbox_pred", "=", "scale", "(", "self", ".", "fcos_reg", "(", "reg_feat", ")", ")", ".", "exp", "(", ")", "\n", "\n", "return", "cls_score", ",", "bbox_pred", ",", "centerness", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.loss": [[105, 191], ["fcos_head.FCOSHead.get_points", "fcos_head.FCOSHead.fcos_target", "cls_scores[].size", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat.nonzero().reshape", "torch.cat.nonzero().reshape", "torch.cat.nonzero().reshape", "len", "fcos_head.FCOSHead.centerness_target", "dict", "len", "len", "len", "cls_score.permute().reshape", "bbox_pred.permute().reshape", "centerness.permute().reshape", "mmdet.core.distance2bbox", "mmdet.core.distance2bbox", "featmap.size", "points.repeat", "torch.cat.nonzero", "torch.cat.nonzero", "torch.cat.nonzero", "mmdet.core.sigmoid_focal_loss().sum", "torch.binary_cross_entropy_with_logits", "torch.binary_cross_entropy_with_logits", "torch.binary_cross_entropy_with_logits", "pos_bbox_preds.sum", "pos_centerness.sum", "cls_score.permute", "bbox_pred.permute", "centerness.permute", "fcos_head.FCOSHead.sum", "mmdet.core.sigmoid_focal_loss", "mmdet.core.iou_loss"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.get_points", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.fcos_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.centerness_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.distance2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.distance2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.iou_loss"], ["", "def", "loss", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "centernesses", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "img_metas", ",", "\n", "cfg", ",", "\n", "gt_bboxes_ignore", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n\n        :param cls_scores: list of tensor. cls_scores[i].size() = (batch, num_class, width_i, height_i) for\n              the i-th level of FPN.\n        :param bbox_preds: list of tensor. bbox_preds[i].size() = (batch, 4, width_i, height_i) for\n              the i-th level of FPN.\n        :param centernesses: list of tensor. centernesses[i].size() = (batch, 1, width_i, height_i) for\n              the i-th level of FPN.\n        :param gt_bboxes:\n        :param gt_labels:\n        :param img_metas:\n        :param cfg:\n        :param gt_bboxes_ignore:\n        :return:\n        \"\"\"", "\n", "assert", "len", "(", "cls_scores", ")", "==", "len", "(", "bbox_preds", ")", "==", "len", "(", "centernesses", ")", "\n", "featmap_sizes", "=", "[", "featmap", ".", "size", "(", ")", "[", "-", "2", ":", "]", "for", "featmap", "in", "cls_scores", "]", "\n", "all_level_points", "=", "self", ".", "get_points", "(", "featmap_sizes", ",", "bbox_preds", "[", "0", "]", ".", "dtype", ",", "\n", "bbox_preds", "[", "0", "]", ".", "device", ")", "\n", "labels", ",", "bbox_targets", "=", "self", ".", "fcos_target", "(", "all_level_points", ",", "gt_bboxes", ",", "\n", "gt_labels", ")", "\n", "\n", "num_imgs", "=", "cls_scores", "[", "0", "]", ".", "size", "(", "0", ")", "\n", "# flatten cls_scores, bbox_preds and centerness", "\n", "flatten_cls_scores", "=", "[", "\n", "cls_score", ".", "permute", "(", "0", ",", "2", ",", "3", ",", "1", ")", ".", "reshape", "(", "-", "1", ",", "self", ".", "cls_out_channels", ")", "\n", "for", "cls_score", "in", "cls_scores", "\n", "]", "\n", "flatten_bbox_preds", "=", "[", "\n", "bbox_pred", ".", "permute", "(", "0", ",", "2", ",", "3", ",", "1", ")", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "for", "bbox_pred", "in", "bbox_preds", "\n", "]", "\n", "flatten_centerness", "=", "[", "\n", "centerness", ".", "permute", "(", "0", ",", "2", ",", "3", ",", "1", ")", ".", "reshape", "(", "-", "1", ")", "\n", "for", "centerness", "in", "centernesses", "\n", "]", "\n", "flatten_cls_scores", "=", "torch", ".", "cat", "(", "flatten_cls_scores", ")", "\n", "flatten_bbox_preds", "=", "torch", ".", "cat", "(", "flatten_bbox_preds", ")", "\n", "flatten_centerness", "=", "torch", ".", "cat", "(", "flatten_centerness", ")", "\n", "flatten_labels", "=", "torch", ".", "cat", "(", "labels", ")", "\n", "flatten_bbox_targets", "=", "torch", ".", "cat", "(", "bbox_targets", ")", "\n", "# repeat points to align with bbox_preds", "\n", "flatten_points", "=", "torch", ".", "cat", "(", "\n", "[", "points", ".", "repeat", "(", "num_imgs", ",", "1", ")", "for", "points", "in", "all_level_points", "]", ")", "\n", "\n", "pos_inds", "=", "flatten_labels", ".", "nonzero", "(", ")", ".", "reshape", "(", "-", "1", ")", "\n", "num_pos", "=", "len", "(", "pos_inds", ")", "\n", "loss_cls", "=", "sigmoid_focal_loss", "(", "\n", "flatten_cls_scores", ",", "flatten_labels", ",", "cfg", ".", "gamma", ",", "cfg", ".", "alpha", ",", "\n", "'none'", ")", ".", "sum", "(", ")", "[", "None", "]", "/", "(", "num_pos", "+", "num_imgs", ")", "# avoid num_pos is 0", "\n", "\n", "pos_bbox_preds", "=", "flatten_bbox_preds", "[", "pos_inds", "]", "\n", "pos_bbox_targets", "=", "flatten_bbox_targets", "[", "pos_inds", "]", "\n", "pos_centerness", "=", "flatten_centerness", "[", "pos_inds", "]", "\n", "pos_centerness_targets", "=", "self", ".", "centerness_target", "(", "pos_bbox_targets", ")", "\n", "\n", "if", "num_pos", ">", "0", ":", "\n", "            ", "pos_points", "=", "flatten_points", "[", "pos_inds", "]", "\n", "pos_decoded_bbox_preds", "=", "distance2bbox", "(", "pos_points", ",", "pos_bbox_preds", ")", "\n", "pos_decoded_target_preds", "=", "distance2bbox", "(", "pos_points", ",", "\n", "pos_bbox_targets", ")", "\n", "# centerness weighted iou loss", "\n", "loss_reg", "=", "(", "(", "iou_loss", "(", "\n", "pos_decoded_bbox_preds", ",", "\n", "pos_decoded_target_preds", ",", "\n", "reduction", "=", "'none'", ")", "*", "pos_centerness_targets", ")", ".", "sum", "(", ")", "/", "\n", "pos_centerness_targets", ".", "sum", "(", ")", ")", "[", "None", "]", "\n", "loss_centerness", "=", "F", ".", "binary_cross_entropy_with_logits", "(", "\n", "pos_centerness", ",", "pos_centerness_targets", ",", "reduction", "=", "'mean'", ")", "[", "None", "]", "\n", "", "else", ":", "\n", "            ", "loss_reg", "=", "pos_bbox_preds", ".", "sum", "(", ")", "[", "None", "]", "\n", "loss_centerness", "=", "pos_centerness", ".", "sum", "(", ")", "[", "None", "]", "\n", "\n", "", "return", "dict", "(", "\n", "loss_cls", "=", "loss_cls", ",", "\n", "loss_reg", "=", "loss_reg", ",", "\n", "loss_centerness", "=", "loss_centerness", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.get_bboxes": [[193, 224], ["len", "fcos_head.FCOSHead.get_points", "range", "len", "len", "len", "fcos_head.FCOSHead.get_bboxes_single", "result_list.append", "featmap.size", "[].detach", "[].detach", "[].detach", "range", "range", "range"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.get_points", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.get_bboxes_single"], ["", "def", "get_bboxes", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "centernesses", ",", "\n", "img_metas", ",", "\n", "cfg", ",", "\n", "rescale", "=", "None", ")", ":", "\n", "        ", "assert", "len", "(", "cls_scores", ")", "==", "len", "(", "bbox_preds", ")", "\n", "num_levels", "=", "len", "(", "cls_scores", ")", "\n", "\n", "featmap_sizes", "=", "[", "featmap", ".", "size", "(", ")", "[", "-", "2", ":", "]", "for", "featmap", "in", "cls_scores", "]", "\n", "mlvl_points", "=", "self", ".", "get_points", "(", "featmap_sizes", ",", "bbox_preds", "[", "0", "]", ".", "dtype", ",", "\n", "bbox_preds", "[", "0", "]", ".", "device", ")", "\n", "result_list", "=", "[", "]", "\n", "for", "img_id", "in", "range", "(", "len", "(", "img_metas", ")", ")", ":", "\n", "            ", "cls_score_list", "=", "[", "\n", "cls_scores", "[", "i", "]", "[", "img_id", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "bbox_pred_list", "=", "[", "\n", "bbox_preds", "[", "i", "]", "[", "img_id", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "centerness_pred_list", "=", "[", "\n", "centernesses", "[", "i", "]", "[", "img_id", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "img_shape", "=", "img_metas", "[", "img_id", "]", "[", "'img_shape'", "]", "\n", "scale_factor", "=", "img_metas", "[", "img_id", "]", "[", "'scale_factor'", "]", "\n", "det_bboxes", "=", "self", ".", "get_bboxes_single", "(", "\n", "cls_score_list", ",", "bbox_pred_list", ",", "centerness_pred_list", ",", "\n", "mlvl_points", ",", "img_shape", ",", "scale_factor", ",", "cfg", ",", "rescale", ")", "\n", "result_list", ".", "append", "(", "det_bboxes", ")", "\n", "", "return", "result_list", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.get_bboxes_single": [[225, 273], ["zip", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat.new_zeros", "torch.cat.new_zeros", "torch.cat.new_zeros", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "mmdet.core.multiclass_nms", "len", "len", "len", "cls_score.permute().reshape().sigmoid", "centerness.permute().reshape().sigmoid.permute().reshape().sigmoid.permute().reshape().sigmoid", "bbox_pred.permute().reshape.permute().reshape.permute().reshape", "cfg.get", "mmdet.core.distance2bbox", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.new_tensor", "torch.cat.new_tensor", "torch.cat.new_tensor", "max_scores.topk", "cls_score.size", "bbox_pred.permute().reshape.permute().reshape.size", "cls_score.permute().reshape", "centerness.permute().reshape().sigmoid.permute().reshape().sigmoid.permute().reshape", "bbox_pred.permute().reshape.permute().reshape.permute", "cls_score.permute", "centerness.permute().reshape().sigmoid.permute().reshape().sigmoid.permute"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.post_processing.bbox_nms.multiclass_nms", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.distance2bbox"], ["", "def", "get_bboxes_single", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "centernesses", ",", "\n", "mlvl_points", ",", "\n", "img_shape", ",", "\n", "scale_factor", ",", "\n", "cfg", ",", "\n", "rescale", "=", "False", ")", ":", "\n", "        ", "assert", "len", "(", "cls_scores", ")", "==", "len", "(", "bbox_preds", ")", "==", "len", "(", "mlvl_points", ")", "\n", "mlvl_bboxes", "=", "[", "]", "\n", "mlvl_scores", "=", "[", "]", "\n", "mlvl_centerness", "=", "[", "]", "\n", "for", "cls_score", ",", "bbox_pred", ",", "centerness", ",", "points", "in", "zip", "(", "\n", "cls_scores", ",", "bbox_preds", ",", "centernesses", ",", "mlvl_points", ")", ":", "\n", "            ", "assert", "cls_score", ".", "size", "(", ")", "[", "-", "2", ":", "]", "==", "bbox_pred", ".", "size", "(", ")", "[", "-", "2", ":", "]", "\n", "scores", "=", "cls_score", ".", "permute", "(", "1", ",", "2", ",", "0", ")", ".", "reshape", "(", "\n", "-", "1", ",", "self", ".", "cls_out_channels", ")", ".", "sigmoid", "(", ")", "\n", "centerness", "=", "centerness", ".", "permute", "(", "1", ",", "2", ",", "0", ")", ".", "reshape", "(", "-", "1", ")", ".", "sigmoid", "(", ")", "\n", "\n", "bbox_pred", "=", "bbox_pred", ".", "permute", "(", "1", ",", "2", ",", "0", ")", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "nms_pre", "=", "cfg", ".", "get", "(", "'nms_pre'", ",", "-", "1", ")", "\n", "if", "nms_pre", ">", "0", "and", "scores", ".", "shape", "[", "0", "]", ">", "nms_pre", ":", "\n", "                ", "max_scores", ",", "_", "=", "(", "scores", "*", "centerness", "[", ":", ",", "None", "]", ")", ".", "max", "(", "dim", "=", "1", ")", "\n", "_", ",", "topk_inds", "=", "max_scores", ".", "topk", "(", "nms_pre", ")", "\n", "points", "=", "points", "[", "topk_inds", ",", ":", "]", "\n", "bbox_pred", "=", "bbox_pred", "[", "topk_inds", ",", ":", "]", "\n", "scores", "=", "scores", "[", "topk_inds", ",", ":", "]", "\n", "centerness", "=", "centerness", "[", "topk_inds", "]", "\n", "", "bboxes", "=", "distance2bbox", "(", "points", ",", "bbox_pred", ",", "max_shape", "=", "img_shape", ")", "\n", "mlvl_bboxes", ".", "append", "(", "bboxes", ")", "\n", "mlvl_scores", ".", "append", "(", "scores", ")", "\n", "mlvl_centerness", ".", "append", "(", "centerness", ")", "\n", "", "mlvl_bboxes", "=", "torch", ".", "cat", "(", "mlvl_bboxes", ")", "\n", "if", "rescale", ":", "\n", "            ", "mlvl_bboxes", "/=", "mlvl_bboxes", ".", "new_tensor", "(", "scale_factor", ")", "\n", "", "mlvl_scores", "=", "torch", ".", "cat", "(", "mlvl_scores", ")", "\n", "padding", "=", "mlvl_scores", ".", "new_zeros", "(", "mlvl_scores", ".", "shape", "[", "0", "]", ",", "1", ")", "\n", "mlvl_scores", "=", "torch", ".", "cat", "(", "[", "padding", ",", "mlvl_scores", "]", ",", "dim", "=", "1", ")", "\n", "mlvl_centerness", "=", "torch", ".", "cat", "(", "mlvl_centerness", ")", "\n", "det_bboxes", ",", "det_labels", "=", "multiclass_nms", "(", "\n", "mlvl_bboxes", ",", "\n", "mlvl_scores", ",", "\n", "cfg", ".", "score_thr", ",", "\n", "cfg", ".", "nms", ",", "\n", "cfg", ".", "max_per_img", ",", "\n", "score_factors", "=", "mlvl_centerness", ")", "\n", "return", "det_bboxes", ",", "det_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.get_points": [[274, 291], ["range", "len", "mlvl_points.append", "fcos_head.FCOSHead.get_points_single"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.get_points_single"], ["", "def", "get_points", "(", "self", ",", "featmap_sizes", ",", "dtype", ",", "device", ")", ":", "\n", "        ", "\"\"\"Get points according to feature map sizes.\n\n        Args:\n            featmap_sizes (list[tuple]): Multi-level feature map sizes.\n            dtype (torch.dtype): Type of points.\n            device (torch.device): Device of points.\n\n        Returns:\n            tuple: points of each image.\n        \"\"\"", "\n", "mlvl_points", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "featmap_sizes", ")", ")", ":", "\n", "            ", "mlvl_points", ".", "append", "(", "\n", "self", ".", "get_points_single", "(", "featmap_sizes", "[", "i", "]", ",", "self", ".", "strides", "[", "i", "]", ",", "\n", "dtype", ",", "device", ")", ")", "\n", "", "return", "mlvl_points", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.get_points_single": [[292, 302], ["torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "x.reshape", "y.reshape"], "methods", ["None"], ["", "def", "get_points_single", "(", "self", ",", "featmap_size", ",", "stride", ",", "dtype", ",", "device", ")", ":", "\n", "        ", "h", ",", "w", "=", "featmap_size", "\n", "x_range", "=", "torch", ".", "arange", "(", "\n", "0", ",", "w", "*", "stride", ",", "stride", ",", "dtype", "=", "dtype", ",", "device", "=", "device", ")", "\n", "y_range", "=", "torch", ".", "arange", "(", "\n", "0", ",", "h", "*", "stride", ",", "stride", ",", "dtype", "=", "dtype", ",", "device", "=", "device", ")", "\n", "y", ",", "x", "=", "torch", ".", "meshgrid", "(", "y_range", ",", "x_range", ")", "\n", "points", "=", "torch", ".", "stack", "(", "\n", "(", "x", ".", "reshape", "(", "-", "1", ")", ",", "y", ".", "reshape", "(", "-", "1", ")", ")", ",", "dim", "=", "-", "1", ")", "+", "stride", "//", "2", "\n", "return", "points", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.fcos_target": [[303, 340], ["len", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "mmdet.core.multi_apply", "range", "len", "len", "[].expand_as", "center.size", "labels.split", "bbox_targets.split", "concat_lvl_labels.append", "concat_lvl_bbox_targets.append", "range", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "points[].new_tensor"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.multi_apply"], ["", "def", "fcos_target", "(", "self", ",", "points", ",", "gt_bboxes_list", ",", "gt_labels_list", ")", ":", "\n", "        ", "assert", "len", "(", "points", ")", "==", "len", "(", "self", ".", "regress_ranges", ")", "\n", "num_levels", "=", "len", "(", "points", ")", "\n", "# expand regress ranges to align with points", "\n", "expanded_regress_ranges", "=", "[", "\n", "points", "[", "i", "]", ".", "new_tensor", "(", "self", ".", "regress_ranges", "[", "i", "]", ")", "[", "None", "]", ".", "expand_as", "(", "\n", "points", "[", "i", "]", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "# concat all levels points and regress ranges", "\n", "concat_regress_ranges", "=", "torch", ".", "cat", "(", "expanded_regress_ranges", ",", "dim", "=", "0", ")", "\n", "concat_points", "=", "torch", ".", "cat", "(", "points", ",", "dim", "=", "0", ")", "\n", "# get labels and bbox_targets of each image", "\n", "labels_list", ",", "bbox_targets_list", "=", "multi_apply", "(", "\n", "self", ".", "fcos_target_single", ",", "\n", "gt_bboxes_list", ",", "\n", "gt_labels_list", ",", "\n", "points", "=", "concat_points", ",", "\n", "regress_ranges", "=", "concat_regress_ranges", ")", "\n", "\n", "# split to per img, per level", "\n", "num_points", "=", "[", "center", ".", "size", "(", "0", ")", "for", "center", "in", "points", "]", "\n", "labels_list", "=", "[", "labels", ".", "split", "(", "num_points", ",", "0", ")", "for", "labels", "in", "labels_list", "]", "\n", "bbox_targets_list", "=", "[", "\n", "bbox_targets", ".", "split", "(", "num_points", ",", "0", ")", "\n", "for", "bbox_targets", "in", "bbox_targets_list", "\n", "]", "\n", "\n", "# concat per level image", "\n", "concat_lvl_labels", "=", "[", "]", "\n", "concat_lvl_bbox_targets", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "num_levels", ")", ":", "\n", "            ", "concat_lvl_labels", ".", "append", "(", "\n", "torch", ".", "cat", "(", "[", "labels", "[", "i", "]", "for", "labels", "in", "labels_list", "]", ")", ")", "\n", "concat_lvl_bbox_targets", ".", "append", "(", "\n", "torch", ".", "cat", "(", "\n", "[", "bbox_targets", "[", "i", "]", "for", "bbox_targets", "in", "bbox_targets_list", "]", ")", ")", "\n", "", "return", "concat_lvl_labels", ",", "concat_lvl_bbox_targets", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.fcos_target_single": [[341, 383], ["points.size", "gt_labels.size", "areas[].repeat", "regress_ranges[].expand", "gt_bboxes[].expand", "xs[].expand", "ys[].expand", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "areas[].repeat.min", "torch.stack.max", "torch.stack.max", "torch.stack.max", "torch.stack.min", "torch.stack.min", "torch.stack.min", "range"], "methods", ["None"], ["", "def", "fcos_target_single", "(", "self", ",", "gt_bboxes", ",", "gt_labels", ",", "points", ",", "regress_ranges", ")", ":", "\n", "        ", "num_points", "=", "points", ".", "size", "(", "0", ")", "\n", "num_gts", "=", "gt_labels", ".", "size", "(", "0", ")", "\n", "\n", "areas", "=", "(", "gt_bboxes", "[", ":", ",", "2", "]", "-", "gt_bboxes", "[", ":", ",", "0", "]", "+", "1", ")", "*", "(", "\n", "gt_bboxes", "[", ":", ",", "3", "]", "-", "gt_bboxes", "[", ":", ",", "1", "]", "+", "1", ")", "\n", "# TODO: figure out why these two are different", "\n", "# areas = areas[None].expand(num_points, num_gts)", "\n", "areas", "=", "areas", "[", "None", "]", ".", "repeat", "(", "num_points", ",", "1", ")", "\n", "regress_ranges", "=", "regress_ranges", "[", ":", ",", "None", ",", ":", "]", ".", "expand", "(", "\n", "num_points", ",", "num_gts", ",", "2", ")", "\n", "gt_bboxes", "=", "gt_bboxes", "[", "None", "]", ".", "expand", "(", "num_points", ",", "num_gts", ",", "4", ")", "\n", "xs", ",", "ys", "=", "points", "[", ":", ",", "0", "]", ",", "points", "[", ":", ",", "1", "]", "\n", "xs", "=", "xs", "[", ":", ",", "None", "]", ".", "expand", "(", "num_points", ",", "num_gts", ")", "\n", "ys", "=", "ys", "[", ":", ",", "None", "]", ".", "expand", "(", "num_points", ",", "num_gts", ")", "\n", "\n", "left", "=", "xs", "-", "gt_bboxes", "[", "...", ",", "0", "]", "\n", "right", "=", "gt_bboxes", "[", "...", ",", "2", "]", "-", "xs", "\n", "top", "=", "ys", "-", "gt_bboxes", "[", "...", ",", "1", "]", "\n", "bottom", "=", "gt_bboxes", "[", "...", ",", "3", "]", "-", "ys", "\n", "bbox_targets", "=", "torch", ".", "stack", "(", "(", "left", ",", "top", ",", "right", ",", "bottom", ")", ",", "-", "1", ")", "\n", "\n", "# condition1: inside a gt bbox", "\n", "inside_gt_bbox_mask", "=", "bbox_targets", ".", "min", "(", "-", "1", ")", "[", "0", "]", ">", "0", "\n", "\n", "# condition2: limit the regression range for each location", "\n", "max_regress_distance", "=", "bbox_targets", ".", "max", "(", "-", "1", ")", "[", "0", "]", "\n", "inside_regress_range", "=", "(", "\n", "max_regress_distance", ">=", "regress_ranges", "[", "...", ",", "0", "]", ")", "&", "(", "\n", "max_regress_distance", "<=", "regress_ranges", "[", "...", ",", "1", "]", ")", "\n", "\n", "# if there are still more than one objects for a location,", "\n", "# we choose the one with minimal area", "\n", "areas", "[", "inside_gt_bbox_mask", "==", "0", "]", "=", "INF", "\n", "areas", "[", "inside_regress_range", "==", "0", "]", "=", "INF", "\n", "min_area", ",", "min_area_inds", "=", "areas", ".", "min", "(", "dim", "=", "1", ")", "\n", "\n", "labels", "=", "gt_labels", "[", "min_area_inds", "]", "\n", "labels", "[", "min_area", "==", "INF", "]", "=", "0", "\n", "bbox_targets", "=", "bbox_targets", "[", "range", "(", "num_points", ")", ",", "min_area_inds", "]", "\n", "\n", "return", "labels", ",", "bbox_targets", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.fcos_head.FCOSHead.centerness_target": [[384, 398], ["torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "left_right.min", "left_right.max", "top_bottom.min", "top_bottom.max"], "methods", ["None"], ["", "def", "centerness_target", "(", "self", ",", "pos_bbox_targets", ")", ":", "\n", "        ", "\"\"\"\n\n        :param pos_bbox_targets: tensor of shape (num, 4), store the top-left and bottom-right\n              corner of the corresponding ground truth boxes for the positives.\n        :return:\n        \"\"\"", "\n", "# only calculate pos centerness targets, otherwise there may be nan", "\n", "left_right", "=", "pos_bbox_targets", "[", ":", ",", "[", "0", ",", "2", "]", "]", "\n", "top_bottom", "=", "pos_bbox_targets", "[", ":", ",", "[", "1", ",", "3", "]", "]", "\n", "centerness_targets", "=", "(", "\n", "left_right", ".", "min", "(", "dim", "=", "-", "1", ")", "[", "0", "]", "/", "left_right", ".", "max", "(", "dim", "=", "-", "1", ")", "[", "0", "]", ")", "*", "(", "\n", "top_bottom", ".", "min", "(", "dim", "=", "-", "1", ")", "[", "0", "]", "/", "top_bottom", ".", "max", "(", "dim", "=", "-", "1", ")", "[", "0", "]", ")", "\n", "return", "torch", ".", "sqrt", "(", "centerness_targets", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.retina_head.RetinaHead.__init__": [[13, 32], ["numpy.array", "anchor_head.AnchorHead.__init__", "range"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "\n", "num_classes", ",", "\n", "in_channels", ",", "\n", "stacked_convs", "=", "4", ",", "\n", "octave_base_scale", "=", "4", ",", "\n", "scales_per_octave", "=", "3", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "None", ",", "\n", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "stacked_convs", "=", "stacked_convs", "\n", "self", ".", "octave_base_scale", "=", "octave_base_scale", "\n", "self", ".", "scales_per_octave", "=", "scales_per_octave", "\n", "self", ".", "conv_cfg", "=", "conv_cfg", "\n", "self", ".", "norm_cfg", "=", "norm_cfg", "\n", "octave_scales", "=", "np", ".", "array", "(", "\n", "[", "2", "**", "(", "i", "/", "scales_per_octave", ")", "for", "i", "in", "range", "(", "scales_per_octave", ")", "]", ")", "\n", "anchor_scales", "=", "octave_scales", "*", "octave_base_scale", "\n", "super", "(", "RetinaHead", ",", "self", ")", ".", "__init__", "(", "\n", "num_classes", ",", "in_channels", ",", "anchor_scales", "=", "anchor_scales", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.retina_head.RetinaHead._init_layers": [[35, 66], ["torch.ReLU", "torch.ModuleList", "torch.ModuleList", "range", "torch.Conv2d", "torch.Conv2d", "retina_head.RetinaHead.cls_convs.append", "retina_head.RetinaHead.reg_convs.append", "utils.ConvModule", "utils.ConvModule"], "methods", ["None"], ["", "def", "_init_layers", "(", "self", ")", ":", "\n", "        ", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "self", ".", "cls_convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "self", ".", "reg_convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "for", "i", "in", "range", "(", "self", ".", "stacked_convs", ")", ":", "\n", "            ", "chn", "=", "self", ".", "in_channels", "if", "i", "==", "0", "else", "self", ".", "feat_channels", "\n", "self", ".", "cls_convs", ".", "append", "(", "\n", "ConvModule", "(", "\n", "chn", ",", "\n", "self", ".", "feat_channels", ",", "\n", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ")", ")", "\n", "self", ".", "reg_convs", ".", "append", "(", "\n", "ConvModule", "(", "\n", "chn", ",", "\n", "self", ".", "feat_channels", ",", "\n", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ")", ")", "\n", "", "self", ".", "retina_cls", "=", "nn", ".", "Conv2d", "(", "\n", "self", ".", "feat_channels", ",", "\n", "self", ".", "num_anchors", "*", "self", ".", "cls_out_channels", ",", "\n", "3", ",", "\n", "padding", "=", "1", ")", "\n", "\n", "self", ".", "retina_reg", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "self", ".", "num_anchors", "*", "4", ",", "3", ",", "padding", "=", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.retina_head.RetinaHead.init_weights": [[67, 75], ["utils.bias_init_with_prob", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.bias_init_with_prob", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "for", "m", "in", "self", ".", "cls_convs", ":", "\n", "            ", "normal_init", "(", "m", ".", "conv", ",", "std", "=", "0.01", ")", "\n", "", "for", "m", "in", "self", ".", "reg_convs", ":", "\n", "            ", "normal_init", "(", "m", ".", "conv", ",", "std", "=", "0.01", ")", "\n", "", "bias_cls", "=", "bias_init_with_prob", "(", "0.01", ")", "\n", "normal_init", "(", "self", ".", "retina_cls", ",", "std", "=", "0.01", ",", "bias", "=", "bias_cls", ")", "\n", "normal_init", "(", "self", ".", "retina_reg", ",", "std", "=", "0.01", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.retina_head.RetinaHead.forward_single": [[76, 91], ["retina_head.RetinaHead.retina_cls", "retina_head.RetinaHead.retina_reg", "cls_conv", "reg_conv"], "methods", ["None"], ["", "def", "forward_single", "(", "self", ",", "x", ")", ":", "\n", "        ", "cls_feat", "=", "x", "\n", "reg_feat", "=", "x", "\n", "for", "cls_conv", "in", "self", ".", "cls_convs", ":", "\n", "            ", "cls_feat", "=", "cls_conv", "(", "cls_feat", ")", "\n", "", "for", "reg_conv", "in", "self", ".", "reg_convs", ":", "\n", "            ", "reg_feat", "=", "reg_conv", "(", "reg_feat", ")", "\n", "\n", "# detach the cls_feat and reg_feat", "\n", "# cls_feat = cls_feat.detach()", "\n", "# reg_feat = reg_feat.detach()", "\n", "\n", "", "cls_score", "=", "self", ".", "retina_cls", "(", "cls_feat", ")", "\n", "bbox_pred", "=", "self", ".", "retina_reg", "(", "reg_feat", ")", "\n", "return", "cls_score", ",", "bbox_pred", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.rpn_head.RPNHead.__init__": [[15, 17], ["anchor_head.AnchorHead.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "in_channels", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "RPNHead", ",", "self", ")", ".", "__init__", "(", "2", ",", "in_channels", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.rpn_head.RPNHead._init_layers": [[18, 24], ["torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d"], "methods", ["None"], ["", "def", "_init_layers", "(", "self", ")", ":", "\n", "        ", "self", ".", "rpn_conv", "=", "nn", ".", "Conv2d", "(", "\n", "self", ".", "in_channels", ",", "self", ".", "feat_channels", ",", "3", ",", "padding", "=", "1", ")", "\n", "self", ".", "rpn_cls", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "\n", "self", ".", "num_anchors", "*", "self", ".", "cls_out_channels", ",", "1", ")", "\n", "self", ".", "rpn_reg", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "self", ".", "num_anchors", "*", "4", ",", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.rpn_head.RPNHead.init_weights": [[25, 29], ["mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "normal_init", "(", "self", ".", "rpn_conv", ",", "std", "=", "0.01", ")", "\n", "normal_init", "(", "self", ".", "rpn_cls", ",", "std", "=", "0.01", ")", "\n", "normal_init", "(", "self", ".", "rpn_reg", ",", "std", "=", "0.01", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.rpn_head.RPNHead.forward_single": [[30, 36], ["rpn_head.RPNHead.rpn_conv", "torch.relu", "torch.relu", "torch.relu", "rpn_head.RPNHead.rpn_cls", "rpn_head.RPNHead.rpn_reg"], "methods", ["None"], ["", "def", "forward_single", "(", "self", ",", "x", ")", ":", "\n", "        ", "x", "=", "self", ".", "rpn_conv", "(", "x", ")", "\n", "x", "=", "F", ".", "relu", "(", "x", ",", "inplace", "=", "True", ")", "\n", "rpn_cls_score", "=", "self", ".", "rpn_cls", "(", "x", ")", "\n", "rpn_bbox_pred", "=", "self", ".", "rpn_reg", "(", "x", ")", "\n", "return", "rpn_cls_score", ",", "rpn_bbox_pred", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.rpn_head.RPNHead.loss": [[37, 54], ["super().loss", "dict"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.loss"], ["", "def", "loss", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "gt_bboxes", ",", "\n", "img_metas", ",", "\n", "cfg", ",", "\n", "gt_bboxes_ignore", "=", "None", ")", ":", "\n", "        ", "losses", "=", "super", "(", "RPNHead", ",", "self", ")", ".", "loss", "(", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "gt_bboxes", ",", "\n", "None", ",", "\n", "img_metas", ",", "\n", "cfg", ",", "\n", "gt_bboxes_ignore", "=", "gt_bboxes_ignore", ")", "\n", "return", "dict", "(", "\n", "loss_rpn_cls", "=", "losses", "[", "'loss_cls'", "]", ",", "loss_rpn_bbox", "=", "losses", "[", "'loss_bbox'", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.rpn_head.RPNHead.get_bboxes_single": [[55, 136], ["range", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "len", "rpn_cls_score.reshape.reshape.permute", "rpn_bbox_pred.permute().reshape.permute().reshape.permute().reshape", "mmdet.core.delta2bbox", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "mmdet.ops.nms", "mlvl_proposals.append", "mmdet.ops.nms", "min", "rpn_cls_score.reshape.sigmoid.topk", "rpn_cls_score.reshape.reshape.reshape", "rpn_cls_score.reshape.reshape.sigmoid", "rpn_cls_score.reshape.reshape.reshape", "rpn_cls_score.reshape.sigmoid.topk", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "rpn_cls_score.reshape.reshape.size", "rpn_bbox_pred.permute().reshape.permute().reshape.size", "rpn_cls_score.reshape.reshape.softmax", "rpn_bbox_pred.permute().reshape.permute().reshape.permute", "rpn_cls_score.reshape.sigmoid.unsqueeze", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.nms.nms_wrapper.nms", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.nms.nms_wrapper.nms"], ["", "def", "get_bboxes_single", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "mlvl_anchors", ",", "\n", "img_shape", ",", "\n", "scale_factor", ",", "\n", "gt_bboxes", ",", "# added by WSK", "\n", "gt_labels", ",", "# added by WSK", "\n", "cfg", ",", "\n", "rescale", "=", "False", ")", ":", "\n", "        ", "\"\"\"\n\n        :param cls_scores: list[Tensor]. len(cls_score) equals to the number of feature map levels.\n              and cls_scores[i].size() is (A*C, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param bbox_preds: list[Tensor]. len(bbox_preds) equals to the number of feature map levels.\n              and bbox_preds[i].size() is (A*4, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map. if use_iou_branch is used, (A*5, width_i, height_i), the\n              additional dim represents the predicted IoU.\n        :param mlvl_anchors: list[Tensor]. len(bbox_preds) equals to the number of feature map levels.\n              and mlvl_anchors[i].size() is (A*4, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param img_shape:\n        :param scale_factor:\n        :param cfg:\n        :param rescale:\n        :return:\n              proposals: tensor of shape (num_proposal, 5)\n        \"\"\"", "\n", "mlvl_proposals", "=", "[", "]", "\n", "\n", "# postprocess the detection results of RPN for each feature level respectively.", "\n", "for", "idx", "in", "range", "(", "len", "(", "cls_scores", ")", ")", ":", "\n", "            ", "rpn_cls_score", "=", "cls_scores", "[", "idx", "]", "\n", "rpn_bbox_pred", "=", "bbox_preds", "[", "idx", "]", "\n", "assert", "rpn_cls_score", ".", "size", "(", ")", "[", "-", "2", ":", "]", "==", "rpn_bbox_pred", ".", "size", "(", ")", "[", "-", "2", ":", "]", "\n", "anchors", "=", "mlvl_anchors", "[", "idx", "]", "\n", "rpn_cls_score", "=", "rpn_cls_score", ".", "permute", "(", "1", ",", "2", ",", "0", ")", "\n", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "                ", "rpn_cls_score", "=", "rpn_cls_score", ".", "reshape", "(", "-", "1", ")", "\n", "scores", "=", "rpn_cls_score", ".", "sigmoid", "(", ")", "# (width_i*height_i*A)", "\n", "", "else", ":", "\n", "                ", "rpn_cls_score", "=", "rpn_cls_score", ".", "reshape", "(", "-", "1", ",", "2", ")", "\n", "scores", "=", "rpn_cls_score", ".", "softmax", "(", "dim", "=", "1", ")", "[", ":", ",", "1", "]", "# (width_i*height_i*A, 2)", "\n", "\n", "", "rpn_bbox_pred", "=", "rpn_bbox_pred", ".", "permute", "(", "1", ",", "2", ",", "0", ")", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "\n", "# select the top-k proposals based on the scores for each feature level respectively.", "\n", "if", "cfg", ".", "nms_pre", ">", "0", "and", "scores", ".", "shape", "[", "0", "]", ">", "cfg", ".", "nms_pre", ":", "\n", "                ", "_", ",", "topk_inds", "=", "scores", ".", "topk", "(", "cfg", ".", "nms_pre", ")", "\n", "rpn_bbox_pred", "=", "rpn_bbox_pred", "[", "topk_inds", ",", ":", "]", "\n", "anchors", "=", "anchors", "[", "topk_inds", ",", ":", "]", "\n", "scores", "=", "scores", "[", "topk_inds", "]", "\n", "", "proposals", "=", "delta2bbox", "(", "anchors", ",", "rpn_bbox_pred", ",", "self", ".", "target_means", ",", "\n", "self", ".", "target_stds", ",", "img_shape", ")", "\n", "if", "cfg", ".", "min_bbox_size", ">", "0", ":", "\n", "                ", "w", "=", "proposals", "[", ":", ",", "2", "]", "-", "proposals", "[", ":", ",", "0", "]", "+", "1", "\n", "h", "=", "proposals", "[", ":", ",", "3", "]", "-", "proposals", "[", ":", ",", "1", "]", "+", "1", "\n", "valid_inds", "=", "torch", ".", "nonzero", "(", "(", "w", ">=", "cfg", ".", "min_bbox_size", ")", "&", "\n", "(", "h", ">=", "cfg", ".", "min_bbox_size", ")", ")", ".", "squeeze", "(", ")", "\n", "proposals", "=", "proposals", "[", "valid_inds", ",", ":", "]", "\n", "scores", "=", "scores", "[", "valid_inds", "]", "\n", "\n", "# apply nms to the selected proposals for each feature level respectively.", "\n", "", "proposals", "=", "torch", ".", "cat", "(", "[", "proposals", ",", "scores", ".", "unsqueeze", "(", "-", "1", ")", "]", ",", "dim", "=", "-", "1", ")", "# (width_i*height_i*A, 5)", "\n", "proposals", ",", "_", "=", "nms", "(", "proposals", ",", "cfg", ".", "nms_thr", ")", "\n", "proposals", "=", "proposals", "[", ":", "cfg", ".", "nms_post", ",", ":", "]", "\n", "mlvl_proposals", ".", "append", "(", "proposals", ")", "\n", "", "proposals", "=", "torch", ".", "cat", "(", "mlvl_proposals", ",", "0", ")", "# (num_proposal, 5)", "\n", "if", "cfg", ".", "nms_across_levels", ":", "\n", "            ", "proposals", ",", "_", "=", "nms", "(", "proposals", ",", "cfg", ".", "nms_thr", ")", "\n", "proposals", "=", "proposals", "[", ":", "cfg", ".", "max_num", ",", ":", "]", "\n", "", "else", ":", "\n", "            ", "scores", "=", "proposals", "[", ":", ",", "4", "]", "\n", "# cfg.max_num proposals after nms for rpn", "\n", "num", "=", "min", "(", "cfg", ".", "max_num", ",", "proposals", ".", "shape", "[", "0", "]", ")", "\n", "\n", "# select the top-k proposals for all the feature levels.", "\n", "_", ",", "topk_inds", "=", "scores", ".", "topk", "(", "num", ")", "\n", "proposals", "=", "proposals", "[", "topk_inds", ",", ":", "]", "\n", "", "return", "proposals", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.ga_rpn_head.GARPNHead.__init__": [[16, 18], ["guided_anchor_head.GuidedAnchorHead.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["def", "__init__", "(", "self", ",", "in_channels", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "GARPNHead", ",", "self", ")", ".", "__init__", "(", "2", ",", "in_channels", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.ga_rpn_head.GARPNHead._init_layers": [[19, 25], ["torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "super()._init_layers"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead._init_layers"], ["", "def", "_init_layers", "(", "self", ")", ":", "\n", "        ", "self", ".", "rpn_conv", "=", "nn", ".", "Conv2d", "(", "self", ".", "in_channels", ",", "\n", "self", ".", "feat_channels", ",", "\n", "3", ",", "\n", "padding", "=", "1", ")", "\n", "super", "(", "GARPNHead", ",", "self", ")", ".", "_init_layers", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.ga_rpn_head.GARPNHead.init_weights": [[26, 29], ["mmcv.cnn.normal_init", "super().init_weights"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "normal_init", "(", "self", ".", "rpn_conv", ",", "std", "=", "0.01", ")", "\n", "super", "(", "GARPNHead", ",", "self", ")", ".", "init_weights", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.ga_rpn_head.GARPNHead.forward_single": [[30, 36], ["ga_rpn_head.GARPNHead.rpn_conv", "torch.relu", "torch.relu", "torch.relu", "super().forward_single"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.forward_single"], ["", "def", "forward_single", "(", "self", ",", "x", ")", ":", "\n", "        ", "x", "=", "self", ".", "rpn_conv", "(", "x", ")", "\n", "x", "=", "F", ".", "relu", "(", "x", ",", "inplace", "=", "True", ")", "\n", "(", "cls_score", ",", "bbox_pred", ",", "shape_pred", ",", "\n", "loc_pred", ")", "=", "super", "(", "GARPNHead", ",", "self", ")", ".", "forward_single", "(", "x", ")", "\n", "return", "cls_score", ",", "bbox_pred", ",", "shape_pred", ",", "loc_pred", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.ga_rpn_head.GARPNHead.loss": [[37, 59], ["super().loss", "dict"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.loss"], ["", "def", "loss", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "shape_preds", ",", "\n", "loc_preds", ",", "\n", "gt_bboxes", ",", "\n", "img_metas", ",", "\n", "cfg", ",", "\n", "gt_bboxes_ignore", "=", "None", ")", ":", "\n", "        ", "losses", "=", "super", "(", "GARPNHead", ",", "self", ")", ".", "loss", "(", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "shape_preds", ",", "\n", "loc_preds", ",", "\n", "gt_bboxes", ",", "\n", "None", ",", "\n", "img_metas", ",", "\n", "cfg", ",", "\n", "gt_bboxes_ignore", "=", "gt_bboxes_ignore", ")", "\n", "return", "dict", "(", "loss_rpn_cls", "=", "losses", "[", "'loss_cls'", "]", ",", "\n", "loss_rpn_bbox", "=", "losses", "[", "'loss_bbox'", "]", ",", "\n", "loss_anchor_shape", "=", "losses", "[", "'loss_shape'", "]", ",", "\n", "loss_anchor_loc", "=", "losses", "[", "'loss_loc'", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.ga_rpn_head.GARPNHead.get_bboxes_single": [[60, 128], ["range", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "len", "rpn_cls_score.reshape.reshape.permute", "mmdet.core.delta2bbox", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "mmdet.ops.nms", "mlvl_proposals.append", "mmdet.ops.nms", "min", "scores.unsqueeze.unsqueeze.topk", "mask.sum", "rpn_cls_score.reshape.reshape.reshape", "rpn_cls_score.reshape.reshape.sigmoid", "rpn_cls_score.reshape.reshape.reshape", "rpn_bbox_pred.unsqueeze.unsqueeze.permute().reshape", "scores.unsqueeze.unsqueeze.dim", "rpn_bbox_pred.unsqueeze.unsqueeze.unsqueeze", "anchors.unsqueeze.unsqueeze.unsqueeze", "scores.unsqueeze.unsqueeze.unsqueeze", "scores.unsqueeze.unsqueeze.topk", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "rpn_cls_score.reshape.reshape.size", "rpn_bbox_pred.unsqueeze.unsqueeze.size", "rpn_cls_score.reshape.reshape.softmax", "scores.unsqueeze.unsqueeze.unsqueeze", "rpn_bbox_pred.unsqueeze.unsqueeze.permute", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.nms.nms_wrapper.nms", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.nms.nms_wrapper.nms"], ["", "def", "get_bboxes_single", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "mlvl_anchors", ",", "\n", "mlvl_masks", ",", "\n", "img_shape", ",", "\n", "scale_factor", ",", "\n", "cfg", ",", "\n", "rescale", "=", "False", ")", ":", "\n", "        ", "mlvl_proposals", "=", "[", "]", "\n", "for", "idx", "in", "range", "(", "len", "(", "cls_scores", ")", ")", ":", "\n", "            ", "rpn_cls_score", "=", "cls_scores", "[", "idx", "]", "\n", "rpn_bbox_pred", "=", "bbox_preds", "[", "idx", "]", "\n", "anchors", "=", "mlvl_anchors", "[", "idx", "]", "\n", "mask", "=", "mlvl_masks", "[", "idx", "]", "\n", "assert", "rpn_cls_score", ".", "size", "(", ")", "[", "-", "2", ":", "]", "==", "rpn_bbox_pred", ".", "size", "(", ")", "[", "-", "2", ":", "]", "\n", "# if no location is kept, end.", "\n", "if", "mask", ".", "sum", "(", ")", "==", "0", ":", "\n", "                ", "continue", "\n", "", "rpn_cls_score", "=", "rpn_cls_score", ".", "permute", "(", "1", ",", "2", ",", "0", ")", "\n", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "                ", "rpn_cls_score", "=", "rpn_cls_score", ".", "reshape", "(", "-", "1", ")", "\n", "scores", "=", "rpn_cls_score", ".", "sigmoid", "(", ")", "\n", "", "else", ":", "\n", "                ", "rpn_cls_score", "=", "rpn_cls_score", ".", "reshape", "(", "-", "1", ",", "2", ")", "\n", "scores", "=", "rpn_cls_score", ".", "softmax", "(", "dim", "=", "1", ")", "[", ":", ",", "1", "]", "\n", "# filter scores, bbox_pred w.r.t. mask.", "\n", "# anchors are filtered in get_anchors() beforehand.", "\n", "", "scores", "=", "scores", "[", "mask", "]", "\n", "rpn_bbox_pred", "=", "rpn_bbox_pred", ".", "permute", "(", "1", ",", "2", ",", "0", ")", ".", "reshape", "(", "-", "1", ",", "\n", "4", ")", "[", "mask", ",", ":", "]", "\n", "if", "scores", ".", "dim", "(", ")", "==", "0", ":", "\n", "                ", "rpn_bbox_pred", "=", "rpn_bbox_pred", ".", "unsqueeze", "(", "0", ")", "\n", "anchors", "=", "anchors", ".", "unsqueeze", "(", "0", ")", "\n", "scores", "=", "scores", ".", "unsqueeze", "(", "0", ")", "\n", "# filter anchors, bbox_pred, scores w.r.t. scores", "\n", "", "if", "cfg", ".", "nms_pre", ">", "0", "and", "scores", ".", "shape", "[", "0", "]", ">", "cfg", ".", "nms_pre", ":", "\n", "                ", "_", ",", "topk_inds", "=", "scores", ".", "topk", "(", "cfg", ".", "nms_pre", ")", "\n", "rpn_bbox_pred", "=", "rpn_bbox_pred", "[", "topk_inds", ",", ":", "]", "\n", "anchors", "=", "anchors", "[", "topk_inds", ",", ":", "]", "\n", "scores", "=", "scores", "[", "topk_inds", "]", "\n", "# get proposals w.r.t. anchors and rpn_bbox_pred", "\n", "", "proposals", "=", "delta2bbox", "(", "anchors", ",", "rpn_bbox_pred", ",", "self", ".", "target_means", ",", "\n", "self", ".", "target_stds", ",", "img_shape", ")", "\n", "# filter out too small bboxes", "\n", "if", "cfg", ".", "min_bbox_size", ">", "0", ":", "\n", "                ", "w", "=", "proposals", "[", ":", ",", "2", "]", "-", "proposals", "[", ":", ",", "0", "]", "+", "1", "\n", "h", "=", "proposals", "[", ":", ",", "3", "]", "-", "proposals", "[", ":", ",", "1", "]", "+", "1", "\n", "valid_inds", "=", "torch", ".", "nonzero", "(", "(", "w", ">=", "cfg", ".", "min_bbox_size", ")", "&", "\n", "(", "h", ">=", "cfg", ".", "min_bbox_size", ")", ")", ".", "squeeze", "(", ")", "\n", "proposals", "=", "proposals", "[", "valid_inds", ",", ":", "]", "\n", "scores", "=", "scores", "[", "valid_inds", "]", "\n", "", "proposals", "=", "torch", ".", "cat", "(", "[", "proposals", ",", "scores", ".", "unsqueeze", "(", "-", "1", ")", "]", ",", "dim", "=", "-", "1", ")", "\n", "# NMS in current level", "\n", "proposals", ",", "_", "=", "nms", "(", "proposals", ",", "cfg", ".", "nms_thr", ")", "\n", "proposals", "=", "proposals", "[", ":", "cfg", ".", "nms_post", ",", ":", "]", "\n", "mlvl_proposals", ".", "append", "(", "proposals", ")", "\n", "", "proposals", "=", "torch", ".", "cat", "(", "mlvl_proposals", ",", "0", ")", "\n", "if", "cfg", ".", "nms_across_levels", ":", "\n", "# NMS across multi levels", "\n", "            ", "proposals", ",", "_", "=", "nms", "(", "proposals", ",", "cfg", ".", "nms_thr", ")", "\n", "proposals", "=", "proposals", "[", ":", "cfg", ".", "max_num", ",", ":", "]", "\n", "", "else", ":", "\n", "            ", "scores", "=", "proposals", "[", ":", ",", "4", "]", "\n", "num", "=", "min", "(", "cfg", ".", "max_num", ",", "proposals", ".", "shape", "[", "0", "]", ")", "\n", "_", ",", "topk_inds", "=", "scores", ".", "topk", "(", "num", ")", "\n", "proposals", "=", "proposals", "[", "topk_inds", ",", ":", "]", "\n", "", "return", "proposals", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.anchor_head.AnchorHead.__init__": [[37, 85], ["dict", "dict", "torch.Module.__init__", "loss_cls.get", "builder.build_loss", "builder.build_loss", "anchor_head.AnchorHead._init_layers", "list", "anchor_head.AnchorHead.anchor_generators.append", "len", "len", "mmdet.core.AnchorGenerator"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead._init_layers"], ["def", "__init__", "(", "self", ",", "\n", "num_classes", ",", "\n", "in_channels", ",", "\n", "feat_channels", "=", "256", ",", "\n", "anchor_scales", "=", "[", "8", ",", "16", ",", "32", "]", ",", "\n", "anchor_ratios", "=", "[", "0.5", ",", "1.0", ",", "2.0", "]", ",", "\n", "anchor_strides", "=", "[", "4", ",", "8", ",", "16", ",", "32", ",", "64", "]", ",", "\n", "anchor_base_sizes", "=", "None", ",", "\n", "target_means", "=", "(", ".0", ",", ".0", ",", ".0", ",", ".0", ")", ",", "\n", "target_stds", "=", "(", "1.0", ",", "1.0", ",", "1.0", ",", "1.0", ")", ",", "\n", "loss_cls", "=", "dict", "(", "\n", "type", "=", "'CrossEntropyLoss'", ",", "\n", "use_sigmoid", "=", "True", ",", "\n", "loss_weight", "=", "1.0", ")", ",", "\n", "loss_bbox", "=", "dict", "(", "\n", "type", "=", "'SmoothL1Loss'", ",", "beta", "=", "1.0", "/", "9.0", ",", "loss_weight", "=", "1.0", ")", ")", ":", "\n", "        ", "super", "(", "AnchorHead", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "in_channels", "=", "in_channels", "\n", "self", ".", "num_classes", "=", "num_classes", "\n", "self", ".", "feat_channels", "=", "feat_channels", "\n", "self", ".", "anchor_scales", "=", "anchor_scales", "\n", "self", ".", "anchor_ratios", "=", "anchor_ratios", "\n", "self", ".", "anchor_strides", "=", "anchor_strides", "\n", "self", ".", "anchor_base_sizes", "=", "list", "(", "\n", "anchor_strides", ")", "if", "anchor_base_sizes", "is", "None", "else", "anchor_base_sizes", "\n", "self", ".", "target_means", "=", "target_means", "\n", "self", ".", "target_stds", "=", "target_stds", "\n", "\n", "self", ".", "use_sigmoid_cls", "=", "loss_cls", ".", "get", "(", "'use_sigmoid'", ",", "False", ")", "\n", "self", ".", "sampling", "=", "loss_cls", "[", "'type'", "]", "not", "in", "[", "'FocalLoss'", ",", "'GHMC'", ",", "'IOUbalancedSigmoidFocalLoss'", "]", "\n", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "            ", "self", ".", "cls_out_channels", "=", "num_classes", "-", "1", "\n", "", "else", ":", "\n", "            ", "self", ".", "cls_out_channels", "=", "num_classes", "\n", "", "self", ".", "loss_cls", "=", "build_loss", "(", "loss_cls", ")", "\n", "self", ".", "loss_bbox", "=", "build_loss", "(", "loss_bbox", ")", "\n", "\n", "self", ".", "anchor_generators", "=", "[", "]", "\n", "for", "anchor_base", "in", "self", ".", "anchor_base_sizes", ":", "\n", "            ", "self", ".", "anchor_generators", ".", "append", "(", "\n", "AnchorGenerator", "(", "anchor_base", ",", "anchor_scales", ",", "anchor_ratios", ")", ")", "\n", "\n", "", "self", ".", "num_anchors", "=", "len", "(", "self", ".", "anchor_ratios", ")", "*", "len", "(", "self", ".", "anchor_scales", ")", "\n", "self", ".", "_init_layers", "(", ")", "\n", "\n", "# added by Shengkai Wu", "\n", "self", ".", "IoU_balanced_Cls", "=", "loss_cls", "[", "'type'", "]", "in", "[", "'IOUbalancedCrossEntropyLoss'", ",", "'IOUbalancedSigmoidFocalLoss'", "]", "\n", "self", ".", "IoU_balanced_Loc", "=", "loss_bbox", "[", "'type'", "]", "in", "[", "'IoUbalancedSmoothL1Loss'", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.anchor_head.AnchorHead._init_layers": [[87, 92], ["torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d"], "methods", ["None"], ["", "def", "_init_layers", "(", "self", ")", ":", "\n", "        ", "self", ".", "use_iou_prediction", "=", "False", "\n", "self", ".", "conv_cls", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "\n", "self", ".", "num_anchors", "*", "self", ".", "cls_out_channels", ",", "1", ")", "\n", "self", ".", "conv_reg", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "self", ".", "num_anchors", "*", "4", ",", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.anchor_head.AnchorHead.init_weights": [[93, 96], ["mmcv.cnn.normal_init", "mmcv.cnn.normal_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "normal_init", "(", "self", ".", "conv_cls", ",", "std", "=", "0.01", ")", "\n", "normal_init", "(", "self", ".", "conv_reg", ",", "std", "=", "0.01", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.anchor_head.AnchorHead.forward_single": [[97, 101], ["anchor_head.AnchorHead.conv_cls", "anchor_head.AnchorHead.conv_reg"], "methods", ["None"], ["", "def", "forward_single", "(", "self", ",", "x", ")", ":", "\n", "        ", "cls_score", "=", "self", ".", "conv_cls", "(", "x", ")", "\n", "bbox_pred", "=", "self", ".", "conv_reg", "(", "x", ")", "\n", "return", "cls_score", ",", "bbox_pred", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.anchor_head.AnchorHead.forward": [[102, 104], ["mmdet.core.multi_apply"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.multi_apply"], ["", "def", "forward", "(", "self", ",", "feats", ")", ":", "\n", "        ", "return", "multi_apply", "(", "self", ".", "forward_single", ",", "feats", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.anchor_head.AnchorHead.get_anchors": [[105, 149], ["len", "len", "range", "enumerate", "anchor_head.AnchorHead.anchor_generators[].grid_anchors", "multi_level_anchors.append", "range", "valid_flag_list.append", "range", "min", "min", "anchor_head.AnchorHead.anchor_generators[].valid_flags", "multi_level_flags.append", "int", "int", "numpy.ceil", "numpy.ceil"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_generator.AnchorGenerator.grid_anchors", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_generator.AnchorGenerator.valid_flags"], ["", "def", "get_anchors", "(", "self", ",", "featmap_sizes", ",", "img_metas", ")", ":", "\n", "        ", "\"\"\"Get anchors according to feature map sizes.\n\n        Args:\n            featmap_sizes (list[tuple]): Multi-level feature map sizes.\n            img_metas (list[dict]): Image meta info.\n\n        Returns:\n            tuple: anchors of each image, valid flags of each image\n            anchor_list: list[list[Tensor]], anchor_list[i][j].size() is (num_anchor, 4) and\n                  and stores the anchors for the j-th level feature map of the i-th image.\n            valid_flag_list: list[list[Tensor]], valid_flag_list.size() is (num_anchor) and\n                  stores the anchors' flags for the j-th level feature map of the i-th image.\n                  1 represents valid anchor and 0 represents invalid anchors.\n\n        \"\"\"", "\n", "num_imgs", "=", "len", "(", "img_metas", ")", "\n", "num_levels", "=", "len", "(", "featmap_sizes", ")", "\n", "\n", "# since feature map sizes of all images are the same, we only compute", "\n", "# anchors for one time", "\n", "multi_level_anchors", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "num_levels", ")", ":", "\n", "            ", "anchors", "=", "self", ".", "anchor_generators", "[", "i", "]", ".", "grid_anchors", "(", "\n", "featmap_sizes", "[", "i", "]", ",", "self", ".", "anchor_strides", "[", "i", "]", ")", "\n", "multi_level_anchors", ".", "append", "(", "anchors", ")", "\n", "", "anchor_list", "=", "[", "multi_level_anchors", "for", "_", "in", "range", "(", "num_imgs", ")", "]", "\n", "\n", "# for each image, we compute valid flags of multi level anchors", "\n", "valid_flag_list", "=", "[", "]", "\n", "for", "img_id", ",", "img_meta", "in", "enumerate", "(", "img_metas", ")", ":", "\n", "            ", "multi_level_flags", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "num_levels", ")", ":", "\n", "                ", "anchor_stride", "=", "self", ".", "anchor_strides", "[", "i", "]", "\n", "feat_h", ",", "feat_w", "=", "featmap_sizes", "[", "i", "]", "\n", "h", ",", "w", ",", "_", "=", "img_meta", "[", "'pad_shape'", "]", "\n", "valid_feat_h", "=", "min", "(", "int", "(", "np", ".", "ceil", "(", "h", "/", "anchor_stride", ")", ")", ",", "feat_h", ")", "\n", "valid_feat_w", "=", "min", "(", "int", "(", "np", ".", "ceil", "(", "w", "/", "anchor_stride", ")", ")", ",", "feat_w", ")", "\n", "flags", "=", "self", ".", "anchor_generators", "[", "i", "]", ".", "valid_flags", "(", "\n", "(", "feat_h", ",", "feat_w", ")", ",", "(", "valid_feat_h", ",", "valid_feat_w", ")", ")", "\n", "multi_level_flags", ".", "append", "(", "flags", ")", "\n", "", "valid_flag_list", ".", "append", "(", "multi_level_flags", ")", "\n", "\n", "", "return", "anchor_list", ",", "valid_flag_list", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.anchor_head.AnchorHead.loss_single": [[150, 233], ["bbox_targets.reshape.reshape.reshape", "bbox_weights.reshape.reshape.reshape", "level_anchor.reshape.reshape.reshape", "bbox_pred.permute().reshape.permute().reshape.permute().reshape", "labels.reshape.reshape.reshape", "label_weights.reshape.reshape.reshape", "cls_score.permute().reshape.permute().reshape.permute().reshape", "mmdet.core.delta2bbox", "mmdet.core.delta2bbox", "mmdet.core.bbox_overlaps", "anchor_head.AnchorHead.loss_bbox", "anchor_head.AnchorHead.loss_bbox", "mmdet.core.anchor.anchor_target.expand_binary_labels", "anchor_head.AnchorHead.loss_cls", "anchor_head.AnchorHead.loss_cls", "bbox_pred.permute().reshape.permute().reshape.permute", "cls_score.permute().reshape.permute().reshape.permute"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.expand_binary_labels"], ["", "def", "loss_single", "(", "self", ",", "cls_score", ",", "bbox_pred", ",", "labels", ",", "label_weights", ",", "bbox_targets", ",", "bbox_weights", ",", "\n", "level_anchor", ",", "# added by Shengkai Wu", "\n", "num_total_samples", ",", "\n", "gt_bboxes", ",", "# added by Shengkai Wu", "\n", "cfg", ")", ":", "\n", "        ", "\"\"\"\n        compute loss for a single layer of the prediction pyramid.\n        :param cls_score: tensor of shape (batch, A*num_class, width_i, height_i)\n        :param bbox_pred: tensor of shape (batch, A*4, width_i, height_i)\n        :param labels: For RetinaNet, tensor of shape (batch, A*width*height) storing gt labels such as 1, 2, 80 for\n              positive examples and 0 for negatives or others.\n        :param label_weights: the same as labels. 1 for positive and negative examples, 0 for invalid anchors and neutrals.\n        :param bbox_targets: tensor of shape (batch, A*width*height, 4). Store the parametrized coordinates of\n              targets for positives and 0 for negatives and others.\n        :param bbox_weights: tensor of shape (batch, A*width*height, 4). 1 for positives and 0 for negatives and others.\n        :param level_anchor: tensor of shape (batch, A*width*height, 4)\n        :param num_total_samples:\n        :param gt_bboxes: list of tensor. gt_boxes[i].size() = (num_truth_i, 4), store the top-left and bottom-right corner of\n              truth boxes for the i-th image.\n        :param cfg:\n        :return:\n        \"\"\"", "\n", "bbox_targets", "=", "bbox_targets", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "bbox_weights", "=", "bbox_weights", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "# added by Shengkai Wu", "\n", "level_anchor", "=", "level_anchor", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "\n", "bbox_pred", "=", "bbox_pred", ".", "permute", "(", "0", ",", "2", ",", "3", ",", "1", ")", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "\n", "\n", "IoU_balanced_Cls", "=", "self", ".", "IoU_balanced_Cls", "\n", "IoU_balanced_Loc", "=", "self", ".", "IoU_balanced_Loc", "\n", "# if IoU_balanced_Loc or self.use_iou_prediction:", "\n", "if", "IoU_balanced_Loc", "or", "IoU_balanced_Cls", ":", "\n", "            ", "pred_box", "=", "delta2bbox", "(", "level_anchor", ",", "bbox_pred", ",", "self", ".", "target_means", ",", "self", ".", "target_stds", ")", "\n", "# the negatives will stores the anchors information(x, y, w, h)", "\n", "target_box", "=", "delta2bbox", "(", "level_anchor", ",", "bbox_targets", ",", "self", ".", "target_means", ",", "self", ".", "target_stds", ")", "\n", "iou", "=", "bbox_overlaps", "(", "target_box", ",", "pred_box", ",", "is_aligned", "=", "True", ")", "# regressed IoU for positives", "\n", "# iou = bbox_overlaps(target_box, level_anchor, is_aligned=True) # original IoU for positives", "\n", "\n", "\n", "", "if", "IoU_balanced_Loc", ":", "\n", "            ", "loss_bbox", "=", "self", ".", "loss_bbox", "(", "\n", "bbox_pred", ",", "\n", "bbox_targets", ",", "\n", "iou", ",", "\n", "bbox_weights", ",", "\n", "avg_factor", "=", "num_total_samples", ")", "\n", "", "else", ":", "\n", "            ", "loss_bbox", "=", "self", ".", "loss_bbox", "(", "\n", "bbox_pred", ",", "\n", "bbox_targets", ",", "\n", "bbox_weights", ",", "\n", "avg_factor", "=", "num_total_samples", ")", "\n", "\n", "# classification loss: focal loss for positive and negative examples", "\n", "", "labels", "=", "labels", ".", "reshape", "(", "-", "1", ")", "\n", "label_weights", "=", "label_weights", ".", "reshape", "(", "-", "1", ")", "\n", "# # added by Shengkai Wu", "\n", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "# transform tensor 'label' from size (batch*A*width*height) to size (batch*A*width*height, num_class)", "\n", "#  and the same as tensor 'label_weights'. may be wrong for rpn", "\n", "            ", "labels", ",", "label_weights", "=", "expand_binary_labels", "(", "labels", ",", "label_weights", ",", "self", ".", "cls_out_channels", ")", "\n", "\n", "", "cls_score", "=", "cls_score", ".", "permute", "(", "0", ",", "2", ",", "3", ",", "1", ")", ".", "reshape", "(", "-", "1", ",", "self", ".", "cls_out_channels", ")", "\n", "if", "IoU_balanced_Cls", ":", "\n", "\n", "            ", "loss_cls", "=", "self", ".", "loss_cls", "(", "\n", "cls_score", ",", "\n", "labels", ",", "\n", "label_weights", ",", "\n", "iou", ",", "\n", "#", "\n", "avg_factor", "=", "num_total_samples", ")", "\n", "# print('test')", "\n", "\n", "", "else", ":", "\n", "            ", "loss_cls", "=", "self", ".", "loss_cls", "(", "\n", "cls_score", ",", "\n", "labels", ",", "\n", "label_weights", ",", "\n", "avg_factor", "=", "num_total_samples", ")", "\n", "", "return", "loss_cls", ",", "loss_bbox", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.anchor_head.AnchorHead.loss": [[234, 300], ["anchor_head.AnchorHead.get_anchors", "mmdet.core.anchor_target", "mmdet.core.multi_apply", "dict", "len", "len", "featmap.size"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.anchor_head.AnchorHead.get_anchors", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.anchor_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.multi_apply"], ["", "def", "loss", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "img_metas", ",", "\n", "cfg", ",", "\n", "gt_bboxes_ignore", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n        :param cls_scores: list[Tensor]. len(cls_scores) equals to the number of feature map levels.\n              and cls_scores[i].size() is (batch, A*C, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param bbox_preds: list[Tensor]. len(bbox_preds) equals to the number of feature map levels.\n              and bbox_preds[i].size() is (batch, A*4, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param gt_bboxes: list[Tensor],Ground truth bboxes of each image. store the top-left and bottom-right corners\n              in the image coordinte;\n        :param gt_labels:\n        :param img_metas: list[dict], Meta info of each image.\n        :param cfg:\n        :param gt_bboxes_ignore:\n        :return:\n        \"\"\"", "\n", "featmap_sizes", "=", "[", "featmap", ".", "size", "(", ")", "[", "-", "2", ":", "]", "for", "featmap", "in", "cls_scores", "]", "\n", "assert", "len", "(", "featmap_sizes", ")", "==", "len", "(", "self", ".", "anchor_generators", ")", "\n", "\n", "anchor_list", ",", "valid_flag_list", "=", "self", ".", "get_anchors", "(", "\n", "featmap_sizes", ",", "img_metas", ")", "\n", "label_channels", "=", "self", ".", "cls_out_channels", "if", "self", ".", "use_sigmoid_cls", "else", "1", "\n", "cls_reg_targets", "=", "anchor_target", "(", "\n", "anchor_list", ",", "\n", "valid_flag_list", ",", "\n", "gt_bboxes", ",", "\n", "img_metas", ",", "\n", "self", ".", "target_means", ",", "\n", "self", ".", "target_stds", ",", "\n", "cfg", ",", "\n", "gt_bboxes_ignore_list", "=", "gt_bboxes_ignore", ",", "\n", "gt_labels_list", "=", "gt_labels", ",", "\n", "label_channels", "=", "label_channels", ",", "\n", "sampling", "=", "self", ".", "sampling", ")", "\n", "if", "cls_reg_targets", "is", "None", ":", "\n", "            ", "return", "None", "\n", "", "(", "labels_list", ",", "label_weights_list", ",", "bbox_targets_list", ",", "bbox_weights_list", ",", "num_total_pos", ",", "num_total_neg", ",", "\n", "level_anchor_list", ")", "=", "cls_reg_targets", "\n", "# added by WSK", "\n", "# If sampling is adopted, num_total_samples = num_total_pos + num_total_neg;", "\n", "# otherwise, num_total_samples = num_total_pos. For 'FocalLoss', 'GHMC', 'IOUbalancedSigmoidFocalLoss',", "\n", "# sampling is not adopted.", "\n", "num_total_samples", "=", "(", "\n", "num_total_pos", "+", "num_total_neg", "if", "self", ".", "sampling", "else", "num_total_pos", ")", "\n", "\n", "losses_cls", ",", "losses_bbox", "=", "multi_apply", "(", "\n", "self", ".", "loss_single", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "labels_list", ",", "\n", "label_weights_list", ",", "\n", "bbox_targets_list", ",", "\n", "bbox_weights_list", ",", "\n", "level_anchor_list", ",", "# added by Shengkai Wu", "\n", "num_total_samples", "=", "num_total_samples", ",", "\n", "gt_bboxes", "=", "gt_bboxes", ",", "# added by Shengkai Wu", "\n", "cfg", "=", "cfg", ")", "\n", "\n", "return", "dict", "(", "loss_cls", "=", "losses_cls", ",", "loss_bbox", "=", "losses_bbox", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.anchor_head.AnchorHead.get_bboxes": [[301, 363], ["len", "range", "len", "len", "anchor_head.AnchorHead.anchor_generators[].grid_anchors", "len", "anchor_head.AnchorHead.get_bboxes_single", "result_list.append", "range", "[].detach", "[].detach", "cls_scores[].size", "range", "range"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_generator.AnchorGenerator.grid_anchors", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.get_bboxes_single"], ["", "def", "get_bboxes", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "gt_bboxes", ",", "# added by WSK", "\n", "gt_labels", ",", "# aded by WSK", "\n", "img_metas", ",", "\n", "cfg", ",", "\n", "rescale", "=", "False", ")", ":", "\n", "        ", "\"\"\"\n\n        :param cls_scores: cls_scores: list[Tensor]. len(cls_scores) equals to the number of feature map levels.\n              and cls_scores[i].size() is (batch, A*C, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param bbox_preds: list[Tensor]. len(bbox_preds) equals to the number of feature map levels.\n              and bbox_preds[i].size() is (batch, A*4, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param gt_bboxes:DC(mmcv.parallel.DataContainer), tensor of shape (num_gts, 4),represent\n             the coordinates of top-left and bottom-right corner for each gt box,  (x_tl, y_tl, x_br, y_br)\n        :param gt_labels: DC(mmcv.parallel.DataContainer), tensor of shape\n        :param img_metas: list[dict], Meta info of each image. DC(mmcv.parallel.DataContainer), the imformation about one image\n            dict{\n            ori_shape=ori_shape,\n            img_shape=img_shape,\n            pad_shape=pad_shape,\n            scale_factor=scale_factor,\n            flip=flip}\n        :param cfg: test.cfg\n        :param rescale:\n        :return:\n        \"\"\"", "\n", "assert", "len", "(", "cls_scores", ")", "==", "len", "(", "bbox_preds", ")", "\n", "num_levels", "=", "len", "(", "cls_scores", ")", "\n", "\n", "mlvl_anchors", "=", "[", "\n", "self", ".", "anchor_generators", "[", "i", "]", ".", "grid_anchors", "(", "cls_scores", "[", "i", "]", ".", "size", "(", ")", "[", "-", "2", ":", "]", ",", "\n", "self", ".", "anchor_strides", "[", "i", "]", ")", "\n", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "result_list", "=", "[", "]", "\n", "# print('the number of images', len(img_metas))", "\n", "for", "img_id", "in", "range", "(", "len", "(", "img_metas", ")", ")", ":", "\n", "# get the classification score and predicted box for each image", "\n", "            ", "cls_score_list", "=", "[", "\n", "cls_scores", "[", "i", "]", "[", "img_id", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "bbox_pred_list", "=", "[", "\n", "bbox_preds", "[", "i", "]", "[", "img_id", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "img_shape", "=", "img_metas", "[", "img_id", "]", "[", "'img_shape'", "]", "\n", "scale_factor", "=", "img_metas", "[", "img_id", "]", "[", "'scale_factor'", "]", "\n", "# added by WSK", "\n", "gt_bboxes_oneimg", "=", "gt_bboxes", "[", "img_id", "]", "\n", "gt_labels_oneimg", "=", "gt_labels", "[", "img_id", "]", "\n", "\n", "\n", "proposals", "=", "self", ".", "get_bboxes_single", "(", "cls_score_list", ",", "bbox_pred_list", ",", "\n", "mlvl_anchors", ",", "img_shape", ",", "\n", "scale_factor", ",", "\n", "gt_bboxes_oneimg", ",", "gt_labels_oneimg", ",", "# added by WSK", "\n", "cfg", ",", "rescale", ")", "\n", "result_list", ".", "append", "(", "proposals", ")", "\n", "", "return", "result_list", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.anchor_head.AnchorHead.get_bboxes_single": [[364, 451], ["zip", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "mmdet.core.multiclass_nms", "len", "len", "len", "cls_score.permute().reshape.permute().reshape.permute().reshape", "bbox_pred.permute().reshape.permute().reshape.permute().reshape", "cfg.get", "mmdet.core.delta2bbox", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.new_tensor", "torch.cat.new_tensor", "torch.cat.new_zeros", "torch.cat.new_zeros", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "cls_score.permute().reshape.permute().reshape.sigmoid", "cls_score.permute().reshape.permute().reshape.softmax", "max_scores.topk", "cls_score.permute().reshape.permute().reshape.size", "bbox_pred.permute().reshape.permute().reshape.size", "cls_score.permute().reshape.permute().reshape.permute", "bbox_pred.permute().reshape.permute().reshape.permute", "cls_score.permute().reshape.softmax.max", "scores[].max"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.post_processing.bbox_nms.multiclass_nms", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox"], ["", "def", "get_bboxes_single", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "mlvl_anchors", ",", "\n", "img_shape", ",", "\n", "scale_factor", ",", "\n", "gt_bboxes", ",", "# added by WSK", "\n", "gt_labels", ",", "# added by WSK", "\n", "cfg", ",", "\n", "rescale", "=", "False", ")", ":", "\n", "        ", "\"\"\"\n        process one image.\n        :param cls_scores: list[Tensor]. len(cls_score) equals to the number of feature map levels.\n              and cls_scores[i].size() is (A*C, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param bbox_preds: list[Tensor]. len(bbox_preds) equals to the number of feature map levels.\n              and bbox_preds[i].size() is (A*4, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map. if use_iou_branch is used, (A*5, width_i, height_i), the\n              additional dim represents the predicted IoU.\n        :param mlvl_anchors: list[Tensor]. len(mlvl_anchors) equals to the number of feature map levels.\n              and mlvl_anchors[i].size() is (width_i*height_i*A, 4). width_i and height_i is the size\n              of the i-th level feature map.\n        :param img_shape: recale the image to ensure the short and long side is no longer than (short_max, long_max)\n        :param scale_factor: the scaling factor.\n        :param gt_bboxes: tensor of shape (num_gts, 4), the coordinates of top-left and bottom-right corners\n        :param gt_labels:\n        :param cfg:\n        :param rescale:\n        :return:\n        \"\"\"", "\n", "assert", "len", "(", "cls_scores", ")", "==", "len", "(", "bbox_preds", ")", "==", "len", "(", "mlvl_anchors", ")", "# the number of levels for FPN", "\n", "mlvl_bboxes", "=", "[", "]", "\n", "mlvl_scores", "=", "[", "]", "\n", "for", "cls_score", ",", "bbox_pred", ",", "anchors", "in", "zip", "(", "cls_scores", ",", "bbox_preds", ",", "\n", "mlvl_anchors", ")", ":", "\n", "            ", "assert", "cls_score", ".", "size", "(", ")", "[", "-", "2", ":", "]", "==", "bbox_pred", ".", "size", "(", ")", "[", "-", "2", ":", "]", "\n", "cls_score", "=", "cls_score", ".", "permute", "(", "1", ",", "2", ",", "\n", "0", ")", ".", "reshape", "(", "-", "1", ",", "self", ".", "cls_out_channels", ")", "\n", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "                ", "scores", "=", "cls_score", ".", "sigmoid", "(", ")", "\n", "", "else", ":", "\n", "                ", "scores", "=", "cls_score", ".", "softmax", "(", "-", "1", ")", "\n", "\n", "\n", "", "bbox_pred", "=", "bbox_pred", ".", "permute", "(", "1", ",", "2", ",", "0", ")", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "#", "\n", "# Added by WSK", "\n", "# multiply the classification score with predicted iou to compute the final", "\n", "# detection confidence.", "\n", "# if self.use_iou_prediction:", "\n", "#     iou_expanded = iou_pred.view(-1, 1).expand(-1, scores.size(-1))", "\n", "#     gamma = 1.0", "\n", "#     scores = scores * iou_expanded.pow(gamma)", "\n", "# print('the predicted iou is ', iou_expanded)", "\n", "# bbox_pred = bbox_pred.permute(1, 2, 0).reshape(-1, 4)", "\n", "\n", "\n", "# select the top-k detections for each feature level respectively.", "\n", "nms_pre", "=", "cfg", ".", "get", "(", "'nms_pre'", ",", "-", "1", ")", "\n", "if", "nms_pre", ">", "0", "and", "scores", ".", "shape", "[", "0", "]", ">", "nms_pre", ":", "\n", "                ", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "                    ", "max_scores", ",", "_", "=", "scores", ".", "max", "(", "dim", "=", "1", ")", "# (width_i*height_i*A)", "\n", "", "else", ":", "\n", "                    ", "max_scores", ",", "_", "=", "scores", "[", ":", ",", "1", ":", "]", ".", "max", "(", "dim", "=", "1", ")", "\n", "\n", "\n", "", "_", ",", "topk_inds", "=", "max_scores", ".", "topk", "(", "nms_pre", ")", "\n", "anchors", "=", "anchors", "[", "topk_inds", ",", ":", "]", "\n", "bbox_pred", "=", "bbox_pred", "[", "topk_inds", ",", ":", "]", "\n", "scores", "=", "scores", "[", "topk_inds", ",", ":", "]", "\n", "", "bboxes", "=", "delta2bbox", "(", "anchors", ",", "bbox_pred", ",", "self", ".", "target_means", ",", "\n", "self", ".", "target_stds", ",", "img_shape", ")", "\n", "mlvl_bboxes", ".", "append", "(", "bboxes", ")", "\n", "mlvl_scores", ".", "append", "(", "scores", ")", "\n", "", "mlvl_bboxes", "=", "torch", ".", "cat", "(", "mlvl_bboxes", ")", "#(n, 4)", "\n", "if", "rescale", ":", "\n", "            ", "mlvl_bboxes", "/=", "mlvl_bboxes", ".", "new_tensor", "(", "scale_factor", ")", "\n", "", "mlvl_scores", "=", "torch", ".", "cat", "(", "mlvl_scores", ")", "#(n, C)", "\n", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "            ", "padding", "=", "mlvl_scores", ".", "new_zeros", "(", "mlvl_scores", ".", "shape", "[", "0", "]", ",", "1", ")", "\n", "mlvl_scores", "=", "torch", ".", "cat", "(", "[", "padding", ",", "mlvl_scores", "]", ",", "dim", "=", "1", ")", "# (n, 1+C)", "\n", "\n", "# apply nms to all the detections from all the feature levels", "\n", "", "det_bboxes", ",", "det_labels", "=", "multiclass_nms", "(", "mlvl_bboxes", ",", "mlvl_scores", ",", "\n", "cfg", ".", "score_thr", ",", "cfg", ".", "nms", ",", "\n", "cfg", ".", "max_per_img", ")", "\n", "return", "det_bboxes", ",", "det_labels", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.FeatureAlignment.__init__": [[35, 51], ["torch.Module.__init__", "torch.Conv2d", "torch.Conv2d", "mmdet.ops.DeformConv", "torch.ReLU", "torch.ReLU"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["def", "__init__", "(", "self", ",", "\n", "in_channels", ",", "\n", "out_channels", ",", "\n", "kernel_size", "=", "3", ",", "\n", "deformable_groups", "=", "4", ")", ":", "\n", "        ", "super", "(", "FeatureAlignment", ",", "self", ")", ".", "__init__", "(", ")", "\n", "offset_channels", "=", "kernel_size", "*", "kernel_size", "*", "2", "\n", "self", ".", "conv_offset", "=", "nn", ".", "Conv2d", "(", "\n", "4", ",", "deformable_groups", "*", "offset_channels", ",", "1", ",", "bias", "=", "False", ")", "\n", "self", ".", "conv_adaption", "=", "DeformConv", "(", "\n", "in_channels", ",", "\n", "out_channels", ",", "\n", "kernel_size", "=", "kernel_size", ",", "\n", "padding", "=", "(", "kernel_size", "-", "1", ")", "//", "2", ",", "\n", "deformable_groups", "=", "deformable_groups", ")", "\n", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.FeatureAlignment.init_weights": [[52, 55], ["mmcv.cnn.normal_init", "mmcv.cnn.normal_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "normal_init", "(", "self", ".", "conv_offset", ",", "std", "=", "0.1", ")", "\n", "normal_init", "(", "self", ".", "conv_adaption", ",", "std", "=", "0.01", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.FeatureAlignment.forward": [[56, 60], ["iou_aware_retina_head.FeatureAlignment.conv_offset", "iou_aware_retina_head.FeatureAlignment.relu", "shape.detach", "iou_aware_retina_head.FeatureAlignment.conv_adaption"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "shape", ")", ":", "\n", "        ", "offset", "=", "self", ".", "conv_offset", "(", "shape", ".", "detach", "(", ")", ")", "\n", "x", "=", "self", ".", "relu", "(", "self", ".", "conv_adaption", "(", "x", ",", "offset", ")", ")", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.__init__": [[66, 86], ["dict", "numpy.array", "anchor_head.AnchorHead.__init__", "range"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "\n", "num_classes", ",", "\n", "in_channels", ",", "\n", "stacked_convs", "=", "4", ",", "\n", "octave_base_scale", "=", "4", ",", "\n", "scales_per_octave", "=", "3", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "None", ",", "\n", "loss_iou", "=", "dict", "(", "type", "=", "'GHMIoU'", ",", "bins", "=", "30", ",", "momentum", "=", "0.75", ",", "use_sigmoid", "=", "True", ",", "loss_weight", "=", "1.0", ")", ",", "\n", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "stacked_convs", "=", "stacked_convs", "\n", "self", ".", "octave_base_scale", "=", "octave_base_scale", "\n", "self", ".", "scales_per_octave", "=", "scales_per_octave", "\n", "self", ".", "conv_cfg", "=", "conv_cfg", "\n", "self", ".", "norm_cfg", "=", "norm_cfg", "\n", "octave_scales", "=", "np", ".", "array", "(", "\n", "[", "2", "**", "(", "i", "/", "scales_per_octave", ")", "for", "i", "in", "range", "(", "scales_per_octave", ")", "]", ")", "\n", "anchor_scales", "=", "octave_scales", "*", "octave_base_scale", "\n", "super", "(", "IoUawareRetinaHead", ",", "self", ")", ".", "__init__", "(", "\n", "num_classes", ",", "in_channels", ",", "anchor_scales", "=", "anchor_scales", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead._init_layers": [[87, 150], ["torch.ReLU", "torch.ReLU", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "range", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "iou_aware_retina_head.IoUawareRetinaHead.cls_convs.append", "iou_aware_retina_head.IoUawareRetinaHead.reg_convs.append", "torch.ModuleList", "torch.ModuleList", "range", "iou_aware_retina_head.FeatureAlignment", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "utils.ConvModule", "utils.ConvModule", "iou_aware_retina_head.IoUawareRetinaHead.iou_convs.append", "utils.ConvModule"], "methods", ["None"], ["", "def", "_init_layers", "(", "self", ")", ":", "\n", "        ", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "self", ".", "cls_convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "self", ".", "reg_convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "for", "i", "in", "range", "(", "self", ".", "stacked_convs", ")", ":", "\n", "            ", "chn", "=", "self", ".", "in_channels", "if", "i", "==", "0", "else", "self", ".", "feat_channels", "\n", "self", ".", "cls_convs", ".", "append", "(", "\n", "ConvModule", "(", "\n", "chn", ",", "\n", "self", ".", "feat_channels", ",", "\n", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ")", ")", "\n", "self", ".", "reg_convs", ".", "append", "(", "\n", "ConvModule", "(", "\n", "chn", ",", "\n", "self", ".", "feat_channels", ",", "\n", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ")", ")", "\n", "", "self", ".", "retina_cls", "=", "nn", ".", "Conv2d", "(", "\n", "self", ".", "feat_channels", ",", "\n", "self", ".", "num_anchors", "*", "self", ".", "cls_out_channels", ",", "\n", "3", ",", "\n", "padding", "=", "1", ")", "\n", "self", ".", "retina_reg", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "self", ".", "num_anchors", "*", "4", ",", "3", ",", "padding", "=", "1", ")", "\n", "\n", "# added by WSK", "\n", "# analyze the effect of the shared conv layers between regression head and", "\n", "# IoU prediction head. The number of conv layers to extract features for", "\n", "# IoU prediction have to be kept to be 4.", "\n", "self", ".", "shared_conv", "=", "4", "\n", "if", "self", ".", "shared_conv", "<", "4", ":", "\n", "            ", "self", ".", "iou_convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "for", "i", "in", "range", "(", "4", "-", "self", ".", "shared_conv", ")", ":", "\n", "                ", "chn", "=", "self", ".", "in_channels", "if", "(", "self", ".", "shared_conv", "==", "0", "and", "i", "==", "0", ")", "else", "self", ".", "feat_channels", "\n", "self", ".", "iou_convs", ".", "append", "(", "\n", "ConvModule", "(", "\n", "chn", ",", "\n", "self", ".", "feat_channels", ",", "\n", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ")", "\n", ")", "\n", "\n", "# feature alignment for IoU prediction", "\n", "", "", "self", ".", "use_feature_alignment", "=", "False", "\n", "self", ".", "deformable_groups", "=", "4", "\n", "if", "self", ".", "use_feature_alignment", ":", "\n", "            ", "self", ".", "feature_alignment", "=", "FeatureAlignment", "(", "\n", "self", ".", "feat_channels", ",", "\n", "self", ".", "feat_channels", ",", "\n", "kernel_size", "=", "3", ",", "\n", "deformable_groups", "=", "self", ".", "deformable_groups", ")", "\n", "self", ".", "retina_iou", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "1", ",", "3", ",", "padding", "=", "1", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "retina_iou", "=", "nn", ".", "Conv2d", "(", "self", ".", "feat_channels", ",", "self", ".", "num_anchors", ",", "3", ",", "padding", "=", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.init_weights": [[153, 170], ["utils.bias_init_with_prob", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "mmcv.cnn.normal_init", "iou_aware_retina_head.IoUawareRetinaHead.feature_alignment.init_weights", "mmcv.cnn.normal_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.bias_init_with_prob", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init"], ["", "", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "for", "m", "in", "self", ".", "cls_convs", ":", "\n", "            ", "normal_init", "(", "m", ".", "conv", ",", "std", "=", "0.01", ")", "\n", "", "for", "m", "in", "self", ".", "reg_convs", ":", "\n", "            ", "normal_init", "(", "m", ".", "conv", ",", "std", "=", "0.01", ")", "\n", "", "bias_cls", "=", "bias_init_with_prob", "(", "0.01", ")", "\n", "normal_init", "(", "self", ".", "retina_cls", ",", "std", "=", "0.01", ",", "bias", "=", "bias_cls", ")", "\n", "normal_init", "(", "self", ".", "retina_reg", ",", "std", "=", "0.01", ")", "\n", "# added by WSK", "\n", "if", "self", ".", "shared_conv", "<", "4", ":", "\n", "            ", "for", "m", "in", "self", ".", "iou_convs", ":", "\n", "                ", "normal_init", "(", "m", ".", "conv", ",", "std", "=", "0.01", ")", "\n", "", "", "normal_init", "(", "self", ".", "retina_iou", ",", "std", "=", "0.01", ")", "\n", "\n", "# added by WSK", "\n", "if", "self", ".", "use_feature_alignment", ":", "\n", "            ", "self", ".", "feature_alignment", ".", "init_weights", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.forward_single": [[171, 220], ["iou_aware_retina_head.IoUawareRetinaHead.retina_cls", "iou_aware_retina_head.IoUawareRetinaHead.retina_reg", "cls_conv", "reg_conv", "reg_feat_list.append", "torch.split", "torch.split", "torch.split", "torch.split", "range", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "iou_aware_retina_head.IoUawareRetinaHead.retina_iou", "iou_conv", "len", "iou_aware_retina_head.IoUawareRetinaHead.feature_alignment", "iou_aware_retina_head.IoUawareRetinaHead.retina_iou", "iou_pred_list.append"], "methods", ["None"], ["", "", "def", "forward_single", "(", "self", ",", "x", ")", ":", "\n", "        ", "\"\"\"\n        process one level of FPN\n        :param x: one feature level of FPN. tensor of size (batch, self.feat_channels, width_i, height_i)\n        :return:\n        \"\"\"", "\n", "cls_feat", "=", "x", "\n", "reg_feat", "=", "x", "\n", "for", "cls_conv", "in", "self", ".", "cls_convs", ":", "\n", "            ", "cls_feat", "=", "cls_conv", "(", "cls_feat", ")", "\n", "\n", "", "reg_feat_list", "=", "[", "]", "\n", "for", "reg_conv", "in", "self", ".", "reg_convs", ":", "\n", "            ", "reg_feat", "=", "reg_conv", "(", "reg_feat", ")", "\n", "reg_feat_list", ".", "append", "(", "reg_feat", ")", "\n", "", "cls_score", "=", "self", ".", "retina_cls", "(", "cls_feat", ")", "# (batch, A*num_class, width_i, height_i)", "\n", "bbox_pred", "=", "self", ".", "retina_reg", "(", "reg_feat", ")", "# (batch, A*4, width_i, height_i)", "\n", "\n", "#added by WSK", "\n", "# concatenation of regression prediction and feature map for the input of", "\n", "# IoU prediction head", "\n", "# bbox_pred_clone = bbox_pred.clone()", "\n", "# bbox_pred_clone = bbox_pred_clone.detach()", "\n", "# reg_feat = torch.cat([reg_feat_list[-1],bbox_pred_clone], 1)", "\n", "\n", "# analyze the effect of the shared conv layers between regression head and", "\n", "# IoU prediction head.", "\n", "if", "self", ".", "shared_conv", "==", "0", ":", "\n", "            ", "iou_feat", "=", "x", "\n", "", "else", ":", "\n", "            ", "iou_feat", "=", "reg_feat_list", "[", "self", ".", "shared_conv", "-", "1", "]", "\n", "", "if", "self", ".", "shared_conv", "<", "4", ":", "\n", "            ", "for", "iou_conv", "in", "self", ".", "iou_convs", ":", "\n", "                ", "iou_feat", "=", "iou_conv", "(", "iou_feat", ")", "\n", "# iou_pred = self.retina_iou(iou_feat) # (batch, A, width_i, height_i)", "\n", "\n", "# feature alignment for iou prediction", "\n", "", "", "if", "self", ".", "use_feature_alignment", ":", "\n", "            ", "bbox_pred_list", "=", "torch", ".", "split", "(", "bbox_pred", ",", "4", ",", "dim", "=", "1", ")", "\n", "iou_pred_list", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "bbox_pred_list", ")", ")", ":", "\n", "                ", "iou_feat_aligned", "=", "self", ".", "feature_alignment", "(", "iou_feat", ",", "bbox_pred_list", "[", "i", "]", ")", "\n", "iou_pred_single_anchor", "=", "self", ".", "retina_iou", "(", "iou_feat_aligned", ")", "# (batch, 1, width_i, height_i)", "\n", "iou_pred_list", ".", "append", "(", "iou_pred_single_anchor", ")", "\n", "", "iou_pred", "=", "torch", ".", "cat", "(", "iou_pred_list", ",", "1", ")", "# (batch, A, width_i, height_i)", "\n", "", "else", ":", "\n", "            ", "iou_pred", "=", "self", ".", "retina_iou", "(", "iou_feat", ")", "# (batch, A, width_i, height_i)", "\n", "\n", "", "return", "cls_score", ",", "bbox_pred", ",", "iou_pred", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.loss_single": [[221, 314], ["bbox_targets.reshape.reshape.reshape", "bbox_weights.reshape.reshape.reshape", "level_anchor.reshape.reshape.reshape", "bbox_pred.permute().reshape.permute().reshape.permute().reshape", "mmdet.core.delta2bbox", "mmdet.core.delta2bbox", "mmdet.core.bbox_overlaps", "iou_pred.permute().reshape.permute().reshape.permute().reshape", "torch.split", "torch.split", "torch.split", "torch.split", "torch.squeeze", "torch.squeeze", "torch.squeeze", "torch.squeeze", "labels.reshape.reshape.reshape", "label_weights.reshape.reshape.reshape", "cls_score.permute().reshape.permute().reshape.permute().reshape", "iou_aware_retina_head.IoUawareRetinaHead.loss_bbox", "iou_aware_retina_head.IoUawareRetinaHead.loss_bbox", "mmdet.core.loss.weighted_iou_regression_loss", "mmdet.core.anchor.anchor_target.expand_binary_labels", "iou_aware_retina_head.IoUawareRetinaHead.loss_cls", "iou_aware_retina_head.IoUawareRetinaHead.loss_cls", "bbox_pred.permute().reshape.permute().reshape.permute", "iou_pred.permute().reshape.permute().reshape.permute", "cls_score.permute().reshape.permute().reshape.permute"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.weighted_iou_regression_loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.expand_binary_labels"], ["", "def", "loss_single", "(", "self", ",", "cls_score", ",", "bbox_pred", ",", "iou_pred", ",", "\n", "labels", ",", "label_weights", ",", "bbox_targets", ",", "bbox_weights", ",", "\n", "level_anchor", ",", "\n", "num_total_samples", ",", "\n", "gt_bboxes", ",", "# added by Shengkai Wu", "\n", "cfg", ")", ":", "\n", "        ", "\"\"\"\n        compute loss for a single layer of the prediction pyramid.\n        :param cls_score: tensor of shape (batch, A*num_class, width_i, height_i)\n        :param bbox_pred: tensor of shape (batch, A*4, width_i, height_i)\n        :param iou_pred: tensor of shape (batch, A, width_i, height_i), sigmoid layer has no been applied.\n        :param labels: For RetinaNet, tensor of shape (batch, A*width*height) storing gt labels such as 1, 2, 80 for\n              positive examples and 0 for negatives or others.\n        :param label_weights: the same as labels. 1 for positive and negative examples, 0 for invalid anchors and neutrals.\n        :param bbox_targets: tensor of shape (batch, A*width*height, 4). Store the parametrized coordinates of\n              targets for positives and 0 for negatives and others.\n        :param bbox_weights: tensor of shape (batch, A*width*height, 4). 1 for positives and 0 for negatives and others.\n        :param level_anchor: tensor of shape (batch, A*width*height, 4)\n        :param num_total_samples:\n        :param gt_bboxes: list of tensor. gt_boxes[i].size() = (num_truth_i, 4), store the top-left and bottom-right corner of\n              truth boxes for the i-th image.\n        :param cfg:\n        :return:\n        \"\"\"", "\n", "\n", "bbox_targets", "=", "bbox_targets", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "bbox_weights", "=", "bbox_weights", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "# added by Shengkai Wu", "\n", "level_anchor", "=", "level_anchor", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "\n", "bbox_pred", "=", "bbox_pred", ".", "permute", "(", "0", ",", "2", ",", "3", ",", "1", ")", ".", "reshape", "(", "-", "1", ",", "4", ")", "# (batch*A*width_i*height_i, 4)", "\n", "\n", "IoU_balanced_Cls", "=", "self", ".", "IoU_balanced_Cls", "\n", "IoU_balanced_Loc", "=", "self", ".", "IoU_balanced_Loc", "\n", "\n", "pred_box", "=", "delta2bbox", "(", "level_anchor", ",", "bbox_pred", ",", "self", ".", "target_means", ",", "self", ".", "target_stds", ")", "\n", "# the negatives will stores the anchors information(x, y, w, h)", "\n", "target_box", "=", "delta2bbox", "(", "level_anchor", ",", "bbox_targets", ",", "self", ".", "target_means", ",", "self", ".", "target_stds", ")", "\n", "iou", "=", "bbox_overlaps", "(", "target_box", ",", "pred_box", ",", "is_aligned", "=", "True", ")", "# (batch*width_i*height_i*A)", "\n", "\n", "if", "IoU_balanced_Loc", ":", "\n", "            ", "loss_bbox", "=", "self", ".", "loss_bbox", "(", "\n", "bbox_pred", ",", "\n", "bbox_targets", ",", "\n", "iou", ",", "\n", "bbox_weights", ",", "\n", "avg_factor", "=", "num_total_samples", ")", "\n", "", "else", ":", "\n", "            ", "loss_bbox", "=", "self", ".", "loss_bbox", "(", "\n", "bbox_pred", ",", "\n", "bbox_targets", ",", "\n", "bbox_weights", ",", "\n", "avg_factor", "=", "num_total_samples", ")", "\n", "\n", "# added by WSK", "\n", "", "iou_pred", "=", "iou_pred", ".", "permute", "(", "0", ",", "2", ",", "3", ",", "1", ")", ".", "reshape", "(", "-", "1", ")", "# (batch*width_i*height_i*A)", "\n", "bbox_weight_list", "=", "torch", ".", "split", "(", "bbox_weights", ",", "1", ",", "-", "1", ")", "\n", "bbox_weight", "=", "bbox_weight_list", "[", "0", "]", "\n", "bbox_weight", "=", "torch", ".", "squeeze", "(", "bbox_weight", ")", "# (batch*A*width_i*height_i)", "\n", "weight_iou", "=", "1.0", "\n", "loss_iou", "=", "weight_iou", "*", "weighted_iou_regression_loss", "(", "iou_pred", ",", "iou", ",", "bbox_weight", ",", "avg_factor", "=", "num_total_samples", ")", "\n", "\n", "\n", "# classification loss: focal loss for positive and negative examples", "\n", "labels", "=", "labels", ".", "reshape", "(", "-", "1", ")", "\n", "label_weights", "=", "label_weights", ".", "reshape", "(", "-", "1", ")", "\n", "# # added by Shengkai Wu", "\n", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "# transform tensor 'label' from size (batch*A*width*height) to size (batch*A*width*height, num_class)", "\n", "#  and the same as tensor 'label_weights'. may be wrong for rpn", "\n", "            ", "labels", ",", "label_weights", "=", "expand_binary_labels", "(", "labels", ",", "label_weights", ",", "self", ".", "cls_out_channels", ")", "\n", "\n", "", "cls_score", "=", "cls_score", ".", "permute", "(", "0", ",", "2", ",", "3", ",", "\n", "1", ")", ".", "reshape", "(", "-", "1", ",", "self", ".", "cls_out_channels", ")", "\n", "if", "IoU_balanced_Cls", ":", "\n", "\n", "            ", "loss_cls", "=", "self", ".", "loss_cls", "(", "\n", "cls_score", ",", "\n", "labels", ",", "\n", "label_weights", ",", "\n", "iou", ",", "\n", "#", "\n", "avg_factor", "=", "num_total_samples", ")", "\n", "# print('test')", "\n", "\n", "", "else", ":", "\n", "            ", "loss_cls", "=", "self", ".", "loss_cls", "(", "\n", "cls_score", ",", "\n", "labels", ",", "\n", "label_weights", ",", "\n", "avg_factor", "=", "num_total_samples", ")", "\n", "\n", "", "return", "loss_cls", ",", "loss_bbox", ",", "loss_iou", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.loss": [[315, 388], ["iou_aware_retina_head.IoUawareRetinaHead.get_anchors", "mmdet.core.anchor_target", "mmdet.core.multi_apply", "dict", "len", "len", "featmap.size"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.anchor_head.AnchorHead.get_anchors", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.anchor_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.multi_apply"], ["", "def", "loss", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "iou_preds", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "img_metas", ",", "\n", "cfg", ",", "\n", "gt_bboxes_ignore", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n\n        :param cls_scores: list[Tensor]. len(cls_scores) equals to the number of feature map levels.\n              and cls_scores[i].size() is (batch, A*C, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param bbox_preds: list[Tensor]. len(bbox_preds) equals to the number of feature map levels.\n              and bbox_preds[i].size() is (batch, A*4, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param iou_preds: list[Tensor]. len(iou_preds) equals to the number of feature map levels.\n              and iou_preds[i].size() is (batch, A, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n\n        :param gt_bboxes: list[Tensor],Ground truth bboxes of each image. store the top-left and bottom-right corners\n              in the image coordinte;\n        :param gt_labels:\n        :param img_metas: list[dict], Meta info of each image.\n        :param cfg:\n        :param gt_bboxes_ignore:\n        :return:\n        \"\"\"", "\n", "featmap_sizes", "=", "[", "featmap", ".", "size", "(", ")", "[", "-", "2", ":", "]", "for", "featmap", "in", "cls_scores", "]", "\n", "assert", "len", "(", "featmap_sizes", ")", "==", "len", "(", "self", ".", "anchor_generators", ")", "\n", "\n", "anchor_list", ",", "valid_flag_list", "=", "self", ".", "get_anchors", "(", "\n", "featmap_sizes", ",", "img_metas", ")", "\n", "label_channels", "=", "self", ".", "cls_out_channels", "if", "self", ".", "use_sigmoid_cls", "else", "1", "\n", "cls_reg_targets", "=", "anchor_target", "(", "\n", "anchor_list", ",", "\n", "valid_flag_list", ",", "\n", "gt_bboxes", ",", "\n", "img_metas", ",", "\n", "self", ".", "target_means", ",", "\n", "self", ".", "target_stds", ",", "\n", "cfg", ",", "\n", "gt_bboxes_ignore_list", "=", "gt_bboxes_ignore", ",", "\n", "gt_labels_list", "=", "gt_labels", ",", "\n", "label_channels", "=", "label_channels", ",", "\n", "sampling", "=", "self", ".", "sampling", ")", "\n", "if", "cls_reg_targets", "is", "None", ":", "\n", "            ", "return", "None", "\n", "", "(", "labels_list", ",", "label_weights_list", ",", "bbox_targets_list", ",", "bbox_weights_list", ",", "num_total_pos", ",", "num_total_neg", ",", "\n", "level_anchor_list", ")", "=", "cls_reg_targets", "\n", "# added by WSK", "\n", "# If sampling is adopted, num_total_samples = num_total_pos + num_total_neg;", "\n", "# otherwise, num_total_samples = num_total_pos. For 'FocalLoss', 'GHMC', 'IOUbalancedSigmoidFocalLoss',", "\n", "# sampling is not adopted.", "\n", "num_total_samples", "=", "(", "\n", "num_total_pos", "+", "num_total_neg", "if", "self", ".", "sampling", "else", "num_total_pos", ")", "\n", "\n", "losses_cls", ",", "losses_bbox", ",", "losses_iou", "=", "multi_apply", "(", "\n", "self", ".", "loss_single", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "iou_preds", ",", "\n", "labels_list", ",", "\n", "label_weights_list", ",", "\n", "bbox_targets_list", ",", "\n", "bbox_weights_list", ",", "\n", "level_anchor_list", ",", "# added by Shengkai Wu", "\n", "num_total_samples", "=", "num_total_samples", ",", "\n", "gt_bboxes", "=", "gt_bboxes", ",", "# added by Shengkai Wu", "\n", "cfg", "=", "cfg", ")", "\n", "\n", "return", "dict", "(", "loss_cls", "=", "losses_cls", ",", "loss_bbox", "=", "losses_bbox", ",", "losses_iou", "=", "losses_iou", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.get_bboxes": [[390, 462], ["len", "range", "len", "len", "iou_aware_retina_head.IoUawareRetinaHead.anchor_generators[].grid_anchors", "len", "iou_aware_retina_head.IoUawareRetinaHead.get_bboxes_single", "result_list.append", "range", "[].detach", "[].detach", "[].detach", "cls_scores[].size", "range", "range", "range"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_generator.AnchorGenerator.grid_anchors", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.get_bboxes_single"], ["", "def", "get_bboxes", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "iou_preds", ",", "\n", "gt_bboxes", ",", "# added by WSK", "\n", "gt_labels", ",", "# aded by WSK", "\n", "img_metas", ",", "\n", "cfg", ",", "\n", "rescale", "=", "False", ")", ":", "\n", "        ", "\"\"\"\n\n        :param cls_scores: list[Tensor]. len(cls_scores) equals to the number of feature map levels.\n              and cls_scores[i].size() is (batch, A*C, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param bbox_preds: list[Tensor]. len(bbox_preds) equals to the number of feature map levels.\n              and bbox_preds[i].size() is (batch, A*4, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param iou_preds: list[Tensor]. len(iou_preds) equals to the number of feature map levels.\n              and iou_preds[i].size() is (batch, A, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param gt_bboxes:DC(mmcv.parallel.DataContainer), tensor of shape (num_gts, 4),represent\n             the coordinates of top-left and bottom-right corner for each gt box,  (x_tl, y_tl, x_br, y_br)\n        :param gt_labels: DC(mmcv.parallel.DataContainer), tensor of shape\n        :param img_metas: list[dict], Meta info of each image. DC(mmcv.parallel.DataContainer), the imformation about one image\n            dict{\n            ori_shape=ori_shape,\n            img_shape=img_shape,\n            pad_shape=pad_shape,\n            scale_factor=scale_factor,\n            flip=flip}\n        :param cfg: test.cfg\n        :param rescale:\n        :return:\n        \"\"\"", "\n", "assert", "len", "(", "cls_scores", ")", "==", "len", "(", "bbox_preds", ")", "\n", "num_levels", "=", "len", "(", "cls_scores", ")", "\n", "\n", "mlvl_anchors", "=", "[", "\n", "self", ".", "anchor_generators", "[", "i", "]", ".", "grid_anchors", "(", "cls_scores", "[", "i", "]", ".", "size", "(", ")", "[", "-", "2", ":", "]", ",", "\n", "self", ".", "anchor_strides", "[", "i", "]", ")", "\n", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "result_list", "=", "[", "]", "\n", "# print('the number of images', len(img_metas))", "\n", "for", "img_id", "in", "range", "(", "len", "(", "img_metas", ")", ")", ":", "\n", "# get the classification score and predicted box for each image", "\n", "            ", "cls_score_list", "=", "[", "\n", "cls_scores", "[", "i", "]", "[", "img_id", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "bbox_pred_list", "=", "[", "\n", "bbox_preds", "[", "i", "]", "[", "img_id", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "\n", "# added by WSK", "\n", "iou_pred_list", "=", "[", "\n", "iou_preds", "[", "i", "]", "[", "img_id", "]", ".", "detach", "(", ")", "for", "i", "in", "range", "(", "num_levels", ")", "\n", "]", "\n", "\n", "img_shape", "=", "img_metas", "[", "img_id", "]", "[", "'img_shape'", "]", "\n", "scale_factor", "=", "img_metas", "[", "img_id", "]", "[", "'scale_factor'", "]", "\n", "# added by WSK", "\n", "gt_bboxes_oneimg", "=", "gt_bboxes", "[", "img_id", "]", "\n", "gt_labels_oneimg", "=", "gt_labels", "[", "img_id", "]", "\n", "\n", "\n", "proposals", "=", "self", ".", "get_bboxes_single", "(", "cls_score_list", ",", "bbox_pred_list", ",", "iou_pred_list", ",", "\n", "mlvl_anchors", ",", "img_shape", ",", "\n", "scale_factor", ",", "\n", "gt_bboxes_oneimg", ",", "gt_labels_oneimg", ",", "# added by WSK", "\n", "cfg", ",", "rescale", ")", "\n", "result_list", ".", "append", "(", "proposals", ")", "\n", "", "return", "result_list", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.get_bboxes_single": [[463, 565], ["zip", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "mmdet.core.multiclass_nms", "len", "len", "len", "len", "cls_score.permute().reshape.permute().reshape.permute().reshape", "bbox_pred.permute().reshape.permute().reshape.permute().reshape", "iou_pred.sigmoid.sigmoid.permute().reshape", "iou_pred.sigmoid.sigmoid.sigmoid", "mmdet.core.delta2bbox", "iou_pred.sigmoid.sigmoid.view().expand", "cfg.get", "mmdet.core.delta2bbox", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.new_tensor", "torch.cat.new_tensor", "torch.cat.new_zeros", "torch.cat.new_zeros", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "cls_score.permute().reshape.permute().reshape.sigmoid", "cls_score.permute().reshape.permute().reshape.softmax", "gt_bboxes.size", "mmdet.core.bbox_overlaps", "mmdet.core.bbox_overlaps.max", "iou_pred.sigmoid.sigmoid.new_zeros", "cls_score.permute().reshape.softmax.size", "cls_score.permute().reshape.softmax.pow", "iou_pred.sigmoid.view().expand.pow", "max_scores.topk", "cls_score.permute().reshape.permute().reshape.size", "bbox_pred.permute().reshape.permute().reshape.size", "cls_score.permute().reshape.permute().reshape.permute", "bbox_pred.permute().reshape.permute().reshape.permute", "iou_pred.sigmoid.sigmoid.permute", "iou_pred.sigmoid.sigmoid.size", "iou_pred.sigmoid.sigmoid.view", "cls_score.permute().reshape.softmax.max", "scores[].max"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.post_processing.bbox_nms.multiclass_nms", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps"], ["", "def", "get_bboxes_single", "(", "self", ",", "\n", "cls_scores", ",", "\n", "bbox_preds", ",", "\n", "iou_preds", ",", "\n", "mlvl_anchors", ",", "\n", "img_shape", ",", "\n", "scale_factor", ",", "\n", "gt_bboxes", ",", "# added by WSK", "\n", "gt_labels", ",", "# added by WSK", "\n", "cfg", ",", "\n", "rescale", "=", "False", ")", ":", "\n", "        ", "\"\"\"\n        process one image.\n        :param cls_scores: list[Tensor]. len(cls_score) equals to the number of feature map levels.\n              and cls_scores[i].size() is (A*C, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param bbox_preds: list[Tensor]. len(bbox_preds) equals to the number of feature map levels.\n              and bbox_preds[i].size() is (A*4, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param iou_preds: list[Tensor]. len(iou_preds) equals to the number of feature map levels.\n              and bbox_preds[i].size() is (A, width_i, height_i). width_i and height_i is the size\n              of the i-th level feature map.\n        :param mlvl_anchors: list[Tensor]. len(mlvl_anchors) equals to the number of feature map levels.\n              and mlvl_anchors[i].size() is (width_i*height_i*A, 4). width_i and height_i is the size\n              of the i-th level feature map.\n        :param img_shape: recale the image to ensure the short and long side is no longer than (short_max, long_max)\n        :param scale_factor: the scaling factor.\n        :param gt_bboxes: tensor of shape (num_gts, 4), the coordinates of top-left and bottom-right corners\n        :param gt_labels:\n        :param cfg:\n        :param rescale:\n        :return:\n        \"\"\"", "\n", "assert", "len", "(", "cls_scores", ")", "==", "len", "(", "bbox_preds", ")", "==", "len", "(", "iou_preds", ")", "==", "len", "(", "mlvl_anchors", ")", "# the number of levels for FPN", "\n", "mlvl_bboxes", "=", "[", "]", "\n", "mlvl_scores", "=", "[", "]", "\n", "for", "cls_score", ",", "bbox_pred", ",", "iou_pred", ",", "anchors", "in", "zip", "(", "cls_scores", ",", "bbox_preds", ",", "iou_preds", ",", "\n", "mlvl_anchors", ")", ":", "\n", "            ", "assert", "cls_score", ".", "size", "(", ")", "[", "-", "2", ":", "]", "==", "bbox_pred", ".", "size", "(", ")", "[", "-", "2", ":", "]", "\n", "cls_score", "=", "cls_score", ".", "permute", "(", "1", ",", "2", ",", "\n", "0", ")", ".", "reshape", "(", "-", "1", ",", "self", ".", "cls_out_channels", ")", "\n", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "                ", "scores", "=", "cls_score", ".", "sigmoid", "(", ")", "\n", "", "else", ":", "\n", "                ", "scores", "=", "cls_score", ".", "softmax", "(", "-", "1", ")", "\n", "\n", "# added by WSK", "\n", "", "alpha", "=", "0.5", "\n", "bbox_pred", "=", "bbox_pred", ".", "permute", "(", "1", ",", "2", ",", "0", ")", ".", "reshape", "(", "-", "1", ",", "4", ")", "\n", "iou_pred", "=", "iou_pred", ".", "permute", "(", "1", ",", "2", ",", "0", ")", ".", "reshape", "(", "-", "1", ")", "# (width_i*height_i*A)", "\n", "iou_pred", "=", "iou_pred", ".", "sigmoid", "(", ")", "\n", "# print('the size of iou_pred is ', iou_pred.size())", "\n", "\n", "# compute the IoU between the regressed anchors and the ground truth boxes", "\n", "bboxes_pred_decode", "=", "delta2bbox", "(", "anchors", ",", "bbox_pred", ",", "self", ".", "target_means", ",", "\n", "self", ".", "target_stds", ",", "img_shape", ")", "# (width_i*height_i*A, 4)", "\n", "if", "gt_bboxes", ".", "size", "(", "0", ")", ">=", "1", ":", "\n", "                ", "overlaps", "=", "bbox_overlaps", "(", "gt_bboxes", ",", "bboxes_pred_decode", ")", "#(num_gt, width_i*height_i*A)", "\n", "# iou_truth.size()=(width_i*height_i*A)", "\n", "iou_truth", ",", "argmax_overlaps", "=", "overlaps", ".", "max", "(", "dim", "=", "0", ")", "# (width_i*height_i*A)", "\n", "", "else", ":", "\n", "                ", "iou_truth", "=", "iou_pred", ".", "new_zeros", "(", "iou_pred", ".", "size", "(", ")", ")", "\n", "\n", "# multiply classification score with the class-agnostic IoU to compute the final", "\n", "# detection confidence", "\n", "", "iou_expanded", "=", "iou_pred", ".", "view", "(", "-", "1", ",", "1", ")", ".", "expand", "(", "-", "1", ",", "scores", ".", "size", "(", "-", "1", ")", ")", "\n", "# iou_expanded = iou_truth.view(-1, 1).expand(-1, scores.size(-1))", "\n", "# scores = scores * iou_expanded", "\n", "scores", "=", "scores", ".", "pow", "(", "alpha", ")", "*", "iou_expanded", ".", "pow", "(", "1", "-", "alpha", ")", "\n", "#", "\n", "\n", "\n", "# select the top-k detections for each feature level respectively.", "\n", "nms_pre", "=", "cfg", ".", "get", "(", "'nms_pre'", ",", "-", "1", ")", "\n", "if", "nms_pre", ">", "0", "and", "scores", ".", "shape", "[", "0", "]", ">", "nms_pre", ":", "\n", "                ", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "                    ", "max_scores", ",", "_", "=", "scores", ".", "max", "(", "dim", "=", "1", ")", "# (width_i*height_i*A)", "\n", "", "else", ":", "\n", "                    ", "max_scores", ",", "_", "=", "scores", "[", ":", ",", "1", ":", "]", ".", "max", "(", "dim", "=", "1", ")", "\n", "\n", "\n", "", "_", ",", "topk_inds", "=", "max_scores", ".", "topk", "(", "nms_pre", ")", "\n", "anchors", "=", "anchors", "[", "topk_inds", ",", ":", "]", "\n", "bbox_pred", "=", "bbox_pred", "[", "topk_inds", ",", ":", "]", "\n", "scores", "=", "scores", "[", "topk_inds", ",", ":", "]", "\n", "", "bboxes", "=", "delta2bbox", "(", "anchors", ",", "bbox_pred", ",", "self", ".", "target_means", ",", "\n", "self", ".", "target_stds", ",", "img_shape", ")", "\n", "mlvl_bboxes", ".", "append", "(", "bboxes", ")", "\n", "mlvl_scores", ".", "append", "(", "scores", ")", "\n", "", "mlvl_bboxes", "=", "torch", ".", "cat", "(", "mlvl_bboxes", ")", "#(n, 4)", "\n", "if", "rescale", ":", "\n", "            ", "mlvl_bboxes", "/=", "mlvl_bboxes", ".", "new_tensor", "(", "scale_factor", ")", "\n", "", "mlvl_scores", "=", "torch", ".", "cat", "(", "mlvl_scores", ")", "#(n, C)", "\n", "if", "self", ".", "use_sigmoid_cls", ":", "\n", "            ", "padding", "=", "mlvl_scores", ".", "new_zeros", "(", "mlvl_scores", ".", "shape", "[", "0", "]", ",", "1", ")", "\n", "mlvl_scores", "=", "torch", ".", "cat", "(", "[", "padding", ",", "mlvl_scores", "]", ",", "dim", "=", "1", ")", "# (n, 1+C)", "\n", "\n", "# apply nms to all the detections from all the feature levels", "\n", "", "det_bboxes", ",", "det_labels", "=", "multiclass_nms", "(", "mlvl_bboxes", ",", "mlvl_scores", ",", "\n", "cfg", ".", "score_thr", ",", "cfg", ".", "nms", ",", "\n", "cfg", ".", "max_per_img", ")", "\n", "return", "det_bboxes", ",", "det_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.base.BaseDetector.__init__": [[17, 19], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", "BaseDetector", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.base.BaseDetector.with_neck": [[20, 23], ["hasattr"], "methods", ["None"], ["", "@", "property", "\n", "def", "with_neck", "(", "self", ")", ":", "\n", "        ", "return", "hasattr", "(", "self", ",", "'neck'", ")", "and", "self", ".", "neck", "is", "not", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.base.BaseDetector.with_shared_head": [[24, 27], ["hasattr"], "methods", ["None"], ["", "@", "property", "\n", "def", "with_shared_head", "(", "self", ")", ":", "\n", "        ", "return", "hasattr", "(", "self", ",", "'shared_head'", ")", "and", "self", ".", "shared_head", "is", "not", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.base.BaseDetector.with_bbox": [[28, 31], ["hasattr"], "methods", ["None"], ["", "@", "property", "\n", "def", "with_bbox", "(", "self", ")", ":", "\n", "        ", "return", "hasattr", "(", "self", ",", "'bbox_head'", ")", "and", "self", ".", "bbox_head", "is", "not", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.base.BaseDetector.with_mask": [[32, 35], ["hasattr"], "methods", ["None"], ["", "@", "property", "\n", "def", "with_mask", "(", "self", ")", ":", "\n", "        ", "return", "hasattr", "(", "self", ",", "'mask_head'", ")", "and", "self", ".", "mask_head", "is", "not", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.base.BaseDetector.extract_feat": [[36, 39], ["None"], "methods", ["None"], ["", "@", "abstractmethod", "\n", "def", "extract_feat", "(", "self", ",", "imgs", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.base.BaseDetector.extract_feats": [[40, 44], ["isinstance", "base.BaseDetector.extract_feat"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.extract_feat"], ["", "def", "extract_feats", "(", "self", ",", "imgs", ")", ":", "\n", "        ", "assert", "isinstance", "(", "imgs", ",", "list", ")", "\n", "for", "img", "in", "imgs", ":", "\n", "            ", "yield", "self", ".", "extract_feat", "(", "img", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.base.BaseDetector.forward_train": [[45, 48], ["None"], "methods", ["None"], ["", "", "@", "abstractmethod", "\n", "def", "forward_train", "(", "self", ",", "imgs", ",", "img_metas", ",", "**", "kwargs", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.base.BaseDetector.simple_test": [[49, 52], ["None"], "methods", ["None"], ["", "@", "abstractmethod", "\n", "def", "simple_test", "(", "self", ",", "img", ",", "img_meta", ",", "**", "kwargs", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.base.BaseDetector.aug_test": [[53, 56], ["None"], "methods", ["None"], ["", "@", "abstractmethod", "\n", "def", "aug_test", "(", "self", ",", "imgs", ",", "img_metas", ",", "**", "kwargs", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.base.BaseDetector.init_weights": [[57, 61], ["logging.getLogger", "logging.getLogger.info"], "methods", ["None"], ["", "def", "init_weights", "(", "self", ",", "pretrained", "=", "None", ")", ":", "\n", "        ", "if", "pretrained", "is", "not", "None", ":", "\n", "            ", "logger", "=", "logging", ".", "getLogger", "(", ")", "\n", "logger", ".", "info", "(", "'load model from: {}'", ".", "format", "(", "pretrained", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.base.BaseDetector.forward_test": [[62, 104], ["len", "imgs[].size", "len", "ValueError", "base.BaseDetector.simple_test", "base.BaseDetector.aug_test", "isinstance", "TypeError", "len", "len", "type"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.simple_test", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.aug_test"], ["", "", "def", "forward_test", "(", "self", ",", "\n", "imgs", ",", "\n", "img_metas", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "**", "kwargs", ")", ":", "\n", "        ", "\"\"\"\n        forward for one image or with its augmentation images\n        :param imgs: list of tensor, if len(imgs) > 0, demonstrating that multi-scale test is used.\n        :param img_metas: list of DC(mmcv.parallel.DataContainer), a dict:\n            dict{\n            ori_shape=ori_shape,\n            img_shape=img_shape,\n            pad_shape=pad_shape,\n            scale_factor=scale_factor,\n            flip=flip}\n        :param gt_bboxes: list of DC(mmcv.parallel.DataContainer), tensor of shape (num_gts, 4),\n              represent the coordinates of top-left and bottom-right corner for each gt box,\n              (x_tl, y_tl, x_br, y_br)\n        :param gt_labels: list of DC(mmcv.parallel.DataContainer)\n        :param kwargs:\n        :return:\n        \"\"\"", "\n", "\n", "for", "var", ",", "name", "in", "[", "(", "imgs", ",", "'imgs'", ")", ",", "(", "img_metas", ",", "'img_metas'", ")", "]", ":", "\n", "            ", "if", "not", "isinstance", "(", "var", ",", "list", ")", ":", "\n", "                ", "raise", "TypeError", "(", "'{} must be a list, but got {}'", ".", "format", "(", "\n", "name", ",", "type", "(", "var", ")", ")", ")", "\n", "# if num_augs > 0, demonstrating that multi-scale test is used.", "\n", "", "", "num_augs", "=", "len", "(", "imgs", ")", "\n", "if", "num_augs", "!=", "len", "(", "img_metas", ")", ":", "\n", "            ", "raise", "ValueError", "(", "\n", "'num of augmentations ({}) != num of image meta ({})'", ".", "format", "(", "\n", "len", "(", "imgs", ")", ",", "len", "(", "img_metas", ")", ")", ")", "\n", "# TODO: remove the restriction of imgs_per_gpu == 1 when prepared", "\n", "", "imgs_per_gpu", "=", "imgs", "[", "0", "]", ".", "size", "(", "0", ")", "\n", "assert", "imgs_per_gpu", "==", "1", "\n", "\n", "if", "num_augs", "==", "1", ":", "\n", "            ", "return", "self", ".", "simple_test", "(", "imgs", "[", "0", "]", ",", "img_metas", "[", "0", "]", ",", "gt_bboxes", "[", "0", "]", ",", "gt_labels", "[", "0", "]", ",", "**", "kwargs", ")", "\n", "", "else", ":", "\n", "            ", "return", "self", ".", "aug_test", "(", "imgs", ",", "img_metas", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.base.BaseDetector.forward": [[105, 124], ["base.BaseDetector.forward_train", "base.BaseDetector.forward_test"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.forward_train", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.fast_rcnn.FastRCNN.forward_test"], ["", "", "def", "forward", "(", "self", ",", "img", ",", "img_meta", ",", "return_loss", "=", "True", ",", "**", "kwargs", ")", ":", "\n", "        ", "\"\"\"\n\n        :param img: list of tensor\n        :param img_meta: list of DC(mmcv.parallel.DataContainer), a dict:\n            dict{\n            ori_shape=ori_shape,\n            img_shape=img_shape,\n            pad_shape=pad_shape,\n            scale_factor=scale_factor,\n            flip=flip}\n        :param return_loss:\n        :param kwargs:\n        :return:\n        \"\"\"", "\n", "if", "return_loss", ":", "\n", "            ", "return", "self", ".", "forward_train", "(", "img", ",", "img_meta", ",", "**", "kwargs", ")", "\n", "", "else", ":", "\n", "            ", "return", "self", ".", "forward_test", "(", "img", ",", "img_meta", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.base.BaseDetector.show_result": [[125, 178], ["isinstance", "mmdet.core.tensor2imgs", "zip", "len", "len", "isinstance", "numpy.vstack", "numpy.concatenate", "mmcv.imshow_det_bboxes", "mmdet.core.get_classes", "isinstance", "mmcv.concat_list", "numpy.full", "TypeError", "numpy.where", "numpy.random.randint", "pycocotools.decode().astype", "enumerate", "type", "pycocotools.decode"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.tensor2imgs", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.class_names.get_classes"], ["", "", "def", "show_result", "(", "self", ",", "\n", "data", ",", "\n", "result", ",", "\n", "img_norm_cfg", ",", "\n", "dataset", "=", "None", ",", "\n", "score_thr", "=", "0.3", ")", ":", "\n", "        ", "if", "isinstance", "(", "result", ",", "tuple", ")", ":", "\n", "            ", "bbox_result", ",", "segm_result", "=", "result", "\n", "", "else", ":", "\n", "            ", "bbox_result", ",", "segm_result", "=", "result", ",", "None", "\n", "\n", "", "img_tensor", "=", "data", "[", "'img'", "]", "[", "0", "]", "\n", "img_metas", "=", "data", "[", "'img_meta'", "]", "[", "0", "]", ".", "data", "[", "0", "]", "\n", "imgs", "=", "tensor2imgs", "(", "img_tensor", ",", "**", "img_norm_cfg", ")", "\n", "assert", "len", "(", "imgs", ")", "==", "len", "(", "img_metas", ")", "\n", "\n", "if", "dataset", "is", "None", ":", "\n", "            ", "class_names", "=", "self", ".", "CLASSES", "\n", "", "elif", "isinstance", "(", "dataset", ",", "str", ")", ":", "\n", "            ", "class_names", "=", "get_classes", "(", "dataset", ")", "\n", "", "elif", "isinstance", "(", "dataset", ",", "(", "list", ",", "tuple", ")", ")", ":", "\n", "            ", "class_names", "=", "dataset", "\n", "", "else", ":", "\n", "            ", "raise", "TypeError", "(", "\n", "'dataset must be a valid dataset name or a sequence'", "\n", "' of class names, not {}'", ".", "format", "(", "type", "(", "dataset", ")", ")", ")", "\n", "\n", "", "for", "img", ",", "img_meta", "in", "zip", "(", "imgs", ",", "img_metas", ")", ":", "\n", "            ", "h", ",", "w", ",", "_", "=", "img_meta", "[", "'img_shape'", "]", "\n", "img_show", "=", "img", "[", ":", "h", ",", ":", "w", ",", ":", "]", "\n", "\n", "bboxes", "=", "np", ".", "vstack", "(", "bbox_result", ")", "\n", "# draw segmentation masks", "\n", "if", "segm_result", "is", "not", "None", ":", "\n", "                ", "segms", "=", "mmcv", ".", "concat_list", "(", "segm_result", ")", "\n", "inds", "=", "np", ".", "where", "(", "bboxes", "[", ":", ",", "-", "1", "]", ">", "score_thr", ")", "[", "0", "]", "\n", "for", "i", "in", "inds", ":", "\n", "                    ", "color_mask", "=", "np", ".", "random", ".", "randint", "(", "\n", "0", ",", "256", ",", "(", "1", ",", "3", ")", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "mask", "=", "maskUtils", ".", "decode", "(", "segms", "[", "i", "]", ")", ".", "astype", "(", "np", ".", "bool", ")", "\n", "img_show", "[", "mask", "]", "=", "img_show", "[", "mask", "]", "*", "0.5", "+", "color_mask", "*", "0.5", "\n", "# draw bounding boxes", "\n", "", "", "labels", "=", "[", "\n", "np", ".", "full", "(", "bbox", ".", "shape", "[", "0", "]", ",", "i", ",", "dtype", "=", "np", ".", "int32", ")", "\n", "for", "i", ",", "bbox", "in", "enumerate", "(", "bbox_result", ")", "\n", "]", "\n", "labels", "=", "np", ".", "concatenate", "(", "labels", ")", "\n", "mmcv", ".", "imshow_det_bboxes", "(", "\n", "img_show", ",", "\n", "bboxes", ",", "\n", "labels", ",", "\n", "class_names", "=", "class_names", ",", "\n", "score_thr", "=", "score_thr", ")", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.rpn.RPN.__init__": [[13, 27], ["base.BaseDetector.__init__", "builder.build_backbone", "builder.build_head", "rpn.RPN.init_weights", "builder.build_neck"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_backbone", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_head", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_neck"], ["    ", "def", "__init__", "(", "self", ",", "\n", "backbone", ",", "\n", "neck", ",", "\n", "rpn_head", ",", "\n", "train_cfg", ",", "\n", "test_cfg", ",", "\n", "pretrained", "=", "None", ")", ":", "\n", "        ", "super", "(", "RPN", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "backbone", "=", "builder", ".", "build_backbone", "(", "backbone", ")", "\n", "self", ".", "neck", "=", "builder", ".", "build_neck", "(", "neck", ")", "if", "neck", "is", "not", "None", "else", "None", "\n", "self", ".", "rpn_head", "=", "builder", ".", "build_head", "(", "rpn_head", ")", "\n", "self", ".", "train_cfg", "=", "train_cfg", "\n", "self", ".", "test_cfg", "=", "test_cfg", "\n", "self", ".", "init_weights", "(", "pretrained", "=", "pretrained", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.rpn.RPN.init_weights": [[28, 34], ["super().init_weights", "rpn.RPN.backbone.init_weights", "rpn.RPN.rpn_head.init_weights", "rpn.RPN.neck.init_weights"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights"], ["", "def", "init_weights", "(", "self", ",", "pretrained", "=", "None", ")", ":", "\n", "        ", "super", "(", "RPN", ",", "self", ")", ".", "init_weights", "(", "pretrained", ")", "\n", "self", ".", "backbone", ".", "init_weights", "(", "pretrained", "=", "pretrained", ")", "\n", "if", "self", ".", "with_neck", ":", "\n", "            ", "self", ".", "neck", ".", "init_weights", "(", ")", "\n", "", "self", ".", "rpn_head", ".", "init_weights", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.rpn.RPN.extract_feat": [[35, 40], ["rpn.RPN.backbone", "rpn.RPN.neck"], "methods", ["None"], ["", "def", "extract_feat", "(", "self", ",", "img", ")", ":", "\n", "        ", "x", "=", "self", ".", "backbone", "(", "img", ")", "\n", "if", "self", ".", "with_neck", ":", "\n", "            ", "x", "=", "self", ".", "neck", "(", "x", ")", "\n", "", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.rpn.RPN.forward_train": [[41, 56], ["rpn.RPN.train_cfg.rpn.get", "rpn.RPN.extract_feat", "rpn.RPN.rpn_head", "rpn.RPN.rpn_head.loss", "mmdet.core.tensor2imgs"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.extract_feat", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.tensor2imgs"], ["", "def", "forward_train", "(", "self", ",", "\n", "img", ",", "\n", "img_meta", ",", "\n", "gt_bboxes", "=", "None", ",", "\n", "gt_bboxes_ignore", "=", "None", ")", ":", "\n", "        ", "if", "self", ".", "train_cfg", ".", "rpn", ".", "get", "(", "'debug'", ",", "False", ")", ":", "\n", "            ", "self", ".", "rpn_head", ".", "debug_imgs", "=", "tensor2imgs", "(", "img", ")", "\n", "\n", "", "x", "=", "self", ".", "extract_feat", "(", "img", ")", "\n", "rpn_outs", "=", "self", ".", "rpn_head", "(", "x", ")", "\n", "\n", "rpn_loss_inputs", "=", "rpn_outs", "+", "(", "gt_bboxes", ",", "img_meta", ",", "self", ".", "train_cfg", ".", "rpn", ")", "\n", "losses", "=", "self", ".", "rpn_head", ".", "loss", "(", "\n", "*", "rpn_loss_inputs", ",", "gt_bboxes_ignore", "=", "gt_bboxes_ignore", ")", "\n", "return", "losses", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.rpn.RPN.simple_test": [[57, 65], ["rpn.RPN.extract_feat", "rpn.RPN.simple_test_rpn", "proposal_list[].cpu().numpy", "zip", "proposal_list[].cpu"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.extract_feat", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.test_mixins.RPNTestMixin.simple_test_rpn"], ["", "def", "simple_test", "(", "self", ",", "img", ",", "img_meta", ",", "rescale", "=", "False", ")", ":", "\n", "        ", "x", "=", "self", ".", "extract_feat", "(", "img", ")", "\n", "proposal_list", "=", "self", ".", "simple_test_rpn", "(", "x", ",", "img_meta", ",", "self", ".", "test_cfg", ".", "rpn", ")", "\n", "if", "rescale", ":", "\n", "            ", "for", "proposals", ",", "meta", "in", "zip", "(", "proposal_list", ",", "img_meta", ")", ":", "\n", "                ", "proposals", "[", ":", ",", ":", "4", "]", "/=", "meta", "[", "'scale_factor'", "]", "\n", "# TODO: remove this restriction", "\n", "", "", "return", "proposal_list", "[", "0", "]", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.rpn.RPN.aug_test": [[66, 78], ["rpn.RPN.aug_test_rpn", "proposal_list[].cpu().numpy", "rpn.RPN.extract_feats", "zip", "mmdet.core.bbox_mapping", "proposal_list[].cpu"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.test_mixins.RPNTestMixin.aug_test_rpn", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.base.BaseDetector.extract_feats", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox_mapping"], ["", "def", "aug_test", "(", "self", ",", "imgs", ",", "img_metas", ",", "rescale", "=", "False", ")", ":", "\n", "        ", "proposal_list", "=", "self", ".", "aug_test_rpn", "(", "\n", "self", ".", "extract_feats", "(", "imgs", ")", ",", "img_metas", ",", "self", ".", "test_cfg", ".", "rpn", ")", "\n", "if", "not", "rescale", ":", "\n", "            ", "for", "proposals", ",", "img_meta", "in", "zip", "(", "proposal_list", ",", "img_metas", "[", "0", "]", ")", ":", "\n", "                ", "img_shape", "=", "img_meta", "[", "'img_shape'", "]", "\n", "scale_factor", "=", "img_meta", "[", "'scale_factor'", "]", "\n", "flip", "=", "img_meta", "[", "'flip'", "]", "\n", "proposals", "[", ":", ",", ":", "4", "]", "=", "bbox_mapping", "(", "proposals", "[", ":", ",", ":", "4", "]", ",", "img_shape", ",", "\n", "scale_factor", ",", "flip", ")", "\n", "# TODO: remove this restriction", "\n", "", "", "return", "proposal_list", "[", "0", "]", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.rpn.RPN.show_result": [[79, 93], ["mmdet.core.tensor2imgs", "zip", "len", "len", "mmcv.imshow_bboxes"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.tensor2imgs"], ["", "def", "show_result", "(", "self", ",", "data", ",", "result", ",", "img_norm_cfg", ",", "dataset", "=", "None", ",", "top_k", "=", "20", ")", ":", "\n", "        ", "\"\"\"Show RPN proposals on the image.\n\n        Although we assume batch size is 1, this method supports arbitrary\n        batch size.\n        \"\"\"", "\n", "img_tensor", "=", "data", "[", "'img'", "]", "[", "0", "]", "\n", "img_metas", "=", "data", "[", "'img_meta'", "]", "[", "0", "]", ".", "data", "[", "0", "]", "\n", "imgs", "=", "tensor2imgs", "(", "img_tensor", ",", "**", "img_norm_cfg", ")", "\n", "assert", "len", "(", "imgs", ")", "==", "len", "(", "img_metas", ")", "\n", "for", "img", ",", "img_meta", "in", "zip", "(", "imgs", ",", "img_metas", ")", ":", "\n", "            ", "h", ",", "w", ",", "_", "=", "img_meta", "[", "'img_shape'", "]", "\n", "img_show", "=", "img", "[", ":", "h", ",", ":", "w", ",", ":", "]", "\n", "mmcv", ".", "imshow_bboxes", "(", "img_show", ",", "result", ",", "top_k", "=", "top_k", ")", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.retinanet.RetinaNet.__init__": [[8, 17], ["single_stage.SingleStageDetector.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "\n", "backbone", ",", "\n", "neck", ",", "\n", "bbox_head", ",", "\n", "train_cfg", "=", "None", ",", "\n", "test_cfg", "=", "None", ",", "\n", "pretrained", "=", "None", ")", ":", "\n", "        ", "super", "(", "RetinaNet", ",", "self", ")", ".", "__init__", "(", "backbone", ",", "neck", ",", "bbox_head", ",", "train_cfg", ",", "\n", "test_cfg", ",", "pretrained", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.fast_rcnn.FastRCNN.__init__": [[8, 30], ["two_stage.TwoStageDetector.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "\n", "backbone", ",", "\n", "bbox_roi_extractor", ",", "\n", "bbox_head", ",", "\n", "train_cfg", ",", "\n", "test_cfg", ",", "\n", "neck", "=", "None", ",", "\n", "shared_head", "=", "None", ",", "\n", "mask_roi_extractor", "=", "None", ",", "\n", "mask_head", "=", "None", ",", "\n", "pretrained", "=", "None", ")", ":", "\n", "        ", "super", "(", "FastRCNN", ",", "self", ")", ".", "__init__", "(", "\n", "backbone", "=", "backbone", ",", "\n", "neck", "=", "neck", ",", "\n", "shared_head", "=", "shared_head", ",", "\n", "bbox_roi_extractor", "=", "bbox_roi_extractor", ",", "\n", "bbox_head", "=", "bbox_head", ",", "\n", "train_cfg", "=", "train_cfg", ",", "\n", "test_cfg", "=", "test_cfg", ",", "\n", "mask_roi_extractor", "=", "mask_roi_extractor", ",", "\n", "mask_head", "=", "mask_head", ",", "\n", "pretrained", "=", "pretrained", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.fast_rcnn.FastRCNN.forward_test": [[31, 51], ["len", "imgs[].size", "len", "ValueError", "fast_rcnn.FastRCNN.simple_test", "fast_rcnn.FastRCNN.aug_test", "isinstance", "TypeError", "len", "len", "type"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.simple_test", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.aug_test"], ["", "def", "forward_test", "(", "self", ",", "imgs", ",", "img_metas", ",", "proposals", ",", "**", "kwargs", ")", ":", "\n", "        ", "for", "var", ",", "name", "in", "[", "(", "imgs", ",", "'imgs'", ")", ",", "(", "img_metas", ",", "'img_metas'", ")", "]", ":", "\n", "            ", "if", "not", "isinstance", "(", "var", ",", "list", ")", ":", "\n", "                ", "raise", "TypeError", "(", "'{} must be a list, but got {}'", ".", "format", "(", "\n", "name", ",", "type", "(", "var", ")", ")", ")", "\n", "\n", "", "", "num_augs", "=", "len", "(", "imgs", ")", "\n", "if", "num_augs", "!=", "len", "(", "img_metas", ")", ":", "\n", "            ", "raise", "ValueError", "(", "\n", "'num of augmentations ({}) != num of image meta ({})'", ".", "format", "(", "\n", "len", "(", "imgs", ")", ",", "len", "(", "img_metas", ")", ")", ")", "\n", "# TODO: remove the restriction of imgs_per_gpu == 1 when prepared", "\n", "", "imgs_per_gpu", "=", "imgs", "[", "0", "]", ".", "size", "(", "0", ")", "\n", "assert", "imgs_per_gpu", "==", "1", "\n", "\n", "if", "num_augs", "==", "1", ":", "\n", "            ", "return", "self", ".", "simple_test", "(", "imgs", "[", "0", "]", ",", "img_metas", "[", "0", "]", ",", "proposals", "[", "0", "]", ",", "\n", "**", "kwargs", ")", "\n", "", "else", ":", "\n", "            ", "return", "self", ".", "aug_test", "(", "imgs", ",", "img_metas", ",", "proposals", ",", "**", "kwargs", ")", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.htc.HybridTaskCascade.__init__": [[14, 34], ["cascade_rcnn.CascadeRCNN.__init__", "builder.build_roi_extractor", "builder.build_head"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_roi_extractor", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_head"], ["    ", "def", "__init__", "(", "self", ",", "\n", "num_stages", ",", "\n", "backbone", ",", "\n", "semantic_roi_extractor", "=", "None", ",", "\n", "semantic_head", "=", "None", ",", "\n", "semantic_fusion", "=", "(", "'bbox'", ",", "'mask'", ")", ",", "\n", "interleaved", "=", "True", ",", "\n", "mask_info_flow", "=", "True", ",", "\n", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "HybridTaskCascade", ",", "self", ")", ".", "__init__", "(", "num_stages", ",", "backbone", ",", "**", "kwargs", ")", "\n", "assert", "self", ".", "with_bbox", "and", "self", ".", "with_mask", "\n", "assert", "not", "self", ".", "with_shared_head", "# shared head not supported", "\n", "if", "semantic_head", "is", "not", "None", ":", "\n", "            ", "self", ".", "semantic_roi_extractor", "=", "builder", ".", "build_roi_extractor", "(", "\n", "semantic_roi_extractor", ")", "\n", "self", ".", "semantic_head", "=", "builder", ".", "build_head", "(", "semantic_head", ")", "\n", "\n", "", "self", ".", "semantic_fusion", "=", "semantic_fusion", "\n", "self", ".", "interleaved", "=", "interleaved", "\n", "self", ".", "mask_info_flow", "=", "mask_info_flow", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.htc.HybridTaskCascade.with_semantic": [[35, 41], ["hasattr"], "methods", ["None"], ["", "@", "property", "\n", "def", "with_semantic", "(", "self", ")", ":", "\n", "        ", "if", "hasattr", "(", "self", ",", "'semantic_head'", ")", "and", "self", ".", "semantic_head", "is", "not", "None", ":", "\n", "            ", "return", "True", "\n", "", "else", ":", "\n", "            ", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.htc.HybridTaskCascade._bbox_forward_train": [[42, 71], ["mmdet.core.bbox2roi", "bbox_roi_extractor", "bbox_head", "bbox_head.get_target", "bbox_head.loss", "htc.HybridTaskCascade.semantic_roi_extractor", "torch.adaptive_avg_pool2d", "torch.adaptive_avg_pool2d"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2roi", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.get_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.loss"], ["", "", "def", "_bbox_forward_train", "(", "self", ",", "\n", "stage", ",", "\n", "x", ",", "\n", "sampling_results", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "rcnn_train_cfg", ",", "\n", "semantic_feat", "=", "None", ")", ":", "\n", "        ", "rois", "=", "bbox2roi", "(", "[", "res", ".", "bboxes", "for", "res", "in", "sampling_results", "]", ")", "\n", "bbox_roi_extractor", "=", "self", ".", "bbox_roi_extractor", "[", "stage", "]", "\n", "bbox_head", "=", "self", ".", "bbox_head", "[", "stage", "]", "\n", "bbox_feats", "=", "bbox_roi_extractor", "(", "x", "[", ":", "bbox_roi_extractor", ".", "num_inputs", "]", ",", "\n", "rois", ")", "\n", "# semantic feature fusion", "\n", "# element-wise sum for original features and pooled semantic features", "\n", "if", "self", ".", "with_semantic", "and", "'bbox'", "in", "self", ".", "semantic_fusion", ":", "\n", "            ", "bbox_semantic_feat", "=", "self", ".", "semantic_roi_extractor", "(", "[", "semantic_feat", "]", ",", "\n", "rois", ")", "\n", "if", "bbox_semantic_feat", ".", "shape", "[", "-", "2", ":", "]", "!=", "bbox_feats", ".", "shape", "[", "-", "2", ":", "]", ":", "\n", "                ", "bbox_semantic_feat", "=", "F", ".", "adaptive_avg_pool2d", "(", "\n", "bbox_semantic_feat", ",", "bbox_feats", ".", "shape", "[", "-", "2", ":", "]", ")", "\n", "", "bbox_feats", "+=", "bbox_semantic_feat", "\n", "\n", "", "cls_score", ",", "bbox_pred", "=", "bbox_head", "(", "bbox_feats", ")", "\n", "\n", "bbox_targets", "=", "bbox_head", ".", "get_target", "(", "sampling_results", ",", "gt_bboxes", ",", "\n", "gt_labels", ",", "rcnn_train_cfg", ")", "\n", "loss_bbox", "=", "bbox_head", ".", "loss", "(", "cls_score", ",", "bbox_pred", ",", "*", "bbox_targets", ")", "\n", "return", "loss_bbox", ",", "rois", ",", "bbox_targets", ",", "bbox_pred", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.htc.HybridTaskCascade._mask_forward_train": [[72, 112], ["mmdet.core.bbox2roi", "mask_roi_extractor", "mask_head.get_target", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "mask_head.loss", "htc.HybridTaskCascade.semantic_roi_extractor", "range", "mask_head", "mask_head", "torch.adaptive_avg_pool2d", "torch.adaptive_avg_pool2d"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2roi", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.get_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.loss"], ["", "def", "_mask_forward_train", "(", "self", ",", "\n", "stage", ",", "\n", "x", ",", "\n", "sampling_results", ",", "\n", "gt_masks", ",", "\n", "rcnn_train_cfg", ",", "\n", "semantic_feat", "=", "None", ")", ":", "\n", "        ", "mask_roi_extractor", "=", "self", ".", "mask_roi_extractor", "[", "stage", "]", "\n", "mask_head", "=", "self", ".", "mask_head", "[", "stage", "]", "\n", "pos_rois", "=", "bbox2roi", "(", "[", "res", ".", "pos_bboxes", "for", "res", "in", "sampling_results", "]", ")", "\n", "mask_feats", "=", "mask_roi_extractor", "(", "x", "[", ":", "mask_roi_extractor", ".", "num_inputs", "]", ",", "\n", "pos_rois", ")", "\n", "\n", "# semantic feature fusion", "\n", "# element-wise sum for original features and pooled semantic features", "\n", "if", "self", ".", "with_semantic", "and", "'mask'", "in", "self", ".", "semantic_fusion", ":", "\n", "            ", "mask_semantic_feat", "=", "self", ".", "semantic_roi_extractor", "(", "[", "semantic_feat", "]", ",", "\n", "pos_rois", ")", "\n", "if", "mask_semantic_feat", ".", "shape", "[", "-", "2", ":", "]", "!=", "mask_feats", ".", "shape", "[", "-", "2", ":", "]", ":", "\n", "                ", "mask_semantic_feat", "=", "F", ".", "adaptive_avg_pool2d", "(", "\n", "mask_semantic_feat", ",", "mask_feats", ".", "shape", "[", "-", "2", ":", "]", ")", "\n", "", "mask_feats", "+=", "mask_semantic_feat", "\n", "\n", "# mask information flow", "\n", "# forward all previous mask heads to obtain last_feat, and fuse it", "\n", "# with the normal mask feature", "\n", "", "if", "self", ".", "mask_info_flow", ":", "\n", "            ", "last_feat", "=", "None", "\n", "for", "i", "in", "range", "(", "stage", ")", ":", "\n", "                ", "last_feat", "=", "self", ".", "mask_head", "[", "i", "]", "(", "\n", "mask_feats", ",", "last_feat", ",", "return_logits", "=", "False", ")", "\n", "", "mask_pred", "=", "mask_head", "(", "mask_feats", ",", "last_feat", ",", "return_feat", "=", "False", ")", "\n", "", "else", ":", "\n", "            ", "mask_pred", "=", "mask_head", "(", "mask_feats", ")", "\n", "\n", "", "mask_targets", "=", "mask_head", ".", "get_target", "(", "sampling_results", ",", "gt_masks", ",", "\n", "rcnn_train_cfg", ")", "\n", "pos_labels", "=", "torch", ".", "cat", "(", "[", "res", ".", "pos_gt_labels", "for", "res", "in", "sampling_results", "]", ")", "\n", "loss_mask", "=", "mask_head", ".", "loss", "(", "mask_pred", ",", "mask_targets", ",", "pos_labels", ")", "\n", "return", "loss_mask", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.htc.HybridTaskCascade._bbox_forward_test": [[113, 127], ["bbox_roi_extractor", "bbox_head", "htc.HybridTaskCascade.semantic_roi_extractor", "torch.adaptive_avg_pool2d", "torch.adaptive_avg_pool2d", "len"], "methods", ["None"], ["", "def", "_bbox_forward_test", "(", "self", ",", "stage", ",", "x", ",", "rois", ",", "semantic_feat", "=", "None", ")", ":", "\n", "        ", "bbox_roi_extractor", "=", "self", ".", "bbox_roi_extractor", "[", "stage", "]", "\n", "bbox_head", "=", "self", ".", "bbox_head", "[", "stage", "]", "\n", "bbox_feats", "=", "bbox_roi_extractor", "(", "\n", "x", "[", ":", "len", "(", "bbox_roi_extractor", ".", "featmap_strides", ")", "]", ",", "rois", ")", "\n", "if", "self", ".", "with_semantic", "and", "'bbox'", "in", "self", ".", "semantic_fusion", ":", "\n", "            ", "bbox_semantic_feat", "=", "self", ".", "semantic_roi_extractor", "(", "[", "semantic_feat", "]", ",", "\n", "rois", ")", "\n", "if", "bbox_semantic_feat", ".", "shape", "[", "-", "2", ":", "]", "!=", "bbox_feats", ".", "shape", "[", "-", "2", ":", "]", ":", "\n", "                ", "bbox_semantic_feat", "=", "F", ".", "adaptive_avg_pool2d", "(", "\n", "bbox_semantic_feat", ",", "bbox_feats", ".", "shape", "[", "-", "2", ":", "]", ")", "\n", "", "bbox_feats", "+=", "bbox_semantic_feat", "\n", "", "cls_score", ",", "bbox_pred", "=", "bbox_head", "(", "bbox_feats", ")", "\n", "return", "cls_score", ",", "bbox_pred", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.htc.HybridTaskCascade._mask_forward_test": [[128, 155], ["mmdet.core.bbox2roi", "mask_roi_extractor", "htc.HybridTaskCascade.semantic_roi_extractor", "range", "mask_head", "mask_head", "torch.adaptive_avg_pool2d", "torch.adaptive_avg_pool2d", "len"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2roi"], ["", "def", "_mask_forward_test", "(", "self", ",", "stage", ",", "x", ",", "bboxes", ",", "semantic_feat", "=", "None", ")", ":", "\n", "        ", "mask_roi_extractor", "=", "self", ".", "mask_roi_extractor", "[", "stage", "]", "\n", "mask_head", "=", "self", ".", "mask_head", "[", "stage", "]", "\n", "mask_rois", "=", "bbox2roi", "(", "[", "bboxes", "]", ")", "\n", "mask_feats", "=", "mask_roi_extractor", "(", "\n", "x", "[", ":", "len", "(", "mask_roi_extractor", ".", "featmap_strides", ")", "]", ",", "mask_rois", ")", "\n", "if", "self", ".", "with_semantic", "and", "'mask'", "in", "self", ".", "semantic_fusion", ":", "\n", "            ", "mask_semantic_feat", "=", "self", ".", "semantic_roi_extractor", "(", "[", "semantic_feat", "]", ",", "\n", "mask_rois", ")", "\n", "if", "mask_semantic_feat", ".", "shape", "[", "-", "2", ":", "]", "!=", "mask_feats", ".", "shape", "[", "-", "2", ":", "]", ":", "\n", "                ", "mask_semantic_feat", "=", "F", ".", "adaptive_avg_pool2d", "(", "\n", "mask_semantic_feat", ",", "mask_feats", ".", "shape", "[", "-", "2", ":", "]", ")", "\n", "", "mask_feats", "+=", "mask_semantic_feat", "\n", "", "if", "self", ".", "mask_info_flow", ":", "\n", "            ", "last_feat", "=", "None", "\n", "last_pred", "=", "None", "\n", "for", "i", "in", "range", "(", "stage", ")", ":", "\n", "                ", "mask_pred", ",", "last_feat", "=", "self", ".", "mask_head", "[", "i", "]", "(", "mask_feats", ",", "last_feat", ")", "\n", "if", "last_pred", "is", "not", "None", ":", "\n", "                    ", "mask_pred", "=", "mask_pred", "+", "last_pred", "\n", "", "last_pred", "=", "mask_pred", "\n", "", "mask_pred", "=", "mask_head", "(", "mask_feats", ",", "last_feat", ",", "return_feat", "=", "False", ")", "\n", "if", "last_pred", "is", "not", "None", ":", "\n", "                ", "mask_pred", "=", "mask_pred", "+", "last_pred", "\n", "", "", "else", ":", "\n", "            ", "mask_pred", "=", "mask_head", "(", "mask_feats", ")", "\n", "", "return", "mask_pred", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.htc.HybridTaskCascade.forward_train": [[156, 267], ["htc.HybridTaskCascade.extract_feat", "dict", "range", "htc.HybridTaskCascade.rpn_head", "htc.HybridTaskCascade.rpn_head.loss", "dict.update", "htc.HybridTaskCascade.train_cfg.get", "htc.HybridTaskCascade.rpn_head.get_bboxes", "htc.HybridTaskCascade.semantic_head", "htc.HybridTaskCascade.semantic_head.loss", "mmdet.core.build_assigner", "mmdet.core.build_sampler", "img.size", "range", "htc.HybridTaskCascade._bbox_forward_train", "loss_bbox.items", "mmdet.core.build_assigner.assign", "mmdet.core.build_sampler.sample", "sampling_results.append", "htc.HybridTaskCascade._mask_forward_train", "htc.HybridTaskCascade.items", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "htc.HybridTaskCascade.bbox_head[].refine_bboxes", "range", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "htc.HybridTaskCascade.bbox_head[].refine_bboxes", "range", "mmdet.core.build_assigner.assign", "mmdet.core.build_sampler.sample", "sampling_results.append"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.extract_feat", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.get_bboxes", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.assign_sampling.build_assigner", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.assign_sampling.build_sampler", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.htc.HybridTaskCascade._bbox_forward_train", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.max_iou_assigner.MaxIoUAssigner.assign", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.pseudo_sampler.PseudoSampler.sample", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.htc.HybridTaskCascade._mask_forward_train", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.refine_bboxes", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.refine_bboxes", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.max_iou_assigner.MaxIoUAssigner.assign", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.pseudo_sampler.PseudoSampler.sample"], ["", "def", "forward_train", "(", "self", ",", "\n", "img", ",", "\n", "img_meta", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "gt_bboxes_ignore", "=", "None", ",", "\n", "gt_masks", "=", "None", ",", "\n", "gt_semantic_seg", "=", "None", ",", "\n", "proposals", "=", "None", ")", ":", "\n", "        ", "x", "=", "self", ".", "extract_feat", "(", "img", ")", "\n", "\n", "losses", "=", "dict", "(", ")", "\n", "\n", "# RPN part, the same as normal two-stage detectors", "\n", "if", "self", ".", "with_rpn", ":", "\n", "            ", "rpn_outs", "=", "self", ".", "rpn_head", "(", "x", ")", "\n", "rpn_loss_inputs", "=", "rpn_outs", "+", "(", "gt_bboxes", ",", "img_meta", ",", "\n", "self", ".", "train_cfg", ".", "rpn", ")", "\n", "rpn_losses", "=", "self", ".", "rpn_head", ".", "loss", "(", "\n", "*", "rpn_loss_inputs", ",", "gt_bboxes_ignore", "=", "gt_bboxes_ignore", ")", "\n", "losses", ".", "update", "(", "rpn_losses", ")", "\n", "\n", "proposal_cfg", "=", "self", ".", "train_cfg", ".", "get", "(", "'rpn_proposal'", ",", "\n", "self", ".", "test_cfg", ".", "rpn", ")", "\n", "proposal_inputs", "=", "rpn_outs", "+", "(", "img_meta", ",", "proposal_cfg", ")", "\n", "proposal_list", "=", "self", ".", "rpn_head", ".", "get_bboxes", "(", "*", "proposal_inputs", ")", "\n", "", "else", ":", "\n", "            ", "proposal_list", "=", "proposals", "\n", "\n", "# semantic segmentation part", "\n", "# 2 outputs: segmentation prediction and embedded features", "\n", "", "if", "self", ".", "with_semantic", ":", "\n", "            ", "semantic_pred", ",", "semantic_feat", "=", "self", ".", "semantic_head", "(", "x", ")", "\n", "loss_seg", "=", "self", ".", "semantic_head", ".", "loss", "(", "semantic_pred", ",", "gt_semantic_seg", ")", "\n", "losses", "[", "'loss_semantic_seg'", "]", "=", "loss_seg", "\n", "", "else", ":", "\n", "            ", "semantic_feat", "=", "None", "\n", "\n", "", "for", "i", "in", "range", "(", "self", ".", "num_stages", ")", ":", "\n", "            ", "self", ".", "current_stage", "=", "i", "\n", "rcnn_train_cfg", "=", "self", ".", "train_cfg", ".", "rcnn", "[", "i", "]", "\n", "lw", "=", "self", ".", "train_cfg", ".", "stage_loss_weights", "[", "i", "]", "\n", "\n", "# assign gts and sample proposals", "\n", "sampling_results", "=", "[", "]", "\n", "bbox_assigner", "=", "build_assigner", "(", "rcnn_train_cfg", ".", "assigner", ")", "\n", "bbox_sampler", "=", "build_sampler", "(", "rcnn_train_cfg", ".", "sampler", ",", "context", "=", "self", ")", "\n", "num_imgs", "=", "img", ".", "size", "(", "0", ")", "\n", "if", "gt_bboxes_ignore", "is", "None", ":", "\n", "                ", "gt_bboxes_ignore", "=", "[", "None", "for", "_", "in", "range", "(", "num_imgs", ")", "]", "\n", "\n", "", "for", "j", "in", "range", "(", "num_imgs", ")", ":", "\n", "                ", "assign_result", "=", "bbox_assigner", ".", "assign", "(", "\n", "proposal_list", "[", "j", "]", ",", "gt_bboxes", "[", "j", "]", ",", "gt_bboxes_ignore", "[", "j", "]", ",", "\n", "gt_labels", "[", "j", "]", ")", "\n", "sampling_result", "=", "bbox_sampler", ".", "sample", "(", "\n", "assign_result", ",", "\n", "proposal_list", "[", "j", "]", ",", "\n", "gt_bboxes", "[", "j", "]", ",", "\n", "gt_labels", "[", "j", "]", ",", "\n", "feats", "=", "[", "lvl_feat", "[", "j", "]", "[", "None", "]", "for", "lvl_feat", "in", "x", "]", ")", "\n", "sampling_results", ".", "append", "(", "sampling_result", ")", "\n", "\n", "# bbox head forward and loss", "\n", "", "loss_bbox", ",", "rois", ",", "bbox_targets", ",", "bbox_pred", "=", "self", ".", "_bbox_forward_train", "(", "\n", "i", ",", "x", ",", "sampling_results", ",", "gt_bboxes", ",", "gt_labels", ",", "\n", "rcnn_train_cfg", ",", "semantic_feat", ")", "\n", "roi_labels", "=", "bbox_targets", "[", "0", "]", "\n", "\n", "for", "name", ",", "value", "in", "loss_bbox", ".", "items", "(", ")", ":", "\n", "                ", "losses", "[", "'s{}.{}'", ".", "format", "(", "i", ",", "name", ")", "]", "=", "(", "\n", "value", "*", "lw", "if", "'loss'", "in", "name", "else", "value", ")", "\n", "\n", "# mask head forward and loss", "\n", "", "if", "self", ".", "with_mask", ":", "\n", "# interleaved execution: use regressed bboxes by the box branch", "\n", "# to train the mask branch", "\n", "                ", "if", "self", ".", "interleaved", ":", "\n", "                    ", "pos_is_gts", "=", "[", "res", ".", "pos_is_gt", "for", "res", "in", "sampling_results", "]", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "                        ", "proposal_list", "=", "self", ".", "bbox_head", "[", "i", "]", ".", "refine_bboxes", "(", "\n", "rois", ",", "roi_labels", ",", "bbox_pred", ",", "pos_is_gts", ",", "img_meta", ")", "\n", "# re-assign and sample 512 RoIs from 512 RoIs", "\n", "sampling_results", "=", "[", "]", "\n", "for", "j", "in", "range", "(", "num_imgs", ")", ":", "\n", "                            ", "assign_result", "=", "bbox_assigner", ".", "assign", "(", "\n", "proposal_list", "[", "j", "]", ",", "gt_bboxes", "[", "j", "]", ",", "\n", "gt_bboxes_ignore", "[", "j", "]", ",", "gt_labels", "[", "j", "]", ")", "\n", "sampling_result", "=", "bbox_sampler", ".", "sample", "(", "\n", "assign_result", ",", "\n", "proposal_list", "[", "j", "]", ",", "\n", "gt_bboxes", "[", "j", "]", ",", "\n", "gt_labels", "[", "j", "]", ",", "\n", "feats", "=", "[", "lvl_feat", "[", "j", "]", "[", "None", "]", "for", "lvl_feat", "in", "x", "]", ")", "\n", "sampling_results", ".", "append", "(", "sampling_result", ")", "\n", "", "", "", "loss_mask", "=", "self", ".", "_mask_forward_train", "(", "i", ",", "x", ",", "sampling_results", ",", "\n", "gt_masks", ",", "rcnn_train_cfg", ",", "\n", "semantic_feat", ")", "\n", "for", "name", ",", "value", "in", "loss_mask", ".", "items", "(", ")", ":", "\n", "                    ", "losses", "[", "'s{}.{}'", ".", "format", "(", "i", ",", "name", ")", "]", "=", "(", "\n", "value", "*", "lw", "if", "'loss'", "in", "name", "else", "value", ")", "\n", "\n", "# refine bboxes (same as Cascade R-CNN)", "\n", "", "", "if", "i", "<", "self", ".", "num_stages", "-", "1", "and", "not", "self", ".", "interleaved", ":", "\n", "                ", "pos_is_gts", "=", "[", "res", ".", "pos_is_gt", "for", "res", "in", "sampling_results", "]", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "                    ", "proposal_list", "=", "self", ".", "bbox_head", "[", "i", "]", ".", "refine_bboxes", "(", "\n", "rois", ",", "roi_labels", ",", "bbox_pred", ",", "pos_is_gts", ",", "img_meta", ")", "\n", "\n", "", "", "", "return", "losses", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.htc.HybridTaskCascade.simple_test": [[268, 394], ["htc.HybridTaskCascade.extract_feat", "mmdet.core.bbox2roi", "range", "htc.HybridTaskCascade.bbox_head[].get_det_bboxes", "mmdet.core.bbox2result", "htc.HybridTaskCascade.simple_test_rpn", "htc.HybridTaskCascade.semantic_head", "htc.HybridTaskCascade._bbox_forward_test", "ms_scores.append", "sum", "float", "bbox_head.get_det_bboxes", "mmdet.core.bbox2result", "cls_score.argmax", "bbox_head.regress_by_class", "len", "mmdet.core.bbox2roi", "mask_roi_extractor", "range", "mmdet.core.merge_aug_masks", "htc.HybridTaskCascade.mask_head[].get_seg_masks", "htc.HybridTaskCascade.semantic_roi_extractor", "aug_masks.append", "htc.HybridTaskCascade._mask_forward_test", "mask_head.get_seg_masks", "range", "mask_head", "mask_head", "mask_head.sigmoid().cpu().numpy", "len", "range", "mask_head.sigmoid().cpu", "mask_head.sigmoid"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.extract_feat", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2roi", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.get_det_bboxes", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2result", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.test_mixins.RPNTestMixin.simple_test_rpn", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.htc.HybridTaskCascade._bbox_forward_test", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.get_det_bboxes", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2result", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.regress_by_class", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2roi", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.post_processing.merge_augs.merge_aug_masks", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.fcn_mask_head.FCNMaskHead.get_seg_masks", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.htc.HybridTaskCascade._mask_forward_test", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.fcn_mask_head.FCNMaskHead.get_seg_masks"], ["", "def", "simple_test", "(", "self", ",", "img", ",", "img_meta", ",", "proposals", "=", "None", ",", "rescale", "=", "False", ")", ":", "\n", "        ", "x", "=", "self", ".", "extract_feat", "(", "img", ")", "\n", "proposal_list", "=", "self", ".", "simple_test_rpn", "(", "\n", "x", ",", "img_meta", ",", "self", ".", "test_cfg", ".", "rpn", ")", "if", "proposals", "is", "None", "else", "proposals", "\n", "\n", "if", "self", ".", "with_semantic", ":", "\n", "            ", "_", ",", "semantic_feat", "=", "self", ".", "semantic_head", "(", "x", ")", "\n", "", "else", ":", "\n", "            ", "semantic_feat", "=", "None", "\n", "\n", "", "img_shape", "=", "img_meta", "[", "0", "]", "[", "'img_shape'", "]", "\n", "ori_shape", "=", "img_meta", "[", "0", "]", "[", "'ori_shape'", "]", "\n", "scale_factor", "=", "img_meta", "[", "0", "]", "[", "'scale_factor'", "]", "\n", "\n", "# \"ms\" in variable names means multi-stage", "\n", "ms_bbox_result", "=", "{", "}", "\n", "ms_segm_result", "=", "{", "}", "\n", "ms_scores", "=", "[", "]", "\n", "rcnn_test_cfg", "=", "self", ".", "test_cfg", ".", "rcnn", "\n", "\n", "rois", "=", "bbox2roi", "(", "proposal_list", ")", "\n", "for", "i", "in", "range", "(", "self", ".", "num_stages", ")", ":", "\n", "            ", "bbox_head", "=", "self", ".", "bbox_head", "[", "i", "]", "\n", "cls_score", ",", "bbox_pred", "=", "self", ".", "_bbox_forward_test", "(", "\n", "i", ",", "x", ",", "rois", ",", "semantic_feat", "=", "semantic_feat", ")", "\n", "ms_scores", ".", "append", "(", "cls_score", ")", "\n", "\n", "if", "self", ".", "test_cfg", ".", "keep_all_stages", ":", "\n", "                ", "det_bboxes", ",", "det_labels", "=", "bbox_head", ".", "get_det_bboxes", "(", "\n", "rois", ",", "\n", "cls_score", ",", "\n", "bbox_pred", ",", "\n", "img_shape", ",", "\n", "scale_factor", ",", "\n", "rescale", "=", "rescale", ",", "\n", "nms_cfg", "=", "rcnn_test_cfg", ")", "\n", "bbox_result", "=", "bbox2result", "(", "det_bboxes", ",", "det_labels", ",", "\n", "bbox_head", ".", "num_classes", ")", "\n", "ms_bbox_result", "[", "'stage{}'", ".", "format", "(", "i", ")", "]", "=", "bbox_result", "\n", "\n", "if", "self", ".", "with_mask", ":", "\n", "                    ", "mask_head", "=", "self", ".", "mask_head", "[", "i", "]", "\n", "if", "det_bboxes", ".", "shape", "[", "0", "]", "==", "0", ":", "\n", "                        ", "segm_result", "=", "[", "\n", "[", "]", "for", "_", "in", "range", "(", "mask_head", ".", "num_classes", "-", "1", ")", "\n", "]", "\n", "", "else", ":", "\n", "                        ", "_bboxes", "=", "(", "\n", "det_bboxes", "[", ":", ",", ":", "4", "]", "*", "scale_factor", "\n", "if", "rescale", "else", "det_bboxes", ")", "\n", "mask_pred", "=", "self", ".", "_mask_forward_test", "(", "\n", "i", ",", "x", ",", "_bboxes", ",", "semantic_feat", "=", "semantic_feat", ")", "\n", "segm_result", "=", "mask_head", ".", "get_seg_masks", "(", "\n", "mask_pred", ",", "_bboxes", ",", "det_labels", ",", "rcnn_test_cfg", ",", "\n", "ori_shape", ",", "scale_factor", ",", "rescale", ")", "\n", "", "ms_segm_result", "[", "'stage{}'", ".", "format", "(", "i", ")", "]", "=", "segm_result", "\n", "\n", "", "", "if", "i", "<", "self", ".", "num_stages", "-", "1", ":", "\n", "                ", "bbox_label", "=", "cls_score", ".", "argmax", "(", "dim", "=", "1", ")", "\n", "rois", "=", "bbox_head", ".", "regress_by_class", "(", "rois", ",", "bbox_label", ",", "bbox_pred", ",", "\n", "img_meta", "[", "0", "]", ")", "\n", "\n", "", "", "cls_score", "=", "sum", "(", "ms_scores", ")", "/", "float", "(", "len", "(", "ms_scores", ")", ")", "\n", "det_bboxes", ",", "det_labels", "=", "self", ".", "bbox_head", "[", "-", "1", "]", ".", "get_det_bboxes", "(", "\n", "rois", ",", "\n", "cls_score", ",", "\n", "bbox_pred", ",", "\n", "img_shape", ",", "\n", "scale_factor", ",", "\n", "rescale", "=", "rescale", ",", "\n", "cfg", "=", "rcnn_test_cfg", ")", "\n", "bbox_result", "=", "bbox2result", "(", "det_bboxes", ",", "det_labels", ",", "\n", "self", ".", "bbox_head", "[", "-", "1", "]", ".", "num_classes", ")", "\n", "ms_bbox_result", "[", "'ensemble'", "]", "=", "bbox_result", "\n", "\n", "if", "self", ".", "with_mask", ":", "\n", "            ", "if", "det_bboxes", ".", "shape", "[", "0", "]", "==", "0", ":", "\n", "                ", "segm_result", "=", "[", "\n", "[", "]", "for", "_", "in", "range", "(", "self", ".", "mask_head", "[", "-", "1", "]", ".", "num_classes", "-", "1", ")", "\n", "]", "\n", "", "else", ":", "\n", "                ", "_bboxes", "=", "(", "\n", "det_bboxes", "[", ":", ",", ":", "4", "]", "*", "scale_factor", "\n", "if", "rescale", "else", "det_bboxes", ")", "\n", "\n", "mask_rois", "=", "bbox2roi", "(", "[", "_bboxes", "]", ")", "\n", "aug_masks", "=", "[", "]", "\n", "mask_roi_extractor", "=", "self", ".", "mask_roi_extractor", "[", "-", "1", "]", "\n", "mask_feats", "=", "mask_roi_extractor", "(", "\n", "x", "[", ":", "len", "(", "mask_roi_extractor", ".", "featmap_strides", ")", "]", ",", "mask_rois", ")", "\n", "if", "self", ".", "with_semantic", "and", "'mask'", "in", "self", ".", "semantic_fusion", ":", "\n", "                    ", "mask_semantic_feat", "=", "self", ".", "semantic_roi_extractor", "(", "\n", "[", "semantic_feat", "]", ",", "mask_rois", ")", "\n", "mask_feats", "+=", "mask_semantic_feat", "\n", "", "last_feat", "=", "None", "\n", "for", "i", "in", "range", "(", "self", ".", "num_stages", ")", ":", "\n", "                    ", "mask_head", "=", "self", ".", "mask_head", "[", "i", "]", "\n", "if", "self", ".", "mask_info_flow", ":", "\n", "                        ", "mask_pred", ",", "last_feat", "=", "mask_head", "(", "mask_feats", ",", "last_feat", ")", "\n", "", "else", ":", "\n", "                        ", "mask_pred", "=", "mask_head", "(", "mask_feats", ")", "\n", "", "aug_masks", ".", "append", "(", "mask_pred", ".", "sigmoid", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ")", "\n", "", "merged_masks", "=", "merge_aug_masks", "(", "aug_masks", ",", "\n", "[", "img_meta", "]", "*", "self", ".", "num_stages", ",", "\n", "self", ".", "test_cfg", ".", "rcnn", ")", "\n", "segm_result", "=", "self", ".", "mask_head", "[", "-", "1", "]", ".", "get_seg_masks", "(", "\n", "merged_masks", ",", "_bboxes", ",", "det_labels", ",", "rcnn_test_cfg", ",", "\n", "ori_shape", ",", "scale_factor", ",", "rescale", ")", "\n", "", "ms_segm_result", "[", "'ensemble'", "]", "=", "segm_result", "\n", "\n", "", "if", "not", "self", ".", "test_cfg", ".", "keep_all_stages", ":", "\n", "            ", "if", "self", ".", "with_mask", ":", "\n", "                ", "results", "=", "(", "ms_bbox_result", "[", "'ensemble'", "]", ",", "\n", "ms_segm_result", "[", "'ensemble'", "]", ")", "\n", "", "else", ":", "\n", "                ", "results", "=", "ms_bbox_result", "[", "'ensemble'", "]", "\n", "", "", "else", ":", "\n", "            ", "if", "self", ".", "with_mask", ":", "\n", "                ", "results", "=", "{", "\n", "stage", ":", "(", "ms_bbox_result", "[", "stage", "]", ",", "ms_segm_result", "[", "stage", "]", ")", "\n", "for", "stage", "in", "ms_bbox_result", "\n", "}", "\n", "", "else", ":", "\n", "                ", "results", "=", "ms_bbox_result", "\n", "\n", "", "", "return", "results", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.htc.HybridTaskCascade.aug_test": [[395, 397], ["None"], "methods", ["None"], ["", "def", "aug_test", "(", "self", ",", "img", ",", "img_meta", ",", "proposals", "=", "None", ",", "rescale", "=", "False", ")", ":", "\n", "        ", "raise", "NotImplementedError", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.two_stage.TwoStageDetector.__init__": [[15, 58], ["base.BaseDetector.__init__", "builder.build_backbone", "two_stage.TwoStageDetector.init_weights", "builder.build_neck", "builder.build_shared_head", "builder.build_head", "builder.build_roi_extractor", "builder.build_head", "builder.build_head", "builder.build_roi_extractor"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_backbone", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_neck", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_shared_head", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_head", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_roi_extractor", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_head", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_head", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_roi_extractor"], ["    ", "def", "__init__", "(", "self", ",", "\n", "backbone", ",", "\n", "neck", "=", "None", ",", "\n", "shared_head", "=", "None", ",", "\n", "rpn_head", "=", "None", ",", "\n", "bbox_roi_extractor", "=", "None", ",", "\n", "bbox_head", "=", "None", ",", "\n", "mask_roi_extractor", "=", "None", ",", "\n", "mask_head", "=", "None", ",", "\n", "train_cfg", "=", "None", ",", "\n", "test_cfg", "=", "None", ",", "\n", "pretrained", "=", "None", ")", ":", "\n", "        ", "super", "(", "TwoStageDetector", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "backbone", "=", "builder", ".", "build_backbone", "(", "backbone", ")", "\n", "\n", "if", "neck", "is", "not", "None", ":", "\n", "            ", "self", ".", "neck", "=", "builder", ".", "build_neck", "(", "neck", ")", "\n", "\n", "", "if", "shared_head", "is", "not", "None", ":", "\n", "            ", "self", ".", "shared_head", "=", "builder", ".", "build_shared_head", "(", "shared_head", ")", "\n", "\n", "", "if", "rpn_head", "is", "not", "None", ":", "\n", "            ", "self", ".", "rpn_head", "=", "builder", ".", "build_head", "(", "rpn_head", ")", "\n", "\n", "", "if", "bbox_head", "is", "not", "None", ":", "\n", "            ", "self", ".", "bbox_roi_extractor", "=", "builder", ".", "build_roi_extractor", "(", "\n", "bbox_roi_extractor", ")", "\n", "self", ".", "bbox_head", "=", "builder", ".", "build_head", "(", "bbox_head", ")", "\n", "\n", "", "if", "mask_head", "is", "not", "None", ":", "\n", "            ", "if", "mask_roi_extractor", "is", "not", "None", ":", "\n", "                ", "self", ".", "mask_roi_extractor", "=", "builder", ".", "build_roi_extractor", "(", "\n", "mask_roi_extractor", ")", "\n", "self", ".", "share_roi_extractor", "=", "False", "\n", "", "else", ":", "\n", "                ", "self", ".", "share_roi_extractor", "=", "True", "\n", "self", ".", "mask_roi_extractor", "=", "self", ".", "bbox_roi_extractor", "\n", "", "self", ".", "mask_head", "=", "builder", ".", "build_head", "(", "mask_head", ")", "\n", "\n", "", "self", ".", "train_cfg", "=", "train_cfg", "\n", "self", ".", "test_cfg", "=", "test_cfg", "\n", "\n", "self", ".", "init_weights", "(", "pretrained", "=", "pretrained", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.two_stage.TwoStageDetector.with_rpn": [[59, 62], ["hasattr"], "methods", ["None"], ["", "@", "property", "\n", "def", "with_rpn", "(", "self", ")", ":", "\n", "        ", "return", "hasattr", "(", "self", ",", "'rpn_head'", ")", "and", "self", ".", "rpn_head", "is", "not", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.two_stage.TwoStageDetector.init_weights": [[63, 83], ["super().init_weights", "two_stage.TwoStageDetector.backbone.init_weights", "isinstance", "two_stage.TwoStageDetector.shared_head.init_weights", "two_stage.TwoStageDetector.rpn_head.init_weights", "two_stage.TwoStageDetector.bbox_roi_extractor.init_weights", "two_stage.TwoStageDetector.bbox_head.init_weights", "two_stage.TwoStageDetector.mask_head.init_weights", "two_stage.TwoStageDetector.neck.init_weights", "two_stage.TwoStageDetector.mask_roi_extractor.init_weights", "m.init_weights"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights"], ["", "def", "init_weights", "(", "self", ",", "pretrained", "=", "None", ")", ":", "\n", "        ", "super", "(", "TwoStageDetector", ",", "self", ")", ".", "init_weights", "(", "pretrained", ")", "\n", "self", ".", "backbone", ".", "init_weights", "(", "pretrained", "=", "pretrained", ")", "\n", "if", "self", ".", "with_neck", ":", "\n", "            ", "if", "isinstance", "(", "self", ".", "neck", ",", "nn", ".", "Sequential", ")", ":", "\n", "                ", "for", "m", "in", "self", ".", "neck", ":", "\n", "                    ", "m", ".", "init_weights", "(", ")", "\n", "", "", "else", ":", "\n", "                ", "self", ".", "neck", ".", "init_weights", "(", ")", "\n", "", "", "if", "self", ".", "with_shared_head", ":", "\n", "            ", "self", ".", "shared_head", ".", "init_weights", "(", "pretrained", "=", "pretrained", ")", "\n", "", "if", "self", ".", "with_rpn", ":", "\n", "            ", "self", ".", "rpn_head", ".", "init_weights", "(", ")", "\n", "", "if", "self", ".", "with_bbox", ":", "\n", "            ", "self", ".", "bbox_roi_extractor", ".", "init_weights", "(", ")", "\n", "self", ".", "bbox_head", ".", "init_weights", "(", ")", "\n", "", "if", "self", ".", "with_mask", ":", "\n", "            ", "self", ".", "mask_head", ".", "init_weights", "(", ")", "\n", "if", "not", "self", ".", "share_roi_extractor", ":", "\n", "                ", "self", ".", "mask_roi_extractor", ".", "init_weights", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.two_stage.TwoStageDetector.extract_feat": [[84, 89], ["two_stage.TwoStageDetector.backbone", "two_stage.TwoStageDetector.neck"], "methods", ["None"], ["", "", "", "def", "extract_feat", "(", "self", ",", "img", ")", ":", "\n", "        ", "x", "=", "self", ".", "backbone", "(", "img", ")", "\n", "if", "self", ".", "with_neck", ":", "\n", "            ", "x", "=", "self", ".", "neck", "(", "x", ")", "\n", "", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.two_stage.TwoStageDetector.forward_train": [[90, 194], ["two_stage.TwoStageDetector.extract_feat", "dict", "two_stage.TwoStageDetector.rpn_head", "two_stage.TwoStageDetector.rpn_head.loss", "dict.update", "two_stage.TwoStageDetector.train_cfg.get", "two_stage.TwoStageDetector.rpn_head.get_bboxes", "mmdet.core.build_assigner", "mmdet.core.build_sampler", "img.size", "range", "mmdet.core.bbox2roi", "two_stage.TwoStageDetector.bbox_roi_extractor", "two_stage.TwoStageDetector.bbox_head", "two_stage.TwoStageDetector.bbox_head.get_target", "two_stage.TwoStageDetector.bbox_head.loss", "dict.update", "two_stage.TwoStageDetector.mask_head", "two_stage.TwoStageDetector.mask_head.get_target", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "two_stage.TwoStageDetector.mask_head.loss", "dict.update", "mmdet.core.build_assigner.assign", "mmdet.core.build_sampler.sample", "sampling_results.append", "two_stage.TwoStageDetector.shared_head", "mmdet.core.bbox2roi", "two_stage.TwoStageDetector.mask_roi_extractor", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "two_stage.TwoStageDetector.shared_head", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "range", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.extract_feat", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.get_bboxes", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.assign_sampling.build_assigner", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.assign_sampling.build_sampler", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2roi", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.get_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.get_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.max_iou_assigner.MaxIoUAssigner.assign", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.pseudo_sampler.PseudoSampler.sample", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2roi"], ["", "def", "forward_train", "(", "self", ",", "\n", "img", ",", "\n", "img_meta", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "gt_bboxes_ignore", "=", "None", ",", "\n", "gt_masks", "=", "None", ",", "\n", "proposals", "=", "None", ")", ":", "\n", "        ", "x", "=", "self", ".", "extract_feat", "(", "img", ")", "\n", "\n", "losses", "=", "dict", "(", ")", "\n", "\n", "# RPN forward and loss", "\n", "if", "self", ".", "with_rpn", ":", "\n", "            ", "rpn_outs", "=", "self", ".", "rpn_head", "(", "x", ")", "\n", "rpn_loss_inputs", "=", "rpn_outs", "+", "(", "gt_bboxes", ",", "img_meta", ",", "\n", "self", ".", "train_cfg", ".", "rpn", ")", "\n", "rpn_losses", "=", "self", ".", "rpn_head", ".", "loss", "(", "\n", "*", "rpn_loss_inputs", ",", "gt_bboxes_ignore", "=", "gt_bboxes_ignore", ")", "\n", "losses", ".", "update", "(", "rpn_losses", ")", "\n", "\n", "proposal_cfg", "=", "self", ".", "train_cfg", ".", "get", "(", "'rpn_proposal'", ",", "\n", "self", ".", "test_cfg", ".", "rpn", ")", "\n", "proposal_inputs", "=", "rpn_outs", "+", "(", "gt_bboxes", ",", "gt_labels", ",", "img_meta", ",", "proposal_cfg", ")", "\n", "# add by WSK", "\n", "# nms and select the top-k proposals for the rcnn training", "\n", "proposal_list", "=", "self", ".", "rpn_head", ".", "get_bboxes", "(", "*", "proposal_inputs", ")", "\n", "", "else", ":", "\n", "            ", "proposal_list", "=", "proposals", "\n", "\n", "# assign gts and sample proposals", "\n", "", "if", "self", ".", "with_bbox", "or", "self", ".", "with_mask", ":", "\n", "            ", "bbox_assigner", "=", "build_assigner", "(", "self", ".", "train_cfg", ".", "rcnn", ".", "assigner", ")", "\n", "bbox_sampler", "=", "build_sampler", "(", "\n", "self", ".", "train_cfg", ".", "rcnn", ".", "sampler", ",", "context", "=", "self", ")", "\n", "num_imgs", "=", "img", ".", "size", "(", "0", ")", "\n", "if", "gt_bboxes_ignore", "is", "None", ":", "\n", "                ", "gt_bboxes_ignore", "=", "[", "None", "for", "_", "in", "range", "(", "num_imgs", ")", "]", "\n", "", "sampling_results", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "num_imgs", ")", ":", "\n", "                ", "assign_result", "=", "bbox_assigner", ".", "assign", "(", "\n", "proposal_list", "[", "i", "]", ",", "gt_bboxes", "[", "i", "]", ",", "gt_bboxes_ignore", "[", "i", "]", ",", "\n", "gt_labels", "[", "i", "]", ")", "\n", "sampling_result", "=", "bbox_sampler", ".", "sample", "(", "\n", "assign_result", ",", "\n", "proposal_list", "[", "i", "]", ",", "\n", "gt_bboxes", "[", "i", "]", ",", "\n", "gt_labels", "[", "i", "]", ",", "\n", "feats", "=", "[", "lvl_feat", "[", "i", "]", "[", "None", "]", "for", "lvl_feat", "in", "x", "]", ")", "\n", "sampling_results", ".", "append", "(", "sampling_result", ")", "\n", "\n", "# bbox head forward and loss", "\n", "", "", "if", "self", ".", "with_bbox", ":", "\n", "            ", "rois", "=", "bbox2roi", "(", "[", "res", ".", "bboxes", "for", "res", "in", "sampling_results", "]", ")", "\n", "# TODO: a more flexible way to decide which feature maps to use", "\n", "bbox_feats", "=", "self", ".", "bbox_roi_extractor", "(", "\n", "x", "[", ":", "self", ".", "bbox_roi_extractor", ".", "num_inputs", "]", ",", "rois", ")", "\n", "if", "self", ".", "with_shared_head", ":", "\n", "                ", "bbox_feats", "=", "self", ".", "shared_head", "(", "bbox_feats", ")", "\n", "", "cls_score", ",", "bbox_pred", "=", "self", ".", "bbox_head", "(", "bbox_feats", ")", "\n", "\n", "bbox_targets", "=", "self", ".", "bbox_head", ".", "get_target", "(", "\n", "sampling_results", ",", "gt_bboxes", ",", "gt_labels", ",", "self", ".", "train_cfg", ".", "rcnn", ")", "\n", "\n", "loss_bbox", "=", "self", ".", "bbox_head", ".", "loss", "(", "cls_score", ",", "bbox_pred", ",", "\n", "*", "bbox_targets", ")", "\n", "losses", ".", "update", "(", "loss_bbox", ")", "\n", "\n", "# mask head forward and loss", "\n", "", "if", "self", ".", "with_mask", ":", "\n", "            ", "if", "not", "self", ".", "share_roi_extractor", ":", "\n", "                ", "pos_rois", "=", "bbox2roi", "(", "\n", "[", "res", ".", "pos_bboxes", "for", "res", "in", "sampling_results", "]", ")", "\n", "mask_feats", "=", "self", ".", "mask_roi_extractor", "(", "\n", "x", "[", ":", "self", ".", "mask_roi_extractor", ".", "num_inputs", "]", ",", "pos_rois", ")", "\n", "if", "self", ".", "with_shared_head", ":", "\n", "                    ", "mask_feats", "=", "self", ".", "shared_head", "(", "mask_feats", ")", "\n", "", "", "else", ":", "\n", "                ", "pos_inds", "=", "[", "]", "\n", "device", "=", "bbox_feats", ".", "device", "\n", "for", "res", "in", "sampling_results", ":", "\n", "                    ", "pos_inds", ".", "append", "(", "\n", "torch", ".", "ones", "(", "\n", "res", ".", "pos_bboxes", ".", "shape", "[", "0", "]", ",", "\n", "device", "=", "device", ",", "\n", "dtype", "=", "torch", ".", "uint8", ")", ")", "\n", "pos_inds", ".", "append", "(", "\n", "torch", ".", "zeros", "(", "\n", "res", ".", "neg_bboxes", ".", "shape", "[", "0", "]", ",", "\n", "device", "=", "device", ",", "\n", "dtype", "=", "torch", ".", "uint8", ")", ")", "\n", "", "pos_inds", "=", "torch", ".", "cat", "(", "pos_inds", ")", "\n", "mask_feats", "=", "bbox_feats", "[", "pos_inds", "]", "\n", "", "mask_pred", "=", "self", ".", "mask_head", "(", "mask_feats", ")", "\n", "\n", "mask_targets", "=", "self", ".", "mask_head", ".", "get_target", "(", "\n", "sampling_results", ",", "gt_masks", ",", "self", ".", "train_cfg", ".", "rcnn", ")", "\n", "pos_labels", "=", "torch", ".", "cat", "(", "\n", "[", "res", ".", "pos_gt_labels", "for", "res", "in", "sampling_results", "]", ")", "\n", "loss_mask", "=", "self", ".", "mask_head", ".", "loss", "(", "mask_pred", ",", "mask_targets", ",", "\n", "pos_labels", ")", "\n", "losses", ".", "update", "(", "loss_mask", ")", "\n", "\n", "", "return", "losses", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.two_stage.TwoStageDetector.simple_test": [[195, 219], ["two_stage.TwoStageDetector.extract_feat", "two_stage.TwoStageDetector.simple_test_bboxes", "mmdet.core.bbox2result", "two_stage.TwoStageDetector.simple_test_rpn", "two_stage.TwoStageDetector.simple_test_mask"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.extract_feat", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.test_mixins.BBoxTestMixin.simple_test_bboxes", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2result", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.test_mixins.RPNTestMixin.simple_test_rpn", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.test_mixins.MaskTestMixin.simple_test_mask"], ["", "def", "simple_test", "(", "self", ",", "img", ",", "img_meta", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "proposals", "=", "None", ",", "rescale", "=", "False", ")", ":", "\n", "        ", "\"\"\"Test without augmentation.\"\"\"", "\n", "assert", "self", ".", "with_bbox", ",", "\"Bbox head must be implemented.\"", "\n", "\n", "x", "=", "self", ".", "extract_feat", "(", "img", ")", "\n", "# add by WSK", "\n", "# proposal_list: list of tensor, proposal_list[i].size()=(num_proposal, 5)", "\n", "proposal_list", "=", "self", ".", "simple_test_rpn", "(", "\n", "x", ",", "gt_bboxes", ",", "gt_labels", ",", "img_meta", ",", "self", ".", "test_cfg", ".", "rpn", ")", "if", "proposals", "is", "None", "else", "proposals", "\n", "\n", "det_bboxes", ",", "det_labels", "=", "self", ".", "simple_test_bboxes", "(", "\n", "x", ",", "img_meta", ",", "proposal_list", ",", "self", ".", "test_cfg", ".", "rcnn", ",", "rescale", "=", "rescale", ")", "\n", "bbox_results", "=", "bbox2result", "(", "det_bboxes", ",", "det_labels", ",", "\n", "self", ".", "bbox_head", ".", "num_classes", ")", "\n", "\n", "if", "not", "self", ".", "with_mask", ":", "\n", "            ", "return", "bbox_results", "\n", "", "else", ":", "\n", "            ", "segm_results", "=", "self", ".", "simple_test_mask", "(", "\n", "x", ",", "img_meta", ",", "det_bboxes", ",", "det_labels", ",", "rescale", "=", "rescale", ")", "\n", "return", "bbox_results", ",", "segm_results", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.two_stage.TwoStageDetector.aug_test": [[220, 248], ["two_stage.TwoStageDetector.aug_test_rpn", "two_stage.TwoStageDetector.aug_test_bboxes", "mmdet.core.bbox2result", "two_stage.TwoStageDetector.extract_feats", "two_stage.TwoStageDetector.extract_feats", "det_bboxes.clone", "two_stage.TwoStageDetector.aug_test_mask", "two_stage.TwoStageDetector.extract_feats"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.test_mixins.RPNTestMixin.aug_test_rpn", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.test_mixins.BBoxTestMixin.aug_test_bboxes", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2result", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.base.BaseDetector.extract_feats", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.base.BaseDetector.extract_feats", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.test_mixins.MaskTestMixin.aug_test_mask", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.base.BaseDetector.extract_feats"], ["", "", "def", "aug_test", "(", "self", ",", "imgs", ",", "img_metas", ",", "rescale", "=", "False", ")", ":", "\n", "        ", "\"\"\"Test with augmentations.\n\n        If rescale is False, then returned bboxes and masks will fit the scale\n        of imgs[0].\n        \"\"\"", "\n", "# recompute feats to save memory", "\n", "proposal_list", "=", "self", ".", "aug_test_rpn", "(", "\n", "self", ".", "extract_feats", "(", "imgs", ")", ",", "img_metas", ",", "self", ".", "test_cfg", ".", "rpn", ")", "\n", "det_bboxes", ",", "det_labels", "=", "self", ".", "aug_test_bboxes", "(", "\n", "self", ".", "extract_feats", "(", "imgs", ")", ",", "img_metas", ",", "proposal_list", ",", "\n", "self", ".", "test_cfg", ".", "rcnn", ")", "\n", "\n", "if", "rescale", ":", "\n", "            ", "_det_bboxes", "=", "det_bboxes", "\n", "", "else", ":", "\n", "            ", "_det_bboxes", "=", "det_bboxes", ".", "clone", "(", ")", "\n", "_det_bboxes", "[", ":", ",", ":", "4", "]", "*=", "img_metas", "[", "0", "]", "[", "0", "]", "[", "'scale_factor'", "]", "\n", "", "bbox_results", "=", "bbox2result", "(", "_det_bboxes", ",", "det_labels", ",", "\n", "self", ".", "bbox_head", ".", "num_classes", ")", "\n", "\n", "# det_bboxes always keep the original scale", "\n", "if", "self", ".", "with_mask", ":", "\n", "            ", "segm_results", "=", "self", ".", "aug_test_mask", "(", "\n", "self", ".", "extract_feats", "(", "imgs", ")", ",", "img_metas", ",", "det_bboxes", ",", "det_labels", ")", "\n", "return", "bbox_results", ",", "segm_results", "\n", "", "else", ":", "\n", "            ", "return", "bbox_results", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.single_stage.SingleStageDetector.__init__": [[12, 27], ["base.BaseDetector.__init__", "builder.build_backbone", "builder.build_head", "single_stage.SingleStageDetector.init_weights", "builder.build_neck"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_backbone", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_head", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_neck"], ["    ", "def", "__init__", "(", "self", ",", "\n", "backbone", ",", "\n", "neck", "=", "None", ",", "\n", "bbox_head", "=", "None", ",", "\n", "train_cfg", "=", "None", ",", "\n", "test_cfg", "=", "None", ",", "\n", "pretrained", "=", "None", ")", ":", "\n", "        ", "super", "(", "SingleStageDetector", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "backbone", "=", "builder", ".", "build_backbone", "(", "backbone", ")", "\n", "if", "neck", "is", "not", "None", ":", "\n", "            ", "self", ".", "neck", "=", "builder", ".", "build_neck", "(", "neck", ")", "\n", "", "self", ".", "bbox_head", "=", "builder", ".", "build_head", "(", "bbox_head", ")", "\n", "self", ".", "train_cfg", "=", "train_cfg", "\n", "self", ".", "test_cfg", "=", "test_cfg", "\n", "self", ".", "init_weights", "(", "pretrained", "=", "pretrained", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.single_stage.SingleStageDetector.init_weights": [[28, 38], ["super().init_weights", "single_stage.SingleStageDetector.backbone.init_weights", "single_stage.SingleStageDetector.bbox_head.init_weights", "isinstance", "single_stage.SingleStageDetector.neck.init_weights", "m.init_weights"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights"], ["", "def", "init_weights", "(", "self", ",", "pretrained", "=", "None", ")", ":", "\n", "        ", "super", "(", "SingleStageDetector", ",", "self", ")", ".", "init_weights", "(", "pretrained", ")", "\n", "self", ".", "backbone", ".", "init_weights", "(", "pretrained", "=", "pretrained", ")", "\n", "if", "self", ".", "with_neck", ":", "\n", "            ", "if", "isinstance", "(", "self", ".", "neck", ",", "nn", ".", "Sequential", ")", ":", "\n", "                ", "for", "m", "in", "self", ".", "neck", ":", "\n", "                    ", "m", ".", "init_weights", "(", ")", "\n", "", "", "else", ":", "\n", "                ", "self", ".", "neck", ".", "init_weights", "(", ")", "\n", "", "", "self", ".", "bbox_head", ".", "init_weights", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.single_stage.SingleStageDetector.extract_feat": [[39, 44], ["single_stage.SingleStageDetector.backbone", "single_stage.SingleStageDetector.neck"], "methods", ["None"], ["", "def", "extract_feat", "(", "self", ",", "img", ")", ":", "\n", "        ", "x", "=", "self", ".", "backbone", "(", "img", ")", "\n", "if", "self", ".", "with_neck", ":", "\n", "            ", "x", "=", "self", ".", "neck", "(", "x", ")", "\n", "", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.single_stage.SingleStageDetector.forward_train": [[45, 63], ["single_stage.SingleStageDetector.extract_feat", "single_stage.SingleStageDetector.bbox_head", "single_stage.SingleStageDetector.bbox_head.loss"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.extract_feat", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.loss"], ["", "def", "forward_train", "(", "self", ",", "\n", "img", ",", "\n", "img_metas", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "gt_bboxes_ignore", "=", "None", ")", ":", "\n", "        ", "x", "=", "self", ".", "extract_feat", "(", "img", ")", "\n", "outs", "=", "self", ".", "bbox_head", "(", "x", ")", "\n", "# if len(outs) == 3:", "\n", "loss_inputs", "=", "outs", "+", "(", "gt_bboxes", ",", "gt_labels", ",", "img_metas", ",", "self", ".", "train_cfg", ")", "\n", "losses", "=", "self", ".", "bbox_head", ".", "loss", "(", "\n", "*", "loss_inputs", ",", "gt_bboxes_ignore", "=", "gt_bboxes_ignore", ")", "\n", "# else:", "\n", "#     loss_inputs = outs + (gt_bboxes, gt_labels, img_metas, self.train_cfg)", "\n", "#     losses = self.bbox_head.loss_with_iou(", "\n", "#         *loss_inputs, gt_bboxes_ignore=gt_bboxes_ignore)", "\n", "\n", "return", "losses", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.single_stage.SingleStageDetector.simple_test": [[64, 97], ["single_stage.SingleStageDetector.extract_feat", "single_stage.SingleStageDetector.bbox_head", "single_stage.SingleStageDetector.bbox_head.get_bboxes", "mmdet.core.bbox2result"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.extract_feat", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.get_bboxes", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2result"], ["", "def", "simple_test", "(", "self", ",", "\n", "img", ",", "\n", "img_meta", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "rescale", "=", "False", ")", ":", "\n", "        ", "\"\"\"\n        only one image is test.\n        :param img: tesnor\n        :param img_meta: DC(mmcv.parallel.DataContainer), the imformation about one image\n            dict{\n            ori_shape=ori_shape,\n            img_shape=img_shape,\n            pad_shape=pad_shape,\n            scale_factor=scale_factor,\n            flip=flip}\n        :param gt_bboxes: DC(mmcv.parallel.DataContainer), tensor of shape (num_gts, 4),represent\n             the coordinates of top-left and bottom-right corner for each gt box,  (x_tl, y_tl, x_br, y_br)\n        :param gt_labels:  DC(mmcv.parallel.DataContainer), tensor of shape\n        :param rescale:\n        :return:\n        \"\"\"", "\n", "x", "=", "self", ".", "extract_feat", "(", "img", ")", "\n", "outs", "=", "self", ".", "bbox_head", "(", "x", ")", "# cls_score, bbox_pred", "\n", "# bbox_inputs = outs + (img_meta, self.test_cfg, rescale)", "\n", "bbox_inputs", "=", "outs", "+", "(", "gt_bboxes", ",", "gt_labels", ",", "img_meta", ",", "self", ".", "test_cfg", ",", "rescale", ")", "\n", "\n", "bbox_list", "=", "self", ".", "bbox_head", ".", "get_bboxes", "(", "*", "bbox_inputs", ")", "\n", "bbox_results", "=", "[", "\n", "bbox2result", "(", "det_bboxes", ",", "det_labels", ",", "self", ".", "bbox_head", ".", "num_classes", ")", "\n", "for", "det_bboxes", ",", "det_labels", "in", "bbox_list", "\n", "]", "\n", "return", "bbox_results", "[", "0", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.single_stage.SingleStageDetector.aug_test": [[98, 100], ["None"], "methods", ["None"], ["", "def", "aug_test", "(", "self", ",", "imgs", ",", "img_metas", ",", "rescale", "=", "False", ")", ":", "\n", "        ", "raise", "NotImplementedError", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.faster_rcnn.FasterRCNN.__init__": [[8, 28], ["two_stage.TwoStageDetector.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "\n", "backbone", ",", "\n", "rpn_head", ",", "\n", "bbox_roi_extractor", ",", "\n", "bbox_head", ",", "\n", "train_cfg", ",", "\n", "test_cfg", ",", "\n", "neck", "=", "None", ",", "\n", "shared_head", "=", "None", ",", "\n", "pretrained", "=", "None", ")", ":", "\n", "        ", "super", "(", "FasterRCNN", ",", "self", ")", ".", "__init__", "(", "\n", "backbone", "=", "backbone", ",", "\n", "neck", "=", "neck", ",", "\n", "shared_head", "=", "shared_head", ",", "\n", "rpn_head", "=", "rpn_head", ",", "\n", "bbox_roi_extractor", "=", "bbox_roi_extractor", ",", "\n", "bbox_head", "=", "bbox_head", ",", "\n", "train_cfg", "=", "train_cfg", ",", "\n", "test_cfg", "=", "test_cfg", ",", "\n", "pretrained", "=", "pretrained", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.fcos.FCOS.__init__": [[8, 17], ["single_stage.SingleStageDetector.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "\n", "backbone", ",", "\n", "neck", ",", "\n", "bbox_head", ",", "\n", "train_cfg", "=", "None", ",", "\n", "test_cfg", "=", "None", ",", "\n", "pretrained", "=", "None", ")", ":", "\n", "        ", "super", "(", "FCOS", ",", "self", ")", ".", "__init__", "(", "backbone", ",", "neck", ",", "bbox_head", ",", "train_cfg", ",", "\n", "test_cfg", ",", "pretrained", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.mask_rcnn.MaskRCNN.__init__": [[8, 32], ["two_stage.TwoStageDetector.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "\n", "backbone", ",", "\n", "rpn_head", ",", "\n", "bbox_roi_extractor", ",", "\n", "bbox_head", ",", "\n", "mask_roi_extractor", ",", "\n", "mask_head", ",", "\n", "train_cfg", ",", "\n", "test_cfg", ",", "\n", "neck", "=", "None", ",", "\n", "shared_head", "=", "None", ",", "\n", "pretrained", "=", "None", ")", ":", "\n", "        ", "super", "(", "MaskRCNN", ",", "self", ")", ".", "__init__", "(", "\n", "backbone", "=", "backbone", ",", "\n", "neck", "=", "neck", ",", "\n", "shared_head", "=", "shared_head", ",", "\n", "rpn_head", "=", "rpn_head", ",", "\n", "bbox_roi_extractor", "=", "bbox_roi_extractor", ",", "\n", "bbox_head", "=", "bbox_head", ",", "\n", "mask_roi_extractor", "=", "mask_roi_extractor", ",", "\n", "mask_head", "=", "mask_head", ",", "\n", "train_cfg", "=", "train_cfg", ",", "\n", "test_cfg", "=", "test_cfg", ",", "\n", "pretrained", "=", "pretrained", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.test_mixins.RPNTestMixin.simple_test_rpn": [[7, 12], ["test_mixins.RPNTestMixin.rpn_head", "test_mixins.RPNTestMixin.rpn_head.get_bboxes"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.get_bboxes"], ["    ", "def", "simple_test_rpn", "(", "self", ",", "x", ",", "gt_bboxes", ",", "gt_labels", ",", "img_meta", ",", "rpn_test_cfg", ")", ":", "\n", "        ", "rpn_outs", "=", "self", ".", "rpn_head", "(", "x", ")", "\n", "proposal_inputs", "=", "rpn_outs", "+", "(", "gt_bboxes", ",", "gt_labels", ",", "img_meta", ",", "rpn_test_cfg", ")", "\n", "proposal_list", "=", "self", ".", "rpn_head", ".", "get_bboxes", "(", "*", "proposal_inputs", ")", "\n", "return", "proposal_list", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.test_mixins.RPNTestMixin.aug_test_rpn": [[13, 26], ["len", "zip", "test_mixins.RPNTestMixin.simple_test_rpn", "enumerate", "mmdet.core.merge_aug_proposals", "range", "aug_proposals[].append", "zip"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.test_mixins.RPNTestMixin.simple_test_rpn", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.post_processing.merge_augs.merge_aug_proposals"], ["", "def", "aug_test_rpn", "(", "self", ",", "feats", ",", "img_metas", ",", "rpn_test_cfg", ")", ":", "\n", "        ", "imgs_per_gpu", "=", "len", "(", "img_metas", "[", "0", "]", ")", "\n", "aug_proposals", "=", "[", "[", "]", "for", "_", "in", "range", "(", "imgs_per_gpu", ")", "]", "\n", "for", "x", ",", "img_meta", "in", "zip", "(", "feats", ",", "img_metas", ")", ":", "\n", "            ", "proposal_list", "=", "self", ".", "simple_test_rpn", "(", "x", ",", "img_meta", ",", "rpn_test_cfg", ")", "\n", "for", "i", ",", "proposals", "in", "enumerate", "(", "proposal_list", ")", ":", "\n", "                ", "aug_proposals", "[", "i", "]", ".", "append", "(", "proposals", ")", "\n", "# after merging, proposals will be rescaled to the original image size", "\n", "", "", "merged_proposals", "=", "[", "\n", "merge_aug_proposals", "(", "proposals", ",", "img_meta", ",", "rpn_test_cfg", ")", "\n", "for", "proposals", ",", "img_meta", "in", "zip", "(", "aug_proposals", ",", "img_metas", ")", "\n", "]", "\n", "return", "merged_proposals", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.test_mixins.BBoxTestMixin.simple_test_bboxes": [[30, 54], ["mmdet.core.bbox2roi", "test_mixins.BBoxTestMixin.bbox_roi_extractor", "test_mixins.BBoxTestMixin.bbox_head", "test_mixins.BBoxTestMixin.bbox_head.get_det_bboxes", "test_mixins.BBoxTestMixin.shared_head", "len"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2roi", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.get_det_bboxes"], ["    ", "def", "simple_test_bboxes", "(", "self", ",", "\n", "x", ",", "\n", "img_meta", ",", "\n", "proposals", ",", "\n", "rcnn_test_cfg", ",", "\n", "rescale", "=", "False", ")", ":", "\n", "        ", "\"\"\"Test only det bboxes without augmentation.\"\"\"", "\n", "rois", "=", "bbox2roi", "(", "proposals", ")", "\n", "roi_feats", "=", "self", ".", "bbox_roi_extractor", "(", "\n", "x", "[", ":", "len", "(", "self", ".", "bbox_roi_extractor", ".", "featmap_strides", ")", "]", ",", "rois", ")", "\n", "if", "self", ".", "with_shared_head", ":", "\n", "            ", "roi_feats", "=", "self", ".", "shared_head", "(", "roi_feats", ")", "\n", "", "cls_score", ",", "bbox_pred", "=", "self", ".", "bbox_head", "(", "roi_feats", ")", "\n", "img_shape", "=", "img_meta", "[", "0", "]", "[", "'img_shape'", "]", "\n", "scale_factor", "=", "img_meta", "[", "0", "]", "[", "'scale_factor'", "]", "\n", "det_bboxes", ",", "det_labels", "=", "self", ".", "bbox_head", ".", "get_det_bboxes", "(", "\n", "rois", ",", "\n", "cls_score", ",", "\n", "bbox_pred", ",", "\n", "img_shape", ",", "\n", "scale_factor", ",", "\n", "rescale", "=", "rescale", ",", "\n", "cfg", "=", "rcnn_test_cfg", ")", "\n", "return", "det_bboxes", ",", "det_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.test_mixins.BBoxTestMixin.aug_test_bboxes": [[55, 90], ["zip", "mmdet.core.merge_aug_bboxes", "mmdet.core.multiclass_nms", "mmdet.core.bbox_mapping", "mmdet.core.bbox2roi", "test_mixins.BBoxTestMixin.bbox_roi_extractor", "test_mixins.BBoxTestMixin.bbox_head", "test_mixins.BBoxTestMixin.bbox_head.get_det_bboxes", "aug_bboxes.append", "aug_scores.append", "test_mixins.BBoxTestMixin.shared_head", "len"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.post_processing.merge_augs.merge_aug_bboxes", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.post_processing.bbox_nms.multiclass_nms", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox_mapping", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2roi", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.get_det_bboxes"], ["", "def", "aug_test_bboxes", "(", "self", ",", "feats", ",", "img_metas", ",", "proposal_list", ",", "rcnn_test_cfg", ")", ":", "\n", "        ", "aug_bboxes", "=", "[", "]", "\n", "aug_scores", "=", "[", "]", "\n", "for", "x", ",", "img_meta", "in", "zip", "(", "feats", ",", "img_metas", ")", ":", "\n", "# only one image in the batch", "\n", "            ", "img_shape", "=", "img_meta", "[", "0", "]", "[", "'img_shape'", "]", "\n", "scale_factor", "=", "img_meta", "[", "0", "]", "[", "'scale_factor'", "]", "\n", "flip", "=", "img_meta", "[", "0", "]", "[", "'flip'", "]", "\n", "# TODO more flexible", "\n", "proposals", "=", "bbox_mapping", "(", "proposal_list", "[", "0", "]", "[", ":", ",", ":", "4", "]", ",", "img_shape", ",", "\n", "scale_factor", ",", "flip", ")", "\n", "rois", "=", "bbox2roi", "(", "[", "proposals", "]", ")", "\n", "# recompute feature maps to save GPU memory", "\n", "roi_feats", "=", "self", ".", "bbox_roi_extractor", "(", "\n", "x", "[", ":", "len", "(", "self", ".", "bbox_roi_extractor", ".", "featmap_strides", ")", "]", ",", "rois", ")", "\n", "if", "self", ".", "with_shared_head", ":", "\n", "                ", "roi_feats", "=", "self", ".", "shared_head", "(", "roi_feats", ")", "\n", "", "cls_score", ",", "bbox_pred", "=", "self", ".", "bbox_head", "(", "roi_feats", ")", "\n", "bboxes", ",", "scores", "=", "self", ".", "bbox_head", ".", "get_det_bboxes", "(", "\n", "rois", ",", "\n", "cls_score", ",", "\n", "bbox_pred", ",", "\n", "img_shape", ",", "\n", "scale_factor", ",", "\n", "rescale", "=", "False", ",", "\n", "cfg", "=", "None", ")", "\n", "aug_bboxes", ".", "append", "(", "bboxes", ")", "\n", "aug_scores", ".", "append", "(", "scores", ")", "\n", "# after merging, bboxes will be rescaled to the original image size", "\n", "", "merged_bboxes", ",", "merged_scores", "=", "merge_aug_bboxes", "(", "\n", "aug_bboxes", ",", "aug_scores", ",", "img_metas", ",", "rcnn_test_cfg", ")", "\n", "det_bboxes", ",", "det_labels", "=", "multiclass_nms", "(", "\n", "merged_bboxes", ",", "merged_scores", ",", "rcnn_test_cfg", ".", "score_thr", ",", "\n", "rcnn_test_cfg", ".", "nms", ",", "rcnn_test_cfg", ".", "max_per_img", ")", "\n", "return", "det_bboxes", ",", "det_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.test_mixins.MaskTestMixin.simple_test_mask": [[94, 120], ["mmdet.core.bbox2roi", "test_mixins.MaskTestMixin.mask_roi_extractor", "test_mixins.MaskTestMixin.mask_head", "test_mixins.MaskTestMixin.mask_head.get_seg_masks", "test_mixins.MaskTestMixin.shared_head", "range", "len"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2roi", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.fcn_mask_head.FCNMaskHead.get_seg_masks"], ["    ", "def", "simple_test_mask", "(", "self", ",", "\n", "x", ",", "\n", "img_meta", ",", "\n", "det_bboxes", ",", "\n", "det_labels", ",", "\n", "rescale", "=", "False", ")", ":", "\n", "# image shape of the first image in the batch (only one)", "\n", "        ", "ori_shape", "=", "img_meta", "[", "0", "]", "[", "'ori_shape'", "]", "\n", "scale_factor", "=", "img_meta", "[", "0", "]", "[", "'scale_factor'", "]", "\n", "if", "det_bboxes", ".", "shape", "[", "0", "]", "==", "0", ":", "\n", "            ", "segm_result", "=", "[", "[", "]", "for", "_", "in", "range", "(", "self", ".", "mask_head", ".", "num_classes", "-", "1", ")", "]", "\n", "", "else", ":", "\n", "# if det_bboxes is rescaled to the original image size, we need to", "\n", "# rescale it back to the testing scale to obtain RoIs.", "\n", "            ", "_bboxes", "=", "(", "\n", "det_bboxes", "[", ":", ",", ":", "4", "]", "*", "scale_factor", "if", "rescale", "else", "det_bboxes", ")", "\n", "mask_rois", "=", "bbox2roi", "(", "[", "_bboxes", "]", ")", "\n", "mask_feats", "=", "self", ".", "mask_roi_extractor", "(", "\n", "x", "[", ":", "len", "(", "self", ".", "mask_roi_extractor", ".", "featmap_strides", ")", "]", ",", "mask_rois", ")", "\n", "if", "self", ".", "with_shared_head", ":", "\n", "                ", "mask_feats", "=", "self", ".", "shared_head", "(", "mask_feats", ")", "\n", "", "mask_pred", "=", "self", ".", "mask_head", "(", "mask_feats", ")", "\n", "segm_result", "=", "self", ".", "mask_head", ".", "get_seg_masks", "(", "\n", "mask_pred", ",", "_bboxes", ",", "det_labels", ",", "self", ".", "test_cfg", ".", "rcnn", ",", "ori_shape", ",", "\n", "scale_factor", ",", "rescale", ")", "\n", "", "return", "segm_result", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.test_mixins.MaskTestMixin.aug_test_mask": [[121, 154], ["zip", "mmdet.core.merge_aug_masks", "test_mixins.MaskTestMixin.mask_head.get_seg_masks", "mmdet.core.bbox_mapping", "mmdet.core.bbox2roi", "test_mixins.MaskTestMixin.mask_roi_extractor", "test_mixins.MaskTestMixin.mask_head", "aug_masks.append", "range", "test_mixins.MaskTestMixin.shared_head", "test_mixins.MaskTestMixin.sigmoid().cpu().numpy", "len", "test_mixins.MaskTestMixin.sigmoid().cpu", "test_mixins.MaskTestMixin.sigmoid"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.post_processing.merge_augs.merge_aug_masks", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.fcn_mask_head.FCNMaskHead.get_seg_masks", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox_mapping", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2roi"], ["", "def", "aug_test_mask", "(", "self", ",", "feats", ",", "img_metas", ",", "det_bboxes", ",", "det_labels", ")", ":", "\n", "        ", "if", "det_bboxes", ".", "shape", "[", "0", "]", "==", "0", ":", "\n", "            ", "segm_result", "=", "[", "[", "]", "for", "_", "in", "range", "(", "self", ".", "mask_head", ".", "num_classes", "-", "1", ")", "]", "\n", "", "else", ":", "\n", "            ", "aug_masks", "=", "[", "]", "\n", "for", "x", ",", "img_meta", "in", "zip", "(", "feats", ",", "img_metas", ")", ":", "\n", "                ", "img_shape", "=", "img_meta", "[", "0", "]", "[", "'img_shape'", "]", "\n", "scale_factor", "=", "img_meta", "[", "0", "]", "[", "'scale_factor'", "]", "\n", "flip", "=", "img_meta", "[", "0", "]", "[", "'flip'", "]", "\n", "_bboxes", "=", "bbox_mapping", "(", "det_bboxes", "[", ":", ",", ":", "4", "]", ",", "img_shape", ",", "\n", "scale_factor", ",", "flip", ")", "\n", "mask_rois", "=", "bbox2roi", "(", "[", "_bboxes", "]", ")", "\n", "mask_feats", "=", "self", ".", "mask_roi_extractor", "(", "\n", "x", "[", ":", "len", "(", "self", ".", "mask_roi_extractor", ".", "featmap_strides", ")", "]", ",", "\n", "mask_rois", ")", "\n", "if", "self", ".", "with_shared_head", ":", "\n", "                    ", "mask_feats", "=", "self", ".", "shared_head", "(", "mask_feats", ")", "\n", "", "mask_pred", "=", "self", ".", "mask_head", "(", "mask_feats", ")", "\n", "# convert to numpy array to save memory", "\n", "aug_masks", ".", "append", "(", "mask_pred", ".", "sigmoid", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ")", "\n", "", "merged_masks", "=", "merge_aug_masks", "(", "aug_masks", ",", "img_metas", ",", "\n", "self", ".", "test_cfg", ".", "rcnn", ")", "\n", "\n", "ori_shape", "=", "img_metas", "[", "0", "]", "[", "0", "]", "[", "'ori_shape'", "]", "\n", "segm_result", "=", "self", ".", "mask_head", ".", "get_seg_masks", "(", "\n", "merged_masks", ",", "\n", "det_bboxes", ",", "\n", "det_labels", ",", "\n", "self", ".", "test_cfg", ".", "rcnn", ",", "\n", "ori_shape", ",", "\n", "scale_factor", "=", "1.0", ",", "\n", "rescale", "=", "False", ")", "\n", "", "return", "segm_result", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.__init__": [[17, 87], ["base.BaseDetector.__init__", "builder.build_backbone", "cascade_rcnn.CascadeRCNN.init_weights", "builder.build_neck", "builder.build_head", "builder.build_shared_head", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "zip", "torch.ModuleList", "torch.ModuleList", "isinstance", "isinstance", "len", "len", "cascade_rcnn.CascadeRCNN.bbox_roi_extractor.append", "cascade_rcnn.CascadeRCNN.bbox_head.append", "isinstance", "len", "cascade_rcnn.CascadeRCNN.mask_head.append", "torch.ModuleList", "torch.ModuleList", "builder.build_roi_extractor", "builder.build_head", "builder.build_head", "isinstance", "len", "cascade_rcnn.CascadeRCNN.mask_roi_extractor.append", "range", "range", "range", "builder.build_roi_extractor", "range"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_backbone", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_neck", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_head", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_shared_head", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_roi_extractor", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_head", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_head", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_roi_extractor"], ["    ", "def", "__init__", "(", "self", ",", "\n", "num_stages", ",", "\n", "backbone", ",", "\n", "neck", "=", "None", ",", "\n", "shared_head", "=", "None", ",", "\n", "rpn_head", "=", "None", ",", "\n", "bbox_roi_extractor", "=", "None", ",", "\n", "bbox_head", "=", "None", ",", "\n", "mask_roi_extractor", "=", "None", ",", "\n", "mask_head", "=", "None", ",", "\n", "train_cfg", "=", "None", ",", "\n", "test_cfg", "=", "None", ",", "\n", "pretrained", "=", "None", ")", ":", "\n", "        ", "assert", "bbox_roi_extractor", "is", "not", "None", "\n", "assert", "bbox_head", "is", "not", "None", "\n", "super", "(", "CascadeRCNN", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "num_stages", "=", "num_stages", "\n", "self", ".", "backbone", "=", "builder", ".", "build_backbone", "(", "backbone", ")", "\n", "\n", "if", "neck", "is", "not", "None", ":", "\n", "            ", "self", ".", "neck", "=", "builder", ".", "build_neck", "(", "neck", ")", "\n", "\n", "", "if", "rpn_head", "is", "not", "None", ":", "\n", "            ", "self", ".", "rpn_head", "=", "builder", ".", "build_head", "(", "rpn_head", ")", "\n", "\n", "", "if", "shared_head", "is", "not", "None", ":", "\n", "            ", "self", ".", "shared_head", "=", "builder", ".", "build_shared_head", "(", "shared_head", ")", "\n", "\n", "", "if", "bbox_head", "is", "not", "None", ":", "\n", "            ", "self", ".", "bbox_roi_extractor", "=", "nn", ".", "ModuleList", "(", ")", "\n", "self", ".", "bbox_head", "=", "nn", ".", "ModuleList", "(", ")", "\n", "if", "not", "isinstance", "(", "bbox_roi_extractor", ",", "list", ")", ":", "\n", "                ", "bbox_roi_extractor", "=", "[", "\n", "bbox_roi_extractor", "for", "_", "in", "range", "(", "num_stages", ")", "\n", "]", "\n", "", "if", "not", "isinstance", "(", "bbox_head", ",", "list", ")", ":", "\n", "                ", "bbox_head", "=", "[", "bbox_head", "for", "_", "in", "range", "(", "num_stages", ")", "]", "\n", "", "assert", "len", "(", "bbox_roi_extractor", ")", "==", "len", "(", "bbox_head", ")", "==", "self", ".", "num_stages", "\n", "for", "roi_extractor", ",", "head", "in", "zip", "(", "bbox_roi_extractor", ",", "bbox_head", ")", ":", "\n", "                ", "self", ".", "bbox_roi_extractor", ".", "append", "(", "\n", "builder", ".", "build_roi_extractor", "(", "roi_extractor", ")", ")", "\n", "self", ".", "bbox_head", ".", "append", "(", "builder", ".", "build_head", "(", "head", ")", ")", "\n", "\n", "", "", "if", "mask_head", "is", "not", "None", ":", "\n", "            ", "self", ".", "mask_head", "=", "nn", ".", "ModuleList", "(", ")", "\n", "if", "not", "isinstance", "(", "mask_head", ",", "list", ")", ":", "\n", "                ", "mask_head", "=", "[", "mask_head", "for", "_", "in", "range", "(", "num_stages", ")", "]", "\n", "", "assert", "len", "(", "mask_head", ")", "==", "self", ".", "num_stages", "\n", "for", "head", "in", "mask_head", ":", "\n", "                ", "self", ".", "mask_head", ".", "append", "(", "builder", ".", "build_head", "(", "head", ")", ")", "\n", "", "if", "mask_roi_extractor", "is", "not", "None", ":", "\n", "                ", "self", ".", "share_roi_extractor", "=", "False", "\n", "self", ".", "mask_roi_extractor", "=", "nn", ".", "ModuleList", "(", ")", "\n", "if", "not", "isinstance", "(", "mask_roi_extractor", ",", "list", ")", ":", "\n", "                    ", "mask_roi_extractor", "=", "[", "\n", "mask_roi_extractor", "for", "_", "in", "range", "(", "num_stages", ")", "\n", "]", "\n", "", "assert", "len", "(", "mask_roi_extractor", ")", "==", "self", ".", "num_stages", "\n", "for", "roi_extractor", "in", "mask_roi_extractor", ":", "\n", "                    ", "self", ".", "mask_roi_extractor", ".", "append", "(", "\n", "builder", ".", "build_roi_extractor", "(", "roi_extractor", ")", ")", "\n", "", "", "else", ":", "\n", "                ", "self", ".", "share_roi_extractor", "=", "True", "\n", "self", ".", "mask_roi_extractor", "=", "self", ".", "bbox_roi_extractor", "\n", "\n", "", "", "self", ".", "train_cfg", "=", "train_cfg", "\n", "self", ".", "test_cfg", "=", "test_cfg", "\n", "\n", "self", ".", "init_weights", "(", "pretrained", "=", "pretrained", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.with_rpn": [[88, 91], ["hasattr"], "methods", ["None"], ["", "@", "property", "\n", "def", "with_rpn", "(", "self", ")", ":", "\n", "        ", "return", "hasattr", "(", "self", ",", "'rpn_head'", ")", "and", "self", ".", "rpn_head", "is", "not", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.init_weights": [[92, 113], ["super().init_weights", "cascade_rcnn.CascadeRCNN.backbone.init_weights", "range", "isinstance", "cascade_rcnn.CascadeRCNN.rpn_head.init_weights", "cascade_rcnn.CascadeRCNN.shared_head.init_weights", "cascade_rcnn.CascadeRCNN.neck.init_weights", "cascade_rcnn.CascadeRCNN.bbox_roi_extractor[].init_weights", "cascade_rcnn.CascadeRCNN.bbox_head[].init_weights", "cascade_rcnn.CascadeRCNN.mask_head[].init_weights", "m.init_weights", "cascade_rcnn.CascadeRCNN.mask_roi_extractor[].init_weights"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights"], ["", "def", "init_weights", "(", "self", ",", "pretrained", "=", "None", ")", ":", "\n", "        ", "super", "(", "CascadeRCNN", ",", "self", ")", ".", "init_weights", "(", "pretrained", ")", "\n", "self", ".", "backbone", ".", "init_weights", "(", "pretrained", "=", "pretrained", ")", "\n", "if", "self", ".", "with_neck", ":", "\n", "            ", "if", "isinstance", "(", "self", ".", "neck", ",", "nn", ".", "Sequential", ")", ":", "\n", "                ", "for", "m", "in", "self", ".", "neck", ":", "\n", "                    ", "m", ".", "init_weights", "(", ")", "\n", "", "", "else", ":", "\n", "                ", "self", ".", "neck", ".", "init_weights", "(", ")", "\n", "", "", "if", "self", ".", "with_rpn", ":", "\n", "            ", "self", ".", "rpn_head", ".", "init_weights", "(", ")", "\n", "", "if", "self", ".", "with_shared_head", ":", "\n", "            ", "self", ".", "shared_head", ".", "init_weights", "(", "pretrained", "=", "pretrained", ")", "\n", "", "for", "i", "in", "range", "(", "self", ".", "num_stages", ")", ":", "\n", "            ", "if", "self", ".", "with_bbox", ":", "\n", "                ", "self", ".", "bbox_roi_extractor", "[", "i", "]", ".", "init_weights", "(", ")", "\n", "self", ".", "bbox_head", "[", "i", "]", ".", "init_weights", "(", ")", "\n", "", "if", "self", ".", "with_mask", ":", "\n", "                ", "if", "not", "self", ".", "share_roi_extractor", ":", "\n", "                    ", "self", ".", "mask_roi_extractor", "[", "i", "]", ".", "init_weights", "(", ")", "\n", "", "self", ".", "mask_head", "[", "i", "]", ".", "init_weights", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.extract_feat": [[114, 119], ["cascade_rcnn.CascadeRCNN.backbone", "cascade_rcnn.CascadeRCNN.neck"], "methods", ["None"], ["", "", "", "def", "extract_feat", "(", "self", ",", "img", ")", ":", "\n", "        ", "x", "=", "self", ".", "backbone", "(", "img", ")", "\n", "if", "self", ".", "with_neck", ":", "\n", "            ", "x", "=", "self", ".", "neck", "(", "x", ")", "\n", "", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.forward_train": [[120, 239], ["cascade_rcnn.CascadeRCNN.extract_feat", "dict", "range", "cascade_rcnn.CascadeRCNN.rpn_head", "cascade_rcnn.CascadeRCNN.rpn_head.loss", "dict.update", "cascade_rcnn.CascadeRCNN.train_cfg.get", "cascade_rcnn.CascadeRCNN.rpn_head.get_bboxes", "mmdet.core.bbox2roi", "bbox_roi_extractor", "bbox_head", "bbox_head.get_target", "bbox_head.loss", "bbox_head.loss.items", "mmdet.core.build_assigner", "mmdet.core.build_sampler", "img.size", "range", "cascade_rcnn.CascadeRCNN.shared_head", "mask_head", "mask_head.get_target", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "mask_head.loss", "mask_head.loss.items", "mmdet.core.build_assigner.assign", "mmdet.core.build_sampler.sample", "sampling_results.append", "mmdet.core.bbox2roi", "mask_roi_extractor", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "bbox_head.refine_bboxes", "cascade_rcnn.CascadeRCNN.shared_head", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "range", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.extract_feat", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor_heads.iou_aware_retina_head.IoUawareRetinaHead.get_bboxes", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2roi", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.get_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.assign_sampling.build_assigner", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.assign_sampling.build_sampler", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.get_target", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.max_iou_assigner.MaxIoUAssigner.assign", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.pseudo_sampler.PseudoSampler.sample", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2roi", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.refine_bboxes"], ["", "def", "forward_train", "(", "self", ",", "\n", "img", ",", "\n", "img_meta", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "gt_bboxes_ignore", "=", "None", ",", "\n", "gt_masks", "=", "None", ",", "\n", "proposals", "=", "None", ")", ":", "\n", "        ", "x", "=", "self", ".", "extract_feat", "(", "img", ")", "\n", "\n", "losses", "=", "dict", "(", ")", "\n", "\n", "if", "self", ".", "with_rpn", ":", "\n", "            ", "rpn_outs", "=", "self", ".", "rpn_head", "(", "x", ")", "\n", "rpn_loss_inputs", "=", "rpn_outs", "+", "(", "gt_bboxes", ",", "img_meta", ",", "\n", "self", ".", "train_cfg", ".", "rpn", ")", "\n", "rpn_losses", "=", "self", ".", "rpn_head", ".", "loss", "(", "\n", "*", "rpn_loss_inputs", ",", "gt_bboxes_ignore", "=", "gt_bboxes_ignore", ")", "\n", "losses", ".", "update", "(", "rpn_losses", ")", "\n", "\n", "proposal_cfg", "=", "self", ".", "train_cfg", ".", "get", "(", "'rpn_proposal'", ",", "\n", "self", ".", "test_cfg", ".", "rpn", ")", "\n", "proposal_inputs", "=", "rpn_outs", "+", "(", "img_meta", ",", "proposal_cfg", ")", "\n", "proposal_list", "=", "self", ".", "rpn_head", ".", "get_bboxes", "(", "*", "proposal_inputs", ")", "\n", "", "else", ":", "\n", "            ", "proposal_list", "=", "proposals", "\n", "\n", "", "for", "i", "in", "range", "(", "self", ".", "num_stages", ")", ":", "\n", "            ", "self", ".", "current_stage", "=", "i", "\n", "rcnn_train_cfg", "=", "self", ".", "train_cfg", ".", "rcnn", "[", "i", "]", "\n", "lw", "=", "self", ".", "train_cfg", ".", "stage_loss_weights", "[", "i", "]", "\n", "\n", "# assign gts and sample proposals", "\n", "sampling_results", "=", "[", "]", "\n", "if", "self", ".", "with_bbox", "or", "self", ".", "with_mask", ":", "\n", "                ", "bbox_assigner", "=", "build_assigner", "(", "rcnn_train_cfg", ".", "assigner", ")", "\n", "bbox_sampler", "=", "build_sampler", "(", "\n", "rcnn_train_cfg", ".", "sampler", ",", "context", "=", "self", ")", "\n", "num_imgs", "=", "img", ".", "size", "(", "0", ")", "\n", "if", "gt_bboxes_ignore", "is", "None", ":", "\n", "                    ", "gt_bboxes_ignore", "=", "[", "None", "for", "_", "in", "range", "(", "num_imgs", ")", "]", "\n", "\n", "", "for", "j", "in", "range", "(", "num_imgs", ")", ":", "\n", "                    ", "assign_result", "=", "bbox_assigner", ".", "assign", "(", "\n", "proposal_list", "[", "j", "]", ",", "gt_bboxes", "[", "j", "]", ",", "gt_bboxes_ignore", "[", "j", "]", ",", "\n", "gt_labels", "[", "j", "]", ")", "\n", "sampling_result", "=", "bbox_sampler", ".", "sample", "(", "\n", "assign_result", ",", "\n", "proposal_list", "[", "j", "]", ",", "\n", "gt_bboxes", "[", "j", "]", ",", "\n", "gt_labels", "[", "j", "]", ",", "\n", "feats", "=", "[", "lvl_feat", "[", "j", "]", "[", "None", "]", "for", "lvl_feat", "in", "x", "]", ")", "\n", "sampling_results", ".", "append", "(", "sampling_result", ")", "\n", "\n", "# bbox head forward and loss", "\n", "", "", "bbox_roi_extractor", "=", "self", ".", "bbox_roi_extractor", "[", "i", "]", "\n", "bbox_head", "=", "self", ".", "bbox_head", "[", "i", "]", "\n", "\n", "rois", "=", "bbox2roi", "(", "[", "res", ".", "bboxes", "for", "res", "in", "sampling_results", "]", ")", "\n", "bbox_feats", "=", "bbox_roi_extractor", "(", "x", "[", ":", "bbox_roi_extractor", ".", "num_inputs", "]", ",", "\n", "rois", ")", "\n", "if", "self", ".", "with_shared_head", ":", "\n", "                ", "bbox_feats", "=", "self", ".", "shared_head", "(", "bbox_feats", ")", "\n", "", "cls_score", ",", "bbox_pred", "=", "bbox_head", "(", "bbox_feats", ")", "\n", "\n", "bbox_targets", "=", "bbox_head", ".", "get_target", "(", "sampling_results", ",", "gt_bboxes", ",", "\n", "gt_labels", ",", "rcnn_train_cfg", ")", "\n", "loss_bbox", "=", "bbox_head", ".", "loss", "(", "cls_score", ",", "bbox_pred", ",", "*", "bbox_targets", ")", "\n", "for", "name", ",", "value", "in", "loss_bbox", ".", "items", "(", ")", ":", "\n", "                ", "losses", "[", "'s{}.{}'", ".", "format", "(", "i", ",", "name", ")", "]", "=", "(", "\n", "value", "*", "lw", "if", "'loss'", "in", "name", "else", "value", ")", "\n", "\n", "# mask head forward and loss", "\n", "", "if", "self", ".", "with_mask", ":", "\n", "                ", "if", "not", "self", ".", "share_roi_extractor", ":", "\n", "                    ", "mask_roi_extractor", "=", "self", ".", "mask_roi_extractor", "[", "i", "]", "\n", "pos_rois", "=", "bbox2roi", "(", "\n", "[", "res", ".", "pos_bboxes", "for", "res", "in", "sampling_results", "]", ")", "\n", "mask_feats", "=", "mask_roi_extractor", "(", "\n", "x", "[", ":", "mask_roi_extractor", ".", "num_inputs", "]", ",", "pos_rois", ")", "\n", "if", "self", ".", "with_shared_head", ":", "\n", "                        ", "mask_feats", "=", "self", ".", "shared_head", "(", "mask_feats", ")", "\n", "", "", "else", ":", "\n", "# reuse positive bbox feats", "\n", "                    ", "pos_inds", "=", "[", "]", "\n", "device", "=", "bbox_feats", ".", "device", "\n", "for", "res", "in", "sampling_results", ":", "\n", "                        ", "pos_inds", ".", "append", "(", "\n", "torch", ".", "ones", "(", "\n", "res", ".", "pos_bboxes", ".", "shape", "[", "0", "]", ",", "\n", "device", "=", "device", ",", "\n", "dtype", "=", "torch", ".", "uint8", ")", ")", "\n", "pos_inds", ".", "append", "(", "\n", "torch", ".", "zeros", "(", "\n", "res", ".", "neg_bboxes", ".", "shape", "[", "0", "]", ",", "\n", "device", "=", "device", ",", "\n", "dtype", "=", "torch", ".", "uint8", ")", ")", "\n", "", "pos_inds", "=", "torch", ".", "cat", "(", "pos_inds", ")", "\n", "mask_feats", "=", "bbox_feats", "[", "pos_inds", "]", "\n", "", "mask_head", "=", "self", ".", "mask_head", "[", "i", "]", "\n", "mask_pred", "=", "mask_head", "(", "mask_feats", ")", "\n", "mask_targets", "=", "mask_head", ".", "get_target", "(", "sampling_results", ",", "gt_masks", ",", "\n", "rcnn_train_cfg", ")", "\n", "pos_labels", "=", "torch", ".", "cat", "(", "\n", "[", "res", ".", "pos_gt_labels", "for", "res", "in", "sampling_results", "]", ")", "\n", "loss_mask", "=", "mask_head", ".", "loss", "(", "mask_pred", ",", "mask_targets", ",", "pos_labels", ")", "\n", "for", "name", ",", "value", "in", "loss_mask", ".", "items", "(", ")", ":", "\n", "                    ", "losses", "[", "'s{}.{}'", ".", "format", "(", "i", ",", "name", ")", "]", "=", "(", "\n", "value", "*", "lw", "if", "'loss'", "in", "name", "else", "value", ")", "\n", "\n", "# refine bboxes", "\n", "", "", "if", "i", "<", "self", ".", "num_stages", "-", "1", ":", "\n", "                ", "pos_is_gts", "=", "[", "res", ".", "pos_is_gt", "for", "res", "in", "sampling_results", "]", "\n", "roi_labels", "=", "bbox_targets", "[", "0", "]", "# bbox_targets is a tuple", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "                    ", "proposal_list", "=", "bbox_head", ".", "refine_bboxes", "(", "\n", "rois", ",", "roi_labels", ",", "bbox_pred", ",", "pos_is_gts", ",", "img_meta", ")", "\n", "\n", "", "", "", "return", "losses", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.simple_test": [[240, 365], ["cascade_rcnn.CascadeRCNN.extract_feat", "mmdet.core.bbox2roi", "range", "cascade_rcnn.CascadeRCNN.bbox_head[].get_det_bboxes", "mmdet.core.bbox2result", "cascade_rcnn.CascadeRCNN.simple_test_rpn", "bbox_roi_extractor", "bbox_head", "ms_scores.append", "sum", "cascade_rcnn.CascadeRCNN.shared_head", "bbox_head.get_det_bboxes", "mmdet.core.bbox2result", "cls_score.argmax", "bbox_head.regress_by_class", "mmdet.core.bbox2roi", "range", "mmdet.core.merge_aug_masks", "cascade_rcnn.CascadeRCNN.mask_head[].get_seg_masks", "mask_roi_extractor", "aug_masks.append", "len", "mmdet.core.bbox2roi", "mask_roi_extractor", "mask_head", "mask_head.get_seg_masks", "range", "cascade_rcnn.CascadeRCNN.shared_head", "mask_head.sigmoid().cpu().numpy", "cascade_rcnn.CascadeRCNN.shared_head", "range", "len", "mask_head.sigmoid().cpu", "len", "mask_head.sigmoid"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.extract_feat", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2roi", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.get_det_bboxes", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2result", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.test_mixins.RPNTestMixin.simple_test_rpn", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.get_det_bboxes", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2result", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.regress_by_class", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2roi", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.post_processing.merge_augs.merge_aug_masks", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.fcn_mask_head.FCNMaskHead.get_seg_masks", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2roi", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask_heads.fcn_mask_head.FCNMaskHead.get_seg_masks"], ["", "def", "simple_test", "(", "self", ",", "img", ",", "img_meta", ",", "proposals", "=", "None", ",", "rescale", "=", "False", ")", ":", "\n", "        ", "x", "=", "self", ".", "extract_feat", "(", "img", ")", "\n", "proposal_list", "=", "self", ".", "simple_test_rpn", "(", "\n", "x", ",", "img_meta", ",", "self", ".", "test_cfg", ".", "rpn", ")", "if", "proposals", "is", "None", "else", "proposals", "\n", "\n", "img_shape", "=", "img_meta", "[", "0", "]", "[", "'img_shape'", "]", "\n", "ori_shape", "=", "img_meta", "[", "0", "]", "[", "'ori_shape'", "]", "\n", "scale_factor", "=", "img_meta", "[", "0", "]", "[", "'scale_factor'", "]", "\n", "\n", "# \"ms\" in variable names means multi-stage", "\n", "ms_bbox_result", "=", "{", "}", "\n", "ms_segm_result", "=", "{", "}", "\n", "ms_scores", "=", "[", "]", "\n", "rcnn_test_cfg", "=", "self", ".", "test_cfg", ".", "rcnn", "\n", "\n", "rois", "=", "bbox2roi", "(", "proposal_list", ")", "\n", "for", "i", "in", "range", "(", "self", ".", "num_stages", ")", ":", "\n", "            ", "bbox_roi_extractor", "=", "self", ".", "bbox_roi_extractor", "[", "i", "]", "\n", "bbox_head", "=", "self", ".", "bbox_head", "[", "i", "]", "\n", "\n", "bbox_feats", "=", "bbox_roi_extractor", "(", "\n", "x", "[", ":", "len", "(", "bbox_roi_extractor", ".", "featmap_strides", ")", "]", ",", "rois", ")", "\n", "if", "self", ".", "with_shared_head", ":", "\n", "                ", "bbox_feats", "=", "self", ".", "shared_head", "(", "bbox_feats", ")", "\n", "\n", "", "cls_score", ",", "bbox_pred", "=", "bbox_head", "(", "bbox_feats", ")", "\n", "ms_scores", ".", "append", "(", "cls_score", ")", "\n", "\n", "if", "self", ".", "test_cfg", ".", "keep_all_stages", ":", "\n", "                ", "det_bboxes", ",", "det_labels", "=", "bbox_head", ".", "get_det_bboxes", "(", "\n", "rois", ",", "\n", "cls_score", ",", "\n", "bbox_pred", ",", "\n", "img_shape", ",", "\n", "scale_factor", ",", "\n", "rescale", "=", "rescale", ",", "\n", "cfg", "=", "rcnn_test_cfg", ")", "\n", "bbox_result", "=", "bbox2result", "(", "det_bboxes", ",", "det_labels", ",", "\n", "bbox_head", ".", "num_classes", ")", "\n", "ms_bbox_result", "[", "'stage{}'", ".", "format", "(", "i", ")", "]", "=", "bbox_result", "\n", "\n", "if", "self", ".", "with_mask", ":", "\n", "                    ", "mask_roi_extractor", "=", "self", ".", "mask_roi_extractor", "[", "i", "]", "\n", "mask_head", "=", "self", ".", "mask_head", "[", "i", "]", "\n", "if", "det_bboxes", ".", "shape", "[", "0", "]", "==", "0", ":", "\n", "                        ", "segm_result", "=", "[", "\n", "[", "]", "for", "_", "in", "range", "(", "mask_head", ".", "num_classes", "-", "1", ")", "\n", "]", "\n", "", "else", ":", "\n", "                        ", "_bboxes", "=", "(", "\n", "det_bboxes", "[", ":", ",", ":", "4", "]", "*", "scale_factor", "\n", "if", "rescale", "else", "det_bboxes", ")", "\n", "mask_rois", "=", "bbox2roi", "(", "[", "_bboxes", "]", ")", "\n", "mask_feats", "=", "mask_roi_extractor", "(", "\n", "x", "[", ":", "len", "(", "mask_roi_extractor", ".", "featmap_strides", ")", "]", ",", "\n", "mask_rois", ")", "\n", "if", "self", ".", "with_shared_head", ":", "\n", "                            ", "mask_feats", "=", "self", ".", "shared_head", "(", "mask_feats", ",", "i", ")", "\n", "", "mask_pred", "=", "mask_head", "(", "mask_feats", ")", "\n", "segm_result", "=", "mask_head", ".", "get_seg_masks", "(", "\n", "mask_pred", ",", "_bboxes", ",", "det_labels", ",", "rcnn_test_cfg", ",", "\n", "ori_shape", ",", "scale_factor", ",", "rescale", ")", "\n", "", "ms_segm_result", "[", "'stage{}'", ".", "format", "(", "i", ")", "]", "=", "segm_result", "\n", "\n", "", "", "if", "i", "<", "self", ".", "num_stages", "-", "1", ":", "\n", "                ", "bbox_label", "=", "cls_score", ".", "argmax", "(", "dim", "=", "1", ")", "\n", "rois", "=", "bbox_head", ".", "regress_by_class", "(", "rois", ",", "bbox_label", ",", "bbox_pred", ",", "\n", "img_meta", "[", "0", "]", ")", "\n", "\n", "", "", "cls_score", "=", "sum", "(", "ms_scores", ")", "/", "self", ".", "num_stages", "\n", "det_bboxes", ",", "det_labels", "=", "self", ".", "bbox_head", "[", "-", "1", "]", ".", "get_det_bboxes", "(", "\n", "rois", ",", "\n", "cls_score", ",", "\n", "bbox_pred", ",", "\n", "img_shape", ",", "\n", "scale_factor", ",", "\n", "rescale", "=", "rescale", ",", "\n", "cfg", "=", "rcnn_test_cfg", ")", "\n", "bbox_result", "=", "bbox2result", "(", "det_bboxes", ",", "det_labels", ",", "\n", "self", ".", "bbox_head", "[", "-", "1", "]", ".", "num_classes", ")", "\n", "ms_bbox_result", "[", "'ensemble'", "]", "=", "bbox_result", "\n", "\n", "if", "self", ".", "with_mask", ":", "\n", "            ", "if", "det_bboxes", ".", "shape", "[", "0", "]", "==", "0", ":", "\n", "                ", "segm_result", "=", "[", "\n", "[", "]", "for", "_", "in", "range", "(", "self", ".", "mask_head", "[", "-", "1", "]", ".", "num_classes", "-", "1", ")", "\n", "]", "\n", "", "else", ":", "\n", "                ", "_bboxes", "=", "(", "\n", "det_bboxes", "[", ":", ",", ":", "4", "]", "*", "scale_factor", "\n", "if", "rescale", "else", "det_bboxes", ")", "\n", "mask_rois", "=", "bbox2roi", "(", "[", "_bboxes", "]", ")", "\n", "aug_masks", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "self", ".", "num_stages", ")", ":", "\n", "                    ", "mask_roi_extractor", "=", "self", ".", "mask_roi_extractor", "[", "i", "]", "\n", "mask_feats", "=", "mask_roi_extractor", "(", "\n", "x", "[", ":", "len", "(", "mask_roi_extractor", ".", "featmap_strides", ")", "]", ",", "mask_rois", ")", "\n", "if", "self", ".", "with_shared_head", ":", "\n", "                        ", "mask_feats", "=", "self", ".", "shared_head", "(", "mask_feats", ")", "\n", "", "mask_pred", "=", "self", ".", "mask_head", "[", "i", "]", "(", "mask_feats", ")", "\n", "aug_masks", ".", "append", "(", "mask_pred", ".", "sigmoid", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ")", "\n", "", "merged_masks", "=", "merge_aug_masks", "(", "aug_masks", ",", "\n", "[", "img_meta", "]", "*", "self", ".", "num_stages", ",", "\n", "self", ".", "test_cfg", ".", "rcnn", ")", "\n", "segm_result", "=", "self", ".", "mask_head", "[", "-", "1", "]", ".", "get_seg_masks", "(", "\n", "merged_masks", ",", "_bboxes", ",", "det_labels", ",", "rcnn_test_cfg", ",", "\n", "ori_shape", ",", "scale_factor", ",", "rescale", ")", "\n", "", "ms_segm_result", "[", "'ensemble'", "]", "=", "segm_result", "\n", "\n", "", "if", "not", "self", ".", "test_cfg", ".", "keep_all_stages", ":", "\n", "            ", "if", "self", ".", "with_mask", ":", "\n", "                ", "results", "=", "(", "ms_bbox_result", "[", "'ensemble'", "]", ",", "\n", "ms_segm_result", "[", "'ensemble'", "]", ")", "\n", "", "else", ":", "\n", "                ", "results", "=", "ms_bbox_result", "[", "'ensemble'", "]", "\n", "", "", "else", ":", "\n", "            ", "if", "self", ".", "with_mask", ":", "\n", "                ", "results", "=", "{", "\n", "stage", ":", "(", "ms_bbox_result", "[", "stage", "]", ",", "ms_segm_result", "[", "stage", "]", ")", "\n", "for", "stage", "in", "ms_bbox_result", "\n", "}", "\n", "", "else", ":", "\n", "                ", "results", "=", "ms_bbox_result", "\n", "\n", "", "", "return", "results", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.aug_test": [[366, 368], ["None"], "methods", ["None"], ["", "def", "aug_test", "(", "self", ",", "img", ",", "img_meta", ",", "proposals", "=", "None", ",", "rescale", "=", "False", ")", ":", "\n", "        ", "raise", "NotImplementedError", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.show_result": [[369, 380], ["super().show_result", "isinstance", "isinstance"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.show_result"], ["", "def", "show_result", "(", "self", ",", "data", ",", "result", ",", "img_norm_cfg", ",", "**", "kwargs", ")", ":", "\n", "        ", "if", "self", ".", "with_mask", ":", "\n", "            ", "ms_bbox_result", ",", "ms_segm_result", "=", "result", "\n", "if", "isinstance", "(", "ms_bbox_result", ",", "dict", ")", ":", "\n", "                ", "result", "=", "(", "ms_bbox_result", "[", "'ensemble'", "]", ",", "\n", "ms_segm_result", "[", "'ensemble'", "]", ")", "\n", "", "", "else", ":", "\n", "            ", "if", "isinstance", "(", "result", ",", "dict", ")", ":", "\n", "                ", "result", "=", "result", "[", "'ensemble'", "]", "\n", "", "", "super", "(", "CascadeRCNN", ",", "self", ")", ".", "show_result", "(", "data", ",", "result", ",", "img_norm_cfg", ",", "\n", "**", "kwargs", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.ssd_vgg.SSDVGG.__init__": [[19, 54], ["mmcv.cnn.VGG.__init__", "ssd_vgg.SSDVGG.features.add_module", "ssd_vgg.SSDVGG.features.add_module", "ssd_vgg.SSDVGG.features.add_module", "ssd_vgg.SSDVGG.features.add_module", "ssd_vgg.SSDVGG.features.add_module", "ssd_vgg.SSDVGG._make_extra_layers", "ssd_vgg.L2Norm", "str", "torch.MaxPool2d", "torch.MaxPool2d", "torch.MaxPool2d", "str", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "str", "torch.ReLU", "torch.ReLU", "torch.ReLU", "str", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "str", "torch.ReLU", "torch.ReLU", "torch.ReLU", "len", "len", "len", "len", "len"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.ssd_vgg.SSDVGG._make_extra_layers"], ["def", "__init__", "(", "self", ",", "\n", "input_size", ",", "\n", "depth", ",", "\n", "with_last_pool", "=", "False", ",", "\n", "ceil_mode", "=", "True", ",", "\n", "out_indices", "=", "(", "3", ",", "4", ")", ",", "\n", "out_feature_indices", "=", "(", "22", ",", "34", ")", ",", "\n", "l2_norm_scale", "=", "20.", ")", ":", "\n", "        ", "super", "(", "SSDVGG", ",", "self", ")", ".", "__init__", "(", "\n", "depth", ",", "\n", "with_last_pool", "=", "with_last_pool", ",", "\n", "ceil_mode", "=", "ceil_mode", ",", "\n", "out_indices", "=", "out_indices", ")", "\n", "assert", "input_size", "in", "(", "300", ",", "512", ")", "\n", "self", ".", "input_size", "=", "input_size", "\n", "\n", "self", ".", "features", ".", "add_module", "(", "\n", "str", "(", "len", "(", "self", ".", "features", ")", ")", ",", "\n", "nn", ".", "MaxPool2d", "(", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "padding", "=", "1", ")", ")", "\n", "self", ".", "features", ".", "add_module", "(", "\n", "str", "(", "len", "(", "self", ".", "features", ")", ")", ",", "\n", "nn", ".", "Conv2d", "(", "512", ",", "1024", ",", "kernel_size", "=", "3", ",", "padding", "=", "6", ",", "dilation", "=", "6", ")", ")", "\n", "self", ".", "features", ".", "add_module", "(", "\n", "str", "(", "len", "(", "self", ".", "features", ")", ")", ",", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", ")", "\n", "self", ".", "features", ".", "add_module", "(", "\n", "str", "(", "len", "(", "self", ".", "features", ")", ")", ",", "nn", ".", "Conv2d", "(", "1024", ",", "1024", ",", "kernel_size", "=", "1", ")", ")", "\n", "self", ".", "features", ".", "add_module", "(", "\n", "str", "(", "len", "(", "self", ".", "features", ")", ")", ",", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", ")", "\n", "self", ".", "out_feature_indices", "=", "out_feature_indices", "\n", "\n", "self", ".", "inplanes", "=", "1024", "\n", "self", ".", "extra", "=", "self", ".", "_make_extra_layers", "(", "self", ".", "extra_setting", "[", "input_size", "]", ")", "\n", "self", ".", "l2_norm", "=", "L2Norm", "(", "\n", "self", ".", "features", "[", "out_feature_indices", "[", "0", "]", "-", "1", "]", ".", "out_channels", ",", "\n", "l2_norm_scale", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.ssd_vgg.SSDVGG.init_weights": [[55, 75], ["isinstance", "ssd_vgg.SSDVGG.extra.modules", "mmcv.cnn.constant_init", "logging.getLogger", "mmcv.runner.load_checkpoint", "isinstance", "ssd_vgg.SSDVGG.features.modules", "TypeError", "mmcv.cnn.xavier_init", "isinstance", "mmcv.cnn.kaiming_init", "isinstance", "mmcv.cnn.constant_init", "isinstance", "mmcv.cnn.normal_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.xavier_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.kaiming_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init"], ["", "def", "init_weights", "(", "self", ",", "pretrained", "=", "None", ")", ":", "\n", "        ", "if", "isinstance", "(", "pretrained", ",", "str", ")", ":", "\n", "            ", "logger", "=", "logging", ".", "getLogger", "(", ")", "\n", "load_checkpoint", "(", "self", ",", "pretrained", ",", "strict", "=", "False", ",", "logger", "=", "logger", ")", "\n", "", "elif", "pretrained", "is", "None", ":", "\n", "            ", "for", "m", "in", "self", ".", "features", ".", "modules", "(", ")", ":", "\n", "                ", "if", "isinstance", "(", "m", ",", "nn", ".", "Conv2d", ")", ":", "\n", "                    ", "kaiming_init", "(", "m", ")", "\n", "", "elif", "isinstance", "(", "m", ",", "nn", ".", "BatchNorm2d", ")", ":", "\n", "                    ", "constant_init", "(", "m", ",", "1", ")", "\n", "", "elif", "isinstance", "(", "m", ",", "nn", ".", "Linear", ")", ":", "\n", "                    ", "normal_init", "(", "m", ",", "std", "=", "0.01", ")", "\n", "", "", "", "else", ":", "\n", "            ", "raise", "TypeError", "(", "'pretrained must be a str or None'", ")", "\n", "\n", "", "for", "m", "in", "self", ".", "extra", ".", "modules", "(", ")", ":", "\n", "            ", "if", "isinstance", "(", "m", ",", "nn", ".", "Conv2d", ")", ":", "\n", "                ", "xavier_init", "(", "m", ",", "distribution", "=", "'uniform'", ")", "\n", "\n", "", "", "constant_init", "(", "self", ".", "l2_norm", ",", "self", ".", "l2_norm", ".", "scale", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.ssd_vgg.SSDVGG.forward": [[76, 91], ["enumerate", "enumerate", "ssd_vgg.SSDVGG.l2_norm", "layer", "torch.relu", "torch.relu", "torch.relu", "len", "tuple", "outs.append", "layer", "outs.append"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "outs", "=", "[", "]", "\n", "for", "i", ",", "layer", "in", "enumerate", "(", "self", ".", "features", ")", ":", "\n", "            ", "x", "=", "layer", "(", "x", ")", "\n", "if", "i", "in", "self", ".", "out_feature_indices", ":", "\n", "                ", "outs", ".", "append", "(", "x", ")", "\n", "", "", "for", "i", ",", "layer", "in", "enumerate", "(", "self", ".", "extra", ")", ":", "\n", "            ", "x", "=", "F", ".", "relu", "(", "layer", "(", "x", ")", ",", "inplace", "=", "True", ")", "\n", "if", "i", "%", "2", "==", "1", ":", "\n", "                ", "outs", ".", "append", "(", "x", ")", "\n", "", "", "outs", "[", "0", "]", "=", "self", ".", "l2_norm", "(", "outs", "[", "0", "]", ")", "\n", "if", "len", "(", "outs", ")", "==", "1", ":", "\n", "            ", "return", "outs", "[", "0", "]", "\n", "", "else", ":", "\n", "            ", "return", "tuple", "(", "outs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.ssd_vgg.SSDVGG._make_extra_layers": [[92, 117], ["range", "torch.Sequential", "torch.Sequential", "torch.Sequential", "len", "layers.append", "layers.append", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d"], "methods", ["None"], ["", "", "def", "_make_extra_layers", "(", "self", ",", "outplanes", ")", ":", "\n", "        ", "layers", "=", "[", "]", "\n", "kernel_sizes", "=", "(", "1", ",", "3", ")", "\n", "num_layers", "=", "0", "\n", "outplane", "=", "None", "\n", "for", "i", "in", "range", "(", "len", "(", "outplanes", ")", ")", ":", "\n", "            ", "if", "self", ".", "inplanes", "==", "'S'", ":", "\n", "                ", "self", ".", "inplanes", "=", "outplane", "\n", "continue", "\n", "", "k", "=", "kernel_sizes", "[", "num_layers", "%", "2", "]", "\n", "if", "outplanes", "[", "i", "]", "==", "'S'", ":", "\n", "                ", "outplane", "=", "outplanes", "[", "i", "+", "1", "]", "\n", "conv", "=", "nn", ".", "Conv2d", "(", "\n", "self", ".", "inplanes", ",", "outplane", ",", "k", ",", "stride", "=", "2", ",", "padding", "=", "1", ")", "\n", "", "else", ":", "\n", "                ", "outplane", "=", "outplanes", "[", "i", "]", "\n", "conv", "=", "nn", ".", "Conv2d", "(", "\n", "self", ".", "inplanes", ",", "outplane", ",", "k", ",", "stride", "=", "1", ",", "padding", "=", "0", ")", "\n", "", "layers", ".", "append", "(", "conv", ")", "\n", "self", ".", "inplanes", "=", "outplanes", "[", "i", "]", "\n", "num_layers", "+=", "1", "\n", "", "if", "self", ".", "input_size", "==", "512", ":", "\n", "            ", "layers", ".", "append", "(", "nn", ".", "Conv2d", "(", "self", ".", "inplanes", ",", "256", ",", "4", ",", "padding", "=", "1", ")", ")", "\n", "\n", "", "return", "nn", ".", "Sequential", "(", "*", "layers", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.ssd_vgg.L2Norm.__init__": [[121, 127], ["torch.Module.__init__", "torch.Parameter", "torch.Parameter", "torch.Parameter", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "n_dims", ",", "scale", "=", "20.", ",", "eps", "=", "1e-10", ")", ":", "\n", "        ", "super", "(", "L2Norm", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "n_dims", "=", "n_dims", "\n", "self", ".", "weight", "=", "nn", ".", "Parameter", "(", "torch", ".", "Tensor", "(", "self", ".", "n_dims", ")", ")", "\n", "self", ".", "eps", "=", "eps", "\n", "self", ".", "scale", "=", "scale", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.ssd_vgg.L2Norm.forward": [[128, 131], ["x.pow().sum().sqrt", "ssd_vgg.L2Norm.weight[].expand_as", "x.pow().sum", "x.pow"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "norm", "=", "x", ".", "pow", "(", "2", ")", ".", "sum", "(", "1", ",", "keepdim", "=", "True", ")", ".", "sqrt", "(", ")", "+", "self", ".", "eps", "\n", "return", "self", ".", "weight", "[", "None", ",", ":", ",", "None", ",", "None", "]", ".", "expand_as", "(", "x", ")", "*", "x", "/", "norm", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRModule.__init__": [[18, 43], ["dict", "torch.Module.__init__", "hrnet.HRModule._check_branches", "hrnet.HRModule._make_branches", "hrnet.HRModule._make_fuse_layers", "torch.ReLU"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRModule._check_branches", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRModule._make_branches", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRModule._make_fuse_layers"], ["def", "__init__", "(", "self", ",", "\n", "num_branches", ",", "\n", "blocks", ",", "\n", "num_blocks", ",", "\n", "in_channels", ",", "\n", "num_channels", ",", "\n", "multiscale_output", "=", "True", ",", "\n", "with_cp", "=", "False", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "dict", "(", "type", "=", "'BN'", ")", ")", ":", "\n", "        ", "super", "(", "HRModule", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "_check_branches", "(", "num_branches", ",", "num_blocks", ",", "in_channels", ",", "\n", "num_channels", ")", "\n", "\n", "self", ".", "in_channels", "=", "in_channels", "\n", "self", ".", "num_branches", "=", "num_branches", "\n", "\n", "self", ".", "multiscale_output", "=", "multiscale_output", "\n", "self", ".", "norm_cfg", "=", "norm_cfg", "\n", "self", ".", "conv_cfg", "=", "conv_cfg", "\n", "self", ".", "with_cp", "=", "with_cp", "\n", "self", ".", "branches", "=", "self", ".", "_make_branches", "(", "num_branches", ",", "blocks", ",", "num_blocks", ",", "\n", "num_channels", ")", "\n", "self", ".", "fuse_layers", "=", "self", ".", "_make_fuse_layers", "(", ")", "\n", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "False", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRModule._check_branches": [[44, 60], ["len", "ValueError", "len", "ValueError", "len", "ValueError", "len", "len", "len"], "methods", ["None"], ["", "def", "_check_branches", "(", "self", ",", "num_branches", ",", "num_blocks", ",", "in_channels", ",", "\n", "num_channels", ")", ":", "\n", "        ", "if", "num_branches", "!=", "len", "(", "num_blocks", ")", ":", "\n", "            ", "error_msg", "=", "'NUM_BRANCHES({}) <> NUM_BLOCKS({})'", ".", "format", "(", "\n", "num_branches", ",", "len", "(", "num_blocks", ")", ")", "\n", "raise", "ValueError", "(", "error_msg", ")", "\n", "\n", "", "if", "num_branches", "!=", "len", "(", "num_channels", ")", ":", "\n", "            ", "error_msg", "=", "'NUM_BRANCHES({}) <> NUM_CHANNELS({})'", ".", "format", "(", "\n", "num_branches", ",", "len", "(", "num_channels", ")", ")", "\n", "raise", "ValueError", "(", "error_msg", ")", "\n", "\n", "", "if", "num_branches", "!=", "len", "(", "in_channels", ")", ":", "\n", "            ", "error_msg", "=", "'NUM_BRANCHES({}) <> NUM_INCHANNELS({})'", ".", "format", "(", "\n", "num_branches", ",", "len", "(", "in_channels", ")", ")", "\n", "raise", "ValueError", "(", "error_msg", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRModule._make_one_branch": [[61, 104], ["layers.append", "range", "torch.Sequential", "torch.Sequential", "block", "layers.append", "utils.build_conv_layer", "block", "utils.build_norm_layer"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer"], ["", "", "def", "_make_one_branch", "(", "self", ",", "\n", "branch_index", ",", "\n", "block", ",", "\n", "num_blocks", ",", "\n", "num_channels", ",", "\n", "stride", "=", "1", ")", ":", "\n", "        ", "downsample", "=", "None", "\n", "if", "stride", "!=", "1", "or", "self", ".", "in_channels", "[", "branch_index", "]", "!=", "num_channels", "[", "branch_index", "]", "*", "block", ".", "expansion", ":", "\n", "            ", "downsample", "=", "nn", ".", "Sequential", "(", "\n", "build_conv_layer", "(", "\n", "self", ".", "conv_cfg", ",", "\n", "self", ".", "in_channels", "[", "branch_index", "]", ",", "\n", "num_channels", "[", "branch_index", "]", "*", "block", ".", "expansion", ",", "\n", "kernel_size", "=", "1", ",", "\n", "stride", "=", "stride", ",", "\n", "bias", "=", "False", ")", ",", "\n", "build_norm_layer", "(", "self", ".", "norm_cfg", ",", "num_channels", "[", "branch_index", "]", "*", "\n", "block", ".", "expansion", ")", "[", "1", "]", ")", "\n", "\n", "", "layers", "=", "[", "]", "\n", "layers", ".", "append", "(", "\n", "block", "(", "\n", "self", ".", "in_channels", "[", "branch_index", "]", ",", "\n", "num_channels", "[", "branch_index", "]", ",", "\n", "stride", ",", "\n", "downsample", "=", "downsample", ",", "\n", "with_cp", "=", "self", ".", "with_cp", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ")", ")", "\n", "self", ".", "in_channels", "[", "branch_index", "]", "=", "num_channels", "[", "branch_index", "]", "*", "block", ".", "expansion", "\n", "for", "i", "in", "range", "(", "1", ",", "num_blocks", "[", "branch_index", "]", ")", ":", "\n", "            ", "layers", ".", "append", "(", "\n", "block", "(", "\n", "self", ".", "in_channels", "[", "branch_index", "]", ",", "\n", "num_channels", "[", "branch_index", "]", ",", "\n", "with_cp", "=", "self", ".", "with_cp", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ")", ")", "\n", "\n", "", "return", "nn", ".", "Sequential", "(", "*", "layers", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRModule._make_branches": [[105, 113], ["range", "torch.ModuleList", "branches.append", "hrnet.HRModule._make_one_branch"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRModule._make_one_branch"], ["", "def", "_make_branches", "(", "self", ",", "num_branches", ",", "block", ",", "num_blocks", ",", "num_channels", ")", ":", "\n", "        ", "branches", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "num_branches", ")", ":", "\n", "            ", "branches", ".", "append", "(", "\n", "self", ".", "_make_one_branch", "(", "i", ",", "block", ",", "num_blocks", ",", "num_channels", ")", ")", "\n", "\n", "", "return", "nn", ".", "ModuleList", "(", "branches", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRModule._make_fuse_layers": [[114, 175], ["range", "torch.ModuleList", "range", "fuse_layers.append", "torch.ModuleList", "fuse_layer.append", "torch.Sequential", "fuse_layer.append", "range", "fuse_layer.append", "utils.build_conv_layer", "torch.Upsample", "torch.Sequential", "utils.build_norm_layer", "conv_downsamples.append", "conv_downsamples.append", "torch.Sequential", "torch.Sequential", "utils.build_conv_layer", "utils.build_conv_layer", "torch.ReLU", "utils.build_norm_layer", "utils.build_norm_layer"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer"], ["", "def", "_make_fuse_layers", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "num_branches", "==", "1", ":", "\n", "            ", "return", "None", "\n", "\n", "", "num_branches", "=", "self", ".", "num_branches", "\n", "in_channels", "=", "self", ".", "in_channels", "\n", "fuse_layers", "=", "[", "]", "\n", "num_out_branches", "=", "num_branches", "if", "self", ".", "multiscale_output", "else", "1", "\n", "for", "i", "in", "range", "(", "num_out_branches", ")", ":", "\n", "            ", "fuse_layer", "=", "[", "]", "\n", "for", "j", "in", "range", "(", "num_branches", ")", ":", "\n", "                ", "if", "j", ">", "i", ":", "\n", "                    ", "fuse_layer", ".", "append", "(", "\n", "nn", ".", "Sequential", "(", "\n", "build_conv_layer", "(", "\n", "self", ".", "conv_cfg", ",", "\n", "in_channels", "[", "j", "]", ",", "\n", "in_channels", "[", "i", "]", ",", "\n", "kernel_size", "=", "1", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "0", ",", "\n", "bias", "=", "False", ")", ",", "\n", "build_norm_layer", "(", "self", ".", "norm_cfg", ",", "in_channels", "[", "i", "]", ")", "[", "1", "]", ",", "\n", "nn", ".", "Upsample", "(", "\n", "scale_factor", "=", "2", "**", "(", "j", "-", "i", ")", ",", "mode", "=", "'nearest'", ")", ")", ")", "\n", "", "elif", "j", "==", "i", ":", "\n", "                    ", "fuse_layer", ".", "append", "(", "None", ")", "\n", "", "else", ":", "\n", "                    ", "conv_downsamples", "=", "[", "]", "\n", "for", "k", "in", "range", "(", "i", "-", "j", ")", ":", "\n", "                        ", "if", "k", "==", "i", "-", "j", "-", "1", ":", "\n", "                            ", "conv_downsamples", ".", "append", "(", "\n", "nn", ".", "Sequential", "(", "\n", "build_conv_layer", "(", "\n", "self", ".", "conv_cfg", ",", "\n", "in_channels", "[", "j", "]", ",", "\n", "in_channels", "[", "i", "]", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "2", ",", "\n", "padding", "=", "1", ",", "\n", "bias", "=", "False", ")", ",", "\n", "build_norm_layer", "(", "self", ".", "norm_cfg", ",", "\n", "in_channels", "[", "i", "]", ")", "[", "1", "]", ")", ")", "\n", "", "else", ":", "\n", "                            ", "conv_downsamples", ".", "append", "(", "\n", "nn", ".", "Sequential", "(", "\n", "build_conv_layer", "(", "\n", "self", ".", "conv_cfg", ",", "\n", "in_channels", "[", "j", "]", ",", "\n", "in_channels", "[", "j", "]", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "2", ",", "\n", "padding", "=", "1", ",", "\n", "bias", "=", "False", ")", ",", "\n", "build_norm_layer", "(", "self", ".", "norm_cfg", ",", "\n", "in_channels", "[", "j", "]", ")", "[", "1", "]", ",", "\n", "nn", ".", "ReLU", "(", "inplace", "=", "False", ")", ")", ")", "\n", "", "", "fuse_layer", ".", "append", "(", "nn", ".", "Sequential", "(", "*", "conv_downsamples", ")", ")", "\n", "", "", "fuse_layers", ".", "append", "(", "nn", ".", "ModuleList", "(", "fuse_layer", ")", ")", "\n", "\n", "", "return", "nn", ".", "ModuleList", "(", "fuse_layers", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRModule.forward": [[176, 193], ["range", "range", "len", "range", "x_fuse.append", "hrnet.HRModule.relu"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "if", "self", ".", "num_branches", "==", "1", ":", "\n", "            ", "return", "[", "self", ".", "branches", "[", "0", "]", "(", "x", "[", "0", "]", ")", "]", "\n", "\n", "", "for", "i", "in", "range", "(", "self", ".", "num_branches", ")", ":", "\n", "            ", "x", "[", "i", "]", "=", "self", ".", "branches", "[", "i", "]", "(", "x", "[", "i", "]", ")", "\n", "\n", "", "x_fuse", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "self", ".", "fuse_layers", ")", ")", ":", "\n", "            ", "y", "=", "0", "\n", "for", "j", "in", "range", "(", "self", ".", "num_branches", ")", ":", "\n", "                ", "if", "i", "==", "j", ":", "\n", "                    ", "y", "+=", "x", "[", "j", "]", "\n", "", "else", ":", "\n", "                    ", "y", "+=", "self", ".", "fuse_layers", "[", "i", "]", "[", "j", "]", "(", "x", "[", "j", "]", ")", "\n", "", "", "x_fuse", ".", "append", "(", "self", ".", "relu", "(", "y", ")", ")", "\n", "", "return", "x_fuse", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRNet.__init__": [[217, 303], ["dict", "torch.Module.__init__", "utils.build_norm_layer", "utils.build_norm_layer", "utils.build_conv_layer", "hrnet.HRNet.add_module", "utils.build_conv_layer", "hrnet.HRNet.add_module", "torch.ReLU", "hrnet.HRNet._make_layer", "hrnet.HRNet._make_transition_layer", "hrnet.HRNet._make_stage", "hrnet.HRNet._make_transition_layer", "hrnet.HRNet._make_stage", "hrnet.HRNet._make_transition_layer", "hrnet.HRNet._make_stage"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRNet._make_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRNet._make_transition_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRNet._make_stage", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRNet._make_transition_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRNet._make_stage", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRNet._make_transition_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRNet._make_stage"], ["def", "__init__", "(", "self", ",", "\n", "extra", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "dict", "(", "type", "=", "'BN'", ")", ",", "\n", "norm_eval", "=", "True", ",", "\n", "with_cp", "=", "False", ",", "\n", "zero_init_residual", "=", "False", ")", ":", "\n", "        ", "super", "(", "HRNet", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "extra", "=", "extra", "\n", "self", ".", "conv_cfg", "=", "conv_cfg", "\n", "self", ".", "norm_cfg", "=", "norm_cfg", "\n", "self", ".", "norm_eval", "=", "norm_eval", "\n", "self", ".", "with_cp", "=", "with_cp", "\n", "self", ".", "zero_init_residual", "=", "zero_init_residual", "\n", "\n", "# stem net", "\n", "self", ".", "norm1_name", ",", "norm1", "=", "build_norm_layer", "(", "self", ".", "norm_cfg", ",", "64", ",", "postfix", "=", "1", ")", "\n", "self", ".", "norm2_name", ",", "norm2", "=", "build_norm_layer", "(", "self", ".", "norm_cfg", ",", "64", ",", "postfix", "=", "2", ")", "\n", "\n", "self", ".", "conv1", "=", "build_conv_layer", "(", "\n", "self", ".", "conv_cfg", ",", "\n", "3", ",", "\n", "64", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "2", ",", "\n", "padding", "=", "1", ",", "\n", "bias", "=", "False", ")", "\n", "\n", "self", ".", "add_module", "(", "self", ".", "norm1_name", ",", "norm1", ")", "\n", "self", ".", "conv2", "=", "build_conv_layer", "(", "\n", "self", ".", "conv_cfg", ",", "\n", "64", ",", "\n", "64", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "2", ",", "\n", "padding", "=", "1", ",", "\n", "bias", "=", "False", ")", "\n", "\n", "self", ".", "add_module", "(", "self", ".", "norm2_name", ",", "norm2", ")", "\n", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "\n", "# stage 1", "\n", "self", ".", "stage1_cfg", "=", "self", ".", "extra", "[", "'stage1'", "]", "\n", "num_channels", "=", "self", ".", "stage1_cfg", "[", "'num_channels'", "]", "[", "0", "]", "\n", "block_type", "=", "self", ".", "stage1_cfg", "[", "'block'", "]", "\n", "num_blocks", "=", "self", ".", "stage1_cfg", "[", "'num_blocks'", "]", "[", "0", "]", "\n", "\n", "block", "=", "self", ".", "blocks_dict", "[", "block_type", "]", "\n", "stage1_out_channels", "=", "num_channels", "*", "block", ".", "expansion", "\n", "self", ".", "layer1", "=", "self", ".", "_make_layer", "(", "block", ",", "64", ",", "num_channels", ",", "num_blocks", ")", "\n", "\n", "# stage 2", "\n", "self", ".", "stage2_cfg", "=", "self", ".", "extra", "[", "'stage2'", "]", "\n", "num_channels", "=", "self", ".", "stage2_cfg", "[", "'num_channels'", "]", "\n", "block_type", "=", "self", ".", "stage2_cfg", "[", "'block'", "]", "\n", "\n", "block", "=", "self", ".", "blocks_dict", "[", "block_type", "]", "\n", "num_channels", "=", "[", "channel", "*", "block", ".", "expansion", "for", "channel", "in", "num_channels", "]", "\n", "self", ".", "transition1", "=", "self", ".", "_make_transition_layer", "(", "[", "stage1_out_channels", "]", ",", "\n", "num_channels", ")", "\n", "self", ".", "stage2", ",", "pre_stage_channels", "=", "self", ".", "_make_stage", "(", "\n", "self", ".", "stage2_cfg", ",", "num_channels", ")", "\n", "\n", "# stage 3", "\n", "self", ".", "stage3_cfg", "=", "self", ".", "extra", "[", "'stage3'", "]", "\n", "num_channels", "=", "self", ".", "stage3_cfg", "[", "'num_channels'", "]", "\n", "block_type", "=", "self", ".", "stage3_cfg", "[", "'block'", "]", "\n", "\n", "block", "=", "self", ".", "blocks_dict", "[", "block_type", "]", "\n", "num_channels", "=", "[", "channel", "*", "block", ".", "expansion", "for", "channel", "in", "num_channels", "]", "\n", "self", ".", "transition2", "=", "self", ".", "_make_transition_layer", "(", "pre_stage_channels", ",", "\n", "num_channels", ")", "\n", "self", ".", "stage3", ",", "pre_stage_channels", "=", "self", ".", "_make_stage", "(", "\n", "self", ".", "stage3_cfg", ",", "num_channels", ")", "\n", "\n", "# stage 4", "\n", "self", ".", "stage4_cfg", "=", "self", ".", "extra", "[", "'stage4'", "]", "\n", "num_channels", "=", "self", ".", "stage4_cfg", "[", "'num_channels'", "]", "\n", "block_type", "=", "self", ".", "stage4_cfg", "[", "'block'", "]", "\n", "\n", "block", "=", "self", ".", "blocks_dict", "[", "block_type", "]", "\n", "num_channels", "=", "[", "channel", "*", "block", ".", "expansion", "for", "channel", "in", "num_channels", "]", "\n", "self", ".", "transition3", "=", "self", ".", "_make_transition_layer", "(", "pre_stage_channels", ",", "\n", "num_channels", ")", "\n", "self", ".", "stage4", ",", "pre_stage_channels", "=", "self", ".", "_make_stage", "(", "\n", "self", ".", "stage4_cfg", ",", "num_channels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRNet.norm1": [[304, 307], ["getattr"], "methods", ["None"], ["", "@", "property", "\n", "def", "norm1", "(", "self", ")", ":", "\n", "        ", "return", "getattr", "(", "self", ",", "self", ".", "norm1_name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRNet.norm2": [[308, 311], ["getattr"], "methods", ["None"], ["", "@", "property", "\n", "def", "norm2", "(", "self", ")", ":", "\n", "        ", "return", "getattr", "(", "self", ",", "self", ".", "norm2_name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRNet._make_transition_layer": [[312, 357], ["len", "len", "range", "torch.ModuleList", "range", "transition_layers.append", "transition_layers.append", "transition_layers.append", "conv_downsamples.append", "torch.Sequential", "torch.Sequential", "torch.Sequential", "utils.build_conv_layer", "torch.ReLU", "utils.build_conv_layer", "torch.ReLU", "utils.build_norm_layer", "utils.build_norm_layer"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer"], ["", "def", "_make_transition_layer", "(", "self", ",", "num_channels_pre_layer", ",", "\n", "num_channels_cur_layer", ")", ":", "\n", "        ", "num_branches_cur", "=", "len", "(", "num_channels_cur_layer", ")", "\n", "num_branches_pre", "=", "len", "(", "num_channels_pre_layer", ")", "\n", "\n", "transition_layers", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "num_branches_cur", ")", ":", "\n", "            ", "if", "i", "<", "num_branches_pre", ":", "\n", "                ", "if", "num_channels_cur_layer", "[", "i", "]", "!=", "num_channels_pre_layer", "[", "i", "]", ":", "\n", "                    ", "transition_layers", ".", "append", "(", "\n", "nn", ".", "Sequential", "(", "\n", "build_conv_layer", "(", "\n", "self", ".", "conv_cfg", ",", "\n", "num_channels_pre_layer", "[", "i", "]", ",", "\n", "num_channels_cur_layer", "[", "i", "]", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ",", "\n", "bias", "=", "False", ")", ",", "\n", "build_norm_layer", "(", "self", ".", "norm_cfg", ",", "\n", "num_channels_cur_layer", "[", "i", "]", ")", "[", "1", "]", ",", "\n", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", ")", ")", "\n", "", "else", ":", "\n", "                    ", "transition_layers", ".", "append", "(", "None", ")", "\n", "", "", "else", ":", "\n", "                ", "conv_downsamples", "=", "[", "]", "\n", "for", "j", "in", "range", "(", "i", "+", "1", "-", "num_branches_pre", ")", ":", "\n", "                    ", "in_channels", "=", "num_channels_pre_layer", "[", "-", "1", "]", "\n", "out_channels", "=", "num_channels_cur_layer", "[", "i", "]", "if", "j", "==", "i", "-", "num_branches_pre", "else", "in_channels", "\n", "conv_downsamples", ".", "append", "(", "\n", "nn", ".", "Sequential", "(", "\n", "build_conv_layer", "(", "\n", "self", ".", "conv_cfg", ",", "\n", "in_channels", ",", "\n", "out_channels", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "2", ",", "\n", "padding", "=", "1", ",", "\n", "bias", "=", "False", ")", ",", "\n", "build_norm_layer", "(", "self", ".", "norm_cfg", ",", "out_channels", ")", "[", "1", "]", ",", "\n", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", ")", ")", "\n", "", "transition_layers", ".", "append", "(", "nn", ".", "Sequential", "(", "*", "conv_downsamples", ")", ")", "\n", "\n", "", "", "return", "nn", ".", "ModuleList", "(", "transition_layers", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRNet._make_layer": [[358, 392], ["layers.append", "range", "torch.Sequential", "torch.Sequential", "block", "layers.append", "utils.build_conv_layer", "block", "utils.build_norm_layer"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer"], ["", "def", "_make_layer", "(", "self", ",", "block", ",", "inplanes", ",", "planes", ",", "blocks", ",", "stride", "=", "1", ")", ":", "\n", "        ", "downsample", "=", "None", "\n", "if", "stride", "!=", "1", "or", "inplanes", "!=", "planes", "*", "block", ".", "expansion", ":", "\n", "            ", "downsample", "=", "nn", ".", "Sequential", "(", "\n", "build_conv_layer", "(", "\n", "self", ".", "conv_cfg", ",", "\n", "inplanes", ",", "\n", "planes", "*", "block", ".", "expansion", ",", "\n", "kernel_size", "=", "1", ",", "\n", "stride", "=", "stride", ",", "\n", "bias", "=", "False", ")", ",", "\n", "build_norm_layer", "(", "self", ".", "norm_cfg", ",", "planes", "*", "block", ".", "expansion", ")", "[", "1", "]", ")", "\n", "\n", "", "layers", "=", "[", "]", "\n", "layers", ".", "append", "(", "\n", "block", "(", "\n", "inplanes", ",", "\n", "planes", ",", "\n", "stride", ",", "\n", "downsample", "=", "downsample", ",", "\n", "with_cp", "=", "self", ".", "with_cp", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ")", ")", "\n", "inplanes", "=", "planes", "*", "block", ".", "expansion", "\n", "for", "i", "in", "range", "(", "1", ",", "blocks", ")", ":", "\n", "            ", "layers", ".", "append", "(", "\n", "block", "(", "\n", "inplanes", ",", "\n", "planes", ",", "\n", "with_cp", "=", "self", ".", "with_cp", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ")", ")", "\n", "\n", "", "return", "nn", ".", "Sequential", "(", "*", "layers", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRNet._make_stage": [[393, 421], ["range", "hr_modules.append", "torch.Sequential", "hrnet.HRModule"], "methods", ["None"], ["", "def", "_make_stage", "(", "self", ",", "layer_config", ",", "in_channels", ",", "multiscale_output", "=", "True", ")", ":", "\n", "        ", "num_modules", "=", "layer_config", "[", "'num_modules'", "]", "\n", "num_branches", "=", "layer_config", "[", "'num_branches'", "]", "\n", "num_blocks", "=", "layer_config", "[", "'num_blocks'", "]", "\n", "num_channels", "=", "layer_config", "[", "'num_channels'", "]", "\n", "block", "=", "self", ".", "blocks_dict", "[", "layer_config", "[", "'block'", "]", "]", "\n", "\n", "hr_modules", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "num_modules", ")", ":", "\n", "# multi_scale_output is only used for the last module", "\n", "            ", "if", "not", "multiscale_output", "and", "i", "==", "num_modules", "-", "1", ":", "\n", "                ", "reset_multiscale_output", "=", "False", "\n", "", "else", ":", "\n", "                ", "reset_multiscale_output", "=", "True", "\n", "\n", "", "hr_modules", ".", "append", "(", "\n", "HRModule", "(", "\n", "num_branches", ",", "\n", "block", ",", "\n", "num_blocks", ",", "\n", "in_channels", ",", "\n", "num_channels", ",", "\n", "reset_multiscale_output", ",", "\n", "with_cp", "=", "self", ".", "with_cp", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ")", ")", "\n", "\n", "", "return", "nn", ".", "Sequential", "(", "*", "hr_modules", ")", ",", "in_channels", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRNet.init_weights": [[422, 441], ["isinstance", "logging.getLogger", "mmcv.runner.load_checkpoint", "hrnet.HRNet.modules", "TypeError", "isinstance", "hrnet.HRNet.modules", "mmcv.cnn.kaiming_init", "isinstance", "isinstance", "mmcv.cnn.constant_init", "mmcv.cnn.constant_init", "isinstance", "mmcv.cnn.constant_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.kaiming_init"], ["", "def", "init_weights", "(", "self", ",", "pretrained", "=", "None", ")", ":", "\n", "        ", "if", "isinstance", "(", "pretrained", ",", "str", ")", ":", "\n", "            ", "logger", "=", "logging", ".", "getLogger", "(", ")", "\n", "load_checkpoint", "(", "self", ",", "pretrained", ",", "strict", "=", "False", ",", "logger", "=", "logger", ")", "\n", "", "elif", "pretrained", "is", "None", ":", "\n", "            ", "for", "m", "in", "self", ".", "modules", "(", ")", ":", "\n", "                ", "if", "isinstance", "(", "m", ",", "nn", ".", "Conv2d", ")", ":", "\n", "                    ", "kaiming_init", "(", "m", ")", "\n", "", "elif", "isinstance", "(", "m", ",", "(", "_BatchNorm", ",", "nn", ".", "GroupNorm", ")", ")", ":", "\n", "                    ", "constant_init", "(", "m", ",", "1", ")", "\n", "\n", "", "", "if", "self", ".", "zero_init_residual", ":", "\n", "                ", "for", "m", "in", "self", ".", "modules", "(", ")", ":", "\n", "                    ", "if", "isinstance", "(", "m", ",", "Bottleneck", ")", ":", "\n", "                        ", "constant_init", "(", "m", ".", "norm3", ",", "0", ")", "\n", "", "elif", "isinstance", "(", "m", ",", "BasicBlock", ")", ":", "\n", "                        ", "constant_init", "(", "m", ".", "norm2", ",", "0", ")", "\n", "", "", "", "", "else", ":", "\n", "            ", "raise", "TypeError", "(", "'pretrained must be a str or None'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRNet.forward": [[442, 477], ["hrnet.HRNet.conv1", "hrnet.HRNet.norm1", "hrnet.HRNet.relu", "hrnet.HRNet.conv2", "hrnet.HRNet.norm2", "hrnet.HRNet.relu", "hrnet.HRNet.layer1", "range", "hrnet.HRNet.stage2", "range", "hrnet.HRNet.stage3", "range", "hrnet.HRNet.stage4", "x_list.append", "x_list.append", "x_list.append", "x_list.append", "x_list.append", "x_list.append"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.ResNet.norm1", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.Bottleneck.norm2"], ["", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "\n", "        ", "x", "=", "self", ".", "conv1", "(", "x", ")", "\n", "x", "=", "self", ".", "norm1", "(", "x", ")", "\n", "x", "=", "self", ".", "relu", "(", "x", ")", "\n", "x", "=", "self", ".", "conv2", "(", "x", ")", "\n", "x", "=", "self", ".", "norm2", "(", "x", ")", "\n", "x", "=", "self", ".", "relu", "(", "x", ")", "\n", "x", "=", "self", ".", "layer1", "(", "x", ")", "\n", "\n", "x_list", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "self", ".", "stage2_cfg", "[", "'num_branches'", "]", ")", ":", "\n", "            ", "if", "self", ".", "transition1", "[", "i", "]", "is", "not", "None", ":", "\n", "                ", "x_list", ".", "append", "(", "self", ".", "transition1", "[", "i", "]", "(", "x", ")", ")", "\n", "", "else", ":", "\n", "                ", "x_list", ".", "append", "(", "x", ")", "\n", "", "", "y_list", "=", "self", ".", "stage2", "(", "x_list", ")", "\n", "\n", "x_list", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "self", ".", "stage3_cfg", "[", "'num_branches'", "]", ")", ":", "\n", "            ", "if", "self", ".", "transition2", "[", "i", "]", "is", "not", "None", ":", "\n", "                ", "x_list", ".", "append", "(", "self", ".", "transition2", "[", "i", "]", "(", "y_list", "[", "-", "1", "]", ")", ")", "\n", "", "else", ":", "\n", "                ", "x_list", ".", "append", "(", "y_list", "[", "i", "]", ")", "\n", "", "", "y_list", "=", "self", ".", "stage3", "(", "x_list", ")", "\n", "\n", "x_list", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "self", ".", "stage4_cfg", "[", "'num_branches'", "]", ")", ":", "\n", "            ", "if", "self", ".", "transition3", "[", "i", "]", "is", "not", "None", ":", "\n", "                ", "x_list", ".", "append", "(", "self", ".", "transition3", "[", "i", "]", "(", "y_list", "[", "-", "1", "]", ")", ")", "\n", "", "else", ":", "\n", "                ", "x_list", ".", "append", "(", "y_list", "[", "i", "]", ")", "\n", "", "", "y_list", "=", "self", ".", "stage4", "(", "x_list", ")", "\n", "\n", "return", "y_list", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.hrnet.HRNet.train": [[478, 485], ["super().train", "hrnet.HRNet.modules", "isinstance", "m.eval"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.ResNet.train"], ["", "def", "train", "(", "self", ",", "mode", "=", "True", ")", ":", "\n", "        ", "super", "(", "HRNet", ",", "self", ")", ".", "train", "(", "mode", ")", "\n", "if", "mode", "and", "self", ".", "norm_eval", ":", "\n", "            ", "for", "m", "in", "self", ".", "modules", "(", ")", ":", "\n", "# trick: eval have effect on BatchNorm only", "\n", "                ", "if", "isinstance", "(", "m", ",", "_BatchNorm", ")", ":", "\n", "                    ", "m", ".", "eval", "(", ")", "\n", "", "", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.BasicBlock.__init__": [[20, 60], ["dict", "torch.Module.__init__", "utils.build_norm_layer", "utils.build_norm_layer", "utils.build_conv_layer", "resnet.BasicBlock.add_module", "utils.build_conv_layer", "resnet.BasicBlock.add_module", "torch.ReLU", "torch.ReLU"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer"], ["def", "__init__", "(", "self", ",", "\n", "inplanes", ",", "\n", "planes", ",", "\n", "stride", "=", "1", ",", "\n", "dilation", "=", "1", ",", "\n", "downsample", "=", "None", ",", "\n", "style", "=", "'pytorch'", ",", "\n", "with_cp", "=", "False", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "dict", "(", "type", "=", "'BN'", ")", ",", "\n", "dcn", "=", "None", ",", "\n", "gcb", "=", "None", ",", "\n", "gen_attention", "=", "None", ")", ":", "\n", "        ", "super", "(", "BasicBlock", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "dcn", "is", "None", ",", "\"Not implemented yet.\"", "\n", "assert", "gen_attention", "is", "None", ",", "\"Not implemented yet.\"", "\n", "assert", "gcb", "is", "None", ",", "\"Not implemented yet.\"", "\n", "\n", "self", ".", "norm1_name", ",", "norm1", "=", "build_norm_layer", "(", "norm_cfg", ",", "planes", ",", "postfix", "=", "1", ")", "\n", "self", ".", "norm2_name", ",", "norm2", "=", "build_norm_layer", "(", "norm_cfg", ",", "planes", ",", "postfix", "=", "2", ")", "\n", "\n", "self", ".", "conv1", "=", "build_conv_layer", "(", "\n", "conv_cfg", ",", "\n", "inplanes", ",", "\n", "planes", ",", "\n", "3", ",", "\n", "stride", "=", "stride", ",", "\n", "padding", "=", "dilation", ",", "\n", "dilation", "=", "dilation", ",", "\n", "bias", "=", "False", ")", "\n", "self", ".", "add_module", "(", "self", ".", "norm1_name", ",", "norm1", ")", "\n", "self", ".", "conv2", "=", "build_conv_layer", "(", "\n", "conv_cfg", ",", "planes", ",", "planes", ",", "3", ",", "padding", "=", "1", ",", "bias", "=", "False", ")", "\n", "self", ".", "add_module", "(", "self", ".", "norm2_name", ",", "norm2", ")", "\n", "\n", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "self", ".", "downsample", "=", "downsample", "\n", "self", ".", "stride", "=", "stride", "\n", "self", ".", "dilation", "=", "dilation", "\n", "assert", "not", "with_cp", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.BasicBlock.norm1": [[61, 64], ["getattr"], "methods", ["None"], ["", "@", "property", "\n", "def", "norm1", "(", "self", ")", ":", "\n", "        ", "return", "getattr", "(", "self", ",", "self", ".", "norm1_name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.BasicBlock.norm2": [[65, 68], ["getattr"], "methods", ["None"], ["", "@", "property", "\n", "def", "norm2", "(", "self", ")", ":", "\n", "        ", "return", "getattr", "(", "self", ",", "self", ".", "norm2_name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.BasicBlock.forward": [[69, 86], ["resnet.BasicBlock.conv1", "resnet.BasicBlock.norm1", "resnet.BasicBlock.relu", "resnet.BasicBlock.conv2", "resnet.BasicBlock.norm2", "resnet.BasicBlock.relu", "resnet.BasicBlock.downsample"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.ResNet.norm1", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.Bottleneck.norm2"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "identity", "=", "x", "\n", "\n", "out", "=", "self", ".", "conv1", "(", "x", ")", "\n", "out", "=", "self", ".", "norm1", "(", "out", ")", "\n", "out", "=", "self", ".", "relu", "(", "out", ")", "\n", "\n", "out", "=", "self", ".", "conv2", "(", "out", ")", "\n", "out", "=", "self", ".", "norm2", "(", "out", ")", "\n", "\n", "if", "self", ".", "downsample", "is", "not", "None", ":", "\n", "            ", "identity", "=", "self", ".", "downsample", "(", "x", ")", "\n", "\n", "", "out", "+=", "identity", "\n", "out", "=", "self", ".", "relu", "(", "out", ")", "\n", "\n", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.Bottleneck.__init__": [[91, 209], ["dict", "torch.Module.__init__", "utils.build_norm_layer", "utils.build_norm_layer", "utils.build_norm_layer", "utils.build_conv_layer", "resnet.Bottleneck.add_module", "resnet.Bottleneck.add_module", "utils.build_conv_layer", "resnet.Bottleneck.add_module", "torch.ReLU", "torch.ReLU", "isinstance", "isinstance", "isinstance", "dcn.get", "dcn.get", "utils.build_conv_layer", "dcn.get", "torch.Conv2d", "torch.Conv2d", "conv_op", "mmdet.ops.ContextBlock", "mmdet.models.plugins.GeneralizedAttention"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer"], ["def", "__init__", "(", "self", ",", "\n", "inplanes", ",", "\n", "planes", ",", "\n", "stride", "=", "1", ",", "\n", "dilation", "=", "1", ",", "\n", "downsample", "=", "None", ",", "\n", "style", "=", "'pytorch'", ",", "\n", "with_cp", "=", "False", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "dict", "(", "type", "=", "'BN'", ")", ",", "\n", "dcn", "=", "None", ",", "\n", "gcb", "=", "None", ",", "\n", "gen_attention", "=", "None", ")", ":", "\n", "        ", "\"\"\"Bottleneck block for ResNet.\n        If style is \"pytorch\", the stride-two layer is the 3x3 conv layer,\n        if it is \"caffe\", the stride-two layer is the first 1x1 conv layer.\n        \"\"\"", "\n", "super", "(", "Bottleneck", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "style", "in", "[", "'pytorch'", ",", "'caffe'", "]", "\n", "assert", "dcn", "is", "None", "or", "isinstance", "(", "dcn", ",", "dict", ")", "\n", "assert", "gcb", "is", "None", "or", "isinstance", "(", "gcb", ",", "dict", ")", "\n", "assert", "gen_attention", "is", "None", "or", "isinstance", "(", "gen_attention", ",", "dict", ")", "\n", "\n", "self", ".", "inplanes", "=", "inplanes", "\n", "self", ".", "planes", "=", "planes", "\n", "self", ".", "stride", "=", "stride", "\n", "self", ".", "dilation", "=", "dilation", "\n", "self", ".", "style", "=", "style", "\n", "self", ".", "with_cp", "=", "with_cp", "\n", "self", ".", "conv_cfg", "=", "conv_cfg", "\n", "self", ".", "norm_cfg", "=", "norm_cfg", "\n", "self", ".", "dcn", "=", "dcn", "\n", "self", ".", "with_dcn", "=", "dcn", "is", "not", "None", "\n", "self", ".", "gcb", "=", "gcb", "\n", "self", ".", "with_gcb", "=", "gcb", "is", "not", "None", "\n", "self", ".", "gen_attention", "=", "gen_attention", "\n", "self", ".", "with_gen_attention", "=", "gen_attention", "is", "not", "None", "\n", "\n", "if", "self", ".", "style", "==", "'pytorch'", ":", "\n", "            ", "self", ".", "conv1_stride", "=", "1", "\n", "self", ".", "conv2_stride", "=", "stride", "\n", "", "else", ":", "\n", "            ", "self", ".", "conv1_stride", "=", "stride", "\n", "self", ".", "conv2_stride", "=", "1", "\n", "\n", "", "self", ".", "norm1_name", ",", "norm1", "=", "build_norm_layer", "(", "norm_cfg", ",", "planes", ",", "postfix", "=", "1", ")", "\n", "self", ".", "norm2_name", ",", "norm2", "=", "build_norm_layer", "(", "norm_cfg", ",", "planes", ",", "postfix", "=", "2", ")", "\n", "self", ".", "norm3_name", ",", "norm3", "=", "build_norm_layer", "(", "\n", "norm_cfg", ",", "planes", "*", "self", ".", "expansion", ",", "postfix", "=", "3", ")", "\n", "\n", "self", ".", "conv1", "=", "build_conv_layer", "(", "\n", "conv_cfg", ",", "\n", "inplanes", ",", "\n", "planes", ",", "\n", "kernel_size", "=", "1", ",", "\n", "stride", "=", "self", ".", "conv1_stride", ",", "\n", "bias", "=", "False", ")", "\n", "self", ".", "add_module", "(", "self", ".", "norm1_name", ",", "norm1", ")", "\n", "fallback_on_stride", "=", "False", "\n", "self", ".", "with_modulated_dcn", "=", "False", "\n", "if", "self", ".", "with_dcn", ":", "\n", "            ", "fallback_on_stride", "=", "dcn", ".", "get", "(", "'fallback_on_stride'", ",", "False", ")", "\n", "self", ".", "with_modulated_dcn", "=", "dcn", ".", "get", "(", "'modulated'", ",", "False", ")", "\n", "", "if", "not", "self", ".", "with_dcn", "or", "fallback_on_stride", ":", "\n", "            ", "self", ".", "conv2", "=", "build_conv_layer", "(", "\n", "conv_cfg", ",", "\n", "planes", ",", "\n", "planes", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "self", ".", "conv2_stride", ",", "\n", "padding", "=", "dilation", ",", "\n", "dilation", "=", "dilation", ",", "\n", "bias", "=", "False", ")", "\n", "", "else", ":", "\n", "            ", "assert", "conv_cfg", "is", "None", ",", "'conv_cfg must be None for DCN'", "\n", "deformable_groups", "=", "dcn", ".", "get", "(", "'deformable_groups'", ",", "1", ")", "\n", "if", "not", "self", ".", "with_modulated_dcn", ":", "\n", "                ", "conv_op", "=", "DeformConv", "\n", "offset_channels", "=", "18", "\n", "", "else", ":", "\n", "                ", "conv_op", "=", "ModulatedDeformConv", "\n", "offset_channels", "=", "27", "\n", "", "self", ".", "conv2_offset", "=", "nn", ".", "Conv2d", "(", "\n", "planes", ",", "\n", "deformable_groups", "*", "offset_channels", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "self", ".", "conv2_stride", ",", "\n", "padding", "=", "dilation", ",", "\n", "dilation", "=", "dilation", ")", "\n", "self", ".", "conv2", "=", "conv_op", "(", "\n", "planes", ",", "\n", "planes", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "self", ".", "conv2_stride", ",", "\n", "padding", "=", "dilation", ",", "\n", "dilation", "=", "dilation", ",", "\n", "deformable_groups", "=", "deformable_groups", ",", "\n", "bias", "=", "False", ")", "\n", "", "self", ".", "add_module", "(", "self", ".", "norm2_name", ",", "norm2", ")", "\n", "self", ".", "conv3", "=", "build_conv_layer", "(", "\n", "conv_cfg", ",", "\n", "planes", ",", "\n", "planes", "*", "self", ".", "expansion", ",", "\n", "kernel_size", "=", "1", ",", "\n", "bias", "=", "False", ")", "\n", "self", ".", "add_module", "(", "self", ".", "norm3_name", ",", "norm3", ")", "\n", "\n", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "self", ".", "downsample", "=", "downsample", "\n", "\n", "if", "self", ".", "with_gcb", ":", "\n", "            ", "gcb_inplanes", "=", "planes", "*", "self", ".", "expansion", "\n", "self", ".", "context_block", "=", "ContextBlock", "(", "inplanes", "=", "gcb_inplanes", ",", "**", "gcb", ")", "\n", "\n", "# gen_attention", "\n", "", "if", "self", ".", "with_gen_attention", ":", "\n", "            ", "self", ".", "gen_attention_block", "=", "GeneralizedAttention", "(", "\n", "planes", ",", "**", "gen_attention", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.Bottleneck.norm1": [[210, 213], ["getattr"], "methods", ["None"], ["", "", "@", "property", "\n", "def", "norm1", "(", "self", ")", ":", "\n", "        ", "return", "getattr", "(", "self", ",", "self", ".", "norm1_name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.Bottleneck.norm2": [[214, 217], ["getattr"], "methods", ["None"], ["", "@", "property", "\n", "def", "norm2", "(", "self", ")", ":", "\n", "        ", "return", "getattr", "(", "self", ",", "self", ".", "norm2_name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.Bottleneck.norm3": [[218, 221], ["getattr"], "methods", ["None"], ["", "@", "property", "\n", "def", "norm3", "(", "self", ")", ":", "\n", "        ", "return", "getattr", "(", "self", ",", "self", ".", "norm3_name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.Bottleneck.forward": [[222, 268], ["resnet.Bottleneck.relu", "resnet.Bottleneck.conv1", "resnet.Bottleneck.norm1", "resnet.Bottleneck.relu", "resnet.Bottleneck.norm2", "resnet.Bottleneck.relu", "resnet.Bottleneck.conv3", "resnet.Bottleneck.norm3", "torch.checkpoint", "torch.checkpoint", "resnet.Bottleneck.forward._inner_forward"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.ResNet.norm1", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.Bottleneck.norm2", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.Bottleneck.norm3"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "\n", "        ", "def", "_inner_forward", "(", "x", ")", ":", "\n", "            ", "identity", "=", "x", "\n", "\n", "out", "=", "self", ".", "conv1", "(", "x", ")", "\n", "out", "=", "self", ".", "norm1", "(", "out", ")", "\n", "out", "=", "self", ".", "relu", "(", "out", ")", "\n", "\n", "if", "not", "self", ".", "with_dcn", ":", "\n", "                ", "out", "=", "self", ".", "conv2", "(", "out", ")", "\n", "", "elif", "self", ".", "with_modulated_dcn", ":", "\n", "                ", "offset_mask", "=", "self", ".", "conv2_offset", "(", "out", ")", "\n", "offset", "=", "offset_mask", "[", ":", ",", ":", "18", ",", ":", ",", ":", "]", "\n", "mask", "=", "offset_mask", "[", ":", ",", "-", "9", ":", ",", ":", ",", ":", "]", ".", "sigmoid", "(", ")", "\n", "out", "=", "self", ".", "conv2", "(", "out", ",", "offset", ",", "mask", ")", "\n", "", "else", ":", "\n", "                ", "offset", "=", "self", ".", "conv2_offset", "(", "out", ")", "\n", "out", "=", "self", ".", "conv2", "(", "out", ",", "offset", ")", "\n", "", "out", "=", "self", ".", "norm2", "(", "out", ")", "\n", "out", "=", "self", ".", "relu", "(", "out", ")", "\n", "\n", "if", "self", ".", "with_gen_attention", ":", "\n", "                ", "out", "=", "self", ".", "gen_attention_block", "(", "out", ")", "\n", "\n", "", "out", "=", "self", ".", "conv3", "(", "out", ")", "\n", "out", "=", "self", ".", "norm3", "(", "out", ")", "\n", "\n", "if", "self", ".", "with_gcb", ":", "\n", "                ", "out", "=", "self", ".", "context_block", "(", "out", ")", "\n", "\n", "", "if", "self", ".", "downsample", "is", "not", "None", ":", "\n", "                ", "identity", "=", "self", ".", "downsample", "(", "x", ")", "\n", "\n", "", "out", "+=", "identity", "\n", "\n", "return", "out", "\n", "\n", "", "if", "self", ".", "with_cp", "and", "x", ".", "requires_grad", ":", "\n", "            ", "out", "=", "cp", ".", "checkpoint", "(", "_inner_forward", ",", "x", ")", "\n", "", "else", ":", "\n", "            ", "out", "=", "_inner_forward", "(", "x", ")", "\n", "\n", "", "out", "=", "self", ".", "relu", "(", "out", ")", "\n", "\n", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.ResNet.__init__": [[366, 449], ["dict", "torch.Module.__init__", "resnet.ResNet._make_stem_layer", "enumerate", "resnet.ResNet._freeze_stages", "KeyError", "len", "len", "max", "resnet.make_res_layer", "resnet.ResNet.add_module", "resnet.ResNet.res_layers.append", "len", "len", "len"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.ResNet._make_stem_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.ResNet._freeze_stages", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnext.make_res_layer"], ["def", "__init__", "(", "self", ",", "\n", "depth", ",", "\n", "num_stages", "=", "4", ",", "\n", "strides", "=", "(", "1", ",", "2", ",", "2", ",", "2", ")", ",", "\n", "dilations", "=", "(", "1", ",", "1", ",", "1", ",", "1", ")", ",", "\n", "out_indices", "=", "(", "0", ",", "1", ",", "2", ",", "3", ")", ",", "\n", "style", "=", "'pytorch'", ",", "\n", "frozen_stages", "=", "-", "1", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "dict", "(", "type", "=", "'BN'", ",", "requires_grad", "=", "True", ")", ",", "\n", "norm_eval", "=", "True", ",", "\n", "dcn", "=", "None", ",", "\n", "stage_with_dcn", "=", "(", "False", ",", "False", ",", "False", ",", "False", ")", ",", "\n", "gcb", "=", "None", ",", "\n", "stage_with_gcb", "=", "(", "False", ",", "False", ",", "False", ",", "False", ")", ",", "\n", "gen_attention", "=", "None", ",", "\n", "stage_with_gen_attention", "=", "(", "(", ")", ",", "(", ")", ",", "(", ")", ",", "(", ")", ")", ",", "\n", "with_cp", "=", "False", ",", "\n", "zero_init_residual", "=", "True", ")", ":", "\n", "        ", "super", "(", "ResNet", ",", "self", ")", ".", "__init__", "(", ")", "\n", "if", "depth", "not", "in", "self", ".", "arch_settings", ":", "\n", "            ", "raise", "KeyError", "(", "'invalid depth {} for resnet'", ".", "format", "(", "depth", ")", ")", "\n", "", "self", ".", "depth", "=", "depth", "\n", "self", ".", "num_stages", "=", "num_stages", "\n", "assert", "num_stages", ">=", "1", "and", "num_stages", "<=", "4", "\n", "self", ".", "strides", "=", "strides", "\n", "self", ".", "dilations", "=", "dilations", "\n", "assert", "len", "(", "strides", ")", "==", "len", "(", "dilations", ")", "==", "num_stages", "\n", "self", ".", "out_indices", "=", "out_indices", "\n", "assert", "max", "(", "out_indices", ")", "<", "num_stages", "\n", "self", ".", "style", "=", "style", "\n", "self", ".", "frozen_stages", "=", "frozen_stages", "\n", "self", ".", "conv_cfg", "=", "conv_cfg", "\n", "self", ".", "norm_cfg", "=", "norm_cfg", "\n", "self", ".", "with_cp", "=", "with_cp", "\n", "self", ".", "norm_eval", "=", "norm_eval", "\n", "self", ".", "dcn", "=", "dcn", "\n", "self", ".", "stage_with_dcn", "=", "stage_with_dcn", "\n", "if", "dcn", "is", "not", "None", ":", "\n", "            ", "assert", "len", "(", "stage_with_dcn", ")", "==", "num_stages", "\n", "", "self", ".", "gen_attention", "=", "gen_attention", "\n", "self", ".", "gcb", "=", "gcb", "\n", "self", ".", "stage_with_gcb", "=", "stage_with_gcb", "\n", "if", "gcb", "is", "not", "None", ":", "\n", "            ", "assert", "len", "(", "stage_with_gcb", ")", "==", "num_stages", "\n", "", "self", ".", "zero_init_residual", "=", "zero_init_residual", "\n", "self", ".", "block", ",", "stage_blocks", "=", "self", ".", "arch_settings", "[", "depth", "]", "\n", "self", ".", "stage_blocks", "=", "stage_blocks", "[", ":", "num_stages", "]", "\n", "self", ".", "inplanes", "=", "64", "\n", "\n", "self", ".", "_make_stem_layer", "(", ")", "\n", "\n", "self", ".", "res_layers", "=", "[", "]", "\n", "for", "i", ",", "num_blocks", "in", "enumerate", "(", "self", ".", "stage_blocks", ")", ":", "\n", "            ", "stride", "=", "strides", "[", "i", "]", "\n", "dilation", "=", "dilations", "[", "i", "]", "\n", "dcn", "=", "self", ".", "dcn", "if", "self", ".", "stage_with_dcn", "[", "i", "]", "else", "None", "\n", "gcb", "=", "self", ".", "gcb", "if", "self", ".", "stage_with_gcb", "[", "i", "]", "else", "None", "\n", "planes", "=", "64", "*", "2", "**", "i", "\n", "res_layer", "=", "make_res_layer", "(", "\n", "self", ".", "block", ",", "\n", "self", ".", "inplanes", ",", "\n", "planes", ",", "\n", "num_blocks", ",", "\n", "stride", "=", "stride", ",", "\n", "dilation", "=", "dilation", ",", "\n", "style", "=", "self", ".", "style", ",", "\n", "with_cp", "=", "with_cp", ",", "\n", "conv_cfg", "=", "conv_cfg", ",", "\n", "norm_cfg", "=", "norm_cfg", ",", "\n", "dcn", "=", "dcn", ",", "\n", "gcb", "=", "gcb", ",", "\n", "gen_attention", "=", "gen_attention", ",", "\n", "gen_attention_blocks", "=", "stage_with_gen_attention", "[", "i", "]", ")", "\n", "self", ".", "inplanes", "=", "planes", "*", "self", ".", "block", ".", "expansion", "\n", "layer_name", "=", "'layer{}'", ".", "format", "(", "i", "+", "1", ")", "\n", "self", ".", "add_module", "(", "layer_name", ",", "res_layer", ")", "\n", "self", ".", "res_layers", ".", "append", "(", "layer_name", ")", "\n", "\n", "", "self", ".", "_freeze_stages", "(", ")", "\n", "\n", "self", ".", "feat_dim", "=", "self", ".", "block", ".", "expansion", "*", "64", "*", "2", "**", "(", "\n", "len", "(", "self", ".", "stage_blocks", ")", "-", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.ResNet.norm1": [[450, 453], ["getattr"], "methods", ["None"], ["", "@", "property", "\n", "def", "norm1", "(", "self", ")", ":", "\n", "        ", "return", "getattr", "(", "self", ",", "self", ".", "norm1_name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.ResNet._make_stem_layer": [[454, 467], ["utils.build_conv_layer", "utils.build_norm_layer", "resnet.ResNet.add_module", "torch.ReLU", "torch.ReLU", "torch.MaxPool2d", "torch.MaxPool2d"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer"], ["", "def", "_make_stem_layer", "(", "self", ")", ":", "\n", "        ", "self", ".", "conv1", "=", "build_conv_layer", "(", "\n", "self", ".", "conv_cfg", ",", "\n", "3", ",", "\n", "64", ",", "\n", "kernel_size", "=", "7", ",", "\n", "stride", "=", "2", ",", "\n", "padding", "=", "3", ",", "\n", "bias", "=", "False", ")", "\n", "self", ".", "norm1_name", ",", "norm1", "=", "build_norm_layer", "(", "self", ".", "norm_cfg", ",", "64", ",", "postfix", "=", "1", ")", "\n", "self", ".", "add_module", "(", "self", ".", "norm1_name", ",", "norm1", ")", "\n", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "self", ".", "maxpool", "=", "nn", ".", "MaxPool2d", "(", "kernel_size", "=", "3", ",", "stride", "=", "2", ",", "padding", "=", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.ResNet._freeze_stages": [[468, 480], ["range", "resnet.ResNet.norm1.eval", "getattr", "getattr.eval", "getattr.parameters", "getattr.parameters"], "methods", ["None"], ["", "def", "_freeze_stages", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "frozen_stages", ">=", "0", ":", "\n", "            ", "self", ".", "norm1", ".", "eval", "(", ")", "\n", "for", "m", "in", "[", "self", ".", "conv1", ",", "self", ".", "norm1", "]", ":", "\n", "                ", "for", "param", "in", "m", ".", "parameters", "(", ")", ":", "\n", "                    ", "param", ".", "requires_grad", "=", "False", "\n", "\n", "", "", "", "for", "i", "in", "range", "(", "1", ",", "self", ".", "frozen_stages", "+", "1", ")", ":", "\n", "            ", "m", "=", "getattr", "(", "self", ",", "'layer{}'", ".", "format", "(", "i", ")", ")", "\n", "m", ".", "eval", "(", ")", "\n", "for", "param", "in", "m", ".", "parameters", "(", ")", ":", "\n", "                ", "param", ".", "requires_grad", "=", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.ResNet.init_weights": [[481, 506], ["isinstance", "logging.getLogger", "mmcv.runner.load_checkpoint", "resnet.ResNet.modules", "TypeError", "isinstance", "resnet.ResNet.modules", "resnet.ResNet.modules", "mmcv.cnn.kaiming_init", "isinstance", "isinstance", "mmcv.cnn.constant_init", "isinstance", "hasattr", "mmcv.cnn.constant_init", "mmcv.cnn.constant_init", "isinstance", "mmcv.cnn.constant_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.kaiming_init"], ["", "", "", "def", "init_weights", "(", "self", ",", "pretrained", "=", "None", ")", ":", "\n", "        ", "if", "isinstance", "(", "pretrained", ",", "str", ")", ":", "\n", "            ", "logger", "=", "logging", ".", "getLogger", "(", ")", "\n", "load_checkpoint", "(", "self", ",", "pretrained", ",", "strict", "=", "False", ",", "logger", "=", "logger", ")", "\n", "", "elif", "pretrained", "is", "None", ":", "\n", "            ", "for", "m", "in", "self", ".", "modules", "(", ")", ":", "\n", "                ", "if", "isinstance", "(", "m", ",", "nn", ".", "Conv2d", ")", ":", "\n", "                    ", "kaiming_init", "(", "m", ")", "\n", "", "elif", "isinstance", "(", "m", ",", "(", "_BatchNorm", ",", "nn", ".", "GroupNorm", ")", ")", ":", "\n", "                    ", "constant_init", "(", "m", ",", "1", ")", "\n", "\n", "", "", "if", "self", ".", "dcn", "is", "not", "None", ":", "\n", "                ", "for", "m", "in", "self", ".", "modules", "(", ")", ":", "\n", "                    ", "if", "isinstance", "(", "m", ",", "Bottleneck", ")", "and", "hasattr", "(", "\n", "m", ",", "'conv2_offset'", ")", ":", "\n", "                        ", "constant_init", "(", "m", ".", "conv2_offset", ",", "0", ")", "\n", "\n", "", "", "", "if", "self", ".", "zero_init_residual", ":", "\n", "                ", "for", "m", "in", "self", ".", "modules", "(", ")", ":", "\n", "                    ", "if", "isinstance", "(", "m", ",", "Bottleneck", ")", ":", "\n", "                        ", "constant_init", "(", "m", ".", "norm3", ",", "0", ")", "\n", "", "elif", "isinstance", "(", "m", ",", "BasicBlock", ")", ":", "\n", "                        ", "constant_init", "(", "m", ".", "norm2", ",", "0", ")", "\n", "", "", "", "", "else", ":", "\n", "            ", "raise", "TypeError", "(", "'pretrained must be a str or None'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.ResNet.forward": [[507, 519], ["resnet.ResNet.conv1", "resnet.ResNet.norm1", "resnet.ResNet.relu", "resnet.ResNet.maxpool", "enumerate", "tuple", "getattr", "getattr.", "outs.append"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.ResNet.norm1"], ["", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "x", "=", "self", ".", "conv1", "(", "x", ")", "\n", "x", "=", "self", ".", "norm1", "(", "x", ")", "\n", "x", "=", "self", ".", "relu", "(", "x", ")", "\n", "x", "=", "self", ".", "maxpool", "(", "x", ")", "\n", "outs", "=", "[", "]", "\n", "for", "i", ",", "layer_name", "in", "enumerate", "(", "self", ".", "res_layers", ")", ":", "\n", "            ", "res_layer", "=", "getattr", "(", "self", ",", "layer_name", ")", "\n", "x", "=", "res_layer", "(", "x", ")", "\n", "if", "i", "in", "self", ".", "out_indices", ":", "\n", "                ", "outs", ".", "append", "(", "x", ")", "\n", "", "", "return", "tuple", "(", "outs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.ResNet.train": [[520, 528], ["super().train", "resnet.ResNet._freeze_stages", "resnet.ResNet.modules", "isinstance", "m.eval"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.ResNet.train", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.ResNet._freeze_stages"], ["", "def", "train", "(", "self", ",", "mode", "=", "True", ")", ":", "\n", "        ", "super", "(", "ResNet", ",", "self", ")", ".", "train", "(", "mode", ")", "\n", "self", ".", "_freeze_stages", "(", ")", "\n", "if", "mode", "and", "self", ".", "norm_eval", ":", "\n", "            ", "for", "m", "in", "self", ".", "modules", "(", ")", ":", "\n", "# trick: eval have effect on BatchNorm only", "\n", "                ", "if", "isinstance", "(", "m", ",", "_BatchNorm", ")", ":", "\n", "                    ", "m", ".", "eval", "(", ")", "\n", "", "", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.make_res_layer": [[270, 331], ["dict", "layers.append", "range", "torch.Sequential", "torch.Sequential", "block", "layers.append", "utils.build_conv_layer", "block", "utils.build_norm_layer"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer"], ["", "", "def", "make_res_layer", "(", "block", ",", "\n", "inplanes", ",", "\n", "planes", ",", "\n", "blocks", ",", "\n", "stride", "=", "1", ",", "\n", "dilation", "=", "1", ",", "\n", "style", "=", "'pytorch'", ",", "\n", "with_cp", "=", "False", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "dict", "(", "type", "=", "'BN'", ")", ",", "\n", "dcn", "=", "None", ",", "\n", "gcb", "=", "None", ",", "\n", "gen_attention", "=", "None", ",", "\n", "gen_attention_blocks", "=", "[", "]", ")", ":", "\n", "    ", "downsample", "=", "None", "\n", "if", "stride", "!=", "1", "or", "inplanes", "!=", "planes", "*", "block", ".", "expansion", ":", "\n", "        ", "downsample", "=", "nn", ".", "Sequential", "(", "\n", "build_conv_layer", "(", "\n", "conv_cfg", ",", "\n", "inplanes", ",", "\n", "planes", "*", "block", ".", "expansion", ",", "\n", "kernel_size", "=", "1", ",", "\n", "stride", "=", "stride", ",", "\n", "bias", "=", "False", ")", ",", "\n", "build_norm_layer", "(", "norm_cfg", ",", "planes", "*", "block", ".", "expansion", ")", "[", "1", "]", ",", "\n", ")", "\n", "\n", "", "layers", "=", "[", "]", "\n", "layers", ".", "append", "(", "\n", "block", "(", "\n", "inplanes", ",", "\n", "planes", ",", "\n", "stride", ",", "\n", "dilation", ",", "\n", "downsample", ",", "\n", "style", "=", "style", ",", "\n", "with_cp", "=", "with_cp", ",", "\n", "conv_cfg", "=", "conv_cfg", ",", "\n", "norm_cfg", "=", "norm_cfg", ",", "\n", "dcn", "=", "dcn", ",", "\n", "gcb", "=", "gcb", ",", "\n", "gen_attention", "=", "gen_attention", "if", "\n", "(", "0", "in", "gen_attention_blocks", ")", "else", "None", ")", ")", "\n", "inplanes", "=", "planes", "*", "block", ".", "expansion", "\n", "for", "i", "in", "range", "(", "1", ",", "blocks", ")", ":", "\n", "        ", "layers", ".", "append", "(", "\n", "block", "(", "\n", "inplanes", ",", "\n", "planes", ",", "\n", "1", ",", "\n", "dilation", ",", "\n", "style", "=", "style", ",", "\n", "with_cp", "=", "with_cp", ",", "\n", "conv_cfg", "=", "conv_cfg", ",", "\n", "norm_cfg", "=", "norm_cfg", ",", "\n", "dcn", "=", "dcn", ",", "\n", "gcb", "=", "gcb", ",", "\n", "gen_attention", "=", "gen_attention", "if", "\n", "(", "i", "in", "gen_attention_blocks", ")", "else", "None", ")", ")", "\n", "\n", "", "return", "nn", ".", "Sequential", "(", "*", "layers", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnext.Bottleneck.__init__": [[14, 92], ["resnet.Bottleneck.__init__", "utils.build_norm_layer", "utils.build_norm_layer", "utils.build_norm_layer", "utils.build_conv_layer", "resnext.Bottleneck.add_module", "resnext.Bottleneck.add_module", "utils.build_conv_layer", "resnext.Bottleneck.add_module", "resnext.Bottleneck.dcn.get", "resnext.Bottleneck.dcn.get", "utils.build_conv_layer", "resnext.Bottleneck.dcn.get", "resnext.Bottleneck.dcn.get", "torch.Conv2d", "conv_op", "math.floor"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer"], ["    ", "def", "__init__", "(", "self", ",", "groups", "=", "1", ",", "base_width", "=", "4", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "\"\"\"Bottleneck block for ResNeXt.\n        If style is \"pytorch\", the stride-two layer is the 3x3 conv layer,\n        if it is \"caffe\", the stride-two layer is the first 1x1 conv layer.\n        \"\"\"", "\n", "super", "(", "Bottleneck", ",", "self", ")", ".", "__init__", "(", "*", "args", ",", "**", "kwargs", ")", "\n", "\n", "if", "groups", "==", "1", ":", "\n", "            ", "width", "=", "self", ".", "planes", "\n", "", "else", ":", "\n", "            ", "width", "=", "math", ".", "floor", "(", "self", ".", "planes", "*", "(", "base_width", "/", "64", ")", ")", "*", "groups", "\n", "\n", "", "self", ".", "norm1_name", ",", "norm1", "=", "build_norm_layer", "(", "\n", "self", ".", "norm_cfg", ",", "width", ",", "postfix", "=", "1", ")", "\n", "self", ".", "norm2_name", ",", "norm2", "=", "build_norm_layer", "(", "\n", "self", ".", "norm_cfg", ",", "width", ",", "postfix", "=", "2", ")", "\n", "self", ".", "norm3_name", ",", "norm3", "=", "build_norm_layer", "(", "\n", "self", ".", "norm_cfg", ",", "self", ".", "planes", "*", "self", ".", "expansion", ",", "postfix", "=", "3", ")", "\n", "\n", "self", ".", "conv1", "=", "build_conv_layer", "(", "\n", "self", ".", "conv_cfg", ",", "\n", "self", ".", "inplanes", ",", "\n", "width", ",", "\n", "kernel_size", "=", "1", ",", "\n", "stride", "=", "self", ".", "conv1_stride", ",", "\n", "bias", "=", "False", ")", "\n", "self", ".", "add_module", "(", "self", ".", "norm1_name", ",", "norm1", ")", "\n", "fallback_on_stride", "=", "False", "\n", "self", ".", "with_modulated_dcn", "=", "False", "\n", "if", "self", ".", "with_dcn", ":", "\n", "            ", "fallback_on_stride", "=", "self", ".", "dcn", ".", "get", "(", "'fallback_on_stride'", ",", "False", ")", "\n", "self", ".", "with_modulated_dcn", "=", "self", ".", "dcn", ".", "get", "(", "'modulated'", ",", "False", ")", "\n", "", "if", "not", "self", ".", "with_dcn", "or", "fallback_on_stride", ":", "\n", "            ", "self", ".", "conv2", "=", "build_conv_layer", "(", "\n", "self", ".", "conv_cfg", ",", "\n", "width", ",", "\n", "width", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "self", ".", "conv2_stride", ",", "\n", "padding", "=", "self", ".", "dilation", ",", "\n", "dilation", "=", "self", ".", "dilation", ",", "\n", "groups", "=", "groups", ",", "\n", "bias", "=", "False", ")", "\n", "", "else", ":", "\n", "            ", "assert", "self", ".", "conv_cfg", "is", "None", ",", "'conv_cfg must be None for DCN'", "\n", "groups", "=", "self", ".", "dcn", ".", "get", "(", "'groups'", ",", "1", ")", "\n", "deformable_groups", "=", "self", ".", "dcn", ".", "get", "(", "'deformable_groups'", ",", "1", ")", "\n", "if", "not", "self", ".", "with_modulated_dcn", ":", "\n", "                ", "conv_op", "=", "DeformConv", "\n", "offset_channels", "=", "18", "\n", "", "else", ":", "\n", "                ", "conv_op", "=", "ModulatedDeformConv", "\n", "offset_channels", "=", "27", "\n", "", "self", ".", "conv2_offset", "=", "nn", ".", "Conv2d", "(", "\n", "width", ",", "\n", "deformable_groups", "*", "offset_channels", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "self", ".", "conv2_stride", ",", "\n", "padding", "=", "self", ".", "dilation", ",", "\n", "dilation", "=", "self", ".", "dilation", ")", "\n", "self", ".", "conv2", "=", "conv_op", "(", "\n", "width", ",", "\n", "width", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "self", ".", "conv2_stride", ",", "\n", "padding", "=", "self", ".", "dilation", ",", "\n", "dilation", "=", "self", ".", "dilation", ",", "\n", "groups", "=", "groups", ",", "\n", "deformable_groups", "=", "deformable_groups", ",", "\n", "bias", "=", "False", ")", "\n", "", "self", ".", "add_module", "(", "self", ".", "norm2_name", ",", "norm2", ")", "\n", "self", ".", "conv3", "=", "build_conv_layer", "(", "\n", "self", ".", "conv_cfg", ",", "\n", "width", ",", "\n", "self", ".", "planes", "*", "self", ".", "expansion", ",", "\n", "kernel_size", "=", "1", ",", "\n", "bias", "=", "False", ")", "\n", "self", ".", "add_module", "(", "self", ".", "norm3_name", ",", "norm3", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnext.ResNeXt.__init__": [[190, 227], ["resnet.ResNet.__init__", "enumerate", "resnext.ResNeXt._freeze_stages", "resnext.make_res_layer", "resnext.ResNeXt.add_module", "resnext.ResNeXt.res_layers.append"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnet.ResNet._freeze_stages", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnext.make_res_layer"], ["def", "__init__", "(", "self", ",", "groups", "=", "1", ",", "base_width", "=", "4", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "ResNeXt", ",", "self", ")", ".", "__init__", "(", "**", "kwargs", ")", "\n", "self", ".", "groups", "=", "groups", "\n", "self", ".", "base_width", "=", "base_width", "\n", "\n", "self", ".", "inplanes", "=", "64", "\n", "self", ".", "res_layers", "=", "[", "]", "\n", "\n", "self", ".", "block", ",", "stage_blocks", "=", "self", ".", "arch_settings", "[", "self", ".", "depth", "]", "\n", "\n", "for", "i", ",", "num_blocks", "in", "enumerate", "(", "self", ".", "stage_blocks", ")", ":", "\n", "            ", "stride", "=", "self", ".", "strides", "[", "i", "]", "\n", "dilation", "=", "self", ".", "dilations", "[", "i", "]", "\n", "dcn", "=", "self", ".", "dcn", "if", "self", ".", "stage_with_dcn", "[", "i", "]", "else", "None", "\n", "gcb", "=", "self", ".", "gcb", "if", "self", ".", "stage_with_gcb", "[", "i", "]", "else", "None", "\n", "planes", "=", "64", "*", "2", "**", "i", "\n", "res_layer", "=", "make_res_layer", "(", "\n", "self", ".", "block", ",", "\n", "self", ".", "inplanes", ",", "\n", "planes", ",", "\n", "num_blocks", ",", "\n", "stride", "=", "stride", ",", "\n", "dilation", "=", "dilation", ",", "\n", "groups", "=", "self", ".", "groups", ",", "\n", "base_width", "=", "self", ".", "base_width", ",", "\n", "style", "=", "self", ".", "style", ",", "\n", "with_cp", "=", "self", ".", "with_cp", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ",", "\n", "dcn", "=", "dcn", ",", "\n", "gcb", "=", "gcb", ")", "\n", "self", ".", "inplanes", "=", "planes", "*", "self", ".", "block", ".", "expansion", "\n", "layer_name", "=", "'layer{}'", ".", "format", "(", "i", "+", "1", ")", "\n", "self", ".", "add_module", "(", "layer_name", ",", "res_layer", ")", "\n", "self", ".", "res_layers", ".", "append", "(", "layer_name", ")", "\n", "\n", "", "self", ".", "_freeze_stages", "(", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.backbones.resnext.make_res_layer": [[94, 155], ["dict", "layers.append", "range", "torch.Sequential", "torch.Sequential", "block", "layers.append", "utils.build_conv_layer", "block", "utils.build_norm_layer"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.conv_module.build_conv_layer", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.norm.build_norm_layer"], ["", "", "def", "make_res_layer", "(", "block", ",", "\n", "inplanes", ",", "\n", "planes", ",", "\n", "blocks", ",", "\n", "stride", "=", "1", ",", "\n", "dilation", "=", "1", ",", "\n", "groups", "=", "1", ",", "\n", "base_width", "=", "4", ",", "\n", "style", "=", "'pytorch'", ",", "\n", "with_cp", "=", "False", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "dict", "(", "type", "=", "'BN'", ")", ",", "\n", "dcn", "=", "None", ",", "\n", "gcb", "=", "None", ")", ":", "\n", "    ", "downsample", "=", "None", "\n", "if", "stride", "!=", "1", "or", "inplanes", "!=", "planes", "*", "block", ".", "expansion", ":", "\n", "        ", "downsample", "=", "nn", ".", "Sequential", "(", "\n", "build_conv_layer", "(", "\n", "conv_cfg", ",", "\n", "inplanes", ",", "\n", "planes", "*", "block", ".", "expansion", ",", "\n", "kernel_size", "=", "1", ",", "\n", "stride", "=", "stride", ",", "\n", "bias", "=", "False", ")", ",", "\n", "build_norm_layer", "(", "norm_cfg", ",", "planes", "*", "block", ".", "expansion", ")", "[", "1", "]", ",", "\n", ")", "\n", "\n", "", "layers", "=", "[", "]", "\n", "layers", ".", "append", "(", "\n", "block", "(", "\n", "inplanes", "=", "inplanes", ",", "\n", "planes", "=", "planes", ",", "\n", "stride", "=", "stride", ",", "\n", "dilation", "=", "dilation", ",", "\n", "downsample", "=", "downsample", ",", "\n", "groups", "=", "groups", ",", "\n", "base_width", "=", "base_width", ",", "\n", "style", "=", "style", ",", "\n", "with_cp", "=", "with_cp", ",", "\n", "conv_cfg", "=", "conv_cfg", ",", "\n", "norm_cfg", "=", "norm_cfg", ",", "\n", "dcn", "=", "dcn", ",", "\n", "gcb", "=", "gcb", ")", ")", "\n", "inplanes", "=", "planes", "*", "block", ".", "expansion", "\n", "for", "i", "in", "range", "(", "1", ",", "blocks", ")", ":", "\n", "        ", "layers", ".", "append", "(", "\n", "block", "(", "\n", "inplanes", "=", "inplanes", ",", "\n", "planes", "=", "planes", ",", "\n", "stride", "=", "1", ",", "\n", "dilation", "=", "dilation", ",", "\n", "groups", "=", "groups", ",", "\n", "base_width", "=", "base_width", ",", "\n", "style", "=", "style", ",", "\n", "with_cp", "=", "with_cp", ",", "\n", "conv_cfg", "=", "conv_cfg", ",", "\n", "norm_cfg", "=", "norm_cfg", ",", "\n", "dcn", "=", "dcn", ",", "\n", "gcb", "=", "gcb", ")", ")", "\n", "\n", "", "return", "nn", ".", "Sequential", "(", "*", "layers", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.plugins.non_local.NonLocal2D.__init__": [[24, 65], ["torch.Module.__init__", "utils.ConvModule", "utils.ConvModule", "utils.ConvModule", "utils.ConvModule", "non_local.NonLocal2D.init_weights"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights"], ["def", "__init__", "(", "self", ",", "\n", "in_channels", ",", "\n", "reduction", "=", "2", ",", "\n", "use_scale", "=", "True", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "None", ",", "\n", "mode", "=", "'embedded_gaussian'", ")", ":", "\n", "        ", "super", "(", "NonLocal2D", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "in_channels", "=", "in_channels", "\n", "self", ".", "reduction", "=", "reduction", "\n", "self", ".", "use_scale", "=", "use_scale", "\n", "self", ".", "inter_channels", "=", "in_channels", "//", "reduction", "\n", "self", ".", "mode", "=", "mode", "\n", "assert", "mode", "in", "[", "'embedded_gaussian'", ",", "'dot_product'", "]", "\n", "\n", "# g, theta, phi are actually `nn.Conv2d`. Here we use ConvModule for", "\n", "# potential usage.", "\n", "self", ".", "g", "=", "ConvModule", "(", "\n", "self", ".", "in_channels", ",", "\n", "self", ".", "inter_channels", ",", "\n", "kernel_size", "=", "1", ",", "\n", "activation", "=", "None", ")", "\n", "self", ".", "theta", "=", "ConvModule", "(", "\n", "self", ".", "in_channels", ",", "\n", "self", ".", "inter_channels", ",", "\n", "kernel_size", "=", "1", ",", "\n", "activation", "=", "None", ")", "\n", "self", ".", "phi", "=", "ConvModule", "(", "\n", "self", ".", "in_channels", ",", "\n", "self", ".", "inter_channels", ",", "\n", "kernel_size", "=", "1", ",", "\n", "activation", "=", "None", ")", "\n", "self", ".", "conv_out", "=", "ConvModule", "(", "\n", "self", ".", "inter_channels", ",", "\n", "self", ".", "in_channels", ",", "\n", "kernel_size", "=", "1", ",", "\n", "conv_cfg", "=", "conv_cfg", ",", "\n", "norm_cfg", "=", "norm_cfg", ",", "\n", "activation", "=", "None", ")", "\n", "\n", "self", ".", "init_weights", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.plugins.non_local.NonLocal2D.init_weights": [[66, 73], ["mmcv.cnn.normal_init", "mmcv.cnn.constant_init", "mmcv.cnn.normal_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.normal_init"], ["", "def", "init_weights", "(", "self", ",", "std", "=", "0.01", ",", "zeros_init", "=", "True", ")", ":", "\n", "        ", "for", "m", "in", "[", "self", ".", "g", ",", "self", ".", "theta", ",", "self", ".", "phi", "]", ":", "\n", "            ", "normal_init", "(", "m", ".", "conv", ",", "std", "=", "std", ")", "\n", "", "if", "zeros_init", ":", "\n", "            ", "constant_init", "(", "self", ".", "conv_out", ".", "conv", ",", "0", ")", "\n", "", "else", ":", "\n", "            ", "normal_init", "(", "self", ".", "conv_out", ".", "conv", ",", "std", "=", "std", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.plugins.non_local.NonLocal2D.embedded_gaussian": [[74, 82], ["torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "pairwise_weight.softmax.softmax.softmax"], "methods", ["None"], ["", "", "def", "embedded_gaussian", "(", "self", ",", "theta_x", ",", "phi_x", ")", ":", "\n", "# pairwise_weight: [N, HxW, HxW]", "\n", "        ", "pairwise_weight", "=", "torch", ".", "matmul", "(", "theta_x", ",", "phi_x", ")", "\n", "if", "self", ".", "use_scale", ":", "\n", "# theta_x.shape[-1] is `self.inter_channels`", "\n", "            ", "pairwise_weight", "/=", "theta_x", ".", "shape", "[", "-", "1", "]", "**", "-", "0.5", "\n", "", "pairwise_weight", "=", "pairwise_weight", ".", "softmax", "(", "dim", "=", "-", "1", ")", "\n", "return", "pairwise_weight", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.plugins.non_local.NonLocal2D.dot_product": [[83, 88], ["torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul"], "methods", ["None"], ["", "def", "dot_product", "(", "self", ",", "theta_x", ",", "phi_x", ")", ":", "\n", "# pairwise_weight: [N, HxW, HxW]", "\n", "        ", "pairwise_weight", "=", "torch", ".", "matmul", "(", "theta_x", ",", "phi_x", ")", "\n", "pairwise_weight", "/=", "pairwise_weight", ".", "shape", "[", "-", "1", "]", "\n", "return", "pairwise_weight", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.plugins.non_local.NonLocal2D.forward": [[89, 115], ["non_local.NonLocal2D.g().view", "g_x.permute.permute.permute", "non_local.NonLocal2D.theta().view", "theta_x.permute.permute.permute", "non_local.NonLocal2D.phi().view", "getattr", "getattr.", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "y.permute().reshape.permute().reshape.permute().reshape", "non_local.NonLocal2D.conv_out", "non_local.NonLocal2D.g", "non_local.NonLocal2D.theta", "non_local.NonLocal2D.phi", "y.permute().reshape.permute().reshape.permute"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "n", ",", "_", ",", "h", ",", "w", "=", "x", ".", "shape", "\n", "\n", "# g_x: [N, HxW, C]", "\n", "g_x", "=", "self", ".", "g", "(", "x", ")", ".", "view", "(", "n", ",", "self", ".", "inter_channels", ",", "-", "1", ")", "\n", "g_x", "=", "g_x", ".", "permute", "(", "0", ",", "2", ",", "1", ")", "\n", "\n", "# theta_x: [N, HxW, C]", "\n", "theta_x", "=", "self", ".", "theta", "(", "x", ")", ".", "view", "(", "n", ",", "self", ".", "inter_channels", ",", "-", "1", ")", "\n", "theta_x", "=", "theta_x", ".", "permute", "(", "0", ",", "2", ",", "1", ")", "\n", "\n", "# phi_x: [N, C, HxW]", "\n", "phi_x", "=", "self", ".", "phi", "(", "x", ")", ".", "view", "(", "n", ",", "self", ".", "inter_channels", ",", "-", "1", ")", "\n", "\n", "pairwise_func", "=", "getattr", "(", "self", ",", "self", ".", "mode", ")", "\n", "# pairwise_weight: [N, HxW, HxW]", "\n", "pairwise_weight", "=", "pairwise_func", "(", "theta_x", ",", "phi_x", ")", "\n", "\n", "# y: [N, HxW, C]", "\n", "y", "=", "torch", ".", "matmul", "(", "pairwise_weight", ",", "g_x", ")", "\n", "# y: [N, C, H, W]", "\n", "y", "=", "y", ".", "permute", "(", "0", ",", "2", ",", "1", ")", ".", "reshape", "(", "n", ",", "self", ".", "inter_channels", ",", "h", ",", "w", ")", "\n", "\n", "output", "=", "x", "+", "self", ".", "conv_out", "(", "y", ")", "\n", "\n", "return", "output", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.plugins.generalized_attention.GeneralizedAttention.__init__": [[34, 152], ["torch.Module.__init__", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Parameter", "torch.Parameter", "torch.Parameter", "generalized_attention.GeneralizedAttention.init_weights", "bool", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Parameter", "torch.Parameter", "torch.Parameter", "torch.Parameter", "torch.Parameter", "torch.Parameter", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "int", "numpy.ones", "range", "torch.Parameter", "torch.Parameter", "torch.Parameter", "torch.AvgPool2d", "torch.AvgPool2d", "torch.AvgPool2d", "torch.AvgPool2d", "torch.AvgPool2d", "torch.AvgPool2d", "int", "math.sqrt", "math.sqrt", "range", "torch.from_numpy().byte", "torch.from_numpy().byte", "torch.from_numpy().byte", "torch.from_numpy().byte", "torch.from_numpy().byte", "torch.from_numpy().byte", "torch.from_numpy().byte", "torch.from_numpy().byte", "torch.from_numpy().byte", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "max", "min", "max", "min"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights"], ["def", "__init__", "(", "self", ",", "\n", "in_dim", ",", "\n", "spatial_range", "=", "-", "1", ",", "\n", "num_heads", "=", "9", ",", "\n", "position_embedding_dim", "=", "-", "1", ",", "\n", "position_magnitude", "=", "1", ",", "\n", "kv_stride", "=", "2", ",", "\n", "q_stride", "=", "1", ",", "\n", "attention_type", "=", "'1111'", ")", ":", "\n", "\n", "        ", "super", "(", "GeneralizedAttention", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "# hard range means local range for non-local operation", "\n", "self", ".", "position_embedding_dim", "=", "(", "\n", "position_embedding_dim", "if", "position_embedding_dim", ">", "0", "else", "in_dim", ")", "\n", "\n", "self", ".", "position_magnitude", "=", "position_magnitude", "\n", "self", ".", "num_heads", "=", "num_heads", "\n", "self", ".", "channel_in", "=", "in_dim", "\n", "self", ".", "spatial_range", "=", "spatial_range", "\n", "self", ".", "kv_stride", "=", "kv_stride", "\n", "self", ".", "q_stride", "=", "q_stride", "\n", "self", ".", "attention_type", "=", "[", "bool", "(", "int", "(", "_", ")", ")", "for", "_", "in", "attention_type", "]", "\n", "self", ".", "qk_embed_dim", "=", "in_dim", "//", "num_heads", "\n", "out_c", "=", "self", ".", "qk_embed_dim", "*", "num_heads", "\n", "\n", "if", "self", ".", "attention_type", "[", "0", "]", "or", "self", ".", "attention_type", "[", "1", "]", ":", "\n", "            ", "self", ".", "query_conv", "=", "nn", ".", "Conv2d", "(", "\n", "in_channels", "=", "in_dim", ",", "\n", "out_channels", "=", "out_c", ",", "\n", "kernel_size", "=", "1", ",", "\n", "bias", "=", "False", ")", "\n", "self", ".", "query_conv", ".", "kaiming_init", "=", "True", "\n", "\n", "", "if", "self", ".", "attention_type", "[", "0", "]", "or", "self", ".", "attention_type", "[", "2", "]", ":", "\n", "            ", "self", ".", "key_conv", "=", "nn", ".", "Conv2d", "(", "\n", "in_channels", "=", "in_dim", ",", "\n", "out_channels", "=", "out_c", ",", "\n", "kernel_size", "=", "1", ",", "\n", "bias", "=", "False", ")", "\n", "self", ".", "key_conv", ".", "kaiming_init", "=", "True", "\n", "\n", "", "self", ".", "v_dim", "=", "in_dim", "//", "num_heads", "\n", "self", ".", "value_conv", "=", "nn", ".", "Conv2d", "(", "\n", "in_channels", "=", "in_dim", ",", "\n", "out_channels", "=", "self", ".", "v_dim", "*", "num_heads", ",", "\n", "kernel_size", "=", "1", ",", "\n", "bias", "=", "False", ")", "\n", "self", ".", "value_conv", ".", "kaiming_init", "=", "True", "\n", "\n", "if", "self", ".", "attention_type", "[", "1", "]", "or", "self", ".", "attention_type", "[", "3", "]", ":", "\n", "            ", "self", ".", "appr_geom_fc_x", "=", "nn", ".", "Linear", "(", "\n", "self", ".", "position_embedding_dim", "//", "2", ",", "out_c", ",", "bias", "=", "False", ")", "\n", "self", ".", "appr_geom_fc_x", ".", "kaiming_init", "=", "True", "\n", "\n", "self", ".", "appr_geom_fc_y", "=", "nn", ".", "Linear", "(", "\n", "self", ".", "position_embedding_dim", "//", "2", ",", "out_c", ",", "bias", "=", "False", ")", "\n", "self", ".", "appr_geom_fc_y", ".", "kaiming_init", "=", "True", "\n", "\n", "", "if", "self", ".", "attention_type", "[", "2", "]", ":", "\n", "            ", "stdv", "=", "1.0", "/", "math", ".", "sqrt", "(", "self", ".", "qk_embed_dim", "*", "2", ")", "\n", "appr_bias_value", "=", "-", "2", "*", "stdv", "*", "torch", ".", "rand", "(", "out_c", ")", "+", "stdv", "\n", "self", ".", "appr_bias", "=", "nn", ".", "Parameter", "(", "appr_bias_value", ")", "\n", "\n", "", "if", "self", ".", "attention_type", "[", "3", "]", ":", "\n", "            ", "stdv", "=", "1.0", "/", "math", ".", "sqrt", "(", "self", ".", "qk_embed_dim", "*", "2", ")", "\n", "geom_bias_value", "=", "-", "2", "*", "stdv", "*", "torch", ".", "rand", "(", "out_c", ")", "+", "stdv", "\n", "self", ".", "geom_bias", "=", "nn", ".", "Parameter", "(", "geom_bias_value", ")", "\n", "\n", "", "self", ".", "proj_conv", "=", "nn", ".", "Conv2d", "(", "\n", "in_channels", "=", "self", ".", "v_dim", "*", "num_heads", ",", "\n", "out_channels", "=", "in_dim", ",", "\n", "kernel_size", "=", "1", ",", "\n", "bias", "=", "True", ")", "\n", "self", ".", "proj_conv", ".", "kaiming_init", "=", "True", "\n", "self", ".", "gamma", "=", "nn", ".", "Parameter", "(", "torch", ".", "zeros", "(", "1", ")", ")", "\n", "\n", "if", "self", ".", "spatial_range", ">=", "0", ":", "\n", "# only works when non local is after 3*3 conv", "\n", "            ", "if", "in_dim", "==", "256", ":", "\n", "                ", "max_len", "=", "84", "\n", "", "elif", "in_dim", "==", "512", ":", "\n", "                ", "max_len", "=", "42", "\n", "\n", "", "max_len_kv", "=", "int", "(", "(", "max_len", "-", "1.0", ")", "/", "self", ".", "kv_stride", "+", "1", ")", "\n", "local_constraint_map", "=", "np", ".", "ones", "(", "\n", "(", "max_len", ",", "max_len", ",", "max_len_kv", ",", "max_len_kv", ")", ",", "dtype", "=", "np", ".", "int", ")", "\n", "for", "iy", "in", "range", "(", "max_len", ")", ":", "\n", "                ", "for", "ix", "in", "range", "(", "max_len", ")", ":", "\n", "                    ", "local_constraint_map", "[", "iy", ",", "ix", ",", "\n", "max", "(", "(", "iy", "-", "self", ".", "spatial_range", ")", "//", "\n", "self", ".", "kv_stride", ",", "0", ")", ":", "min", "(", "\n", "(", "iy", "+", "self", ".", "spatial_range", "+", "\n", "1", ")", "//", "self", ".", "kv_stride", "+", "\n", "1", ",", "max_len", ")", ",", "\n", "max", "(", "(", "ix", "-", "self", ".", "spatial_range", ")", "//", "\n", "self", ".", "kv_stride", ",", "0", ")", ":", "min", "(", "\n", "(", "ix", "+", "self", ".", "spatial_range", "+", "\n", "1", ")", "//", "self", ".", "kv_stride", "+", "\n", "1", ",", "max_len", ")", "]", "=", "0", "\n", "\n", "", "", "self", ".", "local_constraint_map", "=", "nn", ".", "Parameter", "(", "\n", "torch", ".", "from_numpy", "(", "local_constraint_map", ")", ".", "byte", "(", ")", ",", "\n", "requires_grad", "=", "False", ")", "\n", "\n", "", "if", "self", ".", "q_stride", ">", "1", ":", "\n", "            ", "self", ".", "q_downsample", "=", "nn", ".", "AvgPool2d", "(", "\n", "kernel_size", "=", "1", ",", "stride", "=", "self", ".", "q_stride", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "q_downsample", "=", "None", "\n", "\n", "", "if", "self", ".", "kv_stride", ">", "1", ":", "\n", "            ", "self", ".", "kv_downsample", "=", "nn", ".", "AvgPool2d", "(", "\n", "kernel_size", "=", "1", ",", "stride", "=", "self", ".", "kv_stride", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "kv_downsample", "=", "None", "\n", "\n", "", "self", ".", "init_weights", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.plugins.generalized_attention.GeneralizedAttention.get_position_embedding": [[153, 196], ["torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.linspace().cuda", "torch.arange().cuda", "torch.arange().cuda", "torch.arange().cuda", "torch.arange().cuda", "torch.arange().cuda", "torch.arange().cuda", "torch.arange().cuda", "torch.arange().cuda", "torch.arange().cuda", "torch.Tensor().cuda", "torch.Tensor().cuda", "torch.Tensor().cuda", "torch.Tensor().cuda", "torch.Tensor().cuda", "torch.Tensor().cuda", "torch.Tensor().cuda", "torch.Tensor().cuda", "torch.Tensor().cuda", "dim_mat.view.view.view", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.linspace().cuda.view", "torch.linspace().cuda.view", "torch.linspace().cuda.view", "torch.linspace().cuda.view", "torch.linspace().cuda.view", "torch.linspace().cuda.view", "torch.linspace().cuda.view", "torch.linspace().cuda.view", "torch.linspace().cuda.view", "torch.linspace().cuda.view", "torch.linspace().cuda.view", "torch.linspace().cuda.view", "torch.linspace().cuda.unsqueeze", "torch.linspace().cuda.unsqueeze", "torch.linspace().cuda.unsqueeze", "torch.linspace().cuda.unsqueeze", "torch.linspace().cuda.unsqueeze", "torch.linspace().cuda.unsqueeze", "torch.linspace().cuda.unsqueeze", "torch.linspace().cuda.unsqueeze", "torch.linspace().cuda.unsqueeze", "torch.linspace().cuda.unsqueeze", "torch.linspace().cuda.unsqueeze", "torch.linspace().cuda.unsqueeze", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.linspace", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor"], "methods", ["None"], ["", "def", "get_position_embedding", "(", "self", ",", "\n", "h", ",", "\n", "w", ",", "\n", "h_kv", ",", "\n", "w_kv", ",", "\n", "q_stride", ",", "\n", "kv_stride", ",", "\n", "device", ",", "\n", "feat_dim", ",", "\n", "wave_length", "=", "1000", ")", ":", "\n", "        ", "h_idxs", "=", "torch", ".", "linspace", "(", "0", ",", "h", "-", "1", ",", "h", ")", ".", "cuda", "(", "device", ")", "\n", "h_idxs", "=", "h_idxs", ".", "view", "(", "(", "h", ",", "1", ")", ")", "*", "q_stride", "\n", "\n", "w_idxs", "=", "torch", ".", "linspace", "(", "0", ",", "w", "-", "1", ",", "w", ")", ".", "cuda", "(", "device", ")", "\n", "w_idxs", "=", "w_idxs", ".", "view", "(", "(", "w", ",", "1", ")", ")", "*", "q_stride", "\n", "\n", "h_kv_idxs", "=", "torch", ".", "linspace", "(", "0", ",", "h_kv", "-", "1", ",", "h_kv", ")", ".", "cuda", "(", "device", ")", "\n", "h_kv_idxs", "=", "h_kv_idxs", ".", "view", "(", "(", "h_kv", ",", "1", ")", ")", "*", "kv_stride", "\n", "\n", "w_kv_idxs", "=", "torch", ".", "linspace", "(", "0", ",", "w_kv", "-", "1", ",", "w_kv", ")", ".", "cuda", "(", "device", ")", "\n", "w_kv_idxs", "=", "w_kv_idxs", ".", "view", "(", "(", "w_kv", ",", "1", ")", ")", "*", "kv_stride", "\n", "\n", "# (h, h_kv, 1)", "\n", "h_diff", "=", "h_idxs", ".", "unsqueeze", "(", "1", ")", "-", "h_kv_idxs", ".", "unsqueeze", "(", "0", ")", "\n", "h_diff", "*=", "self", ".", "position_magnitude", "\n", "\n", "# (w, w_kv, 1)", "\n", "w_diff", "=", "w_idxs", ".", "unsqueeze", "(", "1", ")", "-", "w_kv_idxs", ".", "unsqueeze", "(", "0", ")", "\n", "w_diff", "*=", "self", ".", "position_magnitude", "\n", "\n", "feat_range", "=", "torch", ".", "arange", "(", "0", ",", "feat_dim", "/", "4", ")", ".", "cuda", "(", "device", ")", "\n", "\n", "dim_mat", "=", "torch", ".", "Tensor", "(", "[", "wave_length", "]", ")", ".", "cuda", "(", "device", ")", "\n", "dim_mat", "=", "dim_mat", "**", "(", "(", "4.", "/", "feat_dim", ")", "*", "feat_range", ")", "\n", "dim_mat", "=", "dim_mat", ".", "view", "(", "(", "1", ",", "1", ",", "-", "1", ")", ")", "\n", "\n", "embedding_x", "=", "torch", ".", "cat", "(", "\n", "(", "(", "w_diff", "/", "dim_mat", ")", ".", "sin", "(", ")", ",", "(", "w_diff", "/", "dim_mat", ")", ".", "cos", "(", ")", ")", ",", "dim", "=", "2", ")", "\n", "\n", "embedding_y", "=", "torch", ".", "cat", "(", "\n", "(", "(", "h_diff", "/", "dim_mat", ")", ".", "sin", "(", ")", ",", "(", "h_diff", "/", "dim_mat", ")", ".", "cos", "(", ")", ")", ",", "dim", "=", "2", ")", "\n", "\n", "return", "embedding_x", ",", "embedding_y", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.plugins.generalized_attention.GeneralizedAttention.forward": [[197, 374], ["torch.softmax", "torch.softmax", "torch.softmax", "generalized_attention.GeneralizedAttention.value_conv", "generalized_attention.GeneralizedAttention.view().permute", "torch.matmul().permute().contiguous().view", "torch.matmul().permute().contiguous().view", "torch.matmul().permute().contiguous().view", "torch.matmul().permute().contiguous().view", "torch.matmul().permute().contiguous().view", "torch.matmul().permute().contiguous().view", "torch.matmul().permute().contiguous().view", "torch.matmul().permute().contiguous().view", "torch.matmul().permute().contiguous().view", "generalized_attention.GeneralizedAttention.proj_conv", "generalized_attention.GeneralizedAttention.q_downsample", "generalized_attention.GeneralizedAttention.kv_downsample", "generalized_attention.GeneralizedAttention.query_conv().view", "proj_query.permute.permute.permute", "generalized_attention.GeneralizedAttention.key_conv().view", "generalized_attention.GeneralizedAttention.get_position_embedding", "generalized_attention.GeneralizedAttention.appr_geom_fc_x().view().permute().repeat", "generalized_attention.GeneralizedAttention.appr_geom_fc_y().view().permute().repeat", "math.sqrt", "math.sqrt", "generalized_attention.GeneralizedAttention.appr_bias.view().repeat", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view.view", "torch.matmul().view.view", "torch.matmul().view.view", "generalized_attention.GeneralizedAttention.local_constraint_map[].contiguous().view", "torch.matmul().view.masked_fill_", "torch.matmul().view.masked_fill_", "torch.matmul().view.masked_fill_", "numpy.sum", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "float", "generalized_attention.GeneralizedAttention.view", "torch.matmul().permute().contiguous", "torch.matmul().permute().contiguous", "torch.matmul().permute().contiguous", "torch.matmul().permute().contiguous", "torch.matmul().permute().contiguous", "torch.matmul().permute().contiguous", "torch.matmul().permute().contiguous", "torch.matmul().permute().contiguous", "torch.matmul().permute().contiguous", "generalized_attention.GeneralizedAttention.query_conv", "generalized_attention.GeneralizedAttention.key_conv", "generalized_attention.GeneralizedAttention.appr_geom_fc_x().view().permute", "generalized_attention.GeneralizedAttention.appr_geom_fc_y().view().permute", "generalized_attention.GeneralizedAttention.appr_bias.view", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "generalized_attention.GeneralizedAttention.appr_bias.view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "generalized_attention.GeneralizedAttention.geom_bias.view", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "energy_x.view.view.permute().unsqueeze", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "energy_y.view.view.unsqueeze", "generalized_attention.GeneralizedAttention.local_constraint_map[].contiguous", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "proj_query_reshape.permute.permute.permute", "generalized_attention.GeneralizedAttention.permute", "generalized_attention.GeneralizedAttention.permute", "proj_query.permute.permute.view", "proj_query_reshape.permute.permute.permute", "generalized_attention.GeneralizedAttention.permute", "generalized_attention.GeneralizedAttention.permute", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "energy_x.view.view.permute().unsqueeze", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "energy_y.view.view.unsqueeze", "torch.matmul().permute", "torch.matmul().permute", "torch.matmul().permute", "torch.matmul().permute", "torch.matmul().permute", "torch.matmul().permute", "torch.matmul().permute", "torch.matmul().permute", "torch.matmul().permute", "generalized_attention.GeneralizedAttention.appr_geom_fc_x().view", "generalized_attention.GeneralizedAttention.appr_geom_fc_y().view", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "generalized_attention.GeneralizedAttention.appr_bias.view().repeat", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "torch.matmul().view", "energy_x.view.view.permute", "generalized_attention.GeneralizedAttention.geom_bias.view().repeat", "generalized_attention.GeneralizedAttention.view", "generalized_attention.GeneralizedAttention.view", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "energy_x.view.view.view", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "energy_y.view.view.view", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "energy_x.view.view.permute", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "generalized_attention.GeneralizedAttention.appr_geom_fc_x", "generalized_attention.GeneralizedAttention.appr_geom_fc_y", "generalized_attention.GeneralizedAttention.appr_bias.view", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "generalized_attention.GeneralizedAttention.geom_bias.view"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.plugins.generalized_attention.GeneralizedAttention.get_position_embedding"], ["", "def", "forward", "(", "self", ",", "x_input", ")", ":", "\n", "        ", "num_heads", "=", "self", ".", "num_heads", "\n", "\n", "# use empirical_attention", "\n", "if", "self", ".", "q_downsample", "is", "not", "None", ":", "\n", "            ", "x_q", "=", "self", ".", "q_downsample", "(", "x_input", ")", "\n", "", "else", ":", "\n", "            ", "x_q", "=", "x_input", "\n", "", "n", ",", "_", ",", "h", ",", "w", "=", "x_q", ".", "shape", "\n", "\n", "if", "self", ".", "kv_downsample", "is", "not", "None", ":", "\n", "            ", "x_kv", "=", "self", ".", "kv_downsample", "(", "x_input", ")", "\n", "", "else", ":", "\n", "            ", "x_kv", "=", "x_input", "\n", "", "_", ",", "_", ",", "h_kv", ",", "w_kv", "=", "x_kv", ".", "shape", "\n", "\n", "if", "self", ".", "attention_type", "[", "0", "]", "or", "self", ".", "attention_type", "[", "1", "]", ":", "\n", "            ", "proj_query", "=", "self", ".", "query_conv", "(", "x_q", ")", ".", "view", "(", "\n", "(", "n", ",", "num_heads", ",", "self", ".", "qk_embed_dim", ",", "h", "*", "w", ")", ")", "\n", "proj_query", "=", "proj_query", ".", "permute", "(", "0", ",", "1", ",", "3", ",", "2", ")", "\n", "\n", "", "if", "self", ".", "attention_type", "[", "0", "]", "or", "self", ".", "attention_type", "[", "2", "]", ":", "\n", "            ", "proj_key", "=", "self", ".", "key_conv", "(", "x_kv", ")", ".", "view", "(", "\n", "(", "n", ",", "num_heads", ",", "self", ".", "qk_embed_dim", ",", "h_kv", "*", "w_kv", ")", ")", "\n", "\n", "", "if", "self", ".", "attention_type", "[", "1", "]", "or", "self", ".", "attention_type", "[", "3", "]", ":", "\n", "            ", "position_embed_x", ",", "position_embed_y", "=", "self", ".", "get_position_embedding", "(", "\n", "h", ",", "w", ",", "h_kv", ",", "w_kv", ",", "self", ".", "q_stride", ",", "self", ".", "kv_stride", ",", "\n", "x_input", ".", "device", ",", "self", ".", "position_embedding_dim", ")", "\n", "# (n, num_heads, w, w_kv, dim)", "\n", "position_feat_x", "=", "self", ".", "appr_geom_fc_x", "(", "position_embed_x", ")", ".", "view", "(", "1", ",", "w", ",", "w_kv", ",", "num_heads", ",", "self", ".", "qk_embed_dim", ")", ".", "permute", "(", "0", ",", "3", ",", "1", ",", "2", ",", "4", ")", ".", "repeat", "(", "n", ",", "1", ",", "1", ",", "1", ",", "1", ")", "\n", "\n", "# (n, num_heads, h, h_kv, dim)", "\n", "position_feat_y", "=", "self", ".", "appr_geom_fc_y", "(", "position_embed_y", ")", ".", "view", "(", "1", ",", "h", ",", "h_kv", ",", "num_heads", ",", "self", ".", "qk_embed_dim", ")", ".", "permute", "(", "0", ",", "3", ",", "1", ",", "2", ",", "4", ")", ".", "repeat", "(", "n", ",", "1", ",", "1", ",", "1", ",", "1", ")", "\n", "\n", "position_feat_x", "/=", "math", ".", "sqrt", "(", "2", ")", "\n", "position_feat_y", "/=", "math", ".", "sqrt", "(", "2", ")", "\n", "\n", "# accelerate for saliency only", "\n", "", "if", "(", "np", ".", "sum", "(", "self", ".", "attention_type", ")", "==", "1", ")", "and", "self", ".", "attention_type", "[", "2", "]", ":", "\n", "            ", "appr_bias", "=", "self", ".", "appr_bias", ".", "view", "(", "1", ",", "num_heads", ",", "1", ",", "self", ".", "qk_embed_dim", ")", ".", "repeat", "(", "n", ",", "1", ",", "1", ",", "1", ")", "\n", "\n", "energy", "=", "torch", ".", "matmul", "(", "appr_bias", ",", "proj_key", ")", ".", "view", "(", "n", ",", "num_heads", ",", "1", ",", "h_kv", "*", "w_kv", ")", "\n", "\n", "h", "=", "1", "\n", "w", "=", "1", "\n", "", "else", ":", "\n", "# (n, num_heads, h*w, h_kv*w_kv), query before key, 540mb for", "\n", "            ", "if", "not", "self", ".", "attention_type", "[", "0", "]", ":", "\n", "                ", "energy", "=", "torch", ".", "zeros", "(", "\n", "n", ",", "\n", "num_heads", ",", "\n", "h", ",", "\n", "w", ",", "\n", "h_kv", ",", "\n", "w_kv", ",", "\n", "dtype", "=", "x_input", ".", "dtype", ",", "\n", "device", "=", "x_input", ".", "device", ")", "\n", "\n", "# attention_type[0]: appr - appr", "\n", "# attention_type[1]: appr - position", "\n", "# attention_type[2]: bias - appr", "\n", "# attention_type[3]: bias - position", "\n", "", "if", "self", ".", "attention_type", "[", "0", "]", "or", "self", ".", "attention_type", "[", "2", "]", ":", "\n", "                ", "if", "self", ".", "attention_type", "[", "0", "]", "and", "self", ".", "attention_type", "[", "2", "]", ":", "\n", "                    ", "appr_bias", "=", "self", ".", "appr_bias", ".", "view", "(", "1", ",", "num_heads", ",", "1", ",", "self", ".", "qk_embed_dim", ")", "\n", "energy", "=", "torch", ".", "matmul", "(", "proj_query", "+", "appr_bias", ",", "proj_key", ")", ".", "view", "(", "n", ",", "num_heads", ",", "h", ",", "w", ",", "h_kv", ",", "w_kv", ")", "\n", "\n", "", "elif", "self", ".", "attention_type", "[", "0", "]", ":", "\n", "                    ", "energy", "=", "torch", ".", "matmul", "(", "proj_query", ",", "proj_key", ")", ".", "view", "(", "n", ",", "num_heads", ",", "h", ",", "w", ",", "h_kv", ",", "w_kv", ")", "\n", "\n", "", "elif", "self", ".", "attention_type", "[", "2", "]", ":", "\n", "                    ", "appr_bias", "=", "self", ".", "appr_bias", ".", "view", "(", "1", ",", "num_heads", ",", "1", ",", "self", ".", "qk_embed_dim", ")", ".", "repeat", "(", "n", ",", "1", ",", "1", ",", "1", ")", "\n", "\n", "energy", "+=", "torch", ".", "matmul", "(", "appr_bias", ",", "proj_key", ")", ".", "view", "(", "n", ",", "num_heads", ",", "1", ",", "1", ",", "h_kv", ",", "w_kv", ")", "\n", "\n", "", "", "if", "self", ".", "attention_type", "[", "1", "]", "or", "self", ".", "attention_type", "[", "3", "]", ":", "\n", "                ", "if", "self", ".", "attention_type", "[", "1", "]", "and", "self", ".", "attention_type", "[", "3", "]", ":", "\n", "                    ", "geom_bias", "=", "self", ".", "geom_bias", ".", "view", "(", "1", ",", "num_heads", ",", "1", ",", "self", ".", "qk_embed_dim", ")", "\n", "\n", "proj_query_reshape", "=", "(", "proj_query", "+", "geom_bias", ")", ".", "view", "(", "n", ",", "num_heads", ",", "h", ",", "w", ",", "self", ".", "qk_embed_dim", ")", "\n", "\n", "energy_x", "=", "torch", ".", "matmul", "(", "\n", "proj_query_reshape", ".", "permute", "(", "0", ",", "1", ",", "3", ",", "2", ",", "4", ")", ",", "\n", "position_feat_x", ".", "permute", "(", "0", ",", "1", ",", "2", ",", "4", ",", "3", ")", ")", "\n", "energy_x", "=", "energy_x", ".", "permute", "(", "0", ",", "1", ",", "3", ",", "2", ",", "4", ")", ".", "unsqueeze", "(", "4", ")", "\n", "\n", "energy_y", "=", "torch", ".", "matmul", "(", "\n", "proj_query_reshape", ",", "\n", "position_feat_y", ".", "permute", "(", "0", ",", "1", ",", "2", ",", "4", ",", "3", ")", ")", "\n", "energy_y", "=", "energy_y", ".", "unsqueeze", "(", "5", ")", "\n", "\n", "energy", "+=", "energy_x", "+", "energy_y", "\n", "\n", "", "elif", "self", ".", "attention_type", "[", "1", "]", ":", "\n", "                    ", "proj_query_reshape", "=", "proj_query", ".", "view", "(", "n", ",", "num_heads", ",", "h", ",", "w", ",", "self", ".", "qk_embed_dim", ")", "\n", "proj_query_reshape", "=", "proj_query_reshape", ".", "permute", "(", "0", ",", "1", ",", "3", ",", "2", ",", "4", ")", "\n", "position_feat_x_reshape", "=", "position_feat_x", ".", "permute", "(", "0", ",", "1", ",", "2", ",", "4", ",", "3", ")", "\n", "position_feat_y_reshape", "=", "position_feat_y", ".", "permute", "(", "0", ",", "1", ",", "2", ",", "4", ",", "3", ")", "\n", "\n", "energy_x", "=", "torch", ".", "matmul", "(", "proj_query_reshape", ",", "\n", "position_feat_x_reshape", ")", "\n", "energy_x", "=", "energy_x", ".", "permute", "(", "0", ",", "1", ",", "3", ",", "2", ",", "4", ")", ".", "unsqueeze", "(", "4", ")", "\n", "\n", "energy_y", "=", "torch", ".", "matmul", "(", "proj_query_reshape", ",", "\n", "position_feat_y_reshape", ")", "\n", "energy_y", "=", "energy_y", ".", "unsqueeze", "(", "5", ")", "\n", "\n", "energy", "+=", "energy_x", "+", "energy_y", "\n", "\n", "", "elif", "self", ".", "attention_type", "[", "3", "]", ":", "\n", "                    ", "geom_bias", "=", "self", ".", "geom_bias", ".", "view", "(", "1", ",", "num_heads", ",", "self", ".", "qk_embed_dim", ",", "1", ")", ".", "repeat", "(", "n", ",", "1", ",", "1", ",", "1", ")", "\n", "\n", "position_feat_x_reshape", "=", "position_feat_x", ".", "view", "(", "n", ",", "num_heads", ",", "w", "*", "w_kv", ",", "self", ".", "qk_embed_dim", ")", "\n", "\n", "position_feat_y_reshape", "=", "position_feat_y", ".", "view", "(", "n", ",", "num_heads", ",", "h", "*", "h_kv", ",", "self", ".", "qk_embed_dim", ")", "\n", "\n", "energy_x", "=", "torch", ".", "matmul", "(", "position_feat_x_reshape", ",", "geom_bias", ")", "\n", "energy_x", "=", "energy_x", ".", "view", "(", "n", ",", "num_heads", ",", "1", ",", "w", ",", "1", ",", "w_kv", ")", "\n", "\n", "energy_y", "=", "torch", ".", "matmul", "(", "position_feat_y_reshape", ",", "geom_bias", ")", "\n", "energy_y", "=", "energy_y", ".", "view", "(", "n", ",", "num_heads", ",", "h", ",", "1", ",", "h_kv", ",", "1", ")", "\n", "\n", "energy", "+=", "energy_x", "+", "energy_y", "\n", "\n", "", "", "energy", "=", "energy", ".", "view", "(", "n", ",", "num_heads", ",", "h", "*", "w", ",", "h_kv", "*", "w_kv", ")", "\n", "\n", "", "if", "self", ".", "spatial_range", ">=", "0", ":", "\n", "            ", "cur_local_constraint_map", "=", "self", ".", "local_constraint_map", "[", ":", "h", ",", ":", "w", ",", ":", "h_kv", ",", ":", "w_kv", "]", ".", "contiguous", "(", ")", ".", "view", "(", "1", ",", "1", ",", "h", "*", "w", ",", "h_kv", "*", "w_kv", ")", "\n", "\n", "energy", "=", "energy", ".", "masked_fill_", "(", "cur_local_constraint_map", ",", "\n", "float", "(", "'-inf'", ")", ")", "\n", "\n", "", "attention", "=", "F", ".", "softmax", "(", "energy", ",", "3", ")", "\n", "\n", "proj_value", "=", "self", ".", "value_conv", "(", "x_kv", ")", "\n", "proj_value_reshape", "=", "proj_value", ".", "view", "(", "(", "n", ",", "num_heads", ",", "self", ".", "v_dim", ",", "h_kv", "*", "w_kv", ")", ")", ".", "permute", "(", "0", ",", "1", ",", "3", ",", "2", ")", "\n", "\n", "out", "=", "torch", ".", "matmul", "(", "attention", ",", "proj_value_reshape", ")", ".", "permute", "(", "0", ",", "1", ",", "3", ",", "2", ")", ".", "contiguous", "(", ")", ".", "view", "(", "n", ",", "self", ".", "v_dim", "*", "self", ".", "num_heads", ",", "h", ",", "w", ")", "\n", "\n", "out", "=", "self", ".", "proj_conv", "(", "out", ")", "\n", "out", "=", "self", ".", "gamma", "*", "out", "+", "x_input", "\n", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.plugins.generalized_attention.GeneralizedAttention.init_weights": [[375, 385], ["generalized_attention.GeneralizedAttention.modules", "hasattr", "mmcv.cnn.kaiming_init"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.weight_init.kaiming_init"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "for", "m", "in", "self", ".", "modules", "(", ")", ":", "\n", "            ", "if", "hasattr", "(", "m", ",", "'kaiming_init'", ")", "and", "m", ".", "kaiming_init", ":", "\n", "                ", "kaiming_init", "(", "\n", "m", ",", "\n", "mode", "=", "'fan_in'", ",", "\n", "nonlinearity", "=", "'leaky_relu'", ",", "\n", "bias", "=", "0", ",", "\n", "distribution", "=", "'uniform'", ",", "\n", "a", "=", "1", ")", "\n", "", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.convfc_bbox_head.ConvFCBBoxHead.__init__": [[18, 90], ["bbox_head.BBoxHead.__init__", "convfc_bbox_head.ConvFCBBoxHead._add_conv_fc_branch", "convfc_bbox_head.ConvFCBBoxHead._add_conv_fc_branch", "convfc_bbox_head.ConvFCBBoxHead._add_conv_fc_branch", "torch.ReLU", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.convfc_bbox_head.ConvFCBBoxHead._add_conv_fc_branch", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.convfc_bbox_head.ConvFCBBoxHead._add_conv_fc_branch", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.convfc_bbox_head.ConvFCBBoxHead._add_conv_fc_branch"], ["def", "__init__", "(", "self", ",", "\n", "num_shared_convs", "=", "0", ",", "\n", "num_shared_fcs", "=", "0", ",", "\n", "num_cls_convs", "=", "0", ",", "\n", "num_cls_fcs", "=", "0", ",", "\n", "num_reg_convs", "=", "0", ",", "\n", "num_reg_fcs", "=", "0", ",", "\n", "conv_out_channels", "=", "256", ",", "\n", "fc_out_channels", "=", "1024", ",", "\n", "conv_cfg", "=", "None", ",", "\n", "norm_cfg", "=", "None", ",", "\n", "with_avg_pool_shared", "=", "False", ",", "\n", "with_avg_pool_cls", "=", "False", ",", "\n", "with_avg_pool_reg", "=", "False", ",", "\n", "*", "args", ",", "\n", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "ConvFCBBoxHead", ",", "self", ")", ".", "__init__", "(", "*", "args", ",", "**", "kwargs", ")", "\n", "assert", "(", "num_shared_convs", "+", "num_shared_fcs", "+", "num_cls_convs", "+", "\n", "num_cls_fcs", "+", "num_reg_convs", "+", "num_reg_fcs", ">", "0", ")", "\n", "if", "num_cls_convs", ">", "0", "or", "num_reg_convs", ">", "0", ":", "\n", "            ", "assert", "num_shared_fcs", "==", "0", "\n", "", "if", "not", "self", ".", "with_cls", ":", "\n", "            ", "assert", "num_cls_convs", "==", "0", "and", "num_cls_fcs", "==", "0", "\n", "", "if", "not", "self", ".", "with_reg", ":", "\n", "            ", "assert", "num_reg_convs", "==", "0", "and", "num_reg_fcs", "==", "0", "\n", "", "self", ".", "num_shared_convs", "=", "num_shared_convs", "\n", "self", ".", "num_shared_fcs", "=", "num_shared_fcs", "\n", "self", ".", "num_cls_convs", "=", "num_cls_convs", "\n", "self", ".", "num_cls_fcs", "=", "num_cls_fcs", "\n", "self", ".", "num_reg_convs", "=", "num_reg_convs", "\n", "self", ".", "num_reg_fcs", "=", "num_reg_fcs", "\n", "self", ".", "conv_out_channels", "=", "conv_out_channels", "\n", "self", ".", "fc_out_channels", "=", "fc_out_channels", "\n", "self", ".", "conv_cfg", "=", "conv_cfg", "\n", "self", ".", "norm_cfg", "=", "norm_cfg", "\n", "\n", "# added by WSK", "\n", "self", ".", "with_avg_pool_shared", "=", "with_avg_pool_shared", "\n", "self", ".", "with_avg_pool_cls", "=", "with_avg_pool_cls", "\n", "self", ".", "with_avg_pool_reg", "=", "with_avg_pool_reg", "\n", "\n", "# add shared convs and fcs", "\n", "self", ".", "shared_convs", ",", "self", ".", "shared_fcs", ",", "last_layer_dim", "=", "self", ".", "_add_conv_fc_branch", "(", "\n", "self", ".", "num_shared_convs", ",", "self", ".", "num_shared_fcs", ",", "self", ".", "in_channels", ",", "\n", "True", ")", "\n", "self", ".", "shared_out_channels", "=", "last_layer_dim", "\n", "\n", "# add cls specific branch", "\n", "self", ".", "cls_convs", ",", "self", ".", "cls_fcs", ",", "self", ".", "cls_last_dim", "=", "self", ".", "_add_conv_fc_branch", "(", "\n", "self", ".", "num_cls_convs", ",", "self", ".", "num_cls_fcs", ",", "self", ".", "shared_out_channels", ")", "\n", "\n", "# add reg specific branch", "\n", "self", ".", "reg_convs", ",", "self", ".", "reg_fcs", ",", "self", ".", "reg_last_dim", "=", "self", ".", "_add_conv_fc_branch", "(", "\n", "self", ".", "num_reg_convs", ",", "self", ".", "num_reg_fcs", ",", "self", ".", "shared_out_channels", ")", "\n", "\n", "if", "self", ".", "num_shared_fcs", "==", "0", "and", "not", "self", ".", "with_avg_pool", ":", "\n", "            ", "if", "self", ".", "num_cls_fcs", "==", "0", ":", "\n", "                ", "self", ".", "cls_last_dim", "*=", "(", "self", ".", "roi_feat_size", "*", "self", ".", "roi_feat_size", ")", "\n", "", "", "if", "self", ".", "num_shared_fcs", "==", "0", "and", "not", "self", ".", "with_avg_pool_reg", ":", "\n", "            ", "if", "self", ".", "num_reg_fcs", "==", "0", ":", "\n", "                ", "self", ".", "reg_last_dim", "*=", "(", "self", ".", "roi_feat_size", "*", "self", ".", "roi_feat_size", ")", "\n", "\n", "", "", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "# reconstruct fc_cls and fc_reg since input channels are changed", "\n", "if", "self", ".", "with_cls", ":", "\n", "            ", "self", ".", "fc_cls", "=", "nn", ".", "Linear", "(", "self", ".", "cls_last_dim", ",", "self", ".", "num_classes", ")", "\n", "", "if", "self", ".", "with_reg", ":", "\n", "            ", "out_dim_reg", "=", "4", "if", "self", ".", "reg_class_agnostic", "else", "4", "*", "self", ".", "num_classes", "\n", "self", ".", "fc_reg", "=", "nn", ".", "Linear", "(", "self", ".", "reg_last_dim", ",", "out_dim_reg", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.convfc_bbox_head.ConvFCBBoxHead._add_conv_fc_branch": [[91, 131], ["torch.ModuleList", "torch.ModuleList", "range", "range", "torch.ModuleList.append", "torch.ModuleList.append", "utils.ConvModule", "torch.Linear"], "methods", ["None"], ["", "", "def", "_add_conv_fc_branch", "(", "self", ",", "\n", "num_branch_convs", ",", "\n", "num_branch_fcs", ",", "\n", "in_channels", ",", "\n", "is_shared", "=", "False", ")", ":", "\n", "        ", "\"\"\"Add shared or separable branch\n\n        convs -> avg pool (optional) -> fcs\n        \"\"\"", "\n", "last_layer_dim", "=", "in_channels", "\n", "# add branch specific conv layers", "\n", "branch_convs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "if", "num_branch_convs", ">", "0", ":", "\n", "            ", "for", "i", "in", "range", "(", "num_branch_convs", ")", ":", "\n", "                ", "conv_in_channels", "=", "(", "\n", "last_layer_dim", "if", "i", "==", "0", "else", "self", ".", "conv_out_channels", ")", "\n", "branch_convs", ".", "append", "(", "\n", "ConvModule", "(", "\n", "conv_in_channels", ",", "\n", "self", ".", "conv_out_channels", ",", "\n", "3", ",", "\n", "padding", "=", "1", ",", "\n", "conv_cfg", "=", "self", ".", "conv_cfg", ",", "\n", "norm_cfg", "=", "self", ".", "norm_cfg", ")", ")", "\n", "", "last_layer_dim", "=", "self", ".", "conv_out_channels", "\n", "# add branch specific fc layers", "\n", "", "branch_fcs", "=", "nn", ".", "ModuleList", "(", ")", "\n", "if", "num_branch_fcs", ">", "0", ":", "\n", "# for shared branch, only consider self.with_avg_pool", "\n", "# for separated branches, also consider self.num_shared_fcs", "\n", "            ", "if", "(", "is_shared", "\n", "or", "self", ".", "num_shared_fcs", "==", "0", ")", "and", "not", "self", ".", "with_avg_pool", ":", "\n", "                ", "last_layer_dim", "*=", "(", "self", ".", "roi_feat_size", "*", "self", ".", "roi_feat_size", ")", "\n", "", "for", "i", "in", "range", "(", "num_branch_fcs", ")", ":", "\n", "                ", "fc_in_channels", "=", "(", "\n", "last_layer_dim", "if", "i", "==", "0", "else", "self", ".", "fc_out_channels", ")", "\n", "branch_fcs", ".", "append", "(", "\n", "nn", ".", "Linear", "(", "fc_in_channels", ",", "self", ".", "fc_out_channels", ")", ")", "\n", "", "last_layer_dim", "=", "self", ".", "fc_out_channels", "\n", "", "return", "branch_convs", ",", "branch_fcs", ",", "last_layer_dim", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.convfc_bbox_head.ConvFCBBoxHead.init_weights": [[132, 139], ["super().init_weights", "module_list.modules", "isinstance", "torch.init.xavier_uniform_", "torch.init.constant_"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "super", "(", "ConvFCBBoxHead", ",", "self", ")", ".", "init_weights", "(", ")", "\n", "for", "module_list", "in", "[", "self", ".", "shared_fcs", ",", "self", ".", "cls_fcs", ",", "self", ".", "reg_fcs", "]", ":", "\n", "            ", "for", "m", "in", "module_list", ".", "modules", "(", ")", ":", "\n", "                ", "if", "isinstance", "(", "m", ",", "nn", ".", "Linear", ")", ":", "\n", "                    ", "nn", ".", "init", ".", "xavier_uniform_", "(", "m", ".", "weight", ")", "\n", "nn", ".", "init", ".", "constant_", "(", "m", ".", "bias", ",", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.convfc_bbox_head.ConvFCBBoxHead.forward": [[140, 177], ["convfc_bbox_head.ConvFCBBoxHead.view", "conv", "convfc_bbox_head.ConvFCBBoxHead.dim", "convfc_bbox_head.ConvFCBBoxHead.view", "convfc_bbox_head.ConvFCBBoxHead.relu", "conv", "convfc_bbox_head.ConvFCBBoxHead.dim", "convfc_bbox_head.ConvFCBBoxHead.view", "convfc_bbox_head.ConvFCBBoxHead.relu", "convfc_bbox_head.ConvFCBBoxHead.fc_cls", "convfc_bbox_head.ConvFCBBoxHead.fc_reg", "conv", "convfc_bbox_head.ConvFCBBoxHead.avg_pool", "convfc_bbox_head.ConvFCBBoxHead.size", "convfc_bbox_head.ConvFCBBoxHead.relu", "convfc_bbox_head.ConvFCBBoxHead.avg_pool", "convfc_bbox_head.ConvFCBBoxHead.size", "fc", "convfc_bbox_head.ConvFCBBoxHead.avg_pool", "convfc_bbox_head.ConvFCBBoxHead.size", "fc", "fc"], "methods", ["None"], ["", "", "", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "# shared part", "\n", "        ", "if", "self", ".", "num_shared_convs", ">", "0", ":", "\n", "            ", "for", "conv", "in", "self", ".", "shared_convs", ":", "\n", "                ", "x", "=", "conv", "(", "x", ")", "\n", "\n", "", "", "if", "self", ".", "num_shared_fcs", ">", "0", ":", "\n", "            ", "if", "self", ".", "with_avg_pool", ":", "\n", "                ", "x", "=", "self", ".", "avg_pool", "(", "x", ")", "\n", "", "x", "=", "x", ".", "view", "(", "x", ".", "size", "(", "0", ")", ",", "-", "1", ")", "\n", "for", "fc", "in", "self", ".", "shared_fcs", ":", "\n", "                ", "x", "=", "self", ".", "relu", "(", "fc", "(", "x", ")", ")", "\n", "# separate branches", "\n", "", "", "x_cls", "=", "x", "\n", "x_reg", "=", "x", "\n", "\n", "for", "conv", "in", "self", ".", "cls_convs", ":", "\n", "            ", "x_cls", "=", "conv", "(", "x_cls", ")", "\n", "", "if", "x_cls", ".", "dim", "(", ")", ">", "2", ":", "\n", "            ", "if", "self", ".", "with_avg_pool", ":", "\n", "                ", "x_cls", "=", "self", ".", "avg_pool", "(", "x_cls", ")", "\n", "", "x_cls", "=", "x_cls", ".", "view", "(", "x_cls", ".", "size", "(", "0", ")", ",", "-", "1", ")", "\n", "", "for", "fc", "in", "self", ".", "cls_fcs", ":", "\n", "            ", "x_cls", "=", "self", ".", "relu", "(", "fc", "(", "x_cls", ")", ")", "\n", "\n", "", "for", "conv", "in", "self", ".", "reg_convs", ":", "\n", "            ", "x_reg", "=", "conv", "(", "x_reg", ")", "\n", "", "if", "x_reg", ".", "dim", "(", ")", ">", "2", ":", "\n", "            ", "if", "self", ".", "with_avg_pool_reg", ":", "\n", "                ", "x_reg", "=", "self", ".", "avg_pool", "(", "x_reg", ")", "\n", "", "x_reg", "=", "x_reg", ".", "view", "(", "x_reg", ".", "size", "(", "0", ")", ",", "-", "1", ")", "\n", "", "for", "fc", "in", "self", ".", "reg_fcs", ":", "\n", "            ", "x_reg", "=", "self", ".", "relu", "(", "fc", "(", "x_reg", ")", ")", "\n", "\n", "", "cls_score", "=", "self", ".", "fc_cls", "(", "x_cls", ")", "if", "self", ".", "with_cls", "else", "None", "\n", "bbox_pred", "=", "self", ".", "fc_reg", "(", "x_reg", ")", "if", "self", ".", "with_reg", "else", "None", "\n", "return", "cls_score", ",", "bbox_pred", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.convfc_bbox_head.SharedFCBBoxHead.__init__": [[182, 194], ["convfc_bbox_head.ConvFCBBoxHead.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "num_fcs", "=", "2", ",", "fc_out_channels", "=", "1024", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "assert", "num_fcs", ">=", "1", "\n", "super", "(", "SharedFCBBoxHead", ",", "self", ")", ".", "__init__", "(", "\n", "num_shared_convs", "=", "0", ",", "\n", "num_shared_fcs", "=", "num_fcs", ",", "\n", "num_cls_convs", "=", "0", ",", "\n", "num_cls_fcs", "=", "0", ",", "\n", "num_reg_convs", "=", "0", ",", "\n", "num_reg_fcs", "=", "0", ",", "\n", "fc_out_channels", "=", "fc_out_channels", ",", "\n", "*", "args", ",", "\n", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.convfc_bbox_head.SeperableBranchBBoxHead.__init__": [[197, 211], ["convfc_bbox_head.ConvFCBBoxHead.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "num_cls_fc", "=", "2", ",", "num_reg_convs", "=", "2", ",", "conv_out_channels", "=", "256", ",", "fc_out_channels", "=", "1024", ",", "with_avg_pool_reg", "=", "True", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "assert", "num_cls_fc", ">=", "1", "and", "num_reg_convs", ">=", "1", "\n", "super", "(", "SeperableBranchBBoxHead", ",", "self", ")", ".", "__init__", "(", "\n", "num_shared_convs", "=", "0", ",", "\n", "num_shared_fcs", "=", "0", ",", "\n", "num_cls_convs", "=", "0", ",", "\n", "num_cls_fcs", "=", "num_cls_fc", ",", "\n", "num_reg_convs", "=", "num_reg_convs", ",", "\n", "num_reg_fcs", "=", "0", ",", "\n", "conv_out_channels", "=", "conv_out_channels", ",", "\n", "fc_out_channels", "=", "fc_out_channels", ",", "\n", "with_avg_pool_reg", "=", "with_avg_pool_reg", "\n", "*", "args", ",", "\n", "**", "kwargs", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.__init__": [[18, 70], ["dict", "dict", "torch.Module.__init__", "builder.build_loss", "builder.build_loss", "torch.AvgPool2d", "torch.AvgPool2d", "torch.AvgPool2d", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_loss"], ["def", "__init__", "(", "self", ",", "\n", "with_avg_pool", "=", "False", ",", "\n", "with_cls", "=", "True", ",", "\n", "with_reg", "=", "True", ",", "\n", "roi_feat_size", "=", "7", ",", "\n", "in_channels", "=", "256", ",", "\n", "num_classes", "=", "81", ",", "\n", "target_means", "=", "[", "0.", ",", "0.", ",", "0.", ",", "0.", "]", ",", "\n", "target_stds", "=", "[", "0.1", ",", "0.1", ",", "0.2", ",", "0.2", "]", ",", "\n", "reg_class_agnostic", "=", "False", ",", "\n", "loss_cls", "=", "dict", "(", "\n", "type", "=", "'CrossEntropyLoss'", ",", "\n", "use_sigmoid", "=", "False", ",", "\n", "loss_weight", "=", "1.0", ")", ",", "\n", "loss_bbox", "=", "dict", "(", "\n", "type", "=", "'SmoothL1Loss'", ",", "beta", "=", "1.0", ",", "loss_weight", "=", "1.0", ")", ")", ":", "\n", "        ", "super", "(", "BBoxHead", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "with_cls", "or", "with_reg", "\n", "self", ".", "with_avg_pool", "=", "with_avg_pool", "\n", "self", ".", "with_cls", "=", "with_cls", "\n", "self", ".", "with_reg", "=", "with_reg", "\n", "self", ".", "roi_feat_size", "=", "roi_feat_size", "\n", "self", ".", "in_channels", "=", "in_channels", "\n", "self", ".", "num_classes", "=", "num_classes", "\n", "self", ".", "target_means", "=", "target_means", "\n", "self", ".", "target_stds", "=", "target_stds", "\n", "self", ".", "reg_class_agnostic", "=", "reg_class_agnostic", "\n", "\n", "# added by WSK", "\n", "self", ".", "use_iou_prediction", "=", "False", "\n", "self", ".", "use_class_agnostic_iou", "=", "True", "\n", "\n", "self", ".", "loss_cls", "=", "build_loss", "(", "loss_cls", ")", "\n", "self", ".", "loss_bbox", "=", "build_loss", "(", "loss_bbox", ")", "\n", "\n", "in_channels", "=", "self", ".", "in_channels", "\n", "if", "self", ".", "with_avg_pool", ":", "\n", "            ", "self", ".", "avg_pool", "=", "nn", ".", "AvgPool2d", "(", "roi_feat_size", ")", "\n", "", "else", ":", "\n", "            ", "in_channels", "*=", "(", "self", ".", "roi_feat_size", "*", "self", ".", "roi_feat_size", ")", "\n", "", "if", "self", ".", "with_cls", ":", "\n", "            ", "self", ".", "fc_cls", "=", "nn", ".", "Linear", "(", "in_channels", ",", "num_classes", ")", "\n", "", "if", "self", ".", "with_reg", ":", "\n", "            ", "out_dim_reg", "=", "4", "if", "reg_class_agnostic", "else", "4", "*", "num_classes", "\n", "# print(\"test: bbox_head\")", "\n", "\n", "self", ".", "fc_reg", "=", "nn", ".", "Linear", "(", "in_channels", ",", "out_dim_reg", ")", "\n", "", "self", ".", "debug_imgs", "=", "None", "\n", "\n", "# added by Shengkai Wu", "\n", "self", ".", "IoU_balanced_Cls", "=", "loss_cls", "[", "'type'", "]", "in", "[", "'IOUbalancedCrossEntropyLoss'", ",", "'IOUbalancedSigmoidFocalLoss'", "]", "\n", "self", ".", "IoU_balanced_Loc", "=", "loss_bbox", "[", "'type'", "]", "in", "[", "'IoUbalancedSmoothL1Loss'", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.init_weights": [[71, 78], ["torch.init.normal_", "torch.init.normal_", "torch.init.normal_", "torch.init.constant_", "torch.init.constant_", "torch.init.constant_", "torch.init.normal_", "torch.init.normal_", "torch.init.normal_", "torch.init.constant_", "torch.init.constant_", "torch.init.constant_"], "methods", ["None"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "with_cls", ":", "\n", "            ", "nn", ".", "init", ".", "normal_", "(", "self", ".", "fc_cls", ".", "weight", ",", "0", ",", "0.01", ")", "\n", "nn", ".", "init", ".", "constant_", "(", "self", ".", "fc_cls", ".", "bias", ",", "0", ")", "\n", "", "if", "self", ".", "with_reg", ":", "\n", "            ", "nn", ".", "init", ".", "normal_", "(", "self", ".", "fc_reg", ".", "weight", ",", "0", ",", "0.001", ")", "\n", "nn", ".", "init", ".", "constant_", "(", "self", ".", "fc_reg", ".", "bias", ",", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.forward": [[79, 86], ["bbox_head.BBoxHead.view", "bbox_head.BBoxHead.avg_pool", "bbox_head.BBoxHead.size", "bbox_head.BBoxHead.fc_cls", "bbox_head.BBoxHead.fc_reg"], "methods", ["None"], ["", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "if", "self", ".", "with_avg_pool", ":", "\n", "            ", "x", "=", "self", ".", "avg_pool", "(", "x", ")", "\n", "", "x", "=", "x", ".", "view", "(", "x", ".", "size", "(", "0", ")", ",", "-", "1", ")", "\n", "cls_score", "=", "self", ".", "fc_cls", "(", "x", ")", "if", "self", ".", "with_cls", "else", "None", "\n", "bbox_pred", "=", "self", ".", "fc_reg", "(", "x", ")", "if", "self", ".", "with_reg", "else", "None", "\n", "return", "cls_score", ",", "bbox_pred", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.get_target": [[87, 104], ["mmdet.core.bbox_target"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.bbox_target.bbox_target"], ["", "def", "get_target", "(", "self", ",", "sampling_results", ",", "gt_bboxes", ",", "gt_labels", ",", "\n", "rcnn_train_cfg", ")", ":", "\n", "        ", "pos_proposals", "=", "[", "res", ".", "pos_bboxes", "for", "res", "in", "sampling_results", "]", "\n", "neg_proposals", "=", "[", "res", ".", "neg_bboxes", "for", "res", "in", "sampling_results", "]", "\n", "pos_gt_bboxes", "=", "[", "res", ".", "pos_gt_bboxes", "for", "res", "in", "sampling_results", "]", "\n", "pos_gt_labels", "=", "[", "res", ".", "pos_gt_labels", "for", "res", "in", "sampling_results", "]", "\n", "reg_classes", "=", "1", "if", "self", ".", "reg_class_agnostic", "else", "self", ".", "num_classes", "\n", "cls_reg_targets", "=", "bbox_target", "(", "\n", "pos_proposals", ",", "\n", "neg_proposals", ",", "\n", "pos_gt_bboxes", ",", "\n", "pos_gt_labels", ",", "\n", "rcnn_train_cfg", ",", "\n", "reg_classes", ",", "\n", "target_means", "=", "self", ".", "target_means", ",", "\n", "target_stds", "=", "self", ".", "target_stds", ")", "\n", "return", "cls_reg_targets", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.loss": [[105, 212], ["dict", "mmdet.core.delta2bbox", "mmdet.core.delta2bbox", "mmdet.core.bbox_overlaps", "bbox_pred.view", "bbox_pred.view", "bbox_head.BBoxHead.loss_bbox", "bbox_head.BBoxHead.loss_bbox", "bbox_pred.new_zeros", "bbox_head.BBoxHead.loss_cls", "mmdet.core.accuracy", "bbox_head.BBoxHead.loss_cls", "mmdet.core.accuracy", "bbox_pred.size", "bbox_pred.size", "bbox_pred.size", "bbox_targets.size", "bbox_targets.size"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.accuracy", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.accuracy"], ["", "def", "loss", "(", "self", ",", "\n", "cls_score", ",", "\n", "bbox_pred", ",", "\n", "labels", ",", "\n", "label_weights", ",", "\n", "bbox_targets", ",", "\n", "bbox_weights", ",", "\n", "proposal_bboxes", ",", "# added by Shengkai Wu", "\n", "reduce", "=", "True", ")", ":", "\n", "        ", "\"\"\"\n\n        :param cls_score: tensor of shape (batch*num_samples, num_classes),num_samples = num_pos+num_neg;\n            store the classification scores;\n        :param bbox_pred: tensor of shape (batch*num_samples, 4) or (batch*num_samples, num_classes*4)/\n            if use_iou_prediction is True, (batch*num_samples, 5) or (batch*num_samples, num_classes*5)\n        :param labels: tensor of shape (batch*num_samples), contain labels for the positives\n            and 0 for negatives;\n        :param label_weights: tensor of shape (batch*num_samples), 1 for all the elements;\n        :param bbox_targets: tensor of shape (batch*num_samples, 4), parametrized coordinates of\n            ground truth boxes for positives and 0 for negatives;\n        :param bbox_weights: tensor of shape (batch*num_samples, 4), 1 for positives and 0 for\n            negatives;\n        :param proposal_bboxes: tensor of shape (batch*num_samples, 4), coordinates of positive proposals\n            and 0 for negatives.\n        :param reduce:\n        :return:\n        \"\"\"", "\n", "losses", "=", "dict", "(", ")", "\n", "# the original implementation of mmdetection", "\n", "# if cls_score is not None:", "\n", "#     losses['loss_cls'] = self.loss_cls(", "\n", "#         cls_score, labels, label_weights, reduce=reduce)", "\n", "#     losses['acc'] = accuracy(cls_score, labels)", "\n", "# if bbox_pred is not None:", "\n", "#     pos_inds = labels > 0", "\n", "#     if self.reg_class_agnostic:", "\n", "#         pos_bbox_pred = bbox_pred.view(bbox_pred.size(0), 4)[pos_inds]", "\n", "#     else:", "\n", "#         pos_bbox_pred = bbox_pred.view(bbox_pred.size(0), -1,", "\n", "#                                        4)[pos_inds, labels[pos_inds]]", "\n", "#     losses['loss_bbox'] = self.loss_bbox(", "\n", "#         pos_bbox_pred,", "\n", "#         bbox_targets[pos_inds],", "\n", "#         bbox_weights[pos_inds],", "\n", "#         avg_factor=bbox_targets.size(0))", "\n", "\n", "# add by Shengkai Wu, modified from the original implementation of mmdetection.", "\n", "# pos_inds = labels > 0", "\n", "\n", "# another way to get the pos_inds", "\n", "pos_inds", "=", "(", "labels", ">", "0", ")", ".", "nonzero", "(", ")", ".", "view", "(", "-", "1", ")", "\n", "\n", "\n", "if", "self", ".", "reg_class_agnostic", ":", "\n", "            ", "pos_bbox_pred", "=", "bbox_pred", ".", "view", "(", "bbox_pred", ".", "size", "(", "0", ")", ",", "4", ")", "[", "pos_inds", "]", "# (num_pos, 4)", "\n", "# print('test')", "\n", "", "else", ":", "\n", "            ", "pos_bbox_pred", "=", "bbox_pred", ".", "view", "(", "bbox_pred", ".", "size", "(", "0", ")", ",", "-", "1", ",", "\n", "4", ")", "[", "pos_inds", ",", "labels", "[", "pos_inds", "]", "]", "# (num_pos, 4)", "\n", "# print(\"test: bbox_head\")", "\n", "\n", "# compute the iou between predicted boxes and corresponding ground truth", "\n", "# boxes for positives. The shape of iou is (batch*num_pos)", "\n", "", "IoU_balanced_Cls", "=", "self", ".", "IoU_balanced_Cls", "\n", "IoU_balanced_Loc", "=", "self", ".", "IoU_balanced_Loc", "\n", "\n", "\n", "if", "IoU_balanced_Cls", "or", "IoU_balanced_Loc", ":", "\n", "# ignoring target_mean and target_std will result in wrong target_box and pred_box and thus wrong", "\n", "# iou.", "\n", "            ", "pred_box", "=", "delta2bbox", "(", "proposal_bboxes", "[", "pos_inds", "]", ",", "pos_bbox_pred", ",", "self", ".", "target_means", ",", "self", ".", "target_stds", ")", "\n", "target_box", "=", "delta2bbox", "(", "proposal_bboxes", "[", "pos_inds", "]", ",", "bbox_targets", "[", "pos_inds", "]", ",", "self", ".", "target_means", ",", "self", ".", "target_stds", ")", "\n", "iou", "=", "bbox_overlaps", "(", "target_box", ",", "pred_box", ",", "is_aligned", "=", "True", ")", "# (num_pos)", "\n", "# iou = bbox_overlaps(target_box,  proposal_bboxes[pos_inds], is_aligned=True)", "\n", "\n", "", "if", "bbox_pred", "is", "not", "None", ":", "\n", "            ", "if", "IoU_balanced_Loc", ":", "\n", "# print('the size of bbox_weights is ', bbox_weights[pos_inds].size())", "\n", "                ", "losses", "[", "'loss_bbox'", "]", "=", "self", ".", "loss_bbox", "(", "\n", "pos_bbox_pred", ",", "\n", "bbox_targets", "[", "pos_inds", "]", ",", "\n", "iou", ",", "\n", "bbox_weights", "[", "pos_inds", "]", ",", "\n", "avg_factor", "=", "bbox_targets", ".", "size", "(", "0", ")", ")", "\n", "\n", "", "else", ":", "\n", "# print('the size of bbox_weights is ', bbox_weights[pos_inds].size())", "\n", "                ", "losses", "[", "'loss_bbox'", "]", "=", "self", ".", "loss_bbox", "(", "\n", "pos_bbox_pred", ",", "\n", "bbox_targets", "[", "pos_inds", "]", ",", "\n", "bbox_weights", "[", "pos_inds", "]", ",", "\n", "avg_factor", "=", "bbox_targets", ".", "size", "(", "0", ")", ")", "\n", "\n", "", "", "if", "cls_score", "is", "not", "None", ":", "\n", "            ", "if", "IoU_balanced_Cls", ":", "\n", "                ", "iou_extended", "=", "bbox_pred", ".", "new_zeros", "(", "bbox_pred", ".", "size", "(", "0", ")", ")", "\n", "iou_extended", "[", "pos_inds", "]", "=", "iou", "\n", "\n", "losses", "[", "'loss_cls'", "]", "=", "self", ".", "loss_cls", "(", "\n", "cls_score", ",", "labels", ",", "label_weights", ",", "iou_extended", ",", "reduce", "=", "reduce", ")", "\n", "losses", "[", "'acc'", "]", "=", "accuracy", "(", "cls_score", ",", "labels", ")", "\n", "", "else", ":", "\n", "                ", "losses", "[", "'loss_cls'", "]", "=", "self", ".", "loss_cls", "(", "\n", "cls_score", ",", "labels", ",", "label_weights", ",", "reduce", "=", "reduce", ")", "\n", "losses", "[", "'acc'", "]", "=", "accuracy", "(", "cls_score", ",", "labels", ")", "\n", "\n", "", "", "return", "losses", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.get_det_bboxes": [[213, 255], ["isinstance", "torch.softmax", "torch.softmax", "torch.softmax", "mmdet.core.delta2bbox", "mmdet.core.multiclass_nms", "sum", "float", "len"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.post_processing.bbox_nms.multiclass_nms"], ["", "def", "get_det_bboxes", "(", "self", ",", "\n", "rois", ",", "\n", "cls_score", ",", "\n", "bbox_pred", ",", "\n", "img_shape", ",", "\n", "scale_factor", ",", "\n", "rescale", "=", "False", ",", "\n", "cfg", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n        :param rois:\n        :param cls_score: tensor of shape (batch*num_samples, num_classes),num_samples = num_pos+num_neg;\n            store the classification scores;\n        :param bbox_pred: tensor of shape (batch*num_samples, 4) or (batch*num_samples, num_classes*4)/\n            if use_iou_prediction is True, (batch*num_samples, 5) or (batch*num_samples, num_classes*5);\n        :param img_shape:\n        :param scale_factor:\n        :param rescale:\n        :param cfg:\n        :return:\n        \"\"\"", "\n", "if", "isinstance", "(", "cls_score", ",", "list", ")", ":", "\n", "            ", "cls_score", "=", "sum", "(", "cls_score", ")", "/", "float", "(", "len", "(", "cls_score", ")", ")", "\n", "", "scores", "=", "F", ".", "softmax", "(", "cls_score", ",", "dim", "=", "1", ")", "if", "cls_score", "is", "not", "None", "else", "None", "\n", "\n", "if", "bbox_pred", "is", "not", "None", ":", "\n", "            ", "bboxes", "=", "delta2bbox", "(", "rois", "[", ":", ",", "1", ":", "]", ",", "bbox_pred", ",", "self", ".", "target_means", ",", "\n", "self", ".", "target_stds", ",", "img_shape", ")", "\n", "", "else", ":", "\n", "            ", "bboxes", "=", "rois", "[", ":", ",", "1", ":", "]", "\n", "# TODO: add clip here", "\n", "\n", "", "if", "rescale", ":", "\n", "            ", "bboxes", "/=", "scale_factor", "\n", "\n", "", "if", "cfg", "is", "None", ":", "\n", "            ", "return", "bboxes", ",", "scores", "\n", "", "else", ":", "\n", "            ", "det_bboxes", ",", "det_labels", "=", "multiclass_nms", "(", "bboxes", ",", "scores", ",", "\n", "cfg", ".", "score_thr", ",", "cfg", ".", "nms", ",", "\n", "cfg", ".", "max_per_img", ")", "\n", "\n", "return", "det_bboxes", ",", "det_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.refine_bboxes": [[256, 295], ["rois[].long().unique", "range", "rois[].long().unique.numel", "len", "len", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze.numel", "torch.nonzero().squeeze.numel", "torch.nonzero().squeeze.numel", "bbox_head.BBoxHead.regress_by_class", "pos_is_gts_.new_ones", "bboxes_list.append", "rois[].long", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero", "torch.nonzero", "len"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.regress_by_class"], ["", "", "def", "refine_bboxes", "(", "self", ",", "rois", ",", "labels", ",", "bbox_preds", ",", "pos_is_gts", ",", "img_metas", ")", ":", "\n", "        ", "\"\"\"Refine bboxes during training.\n\n        Args:\n            rois (Tensor): Shape (n*bs, 5), where n is image number per GPU,\n                and bs is the sampled RoIs per image.\n            labels (Tensor): Shape (n*bs, ).\n            bbox_preds (Tensor): Shape (n*bs, 4) or (n*bs, 4*#class).\n            pos_is_gts (list[Tensor]): Flags indicating if each positive bbox\n                is a gt bbox.\n            img_metas (list[dict]): Meta info of each image.\n\n        Returns:\n            list[Tensor]: Refined bboxes of each image in a mini-batch.\n        \"\"\"", "\n", "img_ids", "=", "rois", "[", ":", ",", "0", "]", ".", "long", "(", ")", ".", "unique", "(", "sorted", "=", "True", ")", "\n", "assert", "img_ids", ".", "numel", "(", ")", "==", "len", "(", "img_metas", ")", "\n", "\n", "bboxes_list", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "img_metas", ")", ")", ":", "\n", "            ", "inds", "=", "torch", ".", "nonzero", "(", "rois", "[", ":", ",", "0", "]", "==", "i", ")", ".", "squeeze", "(", ")", "\n", "num_rois", "=", "inds", ".", "numel", "(", ")", "\n", "\n", "bboxes_", "=", "rois", "[", "inds", ",", "1", ":", "]", "\n", "label_", "=", "labels", "[", "inds", "]", "\n", "bbox_pred_", "=", "bbox_preds", "[", "inds", "]", "\n", "img_meta_", "=", "img_metas", "[", "i", "]", "\n", "pos_is_gts_", "=", "pos_is_gts", "[", "i", "]", "\n", "\n", "bboxes", "=", "self", ".", "regress_by_class", "(", "bboxes_", ",", "label_", ",", "bbox_pred_", ",", "\n", "img_meta_", ")", "\n", "# filter gt bboxes", "\n", "pos_keep", "=", "1", "-", "pos_is_gts_", "\n", "keep_inds", "=", "pos_is_gts_", ".", "new_ones", "(", "num_rois", ")", "\n", "keep_inds", "[", ":", "len", "(", "pos_is_gts_", ")", "]", "=", "pos_keep", "\n", "\n", "bboxes_list", ".", "append", "(", "bboxes", "[", "keep_inds", "]", ")", "\n", "\n", "", "return", "bboxes_list", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.regress_by_class": [[296, 325], ["torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.gather", "torch.gather", "torch.gather", "torch.gather", "torch.gather", "torch.gather", "torch.gather", "torch.gather", "torch.gather", "torch.gather.size", "torch.gather.size", "torch.gather.size", "rois.size", "mmdet.core.delta2bbox", "mmdet.core.delta2bbox", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "rois.size", "rois.size"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox"], ["", "def", "regress_by_class", "(", "self", ",", "rois", ",", "label", ",", "bbox_pred", ",", "img_meta", ")", ":", "\n", "        ", "\"\"\"Regress the bbox for the predicted class. Used in Cascade R-CNN.\n\n        Args:\n            rois (Tensor): shape (n, 4) or (n, 5)\n            label (Tensor): shape (n, )\n            bbox_pred (Tensor): shape (n, 4*(#class+1)) or (n, 4)\n            img_meta (dict): Image meta info.\n\n        Returns:\n            Tensor: Regressed bboxes, the same shape as input rois.\n        \"\"\"", "\n", "assert", "rois", ".", "size", "(", "1", ")", "==", "4", "or", "rois", ".", "size", "(", "1", ")", "==", "5", "\n", "\n", "if", "not", "self", ".", "reg_class_agnostic", ":", "\n", "            ", "label", "=", "label", "*", "4", "\n", "inds", "=", "torch", ".", "stack", "(", "(", "label", ",", "label", "+", "1", ",", "label", "+", "2", ",", "label", "+", "3", ")", ",", "1", ")", "\n", "bbox_pred", "=", "torch", ".", "gather", "(", "bbox_pred", ",", "1", ",", "inds", ")", "\n", "", "assert", "bbox_pred", ".", "size", "(", "1", ")", "==", "4", "\n", "\n", "if", "rois", ".", "size", "(", "1", ")", "==", "4", ":", "\n", "            ", "new_rois", "=", "delta2bbox", "(", "rois", ",", "bbox_pred", ",", "self", ".", "target_means", ",", "\n", "self", ".", "target_stds", ",", "img_meta", "[", "'img_shape'", "]", ")", "\n", "", "else", ":", "\n", "            ", "bboxes", "=", "delta2bbox", "(", "rois", "[", ":", ",", "1", ":", "]", ",", "bbox_pred", ",", "self", ".", "target_means", ",", "\n", "self", ".", "target_stds", ",", "img_meta", "[", "'img_shape'", "]", ")", "\n", "new_rois", "=", "torch", ".", "cat", "(", "(", "rois", "[", ":", ",", "[", "0", "]", "]", ",", "bboxes", ")", ",", "dim", "=", "1", ")", "\n", "\n", "", "return", "new_rois", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.__init__": [[24, 34], ["torch.Module.__init__", "single_level.SingleRoIExtractor.build_roi_layers"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.build_roi_layers"], ["def", "__init__", "(", "self", ",", "\n", "roi_layer", ",", "\n", "out_channels", ",", "\n", "featmap_strides", ",", "\n", "finest_scale", "=", "56", ")", ":", "\n", "        ", "super", "(", "SingleRoIExtractor", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "roi_layers", "=", "self", ".", "build_roi_layers", "(", "roi_layer", ",", "featmap_strides", ")", "\n", "self", ".", "out_channels", "=", "out_channels", "\n", "self", ".", "featmap_strides", "=", "featmap_strides", "\n", "self", ".", "finest_scale", "=", "finest_scale", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.num_inputs": [[35, 39], ["len"], "methods", ["None"], ["", "@", "property", "\n", "def", "num_inputs", "(", "self", ")", ":", "\n", "        ", "\"\"\"int: Input feature map levels.\"\"\"", "\n", "return", "len", "(", "self", ".", "featmap_strides", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.init_weights": [[40, 42], ["None"], "methods", ["None"], ["", "def", "init_weights", "(", "self", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.build_roi_layers": [[43, 51], ["layer_cfg.copy", "layer_cfg.copy.pop", "hasattr", "getattr", "torch.ModuleList", "torch.ModuleList", "getattr."], "methods", ["None"], ["", "def", "build_roi_layers", "(", "self", ",", "layer_cfg", ",", "featmap_strides", ")", ":", "\n", "        ", "cfg", "=", "layer_cfg", ".", "copy", "(", ")", "\n", "layer_type", "=", "cfg", ".", "pop", "(", "'type'", ")", "\n", "assert", "hasattr", "(", "ops", ",", "layer_type", ")", "\n", "layer_cls", "=", "getattr", "(", "ops", ",", "layer_type", ")", "\n", "roi_layers", "=", "nn", ".", "ModuleList", "(", "\n", "[", "layer_cls", "(", "spatial_scale", "=", "1", "/", "s", ",", "**", "cfg", ")", "for", "s", "in", "featmap_strides", "]", ")", "\n", "return", "roi_layers", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.map_roi_levels": [[52, 72], ["torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.floor", "torch.floor", "torch.floor", "torch.floor", "target_lvls.clamp().long.clamp().long.clamp().long", "torch.log2", "torch.log2", "torch.log2", "torch.log2", "target_lvls.clamp().long.clamp().long.clamp"], "methods", ["None"], ["", "def", "map_roi_levels", "(", "self", ",", "rois", ",", "num_levels", ")", ":", "\n", "        ", "\"\"\"Map rois to corresponding feature levels by scales.\n\n        - scale < finest_scale: level 0\n        - finest_scale <= scale < finest_scale * 2: level 1\n        - finest_scale * 2 <= scale < finest_scale * 4: level 2\n        - scale >= finest_scale * 4: level 3\n\n        Args:\n            rois (Tensor): Input RoIs, shape (k, 5).\n            num_levels (int): Total level number.\n\n        Returns:\n            Tensor: Level index (0-based) of each RoI, shape (k, )\n        \"\"\"", "\n", "scale", "=", "torch", ".", "sqrt", "(", "\n", "(", "rois", "[", ":", ",", "3", "]", "-", "rois", "[", ":", ",", "1", "]", "+", "1", ")", "*", "(", "rois", "[", ":", ",", "4", "]", "-", "rois", "[", ":", ",", "2", "]", "+", "1", ")", ")", "\n", "target_lvls", "=", "torch", ".", "floor", "(", "torch", ".", "log2", "(", "scale", "/", "self", ".", "finest_scale", "+", "1e-6", ")", ")", "\n", "target_lvls", "=", "target_lvls", ".", "clamp", "(", "min", "=", "0", ",", "max", "=", "num_levels", "-", "1", ")", ".", "long", "(", ")", "\n", "return", "target_lvls", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.forward": [[73, 89], ["len", "single_level.SingleRoIExtractor.map_roi_levels", "torch.cuda.FloatTensor().fill_", "torch.cuda.FloatTensor().fill_", "torch.cuda.FloatTensor().fill_", "torch.cuda.FloatTensor().fill_", "range", "len", "inds.any", "torch.cuda.FloatTensor", "torch.cuda.FloatTensor", "torch.cuda.FloatTensor", "torch.cuda.FloatTensor", "rois.size"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.roi_extractors.single_level.SingleRoIExtractor.map_roi_levels"], ["", "def", "forward", "(", "self", ",", "feats", ",", "rois", ")", ":", "\n", "        ", "if", "len", "(", "feats", ")", "==", "1", ":", "\n", "            ", "return", "self", ".", "roi_layers", "[", "0", "]", "(", "feats", "[", "0", "]", ",", "rois", ")", "\n", "\n", "", "out_size", "=", "self", ".", "roi_layers", "[", "0", "]", ".", "out_size", "\n", "num_levels", "=", "len", "(", "feats", ")", "\n", "target_lvls", "=", "self", ".", "map_roi_levels", "(", "rois", ",", "num_levels", ")", "\n", "roi_feats", "=", "torch", ".", "cuda", ".", "FloatTensor", "(", "rois", ".", "size", "(", ")", "[", "0", "]", ",", "self", ".", "out_channels", ",", "\n", "out_size", ",", "out_size", ")", ".", "fill_", "(", "0", ")", "\n", "for", "i", "in", "range", "(", "num_levels", ")", ":", "\n", "            ", "inds", "=", "target_lvls", "==", "i", "\n", "if", "inds", ".", "any", "(", ")", ":", "\n", "                ", "rois_", "=", "rois", "[", "inds", ",", ":", "]", "\n", "roi_feats_t", "=", "self", ".", "roi_layers", "[", "i", "]", "(", "feats", "[", "i", "]", ",", "rois_", ")", "\n", "roi_feats", "[", "inds", "]", "+=", "roi_feats_t", "\n", "", "", "return", "roi_feats", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.iou_balanced_smooth_l1_loss.IoUbalancedSmoothL1Loss.__init__": [[10, 15], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "beta", "=", "1.0", ",", "delta", "=", "1.0", ",", "loss_weight", "=", "1.0", ")", ":", "\n", "        ", "super", "(", "IoUbalancedSmoothL1Loss", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "beta", "=", "beta", "\n", "self", ".", "delta", "=", "delta", "\n", "self", ".", "loss_weight", "=", "loss_weight", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.iou_balanced_smooth_l1_loss.IoUbalancedSmoothL1Loss.forward": [[16, 21], ["mmdet.core.weighted_iou_balanced_smoothl1"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.weighted_iou_balanced_smoothl1"], ["", "def", "forward", "(", "self", ",", "pred", ",", "target", ",", "iou", ",", "weight", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "# print(\"the loss_weight is \", self.loss_weight)", "\n", "        ", "loss_bbox", "=", "self", ".", "loss_weight", "*", "weighted_iou_balanced_smoothl1", "(", "\n", "pred", ",", "target", ",", "iou", ",", "weight", ",", "beta", "=", "self", ".", "beta", ",", "delta", "=", "self", ".", "delta", ",", "*", "args", ",", "**", "kwargs", ")", "\n", "return", "loss_bbox", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.balanced_l1_loss.BalancedL1Loss.__init__": [[14, 20], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["def", "__init__", "(", "self", ",", "alpha", "=", "0.5", ",", "gamma", "=", "1.5", ",", "beta", "=", "1.0", ",", "loss_weight", "=", "1.0", ")", ":", "\n", "        ", "super", "(", "BalancedL1Loss", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "alpha", "=", "alpha", "\n", "self", ".", "gamma", "=", "gamma", "\n", "self", ".", "beta", "=", "beta", "\n", "self", ".", "loss_weight", "=", "loss_weight", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.balanced_l1_loss.BalancedL1Loss.forward": [[21, 32], ["mmdet.core.weighted_balanced_l1_loss"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.weighted_balanced_l1_loss"], ["", "def", "forward", "(", "self", ",", "pred", ",", "target", ",", "weight", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "loss_bbox", "=", "self", ".", "loss_weight", "*", "weighted_balanced_l1_loss", "(", "\n", "pred", ",", "\n", "target", ",", "\n", "weight", ",", "\n", "alpha", "=", "self", ".", "alpha", ",", "\n", "gamma", "=", "self", ".", "gamma", ",", "\n", "beta", "=", "self", ".", "beta", ",", "\n", "*", "args", ",", "\n", "**", "kwargs", ")", "\n", "return", "loss_bbox", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.iou_balanced_sigmoid_focal_loss.IOUbalancedSigmoidFocalLoss.__init__": [[10, 26], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "\n", "use_sigmoid", "=", "False", ",", "\n", "loss_weight", "=", "1.0", ",", "\n", "gamma", "=", "2.0", ",", "\n", "alpha", "=", "0.25", ",", "\n", "eta", "=", "1.0", "\n", "# use_diff_thr=False", "\n", ")", ":", "\n", "        ", "super", "(", "IOUbalancedSigmoidFocalLoss", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "use_sigmoid", "is", "True", ",", "'Only sigmoid focaloss supported now.'", "\n", "self", ".", "use_sigmoid", "=", "use_sigmoid", "\n", "self", ".", "loss_weight", "=", "loss_weight", "\n", "self", ".", "gamma", "=", "gamma", "\n", "self", ".", "alpha", "=", "alpha", "\n", "self", ".", "eta", "=", "eta", "\n", "self", ".", "cls_criterion", "=", "iou_balanced_sigmoid_focal_loss", "\n", "# self.use_diff_thr = use_diff_thr", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.iou_balanced_sigmoid_focal_loss.IOUbalancedSigmoidFocalLoss.forward": [[28, 58], ["mmdet.core.iou_balanced_sigmoid_focal_loss.IOUbalancedSigmoidFocalLoss.cls_criterion"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "cls_score", ",", "label", ",", "label_weight", ",", "iou", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "if", "self", ".", "use_sigmoid", ":", "\n", "# loss_cls = self.loss_weight * self.cls_criterion(", "\n", "#     cls_score,", "\n", "#     label,", "\n", "#     label_weight,", "\n", "#     iou,", "\n", "#     # iou_neg,", "\n", "#     gamma=self.gamma,", "\n", "#     alpha=self.alpha,", "\n", "#     eta=self.eta,", "\n", "#     # use_diff_thr=self.use_diff_thr,", "\n", "#     *args,", "\n", "#     **kwargs)", "\n", "            ", "loss_cls", "=", "self", ".", "cls_criterion", "(", "\n", "cls_score", ",", "\n", "label", ",", "\n", "label_weight", ",", "\n", "iou", ",", "\n", "# iou_neg,", "\n", "gamma", "=", "self", ".", "gamma", ",", "\n", "alpha", "=", "self", ".", "alpha", ",", "\n", "eta", "=", "self", ".", "eta", ",", "\n", "# use_diff_thr=self.use_diff_thr,", "\n", "*", "args", ",", "\n", "**", "kwargs", ")", "\n", "\n", "", "else", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "", "return", "loss_cls", "\n", "# return", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.iou_balanced_cross_entropy_loss.IOUbalancedCrossEntropyLoss.__init__": [[11, 25], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "use_sigmoid", "=", "False", ",", "use_mask", "=", "False", ",", "loss_weight", "=", "1.0", ",", "eta", "=", "1.5", ")", ":", "\n", "        ", "super", "(", "IOUbalancedCrossEntropyLoss", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "(", "use_sigmoid", "is", "False", ")", "or", "(", "use_mask", "is", "False", ")", "\n", "self", ".", "use_sigmoid", "=", "use_sigmoid", "\n", "self", ".", "use_mask", "=", "use_mask", "\n", "self", ".", "loss_weight", "=", "loss_weight", "\n", "self", ".", "eta", "=", "eta", "\n", "\n", "if", "self", ".", "use_sigmoid", ":", "\n", "            ", "self", ".", "cls_criterion", "=", "iou_balanced_binary_cross_entropy", "\n", "", "elif", "self", ".", "use_mask", ":", "\n", "            ", "self", ".", "cls_criterion", "=", "mask_cross_entropy", "\n", "", "else", ":", "\n", "            ", "self", ".", "cls_criterion", "=", "iou_balanced_cross_entropy", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.iou_balanced_cross_entropy_loss.IOUbalancedCrossEntropyLoss.forward": [[26, 30], ["iou_balanced_cross_entropy_loss.IOUbalancedCrossEntropyLoss.cls_criterion"], "methods", ["None"], ["", "", "def", "forward", "(", "self", ",", "cls_score", ",", "label", ",", "label_weight", ",", "iou", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "loss_cls", "=", "self", ".", "loss_weight", "*", "self", ".", "cls_criterion", "(", "\n", "cls_score", ",", "label", ",", "label_weight", ",", "iou", ",", "eta", "=", "self", ".", "eta", ",", "*", "args", ",", "**", "kwargs", ")", "\n", "return", "loss_cls", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.iou_loss.IoULoss.__init__": [[10, 16], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "style", "=", "'naive'", ",", "beta", "=", "0.2", ",", "eps", "=", "1e-3", ",", "loss_weight", "=", "1.0", ")", ":", "\n", "        ", "super", "(", "IoULoss", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "style", "=", "style", "\n", "self", ".", "beta", "=", "beta", "\n", "self", ".", "eps", "=", "eps", "\n", "self", ".", "loss_weight", "=", "loss_weight", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.iou_loss.IoULoss.forward": [[17, 28], ["mmdet.core.weighted_iou_loss"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.weighted_iou_loss"], ["", "def", "forward", "(", "self", ",", "pred", ",", "target", ",", "weight", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "loss", "=", "self", ".", "loss_weight", "*", "weighted_iou_loss", "(", "\n", "pred", ",", "\n", "target", ",", "\n", "weight", ",", "\n", "style", "=", "self", ".", "style", ",", "\n", "beta", "=", "self", ".", "beta", ",", "\n", "eps", "=", "self", ".", "eps", ",", "\n", "*", "args", ",", "\n", "**", "kwargs", ")", "\n", "return", "loss", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.focal_loss.FocalLoss.__init__": [[10, 22], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "\n", "use_sigmoid", "=", "False", ",", "\n", "loss_weight", "=", "1.0", ",", "\n", "gamma", "=", "2.0", ",", "\n", "alpha", "=", "0.25", ")", ":", "\n", "        ", "super", "(", "FocalLoss", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "use_sigmoid", "is", "True", ",", "'Only sigmoid focaloss supported now.'", "\n", "self", ".", "use_sigmoid", "=", "use_sigmoid", "\n", "self", ".", "loss_weight", "=", "loss_weight", "\n", "self", ".", "gamma", "=", "gamma", "\n", "self", ".", "alpha", "=", "alpha", "\n", "self", ".", "cls_criterion", "=", "weighted_sigmoid_focal_loss", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.focal_loss.FocalLoss.forward": [[23, 36], ["focal_loss.FocalLoss.cls_criterion"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "cls_score", ",", "label", ",", "label_weight", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "if", "self", ".", "use_sigmoid", ":", "\n", "            ", "loss_cls", "=", "self", ".", "loss_weight", "*", "self", ".", "cls_criterion", "(", "\n", "cls_score", ",", "\n", "label", ",", "\n", "label_weight", ",", "\n", "gamma", "=", "self", ".", "gamma", ",", "\n", "alpha", "=", "self", ".", "alpha", ",", "\n", "*", "args", ",", "\n", "**", "kwargs", ")", "\n", "", "else", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "", "return", "loss_cls", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.ghm_loss.GHMC.__init__": [[32, 49], ["torch.Module.__init__", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["def", "__init__", "(", "\n", "self", ",", "\n", "bins", "=", "10", ",", "\n", "momentum", "=", "0", ",", "\n", "use_sigmoid", "=", "True", ",", "\n", "loss_weight", "=", "1.0", ")", ":", "\n", "        ", "super", "(", "GHMC", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "bins", "=", "bins", "\n", "self", ".", "momentum", "=", "momentum", "\n", "self", ".", "edges", "=", "torch", ".", "arange", "(", "bins", "+", "1", ")", ".", "float", "(", ")", ".", "cuda", "(", ")", "/", "bins", "\n", "self", ".", "edges", "[", "-", "1", "]", "+=", "1e-6", "\n", "if", "momentum", ">", "0", ":", "\n", "            ", "self", ".", "acc_sum", "=", "torch", ".", "zeros", "(", "bins", ")", ".", "cuda", "(", ")", "\n", "", "self", ".", "use_sigmoid", "=", "use_sigmoid", "\n", "if", "not", "self", ".", "use_sigmoid", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "", "self", ".", "loss_weight", "=", "loss_weight", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.ghm_loss.GHMC.forward": [[50, 97], ["torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "max", "range", "pred.dim", "target.dim", "ghm_loss._expand_binary_labels", "target.float", "label_weight.float", "valid.float().sum().item", "inds.sum().item", "torch.binary_cross_entropy_with_logits", "torch.binary_cross_entropy_with_logits", "torch.binary_cross_entropy_with_logits", "pred.size", "pred.sigmoid().detach", "valid.float().sum", "inds.sum", "pred.sigmoid", "valid.float"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses._expand_binary_labels"], ["", "def", "forward", "(", "self", ",", "pred", ",", "target", ",", "label_weight", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "\"\"\"Calculate the GHM-C loss.\n\n        Args:\n            pred (float tensor of size [batch_num, class_num]):\n                The direct prediction of classification fc layer.\n            target (float tensor of size [batch_num, class_num]):\n                Binary class target for each sample. 1 for positives\n                and 0 for others\n            label_weight (float tensor of size [batch_num, class_num]):\n                the value is 1 if the sample is valid and 0 if ignored.\n                1 for positives and negatives, 0 for others.\n        Returns:\n            The gradient harmonized loss.\n        \"\"\"", "\n", "# the target should be binary class label", "\n", "if", "pred", ".", "dim", "(", ")", "!=", "target", ".", "dim", "(", ")", ":", "\n", "            ", "target", ",", "label_weight", "=", "_expand_binary_labels", "(", "\n", "target", ",", "label_weight", ",", "pred", ".", "size", "(", "-", "1", ")", ")", "\n", "", "target", ",", "label_weight", "=", "target", ".", "float", "(", ")", ",", "label_weight", ".", "float", "(", ")", "\n", "edges", "=", "self", ".", "edges", "\n", "mmt", "=", "self", ".", "momentum", "\n", "weights", "=", "torch", ".", "zeros_like", "(", "pred", ")", "\n", "\n", "# gradient length", "\n", "g", "=", "torch", ".", "abs", "(", "pred", ".", "sigmoid", "(", ")", ".", "detach", "(", ")", "-", "target", ")", "\n", "\n", "valid", "=", "label_weight", ">", "0", "\n", "tot", "=", "max", "(", "valid", ".", "float", "(", ")", ".", "sum", "(", ")", ".", "item", "(", ")", ",", "1.0", ")", "# the number of pos and neg", "\n", "n", "=", "0", "# n valid bins", "\n", "for", "i", "in", "range", "(", "self", ".", "bins", ")", ":", "\n", "            ", "inds", "=", "(", "g", ">=", "edges", "[", "i", "]", ")", "&", "(", "g", "<", "edges", "[", "i", "+", "1", "]", ")", "&", "valid", "\n", "num_in_bin", "=", "inds", ".", "sum", "(", ")", ".", "item", "(", ")", "\n", "if", "num_in_bin", ">", "0", ":", "\n", "                ", "if", "mmt", ">", "0", ":", "\n", "                    ", "self", ".", "acc_sum", "[", "i", "]", "=", "mmt", "*", "self", ".", "acc_sum", "[", "i", "]", "+", "(", "1", "-", "mmt", ")", "*", "num_in_bin", "\n", "weights", "[", "inds", "]", "=", "tot", "/", "self", ".", "acc_sum", "[", "i", "]", "\n", "", "else", ":", "\n", "                    ", "weights", "[", "inds", "]", "=", "tot", "/", "num_in_bin", "\n", "", "n", "+=", "1", "\n", "", "", "if", "n", ">", "0", ":", "\n", "            ", "weights", "=", "weights", "/", "n", "\n", "\n", "", "loss", "=", "F", ".", "binary_cross_entropy_with_logits", "(", "\n", "pred", ",", "target", ",", "weights", ",", "reduction", "=", "'sum'", ")", "/", "tot", "\n", "return", "loss", "*", "self", ".", "loss_weight", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.ghm_loss.GHMR.__init__": [[113, 128], ["torch.Module.__init__", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["def", "__init__", "(", "\n", "self", ",", "\n", "mu", "=", "0.02", ",", "\n", "bins", "=", "10", ",", "\n", "momentum", "=", "0", ",", "\n", "loss_weight", "=", "1.0", ")", ":", "\n", "        ", "super", "(", "GHMR", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "mu", "=", "mu", "\n", "self", ".", "bins", "=", "bins", "\n", "self", ".", "edges", "=", "torch", ".", "arange", "(", "bins", "+", "1", ")", ".", "float", "(", ")", ".", "cuda", "(", ")", "/", "bins", "\n", "self", ".", "edges", "[", "-", "1", "]", "=", "1e3", "\n", "self", ".", "momentum", "=", "momentum", "\n", "if", "momentum", ">", "0", ":", "\n", "            ", "self", ".", "acc_sum", "=", "torch", ".", "zeros", "(", "bins", ")", ".", "cuda", "(", ")", "\n", "", "self", ".", "loss_weight", "=", "loss_weight", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.ghm_loss.GHMR.forward": [[129, 175], ["torch.abs().detach", "torch.abs().detach", "torch.abs().detach", "torch.abs().detach", "torch.abs().detach", "torch.abs().detach", "torch.abs().detach", "torch.abs().detach", "torch.abs().detach", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "max", "range", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "label_weight.float().sum().item", "inds.sum().item", "loss.sum", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "label_weight.float().sum", "inds.sum", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "label_weight.float"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "pred", ",", "target", ",", "label_weight", ",", "avg_factor", "=", "None", ")", ":", "\n", "        ", "\"\"\"Calculate the GHM-R loss.\n\n        Args:\n            pred (float tensor of size [batch_num, 4 (* class_num)]):\n                The prediction of box regression layer. Channel number can be 4\n                or 4 * class_num depending on whether it is class-agnostic.\n            target (float tensor of size [batch_num, 4 (* class_num)]):\n                The target regression values with the same size of pred.\n            label_weight (float tensor of size [batch_num, 4 (* class_num)]):\n                The weight of each sample, 0 if ignored.\n        Returns:\n            The gradient harmonized loss.\n        \"\"\"", "\n", "mu", "=", "self", ".", "mu", "\n", "edges", "=", "self", ".", "edges", "\n", "mmt", "=", "self", ".", "momentum", "\n", "\n", "# ASL1 loss", "\n", "diff", "=", "pred", "-", "target", "\n", "loss", "=", "torch", ".", "sqrt", "(", "diff", "*", "diff", "+", "mu", "*", "mu", ")", "-", "mu", "\n", "\n", "# gradient length", "\n", "g", "=", "torch", ".", "abs", "(", "diff", "/", "torch", ".", "sqrt", "(", "mu", "*", "mu", "+", "diff", "*", "diff", ")", ")", ".", "detach", "(", ")", "\n", "weights", "=", "torch", ".", "zeros_like", "(", "g", ")", "\n", "\n", "valid", "=", "label_weight", ">", "0", "\n", "tot", "=", "max", "(", "label_weight", ".", "float", "(", ")", ".", "sum", "(", ")", ".", "item", "(", ")", ",", "1.0", ")", "\n", "n", "=", "0", "# n: valid bins", "\n", "for", "i", "in", "range", "(", "self", ".", "bins", ")", ":", "\n", "            ", "inds", "=", "(", "g", ">=", "edges", "[", "i", "]", ")", "&", "(", "g", "<", "edges", "[", "i", "+", "1", "]", ")", "&", "valid", "\n", "num_in_bin", "=", "inds", ".", "sum", "(", ")", ".", "item", "(", ")", "\n", "if", "num_in_bin", ">", "0", ":", "\n", "                ", "n", "+=", "1", "\n", "if", "mmt", ">", "0", ":", "\n", "                    ", "self", ".", "acc_sum", "[", "i", "]", "=", "mmt", "*", "self", ".", "acc_sum", "[", "i", "]", "+", "(", "1", "-", "mmt", ")", "*", "num_in_bin", "\n", "weights", "[", "inds", "]", "=", "tot", "/", "self", ".", "acc_sum", "[", "i", "]", "\n", "", "else", ":", "\n", "                    ", "weights", "[", "inds", "]", "=", "tot", "/", "num_in_bin", "\n", "", "", "", "if", "n", ">", "0", ":", "\n", "            ", "weights", "/=", "n", "\n", "\n", "", "loss", "=", "loss", "*", "weights", "\n", "loss", "=", "loss", ".", "sum", "(", ")", "/", "tot", "\n", "return", "loss", "*", "self", ".", "loss_weight", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.ghm_loss.GHMIoU.__init__": [[191, 208], ["torch.Module.__init__", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.arange().float().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.arange().float", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["def", "__init__", "(", "\n", "self", ",", "\n", "bins", "=", "10", ",", "\n", "momentum", "=", "0", ",", "\n", "use_sigmoid", "=", "True", ",", "\n", "loss_weight", "=", "1.0", ")", ":", "\n", "        ", "super", "(", "GHMIoU", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "bins", "=", "bins", "\n", "self", ".", "momentum", "=", "momentum", "\n", "self", ".", "edges", "=", "torch", ".", "arange", "(", "bins", "+", "1", ")", ".", "float", "(", ")", ".", "cuda", "(", ")", "/", "bins", "\n", "self", ".", "edges", "[", "-", "1", "]", "+=", "1e-6", "\n", "if", "momentum", ">", "0", ":", "\n", "            ", "self", ".", "acc_sum", "=", "torch", ".", "zeros", "(", "bins", ")", ".", "cuda", "(", ")", "\n", "", "self", ".", "use_sigmoid", "=", "use_sigmoid", "\n", "if", "not", "self", ".", "use_sigmoid", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "", "self", ".", "loss_weight", "=", "loss_weight", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.ghm_loss.GHMIoU.forward": [[209, 255], ["target.detach.detach.detach", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "max", "range", "target.detach.detach.float", "label_weight.float", "valid.float().sum().item", "inds.sum().item", "torch.binary_cross_entropy_with_logits", "torch.binary_cross_entropy_with_logits", "torch.binary_cross_entropy_with_logits", "pred.sigmoid().detach", "valid.float().sum", "inds.sum", "pred.sigmoid", "valid.float"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "pred", ",", "target", ",", "label_weight", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "\"\"\"Calculate the GHM-C loss.\n\n        Args:\n            pred (float tensor of size [batch*A*width*height]):\n                IoU prediction for each regression anchor\n            target (float tensor of size [batch*A*width*height]):\n                store the iou between predicted boxes and its corresponding\n                groundtruth boxes for the positives and the iou between the\n                predicted boxes and anchors for negatives.\n            label_weight (float tensor of size [[batch*A*width*height]):\n                1 for positives and 0 for others.\n        Returns:\n            The gradient harmonized loss.\n        \"\"\"", "\n", "# the target should be binary class label", "\n", "target", ",", "label_weight", "=", "target", ".", "float", "(", ")", ",", "label_weight", ".", "float", "(", ")", "\n", "target", "=", "target", ".", "detach", "(", ")", "\n", "\n", "edges", "=", "self", ".", "edges", "\n", "mmt", "=", "self", ".", "momentum", "\n", "weights", "=", "torch", ".", "zeros_like", "(", "pred", ")", "\n", "\n", "# gradient length", "\n", "g", "=", "torch", ".", "abs", "(", "pred", ".", "sigmoid", "(", ")", ".", "detach", "(", ")", "-", "target", ")", "\n", "\n", "valid", "=", "label_weight", ">", "0", "\n", "tot", "=", "max", "(", "valid", ".", "float", "(", ")", ".", "sum", "(", ")", ".", "item", "(", ")", ",", "1.0", ")", "# the number of pos", "\n", "n", "=", "0", "# n valid bins", "\n", "for", "i", "in", "range", "(", "self", ".", "bins", ")", ":", "\n", "            ", "inds", "=", "(", "g", ">=", "edges", "[", "i", "]", ")", "&", "(", "g", "<", "edges", "[", "i", "+", "1", "]", ")", "&", "valid", "\n", "num_in_bin", "=", "inds", ".", "sum", "(", ")", ".", "item", "(", ")", "\n", "if", "num_in_bin", ">", "0", ":", "\n", "                ", "if", "mmt", ">", "0", ":", "\n", "                    ", "self", ".", "acc_sum", "[", "i", "]", "=", "mmt", "*", "self", ".", "acc_sum", "[", "i", "]", "+", "(", "1", "-", "mmt", ")", "*", "num_in_bin", "\n", "weights", "[", "inds", "]", "=", "tot", "/", "self", ".", "acc_sum", "[", "i", "]", "\n", "", "else", ":", "\n", "                    ", "weights", "[", "inds", "]", "=", "tot", "/", "num_in_bin", "\n", "", "n", "+=", "1", "\n", "", "", "if", "n", ">", "0", ":", "\n", "            ", "weights", "=", "weights", "/", "n", "\n", "\n", "", "loss", "=", "F", ".", "binary_cross_entropy_with_logits", "(", "\n", "pred", ",", "target", ",", "weights", ",", "reduction", "=", "'sum'", ")", "/", "tot", "\n", "return", "loss", "*", "self", ".", "loss_weight", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.ghm_loss._expand_binary_labels": [[8, 16], ["labels.new_full", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "label_weights.view().expand", "torch.nonzero().squeeze.numel", "label_weights.size", "labels.size", "torch.nonzero", "torch.nonzero", "torch.nonzero", "label_weights.view"], "function", ["None"], ["def", "_expand_binary_labels", "(", "labels", ",", "label_weights", ",", "label_channels", ")", ":", "\n", "    ", "bin_labels", "=", "labels", ".", "new_full", "(", "(", "labels", ".", "size", "(", "0", ")", ",", "label_channels", ")", ",", "0", ")", "\n", "inds", "=", "torch", ".", "nonzero", "(", "labels", ">=", "1", ")", ".", "squeeze", "(", ")", "\n", "if", "inds", ".", "numel", "(", ")", ">", "0", ":", "\n", "        ", "bin_labels", "[", "inds", ",", "labels", "[", "inds", "]", "-", "1", "]", "=", "1", "\n", "", "bin_label_weights", "=", "label_weights", ".", "view", "(", "-", "1", ",", "1", ")", ".", "expand", "(", "\n", "label_weights", ".", "size", "(", "0", ")", ",", "label_channels", ")", "\n", "return", "bin_labels", ",", "bin_label_weights", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.cross_entropy_loss.CrossEntropyLoss.__init__": [[11, 24], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "use_sigmoid", "=", "False", ",", "use_mask", "=", "False", ",", "loss_weight", "=", "1.0", ")", ":", "\n", "        ", "super", "(", "CrossEntropyLoss", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "(", "use_sigmoid", "is", "False", ")", "or", "(", "use_mask", "is", "False", ")", "\n", "self", ".", "use_sigmoid", "=", "use_sigmoid", "\n", "self", ".", "use_mask", "=", "use_mask", "\n", "self", ".", "loss_weight", "=", "loss_weight", "\n", "\n", "if", "self", ".", "use_sigmoid", ":", "\n", "            ", "self", ".", "cls_criterion", "=", "weighted_binary_cross_entropy", "\n", "", "elif", "self", ".", "use_mask", ":", "\n", "            ", "self", ".", "cls_criterion", "=", "mask_cross_entropy", "\n", "", "else", ":", "\n", "            ", "self", ".", "cls_criterion", "=", "weighted_cross_entropy", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.cross_entropy_loss.CrossEntropyLoss.forward": [[25, 29], ["cross_entropy_loss.CrossEntropyLoss.cls_criterion"], "methods", ["None"], ["", "", "def", "forward", "(", "self", ",", "cls_score", ",", "label", ",", "label_weight", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "loss_cls", "=", "self", ".", "loss_weight", "*", "self", ".", "cls_criterion", "(", "\n", "cls_score", ",", "label", ",", "label_weight", ",", "*", "args", ",", "**", "kwargs", ")", "\n", "return", "loss_cls", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.smooth_l1_loss.SmoothL1Loss.__init__": [[10, 14], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "beta", "=", "1.0", ",", "loss_weight", "=", "1.0", ")", ":", "\n", "        ", "super", "(", "SmoothL1Loss", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "beta", "=", "beta", "\n", "self", ".", "loss_weight", "=", "loss_weight", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.losses.smooth_l1_loss.SmoothL1Loss.forward": [[15, 19], ["mmdet.core.weighted_smoothl1"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.weighted_smoothl1"], ["", "def", "forward", "(", "self", ",", "pred", ",", "target", ",", "weight", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "loss_bbox", "=", "self", ".", "loss_weight", "*", "weighted_smoothl1", "(", "\n", "pred", ",", "target", ",", "weight", ",", "beta", "=", "self", ".", "beta", ",", "*", "args", ",", "**", "kwargs", ")", "\n", "return", "loss_bbox", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.post_processing.merge_augs.merge_aug_proposals": [[9, 39], ["zip", "torch.cat", "mmdet.ops.nms", "scores.sort", "min", "proposals.clone", "bbox.bbox_mapping_back", "recovered_proposals.append"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.nms.nms_wrapper.nms", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox_mapping_back"], ["def", "merge_aug_proposals", "(", "aug_proposals", ",", "img_metas", ",", "rpn_test_cfg", ")", ":", "\n", "    ", "\"\"\"Merge augmented proposals (multiscale, flip, etc.)\n\n    Args:\n        aug_proposals (list[Tensor]): proposals from different testing\n            schemes, shape (n, 5). Note that they are not rescaled to the\n            original image size.\n        img_metas (list[dict]): image info including \"shape_scale\" and \"flip\".\n        rpn_test_cfg (dict): rpn test config.\n\n    Returns:\n        Tensor: shape (n, 4), proposals corresponding to original image scale.\n    \"\"\"", "\n", "recovered_proposals", "=", "[", "]", "\n", "for", "proposals", ",", "img_info", "in", "zip", "(", "aug_proposals", ",", "img_metas", ")", ":", "\n", "        ", "img_shape", "=", "img_info", "[", "'img_shape'", "]", "\n", "scale_factor", "=", "img_info", "[", "'scale_factor'", "]", "\n", "flip", "=", "img_info", "[", "'flip'", "]", "\n", "_proposals", "=", "proposals", ".", "clone", "(", ")", "\n", "_proposals", "[", ":", ",", ":", "4", "]", "=", "bbox_mapping_back", "(", "_proposals", "[", ":", ",", ":", "4", "]", ",", "img_shape", ",", "\n", "scale_factor", ",", "flip", ")", "\n", "recovered_proposals", ".", "append", "(", "_proposals", ")", "\n", "", "aug_proposals", "=", "torch", ".", "cat", "(", "recovered_proposals", ",", "dim", "=", "0", ")", "\n", "merged_proposals", ",", "_", "=", "nms", "(", "aug_proposals", ",", "rpn_test_cfg", ".", "nms_thr", ")", "\n", "scores", "=", "merged_proposals", "[", ":", ",", "4", "]", "\n", "_", ",", "order", "=", "scores", ".", "sort", "(", "0", ",", "descending", "=", "True", ")", "\n", "num", "=", "min", "(", "rpn_test_cfg", ".", "max_num", ",", "merged_proposals", ".", "shape", "[", "0", "]", ")", "\n", "order", "=", "order", "[", ":", "num", "]", "\n", "merged_proposals", "=", "merged_proposals", "[", "order", ",", ":", "]", "\n", "return", "merged_proposals", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.post_processing.merge_augs.merge_aug_bboxes": [[41, 66], ["zip", "torch.stack().mean", "bbox.bbox_mapping_back", "recovered_bboxes.append", "torch.stack().mean", "torch.stack", "torch.stack"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox_mapping_back"], ["", "def", "merge_aug_bboxes", "(", "aug_bboxes", ",", "aug_scores", ",", "img_metas", ",", "rcnn_test_cfg", ")", ":", "\n", "    ", "\"\"\"Merge augmented detection bboxes and scores.\n\n    Args:\n        aug_bboxes (list[Tensor]): shape (n, 4*#class)\n        aug_scores (list[Tensor] or None): shape (n, #class)\n        img_shapes (list[Tensor]): shape (3, ).\n        rcnn_test_cfg (dict): rcnn test config.\n\n    Returns:\n        tuple: (bboxes, scores)\n    \"\"\"", "\n", "recovered_bboxes", "=", "[", "]", "\n", "for", "bboxes", ",", "img_info", "in", "zip", "(", "aug_bboxes", ",", "img_metas", ")", ":", "\n", "        ", "img_shape", "=", "img_info", "[", "0", "]", "[", "'img_shape'", "]", "\n", "scale_factor", "=", "img_info", "[", "0", "]", "[", "'scale_factor'", "]", "\n", "flip", "=", "img_info", "[", "0", "]", "[", "'flip'", "]", "\n", "bboxes", "=", "bbox_mapping_back", "(", "bboxes", ",", "img_shape", ",", "scale_factor", ",", "flip", ")", "\n", "recovered_bboxes", ".", "append", "(", "bboxes", ")", "\n", "", "bboxes", "=", "torch", ".", "stack", "(", "recovered_bboxes", ")", ".", "mean", "(", "dim", "=", "0", ")", "\n", "if", "aug_scores", "is", "None", ":", "\n", "        ", "return", "bboxes", "\n", "", "else", ":", "\n", "        ", "scores", "=", "torch", ".", "stack", "(", "aug_scores", ")", ".", "mean", "(", "dim", "=", "0", ")", "\n", "return", "bboxes", ",", "scores", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.post_processing.merge_augs.merge_aug_scores": [[68, 74], ["isinstance", "torch.mean", "numpy.mean", "torch.stack"], "function", ["None"], ["", "", "def", "merge_aug_scores", "(", "aug_scores", ")", ":", "\n", "    ", "\"\"\"Merge augmented bbox scores.\"\"\"", "\n", "if", "isinstance", "(", "aug_scores", "[", "0", "]", ",", "torch", ".", "Tensor", ")", ":", "\n", "        ", "return", "torch", ".", "mean", "(", "torch", ".", "stack", "(", "aug_scores", ")", ",", "dim", "=", "0", ")", "\n", "", "else", ":", "\n", "        ", "return", "np", ".", "mean", "(", "aug_scores", ",", "axis", "=", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.post_processing.merge_augs.merge_aug_masks": [[76, 97], ["numpy.mean", "numpy.average", "zip", "numpy.array", "numpy.array"], "function", ["None"], ["", "", "def", "merge_aug_masks", "(", "aug_masks", ",", "img_metas", ",", "rcnn_test_cfg", ",", "weights", "=", "None", ")", ":", "\n", "    ", "\"\"\"Merge augmented mask prediction.\n\n    Args:\n        aug_masks (list[ndarray]): shape (n, #class, h, w)\n        img_shapes (list[ndarray]): shape (3, ).\n        rcnn_test_cfg (dict): rcnn test config.\n\n    Returns:\n        tuple: (bboxes, scores)\n    \"\"\"", "\n", "recovered_masks", "=", "[", "\n", "mask", "if", "not", "img_info", "[", "0", "]", "[", "'flip'", "]", "else", "mask", "[", "...", ",", ":", ":", "-", "1", "]", "\n", "for", "mask", ",", "img_info", "in", "zip", "(", "aug_masks", ",", "img_metas", ")", "\n", "]", "\n", "if", "weights", "is", "None", ":", "\n", "        ", "merged_masks", "=", "np", ".", "mean", "(", "recovered_masks", ",", "axis", "=", "0", ")", "\n", "", "else", ":", "\n", "        ", "merged_masks", "=", "np", ".", "average", "(", "\n", "np", ".", "array", "(", "recovered_masks", ")", ",", "axis", "=", "0", ",", "weights", "=", "np", ".", "array", "(", "weights", ")", ")", "\n", "", "return", "merged_masks", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.post_processing.bbox_nms.multiclass_nms": [[6, 68], ["nms_cfg.copy", "nms_cfg.copy.pop", "getattr", "range", "torch.cat", "getattr.", "multi_bboxes.new_full", "multi_bboxes.new_zeros.append", "multi_bboxes.new_zeros.append", "torch.cat", "torch.cat", "multi_bboxes.new_zeros", "multi_bboxes.new_zeros", "cls_inds.any", "bboxes[].sort"], "function", ["None"], ["def", "multiclass_nms", "(", "multi_bboxes", ",", "\n", "multi_scores", ",", "\n", "score_thr", ",", "\n", "nms_cfg", ",", "\n", "max_num", "=", "-", "1", ",", "\n", "score_factors", "=", "None", ")", ":", "\n", "    ", "\"\"\"NMS for multi-class bboxes. nms will be applied to each category respectively.\n\n    Args:\n        multi_bboxes (Tensor): shape (n, #class*4) or (n, 4)\n        multi_scores (Tensor): shape (n, #class) class=C+1\n        score_thr (float): bbox threshold, bboxes with scores lower than it\n            will not be considered.\n        nms_thr (float): NMS IoU threshold\n        max_num (int): if there are more than max_num bboxes after NMS,\n            only top max_num will be kept.\n        score_factors (Tensor): The factors multiplied to scores before\n            applying NMS\n\n    Returns:\n        tuple: (bboxes, labels), tensors of shape (k, 5) and (k, 1). Labels\n            are 0-based.\n    \"\"\"", "\n", "num_classes", "=", "multi_scores", ".", "shape", "[", "1", "]", "\n", "bboxes", ",", "labels", "=", "[", "]", ",", "[", "]", "\n", "nms_cfg_", "=", "nms_cfg", ".", "copy", "(", ")", "\n", "nms_type", "=", "nms_cfg_", ".", "pop", "(", "'type'", ",", "'nms'", ")", "\n", "nms_op", "=", "getattr", "(", "nms_wrapper", ",", "nms_type", ")", "\n", "# apply nms to each category respectively. a detected box may have multiple", "\n", "# class labels.", "\n", "for", "i", "in", "range", "(", "1", ",", "num_classes", ")", ":", "\n", "        ", "cls_inds", "=", "multi_scores", "[", ":", ",", "i", "]", ">", "score_thr", "\n", "if", "not", "cls_inds", ".", "any", "(", ")", ":", "\n", "            ", "continue", "\n", "# get bboxes and scores of this class", "\n", "", "if", "multi_bboxes", ".", "shape", "[", "1", "]", "==", "4", ":", "\n", "            ", "_bboxes", "=", "multi_bboxes", "[", "cls_inds", ",", ":", "]", "\n", "", "else", ":", "\n", "            ", "_bboxes", "=", "multi_bboxes", "[", "cls_inds", ",", "i", "*", "4", ":", "(", "i", "+", "1", ")", "*", "4", "]", "\n", "", "_scores", "=", "multi_scores", "[", "cls_inds", ",", "i", "]", "\n", "if", "score_factors", "is", "not", "None", ":", "\n", "            ", "_scores", "*=", "score_factors", "[", "cls_inds", "]", "\n", "", "cls_dets", "=", "torch", ".", "cat", "(", "[", "_bboxes", ",", "_scores", "[", ":", ",", "None", "]", "]", ",", "dim", "=", "1", ")", "# (n, 5)", "\n", "# (m,5), the boxes after nms", "\n", "cls_dets", ",", "_", "=", "nms_op", "(", "cls_dets", ",", "**", "nms_cfg_", ")", "\n", "cls_labels", "=", "multi_bboxes", ".", "new_full", "(", "\n", "(", "cls_dets", ".", "shape", "[", "0", "]", ",", ")", ",", "i", "-", "1", ",", "dtype", "=", "torch", ".", "long", ")", "# (n,1)", "\n", "bboxes", ".", "append", "(", "cls_dets", ")", "\n", "labels", ".", "append", "(", "cls_labels", ")", "\n", "", "if", "bboxes", ":", "\n", "        ", "bboxes", "=", "torch", ".", "cat", "(", "bboxes", ")", "\n", "labels", "=", "torch", ".", "cat", "(", "labels", ")", "\n", "if", "bboxes", ".", "shape", "[", "0", "]", ">", "max_num", ":", "\n", "            ", "_", ",", "inds", "=", "bboxes", "[", ":", ",", "-", "1", "]", ".", "sort", "(", "descending", "=", "True", ")", "\n", "inds", "=", "inds", "[", ":", "max_num", "]", "\n", "bboxes", "=", "bboxes", "[", "inds", "]", "\n", "labels", "=", "labels", "[", "inds", "]", "\n", "", "", "else", ":", "\n", "        ", "bboxes", "=", "multi_bboxes", ".", "new_zeros", "(", "(", "0", ",", "5", ")", ")", "\n", "labels", "=", "multi_bboxes", ".", "new_zeros", "(", "(", "0", ",", ")", ",", "dtype", "=", "torch", ".", "long", ")", "\n", "\n", "", "return", "bboxes", ",", "labels", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask.mask_target.mask_target": [[6, 13], ["map", "torch.cat", "list", "range", "len"], "function", ["None"], ["def", "mask_target", "(", "pos_proposals_list", ",", "pos_assigned_gt_inds_list", ",", "gt_masks_list", ",", "\n", "cfg", ")", ":", "\n", "    ", "cfg_list", "=", "[", "cfg", "for", "_", "in", "range", "(", "len", "(", "pos_proposals_list", ")", ")", "]", "\n", "mask_targets", "=", "map", "(", "mask_target_single", ",", "pos_proposals_list", ",", "\n", "pos_assigned_gt_inds_list", ",", "gt_masks_list", ",", "cfg_list", ")", "\n", "mask_targets", "=", "torch", ".", "cat", "(", "list", "(", "mask_targets", ")", ")", "\n", "return", "mask_targets", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask.mask_target.mask_target_single": [[15, 37], ["pos_proposals.size", "pos_proposals.cpu().numpy", "pos_assigned_gt_inds.cpu().numpy.cpu().numpy", "range", "torch.from_numpy().float().to", "pos_proposals.new_zeros", "proposals_np[].astype", "numpy.maximum", "numpy.maximum", "mmcv.imresize", "pos_proposals.new_zeros.append", "pos_proposals.cpu", "pos_assigned_gt_inds.cpu().numpy.cpu", "torch.from_numpy().float", "torch.from_numpy", "numpy.stack"], "function", ["None"], ["", "def", "mask_target_single", "(", "pos_proposals", ",", "pos_assigned_gt_inds", ",", "gt_masks", ",", "cfg", ")", ":", "\n", "    ", "mask_size", "=", "cfg", ".", "mask_size", "\n", "num_pos", "=", "pos_proposals", ".", "size", "(", "0", ")", "\n", "mask_targets", "=", "[", "]", "\n", "if", "num_pos", ">", "0", ":", "\n", "        ", "proposals_np", "=", "pos_proposals", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "pos_assigned_gt_inds", "=", "pos_assigned_gt_inds", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "for", "i", "in", "range", "(", "num_pos", ")", ":", "\n", "            ", "gt_mask", "=", "gt_masks", "[", "pos_assigned_gt_inds", "[", "i", "]", "]", "\n", "bbox", "=", "proposals_np", "[", "i", ",", ":", "]", ".", "astype", "(", "np", ".", "int32", ")", "\n", "x1", ",", "y1", ",", "x2", ",", "y2", "=", "bbox", "\n", "w", "=", "np", ".", "maximum", "(", "x2", "-", "x1", "+", "1", ",", "1", ")", "\n", "h", "=", "np", ".", "maximum", "(", "y2", "-", "y1", "+", "1", ",", "1", ")", "\n", "# mask is uint8 both before and after resizing", "\n", "target", "=", "mmcv", ".", "imresize", "(", "gt_mask", "[", "y1", ":", "y1", "+", "h", ",", "x1", ":", "x1", "+", "w", "]", ",", "\n", "(", "mask_size", ",", "mask_size", ")", ")", "\n", "mask_targets", ".", "append", "(", "target", ")", "\n", "", "mask_targets", "=", "torch", ".", "from_numpy", "(", "np", ".", "stack", "(", "mask_targets", ")", ")", ".", "float", "(", ")", ".", "to", "(", "\n", "pos_proposals", ".", "device", ")", "\n", "", "else", ":", "\n", "        ", "mask_targets", "=", "pos_proposals", ".", "new_zeros", "(", "(", "0", ",", "mask_size", ",", "mask_size", ")", ")", "\n", "", "return", "mask_targets", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.mask.utils.split_combined_polys": [[4, 31], ["range", "len", "poly_lens[].tolist", "polys_per_mask[].tolist", "mmcv.slice_list", "mmcv.slice_list", "mask_polys_list.append"], "function", ["None"], ["import", "mmcv", "\n", "from", "mmcv", ".", "runner", "import", "obj_from_dict", "\n", "import", "torch", "\n", "\n", "import", "matplotlib", ".", "pyplot", "as", "plt", "\n", "import", "numpy", "as", "np", "\n", "from", ".", "concat_dataset", "import", "ConcatDataset", "\n", "from", ".", "repeat_dataset", "import", "RepeatDataset", "\n", "from", ".", ".", "import", "datasets", "\n", "\n", "\n", "def", "to_tensor", "(", "data", ")", ":", "\n", "    ", "\"\"\"Convert objects of various python types to :obj:`torch.Tensor`.\n\n    Supported types are: :class:`numpy.ndarray`, :class:`torch.Tensor`,\n    :class:`Sequence`, :class:`int` and :class:`float`.\n    \"\"\"", "\n", "if", "isinstance", "(", "data", ",", "torch", ".", "Tensor", ")", ":", "\n", "        ", "return", "data", "\n", "", "elif", "isinstance", "(", "data", ",", "np", ".", "ndarray", ")", ":", "\n", "        ", "return", "torch", ".", "from_numpy", "(", "data", ")", "\n", "", "elif", "isinstance", "(", "data", ",", "Sequence", ")", "and", "not", "mmcv", ".", "is_str", "(", "data", ")", ":", "\n", "        ", "return", "torch", ".", "tensor", "(", "data", ")", "\n", "", "elif", "isinstance", "(", "data", ",", "int", ")", ":", "\n", "        ", "return", "torch", ".", "LongTensor", "(", "[", "data", "]", ")", "\n", "", "elif", "isinstance", "(", "data", ",", "float", ")", ":", "\n", "        ", "return", "torch", ".", "FloatTensor", "(", "[", "data", "]", ")", "\n", "", "else", ":", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_generator.AnchorGenerator.__init__": [[6, 13], ["torch.Tensor", "torch.Tensor", "anchor_generator.AnchorGenerator.gen_base_anchors"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_generator.AnchorGenerator.gen_base_anchors"], ["    ", "def", "__init__", "(", "self", ",", "base_size", ",", "scales", ",", "ratios", ",", "scale_major", "=", "True", ",", "ctr", "=", "None", ")", ":", "\n", "        ", "self", ".", "base_size", "=", "base_size", "\n", "self", ".", "scales", "=", "torch", ".", "Tensor", "(", "scales", ")", "\n", "self", ".", "ratios", "=", "torch", ".", "Tensor", "(", "ratios", ")", "\n", "self", ".", "scale_major", "=", "scale_major", "\n", "self", ".", "ctr", "=", "ctr", "\n", "self", ".", "base_anchors", "=", "self", ".", "gen_base_anchors", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_generator.AnchorGenerator.num_base_anchors": [[14, 17], ["anchor_generator.AnchorGenerator.base_anchors.size"], "methods", ["None"], ["", "@", "property", "\n", "def", "num_base_anchors", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "base_anchors", ".", "size", "(", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_generator.AnchorGenerator.gen_base_anchors": [[18, 44], ["torch.sqrt", "torch.stack().round", "torch.stack"], "methods", ["None"], ["", "def", "gen_base_anchors", "(", "self", ")", ":", "\n", "        ", "w", "=", "self", ".", "base_size", "\n", "h", "=", "self", ".", "base_size", "\n", "if", "self", ".", "ctr", "is", "None", ":", "\n", "            ", "x_ctr", "=", "0.5", "*", "(", "w", "-", "1", ")", "\n", "y_ctr", "=", "0.5", "*", "(", "h", "-", "1", ")", "\n", "", "else", ":", "\n", "            ", "x_ctr", ",", "y_ctr", "=", "self", ".", "ctr", "\n", "\n", "", "h_ratios", "=", "torch", ".", "sqrt", "(", "self", ".", "ratios", ")", "\n", "w_ratios", "=", "1", "/", "h_ratios", "\n", "if", "self", ".", "scale_major", ":", "\n", "            ", "ws", "=", "(", "w", "*", "w_ratios", "[", ":", ",", "None", "]", "*", "self", ".", "scales", "[", "None", ",", ":", "]", ")", ".", "view", "(", "-", "1", ")", "\n", "hs", "=", "(", "h", "*", "h_ratios", "[", ":", ",", "None", "]", "*", "self", ".", "scales", "[", "None", ",", ":", "]", ")", ".", "view", "(", "-", "1", ")", "\n", "", "else", ":", "\n", "            ", "ws", "=", "(", "w", "*", "self", ".", "scales", "[", ":", ",", "None", "]", "*", "w_ratios", "[", "None", ",", ":", "]", ")", ".", "view", "(", "-", "1", ")", "\n", "hs", "=", "(", "h", "*", "self", ".", "scales", "[", ":", ",", "None", "]", "*", "h_ratios", "[", "None", ",", ":", "]", ")", ".", "view", "(", "-", "1", ")", "\n", "\n", "", "base_anchors", "=", "torch", ".", "stack", "(", "\n", "[", "\n", "x_ctr", "-", "0.5", "*", "(", "ws", "-", "1", ")", ",", "y_ctr", "-", "0.5", "*", "(", "hs", "-", "1", ")", ",", "\n", "x_ctr", "+", "0.5", "*", "(", "ws", "-", "1", ")", ",", "y_ctr", "+", "0.5", "*", "(", "hs", "-", "1", ")", "\n", "]", ",", "\n", "dim", "=", "-", "1", ")", ".", "round", "(", ")", "\n", "\n", "return", "base_anchors", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_generator.AnchorGenerator._meshgrid": [[45, 52], ["x.repeat", "y.view().repeat().view", "len", "y.view().repeat", "len", "y.view"], "methods", ["None"], ["", "def", "_meshgrid", "(", "self", ",", "x", ",", "y", ",", "row_major", "=", "True", ")", ":", "\n", "        ", "xx", "=", "x", ".", "repeat", "(", "len", "(", "y", ")", ")", "\n", "yy", "=", "y", ".", "view", "(", "-", "1", ",", "1", ")", ".", "repeat", "(", "1", ",", "len", "(", "x", ")", ")", ".", "view", "(", "-", "1", ")", "\n", "if", "row_major", ":", "\n", "            ", "return", "xx", ",", "yy", "\n", "", "else", ":", "\n", "            ", "return", "yy", ",", "xx", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_generator.AnchorGenerator.grid_anchors": [[53, 71], ["anchor_generator.AnchorGenerator.base_anchors.to", "anchor_generator.AnchorGenerator._meshgrid", "torch.stack", "shifts.type_as.type_as.type_as", "all_anchors.view.view.view", "torch.arange", "torch.arange"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_generator.AnchorGenerator._meshgrid"], ["", "", "def", "grid_anchors", "(", "self", ",", "featmap_size", ",", "stride", "=", "16", ",", "device", "=", "'cuda'", ")", ":", "\n", "        ", "base_anchors", "=", "self", ".", "base_anchors", ".", "to", "(", "device", ")", "\n", "\n", "feat_h", ",", "feat_w", "=", "featmap_size", "\n", "shift_x", "=", "torch", ".", "arange", "(", "0", ",", "feat_w", ",", "device", "=", "device", ")", "*", "stride", "\n", "shift_y", "=", "torch", ".", "arange", "(", "0", ",", "feat_h", ",", "device", "=", "device", ")", "*", "stride", "\n", "shift_xx", ",", "shift_yy", "=", "self", ".", "_meshgrid", "(", "shift_x", ",", "shift_y", ")", "\n", "shifts", "=", "torch", ".", "stack", "(", "[", "shift_xx", ",", "shift_yy", ",", "shift_xx", ",", "shift_yy", "]", ",", "dim", "=", "-", "1", ")", "\n", "shifts", "=", "shifts", ".", "type_as", "(", "base_anchors", ")", "\n", "# first feat_w elements correspond to the first row of shifts", "\n", "# add A anchors (1, A, 4) to K shifts (K, 1, 4) to get", "\n", "# shifted anchors (K, A, 4), reshape to (K*A, 4)", "\n", "\n", "all_anchors", "=", "base_anchors", "[", "None", ",", ":", ",", ":", "]", "+", "shifts", "[", ":", ",", "None", ",", ":", "]", "\n", "all_anchors", "=", "all_anchors", ".", "view", "(", "-", "1", ",", "4", ")", "\n", "# first A rows correspond to A anchors of (0, 0) in feature map,", "\n", "# then (0, 1), (0, 2), ...", "\n", "return", "all_anchors", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_generator.AnchorGenerator.valid_flags": [[72, 85], ["torch.zeros", "torch.zeros", "anchor_generator.AnchorGenerator._meshgrid", "valid[].expand().contiguous().view", "valid[].expand().contiguous", "valid[].expand", "valid[].expand().contiguous().view.size"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_generator.AnchorGenerator._meshgrid"], ["", "def", "valid_flags", "(", "self", ",", "featmap_size", ",", "valid_size", ",", "device", "=", "'cuda'", ")", ":", "\n", "        ", "feat_h", ",", "feat_w", "=", "featmap_size", "\n", "valid_h", ",", "valid_w", "=", "valid_size", "\n", "assert", "valid_h", "<=", "feat_h", "and", "valid_w", "<=", "feat_w", "\n", "valid_x", "=", "torch", ".", "zeros", "(", "feat_w", ",", "dtype", "=", "torch", ".", "uint8", ",", "device", "=", "device", ")", "\n", "valid_y", "=", "torch", ".", "zeros", "(", "feat_h", ",", "dtype", "=", "torch", ".", "uint8", ",", "device", "=", "device", ")", "\n", "valid_x", "[", ":", "valid_w", "]", "=", "1", "\n", "valid_y", "[", ":", "valid_h", "]", "=", "1", "\n", "valid_xx", ",", "valid_yy", "=", "self", ".", "_meshgrid", "(", "valid_x", ",", "valid_y", ")", "\n", "valid", "=", "valid_xx", "&", "valid_yy", "\n", "valid", "=", "valid", "[", ":", ",", "None", "]", ".", "expand", "(", "\n", "valid", ".", "size", "(", "0", ")", ",", "self", ".", "num_base_anchors", ")", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ")", "\n", "return", "valid", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.anchor_target": [[7, 108], ["len", "range", "utils.multi_apply", "any", "sum", "sum", "anchor_target.images_to_levels", "anchor_target.images_to_levels", "anchor_target.images_to_levels", "anchor_target.images_to_levels", "anchor_target.images_to_levels", "len", "len", "anchors.size", "torch.cat", "torch.cat", "len", "len", "max", "max", "range", "range", "inds.numel", "inds.numel"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.multi_apply", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.images_to_levels", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.images_to_levels", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.images_to_levels", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.images_to_levels", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.images_to_levels"], ["def", "anchor_target", "(", "anchor_list", ",", "\n", "valid_flag_list", ",", "\n", "gt_bboxes_list", ",", "\n", "img_metas", ",", "\n", "target_means", ",", "\n", "target_stds", ",", "\n", "cfg", ",", "\n", "gt_bboxes_ignore_list", "=", "None", ",", "\n", "gt_labels_list", "=", "None", ",", "\n", "label_channels", "=", "1", ",", "\n", "sampling", "=", "True", ",", "\n", "unmap_outputs", "=", "True", ")", ":", "\n", "    ", "\"\"\"Compute regression and classification targets for anchors.\n\n    Args:\n        anchor_list (list[list]): Multi level anchors of each image. anchor_list[i][j] represent the anchor set for the\n            j-th level of feature pyramid of the i-th image and anchor_list[i][j].shape = (num_anchors, 4)\n        valid_flag_list (list[list]): Multi level valid flags of each image.\n        gt_bboxes_list (list[Tensor]): Ground truth bboxes of each image. gt_bboxes_list[i].size() = (num_truth, 4)\n        img_metas (list[dict]): Meta info of each image.\n        target_means (Iterable): Mean value of regression targets.\n        target_stds (Iterable): Std value of regression targets.\n        cfg (dict): RPN train configs.\n\n    Returns:\n        tuple\n        labels_list: list of tensors. len(labels_list) equals to the num of layers of the feature pyramid and the\n            labels_list[i].size() = (batch, A*width_i*height_i). class labels(1,2,...) for positives and 0 for the others.\n        label_weights_list: the same as labels_list. 1 for positives and negatives, 0 for the others(invalid anchors and neutrals)\n        bbox_targets_list: list of tensors. len(bbox_targets_list) equals to the num of layers of the feature pyramid\n             and the bbox_targets_list[i].size() = (batch, A*width_i*height_i, 4). regression targets for positives and\n             0 for the others\n        bbox_weights_list: the same as bbox_targets_list. 1 for positive anchors, 0 for the others.\n        num_total_pos: the number of positive examples in the batch;\n        num_total_neg: the number of negative examples in the batch;\n        level_anchor_list: list[Tensor]. level_anchor_list[i].size() is (batch, A*width_i*height_i, 4). store the original\n             anchors.\n    \"\"\"", "\n", "num_imgs", "=", "len", "(", "img_metas", ")", "\n", "assert", "len", "(", "anchor_list", ")", "==", "len", "(", "valid_flag_list", ")", "==", "num_imgs", "\n", "\n", "# the numbers of anchors for each feature pyramid level", "\n", "num_level_anchors", "=", "[", "anchors", ".", "size", "(", "0", ")", "for", "anchors", "in", "anchor_list", "[", "0", "]", "]", "\n", "# concat all level anchors and flags to a single tensor", "\n", "# After tihs, anchor_list[i] is transformed from a list to a tensor and", "\n", "# anchor_list[i].shape equal to (num_anchors, 4), representing all the", "\n", "# anchors for the i-th image.", "\n", "for", "i", "in", "range", "(", "num_imgs", ")", ":", "\n", "        ", "assert", "len", "(", "anchor_list", "[", "i", "]", ")", "==", "len", "(", "valid_flag_list", "[", "i", "]", ")", "\n", "anchor_list", "[", "i", "]", "=", "torch", ".", "cat", "(", "anchor_list", "[", "i", "]", ")", "\n", "valid_flag_list", "[", "i", "]", "=", "torch", ".", "cat", "(", "valid_flag_list", "[", "i", "]", ")", "\n", "\n", "# compute targets for each image", "\n", "", "if", "gt_bboxes_ignore_list", "is", "None", ":", "\n", "        ", "gt_bboxes_ignore_list", "=", "[", "None", "for", "_", "in", "range", "(", "num_imgs", ")", "]", "\n", "", "if", "gt_labels_list", "is", "None", ":", "\n", "        ", "gt_labels_list", "=", "[", "None", "for", "_", "in", "range", "(", "num_imgs", ")", "]", "\n", "# all_labels: list[Tensor], all_labels[i].size() is (num_anchors) and stores the labels for all the", "\n", "#       anchors(valid and invalid) in the i-th image. 1,2...num_class for pos, 0 for the others", "\n", "# all_label_weights: list[Tensor], all_label_weights[i].size() is (num_anchors)", "\n", "#       1 for positives and negatives, 0 for the others(invalid anchors and neutrals)", "\n", "# all_bbox_targets: list[Tensor], all_bbox_targets[i].size() is (num_anchors, 4). the regression target", "\n", "#       for the positives, 0 for the others.", "\n", "# all_bbox_weights: list[Tensor], all_bbox_weights[i].size() is (num_anchors, 4). 1 for positive anchors,", "\n", "#      0 for others.", "\n", "", "(", "all_labels", ",", "all_label_weights", ",", "all_bbox_targets", ",", "all_bbox_weights", ",", "\n", "pos_inds_list", ",", "neg_inds_list", ")", "=", "multi_apply", "(", "\n", "anchor_target_single", ",", "# process each image respectively", "\n", "anchor_list", ",", "\n", "valid_flag_list", ",", "\n", "gt_bboxes_list", ",", "\n", "gt_bboxes_ignore_list", ",", "\n", "gt_labels_list", ",", "\n", "img_metas", ",", "\n", "target_means", "=", "target_means", ",", "\n", "target_stds", "=", "target_stds", ",", "\n", "cfg", "=", "cfg", ",", "\n", "label_channels", "=", "label_channels", ",", "\n", "sampling", "=", "sampling", ",", "\n", "unmap_outputs", "=", "unmap_outputs", ")", "\n", "# no valid anchors", "\n", "if", "any", "(", "[", "labels", "is", "None", "for", "labels", "in", "all_labels", "]", ")", ":", "\n", "        ", "return", "None", "\n", "# sampled anchors of all images", "\n", "# added by WSK", "\n", "# for each image, if the number of positives or negatives is 0, then adopt 1 for these two value", "\n", "# As a result, for a batch of image, num_total_pos >= num_images and num_total_neg >= num_images", "\n", "", "num_total_pos", "=", "sum", "(", "[", "max", "(", "inds", ".", "numel", "(", ")", ",", "1", ")", "for", "inds", "in", "pos_inds_list", "]", ")", "\n", "num_total_neg", "=", "sum", "(", "[", "max", "(", "inds", ".", "numel", "(", ")", ",", "1", ")", "for", "inds", "in", "neg_inds_list", "]", ")", "\n", "\n", "# split targets to a list w.r.t. multiple levels", "\n", "labels_list", "=", "images_to_levels", "(", "all_labels", ",", "num_level_anchors", ")", "\n", "label_weights_list", "=", "images_to_levels", "(", "all_label_weights", ",", "num_level_anchors", ")", "\n", "bbox_targets_list", "=", "images_to_levels", "(", "all_bbox_targets", ",", "num_level_anchors", ")", "\n", "bbox_weights_list", "=", "images_to_levels", "(", "all_bbox_weights", ",", "num_level_anchors", ")", "\n", "\n", "# add by Shengkai Wu", "\n", "level_anchor_list", "=", "images_to_levels", "(", "anchor_list", ",", "num_level_anchors", ")", "\n", "\n", "return", "(", "labels_list", ",", "label_weights_list", ",", "bbox_targets_list", ",", "bbox_weights_list", ",", "num_total_pos", ",", "num_total_neg", ",", "\n", "level_anchor_list", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.images_to_levels": [[110, 127], ["torch.stack", "level_targets.append", "target[].squeeze"], "function", ["None"], ["", "def", "images_to_levels", "(", "target", ",", "num_level_anchors", ")", ":", "\n", "    ", "\"\"\"Convert targets by image to targets by feature level.\n\n    [target_img0, target_img1] -> [target_level0, target_level1, ...]\n    target: list[Tensor], target[i].size() = (num_anchors,) for the i-th image;\n    num_level_anchors: list of numbers, store the numbers of anchors of each level;\n\n    level_targets[i].size() = (batch_size, A*width_i*height_i, ) for the i-th level of FPN\n    \"\"\"", "\n", "target", "=", "torch", ".", "stack", "(", "target", ",", "0", ")", "# (batch_size, num_anchors, )", "\n", "level_targets", "=", "[", "]", "\n", "start", "=", "0", "\n", "for", "n", "in", "num_level_anchors", ":", "\n", "        ", "end", "=", "start", "+", "n", "\n", "level_targets", ".", "append", "(", "target", "[", ":", ",", "start", ":", "end", "]", ".", "squeeze", "(", "0", ")", ")", "\n", "start", "=", "end", "\n", "", "return", "level_targets", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.anchor_target_single": [[129, 243], ["anchor_target.anchor_inside_flags", "torch.zeros_like", "torch.zeros_like", "anchors.new_zeros", "anchors.new_zeros", "anchor_inside_flags.any", "bbox.assign_and_sample", "bbox.build_assigner", "bbox.build_assigner.assign", "bbox.PseudoSampler", "bbox.PseudoSampler.sample", "len", "bbox.bbox2delta", "len", "flat_anchors.size", "anchor_target.unmap", "anchor_target.unmap", "anchor_target.unmap", "anchor_target.unmap"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.anchor_inside_flags", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.assign_sampling.assign_and_sample", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.assign_sampling.build_assigner", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.max_iou_assigner.MaxIoUAssigner.assign", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.pseudo_sampler.PseudoSampler.sample", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2delta", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.unmap", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.unmap", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.unmap", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.unmap"], ["", "def", "anchor_target_single", "(", "flat_anchors", ",", "\n", "valid_flags", ",", "\n", "gt_bboxes", ",", "\n", "gt_bboxes_ignore", ",", "\n", "gt_labels", ",", "\n", "img_meta", ",", "\n", "target_means", ",", "\n", "target_stds", ",", "\n", "cfg", ",", "\n", "label_channels", "=", "1", ",", "\n", "sampling", "=", "True", ",", "\n", "unmap_outputs", "=", "True", ")", ":", "\n", "    ", "\"\"\"\n\n    :param flat_anchors: tensor of shape (num_anchors, 4), representing all the anchors for a image.\n    :param valid_flags: tensor of shape (num_anchors), representing all the anchors' flags for a image.\n          1 represents valid anchor and 0 represents invalid anchor.\n    :param gt_bboxes: tensor of shape (num_truth, 4), representing all the ground truth boxes for a image.\n    :param gt_bboxes_ignore: tensor\n    :param gt_labels: tensor\n    :param img_meta: dict\n    :param target_means:\n    :param target_stds:\n    :param cfg:\n    :param label_channels:\n    :param sampling: whether to sample a subset examples from positive examples and negative examples.\n    :param unmap_outputs:\n    :return:\n        labels: tensor of shape (num_anchors). num_anchors is the number of all anchors.\n              store class label such as 1, 2 for positive examples and 0 for negatives or others\n        label_weights: (num_anchors), 1 for positives and negatives, 0 for the others(invalid anchors and neutrals)\n        bbox_targets: (num_anchors, 4), regression target(encoded ground truth box) for the positives\n              and 0 for others.\n        bbox_weights: (num_anchors, 4), 1 for positives and 0 for others.\n        pos_inds: (num_pos), indexes of positive anchors;\n        neg_inds: (num_neg), indexes of negative anchors;\n\n    \"\"\"", "\n", "# tensor of size(): (num_anchors), 1 for valid anchor, 0 for invalid anchor.", "\n", "inside_flags", "=", "anchor_inside_flags", "(", "flat_anchors", ",", "valid_flags", ",", "\n", "img_meta", "[", "'img_shape'", "]", "[", ":", "2", "]", ",", "\n", "cfg", ".", "allowed_border", ")", "\n", "if", "not", "inside_flags", ".", "any", "(", ")", ":", "\n", "        ", "return", "(", "None", ",", ")", "*", "6", "\n", "# assign gt and sample anchors", "\n", "\n", "# only the valid anchors are kept and the invalid anchors are discarded.", "\n", "# For example, flat_anchors.size()=(102123, 4), valid_flags.size()=(102123)", "\n", "# anchors.size()=(69354, 4).", "\n", "", "anchors", "=", "flat_anchors", "[", "inside_flags", ",", ":", "]", "\n", "\n", "if", "sampling", ":", "\n", "        ", "assign_result", ",", "sampling_result", "=", "assign_and_sample", "(", "\n", "anchors", ",", "gt_bboxes", ",", "gt_bboxes_ignore", ",", "None", ",", "cfg", ")", "\n", "", "else", ":", "\n", "        ", "bbox_assigner", "=", "build_assigner", "(", "cfg", ".", "assigner", ")", "\n", "assign_result", "=", "bbox_assigner", ".", "assign", "(", "anchors", ",", "gt_bboxes", ",", "\n", "gt_bboxes_ignore", ",", "gt_labels", ")", "\n", "bbox_sampler", "=", "PseudoSampler", "(", ")", "\n", "sampling_result", "=", "bbox_sampler", ".", "sample", "(", "assign_result", ",", "anchors", ",", "\n", "gt_bboxes", ")", "\n", "", "pos_inds", "=", "sampling_result", ".", "pos_inds", "# (num_pos), indexes of positive anchors", "\n", "neg_inds", "=", "sampling_result", ".", "neg_inds", "# (num_neg), indexes of negative anchors", "\n", "\n", "num_valid_anchors", "=", "anchors", ".", "shape", "[", "0", "]", "\n", "bbox_targets", "=", "torch", ".", "zeros_like", "(", "anchors", ")", "\n", "bbox_weights", "=", "torch", ".", "zeros_like", "(", "anchors", ")", "\n", "labels", "=", "anchors", ".", "new_zeros", "(", "num_valid_anchors", ",", "dtype", "=", "torch", ".", "long", ")", "\n", "label_weights", "=", "anchors", ".", "new_zeros", "(", "num_valid_anchors", ",", "dtype", "=", "torch", ".", "float", ")", "\n", "\n", "\n", "if", "len", "(", "pos_inds", ")", ">", "0", ":", "\n", "        ", "pos_bbox_targets", "=", "bbox2delta", "(", "sampling_result", ".", "pos_bboxes", ",", "\n", "sampling_result", ".", "pos_gt_bboxes", ",", "\n", "target_means", ",", "target_stds", ")", "\n", "bbox_targets", "[", "pos_inds", ",", ":", "]", "=", "pos_bbox_targets", "\n", "\n", "# added by Shengkai Wu", "\n", "# store the correspondign anchors for every ground truth box. (x1, y1, x2, y2)", "\n", "# proposals_to_targets[pos_inds, :] =  sampling_result.pos_bboxes", "\n", "bbox_weights", "[", "pos_inds", ",", ":", "]", "=", "1.0", "\n", "\n", "# gt_labels = none is used for rpn", "\n", "if", "gt_labels", "is", "None", ":", "\n", "            ", "labels", "[", "pos_inds", "]", "=", "1", "\n", "", "else", ":", "\n", "# the labels for each positive example", "\n", "            ", "labels", "[", "pos_inds", "]", "=", "gt_labels", "[", "sampling_result", ".", "pos_assigned_gt_inds", "]", "\n", "", "if", "cfg", ".", "pos_weight", "<=", "0", ":", "\n", "            ", "label_weights", "[", "pos_inds", "]", "=", "1.0", "\n", "", "else", ":", "\n", "            ", "label_weights", "[", "pos_inds", "]", "=", "cfg", ".", "pos_weight", "\n", "\n", "", "", "if", "len", "(", "neg_inds", ")", ">", "0", ":", "\n", "\n", "        ", "label_weights", "[", "neg_inds", "]", "=", "1.0", "\n", "\n", "# map up to original set of anchors so that labels has corresponding relation with flat_anchors.", "\n", "", "if", "unmap_outputs", ":", "\n", "        ", "num_total_anchors", "=", "flat_anchors", ".", "size", "(", "0", ")", "\n", "labels", "=", "unmap", "(", "labels", ",", "num_total_anchors", ",", "inside_flags", ")", "\n", "label_weights", "=", "unmap", "(", "label_weights", ",", "num_total_anchors", ",", "inside_flags", ")", "\n", "\n", "# added by Shengkai Wu", "\n", "# the following three line codes are copied from mmdetection-pytorch-0.4.1 and added by Shengkai Wu.", "\n", "# if label_channels > 1:", "\n", "#     labels, label_weights = expand_binary_labels(", "\n", "#         labels, label_weights, label_channels)", "\n", "\n", "bbox_targets", "=", "unmap", "(", "bbox_targets", ",", "num_total_anchors", ",", "inside_flags", ")", "\n", "bbox_weights", "=", "unmap", "(", "bbox_weights", ",", "num_total_anchors", ",", "inside_flags", ")", "\n", "# proposals_to_targets = unmap(proposals_to_targets, num_total_anchors, inside_flags)", "\n", "\n", "", "return", "(", "labels", ",", "label_weights", ",", "bbox_targets", ",", "bbox_weights", ",", "pos_inds", ",", "neg_inds", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.expand_binary_labels": [[247, 255], ["labels.new_full", "torch.nonzero().squeeze", "label_weights.view().expand", "torch.nonzero().squeeze.numel", "label_weights.size", "labels.size", "torch.nonzero", "label_weights.view"], "function", ["None"], ["", "def", "expand_binary_labels", "(", "labels", ",", "label_weights", ",", "label_channels", ")", ":", "\n", "    ", "bin_labels", "=", "labels", ".", "new_full", "(", "(", "labels", ".", "size", "(", "0", ")", ",", "label_channels", ")", ",", "0", ")", "\n", "inds", "=", "torch", ".", "nonzero", "(", "labels", ">=", "1", ")", ".", "squeeze", "(", ")", "\n", "if", "inds", ".", "numel", "(", ")", ">", "0", ":", "\n", "        ", "bin_labels", "[", "inds", ",", "labels", "[", "inds", "]", "-", "1", "]", "=", "1", "# assign 1 to the corresponding label", "\n", "", "bin_label_weights", "=", "label_weights", ".", "view", "(", "-", "1", ",", "1", ")", ".", "expand", "(", "\n", "label_weights", ".", "size", "(", "0", ")", ",", "label_channels", ")", "\n", "return", "bin_labels", ",", "bin_label_weights", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.anchor_inside_flags": [[258, 270], ["None"], "function", ["None"], ["", "def", "anchor_inside_flags", "(", "flat_anchors", ",", "valid_flags", ",", "img_shape", ",", "\n", "allowed_border", "=", "0", ")", ":", "\n", "    ", "img_h", ",", "img_w", "=", "img_shape", "[", ":", "2", "]", "\n", "if", "allowed_border", ">=", "0", ":", "\n", "        ", "inside_flags", "=", "valid_flags", "&", "(", "flat_anchors", "[", ":", ",", "0", "]", ">=", "-", "allowed_border", ")", "&", "(", "flat_anchors", "[", ":", ",", "1", "]", ">=", "-", "allowed_border", ")", "&", "(", "flat_anchors", "[", ":", ",", "2", "]", "<", "img_w", "+", "allowed_border", ")", "&", "(", "flat_anchors", "[", ":", ",", "3", "]", "<", "img_h", "+", "allowed_border", ")", "\n", "", "else", ":", "\n", "        ", "inside_flags", "=", "valid_flags", "\n", "", "return", "inside_flags", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.unmap": [[272, 283], ["data.dim", "data.new_full", "data.new_full", "data.size"], "function", ["None"], ["", "def", "unmap", "(", "data", ",", "count", ",", "inds", ",", "fill", "=", "0", ")", ":", "\n", "    ", "\"\"\" Unmap a subset of item (data) back to the original set of items (of\n    size count) \"\"\"", "\n", "if", "data", ".", "dim", "(", ")", "==", "1", ":", "\n", "        ", "ret", "=", "data", ".", "new_full", "(", "(", "count", ",", ")", ",", "fill", ")", "\n", "ret", "[", "inds", "]", "=", "data", "\n", "", "else", ":", "\n", "        ", "new_size", "=", "(", "count", ",", ")", "+", "data", ".", "size", "(", ")", "[", "1", ":", "]", "\n", "ret", "=", "data", ".", "new_full", "(", "new_size", ",", "fill", ")", "\n", "ret", "[", "inds", ",", ":", "]", "=", "data", "\n", "", "return", "ret", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.calc_region": [[7, 30], ["torch.round().long", "torch.round().long", "torch.round().long", "torch.round().long", "x1.clamp.clamp", "y1.clamp.clamp", "x2.clamp.clamp", "y2.clamp.clamp", "torch.round", "torch.round", "torch.round", "torch.round"], "function", ["None"], ["def", "calc_region", "(", "bbox", ",", "ratio", ",", "featmap_size", "=", "None", ")", ":", "\n", "    ", "\"\"\"Calculate a proportional bbox region.\n\n    The bbox center are fixed and the new h' and w' is h * ratio and w * ratio.\n\n    Args:\n        bbox (Tensor): Bboxes to calculate regions, shape (n, 4)\n        ratio (float): Ratio of the output region.\n        featmap_size (tuple): Feature map size used for clipping the boundary.\n\n    Returns:\n        tuple: x1, y1, x2, y2\n    \"\"\"", "\n", "x1", "=", "torch", ".", "round", "(", "(", "1", "-", "ratio", ")", "*", "bbox", "[", "0", "]", "+", "ratio", "*", "bbox", "[", "2", "]", ")", ".", "long", "(", ")", "\n", "y1", "=", "torch", ".", "round", "(", "(", "1", "-", "ratio", ")", "*", "bbox", "[", "1", "]", "+", "ratio", "*", "bbox", "[", "3", "]", ")", ".", "long", "(", ")", "\n", "x2", "=", "torch", ".", "round", "(", "ratio", "*", "bbox", "[", "0", "]", "+", "(", "1", "-", "ratio", ")", "*", "bbox", "[", "2", "]", ")", ".", "long", "(", ")", "\n", "y2", "=", "torch", ".", "round", "(", "ratio", "*", "bbox", "[", "1", "]", "+", "(", "1", "-", "ratio", ")", "*", "bbox", "[", "3", "]", ")", ".", "long", "(", ")", "\n", "if", "featmap_size", "is", "not", "None", ":", "\n", "        ", "x1", "=", "x1", ".", "clamp", "(", "min", "=", "0", ",", "max", "=", "featmap_size", "[", "1", "]", "-", "1", ")", "\n", "y1", "=", "y1", ".", "clamp", "(", "min", "=", "0", ",", "max", "=", "featmap_size", "[", "0", "]", "-", "1", ")", "\n", "x2", "=", "x2", ".", "clamp", "(", "min", "=", "0", ",", "max", "=", "featmap_size", "[", "1", "]", "-", "1", ")", "\n", "y2", "=", "y2", ".", "clamp", "(", "min", "=", "0", ",", "max", "=", "featmap_size", "[", "0", "]", "-", "1", ")", "\n", "", "return", "(", "x1", ",", "y1", ",", "x2", ",", "y2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.ga_loc_target": [[32, 130], ["len", "len", "range", "range", "range", "torch.zeros", "torch.full_like", "torch.zeros_like", "all_loc_targets.append", "all_loc_weights.append", "all_ignore_map.append", "torch.sqrt", "torch.sqrt.new_full", "torch.floor", "target_lvls.clamp().long.clamp().long", "range", "sum", "float", "gt_bboxes.size", "target_lvls[].item", "guided_anchor_target.calc_region", "guided_anchor_target.calc_region", "target_lvls.clamp().long.clamp", "guided_anchor_target.calc_region", "guided_anchor_target.calc_region", "torch.log2", "torch.log2", "t.size", "t.size", "t.size"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.calc_region", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.calc_region", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.calc_region", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.calc_region"], ["", "def", "ga_loc_target", "(", "gt_bboxes_list", ",", "\n", "featmap_sizes", ",", "\n", "anchor_scale", ",", "\n", "anchor_strides", ",", "\n", "center_ratio", "=", "0.2", ",", "\n", "ignore_ratio", "=", "0.5", ")", ":", "\n", "    ", "\"\"\"Compute location targets for guided anchoring.\n\n    Each feature map is divided into positive, negative and ignore regions.\n    - positive regions: target 1, weight 1\n    - ignore regions: target 0, weight 0\n    - negative regions: target 0, weight 0.1\n\n    Args:\n        gt_bboxes_list (list[Tensor]): Gt bboxes of each image.\n        featmap_sizes (list[tuple]): Multi level sizes of each feature maps.\n        anchor_scale (int): Anchor scale.\n        anchor_strides ([list[int]]): Multi level anchor strides.\n        center_ratio (float): Ratio of center region.\n        ignore_ratio (float): Ratio of ignore region.\n\n    Returns:\n        tuple\n    \"\"\"", "\n", "img_per_gpu", "=", "len", "(", "gt_bboxes_list", ")", "\n", "num_lvls", "=", "len", "(", "featmap_sizes", ")", "\n", "r1", "=", "(", "1", "-", "center_ratio", ")", "/", "2", "\n", "r2", "=", "(", "1", "-", "ignore_ratio", ")", "/", "2", "\n", "all_loc_targets", "=", "[", "]", "\n", "all_loc_weights", "=", "[", "]", "\n", "all_ignore_map", "=", "[", "]", "\n", "for", "lvl_id", "in", "range", "(", "num_lvls", ")", ":", "\n", "        ", "h", ",", "w", "=", "featmap_sizes", "[", "lvl_id", "]", "\n", "loc_targets", "=", "torch", ".", "zeros", "(", "img_per_gpu", ",", "\n", "1", ",", "\n", "h", ",", "\n", "w", ",", "\n", "device", "=", "gt_bboxes_list", "[", "0", "]", ".", "device", ",", "\n", "dtype", "=", "torch", ".", "float32", ")", "\n", "loc_weights", "=", "torch", ".", "full_like", "(", "loc_targets", ",", "-", "1", ")", "\n", "ignore_map", "=", "torch", ".", "zeros_like", "(", "loc_targets", ")", "\n", "all_loc_targets", ".", "append", "(", "loc_targets", ")", "\n", "all_loc_weights", ".", "append", "(", "loc_weights", ")", "\n", "all_ignore_map", ".", "append", "(", "ignore_map", ")", "\n", "", "for", "img_id", "in", "range", "(", "img_per_gpu", ")", ":", "\n", "        ", "gt_bboxes", "=", "gt_bboxes_list", "[", "img_id", "]", "\n", "scale", "=", "torch", ".", "sqrt", "(", "(", "gt_bboxes", "[", ":", ",", "2", "]", "-", "gt_bboxes", "[", ":", ",", "0", "]", "+", "1", ")", "*", "\n", "(", "gt_bboxes", "[", ":", ",", "3", "]", "-", "gt_bboxes", "[", ":", ",", "1", "]", "+", "1", ")", ")", "\n", "min_anchor_size", "=", "scale", ".", "new_full", "(", "\n", "(", "1", ",", ")", ",", "float", "(", "anchor_scale", "*", "anchor_strides", "[", "0", "]", ")", ")", "\n", "# assign gt bboxes to different feature levels w.r.t. their scales", "\n", "target_lvls", "=", "torch", ".", "floor", "(", "\n", "torch", ".", "log2", "(", "scale", ")", "-", "torch", ".", "log2", "(", "min_anchor_size", ")", "+", "0.5", ")", "\n", "target_lvls", "=", "target_lvls", ".", "clamp", "(", "min", "=", "0", ",", "max", "=", "num_lvls", "-", "1", ")", ".", "long", "(", ")", "\n", "for", "gt_id", "in", "range", "(", "gt_bboxes", ".", "size", "(", "0", ")", ")", ":", "\n", "            ", "lvl", "=", "target_lvls", "[", "gt_id", "]", ".", "item", "(", ")", "\n", "# rescaled to corresponding feature map", "\n", "gt_", "=", "gt_bboxes", "[", "gt_id", ",", ":", "4", "]", "/", "anchor_strides", "[", "lvl", "]", "\n", "# calculate ignore regions", "\n", "ignore_x1", ",", "ignore_y1", ",", "ignore_x2", ",", "ignore_y2", "=", "calc_region", "(", "\n", "gt_", ",", "r2", ",", "featmap_sizes", "[", "lvl", "]", ")", "\n", "# calculate positive (center) regions", "\n", "ctr_x1", ",", "ctr_y1", ",", "ctr_x2", ",", "ctr_y2", "=", "calc_region", "(", "\n", "gt_", ",", "r1", ",", "featmap_sizes", "[", "lvl", "]", ")", "\n", "all_loc_targets", "[", "lvl", "]", "[", "img_id", ",", "0", ",", "ctr_y1", ":", "ctr_y2", "+", "1", ",", "ctr_x1", ":", "ctr_x2", "+", "\n", "1", "]", "=", "1", "\n", "all_loc_weights", "[", "lvl", "]", "[", "img_id", ",", "0", ",", "ignore_y1", ":", "ignore_y2", "+", "\n", "1", ",", "ignore_x1", ":", "ignore_x2", "+", "1", "]", "=", "0", "\n", "all_loc_weights", "[", "lvl", "]", "[", "img_id", ",", "0", ",", "ctr_y1", ":", "ctr_y2", "+", "1", ",", "ctr_x1", ":", "ctr_x2", "+", "\n", "1", "]", "=", "1", "\n", "# calculate ignore map on nearby low level feature", "\n", "if", "lvl", ">", "0", ":", "\n", "                ", "d_lvl", "=", "lvl", "-", "1", "\n", "# rescaled to corresponding feature map", "\n", "gt_", "=", "gt_bboxes", "[", "gt_id", ",", ":", "4", "]", "/", "anchor_strides", "[", "d_lvl", "]", "\n", "ignore_x1", ",", "ignore_y1", ",", "ignore_x2", ",", "ignore_y2", "=", "calc_region", "(", "\n", "gt_", ",", "r2", ",", "featmap_sizes", "[", "d_lvl", "]", ")", "\n", "all_ignore_map", "[", "d_lvl", "]", "[", "img_id", ",", "0", ",", "ignore_y1", ":", "ignore_y2", "+", "\n", "1", ",", "ignore_x1", ":", "ignore_x2", "+", "1", "]", "=", "1", "\n", "# calculate ignore map on nearby high level feature", "\n", "", "if", "lvl", "<", "num_lvls", "-", "1", ":", "\n", "                ", "u_lvl", "=", "lvl", "+", "1", "\n", "# rescaled to corresponding feature map", "\n", "gt_", "=", "gt_bboxes", "[", "gt_id", ",", ":", "4", "]", "/", "anchor_strides", "[", "u_lvl", "]", "\n", "ignore_x1", ",", "ignore_y1", ",", "ignore_x2", ",", "ignore_y2", "=", "calc_region", "(", "\n", "gt_", ",", "r2", ",", "featmap_sizes", "[", "u_lvl", "]", ")", "\n", "all_ignore_map", "[", "u_lvl", "]", "[", "img_id", ",", "0", ",", "ignore_y1", ":", "ignore_y2", "+", "\n", "1", ",", "ignore_x1", ":", "ignore_x2", "+", "1", "]", "=", "1", "\n", "", "", "", "for", "lvl_id", "in", "range", "(", "num_lvls", ")", ":", "\n", "# ignore negative regions w.r.t. ignore map", "\n", "        ", "all_loc_weights", "[", "lvl_id", "]", "[", "(", "all_loc_weights", "[", "lvl_id", "]", "<", "0", ")", "\n", "&", "(", "all_ignore_map", "[", "lvl_id", "]", ">", "0", ")", "]", "=", "0", "\n", "# set negative regions with weight 0.1", "\n", "all_loc_weights", "[", "lvl_id", "]", "[", "all_loc_weights", "[", "lvl_id", "]", "<", "0", "]", "=", "0.1", "\n", "# loc average factor to balance loss", "\n", "", "loc_avg_factor", "=", "sum", "(", "\n", "[", "t", ".", "size", "(", "0", ")", "*", "t", ".", "size", "(", "-", "1", ")", "*", "t", ".", "size", "(", "-", "2", ")", "for", "t", "in", "all_loc_targets", "]", ")", "/", "200", "\n", "return", "all_loc_targets", ",", "all_loc_weights", ",", "loc_avg_factor", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.ga_shape_target": [[132, 201], ["len", "range", "utils.multi_apply", "any", "sum", "sum", "guided_anchor_target.images_to_levels", "guided_anchor_target.images_to_levels", "guided_anchor_target.images_to_levels", "len", "len", "len", "squares.size", "inside_flag_flat_list.append", "approx_flat_list.append", "square_flat_list.append", "len", "len", "torch.cat", "torch.cat", "torch.cat", "max", "max", "range", "inds.numel", "inds.numel"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.multi_apply", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.images_to_levels", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.images_to_levels", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.images_to_levels"], ["", "def", "ga_shape_target", "(", "approx_list", ",", "\n", "inside_flag_list", ",", "\n", "square_list", ",", "\n", "gt_bboxes_list", ",", "\n", "img_metas", ",", "\n", "approxs_per_octave", ",", "\n", "cfg", ",", "\n", "gt_bboxes_ignore_list", "=", "None", ",", "\n", "sampling", "=", "True", ",", "\n", "unmap_outputs", "=", "True", ")", ":", "\n", "    ", "\"\"\"Compute guided anchoring targets.\n\n    Args:\n        approx_list (list[list]): Multi level approxs of each image.\n        inside_flag_list (list[list]): Multi level inside flags of each image.\n        square_list (list[list]): Multi level squares of each image.\n        gt_bboxes_list (list[Tensor]): Ground truth bboxes of each image.\n        img_metas (list[dict]): Meta info of each image.\n        approxs_per_octave (int): number of approxs per octave\n        cfg (dict): RPN train configs.\n        gt_bboxes_ignore_list (list[Tensor]): ignore list of gt bboxes.\n        sampling (bool): sampling or not.\n        unmap_outputs (bool): unmap outputs or not.\n\n    Returns:\n        tuple\n    \"\"\"", "\n", "num_imgs", "=", "len", "(", "img_metas", ")", "\n", "assert", "len", "(", "approx_list", ")", "==", "len", "(", "inside_flag_list", ")", "==", "len", "(", "\n", "square_list", ")", "==", "num_imgs", "\n", "# anchor number of multi levels", "\n", "num_level_squares", "=", "[", "squares", ".", "size", "(", "0", ")", "for", "squares", "in", "square_list", "[", "0", "]", "]", "\n", "# concat all level anchors and flags to a single tensor", "\n", "inside_flag_flat_list", "=", "[", "]", "\n", "approx_flat_list", "=", "[", "]", "\n", "square_flat_list", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "num_imgs", ")", ":", "\n", "        ", "assert", "len", "(", "square_list", "[", "i", "]", ")", "==", "len", "(", "inside_flag_list", "[", "i", "]", ")", "\n", "inside_flag_flat_list", ".", "append", "(", "torch", ".", "cat", "(", "inside_flag_list", "[", "i", "]", ")", ")", "\n", "approx_flat_list", ".", "append", "(", "torch", ".", "cat", "(", "approx_list", "[", "i", "]", ")", ")", "\n", "square_flat_list", ".", "append", "(", "torch", ".", "cat", "(", "square_list", "[", "i", "]", ")", ")", "\n", "\n", "# compute targets for each image", "\n", "", "if", "gt_bboxes_ignore_list", "is", "None", ":", "\n", "        ", "gt_bboxes_ignore_list", "=", "[", "None", "for", "_", "in", "range", "(", "num_imgs", ")", "]", "\n", "", "(", "all_bbox_anchors", ",", "all_bbox_gts", ",", "all_bbox_weights", ",", "pos_inds_list", ",", "\n", "neg_inds_list", ")", "=", "multi_apply", "(", "ga_shape_target_single", ",", "\n", "approx_flat_list", ",", "\n", "inside_flag_flat_list", ",", "\n", "square_flat_list", ",", "\n", "gt_bboxes_list", ",", "\n", "gt_bboxes_ignore_list", ",", "\n", "img_metas", ",", "\n", "approxs_per_octave", "=", "approxs_per_octave", ",", "\n", "cfg", "=", "cfg", ",", "\n", "sampling", "=", "sampling", ",", "\n", "unmap_outputs", "=", "unmap_outputs", ")", "\n", "# no valid anchors", "\n", "if", "any", "(", "[", "bbox_anchors", "is", "None", "for", "bbox_anchors", "in", "all_bbox_anchors", "]", ")", ":", "\n", "        ", "return", "None", "\n", "# sampled anchors of all images", "\n", "", "num_total_pos", "=", "sum", "(", "[", "max", "(", "inds", ".", "numel", "(", ")", ",", "1", ")", "for", "inds", "in", "pos_inds_list", "]", ")", "\n", "num_total_neg", "=", "sum", "(", "[", "max", "(", "inds", ".", "numel", "(", ")", ",", "1", ")", "for", "inds", "in", "neg_inds_list", "]", ")", "\n", "# split targets to a list w.r.t. multiple levels", "\n", "bbox_anchors_list", "=", "images_to_levels", "(", "all_bbox_anchors", ",", "num_level_squares", ")", "\n", "bbox_gts_list", "=", "images_to_levels", "(", "all_bbox_gts", ",", "num_level_squares", ")", "\n", "bbox_weights_list", "=", "images_to_levels", "(", "all_bbox_weights", ",", "num_level_squares", ")", "\n", "return", "(", "bbox_anchors_list", ",", "bbox_gts_list", ",", "bbox_weights_list", ",", "num_total_pos", ",", "\n", "num_total_neg", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.images_to_levels": [[203, 216], ["torch.stack", "level_targets.append", "target[].squeeze"], "function", ["None"], ["", "def", "images_to_levels", "(", "target", ",", "num_level_anchors", ")", ":", "\n", "    ", "\"\"\"Convert targets by image to targets by feature level.\n\n    [target_img0, target_img1] -> [target_level0, target_level1, ...]\n    \"\"\"", "\n", "target", "=", "torch", ".", "stack", "(", "target", ",", "0", ")", "\n", "level_targets", "=", "[", "]", "\n", "start", "=", "0", "\n", "for", "n", "in", "num_level_anchors", ":", "\n", "        ", "end", "=", "start", "+", "n", "\n", "level_targets", ".", "append", "(", "target", "[", ":", ",", "start", ":", "end", "]", ".", "squeeze", "(", "0", ")", ")", "\n", "start", "=", "end", "\n", "", "return", "level_targets", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.guided_anchor_target.ga_shape_target_single": [[218, 286], ["inside_flags[].expand().reshape", "bbox.build_assigner", "bbox.build_assigner.assign", "bbox.PseudoSampler.sample", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "inside_flags.any", "bbox.build_sampler", "bbox.PseudoSampler", "len", "flat_squares.size", "utils.unmap", "utils.unmap", "utils.unmap", "inside_flags[].expand"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.assign_sampling.build_assigner", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.max_iou_assigner.MaxIoUAssigner.assign", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.pseudo_sampler.PseudoSampler.sample", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.assign_sampling.build_sampler", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.unmap", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.unmap", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.anchor.anchor_target.unmap"], ["", "def", "ga_shape_target_single", "(", "flat_approxs", ",", "\n", "inside_flags", ",", "\n", "flat_squares", ",", "\n", "gt_bboxes", ",", "\n", "gt_bboxes_ignore", ",", "\n", "img_meta", ",", "\n", "approxs_per_octave", ",", "\n", "cfg", ",", "\n", "sampling", "=", "True", ",", "\n", "unmap_outputs", "=", "True", ")", ":", "\n", "    ", "\"\"\"Compute guided anchoring targets.\n\n    This function returns sampled anchors and gt bboxes directly\n    rather than calculates regression targets.\n\n    Args:\n        flat_approxs (Tensor): flat approxs of a single image,\n            shape (n, 4)\n        inside_flags (Tensor): inside flags of a single image,\n            shape (n, ).\n        flat_squares (Tensor): flat squares of a single image,\n            shape (approxs_per_octave * n, 4)\n        gt_bboxes (Tensor): Ground truth bboxes of a single image.\n        img_meta (dict): Meta info of a single image.\n        approxs_per_octave (int): number of approxs per octave\n        cfg (dict): RPN train configs.\n        sampling (bool): sampling or not.\n        unmap_outputs (bool): unmap outputs or not.\n\n    Returns:\n        tuple\n    \"\"\"", "\n", "if", "not", "inside_flags", ".", "any", "(", ")", ":", "\n", "        ", "return", "(", "None", ",", ")", "*", "6", "\n", "# assign gt and sample anchors", "\n", "", "expand_inside_flags", "=", "inside_flags", "[", ":", ",", "None", "]", ".", "expand", "(", "\n", "-", "1", ",", "approxs_per_octave", ")", ".", "reshape", "(", "-", "1", ")", "\n", "approxs", "=", "flat_approxs", "[", "expand_inside_flags", ",", ":", "]", "\n", "squares", "=", "flat_squares", "[", "inside_flags", ",", ":", "]", "\n", "\n", "bbox_assigner", "=", "build_assigner", "(", "cfg", ".", "ga_assigner", ")", "\n", "assign_result", "=", "bbox_assigner", ".", "assign", "(", "approxs", ",", "squares", ",", "approxs_per_octave", ",", "\n", "gt_bboxes", ",", "gt_bboxes_ignore", ")", "\n", "if", "sampling", ":", "\n", "        ", "bbox_sampler", "=", "build_sampler", "(", "cfg", ".", "ga_sampler", ")", "\n", "", "else", ":", "\n", "        ", "bbox_sampler", "=", "PseudoSampler", "(", ")", "\n", "", "sampling_result", "=", "bbox_sampler", ".", "sample", "(", "assign_result", ",", "squares", ",", "gt_bboxes", ")", "\n", "\n", "bbox_anchors", "=", "torch", ".", "zeros_like", "(", "squares", ")", "\n", "bbox_gts", "=", "torch", ".", "zeros_like", "(", "squares", ")", "\n", "bbox_weights", "=", "torch", ".", "zeros_like", "(", "squares", ")", "\n", "\n", "pos_inds", "=", "sampling_result", ".", "pos_inds", "\n", "neg_inds", "=", "sampling_result", ".", "neg_inds", "\n", "if", "len", "(", "pos_inds", ")", ">", "0", ":", "\n", "        ", "bbox_anchors", "[", "pos_inds", ",", ":", "]", "=", "sampling_result", ".", "pos_bboxes", "\n", "bbox_gts", "[", "pos_inds", ",", ":", "]", "=", "sampling_result", ".", "pos_gt_bboxes", "\n", "bbox_weights", "[", "pos_inds", ",", ":", "]", "=", "1.0", "\n", "\n", "# map up to original set of anchors", "\n", "", "if", "unmap_outputs", ":", "\n", "        ", "num_total_anchors", "=", "flat_squares", ".", "size", "(", "0", ")", "\n", "bbox_anchors", "=", "unmap", "(", "bbox_anchors", ",", "num_total_anchors", ",", "inside_flags", ")", "\n", "bbox_gts", "=", "unmap", "(", "bbox_gts", ",", "num_total_anchors", ",", "inside_flags", ")", "\n", "bbox_weights", "=", "unmap", "(", "bbox_weights", ",", "num_total_anchors", ",", "inside_flags", ")", "\n", "\n", "", "return", "(", "bbox_anchors", ",", "bbox_gts", ",", "bbox_weights", ",", "pos_inds", ",", "neg_inds", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.mean_ap.average_precision": [[9, 54], ["numpy.zeros", "numpy.zeros", "numpy.ones", "numpy.hstack", "numpy.hstack", "range", "range", "numpy.maximum", "numpy.sum", "range", "ValueError", "numpy.where", "numpy.arange", "precs.max"], "function", ["None"], ["def", "average_precision", "(", "recalls", ",", "precisions", ",", "mode", "=", "'area'", ")", ":", "\n", "    ", "\"\"\"Calculate average precision (for single or multiple scales).\n\n    Args:\n        recalls (ndarray): shape (num_scales, num_dets) or (num_dets, )\n        precisions (ndarray): shape (num_scales, num_dets) or (num_dets, )\n        mode (str): 'area' or '11points', 'area' means calculating the area\n            under precision-recall curve, '11points' means calculating\n            the average precision of recalls at [0, 0.1, ..., 1]\n\n    Returns:\n        float or ndarray: calculated average precision\n    \"\"\"", "\n", "no_scale", "=", "False", "\n", "if", "recalls", ".", "ndim", "==", "1", ":", "\n", "        ", "no_scale", "=", "True", "\n", "recalls", "=", "recalls", "[", "np", ".", "newaxis", ",", ":", "]", "\n", "precisions", "=", "precisions", "[", "np", ".", "newaxis", ",", ":", "]", "\n", "", "assert", "recalls", ".", "shape", "==", "precisions", ".", "shape", "and", "recalls", ".", "ndim", "==", "2", "\n", "num_scales", "=", "recalls", ".", "shape", "[", "0", "]", "\n", "ap", "=", "np", ".", "zeros", "(", "num_scales", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "if", "mode", "==", "'area'", ":", "\n", "        ", "zeros", "=", "np", ".", "zeros", "(", "(", "num_scales", ",", "1", ")", ",", "dtype", "=", "recalls", ".", "dtype", ")", "\n", "ones", "=", "np", ".", "ones", "(", "(", "num_scales", ",", "1", ")", ",", "dtype", "=", "recalls", ".", "dtype", ")", "\n", "mrec", "=", "np", ".", "hstack", "(", "(", "zeros", ",", "recalls", ",", "ones", ")", ")", "\n", "mpre", "=", "np", ".", "hstack", "(", "(", "zeros", ",", "precisions", ",", "zeros", ")", ")", "\n", "for", "i", "in", "range", "(", "mpre", ".", "shape", "[", "1", "]", "-", "1", ",", "0", ",", "-", "1", ")", ":", "\n", "            ", "mpre", "[", ":", ",", "i", "-", "1", "]", "=", "np", ".", "maximum", "(", "mpre", "[", ":", ",", "i", "-", "1", "]", ",", "mpre", "[", ":", ",", "i", "]", ")", "\n", "", "for", "i", "in", "range", "(", "num_scales", ")", ":", "\n", "            ", "ind", "=", "np", ".", "where", "(", "mrec", "[", "i", ",", "1", ":", "]", "!=", "mrec", "[", "i", ",", ":", "-", "1", "]", ")", "[", "0", "]", "\n", "ap", "[", "i", "]", "=", "np", ".", "sum", "(", "\n", "(", "mrec", "[", "i", ",", "ind", "+", "1", "]", "-", "mrec", "[", "i", ",", "ind", "]", ")", "*", "mpre", "[", "i", ",", "ind", "+", "1", "]", ")", "\n", "", "", "elif", "mode", "==", "'11points'", ":", "\n", "        ", "for", "i", "in", "range", "(", "num_scales", ")", ":", "\n", "            ", "for", "thr", "in", "np", ".", "arange", "(", "0", ",", "1", "+", "1e-3", ",", "0.1", ")", ":", "\n", "                ", "precs", "=", "precisions", "[", "i", ",", "recalls", "[", "i", ",", ":", "]", ">=", "thr", "]", "\n", "prec", "=", "precs", ".", "max", "(", ")", "if", "precs", ".", "size", ">", "0", "else", "0", "\n", "ap", "[", "i", "]", "+=", "prec", "\n", "", "ap", "/=", "11", "\n", "", "", "else", ":", "\n", "        ", "raise", "ValueError", "(", "\n", "'Unrecognized mode, only \"area\" and \"11points\" are supported'", ")", "\n", "", "if", "no_scale", ":", "\n", "        ", "ap", "=", "ap", "[", "0", "]", "\n", "", "return", "ap", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.mean_ap.tpfp_imagenet": [[56, 135], ["len", "numpy.zeros", "numpy.zeros", "bbox_overlaps.bbox_overlaps", "numpy.minimum", "numpy.argsort", "enumerate", "numpy.zeros", "enumerate", "numpy.zeros_like", "range"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps"], ["", "def", "tpfp_imagenet", "(", "det_bboxes", ",", "\n", "gt_bboxes", ",", "\n", "gt_ignore", ",", "\n", "default_iou_thr", ",", "\n", "area_ranges", "=", "None", ")", ":", "\n", "    ", "\"\"\"Check if detected bboxes are true positive or false positive.\n\n    Args:\n        det_bbox (ndarray): the detected bbox\n        gt_bboxes (ndarray): ground truth bboxes of this image\n        gt_ignore (ndarray): indicate if gts are ignored for evaluation or not\n        default_iou_thr (float): the iou thresholds for medium and large bboxes\n        area_ranges (list or None): gt bbox area ranges\n\n    Returns:\n        tuple: two arrays (tp, fp) whose elements are 0 and 1\n    \"\"\"", "\n", "num_dets", "=", "det_bboxes", ".", "shape", "[", "0", "]", "\n", "num_gts", "=", "gt_bboxes", ".", "shape", "[", "0", "]", "\n", "if", "area_ranges", "is", "None", ":", "\n", "        ", "area_ranges", "=", "[", "(", "None", ",", "None", ")", "]", "\n", "", "num_scales", "=", "len", "(", "area_ranges", ")", "\n", "# tp and fp are of shape (num_scales, num_gts), each row is tp or fp", "\n", "# of a certain scale.", "\n", "tp", "=", "np", ".", "zeros", "(", "(", "num_scales", ",", "num_dets", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "fp", "=", "np", ".", "zeros", "(", "(", "num_scales", ",", "num_dets", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "if", "gt_bboxes", ".", "shape", "[", "0", "]", "==", "0", ":", "\n", "        ", "if", "area_ranges", "==", "[", "(", "None", ",", "None", ")", "]", ":", "\n", "            ", "fp", "[", "...", "]", "=", "1", "\n", "", "else", ":", "\n", "            ", "det_areas", "=", "(", "det_bboxes", "[", ":", ",", "2", "]", "-", "det_bboxes", "[", ":", ",", "0", "]", "+", "1", ")", "*", "(", "\n", "det_bboxes", "[", ":", ",", "3", "]", "-", "det_bboxes", "[", ":", ",", "1", "]", "+", "1", ")", "\n", "for", "i", ",", "(", "min_area", ",", "max_area", ")", "in", "enumerate", "(", "area_ranges", ")", ":", "\n", "                ", "fp", "[", "i", ",", "(", "det_areas", ">=", "min_area", ")", "&", "(", "det_areas", "<", "max_area", ")", "]", "=", "1", "\n", "", "", "return", "tp", ",", "fp", "\n", "", "ious", "=", "bbox_overlaps", "(", "det_bboxes", ",", "gt_bboxes", "-", "1", ")", "\n", "gt_w", "=", "gt_bboxes", "[", ":", ",", "2", "]", "-", "gt_bboxes", "[", ":", ",", "0", "]", "+", "1", "\n", "gt_h", "=", "gt_bboxes", "[", ":", ",", "3", "]", "-", "gt_bboxes", "[", ":", ",", "1", "]", "+", "1", "\n", "iou_thrs", "=", "np", ".", "minimum", "(", "(", "gt_w", "*", "gt_h", ")", "/", "(", "(", "gt_w", "+", "10.0", ")", "*", "(", "gt_h", "+", "10.0", ")", ")", ",", "\n", "default_iou_thr", ")", "\n", "# sort all detections by scores in descending order", "\n", "sort_inds", "=", "np", ".", "argsort", "(", "-", "det_bboxes", "[", ":", ",", "-", "1", "]", ")", "\n", "for", "k", ",", "(", "min_area", ",", "max_area", ")", "in", "enumerate", "(", "area_ranges", ")", ":", "\n", "        ", "gt_covered", "=", "np", ".", "zeros", "(", "num_gts", ",", "dtype", "=", "bool", ")", "\n", "# if no area range is specified, gt_area_ignore is all False", "\n", "if", "min_area", "is", "None", ":", "\n", "            ", "gt_area_ignore", "=", "np", ".", "zeros_like", "(", "gt_ignore", ",", "dtype", "=", "bool", ")", "\n", "", "else", ":", "\n", "            ", "gt_areas", "=", "gt_w", "*", "gt_h", "\n", "gt_area_ignore", "=", "(", "gt_areas", "<", "min_area", ")", "|", "(", "gt_areas", ">=", "max_area", ")", "\n", "", "for", "i", "in", "sort_inds", ":", "\n", "            ", "max_iou", "=", "-", "1", "\n", "matched_gt", "=", "-", "1", "\n", "# find best overlapped available gt", "\n", "for", "j", "in", "range", "(", "num_gts", ")", ":", "\n", "# different from PASCAL VOC: allow finding other gts if the", "\n", "# best overlaped ones are already matched by other det bboxes", "\n", "                ", "if", "gt_covered", "[", "j", "]", ":", "\n", "                    ", "continue", "\n", "", "elif", "ious", "[", "i", ",", "j", "]", ">=", "iou_thrs", "[", "j", "]", "and", "ious", "[", "i", ",", "j", "]", ">", "max_iou", ":", "\n", "                    ", "max_iou", "=", "ious", "[", "i", ",", "j", "]", "\n", "matched_gt", "=", "j", "\n", "# there are 4 cases for a det bbox:", "\n", "# 1. it matches a gt, tp = 1, fp = 0", "\n", "# 2. it matches an ignored gt, tp = 0, fp = 0", "\n", "# 3. it matches no gt and within area range, tp = 0, fp = 1", "\n", "# 4. it matches no gt but is beyond area range, tp = 0, fp = 0", "\n", "", "", "if", "matched_gt", ">=", "0", ":", "\n", "                ", "gt_covered", "[", "matched_gt", "]", "=", "1", "\n", "if", "not", "(", "gt_ignore", "[", "matched_gt", "]", "or", "gt_area_ignore", "[", "matched_gt", "]", ")", ":", "\n", "                    ", "tp", "[", "k", ",", "i", "]", "=", "1", "\n", "", "", "elif", "min_area", "is", "None", ":", "\n", "                ", "fp", "[", "k", ",", "i", "]", "=", "1", "\n", "", "else", ":", "\n", "                ", "bbox", "=", "det_bboxes", "[", "i", ",", ":", "4", "]", "\n", "area", "=", "(", "bbox", "[", "2", "]", "-", "bbox", "[", "0", "]", "+", "1", ")", "*", "(", "bbox", "[", "3", "]", "-", "bbox", "[", "1", "]", "+", "1", ")", "\n", "if", "area", ">=", "min_area", "and", "area", "<", "max_area", ":", "\n", "                    ", "fp", "[", "k", ",", "i", "]", "=", "1", "\n", "", "", "", "", "return", "tp", ",", "fp", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.mean_ap.tpfp_default": [[137, 200], ["len", "numpy.zeros", "numpy.zeros", "bbox_overlaps.bbox_overlaps", "bbox_overlaps.bbox_overlaps.max", "bbox_overlaps.bbox_overlaps.argmax", "numpy.argsort", "enumerate", "numpy.zeros", "enumerate", "numpy.zeros_like"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps"], ["", "def", "tpfp_default", "(", "det_bboxes", ",", "gt_bboxes", ",", "gt_ignore", ",", "iou_thr", ",", "area_ranges", "=", "None", ")", ":", "\n", "    ", "\"\"\"Check if detected bboxes are true positive or false positive.\n\n    Args:\n        det_bbox (ndarray): the detected bbox\n        gt_bboxes (ndarray): ground truth bboxes of this image\n        gt_ignore (ndarray): indicate if gts are ignored for evaluation or not\n        iou_thr (float): the iou thresholds\n\n    Returns:\n        tuple: (tp, fp), two arrays whose elements are 0 and 1\n    \"\"\"", "\n", "num_dets", "=", "det_bboxes", ".", "shape", "[", "0", "]", "\n", "num_gts", "=", "gt_bboxes", ".", "shape", "[", "0", "]", "\n", "if", "area_ranges", "is", "None", ":", "\n", "        ", "area_ranges", "=", "[", "(", "None", ",", "None", ")", "]", "\n", "", "num_scales", "=", "len", "(", "area_ranges", ")", "\n", "# tp and fp are of shape (num_scales, num_gts), each row is tp or fp of", "\n", "# a certain scale", "\n", "tp", "=", "np", ".", "zeros", "(", "(", "num_scales", ",", "num_dets", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "fp", "=", "np", ".", "zeros", "(", "(", "num_scales", ",", "num_dets", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "# if there is no gt bboxes in this image, then all det bboxes", "\n", "# within area range are false positives", "\n", "if", "gt_bboxes", ".", "shape", "[", "0", "]", "==", "0", ":", "\n", "        ", "if", "area_ranges", "==", "[", "(", "None", ",", "None", ")", "]", ":", "\n", "            ", "fp", "[", "...", "]", "=", "1", "\n", "", "else", ":", "\n", "            ", "det_areas", "=", "(", "det_bboxes", "[", ":", ",", "2", "]", "-", "det_bboxes", "[", ":", ",", "0", "]", "+", "1", ")", "*", "(", "\n", "det_bboxes", "[", ":", ",", "3", "]", "-", "det_bboxes", "[", ":", ",", "1", "]", "+", "1", ")", "\n", "for", "i", ",", "(", "min_area", ",", "max_area", ")", "in", "enumerate", "(", "area_ranges", ")", ":", "\n", "                ", "fp", "[", "i", ",", "(", "det_areas", ">=", "min_area", ")", "&", "(", "det_areas", "<", "max_area", ")", "]", "=", "1", "\n", "", "", "return", "tp", ",", "fp", "\n", "", "ious", "=", "bbox_overlaps", "(", "det_bboxes", ",", "gt_bboxes", ")", "\n", "ious_max", "=", "ious", ".", "max", "(", "axis", "=", "1", ")", "\n", "ious_argmax", "=", "ious", ".", "argmax", "(", "axis", "=", "1", ")", "\n", "sort_inds", "=", "np", ".", "argsort", "(", "-", "det_bboxes", "[", ":", ",", "-", "1", "]", ")", "\n", "for", "k", ",", "(", "min_area", ",", "max_area", ")", "in", "enumerate", "(", "area_ranges", ")", ":", "\n", "        ", "gt_covered", "=", "np", ".", "zeros", "(", "num_gts", ",", "dtype", "=", "bool", ")", "\n", "# if no area range is specified, gt_area_ignore is all False", "\n", "if", "min_area", "is", "None", ":", "\n", "            ", "gt_area_ignore", "=", "np", ".", "zeros_like", "(", "gt_ignore", ",", "dtype", "=", "bool", ")", "\n", "", "else", ":", "\n", "            ", "gt_areas", "=", "(", "gt_bboxes", "[", ":", ",", "2", "]", "-", "gt_bboxes", "[", ":", ",", "0", "]", "+", "1", ")", "*", "(", "\n", "gt_bboxes", "[", ":", ",", "3", "]", "-", "gt_bboxes", "[", ":", ",", "1", "]", "+", "1", ")", "\n", "gt_area_ignore", "=", "(", "gt_areas", "<", "min_area", ")", "|", "(", "gt_areas", ">=", "max_area", ")", "\n", "", "for", "i", "in", "sort_inds", ":", "\n", "            ", "if", "ious_max", "[", "i", "]", ">=", "iou_thr", ":", "\n", "                ", "matched_gt", "=", "ious_argmax", "[", "i", "]", "\n", "if", "not", "(", "gt_ignore", "[", "matched_gt", "]", "or", "gt_area_ignore", "[", "matched_gt", "]", ")", ":", "\n", "                    ", "if", "not", "gt_covered", "[", "matched_gt", "]", ":", "\n", "                        ", "gt_covered", "[", "matched_gt", "]", "=", "True", "\n", "tp", "[", "k", ",", "i", "]", "=", "1", "\n", "", "else", ":", "\n", "                        ", "fp", "[", "k", ",", "i", "]", "=", "1", "\n", "# otherwise ignore this detected bbox, tp = 0, fp = 0", "\n", "", "", "", "elif", "min_area", "is", "None", ":", "\n", "                ", "fp", "[", "k", ",", "i", "]", "=", "1", "\n", "", "else", ":", "\n", "                ", "bbox", "=", "det_bboxes", "[", "i", ",", ":", "4", "]", "\n", "area", "=", "(", "bbox", "[", "2", "]", "-", "bbox", "[", "0", "]", "+", "1", ")", "*", "(", "bbox", "[", "3", "]", "-", "bbox", "[", "1", "]", "+", "1", ")", "\n", "if", "area", ">=", "min_area", "and", "area", "<", "max_area", ":", "\n", "                    ", "fp", "[", "k", ",", "i", "]", "=", "1", "\n", "", "", "", "", "return", "tp", ",", "fp", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.mean_ap.get_cls_results": [[202, 218], ["range", "len", "cls_gts.append", "cls_gt_ignore.append", "cls_gt_ignore.append", "numpy.zeros"], "function", ["None"], ["", "def", "get_cls_results", "(", "det_results", ",", "gt_bboxes", ",", "gt_labels", ",", "gt_ignore", ",", "class_id", ")", ":", "\n", "    ", "\"\"\"Get det results and gt information of a certain class.\"\"\"", "\n", "cls_dets", "=", "[", "det", "[", "class_id", "]", "\n", "for", "det", "in", "det_results", "]", "# det bboxes of this class", "\n", "cls_gts", "=", "[", "]", "# gt bboxes of this class", "\n", "cls_gt_ignore", "=", "[", "]", "\n", "for", "j", "in", "range", "(", "len", "(", "gt_bboxes", ")", ")", ":", "\n", "        ", "gt_bbox", "=", "gt_bboxes", "[", "j", "]", "\n", "cls_inds", "=", "(", "gt_labels", "[", "j", "]", "==", "class_id", "+", "1", ")", "\n", "cls_gt", "=", "gt_bbox", "[", "cls_inds", ",", ":", "]", "if", "gt_bbox", ".", "shape", "[", "0", "]", ">", "0", "else", "gt_bbox", "\n", "cls_gts", ".", "append", "(", "cls_gt", ")", "\n", "if", "gt_ignore", "is", "None", ":", "\n", "            ", "cls_gt_ignore", ".", "append", "(", "np", ".", "zeros", "(", "cls_gt", ".", "shape", "[", "0", "]", ",", "dtype", "=", "np", ".", "int32", ")", ")", "\n", "", "else", ":", "\n", "            ", "cls_gt_ignore", ".", "append", "(", "gt_ignore", "[", "j", "]", "[", "cls_inds", "]", ")", "\n", "", "", "return", "cls_dets", ",", "cls_gts", ",", "cls_gt_ignore", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.mean_ap.eval_map": [[220, 330], ["len", "range", "len", "len", "len", "range", "len", "mean_ap.get_cls_results", "tuple", "numpy.zeros", "enumerate", "numpy.vstack", "numpy.argsort", "numpy.cumsum", "numpy.cumsum", "mean_ap.average_precision", "eval_results.append", "numpy.vstack", "numpy.vstack", "mean_ap.print_map_summary", "len", "len", "len", "tpfp_func", "zip", "numpy.hstack", "numpy.hstack", "numpy.finfo", "numpy.maximum", "numpy.maximum", "num_gts.item.item", "numpy.array().mean().item", "len", "len", "range", "numpy.sum", "enumerate", "numpy.any", "all_ap[].mean", "range", "aps.append", "len", "numpy.logical_not", "numpy.sum", "numpy.array().mean", "numpy.array", "numpy.logical_not"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.mean_ap.get_cls_results", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.mean_ap.average_precision", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.mean_ap.print_map_summary"], ["", "def", "eval_map", "(", "det_results", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "gt_ignore", "=", "None", ",", "\n", "scale_ranges", "=", "None", ",", "\n", "iou_thr", "=", "0.5", ",", "\n", "dataset", "=", "None", ",", "\n", "print_summary", "=", "True", ")", ":", "\n", "    ", "\"\"\"Evaluate mAP of a dataset.\n\n    Args:\n        det_results (list): a list of list, [[cls1_det, cls2_det, ...], ...]\n        gt_bboxes (list): ground truth bboxes of each image, a list of K*4\n            array.\n        gt_labels (list): ground truth labels of each image, a list of K array\n        gt_ignore (list): gt ignore indicators of each image, a list of K array\n        scale_ranges (list, optional): [(min1, max1), (min2, max2), ...]\n        iou_thr (float): IoU threshold\n        dataset (None or str or list): dataset name or dataset classes, there\n            are minor differences in metrics for different datsets, e.g.\n            \"voc07\", \"imagenet_det\", etc.\n        print_summary (bool): whether to print the mAP summary\n\n    Returns:\n        tuple: (mAP, [dict, dict, ...])\n    \"\"\"", "\n", "assert", "len", "(", "det_results", ")", "==", "len", "(", "gt_bboxes", ")", "==", "len", "(", "gt_labels", ")", "\n", "if", "gt_ignore", "is", "not", "None", ":", "\n", "        ", "assert", "len", "(", "gt_ignore", ")", "==", "len", "(", "gt_labels", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "gt_ignore", ")", ")", ":", "\n", "            ", "assert", "len", "(", "gt_labels", "[", "i", "]", ")", "==", "len", "(", "gt_ignore", "[", "i", "]", ")", "\n", "", "", "area_ranges", "=", "(", "[", "(", "rg", "[", "0", "]", "**", "2", ",", "rg", "[", "1", "]", "**", "2", ")", "for", "rg", "in", "scale_ranges", "]", "\n", "if", "scale_ranges", "is", "not", "None", "else", "None", ")", "\n", "num_scales", "=", "len", "(", "scale_ranges", ")", "if", "scale_ranges", "is", "not", "None", "else", "1", "\n", "eval_results", "=", "[", "]", "\n", "num_classes", "=", "len", "(", "det_results", "[", "0", "]", ")", "# positive class num", "\n", "gt_labels", "=", "[", "\n", "label", "if", "label", ".", "ndim", "==", "1", "else", "label", "[", ":", ",", "0", "]", "for", "label", "in", "gt_labels", "\n", "]", "\n", "for", "i", "in", "range", "(", "num_classes", ")", ":", "\n", "# get gt and det bboxes of this class", "\n", "        ", "cls_dets", ",", "cls_gts", ",", "cls_gt_ignore", "=", "get_cls_results", "(", "\n", "det_results", ",", "gt_bboxes", ",", "gt_labels", ",", "gt_ignore", ",", "i", ")", "\n", "# calculate tp and fp for each image", "\n", "tpfp_func", "=", "(", "\n", "tpfp_imagenet", "if", "dataset", "in", "[", "'det'", ",", "'vid'", "]", "else", "tpfp_default", ")", "\n", "tpfp", "=", "[", "\n", "tpfp_func", "(", "cls_dets", "[", "j", "]", ",", "cls_gts", "[", "j", "]", ",", "cls_gt_ignore", "[", "j", "]", ",", "iou_thr", ",", "\n", "area_ranges", ")", "for", "j", "in", "range", "(", "len", "(", "cls_dets", ")", ")", "\n", "]", "\n", "tp", ",", "fp", "=", "tuple", "(", "zip", "(", "*", "tpfp", ")", ")", "\n", "# calculate gt number of each scale, gts ignored or beyond scale", "\n", "# are not counted", "\n", "num_gts", "=", "np", ".", "zeros", "(", "num_scales", ",", "dtype", "=", "int", ")", "\n", "for", "j", ",", "bbox", "in", "enumerate", "(", "cls_gts", ")", ":", "\n", "            ", "if", "area_ranges", "is", "None", ":", "\n", "                ", "num_gts", "[", "0", "]", "+=", "np", ".", "sum", "(", "np", ".", "logical_not", "(", "cls_gt_ignore", "[", "j", "]", ")", ")", "\n", "", "else", ":", "\n", "                ", "gt_areas", "=", "(", "bbox", "[", ":", ",", "2", "]", "-", "bbox", "[", ":", ",", "0", "]", "+", "1", ")", "*", "(", "\n", "bbox", "[", ":", ",", "3", "]", "-", "bbox", "[", ":", ",", "1", "]", "+", "1", ")", "\n", "for", "k", ",", "(", "min_area", ",", "max_area", ")", "in", "enumerate", "(", "area_ranges", ")", ":", "\n", "                    ", "num_gts", "[", "k", "]", "+=", "np", ".", "sum", "(", "\n", "np", ".", "logical_not", "(", "cls_gt_ignore", "[", "j", "]", ")", "&", "\n", "(", "gt_areas", ">=", "min_area", ")", "&", "(", "gt_areas", "<", "max_area", ")", ")", "\n", "# sort all det bboxes by score, also sort tp and fp", "\n", "", "", "", "cls_dets", "=", "np", ".", "vstack", "(", "cls_dets", ")", "\n", "num_dets", "=", "cls_dets", ".", "shape", "[", "0", "]", "\n", "sort_inds", "=", "np", ".", "argsort", "(", "-", "cls_dets", "[", ":", ",", "-", "1", "]", ")", "\n", "tp", "=", "np", ".", "hstack", "(", "tp", ")", "[", ":", ",", "sort_inds", "]", "\n", "fp", "=", "np", ".", "hstack", "(", "fp", ")", "[", ":", ",", "sort_inds", "]", "\n", "# calculate recall and precision with tp and fp", "\n", "tp", "=", "np", ".", "cumsum", "(", "tp", ",", "axis", "=", "1", ")", "\n", "fp", "=", "np", ".", "cumsum", "(", "fp", ",", "axis", "=", "1", ")", "\n", "eps", "=", "np", ".", "finfo", "(", "np", ".", "float32", ")", ".", "eps", "\n", "recalls", "=", "tp", "/", "np", ".", "maximum", "(", "num_gts", "[", ":", ",", "np", ".", "newaxis", "]", ",", "eps", ")", "\n", "precisions", "=", "tp", "/", "np", ".", "maximum", "(", "(", "tp", "+", "fp", ")", ",", "eps", ")", "\n", "# calculate AP", "\n", "if", "scale_ranges", "is", "None", ":", "\n", "            ", "recalls", "=", "recalls", "[", "0", ",", ":", "]", "\n", "precisions", "=", "precisions", "[", "0", ",", ":", "]", "\n", "num_gts", "=", "num_gts", ".", "item", "(", ")", "\n", "", "mode", "=", "'area'", "if", "dataset", "!=", "'voc07'", "else", "'11points'", "\n", "ap", "=", "average_precision", "(", "recalls", ",", "precisions", ",", "mode", ")", "\n", "eval_results", ".", "append", "(", "{", "\n", "'num_gts'", ":", "num_gts", ",", "\n", "'num_dets'", ":", "num_dets", ",", "\n", "'recall'", ":", "recalls", ",", "\n", "'precision'", ":", "precisions", ",", "\n", "'ap'", ":", "ap", "\n", "}", ")", "\n", "", "if", "scale_ranges", "is", "not", "None", ":", "\n", "# shape (num_classes, num_scales)", "\n", "        ", "all_ap", "=", "np", ".", "vstack", "(", "[", "cls_result", "[", "'ap'", "]", "for", "cls_result", "in", "eval_results", "]", ")", "\n", "all_num_gts", "=", "np", ".", "vstack", "(", "\n", "[", "cls_result", "[", "'num_gts'", "]", "for", "cls_result", "in", "eval_results", "]", ")", "\n", "mean_ap", "=", "[", "\n", "all_ap", "[", "all_num_gts", "[", ":", ",", "i", "]", ">", "0", ",", "i", "]", ".", "mean", "(", ")", "\n", "if", "np", ".", "any", "(", "all_num_gts", "[", ":", ",", "i", "]", ">", "0", ")", "else", "0.0", "\n", "for", "i", "in", "range", "(", "num_scales", ")", "\n", "]", "\n", "", "else", ":", "\n", "        ", "aps", "=", "[", "]", "\n", "for", "cls_result", "in", "eval_results", ":", "\n", "            ", "if", "cls_result", "[", "'num_gts'", "]", ">", "0", ":", "\n", "                ", "aps", ".", "append", "(", "cls_result", "[", "'ap'", "]", ")", "\n", "", "", "mean_ap", "=", "np", ".", "array", "(", "aps", ")", ".", "mean", "(", ")", ".", "item", "(", ")", "if", "aps", "else", "0.0", "\n", "", "if", "print_summary", ":", "\n", "        ", "print_map_summary", "(", "mean_ap", ",", "eval_results", ",", "dataset", ")", "\n", "\n", "", "return", "mean_ap", ",", "eval_results", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.mean_ap.print_map_summary": [[332, 381], ["len", "print", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "enumerate", "range", "isinstance", "len", "mmcv.is_str", "isinstance", "range", "table_data.append", "terminaltables.AsciiTable", "print", "str", "class_names.get_classes", "table_data.append", "numpy.array", "numpy.array", "range"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.class_names.get_classes"], ["", "def", "print_map_summary", "(", "mean_ap", ",", "results", ",", "dataset", "=", "None", ")", ":", "\n", "    ", "\"\"\"Print mAP and results of each class.\n\n    Args:\n        mean_ap(float): calculated from `eval_map`\n        results(list): calculated from `eval_map`\n        dataset(None or str or list): dataset name or dataset classes.\n    \"\"\"", "\n", "num_scales", "=", "len", "(", "results", "[", "0", "]", "[", "'ap'", "]", ")", "if", "isinstance", "(", "results", "[", "0", "]", "[", "'ap'", "]", ",", "\n", "np", ".", "ndarray", ")", "else", "1", "\n", "\n", "num_classes", "=", "len", "(", "results", ")", "\n", "print", "(", "'first instialization: the num_classes is '", ",", "num_classes", ")", "\n", "\n", "recalls", "=", "np", ".", "zeros", "(", "(", "num_scales", ",", "num_classes", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "precisions", "=", "np", ".", "zeros", "(", "(", "num_scales", ",", "num_classes", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "aps", "=", "np", ".", "zeros", "(", "(", "num_scales", ",", "num_classes", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "num_gts", "=", "np", ".", "zeros", "(", "(", "num_scales", ",", "num_classes", ")", ",", "dtype", "=", "int", ")", "\n", "for", "i", ",", "cls_result", "in", "enumerate", "(", "results", ")", ":", "\n", "        ", "if", "cls_result", "[", "'recall'", "]", ".", "size", ">", "0", ":", "\n", "            ", "recalls", "[", ":", ",", "i", "]", "=", "np", ".", "array", "(", "cls_result", "[", "'recall'", "]", ",", "ndmin", "=", "2", ")", "[", ":", ",", "-", "1", "]", "\n", "precisions", "[", ":", ",", "i", "]", "=", "np", ".", "array", "(", "\n", "cls_result", "[", "'precision'", "]", ",", "ndmin", "=", "2", ")", "[", ":", ",", "-", "1", "]", "\n", "", "aps", "[", ":", ",", "i", "]", "=", "cls_result", "[", "'ap'", "]", "\n", "num_gts", "[", ":", ",", "i", "]", "=", "cls_result", "[", "'num_gts'", "]", "\n", "\n", "", "if", "dataset", "is", "None", ":", "\n", "        ", "label_names", "=", "[", "str", "(", "i", ")", "for", "i", "in", "range", "(", "1", ",", "num_classes", "+", "1", ")", "]", "\n", "", "elif", "mmcv", ".", "is_str", "(", "dataset", ")", ":", "\n", "        ", "label_names", "=", "get_classes", "(", "dataset", ")", "\n", "", "else", ":", "\n", "        ", "label_names", "=", "dataset", "\n", "\n", "", "if", "not", "isinstance", "(", "mean_ap", ",", "list", ")", ":", "\n", "        ", "mean_ap", "=", "[", "mean_ap", "]", "\n", "", "header", "=", "[", "'class'", ",", "'gts'", ",", "'dets'", ",", "'recall'", ",", "'precision'", ",", "'ap'", "]", "\n", "for", "i", "in", "range", "(", "num_scales", ")", ":", "\n", "        ", "table_data", "=", "[", "header", "]", "\n", "for", "j", "in", "range", "(", "num_classes", ")", ":", "\n", "            ", "row_data", "=", "[", "\n", "label_names", "[", "j", "]", ",", "num_gts", "[", "i", ",", "j", "]", ",", "results", "[", "j", "]", "[", "'num_dets'", "]", ",", "\n", "'{:.3f}'", ".", "format", "(", "recalls", "[", "i", ",", "j", "]", ")", ",", "'{:.3f}'", ".", "format", "(", "\n", "precisions", "[", "i", ",", "j", "]", ")", ",", "'{:.3f}'", ".", "format", "(", "aps", "[", "i", ",", "j", "]", ")", "\n", "]", "\n", "table_data", ".", "append", "(", "row_data", ")", "\n", "", "table_data", ".", "append", "(", "[", "'mAP'", ",", "''", ",", "''", ",", "''", ",", "''", ",", "'{:.3f}'", ".", "format", "(", "mean_ap", "[", "i", "]", ")", "]", ")", "\n", "table", "=", "AsciiTable", "(", "table_data", ")", "\n", "table", ".", "inner_footing_row_border", "=", "True", "\n", "print", "(", "table", ".", "table", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.recall._recalls": [[7, 38], ["sum", "numpy.zeros", "enumerate", "numpy.fliplr", "numpy.zeros", "enumerate", "numpy.zeros", "range", "numpy.sort", "[].copy", "numpy.zeros", "range", "numpy.hstack", "float", "numpy.hstack", "[].copy.argmax", "max_ious.argmax", "numpy.arange"], "function", ["None"], ["def", "_recalls", "(", "all_ious", ",", "proposal_nums", ",", "thrs", ")", ":", "\n", "\n", "    ", "img_num", "=", "all_ious", ".", "shape", "[", "0", "]", "\n", "total_gt_num", "=", "sum", "(", "[", "ious", ".", "shape", "[", "0", "]", "for", "ious", "in", "all_ious", "]", ")", "\n", "\n", "_ious", "=", "np", ".", "zeros", "(", "(", "proposal_nums", ".", "size", ",", "total_gt_num", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "for", "k", ",", "proposal_num", "in", "enumerate", "(", "proposal_nums", ")", ":", "\n", "        ", "tmp_ious", "=", "np", ".", "zeros", "(", "0", ")", "\n", "for", "i", "in", "range", "(", "img_num", ")", ":", "\n", "            ", "ious", "=", "all_ious", "[", "i", "]", "[", ":", ",", ":", "proposal_num", "]", ".", "copy", "(", ")", "\n", "gt_ious", "=", "np", ".", "zeros", "(", "(", "ious", ".", "shape", "[", "0", "]", ")", ")", "\n", "if", "ious", ".", "size", "==", "0", ":", "\n", "                ", "tmp_ious", "=", "np", ".", "hstack", "(", "(", "tmp_ious", ",", "gt_ious", ")", ")", "\n", "continue", "\n", "", "for", "j", "in", "range", "(", "ious", ".", "shape", "[", "0", "]", ")", ":", "\n", "                ", "gt_max_overlaps", "=", "ious", ".", "argmax", "(", "axis", "=", "1", ")", "\n", "max_ious", "=", "ious", "[", "np", ".", "arange", "(", "0", ",", "ious", ".", "shape", "[", "0", "]", ")", ",", "gt_max_overlaps", "]", "\n", "gt_idx", "=", "max_ious", ".", "argmax", "(", ")", "\n", "gt_ious", "[", "j", "]", "=", "max_ious", "[", "gt_idx", "]", "\n", "box_idx", "=", "gt_max_overlaps", "[", "gt_idx", "]", "\n", "ious", "[", "gt_idx", ",", ":", "]", "=", "-", "1", "\n", "ious", "[", ":", ",", "box_idx", "]", "=", "-", "1", "\n", "", "tmp_ious", "=", "np", ".", "hstack", "(", "(", "tmp_ious", ",", "gt_ious", ")", ")", "\n", "", "_ious", "[", "k", ",", ":", "]", "=", "tmp_ious", "\n", "\n", "", "_ious", "=", "np", ".", "fliplr", "(", "np", ".", "sort", "(", "_ious", ",", "axis", "=", "1", ")", ")", "\n", "recalls", "=", "np", ".", "zeros", "(", "(", "proposal_nums", ".", "size", ",", "thrs", ".", "size", ")", ")", "\n", "for", "i", ",", "thr", "in", "enumerate", "(", "thrs", ")", ":", "\n", "        ", "recalls", "[", ":", ",", "i", "]", "=", "(", "_ious", ">=", "thr", ")", ".", "sum", "(", "axis", "=", "1", ")", "/", "float", "(", "total_gt_num", ")", "\n", "\n", "", "return", "recalls", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.recall.set_recall_param": [[40, 60], ["isinstance", "numpy.array", "isinstance", "numpy.array", "isinstance", "numpy.array", "numpy.array", "isinstance", "numpy.array"], "function", ["None"], ["", "def", "set_recall_param", "(", "proposal_nums", ",", "iou_thrs", ")", ":", "\n", "    ", "\"\"\"Check proposal_nums and iou_thrs and set correct format.\n    \"\"\"", "\n", "if", "isinstance", "(", "proposal_nums", ",", "list", ")", ":", "\n", "        ", "_proposal_nums", "=", "np", ".", "array", "(", "proposal_nums", ")", "\n", "", "elif", "isinstance", "(", "proposal_nums", ",", "int", ")", ":", "\n", "        ", "_proposal_nums", "=", "np", ".", "array", "(", "[", "proposal_nums", "]", ")", "\n", "", "else", ":", "\n", "        ", "_proposal_nums", "=", "proposal_nums", "\n", "\n", "", "if", "iou_thrs", "is", "None", ":", "\n", "        ", "_iou_thrs", "=", "np", ".", "array", "(", "[", "0.5", "]", ")", "\n", "", "elif", "isinstance", "(", "iou_thrs", ",", "list", ")", ":", "\n", "        ", "_iou_thrs", "=", "np", ".", "array", "(", "iou_thrs", ")", "\n", "", "elif", "isinstance", "(", "iou_thrs", ",", "float", ")", ":", "\n", "        ", "_iou_thrs", "=", "np", ".", "array", "(", "[", "iou_thrs", "]", ")", "\n", "", "else", ":", "\n", "        ", "_iou_thrs", "=", "iou_thrs", "\n", "\n", "", "return", "_proposal_nums", ",", "_iou_thrs", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.recall.eval_recalls": [[62, 103], ["len", "recall.set_recall_param", "range", "numpy.array", "recall._recalls", "len", "min", "np.array.append", "recall.print_recall_summary", "numpy.zeros", "bbox_overlaps.bbox_overlaps", "numpy.argsort"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.recall.set_recall_param", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.recall._recalls", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.recall.print_recall_summary", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps"], ["", "def", "eval_recalls", "(", "gts", ",", "\n", "proposals", ",", "\n", "proposal_nums", "=", "None", ",", "\n", "iou_thrs", "=", "None", ",", "\n", "print_summary", "=", "True", ")", ":", "\n", "    ", "\"\"\"Calculate recalls.\n\n    Args:\n        gts(list or ndarray): a list of arrays of shape (n, 4)\n        proposals(list or ndarray): a list of arrays of shape (k, 4) or (k, 5)\n        proposal_nums(int or list of int or ndarray): top N proposals\n        thrs(float or list or ndarray): iou thresholds\n\n    Returns:\n        ndarray: recalls of different ious and proposal nums\n    \"\"\"", "\n", "\n", "img_num", "=", "len", "(", "gts", ")", "\n", "assert", "img_num", "==", "len", "(", "proposals", ")", "\n", "\n", "proposal_nums", ",", "iou_thrs", "=", "set_recall_param", "(", "proposal_nums", ",", "iou_thrs", ")", "\n", "\n", "all_ious", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "img_num", ")", ":", "\n", "        ", "if", "proposals", "[", "i", "]", ".", "ndim", "==", "2", "and", "proposals", "[", "i", "]", ".", "shape", "[", "1", "]", "==", "5", ":", "\n", "            ", "scores", "=", "proposals", "[", "i", "]", "[", ":", ",", "4", "]", "\n", "sort_idx", "=", "np", ".", "argsort", "(", "scores", ")", "[", ":", ":", "-", "1", "]", "\n", "img_proposal", "=", "proposals", "[", "i", "]", "[", "sort_idx", ",", ":", "]", "\n", "", "else", ":", "\n", "            ", "img_proposal", "=", "proposals", "[", "i", "]", "\n", "", "prop_num", "=", "min", "(", "img_proposal", ".", "shape", "[", "0", "]", ",", "proposal_nums", "[", "-", "1", "]", ")", "\n", "if", "gts", "[", "i", "]", "is", "None", "or", "gts", "[", "i", "]", ".", "shape", "[", "0", "]", "==", "0", ":", "\n", "            ", "ious", "=", "np", ".", "zeros", "(", "(", "0", ",", "img_proposal", ".", "shape", "[", "0", "]", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "", "else", ":", "\n", "            ", "ious", "=", "bbox_overlaps", "(", "gts", "[", "i", "]", ",", "img_proposal", "[", ":", "prop_num", ",", ":", "4", "]", ")", "\n", "", "all_ious", ".", "append", "(", "ious", ")", "\n", "", "all_ious", "=", "np", ".", "array", "(", "all_ious", ")", "\n", "recalls", "=", "_recalls", "(", "all_ious", ",", "proposal_nums", ",", "iou_thrs", ")", "\n", "if", "print_summary", ":", "\n", "        ", "print_recall_summary", "(", "recalls", ",", "proposal_nums", ",", "iou_thrs", ")", "\n", "", "return", "recalls", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.recall.print_recall_summary": [[105, 136], ["numpy.array", "numpy.array", "enumerate", "terminaltables.AsciiTable", "print", "numpy.arange", "numpy.arange", "iou_thrs[].tolist", "row.insert", "table_data.append", "recalls[].tolist"], "function", ["None"], ["", "def", "print_recall_summary", "(", "recalls", ",", "\n", "proposal_nums", ",", "\n", "iou_thrs", ",", "\n", "row_idxs", "=", "None", ",", "\n", "col_idxs", "=", "None", ")", ":", "\n", "    ", "\"\"\"Print recalls in a table.\n\n    Args:\n        recalls(ndarray): calculated from `bbox_recalls`\n        proposal_nums(ndarray or list): top N proposals\n        iou_thrs(ndarray or list): iou thresholds\n        row_idxs(ndarray): which rows(proposal nums) to print\n        col_idxs(ndarray): which cols(iou thresholds) to print\n    \"\"\"", "\n", "proposal_nums", "=", "np", ".", "array", "(", "proposal_nums", ",", "dtype", "=", "np", ".", "int32", ")", "\n", "iou_thrs", "=", "np", ".", "array", "(", "iou_thrs", ")", "\n", "if", "row_idxs", "is", "None", ":", "\n", "        ", "row_idxs", "=", "np", ".", "arange", "(", "proposal_nums", ".", "size", ")", "\n", "", "if", "col_idxs", "is", "None", ":", "\n", "        ", "col_idxs", "=", "np", ".", "arange", "(", "iou_thrs", ".", "size", ")", "\n", "", "row_header", "=", "[", "''", "]", "+", "iou_thrs", "[", "col_idxs", "]", ".", "tolist", "(", ")", "\n", "table_data", "=", "[", "row_header", "]", "\n", "for", "i", ",", "num", "in", "enumerate", "(", "proposal_nums", "[", "row_idxs", "]", ")", ":", "\n", "        ", "row", "=", "[", "\n", "'{:.3f}'", ".", "format", "(", "val", ")", "\n", "for", "val", "in", "recalls", "[", "row_idxs", "[", "i", "]", ",", "col_idxs", "]", ".", "tolist", "(", ")", "\n", "]", "\n", "row", ".", "insert", "(", "0", ",", "num", ")", "\n", "table_data", ".", "append", "(", "row", ")", "\n", "", "table", "=", "AsciiTable", "(", "table_data", ")", "\n", "print", "(", "table", ".", "table", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.recall.plot_num_recall": [[138, 161], ["isinstance", "isinstance", "plt.figure", "plt.plot", "plt.xlabel", "plt.ylabel", "plt.axis", "plt.figure.show", "proposal_nums.tolist", "recalls.tolist", "proposal_nums.max"], "function", ["None"], ["", "def", "plot_num_recall", "(", "recalls", ",", "proposal_nums", ")", ":", "\n", "    ", "\"\"\"Plot Proposal_num-Recalls curve.\n\n    Args:\n        recalls(ndarray or list): shape (k,)\n        proposal_nums(ndarray or list): same shape as `recalls`\n    \"\"\"", "\n", "if", "isinstance", "(", "proposal_nums", ",", "np", ".", "ndarray", ")", ":", "\n", "        ", "_proposal_nums", "=", "proposal_nums", ".", "tolist", "(", ")", "\n", "", "else", ":", "\n", "        ", "_proposal_nums", "=", "proposal_nums", "\n", "", "if", "isinstance", "(", "recalls", ",", "np", ".", "ndarray", ")", ":", "\n", "        ", "_recalls", "=", "recalls", ".", "tolist", "(", ")", "\n", "", "else", ":", "\n", "        ", "_recalls", "=", "recalls", "\n", "\n", "", "import", "matplotlib", ".", "pyplot", "as", "plt", "\n", "f", "=", "plt", ".", "figure", "(", ")", "\n", "plt", ".", "plot", "(", "[", "0", "]", "+", "_proposal_nums", ",", "[", "0", "]", "+", "_recalls", ")", "\n", "plt", ".", "xlabel", "(", "'Proposal num'", ")", "\n", "plt", ".", "ylabel", "(", "'Recall'", ")", "\n", "plt", ".", "axis", "(", "[", "0", ",", "proposal_nums", ".", "max", "(", ")", ",", "0", ",", "1", "]", ")", "\n", "f", ".", "show", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.recall.plot_iou_recall": [[163, 186], ["isinstance", "isinstance", "plt.figure", "plt.plot", "plt.xlabel", "plt.ylabel", "plt.axis", "plt.figure.show", "iou_thrs.tolist", "recalls.tolist", "iou_thrs.min"], "function", ["None"], ["", "def", "plot_iou_recall", "(", "recalls", ",", "iou_thrs", ")", ":", "\n", "    ", "\"\"\"Plot IoU-Recalls curve.\n\n    Args:\n        recalls(ndarray or list): shape (k,)\n        iou_thrs(ndarray or list): same shape as `recalls`\n    \"\"\"", "\n", "if", "isinstance", "(", "iou_thrs", ",", "np", ".", "ndarray", ")", ":", "\n", "        ", "_iou_thrs", "=", "iou_thrs", ".", "tolist", "(", ")", "\n", "", "else", ":", "\n", "        ", "_iou_thrs", "=", "iou_thrs", "\n", "", "if", "isinstance", "(", "recalls", ",", "np", ".", "ndarray", ")", ":", "\n", "        ", "_recalls", "=", "recalls", ".", "tolist", "(", ")", "\n", "", "else", ":", "\n", "        ", "_recalls", "=", "recalls", "\n", "\n", "", "import", "matplotlib", ".", "pyplot", "as", "plt", "\n", "f", "=", "plt", ".", "figure", "(", ")", "\n", "plt", ".", "plot", "(", "_iou_thrs", "+", "[", "1.0", "]", ",", "_recalls", "+", "[", "0.", "]", ")", "\n", "plt", ".", "xlabel", "(", "'IoU'", ")", "\n", "plt", ".", "ylabel", "(", "'Recall'", ")", "\n", "plt", ".", "axis", "(", "[", "iou_thrs", ".", "min", "(", ")", ",", "1", ",", "0", ",", "1", "]", ")", "\n", "f", ".", "show", "(", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.coco_eval": [[9, 39], ["mmcv.is_str", "isinstance", "result_file.endswith", "pycocotools.coco.COCO.loadRes", "pycocotools.coco.COCO.getImgIds", "pycocotools.coco.COCO", "coco_utils.fast_eval_recall", "enumerate", "pycocotools.cocoeval.COCOeval", "pycocotools.cocoeval.COCOeval.evaluate", "pycocotools.cocoeval.COCOeval.accumulate", "pycocotools.cocoeval.COCOeval.summarize", "numpy.array", "print", "list"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.fast_eval_recall", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.eval_hooks.CocoDistEvalmAPHook.evaluate"], ["def", "coco_eval", "(", "result_file", ",", "result_types", ",", "coco", ",", "max_dets", "=", "(", "100", ",", "300", ",", "1000", ")", ")", ":", "\n", "    ", "for", "res_type", "in", "result_types", ":", "\n", "        ", "assert", "res_type", "in", "[", "\n", "'proposal'", ",", "'proposal_fast'", ",", "'bbox'", ",", "'segm'", ",", "'keypoints'", "\n", "]", "\n", "\n", "", "if", "mmcv", ".", "is_str", "(", "coco", ")", ":", "\n", "        ", "coco", "=", "COCO", "(", "coco", ")", "\n", "", "assert", "isinstance", "(", "coco", ",", "COCO", ")", "\n", "\n", "if", "result_types", "==", "[", "'proposal_fast'", "]", ":", "\n", "        ", "ar", "=", "fast_eval_recall", "(", "result_file", ",", "coco", ",", "np", ".", "array", "(", "max_dets", ")", ")", "\n", "for", "i", ",", "num", "in", "enumerate", "(", "max_dets", ")", ":", "\n", "            ", "print", "(", "'AR@{}\\t= {:.4f}'", ".", "format", "(", "num", ",", "ar", "[", "i", "]", ")", ")", "\n", "", "return", "\n", "\n", "", "assert", "result_file", ".", "endswith", "(", "'.json'", ")", "\n", "coco_dets", "=", "coco", ".", "loadRes", "(", "result_file", ")", "\n", "\n", "img_ids", "=", "coco", ".", "getImgIds", "(", ")", "\n", "for", "res_type", "in", "result_types", ":", "\n", "        ", "iou_type", "=", "'bbox'", "if", "res_type", "==", "'proposal'", "else", "res_type", "\n", "cocoEval", "=", "COCOeval", "(", "coco", ",", "coco_dets", ",", "iou_type", ")", "\n", "cocoEval", ".", "params", ".", "imgIds", "=", "img_ids", "\n", "if", "res_type", "==", "'proposal'", ":", "\n", "            ", "cocoEval", ".", "params", ".", "useCats", "=", "0", "\n", "cocoEval", ".", "params", ".", "maxDets", "=", "list", "(", "max_dets", ")", "\n", "", "cocoEval", ".", "evaluate", "(", ")", "\n", "cocoEval", ".", "accumulate", "(", ")", "\n", "cocoEval", ".", "summarize", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.fast_eval_recall": [[41, 76], ["numpy.arange", "mmcv.is_str", "coco.getImgIds", "range", "recall.eval_recalls", "recall.eval_recalls.mean", "mmcv.load.endswith", "mmcv.load", "len", "coco.getAnnIds", "coco.loadAnns", "numpy.array", "gt_bboxes.append", "isinstance", "TypeError", "len", "gt_bboxes.append", "np.zeros.append", "numpy.zeros", "numpy.zeros", "ann.get", "type"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.recall.eval_recalls"], ["", "", "def", "fast_eval_recall", "(", "results", ",", "\n", "coco", ",", "\n", "max_dets", ",", "\n", "iou_thrs", "=", "np", ".", "arange", "(", "0.5", ",", "0.96", ",", "0.05", ")", ")", ":", "\n", "    ", "if", "mmcv", ".", "is_str", "(", "results", ")", ":", "\n", "        ", "assert", "results", ".", "endswith", "(", "'.pkl'", ")", "\n", "results", "=", "mmcv", ".", "load", "(", "results", ")", "\n", "", "elif", "not", "isinstance", "(", "results", ",", "list", ")", ":", "\n", "        ", "raise", "TypeError", "(", "\n", "'results must be a list of numpy arrays or a filename, not {}'", ".", "\n", "format", "(", "type", "(", "results", ")", ")", ")", "\n", "\n", "", "gt_bboxes", "=", "[", "]", "\n", "img_ids", "=", "coco", ".", "getImgIds", "(", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "img_ids", ")", ")", ":", "\n", "        ", "ann_ids", "=", "coco", ".", "getAnnIds", "(", "imgIds", "=", "img_ids", "[", "i", "]", ")", "\n", "ann_info", "=", "coco", ".", "loadAnns", "(", "ann_ids", ")", "\n", "if", "len", "(", "ann_info", ")", "==", "0", ":", "\n", "            ", "gt_bboxes", ".", "append", "(", "np", ".", "zeros", "(", "(", "0", ",", "4", ")", ")", ")", "\n", "continue", "\n", "", "bboxes", "=", "[", "]", "\n", "for", "ann", "in", "ann_info", ":", "\n", "            ", "if", "ann", ".", "get", "(", "'ignore'", ",", "False", ")", "or", "ann", "[", "'iscrowd'", "]", ":", "\n", "                ", "continue", "\n", "", "x1", ",", "y1", ",", "w", ",", "h", "=", "ann", "[", "'bbox'", "]", "\n", "bboxes", ".", "append", "(", "[", "x1", ",", "y1", ",", "x1", "+", "w", "-", "1", ",", "y1", "+", "h", "-", "1", "]", ")", "\n", "", "bboxes", "=", "np", ".", "array", "(", "bboxes", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "if", "bboxes", ".", "shape", "[", "0", "]", "==", "0", ":", "\n", "            ", "bboxes", "=", "np", ".", "zeros", "(", "(", "0", ",", "4", ")", ")", "\n", "", "gt_bboxes", ".", "append", "(", "bboxes", ")", "\n", "\n", "", "recalls", "=", "eval_recalls", "(", "\n", "gt_bboxes", ",", "results", ",", "max_dets", ",", "iou_thrs", ",", "print_summary", "=", "False", ")", "\n", "ar", "=", "recalls", ".", "mean", "(", "axis", "=", "1", ")", "\n", "return", "ar", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.xyxy2xywh": [[78, 85], ["bbox.tolist"], "function", ["None"], ["", "def", "xyxy2xywh", "(", "bbox", ")", ":", "\n", "    ", "_bbox", "=", "bbox", ".", "tolist", "(", ")", "\n", "return", "[", "\n", "_bbox", "[", "0", "]", ",", "\n", "_bbox", "[", "1", "]", ",", "\n", "_bbox", "[", "2", "]", "-", "_bbox", "[", "0", "]", "+", "1", ",", "\n", "_bbox", "[", "3", "]", "-", "_bbox", "[", "1", "]", "+", "1", ",", "\n", "]", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.proposal2json": [[88, 101], ["range", "len", "range", "dict", "coco_utils.xyxy2xywh", "float", "json_results.append"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.xyxy2xywh"], ["", "def", "proposal2json", "(", "dataset", ",", "results", ")", ":", "\n", "    ", "json_results", "=", "[", "]", "\n", "for", "idx", "in", "range", "(", "len", "(", "dataset", ")", ")", ":", "\n", "        ", "img_id", "=", "dataset", ".", "img_ids", "[", "idx", "]", "\n", "bboxes", "=", "results", "[", "idx", "]", "\n", "for", "i", "in", "range", "(", "bboxes", ".", "shape", "[", "0", "]", ")", ":", "\n", "            ", "data", "=", "dict", "(", ")", "\n", "data", "[", "'image_id'", "]", "=", "img_id", "\n", "data", "[", "'bbox'", "]", "=", "xyxy2xywh", "(", "bboxes", "[", "i", "]", ")", "\n", "data", "[", "'score'", "]", "=", "float", "(", "bboxes", "[", "i", "]", "[", "4", "]", ")", "\n", "data", "[", "'category_id'", "]", "=", "1", "\n", "json_results", ".", "append", "(", "data", ")", "\n", "", "", "return", "json_results", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.det2json": [[103, 118], ["range", "len", "range", "len", "range", "dict", "coco_utils.xyxy2xywh", "float", "json_results.append"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.xyxy2xywh"], ["", "def", "det2json", "(", "dataset", ",", "results", ")", ":", "\n", "    ", "json_results", "=", "[", "]", "\n", "for", "idx", "in", "range", "(", "len", "(", "dataset", ")", ")", ":", "\n", "        ", "img_id", "=", "dataset", ".", "img_ids", "[", "idx", "]", "\n", "result", "=", "results", "[", "idx", "]", "\n", "for", "label", "in", "range", "(", "len", "(", "result", ")", ")", ":", "\n", "            ", "bboxes", "=", "result", "[", "label", "]", "\n", "for", "i", "in", "range", "(", "bboxes", ".", "shape", "[", "0", "]", ")", ":", "\n", "                ", "data", "=", "dict", "(", ")", "\n", "data", "[", "'image_id'", "]", "=", "img_id", "\n", "data", "[", "'bbox'", "]", "=", "xyxy2xywh", "(", "bboxes", "[", "i", "]", ")", "\n", "data", "[", "'score'", "]", "=", "float", "(", "bboxes", "[", "i", "]", "[", "4", "]", ")", "\n", "data", "[", "'category_id'", "]", "=", "dataset", ".", "cat_ids", "[", "label", "]", "\n", "json_results", ".", "append", "(", "data", ")", "\n", "", "", "", "return", "json_results", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.segm2json": [[120, 138], ["range", "len", "range", "len", "range", "dict", "coco_utils.xyxy2xywh", "float", "[].decode", "json_results.append"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.xyxy2xywh"], ["", "def", "segm2json", "(", "dataset", ",", "results", ")", ":", "\n", "    ", "json_results", "=", "[", "]", "\n", "for", "idx", "in", "range", "(", "len", "(", "dataset", ")", ")", ":", "\n", "        ", "img_id", "=", "dataset", ".", "img_ids", "[", "idx", "]", "\n", "det", ",", "seg", "=", "results", "[", "idx", "]", "\n", "for", "label", "in", "range", "(", "len", "(", "det", ")", ")", ":", "\n", "            ", "bboxes", "=", "det", "[", "label", "]", "\n", "segms", "=", "seg", "[", "label", "]", "\n", "for", "i", "in", "range", "(", "bboxes", ".", "shape", "[", "0", "]", ")", ":", "\n", "                ", "data", "=", "dict", "(", ")", "\n", "data", "[", "'image_id'", "]", "=", "img_id", "\n", "data", "[", "'bbox'", "]", "=", "xyxy2xywh", "(", "bboxes", "[", "i", "]", ")", "\n", "data", "[", "'score'", "]", "=", "float", "(", "bboxes", "[", "i", "]", "[", "4", "]", ")", "\n", "data", "[", "'category_id'", "]", "=", "dataset", ".", "cat_ids", "[", "label", "]", "\n", "segms", "[", "i", "]", "[", "'counts'", "]", "=", "segms", "[", "i", "]", "[", "'counts'", "]", ".", "decode", "(", ")", "\n", "data", "[", "'segmentation'", "]", "=", "segms", "[", "i", "]", "\n", "json_results", ".", "append", "(", "data", ")", "\n", "", "", "", "return", "json_results", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.results2json": [[140, 150], ["isinstance", "mmcv.dump", "coco_utils.det2json", "isinstance", "coco_utils.segm2json", "isinstance", "coco_utils.proposal2json", "TypeError"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.det2json", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.segm2json", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.proposal2json"], ["", "def", "results2json", "(", "dataset", ",", "results", ",", "out_file", ")", ":", "\n", "    ", "if", "isinstance", "(", "results", "[", "0", "]", ",", "list", ")", ":", "\n", "        ", "json_results", "=", "det2json", "(", "dataset", ",", "results", ")", "\n", "", "elif", "isinstance", "(", "results", "[", "0", "]", ",", "tuple", ")", ":", "\n", "        ", "json_results", "=", "segm2json", "(", "dataset", ",", "results", ")", "\n", "", "elif", "isinstance", "(", "results", "[", "0", "]", ",", "np", ".", "ndarray", ")", ":", "\n", "        ", "json_results", "=", "proposal2json", "(", "dataset", ",", "results", ")", "\n", "", "else", ":", "\n", "        ", "raise", "TypeError", "(", "'invalid type of results'", ")", "\n", "", "mmcv", ".", "dump", "(", "json_results", ",", "out_file", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.bbox_overlaps.bbox_overlaps": [[4, 50], ["bboxes1.astype.astype", "bboxes2.astype.astype", "numpy.zeros", "range", "numpy.zeros", "numpy.maximum", "numpy.maximum", "numpy.minimum", "numpy.minimum", "numpy.maximum", "numpy.maximum"], "function", ["None"], ["def", "bbox_overlaps", "(", "bboxes1", ",", "bboxes2", ",", "mode", "=", "'iou'", ")", ":", "\n", "    ", "\"\"\"Calculate the ious between each bbox of bboxes1 and bboxes2.\n\n    Args:\n        bboxes1(ndarray): shape (n, 4)\n        bboxes2(ndarray): shape (k, 4)\n        mode(str): iou (intersection over union) or iof (intersection\n            over foreground)\n\n    Returns:\n        ious(ndarray): shape (n, k)\n    \"\"\"", "\n", "\n", "assert", "mode", "in", "[", "'iou'", ",", "'iof'", "]", "\n", "\n", "bboxes1", "=", "bboxes1", ".", "astype", "(", "np", ".", "float32", ")", "\n", "bboxes2", "=", "bboxes2", ".", "astype", "(", "np", ".", "float32", ")", "\n", "rows", "=", "bboxes1", ".", "shape", "[", "0", "]", "\n", "cols", "=", "bboxes2", ".", "shape", "[", "0", "]", "\n", "ious", "=", "np", ".", "zeros", "(", "(", "rows", ",", "cols", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "if", "rows", "*", "cols", "==", "0", ":", "\n", "        ", "return", "ious", "\n", "", "exchange", "=", "False", "\n", "if", "bboxes1", ".", "shape", "[", "0", "]", ">", "bboxes2", ".", "shape", "[", "0", "]", ":", "\n", "        ", "bboxes1", ",", "bboxes2", "=", "bboxes2", ",", "bboxes1", "\n", "ious", "=", "np", ".", "zeros", "(", "(", "cols", ",", "rows", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "exchange", "=", "True", "\n", "", "area1", "=", "(", "bboxes1", "[", ":", ",", "2", "]", "-", "bboxes1", "[", ":", ",", "0", "]", "+", "1", ")", "*", "(", "\n", "bboxes1", "[", ":", ",", "3", "]", "-", "bboxes1", "[", ":", ",", "1", "]", "+", "1", ")", "\n", "area2", "=", "(", "bboxes2", "[", ":", ",", "2", "]", "-", "bboxes2", "[", ":", ",", "0", "]", "+", "1", ")", "*", "(", "\n", "bboxes2", "[", ":", ",", "3", "]", "-", "bboxes2", "[", ":", ",", "1", "]", "+", "1", ")", "\n", "for", "i", "in", "range", "(", "bboxes1", ".", "shape", "[", "0", "]", ")", ":", "\n", "        ", "x_start", "=", "np", ".", "maximum", "(", "bboxes1", "[", "i", ",", "0", "]", ",", "bboxes2", "[", ":", ",", "0", "]", ")", "\n", "y_start", "=", "np", ".", "maximum", "(", "bboxes1", "[", "i", ",", "1", "]", ",", "bboxes2", "[", ":", ",", "1", "]", ")", "\n", "x_end", "=", "np", ".", "minimum", "(", "bboxes1", "[", "i", ",", "2", "]", ",", "bboxes2", "[", ":", ",", "2", "]", ")", "\n", "y_end", "=", "np", ".", "minimum", "(", "bboxes1", "[", "i", ",", "3", "]", ",", "bboxes2", "[", ":", ",", "3", "]", ")", "\n", "overlap", "=", "np", ".", "maximum", "(", "x_end", "-", "x_start", "+", "1", ",", "0", ")", "*", "np", ".", "maximum", "(", "\n", "y_end", "-", "y_start", "+", "1", ",", "0", ")", "\n", "if", "mode", "==", "'iou'", ":", "\n", "            ", "union", "=", "area1", "[", "i", "]", "+", "area2", "-", "overlap", "\n", "", "else", ":", "\n", "            ", "union", "=", "area1", "[", "i", "]", "if", "not", "exchange", "else", "area2", "\n", "", "ious", "[", "i", ",", ":", "]", "=", "overlap", "/", "union", "\n", "", "if", "exchange", ":", "\n", "        ", "ious", "=", "ious", ".", "T", "\n", "", "return", "ious", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.class_names.voc_classes": [[4, 9], ["None"], "function", ["None"], ["def", "voc_classes", "(", ")", ":", "\n", "    ", "return", "[", "\n", "'aeroplane'", ",", "'bicycle'", ",", "'bird'", ",", "'boat'", ",", "'bottle'", ",", "'bus'", ",", "'car'", ",", "'cat'", ",", "\n", "'chair'", ",", "'cow'", ",", "'diningtable'", ",", "'dog'", ",", "'horse'", ",", "'motorbike'", ",", "'person'", ",", "\n", "'pottedplant'", ",", "'sheep'", ",", "'sofa'", ",", "'train'", ",", "'tvmonitor'", "\n", "]", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.class_names.imagenet_det_classes": [[12, 50], ["None"], "function", ["None"], ["", "def", "imagenet_det_classes", "(", ")", ":", "\n", "    ", "return", "[", "\n", "'accordion'", ",", "'airplane'", ",", "'ant'", ",", "'antelope'", ",", "'apple'", ",", "'armadillo'", ",", "\n", "'artichoke'", ",", "'axe'", ",", "'baby_bed'", ",", "'backpack'", ",", "'bagel'", ",", "'balance_beam'", ",", "\n", "'banana'", ",", "'band_aid'", ",", "'banjo'", ",", "'baseball'", ",", "'basketball'", ",", "'bathing_cap'", ",", "\n", "'beaker'", ",", "'bear'", ",", "'bee'", ",", "'bell_pepper'", ",", "'bench'", ",", "'bicycle'", ",", "'binder'", ",", "\n", "'bird'", ",", "'bookshelf'", ",", "'bow_tie'", ",", "'bow'", ",", "'bowl'", ",", "'brassiere'", ",", "'burrito'", ",", "\n", "'bus'", ",", "'butterfly'", ",", "'camel'", ",", "'can_opener'", ",", "'car'", ",", "'cart'", ",", "'cattle'", ",", "\n", "'cello'", ",", "'centipede'", ",", "'chain_saw'", ",", "'chair'", ",", "'chime'", ",", "'cocktail_shaker'", ",", "\n", "'coffee_maker'", ",", "'computer_keyboard'", ",", "'computer_mouse'", ",", "'corkscrew'", ",", "\n", "'cream'", ",", "'croquet_ball'", ",", "'crutch'", ",", "'cucumber'", ",", "'cup_or_mug'", ",", "'diaper'", ",", "\n", "'digital_clock'", ",", "'dishwasher'", ",", "'dog'", ",", "'domestic_cat'", ",", "'dragonfly'", ",", "\n", "'drum'", ",", "'dumbbell'", ",", "'electric_fan'", ",", "'elephant'", ",", "'face_powder'", ",", "'fig'", ",", "\n", "'filing_cabinet'", ",", "'flower_pot'", ",", "'flute'", ",", "'fox'", ",", "'french_horn'", ",", "'frog'", ",", "\n", "'frying_pan'", ",", "'giant_panda'", ",", "'goldfish'", ",", "'golf_ball'", ",", "'golfcart'", ",", "\n", "'guacamole'", ",", "'guitar'", ",", "'hair_dryer'", ",", "'hair_spray'", ",", "'hamburger'", ",", "\n", "'hammer'", ",", "'hamster'", ",", "'harmonica'", ",", "'harp'", ",", "'hat_with_a_wide_brim'", ",", "\n", "'head_cabbage'", ",", "'helmet'", ",", "'hippopotamus'", ",", "'horizontal_bar'", ",", "'horse'", ",", "\n", "'hotdog'", ",", "'iPod'", ",", "'isopod'", ",", "'jellyfish'", ",", "'koala_bear'", ",", "'ladle'", ",", "\n", "'ladybug'", ",", "'lamp'", ",", "'laptop'", ",", "'lemon'", ",", "'lion'", ",", "'lipstick'", ",", "'lizard'", ",", "\n", "'lobster'", ",", "'maillot'", ",", "'maraca'", ",", "'microphone'", ",", "'microwave'", ",", "'milk_can'", ",", "\n", "'miniskirt'", ",", "'monkey'", ",", "'motorcycle'", ",", "'mushroom'", ",", "'nail'", ",", "'neck_brace'", ",", "\n", "'oboe'", ",", "'orange'", ",", "'otter'", ",", "'pencil_box'", ",", "'pencil_sharpener'", ",", "'perfume'", ",", "\n", "'person'", ",", "'piano'", ",", "'pineapple'", ",", "'ping-pong_ball'", ",", "'pitcher'", ",", "'pizza'", ",", "\n", "'plastic_bag'", ",", "'plate_rack'", ",", "'pomegranate'", ",", "'popsicle'", ",", "'porcupine'", ",", "\n", "'power_drill'", ",", "'pretzel'", ",", "'printer'", ",", "'puck'", ",", "'punching_bag'", ",", "'purse'", ",", "\n", "'rabbit'", ",", "'racket'", ",", "'ray'", ",", "'red_panda'", ",", "'refrigerator'", ",", "\n", "'remote_control'", ",", "'rubber_eraser'", ",", "'rugby_ball'", ",", "'ruler'", ",", "\n", "'salt_or_pepper_shaker'", ",", "'saxophone'", ",", "'scorpion'", ",", "'screwdriver'", ",", "\n", "'seal'", ",", "'sheep'", ",", "'ski'", ",", "'skunk'", ",", "'snail'", ",", "'snake'", ",", "'snowmobile'", ",", "\n", "'snowplow'", ",", "'soap_dispenser'", ",", "'soccer_ball'", ",", "'sofa'", ",", "'spatula'", ",", "\n", "'squirrel'", ",", "'starfish'", ",", "'stethoscope'", ",", "'stove'", ",", "'strainer'", ",", "\n", "'strawberry'", ",", "'stretcher'", ",", "'sunglasses'", ",", "'swimming_trunks'", ",", "'swine'", ",", "\n", "'syringe'", ",", "'table'", ",", "'tape_player'", ",", "'tennis_ball'", ",", "'tick'", ",", "'tie'", ",", "\n", "'tiger'", ",", "'toaster'", ",", "'traffic_light'", ",", "'train'", ",", "'trombone'", ",", "'trumpet'", ",", "\n", "'turtle'", ",", "'tv_or_monitor'", ",", "'unicycle'", ",", "'vacuum'", ",", "'violin'", ",", "\n", "'volleyball'", ",", "'waffle_iron'", ",", "'washer'", ",", "'water_bottle'", ",", "'watercraft'", ",", "\n", "'whale'", ",", "'wine_bottle'", ",", "'zebra'", "\n", "]", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.class_names.imagenet_vid_classes": [[53, 60], ["None"], "function", ["None"], ["", "def", "imagenet_vid_classes", "(", ")", ":", "\n", "    ", "return", "[", "\n", "'airplane'", ",", "'antelope'", ",", "'bear'", ",", "'bicycle'", ",", "'bird'", ",", "'bus'", ",", "'car'", ",", "\n", "'cattle'", ",", "'dog'", ",", "'domestic_cat'", ",", "'elephant'", ",", "'fox'", ",", "'giant_panda'", ",", "\n", "'hamster'", ",", "'horse'", ",", "'lion'", ",", "'lizard'", ",", "'monkey'", ",", "'motorcycle'", ",", "'rabbit'", ",", "\n", "'red_panda'", ",", "'sheep'", ",", "'snake'", ",", "'squirrel'", ",", "'tiger'", ",", "'train'", ",", "'turtle'", ",", "\n", "'watercraft'", ",", "'whale'", ",", "'zebra'", "\n", "]", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.class_names.coco_classes": [[79, 82], ["None"], "function", ["None"], ["", "def", "coco_classes", "(", ")", ":", "\n", "    ", "return", "[", "\n", "'person'", "\n", "]", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.class_names.get_classes": [[93, 109], ["dataset_aliases.items", "mmcv.is_str", "TypeError", "eval", "print", "ValueError", "type"], "function", ["None"], ["def", "get_classes", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Get class names of a dataset.\"\"\"", "\n", "alias2name", "=", "{", "}", "\n", "for", "name", ",", "aliases", "in", "dataset_aliases", ".", "items", "(", ")", ":", "\n", "        ", "for", "alias", "in", "aliases", ":", "\n", "            ", "alias2name", "[", "alias", "]", "=", "name", "\n", "\n", "", "", "if", "mmcv", ".", "is_str", "(", "dataset", ")", ":", "\n", "        ", "if", "dataset", "in", "alias2name", ":", "\n", "            ", "labels", "=", "eval", "(", "alias2name", "[", "dataset", "]", "+", "'_classes()'", ")", "\n", "", "else", ":", "\n", "            ", "print", "(", "\"dataset:           %s\"", "%", "dataset", ")", "\n", "raise", "ValueError", "(", "'Unrecognized dataset: {}'", ".", "format", "(", "dataset", ")", ")", "\n", "", "", "else", ":", "\n", "        ", "raise", "TypeError", "(", "'dataset must a str, but got {}'", ".", "format", "(", "type", "(", "dataset", ")", ")", ")", "\n", "", "return", "labels", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.eval_hooks.DistEvalHook.__init__": [[20, 31], ["isinstance", "isinstance", "mmcv.runner.obj_from_dict", "TypeError", "type"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "dataset", ",", "interval", "=", "1", ")", ":", "\n", "        ", "if", "isinstance", "(", "dataset", ",", "Dataset", ")", ":", "\n", "            ", "self", ".", "dataset", "=", "dataset", "\n", "", "elif", "isinstance", "(", "dataset", ",", "dict", ")", ":", "\n", "            ", "self", ".", "dataset", "=", "obj_from_dict", "(", "dataset", ",", "datasets", ",", "\n", "{", "'test_mode'", ":", "True", "}", ")", "\n", "", "else", ":", "\n", "            ", "raise", "TypeError", "(", "\n", "'dataset must be a Dataset object or a dict, not {}'", ".", "format", "(", "\n", "type", "(", "dataset", ")", ")", ")", "\n", "", "self", ".", "interval", "=", "interval", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.eval_hooks.DistEvalHook.after_train_epoch": [[32, 72], ["runner.model.eval", "range", "torch.barrier", "torch.barrier", "eval_hooks.DistEvalHook.every_n_epochs", "mmcv.ProgressBar", "len", "print", "torch.barrier", "torch.barrier", "range", "eval_hooks.DistEvalHook.evaluate", "os.join", "os.join", "mmcv.dump", "torch.barrier", "torch.barrier", "range", "len", "mmcv.parallel.scatter", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "runner.model", "range", "os.join", "os.join", "mmcv.load", "range", "os.remove", "os.remove", "os.remove", "os.remove", "len", "mmcv.parallel.collate", "mmcv.ProgressBar.update", "len", "torch.cuda.current_device", "torch.cuda.current_device", "torch.cuda.current_device", "torch.cuda.current_device"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.eval_hooks.CocoDistEvalmAPHook.evaluate"], ["", "def", "after_train_epoch", "(", "self", ",", "runner", ")", ":", "\n", "        ", "if", "not", "self", ".", "every_n_epochs", "(", "runner", ",", "self", ".", "interval", ")", ":", "\n", "            ", "return", "\n", "", "runner", ".", "model", ".", "eval", "(", ")", "\n", "results", "=", "[", "None", "for", "_", "in", "range", "(", "len", "(", "self", ".", "dataset", ")", ")", "]", "\n", "if", "runner", ".", "rank", "==", "0", ":", "\n", "            ", "prog_bar", "=", "mmcv", ".", "ProgressBar", "(", "len", "(", "self", ".", "dataset", ")", ")", "\n", "", "for", "idx", "in", "range", "(", "runner", ".", "rank", ",", "len", "(", "self", ".", "dataset", ")", ",", "runner", ".", "world_size", ")", ":", "\n", "            ", "data", "=", "self", ".", "dataset", "[", "idx", "]", "\n", "data_gpu", "=", "scatter", "(", "\n", "collate", "(", "[", "data", "]", ",", "samples_per_gpu", "=", "1", ")", ",", "\n", "[", "torch", ".", "cuda", ".", "current_device", "(", ")", "]", ")", "[", "0", "]", "\n", "\n", "# compute output", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "                ", "result", "=", "runner", ".", "model", "(", "\n", "return_loss", "=", "False", ",", "rescale", "=", "True", ",", "**", "data_gpu", ")", "\n", "", "results", "[", "idx", "]", "=", "result", "\n", "\n", "batch_size", "=", "runner", ".", "world_size", "\n", "if", "runner", ".", "rank", "==", "0", ":", "\n", "                ", "for", "_", "in", "range", "(", "batch_size", ")", ":", "\n", "                    ", "prog_bar", ".", "update", "(", ")", "\n", "\n", "", "", "", "if", "runner", ".", "rank", "==", "0", ":", "\n", "            ", "print", "(", "'\\n'", ")", "\n", "dist", ".", "barrier", "(", ")", "\n", "for", "i", "in", "range", "(", "1", ",", "runner", ".", "world_size", ")", ":", "\n", "                ", "tmp_file", "=", "osp", ".", "join", "(", "runner", ".", "work_dir", ",", "'temp_{}.pkl'", ".", "format", "(", "i", ")", ")", "\n", "tmp_results", "=", "mmcv", ".", "load", "(", "tmp_file", ")", "\n", "for", "idx", "in", "range", "(", "i", ",", "len", "(", "results", ")", ",", "runner", ".", "world_size", ")", ":", "\n", "                    ", "results", "[", "idx", "]", "=", "tmp_results", "[", "idx", "]", "\n", "", "os", ".", "remove", "(", "tmp_file", ")", "\n", "", "self", ".", "evaluate", "(", "runner", ",", "results", ")", "\n", "", "else", ":", "\n", "            ", "tmp_file", "=", "osp", ".", "join", "(", "runner", ".", "work_dir", ",", "\n", "'temp_{}.pkl'", ".", "format", "(", "runner", ".", "rank", ")", ")", "\n", "mmcv", ".", "dump", "(", "results", ",", "tmp_file", ")", "\n", "dist", ".", "barrier", "(", ")", "\n", "", "dist", ".", "barrier", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.eval_hooks.DistEvalHook.evaluate": [[73, 75], ["None"], "methods", ["None"], ["", "def", "evaluate", "(", "self", ")", ":", "\n", "        ", "raise", "NotImplementedError", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.eval_hooks.DistEvalmAPHook.evaluate": [[79, 114], ["range", "mean_ap.eval_map", "len", "eval_hooks.DistEvalmAPHook.dataset.get_ann_info", "gt_bboxes.append", "gt_labels.append", "hasattr", "numpy.concatenate", "gt_ignore.append", "numpy.vstack", "numpy.concatenate", "numpy.zeros", "numpy.ones"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.mean_ap.eval_map", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.augmentation_dataset.AugmentationDataset.get_ann_info"], ["    ", "def", "evaluate", "(", "self", ",", "runner", ",", "results", ")", ":", "\n", "        ", "gt_bboxes", "=", "[", "]", "\n", "gt_labels", "=", "[", "]", "\n", "gt_ignore", "=", "[", "]", "if", "self", ".", "dataset", ".", "with_crowd", "else", "None", "\n", "for", "i", "in", "range", "(", "len", "(", "self", ".", "dataset", ")", ")", ":", "\n", "            ", "ann", "=", "self", ".", "dataset", ".", "get_ann_info", "(", "i", ")", "\n", "bboxes", "=", "ann", "[", "'bboxes'", "]", "\n", "labels", "=", "ann", "[", "'labels'", "]", "\n", "if", "gt_ignore", "is", "not", "None", ":", "\n", "                ", "ignore", "=", "np", ".", "concatenate", "(", "[", "\n", "np", ".", "zeros", "(", "bboxes", ".", "shape", "[", "0", "]", ",", "dtype", "=", "np", ".", "bool", ")", ",", "\n", "np", ".", "ones", "(", "ann", "[", "'bboxes_ignore'", "]", ".", "shape", "[", "0", "]", ",", "dtype", "=", "np", ".", "bool", ")", "\n", "]", ")", "\n", "gt_ignore", ".", "append", "(", "ignore", ")", "\n", "bboxes", "=", "np", ".", "vstack", "(", "[", "bboxes", ",", "ann", "[", "'bboxes_ignore'", "]", "]", ")", "\n", "labels", "=", "np", ".", "concatenate", "(", "[", "labels", ",", "ann", "[", "'labels_ignore'", "]", "]", ")", "\n", "", "gt_bboxes", ".", "append", "(", "bboxes", ")", "\n", "gt_labels", ".", "append", "(", "labels", ")", "\n", "# If the dataset is VOC2007, then use 11 points mAP evaluation.", "\n", "", "if", "hasattr", "(", "self", ".", "dataset", ",", "'year'", ")", "and", "self", ".", "dataset", ".", "year", "==", "2007", ":", "\n", "            ", "ds_name", "=", "'voc07'", "\n", "", "else", ":", "\n", "            ", "ds_name", "=", "self", ".", "dataset", ".", "CLASSES", "\n", "# ds_name = list(self.dataset.CLASSES)", "\n", "", "mean_ap", ",", "eval_results", "=", "eval_map", "(", "\n", "results", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "gt_ignore", "=", "gt_ignore", ",", "\n", "scale_ranges", "=", "None", ",", "\n", "iou_thr", "=", "0.5", ",", "\n", "dataset", "=", "ds_name", ",", "\n", "print_summary", "=", "True", ")", "\n", "runner", ".", "log_buffer", ".", "output", "[", "'mAP'", "]", "=", "mean_ap", "\n", "runner", ".", "log_buffer", ".", "ready", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.eval_hooks.CocoDistEvalRecallHook.__init__": [[118, 125], ["numpy.arange", "eval_hooks.DistEvalHook.__init__", "numpy.array", "numpy.array"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "\n", "dataset", ",", "\n", "proposal_nums", "=", "(", "100", ",", "300", ",", "1000", ")", ",", "\n", "iou_thrs", "=", "np", ".", "arange", "(", "0.5", ",", "0.96", ",", "0.05", ")", ")", ":", "\n", "        ", "super", "(", "CocoDistEvalRecallHook", ",", "self", ")", ".", "__init__", "(", "dataset", ")", "\n", "self", ".", "proposal_nums", "=", "np", ".", "array", "(", "proposal_nums", ",", "dtype", "=", "np", ".", "int32", ")", "\n", "self", ".", "iou_thrs", "=", "np", ".", "array", "(", "iou_thrs", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.eval_hooks.CocoDistEvalRecallHook.evaluate": [[126, 134], ["coco_utils.fast_eval_recall", "enumerate"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.fast_eval_recall"], ["", "def", "evaluate", "(", "self", ",", "runner", ",", "results", ")", ":", "\n", "# the official coco evaluation is too slow, here we use our own", "\n", "# implementation instead, which may get slightly different results", "\n", "        ", "ar", "=", "fast_eval_recall", "(", "results", ",", "self", ".", "dataset", ".", "coco", ",", "self", ".", "proposal_nums", ",", "\n", "self", ".", "iou_thrs", ")", "\n", "for", "i", ",", "num", "in", "enumerate", "(", "self", ".", "proposal_nums", ")", ":", "\n", "            ", "runner", ".", "log_buffer", ".", "output", "[", "'AR@{}'", ".", "format", "(", "num", ")", "]", "=", "ar", "[", "i", "]", "\n", "", "runner", ".", "log_buffer", ".", "ready", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.eval_hooks.CocoDistEvalmAPHook.evaluate": [[138, 164], ["os.join", "os.join", "coco_utils.results2json", "cocoGt.loadRes", "cocoGt.getImgIds", "os.remove", "os.remove", "os.remove", "os.remove", "pycocotools.cocoeval.COCOeval", "pycocotools.cocoeval.COCOeval.evaluate", "pycocotools.cocoeval.COCOeval.accumulate", "pycocotools.cocoeval.COCOeval.summarize", "range", "len", "float"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.results2json", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.eval_hooks.CocoDistEvalmAPHook.evaluate"], ["    ", "def", "evaluate", "(", "self", ",", "runner", ",", "results", ")", ":", "\n", "        ", "tmp_file", "=", "osp", ".", "join", "(", "runner", ".", "work_dir", ",", "'temp_0.json'", ")", "\n", "results2json", "(", "self", ".", "dataset", ",", "results", ",", "tmp_file", ")", "\n", "\n", "res_types", "=", "[", "'bbox'", ",", "\n", "'segm'", "]", "if", "runner", ".", "model", ".", "module", ".", "with_mask", "else", "[", "'bbox'", "]", "\n", "cocoGt", "=", "self", ".", "dataset", ".", "coco", "\n", "cocoDt", "=", "cocoGt", ".", "loadRes", "(", "tmp_file", ")", "\n", "imgIds", "=", "cocoGt", ".", "getImgIds", "(", ")", "\n", "for", "res_type", "in", "res_types", ":", "\n", "            ", "iou_type", "=", "res_type", "\n", "cocoEval", "=", "COCOeval", "(", "cocoGt", ",", "cocoDt", ",", "iou_type", ")", "\n", "cocoEval", ".", "params", ".", "imgIds", "=", "imgIds", "\n", "cocoEval", ".", "evaluate", "(", ")", "\n", "cocoEval", ".", "accumulate", "(", ")", "\n", "cocoEval", ".", "summarize", "(", ")", "\n", "metrics", "=", "[", "'mAP'", ",", "'mAP_50'", ",", "'mAP_75'", ",", "'mAP_s'", ",", "'mAP_m'", ",", "'mAP_l'", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "metrics", ")", ")", ":", "\n", "                ", "key", "=", "'{}_{}'", ".", "format", "(", "res_type", ",", "metrics", "[", "i", "]", ")", "\n", "val", "=", "float", "(", "'{:.3f}'", ".", "format", "(", "cocoEval", ".", "stats", "[", "i", "]", ")", ")", "\n", "runner", ".", "log_buffer", ".", "output", "[", "key", "]", "=", "val", "\n", "", "runner", ".", "log_buffer", ".", "output", "[", "'{}_mAP_copypaste'", ".", "format", "(", "res_type", ")", "]", "=", "(", "\n", "'{ap[0]:.3f} {ap[1]:.3f} {ap[2]:.3f} {ap[3]:.3f} '", "\n", "'{ap[4]:.3f} {ap[5]:.3f}'", ")", ".", "format", "(", "ap", "=", "cocoEval", ".", "stats", "[", ":", "6", "]", ")", "\n", "", "runner", ".", "log_buffer", ".", "ready", "=", "True", "\n", "os", ".", "remove", "(", "tmp_file", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2delta": [[6, 42], ["proposals.float.float", "gt.float.float", "torch.log", "torch.log", "torch.stack", "deltas.sub_().div_.new_tensor().unsqueeze", "deltas.sub_().div_.new_tensor().unsqueeze", "deltas.sub_().div_.sub_().div_", "proposals.float.size", "gt.float.size", "deltas.sub_().div_.new_tensor", "deltas.sub_().div_.new_tensor", "deltas.sub_().div_.sub_"], "function", ["None"], ["'ImageTransform'", ",", "'BboxTransform'", ",", "'MaskTransform'", ",", "'SegMapTransform'", ",", "\n", "'Numpy2Tensor'", "\n", "]", "\n", "\n", "\n", "class", "ImageTransform", "(", "object", ")", ":", "\n", "    ", "\"\"\"Preprocess an image.\n\n    1. rescale the image to expected size\n    2. normalize the image\n    3. flip the image (if needed)\n    4. pad the image (if needed)\n    5. transpose to (c, h, w)\n    \"\"\"", "\n", "\n", "def", "__init__", "(", "self", ",", "\n", "mean", "=", "(", "0", ",", "0", ",", "0", ")", ",", "\n", "std", "=", "(", "1", ",", "1", ",", "1", ")", ",", "\n", "to_rgb", "=", "True", ",", "\n", "size_divisor", "=", "None", ")", ":", "\n", "        ", "self", ".", "mean", "=", "np", ".", "array", "(", "mean", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "self", ".", "std", "=", "np", ".", "array", "(", "std", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "self", ".", "to_rgb", "=", "to_rgb", "\n", "self", ".", "size_divisor", "=", "size_divisor", "\n", "\n", "", "def", "__call__", "(", "self", ",", "img", ",", "scale", ",", "flip", "=", "False", ",", "keep_ratio", "=", "True", ")", ":", "\n", "        ", "if", "keep_ratio", ":", "\n", "            ", "img", ",", "scale_factor", "=", "mmcv", ".", "imrescale", "(", "img", ",", "scale", ",", "return_scale", "=", "True", ")", "\n", "", "else", ":", "\n", "            ", "img", ",", "w_scale", ",", "h_scale", "=", "mmcv", ".", "imresize", "(", "\n", "img", ",", "scale", ",", "return_scale", "=", "True", ")", "\n", "scale_factor", "=", "np", ".", "array", "(", "\n", "[", "w_scale", ",", "h_scale", ",", "w_scale", ",", "h_scale", "]", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "", "img_shape", "=", "img", ".", "shape", "\n", "img", "=", "mmcv", ".", "imnormalize", "(", "img", ",", "self", ".", "mean", ",", "self", ".", "std", ",", "self", ".", "to_rgb", ")", "\n", "if", "flip", ":", "\n", "            ", "img", "=", "mmcv", ".", "imflip", "(", "img", ")", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.delta2bbox": [[44, 79], ["deltas.new_tensor().repeat", "deltas.new_tensor().repeat", "numpy.abs", "dw.clamp.clamp", "dh.clamp.clamp", "torch.addcmul", "torch.addcmul", "torch.stack().view_as", "numpy.log", "dw.clamp.exp", "dh.clamp.exp", "x1.clamp.clamp", "y1.clamp.clamp", "x2.clamp.clamp", "y2.clamp.clamp", "deltas.new_tensor", "deltas.size", "deltas.new_tensor", "deltas.size", "torch.stack"], "function", ["None"], ["# Pad an image to ensure each edge to be multiple to size_divisor", "\n", "            ", "img", "=", "mmcv", ".", "impad_to_multiple", "(", "img", ",", "self", ".", "size_divisor", ")", "\n", "pad_shape", "=", "img", ".", "shape", "\n", "", "else", ":", "\n", "            ", "pad_shape", "=", "img_shape", "\n", "", "img", "=", "img", ".", "transpose", "(", "2", ",", "0", ",", "1", ")", "\n", "return", "img", ",", "img_shape", ",", "pad_shape", ",", "scale_factor", "\n", "\n", "\n", "", "", "def", "bbox_flip", "(", "bboxes", ",", "img_shape", ")", ":", "\n", "    ", "\"\"\"Flip bboxes horizontally.\n\n    Args:\n        bboxes(ndarray): shape (..., 4*k)\n        img_shape(tuple): (height, width)\n    \"\"\"", "\n", "assert", "bboxes", ".", "shape", "[", "-", "1", "]", "%", "4", "==", "0", "\n", "w", "=", "img_shape", "[", "1", "]", "\n", "flipped", "=", "bboxes", ".", "copy", "(", ")", "\n", "flipped", "[", "...", ",", "0", ":", ":", "4", "]", "=", "w", "-", "bboxes", "[", "...", ",", "2", ":", ":", "4", "]", "-", "1", "\n", "flipped", "[", "...", ",", "2", ":", ":", "4", "]", "=", "w", "-", "bboxes", "[", "...", ",", "0", ":", ":", "4", "]", "-", "1", "\n", "return", "flipped", "\n", "\n", "\n", "", "class", "BboxTransform", "(", "object", ")", ":", "\n", "    ", "\"\"\"Preprocess gt bboxes.\n\n    1. rescale bboxes according to image size\n    2. flip bboxes (if needed)\n    3. pad the first dimension to `max_num_gts`\n    \"\"\"", "\n", "\n", "def", "__init__", "(", "self", ",", "max_num_gts", "=", "None", ")", ":", "\n", "        ", "self", ".", "max_num_gts", "=", "max_num_gts", "\n", "\n", "", "def", "__call__", "(", "self", ",", "bboxes", ",", "img_shape", ",", "scale_factor", ",", "flip", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox_flip": [[81, 99], ["isinstance", "bboxes.clone", "isinstance", "mmcv.bbox_flip"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox_flip"], ["\n", "gt_bboxes", "=", "bboxes", "*", "scale_factor", "\n", "if", "flip", ":", "\n", "            ", "gt_bboxes", "=", "bbox_flip", "(", "gt_bboxes", ",", "img_shape", ")", "\n", "", "gt_bboxes", "[", ":", ",", "0", ":", ":", "2", "]", "=", "np", ".", "clip", "(", "gt_bboxes", "[", ":", ",", "0", ":", ":", "2", "]", ",", "0", ",", "img_shape", "[", "1", "]", "-", "1", ")", "\n", "gt_bboxes", "[", ":", ",", "1", ":", ":", "2", "]", "=", "np", ".", "clip", "(", "gt_bboxes", "[", ":", ",", "1", ":", ":", "2", "]", ",", "0", ",", "img_shape", "[", "0", "]", "-", "1", ")", "\n", "if", "self", ".", "max_num_gts", "is", "None", ":", "\n", "            ", "return", "gt_bboxes", "\n", "", "else", ":", "\n", "            ", "num_gts", "=", "gt_bboxes", ".", "shape", "[", "0", "]", "\n", "padded_bboxes", "=", "np", ".", "zeros", "(", "(", "self", ".", "max_num_gts", ",", "4", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "padded_bboxes", "[", ":", "num_gts", ",", ":", "]", "=", "gt_bboxes", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox_mapping": [[101, 107], ["transforms.bbox_flip"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox_flip"], ["\n", "\n", "", "", "", "class", "MaskTransform", "(", "object", ")", ":", "\n", "    "]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox_mapping_back": [[109, 114], ["transforms.bbox_flip"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox_flip"], ["\n", "\n", "def", "__call__", "(", "self", ",", "masks", ",", "pad_shape", ",", "scale_factor", ",", "flip", "=", "False", ")", ":", "\n", "        ", "masks", "=", "[", "\n", "mmcv", ".", "imrescale", "(", "mask", ",", "scale_factor", ",", "interpolation", "=", "'nearest'", ")", "\n", "for", "mask", "in", "masks", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2roi": [[116, 136], ["enumerate", "torch.cat", "rois_list.append", "bboxes.size", "bboxes.new_full", "torch.cat", "bboxes.new_zeros", "bboxes.size"], "function", ["None"], ["if", "flip", ":", "\n", "            ", "masks", "=", "[", "mask", "[", ":", ",", ":", ":", "-", "1", "]", "for", "mask", "in", "masks", "]", "\n", "", "padded_masks", "=", "[", "\n", "mmcv", ".", "impad", "(", "mask", ",", "pad_shape", "[", ":", "2", "]", ",", "pad_val", "=", "0", ")", "for", "mask", "in", "masks", "\n", "]", "\n", "padded_masks", "=", "np", ".", "stack", "(", "padded_masks", ",", "axis", "=", "0", ")", "\n", "return", "padded_masks", "\n", "\n", "\n", "", "", "class", "SegMapTransform", "(", "object", ")", ":", "\n", "    ", "\"\"\"Preprocess semantic segmentation maps.\n\n    1. rescale the segmentation map to expected size\n    3. flip the image (if needed)\n    4. pad the image (if needed)\n    \"\"\"", "\n", "\n", "def", "__init__", "(", "self", ",", "size_divisor", "=", "None", ")", ":", "\n", "        ", "self", ".", "size_divisor", "=", "size_divisor", "\n", "\n", "", "def", "__call__", "(", "self", ",", "img", ",", "scale", ",", "flip", "=", "False", ",", "keep_ratio", "=", "True", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.roi2bbox": [[138, 146], ["torch.unique", "rois[].cpu", "bbox_list.append", "img_id.item"], "function", ["None"], ["            ", "img", "=", "mmcv", ".", "imrescale", "(", "img", ",", "scale", ",", "interpolation", "=", "'nearest'", ")", "\n", "", "else", ":", "\n", "            ", "img", "=", "mmcv", ".", "imresize", "(", "img", ",", "scale", ",", "interpolation", "=", "'nearest'", ")", "\n", "", "if", "flip", ":", "\n", "            ", "img", "=", "mmcv", ".", "imflip", "(", "img", ")", "\n", "", "if", "self", ".", "size_divisor", "is", "not", "None", ":", "\n", "            ", "img", "=", "mmcv", ".", "impad_to_multiple", "(", "img", ",", "self", ".", "size_divisor", ")", "\n", "", "return", "img", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2result": [[148, 167], ["bboxes.cpu().numpy.cpu().numpy", "labels.cpu().numpy.cpu().numpy", "numpy.zeros", "range", "bboxes.cpu().numpy.cpu", "labels.cpu().numpy.cpu", "range"], "function", ["None"], ["", "", "class", "Numpy2Tensor", "(", "object", ")", ":", "\n", "\n", "    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "pass", "\n", "\n", "", "def", "__call__", "(", "self", ",", "*", "args", ")", ":", "\n", "        ", "if", "len", "(", "args", ")", "==", "1", ":", "\n", "            ", "return", "torch", ".", "from_numpy", "(", "args", "[", "0", "]", ")", "\n", "", "else", ":", "\n", "            ", "return", "tuple", "(", "[", "torch", ".", "from_numpy", "(", "np", ".", "array", "(", "array", ")", ")", "for", "array", "in", "args", "]", ")", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.distance2bbox": [[169, 191], ["torch.stack", "x1.clamp.clamp", "y1.clamp.clamp", "x2.clamp.clamp", "y2.clamp.clamp"], "function", ["None"], []], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.assign_sampling.build_assigner": [[6, 14], ["isinstance", "isinstance", "mmcv.runner.obj_from_dict", "TypeError", "type"], "function", ["None"], ["def", "build_assigner", "(", "cfg", ",", "**", "kwargs", ")", ":", "\n", "    ", "if", "isinstance", "(", "cfg", ",", "assigners", ".", "BaseAssigner", ")", ":", "\n", "        ", "return", "cfg", "\n", "", "elif", "isinstance", "(", "cfg", ",", "dict", ")", ":", "\n", "        ", "return", "mmcv", ".", "runner", ".", "obj_from_dict", "(", "cfg", ",", "assigners", ",", "default_args", "=", "kwargs", ")", "\n", "", "else", ":", "\n", "        ", "raise", "TypeError", "(", "'Invalid type {} for building a sampler'", ".", "format", "(", "\n", "type", "(", "cfg", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.assign_sampling.build_sampler": [[16, 24], ["isinstance", "isinstance", "mmcv.runner.obj_from_dict", "TypeError", "type"], "function", ["None"], ["", "", "def", "build_sampler", "(", "cfg", ",", "**", "kwargs", ")", ":", "\n", "    ", "if", "isinstance", "(", "cfg", ",", "samplers", ".", "BaseSampler", ")", ":", "\n", "        ", "return", "cfg", "\n", "", "elif", "isinstance", "(", "cfg", ",", "dict", ")", ":", "\n", "        ", "return", "mmcv", ".", "runner", ".", "obj_from_dict", "(", "cfg", ",", "samplers", ",", "default_args", "=", "kwargs", ")", "\n", "", "else", ":", "\n", "        ", "raise", "TypeError", "(", "'Invalid type {} for building a sampler'", ".", "format", "(", "\n", "type", "(", "cfg", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.assign_sampling.assign_and_sample": [[26, 34], ["assign_sampling.build_assigner", "assign_sampling.build_sampler", "build_assigner.assign", "build_sampler.sample"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.assign_sampling.build_assigner", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.assign_sampling.build_sampler", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.max_iou_assigner.MaxIoUAssigner.assign", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.pseudo_sampler.PseudoSampler.sample"], ["", "", "def", "assign_and_sample", "(", "bboxes", ",", "gt_bboxes", ",", "gt_bboxes_ignore", ",", "gt_labels", ",", "cfg", ")", ":", "\n", "    ", "bbox_assigner", "=", "build_assigner", "(", "cfg", ".", "assigner", ")", "\n", "bbox_sampler", "=", "build_sampler", "(", "cfg", ".", "sampler", ")", "\n", "assign_result", "=", "bbox_assigner", ".", "assign", "(", "bboxes", ",", "gt_bboxes", ",", "gt_bboxes_ignore", ",", "\n", "gt_labels", ")", "\n", "sampling_result", "=", "bbox_sampler", ".", "sample", "(", "assign_result", ",", "bboxes", ",", "gt_bboxes", ",", "\n", "gt_labels", ")", "\n", "return", "assign_result", ",", "sampling_result", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps": [[4, 67], ["bboxes1.size", "bboxes2.size", "torch.max", "torch.min", "torch.max", "torch.min", "bboxes1.new", "bboxes1.new"], "function", ["None"], ["def", "bbox_overlaps", "(", "bboxes1", ",", "bboxes2", ",", "mode", "=", "'iou'", ",", "is_aligned", "=", "False", ")", ":", "\n", "    ", "\"\"\"Calculate overlap between two set of bboxes.\n\n    If ``is_aligned`` is ``False``, then calculate the ious between each bbox\n    of bboxes1 and bboxes2, otherwise the ious between each aligned pair of\n    bboxes1 and bboxes2.\n\n    Args:\n        bboxes1 (Tensor): shape (m, 4). always set ground truth boxes to be bboxes1.\n              because area1 of bboxes1 needs represent the foreground area. store\n              the top-left and bottom-right corner (x1, y1, x2, y2)\n        bboxes2 (Tensor): shape (n, 4), if is_aligned is ``True``, then m and n\n            must be equal.\n        mode (str): \"iou\" (intersection over union) or iof (intersection over\n            foreground).\n\n    Returns:\n        ious(Tensor): shape (m, n) if is_aligned == False else shape (m, 1)\n    \"\"\"", "\n", "\n", "assert", "mode", "in", "[", "'iou'", ",", "'iof'", "]", "\n", "\n", "rows", "=", "bboxes1", ".", "size", "(", "0", ")", "\n", "cols", "=", "bboxes2", ".", "size", "(", "0", ")", "\n", "if", "is_aligned", ":", "\n", "        ", "assert", "rows", "==", "cols", "\n", "\n", "", "if", "rows", "*", "cols", "==", "0", ":", "\n", "        ", "return", "bboxes1", ".", "new", "(", "rows", ",", "1", ")", "if", "is_aligned", "else", "bboxes1", ".", "new", "(", "rows", ",", "cols", ")", "\n", "\n", "", "if", "is_aligned", ":", "\n", "        ", "lt", "=", "torch", ".", "max", "(", "bboxes1", "[", ":", ",", ":", "2", "]", ",", "bboxes2", "[", ":", ",", ":", "2", "]", ")", "# [rows, 2]", "\n", "rb", "=", "torch", ".", "min", "(", "bboxes1", "[", ":", ",", "2", ":", "]", ",", "bboxes2", "[", ":", ",", "2", ":", "]", ")", "# [rows, 2]", "\n", "\n", "wh", "=", "(", "rb", "-", "lt", "+", "1", ")", ".", "clamp", "(", "min", "=", "0", ")", "# [rows, 2]", "\n", "overlap", "=", "wh", "[", ":", ",", "0", "]", "*", "wh", "[", ":", ",", "1", "]", "\n", "area1", "=", "(", "bboxes1", "[", ":", ",", "2", "]", "-", "bboxes1", "[", ":", ",", "0", "]", "+", "1", ")", "*", "(", "\n", "bboxes1", "[", ":", ",", "3", "]", "-", "bboxes1", "[", ":", ",", "1", "]", "+", "1", ")", "\n", "\n", "if", "mode", "==", "'iou'", ":", "\n", "            ", "area2", "=", "(", "bboxes2", "[", ":", ",", "2", "]", "-", "bboxes2", "[", ":", ",", "0", "]", "+", "1", ")", "*", "(", "\n", "bboxes2", "[", ":", ",", "3", "]", "-", "bboxes2", "[", ":", ",", "1", "]", "+", "1", ")", "\n", "ious", "=", "overlap", "/", "(", "area1", "+", "area2", "-", "overlap", ")", "\n", "", "else", ":", "\n", "            ", "ious", "=", "overlap", "/", "area1", "\n", "", "", "else", ":", "\n", "# compute the top-left corner and the bottom-right corner for the overlap regions.", "\n", "        ", "lt", "=", "torch", ".", "max", "(", "bboxes1", "[", ":", ",", "None", ",", ":", "2", "]", ",", "bboxes2", "[", ":", ",", ":", "2", "]", ")", "# [rows, cols, 2]", "\n", "rb", "=", "torch", ".", "min", "(", "bboxes1", "[", ":", ",", "None", ",", "2", ":", "]", ",", "bboxes2", "[", ":", ",", "2", ":", "]", ")", "# [rows, cols, 2]", "\n", "\n", "wh", "=", "(", "rb", "-", "lt", "+", "1", ")", ".", "clamp", "(", "min", "=", "0", ")", "# [rows, cols, 2]", "\n", "overlap", "=", "wh", "[", ":", ",", ":", ",", "0", "]", "*", "wh", "[", ":", ",", ":", ",", "1", "]", "# [rows, cols]", "\n", "area1", "=", "(", "bboxes1", "[", ":", ",", "2", "]", "-", "bboxes1", "[", ":", ",", "0", "]", "+", "1", ")", "*", "(", "\n", "bboxes1", "[", ":", ",", "3", "]", "-", "bboxes1", "[", ":", ",", "1", "]", "+", "1", ")", "# [rows]", "\n", "\n", "if", "mode", "==", "'iou'", ":", "\n", "            ", "area2", "=", "(", "bboxes2", "[", ":", ",", "2", "]", "-", "bboxes2", "[", ":", ",", "0", "]", "+", "1", ")", "*", "(", "\n", "bboxes2", "[", ":", ",", "3", "]", "-", "bboxes2", "[", ":", ",", "1", "]", "+", "1", ")", "# [cols]", "\n", "ious", "=", "overlap", "/", "(", "area1", "[", ":", ",", "None", "]", "+", "area2", "-", "overlap", ")", "\n", "", "else", ":", "\n", "            ", "ious", "=", "overlap", "/", "(", "area1", "[", ":", ",", "None", "]", ")", "\n", "\n", "", "", "return", "ious", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.bbox_target.bbox_target": [[7, 57], ["utils.multi_apply", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.utils.misc.multi_apply"], ["def", "bbox_target", "(", "pos_bboxes_list", ",", "\n", "neg_bboxes_list", ",", "\n", "pos_gt_bboxes_list", ",", "\n", "pos_gt_labels_list", ",", "\n", "cfg", ",", "\n", "reg_classes", "=", "1", ",", "\n", "target_means", "=", "[", ".0", ",", ".0", ",", ".0", ",", ".0", "]", ",", "\n", "target_stds", "=", "[", "1.0", ",", "1.0", ",", "1.0", ",", "1.0", "]", ",", "\n", "concat", "=", "True", ")", ":", "\n", "    ", "\"\"\"\n\n    :param pos_bboxes_list:\n    :param neg_bboxes_list:\n    :param pos_gt_bboxes_list:\n    :param pos_gt_labels_list:\n    :param cfg:\n    :param reg_classes:\n    :param target_means:\n    :param target_stds:\n    :param concat:\n    :return:\n    labels: tensor of shape (batch*num_samples), labels for positives; others are set to be 0;\n    label_weights: tensor of shape (batch*num_samples), all the elements are set to be 1;\n    bbox_targets: tensor of shape (batch*num_samples, 4), the parameterized coordinates of the\n        corresponding ground truth boxes for positives; negatives are set to be 0;\n    bbox_weights: tensor of shape (batch*num_samples, 4), the positives are set to be 1; others are 0;\n    proposal_bboxes:tensor of shape (batch*num_samples, 4), positive proposals for positives and others\n    are 0.\n    \"\"\"", "\n", "labels", ",", "label_weights", ",", "bbox_targets", ",", "bbox_weights", ",", "proposal_bboxes", "=", "multi_apply", "(", "\n", "bbox_target_single", ",", "\n", "pos_bboxes_list", ",", "\n", "neg_bboxes_list", ",", "\n", "pos_gt_bboxes_list", ",", "\n", "pos_gt_labels_list", ",", "\n", "cfg", "=", "cfg", ",", "\n", "reg_classes", "=", "reg_classes", ",", "\n", "target_means", "=", "target_means", ",", "\n", "target_stds", "=", "target_stds", ")", "\n", "\n", "if", "concat", ":", "\n", "        ", "labels", "=", "torch", ".", "cat", "(", "labels", ",", "0", ")", "\n", "label_weights", "=", "torch", ".", "cat", "(", "label_weights", ",", "0", ")", "\n", "bbox_targets", "=", "torch", ".", "cat", "(", "bbox_targets", ",", "0", ")", "\n", "bbox_weights", "=", "torch", ".", "cat", "(", "bbox_weights", ",", "0", ")", "\n", "\n", "# added by Shengkai Wu", "\n", "proposal_bboxes", "=", "torch", ".", "cat", "(", "proposal_bboxes", ",", "0", ")", "\n", "\n", "", "return", "labels", ",", "label_weights", ",", "bbox_targets", ",", "bbox_weights", ",", "proposal_bboxes", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.bbox_target.bbox_target_single": [[59, 103], ["pos_bboxes.size", "neg_bboxes.size", "pos_bboxes.new_zeros", "pos_bboxes.new_zeros", "pos_bboxes.new_zeros", "pos_bboxes.new_zeros", "pos_bboxes.new_zeros", "transforms.bbox2delta"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2delta"], ["", "def", "bbox_target_single", "(", "pos_bboxes", ",", "\n", "neg_bboxes", ",", "\n", "pos_gt_bboxes", ",", "\n", "pos_gt_labels", ",", "\n", "cfg", ",", "\n", "reg_classes", "=", "1", ",", "\n", "target_means", "=", "[", ".0", ",", ".0", ",", ".0", ",", ".0", "]", ",", "\n", "target_stds", "=", "[", "1.0", ",", "1.0", ",", "1.0", ",", "1.0", "]", ")", ":", "\n", "    ", "\"\"\"\n    process for each image in the batch\n    :param pos_bboxes: tensor of shape (num_pos, 4)\n    :param neg_bboxes: tensor of shape (num_neg, 4)\n    :param pos_gt_bboxes:\n    :param pos_gt_labels:\n    :param cfg:\n    :param reg_classes:\n    :param target_means:\n    :param target_stds:\n    :return:\n    \"\"\"", "\n", "num_pos", "=", "pos_bboxes", ".", "size", "(", "0", ")", "\n", "num_neg", "=", "neg_bboxes", ".", "size", "(", "0", ")", "\n", "num_samples", "=", "num_pos", "+", "num_neg", "\n", "labels", "=", "pos_bboxes", ".", "new_zeros", "(", "num_samples", ",", "dtype", "=", "torch", ".", "long", ")", "\n", "label_weights", "=", "pos_bboxes", ".", "new_zeros", "(", "num_samples", ")", "\n", "bbox_targets", "=", "pos_bboxes", ".", "new_zeros", "(", "num_samples", ",", "4", ")", "\n", "bbox_weights", "=", "pos_bboxes", ".", "new_zeros", "(", "num_samples", ",", "4", ")", "\n", "proposal_bboxes", "=", "pos_bboxes", ".", "new_zeros", "(", "num_samples", ",", "4", ")", "\n", "if", "num_pos", ">", "0", ":", "\n", "        ", "labels", "[", ":", "num_pos", "]", "=", "pos_gt_labels", "\n", "pos_weight", "=", "1.0", "if", "cfg", ".", "pos_weight", "<=", "0", "else", "cfg", ".", "pos_weight", "\n", "label_weights", "[", ":", "num_pos", "]", "=", "pos_weight", "\n", "pos_bbox_targets", "=", "bbox2delta", "(", "pos_bboxes", ",", "pos_gt_bboxes", ",", "target_means", ",", "\n", "target_stds", ")", "\n", "bbox_targets", "[", ":", "num_pos", ",", ":", "]", "=", "pos_bbox_targets", "\n", "bbox_weights", "[", ":", "num_pos", ",", ":", "]", "=", "1", "\n", "\n", "# added by Shengkai Wu", "\n", "proposal_bboxes", "[", ":", "num_pos", ",", ":", "]", "=", "pos_bboxes", "\n", "\n", "", "if", "num_neg", ">", "0", ":", "\n", "        ", "label_weights", "[", "-", "num_neg", ":", "]", "=", "1.0", "\n", "\n", "", "return", "labels", ",", "label_weights", ",", "bbox_targets", ",", "bbox_weights", ",", "proposal_bboxes", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.bbox_target.expand_target": [[105, 115], ["bbox_targets.new_zeros", "bbox_weights.new_zeros", "torch.nonzero().squeeze", "bbox_targets.size", "bbox_weights.size", "torch.nonzero"], "function", ["None"], ["", "def", "expand_target", "(", "bbox_targets", ",", "bbox_weights", ",", "labels", ",", "num_classes", ")", ":", "\n", "    ", "bbox_targets_expand", "=", "bbox_targets", ".", "new_zeros", "(", "(", "bbox_targets", ".", "size", "(", "0", ")", ",", "\n", "4", "*", "num_classes", ")", ")", "\n", "bbox_weights_expand", "=", "bbox_weights", ".", "new_zeros", "(", "(", "bbox_weights", ".", "size", "(", "0", ")", ",", "\n", "4", "*", "num_classes", ")", ")", "\n", "for", "i", "in", "torch", ".", "nonzero", "(", "labels", ">", "0", ")", ".", "squeeze", "(", "-", "1", ")", ":", "\n", "        ", "start", ",", "end", "=", "labels", "[", "i", "]", "*", "4", ",", "(", "labels", "[", "i", "]", "+", "1", ")", "*", "4", "\n", "bbox_targets_expand", "[", "i", ",", "start", ":", "end", "]", "=", "bbox_targets", "[", "i", ",", ":", "]", "\n", "bbox_weights_expand", "[", "i", ",", "start", ":", "end", "]", "=", "bbox_weights", "[", "i", ",", ":", "]", "\n", "", "return", "bbox_targets_expand", ",", "bbox_weights_expand", "\n", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.base_sampler.BaseSampler.__init__": [[10, 22], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "\n", "num", ",", "\n", "pos_fraction", ",", "\n", "neg_pos_ub", "=", "-", "1", ",", "\n", "add_gt_as_proposals", "=", "True", ",", "\n", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "num", "=", "num", "\n", "self", ".", "pos_fraction", "=", "pos_fraction", "\n", "self", ".", "neg_pos_ub", "=", "neg_pos_ub", "\n", "self", ".", "add_gt_as_proposals", "=", "add_gt_as_proposals", "\n", "self", ".", "pos_sampler", "=", "self", "\n", "self", ".", "neg_sampler", "=", "self", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.base_sampler.BaseSampler._sample_pos": [[23, 26], ["None"], "methods", ["None"], ["", "@", "abstractmethod", "\n", "def", "_sample_pos", "(", "self", ",", "assign_result", ",", "num_expected", ",", "**", "kwargs", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.base_sampler.BaseSampler._sample_neg": [[27, 30], ["None"], "methods", ["None"], ["", "@", "abstractmethod", "\n", "def", "_sample_neg", "(", "self", ",", "assign_result", ",", "num_expected", ",", "**", "kwargs", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.base_sampler.BaseSampler.sample": [[31, 79], ["torch.cat.new_zeros", "int", "base_sampler.BaseSampler.pos_sampler._sample_pos", "pos_inds.unique.unique.unique", "pos_inds.unique.unique.numel", "base_sampler.BaseSampler.neg_sampler._sample_neg", "neg_inds.unique.unique.unique", "sampling_result.SamplingResult", "torch.cat", "assign_result.add_gt_", "torch.cat.new_ones", "torch.cat", "max", "int"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.pseudo_sampler.PseudoSampler._sample_pos", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.pseudo_sampler.PseudoSampler._sample_neg", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.add_gt_"], ["", "def", "sample", "(", "self", ",", "\n", "assign_result", ",", "\n", "bboxes", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", "=", "None", ",", "\n", "**", "kwargs", ")", ":", "\n", "        ", "\"\"\"Sample positive and negative bboxes.\n\n        This is a simple implementation of bbox sampling given candidates,\n        assigning results and ground truth bboxes.\n\n        Args:\n            assign_result (:obj:`AssignResult`): Bbox assigning results.\n            bboxes (Tensor): Boxes to be sampled from.\n            gt_bboxes (Tensor): Ground truth bboxes.\n            gt_labels (Tensor, optional): Class labels of ground truth bboxes.\n\n        Returns:\n            :obj:`SamplingResult`: Sampling result.\n        \"\"\"", "\n", "bboxes", "=", "bboxes", "[", ":", ",", ":", "4", "]", "\n", "\n", "gt_flags", "=", "bboxes", ".", "new_zeros", "(", "(", "bboxes", ".", "shape", "[", "0", "]", ",", ")", ",", "dtype", "=", "torch", ".", "uint8", ")", "\n", "if", "self", ".", "add_gt_as_proposals", ":", "\n", "            ", "bboxes", "=", "torch", ".", "cat", "(", "[", "gt_bboxes", ",", "bboxes", "]", ",", "dim", "=", "0", ")", "\n", "assign_result", ".", "add_gt_", "(", "gt_labels", ")", "\n", "gt_ones", "=", "bboxes", ".", "new_ones", "(", "gt_bboxes", ".", "shape", "[", "0", "]", ",", "dtype", "=", "torch", ".", "uint8", ")", "\n", "gt_flags", "=", "torch", ".", "cat", "(", "[", "gt_ones", ",", "gt_flags", "]", ")", "\n", "\n", "", "num_expected_pos", "=", "int", "(", "self", ".", "num", "*", "self", ".", "pos_fraction", ")", "\n", "pos_inds", "=", "self", ".", "pos_sampler", ".", "_sample_pos", "(", "\n", "assign_result", ",", "num_expected_pos", ",", "bboxes", "=", "bboxes", ",", "**", "kwargs", ")", "\n", "# We found that sampled indices have duplicated items occasionally.", "\n", "# (may be a bug of PyTorch)", "\n", "pos_inds", "=", "pos_inds", ".", "unique", "(", ")", "\n", "num_sampled_pos", "=", "pos_inds", ".", "numel", "(", ")", "\n", "num_expected_neg", "=", "self", ".", "num", "-", "num_sampled_pos", "\n", "if", "self", ".", "neg_pos_ub", ">=", "0", ":", "\n", "            ", "_pos", "=", "max", "(", "1", ",", "num_sampled_pos", ")", "\n", "neg_upper_bound", "=", "int", "(", "self", ".", "neg_pos_ub", "*", "_pos", ")", "\n", "if", "num_expected_neg", ">", "neg_upper_bound", ":", "\n", "                ", "num_expected_neg", "=", "neg_upper_bound", "\n", "", "", "neg_inds", "=", "self", ".", "neg_sampler", ".", "_sample_neg", "(", "\n", "assign_result", ",", "num_expected_neg", ",", "bboxes", "=", "bboxes", ",", "**", "kwargs", ")", "\n", "neg_inds", "=", "neg_inds", ".", "unique", "(", ")", "\n", "\n", "return", "SamplingResult", "(", "pos_inds", ",", "neg_inds", ",", "bboxes", ",", "gt_bboxes", ",", "\n", "assign_result", ",", "gt_flags", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.random_sampler.RandomSampler.__init__": [[9, 17], ["base_sampler.BaseSampler.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "\n", "num", ",", "\n", "pos_fraction", ",", "\n", "neg_pos_ub", "=", "-", "1", ",", "\n", "add_gt_as_proposals", "=", "True", ",", "\n", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "RandomSampler", ",", "self", ")", ".", "__init__", "(", "num", ",", "pos_fraction", ",", "neg_pos_ub", ",", "\n", "add_gt_as_proposals", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.random_sampler.RandomSampler.random_choice": [[18, 34], ["isinstance", "numpy.arange", "numpy.random.shuffle", "len", "numpy.array", "len", "isinstance", "torch.from_numpy().long().to", "torch.from_numpy().long", "torch.from_numpy"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "random_choice", "(", "gallery", ",", "num", ")", ":", "\n", "        ", "\"\"\"Random select some elements from the gallery.\n\n        It seems that Pytorch's implementation is slower than numpy so we use\n        numpy to randperm the indices.\n        \"\"\"", "\n", "assert", "len", "(", "gallery", ")", ">=", "num", "\n", "if", "isinstance", "(", "gallery", ",", "list", ")", ":", "\n", "            ", "gallery", "=", "np", ".", "array", "(", "gallery", ")", "\n", "", "cands", "=", "np", ".", "arange", "(", "len", "(", "gallery", ")", ")", "\n", "np", ".", "random", ".", "shuffle", "(", "cands", ")", "\n", "rand_inds", "=", "cands", "[", ":", "num", "]", "\n", "if", "not", "isinstance", "(", "gallery", ",", "np", ".", "ndarray", ")", ":", "\n", "            ", "rand_inds", "=", "torch", ".", "from_numpy", "(", "rand_inds", ")", ".", "long", "(", ")", ".", "to", "(", "gallery", ".", "device", ")", "\n", "", "return", "gallery", "[", "rand_inds", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.random_sampler.RandomSampler._sample_pos": [[35, 44], ["torch.nonzero", "pos_inds.squeeze.squeeze.numel", "pos_inds.squeeze.squeeze.squeeze", "pos_inds.squeeze.squeeze.numel", "random_sampler.RandomSampler.random_choice"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.random_sampler.RandomSampler.random_choice"], ["", "def", "_sample_pos", "(", "self", ",", "assign_result", ",", "num_expected", ",", "**", "kwargs", ")", ":", "\n", "        ", "\"\"\"Randomly sample some positive samples.\"\"\"", "\n", "pos_inds", "=", "torch", ".", "nonzero", "(", "assign_result", ".", "gt_inds", ">", "0", ")", "\n", "if", "pos_inds", ".", "numel", "(", ")", "!=", "0", ":", "\n", "            ", "pos_inds", "=", "pos_inds", ".", "squeeze", "(", "1", ")", "\n", "", "if", "pos_inds", ".", "numel", "(", ")", "<=", "num_expected", ":", "\n", "            ", "return", "pos_inds", "\n", "", "else", ":", "\n", "            ", "return", "self", ".", "random_choice", "(", "pos_inds", ",", "num_expected", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.random_sampler.RandomSampler._sample_neg": [[45, 54], ["torch.nonzero", "neg_inds.squeeze.squeeze.numel", "neg_inds.squeeze.squeeze.squeeze", "len", "random_sampler.RandomSampler.random_choice"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.random_sampler.RandomSampler.random_choice"], ["", "", "def", "_sample_neg", "(", "self", ",", "assign_result", ",", "num_expected", ",", "**", "kwargs", ")", ":", "\n", "        ", "\"\"\"Randomly sample some negative samples.\"\"\"", "\n", "neg_inds", "=", "torch", ".", "nonzero", "(", "assign_result", ".", "gt_inds", "==", "0", ")", "\n", "if", "neg_inds", ".", "numel", "(", ")", "!=", "0", ":", "\n", "            ", "neg_inds", "=", "neg_inds", ".", "squeeze", "(", "1", ")", "\n", "", "if", "len", "(", "neg_inds", ")", "<=", "num_expected", ":", "\n", "            ", "return", "neg_inds", "\n", "", "else", ":", "\n", "            ", "return", "self", ".", "random_choice", "(", "neg_inds", ",", "num_expected", ")", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.ohem_sampler.OHEMSampler.__init__": [[9, 25], ["base_sampler.BaseSampler.__init__", "hasattr"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["    ", "def", "__init__", "(", "self", ",", "\n", "num", ",", "\n", "pos_fraction", ",", "\n", "context", ",", "\n", "neg_pos_ub", "=", "-", "1", ",", "\n", "add_gt_as_proposals", "=", "True", ",", "\n", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "OHEMSampler", ",", "self", ")", ".", "__init__", "(", "num", ",", "pos_fraction", ",", "neg_pos_ub", ",", "\n", "add_gt_as_proposals", ")", "\n", "if", "not", "hasattr", "(", "context", ",", "'num_stages'", ")", ":", "\n", "            ", "self", ".", "bbox_roi_extractor", "=", "context", ".", "bbox_roi_extractor", "\n", "self", ".", "bbox_head", "=", "context", ".", "bbox_head", "\n", "", "else", ":", "\n", "            ", "self", ".", "bbox_roi_extractor", "=", "context", ".", "bbox_roi_extractor", "[", "\n", "context", ".", "current_stage", "]", "\n", "self", ".", "bbox_head", "=", "context", ".", "bbox_head", "[", "context", ".", "current_stage", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.ohem_sampler.OHEMSampler.hard_mining": [[26, 42], ["torch.no_grad", "transforms.bbox2roi", "ohem_sampler.OHEMSampler.bbox_roi_extractor", "ohem_sampler.OHEMSampler.bbox_head", "loss.topk", "ohem_sampler.OHEMSampler.bbox_head.loss", "cls_score.new_ones", "cls_score.size"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.transforms.bbox2roi", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox_heads.bbox_head.BBoxHead.loss"], ["", "", "def", "hard_mining", "(", "self", ",", "inds", ",", "num_expected", ",", "bboxes", ",", "labels", ",", "feats", ")", ":", "\n", "        ", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "rois", "=", "bbox2roi", "(", "[", "bboxes", "]", ")", "\n", "bbox_feats", "=", "self", ".", "bbox_roi_extractor", "(", "\n", "feats", "[", ":", "self", ".", "bbox_roi_extractor", ".", "num_inputs", "]", ",", "rois", ")", "\n", "cls_score", ",", "_", "=", "self", ".", "bbox_head", "(", "bbox_feats", ")", "\n", "loss", "=", "self", ".", "bbox_head", ".", "loss", "(", "\n", "cls_score", "=", "cls_score", ",", "\n", "bbox_pred", "=", "None", ",", "\n", "labels", "=", "labels", ",", "\n", "label_weights", "=", "cls_score", ".", "new_ones", "(", "cls_score", ".", "size", "(", "0", ")", ")", ",", "\n", "bbox_targets", "=", "None", ",", "\n", "bbox_weights", "=", "None", ",", "\n", "reduce", "=", "False", ")", "[", "'loss_cls'", "]", "\n", "_", ",", "topk_loss_inds", "=", "loss", ".", "topk", "(", "num_expected", ")", "\n", "", "return", "inds", "[", "topk_loss_inds", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.ohem_sampler.OHEMSampler._sample_pos": [[43, 58], ["torch.nonzero", "pos_inds.squeeze.squeeze.numel", "pos_inds.squeeze.squeeze.squeeze", "pos_inds.squeeze.squeeze.numel", "ohem_sampler.OHEMSampler.hard_mining"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.ohem_sampler.OHEMSampler.hard_mining"], ["", "def", "_sample_pos", "(", "self", ",", "\n", "assign_result", ",", "\n", "num_expected", ",", "\n", "bboxes", "=", "None", ",", "\n", "feats", "=", "None", ",", "\n", "**", "kwargs", ")", ":", "\n", "# Sample some hard positive samples", "\n", "        ", "pos_inds", "=", "torch", ".", "nonzero", "(", "assign_result", ".", "gt_inds", ">", "0", ")", "\n", "if", "pos_inds", ".", "numel", "(", ")", "!=", "0", ":", "\n", "            ", "pos_inds", "=", "pos_inds", ".", "squeeze", "(", "1", ")", "\n", "", "if", "pos_inds", ".", "numel", "(", ")", "<=", "num_expected", ":", "\n", "            ", "return", "pos_inds", "\n", "", "else", ":", "\n", "            ", "return", "self", ".", "hard_mining", "(", "pos_inds", ",", "num_expected", ",", "bboxes", "[", "pos_inds", "]", ",", "\n", "assign_result", ".", "labels", "[", "pos_inds", "]", ",", "feats", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.ohem_sampler.OHEMSampler._sample_neg": [[59, 74], ["torch.nonzero", "neg_inds.squeeze.squeeze.numel", "neg_inds.squeeze.squeeze.squeeze", "len", "ohem_sampler.OHEMSampler.hard_mining"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.ohem_sampler.OHEMSampler.hard_mining"], ["", "", "def", "_sample_neg", "(", "self", ",", "\n", "assign_result", ",", "\n", "num_expected", ",", "\n", "bboxes", "=", "None", ",", "\n", "feats", "=", "None", ",", "\n", "**", "kwargs", ")", ":", "\n", "# Sample some hard negative samples", "\n", "        ", "neg_inds", "=", "torch", ".", "nonzero", "(", "assign_result", ".", "gt_inds", "==", "0", ")", "\n", "if", "neg_inds", ".", "numel", "(", ")", "!=", "0", ":", "\n", "            ", "neg_inds", "=", "neg_inds", ".", "squeeze", "(", "1", ")", "\n", "", "if", "len", "(", "neg_inds", ")", "<=", "num_expected", ":", "\n", "            ", "return", "neg_inds", "\n", "", "else", ":", "\n", "            ", "return", "self", ".", "hard_mining", "(", "neg_inds", ",", "num_expected", ",", "bboxes", "[", "neg_inds", "]", ",", "\n", "assign_result", ".", "labels", "[", "neg_inds", "]", ",", "feats", ")", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.instance_balanced_pos_sampler.InstanceBalancedPosSampler._sample_pos": [[9, 42], ["torch.nonzero", "pos_inds.squeeze.squeeze.numel", "pos_inds.squeeze.squeeze.squeeze", "pos_inds.squeeze.squeeze.numel", "assign_result.gt_inds[].unique", "len", "int", "torch.cat", "torch.nonzero", "instance_balanced_pos_sampler.InstanceBalancedPosSampler.append", "len", "numpy.array", "torch.from_numpy().to().long", "torch.cat", "round", "instance_balanced_pos_sampler.InstanceBalancedPosSampler.numel", "instance_balanced_pos_sampler.InstanceBalancedPosSampler.squeeze", "len", "instance_balanced_pos_sampler.InstanceBalancedPosSampler.random_choice", "len", "list", "len", "instance_balanced_pos_sampler.InstanceBalancedPosSampler.random_choice", "len", "instance_balanced_pos_sampler.InstanceBalancedPosSampler.random_choice", "i.item", "torch.from_numpy().to", "float", "set", "set", "pos_inds.squeeze.squeeze.cpu", "instance_balanced_pos_sampler.InstanceBalancedPosSampler.cpu", "torch.from_numpy"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.random_sampler.RandomSampler.random_choice", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.random_sampler.RandomSampler.random_choice", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.random_sampler.RandomSampler.random_choice"], ["    ", "def", "_sample_pos", "(", "self", ",", "assign_result", ",", "num_expected", ",", "**", "kwargs", ")", ":", "\n", "        ", "pos_inds", "=", "torch", ".", "nonzero", "(", "assign_result", ".", "gt_inds", ">", "0", ")", "\n", "if", "pos_inds", ".", "numel", "(", ")", "!=", "0", ":", "\n", "            ", "pos_inds", "=", "pos_inds", ".", "squeeze", "(", "1", ")", "\n", "", "if", "pos_inds", ".", "numel", "(", ")", "<=", "num_expected", ":", "\n", "            ", "return", "pos_inds", "\n", "", "else", ":", "\n", "            ", "unique_gt_inds", "=", "assign_result", ".", "gt_inds", "[", "pos_inds", "]", ".", "unique", "(", ")", "\n", "num_gts", "=", "len", "(", "unique_gt_inds", ")", "\n", "num_per_gt", "=", "int", "(", "round", "(", "num_expected", "/", "float", "(", "num_gts", ")", ")", "+", "1", ")", "\n", "sampled_inds", "=", "[", "]", "\n", "for", "i", "in", "unique_gt_inds", ":", "\n", "                ", "inds", "=", "torch", ".", "nonzero", "(", "assign_result", ".", "gt_inds", "==", "i", ".", "item", "(", ")", ")", "\n", "if", "inds", ".", "numel", "(", ")", "!=", "0", ":", "\n", "                    ", "inds", "=", "inds", ".", "squeeze", "(", "1", ")", "\n", "", "else", ":", "\n", "                    ", "continue", "\n", "", "if", "len", "(", "inds", ")", ">", "num_per_gt", ":", "\n", "                    ", "inds", "=", "self", ".", "random_choice", "(", "inds", ",", "num_per_gt", ")", "\n", "", "sampled_inds", ".", "append", "(", "inds", ")", "\n", "", "sampled_inds", "=", "torch", ".", "cat", "(", "sampled_inds", ")", "\n", "if", "len", "(", "sampled_inds", ")", "<", "num_expected", ":", "\n", "                ", "num_extra", "=", "num_expected", "-", "len", "(", "sampled_inds", ")", "\n", "extra_inds", "=", "np", ".", "array", "(", "\n", "list", "(", "set", "(", "pos_inds", ".", "cpu", "(", ")", ")", "-", "set", "(", "sampled_inds", ".", "cpu", "(", ")", ")", ")", ")", "\n", "if", "len", "(", "extra_inds", ")", ">", "num_extra", ":", "\n", "                    ", "extra_inds", "=", "self", ".", "random_choice", "(", "extra_inds", ",", "num_extra", ")", "\n", "", "extra_inds", "=", "torch", ".", "from_numpy", "(", "extra_inds", ")", ".", "to", "(", "\n", "assign_result", ".", "gt_inds", ".", "device", ")", ".", "long", "(", ")", "\n", "sampled_inds", "=", "torch", ".", "cat", "(", "[", "sampled_inds", ",", "extra_inds", "]", ")", "\n", "", "elif", "len", "(", "sampled_inds", ")", ">", "num_expected", ":", "\n", "                ", "sampled_inds", "=", "self", ".", "random_choice", "(", "sampled_inds", ",", "num_expected", ")", "\n", "", "return", "sampled_inds", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.iou_balanced_neg_sampler.IoUBalancedNegSampler.__init__": [[27, 43], ["random_sampler.RandomSampler.__init__"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__"], ["def", "__init__", "(", "self", ",", "\n", "num", ",", "\n", "pos_fraction", ",", "\n", "floor_thr", "=", "-", "1", ",", "\n", "floor_fraction", "=", "0", ",", "\n", "num_bins", "=", "3", ",", "\n", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "IoUBalancedNegSampler", ",", "self", ")", ".", "__init__", "(", "num", ",", "pos_fraction", ",", "\n", "**", "kwargs", ")", "\n", "assert", "floor_thr", ">=", "0", "or", "floor_thr", "==", "-", "1", "\n", "assert", "0", "<=", "floor_fraction", "<=", "1", "\n", "assert", "num_bins", ">=", "1", "\n", "\n", "self", ".", "floor_thr", "=", "floor_thr", "\n", "self", ".", "floor_fraction", "=", "floor_fraction", "\n", "self", ".", "num_bins", "=", "num_bins", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.iou_balanced_neg_sampler.IoUBalancedNegSampler.sample_via_interval": [[44, 74], ["max_overlaps.max", "int", "range", "numpy.concatenate", "set", "list", "numpy.concatenate.append", "len", "numpy.array", "numpy.concatenate", "len", "iou_balanced_neg_sampler.IoUBalancedNegSampler.random_choice", "numpy.array", "len", "list", "len", "iou_balanced_neg_sampler.IoUBalancedNegSampler.random_choice", "numpy.where", "numpy.logical_and", "set"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.random_sampler.RandomSampler.random_choice", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.random_sampler.RandomSampler.random_choice"], ["", "def", "sample_via_interval", "(", "self", ",", "max_overlaps", ",", "full_set", ",", "num_expected", ")", ":", "\n", "        ", "max_iou", "=", "max_overlaps", ".", "max", "(", ")", "\n", "iou_interval", "=", "(", "max_iou", "-", "self", ".", "floor_thr", ")", "/", "self", ".", "num_bins", "\n", "per_num_expected", "=", "int", "(", "num_expected", "/", "self", ".", "num_bins", ")", "\n", "\n", "sampled_inds", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "self", ".", "num_bins", ")", ":", "\n", "            ", "start_iou", "=", "self", ".", "floor_thr", "+", "i", "*", "iou_interval", "\n", "end_iou", "=", "self", ".", "floor_thr", "+", "(", "i", "+", "1", ")", "*", "iou_interval", "\n", "tmp_set", "=", "set", "(", "\n", "np", ".", "where", "(", "\n", "np", ".", "logical_and", "(", "max_overlaps", ">=", "start_iou", ",", "\n", "max_overlaps", "<", "end_iou", ")", ")", "[", "0", "]", ")", "\n", "tmp_inds", "=", "list", "(", "tmp_set", "&", "full_set", ")", "\n", "if", "len", "(", "tmp_inds", ")", ">", "per_num_expected", ":", "\n", "                ", "tmp_sampled_set", "=", "self", ".", "random_choice", "(", "tmp_inds", ",", "\n", "per_num_expected", ")", "\n", "", "else", ":", "\n", "                ", "tmp_sampled_set", "=", "np", ".", "array", "(", "tmp_inds", ",", "dtype", "=", "np", ".", "int", ")", "\n", "", "sampled_inds", ".", "append", "(", "tmp_sampled_set", ")", "\n", "\n", "", "sampled_inds", "=", "np", ".", "concatenate", "(", "sampled_inds", ")", "\n", "if", "len", "(", "sampled_inds", ")", "<", "num_expected", ":", "\n", "            ", "num_extra", "=", "num_expected", "-", "len", "(", "sampled_inds", ")", "\n", "extra_inds", "=", "np", ".", "array", "(", "list", "(", "full_set", "-", "set", "(", "sampled_inds", ")", ")", ")", "\n", "if", "len", "(", "extra_inds", ")", ">", "num_extra", ":", "\n", "                ", "extra_inds", "=", "self", ".", "random_choice", "(", "extra_inds", ",", "num_extra", ")", "\n", "", "sampled_inds", "=", "np", ".", "concatenate", "(", "[", "sampled_inds", ",", "extra_inds", "]", ")", "\n", "\n", "", "return", "sampled_inds", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.iou_balanced_neg_sampler.IoUBalancedNegSampler._sample_neg": [[75, 134], ["torch.nonzero", "neg_inds.squeeze.squeeze.numel", "neg_inds.squeeze.squeeze.squeeze", "len", "assign_result.max_overlaps.cpu().numpy", "set", "list", "list", "int", "numpy.concatenate", "torch.from_numpy().long().to", "neg_inds.squeeze.squeeze.cpu().numpy", "set", "set", "len", "numpy.array", "len", "len", "iou_balanced_neg_sampler.IoUBalancedNegSampler.random_choice", "numpy.array", "len", "numpy.array", "numpy.concatenate", "assign_result.max_overlaps.cpu", "set", "set", "set", "set", "iou_balanced_neg_sampler.IoUBalancedNegSampler.sample_via_interval", "iou_balanced_neg_sampler.IoUBalancedNegSampler.random_choice", "len", "list", "len", "iou_balanced_neg_sampler.IoUBalancedNegSampler.random_choice", "torch.from_numpy().long", "neg_inds.squeeze.squeeze.cpu", "numpy.where", "numpy.where", "set", "numpy.logical_and", "numpy.where", "numpy.where", "numpy.where", "set", "torch.from_numpy"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.random_sampler.RandomSampler.random_choice", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.iou_balanced_neg_sampler.IoUBalancedNegSampler.sample_via_interval", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.random_sampler.RandomSampler.random_choice", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.random_sampler.RandomSampler.random_choice"], ["", "def", "_sample_neg", "(", "self", ",", "assign_result", ",", "num_expected", ",", "**", "kwargs", ")", ":", "\n", "        ", "neg_inds", "=", "torch", ".", "nonzero", "(", "assign_result", ".", "gt_inds", "==", "0", ")", "\n", "if", "neg_inds", ".", "numel", "(", ")", "!=", "0", ":", "\n", "            ", "neg_inds", "=", "neg_inds", ".", "squeeze", "(", "1", ")", "\n", "", "if", "len", "(", "neg_inds", ")", "<=", "num_expected", ":", "\n", "            ", "return", "neg_inds", "\n", "", "else", ":", "\n", "            ", "max_overlaps", "=", "assign_result", ".", "max_overlaps", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "# balance sampling for negative samples", "\n", "neg_set", "=", "set", "(", "neg_inds", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ")", "\n", "\n", "if", "self", ".", "floor_thr", ">", "0", ":", "\n", "                ", "floor_set", "=", "set", "(", "\n", "np", ".", "where", "(", "\n", "np", ".", "logical_and", "(", "max_overlaps", ">=", "0", ",", "\n", "max_overlaps", "<", "self", ".", "floor_thr", ")", ")", "[", "0", "]", ")", "\n", "iou_sampling_set", "=", "set", "(", "\n", "np", ".", "where", "(", "max_overlaps", ">=", "self", ".", "floor_thr", ")", "[", "0", "]", ")", "\n", "", "elif", "self", ".", "floor_thr", "==", "0", ":", "\n", "                ", "floor_set", "=", "set", "(", "np", ".", "where", "(", "max_overlaps", "==", "0", ")", "[", "0", "]", ")", "\n", "iou_sampling_set", "=", "set", "(", "\n", "np", ".", "where", "(", "max_overlaps", ">", "self", ".", "floor_thr", ")", "[", "0", "]", ")", "\n", "", "else", ":", "\n", "                ", "floor_set", "=", "set", "(", ")", "\n", "iou_sampling_set", "=", "set", "(", "\n", "np", ".", "where", "(", "max_overlaps", ">", "self", ".", "floor_thr", ")", "[", "0", "]", ")", "\n", "\n", "", "floor_neg_inds", "=", "list", "(", "floor_set", "&", "neg_set", ")", "\n", "iou_sampling_neg_inds", "=", "list", "(", "iou_sampling_set", "&", "neg_set", ")", "\n", "num_expected_iou_sampling", "=", "int", "(", "num_expected", "*", "\n", "(", "1", "-", "self", ".", "floor_fraction", ")", ")", "\n", "if", "len", "(", "iou_sampling_neg_inds", ")", ">", "num_expected_iou_sampling", ":", "\n", "                ", "if", "self", ".", "num_bins", ">=", "2", ":", "\n", "                    ", "iou_sampled_inds", "=", "self", ".", "sample_via_interval", "(", "\n", "max_overlaps", ",", "set", "(", "iou_sampling_neg_inds", ")", ",", "\n", "num_expected_iou_sampling", ")", "\n", "", "else", ":", "\n", "                    ", "iou_sampled_inds", "=", "self", ".", "random_choice", "(", "\n", "iou_sampling_neg_inds", ",", "num_expected_iou_sampling", ")", "\n", "", "", "else", ":", "\n", "                ", "iou_sampled_inds", "=", "np", ".", "array", "(", "\n", "iou_sampling_neg_inds", ",", "dtype", "=", "np", ".", "int", ")", "\n", "", "num_expected_floor", "=", "num_expected", "-", "len", "(", "iou_sampled_inds", ")", "\n", "if", "len", "(", "floor_neg_inds", ")", ">", "num_expected_floor", ":", "\n", "                ", "sampled_floor_inds", "=", "self", ".", "random_choice", "(", "\n", "floor_neg_inds", ",", "num_expected_floor", ")", "\n", "", "else", ":", "\n", "                ", "sampled_floor_inds", "=", "np", ".", "array", "(", "floor_neg_inds", ",", "dtype", "=", "np", ".", "int", ")", "\n", "", "sampled_inds", "=", "np", ".", "concatenate", "(", "\n", "(", "sampled_floor_inds", ",", "iou_sampled_inds", ")", ")", "\n", "if", "len", "(", "sampled_inds", ")", "<", "num_expected", ":", "\n", "                ", "num_extra", "=", "num_expected", "-", "len", "(", "sampled_inds", ")", "\n", "extra_inds", "=", "np", ".", "array", "(", "list", "(", "neg_set", "-", "set", "(", "sampled_inds", ")", ")", ")", "\n", "if", "len", "(", "extra_inds", ")", ">", "num_extra", ":", "\n", "                    ", "extra_inds", "=", "self", ".", "random_choice", "(", "extra_inds", ",", "num_extra", ")", "\n", "", "sampled_inds", "=", "np", ".", "concatenate", "(", "(", "sampled_inds", ",", "extra_inds", ")", ")", "\n", "", "sampled_inds", "=", "torch", ".", "from_numpy", "(", "sampled_inds", ")", ".", "long", "(", ")", ".", "to", "(", "\n", "assign_result", ".", "gt_inds", ".", "device", ")", "\n", "return", "sampled_inds", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.combined_sampler.CombinedSampler.__init__": [[7, 11], ["base_sampler.BaseSampler.__init__", "assign_sampling.build_sampler", "assign_sampling.build_sampler"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.assign_sampling.build_sampler", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.assign_sampling.build_sampler"], ["    ", "def", "__init__", "(", "self", ",", "pos_sampler", ",", "neg_sampler", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "CombinedSampler", ",", "self", ")", ".", "__init__", "(", "**", "kwargs", ")", "\n", "self", ".", "pos_sampler", "=", "build_sampler", "(", "pos_sampler", ",", "**", "kwargs", ")", "\n", "self", ".", "neg_sampler", "=", "build_sampler", "(", "neg_sampler", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.combined_sampler.CombinedSampler._sample_pos": [[12, 14], ["None"], "methods", ["None"], ["", "def", "_sample_pos", "(", "self", ",", "**", "kwargs", ")", ":", "\n", "        ", "raise", "NotImplementedError", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.combined_sampler.CombinedSampler._sample_neg": [[15, 17], ["None"], "methods", ["None"], ["", "def", "_sample_neg", "(", "self", ",", "**", "kwargs", ")", ":", "\n", "        ", "raise", "NotImplementedError", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.sampling_result.SamplingResult.__init__": [[6, 30], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "pos_inds", ",", "neg_inds", ",", "bboxes", ",", "gt_bboxes", ",", "assign_result", ",", "\n", "gt_flags", ")", ":", "\n", "        ", "\"\"\"\n\n        :param pos_inds: (num_pos), store the indexes for postives\n        :param neg_inds: (num_neg), store the indexes for negatives;\n        :param bboxes: (num_anchors, 4)\n        :param gt_bboxes: (num_truth, 4)\n        :param assign_result:\n        :param gt_flags:\n        \"\"\"", "\n", "self", ".", "pos_inds", "=", "pos_inds", "\n", "self", ".", "neg_inds", "=", "neg_inds", "\n", "self", ".", "pos_bboxes", "=", "bboxes", "[", "pos_inds", "]", "# (num_pos, 4), positive anchor boxes", "\n", "self", ".", "neg_bboxes", "=", "bboxes", "[", "neg_inds", "]", "# (num_neg, 4), negative anchor boxes", "\n", "self", ".", "pos_is_gt", "=", "gt_flags", "[", "pos_inds", "]", "\n", "\n", "self", ".", "num_gts", "=", "gt_bboxes", ".", "shape", "[", "0", "]", "\n", "self", ".", "pos_assigned_gt_inds", "=", "assign_result", ".", "gt_inds", "[", "pos_inds", "]", "-", "1", "# (num_pos), the indexes of ground truth boxes for positives", "\n", "self", ".", "pos_gt_bboxes", "=", "gt_bboxes", "[", "self", ".", "pos_assigned_gt_inds", ",", ":", "]", "# (num_pos, 4), corresponding ground truth boxes for positives", "\n", "if", "assign_result", ".", "labels", "is", "not", "None", ":", "\n", "            ", "self", ".", "pos_gt_labels", "=", "assign_result", ".", "labels", "[", "pos_inds", "]", "\n", "", "else", ":", "\n", "            ", "self", ".", "pos_gt_labels", "=", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.sampling_result.SamplingResult.bboxes": [[31, 34], ["torch.cat"], "methods", ["None"], ["", "", "@", "property", "\n", "def", "bboxes", "(", "self", ")", ":", "\n", "        ", "return", "torch", ".", "cat", "(", "[", "self", ".", "pos_bboxes", ",", "self", ".", "neg_bboxes", "]", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.pseudo_sampler.PseudoSampler.__init__": [[9, 11], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "**", "kwargs", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.pseudo_sampler.PseudoSampler._sample_pos": [[12, 14], ["None"], "methods", ["None"], ["", "def", "_sample_pos", "(", "self", ",", "**", "kwargs", ")", ":", "\n", "        ", "raise", "NotImplementedError", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.pseudo_sampler.PseudoSampler._sample_neg": [[15, 17], ["None"], "methods", ["None"], ["", "def", "_sample_neg", "(", "self", ",", "**", "kwargs", ")", ":", "\n", "        ", "raise", "NotImplementedError", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.samplers.pseudo_sampler.PseudoSampler.sample": [[18, 39], ["torch.nonzero().squeeze().unique", "torch.nonzero().squeeze().unique", "bboxes.new_zeros", "sampling_result.SamplingResult.SamplingResult", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "torch.nonzero", "torch.nonzero"], "methods", ["None"], ["", "def", "sample", "(", "self", ",", "assign_result", ",", "bboxes", ",", "gt_bboxes", ",", "**", "kwargs", ")", ":", "\n", "        ", "\"\"\"\n\n        :param assign_result:\n        :param bboxes: (num_anchors, 4)\n        :param gt_bboxes: (num_truth, 4)\n        :param kwargs:\n        :return:\n              pos_inds: (num_pos), store the indexes for postives\n              neg_inds: (num_neg), store the indexes for negatives;\n              bboxes: (num_anchors, 4)\n              gt_bboxes: (num_truth, 4)\n        \"\"\"", "\n", "pos_inds", "=", "torch", ".", "nonzero", "(", "\n", "assign_result", ".", "gt_inds", ">", "0", ")", ".", "squeeze", "(", "-", "1", ")", ".", "unique", "(", ")", "#", "\n", "neg_inds", "=", "torch", ".", "nonzero", "(", "\n", "assign_result", ".", "gt_inds", "==", "0", ")", ".", "squeeze", "(", "-", "1", ")", ".", "unique", "(", ")", "#", "\n", "gt_flags", "=", "bboxes", ".", "new_zeros", "(", "bboxes", ".", "shape", "[", "0", "]", ",", "dtype", "=", "torch", ".", "uint8", ")", "\n", "sampling_result", "=", "SamplingResult", "(", "pos_inds", ",", "neg_inds", ",", "bboxes", ",", "gt_bboxes", ",", "\n", "assign_result", ",", "gt_flags", ")", "\n", "return", "sampling_result", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.approx_max_iou_assigner.ApproxMaxIoUAssigner.__init__": [[32, 45], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "\n", "pos_iou_thr", ",", "\n", "neg_iou_thr", ",", "\n", "min_pos_iou", "=", ".0", ",", "\n", "gt_max_assign_all", "=", "True", ",", "\n", "ignore_iof_thr", "=", "-", "1", ",", "\n", "ignore_wrt_candidates", "=", "True", ")", ":", "\n", "        ", "self", ".", "pos_iou_thr", "=", "pos_iou_thr", "\n", "self", ".", "neg_iou_thr", "=", "neg_iou_thr", "\n", "self", ".", "min_pos_iou", "=", "min_pos_iou", "\n", "self", ".", "gt_max_assign_all", "=", "gt_max_assign_all", "\n", "self", ".", "ignore_iof_thr", "=", "ignore_iof_thr", "\n", "self", ".", "ignore_wrt_candidates", "=", "ignore_wrt_candidates", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.approx_max_iou_assigner.ApproxMaxIoUAssigner.assign": [[46, 117], ["squares.size", "gt_bboxes.size", "torch.transpose().contiguous().view", "geometry.bbox_overlaps", "geometry.bbox_overlaps.view().max", "torch.transpose", "approx_max_iou_assigner.ApproxMaxIoUAssigner.assign_wrt_overlaps", "ValueError", "torch.transpose().contiguous", "geometry.bbox_overlaps.view", "gt_bboxes_ignore.numel", "geometry.bbox_overlaps", "geometry.bbox_overlaps.max", "geometry.bbox_overlaps", "geometry.bbox_overlaps.max", "torch.transpose", "torch.transpose().contiguous().view.view"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.max_iou_assigner.MaxIoUAssigner.assign_wrt_overlaps", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps"], ["", "def", "assign", "(", "self", ",", "\n", "approxs", ",", "\n", "squares", ",", "\n", "approxs_per_octave", ",", "\n", "gt_bboxes", ",", "\n", "gt_bboxes_ignore", "=", "None", ",", "\n", "gt_labels", "=", "None", ")", ":", "\n", "        ", "\"\"\"Assign gt to approxs.\n\n        This method assign a gt bbox to each group of approxs (bboxes),\n        each group of approxs is represent by a base approx (bbox) and\n        will be assigned with -1, 0, or a positive number.\n        -1 means don't care, 0 means negative sample,\n        positive number is the index (1-based) of assigned gt.\n        The assignment is done in following steps, the order matters.\n\n        1. assign every bbox to -1\n        2. use the max IoU of each group of approxs to assign\n        2. assign proposals whose iou with all gts < neg_iou_thr to 0\n        3. for each bbox, if the iou with its nearest gt >= pos_iou_thr,\n           assign it to that bbox\n        4. for each gt bbox, assign its nearest proposals (may be more than\n           one) to itself\n\n        Args:\n            approxs (Tensor): Bounding boxes to be assigned,\n        shape(approxs_per_octave*n, 4).\n            squares (Tensor): Base Bounding boxes to be assigned,\n        shape(n, 4).\n            approxs_per_octave (int): number of approxs per octave\n            gt_bboxes (Tensor): Groundtruth boxes, shape (k, 4).\n            gt_bboxes_ignore (Tensor, optional): Ground truth bboxes that are\n                labelled as `ignored`, e.g., crowd boxes in COCO.\n            gt_labels (Tensor, optional): Label of gt_bboxes, shape (k, ).\n\n        Returns:\n            :obj:`AssignResult`: The assign result.\n        \"\"\"", "\n", "\n", "if", "squares", ".", "shape", "[", "0", "]", "==", "0", "or", "gt_bboxes", ".", "shape", "[", "0", "]", "==", "0", ":", "\n", "            ", "raise", "ValueError", "(", "'No gt or approxs'", ")", "\n", "", "num_squares", "=", "squares", ".", "size", "(", "0", ")", "\n", "num_gts", "=", "gt_bboxes", ".", "size", "(", "0", ")", "\n", "# re-organize anchors by approxs_per_octave x num_squares", "\n", "approxs", "=", "torch", ".", "transpose", "(", "\n", "approxs", ".", "view", "(", "num_squares", ",", "approxs_per_octave", ",", "4", ")", ",", "0", ",", "\n", "1", ")", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ",", "4", ")", "\n", "all_overlaps", "=", "bbox_overlaps", "(", "approxs", ",", "gt_bboxes", ")", "\n", "\n", "overlaps", ",", "_", "=", "all_overlaps", ".", "view", "(", "approxs_per_octave", ",", "num_squares", ",", "\n", "num_gts", ")", ".", "max", "(", "dim", "=", "0", ")", "\n", "overlaps", "=", "torch", ".", "transpose", "(", "overlaps", ",", "0", ",", "1", ")", "\n", "\n", "bboxes", "=", "squares", "[", ":", ",", ":", "4", "]", "\n", "\n", "if", "(", "self", ".", "ignore_iof_thr", ">", "0", ")", "and", "(", "gt_bboxes_ignore", "is", "not", "None", ")", "and", "(", "\n", "gt_bboxes_ignore", ".", "numel", "(", ")", ">", "0", ")", ":", "\n", "            ", "if", "self", ".", "ignore_wrt_candidates", ":", "\n", "                ", "ignore_overlaps", "=", "bbox_overlaps", "(", "bboxes", ",", "\n", "gt_bboxes_ignore", ",", "\n", "mode", "=", "'iof'", ")", "\n", "ignore_max_overlaps", ",", "_", "=", "ignore_overlaps", ".", "max", "(", "dim", "=", "1", ")", "\n", "", "else", ":", "\n", "                ", "ignore_overlaps", "=", "bbox_overlaps", "(", "gt_bboxes_ignore", ",", "\n", "bboxes", ",", "\n", "mode", "=", "'iof'", ")", "\n", "ignore_max_overlaps", ",", "_", "=", "ignore_overlaps", ".", "max", "(", "dim", "=", "0", ")", "\n", "", "overlaps", "[", ":", ",", "ignore_max_overlaps", ">", "self", ".", "ignore_iof_thr", "]", "=", "-", "1", "\n", "\n", "", "assign_result", "=", "self", ".", "assign_wrt_overlaps", "(", "overlaps", ",", "gt_labels", ")", "\n", "return", "assign_result", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.base_assigner.BaseAssigner.assign": [[6, 9], ["None"], "methods", ["None"], ["    ", "@", "abstractmethod", "\n", "def", "assign", "(", "self", ",", "bboxes", ",", "gt_bboxes", ",", "gt_bboxes_ignore", "=", "None", ",", "gt_labels", "=", "None", ")", ":", "\n", "        ", "pass", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.max_iou_assigner.MaxIoUAssigner.__init__": [[36, 49], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "\n", "pos_iou_thr", ",", "\n", "neg_iou_thr", ",", "\n", "min_pos_iou", "=", ".0", ",", "\n", "gt_max_assign_all", "=", "True", ",", "\n", "ignore_iof_thr", "=", "-", "1", ",", "\n", "ignore_wrt_candidates", "=", "True", ")", ":", "\n", "        ", "self", ".", "pos_iou_thr", "=", "pos_iou_thr", "\n", "self", ".", "neg_iou_thr", "=", "neg_iou_thr", "\n", "self", ".", "min_pos_iou", "=", "min_pos_iou", "\n", "self", ".", "gt_max_assign_all", "=", "gt_max_assign_all", "\n", "self", ".", "ignore_iof_thr", "=", "ignore_iof_thr", "\n", "self", ".", "ignore_wrt_candidates", "=", "ignore_wrt_candidates", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.max_iou_assigner.MaxIoUAssigner.assign": [[50, 97], ["geometry.bbox_overlaps", "max_iou_assigner.MaxIoUAssigner.assign_wrt_overlaps", "ValueError", "gt_bboxes_ignore.numel", "geometry.bbox_overlaps", "geometry.bbox_overlaps.max", "geometry.bbox_overlaps", "geometry.bbox_overlaps.max"], "methods", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.max_iou_assigner.MaxIoUAssigner.assign_wrt_overlaps", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps"], ["", "def", "assign", "(", "self", ",", "bboxes", ",", "gt_bboxes", ",", "gt_bboxes_ignore", "=", "None", ",", "gt_labels", "=", "None", ")", ":", "\n", "        ", "\"\"\"Assign gt to bboxes.\n\n        This method assign a gt bbox to every bbox (proposal/anchor), each bbox\n        will be assigned with -1, 0, or a positive number. -1 means don't care,\n        0 means negative sample, positive number is the index (1-based) of\n        assigned gt.\n        The assignment is done in following steps, the order matters.\n\n        1. assign every bbox to -1\n        2. assign proposals whose iou with all gts < neg_iou_thr to 0\n        3. for each bbox, if the iou with its nearest gt >= pos_iou_thr,\n           assign it to that bbox\n        4. for each gt bbox, assign its nearest proposals (may be more than\n           one) to itself.\n         added by Shengkai Wu: the 4th step will assign the anchors that have the maximum\n         IOU with the ground truth boxes with the corresponding ground truth box's label.\n\n        Args:\n            bboxes (Tensor): Bounding boxes to be assigned, shape(n, 4).\n            gt_bboxes (Tensor): Groundtruth boxes, shape (k, 4).\n            gt_bboxes_ignore (Tensor, optional): Ground truth bboxes that are\n                labelled as `ignored`, e.g., crowd boxes in COCO.\n            gt_labels (Tensor, optional): Label of gt_bboxes, shape (k, ).\n\n        Returns:\n            :obj:`AssignResult`: The assign result.\n        \"\"\"", "\n", "if", "bboxes", ".", "shape", "[", "0", "]", "==", "0", "or", "gt_bboxes", ".", "shape", "[", "0", "]", "==", "0", ":", "\n", "            ", "raise", "ValueError", "(", "'No gt or bboxes'", ")", "\n", "", "bboxes", "=", "bboxes", "[", ":", ",", ":", "4", "]", "\n", "overlaps", "=", "bbox_overlaps", "(", "gt_bboxes", ",", "bboxes", ")", "\n", "\n", "if", "(", "self", ".", "ignore_iof_thr", ">", "0", ")", "and", "(", "gt_bboxes_ignore", "is", "not", "None", ")", "and", "(", "\n", "gt_bboxes_ignore", ".", "numel", "(", ")", ">", "0", ")", ":", "\n", "            ", "if", "self", ".", "ignore_wrt_candidates", ":", "\n", "                ", "ignore_overlaps", "=", "bbox_overlaps", "(", "\n", "bboxes", ",", "gt_bboxes_ignore", ",", "mode", "=", "'iof'", ")", "\n", "ignore_max_overlaps", ",", "_", "=", "ignore_overlaps", ".", "max", "(", "dim", "=", "1", ")", "\n", "", "else", ":", "\n", "                ", "ignore_overlaps", "=", "bbox_overlaps", "(", "\n", "gt_bboxes_ignore", ",", "bboxes", ",", "mode", "=", "'iof'", ")", "\n", "ignore_max_overlaps", ",", "_", "=", "ignore_overlaps", ".", "max", "(", "dim", "=", "0", ")", "\n", "", "overlaps", "[", ":", ",", "ignore_max_overlaps", ">", "self", ".", "ignore_iof_thr", "]", "=", "-", "1", "\n", "\n", "", "assign_result", "=", "self", ".", "assign_wrt_overlaps", "(", "overlaps", ",", "gt_labels", ")", "\n", "return", "assign_result", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.max_iou_assigner.MaxIoUAssigner.assign_wrt_overlaps": [[98, 202], ["overlaps.new_full", "overlaps.max", "overlaps.max", "isinstance", "range", "assign_result.AssignResult", "overlaps.numel", "ValueError", "overlaps.size", "overlaps.size", "isinstance", "overlaps.new_full.new_zeros", "torch.nonzero().squeeze", "torch.nonzero().squeeze.numel", "len", "torch.nonzero"], "methods", ["None"], ["", "def", "assign_wrt_overlaps", "(", "self", ",", "overlaps", ",", "gt_labels", "=", "None", ")", ":", "\n", "        ", "\"\"\"Assign w.r.t. the overlaps of bboxes with gts.\n\n        Args:\n            overlaps (Tensor): Overlaps between k gt_bboxes and n bboxes,\n                shape(k, n).\n            gt_labels (Tensor, optional): Labels of k gt_bboxes, shape (k, ).\n\n        Returns:\n            :obj:`AssignResult`: The assign result.\n            num_gts: the number of ground truth boxes;\n            assigned_gt_inds: (num_bboxes), store the indexes(>=1) of ground truth boxes for the\n                  positives, 0 for negatives and -1 for neutrals.\n            max_overlaps: (num_bboxes), store the IoU of each anchors with the nearest ground truth boxes;\n\n        \"\"\"", "\n", "if", "overlaps", ".", "numel", "(", ")", "==", "0", ":", "\n", "            ", "raise", "ValueError", "(", "'No gt or proposals'", ")", "\n", "\n", "", "num_gts", ",", "num_bboxes", "=", "overlaps", ".", "size", "(", "0", ")", ",", "overlaps", ".", "size", "(", "1", ")", "\n", "\n", "# 1. assign -1 by default.", "\n", "# size=(num_bboxes), store ground truth boxes index(>=1) for positives,", "\n", "# 0 for negatives and -1 for neutrals.", "\n", "assigned_gt_inds", "=", "overlaps", ".", "new_full", "(", "\n", "(", "num_bboxes", ",", ")", ",", "-", "1", ",", "dtype", "=", "torch", ".", "long", ")", "\n", "\n", "# for each anchor, which gt best overlaps with it", "\n", "# for each anchor, the max iou of all gts", "\n", "max_overlaps", ",", "argmax_overlaps", "=", "overlaps", ".", "max", "(", "dim", "=", "0", ")", "\n", "# for each gt, which anchor best overlaps with it", "\n", "# for each gt, the max iou of all proposals", "\n", "gt_max_overlaps", ",", "gt_argmax_overlaps", "=", "overlaps", ".", "max", "(", "dim", "=", "1", ")", "\n", "\n", "# 2. assign negative: below", "\n", "if", "isinstance", "(", "self", ".", "neg_iou_thr", ",", "float", ")", ":", "\n", "            ", "assigned_gt_inds", "[", "(", "max_overlaps", ">=", "0", ")", "\n", "&", "(", "max_overlaps", "<", "self", ".", "neg_iou_thr", ")", "]", "=", "0", "\n", "", "elif", "isinstance", "(", "self", ".", "neg_iou_thr", ",", "tuple", ")", ":", "\n", "            ", "assert", "len", "(", "self", ".", "neg_iou_thr", ")", "==", "2", "\n", "assigned_gt_inds", "[", "(", "max_overlaps", ">=", "self", ".", "neg_iou_thr", "[", "0", "]", ")", "\n", "&", "(", "max_overlaps", "<", "self", ".", "neg_iou_thr", "[", "1", "]", ")", "]", "=", "0", "\n", "# added by WSK", "\n", "# use different iou threshold to assign label for classification and localization task", "\n", "# respectively. The threshold for classification can be set lower than that for localization", "\n", "# so that more positive anchors can be used to train classification sub-network.", "\n", "# use_different_threshold = False", "\n", "# neg_iou_thr_cls = 0.4", "\n", "# pos_iou_thr_cls = 0.4", "\n", "# if use_different_threshold:", "\n", "#     # assigned_gt_inds_cls: (num_bboxes), -1 for neutrals, 0 for negatives, the indexes of", "\n", "#     # ground truth boxes for positive examples. This is used for classification task.", "\n", "#     assigned_gt_inds_cls = overlaps.new_full(", "\n", "#         (num_bboxes,), -1, dtype=torch.long)", "\n", "#     assigned_gt_inds_cls[(max_overlaps >= 0)", "\n", "#                      & (max_overlaps < neg_iou_thr_cls)] = 0", "\n", "#     pos_inds = max_overlaps >= pos_iou_thr_cls", "\n", "#     assigned_gt_inds_cls[pos_inds] = argmax_overlaps[pos_inds] + 1", "\n", "#     for i in range(num_gts):", "\n", "#         if gt_max_overlaps[i] >= self.min_pos_iou:", "\n", "#             if self.gt_max_assign_all:", "\n", "#                 max_iou_inds = overlaps[i, :] == gt_max_overlaps[i]", "\n", "#                 assigned_gt_inds_cls[max_iou_inds] = i + 1", "\n", "#             else:", "\n", "#                 assigned_gt_inds_cls[gt_argmax_overlaps[i]] = i + 1", "\n", "\n", "# 3. assign positive: above positive IoU threshold", "\n", "# added by WSK:", "\n", "# assigned_gt_inds: size = (num_bboxes), store gt index for examples with IoU > pos_iou_thr", "\n", "", "pos_inds", "=", "max_overlaps", ">=", "self", ".", "pos_iou_thr", "\n", "assigned_gt_inds", "[", "pos_inds", "]", "=", "argmax_overlaps", "[", "pos_inds", "]", "+", "1", "\n", "\n", "# pos_iou_thr_loc = 0.5", "\n", "# if use_different_threshold:", "\n", "#     pos_inds_loc = max_overlaps >= pos_iou_thr_loc", "\n", "\n", "\n", "\n", "# 4. assign fg: for each gt, proposals with highest IoU", "\n", "# added by WSK", "\n", "# this step can't ensure all the ground truth boxes have the corresponding anchors. For examples,", "\n", "# the object i have the nearest anchor j with IoU=0.4. however, object k < i also have the nearest", "\n", "# anchor j with IoU=0.45. this step will make the object k have no corresponding anchor.", "\n", "# Differently, YOLACT assign the ground truth boxes with the highest IoU firstly in sequence in this step.", "\n", "# This can ensure that every ground truth box have at least one corresponding anchor.", "\n", "for", "i", "in", "range", "(", "num_gts", ")", ":", "\n", "            ", "if", "gt_max_overlaps", "[", "i", "]", ">=", "self", ".", "min_pos_iou", ":", "\n", "                ", "if", "self", ".", "gt_max_assign_all", ":", "\n", "                    ", "max_iou_inds", "=", "overlaps", "[", "i", ",", ":", "]", "==", "gt_max_overlaps", "[", "i", "]", "\n", "assigned_gt_inds", "[", "max_iou_inds", "]", "=", "i", "+", "1", "\n", "", "else", ":", "\n", "                    ", "assigned_gt_inds", "[", "gt_argmax_overlaps", "[", "i", "]", "]", "=", "i", "+", "1", "\n", "\n", "", "", "", "if", "gt_labels", "is", "not", "None", ":", "\n", "            ", "assigned_labels", "=", "assigned_gt_inds", ".", "new_zeros", "(", "(", "num_bboxes", ",", ")", ")", "\n", "pos_inds", "=", "torch", ".", "nonzero", "(", "assigned_gt_inds", ">", "0", ")", ".", "squeeze", "(", ")", "\n", "if", "pos_inds", ".", "numel", "(", ")", ">", "0", ":", "\n", "                ", "assigned_labels", "[", "pos_inds", "]", "=", "gt_labels", "[", "\n", "assigned_gt_inds", "[", "pos_inds", "]", "-", "1", "]", "\n", "", "", "else", ":", "\n", "            ", "assigned_labels", "=", "None", "\n", "\n", "", "return", "AssignResult", "(", "\n", "num_gts", ",", "assigned_gt_inds", ",", "max_overlaps", ",", "labels", "=", "assigned_labels", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.__init__": [[6, 20], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "num_gts", ",", "gt_inds", ",", "max_overlaps", ",", "labels", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n\n        :param num_gts: number of ground truth boxes\n        :param gt_inds: (num_anchors), store indexes(>=1) of corresponding ground truth boxes\n              for positive examples, -1 for neutrals and 0 for negatives.\n        :param max_overlaps: (num_anchors), the max IoU for each anchors with the nearest\n              ground truth box.\n        :param labels:\n        \"\"\"", "\n", "self", ".", "num_gts", "=", "num_gts", "\n", "self", ".", "gt_inds", "=", "gt_inds", "\n", "self", ".", "max_overlaps", "=", "max_overlaps", "\n", "self", ".", "labels", "=", "labels", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.assigners.assign_result.AssignResult.add_gt_": [[21, 34], ["torch.arange", "torch.cat", "torch.cat", "torch.cat", "len", "assign_result.AssignResult.max_overlaps.new_ones"], "methods", ["None"], ["", "def", "add_gt_", "(", "self", ",", "gt_labels", ")", ":", "\n", "        ", "\"\"\"\n\n        :param gt_labels:\n        :return:\n        \"\"\"", "\n", "self_inds", "=", "torch", ".", "arange", "(", "\n", "1", ",", "len", "(", "gt_labels", ")", "+", "1", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "gt_labels", ".", "device", ")", "\n", "self", ".", "gt_inds", "=", "torch", ".", "cat", "(", "[", "self_inds", ",", "self", ".", "gt_inds", "]", ")", "\n", "self", ".", "max_overlaps", "=", "torch", ".", "cat", "(", "\n", "[", "self", ".", "max_overlaps", ".", "new_ones", "(", "self", ".", "num_gts", ")", ",", "self", ".", "max_overlaps", "]", ")", "\n", "if", "self", ".", "labels", "is", "not", "None", ":", "\n", "            ", "self", ".", "labels", "=", "torch", ".", "cat", "(", "[", "gt_labels", ",", "self", ".", "labels", "]", ")", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.consistent_loss.consistent_loss": [[6, 34], ["torch.cross_entropy", "iou.new_zeros", "iou.new_ones", "torch.where", "torch.where", "iou_weights.detach.detach", "max", "iou.size", "iou.size", "torch.sum().float().item", "torch.sum().float().item", "torch.sum", "torch.sum", "torch.sum().float", "torch.sum().float", "torch.sum", "torch.sum"], "function", ["None"], ["def", "consistent_loss", "(", "pred", ",", "label", ",", "weight", ",", "iou", ",", "avg_factor", "=", "None", ",", "reduce", "=", "True", ")", ":", "\n", "    ", "\"\"\"\n    :param pred: tesnor of shape (batch*num_samples, num_class)\n    :param label: tensor of shape (batch*num_samples), store gt labels such as\n               0, 1, 2, 80 for corresponding class(0 represent background).\n    :param weight: tensor of shape (batch*num_samples), 1 for all the elements;\n    :param iou: tensor of shape (batch*num_samples), iou between proposals and corresponding ground\n        truth boxes for positives and 0 for negatives.\n    :param avg_factor:\n    :param reduce:\n    :return:\n    \"\"\"", "\n", "if", "avg_factor", "is", "None", ":", "\n", "        ", "avg_factor", "=", "max", "(", "torch", ".", "sum", "(", "weight", ">", "0", ")", ".", "float", "(", ")", ".", "item", "(", ")", ",", "1.", ")", "\n", "", "raw1", "=", "F", ".", "cross_entropy", "(", "pred", ",", "label", ",", "reduction", "=", "'none'", ")", "\n", "target", "=", "iou", ".", "new_zeros", "(", "iou", ".", "size", "(", "0", ")", ")", "\n", "pos_inds", "=", "(", "label", ">", "0", ")", ".", "nonzero", "(", ")", ".", "view", "(", "-", "1", ")", "\n", "target", "[", "pos_inds", "]", "=", "1.0", "\n", "threshold", "=", "0.5", "\n", "ones_weight", "=", "iou", ".", "new_ones", "(", "iou", ".", "size", "(", "0", ")", ")", "\n", "iou_weights_1", "=", "torch", ".", "where", "(", "iou", ">", "threshold", ",", "1.0", "+", "(", "iou", "-", "threshold", ")", ",", "ones_weight", ")", "\n", "iou_weights", "=", "(", "1", "-", "target", ")", "+", "target", "*", "iou_weights_1", "\n", "iou_weights", "=", "iou_weights", ".", "detach", "(", ")", "\n", "raw", "=", "raw1", "*", "iou_weights", "\n", "if", "reduce", ":", "\n", "        ", "return", "torch", ".", "sum", "(", "raw", "*", "weight", ")", "[", "None", "]", "/", "avg_factor", "\n", "", "else", ":", "\n", "        ", "return", "raw", "*", "weight", "/", "avg_factor", "", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.weighted_nll_loss": [[12, 17], ["torch.nll_loss", "max", "torch.sum().float().item", "torch.sum().float().item", "torch.sum", "torch.sum", "torch.sum().float", "torch.sum().float", "torch.sum", "torch.sum"], "function", ["None"], ["def", "weighted_nll_loss", "(", "pred", ",", "label", ",", "weight", ",", "avg_factor", "=", "None", ")", ":", "\n", "    ", "if", "avg_factor", "is", "None", ":", "\n", "        ", "avg_factor", "=", "max", "(", "torch", ".", "sum", "(", "weight", ">", "0", ")", ".", "float", "(", ")", ".", "item", "(", ")", ",", "1.", ")", "\n", "", "raw", "=", "F", ".", "nll_loss", "(", "pred", ",", "label", ",", "reduction", "=", "'none'", ")", "\n", "return", "torch", ".", "sum", "(", "raw", "*", "weight", ")", "[", "None", "]", "/", "avg_factor", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.weighted_cross_entropy": [[19, 27], ["torch.cross_entropy", "max", "torch.sum().float().item", "torch.sum().float().item", "torch.sum", "torch.sum", "torch.sum().float", "torch.sum().float", "torch.sum", "torch.sum"], "function", ["None"], ["", "def", "weighted_cross_entropy", "(", "pred", ",", "label", ",", "weight", ",", "avg_factor", "=", "None", ",", "reduce", "=", "True", ")", ":", "\n", "    ", "if", "avg_factor", "is", "None", ":", "\n", "        ", "avg_factor", "=", "max", "(", "torch", ".", "sum", "(", "weight", ">", "0", ")", ".", "float", "(", ")", ".", "item", "(", ")", ",", "1.", ")", "\n", "", "raw", "=", "F", ".", "cross_entropy", "(", "pred", ",", "label", ",", "reduction", "=", "'none'", ")", "\n", "if", "reduce", ":", "\n", "        ", "return", "torch", ".", "sum", "(", "raw", "*", "weight", ")", "[", "None", "]", "/", "avg_factor", "\n", "", "else", ":", "\n", "        ", "return", "raw", "*", "weight", "/", "avg_factor", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.iou_balanced_cross_entropy": [[30, 109], ["torch.cross_entropy", "iou.new_zeros", "target.type_as.type_as", "iou.size", "max", "normalized_iou_weights.detach.detach", "iou_weights.detach.detach", "iou_weights.detach.detach", "torch.sum().float().item", "torch.sum().float().item", "iou.new_ones", "torch.where", "torch.where", "iou_weights.detach.detach", "torch.sum", "torch.sum", "iou.size", "torch.sum().float", "torch.sum().float", "torch.sum", "torch.sum"], "function", ["None"], ["", "", "def", "iou_balanced_cross_entropy", "(", "pred", ",", "label", ",", "weight", ",", "iou", ",", "eta", "=", "1.5", ",", "avg_factor", "=", "None", ",", "reduce", "=", "True", ")", ":", "\n", "    ", "\"\"\"\n    iou_balanced cross entropy loss to make the training process to focus more on positives with higher\n    iou.\n    :param pred: tesnor of shape (batch*num_samples, num_class)\n    :param label: tensor of shape (batch*num_samples), store gt labels such as\n               0, 1, 2, 80 for corresponding class(0 represent background).\n    :param weight: tensor of shape (batch*num_samples), 1 for all the elements;\n    :param iou: tensor of shape (batch*num_samples), iou between predicted boxes and corresponding ground\n        truth boxes for positives and 0 for negatives.\n    :param eta: control to which extent the training process focuses on the positives with high iou.\n    :param avg_factor:\n    :param reduce:\n    :return:\n    \"\"\"", "\n", "# avg_factor = batch*num_samples", "\n", "# if avg_factor is None:", "\n", "#     avg_factor = max(torch.sum(weight > 0).float().item(), 1.)", "\n", "\n", "raw1", "=", "F", ".", "cross_entropy", "(", "pred", ",", "label", ",", "reduction", "=", "'none'", ")", "\n", "\n", "target", "=", "iou", ".", "new_zeros", "(", "iou", ".", "size", "(", "0", ")", ")", "\n", "# target_1 = iou.new_zeros(iou.size(0))", "\n", "# the way to get the indexes of positive example may be wrong; is it right?", "\n", "# pos_inds_1 = label > 0", "\n", "# target_1[pos_inds_1] = 1", "\n", "# modify the way to get the indexes", "\n", "pos_inds", "=", "(", "label", ">", "0", ")", ".", "nonzero", "(", ")", ".", "view", "(", "-", "1", ")", "\n", "# pos_inds = (label >= 1).nonzero().view(-1)", "\n", "target", "[", "pos_inds", "]", "=", "1.0", "\n", "# pos_inds_test = target.nonzero().view(-1)", "\n", "\n", "method_1", "=", "True", "\n", "normalization", "=", "True", "\n", "\n", "method_2", "=", "False", "\n", "\n", "threshold", "=", "0.66", "\n", "# threshold = torch.min(iou[pos_inds]).item()", "\n", "\n", "method_3", "=", "False", "\n", "\n", "target", "=", "target", ".", "type_as", "(", "pred", ")", "\n", "if", "method_1", ":", "\n", "        ", "if", "normalization", ":", "\n", "            ", "iou_weights", "=", "(", "1", "-", "target", ")", "+", "(", "target", "*", "iou", ")", ".", "pow", "(", "eta", ")", "\n", "# normalized to keep the sum of loss for positive examples unchanged;", "\n", "raw2", "=", "raw1", "*", "iou_weights", "\n", "normalizer", "=", "(", "raw1", "*", "target", ")", ".", "sum", "(", ")", "/", "(", "(", "raw2", "*", "target", ")", ".", "sum", "(", ")", "+", "1e-6", ")", "\n", "normalized_iou_weights", "=", "(", "1", "-", "target", ")", "+", "(", "target", "*", "iou", ")", ".", "pow", "(", "eta", ")", "*", "normalizer", "\n", "normalized_iou_weights", "=", "normalized_iou_weights", ".", "detach", "(", ")", "\n", "raw", "=", "raw1", "*", "normalized_iou_weights", "\n", "", "else", ":", "\n", "            ", "weight_pos", "=", "1.8", "\n", "iou_weights", "=", "(", "1", "-", "target", ")", "+", "(", "target", "*", "iou", ")", ".", "pow", "(", "eta", ")", "*", "weight_pos", "\n", "iou_weights", "=", "iou_weights", ".", "detach", "(", ")", "\n", "raw", "=", "raw1", "*", "iou_weights", "\n", "", "", "elif", "method_2", ":", "\n", "        ", "iou_weights", "=", "(", "1", "-", "target", ")", "+", "(", "target", "*", "(", "1", "+", "(", "iou", "-", "threshold", ")", ")", ")", ".", "pow", "(", "eta", ")", "\n", "iou_weights", "=", "iou_weights", ".", "detach", "(", ")", "\n", "raw", "=", "raw1", "*", "iou_weights", "\n", "", "elif", "method_3", ":", "\n", "        ", "ones_weight", "=", "iou", ".", "new_ones", "(", "iou", ".", "size", "(", "0", ")", ")", "\n", "iou_weights_1", "=", "torch", ".", "where", "(", "iou", ">", "threshold", ",", "1.0", "+", "(", "iou", "-", "threshold", ")", ",", "ones_weight", ")", "\n", "# iou_weights = (1 - target) + (target * iou_weights_1).pow(eta)", "\n", "iou_weights", "=", "(", "1", "-", "target", ")", "+", "target", "*", "iou_weights_1", "\n", "iou_weights", "=", "iou_weights", ".", "detach", "(", ")", "\n", "raw", "=", "raw1", "*", "iou_weights", "\n", "# raw = (raw1 * iou_weights +raw1)/2", "\n", "# print('test_loss')", "\n", "\n", "", "if", "avg_factor", "is", "None", ":", "\n", "# avg_factor = max(torch.sum(normalized_iou_weights).float().item(), 1.)", "\n", "        ", "avg_factor", "=", "max", "(", "torch", ".", "sum", "(", "weight", ">", "0", ")", ".", "float", "(", ")", ".", "item", "(", ")", ",", "1.", ")", "\n", "\n", "", "if", "reduce", ":", "\n", "        ", "return", "torch", ".", "sum", "(", "raw", "*", "weight", ")", "[", "None", "]", "/", "avg_factor", "\n", "", "else", ":", "\n", "        ", "return", "raw", "*", "weight", "/", "avg_factor", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.consistent_loss": [[110, 138], ["torch.cross_entropy", "iou.new_zeros", "iou.new_ones", "torch.where", "torch.where", "iou_weights.detach.detach", "max", "iou.size", "iou.size", "torch.sum().float().item", "torch.sum().float().item", "torch.sum", "torch.sum", "torch.sum().float", "torch.sum().float", "torch.sum", "torch.sum"], "function", ["None"], ["", "", "def", "consistent_loss", "(", "pred", ",", "label", ",", "weight", ",", "iou", ",", "avg_factor", "=", "None", ",", "reduce", "=", "True", ")", ":", "\n", "    ", "\"\"\"\n    :param pred: tesnor of shape (batch*num_samples, num_class)\n    :param label: tensor of shape (batch*num_samples), store gt labels such as\n               0, 1, 2, 80 for corresponding class(0 represent background).\n    :param weight: tensor of shape (batch*num_samples), 1 for all the elements;\n    :param iou: tensor of shape (batch*num_samples), iou between proposals and corresponding ground\n        truth boxes for positives and 0 for negatives.\n    :param avg_factor:\n    :param reduce:\n    :return:\n    \"\"\"", "\n", "if", "avg_factor", "is", "None", ":", "\n", "        ", "avg_factor", "=", "max", "(", "torch", ".", "sum", "(", "weight", ">", "0", ")", ".", "float", "(", ")", ".", "item", "(", ")", ",", "1.", ")", "\n", "", "raw1", "=", "F", ".", "cross_entropy", "(", "pred", ",", "label", ",", "reduction", "=", "'none'", ")", "\n", "target", "=", "iou", ".", "new_zeros", "(", "iou", ".", "size", "(", "0", ")", ")", "\n", "pos_inds", "=", "(", "label", ">", "0", ")", ".", "nonzero", "(", ")", ".", "view", "(", "-", "1", ")", "\n", "target", "[", "pos_inds", "]", "=", "1.0", "\n", "threshold", "=", "0.5", "\n", "ones_weight", "=", "iou", ".", "new_ones", "(", "iou", ".", "size", "(", "0", ")", ")", "\n", "iou_weights_1", "=", "torch", ".", "where", "(", "iou", ">", "threshold", ",", "1.0", "+", "(", "iou", "-", "threshold", ")", ",", "ones_weight", ")", "\n", "iou_weights", "=", "(", "1", "-", "target", ")", "+", "target", "*", "iou_weights_1", "\n", "iou_weights", "=", "iou_weights", ".", "detach", "(", ")", "\n", "raw", "=", "raw1", "*", "iou_weights", "\n", "if", "reduce", ":", "\n", "        ", "return", "torch", ".", "sum", "(", "raw", "*", "weight", ")", "[", "None", "]", "/", "avg_factor", "\n", "", "else", ":", "\n", "        ", "return", "raw", "*", "weight", "/", "avg_factor", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.weighted_binary_cross_entropy": [[141, 150], ["pred.dim", "label.dim", "losses._expand_binary_labels", "max", "pred.size", "torch.sum().float().item", "torch.sum().float().item", "torch.binary_cross_entropy_with_logits", "label.float", "weight.float", "torch.sum().float", "torch.sum().float", "torch.sum", "torch.sum"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses._expand_binary_labels"], ["", "", "def", "weighted_binary_cross_entropy", "(", "pred", ",", "label", ",", "weight", ",", "avg_factor", "=", "None", ")", ":", "\n", "    ", "if", "pred", ".", "dim", "(", ")", "!=", "label", ".", "dim", "(", ")", ":", "\n", "        ", "label", ",", "weight", "=", "_expand_binary_labels", "(", "label", ",", "weight", ",", "pred", ".", "size", "(", "-", "1", ")", ")", "\n", "", "if", "avg_factor", "is", "None", ":", "\n", "        ", "avg_factor", "=", "max", "(", "torch", ".", "sum", "(", "weight", ">", "0", ")", ".", "float", "(", ")", ".", "item", "(", ")", ",", "1.", ")", "\n", "# print('test')", "\n", "", "return", "F", ".", "binary_cross_entropy_with_logits", "(", "\n", "pred", ",", "label", ".", "float", "(", ")", ",", "weight", ".", "float", "(", ")", ",", "\n", "reduction", "=", "'sum'", ")", "[", "None", "]", "/", "avg_factor", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.iou_balanced_binary_cross_entropy": [[151, 214], ["torch.binary_cross_entropy_with_logits", "label.new_zeros", "pred.dim", "label.dim", "losses._expand_binary_labels", "max", "label.float", "label.size", "target.type_as.type_as", "iou.unsqueeze.unsqueeze", "normalized_iou_weights.detach.detach", "target.type_as.type_as", "iou_weights.detach.detach", "pred.size", "torch.sum().float().item", "torch.sum().float().item", "torch.sum", "torch.sum", "torch.sum().float", "torch.sum().float", "torch.sum", "torch.sum"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses._expand_binary_labels"], ["", "def", "iou_balanced_binary_cross_entropy", "(", "pred", ",", "label", ",", "weight", ",", "iou", ",", "eta", "=", "1.5", ",", "avg_factor", "=", "None", ",", "reduce", "=", "True", ")", ":", "\n", "    ", "\"\"\"\n\n    :param pred: tensor of shape (num_examples, 1)\n    :param label: tensor of shape (num_examples, 1)\n    :param weight: tensor of shape (num_examples, 1)\n    :param iou: tensor of shape (num_examples), containing the iou for all the regressed\n          positive examples.\n    :param eta:\n    :param avg_factor:\n    :return:\n    \"\"\"", "\n", "if", "pred", ".", "dim", "(", ")", "!=", "label", ".", "dim", "(", ")", ":", "\n", "        ", "label", ",", "weight", "=", "_expand_binary_labels", "(", "label", ",", "weight", ",", "pred", ".", "size", "(", "-", "1", ")", ")", "\n", "", "if", "avg_factor", "is", "None", ":", "\n", "        ", "avg_factor", "=", "max", "(", "torch", ".", "sum", "(", "weight", ">", "0", ")", ".", "float", "(", ")", ".", "item", "(", ")", ",", "1.", ")", "\n", "\n", "", "raw1", "=", "F", ".", "binary_cross_entropy_with_logits", "(", "pred", ",", "label", ".", "float", "(", ")", ",", "reduction", "=", "'none'", ")", "\n", "\n", "target", "=", "label", ".", "new_zeros", "(", "label", ".", "size", "(", ")", ")", "\n", "# target_1 = iou.new_zeros(iou.size(0))", "\n", "# the way to get the indexes of positive example may be wrong; is it wright?", "\n", "# pos_inds_1 = label > 0", "\n", "# target_1[pos_inds_1] = 1", "\n", "# modify the way to get the indexes", "\n", "# label_squeeze = torch.squeeze(label)", "\n", "# pos_inds = (label > 0).nonzero().view(-1)", "\n", "# print('the size of label is ', label.size())", "\n", "pos_inds", "=", "(", "label", ">", "0", ")", ".", "nonzero", "(", ")", "\n", "# print('the size of label_squeeze is ', label_squeeze.size())", "\n", "target", "[", "pos_inds", "]", "=", "1", "\n", "\n", "# print('the num of positive examples is', torch.sum(target))", "\n", "# print('the num of positive examples for target_1 is', torch.sum(target_1))", "\n", "normalization", "=", "True", "\n", "if", "normalization", ":", "\n", "        ", "target", "=", "target", ".", "type_as", "(", "pred", ")", "\n", "iou", "=", "iou", ".", "unsqueeze", "(", "-", "1", ")", "\n", "# print('the size of target is ', target.size())", "\n", "# print('the size of iou is ', iou.size())", "\n", "# print('the size of iou_1 is ', iou_1.size())", "\n", "iou_weights", "=", "(", "1", "-", "target", ")", "+", "(", "target", "*", "iou", ")", ".", "pow", "(", "eta", ")", "\n", "# print('the size of iou_weights is ', iou_weights.size())", "\n", "# print('the size of raw1 is ', raw1.size())", "\n", "# iou_weights.unsqueeze(1)", "\n", "# normalized to keep the sum of loss for positive examples unchanged;", "\n", "raw2", "=", "raw1", "*", "iou_weights", "\n", "normalizer", "=", "(", "raw1", "*", "target", ")", ".", "sum", "(", ")", "/", "(", "(", "raw2", "*", "target", ")", ".", "sum", "(", ")", "+", "1e-6", ")", "\n", "normalized_iou_weights", "=", "(", "1", "-", "target", ")", "+", "(", "target", "*", "iou", ")", ".", "pow", "(", "eta", ")", "*", "normalizer", "\n", "normalized_iou_weights", "=", "normalized_iou_weights", ".", "detach", "(", ")", "\n", "raw", "=", "raw1", "*", "normalized_iou_weights", "\n", "", "else", ":", "\n", "        ", "target", "=", "target", ".", "type_as", "(", "pred", ")", "\n", "weight_pos", "=", "1.8", "\n", "iou_weights", "=", "(", "1", "-", "target", ")", "+", "(", "target", "*", "iou", ")", ".", "pow", "(", "eta", ")", "*", "weight_pos", "\n", "iou_weights", "=", "iou_weights", ".", "detach", "(", ")", "\n", "raw", "=", "raw1", "*", "iou_weights", "\n", "\n", "", "if", "reduce", ":", "\n", "\n", "        ", "return", "torch", ".", "sum", "(", "raw", "*", "weight", ")", "[", "None", "]", "/", "avg_factor", "\n", "", "else", ":", "\n", "        ", "return", "raw", "*", "weight", "/", "avg_factor", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.py_sigmoid_focal_loss": [[226, 248], ["pred.sigmoid", "target.type_as.type_as", "torch._Reduction.get_enum", "pt.pow", "torch.binary_cross_entropy_with_logits", "loss.mean", "loss.sum"], "function", ["None"], ["", "", "def", "py_sigmoid_focal_loss", "(", "pred", ",", "\n", "target", ",", "\n", "weight", ",", "\n", "gamma", "=", "2.0", ",", "\n", "alpha", "=", "0.25", ",", "\n", "reduction", "=", "'mean'", ")", ":", "\n", "    ", "pred_sigmoid", "=", "pred", ".", "sigmoid", "(", ")", "\n", "target", "=", "target", ".", "type_as", "(", "pred", ")", "\n", "pt", "=", "(", "1", "-", "pred_sigmoid", ")", "*", "target", "+", "pred_sigmoid", "*", "(", "1", "-", "target", ")", "\n", "weight", "=", "(", "alpha", "*", "target", "+", "(", "1", "-", "alpha", ")", "*", "(", "1", "-", "target", ")", ")", "*", "weight", "\n", "weight", "=", "weight", "*", "pt", ".", "pow", "(", "gamma", ")", "\n", "loss", "=", "F", ".", "binary_cross_entropy_with_logits", "(", "\n", "pred", ",", "target", ",", "reduction", "=", "'none'", ")", "*", "weight", "\n", "# the value of reduction_enum is decided by arg 'reduction'", "\n", "# none: 0, mean:1, sum: 2", "\n", "reduction_enum", "=", "F", ".", "_Reduction", ".", "get_enum", "(", "reduction", ")", "\n", "if", "reduction_enum", "==", "0", ":", "\n", "        ", "return", "loss", "\n", "", "elif", "reduction_enum", "==", "1", ":", "\n", "        ", "return", "loss", ".", "mean", "(", ")", "\n", "", "elif", "reduction_enum", "==", "2", ":", "\n", "        ", "return", "loss", ".", "sum", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.py_sigmoid_focal_loss_for_negatives": [[254, 276], ["pred.sigmoid", "target.type_as.type_as", "torch._Reduction.get_enum", "pt.pow", "torch.binary_cross_entropy_with_logits", "loss.mean", "loss.sum"], "function", ["None"], ["", "", "def", "py_sigmoid_focal_loss_for_negatives", "(", "pred", ",", "\n", "target", ",", "\n", "weight", ",", "\n", "gamma", "=", "2.0", ",", "\n", "alpha", "=", "0.25", ",", "\n", "reduction", "=", "'mean'", ")", ":", "\n", "    ", "pred_sigmoid", "=", "pred", ".", "sigmoid", "(", ")", "\n", "target", "=", "target", ".", "type_as", "(", "pred", ")", "\n", "pt", "=", "target", "+", "pred_sigmoid", "*", "(", "1", "-", "target", ")", "\n", "weight", "=", "(", "alpha", "*", "target", "+", "(", "1", "-", "alpha", ")", "*", "(", "1", "-", "target", ")", ")", "*", "weight", "\n", "weight", "=", "weight", "*", "pt", ".", "pow", "(", "gamma", ")", "\n", "loss", "=", "F", ".", "binary_cross_entropy_with_logits", "(", "pred", ",", "target", ",", "reduction", "=", "'none'", ")", "*", "weight", "\n", "# the value of reduction_enum is decided by arg 'reduction'", "\n", "# none: 0, mean:1, sum: 2", "\n", "# print(\"only compute the focal loss for negative examples\")", "\n", "reduction_enum", "=", "F", ".", "_Reduction", ".", "get_enum", "(", "reduction", ")", "\n", "if", "reduction_enum", "==", "0", ":", "\n", "        ", "return", "loss", "\n", "", "elif", "reduction_enum", "==", "1", ":", "\n", "        ", "return", "loss", ".", "mean", "(", ")", "\n", "", "elif", "reduction_enum", "==", "2", ":", "\n", "        ", "return", "loss", ".", "sum", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.weighted_sigmoid_focal_loss": [[279, 304], ["losses.py_sigmoid_focal_loss", "torch.sum().float().item", "torch.sum().float().item", "torch.sum().float", "torch.sum().float", "torch.sum", "torch.sum"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.py_sigmoid_focal_loss"], ["", "", "def", "weighted_sigmoid_focal_loss", "(", "pred", ",", "\n", "target", ",", "\n", "weight", ",", "\n", "gamma", "=", "2.0", ",", "\n", "alpha", "=", "0.25", ",", "\n", "avg_factor", "=", "None", ",", "\n", "num_classes", "=", "80", ")", ":", "\n", "    ", "\"\"\"\n    note that\n    :param pred: tensor of shape (batch*A*width*height, num_class)\n    :param target: tensor of shape (batch*A*width*height, num_class), only the element for the\n        positive labels are 1.\n    :param weight: tensor of shape (batch*A*width*height, num_class), 1 for pos and neg, 0 for the others\n    :param gamma:\n    :param alpha:\n    :param avg_factor:\n    :param num_classes:\n    :return:\n    \"\"\"", "\n", "if", "avg_factor", "is", "None", ":", "\n", "        ", "avg_factor", "=", "torch", ".", "sum", "(", "weight", ">", "0", ")", ".", "float", "(", ")", ".", "item", "(", ")", "/", "num_classes", "+", "1e-6", "\n", "\n", "", "return", "py_sigmoid_focal_loss", "(", "\n", "pred", ",", "target", ",", "weight", ",", "gamma", "=", "gamma", ",", "alpha", "=", "alpha", ",", "\n", "reduction", "=", "'sum'", ")", "[", "None", "]", "/", "avg_factor", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.iou_balanced_sigmoid_focal_loss": [[309, 375], ["target.type_as.type_as", "losses.py_sigmoid_focal_loss", "iou.view().expand", "normalized_iou_weights.detach.detach", "iou.view().expand", "iou.view().expand.new_ones", "torch.where", "torch.where", "iou_weights.detach.detach", "iou.view().expand.size", "torch.sum", "torch.sum", "iou.view", "target.type_as.size", "iou.view", "target.type_as.size"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.py_sigmoid_focal_loss"], ["", "def", "iou_balanced_sigmoid_focal_loss", "(", "pred", ",", "\n", "target", ",", "\n", "weight", ",", "\n", "iou", ",", "\n", "gamma", "=", "2.0", ",", "\n", "alpha", "=", "0.25", ",", "\n", "eta", "=", "1.5", ",", "\n", "avg_factor", "=", "None", ",", "\n", "num_classes", "=", "80", ")", ":", "\n", "    ", "\"\"\"\n\n    :param pred: tensor of shape (batch*A*width*height, num_class)\n    :param target: tensor of shape (batch*A*width*height, num_class), only the positive label is\n          assigned 1, 0 for others.\n    :param weight: tensor of shape (batch*A*width*height, num_class), 1 for pos and neg, 0 for the others.\n    :param iou: tensor of shape (batch*A*width*height), store the iou between predicted boxes and its\n          corresponding ground truth boxes for the positives and the iou between the predicted boxes and\n          anchors for negatives.\n    :param gamma:\n    :param alpha:\n    :param eta: control the suppression for the positives of low iou.\n    :param avg_factor: num_positive_samples. If None,\n    :param num_classes:\n    :return:\n    \"\"\"", "\n", "# if avg_factor is None:", "\n", "#     avg_factor = torch.sum(target).float().item() + 1e-6", "\n", "#     use_diff_thr = True", "\n", "# pred_sigmoid = pred.sigmoid()", "\n", "target", "=", "target", ".", "type_as", "(", "pred", ")", "\n", "\n", "loss1", "=", "py_sigmoid_focal_loss", "(", "\n", "pred", ",", "target", ",", "weight", ",", "gamma", "=", "gamma", ",", "alpha", "=", "alpha", ",", "\n", "reduction", "=", "'none'", ")", "\n", "\n", "IoU_balanced_Cls", "=", "True", "\n", "threshold", "=", "0.5", "\n", "if", "IoU_balanced_Cls", ":", "\n", "# compute the normalized weights so that the loss produced by the positive examples", "\n", "# doesn't change.", "\n", "        ", "iou_expanded", "=", "iou", ".", "view", "(", "-", "1", ",", "1", ")", ".", "expand", "(", "-", "1", ",", "target", ".", "size", "(", ")", "[", "1", "]", ")", "\n", "iou_weights", "=", "(", "1", "-", "target", ")", "+", "(", "target", "*", "iou_expanded", ")", ".", "pow", "(", "eta", ")", "\n", "# iou_weights = iou_weights.detach()", "\n", "loss2", "=", "loss1", "*", "iou_weights", "\n", "normalizer", "=", "(", "loss1", "*", "target", ")", ".", "sum", "(", ")", "/", "(", "(", "loss2", "*", "target", ")", ".", "sum", "(", ")", "+", "1e-6", ")", "\n", "# normalizer = 2.1", "\n", "normalized_iou_weights", "=", "(", "1", "-", "target", ")", "+", "(", "target", "*", "iou_expanded", ")", ".", "pow", "(", "eta", ")", "*", "normalizer", "\n", "normalized_iou_weights", "=", "normalized_iou_weights", ".", "detach", "(", ")", "\n", "\n", "loss", "=", "loss1", "*", "normalized_iou_weights", "\n", "# print('test')", "\n", "", "else", ":", "\n", "# consistent loss", "\n", "        ", "iou_expanded", "=", "iou", ".", "view", "(", "-", "1", ",", "1", ")", ".", "expand", "(", "-", "1", ",", "target", ".", "size", "(", ")", "[", "1", "]", ")", "\n", "ones_weight", "=", "iou_expanded", ".", "new_ones", "(", "iou_expanded", ".", "size", "(", ")", ")", "\n", "# print('ones_weight.size() is ', ones_weight.size())", "\n", "iou_weights_1", "=", "torch", ".", "where", "(", "iou_expanded", ">", "threshold", ",", "1.0", "+", "(", "iou_expanded", "-", "threshold", ")", ",", "ones_weight", ")", "\n", "# iou_weights = (1 - target) + (target * iou_weights_1).pow(eta)", "\n", "iou_weights", "=", "(", "1", "-", "target", ")", "+", "target", "*", "iou_weights_1", "\n", "iou_weights", "=", "iou_weights", ".", "detach", "(", ")", "\n", "# loss = loss1 * iou_weights", "\n", "balance_factor", "=", "0.6", "\n", "loss", "=", "loss1", "*", "balance_factor", "+", "loss1", "*", "iou_weights", "*", "(", "1", "-", "balance_factor", ")", "\n", "\n", "\n", "", "return", "torch", ".", "sum", "(", "loss", ")", "[", "None", "]", "/", "avg_factor", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.mask_cross_entropy": [[377, 383], ["torch.arange", "torch.arange", "pred[].squeeze", "pred.size", "torch.binary_cross_entropy_with_logits"], "function", ["None"], ["", "def", "mask_cross_entropy", "(", "pred", ",", "target", ",", "label", ")", ":", "\n", "    ", "num_rois", "=", "pred", ".", "size", "(", ")", "[", "0", "]", "\n", "inds", "=", "torch", ".", "arange", "(", "0", ",", "num_rois", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "pred", ".", "device", ")", "\n", "pred_slice", "=", "pred", "[", "inds", ",", "label", "]", ".", "squeeze", "(", "1", ")", "\n", "return", "F", ".", "binary_cross_entropy_with_logits", "(", "\n", "pred_slice", ",", "target", ",", "reduction", "=", "'mean'", ")", "[", "None", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.smooth_l1_loss": [[385, 400], ["torch.abs", "torch.abs", "torch.where", "torch.where", "torch._Reduction.get_enum", "pred.size", "target.size", "target.numel", "torch.where.sum", "pred.numel", "torch.where.sum"], "function", ["None"], ["", "def", "smooth_l1_loss", "(", "pred", ",", "target", ",", "beta", "=", "1.0", ",", "reduction", "=", "'mean'", ")", ":", "\n", "    ", "assert", "beta", ">", "0", "\n", "assert", "pred", ".", "size", "(", ")", "==", "target", ".", "size", "(", ")", "and", "target", ".", "numel", "(", ")", ">", "0", "\n", "diff", "=", "torch", ".", "abs", "(", "pred", "-", "target", ")", "\n", "loss", "=", "torch", ".", "where", "(", "diff", "<", "beta", ",", "0.5", "*", "diff", "*", "diff", "/", "beta", ",", "\n", "diff", "-", "0.5", "*", "beta", ")", "\n", "# the value of reduction_enum is decided by arg 'reduction'", "\n", "# none: 0, mean:1, sum: 2", "\n", "reduction_enum", "=", "F", ".", "_Reduction", ".", "get_enum", "(", "reduction", ")", "\n", "if", "reduction_enum", "==", "0", ":", "\n", "        ", "return", "loss", "\n", "", "elif", "reduction_enum", "==", "1", ":", "\n", "        ", "return", "loss", ".", "sum", "(", ")", "/", "pred", ".", "numel", "(", ")", "\n", "", "elif", "reduction_enum", "==", "2", ":", "\n", "        ", "return", "loss", ".", "sum", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.weighted_smoothl1": [[403, 412], ["losses.smooth_l1_loss", "torch.sum", "torch.sum", "torch.sum().float().item", "torch.sum().float().item", "torch.sum().float", "torch.sum().float", "torch.sum", "torch.sum"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.smooth_l1_loss"], ["", "", "def", "weighted_smoothl1", "(", "pred", ",", "target", ",", "weight", ",", "beta", "=", "1.0", ",", "avg_factor", "=", "None", ")", ":", "\n", "    ", "if", "avg_factor", "is", "None", ":", "\n", "        ", "avg_factor", "=", "torch", ".", "sum", "(", "weight", ">", "0", ")", ".", "float", "(", ")", ".", "item", "(", ")", "/", "4", "+", "1e-6", "\n", "", "loss", "=", "smooth_l1_loss", "(", "pred", ",", "target", ",", "beta", ",", "reduction", "=", "'none'", ")", "\n", "# print('the size of pred is ', pred.size())", "\n", "# print('the size of target is ', target.size())", "\n", "# print('the size of weight is', weight.size())", "\n", "\n", "return", "torch", ".", "sum", "(", "loss", "*", "weight", ")", "[", "None", "]", "/", "avg_factor", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.weighted_iou_balanced_smoothl1": [[416, 459], ["iou.view().expand", "iou_weight.detach.detach", "losses.smooth_l1_loss", "iou.new_zeros", "iou.new_zeros.view().expand", "iou.view().expand.pow", "pred.size", "target.size", "target.numel", "iou.size", "iou.view", "torch.sum", "torch.sum", "iou.new_zeros.view", "torch.sum().float().item", "torch.sum().float().item", "torch.sum().float", "torch.sum().float", "torch.sum", "torch.sum"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.smooth_l1_loss"], ["", "def", "weighted_iou_balanced_smoothl1", "(", "pred", ",", "target", ",", "iou", ",", "weight", ",", "beta", "=", "1.0", ",", "delta", "=", "1.5", ",", "avg_factor", "=", "None", ")", ":", "\n", "    ", "\"\"\"\n\n    :param pred: tensor of shape (batch*A*width*height, 4) or (batch*num_pos, 4)\n    :param target: tensor of shape (batch*A*width*height, 4), store the parametrized coordinates of target boxes\n          for the positive anchors and other values are set to be 0. Or tensor of shape (batch*num_pos, 4)\n    :param iou: tensor of shape (batch*A*width*height)Or tensor of shape (batch*num_pos), store the iou between\n          predicted boxes and its corresponding groundtruth boxes for the positives and the iou between the predicted\n          boxes and anchors for negatives.\n    :param weight: tensor of shape (batch*A*width*height, 4), only the weights for positive anchors are set to\n          be 1 and other values are set to be 0. Or tensor of shape (batch*num_pos, 4), all the elements are 1.\n    :param beta:\n    :param delta: control the suppression for the outliers.\n    :param avg_factor:\n    :return:\n    \"\"\"", "\n", "# the pred and target are transformed to image domain and represented by top-left and bottom-right corners.", "\n", "assert", "pred", ".", "size", "(", ")", "==", "target", ".", "size", "(", ")", "and", "target", ".", "numel", "(", ")", ">", "0", "\n", "# ignore the positive examples of which the iou after regression is smaller", "\n", "# than 0.5;", "\n", "ignore_outliers", "=", "False", "\n", "iou_threshold", "=", "0.5", "\n", "if", "ignore_outliers", ":", "\n", "        ", "filter", "=", "iou", ".", "new_zeros", "(", "iou", ".", "size", "(", ")", ")", "\n", "filter_extend", "=", "filter", ".", "view", "(", "-", "1", ",", "1", ")", ".", "expand", "(", "-", "1", ",", "4", ")", "\n", "ind", "=", "(", "iou", ">=", "iou_threshold", ")", ".", "nonzero", "(", ")", "\n", "filter", "[", "ind", "]", "=", "1", "\n", "iou", "=", "iou", "*", "filter", "\n", "\n", "", "iou_expanded", "=", "iou", ".", "view", "(", "-", "1", ",", "1", ")", ".", "expand", "(", "-", "1", ",", "4", ")", "\n", "\n", "iou_weight", "=", "weight", "*", "iou_expanded", ".", "pow", "(", "delta", ")", "\n", "iou_weight", "=", "iou_weight", ".", "detach", "(", ")", "\n", "\n", "\n", "if", "avg_factor", "is", "None", ":", "\n", "        ", "avg_factor", "=", "torch", ".", "sum", "(", "weight", ">", "0", ")", ".", "float", "(", ")", ".", "item", "(", ")", "/", "4", "+", "1e-6", "\n", "\n", "", "loss1", "=", "smooth_l1_loss", "(", "pred", ",", "target", ",", "beta", ",", "reduction", "=", "'none'", ")", "\n", "loss2", "=", "loss1", "*", "iou_weight", "\n", "# loss2 = loss1 *filter_extend", "\n", "\n", "return", "torch", ".", "sum", "(", "loss2", ")", "[", "None", "]", "/", "avg_factor", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.weighted_iou_regression_loss": [[460, 481], ["torch.binary_cross_entropy_with_logits", "torch.sum", "torch.sum"], "function", ["None"], ["", "def", "weighted_iou_regression_loss", "(", "iou_pred", ",", "iou_target", ",", "weight", ",", "avg_factor", "=", "None", ")", ":", "\n", "    ", "\"\"\"\n\n    :param iou_pred: tensor of shape (batch*A*width*height) or (batch*num_pos)\n    :param iou_target: tensor of shape (batch*A*width*height)Or tensor of shape (batch*num_pos), store the iou between\n          predicted boxes and its corresponding groundtruth boxes for the positives and the iou between the predicted\n          boxes and anchors for negatives.\n    :param weight: tensor of shape (batch*A*width*height) or (batch*num_pos), 1 for positives and 0 for negatives and neutrals.\n    :param avg_factor:\n    :return:\n    \"\"\"", "\n", "# iou_pred_sigmoid = iou_pred.sigmoid()", "\n", "# iou_target = iou_target.detach()", "\n", "\n", "# L2 loss.", "\n", "# loss = torch.pow((iou_pred_sigmoid - iou_target), 2)*weight", "\n", "\n", "# Binary cross-entropy loss for the positive examples", "\n", "loss", "=", "F", ".", "binary_cross_entropy_with_logits", "(", "iou_pred", ",", "iou_target", ",", "reduction", "=", "'none'", ")", "*", "weight", "\n", "\n", "return", "torch", ".", "sum", "(", "loss", ")", "[", "None", "]", "/", "avg_factor", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.balanced_l1_loss": [[482, 508], ["torch.abs", "torch.abs", "torch.where", "torch.where", "torch._Reduction.get_enum", "pred.size", "target.size", "target.numel", "torch.log", "torch.log", "torch.where.sum", "pred.numel", "torch.where.sum"], "function", ["None"], ["", "def", "balanced_l1_loss", "(", "pred", ",", "\n", "target", ",", "\n", "beta", "=", "1.0", ",", "\n", "alpha", "=", "0.5", ",", "\n", "gamma", "=", "1.5", ",", "\n", "reduction", "=", "'none'", ")", ":", "\n", "    ", "assert", "beta", ">", "0", "\n", "assert", "pred", ".", "size", "(", ")", "==", "target", ".", "size", "(", ")", "and", "target", ".", "numel", "(", ")", ">", "0", "\n", "\n", "diff", "=", "torch", ".", "abs", "(", "pred", "-", "target", ")", "\n", "b", "=", "np", ".", "e", "**", "(", "gamma", "/", "alpha", ")", "-", "1", "\n", "loss", "=", "torch", ".", "where", "(", "\n", "diff", "<", "beta", ",", "alpha", "/", "b", "*", "\n", "(", "b", "*", "diff", "+", "1", ")", "*", "torch", ".", "log", "(", "b", "*", "diff", "/", "beta", "+", "1", ")", "-", "alpha", "*", "diff", ",", "\n", "gamma", "*", "diff", "+", "gamma", "/", "b", "-", "alpha", "*", "beta", ")", "\n", "\n", "reduction_enum", "=", "F", ".", "_Reduction", ".", "get_enum", "(", "reduction", ")", "\n", "# none: 0, elementwise_mean:1, sum: 2", "\n", "if", "reduction_enum", "==", "0", ":", "\n", "        ", "return", "loss", "\n", "", "elif", "reduction_enum", "==", "1", ":", "\n", "        ", "return", "loss", ".", "sum", "(", ")", "/", "pred", ".", "numel", "(", ")", "\n", "", "elif", "reduction_enum", "==", "2", ":", "\n", "        ", "return", "loss", ".", "sum", "(", ")", "\n", "\n", "", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.weighted_balanced_l1_loss": [[510, 521], ["losses.balanced_l1_loss", "torch.sum", "torch.sum", "torch.sum().float().item", "torch.sum().float().item", "torch.sum().float", "torch.sum().float", "torch.sum", "torch.sum"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.balanced_l1_loss"], ["", "def", "weighted_balanced_l1_loss", "(", "pred", ",", "\n", "target", ",", "\n", "weight", ",", "\n", "beta", "=", "1.0", ",", "\n", "alpha", "=", "0.5", ",", "\n", "gamma", "=", "1.5", ",", "\n", "avg_factor", "=", "None", ")", ":", "\n", "    ", "if", "avg_factor", "is", "None", ":", "\n", "        ", "avg_factor", "=", "torch", ".", "sum", "(", "weight", ">", "0", ")", ".", "float", "(", ")", ".", "item", "(", ")", "/", "4", "+", "1e-6", "\n", "", "loss", "=", "balanced_l1_loss", "(", "pred", ",", "target", ",", "beta", ",", "alpha", ",", "gamma", ",", "reduction", "=", "'none'", ")", "\n", "return", "torch", ".", "sum", "(", "loss", "*", "weight", ")", "[", "None", "]", "/", "avg_factor", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.bounded_iou_loss": [[523, 570], ["torch.stack().view", "torch.stack().view", "torch.where", "torch.where", "torch._Reduction.get_enum", "torch.no_grad", "torch.no_grad", "torch.max", "torch.max", "torch.max", "torch.max", "torch.min", "torch.min", "torch.min", "torch.min", "loss_dx.size", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.stack", "torch.stack", "torch.where.sum", "pred.numel", "torch.where.sum", "dx.abs", "dy.abs", "dx.abs", "dy.abs"], "function", ["None"], ["", "def", "bounded_iou_loss", "(", "pred", ",", "target", ",", "beta", "=", "0.2", ",", "eps", "=", "1e-3", ",", "reduction", "=", "'mean'", ")", ":", "\n", "    ", "\"\"\"Improving Object Localization with Fitness NMS and Bounded IoU Loss,\n    https://arxiv.org/abs/1711.00164.\n\n    Args:\n        pred (tensor): Predicted bboxes.\n        target (tensor): Target bboxes.\n        beta (float): beta parameter in smoothl1.\n        eps (float): eps to avoid NaN.\n        reduction (str): Reduction type.\n    \"\"\"", "\n", "pred_ctrx", "=", "(", "pred", "[", ":", ",", "0", "]", "+", "pred", "[", ":", ",", "2", "]", ")", "*", "0.5", "\n", "pred_ctry", "=", "(", "pred", "[", ":", ",", "1", "]", "+", "pred", "[", ":", ",", "3", "]", ")", "*", "0.5", "\n", "pred_w", "=", "pred", "[", ":", ",", "2", "]", "-", "pred", "[", ":", ",", "0", "]", "+", "1", "\n", "pred_h", "=", "pred", "[", ":", ",", "3", "]", "-", "pred", "[", ":", ",", "1", "]", "+", "1", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "        ", "target_ctrx", "=", "(", "target", "[", ":", ",", "0", "]", "+", "target", "[", ":", ",", "2", "]", ")", "*", "0.5", "\n", "target_ctry", "=", "(", "target", "[", ":", ",", "1", "]", "+", "target", "[", ":", ",", "3", "]", ")", "*", "0.5", "\n", "target_w", "=", "target", "[", ":", ",", "2", "]", "-", "target", "[", ":", ",", "0", "]", "+", "1", "\n", "target_h", "=", "target", "[", ":", ",", "3", "]", "-", "target", "[", ":", ",", "1", "]", "+", "1", "\n", "\n", "", "dx", "=", "target_ctrx", "-", "pred_ctrx", "\n", "dy", "=", "target_ctry", "-", "pred_ctry", "\n", "\n", "loss_dx", "=", "1", "-", "torch", ".", "max", "(", "\n", "(", "target_w", "-", "2", "*", "dx", ".", "abs", "(", ")", ")", "/", "\n", "(", "target_w", "+", "2", "*", "dx", ".", "abs", "(", ")", "+", "eps", ")", ",", "torch", ".", "zeros_like", "(", "dx", ")", ")", "\n", "loss_dy", "=", "1", "-", "torch", ".", "max", "(", "\n", "(", "target_h", "-", "2", "*", "dy", ".", "abs", "(", ")", ")", "/", "\n", "(", "target_h", "+", "2", "*", "dy", ".", "abs", "(", ")", "+", "eps", ")", ",", "torch", ".", "zeros_like", "(", "dy", ")", ")", "\n", "loss_dw", "=", "1", "-", "torch", ".", "min", "(", "target_w", "/", "(", "pred_w", "+", "eps", ")", ",", "pred_w", "/", "\n", "(", "target_w", "+", "eps", ")", ")", "\n", "loss_dh", "=", "1", "-", "torch", ".", "min", "(", "target_h", "/", "(", "pred_h", "+", "eps", ")", ",", "pred_h", "/", "\n", "(", "target_h", "+", "eps", ")", ")", "\n", "loss_comb", "=", "torch", ".", "stack", "(", "[", "loss_dx", ",", "loss_dy", ",", "loss_dw", ",", "loss_dh", "]", ",", "\n", "dim", "=", "-", "1", ")", ".", "view", "(", "loss_dx", ".", "size", "(", "0", ")", ",", "-", "1", ")", "\n", "\n", "loss", "=", "torch", ".", "where", "(", "loss_comb", "<", "beta", ",", "0.5", "*", "loss_comb", "*", "loss_comb", "/", "beta", ",", "\n", "loss_comb", "-", "0.5", "*", "beta", ")", "\n", "reduction_enum", "=", "F", ".", "_Reduction", ".", "get_enum", "(", "reduction", ")", "\n", "# none: 0, mean:1, sum: 2", "\n", "if", "reduction_enum", "==", "0", ":", "\n", "        ", "return", "loss", "\n", "", "elif", "reduction_enum", "==", "1", ":", "\n", "        ", "return", "loss", ".", "sum", "(", ")", "/", "pred", ".", "numel", "(", ")", "\n", "", "elif", "reduction_enum", "==", "2", ":", "\n", "        ", "return", "loss", ".", "sum", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.weighted_iou_loss": [[572, 597], ["torch.nonzero", "torch.nonzero", "ValueError", "inds.squeeze.numel", "inds.squeeze.squeeze", "losses.bounded_iou_loss", "losses.iou_loss", "inds.squeeze.numel"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.bounded_iou_loss", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.iou_loss"], ["", "", "def", "weighted_iou_loss", "(", "pred", ",", "\n", "target", ",", "\n", "weight", ",", "\n", "style", "=", "'naive'", ",", "\n", "beta", "=", "0.2", ",", "\n", "eps", "=", "1e-3", ",", "\n", "avg_factor", "=", "None", ")", ":", "\n", "    ", "if", "style", "not", "in", "[", "'bounded'", ",", "'naive'", "]", ":", "\n", "        ", "raise", "ValueError", "(", "'Only support bounded iou loss and naive iou loss.'", ")", "\n", "", "inds", "=", "torch", ".", "nonzero", "(", "weight", "[", ":", ",", "0", "]", ">", "0", ")", "\n", "if", "avg_factor", "is", "None", ":", "\n", "        ", "avg_factor", "=", "inds", ".", "numel", "(", ")", "+", "1e-6", "\n", "\n", "", "if", "inds", ".", "numel", "(", ")", ">", "0", ":", "\n", "        ", "inds", "=", "inds", ".", "squeeze", "(", "1", ")", "\n", "", "else", ":", "\n", "        ", "return", "(", "pred", "*", "weight", ")", ".", "sum", "(", ")", "[", "None", "]", "/", "avg_factor", "\n", "\n", "", "if", "style", "==", "'bounded'", ":", "\n", "        ", "loss", "=", "bounded_iou_loss", "(", "\n", "pred", "[", "inds", "]", ",", "target", "[", "inds", "]", ",", "beta", "=", "beta", ",", "eps", "=", "eps", ",", "reduction", "=", "'sum'", ")", "\n", "", "else", ":", "\n", "        ", "loss", "=", "iou_loss", "(", "pred", "[", "inds", "]", ",", "target", "[", "inds", "]", ",", "reduction", "=", "'sum'", ")", "\n", "", "loss", "=", "loss", "[", "None", "]", "/", "avg_factor", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.accuracy": [[599, 624], ["isinstance", "max", "pred.topk", "pred_label.t.t", "pred_label.t.eq", "target.view().expand_as", "correct[].view().float().sum", "res.append", "correct[].view().float().sum.mul_", "target.view", "correct[].view().float", "pred.size", "correct[].view"], "function", ["None"], ["", "def", "accuracy", "(", "pred", ",", "target", ",", "topk", "=", "1", ")", ":", "\n", "    ", "\"\"\"\n\n    :param pred: (batch*num_sample, C)\n    :param target: (batch*num_sample)\n    :param topk:\n    :return:\n    \"\"\"", "\n", "\n", "if", "isinstance", "(", "topk", ",", "int", ")", ":", "\n", "        ", "topk", "=", "(", "topk", ",", ")", "\n", "return_single", "=", "True", "\n", "", "else", ":", "\n", "        ", "return_single", "=", "False", "\n", "\n", "", "maxk", "=", "max", "(", "topk", ")", "\n", "_", ",", "pred_label", "=", "pred", ".", "topk", "(", "maxk", ",", "1", ",", "True", ",", "True", ")", "# (batch*num_sample, 1)", "\n", "pred_label", "=", "pred_label", ".", "t", "(", ")", "# (1, batch*num_sample)", "\n", "correct", "=", "pred_label", ".", "eq", "(", "target", ".", "view", "(", "1", ",", "-", "1", ")", ".", "expand_as", "(", "pred_label", ")", ")", "# (1, batch*num_sample)", "\n", "\n", "res", "=", "[", "]", "\n", "for", "k", "in", "topk", ":", "\n", "        ", "correct_k", "=", "correct", "[", ":", "k", "]", ".", "view", "(", "-", "1", ")", ".", "float", "(", ")", ".", "sum", "(", "0", ",", "keepdim", "=", "True", ")", "\n", "res", ".", "append", "(", "correct_k", ".", "mul_", "(", "100.0", "/", "pred", ".", "size", "(", "0", ")", ")", ")", "\n", "", "return", "res", "[", "0", "]", "if", "return_single", "else", "res", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses._expand_binary_labels": [[626, 634], ["labels.new_full", "torch.nonzero().squeeze", "torch.nonzero().squeeze", "label_weights.view().expand", "torch.nonzero().squeeze.numel", "label_weights.size", "labels.size", "torch.nonzero", "torch.nonzero", "label_weights.view"], "function", ["None"], ["", "def", "_expand_binary_labels", "(", "labels", ",", "label_weights", ",", "label_channels", ")", ":", "\n", "    ", "bin_labels", "=", "labels", ".", "new_full", "(", "(", "labels", ".", "size", "(", "0", ")", ",", "label_channels", ")", ",", "0", ")", "\n", "inds", "=", "torch", ".", "nonzero", "(", "labels", ">=", "1", ")", ".", "squeeze", "(", ")", "\n", "if", "inds", ".", "numel", "(", ")", ">", "0", ":", "\n", "        ", "bin_labels", "[", "inds", ",", "labels", "[", "inds", "]", "-", "1", "]", "=", "1", "\n", "", "bin_label_weights", "=", "label_weights", ".", "view", "(", "-", "1", ",", "1", ")", ".", "expand", "(", "\n", "label_weights", ".", "size", "(", "0", ")", ",", "label_channels", ")", "\n", "return", "bin_labels", ",", "bin_label_weights", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loss.losses.iou_loss": [[636, 647], ["bbox.bbox_overlaps", "torch._Reduction.get_enum", "bbox.bbox_overlaps.log", "loss.mean", "loss.sum"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.bbox.geometry.bbox_overlaps"], ["", "def", "iou_loss", "(", "pred_bboxes", ",", "target_bboxes", ",", "reduction", "=", "'mean'", ")", ":", "\n", "    ", "ious", "=", "bbox_overlaps", "(", "pred_bboxes", ",", "target_bboxes", ",", "is_aligned", "=", "True", ")", "\n", "loss", "=", "-", "ious", ".", "log", "(", ")", "\n", "\n", "reduction_enum", "=", "F", ".", "_Reduction", ".", "get_enum", "(", "reduction", ")", "\n", "if", "reduction_enum", "==", "0", ":", "\n", "        ", "return", "loss", "\n", "", "elif", "reduction_enum", "==", "1", ":", "\n", "        ", "return", "loss", ".", "mean", "(", ")", "\n", "", "elif", "reduction_enum", "==", "2", ":", "\n", "        ", "return", "loss", ".", "sum", "(", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.coco_eval.main": [[6, 25], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args", "mmdet.core.coco_eval"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.parse_args", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.coco_eval"], ["def", "main", "(", ")", ":", "\n", "    ", "parser", "=", "ArgumentParser", "(", "description", "=", "'COCO Evaluation'", ")", "\n", "parser", ".", "add_argument", "(", "'result'", ",", "help", "=", "'result file path'", ")", "\n", "parser", ".", "add_argument", "(", "'--ann'", ",", "help", "=", "'annotation file path'", ")", "\n", "parser", ".", "add_argument", "(", "\n", "'--types'", ",", "\n", "type", "=", "str", ",", "\n", "nargs", "=", "'+'", ",", "\n", "choices", "=", "[", "'proposal_fast'", ",", "'proposal'", ",", "'bbox'", ",", "'segm'", ",", "'keypoint'", "]", ",", "\n", "default", "=", "[", "'bbox'", "]", ",", "\n", "help", "=", "'result types'", ")", "\n", "parser", ".", "add_argument", "(", "\n", "'--max-dets'", ",", "\n", "type", "=", "int", ",", "\n", "nargs", "=", "'+'", ",", "\n", "default", "=", "[", "100", ",", "300", ",", "1000", "]", ",", "\n", "help", "=", "'proposal numbers, only used for recall evaluation'", ")", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "coco_eval", "(", "args", ".", "result", ",", "args", ".", "types", ",", "args", ".", "ann", ",", "args", ".", "max_dets", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.voc_eval.voc_eval": [[10, 63], ["mmcv.load", "range", "mmdet.core.eval_map", "print", "print", "len", "dataset.get_ann_info", "gt_bboxes.append", "gt_labels.append", "hasattr", "mmdet.core.eval_map", "mean_ap_list.append", "numpy.concatenate", "gt_ignore.append", "numpy.vstack", "numpy.concatenate", "numpy.zeros", "numpy.ones"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.mean_ap.eval_map", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.augmentation_dataset.AugmentationDataset.get_ann_info", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.mean_ap.eval_map"], ["def", "voc_eval", "(", "result_file", ",", "dataset", ",", "iou_thr", "=", "0.5", ")", ":", "\n", "    ", "det_results", "=", "mmcv", ".", "load", "(", "result_file", ")", "\n", "gt_bboxes", "=", "[", "]", "\n", "gt_labels", "=", "[", "]", "\n", "gt_ignore", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "dataset", ")", ")", ":", "\n", "        ", "ann", "=", "dataset", ".", "get_ann_info", "(", "i", ")", "\n", "bboxes", "=", "ann", "[", "'bboxes'", "]", "\n", "labels", "=", "ann", "[", "'labels'", "]", "\n", "if", "'bboxes_ignore'", "in", "ann", ":", "\n", "            ", "ignore", "=", "np", ".", "concatenate", "(", "[", "\n", "np", ".", "zeros", "(", "bboxes", ".", "shape", "[", "0", "]", ",", "dtype", "=", "np", ".", "bool", ")", ",", "\n", "np", ".", "ones", "(", "ann", "[", "'bboxes_ignore'", "]", ".", "shape", "[", "0", "]", ",", "dtype", "=", "np", ".", "bool", ")", "\n", "]", ")", "\n", "gt_ignore", ".", "append", "(", "ignore", ")", "\n", "bboxes", "=", "np", ".", "vstack", "(", "[", "bboxes", ",", "ann", "[", "'bboxes_ignore'", "]", "]", ")", "\n", "labels", "=", "np", ".", "concatenate", "(", "[", "labels", ",", "ann", "[", "'labels_ignore'", "]", "]", ")", "\n", "", "gt_bboxes", ".", "append", "(", "bboxes", ")", "\n", "gt_labels", ".", "append", "(", "labels", ")", "\n", "", "if", "not", "gt_ignore", ":", "\n", "        ", "gt_ignore", "=", "gt_ignore", "\n", "", "if", "hasattr", "(", "dataset", ",", "'year'", ")", "and", "dataset", ".", "year", "==", "2007", ":", "\n", "        ", "dataset_name", "=", "'voc07'", "\n", "", "else", ":", "\n", "        ", "dataset_name", "=", "dataset", ".", "CLASSES", "\n", "", "eval_map", "(", "\n", "det_results", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "gt_ignore", "=", "gt_ignore", ",", "\n", "scale_ranges", "=", "None", ",", "\n", "iou_thr", "=", "iou_thr", ",", "\n", "dataset", "=", "dataset_name", ",", "\n", "print_summary", "=", "True", ")", "\n", "# added by WSK", "\n", "# this is added to compute the C0C0-style AP", "\n", "iou_thr_list", "=", "[", "0.5", ",", "0.55", ",", "0.60", ",", "0.65", ",", "0.70", ",", "0.75", ",", "0.80", ",", "0.85", ",", "0.90", ",", "0.95", "]", "\n", "mean_ap_list", "=", "[", "]", "\n", "ap_COCO", "=", "0", "\n", "for", "thr", "in", "iou_thr_list", ":", "\n", "        ", "mean_ap", ",", "eval_results", "=", "eval_map", "(", "\n", "det_results", ",", "\n", "gt_bboxes", ",", "\n", "gt_labels", ",", "\n", "gt_ignore", "=", "gt_ignore", ",", "\n", "scale_ranges", "=", "None", ",", "\n", "iou_thr", "=", "thr", ",", "\n", "dataset", "=", "dataset_name", ",", "\n", "print_summary", "=", "True", ")", "\n", "ap_COCO", "=", "ap_COCO", "+", "mean_ap", "*", "0.1", "\n", "mean_ap_list", ".", "append", "(", "mean_ap", ")", "\n", "", "print", "(", "'the ap_COCO is '", ",", "ap_COCO", ")", "\n", "print", "(", "'the mean_ap_list is '", ",", "mean_ap_list", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.voc_eval.main": [[68, 81], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args", "mmcv.Config.fromfile", "mmcv.runner.obj_from_dict", "voc_eval.voc_eval"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.parse_args", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.voc_eval.voc_eval"], ["", "def", "main", "(", ")", ":", "\n", "    ", "parser", "=", "ArgumentParser", "(", "description", "=", "'VOC Evaluation'", ")", "\n", "parser", ".", "add_argument", "(", "'result'", ",", "help", "=", "'result file path'", ")", "\n", "parser", ".", "add_argument", "(", "'config'", ",", "help", "=", "'config file path'", ")", "\n", "parser", ".", "add_argument", "(", "\n", "'--iou-thr'", ",", "\n", "type", "=", "float", ",", "\n", "default", "=", "0.5", ",", "\n", "help", "=", "'IoU threshold for evaluation'", ")", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "cfg", "=", "mmcv", ".", "Config", ".", "fromfile", "(", "args", ".", "config", ")", "\n", "test_dataset", "=", "mmcv", ".", "runner", ".", "obj_from_dict", "(", "cfg", ".", "data", ".", "test", ",", "datasets", ")", "\n", "voc_eval", "(", "args", ".", "result", ",", "test_dataset", ",", "args", ".", "iou_thr", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.publish_model.parse_args": [[6, 13], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.parse_args"], ["def", "parse_args", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", "\n", "description", "=", "'Process a checkpoint to be published'", ")", "\n", "parser", ".", "add_argument", "(", "'in_file'", ",", "help", "=", "'input checkpoint filename'", ")", "\n", "parser", ".", "add_argument", "(", "'out_file'", ",", "help", "=", "'output checkpoint filename'", ")", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "return", "args", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.publish_model.process_checkpoint": [[15, 26], ["torch.load", "torch.save", "subprocess.check_output().decode", "subprocess.Popen", "out_file.rstrip", "subprocess.check_output"], "function", ["None"], ["", "def", "process_checkpoint", "(", "in_file", ",", "out_file", ")", ":", "\n", "    ", "checkpoint", "=", "torch", ".", "load", "(", "in_file", ",", "map_location", "=", "'cpu'", ")", "\n", "# remove optimizer for smaller file size", "\n", "if", "'optimizer'", "in", "checkpoint", ":", "\n", "        ", "del", "checkpoint", "[", "'optimizer'", "]", "\n", "# if it is necessary to remove some sensitive data in checkpoint['meta'],", "\n", "# add the code here.", "\n", "", "torch", ".", "save", "(", "checkpoint", ",", "out_file", ")", "\n", "sha", "=", "subprocess", ".", "check_output", "(", "[", "'sha256sum'", ",", "out_file", "]", ")", ".", "decode", "(", ")", "\n", "final_file", "=", "out_file", ".", "rstrip", "(", "'.pth'", ")", "+", "'-{}.pth'", ".", "format", "(", "sha", "[", ":", "8", "]", ")", "\n", "subprocess", ".", "Popen", "(", "[", "'mv'", ",", "out_file", ",", "final_file", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.publish_model.main": [[28, 31], ["publish_model.parse_args", "publish_model.process_checkpoint"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.parse_args", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.publish_model.process_checkpoint"], ["", "def", "main", "(", ")", ":", "\n", "    ", "args", "=", "parse_args", "(", ")", "\n", "process_checkpoint", "(", "args", ".", "in_file", ",", "args", ".", "out_file", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.analyze_logs.cal_train_time": [[10, 32], ["enumerate", "print", "log_dict.keys", "numpy.array", "np.array.mean", "all_times.mean.argmax", "all_times.mean.argmin", "all_times.mean.std", "print", "print", "print", "print", "print", "np.array.append", "np.array.append", "numpy.mean"], "function", ["None"], ["def", "cal_train_time", "(", "log_dicts", ",", "args", ")", ":", "\n", "    ", "for", "i", ",", "log_dict", "in", "enumerate", "(", "log_dicts", ")", ":", "\n", "        ", "print", "(", "'{}Analyze train time of {}{}'", ".", "format", "(", "'-'", "*", "5", ",", "args", ".", "json_logs", "[", "i", "]", ",", "\n", "'-'", "*", "5", ")", ")", "\n", "all_times", "=", "[", "]", "\n", "for", "epoch", "in", "log_dict", ".", "keys", "(", ")", ":", "\n", "            ", "if", "args", ".", "include_outliers", ":", "\n", "                ", "all_times", ".", "append", "(", "log_dict", "[", "epoch", "]", "[", "'time'", "]", ")", "\n", "", "else", ":", "\n", "                ", "all_times", ".", "append", "(", "log_dict", "[", "epoch", "]", "[", "'time'", "]", "[", "1", ":", "]", ")", "\n", "", "", "all_times", "=", "np", ".", "array", "(", "all_times", ")", "\n", "epoch_ave_time", "=", "all_times", ".", "mean", "(", "-", "1", ")", "\n", "slowest_epoch", "=", "epoch_ave_time", ".", "argmax", "(", ")", "\n", "fastest_epoch", "=", "epoch_ave_time", ".", "argmin", "(", ")", "\n", "std_over_epoch", "=", "epoch_ave_time", ".", "std", "(", ")", "\n", "print", "(", "'slowest epoch {}, average time is {:.4f}'", ".", "format", "(", "\n", "slowest_epoch", "+", "1", ",", "epoch_ave_time", "[", "slowest_epoch", "]", ")", ")", "\n", "print", "(", "'fastest epoch {}, average time is {:.4f}'", ".", "format", "(", "\n", "fastest_epoch", "+", "1", ",", "epoch_ave_time", "[", "fastest_epoch", "]", ")", ")", "\n", "print", "(", "'time std over epochs is {:.4f}'", ".", "format", "(", "std_over_epoch", ")", ")", "\n", "print", "(", "'average iter time: {:.4f} s/iter'", ".", "format", "(", "np", ".", "mean", "(", "all_times", ")", ")", ")", "\n", "print", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.analyze_logs.plot_curve": [[34, 92], ["seaborn.set_style", "len", "enumerate", "matplotlib.switch_backend", "len", "list", "enumerate", "matplotlib.show", "print", "matplotlib.savefig", "matplotlib.cla", "len", "len", "log_dict.keys", "print", "matplotlib.legend", "matplotlib.title", "legend.append", "numpy.arange", "matplotlib.gca", "plt.gca.set_xticks", "matplotlib.xlabel", "matplotlib.plot", "numpy.concatenate", "numpy.concatenate", "matplotlib.xlabel", "matplotlib.plot", "np.concatenate.append", "np.concatenate.append", "max", "numpy.array", "numpy.array", "len"], "function", ["None"], ["", "", "def", "plot_curve", "(", "log_dicts", ",", "args", ")", ":", "\n", "    ", "if", "args", ".", "backend", "is", "not", "None", ":", "\n", "        ", "plt", ".", "switch_backend", "(", "args", ".", "backend", ")", "\n", "", "sns", ".", "set_style", "(", "args", ".", "style", ")", "\n", "# if legend is None, use {filename}_{key} as legend", "\n", "legend", "=", "args", ".", "legend", "\n", "if", "legend", "is", "None", ":", "\n", "        ", "legend", "=", "[", "]", "\n", "for", "json_log", "in", "args", ".", "json_logs", ":", "\n", "            ", "for", "metric", "in", "args", ".", "keys", ":", "\n", "                ", "legend", ".", "append", "(", "'{}_{}'", ".", "format", "(", "json_log", ",", "metric", ")", ")", "\n", "", "", "", "assert", "len", "(", "legend", ")", "==", "(", "len", "(", "args", ".", "json_logs", ")", "*", "len", "(", "args", ".", "keys", ")", ")", "\n", "metrics", "=", "args", ".", "keys", "\n", "\n", "num_metrics", "=", "len", "(", "metrics", ")", "\n", "for", "i", ",", "log_dict", "in", "enumerate", "(", "log_dicts", ")", ":", "\n", "        ", "epochs", "=", "list", "(", "log_dict", ".", "keys", "(", ")", ")", "\n", "for", "j", ",", "metric", "in", "enumerate", "(", "metrics", ")", ":", "\n", "            ", "print", "(", "'plot curve of {}, metric is {}'", ".", "format", "(", "\n", "args", ".", "json_logs", "[", "i", "]", ",", "metric", ")", ")", "\n", "assert", "metric", "in", "log_dict", "[", "epochs", "[", "\n", "0", "]", "]", ",", "'{} does not contain metric {}'", ".", "format", "(", "\n", "args", ".", "json_logs", "[", "i", "]", ",", "metric", ")", "\n", "\n", "if", "'mAP'", "in", "metric", ":", "\n", "                ", "xs", "=", "np", ".", "arange", "(", "1", ",", "max", "(", "epochs", ")", "+", "1", ")", "\n", "ys", "=", "[", "]", "\n", "for", "epoch", "in", "epochs", ":", "\n", "                    ", "ys", "+=", "log_dict", "[", "epoch", "]", "[", "metric", "]", "\n", "", "ax", "=", "plt", ".", "gca", "(", ")", "\n", "ax", ".", "set_xticks", "(", "xs", ")", "\n", "plt", ".", "xlabel", "(", "'epoch'", ")", "\n", "plt", ".", "plot", "(", "xs", ",", "ys", ",", "label", "=", "legend", "[", "i", "*", "num_metrics", "+", "j", "]", ",", "marker", "=", "'o'", ")", "\n", "", "else", ":", "\n", "                ", "xs", "=", "[", "]", "\n", "ys", "=", "[", "]", "\n", "num_iters_per_epoch", "=", "log_dict", "[", "epochs", "[", "0", "]", "]", "[", "'iter'", "]", "[", "-", "1", "]", "\n", "for", "epoch", "in", "epochs", ":", "\n", "                    ", "iters", "=", "log_dict", "[", "epoch", "]", "[", "'iter'", "]", "\n", "if", "log_dict", "[", "epoch", "]", "[", "'mode'", "]", "[", "-", "1", "]", "==", "'val'", ":", "\n", "                        ", "iters", "=", "iters", "[", ":", "-", "1", "]", "\n", "", "xs", ".", "append", "(", "\n", "np", ".", "array", "(", "iters", ")", "+", "(", "epoch", "-", "1", ")", "*", "num_iters_per_epoch", ")", "\n", "ys", ".", "append", "(", "np", ".", "array", "(", "log_dict", "[", "epoch", "]", "[", "metric", "]", "[", ":", "len", "(", "iters", ")", "]", ")", ")", "\n", "", "xs", "=", "np", ".", "concatenate", "(", "xs", ")", "\n", "ys", "=", "np", ".", "concatenate", "(", "ys", ")", "\n", "plt", ".", "xlabel", "(", "'iter'", ")", "\n", "plt", ".", "plot", "(", "\n", "xs", ",", "ys", ",", "label", "=", "legend", "[", "i", "*", "num_metrics", "+", "j", "]", ",", "linewidth", "=", "0.5", ")", "\n", "", "plt", ".", "legend", "(", ")", "\n", "", "if", "args", ".", "title", "is", "not", "None", ":", "\n", "            ", "plt", ".", "title", "(", "args", ".", "title", ")", "\n", "", "", "if", "args", ".", "out", "is", "None", ":", "\n", "        ", "plt", ".", "show", "(", ")", "\n", "", "else", ":", "\n", "        ", "print", "(", "'save curve to: {}'", ".", "format", "(", "args", ".", "out", ")", ")", "\n", "plt", ".", "savefig", "(", "args", ".", "out", ")", "\n", "plt", ".", "cla", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.analyze_logs.add_plot_parser": [[94, 120], ["subparsers.add_parser", "subparsers.add_parser.add_argument", "subparsers.add_parser.add_argument", "subparsers.add_parser.add_argument", "subparsers.add_parser.add_argument", "subparsers.add_parser.add_argument", "subparsers.add_parser.add_argument", "subparsers.add_parser.add_argument"], "function", ["None"], ["", "", "def", "add_plot_parser", "(", "subparsers", ")", ":", "\n", "    ", "parser_plt", "=", "subparsers", ".", "add_parser", "(", "\n", "'plot_curve'", ",", "help", "=", "'parser for plotting curves'", ")", "\n", "parser_plt", ".", "add_argument", "(", "\n", "'json_logs'", ",", "\n", "type", "=", "str", ",", "\n", "nargs", "=", "'+'", ",", "\n", "help", "=", "'path of train log in json format'", ")", "\n", "parser_plt", ".", "add_argument", "(", "\n", "'--keys'", ",", "\n", "type", "=", "str", ",", "\n", "nargs", "=", "'+'", ",", "\n", "default", "=", "[", "'bbox_mAP'", "]", ",", "\n", "help", "=", "'the metric that you want to plot'", ")", "\n", "parser_plt", ".", "add_argument", "(", "'--title'", ",", "type", "=", "str", ",", "help", "=", "'title of figure'", ")", "\n", "parser_plt", ".", "add_argument", "(", "\n", "'--legend'", ",", "\n", "type", "=", "str", ",", "\n", "nargs", "=", "'+'", ",", "\n", "default", "=", "None", ",", "\n", "help", "=", "'legend of each plot'", ")", "\n", "parser_plt", ".", "add_argument", "(", "\n", "'--backend'", ",", "type", "=", "str", ",", "default", "=", "None", ",", "help", "=", "'backend of plt'", ")", "\n", "parser_plt", ".", "add_argument", "(", "\n", "'--style'", ",", "type", "=", "str", ",", "default", "=", "'dark'", ",", "help", "=", "'style of plt'", ")", "\n", "parser_plt", ".", "add_argument", "(", "'--out'", ",", "type", "=", "str", ",", "default", "=", "None", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.analyze_logs.add_time_parser": [[122, 135], ["subparsers.add_parser", "subparsers.add_parser.add_argument", "subparsers.add_parser.add_argument"], "function", ["None"], ["", "def", "add_time_parser", "(", "subparsers", ")", ":", "\n", "    ", "parser_time", "=", "subparsers", ".", "add_parser", "(", "\n", "'cal_train_time'", ",", "\n", "help", "=", "'parser for computing the average time per training iteration'", ")", "\n", "parser_time", ".", "add_argument", "(", "\n", "'json_logs'", ",", "\n", "type", "=", "str", ",", "\n", "nargs", "=", "'+'", ",", "\n", "help", "=", "'path of train log in json format'", ")", "\n", "parser_time", ".", "add_argument", "(", "\n", "'--include-outliers'", ",", "\n", "action", "=", "'store_true'", ",", "\n", "help", "=", "'include the first value of every epoch when computing '", "\n", "'the average time'", ")", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.analyze_logs.parse_args": [[138, 146], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_subparsers", "analyze_logs.add_plot_parser", "analyze_logs.add_time_parser", "argparse.ArgumentParser.parse_args"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.analyze_logs.add_plot_parser", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.analyze_logs.add_time_parser", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.parse_args"], ["", "def", "parse_args", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", "description", "=", "'Analyze Json Log'", ")", "\n", "# currently only support plot curve and calculate average train time", "\n", "subparsers", "=", "parser", ".", "add_subparsers", "(", "dest", "=", "'task'", ",", "help", "=", "'task parser'", ")", "\n", "add_plot_parser", "(", "subparsers", ")", "\n", "add_time_parser", "(", "subparsers", ")", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "return", "args", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.analyze_logs.load_json_logs": [[148, 163], ["zip", "dict", "open", "json.loads", "json.loads.pop", "json.loads.items", "l.strip", "collections.defaultdict", "[].append"], "function", ["None"], ["", "def", "load_json_logs", "(", "json_logs", ")", ":", "\n", "# load and convert json_logs to log_dict, key is epoch, value is a sub dict", "\n", "# keys of sub dict is different metrics, e.g. memory, bbox_mAP", "\n", "# value of sub dict is a list of corresponding values of all iterations", "\n", "    ", "log_dicts", "=", "[", "dict", "(", ")", "for", "_", "in", "json_logs", "]", "\n", "for", "json_log", ",", "log_dict", "in", "zip", "(", "json_logs", ",", "log_dicts", ")", ":", "\n", "        ", "with", "open", "(", "json_log", ",", "'r'", ")", "as", "log_file", ":", "\n", "            ", "for", "l", "in", "log_file", ":", "\n", "                ", "log", "=", "json", ".", "loads", "(", "l", ".", "strip", "(", ")", ")", "\n", "epoch", "=", "log", ".", "pop", "(", "'epoch'", ")", "\n", "if", "epoch", "not", "in", "log_dict", ":", "\n", "                    ", "log_dict", "[", "epoch", "]", "=", "defaultdict", "(", "list", ")", "\n", "", "for", "k", ",", "v", "in", "log", ".", "items", "(", ")", ":", "\n", "                    ", "log_dict", "[", "epoch", "]", "[", "k", "]", ".", "append", "(", "v", ")", "\n", "", "", "", "", "return", "log_dicts", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.analyze_logs.main": [[165, 175], ["analyze_logs.parse_args", "analyze_logs.load_json_logs", "json_log.endswith", "eval"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.parse_args", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.analyze_logs.load_json_logs"], ["", "def", "main", "(", ")", ":", "\n", "    ", "args", "=", "parse_args", "(", ")", "\n", "\n", "json_logs", "=", "args", ".", "json_logs", "\n", "for", "json_log", "in", "json_logs", ":", "\n", "        ", "assert", "json_log", ".", "endswith", "(", "'.json'", ")", "\n", "\n", "", "log_dicts", "=", "load_json_logs", "(", "json_logs", ")", "\n", "\n", "eval", "(", "args", ".", "task", ")", "(", "log_dicts", ",", "args", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.train.parse_args": [[14, 40], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.parse_args"], ["from", "mmdet", ".", "models", "import", "RPN", "\n", "from", ".", "env", "import", "get_root_logger", "\n", "\n", "\n", "def", "parse_losses", "(", "losses", ")", ":", "\n", "    ", "log_vars", "=", "OrderedDict", "(", ")", "\n", "for", "loss_name", ",", "loss_value", "in", "losses", ".", "items", "(", ")", ":", "\n", "        ", "if", "isinstance", "(", "loss_value", ",", "torch", ".", "Tensor", ")", ":", "\n", "            ", "log_vars", "[", "loss_name", "]", "=", "loss_value", ".", "mean", "(", ")", "\n", "", "elif", "isinstance", "(", "loss_value", ",", "list", ")", ":", "\n", "            ", "log_vars", "[", "loss_name", "]", "=", "sum", "(", "_loss", ".", "mean", "(", ")", "for", "_loss", "in", "loss_value", ")", "\n", "", "else", ":", "\n", "            ", "raise", "TypeError", "(", "\n", "'{} is not a tensor or list of tensors'", ".", "format", "(", "loss_name", ")", ")", "\n", "\n", "", "", "loss", "=", "sum", "(", "_value", "for", "_key", ",", "_value", "in", "log_vars", ".", "items", "(", ")", "if", "'loss'", "in", "_key", ")", "\n", "\n", "log_vars", "[", "'loss'", "]", "=", "loss", "\n", "for", "name", "in", "log_vars", ":", "\n", "        ", "log_vars", "[", "name", "]", "=", "log_vars", "[", "name", "]", ".", "item", "(", ")", "\n", "\n", "", "return", "loss", ",", "log_vars", "\n", "\n", "\n", "", "def", "batch_processor", "(", "model", ",", "data", ",", "train_mode", ")", ":", "\n", "    ", "losses", "=", "model", "(", "**", "data", ")", "\n", "loss", ",", "log_vars", "=", "parse_losses", "(", "losses", ")", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.train.main": [[42, 92], ["train.parse_args", "mmcv.Config.fromfile", "Config.fromfile.get", "mmdet.apis.get_root_logger", "mmdet.apis.get_root_logger.info", "mmdet.models.build_detector", "mmdet.datasets.get_dataset", "mmdet.apis.train_detector", "mmdet.apis.init_dist", "mmdet.apis.get_root_logger.info", "mmdet.apis.set_random_seed", "dict"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.parse_args", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.env.get_root_logger", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_detector", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.utils.get_dataset", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.train.train_detector", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.env.init_dist", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.env.set_random_seed"], ["outputs", "=", "dict", "(", "\n", "loss", "=", "loss", ",", "log_vars", "=", "log_vars", ",", "num_samples", "=", "len", "(", "data", "[", "'img'", "]", ".", "data", ")", ")", "\n", "\n", "return", "outputs", "\n", "\n", "\n", "", "def", "train_detector", "(", "model", ",", "\n", "dataset", ",", "\n", "cfg", ",", "\n", "distributed", "=", "False", ",", "\n", "validate", "=", "False", ",", "\n", "logger", "=", "None", ")", ":", "\n", "    ", "if", "logger", "is", "None", ":", "\n", "        ", "logger", "=", "get_root_logger", "(", "cfg", ".", "log_level", ")", "\n", "\n", "# start training", "\n", "", "if", "distributed", ":", "\n", "        ", "_dist_train", "(", "model", ",", "dataset", ",", "cfg", ",", "validate", "=", "validate", ")", "\n", "", "else", ":", "\n", "        ", "_non_dist_train", "(", "model", ",", "dataset", ",", "cfg", ",", "validate", "=", "validate", ")", "\n", "\n", "\n", "", "", "def", "build_optimizer", "(", "model", ",", "optimizer_cfg", ")", ":", "\n", "    ", "\"\"\"Build optimizer from configs.\n\n    Args:\n        model (:obj:`nn.Module`): The model with parameters to be optimized.\n        optimizer_cfg (dict): The config dict of the optimizer.\n            Positional fields are:\n                - type: class name of the optimizer.\n                - lr: base learning rate.\n            Optional fields are:\n                - any arguments of the corresponding optimizer type, e.g.,\n                  weight_decay, momentum, etc.\n                - paramwise_options: a dict with 3 accepted fileds\n                  (bias_lr_mult, bias_decay_mult, norm_decay_mult).\n                  `bias_lr_mult` and `bias_decay_mult` will be multiplied to\n                  the lr and weight decay respectively for all bias parameters\n                  (except for the normalization layers), and\n                  `norm_decay_mult` will be multiplied to the weight decay\n                  for all weight and bias parameters of normalization layers.\n\n    Returns:\n        torch.optim.Optimizer: The initialized optimizer.\n    \"\"\"", "\n", "if", "hasattr", "(", "model", ",", "'module'", ")", ":", "\n", "        ", "model", "=", "model", ".", "module", "\n", "\n", "", "optimizer_cfg", "=", "optimizer_cfg", ".", "copy", "(", ")", "\n", "paramwise_options", "=", "optimizer_cfg", ".", "pop", "(", "'paramwise_options'", ",", "None", ")", "\n", "# if no paramwise option is specified, just use the global setting", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.detectron2pytorch.convert_bn": [[10, 21], ["torch.from_numpy", "torch.from_numpy", "state_dict[].size", "torch.zeros", "torch.ones", "converted_names.add", "converted_names.add"], "function", ["None"], ["def", "convert_bn", "(", "blobs", ",", "state_dict", ",", "caffe_name", ",", "torch_name", ",", "converted_names", ")", ":", "\n", "# detectron replace bn with affine channel layer", "\n", "    ", "state_dict", "[", "torch_name", "+", "'.bias'", "]", "=", "torch", ".", "from_numpy", "(", "blobs", "[", "caffe_name", "+", "\n", "'_b'", "]", ")", "\n", "state_dict", "[", "torch_name", "+", "'.weight'", "]", "=", "torch", ".", "from_numpy", "(", "blobs", "[", "caffe_name", "+", "\n", "'_s'", "]", ")", "\n", "bn_size", "=", "state_dict", "[", "torch_name", "+", "'.weight'", "]", ".", "size", "(", ")", "\n", "state_dict", "[", "torch_name", "+", "'.running_mean'", "]", "=", "torch", ".", "zeros", "(", "bn_size", ")", "\n", "state_dict", "[", "torch_name", "+", "'.running_var'", "]", "=", "torch", ".", "ones", "(", "bn_size", ")", "\n", "converted_names", ".", "add", "(", "caffe_name", "+", "'_b'", ")", "\n", "converted_names", ".", "add", "(", "caffe_name", "+", "'_s'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.detectron2pytorch.convert_conv_fc": [[23, 32], ["torch.from_numpy", "converted_names.add", "torch.from_numpy", "converted_names.add"], "function", ["None"], ["", "def", "convert_conv_fc", "(", "blobs", ",", "state_dict", ",", "caffe_name", ",", "torch_name", ",", "\n", "converted_names", ")", ":", "\n", "    ", "state_dict", "[", "torch_name", "+", "'.weight'", "]", "=", "torch", ".", "from_numpy", "(", "blobs", "[", "caffe_name", "+", "\n", "'_w'", "]", ")", "\n", "converted_names", ".", "add", "(", "caffe_name", "+", "'_w'", ")", "\n", "if", "caffe_name", "+", "'_b'", "in", "blobs", ":", "\n", "        ", "state_dict", "[", "torch_name", "+", "'.bias'", "]", "=", "torch", ".", "from_numpy", "(", "blobs", "[", "caffe_name", "+", "\n", "'_b'", "]", ")", "\n", "converted_names", ".", "add", "(", "caffe_name", "+", "'_b'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.detectron2pytorch.convert": [[34, 76], ["mmcv.load", "collections.OrderedDict", "set", "detectron2pytorch.convert_conv_fc", "detectron2pytorch.convert_bn", "range", "dict", "torch.save", "ValueError", "range", "len", "enumerate", "print", "detectron2pytorch.convert_conv_fc", "detectron2pytorch.convert_bn", "detectron2pytorch.convert_conv_fc", "detectron2pytorch.convert_bn"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.detectron2pytorch.convert_conv_fc", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.detectron2pytorch.convert_bn", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.detectron2pytorch.convert_conv_fc", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.detectron2pytorch.convert_bn", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.detectron2pytorch.convert_conv_fc", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.detectron2pytorch.convert_bn"], ["", "", "def", "convert", "(", "src", ",", "dst", ",", "depth", ")", ":", "\n", "    ", "\"\"\"Convert keys in detectron pretrained ResNet models to pytorch style.\"\"\"", "\n", "# load arch_settings", "\n", "if", "depth", "not", "in", "arch_settings", ":", "\n", "        ", "raise", "ValueError", "(", "'Only support ResNet-50 and ResNet-101 currently'", ")", "\n", "", "block_nums", "=", "arch_settings", "[", "depth", "]", "\n", "# load caffe model", "\n", "caffe_model", "=", "mmcv", ".", "load", "(", "src", ",", "encoding", "=", "'latin1'", ")", "\n", "blobs", "=", "caffe_model", "[", "'blobs'", "]", "if", "'blobs'", "in", "caffe_model", "else", "caffe_model", "\n", "# convert to pytorch style", "\n", "state_dict", "=", "OrderedDict", "(", ")", "\n", "converted_names", "=", "set", "(", ")", "\n", "convert_conv_fc", "(", "blobs", ",", "state_dict", ",", "'conv1'", ",", "'conv1'", ",", "converted_names", ")", "\n", "convert_bn", "(", "blobs", ",", "state_dict", ",", "'res_conv1_bn'", ",", "'bn1'", ",", "converted_names", ")", "\n", "for", "i", "in", "range", "(", "1", ",", "len", "(", "block_nums", ")", "+", "1", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "block_nums", "[", "i", "-", "1", "]", ")", ":", "\n", "            ", "if", "j", "==", "0", ":", "\n", "                ", "convert_conv_fc", "(", "blobs", ",", "state_dict", ",", "\n", "'res{}_{}_branch1'", ".", "format", "(", "i", "+", "1", ",", "j", ")", ",", "\n", "'layer{}.{}.downsample.0'", ".", "format", "(", "i", ",", "j", ")", ",", "\n", "converted_names", ")", "\n", "convert_bn", "(", "blobs", ",", "state_dict", ",", "\n", "'res{}_{}_branch1_bn'", ".", "format", "(", "i", "+", "1", ",", "j", ")", ",", "\n", "'layer{}.{}.downsample.1'", ".", "format", "(", "i", ",", "j", ")", ",", "\n", "converted_names", ")", "\n", "", "for", "k", ",", "letter", "in", "enumerate", "(", "[", "'a'", ",", "'b'", ",", "'c'", "]", ")", ":", "\n", "                ", "convert_conv_fc", "(", "blobs", ",", "state_dict", ",", "\n", "'res{}_{}_branch2{}'", ".", "format", "(", "i", "+", "1", ",", "j", ",", "letter", ")", ",", "\n", "'layer{}.{}.conv{}'", ".", "format", "(", "i", ",", "j", ",", "k", "+", "1", ")", ",", "\n", "converted_names", ")", "\n", "convert_bn", "(", "blobs", ",", "state_dict", ",", "\n", "'res{}_{}_branch2{}_bn'", ".", "format", "(", "i", "+", "1", ",", "j", ",", "letter", ")", ",", "\n", "'layer{}.{}.bn{}'", ".", "format", "(", "i", ",", "j", ",", "\n", "k", "+", "1", ")", ",", "converted_names", ")", "\n", "# check if all layers are converted", "\n", "", "", "", "for", "key", "in", "blobs", ":", "\n", "        ", "if", "key", "not", "in", "converted_names", ":", "\n", "            ", "print", "(", "'Not Convert: {}'", ".", "format", "(", "key", ")", ")", "\n", "# save checkpoint", "\n", "", "", "checkpoint", "=", "dict", "(", ")", "\n", "checkpoint", "[", "'state_dict'", "]", "=", "state_dict", "\n", "torch", ".", "save", "(", "checkpoint", ",", "dst", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.detectron2pytorch.main": [[78, 85], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args", "detectron2pytorch.convert"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.parse_args", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.upgrade_model_version.convert"], ["", "def", "main", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", "description", "=", "'Convert model keys'", ")", "\n", "parser", ".", "add_argument", "(", "'src'", ",", "help", "=", "'src detectron model path'", ")", "\n", "parser", ".", "add_argument", "(", "'dst'", ",", "help", "=", "'save path'", ")", "\n", "parser", ".", "add_argument", "(", "'depth'", ",", "type", "=", "int", ",", "help", "=", "'ResNet model depth'", ")", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "convert", "(", "args", ".", "src", ",", "args", ".", "dst", ",", "args", ".", "depth", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.test.single_gpu_test": [[18, 35], ["model.eval", "mmcv.ProgressBar", "enumerate", "len", "results.append", "[].size", "range", "torch.no_grad", "torch.no_grad", "model", "model.module.show_result", "mmcv.ProgressBar.update"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.detectors.cascade_rcnn.CascadeRCNN.show_result"], ["def", "single_gpu_test", "(", "model", ",", "data_loader", ",", "show", "=", "False", ")", ":", "\n", "    ", "model", ".", "eval", "(", ")", "\n", "results", "=", "[", "]", "\n", "dataset", "=", "data_loader", ".", "dataset", "\n", "prog_bar", "=", "mmcv", ".", "ProgressBar", "(", "len", "(", "dataset", ")", ")", "\n", "for", "i", ",", "data", "in", "enumerate", "(", "data_loader", ")", ":", "\n", "        ", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "result", "=", "model", "(", "return_loss", "=", "False", ",", "rescale", "=", "not", "show", ",", "**", "data", ")", "\n", "", "results", ".", "append", "(", "result", ")", "\n", "\n", "if", "show", ":", "\n", "            ", "model", ".", "module", ".", "show_result", "(", "data", ",", "result", ",", "dataset", ".", "img_norm_cfg", ")", "\n", "\n", "", "batch_size", "=", "data", "[", "'img'", "]", "[", "0", "]", ".", "size", "(", "0", ")", "\n", "for", "_", "in", "range", "(", "batch_size", ")", ":", "\n", "            ", "prog_bar", ".", "update", "(", ")", "\n", "", "", "return", "results", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.test.multi_gpu_test": [[37, 61], ["model.eval", "mmcv.runner.get_dist_info", "enumerate", "test.collect_results", "mmcv.ProgressBar", "collect_results.append", "len", "len", "torch.no_grad", "torch.no_grad", "model", "[].size", "range", "mmcv.ProgressBar.update"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.test.collect_results"], ["", "def", "multi_gpu_test", "(", "model", ",", "data_loader", ",", "tmpdir", "=", "None", ")", ":", "\n", "    ", "model", ".", "eval", "(", ")", "\n", "results", "=", "[", "]", "\n", "dataset", "=", "data_loader", ".", "dataset", "\n", "rank", ",", "world_size", "=", "get_dist_info", "(", ")", "\n", "if", "rank", "==", "0", ":", "\n", "        ", "prog_bar", "=", "mmcv", ".", "ProgressBar", "(", "len", "(", "dataset", ")", ")", "\n", "", "for", "i", ",", "data", "in", "enumerate", "(", "data_loader", ")", ":", "\n", "        ", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "# the data provide the img or annotation information and  is", "\n", "# decided by CustomDataset.prepare_train_img or prepare_test_img", "\n", "            ", "result", "=", "model", "(", "return_loss", "=", "False", ",", "rescale", "=", "True", ",", "**", "data", ")", "\n", "# result = model(return_loss=True, **data)", "\n", "", "results", ".", "append", "(", "result", ")", "\n", "\n", "if", "rank", "==", "0", ":", "\n", "            ", "batch_size", "=", "data", "[", "'img'", "]", "[", "0", "]", ".", "size", "(", "0", ")", "\n", "for", "_", "in", "range", "(", "batch_size", "*", "world_size", ")", ":", "\n", "                ", "prog_bar", ".", "update", "(", ")", "\n", "\n", "# collect results from all ranks", "\n", "", "", "", "results", "=", "collect_results", "(", "results", ",", "len", "(", "dataset", ")", ",", "tmpdir", ")", "\n", "\n", "return", "results", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.test.collect_results": [[63, 103], ["mmcv.runner.get_dist_info", "mmcv.dump", "torch.barrier", "torch.full", "torch.full", "torch.broadcast", "torch.full.cpu().numpy().tobytes().decode().rstrip", "mmcv.mkdir_or_exist", "os.join", "range", "zip", "shutil.rmtree", "tempfile.mkdtemp", "torch.tensor", "torch.tensor", "os.join", "part_list.append", "ordered_results.extend", "bytearray", "torch.full.cpu().numpy().tobytes().decode", "mmcv.load", "list", "torch.tensor.encode", "len", "torch.full.cpu().numpy().tobytes", "torch.full.cpu().numpy", "torch.full.cpu"], "function", ["None"], ["", "def", "collect_results", "(", "result_part", ",", "size", ",", "tmpdir", "=", "None", ")", ":", "\n", "    ", "rank", ",", "world_size", "=", "get_dist_info", "(", ")", "\n", "# create a tmp dir if it is not specified", "\n", "if", "tmpdir", "is", "None", ":", "\n", "        ", "MAX_LEN", "=", "512", "\n", "# 32 is whitespace", "\n", "dir_tensor", "=", "torch", ".", "full", "(", "(", "MAX_LEN", ",", ")", ",", "\n", "32", ",", "\n", "dtype", "=", "torch", ".", "uint8", ",", "\n", "device", "=", "'cuda'", ")", "\n", "if", "rank", "==", "0", ":", "\n", "            ", "tmpdir", "=", "tempfile", ".", "mkdtemp", "(", ")", "\n", "tmpdir", "=", "torch", ".", "tensor", "(", "\n", "bytearray", "(", "tmpdir", ".", "encode", "(", ")", ")", ",", "dtype", "=", "torch", ".", "uint8", ",", "device", "=", "'cuda'", ")", "\n", "dir_tensor", "[", ":", "len", "(", "tmpdir", ")", "]", "=", "tmpdir", "\n", "", "dist", ".", "broadcast", "(", "dir_tensor", ",", "0", ")", "\n", "tmpdir", "=", "dir_tensor", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ".", "tobytes", "(", ")", ".", "decode", "(", ")", ".", "rstrip", "(", ")", "\n", "", "else", ":", "\n", "        ", "mmcv", ".", "mkdir_or_exist", "(", "tmpdir", ")", "\n", "# dump the part result to the dir", "\n", "", "mmcv", ".", "dump", "(", "result_part", ",", "osp", ".", "join", "(", "tmpdir", ",", "'part_{}.pkl'", ".", "format", "(", "rank", ")", ")", ")", "\n", "dist", ".", "barrier", "(", ")", "\n", "# collect all parts", "\n", "if", "rank", "!=", "0", ":", "\n", "        ", "return", "None", "\n", "", "else", ":", "\n", "# load results of all parts from tmp dir", "\n", "        ", "part_list", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "world_size", ")", ":", "\n", "            ", "part_file", "=", "osp", ".", "join", "(", "tmpdir", ",", "'part_{}.pkl'", ".", "format", "(", "i", ")", ")", "\n", "part_list", ".", "append", "(", "mmcv", ".", "load", "(", "part_file", ")", ")", "\n", "# sort the results", "\n", "", "ordered_results", "=", "[", "]", "\n", "for", "res", "in", "zip", "(", "*", "part_list", ")", ":", "\n", "            ", "ordered_results", ".", "extend", "(", "list", "(", "res", ")", ")", "\n", "# the dataloader may pad some samples", "\n", "", "ordered_results", "=", "ordered_results", "[", ":", "size", "]", "\n", "# remove tmp dir", "\n", "shutil", ".", "rmtree", "(", "tmpdir", ")", "\n", "return", "ordered_results", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.test.parse_args": [[105, 126], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.parse_args"], ["", "", "def", "parse_args", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", "description", "=", "'MMDet test detector'", ")", "\n", "parser", ".", "add_argument", "(", "'config'", ",", "help", "=", "'test config file path'", ")", "\n", "parser", ".", "add_argument", "(", "'checkpoint'", ",", "help", "=", "'checkpoint file'", ")", "\n", "parser", ".", "add_argument", "(", "'--out'", ",", "help", "=", "'output result file'", ")", "\n", "parser", ".", "add_argument", "(", "\n", "'--eval'", ",", "\n", "type", "=", "str", ",", "\n", "nargs", "=", "'+'", ",", "\n", "choices", "=", "[", "'proposal'", ",", "'proposal_fast'", ",", "'bbox'", ",", "'segm'", ",", "'keypoints'", "]", ",", "\n", "help", "=", "'eval types'", ")", "\n", "parser", ".", "add_argument", "(", "'--show'", ",", "action", "=", "'store_true'", ",", "help", "=", "'show results'", ")", "\n", "parser", ".", "add_argument", "(", "'--tmpdir'", ",", "help", "=", "'tmp dir for writing some results'", ")", "\n", "parser", ".", "add_argument", "(", "\n", "'--launcher'", ",", "\n", "choices", "=", "[", "'none'", ",", "'pytorch'", ",", "'slurm'", ",", "'mpi'", "]", ",", "\n", "default", "=", "'none'", ",", "\n", "help", "=", "'job launcher'", ")", "\n", "parser", ".", "add_argument", "(", "'--local_rank'", ",", "type", "=", "int", ",", "default", "=", "0", ")", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "return", "args", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.test.main": [[128, 197], ["test.parse_args", "mmcv.Config.fromfile", "mmcv.Config.fromfile.get", "mmdet.datasets.get_dataset", "mmdet.datasets.build_dataloader", "mmdet.models.build_detector", "mmcv.runner.load_checkpoint", "mmcv.runner.get_dist_info", "ValueError", "mmdet.apis.init_dist", "mmcv.parallel.MMDataParallel", "test.single_gpu_test", "mmcv.parallel.MMDistributedDataParallel", "test.multi_gpu_test", "print", "mmcv.dump", "parse_args.out.endswith", "mmcv.parallel.MMDistributedDataParallel.cuda", "print", "mmdet.core.coco_eval", "isinstance", "mmdet.core.results2json", "mmdet.core.coco_eval", "print", "mmdet.core.results2json", "mmdet.core.coco_eval"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.parse_args", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.datasets.utils.get_dataset", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.loader.build_loader.build_dataloader", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.models.builder.build_detector", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.apis.env.init_dist", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.test.single_gpu_test", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.test.multi_gpu_test", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.coco_eval", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.results2json", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.coco_eval", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.results2json", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.evaluation.coco_utils.coco_eval"], ["", "def", "main", "(", ")", ":", "\n", "    ", "args", "=", "parse_args", "(", ")", "\n", "\n", "if", "args", ".", "out", "is", "not", "None", "and", "not", "args", ".", "out", ".", "endswith", "(", "(", "'.pkl'", ",", "'.pickle'", ")", ")", ":", "\n", "        ", "raise", "ValueError", "(", "'The output file must be a pkl file.'", ")", "\n", "\n", "", "cfg", "=", "mmcv", ".", "Config", ".", "fromfile", "(", "args", ".", "config", ")", "\n", "# set cudnn_benchmark", "\n", "if", "cfg", ".", "get", "(", "'cudnn_benchmark'", ",", "False", ")", ":", "\n", "        ", "torch", ".", "backends", ".", "cudnn", ".", "benchmark", "=", "True", "\n", "", "cfg", ".", "model", ".", "pretrained", "=", "None", "\n", "cfg", ".", "data", ".", "test", ".", "test_mode", "=", "True", "\n", "\n", "# init distributed env first, since logger depends on the dist info.", "\n", "if", "args", ".", "launcher", "==", "'none'", ":", "\n", "        ", "distributed", "=", "False", "\n", "", "else", ":", "\n", "        ", "distributed", "=", "True", "\n", "init_dist", "(", "args", ".", "launcher", ",", "**", "cfg", ".", "dist_params", ")", "\n", "\n", "# build the dataloader", "\n", "# TODO: support multiple images per gpu (only minor changes are needed)", "\n", "", "dataset", "=", "get_dataset", "(", "cfg", ".", "data", ".", "test", ")", "\n", "data_loader", "=", "build_dataloader", "(", "\n", "dataset", ",", "\n", "imgs_per_gpu", "=", "1", ",", "\n", "workers_per_gpu", "=", "cfg", ".", "data", ".", "workers_per_gpu", ",", "\n", "dist", "=", "distributed", ",", "\n", "shuffle", "=", "False", ")", "\n", "\n", "# build the model and load checkpoint", "\n", "model", "=", "build_detector", "(", "cfg", ".", "model", ",", "train_cfg", "=", "None", ",", "test_cfg", "=", "cfg", ".", "test_cfg", ")", "\n", "checkpoint", "=", "load_checkpoint", "(", "model", ",", "args", ".", "checkpoint", ",", "map_location", "=", "'cpu'", ")", "\n", "# old versions did not save class info in checkpoints, this walkaround is", "\n", "# for backward compatibility", "\n", "if", "'CLASSES'", "in", "checkpoint", "[", "'meta'", "]", ":", "\n", "        ", "model", ".", "CLASSES", "=", "checkpoint", "[", "'meta'", "]", "[", "'CLASSES'", "]", "\n", "", "else", ":", "\n", "        ", "model", ".", "CLASSES", "=", "dataset", ".", "CLASSES", "\n", "\n", "", "if", "not", "distributed", ":", "\n", "        ", "model", "=", "MMDataParallel", "(", "model", ",", "device_ids", "=", "[", "0", "]", ")", "\n", "outputs", "=", "single_gpu_test", "(", "model", ",", "data_loader", ",", "args", ".", "show", ")", "\n", "", "else", ":", "\n", "        ", "model", "=", "MMDistributedDataParallel", "(", "model", ".", "cuda", "(", ")", ")", "\n", "outputs", "=", "multi_gpu_test", "(", "model", ",", "data_loader", ",", "args", ".", "tmpdir", ")", "\n", "\n", "", "rank", ",", "_", "=", "get_dist_info", "(", ")", "\n", "if", "args", ".", "out", "and", "rank", "==", "0", ":", "\n", "        ", "print", "(", "'\\nwriting results to {}'", ".", "format", "(", "args", ".", "out", ")", ")", "\n", "mmcv", ".", "dump", "(", "outputs", ",", "args", ".", "out", ")", "\n", "eval_types", "=", "args", ".", "eval", "\n", "if", "eval_types", ":", "\n", "            ", "print", "(", "'Starting evaluate {}'", ".", "format", "(", "' and '", ".", "join", "(", "eval_types", ")", ")", ")", "\n", "if", "eval_types", "==", "[", "'proposal_fast'", "]", ":", "\n", "                ", "result_file", "=", "args", ".", "out", "\n", "coco_eval", "(", "result_file", ",", "eval_types", ",", "dataset", ".", "coco", ")", "\n", "", "else", ":", "\n", "                ", "if", "not", "isinstance", "(", "outputs", "[", "0", "]", ",", "dict", ")", ":", "\n", "                    ", "result_file", "=", "args", ".", "out", "+", "'.json'", "\n", "results2json", "(", "dataset", ",", "outputs", ",", "result_file", ")", "\n", "coco_eval", "(", "result_file", ",", "eval_types", ",", "dataset", ".", "coco", ")", "\n", "", "else", ":", "\n", "                    ", "for", "name", "in", "outputs", "[", "0", "]", ":", "\n", "                        ", "print", "(", "'\\nEvaluating {}'", ".", "format", "(", "name", ")", ")", "\n", "outputs_", "=", "[", "out", "[", "name", "]", "for", "out", "in", "outputs", "]", "\n", "result_file", "=", "args", ".", "out", "+", "'.{}.json'", ".", "format", "(", "name", ")", "\n", "results2json", "(", "dataset", ",", "outputs_", ",", "result_file", ")", "\n", "coco_eval", "(", "result_file", ",", "eval_types", ",", "dataset", ".", "coco", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.upgrade_model_version.convert": [[8, 31], ["torch.load", "torch.load.pop", "collections.OrderedDict", "checkpoint.pop.items", "torch.save", "re.search", "key.replace", "re.search.groups"], "function", ["None"], ["def", "convert", "(", "in_file", ",", "out_file", ")", ":", "\n", "    ", "\"\"\"Convert keys in checkpoints.\n\n    There can be some breaking changes during the development of mmdetection,\n    and this tool is used for upgrading checkpoints trained with old versions\n    to the latest one.\n    \"\"\"", "\n", "checkpoint", "=", "torch", ".", "load", "(", "in_file", ")", "\n", "in_state_dict", "=", "checkpoint", ".", "pop", "(", "'state_dict'", ")", "\n", "out_state_dict", "=", "OrderedDict", "(", ")", "\n", "for", "key", ",", "val", "in", "in_state_dict", ".", "items", "(", ")", ":", "\n", "# Use ConvModule instead of nn.Conv2d in RetinaNet", "\n", "# cls_convs.0.weight -> cls_convs.0.conv.weight", "\n", "        ", "m", "=", "re", ".", "search", "(", "r'(cls_convs|reg_convs).\\d.(weight|bias)'", ",", "key", ")", "\n", "if", "m", "is", "not", "None", ":", "\n", "            ", "param", "=", "m", ".", "groups", "(", ")", "[", "1", "]", "\n", "new_key", "=", "key", ".", "replace", "(", "param", ",", "'conv.{}'", ".", "format", "(", "param", ")", ")", "\n", "out_state_dict", "[", "new_key", "]", "=", "val", "\n", "continue", "\n", "\n", "", "out_state_dict", "[", "key", "]", "=", "val", "\n", "", "checkpoint", "[", "'state_dict'", "]", "=", "out_state_dict", "\n", "torch", ".", "save", "(", "checkpoint", ",", "out_file", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.upgrade_model_version.main": [[33, 39], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args", "upgrade_model_version.convert"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.parse_args", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.upgrade_model_version.convert"], ["", "def", "main", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", "description", "=", "'Upgrade model version'", ")", "\n", "parser", ".", "add_argument", "(", "'in_file'", ",", "help", "=", "'input checkpoint file'", ")", "\n", "parser", ".", "add_argument", "(", "'out_file'", ",", "help", "=", "'output checkpoint file'", ")", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "convert", "(", "args", ".", "in_file", ",", "args", ".", "out_file", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.split_JSON_file.split_JSON_file": [[10, 42], ["enumerate", "mmcv.dump", "mmcv.dump", "mmcv.dump", "mmcv.dump", "mmcv.dump", "json.load", "int", "type", "type", "open", "json_results_1.append", "len", "json_results_2.append", "json_results_3.append", "json_results_4.append", "json_results_5.append"], "function", ["None"], ["def", "split_JSON_file", "(", "JSON_file", ")", ":", "\n", "    ", "\"\"\"\n    split one JSON file to 5 JSON file with equally size\n    :param JSON_file: the JSON file to be splited\n    :return:\n    \"\"\"", "\n", "if", "type", "(", "JSON_file", ")", "==", "str", "or", "type", "(", "JSON_file", ")", "==", "unicode", ":", "\n", "        ", "anns", "=", "json", ".", "load", "(", "open", "(", "JSON_file", ")", ")", "\n", "", "max_num", "=", "int", "(", "len", "(", "anns", ")", "/", "5", ")", "+", "1", "\n", "files_name", "=", "[", "'file_1.json'", ",", "'file_2.json'", ",", "'file_3.json'", ",", "'file_4.json'", ",", "'file_5.json'", "]", "\n", "json_results_1", "=", "[", "]", "\n", "json_results_2", "=", "[", "]", "\n", "json_results_3", "=", "[", "]", "\n", "json_results_4", "=", "[", "]", "\n", "json_results_5", "=", "[", "]", "\n", "\n", "for", "ind", ",", "ann", "in", "enumerate", "(", "anns", ")", ":", "\n", "        ", "if", "ind", "<", "max_num", ":", "\n", "            ", "json_results_1", ".", "append", "(", "ann", ")", "\n", "", "elif", "ind", ">=", "max_num", "and", "ind", "<", "2", "*", "max_num", ":", "\n", "            ", "json_results_2", ".", "append", "(", "ann", ")", "\n", "", "elif", "ind", ">=", "2", "*", "max_num", "and", "ind", "<", "3", "*", "max_num", ":", "\n", "            ", "json_results_3", ".", "append", "(", "ann", ")", "\n", "", "elif", "ind", ">=", "3", "*", "max_num", "and", "ind", "<", "4", "*", "max_num", ":", "\n", "            ", "json_results_4", ".", "append", "(", "ann", ")", "\n", "", "elif", "ind", ">=", "4", "*", "max_num", ":", "\n", "            ", "json_results_5", ".", "append", "(", "ann", ")", "\n", "", "", "mmcv", ".", "dump", "(", "json_results_1", ",", "files_name", "[", "0", "]", ")", "\n", "mmcv", ".", "dump", "(", "json_results_2", ",", "files_name", "[", "1", "]", ")", "\n", "mmcv", ".", "dump", "(", "json_results_3", ",", "files_name", "[", "2", "]", ")", "\n", "mmcv", ".", "dump", "(", "json_results_4", ",", "files_name", "[", "3", "]", ")", "\n", "mmcv", ".", "dump", "(", "json_results_5", ",", "files_name", "[", "4", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.split_JSON_file.main": [[46, 53], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args", "split_JSON_file.split_JSON_file"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.parse_args", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.split_JSON_file.split_JSON_file"], ["", "def", "main", "(", ")", ":", "\n", "    ", "parser", "=", "ArgumentParser", "(", "description", "=", "'Split one JSON file to multi JSON file'", ")", "\n", "parser", ".", "add_argument", "(", "'--JSON_file'", ",", "help", "=", "'the JSON file to be splited'", ")", "\n", "\n", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "split_JSON_file", "(", "args", ".", "JSON_file", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.analyze_resulsts.analyze_results": [[11, 129], ["mmcv.is_str", "isinstance", "result_file.endswith", "pycocotools.coco.COCO.loadRes", "pycocotools.coco.COCO.getImgIds", "pycocotools.coco.COCO", "pycocotools.cocoeval.COCOeval", "pycocotools.cocoeval.COCOeval.analyze_results", "mmcv.dump", "print", "numpy.zeros", "numpy.zeros", "enumerate", "matplotlib.scatter", "numpy.stack", "numpy.savetxt", "numpy.savetxt", "numpy.savetxt", "matplotlib.ylabel", "matplotlib.xlabel", "matplotlib.savefig", "matplotlib.show", "list", "len", "ious.append", "scores.append"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.analyze_resulsts.analyze_results"], ["def", "analyze_results", "(", "result_file", ",", "result_types", ",", "coco", ",", "max_dets", "=", "(", "100", ",", "300", ",", "1000", ")", ")", ":", "\n", "    ", "for", "res_type", "in", "result_types", ":", "\n", "        ", "assert", "res_type", "in", "[", "\n", "'proposal'", ",", "'proposal_fast'", ",", "'bbox'", ",", "'segm'", ",", "'keypoints'", "\n", "]", "\n", "\n", "", "if", "mmcv", ".", "is_str", "(", "coco", ")", ":", "\n", "        ", "coco", "=", "COCO", "(", "coco", ")", "\n", "", "assert", "isinstance", "(", "coco", ",", "COCO", ")", "\n", "\n", "# if result_types == ['proposal_fast']:", "\n", "#     ar = fast_eval_recall(result_file, coco, np.array(max_dets))", "\n", "#     for i, num in enumerate(max_dets):", "\n", "#         print('AR@{}\\t= {:.4f}'.format(num, ar[i]))", "\n", "#     return", "\n", "\n", "assert", "result_file", ".", "endswith", "(", "'.json'", ")", "\n", "coco_dets", "=", "coco", ".", "loadRes", "(", "result_file", ")", "\n", "\n", "img_ids", "=", "coco", ".", "getImgIds", "(", ")", "\n", "for", "res_type", "in", "result_types", ":", "\n", "        ", "iou_type", "=", "'bbox'", "if", "res_type", "==", "'proposal'", "else", "res_type", "\n", "cocoEval", "=", "COCOeval", "(", "coco", ",", "coco_dets", ",", "iou_type", ")", "\n", "cocoEval", ".", "params", ".", "imgIds", "=", "img_ids", "\n", "if", "res_type", "==", "'proposal'", ":", "\n", "            ", "cocoEval", ".", "params", ".", "useCats", "=", "0", "\n", "cocoEval", ".", "params", ".", "maxDets", "=", "list", "(", "max_dets", ")", "\n", "\n", "# cocoEval.evaluate()", "\n", "", "dt_with_iou", "=", "cocoEval", ".", "analyze_results", "(", ")", "\n", "result_file", "=", "'results_with_iou.json'", "\n", "mmcv", ".", "dump", "(", "dt_with_iou", ",", "result_file", ")", "\n", "\n", "ious", "=", "[", "]", "\n", "scores", "=", "[", "]", "\n", "print", "(", "'the number of detections is '", ",", "len", "(", "dt_with_iou", ")", ")", "\n", "num", "=", "np", ".", "zeros", "(", "[", "20", "]", ",", "dtype", "=", "np", ".", "int", ")", "\n", "sum", "=", "np", ".", "zeros", "(", "[", "20", "]", ",", "dtype", "=", "np", ".", "float", ")", "\n", "for", "ind", ",", "dt", "in", "enumerate", "(", "dt_with_iou", ")", ":", "\n", "# if dt['iou'] < 0.5:", "\n", "#     continue", "\n", "\n", "            ", "if", "dt", "[", "'iou'", "]", ">=", "0", "and", "dt", "[", "'iou'", "]", "<", "0.05", ":", "\n", "                ", "num", "[", "0", "]", "=", "num", "[", "0", "]", "+", "1", "\n", "sum", "[", "0", "]", "=", "sum", "[", "0", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.05", "and", "dt", "[", "'iou'", "]", "<", "0.1", ":", "\n", "                ", "num", "[", "1", "]", "=", "num", "[", "1", "]", "+", "1", "\n", "sum", "[", "1", "]", "=", "sum", "[", "1", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.1", "and", "dt", "[", "'iou'", "]", "<", "0.15", ":", "\n", "                ", "num", "[", "2", "]", "=", "num", "[", "2", "]", "+", "1", "\n", "sum", "[", "2", "]", "=", "sum", "[", "2", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.15", "and", "dt", "[", "'iou'", "]", "<", "0.2", ":", "\n", "                ", "num", "[", "3", "]", "=", "num", "[", "3", "]", "+", "1", "\n", "sum", "[", "3", "]", "=", "sum", "[", "3", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.2", "and", "dt", "[", "'iou'", "]", "<", "0.25", ":", "\n", "                ", "num", "[", "4", "]", "=", "num", "[", "4", "]", "+", "1", "\n", "sum", "[", "4", "]", "=", "sum", "[", "4", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.25", "and", "dt", "[", "'iou'", "]", "<", "0.3", ":", "\n", "                ", "num", "[", "5", "]", "=", "num", "[", "5", "]", "+", "1", "\n", "sum", "[", "5", "]", "=", "sum", "[", "5", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.3", "and", "dt", "[", "'iou'", "]", "<", "0.35", ":", "\n", "                ", "num", "[", "6", "]", "=", "num", "[", "6", "]", "+", "1", "\n", "sum", "[", "6", "]", "=", "sum", "[", "6", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.35", "and", "dt", "[", "'iou'", "]", "<", "0.4", ":", "\n", "                ", "num", "[", "7", "]", "=", "num", "[", "7", "]", "+", "1", "\n", "sum", "[", "7", "]", "=", "sum", "[", "7", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.4", "and", "dt", "[", "'iou'", "]", "<", "0.45", ":", "\n", "                ", "num", "[", "8", "]", "=", "num", "[", "8", "]", "+", "1", "\n", "sum", "[", "8", "]", "=", "sum", "[", "8", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.45", "and", "dt", "[", "'iou'", "]", "<=", "0.5", ":", "\n", "                ", "num", "[", "9", "]", "=", "num", "[", "9", "]", "+", "1", "\n", "sum", "[", "9", "]", "=", "sum", "[", "9", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.5", "and", "dt", "[", "'iou'", "]", "<", "0.55", ":", "\n", "                ", "num", "[", "10", "]", "=", "num", "[", "10", "]", "+", "1", "\n", "sum", "[", "10", "]", "=", "sum", "[", "10", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.55", "and", "dt", "[", "'iou'", "]", "<", "0.6", ":", "\n", "                ", "num", "[", "11", "]", "=", "num", "[", "11", "]", "+", "1", "\n", "sum", "[", "11", "]", "=", "sum", "[", "11", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.6", "and", "dt", "[", "'iou'", "]", "<", "0.65", ":", "\n", "                ", "num", "[", "12", "]", "=", "num", "[", "12", "]", "+", "1", "\n", "sum", "[", "12", "]", "=", "sum", "[", "12", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.65", "and", "dt", "[", "'iou'", "]", "<", "0.7", ":", "\n", "                ", "num", "[", "13", "]", "=", "num", "[", "13", "]", "+", "1", "\n", "sum", "[", "13", "]", "=", "sum", "[", "13", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.7", "and", "dt", "[", "'iou'", "]", "<", "0.75", ":", "\n", "                ", "num", "[", "14", "]", "=", "num", "[", "14", "]", "+", "1", "\n", "sum", "[", "14", "]", "=", "sum", "[", "14", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.75", "and", "dt", "[", "'iou'", "]", "<", "0.8", ":", "\n", "                ", "num", "[", "15", "]", "=", "num", "[", "15", "]", "+", "1", "\n", "sum", "[", "15", "]", "=", "sum", "[", "15", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.8", "and", "dt", "[", "'iou'", "]", "<", "0.85", ":", "\n", "                ", "num", "[", "16", "]", "=", "num", "[", "16", "]", "+", "1", "\n", "sum", "[", "16", "]", "=", "sum", "[", "16", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.85", "and", "dt", "[", "'iou'", "]", "<", "0.9", ":", "\n", "                ", "num", "[", "17", "]", "=", "num", "[", "17", "]", "+", "1", "\n", "sum", "[", "17", "]", "=", "sum", "[", "17", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.9", "and", "dt", "[", "'iou'", "]", "<", "0.95", ":", "\n", "                ", "num", "[", "18", "]", "=", "num", "[", "18", "]", "+", "1", "\n", "sum", "[", "18", "]", "=", "sum", "[", "18", "]", "+", "dt", "[", "'score'", "]", "\n", "", "elif", "dt", "[", "'iou'", "]", ">=", "0.95", "and", "dt", "[", "'iou'", "]", "<=", "1.0", ":", "\n", "                ", "num", "[", "19", "]", "=", "num", "[", "19", "]", "+", "1", "\n", "sum", "[", "19", "]", "=", "sum", "[", "19", "]", "+", "dt", "[", "'score'", "]", "\n", "\n", "", "ious", ".", "append", "(", "dt", "[", "'iou'", "]", ")", "\n", "scores", ".", "append", "(", "dt", "[", "'score'", "]", ")", "\n", "# if ind >200000:", "\n", "#     break", "\n", "", "average", "=", "sum", "/", "num", "\n", "plt", ".", "scatter", "(", "ious", ",", "scores", ",", "0.1", ")", "\n", "ious_scores", "=", "np", ".", "stack", "(", "(", "ious", ",", "scores", ")", ",", "axis", "=", "-", "1", ")", "\n", "np", ".", "savetxt", "(", "'ious_scores.csv'", ",", "ious_scores", ",", "delimiter", "=", "','", ",", "fmt", "=", "'%.3e'", ",", "header", "=", "'iou, score'", ")", "\n", "np", ".", "savetxt", "(", "'average_scores.csv'", ",", "average", ",", "fmt", "=", "'%f'", ",", "header", "=", "'average_score'", ")", "\n", "np", ".", "savetxt", "(", "'num_samples.csv'", ",", "num", ",", "fmt", "=", "'%d'", ",", "header", "=", "'num_samples'", ")", "\n", "\n", "plt", ".", "ylabel", "(", "'classification score'", ")", "\n", "plt", ".", "xlabel", "(", "'IoU with ground truth'", ")", "\n", "plt", ".", "savefig", "(", "'score_vs_iou'", ")", "\n", "plt", ".", "show", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.analyze_resulsts.main": [[131, 150], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args", "analyze_resulsts.analyze_results"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.parse_args", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.tools.analyze_resulsts.analyze_results"], ["", "", "def", "main", "(", ")", ":", "\n", "    ", "parser", "=", "ArgumentParser", "(", "description", "=", "'Analysis of Detection Results'", ")", "\n", "parser", ".", "add_argument", "(", "'result'", ",", "help", "=", "'result file path'", ")", "\n", "parser", ".", "add_argument", "(", "'--ann'", ",", "help", "=", "'annotation file path'", ")", "\n", "parser", ".", "add_argument", "(", "\n", "'--types'", ",", "\n", "type", "=", "str", ",", "\n", "nargs", "=", "'+'", ",", "\n", "choices", "=", "[", "'proposal_fast'", ",", "'proposal'", ",", "'bbox'", ",", "'segm'", ",", "'keypoint'", "]", ",", "\n", "default", "=", "[", "'bbox'", "]", ",", "\n", "help", "=", "'result types'", ")", "\n", "parser", ".", "add_argument", "(", "\n", "'--max-dets'", ",", "\n", "type", "=", "int", ",", "\n", "nargs", "=", "'+'", ",", "\n", "default", "=", "[", "100", ",", "300", ",", "1000", "]", ",", "\n", "help", "=", "'proposal numbers, only used for recall evaluation'", ")", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "analyze_results", "(", "args", ".", "result", ",", "args", ".", "types", ",", "args", ".", "ann", ",", "args", ".", "max_dets", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.parse_xml": [[13, 65], ["xml.parse", "ET.parse.getroot", "tree.getroot.find", "int", "int", "tree.getroot.findall", "int", "obj.find", "numpy.zeros", "numpy.zeros", "numpy.array", "numpy.zeros", "numpy.zeros", "numpy.array", "root.find.find", "root.find.find", "obj.find", "int", "int", "int", "int", "np.zeros.append", "np.array.append", "np.zeros.append", "np.array.append", "numpy.array", "numpy.array", "np.zeros.astype", "np.array.astype", "np.zeros.astype", "np.array.astype", "obj.find", "obj.find.find", "obj.find.find", "obj.find.find", "obj.find.find"], "function", ["None"], ["def", "parse_xml", "(", "args", ")", ":", "\n", "    ", "xml_path", ",", "img_path", "=", "args", "\n", "tree", "=", "ET", ".", "parse", "(", "xml_path", ")", "\n", "root", "=", "tree", ".", "getroot", "(", ")", "\n", "size", "=", "root", ".", "find", "(", "'size'", ")", "\n", "w", "=", "int", "(", "size", ".", "find", "(", "'width'", ")", ".", "text", ")", "\n", "h", "=", "int", "(", "size", ".", "find", "(", "'height'", ")", ".", "text", ")", "\n", "bboxes", "=", "[", "]", "\n", "labels", "=", "[", "]", "\n", "bboxes_ignore", "=", "[", "]", "\n", "labels_ignore", "=", "[", "]", "\n", "for", "obj", "in", "root", ".", "findall", "(", "'object'", ")", ":", "\n", "        ", "name", "=", "obj", ".", "find", "(", "'name'", ")", ".", "text", "\n", "label", "=", "label_ids", "[", "name", "]", "\n", "difficult", "=", "int", "(", "obj", ".", "find", "(", "'difficult'", ")", ".", "text", ")", "\n", "bnd_box", "=", "obj", ".", "find", "(", "'bndbox'", ")", "\n", "bbox", "=", "[", "\n", "int", "(", "bnd_box", ".", "find", "(", "'xmin'", ")", ".", "text", ")", ",", "\n", "int", "(", "bnd_box", ".", "find", "(", "'ymin'", ")", ".", "text", ")", ",", "\n", "int", "(", "bnd_box", ".", "find", "(", "'xmax'", ")", ".", "text", ")", ",", "\n", "int", "(", "bnd_box", ".", "find", "(", "'ymax'", ")", ".", "text", ")", "\n", "]", "\n", "if", "difficult", ":", "\n", "            ", "bboxes_ignore", ".", "append", "(", "bbox", ")", "\n", "labels_ignore", ".", "append", "(", "label", ")", "\n", "", "else", ":", "\n", "            ", "bboxes", ".", "append", "(", "bbox", ")", "\n", "labels", ".", "append", "(", "label", ")", "\n", "", "", "if", "not", "bboxes", ":", "\n", "        ", "bboxes", "=", "np", ".", "zeros", "(", "(", "0", ",", "4", ")", ")", "\n", "labels", "=", "np", ".", "zeros", "(", "(", "0", ",", ")", ")", "\n", "", "else", ":", "\n", "        ", "bboxes", "=", "np", ".", "array", "(", "bboxes", ",", "ndmin", "=", "2", ")", "-", "1", "\n", "labels", "=", "np", ".", "array", "(", "labels", ")", "\n", "", "if", "not", "bboxes_ignore", ":", "\n", "        ", "bboxes_ignore", "=", "np", ".", "zeros", "(", "(", "0", ",", "4", ")", ")", "\n", "labels_ignore", "=", "np", ".", "zeros", "(", "(", "0", ",", ")", ")", "\n", "", "else", ":", "\n", "        ", "bboxes_ignore", "=", "np", ".", "array", "(", "bboxes_ignore", ",", "ndmin", "=", "2", ")", "-", "1", "\n", "labels_ignore", "=", "np", ".", "array", "(", "labels_ignore", ")", "\n", "", "annotation", "=", "{", "\n", "'filename'", ":", "img_path", ",", "\n", "'width'", ":", "w", ",", "\n", "'height'", ":", "h", ",", "\n", "'ann'", ":", "{", "\n", "'bboxes'", ":", "bboxes", ".", "astype", "(", "np", ".", "float32", ")", ",", "\n", "'labels'", ":", "labels", ".", "astype", "(", "np", ".", "int64", ")", ",", "\n", "'bboxes_ignore'", ":", "bboxes_ignore", ".", "astype", "(", "np", ".", "float32", ")", ",", "\n", "'labels_ignore'", ":", "labels_ignore", ".", "astype", "(", "np", ".", "int64", ")", "\n", "}", "\n", "}", "\n", "return", "annotation", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.cvt_annotations": [[67, 92], ["mmcv.dump", "isinstance", "os.join", "mmcv.list_from_file", "mmcv.track_progress", "annotations.extend", "os.isfile", "print", "os.join", "list", "zip"], "function", ["None"], ["", "def", "cvt_annotations", "(", "devkit_path", ",", "years", ",", "split", ",", "out_file", ")", ":", "\n", "    ", "if", "not", "isinstance", "(", "years", ",", "list", ")", ":", "\n", "        ", "years", "=", "[", "years", "]", "\n", "", "annotations", "=", "[", "]", "\n", "for", "year", "in", "years", ":", "\n", "        ", "filelist", "=", "osp", ".", "join", "(", "devkit_path", ",", "'VOC{}/ImageSets/Main/{}.txt'", ".", "format", "(", "\n", "year", ",", "split", ")", ")", "\n", "if", "not", "osp", ".", "isfile", "(", "filelist", ")", ":", "\n", "            ", "print", "(", "'filelist does not exist: {}, skip voc{} {}'", ".", "format", "(", "\n", "filelist", ",", "year", ",", "split", ")", ")", "\n", "return", "\n", "", "img_names", "=", "mmcv", ".", "list_from_file", "(", "filelist", ")", "\n", "xml_paths", "=", "[", "\n", "osp", ".", "join", "(", "devkit_path", ",", "'VOC{}/Annotations/{}.xml'", ".", "format", "(", "\n", "year", ",", "img_name", ")", ")", "for", "img_name", "in", "img_names", "\n", "]", "\n", "img_paths", "=", "[", "\n", "'VOC{}/JPEGImages/{}.jpg'", ".", "format", "(", "year", ",", "img_name", ")", "\n", "for", "img_name", "in", "img_names", "\n", "]", "\n", "part_annotations", "=", "mmcv", ".", "track_progress", "(", "parse_xml", ",", "\n", "list", "(", "zip", "(", "xml_paths", ",", "img_paths", ")", ")", ")", "\n", "annotations", ".", "extend", "(", "part_annotations", ")", "\n", "", "mmcv", ".", "dump", "(", "annotations", ",", "out_file", ")", "\n", "return", "annotations", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.parse_args": [[94, 101], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.parse_args"], ["", "def", "parse_args", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", "\n", "description", "=", "'Convert PASCAL VOC annotations to mmdetection format'", ")", "\n", "parser", ".", "add_argument", "(", "'devkit_path'", ",", "help", "=", "'pascal voc devkit path'", ")", "\n", "parser", ".", "add_argument", "(", "'-o'", ",", "'--out-dir'", ",", "help", "=", "'output path'", ")", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "return", "args", "\n", "\n"]], "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.main": [[103, 137], ["pascal_voc.parse_args", "mmcv.mkdir_or_exist", "os.isdir", "os.isdir", "print", "os.join", "years.append", "os.join", "years.append", "years.append", "IOError", "print", "pascal_voc.cvt_annotations", "isinstance", "print", "pascal_voc.cvt_annotations", "os.join", "os.join"], "function", ["home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.parse_args", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.cvt_annotations", "home.repos.pwc.inspect_result.ShengkaiWu_IoU-aware-single-stage-object-detector.convert_datasets.pascal_voc.cvt_annotations"], ["", "def", "main", "(", ")", ":", "\n", "    ", "args", "=", "parse_args", "(", ")", "\n", "devkit_path", "=", "args", ".", "devkit_path", "\n", "out_dir", "=", "args", ".", "out_dir", "if", "args", ".", "out_dir", "else", "devkit_path", "\n", "mmcv", ".", "mkdir_or_exist", "(", "out_dir", ")", "\n", "\n", "years", "=", "[", "]", "\n", "if", "osp", ".", "isdir", "(", "osp", ".", "join", "(", "devkit_path", ",", "'VOC2007'", ")", ")", ":", "\n", "        ", "years", ".", "append", "(", "'2007'", ")", "\n", "", "if", "osp", ".", "isdir", "(", "osp", ".", "join", "(", "devkit_path", ",", "'VOC2012'", ")", ")", ":", "\n", "        ", "years", ".", "append", "(", "'2012'", ")", "\n", "", "if", "'2007'", "in", "years", "and", "'2012'", "in", "years", ":", "\n", "        ", "years", ".", "append", "(", "[", "'2007'", ",", "'2012'", "]", ")", "\n", "", "if", "not", "years", ":", "\n", "        ", "raise", "IOError", "(", "'The devkit path {} contains neither \"VOC2007\" nor '", "\n", "'\"VOC2012\" subfolder'", ".", "format", "(", "devkit_path", ")", ")", "\n", "", "for", "year", "in", "years", ":", "\n", "        ", "if", "year", "==", "'2007'", ":", "\n", "            ", "prefix", "=", "'voc07'", "\n", "", "elif", "year", "==", "'2012'", ":", "\n", "            ", "prefix", "=", "'voc12'", "\n", "", "elif", "year", "==", "[", "'2007'", ",", "'2012'", "]", ":", "\n", "            ", "prefix", "=", "'voc0712'", "\n", "", "for", "split", "in", "[", "'train'", ",", "'val'", ",", "'trainval'", "]", ":", "\n", "            ", "dataset_name", "=", "prefix", "+", "'_'", "+", "split", "\n", "print", "(", "'processing {} ...'", ".", "format", "(", "dataset_name", ")", ")", "\n", "cvt_annotations", "(", "devkit_path", ",", "year", ",", "split", ",", "\n", "osp", ".", "join", "(", "out_dir", ",", "dataset_name", "+", "'.pkl'", ")", ")", "\n", "", "if", "not", "isinstance", "(", "year", ",", "list", ")", ":", "\n", "            ", "dataset_name", "=", "prefix", "+", "'_test'", "\n", "print", "(", "'processing {} ...'", ".", "format", "(", "dataset_name", ")", ")", "\n", "cvt_annotations", "(", "devkit_path", ",", "year", ",", "'test'", ",", "\n", "osp", ".", "join", "(", "out_dir", ",", "dataset_name", "+", "'.pkl'", ")", ")", "\n", "", "", "print", "(", "'Done!'", ")", "\n", "\n"]]}