{"home.repos.pwc.inspect_result.mp2893_mime.None.mime.build_model": [[17, 110], ["tensorflow.get_variable", "tensorflow.get_variable", "tensorflow.get_variable", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.nn.embedding_lookup", "emb_activation", "tensorflow.reshape", "tensorflow.nn.embedding_lookup", "emb_activation", "tensorflow.reduce_sum", "tensorflow.keras.layers.Dense", "tf.keras.layers.Dense.", "tensorflow.nn.embedding_lookup", "emb_activation", "tensorflow.reduce_sum", "tensorflow.keras.layers.Dense", "tf.keras.layers.Dense.", "tensorflow.keras.layers.Dense", "tf.keras.layers.Dense.", "tensorflow.reshape", "tensorflow.reduce_sum", "tensorflow.reshape", "tensorflow.placeholder", "tensorflow.keras.layers.GRUCell", "tensorflow.keras.layers.Dense", "tensorflow.keras.layers.Dense", "tensorflow.keras.layers.Dense", "tensorflow.keras.layers.Dense", "tensorflow.nn.dynamic_rnn", "tensorflow.squeeze", "tensorflow.placeholder", "tensorflow.losses.softmax_cross_entropy", "tensorflow.losses.sigmoid_cross_entropy", "tensorflow.losses.sigmoid_cross_entropy", "tensorflow.reshape", "tensorflow.reshape", "tensorflow.reshape", "tf.keras.layers.Dense.", "tensorflow.reduce_mean", "tf.keras.layers.Dense.", "tensorflow.reshape", "tensorflow.reshape", "tf.keras.layers.Dense.", "tensorflow.reshape", "tensorflow.reshape", "tf.keras.layers.Dense.", "tensorflow.reshape", "tensorflow.reshape", "tensorflow.reshape", "tensorflow.reshape", "tensorflow.reshape", "tensorflow.log", "tensorflow.log"], "function", ["None"], ["def", "build_model", "(", "options", ")", ":", "\n", "    ", "if", "options", "[", "'emb_activation'", "]", "==", "'sigmoid'", ":", "\n", "        ", "emb_activation", "=", "tf", ".", "nn", ".", "sigmoid", "\n", "", "elif", "options", "[", "'emb_activation'", "]", "==", "'tanh'", ":", "\n", "        ", "emb_activation", "=", "tf", ".", "nn", ".", "tanh", "\n", "", "else", ":", "\n", "        ", "emb_activation", "=", "tf", ".", "nn", ".", "relu", "\n", "\n", "", "if", "options", "[", "'order_activation'", "]", "==", "'sigmoid'", ":", "\n", "        ", "order_activation", "=", "tf", ".", "nn", ".", "sigmoid", "\n", "", "elif", "options", "[", "'order_activation'", "]", "==", "'tanh'", ":", "\n", "        ", "order_activation", "=", "tf", ".", "nn", ".", "tanh", "\n", "", "else", ":", "\n", "        ", "order_activation", "=", "tf", ".", "nn", ".", "relu", "\n", "\n", "", "if", "options", "[", "'visit_activation'", "]", "==", "'sigmoid'", ":", "\n", "        ", "visit_activation", "=", "tf", ".", "nn", ".", "sigmoid", "\n", "", "elif", "options", "[", "'visit_activation'", "]", "==", "'tanh'", ":", "\n", "        ", "visit_activation", "=", "tf", ".", "nn", ".", "tanh", "\n", "", "else", ":", "\n", "        ", "visit_activation", "=", "tf", ".", "nn", ".", "relu", "\n", "\n", "", "W_emb_dx", "=", "tf", ".", "get_variable", "(", "'W_emb_dx'", ",", "shape", "=", "(", "options", "[", "'num_dx'", "]", ",", "options", "[", "'dx_emb_size'", "]", ")", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "W_emb_rx", "=", "tf", ".", "get_variable", "(", "'W_emb_rx'", ",", "shape", "=", "(", "options", "[", "'num_rx'", "]", ",", "options", "[", "'rx_emb_size'", "]", ")", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "W_emb_pr", "=", "tf", ".", "get_variable", "(", "'W_emb_pr'", ",", "shape", "=", "(", "options", "[", "'num_pr'", "]", ",", "options", "[", "'pr_emb_size'", "]", ")", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "\n", "dx_var", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "shape", "=", "(", "None", ",", "options", "[", "'batch_size'", "]", ",", "options", "[", "'max_dx_per_visit'", "]", ")", ",", "name", "=", "'dx_var'", ")", "\n", "rx_var", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "shape", "=", "(", "None", ",", "options", "[", "'batch_size'", "]", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_rx_per_dx'", "]", ")", ",", "name", "=", "'rx_var'", ")", "\n", "pr_var", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "shape", "=", "(", "None", ",", "options", "[", "'batch_size'", "]", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_pr_per_dx'", "]", ")", ",", "name", "=", "'pr_var'", ")", "\n", "\n", "dx_label", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "shape", "=", "(", "None", ",", "options", "[", "'batch_size'", "]", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'num_dx'", "]", ")", ",", "name", "=", "'dx_label'", ")", "\n", "rx_label", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "shape", "=", "(", "None", ",", "options", "[", "'batch_size'", "]", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'num_rx'", "]", ")", ",", "name", "=", "'rx_label'", ")", "\n", "pr_label", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "shape", "=", "(", "None", ",", "options", "[", "'batch_size'", "]", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'num_pr'", "]", ")", ",", "name", "=", "'pr_label'", ")", "\n", "\n", "dx_mask", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "shape", "=", "(", "None", ",", "options", "[", "'batch_size'", "]", ",", "options", "[", "'max_dx_per_visit'", "]", ")", ",", "name", "=", "'dx_mask'", ")", "\n", "rx_mask", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "shape", "=", "(", "None", ",", "options", "[", "'batch_size'", "]", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_rx_per_dx'", "]", ")", ",", "name", "=", "'rx_mask'", ")", "\n", "pr_mask", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "shape", "=", "(", "None", ",", "options", "[", "'batch_size'", "]", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_pr_per_dx'", "]", ")", ",", "name", "=", "'pr_mask'", ")", "\n", "\n", "dx_visit", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "W_emb_dx", ",", "tf", ".", "reshape", "(", "dx_var", ",", "(", "-", "1", ",", "options", "[", "'max_dx_per_visit'", "]", ")", ")", ")", "\n", "dx_visit", "=", "emb_activation", "(", "dx_visit", ")", "\n", "dx_visit", "=", "tf", ".", "reshape", "(", "dx_visit", ",", "(", "-", "1", ",", "options", "[", "'dx_emb_size'", "]", ")", ")", "\n", "\n", "rx_visit", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "W_emb_rx", ",", "tf", ".", "reshape", "(", "rx_var", ",", "(", "-", "1", ",", "options", "[", "'max_rx_per_dx'", "]", ")", ")", ")", "\n", "rx_visit", "=", "emb_activation", "(", "rx_visit", ")", "\n", "rx_visit", "=", "rx_visit", "*", "tf", ".", "reshape", "(", "rx_mask", ",", "(", "-", "1", ",", "options", "[", "'max_rx_per_dx'", "]", ")", ")", "[", ":", ",", ":", ",", "None", "]", "####Masking####", "\n", "rx_visit", "=", "tf", ".", "reduce_sum", "(", "rx_visit", ",", "axis", "=", "1", ")", "\n", "W_dr", "=", "tf", ".", "keras", ".", "layers", ".", "Dense", "(", "options", "[", "'rx_emb_size'", "]", ",", "activation", "=", "order_activation", ",", "name", "=", "'W_dr'", ")", "\n", "dr_visit", "=", "W_dr", "(", "dx_visit", ")", "\n", "dr_visit", "=", "dr_visit", "*", "rx_visit", "\n", "\n", "pr_visit", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "W_emb_pr", ",", "tf", ".", "reshape", "(", "pr_var", ",", "(", "-", "1", ",", "options", "[", "'max_pr_per_dx'", "]", ")", ")", ")", "\n", "pr_visit", "=", "emb_activation", "(", "pr_visit", ")", "\n", "pr_visit", "=", "pr_visit", "*", "tf", ".", "reshape", "(", "pr_mask", ",", "(", "-", "1", ",", "options", "[", "'max_pr_per_dx'", "]", ")", ")", "[", ":", ",", ":", ",", "None", "]", "####Masking####", "\n", "pr_visit", "=", "tf", ".", "reduce_sum", "(", "pr_visit", ",", "axis", "=", "1", ")", "\n", "W_dp", "=", "tf", ".", "keras", ".", "layers", ".", "Dense", "(", "options", "[", "'pr_emb_size'", "]", ",", "activation", "=", "order_activation", ",", "name", "=", "'W_dp'", ")", "\n", "dp_visit", "=", "W_dp", "(", "dx_visit", ")", "\n", "dp_visit", "=", "dp_visit", "*", "pr_visit", "\n", "\n", "dx_obj", "=", "dx_visit", "+", "dr_visit", "+", "dp_visit", "\n", "W_dx", "=", "tf", ".", "keras", ".", "layers", ".", "Dense", "(", "options", "[", "'dxobj_emb_size'", "]", ",", "activation", "=", "order_activation", ",", "name", "=", "'W_dxobj'", ")", "\n", "dx_obj", "=", "W_dx", "(", "dx_obj", ")", "\n", "pre_visit", "=", "tf", ".", "reshape", "(", "dx_obj", ",", "(", "-", "1", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'dxobj_emb_size'", "]", ")", ")", "\n", "pre_visit", "=", "pre_visit", "*", "tf", ".", "reshape", "(", "dx_mask", ",", "(", "-", "1", ",", "options", "[", "'max_dx_per_visit'", "]", ")", ")", "[", ":", ",", ":", ",", "None", "]", "####Masking####", "\n", "visit", "=", "tf", ".", "reduce_sum", "(", "pre_visit", ",", "axis", "=", "1", ")", "\n", "seq_visit", "=", "tf", ".", "reshape", "(", "visit", ",", "(", "-", "1", ",", "options", "[", "'batch_size'", "]", ",", "options", "[", "'visit_emb_size'", "]", ")", ")", "\n", "\n", "seq_length", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "shape", "=", "(", "options", "[", "'batch_size'", "]", ")", ",", "name", "=", "'seq_length'", ")", "\n", "rnn_cell", "=", "tf", ".", "keras", ".", "layers", ".", "GRUCell", "(", "options", "[", "'rnn_size'", "]", ",", "name", "=", "'emb2rnn'", ")", "\n", "rnn2pred", "=", "tf", ".", "keras", ".", "layers", ".", "Dense", "(", "options", "[", "'output_size'", "]", ",", "activation", "=", "tf", ".", "nn", ".", "sigmoid", ",", "name", "=", "'rnn2pred'", ")", "\n", "rnn2aux_dx", "=", "tf", ".", "keras", ".", "layers", ".", "Dense", "(", "options", "[", "'num_dx'", "]", ",", "name", "=", "'rnn2aux_dx'", ")", "\n", "rnn2aux_rx", "=", "tf", ".", "keras", ".", "layers", ".", "Dense", "(", "options", "[", "'num_rx'", "]", ",", "name", "=", "'rnn2aux_rx'", ")", "\n", "rnn2aux_pr", "=", "tf", ".", "keras", ".", "layers", ".", "Dense", "(", "options", "[", "'num_pr'", "]", ",", "name", "=", "'rnn2aux_pr'", ")", "\n", "\n", "_", ",", "final_states", "=", "tf", ".", "nn", ".", "dynamic_rnn", "(", "rnn_cell", ",", "seq_visit", ",", "dtype", "=", "tf", ".", "float32", ",", "time_major", "=", "True", ",", "sequence_length", "=", "seq_length", ")", "\n", "preds", "=", "tf", ".", "squeeze", "(", "rnn2pred", "(", "final_states", ")", ")", "\n", "labels", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "shape", "=", "(", "options", "[", "'batch_size'", "]", ")", ",", "name", "=", "'labels'", ")", "\n", "loss", "=", "-", "tf", ".", "reduce_mean", "(", "labels", "*", "tf", ".", "log", "(", "preds", "+", "1e-10", ")", "+", "(", "1.", "-", "labels", ")", "*", "tf", ".", "log", "(", "1.", "-", "preds", "+", "1e-10", ")", ")", "\n", "\n", "aux_dx_preds", "=", "rnn2aux_dx", "(", "dx_obj", ")", "*", "tf", ".", "reshape", "(", "dx_mask", ",", "(", "-", "1", ",", "1", ")", ")", "\n", "aux_dx_loss", "=", "tf", ".", "losses", ".", "softmax_cross_entropy", "(", "tf", ".", "reshape", "(", "dx_label", ",", "(", "-", "1", ",", "options", "[", "'num_dx'", "]", ")", ")", ",", "aux_dx_preds", ")", "\n", "\n", "aux_rx_preds", "=", "rnn2aux_rx", "(", "dx_obj", ")", "*", "tf", ".", "reshape", "(", "dx_mask", ",", "(", "-", "1", ",", "1", ")", ")", "\n", "aux_rx_loss", "=", "tf", ".", "losses", ".", "sigmoid_cross_entropy", "(", "tf", ".", "reshape", "(", "rx_label", ",", "(", "-", "1", ",", "options", "[", "'num_rx'", "]", ")", ")", ",", "aux_rx_preds", ")", "\n", "\n", "aux_pr_preds", "=", "rnn2aux_pr", "(", "dx_obj", ")", "*", "tf", ".", "reshape", "(", "dx_mask", ",", "(", "-", "1", ",", "1", ")", ")", "\n", "aux_pr_loss", "=", "tf", ".", "losses", ".", "sigmoid_cross_entropy", "(", "tf", ".", "reshape", "(", "pr_label", ",", "(", "-", "1", ",", "options", "[", "'num_pr'", "]", ")", ")", ",", "aux_pr_preds", ")", "\n", "\n", "input_tensors", "=", "(", "dx_var", ",", "rx_var", ",", "pr_var", ")", "\n", "label_tensors", "=", "(", "dx_label", ",", "rx_label", ",", "pr_label", ",", "labels", ")", "\n", "mask_tensors", "=", "(", "dx_mask", ",", "rx_mask", ",", "pr_mask", ")", "\n", "loss_tensors", "=", "(", "aux_dx_loss", ",", "aux_rx_loss", ",", "aux_pr_loss", ",", "loss", ")", "\n", "\n", "return", "input_tensors", ",", "label_tensors", ",", "mask_tensors", ",", "loss_tensors", ",", "seq_length", ",", "preds", "\n", "\n"]], "home.repos.pwc.inspect_result.mp2893_mime.None.mime.run_test": [[112, 140], ["builtins.range", "sklearn.metrics.roc_auc_score", "sklearn.metrics.average_precision_score", "int", "mime_util.st_preprocess_hf_aux", "sess.run", "all_losses.append", "all_preds.extend", "all_labels.extend", "numpy.mean", "list", "len", "numpy.array", "numpy.squeeze", "sklearn.preprocessing.binarize", "numpy.array().reshape", "numpy.array"], "function", ["home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.st_preprocess_hf_aux"], ["", "def", "run_test", "(", "seqs", ",", "label_seqs", ",", "sess", ",", "preds_T", ",", "input_PHs", ",", "label_PHs", ",", "mask_PHs", ",", "seq_length_PH", ",", "loss_T", ",", "options", ")", ":", "\n", "    ", "all_losses", "=", "[", "]", "\n", "all_preds", "=", "[", "]", "\n", "all_labels", "=", "[", "]", "\n", "batch_size", "=", "options", "[", "'batch_size'", "]", "\n", "for", "idx", "in", "range", "(", "int", "(", "len", "(", "label_seqs", ")", "/", "batch_size", ")", ")", ":", "\n", "        ", "batch_x", "=", "seqs", "[", "idx", "*", "batch_size", ":", "(", "idx", "+", "1", ")", "*", "batch_size", "]", "\n", "batch_y", "=", "label_seqs", "[", "idx", "*", "batch_size", ":", "(", "idx", "+", "1", ")", "*", "batch_size", "]", "\n", "inputs", ",", "_", ",", "masks", ",", "seq_length", "=", "mime_util", ".", "st_preprocess_hf_aux", "(", "batch_x", ",", "options", ")", "\n", "preds", ",", "loss", "=", "sess", ".", "run", "(", "[", "preds_T", ",", "loss_T", "]", ",", "\n", "feed_dict", "=", "{", "\n", "input_PHs", "[", "0", "]", ":", "inputs", "[", "0", "]", ",", "\n", "input_PHs", "[", "1", "]", ":", "inputs", "[", "1", "]", ",", "\n", "input_PHs", "[", "2", "]", ":", "inputs", "[", "2", "]", ",", "\n", "mask_PHs", "[", "0", "]", ":", "masks", "[", "0", "]", ",", "\n", "mask_PHs", "[", "1", "]", ":", "masks", "[", "1", "]", ",", "\n", "mask_PHs", "[", "2", "]", ":", "masks", "[", "2", "]", ",", "\n", "label_PHs", "[", "-", "1", "]", ":", "batch_y", ",", "\n", "seq_length_PH", ":", "seq_length", ",", "\n", "}", "\n", ")", "\n", "all_losses", ".", "append", "(", "loss", ")", "\n", "all_preds", ".", "extend", "(", "list", "(", "preds", ")", ")", "\n", "all_labels", ".", "extend", "(", "batch_y", ")", "\n", "", "auc", "=", "roc_auc_score", "(", "all_labels", ",", "all_preds", ")", "\n", "aucpr", "=", "average_precision_score", "(", "all_labels", ",", "all_preds", ")", "\n", "accuracy", "=", "(", "np", ".", "array", "(", "all_labels", ")", "==", "np", ".", "squeeze", "(", "binarize", "(", "np", ".", "array", "(", "all_preds", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", ",", "threshold", "=", ".5", ")", ")", ")", ".", "mean", "(", ")", "\n", "return", "np", ".", "mean", "(", "all_losses", ")", ",", "auc", ",", "aucpr", "\n", "\n"]], "home.repos.pwc.inspect_result.mp2893_mime.None.mime.train": [[142, 238], ["locals().copy", "mime.build_model", "tensorflow.trainable_variables", "tensorflow.constant", "tensorflow.train.AdamOptimizer", "tf.train.AdamOptimizer.minimize", "mime_util.load_data", "tensorflow.train.Saver", "tensorflow.reduce_sum", "tensorflow.Session", "sess.run", "builtins.range", "locals", "len", "tensorflow.global_variables_initializer", "mime_util.sample_batch", "mime_util.st_preprocess_hf_aux", "sess.run", "mime.run_test", "print", "mime.run_test", "tf.train.Saver.save", "str", "str"], "function", ["home.repos.pwc.inspect_result.mp2893_mime.None.mime.build_model", "home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.load_data", "home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.sample_batch", "home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.st_preprocess_hf_aux", "home.repos.pwc.inspect_result.mp2893_mime.None.mime.run_test", "home.repos.pwc.inspect_result.mp2893_mime.None.mime.run_test"], ["", "def", "train", "(", "\n", "input_path", "=", "''", ",", "\n", "batch_size", "=", "100", ",", "\n", "num_iter", "=", "100", ",", "\n", "eval_period", "=", "10", ",", "\n", "num_eval", "=", "100", ",", "\n", "rnn_size", "=", "256", ",", "\n", "output_size", "=", "1", ",", "\n", "learning_rate", "=", "1e-3", ",", "\n", "output_path", "=", "''", ",", "\n", "random_seed", "=", "1234", ",", "\n", "split_seed", "=", "1234", ",", "\n", "emb_activation", "=", "'sigmoid'", ",", "\n", "order_activation", "=", "'sigmoid'", ",", "\n", "visit_activation", "=", "'sigmoid'", ",", "\n", "num_dx", "=", "100", ",", "\n", "num_rx", "=", "100", ",", "\n", "num_pr", "=", "100", ",", "\n", "dx_emb_size", "=", "128", ",", "\n", "rx_emb_size", "=", "128", ",", "\n", "pr_emb_size", "=", "128", ",", "\n", "dxobj_emb_size", "=", "128", ",", "\n", "visit_emb_size", "=", "128", ",", "\n", "max_dx_per_visit", "=", "29", ",", "\n", "max_rx_per_dx", "=", "17", ",", "\n", "max_pr_per_dx", "=", "10", ",", "\n", "regularize", "=", "1e-3", ",", "\n", "aux_lambda", "=", "0.1", ",", "\n", "min_threshold", "=", "1", ",", "\n", "max_threshold", "=", "200", ",", "\n", "train_ratio", "=", "1.0", ",", "\n", "association_threshold", "=", "0.0", ",", "\n", ")", ":", "\n", "    ", "options", "=", "locals", "(", ")", ".", "copy", "(", ")", "\n", "input_PHs", ",", "label_PHs", ",", "mask_PHs", ",", "loss_Ts", ",", "seq_length_PH", ",", "preds_T", "=", "build_model", "(", "options", ")", "\n", "\n", "all_vars", "=", "tf", ".", "trainable_variables", "(", ")", "\n", "L2_loss", "=", "tf", ".", "constant", "(", "0.0", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "for", "var", "in", "all_vars", ":", "\n", "        ", "if", "len", "(", "var", ".", "shape", ")", "<", "2", ":", "\n", "            ", "continue", "\n", "", "L2_loss", "+=", "tf", ".", "reduce_sum", "(", "var", "**", "2", ")", "\n", "\n", "", "optimizer", "=", "tf", ".", "train", ".", "AdamOptimizer", "(", "learning_rate", "=", "options", "[", "'learning_rate'", "]", ")", "\n", "loss_T", "=", "options", "[", "'aux_lambda'", "]", "*", "(", "loss_Ts", "[", "0", "]", "+", "loss_Ts", "[", "1", "]", "+", "loss_Ts", "[", "2", "]", ")", "+", "loss_Ts", "[", "3", "]", "\n", "minimize_op", "=", "optimizer", ".", "minimize", "(", "loss_T", "+", "regularize", "*", "L2_loss", ")", "\n", "train_seqs", ",", "train_labels", ",", "valid_seqs", ",", "valid_labels", ",", "test_seqs", ",", "test_labels", "=", "mime_util", ".", "load_data", "(", "\n", "options", "[", "'input_path'", "]", ",", "\n", "min_threshold", "=", "options", "[", "'min_threshold'", "]", ",", "\n", "max_threshold", "=", "options", "[", "'max_threshold'", "]", ",", "\n", "seed", "=", "options", "[", "'split_seed'", "]", ",", "\n", "train_ratio", "=", "options", "[", "'train_ratio'", "]", ",", "\n", "association_threshold", "=", "options", "[", "'association_threshold'", "]", ")", "\n", "\n", "saver", "=", "tf", ".", "train", ".", "Saver", "(", "max_to_keep", "=", "1", ")", "\n", "with", "tf", ".", "Session", "(", ")", "as", "sess", ":", "\n", "        ", "sess", ".", "run", "(", "tf", ".", "global_variables_initializer", "(", ")", ")", "\n", "\n", "best_valid_loss", "=", "100000.0", "\n", "best_test_loss", "=", "100000.0", "\n", "best_valid_auc", "=", "0.0", "\n", "best_test_auc", "=", "0.0", "\n", "best_valid_aucpr", "=", "0.0", "\n", "best_test_aucpr", "=", "0.0", "\n", "for", "train_iter", "in", "range", "(", "options", "[", "'num_iter'", "]", "+", "1", ")", ":", "\n", "            ", "batch_x", ",", "batch_y", "=", "mime_util", ".", "sample_batch", "(", "train_seqs", ",", "train_labels", ",", "options", "[", "'batch_size'", "]", ")", "\n", "inputs", ",", "labels", ",", "masks", ",", "seq_length", "=", "mime_util", ".", "st_preprocess_hf_aux", "(", "batch_x", ",", "options", ")", "\n", "_", ",", "preds", ",", "losses", "=", "sess", ".", "run", "(", "[", "minimize_op", ",", "preds_T", ",", "loss_Ts", "]", ",", "\n", "feed_dict", "=", "{", "\n", "input_PHs", "[", "0", "]", ":", "inputs", "[", "0", "]", ",", "\n", "input_PHs", "[", "1", "]", ":", "inputs", "[", "1", "]", ",", "\n", "input_PHs", "[", "2", "]", ":", "inputs", "[", "2", "]", ",", "\n", "mask_PHs", "[", "0", "]", ":", "masks", "[", "0", "]", ",", "\n", "mask_PHs", "[", "1", "]", ":", "masks", "[", "1", "]", ",", "\n", "mask_PHs", "[", "2", "]", ":", "masks", "[", "2", "]", ",", "\n", "label_PHs", "[", "0", "]", ":", "labels", "[", "0", "]", ",", "\n", "label_PHs", "[", "1", "]", ":", "labels", "[", "1", "]", ",", "\n", "label_PHs", "[", "2", "]", ":", "labels", "[", "2", "]", ",", "\n", "label_PHs", "[", "3", "]", ":", "batch_y", ",", "\n", "seq_length_PH", ":", "seq_length", ",", "\n", "}", "\n", ")", "\n", "\n", "if", "train_iter", ">", "0", "and", "train_iter", "%", "options", "[", "'eval_period'", "]", "==", "0", ":", "\n", "                ", "valid_loss", ",", "valid_auc", ",", "valid_aucpr", "=", "run_test", "(", "valid_seqs", ",", "valid_labels", ",", "sess", ",", "preds_T", ",", "input_PHs", ",", "label_PHs", ",", "mask_PHs", ",", "seq_length_PH", ",", "loss_Ts", "[", "-", "1", "]", ",", "options", ")", "\n", "if", "valid_loss", "<", "best_valid_loss", ":", "\n", "                    ", "test_loss", ",", "test_auc", ",", "test_aucpr", "=", "run_test", "(", "test_seqs", ",", "test_labels", ",", "sess", ",", "preds_T", ",", "input_PHs", ",", "label_PHs", ",", "mask_PHs", ",", "seq_length_PH", ",", "loss_Ts", "[", "-", "1", "]", ",", "options", ")", "\n", "best_valid_loss", "=", "valid_loss", "\n", "best_valid_auc", "=", "valid_auc", "\n", "best_valid_aucpr", "=", "valid_aucpr", "\n", "best_test_loss", "=", "test_loss", "\n", "best_test_auc", "=", "test_auc", "\n", "best_test_aucpr", "=", "test_aucpr", "\n", "savePath", "=", "saver", ".", "save", "(", "sess", ",", "output_path", "+", "'/r'", "+", "str", "(", "random_seed", ")", "+", "'s'", "+", "str", "(", "split_seed", ")", "+", "'/model'", ",", "global_step", "=", "train_iter", ")", "\n", "", "print", "(", "'round:%d, valid_loss:%f, valid_auc:%f, valid_aucpr:%f'", "%", "(", "train_iter", ",", "valid_loss", ",", "valid_auc", ",", "valid_aucpr", ")", ")", "\n", "", "", "return", "best_valid_loss", ",", "best_test_loss", ",", "best_valid_auc", ",", "best_test_auc", ",", "best_valid_aucpr", ",", "best_test_aucpr", "\n", "\n"]], "home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.load_data": [[12, 58], ["pickle.load", "pickle.load", "zip", "mime_util.find_patients_with_many_associations", "sklearn.model_selection.train_test_split", "sklearn.model_selection.train_test_split", "int", "mime_util.load_data.len_argsort"], "function", ["home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.find_patients_with_many_associations"], ["def", "load_data", "(", "input_path", ",", "min_threshold", "=", "5", ",", "max_threshold", "=", "150", ",", "seed", "=", "1234", ",", "train_ratio", "=", "1.", ",", "association_threshold", "=", "0.2", ",", "seqs_name", "=", "'.seqs'", ",", "labels_name", "=", "'.labels'", ",", "filter_codes", "=", "True", ")", ":", "\n", "    ", "seqs", "=", "pickle", ".", "load", "(", "open", "(", "input_path", "+", "seqs_name", ",", "'rb'", ")", ")", "\n", "labels", "=", "pickle", ".", "load", "(", "open", "(", "input_path", "+", "labels_name", ",", "'rb'", ")", ")", "\n", "\n", "new_seqs", "=", "[", "]", "\n", "new_labels", "=", "[", "]", "\n", "for", "seq", ",", "label", "in", "zip", "(", "seqs", ",", "labels", ")", ":", "\n", "        ", "if", "len", "(", "seq", ")", "<", "min_threshold", "or", "len", "(", "seq", ")", ">=", "max_threshold", ":", "\n", "            ", "continue", "\n", "", "else", ":", "\n", "            ", "new_seqs", ".", "append", "(", "seq", ")", "\n", "new_labels", ".", "append", "(", "label", ")", "\n", "", "", "seqs", "=", "new_seqs", "\n", "labels", "=", "new_labels", "\n", "\n", "seqs", ",", "labels", "=", "find_patients_with_many_associations", "(", "seqs", ",", "labels", ",", "association_threshold", ")", "\n", "\n", "train_seqs", ",", "temp_seqs", ",", "train_labels", ",", "temp_labels", "=", "train_test_split", "(", "seqs", ",", "labels", ",", "test_size", "=", "0.8", ",", "random_state", "=", "seed", ")", "\n", "valid_seqs", ",", "test_seqs", ",", "valid_labels", ",", "test_labels", "=", "train_test_split", "(", "temp_seqs", ",", "temp_labels", ",", "test_size", "=", "0.5", ",", "random_state", "=", "seed", ")", "\n", "\n", "train_size", "=", "int", "(", "len", "(", "train_seqs", ")", "*", "train_ratio", ")", "\n", "train_seqs", "=", "train_seqs", "[", ":", "train_size", "]", "\n", "train_labels", "=", "train_labels", "[", ":", "train_size", "]", "\n", "\n", "if", "filter_codes", ":", "\n", "        ", "dx_codes", ",", "rx_codes", ",", "pr_codes", "=", "build_dicts", "(", "train_seqs", ")", "\n", "valid_seqs", "=", "filter_unknown_codes", "(", "dx_codes", ",", "rx_codes", ",", "pr_codes", ",", "valid_seqs", ")", "\n", "test_seqs", "=", "filter_unknown_codes", "(", "dx_codes", ",", "rx_codes", ",", "pr_codes", ",", "test_seqs", ")", "\n", "\n", "", "def", "len_argsort", "(", "seq", ")", ":", "\n", "        ", "return", "sorted", "(", "range", "(", "len", "(", "seq", ")", ")", ",", "key", "=", "lambda", "x", ":", "len", "(", "seq", "[", "x", "]", ")", ")", "\n", "\n", "", "sorted_index", "=", "len_argsort", "(", "train_seqs", ")", "\n", "train_seqs", "=", "[", "train_seqs", "[", "i", "]", "for", "i", "in", "sorted_index", "]", "\n", "train_labels", "=", "[", "train_labels", "[", "i", "]", "for", "i", "in", "sorted_index", "]", "\n", "\n", "sorted_index", "=", "len_argsort", "(", "valid_seqs", ")", "\n", "valid_seqs", "=", "[", "valid_seqs", "[", "i", "]", "for", "i", "in", "sorted_index", "]", "\n", "valid_labels", "=", "[", "valid_labels", "[", "i", "]", "for", "i", "in", "sorted_index", "]", "\n", "\n", "sorted_index", "=", "len_argsort", "(", "test_seqs", ")", "\n", "test_seqs", "=", "[", "test_seqs", "[", "i", "]", "for", "i", "in", "sorted_index", "]", "\n", "test_labels", "=", "[", "test_labels", "[", "i", "]", "for", "i", "in", "sorted_index", "]", "\n", "\n", "\n", "return", "train_seqs", ",", "train_labels", ",", "valid_seqs", ",", "valid_labels", ",", "test_seqs", ",", "test_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.find_patients_with_many_associations": [[60, 81], ["zip", "float", "len", "new_seqs.append", "new_labels.append", "len", "len"], "function", ["None"], ["", "def", "find_patients_with_many_associations", "(", "seqs", ",", "labels", ",", "threshold", ")", ":", "\n", "    ", "new_seqs", "=", "[", "]", "\n", "new_labels", "=", "[", "]", "\n", "for", "patient", ",", "label", "in", "zip", "(", "seqs", ",", "labels", ")", ":", "\n", "        ", "code_count", "=", "0", "\n", "dxobj_count", "=", "0", "\n", "for", "visit", "in", "patient", ":", "\n", "            ", "local_code_count", "=", "0", "\n", "for", "dxset", "in", "visit", ":", "\n", "                ", "dx", "=", "dxset", "[", "0", "]", "\n", "rxs", "=", "dxset", "[", "1", "]", "\n", "prs", "=", "dxset", "[", "2", "]", "\n", "if", "len", "(", "rxs", ")", ">", "0", "or", "len", "(", "prs", ")", ">", "0", ":", "\n", "                    ", "local_code_count", "+=", "1", "\n", "", "", "if", "local_code_count", ">", "1", ":", "\n", "                ", "code_count", "+=", "1", "\n", "", "", "num_visits", "=", "float", "(", "len", "(", "patient", ")", ")", "\n", "if", "code_count", "/", "num_visits", ">=", "threshold", ":", "\n", "            ", "new_seqs", ".", "append", "(", "patient", ")", "\n", "new_labels", ".", "append", "(", "label", ")", "\n", "", "", "return", "new_seqs", ",", "new_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.build_dicts": [[83, 96], ["set", "set", "set", "dx_codes.append", "rx_codes.extend", "pr_codes.extend"], "function", ["None"], ["", "def", "build_dicts", "(", "seqs", ")", ":", "\n", "    ", "dx_codes", "=", "[", "]", "\n", "rx_codes", "=", "[", "]", "\n", "pr_codes", "=", "[", "]", "\n", "\n", "for", "patient", "in", "seqs", ":", "\n", "        ", "for", "visit", "in", "patient", ":", "\n", "            ", "for", "dxobj", "in", "visit", ":", "\n", "                ", "dx_codes", ".", "append", "(", "dxobj", "[", "0", "]", ")", "\n", "rx_codes", ".", "extend", "(", "dxobj", "[", "1", "]", ")", "\n", "pr_codes", ".", "extend", "(", "dxobj", "[", "2", "]", ")", "\n", "\n", "", "", "", "return", "set", "(", "dx_codes", ")", ",", "set", "(", "rx_codes", ")", ",", "set", "(", "pr_codes", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.filter_unknown_codes": [[97, 112], ["new_seqs.append", "new_patient.append", "new_visit.append"], "function", ["None"], ["", "def", "filter_unknown_codes", "(", "dx_codes", ",", "rx_codes", ",", "pr_codes", ",", "seqs", ")", ":", "\n", "    ", "new_seqs", "=", "[", "]", "\n", "for", "patient", "in", "seqs", ":", "\n", "        ", "new_patient", "=", "[", "]", "\n", "for", "visit", "in", "patient", ":", "\n", "            ", "new_visit", "=", "[", "]", "\n", "for", "dxobj", "in", "visit", ":", "\n", "                ", "dx", "=", "dxobj", "[", "0", "]", "\n", "if", "dx", "not", "in", "dx_codes", ":", "continue", "\n", "new_rxs", "=", "[", "rx", "for", "rx", "in", "dxobj", "[", "1", "]", "if", "rx", "in", "rx_codes", "]", "\n", "new_prs", "=", "[", "pr", "for", "pr", "in", "dxobj", "[", "2", "]", "if", "pr", "in", "pr_codes", "]", "\n", "new_visit", ".", "append", "(", "[", "dx", ",", "new_rxs", ",", "new_prs", "]", ")", "\n", "", "new_patient", ".", "append", "(", "new_visit", ")", "\n", "", "new_seqs", ".", "append", "(", "new_patient", ")", "\n", "", "return", "new_seqs", "\n", "\n"]], "home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.preprocess_hierarchical": [[114, 134], ["enumerate", "enumerate", "new_patients.append", "enumerate", "new_patient.append", "codes.append", "codes.extend", "codes.extend", "list", "numpy.array", "list", "list", "set", "numpy.array"], "function", ["None"], ["", "def", "preprocess_hierarchical", "(", "patients", ",", "options", ")", ":", "\n", "    ", "num_dx", "=", "options", "[", "'num_dx'", "]", "\n", "num_rx", "=", "options", "[", "'num_rx'", "]", "\n", "\n", "new_patients", "=", "[", "]", "\n", "for", "i", ",", "patient", "in", "enumerate", "(", "patients", ")", ":", "\n", "        ", "new_patient", "=", "[", "]", "\n", "for", "j", ",", "visit", "in", "enumerate", "(", "patient", ")", ":", "\n", "            ", "codes", "=", "[", "]", "\n", "for", "k", ",", "diagnosis", "in", "enumerate", "(", "visit", ")", ":", "\n", "                ", "dx_code", "=", "diagnosis", "[", "0", "]", "\n", "rx_codes", "=", "np", ".", "array", "(", "diagnosis", "[", "1", "]", ")", "+", "num_dx", "\n", "proc_codes", "=", "np", ".", "array", "(", "diagnosis", "[", "2", "]", ")", "+", "num_dx", "+", "num_rx", "\n", "codes", ".", "append", "(", "dx_code", ")", "\n", "codes", ".", "extend", "(", "list", "(", "rx_codes", ")", ")", "\n", "codes", ".", "extend", "(", "list", "(", "proc_codes", ")", ")", "\n", "", "new_patient", ".", "append", "(", "list", "(", "set", "(", "codes", ")", ")", ")", "\n", "", "new_patients", ".", "append", "(", "new_patient", ")", "\n", "\n", "", "return", "new_patients", "\n", "\n"]], "home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.sample_batch": [[136, 139], ["numpy.random.randint", "len"], "function", ["None"], ["", "def", "sample_batch", "(", "seqs", ",", "labels", ",", "batch_size", ")", ":", "\n", "    ", "idx", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "len", "(", "seqs", ")", "-", "batch_size", "+", "1", ")", "\n", "return", "seqs", "[", "idx", ":", "idx", "+", "batch_size", "]", ",", "labels", "[", "idx", ":", "idx", "+", "batch_size", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.preprocess_hf": [[141, 157], ["numpy.array", "numpy.max", "len", "numpy.zeros().astype", "enumerate", "numpy.transpose", "numpy.array().astype", "zip", "len", "numpy.zeros", "numpy.array"], "function", ["None"], ["", "def", "preprocess_hf", "(", "seqs", ",", "options", ")", ":", "\n", "    ", "lengths", "=", "np", ".", "array", "(", "[", "len", "(", "seq", ")", "for", "seq", "in", "seqs", "]", ")", "\n", "max_length", "=", "np", ".", "max", "(", "lengths", ")", "\n", "num_samples", "=", "len", "(", "seqs", ")", "\n", "x", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'input_size'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "#mask = np.zeros((num_samples, max_length)).astype('float32')", "\n", "\n", "for", "idx", ",", "seq", "in", "enumerate", "(", "seqs", ")", ":", "\n", "        ", "for", "xvec", ",", "subseq", "in", "zip", "(", "x", "[", "idx", "]", ",", "seq", ")", ":", "\n", "            ", "xvec", "[", "subseq", "]", "=", "1.", "\n", "#mask[idx, :lengths[idx]] = 1.", "\n", "\n", "", "", "x", "=", "np", ".", "transpose", "(", "x", ",", "(", "1", ",", "0", ",", "2", ")", ")", "#time-major RNN", "\n", "#mask = np.transpose(mask) #time-major RNN", "\n", "lengths", "=", "np", ".", "array", "(", "lengths", ")", ".", "astype", "(", "'int64'", ")", "\n", "return", "x", ",", "lengths", "\n", "\n"]], "home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.preprocess_dpm": [[159, 180], ["numpy.max", "len", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "enumerate", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.array().astype", "numpy.array", "zip", "zip", "zip", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.array", "len"], "function", ["None"], ["", "def", "preprocess_dpm", "(", "seqs", ",", "labels", ",", "options", ")", ":", "\n", "    ", "lengths", "=", "np", ".", "array", "(", "[", "len", "(", "seq", ")", "for", "seq", "in", "seqs", "]", ")", "-", "1", "\n", "max_length", "=", "np", ".", "max", "(", "lengths", ")", "\n", "num_samples", "=", "len", "(", "seqs", ")", "\n", "\n", "x", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'input_size'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "y", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'output_size'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "mask", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "\n", "for", "idx", ",", "(", "seq", ",", "lseq", ")", "in", "enumerate", "(", "zip", "(", "seqs", ",", "labels", ")", ")", ":", "\n", "        ", "for", "xvec", ",", "subseq", "in", "zip", "(", "x", "[", "idx", "]", ",", "seq", "[", ":", "-", "1", "]", ")", ":", "\n", "            ", "xvec", "[", "subseq", "]", "=", "1.", "\n", "", "for", "yvec", ",", "subseq", "in", "zip", "(", "y", "[", "idx", "]", ",", "lseq", "[", "1", ":", "]", ")", ":", "\n", "            ", "yvec", "[", "subseq", "]", "=", "1.", "\n", "", "mask", "[", "idx", ",", ":", "lengths", "[", "idx", "]", "]", "=", "1.", "\n", "\n", "", "x", "=", "np", ".", "transpose", "(", "x", ",", "(", "1", ",", "0", ",", "2", ")", ")", "#time-major RNN", "\n", "y", "=", "np", ".", "transpose", "(", "y", ",", "(", "1", ",", "0", ",", "2", ")", ")", "#time-major RNN", "\n", "mask", "=", "np", ".", "transpose", "(", "mask", ")", "#time-major RNN", "\n", "lengths", "=", "np", ".", "array", "(", "lengths", ")", ".", "astype", "(", "'int32'", ")", "\n", "return", "x", ",", "y", ",", "mask", ",", "lengths", "\n", "\n"]], "home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.count_parameters": [[182, 192], ["tensorflow.trainable_variables", "variable.get_shape", "str"], "function", ["None"], ["", "def", "count_parameters", "(", "exclude", "=", "\"rnn\"", ")", ":", "\n", "    ", "total_parameters", "=", "0", "\n", "for", "variable", "in", "tf", ".", "trainable_variables", "(", ")", ":", "\n", "        ", "if", "exclude", "in", "str", "(", "variable", ".", "name", ")", ":", "continue", "\n", "shape", "=", "variable", ".", "get_shape", "(", ")", "\n", "variable_parameters", "=", "1", "\n", "for", "dim", "in", "shape", ":", "\n", "            ", "variable_parameters", "*=", "dim", ".", "value", "\n", "", "total_parameters", "+=", "variable_parameters", "\n", "", "return", "total_parameters", "\n", "\n"]], "home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.recallTop": [[194, 204], ["list", "range", "numpy.array().mean", "len", "list", "list.append", "list.append", "numpy.array", "len", "len", "set", "set().intersection", "set", "set"], "function", ["None"], ["", "def", "recallTop", "(", "y_true", ",", "y_pred", ",", "rank", "=", "[", "5", ",", "10", ",", "20", ",", "30", "]", ")", ":", "\n", "    ", "recall", "=", "list", "(", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "y_pred", ")", ")", ":", "\n", "        ", "thisOne", "=", "list", "(", ")", "\n", "codes", "=", "y_true", "[", "i", "]", "\n", "tops", "=", "y_pred", "[", "i", "]", "\n", "for", "rk", "in", "rank", ":", "\n", "            ", "thisOne", ".", "append", "(", "len", "(", "set", "(", "codes", ")", ".", "intersection", "(", "set", "(", "tops", "[", ":", "rk", "]", ")", ")", ")", "*", "1.0", "/", "len", "(", "set", "(", "codes", ")", ")", ")", "\n", "", "recall", ".", "append", "(", "thisOne", ")", "\n", "", "return", "(", "np", ".", "array", "(", "recall", ")", ")", ".", "mean", "(", "axis", "=", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.preprocess_mp": [[206, 222], ["numpy.array", "numpy.max", "len", "numpy.zeros().astype", "numpy.zeros().astype", "enumerate", "numpy.transpose", "numpy.array().astype", "zip", "zip", "len", "numpy.zeros", "numpy.zeros", "numpy.array"], "function", ["None"], ["", "def", "preprocess_mp", "(", "seqs", ",", "labels", ",", "options", ")", ":", "\n", "    ", "lengths", "=", "np", ".", "array", "(", "[", "len", "(", "seq", ")", "for", "seq", "in", "seqs", "]", ")", "\n", "max_length", "=", "np", ".", "max", "(", "lengths", ")", "\n", "num_samples", "=", "len", "(", "seqs", ")", "\n", "\n", "x", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'input_size'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "y", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "options", "[", "'output_size'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "\n", "for", "idx", ",", "(", "seq", ",", "lseq", ")", "in", "enumerate", "(", "zip", "(", "seqs", ",", "labels", ")", ")", ":", "\n", "        ", "for", "xvec", ",", "subseq", "in", "zip", "(", "x", "[", "idx", "]", ",", "seq", ")", ":", "\n", "            ", "xvec", "[", "subseq", "]", "=", "1.", "\n", "", "y", "[", "idx", "]", "[", "lseq", "]", "=", "1.", "\n", "\n", "", "x", "=", "np", ".", "transpose", "(", "x", ",", "(", "1", ",", "0", ",", "2", ")", ")", "#time-major RNN", "\n", "lengths", "=", "np", ".", "array", "(", "lengths", ")", ".", "astype", "(", "'int32'", ")", "\n", "return", "x", ",", "y", ",", "lengths", "\n", "\n"]], "home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.st_preprocess_hf": [[224, 262], ["numpy.array", "numpy.max", "len", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "enumerate", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.array().astype", "enumerate", "len", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "enumerate", "numpy.array", "list", "list", "len", "len", "len", "len"], "function", ["None"], ["", "def", "st_preprocess_hf", "(", "patients", ",", "options", ")", ":", "\n", "    ", "lengths", "=", "np", ".", "array", "(", "[", "len", "(", "seq", ")", "for", "seq", "in", "patients", "]", ")", "\n", "max_length", "=", "np", ".", "max", "(", "lengths", ")", "\n", "num_samples", "=", "len", "(", "patients", ")", "\n", "dx", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ")", ")", ".", "astype", "(", "'int32'", ")", "\n", "rx", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_rx_per_dx'", "]", ")", ")", ".", "astype", "(", "'int32'", ")", "\n", "pr", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_pr_per_dx'", "]", ")", ")", ".", "astype", "(", "'int32'", ")", "\n", "\n", "dx_mask", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "rx_mask", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_rx_per_dx'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "pr_mask", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_pr_per_dx'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "\n", "for", "i", ",", "patient", "in", "enumerate", "(", "patients", ")", ":", "\n", "        ", "for", "j", ",", "visit", "in", "enumerate", "(", "patient", ")", ":", "\n", "            ", "for", "k", ",", "diagnosis", "in", "enumerate", "(", "visit", ")", ":", "\n", "                ", "dx", "[", "i", ",", "j", ",", "k", "]", "=", "diagnosis", "[", "0", "]", "\n", "dx_mask", "[", "i", ",", "j", ",", "k", "]", "=", "1.", "\n", "\n", "med_orders", "=", "list", "(", "diagnosis", "[", "1", "]", ")", "\n", "rx", "[", "i", ",", "j", ",", "k", "]", "[", ":", "len", "(", "med_orders", ")", "]", "=", "med_orders", "####For now we only use codes. In the future, we may use extra info such as instructions", "\n", "rx_mask", "[", "i", ",", "j", ",", "k", "]", "[", ":", "len", "(", "med_orders", ")", "]", "=", "1.", "\n", "\n", "proc_orders", "=", "list", "(", "diagnosis", "[", "2", "]", ")", "\n", "pr", "[", "i", ",", "j", ",", "k", "]", "[", ":", "len", "(", "proc_orders", ")", "]", "=", "proc_orders", "####For now we only use codes. In the future, we may use extra info such as components", "\n", "pr_mask", "[", "i", ",", "j", ",", "k", "]", "[", ":", "len", "(", "proc_orders", ")", "]", "=", "1.", "\n", "\n", "", "", "", "dx", "=", "np", ".", "transpose", "(", "dx", ",", "(", "1", ",", "0", ",", "2", ")", ")", "#time-major RNN", "\n", "rx", "=", "np", ".", "transpose", "(", "rx", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "pr", "=", "np", ".", "transpose", "(", "pr", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "dx_mask", "=", "np", ".", "transpose", "(", "dx_mask", ",", "(", "1", ",", "0", ",", "2", ")", ")", "\n", "rx_mask", "=", "np", ".", "transpose", "(", "rx_mask", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "pr_mask", "=", "np", ".", "transpose", "(", "pr_mask", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "lengths", "=", "np", ".", "array", "(", "lengths", ")", ".", "astype", "(", "'int32'", ")", "\n", "\n", "inputs", "=", "(", "dx", ",", "rx", ",", "pr", ")", "\n", "masks", "=", "(", "dx_mask", ",", "rx_mask", ",", "pr_mask", ")", "\n", "\n", "return", "inputs", ",", "masks", ",", "lengths", "\n", "\n"]], "home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.st_preprocess_dpm": [[264, 313], ["numpy.max", "len", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "enumerate", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.array().astype", "numpy.array", "zip", "enumerate", "zip", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "enumerate", "numpy.array", "len", "len", "len", "len", "len"], "function", ["None"], ["", "def", "st_preprocess_dpm", "(", "patients", ",", "labels", ",", "options", ")", ":", "\n", "    ", "lengths", "=", "np", ".", "array", "(", "[", "len", "(", "seq", ")", "for", "seq", "in", "patients", "]", ")", "-", "1", "\n", "max_length", "=", "np", ".", "max", "(", "lengths", ")", "\n", "num_samples", "=", "len", "(", "patients", ")", "\n", "\n", "dx", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ")", ")", ".", "astype", "(", "'int32'", ")", "\n", "rx", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_rx_per_dx'", "]", ")", ")", ".", "astype", "(", "'int32'", ")", "\n", "pr", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_pr_per_dx'", "]", ")", ")", ".", "astype", "(", "'int32'", ")", "\n", "\n", "dx_mask", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "rx_mask", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_rx_per_dx'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "pr_mask", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_pr_per_dx'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "\n", "y", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'output_size'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "mask", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "\n", "for", "i", ",", "(", "patient", ",", "lseq", ")", "in", "enumerate", "(", "zip", "(", "patients", ",", "labels", ")", ")", ":", "\n", "        ", "for", "j", ",", "visit", "in", "enumerate", "(", "patient", "[", ":", "-", "1", "]", ")", ":", "\n", "            ", "for", "k", ",", "diagnosis", "in", "enumerate", "(", "visit", ")", ":", "\n", "                ", "dx", "[", "i", ",", "j", ",", "k", "]", "=", "diagnosis", "[", "0", "]", "\n", "dx_mask", "[", "i", ",", "j", ",", "k", "]", "=", "1.", "\n", "\n", "med_orders", "=", "diagnosis", "[", "1", "]", "\n", "rx", "[", "i", ",", "j", ",", "k", "]", "[", ":", "len", "(", "med_orders", ")", "]", "=", "med_orders", "####For now we only use codes. In the future, we may use extra info such as instructions", "\n", "rx_mask", "[", "i", ",", "j", ",", "k", "]", "[", ":", "len", "(", "med_orders", ")", "]", "=", "1.", "\n", "\n", "proc_orders", "=", "diagnosis", "[", "2", "]", "\n", "pr", "[", "i", ",", "j", ",", "k", "]", "[", ":", "len", "(", "proc_orders", ")", "]", "=", "proc_orders", "####For now we only use codes. In the future, we may use extra info such as components", "\n", "pr_mask", "[", "i", ",", "j", ",", "k", "]", "[", ":", "len", "(", "proc_orders", ")", "]", "=", "1.", "\n", "", "", "for", "yvec", ",", "subseq", "in", "zip", "(", "y", "[", "i", "]", ",", "lseq", "[", "1", ":", "]", ")", ":", "\n", "            ", "yvec", "[", "subseq", "]", "=", "1.", "\n", "", "mask", "[", "i", ",", ":", "lengths", "[", "i", "]", "]", "=", "1.", "\n", "\n", "", "dx", "=", "np", ".", "transpose", "(", "dx", ",", "(", "1", ",", "0", ",", "2", ")", ")", "#time-major RNN", "\n", "rx", "=", "np", ".", "transpose", "(", "rx", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "pr", "=", "np", ".", "transpose", "(", "pr", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "\n", "dx_mask", "=", "np", ".", "transpose", "(", "dx_mask", ",", "(", "1", ",", "0", ",", "2", ")", ")", "\n", "rx_mask", "=", "np", ".", "transpose", "(", "rx_mask", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "pr_mask", "=", "np", ".", "transpose", "(", "pr_mask", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "mask", "=", "np", ".", "transpose", "(", "mask", ")", "#time-major RNN", "\n", "\n", "y", "=", "np", ".", "transpose", "(", "y", ",", "(", "1", ",", "0", ",", "2", ")", ")", "#time-major RNN", "\n", "lengths", "=", "np", ".", "array", "(", "lengths", ")", ".", "astype", "(", "'int32'", ")", "\n", "\n", "inputs", "=", "(", "dx", ",", "rx", ",", "pr", ")", "\n", "masks", "=", "(", "dx_mask", ",", "rx_mask", ",", "pr_mask", ",", "mask", ")", "\n", "\n", "return", "inputs", ",", "y", ",", "masks", ",", "lengths", "\n", "\n"]], "home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.st_preprocess_mp": [[315, 358], ["numpy.array", "numpy.max", "len", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "enumerate", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.array().astype", "zip", "enumerate", "len", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "enumerate", "numpy.array", "len", "len", "len", "len"], "function", ["None"], ["", "def", "st_preprocess_mp", "(", "patients", ",", "labels", ",", "options", ")", ":", "\n", "    ", "lengths", "=", "np", ".", "array", "(", "[", "len", "(", "seq", ")", "for", "seq", "in", "patients", "]", ")", "\n", "max_length", "=", "np", ".", "max", "(", "lengths", ")", "\n", "num_samples", "=", "len", "(", "patients", ")", "\n", "\n", "dx", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ")", ")", ".", "astype", "(", "'int32'", ")", "\n", "dx_mask", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "rx", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_rx_per_dx'", "]", ")", ")", ".", "astype", "(", "'int32'", ")", "\n", "rx_mask", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_rx_per_dx'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "pr", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_pr_per_dx'", "]", ")", ")", ".", "astype", "(", "'int32'", ")", "\n", "pr_mask", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_pr_per_dx'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "\n", "y", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "options", "[", "'output_size'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "\n", "for", "i", ",", "(", "patient", ",", "lseq", ")", "in", "enumerate", "(", "zip", "(", "patients", ",", "labels", ")", ")", ":", "\n", "        ", "for", "j", ",", "visit", "in", "enumerate", "(", "patient", ")", ":", "\n", "            ", "for", "k", ",", "diagnosis", "in", "enumerate", "(", "visit", ")", ":", "\n", "                ", "dx", "[", "i", ",", "j", ",", "k", "]", "=", "diagnosis", "[", "0", "]", "\n", "dx_mask", "[", "i", ",", "j", ",", "k", "]", "=", "1.", "\n", "\n", "med_orders", "=", "diagnosis", "[", "1", "]", "\n", "rx", "[", "i", ",", "j", ",", "k", "]", "[", ":", "len", "(", "med_orders", ")", "]", "=", "med_orders", "####For now we only use codes. In the future, we may use extra info such as instructions", "\n", "rx_mask", "[", "i", ",", "j", ",", "k", "]", "[", ":", "len", "(", "med_orders", ")", "]", "=", "1.", "\n", "\n", "proc_orders", "=", "diagnosis", "[", "2", "]", "\n", "pr", "[", "i", ",", "j", ",", "k", "]", "[", ":", "len", "(", "proc_orders", ")", "]", "=", "proc_orders", "####For now we only use codes. In the future, we may use extra info such as components", "\n", "pr_mask", "[", "i", ",", "j", ",", "k", "]", "[", ":", "len", "(", "proc_orders", ")", "]", "=", "1.", "\n", "", "", "y", "[", "i", "]", "[", "lseq", "]", "=", "1.", "\n", "\n", "", "dx", "=", "np", ".", "transpose", "(", "dx", ",", "(", "1", ",", "0", ",", "2", ")", ")", "#time-major RNN", "\n", "rx", "=", "np", ".", "transpose", "(", "rx", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "pr", "=", "np", ".", "transpose", "(", "pr", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "\n", "dx_mask", "=", "np", ".", "transpose", "(", "dx_mask", ",", "(", "1", ",", "0", ",", "2", ")", ")", "\n", "rx_mask", "=", "np", ".", "transpose", "(", "rx_mask", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "pr_mask", "=", "np", ".", "transpose", "(", "pr_mask", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "\n", "lengths", "=", "np", ".", "array", "(", "lengths", ")", ".", "astype", "(", "'int32'", ")", "\n", "\n", "inputs", "=", "(", "dx", ",", "rx", ",", "pr", ")", "\n", "masks", "=", "(", "dx_mask", ",", "rx_mask", ",", "pr_mask", ")", "\n", "\n", "return", "inputs", ",", "y", ",", "masks", ",", "lengths", "\n", "\n"]], "home.repos.pwc.inspect_result.mp2893_mime.None.mime_util.st_preprocess_hf_aux": [[360, 409], ["numpy.array", "numpy.max", "len", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "numpy.zeros().astype", "enumerate", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.transpose", "numpy.array().astype", "enumerate", "len", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "enumerate", "numpy.array", "list", "list", "len", "len", "len", "len"], "function", ["None"], ["", "def", "st_preprocess_hf_aux", "(", "patients", ",", "options", ")", ":", "\n", "    ", "lengths", "=", "np", ".", "array", "(", "[", "len", "(", "seq", ")", "for", "seq", "in", "patients", "]", ")", "\n", "max_length", "=", "np", ".", "max", "(", "lengths", ")", "\n", "num_samples", "=", "len", "(", "patients", ")", "\n", "dx", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ")", ")", ".", "astype", "(", "'int32'", ")", "\n", "rx", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_rx_per_dx'", "]", ")", ")", ".", "astype", "(", "'int32'", ")", "\n", "pr", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_pr_per_dx'", "]", ")", ")", ".", "astype", "(", "'int32'", ")", "\n", "\n", "dx_mask", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "rx_mask", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_rx_per_dx'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "pr_mask", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'max_pr_per_dx'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "\n", "dx_label", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'num_dx'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "rx_label", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'num_rx'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "pr_label", "=", "np", ".", "zeros", "(", "(", "num_samples", ",", "max_length", ",", "options", "[", "'max_dx_per_visit'", "]", ",", "options", "[", "'num_pr'", "]", ")", ")", ".", "astype", "(", "'float32'", ")", "\n", "\n", "for", "i", ",", "patient", "in", "enumerate", "(", "patients", ")", ":", "\n", "        ", "for", "j", ",", "visit", "in", "enumerate", "(", "patient", ")", ":", "\n", "            ", "for", "k", ",", "diagnosis", "in", "enumerate", "(", "visit", ")", ":", "\n", "                ", "dx", "[", "i", ",", "j", ",", "k", "]", "=", "diagnosis", "[", "0", "]", "\n", "dx_mask", "[", "i", ",", "j", ",", "k", "]", "=", "1.", "\n", "dx_label", "[", "i", ",", "j", ",", "k", "]", "[", "diagnosis", "[", "0", "]", "]", "=", "1.", "\n", "\n", "med_orders", "=", "list", "(", "diagnosis", "[", "1", "]", ")", "\n", "rx", "[", "i", ",", "j", ",", "k", "]", "[", ":", "len", "(", "med_orders", ")", "]", "=", "med_orders", "####For now we only use codes. In the future, we may use extra info such as instructions", "\n", "rx_mask", "[", "i", ",", "j", ",", "k", "]", "[", ":", "len", "(", "med_orders", ")", "]", "=", "1.", "\n", "rx_label", "[", "i", ",", "j", ",", "k", "]", "[", "med_orders", "]", "=", "1.", "\n", "\n", "proc_orders", "=", "list", "(", "diagnosis", "[", "2", "]", ")", "\n", "pr", "[", "i", ",", "j", ",", "k", "]", "[", ":", "len", "(", "proc_orders", ")", "]", "=", "proc_orders", "####For now we only use codes. In the future, we may use extra info such as components", "\n", "pr_mask", "[", "i", ",", "j", ",", "k", "]", "[", ":", "len", "(", "proc_orders", ")", "]", "=", "1.", "\n", "pr_label", "[", "i", ",", "j", ",", "k", "]", "[", "proc_orders", "]", "=", "1.", "\n", "\n", "", "", "", "dx", "=", "np", ".", "transpose", "(", "dx", ",", "(", "1", ",", "0", ",", "2", ")", ")", "#time-major RNN", "\n", "rx", "=", "np", ".", "transpose", "(", "rx", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "pr", "=", "np", ".", "transpose", "(", "pr", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "dx_mask", "=", "np", ".", "transpose", "(", "dx_mask", ",", "(", "1", ",", "0", ",", "2", ")", ")", "\n", "rx_mask", "=", "np", ".", "transpose", "(", "rx_mask", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "pr_mask", "=", "np", ".", "transpose", "(", "pr_mask", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "dx_label", "=", "np", ".", "transpose", "(", "dx_label", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "rx_label", "=", "np", ".", "transpose", "(", "rx_label", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "pr_label", "=", "np", ".", "transpose", "(", "pr_label", ",", "(", "1", ",", "0", ",", "2", ",", "3", ")", ")", "\n", "lengths", "=", "np", ".", "array", "(", "lengths", ")", ".", "astype", "(", "'int32'", ")", "\n", "\n", "inputs", "=", "(", "dx", ",", "rx", ",", "pr", ")", "\n", "masks", "=", "(", "dx_mask", ",", "rx_mask", ",", "pr_mask", ")", "\n", "labels", "=", "(", "dx_label", ",", "rx_label", ",", "pr_label", ")", "\n", "\n", "return", "inputs", ",", "labels", ",", "masks", ",", "lengths", "\n", "", ""]]}