{"home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_response_design_matrix": [[47, 70], ["data.astype.astype", "numpy.delete", "sklearn.preprocessing.LabelEncoder", "preprocessing.LabelEncoder.fit", "preprocessing.LabelEncoder.transform", "len", "sklearn.preprocessing.OneHotEncoder", "preprocessing.OneHotEncoder.fit", "preprocessing.OneHotEncoder.transform().toarray", "numpy.append", "numpy.where", "numpy.median", "numpy.any", "numpy.isnan", "preprocessing.OneHotEncoder.transform", "numpy.isnan", "numpy.isnan"], "function", ["None"], ["def", "get_response_design_matrix", "(", "data", ",", "indcat", ",", "indresp", "=", "0", ",", "naind", "=", "None", ",", "respToCat", "=", "False", ",", "narm", "=", "False", ")", ":", "\n", "    ", "itransform", "=", "indcat", "+", "[", "indresp", "]", "if", "respToCat", "else", "indcat", "\n", "for", "i", "in", "itransform", ":", "\n", "        ", "le", "=", "preprocessing", ".", "LabelEncoder", "(", ")", "\n", "le", ".", "fit", "(", "data", "[", ":", ",", "i", "]", ")", "\n", "data", "[", ":", ",", "i", "]", "=", "le", ".", "transform", "(", "data", "[", ":", ",", "i", "]", ")", "\n", "", "data", "[", "np", ".", "where", "(", "data", "==", "\"NULL\"", ")", "]", "=", "np", ".", "nan", "\n", "data", "=", "data", ".", "astype", "(", "np", ".", "float", ")", "\n", "if", "naind", "is", "not", "None", ":", "\n", "        ", "for", "ina", "in", "naind", ":", "data", "[", "np", ".", "isnan", "(", "data", "[", ":", ",", "ina", "]", ")", ",", "ina", "]", "=", "np", ".", "median", "(", "data", "[", "~", "np", ".", "isnan", "(", "data", "[", ":", ",", "ina", "]", ")", ",", "ina", "]", ")", "\n", "", "if", "narm", ":", "\n", "        ", "mask", "=", "~", "np", ".", "any", "(", "np", ".", "isnan", "(", "data", ")", ",", "axis", "=", "1", ")", "\n", "data", "=", "data", "[", "mask", "]", "\n", "", "contvars", "=", "np", ".", "delete", "(", "data", ",", "[", "indresp", "]", "+", "indcat", ",", "axis", "=", "1", ")", "\n", "y", "=", "data", "[", ":", ",", "indresp", "]", "\n", "if", "len", "(", "indcat", ")", ">", "0", ":", "\n", "        ", "enc", "=", "preprocessing", ".", "OneHotEncoder", "(", ")", "\n", "enc", ".", "fit", "(", "data", "[", ":", ",", "indcat", "]", ")", "\n", "dummies", "=", "enc", ".", "transform", "(", "data", "[", ":", ",", "indcat", "]", ")", ".", "toarray", "(", ")", "\n", "X", "=", "np", ".", "append", "(", "contvars", ",", "dummies", ",", "axis", "=", "1", ")", "\n", "", "else", ":", "\n", "        ", "X", "=", "contvars", "\n", "", "return", "[", "y", ",", "X", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.sum_sq_fct": [[72, 78], ["numpy.zeros", "range", "numpy.random.normal().reshape", "numpy.random.rand", "numpy.random.normal"], "function", ["None"], ["", "def", "sum_sq_fct", "(", "ntot", ",", "p", "=", "10", ",", "dist", "=", "\"norm\"", ")", ":", "\n", "    ", "if", "dist", "==", "\"norm\"", ":", "X", "=", "np", ".", "random", ".", "normal", "(", "size", "=", "(", "ntot", "*", "p", ")", ")", ".", "reshape", "(", "(", "ntot", ",", "p", ")", ")", "\n", "if", "dist", "==", "\"unif\"", ":", "X", "=", "np", ".", "random", ".", "rand", "(", "ntot", ",", "p", ")", "\n", "r", "=", "np", ".", "zeros", "(", "X", ".", "shape", "[", "0", "]", ")", "\n", "for", "i", "in", "range", "(", "0", ",", "X", ".", "shape", "[", "1", "]", ")", ":", "r", "+=", "(", "X", "[", ":", ",", "i", "]", ")", "**", "2", "\n", "return", "(", "X", ",", "r", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.load_simulate_data": [[80, 265], ["list", "numpy.random.shuffle", "numpy.min", "int", "numpy.random.seed", "numpy.genfromtxt", "numpy.genfromtxt", "Compare_boosting.get_response_design_matrix", "numpy.genfromtxt", "Compare_boosting.get_response_design_matrix", "numpy.genfromtxt", "Compare_boosting.get_response_design_matrix", "numpy.genfromtxt", "numpy.genfromtxt", "Compare_boosting.get_response_design_matrix", "numpy.genfromtxt", "Compare_boosting.get_response_design_matrix", "numpy.genfromtxt", "numpy.genfromtxt", "numpy.append", "Compare_boosting.get_response_design_matrix", "numpy.genfromtxt", "Compare_boosting.get_response_design_matrix", "numpy.genfromtxt", "Compare_boosting.get_response_design_matrix", "numpy.genfromtxt", "Compare_boosting.get_response_design_matrix", "numpy.genfromtxt", "Compare_boosting.get_response_design_matrix", "numpy.genfromtxt", "Compare_boosting.get_response_design_matrix", "numpy.genfromtxt", "numpy.genfromtxt", "numpy.genfromtxt", "numpy.genfromtxt", "numpy.append", "numpy.append", "sklearn.datasets.load_svmlight_file", "sklearn.datasets.load_svmlight_file", "numpy.append", "numpy.append", "sklearn.datasets.load_svmlight_file", "sklearn.datasets.load_svmlight_file", "sklearn.datasets.load_svmlight_file", "numpy.append", "numpy.append", "sklearn.datasets.load_svmlight_file", "data[].toarray", "sklearn.make_friedman3", "numpy.random.normal", "numpy.append", "numpy.random.rand", "numpy.exp", "sklearn.make_classification", "numpy.random.normal().reshape", "numpy.zeros", "range", "numpy.random.binomial", "sklearn.make_classification", "Compare_boosting.sum_sq_fct", "r.copy", "range", "numpy.isnan().any", "numpy.arange", "len", "numpy.unique", "int", "range", "train[].toarray", "test[].toarray", "numpy.append", "test[].toarray", "numpy.append", "numpy.random.normal", "numpy.random.poisson", "numpy.random.gamma", "sklearn.make_friedman3", "sklearn.make_friedman3", "numpy.random.rand", "numpy.exp", "numpy.random.rand", "numpy.exp", "numpy.random.poisson", "numpy.random.gamma", "numpy.random.normal", "len", "len", "numpy.random.shuffle", "numpy.unique", "range", "train[].toarray", "valid[].toarray", "numpy.random.normal", "numpy.sum", "numpy.exp", "len", "numpy.isnan", "len", "len", "numpy.min", "numpy.sin", "numpy.sin", "numpy.unique", "numpy.sin", "numpy.sin", "numpy.sin", "numpy.sin", "int", "int"], "function", ["home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_response_design_matrix", "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_response_design_matrix", "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_response_design_matrix", "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_response_design_matrix", "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_response_design_matrix", "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_response_design_matrix", "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_response_design_matrix", "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_response_design_matrix", "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_response_design_matrix", "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_response_design_matrix", "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_response_design_matrix", "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.sum_sq_fct"], ["", "def", "load_simulate_data", "(", "dataset", ",", "n", ",", "gamma", "=", "2", ",", "sigma", "=", "1", ",", "seed", "=", "None", ",", "\n", "yl", "=", "0", ",", "yu", "=", "1", ",", "path", "=", "None", ",", "npart", "=", "3", ",", "FullDataSet", "=", "False", ")", ":", "\n", "    ", "ntot", "=", "npart", "*", "n", "\n", "if", "seed", "is", "not", "None", ":", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "\"\"\"\n    Real regression data\n    \"\"\"", "\n", "if", "dataset", "==", "\"birthweight\"", ":", "##n=150, p=5", "\n", "# Source: tbm package (see Load_Hothorn_data.R file)", "\n", "        ", "data", "=", "np", ".", "genfromtxt", "(", "path", "+", "'birthweight.csv'", ",", "delimiter", "=", "','", ",", "dtype", "=", "float", ",", "skip_header", "=", "1", ")", "\n", "X", "=", "data", "[", ":", ",", "1", ":", "6", "]", "\n", "y", "=", "data", "[", ":", ",", "0", "]", "\n", "", "if", "dataset", "==", "\"malnutrition\"", ":", "##n=24166, p=42", "\n", "# Source: tbm package (see Load_Hothorn_data.R file)", "\n", "        ", "data", "=", "np", ".", "genfromtxt", "(", "path", "+", "'malnutrition.csv'", ",", "delimiter", "=", "','", ",", "dtype", "=", "float", ",", "skip_header", "=", "1", ")", "\n", "y", ",", "X", "=", "get_response_design_matrix", "(", "data", ",", "indresp", "=", "0", ",", "indcat", "=", "range", "(", "7", ",", "21", ")", ",", "respToCat", "=", "False", ")", "\n", "", "if", "dataset", "in", "[", "\"insurance\"", ",", "\"liberty\"", "]", ":", "##n=50999", "\n", "#Liberty Mutual Group: Property Inspection Prediction", "\n", "#Source:  https://www.kaggle.com/c/liberty-mutual-group-property-inspection-prediction", "\n", "        ", "data", "=", "np", ".", "genfromtxt", "(", "path", "+", "'insurance_data.csv'", ",", "delimiter", "=", "','", ",", "skip_header", "=", "1", ",", "dtype", "=", "str", ")", "\n", "indcat", "=", "[", "4", ",", "5", ",", "6", ",", "7", ",", "8", ",", "9", ",", "11", ",", "12", ",", "14", ",", "15", ",", "16", ",", "17", ",", "20", ",", "22", ",", "25", ",", "28", ",", "29", ",", "30", "]", "\n", "y", ",", "X", "=", "get_response_design_matrix", "(", "data", ",", "indresp", "=", "0", ",", "indcat", "=", "indcat", ")", "\n", "y", "=", "y", "-", "1", "##Shift by one, otherwise the Poisson distribution cannot fit since there are no zeros", "\n", "", "\"\"\"\n    Real classification data\n    \"\"\"", "\n", "if", "dataset", "==", "\"digits\"", ":", "##n=5620", "\n", "# Source: https://archive.ics.uci.edu/ml/datasets/Pen-Based+Recognition+of+Handwritten+Digits", "\n", "        ", "data", "=", "np", ".", "genfromtxt", "(", "path", "+", "'digits.csv'", ",", "delimiter", "=", "','", ",", "dtype", "=", "str", ")", "\n", "y", ",", "X", "=", "get_response_design_matrix", "(", "data", ",", "indresp", "=", "64", ",", "indcat", "=", "[", "]", ",", "respToCat", "=", "True", ")", "\n", "", "if", "dataset", "==", "\"cancer\"", ":", "##n=699", "\n", "# Source: http://archive.ics.uci.edu/ml/datasets/Breast+Cancer+Wisconsin+(Original)", "\n", "        ", "data", "=", "np", ".", "genfromtxt", "(", "path", "+", "'cancer_data.csv'", ",", "delimiter", "=", "','", ")", "\n", "X", "=", "data", "[", ":", ",", "1", ":", "10", "]", "\n", "y", "=", "data", "[", ":", ",", "10", "]", "\n", "y", "[", "y", "==", "2", "]", "=", "0", "\n", "y", "[", "y", "==", "4", "]", "=", "1", "\n", "", "if", "dataset", "==", "\"bank\"", ":", "##n=41188", "\n", "# Source: http://archive.ics.uci.edu/ml/datasets/Bank+Marketing", "\n", "##Variable duration removed in csv as suggested on the website", "\n", "        ", "data", "=", "np", ".", "genfromtxt", "(", "path", "+", "'bank.csv'", ",", "delimiter", "=", "','", ",", "dtype", "=", "str", ",", "skip_header", "=", "1", ")", "\n", "indcat", "=", "range", "(", "1", ",", "10", ")", "+", "[", "13", "]", "\n", "y", ",", "X", "=", "get_response_design_matrix", "(", "data", ",", "indresp", "=", "19", ",", "indcat", "=", "indcat", ",", "respToCat", "=", "True", ")", "\n", "", "if", "dataset", "==", "\"car\"", ":", "##n=1728", "\n", "##source: https://archive.ics.uci.edu/ml/datasets/car+evaluation", "\n", "        ", "data", "=", "np", ".", "genfromtxt", "(", "path", "+", "'car_data.csv'", ",", "delimiter", "=", "','", ",", "dtype", "=", "str", ")", "\n", "indcat", "=", "[", "0", ",", "1", ",", "2", ",", "3", ",", "4", ",", "5", "]", "\n", "y", ",", "X", "=", "get_response_design_matrix", "(", "data", ",", "indresp", "=", "6", ",", "indcat", "=", "indcat", ",", "respToCat", "=", "True", ")", "\n", "", "if", "dataset", "==", "\"adult\"", ":", "##n=48842", "\n", "# Source: http://archive.ics.uci.edu/ml/datasets/Adult", "\n", "        ", "datatrain", "=", "np", ".", "genfromtxt", "(", "path", "+", "'adult_train_data.csv'", ",", "delimiter", "=", "','", ",", "dtype", "=", "str", ")", "\n", "datatest", "=", "np", ".", "genfromtxt", "(", "path", "+", "'adult_test_data.csv'", ",", "delimiter", "=", "','", ",", "dtype", "=", "str", ")", "\n", "data", "=", "np", ".", "append", "(", "datatrain", ",", "datatest", ",", "axis", "=", "0", ")", "\n", "indcat", "=", "[", "1", ",", "3", ",", "5", ",", "6", ",", "7", ",", "8", ",", "9", ",", "13", "]", "\n", "y", ",", "X", "=", "get_response_design_matrix", "(", "data", ",", "indresp", "=", "14", ",", "indcat", "=", "indcat", ",", "respToCat", "=", "True", ")", "\n", "", "if", "dataset", "==", "\"glass\"", ":", "##n=214", "\n", "        ", "data", "=", "np", ".", "genfromtxt", "(", "path", "+", "'glass.csv'", ",", "delimiter", "=", "','", ",", "dtype", "=", "str", ")", "\n", "y", ",", "X", "=", "get_response_design_matrix", "(", "data", ",", "indresp", "=", "9", ",", "indcat", "=", "[", "]", ",", "respToCat", "=", "True", ")", "\n", "", "if", "dataset", "==", "\"ionosphere\"", ":", "##n=351", "\n", "##source https://archive.ics.uci.edu/ml/datasets/ionosphere", "\n", "        ", "data", "=", "np", ".", "genfromtxt", "(", "path", "+", "'ionosphere.csv'", ",", "delimiter", "=", "','", ",", "dtype", "=", "str", ")", "\n", "y", ",", "X", "=", "get_response_design_matrix", "(", "data", ",", "indresp", "=", "34", ",", "indcat", "=", "[", "]", ",", "respToCat", "=", "True", ")", "\n", "", "if", "dataset", "==", "\"letter\"", ":", "##n=20000", "\n", "##source: https://archive.ics.uci.edu/ml/datasets/letter+recognition", "\n", "        ", "data", "=", "np", ".", "genfromtxt", "(", "path", "+", "'letter.csv'", ",", "delimiter", "=", "','", ",", "dtype", "=", "str", ")", "\n", "y", ",", "X", "=", "get_response_design_matrix", "(", "data", ",", "indresp", "=", "0", ",", "indcat", "=", "[", "]", ",", "respToCat", "=", "True", ")", "\n", "", "if", "dataset", "==", "\"sonar\"", ":", "##n=208", "\n", "##source: http://archive.ics.uci.edu/ml/datasets/connectionist+bench+(sonar,+mines+vs.+rocks)", "\n", "        ", "data", "=", "np", ".", "genfromtxt", "(", "path", "+", "'sonar.csv'", ",", "delimiter", "=", "','", ",", "dtype", "=", "str", ")", "\n", "y", ",", "X", "=", "get_response_design_matrix", "(", "data", ",", "indresp", "=", "60", ",", "indcat", "=", "[", "]", ",", "respToCat", "=", "True", ")", "\n", "", "if", "dataset", "==", "\"satimage\"", ":", "##n=6438", "\n", "##source: https://archive.ics.uci.edu/ml/datasets/Statlog+(Landsat+Satellite)", "\n", "        ", "data", "=", "np", ".", "genfromtxt", "(", "path", "+", "'satimage.csv'", ",", "delimiter", "=", "','", ",", "dtype", "=", "str", ")", "\n", "y", ",", "X", "=", "get_response_design_matrix", "(", "data", ",", "indresp", "=", "36", ",", "indcat", "=", "[", "]", ",", "respToCat", "=", "True", ")", "\n", "", "if", "dataset", "==", "\"smartphone\"", ":", "##n=10299", "\n", "# Source: https://archive.ics.uci.edu/ml/datasets/Smartphone-Based+Recognition+of+Human+Activities+and+Postural+Transitions", "\n", "        ", "Xtrain", "=", "np", ".", "genfromtxt", "(", "path", "+", "'smartphone_X_train.csv'", ",", "delimiter", "=", "','", ")", "\n", "Xtest", "=", "np", ".", "genfromtxt", "(", "path", "+", "'smartphone_X_test.csv'", ",", "delimiter", "=", "','", ")", "\n", "ytrain", "=", "np", ".", "genfromtxt", "(", "path", "+", "'smartphone_y_train.csv'", ",", "delimiter", "=", "','", ")", "\n", "ytest", "=", "np", ".", "genfromtxt", "(", "path", "+", "'smartphone_y_test.csv'", ",", "delimiter", "=", "','", ")", "\n", "X", "=", "np", ".", "append", "(", "Xtrain", ",", "Xtest", ",", "axis", "=", "0", ")", "\n", "y", "=", "np", ".", "append", "(", "ytrain", ",", "ytest", ",", "axis", "=", "0", ")", "\n", "y", "=", "y", "-", "1", "\n", "", "if", "dataset", "==", "\"usps\"", ":", "##n=9298, p=256, classes=10", "\n", "##https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass.html", "\n", "        ", "train", "=", "load_svmlight_file", "(", "path", "+", "'usps.bz2'", ")", "\n", "test", "=", "load_svmlight_file", "(", "path", "+", "'usps.t.bz2'", ")", "\n", "X", "=", "np", ".", "append", "(", "train", "[", "0", "]", ".", "toarray", "(", ")", ",", "test", "[", "0", "]", ".", "toarray", "(", ")", ",", "axis", "=", "0", ")", "\n", "y", "=", "np", ".", "append", "(", "train", "[", "1", "]", ",", "test", "[", "1", "]", ",", "axis", "=", "0", ")", "\n", "y", "=", "y", "-", "1", "\n", "", "if", "dataset", "==", "\"ijcnn\"", ":", "##n=141691, p=22, classes=2", "\n", "##https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/binary.html", "\n", "        ", "test", "=", "load_svmlight_file", "(", "path", "+", "'ijcnn1.t.bz2'", ")", "\n", "valid", "=", "load_svmlight_file", "(", "path", "+", "'ijcnn1.val.bz2'", ")", "\n", "train", "=", "load_svmlight_file", "(", "path", "+", "'ijcnn1.tr.bz2'", ")", "\n", "X", "=", "np", ".", "append", "(", "np", ".", "append", "(", "train", "[", "0", "]", ".", "toarray", "(", ")", ",", "valid", "[", "0", "]", ".", "toarray", "(", ")", ",", "axis", "=", "0", ")", ",", "test", "[", "0", "]", ".", "toarray", "(", ")", ",", "axis", "=", "0", ")", "\n", "y", "=", "np", ".", "append", "(", "np", ".", "append", "(", "train", "[", "1", "]", ",", "valid", "[", "1", "]", ",", "axis", "=", "0", ")", ",", "test", "[", "1", "]", ",", "axis", "=", "0", ")", "\n", "y", "[", "y", "==", "-", "1", "]", "=", "0", "\n", "", "if", "dataset", "==", "\"covtype\"", ":", "##n=581012, p=54, classes=7", "\n", "##https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass.html", "\n", "        ", "data", "=", "load_svmlight_file", "(", "path", "+", "'covtype.bz2'", ")", "\n", "X", "=", "data", "[", "0", "]", ".", "toarray", "(", ")", "\n", "y", "=", "data", "[", "1", "]", "\n", "y", "=", "y", "-", "1", "\n", "", "\"\"\"\n    Simulated regression data\n    \"\"\"", "\n", "if", "dataset", "in", "[", "\"poisson\"", ",", "\"gamma\"", ",", "\"tobit\"", "]", ":", "\n", "        ", "X", ",", "lp", "=", "datasets", ".", "make_friedman3", "(", "n_samples", "=", "ntot", ")", "\n", "lp", "=", "lp", "*", "5", "+", "0.2", "\n", "if", "dataset", "==", "\"tobit\"", ":", "\n", "            ", "y", "=", "np", ".", "random", ".", "normal", "(", "loc", "=", "lp", ",", "scale", "=", "sigma", ")", "\n", "y", "[", "y", ">=", "yu", "]", "=", "yu", "\n", "y", "[", "y", "<=", "yl", "]", "=", "yl", "\n", "", "if", "dataset", "==", "\"poisson\"", ":", "y", "=", "np", ".", "random", ".", "poisson", "(", "lp", ")", "\n", "if", "dataset", "==", "\"gamma\"", ":", "y", "=", "np", ".", "random", ".", "gamma", "(", "scale", "=", "lp", "/", "gamma", ",", "shape", "=", "gamma", ")", "\n", "", "if", "dataset", "in", "[", "\"msr_f3\"", ",", "\"msr_r\"", "]", ":", "\n", "        ", "if", "dataset", "in", "[", "\"msr_f3\"", "]", ":", "\n", "            ", "X_mean", ",", "lp_mean", "=", "datasets", ".", "make_friedman3", "(", "n_samples", "=", "ntot", ")", "\n", "X_sd", ",", "lp_sd", "=", "datasets", ".", "make_friedman3", "(", "n_samples", "=", "ntot", ")", "\n", "lp_sd", "=", "lp_sd", "*", "5", "+", "0.2", "\n", "lp_mean", "=", "lp_mean", "*", "5", "+", "0.2", "\n", "", "if", "dataset", "in", "[", "\"msr_r\"", "]", ":", "##Simulate according to Ridgeway (1999) PhD thesis", "\n", "            ", "X_mean", "=", "np", ".", "random", ".", "rand", "(", "ntot", ",", "2", ")", "\n", "lp_mean", "=", "np", ".", "exp", "(", "2", "*", "np", ".", "sin", "(", "3", "*", "X_mean", "[", ":", ",", "0", "]", "+", "5", "*", "X_mean", "[", ":", ",", "0", "]", "**", "2", ")", "-", "2", "*", "np", ".", "sin", "(", "3", "*", "(", "X_mean", "[", ":", ",", "1", "]", "+", "0.1", ")", "+", "5", "*", "(", "X_mean", "[", ":", ",", "1", "]", "+", "0.1", ")", "**", "2", ")", ")", "\n", "X_sd", "=", "np", ".", "random", ".", "rand", "(", "ntot", ",", "2", ")", "\n", "lp_sd", "=", "np", ".", "exp", "(", "2", "*", "np", ".", "sin", "(", "3", "*", "X_sd", "[", ":", ",", "0", "]", "+", "5", "*", "X_sd", "[", ":", ",", "0", "]", "**", "2", ")", "-", "2", "*", "np", ".", "sin", "(", "3", "*", "(", "X_sd", "[", ":", ",", "1", "]", "+", "0.1", ")", "+", "5", "*", "(", "X_sd", "[", ":", ",", "1", "]", "+", "0.1", ")", "**", "2", ")", ")", "\n", "", "y", "=", "np", ".", "random", ".", "normal", "(", "loc", "=", "lp_mean", ",", "scale", "=", "lp_sd", ")", "\n", "X", "=", "np", ".", "append", "(", "X_mean", ",", "X_sd", ",", "axis", "=", "1", ")", "\n", "", "if", "dataset", "in", "[", "\"poisson_r\"", ",", "\"gamma_r\"", ",", "\"tobit_r\"", "]", ":", "##Simulate according to Ridgeway (1999) PhD thesis", "\n", "        ", "X", "=", "np", ".", "random", ".", "rand", "(", "ntot", ",", "2", ")", "\n", "lp", "=", "np", ".", "exp", "(", "2", "*", "np", ".", "sin", "(", "3", "*", "X", "[", ":", ",", "0", "]", "+", "5", "*", "X", "[", ":", ",", "0", "]", "**", "2", ")", "-", "2", "*", "np", ".", "sin", "(", "3", "*", "(", "X", "[", ":", ",", "1", "]", "+", "0.1", ")", "+", "5", "*", "(", "X", "[", ":", ",", "1", "]", "+", "0.1", ")", "**", "2", ")", ")", "\n", "if", "dataset", "==", "\"poisson_r\"", ":", "y", "=", "np", ".", "random", ".", "poisson", "(", "lp", ")", "\n", "if", "dataset", "==", "\"gamma_r\"", ":", "y", "=", "np", ".", "random", ".", "gamma", "(", "scale", "=", "lp", "/", "gamma", ",", "shape", "=", "gamma", ")", "\n", "if", "dataset", "==", "\"tobit_r\"", ":", "\n", "            ", "y", "=", "np", ".", "random", ".", "normal", "(", "loc", "=", "lp", ",", "scale", "=", "sigma", ")", "\n", "y", "[", "y", ">=", "yu", "]", "=", "yu", "\n", "y", "[", "y", "<=", "yl", "]", "=", "yl", "\n", "", "", "\"\"\"\n    Simulated classification data\n    \"\"\"", "\n", "if", "dataset", "==", "\"bin_clasif\"", ":", "\n", "        ", "X", ",", "y", "=", "datasets", ".", "make_classification", "(", "n_samples", "=", "ntot", ",", "n_informative", "=", "10", ",", "n_redundant", "=", "0", ",", "n_features", "=", "10", ")", "\n", "", "if", "dataset", "==", "\"bin_clasif_fht1\"", ":", "##Simulate according to FHT00 page361 and MWB07 (JMLR) p416", "\n", "        ", "X", "=", "np", ".", "random", ".", "normal", "(", "size", "=", "(", "ntot", "*", "10", ")", ")", ".", "reshape", "(", "(", "ntot", ",", "10", ")", ")", "\n", "lp", "=", "np", ".", "zeros", "(", "ntot", ")", "\n", "lp", "+=", "1", "\n", "for", "i", "in", "range", "(", "0", ",", "6", ")", ":", "\n", "            ", "lp", "+=", "(", "-", "1", ")", "**", "(", "i", "+", "1", ")", "*", "X", "[", ":", ",", "i", "]", "\n", "", "lp", "=", "lp", "*", "np", ".", "sum", "(", "X", "[", ":", ",", "0", ":", "6", "]", ",", "axis", "=", "1", ")", "*", "10", "\n", "prob", "=", "1", "/", "(", "1", "+", "np", ".", "exp", "(", "-", "lp", ")", ")", "\n", "y", "=", "np", ".", "random", ".", "binomial", "(", "1", ",", "prob", ")", "\n", "", "if", "dataset", "==", "\"multi_clasif\"", ":", "\n", "        ", "X", ",", "y", "=", "datasets", ".", "make_classification", "(", "n_samples", "=", "ntot", ",", "n_classes", "=", "5", ",", "n_informative", "=", "10", ",", "n_redundant", "=", "0", ",", "n_features", "=", "10", ")", "\n", "", "if", "dataset", "==", "\"multi_clasif_fht\"", ":", "##Simulate according to FHT00 p358 ", "\n", "        ", "X", ",", "r", "=", "sum_sq_fct", "(", "ntot", ",", "p", "=", "10", ")", "\n", "y", "=", "r", ".", "copy", "(", ")", "\n", "cuts", "=", "[", "-", "1e50", ",", "6.2", ",", "8.3", ",", "10.5", ",", "13.4", ",", "1e50", "]", "\n", "for", "i", "in", "range", "(", "0", ",", "len", "(", "cuts", ")", "-", "1", ")", ":", "y", "[", "(", "r", ">=", "cuts", "[", "i", "]", ")", "&", "(", "r", "<", "cuts", "[", "i", "+", "1", "]", ")", "]", "=", "i", "\n", "##Drop NAs", "\n", "", "incl", "=", "~", "np", ".", "isnan", "(", "X", ")", ".", "any", "(", "axis", "=", "1", ")", "\n", "X", "=", "X", "[", "incl", "]", "\n", "y", "=", "y", "[", "incl", "]", "\n", "## Dndex for splitting data", "\n", "randind", "=", "list", "(", "np", ".", "arange", "(", "len", "(", "y", ")", ")", ")", "\n", "##Shuffle data", "\n", "np", ".", "random", ".", "shuffle", "(", "randind", ")", "\n", "##Define different data for training, validation, and testing", "\n", "if", "FullDataSet", ":", "ntot", "=", "len", "(", "y", ")", "\n", "ntot", "=", "np", ".", "min", "(", "[", "ntot", ",", "len", "(", "y", ")", "]", ")", "\n", "##Check the minimal number of samples per class", "\n", "if", "dataset", "in", "BinClassifDatasets", "+", "MultiClassifDatasets", ":", "\n", "        ", "ue", ",", "counts", "=", "np", ".", "unique", "(", "y", "[", "randind", "[", "0", ":", "int", "(", "ntot", "/", "npart", ")", "]", "]", ",", "return_counts", "=", "True", ")", "\n", "while", "(", "(", "len", "(", "ue", ")", "<", "len", "(", "np", ".", "unique", "(", "y", ")", ")", ")", "|", "(", "np", ".", "min", "(", "counts", ")", "<", "2", ")", ")", ":", "\n", "            ", "np", ".", "random", ".", "shuffle", "(", "randind", ")", "\n", "ue", ",", "counts", "=", "np", ".", "unique", "(", "y", "[", "randind", "[", "0", ":", "int", "(", "ntot", "/", "npart", ")", "]", "]", ",", "return_counts", "=", "True", ")", "\n", "", "", "ntrain", "=", "int", "(", "ntot", "/", "npart", ")", "\n", "nvalid", "=", "int", "(", "ntot", "/", "npart", ")", "if", "npart", "==", "3", "else", "0", "\n", "indtrain", "=", "randind", "[", "0", ":", "ntrain", "]", "\n", "indvalid", "=", "randind", "[", "ntrain", ":", "(", "ntrain", "+", "nvalid", ")", "]", "\n", "indtest", "=", "randind", "[", "(", "ntrain", "+", "nvalid", ")", ":", "ntot", "]", "\n", "if", "npart", "==", "2", ":", "\n", "        ", "return", "(", "X", "[", "indtrain", ",", ":", "]", ",", "X", "[", "indtest", ",", ":", "]", ",", "y", "[", "indtrain", "]", ",", "y", "[", "indtest", "]", ")", "\n", "", "if", "npart", "==", "3", ":", "\n", "        ", "return", "(", "X", "[", "indtrain", ",", ":", "]", ",", "X", "[", "indvalid", ",", ":", "]", ",", "X", "[", "indtest", ",", ":", "]", ",", "y", "[", "indtrain", "]", ",", "y", "[", "indvalid", "]", ",", "y", "[", "indtest", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.return_limits_tobit": [[266, 274], ["Compare_boosting.load_simulate_data", "numpy.percentile", "numpy.concatenate"], "function", ["home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.load_simulate_data"], ["", "", "def", "return_limits_tobit", "(", "dataset", ",", "sigma", "=", "1", ")", ":", "\n", "    ", "if", "dataset", "in", "TobitTask", ":", "\n", "        ", "X1", ",", "X2", ",", "X3", ",", "y1", ",", "y2", ",", "y3", "=", "load_simulate_data", "(", "dataset", "=", "dataset", ",", "n", "=", "100000", ",", "sigma", "=", "sigma", ",", "seed", "=", "1", ",", "yl", "=", "-", "1e30", ",", "yu", "=", "1e30", ")", "\n", "yl", ",", "yu", "=", "np", ".", "percentile", "(", "np", ".", "concatenate", "(", "(", "y1", ",", "y2", ",", "y3", ")", ")", ",", "q", "=", "[", "33.33", ",", "66.66", "]", ")", "\n", "", "else", ":", "\n", "        ", "yl", "=", "-", "1e30", "\n", "yu", "=", "1e30", "\n", "", "return", "(", "yl", ",", "yu", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_ktboost_model": [[276, 295], ["KTBoost.BoostingRegressor", "KTBoost.BoostingClassifier"], "function", ["None"], ["", "def", "get_ktboost_model", "(", "mod", ",", "dataset", ",", "max_depth", ",", "n_estimators", ",", "seed", ",", "yl", "=", "0", ",", "yu", "=", "1", ",", "gamma", "=", "1", ",", "\n", "learning_rate", "=", "0.1", ",", "min_samples_leaf", "=", "1", ",", "min_weight_leaf", "=", "1.", ")", ":", "\n", "    ", "if", "dataset", "in", "PoissonTask", ":", "loss", "=", "\"poisson\"", "\n", "if", "dataset", "in", "BinClassifDatasets", "+", "MultiClassifDatasets", ":", "loss", "=", "'deviance'", "\n", "if", "dataset", "in", "GammaTask", ":", "loss", "=", "\"gamma\"", "\n", "if", "dataset", "in", "TobitTask", ":", "loss", "=", "\"tobit\"", "\n", "if", "dataset", "in", "MSRTask", ":", "loss", "=", "\"msr\"", "\n", "if", "mod", "in", "[", "'GG'", ",", "\"XG\"", "]", ":", "update_step", "=", "\"gradient\"", "\n", "if", "mod", "in", "[", "'GN'", "]", ":", "update_step", "=", "\"hybrid\"", "\n", "if", "mod", "in", "[", "'NN'", "]", ":", "update_step", "=", "\"newton\"", "\n", "if", "dataset", "in", "RegrDatasets", ":", "\n", "        ", "model", "=", "ktb", ".", "BoostingRegressor", "(", "loss", "=", "loss", ",", "criterion", "=", "'mse'", ",", "max_depth", "=", "max_depth", ",", "min_weight_leaf", "=", "min_weight_leaf", ",", "min_samples_leaf", "=", "min_samples_leaf", ",", "\n", "n_estimators", "=", "n_estimators", ",", "learning_rate", "=", "learning_rate", ",", "random_state", "=", "seed", ",", "\n", "update_step", "=", "update_step", ",", "yl", "=", "yl", ",", "yu", "=", "yu", ",", "gamma", "=", "gamma", ")", "\n", "", "if", "dataset", "in", "BinClassifDatasets", "+", "MultiClassifDatasets", ":", "\n", "        ", "model", "=", "ktb", ".", "BoostingClassifier", "(", "loss", "=", "loss", ",", "criterion", "=", "'mse'", ",", "max_depth", "=", "max_depth", ",", "min_weight_leaf", "=", "min_weight_leaf", ",", "min_samples_leaf", "=", "min_samples_leaf", ",", "\n", "n_estimators", "=", "n_estimators", ",", "learning_rate", "=", "learning_rate", ",", "random_state", "=", "seed", ",", "\n", "update_step", "=", "update_step", ")", "\n", "", "return", "(", "model", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_param_grid_cross_prod": [[297, 304], ["None"], "function", ["None"], ["", "def", "get_param_grid_cross_prod", "(", "param_grid", ")", ":", "\n", "    ", "cross_prod", "=", "[", "]", "\n", "for", "lr", "in", "param_grid", "[", "'learning_rate'", "]", ":", "\n", "        ", "for", "mw", "in", "param_grid", "[", "'min_weight_leaf'", "]", ":", "\n", "            ", "for", "ms", "in", "param_grid", "[", "'min_samples_leaf'", "]", ":", "\n", "                ", "cross_prod", "+=", "[", "(", "lr", ",", "mw", ",", "ms", ")", "]", "\n", "", "", "", "return", "(", "cross_prod", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_data_param_XGBoost": [[306, 318], ["xgboost.DMatrix", "xgboost.DMatrix", "len", "numpy.unique"], "function", ["None"], ["", "def", "get_data_param_XGBoost", "(", "Xtrain", ",", "Xtest", ",", "ytrain", ",", "ytest", ",", "dataset", ",", "max_depth", ",", "min_weight_leaf", ",", "learning_rate", "=", "0.1", ",", "seed", "=", "0", ")", ":", "\n", "    ", "dtrain", "=", "xgb", ".", "DMatrix", "(", "Xtrain", ",", "label", "=", "ytrain", ")", "\n", "dtest", "=", "xgb", ".", "DMatrix", "(", "Xtest", ",", "label", "=", "ytest", ")", "\n", "if", "dataset", "in", "BinClassifDatasets", ":", "objective", "=", "'binary:logistic'", "\n", "if", "dataset", "in", "MultiClassifDatasets", ":", "objective", "=", "'multi:softprob'", "\n", "if", "dataset", "in", "PoissonTask", ":", "objective", "=", "'count:poisson'", "\n", "if", "dataset", "in", "GammaTask", ":", "objective", "=", "'reg:gamma'", "\n", "param", "=", "{", "'max_depth'", ":", "max_depth", ",", "'eta'", ":", "learning_rate", ",", "'lambda'", ":", "0", ",", "\n", "'objective'", ":", "objective", ",", "'min_child_weight'", ":", "min_weight_leaf", ",", "\n", "'tree_method'", ":", "'exact'", ",", "'seed'", ":", "seed", ",", "'max_delta_step'", ":", "0", "}", "\n", "if", "dataset", "in", "MultiClassifDatasets", ":", "param", "[", "'num_class'", "]", "=", "len", "(", "np", ".", "unique", "(", "ytrain", ")", ")", "\n", "return", "(", "dtrain", ",", "dtest", ",", "param", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.tune_pars_calc_test_error": [[320, 389], ["Compare_boosting.get_ktboost_model", "Compare_boosting.get_param_grid_cross_prod", "pickle.dump", "pickle.dump", "pickle.dump", "pickle.dump", "pickle.dump", "pickle.dump", "pickle.dump", "os.chdir", "subprocess.call", "pickle.load", "numpy.array", "list", "list", "open", "open", "open", "open", "open", "open", "open", "ValueError", "open", "Compare_boosting.get_data_param_XGBoost", "pickle.dump", "subprocess.call", "pickle.load", "Compare_boosting.get_ktboost_model", "get_ktboost_model.set_params", "get_ktboost_model.fit", "get_ktboost_model.loss_", "get_ktboost_model.loss_", "str", "xgboost.train", "xgb.train.predict", "open", "ValueError", "open", "sklearn.metrics.accuracy_score", "sklearn.metrics.accuracy_score", "sklearn.metrics.accuracy_score", "sklearn.metrics.accuracy_score", "numpy.nanargmin", "numpy.nanargmin", "int", "numpy.log", "scipy.special.logit", "numpy.log", "numpy.argmax", "numpy.argmax", "str", "numpy.min", "numpy.min", "str", "len", "str", "str", "str", "str", "str"], "function", ["home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_ktboost_model", "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_param_grid_cross_prod", "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_data_param_XGBoost", "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.get_ktboost_model"], ["", "def", "tune_pars_calc_test_error", "(", "mod", ",", "max_depth", ",", "n_estimators", ",", "n", ",", "seed", ",", "param_grid", ",", "\n", "dataset", ",", "path_temp", ",", "path_code", ",", "Xtrain", ",", "Xtest", ",", "Xvalid", ",", "ytrain", ",", "ytest", ",", "yvalid", ",", "\n", "ncores", "=", "1", ",", "yl", "=", "0", ",", "yu", "=", "1", ",", "gamma", "=", "1", ",", "calcOptLoss", "=", "True", ")", ":", "\n", "    ", "model", "=", "get_ktboost_model", "(", "mod", "=", "mod", ",", "dataset", "=", "dataset", ",", "max_depth", "=", "max_depth", ",", "n_estimators", "=", "n_estimators", ",", "\n", "seed", "=", "seed", ",", "yl", "=", "yl", ",", "yu", "=", "yu", ",", "gamma", "=", "gamma", ")", "\n", "param_grid_cross_prod", "=", "get_param_grid_cross_prod", "(", "param_grid", ")", "\n", "pickle", ".", "dump", "(", "param_grid_cross_prod", ",", "open", "(", "path_temp", "+", "'param_grid_cross_prod.p'", ",", "'wb'", ")", ")", "\n", "pickle", ".", "dump", "(", "Xtrain", ",", "open", "(", "path_temp", "+", "'Xtrain.p'", ",", "'wb'", ")", ")", "##For use below in CV function", "\n", "pickle", ".", "dump", "(", "ytrain", ",", "open", "(", "path_temp", "+", "'ytrain.p'", ",", "'wb'", ")", ")", "\n", "pickle", ".", "dump", "(", "Xvalid", ",", "open", "(", "path_temp", "+", "'Xvalid.p'", ",", "'wb'", ")", ")", "\n", "pickle", ".", "dump", "(", "yvalid", ",", "open", "(", "path_temp", "+", "'yvalid.p'", ",", "'wb'", ")", ")", "\n", "pickle", ".", "dump", "(", "Xtest", ",", "open", "(", "path_temp", "+", "'Xtest.p'", ",", "'wb'", ")", ")", "\n", "pickle", ".", "dump", "(", "model", ",", "open", "(", "path_temp", "+", "'model.p'", ",", "'wb'", ")", ")", "\n", "##Choose tuning parameters", "\n", "os", ".", "chdir", "(", "path_code", ")", "\n", "cmd", "=", "\"python tune_pars_multiprocessing.py \"", "+", "str", "(", "n_estimators", ")", "+", "\" \"", "+", "str", "(", "seed", ")", "+", "\" \"", "+", "str", "(", "ncores", ")", "+", "\" \"", "+", "dataset", "+", "\" \"", "+", "path_temp", "+", "\" \"", "+", "mod", "\n", "status", "=", "subprocess", ".", "call", "(", "cmd", ",", "shell", "=", "True", ")", "\n", "if", "not", "status", "==", "0", ":", "raise", "ValueError", "(", "\"Error in parameter tuning for \"", "+", "str", "(", "dataset", ")", "+", "\" & \"", "+", "str", "(", "mod", ")", ")", "\n", "cvscores", "=", "pickle", ".", "load", "(", "open", "(", "path_temp", "+", "'results.p'", ",", "'rb'", ")", ")", "\n", "cvscores", "=", "np", ".", "array", "(", "cvscores", ")", "\n", "opt_pars_score", "=", "list", "(", "cvscores", "[", "np", ".", "nanargmin", "(", "cvscores", "[", ":", ",", "4", "]", ")", ",", "[", "3", ",", "0", ",", "1", ",", "2", "]", "]", ")", "\n", "## Results when setting the number of samples per leaf parameter to its default value", "\n", "cvscores_noW", "=", "cvscores", "[", "(", "cvscores", "[", ":", ",", "1", "]", "==", "np", ".", "min", "(", "cvscores", "[", ":", ",", "1", "]", ")", ")", "&", "(", "cvscores", "[", ":", ",", "2", "]", "==", "np", ".", "min", "(", "cvscores", "[", ":", ",", "2", "]", ")", ")", ",", ":", "]", "\n", "opt_pars_score_noW", "=", "list", "(", "cvscores_noW", "[", "np", ".", "nanargmin", "(", "cvscores_noW", "[", ":", ",", "4", "]", ")", ",", "[", "3", ",", "0", ",", "1", ",", "2", "]", "]", ")", "\n", "opt_params", "=", "[", "opt_pars_score", ",", "opt_pars_score_noW", "]", "\n", "##Train best model and make predictions for evaluation", "\n", "if", "calcOptLoss", ":", "\n", "        ", "if", "mod", "==", "'XG'", ":", "\n", "            ", "dtrain", ",", "dtest", ",", "param", "=", "get_data_param_XGBoost", "(", "Xtrain", "=", "Xtrain", ",", "Xtest", "=", "Xtest", ",", "ytrain", "=", "ytrain", ",", "ytest", "=", "ytest", ",", "\n", "dataset", "=", "dataset", ",", "max_depth", "=", "max_depth", ",", "min_weight_leaf", "=", "1.", ",", "seed", "=", "seed", ")", "\n", "preds", "=", "[", "]", "\n", "for", "nest", ",", "lr", ",", "mw", ",", "ms", "in", "opt_params", ":", "\n", "                ", "param", "[", "'eta'", "]", "=", "lr", "\n", "param", "[", "'min_child_weight'", "]", "=", "mw", "\n", "modxgb", "=", "xgb", ".", "train", "(", "param", ",", "dtrain", ",", "int", "(", "nest", ")", ")", "\n", "pred", "=", "modxgb", ".", "predict", "(", "dtest", ")", "\n", "if", "(", "dataset", "in", "RegrDatasets", ")", "&", "(", "dataset", "not", "in", "TobitTask", "+", "MSRTask", ")", ":", "pred", "=", "np", ".", "log", "(", "pred", ")", "\n", "if", "dataset", "in", "BinClassifDatasets", ":", "pred", "=", "logit", "(", "pred", ")", "##logit link", "\n", "if", "dataset", "in", "MultiClassifDatasets", ":", "pred", "=", "np", ".", "log", "(", "pred", ")", "##softmax (up to a constant that cancels)", "\n", "preds", "+=", "[", "pred", "]", "\n", "", "", "else", ":", "\n", "            ", "pickle", ".", "dump", "(", "opt_params", ",", "open", "(", "path_temp", "+", "'opt_params.p'", ",", "'wb'", ")", ")", "\n", "cmd", "=", "\"python fit_pred_multiprocessing.py \"", "+", "\" \"", "+", "str", "(", "ncores", ")", "+", "\" \"", "+", "dataset", "+", "\" \"", "+", "mod", "+", "\" \"", "+", "path_temp", "\n", "status", "=", "subprocess", ".", "call", "(", "cmd", ",", "shell", "=", "True", ")", "\n", "if", "not", "status", "==", "0", ":", "raise", "ValueError", "(", "\"Error in CV score calculation for \"", "+", "str", "(", "dataset", ")", "+", "\" & \"", "+", "str", "(", "mod", ")", ")", "\n", "preds", "=", "pickle", ".", "load", "(", "open", "(", "path_temp", "+", "'preds.p'", ",", "'rb'", ")", ")", "\n", "", "", "else", ":", "\n", "        ", "preds", "=", "None", "\n", "##Determine optimal negll / error rate", "\n", "", "if", "calcOptLoss", ":", "\n", "        ", "if", "dataset", "in", "BinClassifDatasets", ":", "\n", "            ", "score", "=", "1", "-", "accuracy_score", "(", "ytest", ",", "(", "preds", "[", "0", "]", ">", "0.", ")", ".", "astype", "(", "float", ")", ")", "\n", "score_noW", "=", "1", "-", "accuracy_score", "(", "ytest", ",", "(", "preds", "[", "1", "]", ">", "0.", ")", ".", "astype", "(", "float", ")", ")", "\n", "", "if", "dataset", "in", "MultiClassifDatasets", ":", "\n", "            ", "score", "=", "1", "-", "accuracy_score", "(", "ytest", ",", "np", ".", "argmax", "(", "preds", "[", "0", "]", ",", "axis", "=", "1", ")", ")", "\n", "score_noW", "=", "1", "-", "accuracy_score", "(", "ytest", ",", "np", ".", "argmax", "(", "preds", "[", "1", "]", ",", "axis", "=", "1", ")", ")", "\n", "", "if", "dataset", "in", "RegrDatasets", ":", "\n", "            ", "dummy_model", "=", "get_ktboost_model", "(", "mod", "=", "\"GG\"", ",", "dataset", "=", "dataset", ",", "max_depth", "=", "max_depth", ",", "\n", "n_estimators", "=", "n_estimators", ",", "seed", "=", "seed", ",", "yl", "=", "yl", ",", "yu", "=", "yu", ",", "gamma", "=", "gamma", ")", "\n", "dummy_model", ".", "set_params", "(", "learning_rate", "=", "0.01", ",", "n_estimators", "=", "1", ")", "\n", "dummy_model", ".", "fit", "(", "Xtrain", ",", "ytrain", ")", "\n", "score", "=", "dummy_model", ".", "loss_", "(", "ytest", ",", "preds", "[", "0", "]", ")", "\n", "score_noW", "=", "dummy_model", ".", "loss_", "(", "ytest", ",", "preds", "[", "1", "]", ")", "\n", "", "", "else", ":", "\n", "         ", "score", "=", "None", "\n", "score_noW", "=", "None", "\n", "##Return results", "\n", "", "res", "=", "[", "dataset", ",", "mod", ",", "len", "(", "ytrain", ")", "]", "+", "opt_pars_score", "+", "[", "score", "]", "+", "opt_pars_score_noW", "+", "[", "score_noW", "]", "\n", "return", "(", "res", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.Compare_boosting.ensure_dir": [[390, 394], ["os.path.dirname", "os.path.exists", "os.makedirs"], "function", ["None"], ["", "def", "ensure_dir", "(", "file_path", ")", ":", "\n", "    ", "directory", "=", "os", ".", "path", ".", "dirname", "(", "file_path", ")", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "directory", ")", ":", "\n", "        ", "os", ".", "makedirs", "(", "directory", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.fit_pred_multiprocessing.fit_pred": [[14, 29], ["model.set_params", "model.fit", "model.predict", "model.decision_function", "int", "int"], "function", ["None"], ["", "def", "fit_pred", "(", "nest", ",", "lr", ",", "mw", ",", "ms", ",", "model", ",", "Xtrain", ",", "ytrain", ",", "Xtest", ",", "dataset", ",", "mod", ")", ":", "\n", "    ", "PoissonTask", "=", "[", "\"poisson\"", ",", "\"insurance\"", ",", "\"poisson_r\"", "]", "\n", "GammaTask", "=", "[", "\"gamma\"", ",", "\"gamma_r\"", "]", "\n", "TobitTask", "=", "[", "\"tobit\"", ",", "\"tobit_r\"", "]", "\n", "MSRTask", "=", "[", "\"msr_f3\"", ",", "\"msr_r\"", ",", "\"birthweight\"", ",", "\"malnutrition\"", ",", "\"head_circumf\"", ",", "\"bodyfat\"", "]", "\n", "RegrDatasets", "=", "PoissonTask", "+", "GammaTask", "+", "TobitTask", "+", "MSRTask", "\n", "BinClassifDatasets", "=", "[", "\"bin_clasif\"", ",", "\"bin_clasif_fht1\"", ",", "\n", "\"ionosphere\"", ",", "\"sonar\"", ",", "\"adult\"", ",", "\"titanic\"", ",", "\"bank\"", ",", "\"cancer\"", ",", "\"ijcnn\"", "]", "\n", "MultiClassifDatasets", "=", "[", "\"multi_clasif\"", ",", "\"multi_clasif_fht\"", ",", "\"multi_clasif_cos\"", ",", "\n", "\"digits\"", ",", "\"car\"", ",", "\"glass\"", ",", "\"satimage\"", ",", "\"letter\"", ",", "\"smartphone\"", ",", "\"covtype\"", ",", "\"usps\"", "]", "\n", "model", ".", "set_params", "(", "learning_rate", "=", "lr", ",", "n_estimators", "=", "int", "(", "nest", ")", ",", "min_samples_leaf", "=", "int", "(", "ms", ")", ",", "min_weight_leaf", "=", "mw", ")", "\n", "model", ".", "fit", "(", "Xtrain", ",", "ytrain", ")", "\n", "if", "dataset", "in", "RegrDatasets", ":", "pred", "=", "model", ".", "predict", "(", "Xtest", ")", "\n", "if", "dataset", "in", "BinClassifDatasets", "+", "MultiClassifDatasets", ":", "pred", "=", "model", ".", "decision_function", "(", "Xtest", ")", "\n", "return", "(", "pred", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fabsig_GradientNewtonBoosting.None.tune_pars_multiprocessing.do_tune_boost": [[20, 90], ["int", "int", "range", "model.set_params", "numpy.empty", "numpy.nanmin", "model.fit", "xgb.DMatrix", "xgb.DMatrix", "dict", "print", "print", "enumerate", "enumerate", "len", "xgb.train", "model.staged_predict", "model.staged_decision_function", "numpy.unique", "print", "numpy.nanargmin", "model.loss_", "sklearn.metrics.accuracy_score", "sklearn.metrics.accuracy_score", "str", "numpy.argmax", "str", "str"], "function", ["None"], ["def", "do_tune_boost", "(", "lr", ",", "model", ",", "Xtrain", ",", "ytrain", ",", "seed", ",", "dataset", ",", "Xvalid", ",", "yvalid", ",", "n_estimators", "=", "1000", ",", "\n", "printres", "=", "False", ",", "min_weight_leaf", "=", "1.", ",", "min_samples_leaf", "=", "1", ",", "mod", "=", "\"GN\"", ",", "max_depth", "=", "5", ")", ":", "\n", "    ", "PoissonTask", "=", "[", "\"poisson\"", ",", "\"insurance\"", ",", "\"poisson_r\"", "]", "\n", "GammaTask", "=", "[", "\"gamma\"", ",", "\"gamma_r\"", "]", "\n", "TobitTask", "=", "[", "\"tobit\"", ",", "\"tobit_r\"", "]", "\n", "MSRTask", "=", "[", "\"msr_f3\"", ",", "\"msr_r\"", ",", "\"birthweight\"", ",", "\"malnutrition\"", ",", "\"head_circumf\"", ",", "\"bodyfat\"", "]", "\n", "RegrDatasets", "=", "PoissonTask", "+", "GammaTask", "+", "TobitTask", "+", "MSRTask", "\n", "BinClassifDatasets", "=", "[", "\"bin_clasif\"", ",", "\"bin_clasif_fht1\"", ",", "\n", "\"ionosphere\"", ",", "\"sonar\"", ",", "\"adult\"", ",", "\"titanic\"", ",", "\"bank\"", ",", "\"cancer\"", ",", "\"ijcnn\"", "]", "\n", "MultiClassifDatasets", "=", "[", "\"multi_clasif\"", ",", "\"multi_clasif_fht\"", ",", "\"multi_clasif_cos\"", ",", "\n", "\"digits\"", ",", "\"car\"", ",", "\"glass\"", ",", "\"satimage\"", ",", "\"letter\"", ",", "\"smartphone\"", ",", "\"covtype\"", ",", "\"usps\"", "]", "\n", "n_estimators", "=", "int", "(", "n_estimators", ")", "\n", "min_samples_leaf", "=", "int", "(", "min_samples_leaf", ")", "\n", "nests", "=", "range", "(", "1", ",", "n_estimators", "+", "1", ",", "1", ")", "\n", "model", ".", "set_params", "(", "learning_rate", "=", "lr", ",", "n_estimators", "=", "n_estimators", ",", "min_samples_leaf", "=", "min_samples_leaf", ",", "min_weight_leaf", "=", "min_weight_leaf", ")", "\n", "\n", "test_score", "=", "np", ".", "empty", "(", "n_estimators", "+", "1", ")", "\n", "test_score", "[", ":", "]", "=", "np", ".", "nan", "\n", "if", "mod", "in", "[", "\"GG\"", ",", "\"GN\"", ",", "\"NN\"", "]", ":", "\n", "        ", "model", ".", "fit", "(", "Xtrain", ",", "ytrain", ")", "\n", "if", "dataset", "in", "RegrDatasets", ":", "\n", "            ", "for", "ind", ",", "pred", "in", "enumerate", "(", "model", ".", "staged_predict", "(", "Xvalid", ")", ")", ":", "\n", "                ", "i", "=", "ind", "+", "1", "##i=nb of trees", "\n", "if", "i", "in", "nests", ":", "\n", "                    ", "test_score", "[", "i", "]", "=", "model", ".", "loss_", "(", "yvalid", ",", "pred", ")", "\n", "", "", "", "if", "dataset", "in", "BinClassifDatasets", "+", "MultiClassifDatasets", ":", "\n", "            ", "for", "ind", ",", "pred", "in", "enumerate", "(", "model", ".", "staged_decision_function", "(", "Xvalid", ")", ")", ":", "\n", "                ", "i", "=", "ind", "+", "1", "##i=nb of trees", "\n", "if", "i", "in", "nests", ":", "\n", "                    ", "if", "dataset", "in", "BinClassifDatasets", ":", "test_score", "[", "i", "]", "=", "1", "-", "accuracy_score", "(", "yvalid", ",", "(", "pred", ">", "0", ")", ".", "astype", "(", "float", ")", ")", "\n", "if", "dataset", "in", "MultiClassifDatasets", ":", "test_score", "[", "i", "]", "=", "1", "-", "accuracy_score", "(", "yvalid", ",", "np", ".", "argmax", "(", "pred", ",", "axis", "=", "1", ")", ")", "\n", "##XGBoost            ", "\n", "", "", "", "", "if", "mod", "==", "\"XG\"", ":", "\n", "        ", "dtrain", "=", "xgb", ".", "DMatrix", "(", "Xtrain", ",", "label", "=", "ytrain", ")", "\n", "dvalid", "=", "xgb", ".", "DMatrix", "(", "Xvalid", ",", "label", "=", "yvalid", ")", "\n", "if", "dataset", "in", "BinClassifDatasets", ":", "\n", "            ", "objective", "=", "'binary:logistic'", "\n", "score_name", "=", "'error'", "\n", "", "if", "dataset", "in", "MultiClassifDatasets", ":", "\n", "            ", "objective", "=", "'multi:softprob'", "\n", "score_name", "=", "'merror'", "\n", "", "if", "dataset", "in", "PoissonTask", ":", "\n", "            ", "objective", "=", "'count:poisson'", "\n", "score_name", "=", "'poisson-nloglik'", "\n", "", "if", "dataset", "in", "GammaTask", ":", "\n", "            ", "objective", "=", "'reg:gamma'", "\n", "score_name", "=", "\"gamma-nloglik\"", "\n", "", "param", "=", "{", "'max_depth'", ":", "max_depth", ",", "'eta'", ":", "lr", ",", "'lambda'", ":", "0", ",", "\n", "'objective'", ":", "objective", ",", "'min_child_weight'", ":", "min_weight_leaf", ",", "\n", "'tree_method'", ":", "'exact'", ",", "'seed'", ":", "seed", ",", "\n", "'max_delta_step'", ":", "0", ",", "'eval_metric'", ":", "[", "score_name", "]", "}", "\n", "if", "dataset", "in", "MultiClassifDatasets", ":", "param", "[", "'num_class'", "]", "=", "len", "(", "np", ".", "unique", "(", "ytrain", ")", ")", "\n", "watchlist", "=", "[", "(", "dvalid", ",", "'eval'", ")", "]", "\n", "evals_result", "=", "dict", "(", ")", "\n", "try", ":", "\n", "            ", "xgb", ".", "train", "(", "params", "=", "param", ",", "dtrain", "=", "dtrain", ",", "num_boost_round", "=", "n_estimators", ",", "\n", "evals", "=", "watchlist", ",", "verbose_eval", "=", "False", ",", "evals_result", "=", "evals_result", ")", "\n", "test_score", "[", "nests", "]", "=", "evals_result", "[", "'eval'", "]", "[", "score_name", "]", "\n", "", "except", "ValueError", "as", "e", ":", "\n", "            ", "print", "(", "\"XGBoost error in evaluation for \"", "+", "str", "(", "dataset", ")", "+", "\" & LR=\"", "+", "str", "(", "lr", ")", "+", "\": \\\"\"", "+", "str", "(", "e", ")", "+", "\"\\\"\"", ")", "\n", "test_score", "[", "nests", "]", "=", "999999999", "\n", "", "", "opt_score", "=", "np", ".", "nanmin", "(", "test_score", "[", "nests", "]", ")", "\n", "try", ":", "\n", "        ", "opt_nest_score", "=", "nests", "[", "np", ".", "nanargmin", "(", "test_score", "[", "nests", "]", ")", "]", "\n", "", "except", "ValueError", ":", "\n", "        ", "opt_nest_score", "=", "n_estimators", "\n", "", "if", "printres", ":", "\n", "        ", "print", "(", "\"lr,min_weight_leaf,min_samples_leaf,opt_nest_score,opt_score\"", ")", "\n", "print", "(", "[", "lr", ",", "min_weight_leaf", ",", "min_samples_leaf", ",", "opt_nest_score", ",", "opt_score", "]", ")", "\n", "", "return", "(", "[", "lr", ",", "min_weight_leaf", ",", "min_samples_leaf", ",", "opt_nest_score", ",", "opt_score", "]", ")", "\n", "\n"]]}