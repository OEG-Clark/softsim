{"home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.intersection_over_union": [[5, 26], ["Polygon.Polygon", "Polygon.Polygon", "Polygon.Polygon.area", "Polygon.Polygon.area", "poly_inter.area", "min", "numpy.array().reshape", "numpy.array().reshape", "numpy.array", "numpy.array"], "function", ["None"], ["def", "intersection_over_union", "(", "a_quad_list", ",", "b_quad_list", ")", ":", "\n", "    ", "import", "Polygon", "\n", "\n", "poly_a", "=", "Polygon", ".", "Polygon", "(", "np", ".", "array", "(", "a_quad_list", ")", ".", "reshape", "(", "-", "1", ",", "2", ")", ")", "\n", "poly_b", "=", "Polygon", ".", "Polygon", "(", "np", ".", "array", "(", "b_quad_list", ")", ".", "reshape", "(", "-", "1", ",", "2", ")", ")", "\n", "\n", "poly_inter", "=", "poly_a", "&", "poly_b", "\n", "\n", "area_a", "=", "poly_a", ".", "area", "(", ")", "\n", "area_b", "=", "poly_b", ".", "area", "(", ")", "\n", "\n", "area_inter", "=", "poly_inter", ".", "area", "(", ")", "\n", "area_union", "=", "area_a", "+", "area_b", "-", "area_inter", "\n", "\n", "area_min", "=", "min", "(", "area_a", ",", "area_b", ")", "\n", "if", "area_min", "<", "area_inter", "<", "area_min", "*", "1.0000000001", ":", "\n", "        ", "area_inter", "=", "area_min", "\n", "\n", "", "jaccard_index", "=", "area_inter", "/", "area_union", "\n", "\n", "return", "jaccard_index", "\n", "\n"]], "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.intersection_over_union_with_ground_truth_normalization": [[28, 84], ["numpy.array", "cv2.getPerspectiveTransform", "cv2.perspectiveTransform", "Polygon.Polygon", "Polygon.Polygon", "Polygon.Polygon.area", "Polygon.Polygon.area", "poly_inter.area", "min", "numpy.array().reshape", "np.array.reshape", "numpy.array().reshape", "np.array.reshape", "cv2.perspectiveTransform.reshape", "numpy.array", "numpy.array"], "function", ["None"], ["", "def", "intersection_over_union_with_ground_truth_normalization", "(", "prediction", ",", "ground_truth", ",", "tpl_size", ")", ":", "\n", "    ", "import", "Polygon", "\n", "import", "cv2", "\n", "# Reference : https://github.com/jchazalon/smartdoc15-ch1-eval", "\n", "#MIT License", "\n", "#", "\n", "#Copyright (c) 2015 Joseph Chazalon - University of La Rochelle, France", "\n", "#                   joseph(dot)chazalon(at)univ-lr(dot)fr", "\n", "#Copyright (c) 2015 Mar\u00e7al Rusi\u00f1ol <marcal(at)cvc(dot)uab(dot)cat>", "\n", "#                   CVC / Universitat Aut\u00f2noma de Barcelona, Spain", "\n", "#", "\n", "#Permission is hereby granted, free of charge, to any person obtaining a copy", "\n", "#of this software and associated documentation files (the \"Software\"), to deal", "\n", "#in the Software without restriction, including without limitation the rights", "\n", "#to use, copy, modify, merge, publish, distribute, sublicense, and/or sell", "\n", "#copies of the Software, and to permit persons to whom the Software is", "\n", "#furnished to do so, subject to the following conditions:", "\n", "#", "\n", "#The above copyright notice and this permission notice shall be included in all", "\n", "#copies or substantial portions of the Software.", "\n", "#", "\n", "#THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR", "\n", "#IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,", "\n", "#FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE", "\n", "#AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER", "\n", "#LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,", "\n", "#OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE", "\n", "#SOFTWARE.", "\n", "\n", "target_width", "=", "tpl_size", "[", "0", "]", "\n", "target_height", "=", "tpl_size", "[", "1", "]", "\n", "\n", "object_coord_target", "=", "np", ".", "array", "(", "[", "[", "0", ",", "0", "]", ",", "[", "target_width", ",", "0", "]", ",", "[", "target_width", ",", "target_height", "]", ",", "[", "0", ",", "target_height", "]", "]", ",", "\n", "np", ".", "float32", ")", "\n", "\n", "matrix", "=", "cv2", ".", "getPerspectiveTransform", "(", "np", ".", "array", "(", "ground_truth", ",", "np", ".", "float32", ")", ".", "reshape", "(", "-", "1", ",", "2", ")", ",", "\n", "object_coord_target", ".", "reshape", "(", "-", "1", ",", "2", ")", ")", "\n", "\n", "test_coords", "=", "cv2", ".", "perspectiveTransform", "(", "np", ".", "array", "(", "prediction", ",", "np", ".", "float32", ")", ".", "reshape", "(", "-", "1", ",", "1", ",", "2", ")", ",", "matrix", ")", "\n", "\n", "poly_target", "=", "Polygon", ".", "Polygon", "(", "object_coord_target", ".", "reshape", "(", "-", "1", ",", "2", ")", ")", "\n", "poly_test", "=", "Polygon", ".", "Polygon", "(", "test_coords", ".", "reshape", "(", "-", "1", ",", "2", ")", ")", "\n", "poly_inter", "=", "poly_target", "&", "poly_test", "\n", "\n", "area_target", "=", "poly_target", ".", "area", "(", ")", "\n", "area_test", "=", "poly_test", ".", "area", "(", ")", "\n", "area_inter", "=", "poly_inter", ".", "area", "(", ")", "\n", "\n", "area_union", "=", "area_test", "+", "area_target", "-", "area_inter", "\n", "\n", "area_min", "=", "min", "(", "area_target", ",", "area_test", ")", "\n", "if", "area_min", "<", "area_inter", "<", "area_min", "*", "1.0000000001", ":", "\n", "        ", "area_inter", "=", "area_min", "\n", "\n", "", "jaccard_index", "=", "area_inter", "/", "area_union", "\n", "return", "jaccard_index", "\n", "\n"]], "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.mean_intersection_over_union": [[86, 120], ["numpy.array", "numpy.array", "numpy.zeros", "a.astype.astype", "cv2.fillConvexPoly", "numpy.logical_not", "numpy.zeros", "b.astype.astype", "cv2.fillConvexPoly", "numpy.logical_not", "numpy.logical_or", "numpy.logical_or", "float", "print", "breakpoint", "float", "float", "float", "print", "breakpoint", "float", "float", "numpy.sum", "float", "numpy.sum", "numpy.sum", "numpy.sum", "float", "numpy.sum", "numpy.sum", "numpy.sum", "numpy.sum"], "function", ["None"], ["", "def", "mean_intersection_over_union", "(", "a", ",", "b", ",", "image_size", ")", ":", "\n", "    ", "import", "cv2", "\n", "\n", "width", "=", "image_size", "[", "0", "]", "\n", "height", "=", "image_size", "[", "1", "]", "\n", "\n", "a", "=", "np", ".", "array", "(", "a", ")", "\n", "b", "=", "np", ".", "array", "(", "b", ")", "\n", "\n", "img1", "=", "np", ".", "zeros", "(", "(", "height", ",", "width", ")", ")", "\n", "a", "=", "a", ".", "astype", "(", "np", ".", "int32", ")", "\n", "cv2", ".", "fillConvexPoly", "(", "img1", ",", "a", ",", "1", ")", "\n", "not_img1", "=", "np", ".", "logical_not", "(", "img1", ")", "\n", "\n", "img2", "=", "np", ".", "zeros", "(", "(", "height", ",", "width", ")", ")", "\n", "b", "=", "b", ".", "astype", "(", "np", ".", "int32", ")", "\n", "cv2", ".", "fillConvexPoly", "(", "img2", ",", "b", ",", "1", ")", "\n", "not_img2", "=", "np", ".", "logical_not", "(", "img2", ")", "\n", "\n", "inter", "=", "img1", "*", "img2", "\n", "union", "=", "np", ".", "logical_or", "(", "img1", ",", "img2", ")", "\n", "if", "float", "(", "np", ".", "sum", "(", "union", ")", ")", "<", "1", ":", "\n", "        ", "print", "(", "1", ",", "a", ",", "b", ",", "float", "(", "np", ".", "sum", "(", "union", ")", ")", ")", "\n", "breakpoint", "(", ")", "\n", "", "iou", "=", "float", "(", "np", ".", "sum", "(", "inter", ")", ")", "/", "float", "(", "np", ".", "sum", "(", "union", ")", ")", "\n", "\n", "inter_back", "=", "not_img1", "*", "not_img2", "\n", "union_back", "=", "np", ".", "logical_or", "(", "not_img1", ",", "not_img2", ")", "\n", "\n", "if", "float", "(", "np", ".", "sum", "(", "union_back", ")", ")", "<", "1", ":", "\n", "        ", "print", "(", "2", ",", "a", ",", "b", ",", "float", "(", "np", ".", "sum", "(", "union_back", ")", ")", ")", "\n", "breakpoint", "(", ")", "\n", "", "iou_back", "=", "float", "(", "np", ".", "sum", "(", "inter_back", ")", ")", "/", "float", "(", "np", ".", "sum", "(", "union_back", ")", ")", "\n", "return", "(", "iou", "+", "iou_back", ")", "/", "2", "\n", "\n"]], "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.euc_distance": [[122, 126], ["math.sqrt", "len", "len", "sum", "zip"], "function", ["None"], ["", "def", "euc_distance", "(", "p1", ",", "p2", ")", ":", "\n", "    ", "assert", "len", "(", "p1", ")", "==", "2", "\n", "assert", "len", "(", "p2", ")", "==", "2", "\n", "return", "math", ".", "sqrt", "(", "sum", "(", "[", "(", "c1", "-", "c2", ")", "**", "2", "for", "(", "c1", ",", "c2", ")", "in", "zip", "(", "p1", ",", "p2", ")", "]", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.corner_residuals": [[128, 130], ["metrics.euc_distance", "zip"], "function", ["home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.euc_distance"], ["", "def", "corner_residuals", "(", "run", ",", "ideal", ")", ":", "\n", "    ", "return", "[", "euc_distance", "(", "p1", ",", "p2", ")", "for", "(", "p1", ",", "p2", ")", "in", "zip", "(", "run", ",", "ideal", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.as_rect": [[132, 135], ["len"], "function", ["None"], ["", "def", "as_rect", "(", "size", ")", ":", "\n", "    ", "assert", "len", "(", "size", ")", "==", "2", "\n", "return", "[", "(", "0", ",", "0", ")", ",", "(", "size", "[", "0", "]", ",", "0", ")", ",", "(", "size", "[", "0", "]", ",", "size", "[", "1", "]", ")", ",", "(", "0", ",", "size", "[", "1", "]", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.transform_point": [[137, 144], ["None"], "function", ["None"], ["", "def", "transform_point", "(", "h", ",", "p", ")", ":", "\n", "    ", "d", "=", "h", "[", "2", "]", "[", "0", "]", "*", "p", "[", "0", "]", "+", "h", "[", "2", "]", "[", "1", "]", "*", "p", "[", "1", "]", "+", "h", "[", "2", "]", "[", "2", "]", "\n", "assert", "d", "!=", "0", "\n", "\n", "x", "=", "(", "h", "[", "0", "]", "[", "0", "]", "*", "p", "[", "0", "]", "+", "h", "[", "0", "]", "[", "1", "]", "*", "p", "[", "1", "]", "+", "h", "[", "0", "]", "[", "2", "]", ")", "/", "d", "\n", "y", "=", "(", "h", "[", "1", "]", "[", "0", "]", "*", "p", "[", "0", "]", "+", "h", "[", "1", "]", "[", "1", "]", "*", "p", "[", "1", "]", "+", "h", "[", "1", "]", "[", "2", "]", ")", "/", "d", "\n", "return", "x", ",", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.template_perimeter": [[146, 148], ["None"], "function", ["None"], ["", "def", "template_perimeter", "(", "size", ")", ":", "\n", "    ", "return", "(", "size", "[", "0", "]", "+", "size", "[", "1", "]", ")", "*", "2", "\n", "\n"]], "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.provide_regular_orientation": [[150, 156], ["numpy.array", "numpy.cross"], "function", ["None"], ["", "def", "provide_regular_orientation", "(", "quad", ")", ":", "\n", "    ", "q", "=", "np", ".", "array", "(", "quad", ")", "\n", "if", "np", ".", "cross", "(", "q", "[", "1", "]", "-", "q", "[", "0", "]", ",", "q", "[", "2", "]", "-", "q", "[", "1", "]", ")", ">", "0", ":", "\n", "        ", "return", "quad", "\n", "", "else", ":", "\n", "        ", "return", "[", "quad", "[", "1", "]", ",", "quad", "[", "0", "]", ",", "quad", "[", "3", "]", ",", "quad", "[", "2", "]", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.residual_metric": [[158, 186], ["metrics.provide_regular_orientation", "metrics.provide_regular_orientation", "cv2.getPerspectiveTransform", "metrics.corner_residuals", "metrics.corner_residuals", "metrics.corner_residuals", "metrics.corner_residuals", "numpy.array().reshape", "numpy.array().reshape", "metrics.transform_point", "metrics.as_rect", "metrics.as_rect", "max", "max", "metrics.as_rect", "max", "max", "metrics.as_rect", "max", "max", "max", "metrics.template_perimeter", "numpy.array", "numpy.array", "metrics.as_rect"], "function", ["home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.provide_regular_orientation", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.provide_regular_orientation", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.corner_residuals", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.corner_residuals", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.corner_residuals", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.corner_residuals", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.transform_point", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.as_rect", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.as_rect", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.as_rect", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.as_rect", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.template_perimeter", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.as_rect"], ["", "", "def", "residual_metric", "(", "run", ",", "ideal", ",", "size", ")", ":", "\n", "    ", "import", "cv2", "\n", "\n", "run", "=", "provide_regular_orientation", "(", "run", ")", "\n", "ideal", "=", "provide_regular_orientation", "(", "ideal", ")", "\n", "\n", "matrix", "=", "cv2", ".", "getPerspectiveTransform", "(", "np", ".", "array", "(", "run", ",", "np", ".", "float32", ")", ".", "reshape", "(", "-", "1", ",", "2", ")", ",", "\n", "np", ".", "array", "(", "as_rect", "(", "size", ")", ",", "np", ".", "float32", ")", ".", "reshape", "(", "-", "1", ",", "2", ")", ")", "\n", "\n", "ta", "=", "[", "transform_point", "(", "matrix", ",", "p", ")", "for", "p", "in", "ideal", "]", "\n", "residuals", "=", "corner_residuals", "(", "ta", ",", "as_rect", "(", "size", ")", ")", "\n", "\n", "ta_rotated", "=", "[", "ta", "[", "3", "]", ",", "ta", "[", "0", "]", ",", "ta", "[", "1", "]", ",", "ta", "[", "2", "]", "]", "\n", "residuals_rotated", "=", "corner_residuals", "(", "ta_rotated", ",", "as_rect", "(", "size", ")", ")", "\n", "if", "max", "(", "residuals", ")", ">", "max", "(", "residuals_rotated", ")", ":", "\n", "        ", "residuals", "=", "residuals_rotated", "\n", "", "ta_rotated", "=", "[", "ta", "[", "2", "]", ",", "ta", "[", "3", "]", ",", "ta", "[", "0", "]", ",", "ta", "[", "1", "]", "]", "\n", "residuals_rotated", "=", "corner_residuals", "(", "ta_rotated", ",", "as_rect", "(", "size", ")", ")", "\n", "if", "max", "(", "residuals", ")", ">", "max", "(", "residuals_rotated", ")", ":", "\n", "        ", "residuals", "=", "residuals_rotated", "\n", "", "ta_rotated", "=", "[", "ta", "[", "1", "]", ",", "ta", "[", "2", "]", ",", "ta", "[", "3", "]", ",", "ta", "[", "0", "]", "]", "\n", "residuals_rotated", "=", "corner_residuals", "(", "ta_rotated", ",", "as_rect", "(", "size", ")", ")", "\n", "if", "max", "(", "residuals", ")", ">", "max", "(", "residuals_rotated", ")", ":", "\n", "        ", "residuals", "=", "residuals_rotated", "\n", "\n", "", "score", "=", "max", "(", "residuals", ")", "/", "template_perimeter", "(", "size", ")", "\n", "\n", "return", "score", "\n", "", ""]], "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.run_stat.read_json": [[12, 15], ["open", "json.load"], "function", ["None"], ["def", "read_json", "(", "fin", ")", ":", "\n", "    ", "with", "open", "(", "fin", ",", "encoding", "=", "'utf-8'", ")", "as", "f", ":", "\n", "        ", "return", "json", ".", "load", "(", "f", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.run_stat.process_name": [[17, 24], ["max", "name.find", "name.rfind", "name.rfind", "len"], "function", ["None"], ["", "", "def", "process_name", "(", "name", ")", ":", "\n", "    ", "pos", "=", "max", "(", "name", ".", "rfind", "(", "'/'", ")", ",", "name", ".", "rfind", "(", "'\\\\'", ")", ")", "\n", "name", "=", "name", "[", "pos", "+", "1", ":", "len", "(", "name", ")", "]", "\n", "pos", "=", "name", ".", "find", "(", "'.'", ")", "\n", "name", "=", "name", "[", "0", ":", "pos", "]", "\n", "\n", "return", "name", "\n", "\n"]], "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.run_stat.process_item": [[26, 64], ["metrics.mean_intersection_over_union", "metrics.intersection_over_union_with_ground_truth_normalization", "metrics.intersection_over_union", "metrics.residual_metric"], "function", ["home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.mean_intersection_over_union", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.intersection_over_union_with_ground_truth_normalization", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.intersection_over_union", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.metrics.residual_metric"], ["", "def", "process_item", "(", "item", ",", "statistics", ")", ":", "\n", "    ", "stat", "=", "{", "}", "\n", "if", "not", "item", "[", "'system_result_quad_exists'", "]", ":", "\n", "        ", "if", "'mean_iou'", "in", "statistics", ":", "\n", "            ", "stat", "[", "'mean_iou'", "]", "=", "0.0", "\n", "", "if", "'iou_gt'", "in", "statistics", ":", "\n", "            ", "stat", "[", "'iou_gt'", "]", "=", "0.0", "\n", "", "if", "'iou'", "in", "statistics", ":", "\n", "            ", "stat", "[", "'iou'", "]", "=", "0.0", "\n", "", "if", "'minD'", "in", "statistics", ":", "\n", "            ", "stat", "[", "'minD'", "]", "=", "np", ".", "nan", "\n", "\n", "", "return", "stat", "\n", "\n", "", "system_quad", "=", "item", "[", "'system_result_quad'", "]", "\n", "true_quad", "=", "item", "[", "'ground_truth_quad'", "]", "\n", "template_size", "=", "item", "[", "'template_size'", "]", "\n", "image_size", "=", "item", "[", "'size'", "]", "\n", "\n", "if", "'mean_iou'", "in", "statistics", ":", "\n", "        ", "mean_iou_stat", "=", "metrics", ".", "mean_intersection_over_union", "(", "system_quad", ",", "true_quad", ",", "image_size", ")", "\n", "stat", "[", "'mean_iou'", "]", "=", "mean_iou_stat", "\n", "\n", "", "if", "'iou_gt'", "in", "statistics", ":", "\n", "        ", "normed_iou_stat", "=", "metrics", ".", "intersection_over_union_with_ground_truth_normalization", "(", "system_quad", ",", "\n", "true_quad", ",", "\n", "template_size", ")", "\n", "stat", "[", "'iou_gt'", "]", "=", "normed_iou_stat", "\n", "\n", "", "if", "'iou'", "in", "statistics", ":", "\n", "        ", "iou_stat", "=", "metrics", ".", "intersection_over_union", "(", "system_quad", ",", "true_quad", ")", "\n", "stat", "[", "'iou'", "]", "=", "iou_stat", "\n", "\n", "", "if", "'minD'", "in", "statistics", ":", "\n", "        ", "residual_stat", "=", "metrics", ".", "residual_metric", "(", "system_quad", ",", "true_quad", ",", "template_size", ")", "\n", "stat", "[", "'minD'", "]", "=", "residual_stat", "\n", "\n", "", "return", "stat", "\n", "\n"]], "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.run_stat.add_to_stats": [[66, 73], ["one_item_stat.keys", "stats.keys", "stats[].append", "stats[].append"], "function", ["None"], ["", "def", "add_to_stats", "(", "stats", ",", "one_item_stat", ")", ":", "\n", "    ", "for", "key", "in", "one_item_stat", ".", "keys", "(", ")", ":", "\n", "        ", "if", "key", "in", "stats", ".", "keys", "(", ")", ":", "\n", "            ", "stats", "[", "key", "]", ".", "append", "(", "one_item_stat", "[", "key", "]", ")", "\n", "", "else", ":", "\n", "            ", "stats", "[", "key", "]", "=", "[", "]", "\n", "stats", "[", "key", "]", ".", "append", "(", "one_item_stat", "[", "key", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.run_stat.process": [[75, 93], ["print", "print", "print", "run_stat.read_json", "open", "set", "print", "open.read().splitlines", "run_stat.process_name", "run_stat.process_item", "run_stat.add_to_stats", "open.read"], "function", ["home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.run_stat.read_json", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.run_stat.process_name", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.run_stat.process_item", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.run_stat.add_to_stats"], ["", "", "", "def", "process", "(", "results", ",", "runlist", ",", "stat_types", ")", ":", "\n", "    ", "print", "(", "'Calulating following statistic(s):'", ")", "\n", "for", "stat", "in", "stat_types", ":", "\n", "        ", "print", "(", "'   '", "+", "stat", ")", "\n", "", "print", "(", "'on subset of MIDV-500:'", ")", "\n", "print", "(", "runlist", ")", "\n", "\n", "results", "=", "read_json", "(", "results", ")", "\n", "runlist", "=", "open", "(", "runlist", ",", "'r'", ")", "\n", "current_images", "=", "set", "(", "runlist", ".", "read", "(", ")", ".", "splitlines", "(", ")", ")", "\n", "stats", "=", "{", "}", "\n", "for", "result", "in", "results", ":", "\n", "        ", "result_name", "=", "result", "[", "'origin_image_path'", "]", "\n", "result_name", "=", "process_name", "(", "result_name", ")", "\n", "if", "result_name", "in", "current_images", ":", "\n", "            ", "one_stat", "=", "process_item", "(", "result", ",", "stat_types", ")", "\n", "add_to_stats", "(", "stats", ",", "one_stat", ")", "\n", "", "", "return", "stats", "\n", "\n"]], "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.run_stat.process_whole_report": [[95, 106], ["print", "print", "run_stat.read_json", "print", "run_stat.process_item", "run_stat.add_to_stats"], "function", ["home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.run_stat.read_json", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.run_stat.process_item", "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.run_stat.add_to_stats"], ["", "def", "process_whole_report", "(", "results", ",", "stat_types", ")", ":", "\n", "    ", "print", "(", "'Calulating following statistic(s):'", ")", "\n", "for", "stat", "in", "stat_types", ":", "\n", "        ", "print", "(", "'   '", "+", "stat", ")", "\n", "", "print", "(", "'on full MIDV-500 dataset'", ")", "\n", "results", "=", "read_json", "(", "results", ")", "\n", "stats", "=", "{", "}", "\n", "for", "result", "in", "results", ":", "\n", "        ", "one_stat", "=", "process_item", "(", "result", ",", "stat_types", ")", "\n", "add_to_stats", "(", "stats", ",", "one_stat", ")", "\n", "", "return", "stats", "\n", "\n"]], "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.run_stat.stat_output": [[108, 177], ["len", "numpy.mean", "print", "print", "print", "print", "print", "print", "len", "numpy.mean", "print", "print", "print", "print", "print", "print", "len", "numpy.mean", "print", "print", "print", "print", "print", "print", "len", "numpy.nanmean", "print", "print", "print", "print", "print", "print", "numpy.array", "numpy.array", "numpy.isnan"], "function", ["None"], ["", "def", "stat_output", "(", "stats", ",", "stat_types", ")", ":", "\n", "    ", "length", ",", "avg", ",", "thr_num", "=", "0", ",", "0.0", ",", "0.0", "\n", "if", "'mean_iou'", "in", "stat_types", ":", "\n", "        ", "length", "=", "len", "(", "stats", "[", "'mean_iou'", "]", ")", "\n", "avg", "=", "np", ".", "mean", "(", "np", ".", "array", "(", "stats", "[", "'mean_iou'", "]", ")", ")", "\n", "for", "st", "in", "stats", "[", "'mean_iou'", "]", ":", "\n", "            ", "if", "st", ">", "THRESHOLD", "-", "1e-10", ":", "\n", "                ", "thr_num", "+=", "1", "\n", "", "", "thr_num", "/=", "length", "\n", "\n", "print", "(", "'\\n'", ")", "\n", "print", "(", "'Metric: Mean intersection over union of foreground and background'", ")", "\n", "print", "(", "'   Number of images                : '", ",", "length", ")", "\n", "print", "(", "'   Average value                   : '", ",", "avg", ")", "\n", "print", "(", "'   Percentage of correct (*) images: '", ",", "thr_num", "*", "100", ",", "'%'", ")", "\n", "print", "(", "\"* A result is considered to be correct if its score is more than THRESHOLD=%.2f.\"", "%", "THRESHOLD", ",", "\n", "\"To change THRESHOLD see help\"", ")", "\n", "", "length", ",", "avg", ",", "thr_num", "=", "0", ",", "0.0", ",", "0.0", "\n", "if", "'iou_gt'", "in", "stat_types", ":", "\n", "        ", "length", "=", "len", "(", "stats", "[", "'iou_gt'", "]", ")", "\n", "avg", "=", "np", ".", "mean", "(", "np", ".", "array", "(", "stats", "[", "'iou_gt'", "]", ")", ")", "\n", "for", "st", "in", "stats", "[", "'iou_gt'", "]", ":", "\n", "            ", "if", "st", ">", "THRESHOLD", "-", "1e-10", ":", "\n", "                ", "thr_num", "+=", "1", "\n", "", "", "thr_num", "/=", "length", "\n", "\n", "print", "(", "'\\n'", ")", "\n", "print", "(", "'Metric: Intersection over union in ground truth quad coordinate system'", ")", "\n", "print", "(", "'   Number of images                : '", ",", "length", ")", "\n", "print", "(", "'   Average value                   : '", ",", "avg", ")", "\n", "print", "(", "'   Percentage of correct (*) images: '", ",", "thr_num", "*", "100", ",", "'%'", ")", "\n", "print", "(", "\"* A result is considered to be correct if its score is more than THRESHOLD=%.2f.\"", "%", "THRESHOLD", ",", "\n", "\"To change THRESHOLD see help\"", ")", "\n", "", "length", ",", "avg", ",", "thr_num", "=", "0", ",", "0.0", ",", "0.0", "\n", "if", "'iou'", "in", "stat_types", ":", "\n", "        ", "length", "=", "len", "(", "stats", "[", "'iou'", "]", ")", "\n", "avg", "=", "np", ".", "mean", "(", "stats", "[", "'iou'", "]", ")", "\n", "for", "st", "in", "stats", "[", "'iou'", "]", ":", "\n", "            ", "if", "st", ">", "THRESHOLD", "-", "1e-10", ":", "\n", "                ", "thr_num", "+=", "1", "\n", "", "", "thr_num", "/=", "length", "\n", "\n", "print", "(", "'\\n'", ")", "\n", "print", "(", "'Metric: Intersection over union'", ")", "\n", "print", "(", "'   Number of images                : '", ",", "length", ")", "\n", "print", "(", "'   Average value                   : '", ",", "avg", ")", "\n", "print", "(", "'   Percentage of correct (*) images: '", ",", "thr_num", "*", "100", ",", "'%'", ")", "\n", "print", "(", "\"* A result is considered to be correct if its score is more than THRESHOLD=%.2f.\"", "%", "THRESHOLD", ",", "\n", "\"To change THRESHOLD see help\"", ")", "\n", "", "length", ",", "avg", ",", "thr_num", "=", "0", ",", "0.0", ",", "0.0", "\n", "if", "'minD'", "in", "stat_types", ":", "\n", "        ", "length", "=", "len", "(", "stats", "[", "'minD'", "]", ")", "\n", "avg", "=", "np", ".", "nanmean", "(", "stats", "[", "'minD'", "]", ")", "\n", "\n", "for", "st", "in", "stats", "[", "'minD'", "]", ":", "\n", "            ", "if", "not", "np", ".", "isnan", "(", "st", ")", ":", "\n", "                ", "if", "st", "<", "RESIDUALS_THRESHOLD", "+", "1e-10", ":", "\n", "                    ", "thr_num", "+=", "1", "\n", "", "", "", "thr_num", "/=", "length", "\n", "\n", "print", "(", "'\\n'", ")", "\n", "print", "(", "'Metric: Minimum corner distance in result quad coordinate system'", ")", "\n", "print", "(", "'   Number of images                 : '", ",", "length", ")", "\n", "print", "(", "'   Average value (*)                : '", ",", "avg", ")", "\n", "print", "(", "'   Percentage of correct (**) images: '", ",", "thr_num", "*", "100", ",", "'%'", ")", "\n", "print", "(", "\"* Note: average value is calculated only for the images having a resulting quadrilateral\\n\"", "\n", "\"** A result is considered to be correct if its deviation\"", "\n", "\" is less than RESIDUALS_THRESHOLD=%.3f.\"", "%", "RESIDUALS_THRESHOLD", ",", "\n", "\"To change RESIDUALS_THRESHOLD see help\\n\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.SmartEngines_hough_document_localization.None.run_stat.create_parser": [[179, 229], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument"], "function", ["None"], ["", "", "def", "create_parser", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", "description", "=", "'This script calculate accuracy on MIDV-500 dataset'", ",", "\n", "formatter_class", "=", "argparse", ".", "RawTextHelpFormatter", ")", "\n", "parser", ".", "add_argument", "(", "'report'", ",", "type", "=", "str", ",", "\n", "help", "=", "'path to file containing output data in JSON format. '", "\n", "'It should contain following fields for every image:\\n'", "\n", "'\\'origin_image_path\\'         - path to source image (either absolute or relative)\\n'", "\n", "'\\'size\\'                      - image size as an array of numbers [width, height]\\n'", "\n", "'\\'template_size\\'             - size of a template as an array of numbers '", "\n", "'[width, height]\\n'", "\n", "'\\'ground_truth_quad\\'         - markup quadrilateral coordinates '", "\n", "'as an array of 4 arrays of 2 doubles '", "\n", "'e.g. [[0.0, 0.0], [100.0, 0.0], [100.0, 200.0], [0.0, 200.0]]\\n'", "\n", "'\\'system_result_quad_exists\\' - if there is a system quadrilateral output\\n'", "\n", "'\\'system_result_quad\\'        - output quadrilateral coordinates '", "\n", "'(see \\'ground_truth_quad\\')\\n'", "\n", "'\\n'", "\n", "'e.g.:\\n'", "\n", "'{'", "\n", "'\"origin_image_path\": \"D:/images\\\\01_alb_id/CA\\\\CA01_01.tif\",\\n'", "\n", "'\"size\": [ 1080, 1920],\\n'", "\n", "'\"template_size\": [ 856, 540],\\n'", "\n", "'\"ground_truth_quad\": [\\n'", "\n", "'   [ 97.0, 672.0],\\n'", "\n", "'   [ 904.0, 643.0],\\n'", "\n", "'   [ 931.0, 1142.0],\\n'", "\n", "'   [ 122.0, 1185.0]]\\n'", "\n", "'\"system_result_quad_exists\": true,\\n'", "\n", "'\"system_result_quad\": [\\n'", "\n", "'   [ 45.1, 674.3],\\n'", "\n", "'   [ 903.8, 643.4],\\n'", "\n", "'   [ 930.4, 1141.7],\\n'", "\n", "'   [ 116.2, 1185.0]]\\n'", "\n", "'}'", ")", "\n", "\n", "parser", ".", "add_argument", "(", "'--runlist'", ",", "type", "=", "str", ",", "\n", "help", "=", "'path to a list of images to be checked. If None given, whole report file will be checked'", ")", "\n", "parser", ".", "add_argument", "(", "'--metrics'", ",", "dest", "=", "'metrics'", ",", "nargs", "=", "'+'", ",", "type", "=", "str", ",", "\n", "choices", "=", "{", "'iou'", ",", "'mean_iou'", ",", "'iou_gt'", ",", "'minD'", "}", ",", "\n", "help", "=", "'what metrics should be used to calculate statistics. Possible variants: \\n'", "\n", "'\\'iou\\'       - IoU (intersection over union) \\n'", "\n", "'\\'mean_iou\\'  - mean IoU of foreground and background \\n'", "\n", "'\\'iou_gt\\' - IoU in ground-truth quad coordinate system \\n'", "\n", "'\\'minD\\'      - minimum by all relabling quads from maximum corner distance in result quad coordinate system\\n'", "\n", "\"Note: this value is calculated only for the images having a resulting quadrilateral\"", ")", "\n", "parser", ".", "add_argument", "(", "'--hardChangeThreshold'", ",", "dest", "=", "'changed_thr_const'", ",", "type", "=", "float", ",", "\n", "help", "=", "'changes threshold constant (default=0.9)'", ")", "\n", "parser", ".", "add_argument", "(", "'--hardChangeResidualsThreshold'", ",", "dest", "=", "'changed_residuals_const'", ",", "type", "=", "float", ",", "\n", "help", "=", "'changes residuals Threshold constant (default=0.017)'", ")", "\n", "return", "parser", "\n", "\n"]]}