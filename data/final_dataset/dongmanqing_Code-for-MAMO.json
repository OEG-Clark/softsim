{"home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.__init__": [[6, 14], ["super().__init__"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.info_embedding.UserEmbedding.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input1_module", ",", "input2_module", ",", "embedding1_module", ",", "embedding2_module", ",", "rec_module", ")", ":", "\n", "        ", "super", "(", "BASEModel", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "input_user_loading", "=", "input1_module", "\n", "self", ".", "input_item_loading", "=", "input2_module", "\n", "self", ".", "user_embedding", "=", "embedding1_module", "\n", "self", ".", "item_embedding", "=", "embedding2_module", "\n", "self", ".", "rec_model", "=", "rec_module", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.forward": [[15, 20], ["models.BASEModel.rec_model", "models.BASEModel.input_user_loading", "models.BASEModel.input_item_loading", "models.BASEModel.user_embedding", "models.BASEModel.item_embedding"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x1", ",", "x2", ")", ":", "\n", "        ", "pu", ",", "pi", "=", "self", ".", "input_user_loading", "(", "x1", ")", ",", "self", ".", "input_item_loading", "(", "x2", ")", "\n", "eu", ",", "ei", "=", "self", ".", "user_embedding", "(", "pu", ")", ",", "self", ".", "item_embedding", "(", "pi", ")", "\n", "rec_value", "=", "self", ".", "rec_model", "(", "eu", ",", "ei", ")", "\n", "return", "rec_value", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.get_weights": [[21, 26], ["utils.get_params", "utils.get_params", "utils.get_params", "models.BASEModel.user_embedding.parameters", "models.BASEModel.item_embedding.parameters", "models.BASEModel.rec_model.parameters"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.get_params", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.get_params", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.get_params"], ["", "def", "get_weights", "(", "self", ")", ":", "\n", "        ", "u_emb_params", "=", "get_params", "(", "self", ".", "user_embedding", ".", "parameters", "(", ")", ")", "\n", "i_emb_params", "=", "get_params", "(", "self", ".", "item_embedding", ".", "parameters", "(", ")", ")", "\n", "rec_params", "=", "get_params", "(", "self", ".", "rec_model", ".", "parameters", "(", ")", ")", "\n", "return", "u_emb_params", ",", "i_emb_params", ",", "rec_params", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.get_zero_weights": [[27, 32], ["utils.get_zeros_like_params", "utils.get_zeros_like_params", "utils.get_zeros_like_params", "models.BASEModel.user_embedding.parameters", "models.BASEModel.item_embedding.parameters", "models.BASEModel.rec_model.parameters"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.get_zeros_like_params", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.get_zeros_like_params", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.get_zeros_like_params"], ["", "def", "get_zero_weights", "(", "self", ")", ":", "\n", "        ", "zeros_like_u_emb_params", "=", "get_zeros_like_params", "(", "self", ".", "user_embedding", ".", "parameters", "(", ")", ")", "\n", "zeros_like_i_emb_params", "=", "get_zeros_like_params", "(", "self", ".", "item_embedding", ".", "parameters", "(", ")", ")", "\n", "zeros_like_rec_params", "=", "get_zeros_like_params", "(", "self", ".", "rec_model", ".", "parameters", "(", ")", ")", "\n", "return", "zeros_like_u_emb_params", ",", "zeros_like_i_emb_params", ",", "zeros_like_rec_params", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.init_weights": [[33, 37], ["utils.init_params", "utils.init_params", "utils.init_params", "models.BASEModel.user_embedding.parameters", "models.BASEModel.item_embedding.parameters", "models.BASEModel.rec_model.parameters"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.init_params", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.init_params", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.init_params"], ["", "def", "init_weights", "(", "self", ",", "u_emb_para", ",", "i_emb_para", ",", "rec_para", ")", ":", "\n", "        ", "init_params", "(", "self", ".", "user_embedding", ".", "parameters", "(", ")", ",", "u_emb_para", ")", "\n", "init_params", "(", "self", ".", "item_embedding", ".", "parameters", "(", ")", ",", "i_emb_para", ")", "\n", "init_params", "(", "self", ".", "rec_model", ".", "parameters", "(", ")", ",", "rec_para", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.get_grad": [[38, 43], ["utils.get_grad", "utils.get_grad", "utils.get_grad", "models.BASEModel.user_embedding.parameters", "models.BASEModel.item_embedding.parameters", "models.BASEModel.rec_model.parameters"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.get_grad", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.get_grad", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.get_grad"], ["", "def", "get_grad", "(", "self", ")", ":", "\n", "        ", "u_grad", "=", "get_grad", "(", "self", ".", "user_embedding", ".", "parameters", "(", ")", ")", "\n", "i_grad", "=", "get_grad", "(", "self", ".", "item_embedding", ".", "parameters", "(", ")", ")", "\n", "r_grad", "=", "get_grad", "(", "self", ".", "rec_model", ".", "parameters", "(", ")", ")", "\n", "return", "u_grad", ",", "i_grad", ",", "r_grad", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.init_u_mem_weights": [[44, 48], ["utils.init_u_mem_params", "utils.init_params", "utils.init_params", "models.BASEModel.user_embedding.parameters", "models.BASEModel.item_embedding.parameters", "models.BASEModel.rec_model.parameters"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.init_u_mem_params", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.init_params", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.init_params"], ["", "def", "init_u_mem_weights", "(", "self", ",", "u_emb_para", ",", "mu", ",", "tao", ",", "i_emb_para", ",", "rec_para", ")", ":", "\n", "        ", "init_u_mem_params", "(", "self", ".", "user_embedding", ".", "parameters", "(", ")", ",", "u_emb_para", ",", "mu", ",", "tao", ")", "\n", "init_params", "(", "self", ".", "item_embedding", ".", "parameters", "(", ")", ",", "i_emb_para", ")", "\n", "init_params", "(", "self", ".", "rec_model", ".", "parameters", "(", ")", ",", "rec_para", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.init_ui_mem_weights": [[49, 53], ["task_mem.read_head", "utils.init_ui_mem_params", "models.BASEModel.rec_model.mem_layer.parameters"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.TaskMem.read_head", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.init_ui_mem_params"], ["", "def", "init_ui_mem_weights", "(", "self", ",", "att_values", ",", "task_mem", ")", ":", "\n", "# init the weights only for the mem layer", "\n", "        ", "u_mui", "=", "task_mem", ".", "read_head", "(", "att_values", ")", "\n", "init_ui_mem_params", "(", "self", ".", "rec_model", ".", "mem_layer", ".", "parameters", "(", ")", ",", "u_mui", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.get_ui_mem_weights": [[54, 56], ["utils.get_params", "models.BASEModel.rec_model.mem_layer.parameters"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.get_params"], ["", "def", "get_ui_mem_weights", "(", "self", ")", ":", "\n", "        ", "return", "get_params", "(", "self", ".", "rec_model", ".", "mem_layer", ".", "parameters", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.LOCALUpdate.__init__": [[59, 82], ["utils.load_user_info", "utils.UserDataLoader", "torch.utils.data.DataLoader", "torch.optim.Adam", "torch.nn.CrossEntropyLoss", "models.LOCALUpdate.model.parameters", "models.LOCALUpdate.s_x1.to", "models.LOCALUpdate.s_x2.to", "models.LOCALUpdate.s_y.to", "models.LOCALUpdate.q_x1.to", "models.LOCALUpdate.q_x2.to", "models.LOCALUpdate.q_y.to"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.load_user_info"], ["    ", "def", "__init__", "(", "self", ",", "your_model", ",", "u_idx", ",", "dataset", ",", "sup_size", ",", "que_size", ",", "bt_size", ",", "n_loop", ",", "update_lr", ",", "top_k", ",", "device", ")", ":", "\n", "        ", "self", ".", "s_x1", ",", "self", ".", "s_x2", ",", "self", ".", "s_y", ",", "self", ".", "s_y0", ",", "self", ".", "q_x1", ",", "self", ".", "q_x2", ",", "self", ".", "q_y", ",", "self", ".", "q_y0", "=", "load_user_info", "(", "u_idx", ",", "\n", "dataset", ",", "\n", "sup_size", ",", "\n", "que_size", ",", "\n", "device", ")", "\n", "user_data", "=", "UserDataLoader", "(", "self", ".", "s_x1", ",", "self", ".", "s_x2", ",", "self", ".", "s_y", ",", "self", ".", "s_y0", ")", "\n", "self", ".", "user_data_loader", "=", "DataLoader", "(", "user_data", ",", "batch_size", "=", "bt_size", ")", "\n", "self", ".", "model", "=", "your_model", "\n", "\n", "self", ".", "update_lr", "=", "update_lr", "\n", "self", ".", "optimizer", "=", "torch", ".", "optim", ".", "Adam", "(", "self", ".", "model", ".", "parameters", "(", ")", ",", "lr", "=", "self", ".", "update_lr", ")", "\n", "\n", "# self.loss_fn = torch.nn.NLLLoss()", "\n", "self", ".", "loss_fn", "=", "torch", ".", "nn", ".", "CrossEntropyLoss", "(", ")", "\n", "\n", "self", ".", "n_loop", "=", "n_loop", "\n", "self", ".", "top_k", "=", "top_k", "\n", "\n", "self", ".", "device", "=", "device", "\n", "\n", "self", ".", "s_x1", ",", "self", ".", "s_x2", ",", "self", ".", "s_y", "=", "self", ".", "s_x1", ".", "to", "(", "self", ".", "device", ")", ",", "self", ".", "s_x2", ".", "to", "(", "self", ".", "device", ")", ",", "self", ".", "s_y", ".", "to", "(", "self", ".", "device", ")", "\n", "self", ".", "q_x1", ",", "self", ".", "q_x2", ",", "self", ".", "q_y", "=", "self", ".", "q_x1", ".", "to", "(", "self", ".", "device", ")", ",", "self", ".", "q_x2", ".", "to", "(", "self", ".", "device", ")", ",", "self", ".", "q_y", ".", "to", "(", "self", ".", "device", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.LOCALUpdate.train": [[83, 103], ["range", "models.LOCALUpdate.model", "models.LOCALUpdate.optimizer.zero_grad", "models.LOCALUpdate.loss_fn", "models.LOCALUpdate.backward", "torch.nn.utils.clip_grad_norm_", "models.LOCALUpdate.model.get_grad", "enumerate", "models.LOCALUpdate.model.parameters", "models.LOCALUpdate.model", "models.LOCALUpdate.loss_fn", "models.LOCALUpdate.optimizer.zero_grad", "models.LOCALUpdate.backward", "torch.nn.utils.clip_grad_norm_", "models.LOCALUpdate.optimizer.step", "x1.to", "x2.to", "y.to", "models.LOCALUpdate.model.parameters"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.get_grad"], ["", "def", "train", "(", "self", ")", ":", "\n", "        ", "for", "i", "in", "range", "(", "self", ".", "n_loop", ")", ":", "\n", "# on support set", "\n", "            ", "for", "i_batch", ",", "(", "x1", ",", "x2", ",", "y", ",", "y0", ")", "in", "enumerate", "(", "self", ".", "user_data_loader", ")", ":", "\n", "                ", "x1", ",", "x2", ",", "y", "=", "x1", ".", "to", "(", "self", ".", "device", ")", ",", "x2", ".", "to", "(", "self", ".", "device", ")", ",", "y", ".", "to", "(", "self", ".", "device", ")", "\n", "pred_y", "=", "self", ".", "model", "(", "x1", ",", "x2", ")", "\n", "loss", "=", "self", ".", "loss_fn", "(", "pred_y", ",", "y", ")", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "loss", ".", "backward", "(", ")", "# local theta updating", "\n", "torch", ".", "nn", ".", "utils", ".", "clip_grad_norm_", "(", "self", ".", "model", ".", "parameters", "(", ")", ",", "5.", ")", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "", "", "q_pred_y", "=", "self", ".", "model", "(", "self", ".", "q_x1", ",", "self", ".", "q_x2", ")", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "loss", "=", "self", ".", "loss_fn", "(", "q_pred_y", ",", "self", ".", "q_y", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "torch", ".", "nn", ".", "utils", ".", "clip_grad_norm_", "(", "self", ".", "model", ".", "parameters", "(", ")", ",", "5.", ")", "\n", "\n", "u_grad", ",", "i_grad", ",", "r_grad", "=", "self", ".", "model", ".", "get_grad", "(", ")", "\n", "return", "u_grad", ",", "i_grad", ",", "r_grad", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.LOCALUpdate.test": [[104, 118], ["range", "models.LOCALUpdate.model", "enumerate", "models.LOCALUpdate.model", "models.LOCALUpdate.loss_fn", "models.LOCALUpdate.optimizer.zero_grad", "models.LOCALUpdate.backward", "torch.nn.utils.clip_grad_norm_", "models.LOCALUpdate.optimizer.step", "x1.to", "x2.to", "y.to", "models.LOCALUpdate.model.parameters"], "methods", ["None"], ["", "def", "test", "(", "self", ")", ":", "\n", "        ", "for", "i", "in", "range", "(", "self", ".", "n_loop", ")", ":", "\n", "# on support set", "\n", "            ", "for", "i_batch", ",", "(", "x1", ",", "x2", ",", "y", ",", "y0", ")", "in", "enumerate", "(", "self", ".", "user_data_loader", ")", ":", "\n", "                ", "x1", ",", "x2", ",", "y", "=", "x1", ".", "to", "(", "self", ".", "device", ")", ",", "x2", ".", "to", "(", "self", ".", "device", ")", ",", "y", ".", "to", "(", "self", ".", "device", ")", "\n", "pred_y", "=", "self", ".", "model", "(", "x1", ",", "x2", ")", "\n", "loss", "=", "self", ".", "loss_fn", "(", "pred_y", ",", "y", ")", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "loss", ".", "backward", "(", ")", "# local theta updating", "\n", "torch", ".", "nn", ".", "utils", ".", "clip_grad_norm_", "(", "self", ".", "model", ".", "parameters", "(", ")", ",", "5.", ")", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "# D.I.Y your calculation for the results", "\n", "", "", "q_pred_y", "=", "self", ".", "model", "(", "self", ".", "q_x1", ",", "self", ".", "q_x2", ")", "# on query set", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.maml_train": [[120, 125], ["utils.update_parameters", "utils.update_parameters", "utils.update_parameters"], "function", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.update_parameters", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.update_parameters", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.update_parameters"], ["", "", "def", "maml_train", "(", "raw_phi_u", ",", "raw_phi_i", ",", "raw_phi_r", ",", "u_grad_list", ",", "i_grad_list", ",", "r_grad_list", ",", "global_lr", ")", ":", "\n", "    ", "phi_u", "=", "update_parameters", "(", "raw_phi_u", ",", "u_grad_list", ",", "global_lr", ")", "\n", "phi_i", "=", "update_parameters", "(", "raw_phi_i", ",", "i_grad_list", ",", "global_lr", ")", "\n", "phi_r", "=", "update_parameters", "(", "raw_phi_r", ",", "r_grad_list", ",", "global_lr", ")", "\n", "return", "phi_u", ",", "phi_i", ",", "phi_r", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.user_mem_init": [[127, 135], ["pickle.load", "utils.to_torch().to", "loading_model", "feature_mem.read_head", "open", "utils.to_torch", "str"], "function", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.TaskMem.read_head", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.to_torch"], ["", "def", "user_mem_init", "(", "u_id", ",", "dataset", ",", "device", ",", "feature_mem", ",", "loading_model", ",", "alpha", ")", ":", "\n", "    ", "path", "=", "'data_processed/'", "+", "dataset", "+", "'/raw/'", "\n", "u_x1_data", "=", "pickle", ".", "load", "(", "open", "(", "'{}sample_{}_x1.p'", ".", "format", "(", "path", ",", "str", "(", "u_id", ")", ")", ",", "'rb'", ")", ")", "\n", "u_x1", "=", "to_torch", "(", "[", "u_x1_data", "]", ")", ".", "to", "(", "device", ")", "\n", "pu", "=", "loading_model", "(", "u_x1", ")", "\n", "personalized_bias_term", ",", "att_values", "=", "feature_mem", ".", "read_head", "(", "pu", ",", "alpha", ")", "\n", "del", "u_x1_data", ",", "u_x1", ",", "pu", "\n", "return", "personalized_bias_term", ",", "att_values", "\n", "", ""]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.mamoRec.MAMRec.__init__": [[12, 72], ["torch.cuda.is_available", "torch.device", "train_test_user_list", "modules.info_embedding.UserEmbedding().to", "modules.info_embedding.ItemEmbedding().to", "modules.rec_model.RecMAM().to", "models.BASEModel().to", "mamoRec.MAMRec.model.get_weights", "modules.memories.FeatureMem", "modules.memories.TaskMem", "mamoRec.MAMRec.train", "modules.input_loading.MLUserLoading().to", "modules.input_loading.MLItemLoading().to", "modules.input_loading.BKUserLoading().to", "modules.input_loading.BKItemLoading().to", "modules.info_embedding.UserEmbedding", "modules.info_embedding.ItemEmbedding", "modules.rec_model.RecMAM", "models.BASEModel", "modules.input_loading.MLUserLoading", "modules.input_loading.MLItemLoading", "modules.input_loading.BKUserLoading", "modules.input_loading.BKItemLoading"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.train_test_user_list", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.get_weights", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.LOCALUpdate.train"], ["    ", "def", "__init__", "(", "self", ",", "dataset", "=", "'movielens'", ")", ":", "\n", "\n", "        ", "self", ".", "dataset", "=", "dataset", "\n", "self", ".", "support_size", "=", "config_settings", "[", "'support_size'", "]", "\n", "self", ".", "query_size", "=", "config_settings", "[", "'query_size'", "]", "\n", "self", ".", "n_epoch", "=", "config_settings", "[", "'n_epoch'", "]", "\n", "self", ".", "n_inner_loop", "=", "config_settings", "[", "'n_inner_loop'", "]", "\n", "self", ".", "batch_size", "=", "config_settings", "[", "'batch_size'", "]", "\n", "self", ".", "n_layer", "=", "config_settings", "[", "'n_layer'", "]", "\n", "self", ".", "embedding_dim", "=", "config_settings", "[", "'embedding_dim'", "]", "\n", "self", ".", "rho", "=", "config_settings", "[", "'rho'", "]", "# local learning rate", "\n", "self", ".", "lamda", "=", "config_settings", "[", "'lamda'", "]", "# global learning rate", "\n", "self", ".", "tao", "=", "config_settings", "[", "'tao'", "]", "# hyper-parameter for initializing personalized u weights", "\n", "self", ".", "USE_CUDA", "=", "torch", ".", "cuda", ".", "is_available", "(", ")", "\n", "self", ".", "device", "=", "torch", ".", "device", "(", "config_settings", "[", "'cuda_option'", "]", "if", "self", ".", "USE_CUDA", "else", "\"cpu\"", ")", "\n", "self", ".", "n_k", "=", "config_settings", "[", "'n_k'", "]", "\n", "self", ".", "alpha", "=", "config_settings", "[", "'alpha'", "]", "\n", "self", ".", "beta", "=", "config_settings", "[", "'beta'", "]", "\n", "self", ".", "gamma", "=", "config_settings", "[", "'gamma'", "]", "\n", "self", ".", "active_func", "=", "config_settings", "[", "'active_func'", "]", "\n", "self", ".", "rand", "=", "config_settings", "[", "'rand'", "]", "\n", "self", ".", "random_state", "=", "config_settings", "[", "'random_state'", "]", "\n", "self", ".", "split_ratio", "=", "config_settings", "[", "'split_ratio'", "]", "\n", "\n", "# load dataset", "\n", "self", ".", "train_users", ",", "self", ".", "test_users", "=", "train_test_user_list", "(", "dataset", "=", "dataset", ",", "rand", "=", "self", ".", "rand", ",", "\n", "random_state", "=", "self", ".", "random_state", ",", "\n", "train_test_split_ratio", "=", "self", ".", "split_ratio", ")", "\n", "\n", "if", "dataset", "==", "'movielens'", ":", "\n", "            ", "self", ".", "x1_loading", ",", "self", ".", "x2_loading", "=", "MLUserLoading", "(", "embedding_dim", "=", "self", ".", "embedding_dim", ")", ".", "to", "(", "self", ".", "device", ")", ",", "MLItemLoading", "(", "embedding_dim", "=", "self", ".", "embedding_dim", ")", ".", "to", "(", "self", ".", "device", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "x1_loading", ",", "self", ".", "x2_loading", "=", "BKUserLoading", "(", "embedding_dim", "=", "self", ".", "embedding_dim", ")", ".", "to", "(", "self", ".", "device", ")", ",", "BKItemLoading", "(", "embedding_dim", "=", "self", ".", "embedding_dim", ")", ".", "to", "(", "self", ".", "device", ")", "\n", "\n", "", "self", ".", "n_y", "=", "default_info", "[", "dataset", "]", "[", "'n_y'", "]", "\n", "\n", "# Embedding model", "\n", "self", ".", "UEmb", "=", "UserEmbedding", "(", "self", ".", "n_layer", ",", "default_info", "[", "dataset", "]", "[", "'u_in_dim'", "]", "*", "self", ".", "embedding_dim", ",", "\n", "self", ".", "embedding_dim", ",", "activation", "=", "self", ".", "active_func", ")", ".", "to", "(", "self", ".", "device", ")", "\n", "self", ".", "IEmb", "=", "ItemEmbedding", "(", "self", ".", "n_layer", ",", "default_info", "[", "dataset", "]", "[", "'i_in_dim'", "]", "*", "self", ".", "embedding_dim", ",", "\n", "self", ".", "embedding_dim", ",", "activation", "=", "self", ".", "active_func", ")", ".", "to", "(", "self", ".", "device", ")", "\n", "\n", "# rec model", "\n", "self", ".", "rec_model", "=", "RecMAM", "(", "self", ".", "embedding_dim", ",", "self", ".", "n_y", ",", "self", ".", "n_layer", ",", "activation", "=", "self", ".", "active_func", ")", ".", "to", "(", "self", ".", "device", ")", "\n", "\n", "# whole model", "\n", "self", ".", "model", "=", "BASEModel", "(", "self", ".", "x1_loading", ",", "self", ".", "x2_loading", ",", "self", ".", "UEmb", ",", "self", ".", "IEmb", ",", "self", ".", "rec_model", ")", ".", "to", "(", "self", ".", "device", ")", "\n", "\n", "self", ".", "phi_u", ",", "self", ".", "phi_i", ",", "self", ".", "phi_r", "=", "self", ".", "model", ".", "get_weights", "(", ")", "\n", "\n", "self", ".", "FeatureMEM", "=", "FeatureMem", "(", "self", ".", "n_k", ",", "default_info", "[", "dataset", "]", "[", "'u_in_dim'", "]", "*", "self", ".", "embedding_dim", ",", "\n", "self", ".", "model", ",", "device", "=", "self", ".", "device", ")", "\n", "self", ".", "TaskMEM", "=", "TaskMem", "(", "self", ".", "n_k", ",", "self", ".", "embedding_dim", ",", "device", "=", "self", ".", "device", ")", "\n", "\n", "self", ".", "train", "=", "self", ".", "train_with_meta_optimization", "\n", "self", ".", "test", "=", "self", ".", "test_with_meta_optimization", "\n", "\n", "self", ".", "train", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.mamoRec.MAMRec.train_with_meta_optimization": [[73, 100], ["range", "mamoRec.MAMRec.model.get_zero_weights", "models.maml_train", "mamoRec.MAMRec.test_with_meta_optimization", "models.user_mem_init", "mamoRec.MAMRec.model.init_u_mem_weights", "mamoRec.MAMRec.model.init_ui_mem_weights", "models.LOCALUpdate", "models.LOCALUpdate.train", "mamoRec.MAMRec.FeatureMEM.write_head", "mamoRec.MAMRec.model.get_ui_mem_weights", "mamoRec.MAMRec.TaskMEM.write_head", "grads_sum", "grads_sum", "grads_sum"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.get_zero_weights", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.maml_train", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.mamoRec.MAMRec.test_with_meta_optimization", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.user_mem_init", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.init_u_mem_weights", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.init_ui_mem_weights", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.LOCALUpdate.train", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.TaskMem.write_head", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.get_ui_mem_weights", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.TaskMem.write_head", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.grads_sum", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.grads_sum", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.grads_sum"], ["", "def", "train_with_meta_optimization", "(", "self", ")", ":", "\n", "        ", "for", "i", "in", "range", "(", "self", ".", "n_epoch", ")", ":", "\n", "            ", "u_grad_sum", ",", "i_grad_sum", ",", "r_grad_sum", "=", "self", ".", "model", ".", "get_zero_weights", "(", ")", "\n", "\n", "# On training dataset", "\n", "for", "u", "in", "self", ".", "train_users", "[", ":", "100", "]", ":", "\n", "# init local parameters: theta_u, theta_i, theta_r", "\n", "                ", "bias_term", ",", "att_values", "=", "user_mem_init", "(", "u", ",", "self", ".", "dataset", ",", "self", ".", "device", ",", "self", ".", "FeatureMEM", ",", "self", ".", "x1_loading", ",", "\n", "self", ".", "alpha", ")", "\n", "self", ".", "model", ".", "init_u_mem_weights", "(", "self", ".", "phi_u", ",", "bias_term", ",", "self", ".", "tao", ",", "self", ".", "phi_i", ",", "self", ".", "phi_r", ")", "\n", "self", ".", "model", ".", "init_ui_mem_weights", "(", "att_values", ",", "self", ".", "TaskMEM", ")", "\n", "\n", "user_module", "=", "LOCALUpdate", "(", "self", ".", "model", ",", "u", ",", "self", ".", "dataset", ",", "self", ".", "support_size", ",", "self", ".", "query_size", ",", "self", ".", "batch_size", ",", "\n", "self", ".", "n_inner_loop", ",", "self", ".", "rho", ",", "top_k", "=", "3", ",", "device", "=", "self", ".", "device", ")", "\n", "u_grad", ",", "i_grad", ",", "r_grad", "=", "user_module", ".", "train", "(", ")", "\n", "\n", "u_grad_sum", ",", "i_grad_sum", ",", "r_grad_sum", "=", "grads_sum", "(", "u_grad_sum", ",", "u_grad", ")", ",", "grads_sum", "(", "i_grad_sum", ",", "i_grad", ")", ",", "grads_sum", "(", "r_grad_sum", ",", "r_grad", ")", "\n", "\n", "self", ".", "FeatureMEM", ".", "write_head", "(", "u_grad", ",", "self", ".", "beta", ")", "\n", "u_mui", "=", "self", ".", "model", ".", "get_ui_mem_weights", "(", ")", "\n", "self", ".", "TaskMEM", ".", "write_head", "(", "u_mui", "[", "0", "]", ",", "self", ".", "gamma", ")", "\n", "\n", "", "self", ".", "phi_u", ",", "self", ".", "phi_i", ",", "self", ".", "phi_r", "=", "maml_train", "(", "self", ".", "phi_u", ",", "self", ".", "phi_i", ",", "self", ".", "phi_r", ",", "\n", "u_grad_sum", ",", "i_grad_sum", ",", "r_grad_sum", ",", "self", ".", "lamda", ")", "\n", "\n", "self", ".", "test_with_meta_optimization", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.mamoRec.MAMRec.test_with_meta_optimization": [[101, 114], ["mamoRec.MAMRec.model.get_weights", "models.user_mem_init", "mamoRec.MAMRec.model.init_u_mem_weights", "mamoRec.MAMRec.model.init_ui_mem_weights", "mamoRec.MAMRec.model.init_weights", "models.LOCALUpdate", "models.LOCALUpdate.test"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.get_weights", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.user_mem_init", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.init_u_mem_weights", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.init_ui_mem_weights", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.init_weights", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.LOCALUpdate.test"], ["", "", "def", "test_with_meta_optimization", "(", "self", ")", ":", "\n", "        ", "best_phi_u", ",", "best_phi_i", ",", "best_phi_r", "=", "self", ".", "model", ".", "get_weights", "(", ")", "\n", "\n", "for", "u", "in", "self", ".", "test_users", ":", "\n", "            ", "bias_term", ",", "att_values", "=", "user_mem_init", "(", "u", ",", "self", ".", "dataset", ",", "self", ".", "device", ",", "self", ".", "FeatureMEM", ",", "self", ".", "x1_loading", ",", "\n", "self", ".", "alpha", ")", "\n", "self", ".", "model", ".", "init_u_mem_weights", "(", "best_phi_u", ",", "bias_term", ",", "self", ".", "tao", ",", "best_phi_i", ",", "best_phi_r", ")", "\n", "self", ".", "model", ".", "init_ui_mem_weights", "(", "att_values", ",", "self", ".", "TaskMEM", ")", "\n", "\n", "self", ".", "model", ".", "init_weights", "(", "best_phi_u", ",", "best_phi_i", ",", "best_phi_r", ")", "\n", "user_module", "=", "LOCALUpdate", "(", "self", ".", "model", ",", "u", ",", "self", ".", "dataset", ",", "self", ".", "support_size", ",", "self", ".", "query_size", ",", "self", ".", "batch_size", ",", "\n", "self", ".", "n_inner_loop", ",", "self", ".", "rho", ",", "top_k", "=", "3", ",", "device", "=", "self", ".", "device", ")", "\n", "user_module", ".", "test", "(", ")", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.prepareDataset.id_storing": [[6, 19], ["os.path.exists", "os.mkdir", "os.path.exists", "os.mkdir", "prepare_data.prepareMovielens.id_storing_movielens", "id_storing_bookcrossing"], "function", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.prepare_data.prepareMovielens.id_storing_movielens"], ["def", "id_storing", "(", "dataset", "=", "'movielens'", ",", "max_count", "=", "20", ")", ":", "\n", "# dataset option: 'movielens', 'bookcrossing'", "\n", "# max_count: storing_size", "\n", "    ", "storing_path", "=", "'data_processed'", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "storing_path", ")", ":", "\n", "        ", "os", ".", "mkdir", "(", "storing_path", ")", "\n", "", "if", "not", "os", ".", "path", ".", "exists", "(", "'{}/{}'", ".", "format", "(", "storing_path", ",", "dataset", ")", ")", ":", "\n", "        ", "os", ".", "mkdir", "(", "'{}/{}'", ".", "format", "(", "storing_path", ",", "dataset", ")", ")", "\n", "\n", "", "if", "dataset", "==", "'movielens'", ":", "\n", "        ", "id_storing_movielens", "(", "max_count", "=", "max_count", ")", "\n", "", "else", ":", "\n", "        ", "id_storing_bookcrossing", "(", "max_count", "=", "max_count", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.prepareDataset.dict_storing": [[21, 26], ["prepare_data.prepareMovielens.dict_storing_movielens", "dict_storing_bookcrossing"], "function", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.prepare_data.prepareMovielens.dict_storing_movielens"], ["", "", "def", "dict_storing", "(", "dataset", "=", "'movielens'", ")", ":", "\n", "    ", "if", "dataset", "==", "'movielens'", ":", "\n", "        ", "dict_storing_movielens", "(", ")", "\n", "", "else", ":", "\n", "        ", "dict_storing_bookcrossing", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.prepareDataset.state_check": [[28, 46], ["None"], "function", ["None"], ["", "", "def", "state_check", "(", "u_id", ",", "i_id", ",", "u_state_ids", ",", "i_state_ids", ")", ":", "\n", "\n", "    ", "if", "u_id", "in", "u_state_ids", "[", "'user_warm_ids'", "]", ":", "\n", "# warm-warm", "\n", "        ", "if", "i_id", "in", "i_state_ids", "[", "'item_warm_ids'", "]", ":", "\n", "            ", "code", "=", "0", "\n", "# warm-cold", "\n", "", "else", ":", "\n", "            ", "code", "=", "1", "\n", "\n", "", "", "else", ":", "\n", "# cold-warm", "\n", "        ", "if", "i_id", "in", "i_state_ids", "[", "'item_warm_ids'", "]", ":", "\n", "            ", "code", "=", "2", "\n", "# cold-cold", "\n", "", "else", ":", "\n", "            ", "code", "=", "3", "\n", "", "", "return", "code", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.prepareDataset.data_generation": [[48, 99], ["os.path.exists", "os.mkdir", "pickle.load", "pickle.load", "pickle.load", "pickle.load", "pickle.load", "tqdm", "os.path.exists", "print", "open", "open", "open", "open", "open", "np.array", "pickle.dump", "pickle.dump", "pickle.dump", "pickle.dump", "open", "open", "open", "open", "pickle.load.keys", "prepareDataset.state_check", "i_feature_file.append", "state_codes.append", "str", "str", "str", "str"], "function", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.prepareDataset.state_check"], ["", "def", "data_generation", "(", "dataset", "=", "'movielens'", ")", ":", "\n", "# inputs: movies info, ratings info, state ids", "\n", "# outputs: training and testing samples.", "\n", "#           Each sample is from a user.", "\n", "#           Each sample includes support set and query set.", "\n", "# output type: mixed, warm, cold_user, cold_item, cold_user_item", "\n", "    ", "storing_path", "=", "'data_processed'", "\n", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "'{}/{}/raw'", ".", "format", "(", "storing_path", ",", "dataset", ")", ")", ":", "\n", "        ", "os", ".", "mkdir", "(", "'{}/{}/raw/'", ".", "format", "(", "storing_path", ",", "dataset", ")", ")", "\n", "processing_code", "=", "1", "\n", "", "elif", "not", "os", ".", "path", ".", "exists", "(", "'{}/{}/raw/sample_1_x1.p'", ".", "format", "(", "storing_path", ",", "dataset", ")", ")", ":", "\n", "        ", "processing_code", "=", "1", "\n", "", "else", ":", "\n", "        ", "processing_code", "=", "0", "\n", "print", "(", "'Data already generated! '", ")", "\n", "\n", "", "if", "processing_code", "==", "1", ":", "\n", "        ", "sorted_ratings", "=", "pickle", ".", "load", "(", "open", "(", "'{}/{}/ratings_sorted.p'", ".", "format", "(", "storing_path", ",", "dataset", ")", ",", "'rb'", ")", ")", "\n", "user_state_ids", "=", "pickle", ".", "load", "(", "open", "(", "'{}/{}/user_state_ids.p'", ".", "format", "(", "storing_path", ",", "dataset", ")", ",", "'rb'", ")", ")", "\n", "item_state_ids", "=", "pickle", ".", "load", "(", "open", "(", "'{}/{}/item_state_ids.p'", ".", "format", "(", "storing_path", ",", "dataset", ")", ",", "'rb'", ")", ")", "\n", "user_dict", "=", "pickle", ".", "load", "(", "open", "(", "'{}/{}/user_dict.p'", ".", "format", "(", "storing_path", ",", "dataset", ")", ",", "'rb'", ")", ")", "\n", "item_dict", "=", "pickle", ".", "load", "(", "open", "(", "'{}/{}/item_dict.p'", ".", "format", "(", "storing_path", ",", "dataset", ")", ",", "'rb'", ")", ")", "\n", "\n", "u_all_ids", "=", "user_state_ids", "[", "'user_all_ids'", "]", "\n", "\n", "file_index", "=", "1", "\n", "\n", "for", "u_id", "in", "tqdm", "(", "u_all_ids", ")", ":", "\n", "            ", "u_info", "=", "sorted_ratings", ".", "loc", "[", "sorted_ratings", ".", "user_id", "==", "u_id", "]", "\n", "ratings", "=", "np", ".", "array", "(", "u_info", ".", "rating", ")", "\n", "u_feature", "=", "user_dict", "[", "u_id", "]", "\n", "\n", "u_i_ids", "=", "u_info", ".", "item_id", "\n", "\n", "i_feature_file", "=", "[", "]", "\n", "state_codes", "=", "[", "]", "\n", "\n", "for", "i_id", "in", "u_i_ids", ":", "\n", "                ", "if", "i_id", "in", "item_dict", ".", "keys", "(", ")", ":", "\n", "                    ", "i_feature", "=", "item_dict", "[", "i_id", "]", "\n", "state_code", "=", "state_check", "(", "u_id", ",", "i_id", ",", "user_state_ids", ",", "item_state_ids", ")", "\n", "i_feature_file", ".", "append", "(", "i_feature", ")", "\n", "state_codes", ".", "append", "(", "state_code", ")", "\n", "\n", "", "", "pickle", ".", "dump", "(", "u_feature", ",", "open", "(", "'{}/{}/raw/'", ".", "format", "(", "storing_path", ",", "dataset", ")", "+", "'sample_'", "+", "str", "(", "file_index", ")", "+", "'_x1.p'", ",", "'wb'", ")", ")", "\n", "pickle", ".", "dump", "(", "i_feature_file", ",", "open", "(", "'{}/{}/raw/'", ".", "format", "(", "storing_path", ",", "dataset", ")", "+", "'sample_'", "+", "str", "(", "file_index", ")", "+", "'_x2.p'", ",", "'wb'", ")", ")", "\n", "pickle", ".", "dump", "(", "ratings", ",", "open", "(", "'{}/{}/raw/'", ".", "format", "(", "storing_path", ",", "dataset", ")", "+", "'sample_'", "+", "str", "(", "file_index", ")", "+", "'_y.p'", ",", "'wb'", ")", ")", "\n", "pickle", ".", "dump", "(", "state_codes", ",", "open", "(", "'{}/{}/raw/'", ".", "format", "(", "storing_path", ",", "dataset", ")", "+", "'sample_'", "+", "str", "(", "file_index", ")", "+", "'_y0.p'", ",", "'wb'", ")", ")", "\n", "\n", "file_index", "+=", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.UserDataLoader.__init__": [[84, 90], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "x1", ",", "x2", ",", "y", ",", "y0", ",", "transform", "=", "None", ")", ":", "\n", "        ", "self", ".", "x1", "=", "x1", "\n", "self", ".", "x2", "=", "x2", "\n", "self", ".", "y", "=", "y", "\n", "self", ".", "y0", "=", "y0", "\n", "self", ".", "transform", "=", "transform", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.UserDataLoader.__len__": [[91, 93], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.UserDataLoader.__getitem__": [[94, 104], ["torch.is_tensor", "idx.tolist.tolist.tolist"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "idx", ")", ":", "\n", "        ", "if", "torch", ".", "is_tensor", "(", "idx", ")", ":", "\n", "            ", "idx", "=", "idx", ".", "tolist", "(", ")", "\n", "\n", "", "user_info", "=", "self", ".", "x1", "[", "idx", "]", "\n", "item_info", "=", "self", ".", "x2", "[", "idx", "]", "\n", "ratings", "=", "self", ".", "y", "[", "idx", "]", "\n", "cold_labels", "=", "self", ".", "y0", "[", "idx", "]", "\n", "\n", "return", "user_info", ",", "item_info", ",", "ratings", ",", "cold_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.to_torch": [[36, 38], ["torch.from_numpy", "numpy.array"], "function", ["None"], ["def", "to_torch", "(", "in_list", ")", ":", "\n", "    ", "return", "torch", ".", "from_numpy", "(", "np", ".", "array", "(", "in_list", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.train_test_user_list": [[41, 58], ["int", "int", "list", "range", "random.shuffle", "random.seed", "random.shuffle", "pickle.dump", "pickle.dump", "len", "open", "open", "os.listdir"], "function", ["None"], ["", "def", "train_test_user_list", "(", "dataset", "=", "'movielens'", ",", "rand", "=", "True", ",", "random_state", "=", "32", ",", "train_test_split_ratio", "=", "0.8", ",", "store", "=", "False", ")", ":", "\n", "    ", "path", "=", "'data_processed/'", "+", "dataset", "+", "'/raw/'", "\n", "path_store", "=", "'data_processed/'", "+", "dataset", "+", "'/'", "\n", "len_user", "=", "int", "(", "len", "(", "os", ".", "listdir", "(", "path", ")", ")", "/", "4", ")", "# movielens 6040, bookcrossing 4323", "\n", "training_size", "=", "int", "(", "len_user", "*", "train_test_split_ratio", ")", "# movielens: , bookcrossing:", "\n", "user_id_list", "=", "list", "(", "range", "(", "1", ",", "len_user", ")", ")", "\n", "if", "rand", ":", "\n", "        ", "random", ".", "shuffle", "(", "user_id_list", ")", "\n", "", "else", ":", "\n", "        ", "random", ".", "seed", "(", "random_state", ")", "\n", "random", ".", "shuffle", "(", "user_id_list", ")", "\n", "\n", "", "train_user_set", ",", "test_user_set", "=", "user_id_list", "[", ":", "training_size", "]", ",", "user_id_list", "[", "training_size", ":", "]", "\n", "if", "store", ":", "\n", "        ", "pickle", ".", "dump", "(", "train_user_set", ",", "open", "(", "path_store", "+", "'train_user_set.p'", ",", "'wb'", ")", ")", "\n", "pickle", ".", "dump", "(", "test_user_set", ",", "open", "(", "path_store", "+", "'test_user_set.p'", ",", "'wb'", ")", ")", "\n", "", "return", "train_user_set", ",", "test_user_set", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.load_user_info": [[60, 80], ["torch.device", "pickle.load", "pickle.load", "pickle.load", "pickle.load", "numpy.tile", "open", "open", "open", "open", "to_torch().to", "to_torch().to", "to_torch().to", "to_torch().to", "to_torch().to", "to_torch().to", "to_torch().to", "to_torch().to", "str", "str", "str", "str", "utils.to_torch", "utils.to_torch", "utils.to_torch", "utils.to_torch", "utils.to_torch", "utils.to_torch", "utils.to_torch", "utils.to_torch"], "function", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.to_torch", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.to_torch", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.to_torch", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.to_torch", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.to_torch", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.to_torch", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.to_torch", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.to_torch"], ["", "def", "load_user_info", "(", "user_id", ",", "dataset", "=", "'movielens'", ",", "support_size", "=", "16", ",", "query_size", "=", "4", ",", "device", "=", "torch", ".", "device", "(", "'cpu'", ")", ")", ":", "\n", "    ", "path", "=", "'data_processed/'", "+", "dataset", "+", "'/raw/'", "\n", "u_x1", "=", "pickle", ".", "load", "(", "open", "(", "'{}sample_{}_x1.p'", ".", "format", "(", "path", ",", "str", "(", "user_id", ")", ")", ",", "'rb'", ")", ")", "\n", "u_x2", "=", "pickle", ".", "load", "(", "open", "(", "'{}sample_{}_x2.p'", ".", "format", "(", "path", ",", "str", "(", "user_id", ")", ")", ",", "'rb'", ")", ")", "\n", "u_y", "=", "pickle", ".", "load", "(", "open", "(", "'{}sample_{}_y.p'", ".", "format", "(", "path", ",", "str", "(", "user_id", ")", ")", ",", "'rb'", ")", ")", "\n", "u_y0", "=", "pickle", ".", "load", "(", "open", "(", "'{}sample_{}_y0.p'", ".", "format", "(", "path", ",", "str", "(", "user_id", ")", ")", ",", "'rb'", ")", ")", "\n", "\n", "u_x1", "=", "np", ".", "tile", "(", "u_x1", ",", "(", "config", "[", "'sample_size'", "]", ",", "1", ")", ")", "\n", "u_y", "=", "u_y", "-", "1", "\n", "\n", "sup_x1", ",", "que_x1", "=", "to_torch", "(", "u_x1", "[", ":", "support_size", "]", ")", ".", "to", "(", "device", ")", ",", "to_torch", "(", "u_x1", "[", "support_size", ":", "support_size", "+", "query_size", "]", ")", ".", "to", "(", "device", ")", "\n", "sup_x2", ",", "que_x2", "=", "to_torch", "(", "u_x2", "[", ":", "support_size", "]", ")", ".", "to", "(", "device", ")", ",", "to_torch", "(", "u_x2", "[", "support_size", ":", "support_size", "+", "query_size", "]", ")", ".", "to", "(", "device", ")", "\n", "sup_y", ",", "que_y", "=", "to_torch", "(", "u_y", "[", ":", "support_size", "]", ")", ".", "to", "(", "device", ")", ",", "to_torch", "(", "u_y", "[", "support_size", ":", "support_size", "+", "query_size", "]", ")", ".", "to", "(", "device", ")", "\n", "sup_y0", ",", "que_y0", "=", "to_torch", "(", "u_y0", "[", ":", "support_size", "]", ")", ".", "to", "(", "device", ")", ",", "to_torch", "(", "u_y0", "[", "support_size", ":", "support_size", "+", "query_size", "]", ")", ".", "to", "(", "device", ")", "\n", "\n", "return", "sup_x1", ",", "sup_x2", ",", "sup_y", ",", "sup_y0", ",", "que_x1", ",", "que_x2", ",", "que_y", ",", "que_y0", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.get_params": [[107, 117], ["copy.deepcopy", "params.append"], "function", ["None"], ["", "", "def", "get_params", "(", "param_list", ")", ":", "\n", "    ", "params", "=", "[", "]", "\n", "count", "=", "0", "\n", "for", "param", "in", "param_list", ":", "\n", "        ", "if", "count", "%", "2", "==", "0", ":", "\n", "            ", "value", "=", "deepcopy", "(", "param", ".", "data", ")", "\n", "params", ".", "append", "(", "value", ")", "\n", "del", "value", "\n", "", "count", "+=", "1", "\n", "", "return", "params", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.get_zeros_like_params": [[119, 128], ["copy.deepcopy", "zeros_like_params.append", "torch.zeros_like"], "function", ["None"], ["", "def", "get_zeros_like_params", "(", "param_list", ")", ":", "\n", "    ", "zeros_like_params", "=", "[", "]", "\n", "count", "=", "0", "\n", "for", "param", "in", "param_list", ":", "\n", "        ", "if", "count", "%", "2", "==", "0", ":", "\n", "            ", "value", "=", "deepcopy", "(", "torch", ".", "zeros_like", "(", "param", ".", "data", ")", ")", "\n", "zeros_like_params", ".", "append", "(", "value", ")", "\n", "", "count", "+=", "1", "\n", "", "return", "zeros_like_params", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.init_params": [[130, 138], ["param.data.copy_"], "function", ["None"], ["", "def", "init_params", "(", "param_list", ",", "init_values", ")", ":", "\n", "    ", "count", "=", "0", "\n", "init_count", "=", "0", "\n", "for", "param", "in", "param_list", ":", "\n", "        ", "if", "count", "%", "2", "==", "0", ":", "\n", "            ", "param", ".", "data", ".", "copy_", "(", "init_values", "[", "init_count", "]", ")", "\n", "init_count", "+=", "1", "\n", "", "count", "+=", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.init_u_mem_params": [[140, 148], ["param.data.copy_"], "function", ["None"], ["", "", "def", "init_u_mem_params", "(", "param_list", ",", "init_values", ",", "bias_term", ",", "tao", ")", ":", "\n", "    ", "count", "=", "0", "\n", "init_count", "=", "0", "\n", "for", "param", "in", "param_list", ":", "\n", "        ", "if", "count", "%", "2", "==", "0", ":", "\n", "            ", "param", ".", "data", ".", "copy_", "(", "init_values", "[", "init_count", "]", "-", "tao", "*", "bias_term", "[", "init_count", "]", ")", "\n", "init_count", "+=", "1", "\n", "", "count", "+=", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.init_ui_mem_params": [[150, 156], ["param.data.copy_"], "function", ["None"], ["", "", "def", "init_ui_mem_params", "(", "param_list", ",", "init_values", ")", ":", "\n", "    ", "count", "=", "0", "\n", "for", "param", "in", "param_list", ":", "\n", "        ", "if", "count", "%", "2", "==", "0", ":", "\n", "            ", "param", ".", "data", ".", "copy_", "(", "init_values", ")", "\n", "", "count", "+=", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.get_grad": [[158, 168], ["copy.deepcopy", "param_grads.append"], "function", ["None"], ["", "", "def", "get_grad", "(", "param_list", ")", ":", "\n", "    ", "count", "=", "0", "\n", "param_grads", "=", "[", "]", "\n", "for", "param", "in", "param_list", ":", "\n", "        ", "if", "count", "%", "2", "==", "0", ":", "\n", "            ", "value", "=", "deepcopy", "(", "param", ".", "grad", ")", "\n", "param_grads", ".", "append", "(", "value", ")", "\n", "del", "value", "\n", "", "count", "+=", "1", "\n", "", "return", "param_grads", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.grads_sum": [[170, 172], ["range", "len"], "function", ["None"], ["", "def", "grads_sum", "(", "raw_grads_list", ",", "new_grads_list", ")", ":", "\n", "    ", "return", "[", "raw_grads_list", "[", "i", "]", "+", "new_grads_list", "[", "i", "]", "for", "i", "in", "range", "(", "len", "(", "raw_grads_list", ")", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.update_parameters": [[174, 176], ["range", "len"], "function", ["None"], ["", "def", "update_parameters", "(", "params", ",", "grads", ",", "lr", ")", ":", "\n", "    ", "return", "[", "params", "[", "i", "]", "-", "lr", "*", "grads", "[", "i", "]", "for", "i", "in", "range", "(", "len", "(", "params", ")", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.activation_func": [[179, 193], ["name.lower.lower", "torch.nn.Sigmoid", "torch.nn.Tanh", "torch.nn.ReLU", "torch.nn.Softmax", "torch.nn.LeakyReLU", "torch.nn.Sequential"], "function", ["None"], ["", "def", "activation_func", "(", "name", ")", ":", "\n", "    ", "name", "=", "name", ".", "lower", "(", ")", "\n", "if", "name", "==", "\"sigmoid\"", ":", "\n", "        ", "return", "torch", ".", "nn", ".", "Sigmoid", "(", ")", "\n", "", "elif", "name", "==", "\"tanh\"", ":", "\n", "        ", "return", "torch", ".", "nn", ".", "Tanh", "(", ")", "\n", "", "elif", "name", "==", "\"relu\"", ":", "\n", "        ", "return", "torch", ".", "nn", ".", "ReLU", "(", ")", "\n", "", "elif", "name", "==", "'softmax'", ":", "\n", "        ", "return", "torch", ".", "nn", ".", "Softmax", "(", ")", "\n", "", "elif", "name", "==", "'leaky_relu'", ":", "\n", "        ", "return", "torch", ".", "nn", ".", "LeakyReLU", "(", "0.1", ")", "\n", "", "else", ":", "\n", "        ", "return", "torch", ".", "nn", ".", "Sequential", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.mae": [[196, 205], ["len", "torch.argmax", "torch.abs", "torch.mean", "torch.abs.float"], "function", ["None"], ["", "", "def", "mae", "(", "ground_truth", ",", "test_result", ")", ":", "\n", "    ", "if", "len", "(", "ground_truth", ")", ">", "0", ":", "\n", "        ", "pred_y", "=", "torch", ".", "argmax", "(", "test_result", ",", "dim", "=", "1", ")", "\n", "sub", "=", "ground_truth", "-", "pred_y", "\n", "abs_sub", "=", "torch", ".", "abs", "(", "sub", ")", "\n", "out", "=", "torch", ".", "mean", "(", "abs_sub", ".", "float", "(", ")", ",", "dim", "=", "0", ")", "\n", "", "else", ":", "\n", "        ", "out", "=", "1", "\n", "", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.ndcg": [[207, 230], ["torch.argmax", "ground_truth.clone().detach().sort", "torch.argmax.clone().detach().sort", "pred_sort_y.sort", "ground_truth.clone().detach", "torch.argmax.clone().detach", "math.log2", "math.log2", "ground_truth.clone", "torch.argmax.clone", "float", "float"], "function", ["None"], ["", "def", "ndcg", "(", "ground_truth", ",", "test_result", ",", "top_k", "=", "3", ")", ":", "\n", "    ", "pred_y", "=", "torch", ".", "argmax", "(", "test_result", ",", "dim", "=", "1", ")", "\n", "sort_real_y", ",", "sort_real_y_index", "=", "ground_truth", ".", "clone", "(", ")", ".", "detach", "(", ")", ".", "sort", "(", "descending", "=", "True", ")", "\n", "sort_pred_y", ",", "sort_pred_y_index", "=", "pred_y", ".", "clone", "(", ")", ".", "detach", "(", ")", ".", "sort", "(", "descending", "=", "True", ")", "\n", "pred_sort_y", "=", "ground_truth", "[", "sort_pred_y_index", "]", "[", ":", "top_k", "]", "\n", "top_pred_y", ",", "_", "=", "pred_sort_y", ".", "sort", "(", "descending", "=", "True", ")", "\n", "\n", "ideal_dcg", "=", "0", "\n", "n", "=", "1", "\n", "for", "value", "in", "sort_real_y", "[", ":", "top_k", "]", ":", "\n", "        ", "i_dcg", "=", "(", "2", "**", "float", "(", "value", "+", "1", ")", "-", "1", ")", "/", "log2", "(", "n", "+", "1", ")", "\n", "ideal_dcg", "+=", "i_dcg", "\n", "n", "+=", "1", "\n", "\n", "", "pred_dcg", "=", "0", "\n", "n", "=", "1", "\n", "for", "value", "in", "top_pred_y", ":", "\n", "        ", "p_dcg", "=", "(", "2", "**", "float", "(", "value", "+", "1", ")", "-", "1", ")", "/", "log2", "(", "n", "+", "1", ")", "\n", "pred_dcg", "+=", "p_dcg", "\n", "n", "+=", "1", "\n", "\n", "", "n_dcg", "=", "pred_dcg", "/", "ideal_dcg", "\n", "return", "n_dcg", "\n", "", ""]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.prepare_data.prepareList.load_list": [[9, 15], ["open", "f.readlines", "list_.append", "line.strip"], "function", ["None"], ["def", "load_list", "(", "f_name", ")", ":", "\n", "    ", "list_", "=", "[", "]", "\n", "with", "open", "(", "f_name", ",", "encoding", "=", "\"utf-8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ".", "readlines", "(", ")", ":", "\n", "            ", "list_", ".", "append", "(", "line", ".", "strip", "(", ")", ")", "\n", "", "", "return", "list_", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.prepare_data.prepareList.pickle_load": [[16, 20], ["pickle.load", "open"], "function", ["None"], ["", "def", "pickle_load", "(", "file_name", ")", ":", "\n", "    ", "path", "=", "'data_raw/book_crossing/'", "\n", "target_file", "=", "pickle", ".", "load", "(", "open", "(", "path", "+", "file_name", ",", "'rb'", ")", ")", "\n", "return", "target_file", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.prepare_data.prepareList.user_converting_ml": [[33, 39], ["gender_list.index", "age_list.index", "occupation_list.index"], "function", ["None"], ["def", "user_converting_ml", "(", "user_row", ",", "age_list", ",", "gender_list", ",", "occupation_list", ")", ":", "\n", "# gender_dim: 2, age_dim: 7, occupation: 21", "\n", "    ", "gender_idx", "=", "gender_list", ".", "index", "(", "user_row", ".", "iat", "[", "0", ",", "1", "]", ")", "\n", "age_idx", "=", "age_list", ".", "index", "(", "user_row", ".", "iat", "[", "0", ",", "2", "]", ")", "\n", "occupation_idx", "=", "occupation_list", ".", "index", "(", "user_row", ".", "iat", "[", "0", ",", "3", "]", ")", "\n", "return", "[", "gender_idx", ",", "age_idx", ",", "occupation_idx", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.prepare_data.prepareList.item_converting_ml": [[41, 57], ["rate_list.index", "str().split", "str().split", "year_list.index", "list", "list.extend", "list.extend", "genre_list.index", "director_list.index", "str", "str", "re.sub"], "function", ["None"], ["", "def", "item_converting_ml", "(", "item_row", ",", "rate_list", ",", "genre_list", ",", "director_list", ",", "year_list", ")", ":", "\n", "# rate_dim: 6, year_dim: 1,  genre_dim:25, director_dim: 2186,", "\n", "    ", "rate_idx", "=", "rate_list", ".", "index", "(", "item_row", ".", "iat", "[", "0", ",", "3", "]", ")", "\n", "genre_idx", "=", "[", "0", "]", "*", "25", "\n", "for", "genre", "in", "str", "(", "item_row", ".", "iat", "[", "0", ",", "4", "]", ")", ".", "split", "(", "\", \"", ")", ":", "\n", "        ", "idx", "=", "genre_list", ".", "index", "(", "genre", ")", "\n", "genre_idx", "[", "idx", "]", "=", "1", "\n", "", "director_idx", "=", "[", "0", "]", "*", "2186", "\n", "for", "director", "in", "str", "(", "item_row", ".", "iat", "[", "0", ",", "5", "]", ")", ".", "split", "(", "\", \"", ")", ":", "\n", "        ", "idx", "=", "director_list", ".", "index", "(", "re", ".", "sub", "(", "r'\\([^()]*\\)'", ",", "''", ",", "director", ")", ")", "\n", "director_idx", "[", "idx", "]", "=", "1", "\n", "", "year_idx", "=", "year_list", ".", "index", "(", "item_row", ".", "iat", "[", "0", ",", "2", "]", ")", "\n", "out_list", "=", "list", "(", "[", "rate_idx", ",", "year_idx", "]", ")", "\n", "out_list", ".", "extend", "(", "genre_idx", ")", "\n", "out_list", ".", "extend", "(", "director_idx", ")", "\n", "return", "out_list", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.prepare_data.prepareList.user_converting_bk": [[59, 63], ["age_list.index", "location_list.index"], "function", ["None"], ["", "def", "user_converting_bk", "(", "user_row", ",", "age_list", ",", "location_list", ")", ":", "\n", "    ", "age_idx", "=", "age_list", ".", "index", "(", "user_row", ".", "iat", "[", "0", ",", "2", "]", ")", "\n", "location_idx", "=", "location_list", ".", "index", "(", "user_row", ".", "iat", "[", "0", ",", "1", "]", ")", "\n", "return", "[", "age_idx", ",", "location_idx", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.prepare_data.prepareList.item_converting_bk": [[65, 70], ["author_list.index", "year_list.index", "publisher_list.index"], "function", ["None"], ["", "def", "item_converting_bk", "(", "item_row", ",", "author_list", ",", "year_list", ",", "publisher_list", ")", ":", "\n", "    ", "author_idx", "=", "author_list", ".", "index", "(", "item_row", ".", "iat", "[", "0", ",", "2", "]", ")", "\n", "year_idx", "=", "year_list", ".", "index", "(", "item_row", ".", "iat", "[", "0", ",", "3", "]", ")", "\n", "publisher_idx", "=", "publisher_list", ".", "index", "(", "item_row", ".", "iat", "[", "0", ",", "4", "]", ")", "\n", "return", "[", "author_idx", ",", "year_idx", ",", "publisher_idx", "]", "\n", "", ""]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.prepare_data.prepareMovielens.load_movielens": [[37, 59], ["pandas.read_csv", "user_info.drop.drop", "pandas.read_csv", "item_info.drop.drop", "pandas.read_csv", "ratings[].map", "ratings.drop.drop", "datetime.datetime.fromtimestamp"], "function", ["None"], ["def", "load_movielens", "(", ")", ":", "\n", "    ", "path", "=", "'data_raw/ml-1m/'", "\n", "user_info_path", "=", "\"{}/users.dat\"", ".", "format", "(", "path", ")", "\n", "item_info_path", "=", "\"{}/movies_extrainfos.dat\"", ".", "format", "(", "path", ")", "\n", "rating_path", "=", "'{}/ratings.dat'", ".", "format", "(", "path", ")", "\n", "\n", "user_info", "=", "pd", ".", "read_csv", "(", "user_info_path", ",", "\n", "names", "=", "[", "'user_id'", ",", "'gender'", ",", "'age'", ",", "'occupation_code'", ",", "'zip'", "]", ",", "\n", "sep", "=", "\"::\"", ",", "engine", "=", "'python'", ")", "\n", "user_info", "=", "user_info", ".", "drop", "(", "columns", "=", "[", "'zip'", "]", ")", "\n", "item_info", "=", "pd", ".", "read_csv", "(", "item_info_path", ",", "\n", "names", "=", "[", "'item_id'", ",", "'title'", ",", "'year'", ",", "'rate'", ",", "'released'", ",", "'genre'", ",", "'director'", ",", "'writer'", ",", "'actors'", ",", "'plot'", ",", "'poster'", "]", ",", "\n", "sep", "=", "\"::\"", ",", "engine", "=", "'python'", ",", "encoding", "=", "\"utf-8\"", ")", "\n", "item_info", "=", "item_info", ".", "drop", "(", "columns", "=", "[", "'released'", ",", "'writer'", ",", "'actors'", ",", "'plot'", ",", "'poster'", "]", ")", "\n", "ratings", "=", "pd", ".", "read_csv", "(", "rating_path", ",", "\n", "names", "=", "[", "'user_id'", ",", "'item_id'", ",", "'rating'", ",", "'timestamp'", "]", ",", "\n", "sep", "=", "\"::\"", ",", "engine", "=", "'python'", ")", "\n", "\n", "ratings", "[", "'time'", "]", "=", "ratings", "[", "\"timestamp\"", "]", ".", "map", "(", "lambda", "x", ":", "datetime", ".", "datetime", ".", "fromtimestamp", "(", "x", ")", ")", "\n", "ratings", "=", "ratings", ".", "drop", "(", "[", "\"timestamp\"", "]", ",", "axis", "=", "1", ")", "\n", "\n", "return", "user_info", ",", "item_info", ",", "ratings", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.prepare_data.prepareMovielens.id_storing_movielens": [[61, 131], ["os.path.exists", "prepareMovielens.load_movielens", "ratings_dat.sort_values().reset_index", "print", "ratings_dat.sort_values().reset_index", "pandas.DataFrame", "ratings_dat.user_id.unique", "ratings_dat.user_id.nunique", "tqdm.tqdm", "print", "print", "new_df.append.user_id.unique", "new_df.append.sort_values().reset_index", "new_df.sort_values().reset_index.item_id.unique", "new_df.sort_values().reset_index.item_id.nunique", "tqdm.tqdm", "print", "print", "pickle.dump", "pickle.dump", "pickle.dump", "print", "ratings_dat.sort_values().reset_index.loc[].reset_index", "len", "user_counts.append", "new_df.sort_values().reset_index.loc[].reset_index", "len", "item_counts.append", "open", "open", "open", "ratings_dat.sort_values", "ratings_dat.sort_values", "new_df.append.append", "new_df.append.sort_values", "item_warm_list.append", "item_cold_list.append", "round", "user_warm_list.append", "user_cold_list.append", "len", "len", "min", "max", "len", "len", "min", "max", "len", "len", "len", "len"], "function", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.prepare_data.prepareMovielens.load_movielens"], ["", "def", "id_storing_movielens", "(", "max_count", "=", "20", ")", ":", "\n", "    ", "storing_path", "=", "'data_processed'", "\n", "dataset", "=", "'movielens'", "\n", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "'{}/{}/user_state_ids.p'", ".", "format", "(", "storing_path", ",", "dataset", ")", ")", ":", "\n", "        ", "_", ",", "_", ",", "ratings_dat", "=", "load_movielens", "(", ")", "\n", "\n", "sorted_time", "=", "ratings_dat", ".", "sort_values", "(", "by", "=", "'time'", ",", "ascending", "=", "True", ")", ".", "reset_index", "(", "drop", "=", "True", ")", "\n", "start_time", ",", "split_time", ",", "end_time", "=", "sorted_time", "[", "'time'", "]", "[", "0", "]", ",", "sorted_time", "[", "'time'", "]", "[", "\n", "round", "(", "0.8", "*", "len", "(", "ratings_dat", ")", ")", "]", ",", "sorted_time", "[", "'time'", "]", "[", "len", "(", "ratings_dat", ")", "-", "1", "]", "\n", "\n", "print", "(", "'start time %s, split_time %s, end time %s'", "%", "(", "start_time", ",", "split_time", ",", "end_time", ")", ")", "\n", "\n", "sorted_users", "=", "ratings_dat", ".", "sort_values", "(", "by", "=", "[", "'user_id'", ",", "'time'", "]", ",", "ascending", "=", "[", "True", ",", "True", "]", ")", ".", "reset_index", "(", "drop", "=", "True", ")", "\n", "\n", "# user_statistics", "\n", "user_warm_list", ",", "user_cold_list", ",", "user_counts", "=", "[", "]", ",", "[", "]", ",", "[", "]", "\n", "new_df", "=", "pd", ".", "DataFrame", "(", ")", "\n", "\n", "user_ids", "=", "ratings_dat", ".", "user_id", ".", "unique", "(", ")", "\n", "n_user_ids", "=", "ratings_dat", ".", "user_id", ".", "nunique", "(", ")", "\n", "\n", "for", "u_id", "in", "tqdm", "(", "user_ids", ")", ":", "\n", "            ", "u_info", "=", "sorted_users", ".", "loc", "[", "sorted_users", ".", "user_id", "==", "u_id", "]", ".", "reset_index", "(", "drop", "=", "True", ")", "\n", "u_count", "=", "len", "(", "u_info", ")", "\n", "if", "u_count", ">", "max_count", "-", "1", ":", "\n", "                ", "new_u_info", "=", "u_info", ".", "iloc", "[", ":", "max_count", ",", ":", "]", "\n", "new_df", "=", "new_df", ".", "append", "(", "new_u_info", ",", "ignore_index", "=", "True", ")", "\n", "u_time", "=", "u_info", "[", "'time'", "]", "[", "0", "]", "\n", "if", "u_time", "<", "split_time", ":", "\n", "                    ", "user_warm_list", ".", "append", "(", "u_id", ")", "\n", "", "else", ":", "\n", "                    ", "user_cold_list", ".", "append", "(", "u_id", ")", "\n", "", "", "user_counts", ".", "append", "(", "u_count", ")", "\n", "", "print", "(", "'num warm users: %d, num cold users: %d'", "%", "(", "len", "(", "user_warm_list", ")", ",", "len", "(", "user_cold_list", ")", ")", ")", "\n", "print", "(", "'min count: %d, avg count: %d, max count: %d'", "%", "(", "min", "(", "user_counts", ")", ",", "len", "(", "ratings_dat", ")", "/", "n_user_ids", ",", "max", "(", "user_counts", ")", ")", ")", "\n", "\n", "new_all_ids", "=", "new_df", ".", "user_id", ".", "unique", "(", ")", "\n", "\n", "user_state_ids", "=", "{", "'user_all_ids'", ":", "new_all_ids", ",", "'user_warm_ids'", ":", "user_warm_list", ",", "\n", "'user_cold_ids'", ":", "user_cold_list", "}", "\n", "\n", "# item_statistics", "\n", "sorted_items", "=", "new_df", ".", "sort_values", "(", "by", "=", "[", "'item_id'", ",", "'time'", "]", ",", "ascending", "=", "[", "True", ",", "True", "]", ")", ".", "reset_index", "(", "drop", "=", "True", ")", "\n", "\n", "item_warm_list", ",", "item_cold_list", ",", "item_counts", "=", "[", "]", ",", "[", "]", ",", "[", "]", "\n", "\n", "item_ids", "=", "sorted_items", ".", "item_id", ".", "unique", "(", ")", "\n", "n_item_ids", "=", "sorted_items", ".", "item_id", ".", "nunique", "(", ")", "\n", "\n", "for", "i_id", "in", "tqdm", "(", "item_ids", ")", ":", "\n", "            ", "i_info", "=", "sorted_items", ".", "loc", "[", "sorted_items", ".", "item_id", "==", "i_id", "]", ".", "reset_index", "(", "drop", "=", "True", ")", "\n", "i_count", "=", "len", "(", "i_info", ")", "\n", "if", "i_count", ">", "10", ":", "\n", "                ", "item_warm_list", ".", "append", "(", "i_id", ")", "\n", "", "else", ":", "\n", "                ", "item_cold_list", ".", "append", "(", "i_id", ")", "\n", "", "item_counts", ".", "append", "(", "i_count", ")", "\n", "", "print", "(", "'num warm items: %d,   num cold items: %d'", "%", "(", "len", "(", "item_warm_list", ")", ",", "len", "(", "item_cold_list", ")", ")", ")", "\n", "print", "(", "'min count: %d,  avg count: %d,  max count: %d'", "%", "(", "\n", "min", "(", "item_counts", ")", ",", "len", "(", "ratings_dat", ")", "/", "n_item_ids", ",", "max", "(", "item_counts", ")", ")", ")", "\n", "\n", "item_state_ids", "=", "{", "'item_all_ids'", ":", "item_ids", ",", "'item_warm_ids'", ":", "item_warm_list", ",", "\n", "'item_cold_ids'", ":", "item_cold_list", "}", "\n", "\n", "pickle", ".", "dump", "(", "new_df", ",", "open", "(", "'{}/{}/ratings_sorted.p'", ".", "format", "(", "storing_path", ",", "dataset", ")", ",", "'wb'", ")", ")", "\n", "pickle", ".", "dump", "(", "item_state_ids", ",", "open", "(", "'{}/{}/item_state_ids.p'", ".", "format", "(", "storing_path", ",", "dataset", ")", ",", "'wb'", ")", ")", "\n", "pickle", ".", "dump", "(", "user_state_ids", ",", "open", "(", "'{}/{}/user_state_ids.p'", ".", "format", "(", "storing_path", ",", "dataset", ")", ",", "'wb'", ")", ")", "\n", "", "else", ":", "\n", "        ", "print", "(", "'id information is already stored.'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.prepare_data.prepareMovielens.dict_storing_movielens": [[133, 198], ["pickle.load", "pickle.load", "prepareMovielens.load_movielens", "tqdm.tqdm", "numpy.array", "tqdm.tqdm", "pickle.dump", "list", "tqdm.tqdm", "numpy.array", "tqdm.tqdm", "pickle.dump", "open", "open", "user_converting_ml", "np.array.append", "open", "item_info.year.unique", "open", "len", "item_converting_ml", "updated_i_id.append", "np.array.append"], "function", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.prepare_data.prepareMovielens.load_movielens", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.prepare_data.prepareList.user_converting_ml", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.prepare_data.prepareList.item_converting_ml"], ["", "", "def", "dict_storing_movielens", "(", ")", ":", "\n", "    ", "storing_path", "=", "'data_processed'", "\n", "dataset", "=", "'movielens'", "\n", "\n", "user_state_ids", "=", "pickle", ".", "load", "(", "open", "(", "'{}/{}/user_state_ids.p'", ".", "format", "(", "storing_path", ",", "dataset", ")", ",", "'rb'", ")", ")", "\n", "item_state_ids", "=", "pickle", ".", "load", "(", "open", "(", "'{}/{}/item_state_ids.p'", ".", "format", "(", "storing_path", ",", "dataset", ")", ",", "'rb'", ")", ")", "\n", "\n", "# store user and item dict", "\n", "user_info", ",", "item_info", ",", "_", "=", "load_movielens", "(", ")", "\n", "\n", "# user", "\n", "user_all_features", "=", "[", "]", "\n", "user_all_ids", "=", "user_state_ids", "[", "'user_all_ids'", "]", "\n", "\n", "user_dict", "=", "{", "}", "\n", "\n", "for", "u_id", "in", "tqdm", "(", "user_all_ids", ")", ":", "\n", "        ", "row", "=", "user_info", ".", "loc", "[", "user_info", "[", "'user_id'", "]", "==", "u_id", "]", "\n", "feature_vector", "=", "user_converting_ml", "(", "user_row", "=", "row", ",", "age_list", "=", "list_movieLens", "[", "'list_age'", "]", ",", "\n", "gender_list", "=", "list_movieLens", "[", "'list_gender'", "]", ",", "\n", "occupation_list", "=", "list_movieLens", "[", "'list_occupation'", "]", ")", "\n", "\n", "user_all_features", ".", "append", "(", "feature_vector", ")", "\n", "\n", "", "user_all_features", "=", "np", ".", "array", "(", "user_all_features", ")", "\n", "\n", "count", "=", "0", "\n", "\n", "for", "u_id", "in", "tqdm", "(", "user_all_ids", ")", ":", "\n", "        ", "u_info", "=", "user_all_features", "[", "count", "]", "\n", "user_dict", "[", "u_id", "]", "=", "u_info", "\n", "count", "+=", "1", "\n", "\n", "", "pickle", ".", "dump", "(", "user_dict", ",", "open", "(", "'{}/{}/user_dict.p'", ".", "format", "(", "storing_path", ",", "dataset", ")", ",", "'wb'", ")", ")", "\n", "\n", "# item", "\n", "item_all_features", "=", "[", "]", "\n", "\n", "item_all_ids", "=", "item_state_ids", "[", "'item_all_ids'", "]", "\n", "item_dict", "=", "{", "}", "\n", "\n", "updated_i_id", "=", "[", "]", "\n", "\n", "year_list", "=", "list", "(", "item_info", ".", "year", ".", "unique", "(", ")", ")", "\n", "\n", "for", "i_id", "in", "tqdm", "(", "item_all_ids", ")", ":", "\n", "        ", "row", "=", "item_info", ".", "loc", "[", "item_info", "[", "'item_id'", "]", "==", "i_id", "]", "\n", "if", "len", "(", "row", ")", ">", "0", ":", "\n", "            ", "feature_vector", "=", "item_converting_ml", "(", "item_row", "=", "row", ",", "rate_list", "=", "list_movieLens", "[", "'list_rate'", "]", ",", "\n", "genre_list", "=", "list_movieLens", "[", "'list_genre'", "]", ",", "\n", "director_list", "=", "list_movieLens", "[", "'list_director'", "]", ",", "\n", "year_list", "=", "year_list", ")", "\n", "updated_i_id", ".", "append", "(", "i_id", ")", "\n", "item_all_features", ".", "append", "(", "feature_vector", ")", "\n", "\n", "", "", "item_all_features", "=", "np", ".", "array", "(", "item_all_features", ")", "\n", "\n", "count", "=", "0", "\n", "\n", "for", "i_id", "in", "tqdm", "(", "updated_i_id", ")", ":", "\n", "        ", "i_info", "=", "item_all_features", "[", "count", "]", "\n", "item_dict", "[", "i_id", "]", "=", "i_info", "\n", "count", "+=", "1", "\n", "\n", "", "pickle", ".", "dump", "(", "item_dict", ",", "open", "(", "'{}/{}/item_dict.p'", ".", "format", "(", "storing_path", ",", "dataset", ")", ",", "'wb'", ")", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.FeatureMem.__init__": [[5, 18], ["torch.randn().normal_", "base_model.get_weights", "range", "torch.zeros().to", "memories.FeatureMem.u_memory.append", "torch.randn", "bias_list.append", "torch.zeros", "param.normal_"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.get_weights"], ["    ", "def", "__init__", "(", "self", ",", "n_k", ",", "u_emb_dim", ",", "base_model", ",", "device", ")", ":", "\n", "        ", "self", ".", "n_k", "=", "n_k", "\n", "self", ".", "base_model", "=", "base_model", "\n", "self", ".", "p_memory", "=", "torch", ".", "randn", "(", "n_k", ",", "u_emb_dim", ",", "device", "=", "device", ")", ".", "normal_", "(", ")", "# on device", "\n", "u_param", ",", "_", ",", "_", "=", "base_model", ".", "get_weights", "(", ")", "\n", "self", ".", "u_memory", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "n_k", ")", ":", "\n", "            ", "bias_list", "=", "[", "]", "\n", "for", "param", "in", "u_param", ":", "\n", "                ", "bias_list", ".", "append", "(", "param", ".", "normal_", "(", "std", "=", "0.05", ")", ")", "\n", "", "self", ".", "u_memory", ".", "append", "(", "bias_list", ")", "\n", "", "self", ".", "att_values", "=", "torch", ".", "zeros", "(", "n_k", ")", ".", "to", "(", "device", ")", "\n", "self", ".", "device", "=", "device", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.FeatureMem.read_head": [[19, 31], ["Attention().to", "Attention().to.to", "memories.get_mu", "Attention().to.to.reshape", "torch.mm", "memories.Attention", "Attention().to."], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.get_mu"], ["", "def", "read_head", "(", "self", ",", "p_u", ",", "alpha", ",", "train", "=", "True", ")", ":", "\n", "# get personalized mu", "\n", "        ", "att_model", "=", "Attention", "(", "self", ".", "n_k", ")", ".", "to", "(", "self", ".", "device", ")", "\n", "attention_values", "=", "att_model", "(", "p_u", ",", "self", ".", "p_memory", ")", ".", "to", "(", "self", ".", "device", ")", "# pu on device", "\n", "personalized_mu", "=", "get_mu", "(", "attention_values", ",", "self", ".", "u_memory", ",", "self", ".", "base_model", ",", "self", ".", "device", ")", "\n", "# update mp", "\n", "transposed_att", "=", "attention_values", ".", "reshape", "(", "self", ".", "n_k", ",", "1", ")", "\n", "product", "=", "torch", ".", "mm", "(", "transposed_att", ",", "p_u", ")", "\n", "if", "train", ":", "\n", "            ", "self", ".", "p_memory", "=", "alpha", "*", "product", "+", "(", "1", "-", "alpha", ")", "*", "self", ".", "p_memory", "\n", "", "self", ".", "att_values", "=", "attention_values", "\n", "return", "personalized_mu", ",", "attention_values", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.FeatureMem.write_head": [[32, 34], ["memories.update_mu"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.update_mu"], ["", "def", "write_head", "(", "self", ",", "u_grads", ",", "lr", ")", ":", "\n", "        ", "update_mu", "(", "self", ".", "att_values", ",", "self", ".", "u_memory", ",", "u_grads", ",", "lr", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.TaskMem.__init__": [[37, 41], ["torch.rand().normal_", "torch.zeros", "torch.rand"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "n_k", ",", "emb_dim", ",", "device", ")", ":", "\n", "        ", "self", ".", "n_k", "=", "n_k", "\n", "self", ".", "memory_UI", "=", "torch", ".", "rand", "(", "n_k", ",", "emb_dim", "*", "2", ",", "emb_dim", "*", "2", ",", "device", "=", "device", ")", ".", "normal_", "(", ")", "\n", "self", ".", "att_values", "=", "torch", ".", "zeros", "(", "n_k", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.TaskMem.read_head": [[42, 45], ["memories.get_mui"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.get_mui"], ["", "def", "read_head", "(", "self", ",", "att_values", ")", ":", "\n", "        ", "self", ".", "att_values", "=", "att_values", "\n", "return", "get_mui", "(", "att_values", ",", "self", ".", "memory_UI", ",", "self", ".", "n_k", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.TaskMem.write_head": [[46, 49], ["memories.update_mui"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.update_mui"], ["", "def", "write_head", "(", "self", ",", "u_mui", ",", "lr", ")", ":", "\n", "        ", "update_values", "=", "update_mui", "(", "self", ".", "att_values", ",", "self", ".", "n_k", ",", "u_mui", ")", "\n", "self", ".", "memory_UI", "=", "lr", "*", "update_values", "+", "(", "1", "-", "lr", ")", "*", "self", ".", "memory_UI", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.Attention.__init__": [[63, 68], ["super().__init__", "torch.nn.Linear", "torch.nn.Softmax", "activation_func"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.info_embedding.UserEmbedding.__init__", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.activation_func"], ["    ", "def", "__init__", "(", "self", ",", "n_k", ",", "activation", "=", "'relu'", ")", ":", "\n", "        ", "super", "(", "Attention", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "n_k", "=", "n_k", "\n", "self", ".", "fc_layer", "=", "torch", ".", "nn", ".", "Linear", "(", "self", ".", "n_k", ",", "self", ".", "n_k", ",", "activation_func", "(", "activation", ")", ")", "\n", "self", ".", "soft_max_layer", "=", "torch", ".", "nn", ".", "Softmax", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.Attention.forward": [[69, 75], ["pu.repeat().view", "memories.cosine_similarity", "memories.Attention.fc_layer", "memories.Attention.soft_max_layer", "len", "pu.repeat", "len"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.cosine_similarity"], ["", "def", "forward", "(", "self", ",", "pu", ",", "mp", ")", ":", "\n", "        ", "expanded_pu", "=", "pu", ".", "repeat", "(", "1", ",", "len", "(", "mp", ")", ")", ".", "view", "(", "len", "(", "mp", ")", ",", "-", "1", ")", "# shape, n_k, pu_dim", "\n", "inputs", "=", "cosine_similarity", "(", "expanded_pu", ",", "mp", ")", "\n", "fc_layers", "=", "self", ".", "fc_layer", "(", "inputs", ")", "\n", "attention_values", "=", "self", ".", "soft_max_layer", "(", "fc_layers", ")", "\n", "return", "attention_values", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.cosine_similarity": [[51, 60], ["torch.sqrt", "torch.sqrt", "torch.sum", "torch.mul", "torch.div", "torch.sum", "torch.sum", "torch.mul"], "function", ["None"], ["", "", "def", "cosine_similarity", "(", "input1", ",", "input2", ")", ":", "\n", "    ", "query_norm", "=", "torch", ".", "sqrt", "(", "torch", ".", "sum", "(", "input1", "**", "2", "+", "0.00001", ",", "1", ")", ")", "\n", "doc_norm", "=", "torch", ".", "sqrt", "(", "torch", ".", "sum", "(", "input2", "**", "2", "+", "0.00001", ",", "1", ")", ")", "\n", "\n", "prod", "=", "torch", ".", "sum", "(", "torch", ".", "mul", "(", "input1", ",", "input2", ")", ",", "1", ")", "\n", "norm_prod", "=", "torch", ".", "mul", "(", "query_norm", ",", "doc_norm", ")", "\n", "\n", "cos_sim_raw", "=", "torch", ".", "div", "(", "prod", ",", "norm_prod", ")", "\n", "return", "cos_sim_raw", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.get_mu": [[77, 84], ["model.get_zero_weights", "att_values.reshape", "range", "len", "len", "range", "len", "[].to"], "function", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.models.BASEModel.get_zero_weights"], ["", "", "def", "get_mu", "(", "att_values", ",", "mu", ",", "model", ",", "device", ")", ":", "\n", "    ", "mu0", ",", "_", ",", "_", "=", "model", ".", "get_zero_weights", "(", ")", "\n", "attention_values", "=", "att_values", ".", "reshape", "(", "len", "(", "mu", ")", ",", "1", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "mu", ")", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "mu", "[", "i", "]", ")", ")", ":", "\n", "            ", "mu0", "[", "j", "]", "+=", "attention_values", "[", "i", "]", "*", "mu", "[", "i", "]", "[", "j", "]", ".", "to", "(", "device", ")", "\n", "", "", "return", "mu0", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.update_mu": [[86, 91], ["att_values.reshape.reshape", "range", "len", "len", "range", "len"], "function", ["None"], ["", "def", "update_mu", "(", "att_values", ",", "mu", ",", "grads", ",", "lr", ")", ":", "\n", "    ", "att_values", "=", "att_values", ".", "reshape", "(", "len", "(", "mu", ")", ",", "1", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "mu", ")", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "mu", "[", "i", "]", ")", ")", ":", "\n", "            ", "mu", "[", "i", "]", "[", "j", "]", "=", "lr", "*", "att_values", "[", "i", "]", "*", "grads", "[", "j", "]", "+", "(", "1", "-", "lr", ")", "*", "mu", "[", "i", "]", "[", "j", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.get_mui": [[93, 98], ["att_values.reshape", "torch.mul", "torch.mul.sum"], "function", ["None"], ["", "", "", "def", "get_mui", "(", "att_values", ",", "mui", ",", "n_k", ")", ":", "\n", "    ", "attention_values", "=", "att_values", ".", "reshape", "(", "n_k", ",", "1", ",", "1", ")", "\n", "attend_mui", "=", "torch", ".", "mul", "(", "attention_values", ",", "mui", ")", "\n", "u_mui", "=", "attend_mui", ".", "sum", "(", "dim", "=", "0", ")", "\n", "return", "u_mui", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.memories.update_mui": [[100, 105], ["u_mui.unsqueeze().repeat", "att_values.reshape", "torch.mul", "u_mui.unsqueeze"], "function", ["None"], ["", "def", "update_mui", "(", "att_values", ",", "n_k", ",", "u_mui", ")", ":", "\n", "    ", "repeat_u_mui", "=", "u_mui", ".", "unsqueeze", "(", "0", ")", ".", "repeat", "(", "n_k", ",", "1", ",", "1", ")", "\n", "attention_tensor", "=", "att_values", ".", "reshape", "(", "n_k", ",", "1", ",", "1", ")", "\n", "attend_u_mui", "=", "torch", ".", "mul", "(", "attention_tensor", ",", "repeat_u_mui", ")", "\n", "return", "attend_u_mui", "\n", "", ""]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.input_loading.MLUserLoading.__init__": [[6, 16], ["super().__init__", "torch.nn.Embedding", "torch.nn.Embedding", "torch.nn.Embedding"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.info_embedding.UserEmbedding.__init__"], ["    ", "def", "__init__", "(", "self", ",", "embedding_dim", ")", ":", "\n", "        ", "super", "(", "MLUserLoading", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "num_gender", "=", "config", "[", "'n_gender'", "]", "\n", "self", ".", "num_age", "=", "config", "[", "'n_age'", "]", "\n", "self", ".", "num_occupation", "=", "config", "[", "'n_occupation'", "]", "\n", "self", ".", "embedding_dim", "=", "embedding_dim", "\n", "\n", "self", ".", "embedding_gender", "=", "torch", ".", "nn", ".", "Embedding", "(", "num_embeddings", "=", "self", ".", "num_gender", ",", "embedding_dim", "=", "self", ".", "embedding_dim", ")", "\n", "self", ".", "embedding_age", "=", "torch", ".", "nn", ".", "Embedding", "(", "num_embeddings", "=", "self", ".", "num_age", ",", "embedding_dim", "=", "self", ".", "embedding_dim", ")", "\n", "self", ".", "embedding_occupation", "=", "torch", ".", "nn", ".", "Embedding", "(", "num_embeddings", "=", "self", ".", "num_occupation", ",", "embedding_dim", "=", "self", ".", "embedding_dim", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.input_loading.MLUserLoading.forward": [[17, 24], ["input_loading.MLUserLoading.embedding_gender", "input_loading.MLUserLoading.embedding_age", "input_loading.MLUserLoading.embedding_occupation", "torch.cat"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x1", ")", ":", "\n", "        ", "gender_idx", ",", "age_idx", ",", "occupation_idx", "=", "x1", "[", ":", ",", "0", "]", ",", "x1", "[", ":", ",", "1", "]", ",", "x1", "[", ":", ",", "2", "]", "\n", "gender_emb", "=", "self", ".", "embedding_gender", "(", "gender_idx", ")", "\n", "age_emb", "=", "self", ".", "embedding_age", "(", "age_idx", ")", "\n", "occupation_emb", "=", "self", ".", "embedding_occupation", "(", "occupation_idx", ")", "\n", "concat_emb", "=", "torch", ".", "cat", "(", "(", "gender_emb", ",", "age_emb", ",", "occupation_emb", ")", ",", "1", ")", "\n", "return", "concat_emb", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.input_loading.MLItemLoading.__init__": [[27, 39], ["super().__init__", "torch.nn.Embedding", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Embedding"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.info_embedding.UserEmbedding.__init__"], ["    ", "def", "__init__", "(", "self", ",", "embedding_dim", ")", ":", "\n", "        ", "super", "(", "MLItemLoading", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "rate_dim", "=", "config", "[", "'n_rate'", "]", "\n", "self", ".", "genre_dim", "=", "config", "[", "'n_genre'", "]", "\n", "self", ".", "director_dim", "=", "config", "[", "'n_director'", "]", "\n", "self", ".", "year_dim", "=", "config", "[", "'n_year'", "]", "\n", "self", ".", "embedding_dim", "=", "embedding_dim", "\n", "\n", "self", ".", "emb_rate", "=", "torch", ".", "nn", ".", "Embedding", "(", "num_embeddings", "=", "self", ".", "rate_dim", ",", "embedding_dim", "=", "self", ".", "embedding_dim", ")", "\n", "self", ".", "emb_genre", "=", "torch", ".", "nn", ".", "Linear", "(", "in_features", "=", "self", ".", "genre_dim", ",", "out_features", "=", "self", ".", "embedding_dim", ",", "bias", "=", "False", ")", "\n", "self", ".", "emb_director", "=", "torch", ".", "nn", ".", "Linear", "(", "in_features", "=", "self", ".", "director_dim", ",", "out_features", "=", "self", ".", "embedding_dim", ",", "bias", "=", "False", ")", "\n", "self", ".", "emb_year", "=", "torch", ".", "nn", ".", "Embedding", "(", "num_embeddings", "=", "self", ".", "year_dim", ",", "embedding_dim", "=", "self", ".", "embedding_dim", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.input_loading.MLItemLoading.forward": [[40, 48], ["input_loading.MLItemLoading.emb_rate", "input_loading.MLItemLoading.emb_year", "torch.sigmoid", "torch.sigmoid", "torch.cat", "input_loading.MLItemLoading.emb_genre", "input_loading.MLItemLoading.emb_director", "genre_idx.float", "director_idx.float"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x2", ")", ":", "\n", "        ", "rate_idx", ",", "year_idx", ",", "genre_idx", ",", "director_idx", "=", "x2", "[", ":", ",", "0", "]", ",", "x2", "[", ":", ",", "1", "]", ",", "x2", "[", ":", ",", "2", ":", "27", "]", ",", "x2", "[", ":", ",", "27", ":", "]", "\n", "rate_emb", "=", "self", ".", "emb_rate", "(", "rate_idx", ")", "\n", "year_emb", "=", "self", ".", "emb_year", "(", "year_idx", ")", "\n", "genre_emb", "=", "F", ".", "sigmoid", "(", "self", ".", "emb_genre", "(", "genre_idx", ".", "float", "(", ")", ")", ")", "\n", "director_emb", "=", "F", ".", "sigmoid", "(", "self", ".", "emb_director", "(", "director_idx", ".", "float", "(", ")", ")", ")", "\n", "concat_emb", "=", "torch", ".", "cat", "(", "(", "rate_emb", ",", "year_emb", ",", "genre_emb", ",", "director_emb", ")", ",", "1", ")", "\n", "return", "concat_emb", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.input_loading.BKUserLoading.__init__": [[50, 58], ["super().__init__", "torch.nn.Embedding", "torch.nn.Embedding"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.info_embedding.UserEmbedding.__init__"], ["    ", "def", "__init__", "(", "self", ",", "embedding_dim", ")", ":", "\n", "        ", "super", "(", "BKUserLoading", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "age_dim", "=", "config", "[", "'n_age_bk'", "]", "\n", "self", ".", "location_dim", "=", "config", "[", "'n_location'", "]", "\n", "self", ".", "embedding_dim", "=", "embedding_dim", "\n", "\n", "self", ".", "emb_age", "=", "torch", ".", "nn", ".", "Embedding", "(", "num_embeddings", "=", "self", ".", "age_dim", ",", "embedding_dim", "=", "self", ".", "embedding_dim", ")", "\n", "self", ".", "emb_location", "=", "torch", ".", "nn", ".", "Embedding", "(", "num_embeddings", "=", "self", ".", "location_dim", ",", "embedding_dim", "=", "self", ".", "embedding_dim", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.input_loading.BKUserLoading.forward": [[59, 65], ["input_loading.BKUserLoading.emb_age", "input_loading.BKUserLoading.emb_location", "torch.cat"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x1", ")", ":", "\n", "        ", "age_idx", ",", "location_idx", "=", "x1", "[", ":", ",", "0", "]", ",", "x1", "[", ":", ",", "1", "]", "\n", "age_emb", "=", "self", ".", "emb_age", "(", "age_idx", ")", "\n", "location_emb", "=", "self", ".", "emb_location", "(", "location_idx", ")", "\n", "concat_emb", "=", "torch", ".", "cat", "(", "(", "age_emb", ",", "location_emb", ")", ",", "1", ")", "\n", "return", "concat_emb", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.input_loading.BKItemLoading.__init__": [[67, 77], ["super().__init__", "torch.nn.Embedding", "torch.nn.Embedding", "torch.nn.Embedding"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.info_embedding.UserEmbedding.__init__"], ["    ", "def", "__init__", "(", "self", ",", "embedding_dim", ")", ":", "\n", "        ", "super", "(", "BKItemLoading", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "year_dim", "=", "config", "[", "'n_year_bk'", "]", "\n", "self", ".", "author_dim", "=", "config", "[", "'n_author'", "]", "\n", "self", ".", "publisher_dim", "=", "config", "[", "'n_publisher'", "]", "\n", "self", ".", "embedding_dim", "=", "embedding_dim", "\n", "\n", "self", ".", "emb_year", "=", "torch", ".", "nn", ".", "Embedding", "(", "num_embeddings", "=", "self", ".", "year_dim", ",", "embedding_dim", "=", "self", ".", "embedding_dim", ")", "\n", "self", ".", "emb_author", "=", "torch", ".", "nn", ".", "Embedding", "(", "num_embeddings", "=", "self", ".", "author_dim", ",", "embedding_dim", "=", "self", ".", "embedding_dim", ")", "\n", "self", ".", "emb_publisher", "=", "torch", ".", "nn", ".", "Embedding", "(", "num_embeddings", "=", "self", ".", "publisher_dim", ",", "embedding_dim", "=", "self", ".", "embedding_dim", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.input_loading.BKItemLoading.forward": [[78, 85], ["input_loading.BKItemLoading.emb_year", "input_loading.BKItemLoading.emb_author", "input_loading.BKItemLoading.emb_publisher", "torch.cat"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x2", ")", ":", "\n", "        ", "author_idx", ",", "year_idx", ",", "publisher_idx", "=", "x2", "[", ":", ",", "0", "]", ",", "x2", "[", ":", ",", "1", "]", ",", "x2", "[", ":", ",", "2", "]", "\n", "year_emb", "=", "self", ".", "emb_year", "(", "year_idx", ")", "\n", "author_emb", "=", "self", ".", "emb_author", "(", "author_idx", ")", "\n", "publisher_emb", "=", "self", ".", "emb_publisher", "(", "publisher_idx", ")", "\n", "concat_emb", "=", "torch", ".", "cat", "(", "(", "year_emb", ",", "author_emb", ",", "publisher_emb", ")", ",", "1", ")", "\n", "return", "concat_emb", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.rec_model.RecMAM.__init__": [[5, 28], ["super().__init__", "torch.nn.Linear", "range", "torch.nn.Sequential", "torch.nn.Sequential", "int", "torch.nn.Linear", "fcs.append", "fcs.append", "activation_func", "torch.nn.Linear", "activation_func", "torch.nn.Linear"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.info_embedding.UserEmbedding.__init__", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.activation_func", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.activation_func"], ["    ", "def", "__init__", "(", "self", ",", "embedding_dim", ",", "n_y", ",", "n_layer", ",", "activation", "=", "'sigmoid'", ",", "classification", "=", "True", ")", ":", "\n", "        ", "super", "(", "RecMAM", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "input_size", "=", "embedding_dim", "*", "2", "\n", "\n", "self", ".", "mem_layer", "=", "torch", ".", "nn", ".", "Linear", "(", "self", ".", "input_size", ",", "self", ".", "input_size", ")", "\n", "\n", "fcs", "=", "[", "]", "\n", "last_size", "=", "self", ".", "input_size", "\n", "\n", "for", "i", "in", "range", "(", "n_layer", "-", "1", ")", ":", "\n", "            ", "out_dim", "=", "int", "(", "last_size", "/", "2", ")", "\n", "linear_model", "=", "torch", ".", "nn", ".", "Linear", "(", "last_size", ",", "out_dim", ")", "\n", "fcs", ".", "append", "(", "linear_model", ")", "\n", "last_size", "=", "out_dim", "\n", "fcs", ".", "append", "(", "activation_func", "(", "activation", ")", ")", "\n", "\n", "", "self", ".", "fc", "=", "torch", ".", "nn", ".", "Sequential", "(", "*", "fcs", ")", "\n", "\n", "if", "classification", ":", "\n", "            ", "finals", "=", "[", "torch", ".", "nn", ".", "Linear", "(", "last_size", ",", "n_y", ")", ",", "activation_func", "(", "'softmax'", ")", "]", "\n", "", "else", ":", "\n", "            ", "finals", "=", "[", "torch", ".", "nn", ".", "Linear", "(", "last_size", ",", "1", ")", "]", "\n", "", "self", ".", "final_layer", "=", "torch", ".", "nn", ".", "Sequential", "(", "*", "finals", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.rec_model.RecMAM.forward": [[29, 35], ["torch.cat", "rec_model.RecMAM.mem_layer", "rec_model.RecMAM.fc", "rec_model.RecMAM.final_layer"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x1", ",", "x2", ")", ":", "\n", "        ", "x", "=", "torch", ".", "cat", "(", "[", "x1", ",", "x2", "]", ",", "1", ")", "\n", "out0", "=", "self", ".", "mem_layer", "(", "x", ")", "\n", "out", "=", "self", ".", "fc", "(", "out0", ")", "\n", "out", "=", "self", ".", "final_layer", "(", "out", ")", "\n", "return", "out", "\n", "", "", ""]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.info_embedding.ItemEmbedding.__init__": [[6, 25], ["super().__init__", "int", "range", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Linear", "torch.nn.Linear.bias.data.fill_", "fcs.append", "fcs.append", "torch.nn.Linear", "activation_func", "activation_func"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.info_embedding.UserEmbedding.__init__", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.activation_func", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.activation_func"], ["    ", "def", "__init__", "(", "self", ",", "n_layer", ",", "in_dim", ",", "embedding_dim", ",", "activation", "=", "'sigmoid'", ")", ":", "\n", "        ", "super", "(", "ItemEmbedding", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "input_size", "=", "in_dim", "\n", "\n", "fcs", "=", "[", "]", "\n", "last_size", "=", "self", ".", "input_size", "\n", "hid_dim", "=", "int", "(", "self", ".", "input_size", "/", "2", ")", "\n", "\n", "for", "i", "in", "range", "(", "n_layer", "-", "1", ")", ":", "\n", "            ", "linear_model", "=", "torch", ".", "nn", ".", "Linear", "(", "last_size", ",", "hid_dim", ")", "\n", "linear_model", ".", "bias", ".", "data", ".", "fill_", "(", "0.0", ")", "\n", "fcs", ".", "append", "(", "linear_model", ")", "\n", "last_size", "=", "hid_dim", "\n", "fcs", ".", "append", "(", "activation_func", "(", "activation", ")", ")", "\n", "\n", "", "self", ".", "fc", "=", "torch", ".", "nn", ".", "Sequential", "(", "*", "fcs", ")", "\n", "\n", "finals", "=", "[", "torch", ".", "nn", ".", "Linear", "(", "last_size", ",", "embedding_dim", ")", ",", "activation_func", "(", "activation", ")", "]", "\n", "self", ".", "final_layer", "=", "torch", ".", "nn", ".", "Sequential", "(", "*", "finals", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.info_embedding.ItemEmbedding.forward": [[26, 30], ["info_embedding.ItemEmbedding.fc", "info_embedding.ItemEmbedding.final_layer"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "x", "=", "self", ".", "fc", "(", "x", ")", "\n", "out", "=", "self", ".", "final_layer", "(", "x", ")", "\n", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.info_embedding.UserEmbedding.__init__": [[33, 52], ["super().__init__", "int", "range", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Linear", "torch.nn.Linear.bias.data.fill_", "fcs.append", "fcs.append", "torch.nn.Linear", "activation_func", "activation_func"], "methods", ["home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.info_embedding.UserEmbedding.__init__", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.activation_func", "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.None.utils.activation_func"], ["    ", "def", "__init__", "(", "self", ",", "n_layer", ",", "in_dim", ",", "embedding_dim", ",", "activation", "=", "'sigmoid'", ")", ":", "\n", "        ", "super", "(", "UserEmbedding", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "input_size", "=", "in_dim", "\n", "\n", "fcs", "=", "[", "]", "\n", "last_size", "=", "self", ".", "input_size", "\n", "hid_dim", "=", "int", "(", "self", ".", "input_size", "/", "2", ")", "\n", "\n", "for", "i", "in", "range", "(", "n_layer", "-", "1", ")", ":", "\n", "            ", "linear_model", "=", "torch", ".", "nn", ".", "Linear", "(", "last_size", ",", "hid_dim", ")", "\n", "linear_model", ".", "bias", ".", "data", ".", "fill_", "(", "0.0", ")", "\n", "fcs", ".", "append", "(", "linear_model", ")", "\n", "last_size", "=", "hid_dim", "\n", "fcs", ".", "append", "(", "activation_func", "(", "activation", ")", ")", "\n", "\n", "", "self", ".", "fc", "=", "torch", ".", "nn", ".", "Sequential", "(", "*", "fcs", ")", "\n", "\n", "finals", "=", "[", "torch", ".", "nn", ".", "Linear", "(", "last_size", ",", "embedding_dim", ")", ",", "activation_func", "(", "activation", ")", "]", "\n", "self", ".", "final_layer", "=", "torch", ".", "nn", ".", "Sequential", "(", "*", "finals", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.dongmanqing_Code-for-MAMO.modules.info_embedding.UserEmbedding.forward": [[53, 57], ["info_embedding.UserEmbedding.fc", "info_embedding.UserEmbedding.final_layer"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "x", "=", "self", ".", "fc", "(", "x", ")", "\n", "out", "=", "self", ".", "final_layer", "(", "x", ")", "\n", "return", "out", "\n", "", "", ""]]}