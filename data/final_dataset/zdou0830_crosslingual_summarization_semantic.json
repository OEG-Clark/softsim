{"home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.word-level-supervised.translate.translate": [[17, 49], ["sorted", "sorted", "logging.info", "beaver.infer.beam_search", "zip", "open", "out_file.write", "out_file.write", "zip", "open", "out_file.write", "out_file.write", "len", "logging.info", "len", "logging.info", "fields[].decode", "fields[].decode"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.translator.beam_search", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode"], ["def", "translate", "(", "dataset", ",", "fields", ",", "model", ")", ":", "\n", "\n", "    ", "already_1", ",", "hypothesis_1", ",", "references_1", "=", "0", ",", "[", "]", ",", "[", "]", "\n", "already_2", ",", "hypothesis_2", ",", "references_2", "=", "0", ",", "[", "]", ",", "[", "]", "\n", "\n", "for", "batch", ",", "flag", "in", "dataset", ":", "\n", "        ", "predictions", "=", "beam_search", "(", "opt", ",", "model", ",", "batch", ".", "src", ",", "fields", ",", "flag", ")", "\n", "\n", "if", "flag", ":", "\n", "            ", "hypothesis_1", "+=", "[", "fields", "[", "\"task1_tgt\"", "]", ".", "decode", "(", "p", ")", "for", "p", "in", "predictions", "]", "\n", "already_1", "+=", "len", "(", "predictions", ")", "\n", "logging", ".", "info", "(", "\"Task 1: %7d/%7d\"", "%", "(", "already_1", ",", "dataset", ".", "task1_dataset", ".", "num_examples", ")", ")", "\n", "", "else", ":", "\n", "            ", "hypothesis_2", "+=", "[", "fields", "[", "\"task2_tgt\"", "]", ".", "decode", "(", "p", ")", "for", "p", "in", "predictions", "]", "\n", "already_2", "+=", "len", "(", "predictions", ")", "\n", "logging", ".", "info", "(", "\"Task 2: %7d/%7d\"", "%", "(", "already_2", ",", "dataset", ".", "task2_dataset", ".", "num_examples", ")", ")", "\n", "\n", "", "", "origin_1", "=", "sorted", "(", "zip", "(", "hypothesis_1", ",", "dataset", ".", "task1_dataset", ".", "seed", ")", ",", "key", "=", "lambda", "t", ":", "t", "[", "1", "]", ")", "\n", "hypothesis_1", "=", "[", "h", "for", "h", ",", "_", "in", "origin_1", "]", "\n", "\n", "with", "open", "(", "opt", ".", "output", "[", "0", "]", ",", "\"w\"", ",", "encoding", "=", "\"UTF-8\"", ")", "as", "out_file", ":", "\n", "        ", "out_file", ".", "write", "(", "\"\\n\"", ".", "join", "(", "hypothesis_1", ")", ")", "\n", "out_file", ".", "write", "(", "\"\\n\"", ")", "\n", "\n", "", "origin_2", "=", "sorted", "(", "zip", "(", "hypothesis_2", ",", "dataset", ".", "task2_dataset", ".", "seed", ")", ",", "key", "=", "lambda", "t", ":", "t", "[", "1", "]", ")", "\n", "hypothesis_2", "=", "[", "h", "for", "h", ",", "_", "in", "origin_2", "]", "\n", "\n", "with", "open", "(", "opt", ".", "output", "[", "1", "]", ",", "\"w\"", ",", "encoding", "=", "\"UTF-8\"", ")", "as", "out_file", ":", "\n", "        ", "out_file", ".", "write", "(", "\"\\n\"", ".", "join", "(", "hypothesis_2", ")", ")", "\n", "out_file", ".", "write", "(", "\"\\n\"", ")", "\n", "\n", "", "logging", ".", "info", "(", "\"Translation finished. \"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.word-level-supervised.translate.main": [[51, 74], ["logging.info", "beaver.data.build_dataset", "logging.info", "torch.load", "logging.info", "beaver.model.NMTModel.load_model().to().eval", "logging.info", "len", "len", "len", "torch.set_grad_enabled", "translate.translate", "beaver.model.NMTModel.load_model().to", "beaver.model.NMTModel.load_model"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.utils.build_dataset", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.translate.translate", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.nmt_model.NMTModel.load_model"], ["", "def", "main", "(", ")", ":", "\n", "    ", "logging", ".", "info", "(", "\"Build dataset...\"", ")", "\n", "dataset", "=", "build_dataset", "(", "opt", ",", "[", "opt", ".", "input", "[", "0", "]", ",", "opt", ".", "input", "[", "0", "]", ",", "opt", ".", "input", "[", "1", "]", ",", "opt", ".", "input", "[", "1", "]", "]", ",", "opt", ".", "vocab", ",", "device", ",", "train", "=", "False", ")", "\n", "\n", "fields", "=", "dataset", ".", "fields", "\n", "\n", "pad_ids", "=", "{", "\"src\"", ":", "fields", "[", "\"src\"", "]", ".", "pad_id", ",", "\n", "\"task1_tgt\"", ":", "fields", "[", "\"task1_tgt\"", "]", ".", "pad_id", ",", "\n", "\"task2_tgt\"", ":", "fields", "[", "\"task2_tgt\"", "]", ".", "pad_id", "}", "\n", "vocab_sizes", "=", "{", "\"src\"", ":", "len", "(", "fields", "[", "\"src\"", "]", ".", "vocab", ")", ",", "\n", "\"task1_tgt\"", ":", "len", "(", "fields", "[", "\"task1_tgt\"", "]", ".", "vocab", ")", ",", "\n", "\"task2_tgt\"", ":", "len", "(", "fields", "[", "\"task2_tgt\"", "]", ".", "vocab", ")", "}", "\n", "\n", "# load checkpoint from model_path", "\n", "logging", ".", "info", "(", "\"Load checkpoint from %s.\"", "%", "opt", ".", "model_path", ")", "\n", "checkpoint", "=", "torch", ".", "load", "(", "opt", ".", "model_path", ",", "map_location", "=", "lambda", "storage", ",", "loc", ":", "storage", ")", "\n", "\n", "logging", ".", "info", "(", "\"Build model...\"", ")", "\n", "model", "=", "NMTModel", ".", "load_model", "(", "checkpoint", "[", "\"opt\"", "]", ",", "pad_ids", ",", "vocab_sizes", ",", "checkpoint", "[", "\"model\"", "]", ")", ".", "to", "(", "device", ")", ".", "eval", "(", ")", "\n", "\n", "logging", ".", "info", "(", "\"Start translation...\"", ")", "\n", "with", "torch", ".", "set_grad_enabled", "(", "False", ")", ":", "\n", "        ", "translate", "(", "dataset", ",", "fields", ",", "model", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.word-level-supervised.train.valid": [[26, 63], ["model.eval", "enumerate", "beaver.utils.calculate_bleu", "beaver.utils.calculate_bleu", "beaver.utils.metric.calculate_rouge", "beaver.utils.metric.calculate_rouge", "logging.info", "saver.save", "model", "model.topk", "model.state_dict", "criterion_task1", "criterion_task2", "valid_dataset.fields[].decode", "valid_dataset.fields[].decode", "valid_dataset.fields[].decode", "valid_dataset.fields[].decode"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.metric.calculate_bleu", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.metric.calculate_bleu", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.metric.calculate_rouge", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.metric.calculate_rouge", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.saver.Saver.save", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode"], ["def", "valid", "(", "model", ",", "criterion_task1", ",", "criterion_task2", ",", "valid_dataset", ",", "step", ")", ":", "\n", "    ", "model", ".", "eval", "(", ")", "\n", "total_n", "=", "0", "\n", "total_task1_loss", "=", "total_task2_loss", "=", "0.0", "\n", "task1_hypothesis", ",", "task1_references", "=", "[", "]", ",", "[", "]", "\n", "task2_hypothesis", ",", "task2_references", "=", "[", "]", ",", "[", "]", "\n", "\n", "for", "i", ",", "(", "batch", ",", "flag", ")", "in", "enumerate", "(", "valid_dataset", ")", ":", "\n", "\n", "        ", "scores", "=", "model", "(", "batch", ".", "src", ",", "batch", ".", "tgt", ",", "flag", ")", "\n", "if", "flag", ":", "\n", "            ", "loss", "=", "criterion_task1", "(", "scores", ",", "batch", ".", "tgt", ")", "\n", "", "else", ":", "\n", "            ", "loss", "=", "criterion_task2", "(", "scores", ",", "batch", ".", "tgt", ")", "\n", "", "_", ",", "predictions", "=", "scores", ".", "topk", "(", "k", "=", "1", ",", "dim", "=", "-", "1", ")", "\n", "\n", "if", "flag", ":", "# task1", "\n", "            ", "total_task1_loss", "+=", "loss", ".", "data", "\n", "task1_hypothesis", "+=", "[", "valid_dataset", ".", "fields", "[", "\"task1_tgt\"", "]", ".", "decode", "(", "p", ")", "for", "p", "in", "predictions", "]", "\n", "task1_references", "+=", "[", "valid_dataset", ".", "fields", "[", "\"task1_tgt\"", "]", ".", "decode", "(", "t", ")", "for", "t", "in", "batch", ".", "tgt", "]", "\n", "", "else", ":", "\n", "            ", "total_task2_loss", "+=", "loss", ".", "data", "\n", "task2_hypothesis", "+=", "[", "valid_dataset", ".", "fields", "[", "\"task2_tgt\"", "]", ".", "decode", "(", "p", ")", "for", "p", "in", "predictions", "]", "\n", "task2_references", "+=", "[", "valid_dataset", ".", "fields", "[", "\"task2_tgt\"", "]", ".", "decode", "(", "t", ")", "for", "t", "in", "batch", ".", "tgt", "]", "\n", "\n", "", "total_n", "+=", "1", "\n", "\n", "", "bleu_task1", "=", "calculate_bleu", "(", "task1_hypothesis", ",", "task1_references", ")", "\n", "bleu_task2", "=", "calculate_bleu", "(", "task2_hypothesis", ",", "task2_references", ")", "\n", "rouge1_task1", ",", "rouge2_task1", "=", "calculate_rouge", "(", "task1_hypothesis", ",", "task1_references", ")", "\n", "rouge1_task2", ",", "rouge2_task2", "=", "calculate_rouge", "(", "task2_hypothesis", ",", "task2_references", ")", "\n", "mean_task1_loss", "=", "total_task1_loss", "/", "total_n", "\n", "mean_task2_loss", "=", "total_task2_loss", "/", "total_n", "\n", "logging", ".", "info", "(", "\"loss-task1: %.2f \\t loss-task2 %.2f \\t bleu-task1: %3.2f\\t bleu-task2: %3.2f \\t rouge1-task1: %3.2f \\t rouge1-task2: %3.2f \\t rouge2-task1: %3.2f \\t rouge2-task2: %3.2f\"", "\n", "%", "(", "mean_task1_loss", ",", "mean_task2_loss", ",", "bleu_task1", ",", "bleu_task2", ",", "rouge1_task1", ",", "rouge1_task2", ",", "rouge2_task1", ",", "rouge2_task2", ")", ")", "\n", "checkpoint", "=", "{", "\"model\"", ":", "model", ".", "state_dict", "(", ")", ",", "\"opt\"", ":", "opt", "}", "\n", "saver", ".", "save", "(", "checkpoint", ",", "step", ",", "mean_task1_loss", ",", "mean_task2_loss", ",", "bleu_task1", ",", "bleu_task2", ",", "rouge1_task1", ",", "rouge1_task2", ",", "rouge2_task1", ",", "rouge2_task2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.word-level-supervised.train.train": [[65, 107], ["model.zero_grad", "enumerate", "model", "criterion_task2.backward", "criterion_task1", "criterion_task2", "optimizer.step", "model.zero_grad", "torch.mean", "torch.mean", "logging.info", "model.train", "torch.mean", "torch.mean", "torch.set_grad_enabled", "torch.set_grad_enabled", "train.valid", "torch.log", "torch.log", "batch.score.view", "batch.score.view"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.loss.optimizers.WarmAdam.step", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.train", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.valid"], ["", "def", "train", "(", "model", ",", "criterion_task1", ",", "criterion_task2", ",", "optimizer", ",", "train_dataset", ",", "valid_dataset", ")", ":", "\n", "    ", "total_task1_loss", "=", "total_task2_loss", "=", "0.0", "\n", "model", ".", "zero_grad", "(", ")", "\n", "for", "i", ",", "(", "batch", ",", "flag", ")", "in", "enumerate", "(", "train_dataset", ")", ":", "\n", "\n", "        ", "scores", ",", "ext_scores", "=", "model", "(", "batch", ".", "src", ",", "batch", ".", "tgt", ",", "flag", ",", "True", ")", "\n", "if", "flag", ":", "\n", "            ", "loss", "=", "criterion_task1", "(", "scores", ",", "batch", ".", "tgt", ")", "\n", "", "else", ":", "\n", "            ", "loss", "=", "criterion_task2", "(", "scores", ",", "batch", ".", "tgt", ")", "\n", "\n", "", "if", "not", "flag", ":", "\n", "            ", "if", "True", ":", "\n", "                ", "loss2", "=", "torch", ".", "mean", "(", "(", "ext_scores", "-", "torch", ".", "log", "(", "batch", ".", "score", ".", "view", "(", "1", ",", "-", "1", ")", "+", "1e-6", ")", ")", "**", "2", ")", "\n", "loss", "=", "loss", "+", "1.0", "*", "loss2", "\n", "", "else", ":", "\n", "                ", "loss2", "=", "-", "torch", ".", "mean", "(", "ext_scores", "*", "(", "batch", ".", "score", ".", "view", "(", "1", ",", "-", "1", ")", ")", ")", "\n", "loss", "=", "loss", "+", "10.0", "*", "loss2", "\n", "\n", "", "", "loss", ".", "backward", "(", ")", "\n", "\n", "if", "flag", ":", "# task1", "\n", "            ", "total_task1_loss", "+=", "loss", ".", "data", "\n", "", "else", ":", "\n", "            ", "total_task2_loss", "+=", "loss", ".", "data", "\n", "\n", "", "if", "(", "i", "+", "1", ")", "%", "opt", ".", "grad_accum", "==", "0", ":", "\n", "            ", "optimizer", ".", "step", "(", ")", "\n", "model", ".", "zero_grad", "(", ")", "\n", "\n", "if", "optimizer", ".", "n_step", "%", "opt", ".", "report_every", "==", "0", ":", "\n", "                ", "mean_task1_loss", "=", "total_task1_loss", "/", "opt", ".", "report_every", "/", "opt", ".", "grad_accum", "*", "2", "\n", "mean_task2_loss", "=", "total_task2_loss", "/", "opt", ".", "report_every", "/", "opt", ".", "grad_accum", "*", "2", "\n", "logging", ".", "info", "(", "\"step: %7d\\t loss-task1: %.4f \\t loss-task2: %.4f\"", "\n", "%", "(", "optimizer", ".", "n_step", ",", "mean_task1_loss", ",", "mean_task2_loss", ")", ")", "\n", "total_task1_loss", "=", "total_task2_loss", "=", "0.0", "\n", "\n", "", "if", "optimizer", ".", "n_step", "%", "opt", ".", "save_every", "==", "0", ":", "\n", "                ", "with", "torch", ".", "set_grad_enabled", "(", "False", ")", ":", "\n", "                    ", "valid", "(", "model", ",", "criterion_task1", ",", "criterion_task2", ",", "valid_dataset", ",", "optimizer", ".", "n_step", ")", "\n", "", "model", ".", "train", "(", ")", "\n", "", "", "del", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.word-level-supervised.train.main": [[109, 132], ["logging.info", "beaver.data.build_dataset", "beaver.data.build_dataset", "logging.info", "beaver.model.NMTModel.load_model().to", "beaver.loss.LabelSmoothingLoss().to", "beaver.loss.LabelSmoothingLoss().to", "beaver.loss.WarmAdam", "logging.info", "train.train", "len", "len", "len", "int", "NMTModel.load_model().to.parameters", "beaver.model.NMTModel.load_model", "beaver.loss.LabelSmoothingLoss", "beaver.loss.LabelSmoothingLoss", "opt.train_from.split"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.utils.build_dataset", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.utils.build_dataset", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.train", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.nmt_model.NMTModel.load_model"], ["", "", "def", "main", "(", ")", ":", "\n", "    ", "logging", ".", "info", "(", "\"Build dataset...\"", ")", "\n", "train_dataset", "=", "build_dataset", "(", "opt", ",", "opt", ".", "train", ",", "opt", ".", "vocab", ",", "device", ",", "train", "=", "True", ")", "\n", "valid_dataset", "=", "build_dataset", "(", "opt", ",", "opt", ".", "valid", ",", "opt", ".", "vocab", ",", "device", ",", "train", "=", "False", ")", "\n", "fields", "=", "valid_dataset", ".", "fields", "=", "train_dataset", ".", "fields", "\n", "logging", ".", "info", "(", "\"Build model...\"", ")", "\n", "\n", "pad_ids", "=", "{", "\"src\"", ":", "fields", "[", "\"src\"", "]", ".", "pad_id", ",", "\n", "\"task1_tgt\"", ":", "fields", "[", "\"task1_tgt\"", "]", ".", "pad_id", ",", "\n", "\"task2_tgt\"", ":", "fields", "[", "\"task2_tgt\"", "]", ".", "pad_id", "}", "\n", "vocab_sizes", "=", "{", "\"src\"", ":", "len", "(", "fields", "[", "\"src\"", "]", ".", "vocab", ")", ",", "\n", "\"task1_tgt\"", ":", "len", "(", "fields", "[", "\"task1_tgt\"", "]", ".", "vocab", ")", ",", "\n", "\"task2_tgt\"", ":", "len", "(", "fields", "[", "\"task2_tgt\"", "]", ".", "vocab", ")", "}", "\n", "\n", "model", "=", "NMTModel", ".", "load_model", "(", "opt", ",", "pad_ids", ",", "vocab_sizes", ",", "cls_id1", "=", "None", ",", "cls_id2", "=", "None", ")", ".", "to", "(", "device", ")", "\n", "criterion_task1", "=", "LabelSmoothingLoss", "(", "opt", ".", "label_smoothing", ",", "vocab_sizes", "[", "\"task1_tgt\"", "]", ",", "pad_ids", "[", "\"task1_tgt\"", "]", ")", ".", "to", "(", "device", ")", "\n", "criterion_task2", "=", "LabelSmoothingLoss", "(", "opt", ".", "label_smoothing", ",", "vocab_sizes", "[", "\"task2_tgt\"", "]", ",", "pad_ids", "[", "\"task2_tgt\"", "]", ")", ".", "to", "(", "device", ")", "\n", "\n", "n_step", "=", "int", "(", "opt", ".", "train_from", ".", "split", "(", "\"-\"", ")", "[", "-", "1", "]", ")", "if", "opt", ".", "train_from", "else", "1", "\n", "optimizer", "=", "WarmAdam", "(", "model", ".", "parameters", "(", ")", ",", "opt", ".", "lr", ",", "opt", ".", "hidden_size", ",", "opt", ".", "warm_up", ",", "n_step", ")", "\n", "\n", "logging", ".", "info", "(", "\"start training...\"", ")", "\n", "train", "(", "model", ",", "criterion_task1", ",", "criterion_task2", ",", "optimizer", ",", "train_dataset", ",", "valid_dataset", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.tools.model_average.main": [[10, 27], ["int", "len", "first_model.items", "torch.save", "len", "print", "exit", "os.path.join", "sorted", "torch.load", "os.path.join", "os.listdir", "f.startswith", "fs[].split", "fs[].split"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.saver.Saver.save"], ["def", "main", "(", ")", ":", "\n", "    ", "if", "len", "(", "sys", ".", "argv", ")", "!=", "3", ":", "\n", "        ", "print", "(", "\"python model_average.py model_path n\"", ")", "\n", "exit", "(", ")", "\n", "\n", "", "model_path", "=", "sys", ".", "argv", "[", "1", "]", "\n", "n", "=", "int", "(", "sys", ".", "argv", "[", "2", "]", ")", "# last n model to be averaged", "\n", "fs", "=", "[", "os", ".", "path", ".", "join", "(", "model_path", ",", "f", ")", "for", "f", "in", "os", ".", "listdir", "(", "model_path", ")", "if", "f", ".", "startswith", "(", "\"checkpoint\"", ")", "]", "\n", "fs", "=", "sorted", "(", "fs", ",", "reverse", "=", "True", ")", "[", ":", "n", "]", "# last n file", "\n", "n", "=", "len", "(", "fs", ")", "# actual file count", "\n", "cks", "=", "[", "torch", ".", "load", "(", "f", ",", "map_location", "=", "lambda", "storage", ",", "loc", ":", "storage", ")", "for", "f", "in", "fs", "]", "\n", "first_model", "=", "cks", "[", "0", "]", "[", "\"model\"", "]", "# average all weights into first model and save it", "\n", "for", "k", ",", "_", "in", "first_model", ".", "items", "(", ")", ":", "\n", "        ", "for", "ck", "in", "cks", "[", "1", ":", "]", ":", "\n", "            ", "first_model", "[", "k", "]", "=", "(", "first_model", "[", "k", "]", "+", "ck", "[", "\"model\"", "]", "[", "k", "]", ")", "\n", "", "first_model", "[", "k", "]", "=", "first_model", "[", "k", "]", "/", "n", "\n", "", "torch", ".", "save", "(", "cks", "[", "0", "]", ",", "os", ".", "path", ".", "join", "(", "model_path", ",", "\"averaged-%s-%s\"", "%", "(", "fs", "[", "-", "1", "]", ".", "split", "(", "\"-\"", ")", "[", "-", "1", "]", ",", "fs", "[", "0", "]", ".", "split", "(", "\"-\"", ")", "[", "-", "1", "]", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.tools.build_vocab.main": [[8, 22], ["int", "collections.Counter", "collections.Counter.most_common", "sum", "sum", "log", "log", "log", "log", "collections.Counter.update", "print", "line.strip().split", "len", "line.strip"], "function", ["None"], ["def", "main", "(", ")", ":", "\n", "    ", "size", "=", "int", "(", "sys", ".", "argv", "[", "1", "]", ")", "\n", "counter", "=", "collections", ".", "Counter", "(", ")", "\n", "for", "line", "in", "sys", ".", "stdin", ":", "\n", "        ", "counter", ".", "update", "(", "line", ".", "strip", "(", ")", ".", "split", "(", ")", ")", "\n", "", "items", "=", "counter", ".", "most_common", "(", ")", "\n", "for", "word", ",", "_", "in", "items", "[", ":", "size", "]", ":", "\n", "        ", "print", "(", "word", ")", "\n", "", "total", "=", "sum", "(", "[", "c", "for", "_", ",", "c", "in", "items", "]", ")", "\n", "appear", "=", "sum", "(", "[", "c", "for", "_", ",", "c", "in", "items", "[", ":", "size", "]", "]", ")", "\n", "log", "(", "\"total words: %d\\n\"", "%", "total", ")", "\n", "log", "(", "\"words in vocab: %d\\n\"", "%", "appear", ")", "\n", "log", "(", "\"vocab coverage: %.2f%%\\n\"", "%", "(", "1.0", "*", "appear", "/", "total", "*", "100", ")", ")", "\n", "log", "(", "\"total unique words: %d\\n\"", "%", "len", "(", "items", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.get_ngrams": [[4, 11], ["set", "len", "range", "set.add", "tuple"], "function", ["None"], ["def", "get_ngrams", "(", "n", ",", "text", ")", ":", "\n", "    ", "ngram_set", "=", "set", "(", ")", "\n", "text_length", "=", "len", "(", "text", ")", "\n", "max_index_ngram", "=", "text_length", "-", "n", "\n", "for", "i", "in", "range", "(", "max_index_ngram", "+", "1", ")", ":", "\n", "        ", "ngram_set", ".", "add", "(", "tuple", "(", "text", "[", "i", ":", "i", "+", "n", "]", ")", ")", "\n", "", "return", "ngram_set", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.rouge_n": [[33, 47], ["rouge.get_ngrams", "rouge.get_ngrams", "len", "get_ngrams.intersection", "len", "len", "len"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.get_ngrams", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.get_ngrams"], ["\n", "", "def", "rouge_2", "(", "evaluated_sentences", ",", "reference_sentences", ")", ":", "\n", "    ", "evaluated_sentences", "=", "evaluated_sentences", ".", "split", "(", ")", "\n", "reference_sentences", "=", "reference_sentences", ".", "split", "(", ")", "\n", "return", "rouge_n", "(", "evaluated_sentences", ",", "reference_sentences", ",", "n", "=", "2", ")", "\n", "\n", "\n", "", "def", "F_1", "(", "evaluated_sentences", ",", "reference_sentences", ",", "beta", "=", "1", ")", ":", "\n", "    ", "evaluated_sentences", "=", "evaluated_sentences", ".", "split", "(", ")", "\n", "reference_sentences", "=", "reference_sentences", ".", "split", "(", ")", "\n", "if", "len", "(", "evaluated_sentences", ")", "<=", "0", "or", "len", "(", "reference_sentences", ")", "<=", "0", ":", "\n", "        ", "return", "0", "\n", "\n", "", "evaluated_ngrams", "=", "get_ngrams", "(", "beta", ",", "evaluated_sentences", ")", "# equal to retrieved set", "\n", "reference_ngrams", "=", "get_ngrams", "(", "beta", ",", "reference_sentences", ")", "# equal to relevant set", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.rouge_1": [[49, 53], ["evaluated_sentences.split.split", "reference_sentences.split.split", "rouge.rouge_n"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.rouge_n"], ["reference_ngrams_num", "=", "len", "(", "reference_ngrams", ")", "\n", "\n", "if", "reference_ngrams_num", "==", "0", "or", "evaluated_ngrams_num", "==", "0", ":", "\n", "        ", "return", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.rouge_2": [[55, 59], ["evaluated_sentences.split.split", "reference_sentences.split.split", "rouge.rouge_n"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.rouge_n"], ["overlapping_ngrams_num", "=", "len", "(", "overlapping_ngrams", ")", "\n", "if", "overlapping_ngrams_num", "==", "0", ":", "\n", "        ", "return", "0", "\n", "", "return", "2", "*", "overlapping_ngrams_num", "/", "(", "reference_ngrams_num", "+", "evaluated_ngrams_num", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.F_1": [[61, 84], ["evaluated_sentences.split.split", "reference_sentences.split.split", "rouge.create_ngrams", "rouge.create_ngrams", "rouge.score_ngrams", "rouge.get_ngrams", "rouge.get_ngrams", "len", "len", "get_ngrams.intersection", "len", "len", "len"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.create_ngrams", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.create_ngrams", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.score_ngrams", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.get_ngrams", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.get_ngrams"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.metric.calculate_bleu": [[9, 17], ["tempfile.NamedTemporaryFile", "tempfile.NamedTemporaryFile.write", "tempfile.NamedTemporaryFile.close", "tempfile.NamedTemporaryFile", "tempfile.NamedTemporaryFile.write", "tempfile.NamedTemporaryFile.close", "metric.file_bleu"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.metric.file_bleu"], ["def", "calculate_bleu", "(", "hypotheses", ",", "references", ",", "lowercase", "=", "False", ")", ":", "\n", "    ", "hypothesis_file", "=", "tempfile", ".", "NamedTemporaryFile", "(", "mode", "=", "\"w\"", ",", "encoding", "=", "\"UTF-8\"", ",", "delete", "=", "False", ")", "\n", "hypothesis_file", ".", "write", "(", "\"\\n\"", ".", "join", "(", "hypotheses", ")", "+", "\"\\n\"", ")", "\n", "hypothesis_file", ".", "close", "(", ")", "\n", "reference_file", "=", "tempfile", ".", "NamedTemporaryFile", "(", "mode", "=", "\"w\"", ",", "encoding", "=", "\"UTF-8\"", ",", "delete", "=", "False", ")", "\n", "reference_file", ".", "write", "(", "\"\\n\"", ".", "join", "(", "references", ")", "+", "\"\\n\"", ")", "\n", "reference_file", ".", "close", "(", ")", "\n", "return", "file_bleu", "(", "hypothesis_file", ".", "name", ",", "reference_file", ".", "name", ",", "lowercase", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.metric.calculate_rouge": [[19, 30], ["zip", "beaver.utils.rouge.F_1", "beaver.utils.rouge.F_1", "rg1list.append", "rg2list.append", "sum", "len", "sum", "len"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.F_1", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.F_1"], ["", "def", "calculate_rouge", "(", "hypotheses", ",", "references", ")", ":", "\n", "    ", "rg1list", "=", "[", "]", "\n", "rg2list", "=", "[", "]", "\n", "for", "hypo", ",", "ref", "in", "zip", "(", "hypotheses", ",", "references", ")", ":", "\n", "        ", "rouge1", "=", "F_1", "(", "hypo", ",", "ref", ",", "beta", "=", "1", ")", "\n", "rouge2", "=", "F_1", "(", "hypo", ",", "ref", ",", "beta", "=", "2", ")", "\n", "rg1list", ".", "append", "(", "rouge1", ")", "\n", "rg2list", ".", "append", "(", "rouge2", ")", "\n", "", "rg1", "=", "sum", "(", "rg1list", ")", "/", "len", "(", "rg1list", ")", "\n", "rg2", "=", "sum", "(", "rg2list", ")", "/", "len", "(", "rg2list", ")", "\n", "return", "rg1", "*", "100", ",", "rg2", "*", "100", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.metric.file_bleu": [[32, 47], ["os.path.dirname", "os.path.join", "os.path.dirname", "open", "open", "float", "os.path.dirname", "subprocess.check_output().decode", "re.search().group", "subprocess.check_output", "re.search"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode"], ["", "def", "file_bleu", "(", "hypothesis", ",", "reference", ",", "lowercase", "=", "False", ")", ":", "\n", "# ../../../tools/multi-bleu.perl, so take 3 levels up.", "\n", "    ", "beaver_path", "=", "os", ".", "path", ".", "dirname", "(", "os", ".", "path", ".", "dirname", "(", "os", ".", "path", ".", "dirname", "(", "__file__", ")", ")", ")", "\n", "multi_bleu_path", "=", "os", ".", "path", ".", "join", "(", "beaver_path", ",", "\"tools\"", ",", "\"multi-bleu.perl\"", ")", "\n", "with", "open", "(", "hypothesis", ",", "\"r\"", ")", "as", "read_pred", ",", "open", "(", "os", ".", "devnull", ",", "\"w\"", ")", "as", "black_hole", ":", "\n", "        ", "bleu_cmd", "=", "[", "\"perl\"", ",", "multi_bleu_path", "]", "\n", "if", "lowercase", ":", "\n", "            ", "bleu_cmd", "+=", "[", "\"-lc\"", "]", "\n", "", "bleu_cmd", "+=", "[", "reference", "]", "\n", "try", ":", "\n", "            ", "bleu_out", "=", "subprocess", ".", "check_output", "(", "bleu_cmd", ",", "stdin", "=", "read_pred", ",", "stderr", "=", "black_hole", ")", ".", "decode", "(", "\"utf-8\"", ")", "\n", "bleu_score", "=", "re", ".", "search", "(", "r\"BLEU = (.+?),\"", ",", "bleu_out", ")", ".", "group", "(", "1", ")", "\n", "", "except", "subprocess", ".", "CalledProcessError", ":", "\n", "            ", "bleu_score", "=", "-", "1.0", "\n", "", "return", "float", "(", "bleu_score", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.parseopt.common_opts": [[7, 18], ["parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument"], "function", ["None"], ["def", "common_opts", "(", "parser", ")", ":", "\n", "    ", "parser", ".", "add_argument", "(", "\"-vocab\"", ",", "type", "=", "str", ",", "nargs", "=", "\"*\"", ",", "help", "=", "\"Vocab file\"", ")", "\n", "parser", ".", "add_argument", "(", "\"-batch_size\"", ",", "type", "=", "int", ",", "default", "=", "8192", ",", "help", "=", "\"Batch size\"", ")", "\n", "parser", ".", "add_argument", "(", "\"-beam_size\"", ",", "type", "=", "int", ",", "default", "=", "4", ",", "help", "=", "\"Beam size\"", ")", "\n", "parser", ".", "add_argument", "(", "\"-max_length\"", ",", "type", "=", "int", ",", "default", "=", "200", ",", "help", "=", "\"Maximum prediction length\"", ")", "\n", "parser", ".", "add_argument", "(", "\"-length_penalty\"", ",", "type", "=", "float", ",", "default", "=", "0.6", ",", "help", "=", "\"Length penalty\"", ")", "\n", "parser", ".", "add_argument", "(", "\"-model_path\"", ",", "default", "=", "\"train\"", ",", "help", "=", "\"Path to model checkpoint file\"", ")", "\n", "parser", ".", "add_argument", "(", "\"-tf\"", ",", "action", "=", "\"store_true\"", ",", "help", "=", "\"Use teacher forcing for decoding\"", ")", "\n", "\n", "parser", ".", "add_argument", "(", "\"-mono\"", ",", "action", "=", "\"store_true\"", ",", "help", "=", "\"\u4efb\u52a11\u4e3a\u5355\u8bed\u6458\u8981\"", ")", "\n", "parser", ".", "add_argument", "(", "\"-min_length\"", ",", "type", "=", "int", ",", "default", "=", "1", ",", "help", "=", "\"Minimum prediction length\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.parseopt.data_opts": [[20, 24], ["parser.add_argument", "parser.add_argument", "parser.add_argument"], "function", ["None"], ["", "def", "data_opts", "(", "parser", ")", ":", "\n", "    ", "parser", ".", "add_argument", "(", "\"-train\"", ",", "type", "=", "str", ",", "nargs", "=", "4", ",", "help", "=", "\"Training data\"", ")", "\n", "parser", ".", "add_argument", "(", "\"-valid\"", ",", "type", "=", "str", ",", "nargs", "=", "4", ",", "help", "=", "\"Validation data\"", ")", "\n", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.parseopt.train_opts": [[26, 37], ["parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument"], "function", ["None"], ["    ", "parser", ".", "add_argument", "(", "\"-grad_accum\"", ",", "type", "=", "int", ",", "default", "=", "1", ",", "help", "=", "\"Accumulate gradients\"", ")", "\n", "parser", ".", "add_argument", "(", "\"-max_to_keep\"", ",", "type", "=", "int", ",", "default", "=", "5", ",", "help", "=", "\"How many checkpoints to keep\"", ")", "\n", "parser", ".", "add_argument", "(", "\"-report_every\"", ",", "type", "=", "int", ",", "default", "=", "1000", ",", "help", "=", "\"Report every n steps\"", ")", "\n", "parser", ".", "add_argument", "(", "\"-save_every\"", ",", "type", "=", "int", ",", "default", "=", "2000", ",", "help", "=", "\"Valid and save model for every n steps\"", ")", "\n", "\n", "parser", ".", "add_argument", "(", "\"-train_from\"", ",", "type", "=", "str", ",", "default", "=", "None", ",", "help", "=", "\"Train from checkpoint\"", ")", "\n", "parser", ".", "add_argument", "(", "\"-score_file1\"", ",", "type", "=", "str", ",", "default", "=", "None", ",", "help", "=", "\"score1\"", ")", "\n", "parser", ".", "add_argument", "(", "\"-score_file2\"", ",", "type", "=", "str", ",", "default", "=", "None", ",", "help", "=", "\"score2\"", ")", "\n", "\n", "\n", "", "def", "model_opts", "(", "parser", ")", ":", "\n", "    ", "parser", ".", "add_argument", "(", "\"-layers\"", ",", "type", "=", "int", ",", "default", "=", "6", ",", "help", "=", "\"Number of layers\"", ")", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.parseopt.model_opts": [[39, 49], ["parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument"], "function", ["None"], ["parser", ".", "add_argument", "(", "\"-hidden_size\"", ",", "type", "=", "int", ",", "default", "=", "512", ",", "help", "=", "\"Size of hidden states\"", ")", "\n", "parser", ".", "add_argument", "(", "\"-ff_size\"", ",", "type", "=", "int", ",", "default", "=", "2048", ",", "help", "=", "\"Feed forward hidden size\"", ")", "\n", "\n", "parser", ".", "add_argument", "(", "\"-lr\"", ",", "type", "=", "float", ",", "default", "=", "1.0", ",", "help", "=", "\"Learning rate\"", ")", "\n", "parser", ".", "add_argument", "(", "\"-warm_up\"", ",", "type", "=", "int", ",", "default", "=", "8000", ",", "help", "=", "\"Warm up step\"", ")", "\n", "parser", ".", "add_argument", "(", "\"-label_smoothing\"", ",", "type", "=", "float", ",", "default", "=", "0.1", ",", "help", "=", "\"Label smoothing rate\"", ")", "\n", "parser", ".", "add_argument", "(", "\"-dropout\"", ",", "type", "=", "float", ",", "default", "=", "0.1", ",", "help", "=", "\"Dropout rate\"", ")", "\n", "\n", "\n", "", "def", "translate_opts", "(", "parser", ")", ":", "\n", "    ", "parser", ".", "add_argument", "(", "\"-input\"", ",", "type", "=", "str", ",", "nargs", "=", "2", ",", "help", "=", "\"Translation data\"", ")", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.parseopt.translate_opts": [[51, 56], ["parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument"], "function", ["None"], ["parser", ".", "add_argument", "(", "\"-output\"", ",", "default", "=", "[", "\"output1.txt\"", ",", "\"output2.txt\"", "]", ",", "help", "=", "\"Path to output the predictions\"", ")", "\n", "parser", ".", "add_argument", "(", "\"-bleu\"", ",", "action", "=", "\"store_true\"", ",", "help", "=", "\"Report BLEU\"", ")", "\n", "\n", "\n", "", "def", "parse_train_args", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.parseopt.parse_train_args": [[58, 65], ["argparse.ArgumentParser", "parseopt.data_opts", "parseopt.train_opts", "parseopt.model_opts", "parseopt.common_opts", "parseopt.parse_args"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.parseopt.data_opts", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.parseopt.train_opts", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.parseopt.model_opts", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.parseopt.common_opts", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.parseopt.parse_args"], ["train_opts", "(", "parser", ")", "\n", "model_opts", "(", "parser", ")", "\n", "common_opts", "(", "parser", ")", "\n", "return", "parse_args", "(", "parser", ")", "\n", "\n", "\n", "", "def", "parse_translate_args", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.parseopt.parse_translate_args": [[67, 72], ["argparse.ArgumentParser", "parseopt.translate_opts", "parseopt.common_opts", "parseopt.parse_args"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.parseopt.translate_opts", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.parseopt.common_opts", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.parseopt.parse_args"], ["common_opts", "(", "parser", ")", "\n", "return", "parse_args", "(", "parser", ")", "\n", "\n", "\n", "", "def", "parse_args", "(", "parser", ")", ":", "\n", "    ", "parser", ".", "add_argument", "(", "\"-config\"", ",", "type", "=", "str", ",", "help", "=", "\"Config file\"", ")", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.parseopt.parse_args": [[74, 83], ["parser.add_argument", "parser.parse_args", "json.load", "parser.set_defaults", "parser.parse_args", "open", "d.items"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.parseopt.parse_args", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.parseopt.parse_args"], ["if", "opt", ".", "config", ":", "\n", "        ", "config", "=", "json", ".", "load", "(", "open", "(", "opt", ".", "config", ")", ",", "object_hook", "=", "lambda", "d", ":", "{", "k", ":", "v", "for", "k", ",", "v", "in", "d", ".", "items", "(", ")", "if", "k", "!=", "\"comment\"", "}", ")", "\n", "parser", ".", "set_defaults", "(", "**", "config", ")", "\n", "return", "parser", ".", "parse_args", "(", ")", "\n", "", "else", ":", "\n", "        ", "return", "opt", "\n", "", "", ""]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.__init__.get_device": [[9, 14], ["torch.cuda.is_available", "torch.device", "torch.device"], "function", ["None"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.__init__.printing_opt": [[16, 18], ["sorted", "vars().items", "vars"], "function", ["None"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.saver.Saver.__init__": [[9, 17], ["os.mkdir", "datetime.datetime.now().strftime", "open", "log.write", "os.path.join", "datetime.datetime.now", "json.dumps", "vars"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "opt", ")", ":", "\n", "        ", "self", ".", "ckpt_names", "=", "[", "]", "\n", "self", ".", "model_path", "=", "opt", ".", "model_path", "+", "datetime", ".", "datetime", ".", "now", "(", ")", ".", "strftime", "(", "\"-%y%m%d-%H%M%S\"", ")", "\n", "self", ".", "max_to_keep", "=", "opt", ".", "max_to_keep", "\n", "os", ".", "mkdir", "(", "self", ".", "model_path", ")", "\n", "\n", "with", "open", "(", "os", ".", "path", ".", "join", "(", "self", ".", "model_path", ",", "\"params.json\"", ")", ",", "\"w\"", ",", "encoding", "=", "\"UTF-8\"", ")", "as", "log", ":", "\n", "            ", "log", ".", "write", "(", "json", ".", "dumps", "(", "vars", "(", "opt", ")", ",", "indent", "=", "4", ")", "+", "\"\\n\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.saver.Saver.save": [[18, 42], ["os.path.join", "saver.Saver.ckpt_names.append", "torch.save", "open", "log.write", "log.write", "log.write", "log.write", "log.write", "log.write", "log.write", "log.write", "log.write", "log.write", "log.write", "log.write", "log.write", "len", "saver.Saver.ckpt_names.pop", "os.remove", "os.path.join", "datetime.datetime.now"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.saver.Saver.save"], ["", "", "def", "save", "(", "self", ",", "save_dict", ",", "step", ",", "loss_task1", ",", "loss_task2", ",", "bleu_task1", ",", "bleu_task2", ",", "rouge1_task1", ",", "rouge1_task2", ",", "rouge2_task1", ",", "rouge2_task2", ")", ":", "\n", "        ", "filename", "=", "\"checkpoint-step-%06d\"", "%", "step", "\n", "full_filename", "=", "os", ".", "path", ".", "join", "(", "self", ".", "model_path", ",", "filename", ")", "\n", "self", ".", "ckpt_names", ".", "append", "(", "full_filename", ")", "\n", "torch", ".", "save", "(", "save_dict", ",", "full_filename", ")", "\n", "\n", "with", "open", "(", "os", ".", "path", ".", "join", "(", "self", ".", "model_path", ",", "\"log\"", ")", ",", "\"a\"", ",", "encoding", "=", "\"UTF-8\"", ")", "as", "log", ":", "\n", "            ", "log", ".", "write", "(", "\"%s\\t\"", "%", "datetime", ".", "datetime", ".", "now", "(", ")", ")", "\n", "log", ".", "write", "(", "\"step: %6d\\t\"", "%", "step", ")", "\n", "log", ".", "write", "(", "\"loss-task1: %.2f\\t\"", "%", "loss_task1", ")", "\n", "log", ".", "write", "(", "\"loss-task2: %.2f\\t\"", "%", "loss_task2", ")", "\n", "log", ".", "write", "(", "\"bleu-task1: %3.2f\\t\"", "%", "bleu_task1", ")", "\n", "log", ".", "write", "(", "\"bleu-task2: %3.2f\\t\"", "%", "bleu_task2", ")", "\n", "log", ".", "write", "(", "\"rouge1-task1: %3.2f\\t\"", "%", "rouge1_task1", ")", "\n", "log", ".", "write", "(", "\"rouge1-task2: %3.2f\\t\"", "%", "rouge1_task2", ")", "\n", "log", ".", "write", "(", "\"rouge2-task1: %3.2f\\t\"", "%", "rouge2_task1", ")", "\n", "log", ".", "write", "(", "\"rouge2-task2: %3.2f\\t\"", "%", "rouge2_task2", ")", "\n", "log", ".", "write", "(", "\"\\n\"", ")", "\n", "\n", "", "if", "0", "<", "self", ".", "max_to_keep", "<", "len", "(", "self", ".", "ckpt_names", ")", ":", "\n", "            ", "earliest_ckpt", "=", "self", ".", "ckpt_names", ".", "pop", "(", "0", ")", "\n", "os", ".", "remove", "(", "earliest_ckpt", ")", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.create_ngrams": [[12, 17], ["collections.Counter", "tuple", "range", "len"], "function", ["None"], ["\n", "", "def", "rouge_n", "(", "evaluated_sentences", ",", "reference_sentences", ",", "n", "=", "2", ")", ":", "#\u9ed8\u8ba4rouge_2", "\n", "    ", "if", "len", "(", "evaluated_sentences", ")", "<=", "0", "or", "len", "(", "reference_sentences", ")", "<=", "0", ":", "\n", "        ", "return", "0", "\n", "\n", "", "evaluated_ngrams", "=", "get_ngrams", "(", "n", ",", "evaluated_sentences", ")", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.score_ngrams": [[20, 32], ["six.iterkeys", "sum", "sum", "min", "target_ngrams.values", "prediction_ngrams.values", "max", "max"], "function", ["None"], ["if", "reference_ngrams_count", "==", "0", ":", "\n", "        ", "return", "0", "\n", "\n", "", "overlapping_ngrams", "=", "evaluated_ngrams", ".", "intersection", "(", "reference_ngrams", ")", "\n", "overlapping_ngrams_count", "=", "len", "(", "overlapping_ngrams", ")", "\n", "return", "overlapping_ngrams_count", "/", "reference_ngrams_count", "\n", "\n", "\n", "", "def", "rouge_1", "(", "evaluated_sentences", ",", "reference_sentences", ")", ":", "\n", "    ", "evaluated_sentences", "=", "evaluated_sentences", ".", "split", "(", ")", "\n", "reference_sentences", "=", "reference_sentences", ".", "split", "(", ")", "\n", "return", "rouge_n", "(", "evaluated_sentences", ",", "reference_sentences", ",", "n", "=", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.my_lcs": [[85, 99], ["range", "len", "len", "range", "range", "len", "len", "range", "len", "max", "len", "len", "len"], "function", ["None"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.calc_rouge_L": [[99, 122], ["rouge.my_lcs", "float", "float", "len", "len", "float"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.rouge.my_lcs"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.embeddings.Embedding.__init__": [[19, 30], ["embeddings.positional_encoding", "torch.Module.__init__", "torch.Embedding", "torch.Embedding", "embeddings.Embedding.register_buffer", "torch.Dropout", "torch.Dropout", "embeddings.Embedding.reset_parameters"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.embeddings.positional_encoding", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.__init__", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.MultiHeadedAttention.reset_parameters"], ["    ", "def", "__init__", "(", "self", ",", "embedding_dim", ",", "vocab_size", ",", "padding_idx", ",", "dropout", ")", ":", "\n", "        ", "self", ".", "word_padding_idx", "=", "padding_idx", "\n", "self", ".", "embedding_dim", "=", "embedding_dim", "\n", "pe", "=", "positional_encoding", "(", "embedding_dim", ")", "\n", "super", "(", "Embedding", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "embedding", "=", "nn", ".", "Embedding", "(", "vocab_size", ",", "embedding_dim", ",", "padding_idx", "=", "padding_idx", ")", "\n", "self", ".", "register_buffer", "(", "'pe'", ",", "pe", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "p", "=", "dropout", ")", "\n", "\n", "self", ".", "reset_parameters", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.embeddings.Embedding.reset_parameters": [[31, 33], ["torch.init.normal_", "torch.init.normal_"], "methods", ["None"], ["", "def", "reset_parameters", "(", "self", ")", ":", "\n", "        ", "nn", ".", "init", ".", "normal_", "(", "self", ".", "embedding", ".", "weight", ",", "mean", "=", "0.0", ",", "std", "=", "self", ".", "embedding_dim", "**", "-", "0.5", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.embeddings.Embedding.padding_idx": [[34, 37], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "padding_idx", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "word_padding_idx", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.embeddings.Embedding.forward": [[38, 41], ["embeddings.Embedding.dropout", "embeddings.Embedding.embedding", "math.sqrt", "x.size"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "timestep", "=", "0", ")", ":", "\n", "        ", "embedding", "=", "self", ".", "embedding", "(", "x", ")", "*", "math", ".", "sqrt", "(", "self", ".", "embedding_dim", ")", "+", "self", ".", "pe", "[", "timestep", ":", "timestep", "+", "x", ".", "size", "(", "1", ")", "]", "\n", "return", "self", ".", "dropout", "(", "embedding", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.embeddings.positional_encoding": [[9, 16], ["torch.zeros", "torch.zeros", "torch.arange().unsqueeze", "torch.arange().unsqueeze", "torch.exp", "torch.exp", "torch.sin", "torch.sin", "torch.cos", "torch.cos", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange().unsqueeze.float", "torch.arange().unsqueeze.float", "math.log"], "function", ["None"], ["def", "positional_encoding", "(", "dim", ",", "max_len", "=", "5000", ")", ":", "\n", "    ", "pe", "=", "torch", ".", "zeros", "(", "max_len", ",", "dim", ")", "\n", "position", "=", "torch", ".", "arange", "(", "0", ",", "max_len", ")", ".", "unsqueeze", "(", "1", ")", "\n", "div_term", "=", "torch", ".", "exp", "(", "(", "torch", ".", "arange", "(", "0", ",", "dim", ",", "2", ",", "dtype", "=", "torch", ".", "float", ")", "*", "-", "(", "math", ".", "log", "(", "10000.0", ")", "/", "dim", ")", ")", ")", "\n", "pe", "[", ":", ",", "0", ":", ":", "2", "]", "=", "torch", ".", "sin", "(", "position", ".", "float", "(", ")", "*", "div_term", ")", "\n", "pe", "[", ":", ",", "1", ":", ":", "2", "]", "=", "torch", ".", "cos", "(", "position", ".", "float", "(", ")", "*", "div_term", ")", "\n", "return", "pe", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.nmt_model.Extractor.__init__": [[11, 19], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.ReLU", "torch.ReLU", "torch.Linear", "torch.Linear", "torch.LogSigmoid", "torch.LogSigmoid", "nmt_model.Extractor.reset_parameters"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.__init__", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.MultiHeadedAttention.reset_parameters"], ["    ", "def", "__init__", "(", "self", ",", "hidden_size", ":", "int", ")", ":", "\n", "        ", "super", "(", "Extractor", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "linear_hidden1", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "hidden_size", ")", "\n", "self", ".", "act1", "=", "nn", ".", "ReLU", "(", ")", "\n", "self", ".", "linear_hidden2", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "1", ")", "\n", "self", ".", "act2", "=", "nn", ".", "LogSigmoid", "(", ")", "\n", "self", ".", "hidden_size", "=", "hidden_size", "\n", "self", ".", "reset_parameters", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.nmt_model.Extractor.reset_parameters": [[20, 23], ["torch.init.xavier_uniform_", "torch.init.xavier_uniform_", "torch.init.xavier_uniform_", "torch.init.xavier_uniform_"], "methods", ["None"], ["", "def", "reset_parameters", "(", "self", ")", ":", "\n", "        ", "nn", ".", "init", ".", "xavier_uniform_", "(", "self", ".", "linear_hidden1", ".", "weight", ")", "\n", "nn", ".", "init", ".", "xavier_uniform_", "(", "self", ".", "linear_hidden2", ".", "weight", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.nmt_model.Extractor.forward": [[24, 30], ["nmt_model.Extractor.linear_hidden1", "nmt_model.Extractor.act1", "nmt_model.Extractor.linear_hidden2", "nmt_model.Extractor.act2"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "x", "=", "self", ".", "linear_hidden1", "(", "x", ")", "\n", "x", "=", "self", ".", "act1", "(", "x", ")", "\n", "x", "=", "self", ".", "linear_hidden2", "(", "x", ")", "\n", "x", "=", "self", ".", "act2", "(", "x", ")", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.nmt_model.Generator.__init__": [[12, 19], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.LogSoftmax", "torch.LogSoftmax", "nmt_model.Generator.reset_parameters"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.__init__", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.MultiHeadedAttention.reset_parameters"], ["        ", "super", "(", "Extractor", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "linear_hidden1", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "hidden_size", ")", "\n", "self", ".", "act1", "=", "nn", ".", "ReLU", "(", ")", "\n", "self", ".", "linear_hidden2", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "1", ")", "\n", "self", ".", "act2", "=", "nn", ".", "LogSigmoid", "(", ")", "\n", "self", ".", "hidden_size", "=", "hidden_size", "\n", "self", ".", "reset_parameters", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.nmt_model.Generator.reset_parameters": [[20, 22], ["torch.init.xavier_uniform_", "torch.init.xavier_uniform_"], "methods", ["None"], ["", "def", "reset_parameters", "(", "self", ")", ":", "\n", "        ", "nn", ".", "init", ".", "xavier_uniform_", "(", "self", ".", "linear_hidden1", ".", "weight", ")", "\n", "nn", ".", "init", ".", "xavier_uniform_", "(", "self", ".", "linear_hidden2", ".", "weight", ")", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.nmt_model.Generator.forward": [[23, 27], ["nmt_model.Generator.linear_hidden", "nmt_model.Generator.lsm"], "methods", ["None"], ["\n", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "x", "=", "self", ".", "linear_hidden1", "(", "x", ")", "\n", "x", "=", "self", ".", "act1", "(", "x", ")", "\n", "x", "=", "self", ".", "linear_hidden2", "(", "x", ")", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.nmt_model.NMTModel.__init__": [[31, 43], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.__init__"], ["", "", "class", "Generator", "(", "nn", ".", "Module", ")", ":", "\n", "    ", "def", "__init__", "(", "self", ",", "hidden_size", ":", "int", ",", "tgt_vocab_size", ":", "int", ")", ":", "\n", "        ", "self", ".", "vocab_size", "=", "tgt_vocab_size", "\n", "super", "(", "Generator", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "linear_hidden", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "tgt_vocab_size", ")", "\n", "self", ".", "lsm", "=", "nn", ".", "LogSoftmax", "(", "dim", "=", "-", "1", ")", "\n", "\n", "self", ".", "reset_parameters", "(", ")", "\n", "\n", "", "def", "reset_parameters", "(", "self", ")", ":", "\n", "        ", "nn", ".", "init", ".", "xavier_uniform_", "(", "self", ".", "linear_hidden", ".", "weight", ")", "\n", "\n", "", "def", "forward", "(", "self", ",", "dec_out", ")", ":", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.nmt_model.NMTModel.forward": [[44, 56], ["source.eq", "target.eq", "nmt_model.NMTModel.encoder", "nmt_model.NMTModel.task1_decoder", "nmt_model.NMTModel.task1_generator", "nmt_model.NMTModel.task2_decoder", "nmt_model.NMTModel.task2_generator"], "methods", ["None"], ["        ", "score", "=", "self", ".", "linear_hidden", "(", "dec_out", ")", "\n", "lsm_score", "=", "self", ".", "lsm", "(", "score", ")", "\n", "return", "lsm_score", "\n", "\n", "\n", "", "", "class", "NMTModel", "(", "nn", ".", "Module", ")", ":", "\n", "\n", "    ", "def", "__init__", "(", "self", ",", "encoder", ":", "Encoder", ",", "\n", "task1_decoder", ":", "Decoder", ",", "\n", "task2_decoder", ":", "Decoder", ",", "\n", "task1_generator", ":", "Generator", ",", "\n", "task2_generator", ":", "Generator", ",", "\n", "task1_extractor", ":", "Extractor", ",", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.nmt_model.NMTModel.load_model": [[57, 123], ["beaver.model.embeddings.Embedding", "beaver.model.embeddings.Embedding", "beaver.model.transformer.Encoder", "beaver.model.transformer.Decoder", "beaver.model.transformer.Decoder", "nmt_model.Generator", "nmt_model.Generator", "cls", "torch.load", "torch.load", "torch.load", "torch.load", "cls.state_dict", "cls.state_dict.update", "cls.load_state_dict", "cls.load_state_dict", "cls.load_state_dict", "cls.state_dict", "cls.state_dict.update", "cls.load_state_dict"], "methods", ["None"], ["task2_extractor", ":", "Extractor", ",", "\n", "cls_id1", "=", "None", ",", "\n", "cls_id2", "=", "None", ")", ":", "\n", "        ", "super", "(", "NMTModel", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "encoder", "=", "encoder", "\n", "self", ".", "task1_decoder", "=", "task1_decoder", "\n", "self", ".", "task2_decoder", "=", "task2_decoder", "\n", "self", ".", "task1_generator", "=", "task1_generator", "\n", "self", ".", "task2_generator", "=", "task2_generator", "\n", "self", ".", "task1_extractor", "=", "task1_extractor", "\n", "self", ".", "task2_extractor", "=", "task2_extractor", "\n", "self", ".", "cls_id1", "=", "cls_id1", "\n", "self", ".", "cls_id2", "=", "cls_id2", "\n", "\n", "", "def", "forward", "(", "self", ",", "source", ",", "target", ",", "flag", ",", "pos", "=", "None", ")", ":", "\n", "        ", "target", "=", "target", "[", ":", ",", ":", "-", "1", "]", "# shift left", "\n", "source_pad", "=", "source", ".", "eq", "(", "self", ".", "encoder", ".", "embedding", ".", "word_padding_idx", ")", "\n", "target_pad", "=", "target", ".", "eq", "(", "self", ".", "task1_decoder", ".", "embedding", ".", "word_padding_idx", ")", "\n", "enc_out", "=", "self", ".", "encoder", "(", "source", ",", "source_pad", ")", "\n", "\n", "if", "flag", ":", "# task1", "\n", "            ", "decoder_outputs", ",", "_", "=", "self", ".", "task1_decoder", "(", "target", ",", "enc_out", ",", "source_pad", ",", "target_pad", ")", "\n", "scores", "=", "self", ".", "task1_generator", "(", "decoder_outputs", ")", "\n", "if", "pos", "is", "not", "None", ":", "\n", "              ", "ext_in", "=", "enc_out", ".", "view", "(", "-", "1", ",", "enc_out", ".", "size", "(", "-", "1", ")", ")", "\n", "ext_scores", "=", "self", ".", "task1_extractor", "(", "ext_in", ")", "\n", "return", "scores", ",", "ext_scores", "\n", "", "", "else", ":", "# task2", "\n", "            ", "decoder_outputs", ",", "_", "=", "self", ".", "task2_decoder", "(", "target", ",", "enc_out", ",", "source_pad", ",", "target_pad", ")", "\n", "scores", "=", "self", ".", "task2_generator", "(", "decoder_outputs", ")", "\n", "if", "pos", "is", "not", "None", ":", "\n", "              ", "ext_in", "=", "enc_out", ".", "view", "(", "-", "1", ",", "enc_out", ".", "size", "(", "-", "1", ")", ")", "\n", "ext_scores", "=", "self", ".", "task1_extractor", "(", "ext_in", ")", "\n", "return", "scores", ",", "ext_scores", "\n", "\n", "", "", "return", "scores", "\n", "\n", "", "@", "classmethod", "\n", "def", "load_model", "(", "cls", ",", "model_opt", ",", "\n", "pad_ids", ":", "Dict", "[", "str", ",", "int", "]", ",", "\n", "vocab_sizes", ":", "Dict", "[", "str", ",", "int", "]", ",", "\n", "checkpoint", "=", "None", ",", "\n", "cls_id1", "=", "None", ",", "\n", "cls_id2", "=", "None", ")", ":", "\n", "        ", "source_embedding", "=", "Embedding", "(", "embedding_dim", "=", "model_opt", ".", "hidden_size", ",", "\n", "dropout", "=", "model_opt", ".", "dropout", ",", "\n", "padding_idx", "=", "pad_ids", "[", "\"src\"", "]", ",", "\n", "vocab_size", "=", "vocab_sizes", "[", "\"src\"", "]", ")", "\n", "\n", "target_embedding_task2", "=", "Embedding", "(", "embedding_dim", "=", "model_opt", ".", "hidden_size", ",", "\n", "dropout", "=", "model_opt", ".", "dropout", ",", "\n", "padding_idx", "=", "pad_ids", "[", "\"task2_tgt\"", "]", ",", "\n", "vocab_size", "=", "vocab_sizes", "[", "\"task2_tgt\"", "]", ")", "\n", "if", "model_opt", ".", "mono", ":", "\n", "            ", "target_embedding_task1", "=", "source_embedding", "\n", "", "else", ":", "\n", "            ", "target_embedding_task1", "=", "target_embedding_task2", "\n", "\n", "", "encoder", "=", "Encoder", "(", "model_opt", ".", "layers", ",", "\n", "model_opt", ".", "heads", ",", "\n", "model_opt", ".", "hidden_size", ",", "\n", "model_opt", ".", "dropout", ",", "\n", "model_opt", ".", "ff_size", ",", "\n", "source_embedding", ")", "\n", "\n", "task1_decoder", "=", "Decoder", "(", "model_opt", ".", "layers", ",", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.FeedForward.__init__": [[9, 17], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.ReLU", "torch.ReLU", "torch.Dropout", "torch.Dropout", "transformer.FeedForward.reset_parameters"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.__init__", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.MultiHeadedAttention.reset_parameters"], ["    ", "def", "__init__", "(", "self", ",", "hidden_size", ",", "inner_size", ",", "dropout", ")", ":", "\n", "        ", "super", "(", "FeedForward", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "linear_in", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "inner_size", ",", "bias", "=", "False", ")", "\n", "self", ".", "linear_out", "=", "nn", ".", "Linear", "(", "inner_size", ",", "hidden_size", ",", "bias", "=", "False", ")", "\n", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "dropout", ")", "\n", "\n", "self", ".", "reset_parameters", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.FeedForward.reset_parameters": [[18, 21], ["torch.init.xavier_uniform_", "torch.init.xavier_uniform_", "torch.init.xavier_uniform_", "torch.init.xavier_uniform_"], "methods", ["None"], ["", "def", "reset_parameters", "(", "self", ")", ":", "\n", "        ", "nn", ".", "init", ".", "xavier_uniform_", "(", "self", ".", "linear_in", ".", "weight", ")", "\n", "nn", ".", "init", ".", "xavier_uniform_", "(", "self", ".", "linear_out", ".", "weight", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.FeedForward.forward": [[22, 28], ["transformer.FeedForward.linear_in", "transformer.FeedForward.relu", "transformer.FeedForward.dropout", "transformer.FeedForward.linear_out"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "y", "=", "self", ".", "linear_in", "(", "x", ")", "\n", "y", "=", "self", ".", "relu", "(", "y", ")", "\n", "y", "=", "self", ".", "dropout", "(", "y", ")", "\n", "y", "=", "self", ".", "linear_out", "(", "y", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.EncoderLayer.__init__": [[32, 39], ["torch.Module.__init__", "transformer.MultiHeadedAttention", "transformer.FeedForward", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.Dropout", "torch.Dropout", "torch.LayerNorm", "torch.LayerNorm", "range", "range"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.__init__"], ["    ", "def", "__init__", "(", "self", ",", "hidden_size", ",", "dropout", ",", "head_count", ",", "ff_size", ")", ":", "\n", "        ", "super", "(", "EncoderLayer", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "self_attn", "=", "MultiHeadedAttention", "(", "head_count", ",", "hidden_size", ",", "dropout", ")", "\n", "self", ".", "feed_forward", "=", "FeedForward", "(", "hidden_size", ",", "ff_size", ",", "dropout", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "ModuleList", "(", "[", "nn", ".", "Dropout", "(", "dropout", ")", "for", "_", "in", "range", "(", "2", ")", "]", ")", "\n", "self", ".", "norm", "=", "nn", ".", "ModuleList", "(", "[", "nn", ".", "LayerNorm", "(", "hidden_size", ")", "for", "_", "in", "range", "(", "2", ")", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.EncoderLayer.forward": [[40, 49], ["transformer.EncoderLayer.self_attn", "transformer.EncoderLayer.feed_forward"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "mask", ")", ":", "\n", "# self attention", "\n", "        ", "y", "=", "self", ".", "self_attn", "(", "self", ".", "norm", "[", "0", "]", "(", "x", ")", ",", "mask", "=", "mask", ")", "\n", "x", "=", "x", "+", "self", ".", "dropout", "[", "0", "]", "(", "y", ")", "\n", "\n", "# feed forward", "\n", "y", "=", "self", ".", "feed_forward", "(", "self", ".", "norm", "[", "1", "]", "(", "x", ")", ")", "\n", "x", "=", "x", "+", "self", ".", "dropout", "[", "1", "]", "(", "y", ")", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.Encoder.__init__": [[52, 59], ["torch.Module.__init__", "torch.ModuleList", "torch.ModuleList", "torch.LayerNorm", "torch.LayerNorm", "transformer.EncoderLayer", "range"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.__init__"], ["    ", "def", "__init__", "(", "self", ",", "num_layers", ",", "num_heads", ",", "hidden_size", ",", "dropout", ",", "ff_size", ",", "embedding", ")", ":", "\n", "        ", "self", ".", "num_layers", "=", "num_layers", "\n", "\n", "super", "(", "Encoder", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "embedding", "=", "embedding", "\n", "self", ".", "layers", "=", "nn", ".", "ModuleList", "(", "[", "EncoderLayer", "(", "hidden_size", ",", "dropout", ",", "num_heads", ",", "ff_size", ")", "for", "_", "in", "range", "(", "num_layers", ")", "]", ")", "\n", "self", ".", "norm", "=", "nn", ".", "LayerNorm", "(", "hidden_size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.Encoder.forward": [[60, 66], ["src_pad.unsqueeze", "transformer.Encoder.embedding", "range", "transformer.Encoder.norm"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "src", ",", "src_pad", ")", ":", "\n", "        ", "src_mask", "=", "src_pad", ".", "unsqueeze", "(", "1", ")", "\n", "output", "=", "self", ".", "embedding", "(", "src", ")", "\n", "for", "i", "in", "range", "(", "self", ".", "num_layers", ")", ":", "\n", "            ", "output", "=", "self", ".", "layers", "[", "i", "]", "(", "output", ",", "src_mask", ")", "\n", "", "return", "self", ".", "norm", "(", "output", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.DecoderLayer.__init__": [[70, 77], ["torch.Module.__init__", "transformer.MultiHeadedAttention", "transformer.MultiHeadedAttention", "transformer.FeedForward", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.LayerNorm", "torch.LayerNorm", "torch.Dropout", "torch.Dropout", "range", "range"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.__init__"], ["    ", "def", "__init__", "(", "self", ",", "hidden_size", ",", "dropout", ",", "head_count", ",", "ff_size", ")", ":", "\n", "        ", "super", "(", "DecoderLayer", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "self_attn", "=", "MultiHeadedAttention", "(", "head_count", ",", "hidden_size", ",", "dropout", ")", "\n", "self", ".", "src_attn", "=", "MultiHeadedAttention", "(", "head_count", ",", "hidden_size", ",", "dropout", ")", "\n", "self", ".", "feed_forward", "=", "FeedForward", "(", "hidden_size", ",", "ff_size", ",", "dropout", ")", "\n", "self", ".", "norm", "=", "nn", ".", "ModuleList", "(", "[", "nn", ".", "LayerNorm", "(", "hidden_size", ",", "eps", "=", "1e-6", ")", "for", "_", "in", "range", "(", "3", ")", "]", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "ModuleList", "(", "[", "nn", ".", "Dropout", "(", "dropout", ")", "for", "_", "in", "range", "(", "3", ")", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.DecoderLayer.forward": [[78, 93], ["transformer.DecoderLayer.self_attn", "transformer.DecoderLayer.src_attn", "transformer.DecoderLayer.feed_forward", "torch.cat", "torch.cat", "torch.cat", "torch.cat"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "enc_out", ",", "src_mask", ",", "tgt_mask", ",", "previous", "=", "None", ")", ":", "\n", "        ", "all_input", "=", "x", "if", "previous", "is", "None", "else", "torch", ".", "cat", "(", "(", "previous", ",", "x", ")", ",", "dim", "=", "1", ")", "\n", "\n", "# self attention", "\n", "y", "=", "self", ".", "self_attn", "(", "self", ".", "norm", "[", "0", "]", "(", "x", ")", ",", "self", ".", "norm", "[", "0", "]", "(", "all_input", ")", ",", "mask", "=", "tgt_mask", ")", "\n", "x", "=", "x", "+", "self", ".", "dropout", "[", "0", "]", "(", "y", ")", "\n", "\n", "# encoder decoder attention", "\n", "y", "=", "self", ".", "src_attn", "(", "self", ".", "norm", "[", "1", "]", "(", "x", ")", ",", "enc_out", ",", "mask", "=", "src_mask", ")", "\n", "x", "=", "x", "+", "self", ".", "dropout", "[", "1", "]", "(", "y", ")", "\n", "\n", "# feed forward", "\n", "y", "=", "self", ".", "feed_forward", "(", "self", ".", "norm", "[", "2", "]", "(", "x", ")", ")", "\n", "x", "=", "x", "+", "self", ".", "dropout", "[", "2", "]", "(", "y", ")", "\n", "return", "x", ",", "all_input", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.Decoder.__init__": [[97, 106], ["torch.Module.__init__", "torch.ModuleList", "torch.ModuleList", "transformer.Decoder.register_buffer", "transformer.Decoder.register_buffer", "torch.LayerNorm", "torch.LayerNorm", "torch.triu().byte", "torch.triu().byte", "torch.triu().byte", "torch.triu().byte", "torch.zeros().byte", "torch.zeros().byte", "torch.zeros().byte", "torch.zeros().byte", "transformer.DecoderLayer", "range", "torch.triu", "torch.triu", "torch.triu", "torch.triu", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.ones", "torch.ones", "torch.ones", "torch.ones"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.__init__"], ["    ", "def", "__init__", "(", "self", ",", "num_layers", ",", "num_heads", ",", "hidden_size", ",", "dropout", ",", "ff_size", ",", "embedding", ",", "share_decoder", "=", "None", ",", "num_share_layer", "=", "0", ")", ":", "\n", "        ", "self", ".", "num_layers", "=", "num_layers", "\n", "\n", "super", "(", "Decoder", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "embedding", "=", "embedding", "\n", "#self.layers = nn.ModuleList([DecoderLayer(hidden_size, dropout, num_heads, ff_size) for _ in range(num_layers)])", "\n", "self", ".", "layers", "=", "nn", ".", "ModuleList", "(", "[", "DecoderLayer", "(", "hidden_size", ",", "dropout", ",", "num_heads", ",", "ff_size", ")", "if", "share_decoder", "is", "None", "or", "i", "<", "num_share_layer", "else", "share_decoder", ".", "layers", "[", "i", "]", "for", "i", "in", "range", "(", "num_layers", ")", "]", ")", "\n", "self", ".", "register_buffer", "(", "\"upper_triangle\"", ",", "torch", ".", "triu", "(", "torch", ".", "ones", "(", "1000", ",", "1000", ")", ",", "diagonal", "=", "1", ")", ".", "byte", "(", ")", ")", "\n", "self", ".", "register_buffer", "(", "\"zero_mask\"", ",", "torch", ".", "zeros", "(", "1", ")", ".", "byte", "(", ")", ")", "\n", "self", ".", "norm", "=", "nn", ".", "LayerNorm", "(", "hidden_size", ",", "eps", "=", "1e-6", ")", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.Decoder.forward": [[107, 126], ["transformer.Decoder.embedding", "tgt.size", "src_pad.unsqueeze", "tgt_pad.unsqueeze", "torch.gt", "torch.gt", "torch.gt", "torch.gt", "range", "saved_inputs.append", "transformer.Decoder.norm", "torch.stack", "torch.stack", "torch.stack", "torch.stack"], "methods", ["None"], ["\n", "", "def", "forward", "(", "self", ",", "tgt", ",", "enc_out", ",", "src_pad", ",", "tgt_pad", ",", "previous", "=", "None", ",", "timestep", "=", "0", ")", ":", "\n", "\n", "        ", "output", "=", "self", ".", "embedding", "(", "tgt", ",", "timestep", ")", "\n", "tgt_len", "=", "tgt", ".", "size", "(", "1", ")", "\n", "\n", "src_mask", "=", "src_pad", ".", "unsqueeze", "(", "1", ")", "\n", "tgt_mask", "=", "tgt_pad", ".", "unsqueeze", "(", "1", ")", "\n", "upper_triangle", "=", "self", ".", "upper_triangle", "[", ":", "tgt_len", ",", ":", "tgt_len", "]", "\n", "\n", "# tgt mask: 0 if not upper and not pad", "\n", "tgt_mask", "=", "torch", ".", "gt", "(", "tgt_mask", "+", "upper_triangle", ",", "0", ")", "\n", "saved_inputs", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "self", ".", "num_layers", ")", ":", "\n", "            ", "prev_layer", "=", "None", "if", "previous", "is", "None", "else", "previous", "[", ":", ",", "i", "]", "\n", "tgt_mask", "=", "tgt_mask", "if", "previous", "is", "None", "else", "self", ".", "zero_mask", "\n", "\n", "output", ",", "all_input", "=", "self", ".", "layers", "[", "i", "]", "(", "output", ",", "enc_out", ",", "src_mask", ",", "tgt_mask", ",", "prev_layer", ")", "\n", "saved_inputs", ".", "append", "(", "all_input", ")", "\n", "", "return", "self", ".", "norm", "(", "output", ")", ",", "torch", ".", "stack", "(", "saved_inputs", ",", "dim", "=", "1", ")", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.MultiHeadedAttention.__init__": [[130, 145], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Softmax", "torch.Softmax", "torch.Dropout", "torch.Dropout", "torch.Linear", "torch.Linear", "transformer.MultiHeadedAttention.reset_parameters"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.__init__", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.MultiHeadedAttention.reset_parameters"], ["\n", "    ", "def", "__init__", "(", "self", ",", "head_count", ",", "model_dim", ",", "dropout", ")", ":", "\n", "        ", "self", ".", "dim_per_head", "=", "model_dim", "//", "head_count", "\n", "self", ".", "head_count", "=", "head_count", "\n", "\n", "super", "(", "MultiHeadedAttention", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "linear_q", "=", "nn", ".", "Linear", "(", "model_dim", ",", "model_dim", ",", "bias", "=", "False", ")", "\n", "self", ".", "linear_k", "=", "nn", ".", "Linear", "(", "model_dim", ",", "model_dim", ",", "bias", "=", "False", ")", "\n", "self", ".", "linear_v", "=", "nn", ".", "Linear", "(", "model_dim", ",", "model_dim", ",", "bias", "=", "False", ")", "\n", "\n", "self", ".", "softmax", "=", "nn", ".", "Softmax", "(", "dim", "=", "-", "1", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "dropout", ")", "\n", "self", ".", "final_linear", "=", "nn", ".", "Linear", "(", "model_dim", ",", "model_dim", ")", "\n", "\n", "self", ".", "reset_parameters", "(", ")", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.MultiHeadedAttention.reset_parameters": [[146, 151], ["torch.init.xavier_uniform_", "torch.init.xavier_uniform_", "torch.init.xavier_uniform_", "torch.init.xavier_uniform_", "torch.init.xavier_uniform_", "torch.init.xavier_uniform_", "torch.init.xavier_uniform_", "torch.init.xavier_uniform_"], "methods", ["None"], ["\n", "", "def", "reset_parameters", "(", "self", ")", ":", "\n", "        ", "nn", ".", "init", ".", "xavier_uniform_", "(", "self", ".", "linear_q", ".", "weight", ")", "\n", "nn", ".", "init", ".", "xavier_uniform_", "(", "self", ".", "linear_k", ".", "weight", ")", "\n", "nn", ".", "init", ".", "xavier_uniform_", "(", "self", ".", "linear_v", ".", "weight", ")", "\n", "nn", ".", "init", ".", "xavier_uniform_", "(", "self", ".", "final_linear", ".", "weight", ")", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.transformer.MultiHeadedAttention.forward": [[152, 180], ["transformer.MultiHeadedAttention.forward.split_head"], "methods", ["None"], ["\n", "", "def", "forward", "(", "self", ",", "query", ",", "memory", "=", "None", ",", "mask", "=", "None", ")", ":", "\n", "        ", "memory", "=", "query", "if", "memory", "is", "None", "else", "memory", "\n", "\n", "def", "split_head", "(", "x", ")", ":", "\n", "# B x L x D => B x h x L x d", "\n", "            ", "return", "x", ".", "view", "(", "x", ".", "size", "(", "0", ")", ",", "-", "1", ",", "self", ".", "head_count", ",", "self", ".", "dim_per_head", ")", ".", "transpose", "(", "1", ",", "2", ")", "\n", "\n", "", "def", "combine_head", "(", "x", ")", ":", "\n", "# B x h x L x d  => B x L x D", "\n", "            ", "return", "x", ".", "transpose", "(", "1", ",", "2", ")", ".", "contiguous", "(", ")", ".", "view", "(", "x", ".", "size", "(", "0", ")", ",", "-", "1", ",", "self", ".", "head_count", "*", "self", ".", "dim_per_head", ")", "\n", "\n", "# 1) Project q, k, v.", "\n", "", "q", "=", "split_head", "(", "self", ".", "linear_q", "(", "query", ")", ")", "\n", "k", "=", "split_head", "(", "self", ".", "linear_k", "(", "memory", ")", ")", "\n", "v", "=", "split_head", "(", "self", ".", "linear_v", "(", "memory", ")", ")", "\n", "\n", "# 2) Calculate and scale scores.", "\n", "q", "=", "q", "/", "math", ".", "sqrt", "(", "self", ".", "dim_per_head", ")", "\n", "scores", "=", "torch", ".", "matmul", "(", "q", ",", "k", ".", "transpose", "(", "2", ",", "3", ")", ")", "\n", "\n", "mask", "=", "mask", ".", "unsqueeze", "(", "1", ")", ".", "expand_as", "(", "scores", ")", "\n", "scores", ".", "masked_fill_", "(", "mask", ",", "-", "1e18", ")", "\n", "\n", "# 3) Apply attention dropout and compute context vectors.", "\n", "weights", "=", "self", ".", "dropout", "(", "self", ".", "softmax", "(", "scores", ")", ")", "\n", "context", "=", "combine_head", "(", "torch", ".", "matmul", "(", "weights", ",", "v", ")", ")", "\n", "\n", "return", "self", ".", "final_linear", "(", "context", ")", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.__init__": [[13, 20], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "bos", ":", "bool", ",", "eos", ":", "bool", ",", "pad", ":", "bool", ",", "unk", ":", "bool", ")", ":", "\n", "        ", "self", ".", "bos_token", "=", "BOS_TOKEN", "if", "bos", "else", "None", "\n", "self", ".", "eos_token", "=", "EOS_TOKEN", "if", "eos", "else", "None", "\n", "self", ".", "unk_token", "=", "UNK_TOKEN", "if", "unk", "else", "None", "\n", "self", ".", "pad_token", "=", "PAD_TOKEN", "if", "pad", "else", "None", "\n", "\n", "self", ".", "vocab", "=", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.load_vocab": [[21, 23], ["field.Vocab"], "methods", ["None"], ["", "def", "load_vocab", "(", "self", ",", "words", ":", "List", "[", "str", "]", ",", "specials", ":", "List", "[", "str", "]", ")", ":", "\n", "        ", "self", ".", "vocab", "=", "Vocab", "(", "words", ",", "specials", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.process": [[24, 41], ["max", "torch.tensor", "torch.tensor.long().to", "torch.tensor.append", "length.append", "len", "field.Field.encode", "torch.tensor.long", "len", "len", "len", "len"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.encode"], ["", "def", "process", "(", "self", ",", "batch", ",", "device", ",", "score_batch", "=", "None", ")", ":", "\n", "\n", "        ", "max_len", "=", "max", "(", "len", "(", "x", ")", "for", "x", "in", "batch", ")", "\n", "\n", "padded", ",", "length", "=", "[", "]", ",", "[", "]", "\n", "\n", "if", "score_batch", "is", "not", "None", ":", "\n", "          ", "for", "x", ",", "score", "in", "zip", "(", "batch", ",", "score_batch", ")", ":", "\n", "              ", "bos", "=", "[", "self", ".", "bos_token", "]", "if", "self", ".", "bos_token", "else", "[", "]", "\n", "eos", "=", "[", "self", ".", "eos_token", "]", "if", "self", ".", "eos_token", "else", "[", "]", "\n", "pad", "=", "[", "self", ".", "pad_token", "]", "*", "(", "max_len", "-", "len", "(", "x", ")", ")", "\n", "\n", "padded", ".", "append", "(", "bos", "+", "x", "+", "eos", "+", "pad", ")", "\n", "length", ".", "append", "(", "len", "(", "x", ")", "+", "len", "(", "bos", ")", "+", "len", "(", "eos", ")", ")", "\n", "\n", "", "padded", "=", "torch", ".", "tensor", "(", "[", "self", ".", "encode", "(", "ex", ")", "for", "ex", "in", "padded", "]", ")", "\n", "\n", "scores", "=", "[", "]", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.encode": [[42, 50], ["ids.append", "ids.append"], "methods", ["None"], ["for", "s", "in", "score_batch", ":", "\n", "            ", "scores", ".", "extend", "(", "s", ")", "\n", "", "score", "=", "torch", ".", "tensor", "(", "scores", ")", ".", "to", "(", "device", ")", "\n", "return", "padded", ".", "long", "(", ")", ".", "to", "(", "device", ")", ",", "score", "\n", "\n", "", "else", ":", "\n", "          ", "for", "x", "in", "batch", ":", "\n", "              ", "bos", "=", "[", "self", ".", "bos_token", "]", "if", "self", ".", "bos_token", "else", "[", "]", "\n", "eos", "=", "[", "self", ".", "eos_token", "]", "if", "self", ".", "eos_token", "else", "[", "]", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode": [[88, 98], ["tokens.append"], "methods", ["None"], ["def", "cls_id2", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "vocab", ".", "stoi", "[", "\"<cls>\"", "]", "\n", "", "@", "property", "\n", "def", "pad_id", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "vocab", ".", "stoi", "[", "self", ".", "pad_token", "]", "\n", "\n", "", "@", "property", "\n", "def", "eos_id", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "vocab", ".", "stoi", "[", "self", ".", "eos_token", "]", "\n", "\n", "", "@", "property", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.special": [[99, 102], ["None"], "methods", ["None"], ["def", "bos_id", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "vocab", ".", "stoi", "[", "self", ".", "bos_token", "]", "\n", "\n", "", "@", "property", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.cls_id1": [[84, 87], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "cls_id1", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "vocab", ".", "stoi", "[", "\"<cls>\"", "]", "\n", "", "@", "property", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.cls_id2": [[87, 90], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "cls_id2", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "vocab", ".", "stoi", "[", "\"<cls>\"", "]", "\n", "", "@", "property", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.pad_id": [[103, 106], ["None"], "methods", ["None"], ["def", "unk_id", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "vocab", ".", "stoi", "[", "self", ".", "unk_token", "]", "\n", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.eos_id": [[107, 110], ["None"], "methods", ["None"], ["", "", "class", "Vocab", "(", "object", ")", ":", "\n", "    ", "def", "__init__", "(", "self", ",", "words", ":", "List", "[", "str", "]", ",", "specials", ":", "List", "[", "str", "]", ")", ":", "\n", "        ", "self", ".", "itos", "=", "specials", "+", "words", "\n", "self", ".", "stoi", "=", "{", "tok", ":", "i", "for", "i", ",", "tok", "in", "enumerate", "(", "self", ".", "itos", ")", "}", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.bos_id": [[111, 114], ["None"], "methods", ["None"], ["\n", "", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "itos", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.unk_id": [[115, 118], ["None"], "methods", ["None"], ["", "", ""]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Vocab.__init__": [[121, 124], ["enumerate"], "methods", ["None"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Vocab.__len__": [[125, 127], ["len"], "methods", ["None"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.dataset.TranslationDataset.__init__": [[19, 48], ["dataset.TranslationDataset.sort", "len", "list", "zip", "zip", "print", "print", "dataset.batch", "len", "len", "dataset.read_file", "dataset.read_file", "examples.append", "dataset.read_file", "dataset.read_file", "examples.append", "len", "len", "Example", "ExampleVec"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.dataset.TranslationDataset.sort", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.dataset.batch", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.dataset.read_file", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.dataset.read_file", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.dataset.read_file", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.dataset.read_file"], ["    ", "def", "__init__", "(", "self", ",", "\n", "src_path", ":", "str", ",", "\n", "tgt_path", ":", "str", ",", "\n", "batch_size", ":", "int", ",", "\n", "device", ":", "torch", ".", "device", ",", "\n", "train", ":", "bool", ",", "\n", "fields", ":", "Dict", "[", "str", ",", "Field", "]", ",", "\n", "score_path", ":", "str", ")", ":", "\n", "\n", "        ", "self", ".", "batch_size", "=", "batch_size", "\n", "self", ".", "train", "=", "train", "\n", "self", ".", "device", "=", "device", "\n", "self", ".", "fields", "=", "fields", "\n", "self", ".", "sort_key", "=", "lambda", "ex", ":", "(", "len", "(", "ex", ".", "src", ")", ",", "len", "(", "ex", ".", "tgt", ")", ")", "\n", "\n", "examples", "=", "[", "]", "\n", "if", "train", ":", "\n", "          ", "for", "src_line", ",", "tgt_line", ",", "score_line", "in", "zip", "(", "read_file", "(", "src_path", ")", ",", "read_file", "(", "tgt_path", ")", ",", "read_file", "(", "score_path", ")", ")", ":", "\n", "              ", "examples", ".", "append", "(", "TrainExample", "(", "src_line", ",", "tgt_line", ",", "[", "float", "(", "s", ")", "for", "s", "in", "score_line", "]", ")", ")", "\n", "", "", "else", ":", "\n", "          ", "for", "src_line", ",", "tgt_line", "in", "zip", "(", "read_file", "(", "src_path", ")", ",", "read_file", "(", "tgt_path", ")", ")", ":", "\n", "              ", "examples", ".", "append", "(", "Example", "(", "src_line", ",", "tgt_line", ")", ")", "\n", "", "", "examples", ",", "self", ".", "seed", "=", "self", ".", "sort", "(", "examples", ")", "\n", "\n", "self", ".", "num_examples", "=", "len", "(", "examples", ")", "\n", "self", ".", "batches", "=", "list", "(", "batch", "(", "examples", ",", "self", ".", "batch_size", ")", ")", "\n", "\n", "", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "while", "True", ":", "\n", "            ", "if", "self", ".", "train", ":", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.dataset.TranslationDataset.__iter__": [[49, 63], ["random.shuffle", "dataset.TranslationDataset.fields[].process", "dataset.TranslationDataset.fields[].process", "torch.Tensor().to", "BatchVec", "Batch", "torch.Tensor", "len", "len"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.process", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.process"], ["                ", "random", ".", "shuffle", "(", "self", ".", "batches", ")", "\n", "for", "minibatch", "in", "self", ".", "batches", ":", "\n", "                    ", "src", ",", "score", "=", "self", ".", "fields", "[", "\"src\"", "]", ".", "process", "(", "[", "x", ".", "src", "for", "x", "in", "minibatch", "]", ",", "self", ".", "device", ",", "[", "x", ".", "score", "for", "x", "in", "minibatch", "]", ")", "\n", "tgt", "=", "self", ".", "fields", "[", "\"tgt\"", "]", ".", "process", "(", "[", "x", ".", "tgt", "for", "x", "in", "minibatch", "]", ",", "self", ".", "device", ")", "\n", "yield", "TrainBatch", "(", "src", "=", "src", ",", "tgt", "=", "tgt", ",", "batch_size", "=", "len", "(", "minibatch", ")", ",", "score", "=", "score", ")", "\n", "", "", "else", ":", "\n", "                ", "for", "minibatch", "in", "self", ".", "batches", ":", "\n", "                    ", "src", "=", "self", ".", "fields", "[", "\"src\"", "]", ".", "process", "(", "[", "x", ".", "src", "for", "x", "in", "minibatch", "]", ",", "self", ".", "device", ")", "\n", "tgt", "=", "self", ".", "fields", "[", "\"tgt\"", "]", ".", "process", "(", "[", "x", ".", "tgt", "for", "x", "in", "minibatch", "]", ",", "self", ".", "device", ")", "\n", "yield", "Batch", "(", "src", "=", "src", ",", "tgt", "=", "tgt", ",", "batch_size", "=", "len", "(", "minibatch", ")", ")", "\n", "\n", "", "", "if", "not", "self", ".", "train", ":", "\n", "                ", "break", "\n", "\n", "", "", "", "def", "sort", "(", "self", ",", "examples", ")", ":", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.dataset.TranslationDataset.sort": [[64, 67], ["sorted", "range", "sorted", "len", "dataset.TranslationDataset.sort_key"], "methods", ["None"], ["        ", "seed", "=", "sorted", "(", "range", "(", "len", "(", "examples", ")", ")", ",", "key", "=", "lambda", "idx", ":", "self", ".", "sort_key", "(", "examples", "[", "idx", "]", ")", ")", "\n", "return", "sorted", "(", "examples", ",", "key", "=", "self", ".", "sort_key", ")", ",", "seed", "\n", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.dataset.read_file": [[69, 73], ["open", "line.strip().split", "line.strip"], "function", ["None"], ["    ", "with", "open", "(", "path", ",", "encoding", "=", "\"utf-8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "yield", "line", ".", "strip", "(", ")", ".", "split", "(", ")", "\n", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.dataset.batch": [[75, 85], ["minibatch.append", "max", "len", "len", "len", "max", "len", "len"], "function", ["None"], ["    ", "minibatch", ",", "cur_len", "=", "[", "]", ",", "0", "\n", "for", "ex", "in", "data", ":", "\n", "        ", "minibatch", ".", "append", "(", "ex", ")", "\n", "cur_len", "=", "max", "(", "cur_len", ",", "len", "(", "ex", ".", "src", ")", ",", "len", "(", "ex", ".", "tgt", ")", ")", "\n", "if", "cur_len", "*", "len", "(", "minibatch", ")", ">", "batch_size", ":", "\n", "            ", "yield", "minibatch", "[", ":", "-", "1", "]", "\n", "minibatch", ",", "cur_len", "=", "[", "ex", "]", ",", "max", "(", "len", "(", "ex", ".", "src", ")", ",", "len", "(", "ex", ".", "tgt", ")", ")", "\n", "", "", "if", "minibatch", ":", "\n", "        ", "yield", "minibatch", "\n", "\n", "", "", ""]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.utils.build_dataset": [[8, 50], ["beaver.data.field.Field", "beaver.data.field.Field", "beaver.data.field.Field", "beaver.data.field.Field.load_vocab", "beaver.data.field.Field.load_vocab", "beaver.data.dataset.TranslationDataset", "beaver.data.dataset.TranslationDataset", "beaver.data.dataset_wrapper.Dataset", "open", "open", "sorted", "beaver.data.field.Field.load_vocab", "beaver.data.field.Field.load_vocab", "open", "pickle.load", "line.strip", "line.strip", "set"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.load_vocab", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.load_vocab", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.load_vocab", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.load_vocab"], ["def", "build_dataset", "(", "opt", ",", "data_path", ",", "vocab_path", ",", "device", ",", "train", "=", "True", ")", ":", "\n", "    ", "task1_source_path", "=", "data_path", "[", "0", "]", "\n", "task1_target_path", "=", "data_path", "[", "1", "]", "\n", "task2_source_path", "=", "data_path", "[", "2", "]", "\n", "task2_target_path", "=", "data_path", "[", "3", "]", "\n", "\n", "if", "train", ":", "\n", "      ", "score_path1", ",", "score_path2", "=", "opt", ".", "score_file1", ",", "opt", ".", "score_file2", "\n", "", "else", ":", "\n", "      ", "score_path1", "=", "score_path2", "=", "None", "\n", "\n", "", "source_field", "=", "Field", "(", "unk", "=", "True", ",", "pad", "=", "True", ",", "bos", "=", "False", ",", "eos", "=", "False", ")", "\n", "translation_target_field", "=", "Field", "(", "unk", "=", "True", ",", "pad", "=", "True", ",", "bos", "=", "True", ",", "eos", "=", "True", ")", "\n", "summary_target_field", "=", "Field", "(", "unk", "=", "True", ",", "pad", "=", "True", ",", "bos", "=", "True", ",", "eos", "=", "True", ")", "\n", "\n", "source_vocab", ",", "target_vocab", "=", "vocab_path", "\n", "source_special", "=", "source_field", ".", "special", "\n", "translation_target_special", "=", "translation_target_field", ".", "special", "\n", "summary_target_special", "=", "summary_target_field", ".", "special", "\n", "\n", "with", "open", "(", "source_vocab", ",", "encoding", "=", "\"UTF-8\"", ")", "as", "f", ":", "\n", "        ", "source_words", "=", "[", "line", ".", "strip", "(", ")", "for", "line", "in", "f", "]", "\n", "", "with", "open", "(", "target_vocab", ",", "encoding", "=", "\"UTF-8\"", ")", "as", "f", ":", "\n", "        ", "target_words", "=", "[", "line", ".", "strip", "(", ")", "for", "line", "in", "f", "]", "\n", "\n", "", "if", "opt", ".", "mono", ":", "\n", "# source\u548c\u6458\u8981target\u5171\u4eab\u8bcd\u8868", "\n", "        ", "source_special", "=", "summary_target_special", "=", "sorted", "(", "set", "(", "source_special", "+", "summary_target_special", ")", ")", "\n", "\n", "", "source_field", ".", "load_vocab", "(", "source_words", ",", "source_special", ")", "\n", "translation_target_field", ".", "load_vocab", "(", "target_words", ",", "translation_target_special", ")", "\n", "\n", "if", "opt", ".", "mono", ":", "\n", "        ", "summary_target_field", ".", "load_vocab", "(", "source_words", ",", "summary_target_special", ")", "\n", "", "else", ":", "\n", "        ", "summary_target_field", ".", "load_vocab", "(", "target_words", ",", "summary_target_special", ")", "\n", "\n", "", "data1", "=", "TranslationDataset", "(", "task1_source_path", ",", "task1_target_path", ",", "opt", ".", "batch_size", ",", "device", ",", "train", ",", "\n", "{", "'src'", ":", "source_field", ",", "'tgt'", ":", "summary_target_field", "}", ",", "score_path1", ")", "\n", "\n", "data2", "=", "TranslationDataset", "(", "task2_source_path", ",", "task2_target_path", ",", "opt", ".", "batch_size", ",", "device", ",", "train", ",", "\n", "{", "'src'", ":", "source_field", ",", "'tgt'", ":", "translation_target_field", "}", ",", "score_path2", ")", "\n", "return", "Dataset", "(", "data1", ",", "data2", ")", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.dataset_wrapper.Dataset.__init__": [[8, 16], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "task1_dataset", ":", "TranslationDataset", ",", "task2_dataset", ":", "TranslationDataset", ")", ":", "\n", "        ", "self", ".", "task1_dataset", "=", "task1_dataset", "\n", "self", ".", "task2_dataset", "=", "task2_dataset", "\n", "\n", "self", ".", "fields", "=", "{", "\n", "\"src\"", ":", "task2_dataset", ".", "fields", "[", "\"src\"", "]", ",", "\n", "\"task1_tgt\"", ":", "task1_dataset", ".", "fields", "[", "\"tgt\"", "]", ",", "\n", "\"task2_tgt\"", ":", "task2_dataset", ".", "fields", "[", "\"tgt\"", "]", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.dataset_wrapper.Dataset.__iter__": [[18, 24], ["itertools.zip_longest"], "methods", ["None"], ["", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "for", "batch1", ",", "batch2", "in", "itertools", ".", "zip_longest", "(", "self", ".", "task1_dataset", ",", "self", ".", "task2_dataset", ")", ":", "\n", "            ", "if", "batch1", "is", "not", "None", ":", "\n", "                ", "yield", "batch1", ",", "True", "\n", "", "if", "batch2", "is", "not", "None", ":", "\n", "                ", "yield", "batch2", ",", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode_word": [[51, 68], ["ori_tokens.append", "tokens.append", "tokens.append", "str", "tok_id.cpu().numpy", "tok_id.cpu"], "methods", ["None"], ["pad", "=", "[", "self", ".", "pad_token", "]", "*", "(", "max_len", "-", "len", "(", "x", ")", ")", "\n", "\n", "padded", ".", "append", "(", "bos", "+", "x", "+", "eos", "+", "pad", ")", "\n", "length", ".", "append", "(", "len", "(", "x", ")", "+", "len", "(", "bos", ")", "+", "len", "(", "eos", ")", ")", "\n", "\n", "", "padded", "=", "torch", ".", "tensor", "(", "[", "self", ".", "encode", "(", "ex", ")", "for", "ex", "in", "padded", "]", ")", "\n", "\n", "return", "padded", ".", "long", "(", ")", ".", "to", "(", "device", ")", "\n", "\n", "", "", "def", "encode", "(", "self", ",", "tokens", ")", ":", "\n", "        ", "ids", "=", "[", "]", "\n", "for", "tok", "in", "tokens", ":", "\n", "            ", "if", "tok", "in", "self", ".", "vocab", ".", "stoi", ":", "\n", "                ", "ids", ".", "append", "(", "self", ".", "vocab", ".", "stoi", "[", "tok", "]", ")", "\n", "", "else", ":", "\n", "                ", "ids", ".", "append", "(", "self", ".", "unk_id", ")", "\n", "", "", "return", "ids", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode_ori": [[69, 86], ["ori_tokens.append", "tokens.append", "tokens.append", "str", "tok_id.cpu().numpy", "tok_id.cpu"], "methods", ["None"], ["", "def", "decode", "(", "self", ",", "ids", ")", ":", "\n", "        ", "tokens", "=", "[", "]", "\n", "for", "tok", "in", "ids", ":", "\n", "            ", "tok", "=", "self", ".", "vocab", ".", "itos", "[", "tok", "]", "\n", "if", "tok", "==", "self", ".", "eos_token", ":", "\n", "                ", "break", "\n", "", "if", "tok", "==", "self", ".", "bos_token", ":", "\n", "                ", "continue", "\n", "", "tokens", ".", "append", "(", "tok", ")", "\n", "", "return", "\" \"", ".", "join", "(", "tokens", ")", ".", "replace", "(", "\"@@ \"", ",", "\"\"", ")", ".", "replace", "(", "\"@@\"", ",", "\"\"", ")", "\n", "\n", "", "@", "property", "\n", "def", "special", "(", "self", ")", ":", "\n", "        ", "return", "[", "tok", "for", "tok", "in", "[", "self", ".", "unk_token", ",", "self", ".", "pad_token", ",", "self", ".", "bos_token", ",", "self", ".", "eos_token", "]", "if", "tok", "is", "not", "None", "]", "\n", "\n", "", "@", "property", "\n", "def", "cls_id1", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "vocab", ".", "stoi", "[", "\"<cls>\"", "]", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.translator.beam_search": [[8, 65], ["src.repeat().view.size", "src.repeat().view.repeat().view", "src.repeat().view.eq", "encoder", "range", "beaver.infer.beam.Beam", "all", "torch.cat().unsqueeze", "torch.cat().unsqueeze.eq", "decoder", "torch.stack().unsqueeze", "generator().view", "enumerate", "torch.index_select", "range", "src.repeat().view.repeat", "b.advance", "torch.cat", "torch.stack", "generator", "indexes.view", "indexes.view", "torch.arange"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.beam.Greedy.advance"], ["def", "beam_search", "(", "opt", ",", "model", ",", "src", ",", "fields", ",", "flag", ")", ":", "\n", "    ", "batch_size", "=", "src", ".", "size", "(", "0", ")", "\n", "beam_size", "=", "opt", ".", "beam_size", "\n", "device", "=", "src", ".", "device", "\n", "\n", "encoder", "=", "model", ".", "encoder", "\n", "\n", "if", "flag", ":", "\n", "        ", "decoder", "=", "model", ".", "task1_decoder", "\n", "generator", "=", "model", ".", "task1_generator", "\n", "tgt_field", "=", "fields", "[", "\"task1_tgt\"", "]", "\n", "num_words", "=", "model", ".", "task1_generator", ".", "vocab_size", "\n", "", "else", ":", "\n", "        ", "decoder", "=", "model", ".", "task2_decoder", "\n", "generator", "=", "model", ".", "task2_generator", "\n", "tgt_field", "=", "fields", "[", "\"task2_tgt\"", "]", "\n", "num_words", "=", "model", ".", "task2_generator", ".", "vocab_size", "\n", "\n", "", "beams", "=", "[", "Beam", "(", "opt", ".", "beam_size", ",", "tgt_field", ".", "pad_id", ",", "tgt_field", ".", "bos_id", ",", "tgt_field", ".", "eos_id", ",", "\n", "device", ",", "opt", ".", "length_penalty", ")", "for", "_", "in", "range", "(", "batch_size", ")", "]", "\n", "\n", "src", "=", "src", ".", "repeat", "(", "1", ",", "beam_size", ")", ".", "view", "(", "batch_size", "*", "beam_size", ",", "-", "1", ")", "\n", "src_pad", "=", "src", ".", "eq", "(", "fields", "[", "\"src\"", "]", ".", "pad_id", ")", "\n", "src_out", "=", "encoder", "(", "src", ",", "src_pad", ")", "\n", "\n", "beam_expander", "=", "(", "torch", ".", "arange", "(", "batch_size", ")", "*", "beam_size", ")", ".", "view", "(", "-", "1", ",", "1", ")", ".", "to", "(", "device", ")", "\n", "\n", "previous", "=", "None", "\n", "\n", "for", "i", "in", "range", "(", "opt", ".", "max_length", ")", ":", "\n", "        ", "if", "all", "(", "(", "b", ".", "done", "for", "b", "in", "beams", ")", ")", ":", "\n", "            ", "break", "\n", "\n", "# [batch_size x beam_size, 1]", "\n", "", "current_token", "=", "torch", ".", "cat", "(", "[", "b", ".", "current_state", "for", "b", "in", "beams", "]", ")", ".", "unsqueeze", "(", "-", "1", ")", "\n", "tgt_pad", "=", "current_token", ".", "eq", "(", "tgt_field", ".", "pad_id", ")", "\n", "out", ",", "previous", "=", "decoder", "(", "current_token", ",", "src_out", ",", "src_pad", ",", "tgt_pad", ",", "previous", ",", "i", ")", "\n", "previous_score", "=", "torch", ".", "stack", "(", "[", "b", ".", "scores", "for", "b", "in", "beams", "]", ")", ".", "unsqueeze", "(", "-", "1", ")", "\n", "out", "=", "generator", "(", "out", ")", ".", "view", "(", "batch_size", ",", "beam_size", ",", "-", "1", ")", "\n", "\n", "if", "i", "<", "opt", ".", "min_length", ":", "\n", "            ", "out", "[", ":", ",", ":", ",", "tgt_field", ".", "eos_id", "]", "=", "-", "1e15", "\n", "\n", "# find topk candidates", "\n", "", "scores", ",", "indexes", "=", "(", "out", "+", "previous_score", ")", ".", "view", "(", "batch_size", ",", "-", "1", ")", ".", "topk", "(", "beam_size", ")", "\n", "\n", "# find origins and token", "\n", "origins", "=", "(", "indexes", ".", "view", "(", "-", "1", ")", "//", "num_words", ")", ".", "view", "(", "batch_size", ",", "beam_size", ")", "\n", "tokens", "=", "(", "indexes", ".", "view", "(", "-", "1", ")", "%", "num_words", ")", ".", "view", "(", "batch_size", ",", "beam_size", ")", "\n", "\n", "for", "j", ",", "b", "in", "enumerate", "(", "beams", ")", ":", "\n", "            ", "b", ".", "advance", "(", "scores", "[", "j", "]", ",", "origins", "[", "j", "]", ",", "tokens", "[", "j", "]", ")", "\n", "\n", "", "origins", "=", "(", "origins", "+", "beam_expander", ")", ".", "view", "(", "-", "1", ")", "\n", "previous", "=", "torch", ".", "index_select", "(", "previous", ",", "0", ",", "origins", ")", "\n", "\n", "", "return", "[", "b", ".", "best_hypothesis", "for", "b", "in", "beams", "]", "\n", "", ""]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.beam.Beam.__init__": [[7, 19], ["torch.full().float().to", "torch.full().long().to", "torch.full().float", "torch.full().long", "torch.full", "torch.full"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "beam_size", ",", "pad", ",", "bos", ",", "eos", ",", "device", ",", "lp", ")", ":", "\n", "\n", "        ", "self", ".", "size", "=", "beam_size", "\n", "self", ".", "alpha", "=", "lp", "\n", "\n", "self", ".", "scores", "=", "torch", ".", "full", "(", "[", "beam_size", "]", ",", "-", "1e20", ")", ".", "float", "(", ")", ".", "to", "(", "device", ")", "\n", "self", ".", "scores", "[", "0", "]", "=", "0.", "\n", "\n", "self", ".", "hypotheses", "=", "torch", ".", "full", "(", "[", "1", ",", "beam_size", "]", ",", "fill_value", "=", "pad", ")", ".", "long", "(", ")", ".", "to", "(", "device", ")", "\n", "self", ".", "hypotheses", "[", "0", "]", "[", "0", "]", "=", "bos", "\n", "self", ".", "eos", "=", "eos", "\n", "self", ".", "finished", "=", "[", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.beam.Beam.current_state": [[20, 23], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "current_state", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "hypotheses", "[", "-", "1", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.beam.Beam.advance": [[24, 33], ["torch.index_select", "torch.cat", "enumerate", "tokens.unsqueeze", "beam.Beam.finished.append", "beam.Beam.scores[].clone"], "methods", ["None"], ["", "def", "advance", "(", "self", ",", "scores", ",", "origin", ",", "tokens", ")", ":", "\n", "        ", "self", ".", "scores", "=", "scores", "\n", "self", ".", "hypotheses", "=", "torch", ".", "index_select", "(", "self", ".", "hypotheses", ",", "1", ",", "origin", ")", "\n", "self", ".", "hypotheses", "=", "torch", ".", "cat", "(", "[", "self", ".", "hypotheses", ",", "tokens", ".", "unsqueeze", "(", "0", ")", "]", ")", "\n", "\n", "for", "idx", ",", "tok", "in", "enumerate", "(", "self", ".", "hypotheses", "[", "-", "1", "]", ")", ":", "\n", "            ", "if", "tok", "==", "self", ".", "eos", ":", "\n", "                ", "self", ".", "finished", ".", "append", "(", "(", "self", ".", "scores", "[", "idx", "]", ".", "clone", "(", ")", ",", "self", ".", "hypotheses", "[", "1", ":", ",", "idx", "]", ")", ")", "\n", "self", ".", "scores", "[", "idx", "]", "=", "-", "1e20", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.beam.Beam.done": [[34, 39], ["max", "bool", "max", "beam.Beam.length_penalty", "beam.Beam.hypotheses.size", "beam.Beam.length_penalty", "t[].size"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.beam.Greedy.length_penalty", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.beam.Greedy.length_penalty"], ["", "", "", "@", "property", "\n", "def", "done", "(", "self", ")", ":", "\n", "        ", "max_score", "=", "max", "(", "[", "self", ".", "length_penalty", "(", "score", ",", "self", ".", "hypotheses", ".", "size", "(", "0", ")", ")", "for", "score", "in", "self", ".", "scores", "]", ")", "\n", "max_finish", "=", "max", "(", "[", "self", ".", "length_penalty", "(", "t", "[", "0", "]", ",", "t", "[", "1", "]", ".", "size", "(", "0", ")", ")", "for", "t", "in", "self", ".", "finished", "]", ")", "if", "self", ".", "finished", "else", "-", "1e20", "\n", "return", "bool", "(", "max_score", "<", "max_finish", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.beam.Beam.best_hypothesis": [[40, 46], ["sorted", "beam.Beam.length_penalty", "t[].size"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.beam.Greedy.length_penalty"], ["", "@", "property", "\n", "def", "best_hypothesis", "(", "self", ")", ":", "\n", "        ", "finished", "=", "sorted", "(", "self", ".", "finished", ",", "key", "=", "lambda", "t", ":", "self", ".", "length_penalty", "(", "t", "[", "0", "]", ",", "t", "[", "1", "]", ".", "size", "(", "0", ")", ")", ",", "reverse", "=", "True", ")", "\n", "if", "not", "finished", ":", "\n", "            ", "return", "self", ".", "hypotheses", "[", "1", ":", ",", "0", "]", "\n", "", "return", "finished", "[", "0", "]", "[", "1", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.beam.Beam.length_penalty": [[47, 49], ["None"], "methods", ["None"], ["", "def", "length_penalty", "(", "self", ",", "score", ",", "length", ")", ":", "\n", "        ", "return", "score", "*", "(", "6", "**", "self", ".", "alpha", ")", "/", "(", "(", "5", "+", "length", ")", "**", "self", ".", "alpha", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.translator.greedy_search": [[66, 115], ["src.view.size", "src.view.view", "src.view.eq", "encoder", "range", "beaver.infer.beam.Greedy", "all", "torch.cat().unsqueeze", "torch.cat().unsqueeze.eq", "decoder", "generator", "generator.view().topk", "indexes.view", "enumerate", "range", "b.advance", "torch.cat", "generator.view"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.beam.Greedy.advance"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.translator.sampling": [[116, 167], ["src.view.size", "src.view.view", "src.view.eq", "encoder", "range", "beaver.infer.beam.Greedy", "all", "torch.cat().unsqueeze", "torch.cat().unsqueeze.eq", "decoder", "generator", "torch.div", "torch.distributions.Multinomial", "torch.argmax", "torch.argmax.view", "enumerate", "range", "torch.distributions.Multinomial.sample", "b.advance", "torch.cat"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.beam.Greedy.advance"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.beam.Greedy.__init__": [[52, 66], ["torch.full().float().to", "torch.full().long().to", "torch.full().float", "torch.full().long", "torch.full", "torch.full"], "methods", ["None"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.beam.Greedy.current_state": [[67, 70], ["None"], "methods", ["None"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.beam.Greedy.advance": [[71, 79], ["torch.cat", "enumerate", "tokens.unsqueeze", "beam.Greedy.finished.append"], "methods", ["None"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.beam.Greedy.done": [[81, 84], ["None"], "methods", ["None"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.beam.Greedy.best_hypothesis": [[88, 94], ["len"], "methods", ["None"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.beam.Greedy.length_penalty": [[95, 97], ["None"], "methods", ["None"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.loss.optimizers.WarmAdam.__init__": [[9, 15], ["torch.Adam", "torch.Adam", "torch.Adam"], "methods", ["None"], ["        ", "self", ".", "original_lr", "=", "lr", "\n", "self", ".", "n_step", "=", "n_step", "\n", "self", ".", "hidden_size", "=", "hidden_size", "\n", "self", ".", "warm_up_step", "=", "warm_up", "\n", "self", ".", "optimizer", "=", "optim", ".", "Adam", "(", "params", ",", "betas", "=", "[", "0.9", ",", "0.998", "]", ",", "eps", "=", "1e-9", ")", "\n", "\n", "", "def", "step", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.loss.optimizers.WarmAdam.step": [[16, 23], ["min", "optimizers.WarmAdam.optimizer.step"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.loss.optimizers.WarmAdam.step"], ["        ", "self", ".", "n_step", "+=", "1", "\n", "warm_up", "=", "min", "(", "self", ".", "n_step", "**", "(", "-", "0.5", ")", ",", "self", ".", "n_step", "*", "self", ".", "warm_up_step", "**", "(", "-", "1.5", ")", ")", "\n", "lr", "=", "self", ".", "original_lr", "*", "(", "self", ".", "hidden_size", "**", "(", "-", "0.5", ")", "*", "warm_up", ")", "\n", "for", "param_group", "in", "self", ".", "optimizer", ".", "param_groups", ":", "\n", "            ", "param_group", "[", "'lr'", "]", "=", "lr", "\n", "", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.loss.optimizers.LabelSmoothingLoss.__init__": [[26, 32], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.__init__"], ["        ", "self", ".", "padding_idx", "=", "ignore_index", "\n", "self", ".", "label_smoothing", "=", "label_smoothing", "\n", "self", ".", "vocab_size", "=", "tgt_vocab_size", "\n", "\n", "super", "(", "LabelSmoothingLoss", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "", "def", "forward", "(", "self", ",", "output", ",", "target", ")", ":", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.loss.optimizers.LabelSmoothingLoss.forward": [[33, 42], ["target[].contiguous().view", "output.view.view.view", "target[].contiguous().view.ne", "[].sum", "[].sum", "target[].contiguous().view.ne.float().sum", "target[].contiguous", "target[].contiguous().view.ne.float", "output.view.view.gather", "output.view.view.sum", "target[].contiguous().view.view"], "methods", ["None"], ["        ", "target", "=", "target", "[", ":", ",", "1", ":", "]", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ")", "\n", "output", "=", "output", ".", "view", "(", "-", "1", ",", "self", ".", "vocab_size", ")", "\n", "non_pad_mask", "=", "target", ".", "ne", "(", "self", ".", "padding_idx", ")", "\n", "nll_loss", "=", "-", "output", ".", "gather", "(", "dim", "=", "-", "1", ",", "index", "=", "target", ".", "view", "(", "-", "1", ",", "1", ")", ")", "[", "non_pad_mask", "]", ".", "sum", "(", ")", "\n", "smooth_loss", "=", "-", "output", ".", "sum", "(", "dim", "=", "-", "1", ",", "keepdim", "=", "True", ")", "[", "non_pad_mask", "]", ".", "sum", "(", ")", "\n", "eps_i", "=", "self", ".", "label_smoothing", "/", "self", ".", "vocab_size", "\n", "loss", "=", "(", "1.", "-", "self", ".", "label_smoothing", ")", "*", "nll_loss", "+", "eps_i", "*", "smooth_loss", "\n", "return", "loss", "/", "non_pad_mask", ".", "float", "(", ")", ".", "sum", "(", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.loss.optimizers.MyLabelSmoothingLoss.__init__": [[44, 50], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.__init__"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.loss.optimizers.MyLabelSmoothingLoss.forward": [[51, 69], ["output.view.view.size", "output.view.view.size", "target[].contiguous().view", "output.view.view.view", "target[].contiguous().view.ne", "nll_loss[].sum", "smooth_loss[].sum", "output.view.view.gather", "output.view.view.sum", "weight.detach().repeat().view.detach().repeat().view.detach().repeat().view", "target[].contiguous().view.ne.float().sum", "target[].contiguous", "target[].contiguous().view.view", "weight.detach().repeat().view.detach().repeat().view.detach().repeat", "target[].contiguous().view.ne.float", "weight.detach().repeat().view.detach().repeat().view.detach"], "methods", ["None"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sent-level-supervised.translate.translate": [[17, 49], ["sorted", "sorted", "logging.info", "beaver.infer.beam_search", "zip", "open", "out_file.write", "out_file.write", "zip", "open", "out_file.write", "out_file.write", "len", "logging.info", "len", "logging.info", "fields[].decode", "fields[].decode"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.translator.beam_search", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode"], ["def", "translate", "(", "dataset", ",", "fields", ",", "model", ")", ":", "\n", "\n", "    ", "already_1", ",", "hypothesis_1", ",", "references_1", "=", "0", ",", "[", "]", ",", "[", "]", "\n", "already_2", ",", "hypothesis_2", ",", "references_2", "=", "0", ",", "[", "]", ",", "[", "]", "\n", "\n", "for", "batch", ",", "flag", "in", "dataset", ":", "\n", "        ", "predictions", "=", "beam_search", "(", "opt", ",", "model", ",", "batch", ".", "src", ",", "fields", ",", "flag", ")", "\n", "\n", "if", "flag", ":", "\n", "            ", "hypothesis_1", "+=", "[", "fields", "[", "\"task1_tgt\"", "]", ".", "decode", "(", "p", ")", "for", "p", "in", "predictions", "]", "\n", "already_1", "+=", "len", "(", "predictions", ")", "\n", "logging", ".", "info", "(", "\"Task 1: %7d/%7d\"", "%", "(", "already_1", ",", "dataset", ".", "task1_dataset", ".", "num_examples", ")", ")", "\n", "", "else", ":", "\n", "            ", "hypothesis_2", "+=", "[", "fields", "[", "\"task2_tgt\"", "]", ".", "decode", "(", "p", ")", "for", "p", "in", "predictions", "]", "\n", "already_2", "+=", "len", "(", "predictions", ")", "\n", "logging", ".", "info", "(", "\"Task 2: %7d/%7d\"", "%", "(", "already_2", ",", "dataset", ".", "task2_dataset", ".", "num_examples", ")", ")", "\n", "\n", "", "", "origin_1", "=", "sorted", "(", "zip", "(", "hypothesis_1", ",", "dataset", ".", "task1_dataset", ".", "seed", ")", ",", "key", "=", "lambda", "t", ":", "t", "[", "1", "]", ")", "\n", "hypothesis_1", "=", "[", "h", "for", "h", ",", "_", "in", "origin_1", "]", "\n", "\n", "with", "open", "(", "opt", ".", "output", "[", "0", "]", ",", "\"w\"", ",", "encoding", "=", "\"UTF-8\"", ")", "as", "out_file", ":", "\n", "        ", "out_file", ".", "write", "(", "\"\\n\"", ".", "join", "(", "hypothesis_1", ")", ")", "\n", "out_file", ".", "write", "(", "\"\\n\"", ")", "\n", "\n", "", "origin_2", "=", "sorted", "(", "zip", "(", "hypothesis_2", ",", "dataset", ".", "task2_dataset", ".", "seed", ")", ",", "key", "=", "lambda", "t", ":", "t", "[", "1", "]", ")", "\n", "hypothesis_2", "=", "[", "h", "for", "h", ",", "_", "in", "origin_2", "]", "\n", "\n", "with", "open", "(", "opt", ".", "output", "[", "1", "]", ",", "\"w\"", ",", "encoding", "=", "\"UTF-8\"", ")", "as", "out_file", ":", "\n", "        ", "out_file", ".", "write", "(", "\"\\n\"", ".", "join", "(", "hypothesis_2", ")", ")", "\n", "out_file", ".", "write", "(", "\"\\n\"", ")", "\n", "\n", "", "logging", ".", "info", "(", "\"Translation finished. \"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sent-level-supervised.translate.main": [[51, 74], ["logging.info", "beaver.data.build_dataset", "logging.info", "torch.load", "logging.info", "beaver.model.NMTModel.load_model().to().eval", "logging.info", "len", "len", "len", "torch.set_grad_enabled", "translate.translate", "beaver.model.NMTModel.load_model().to", "beaver.model.NMTModel.load_model"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.utils.build_dataset", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.translate.translate", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.nmt_model.NMTModel.load_model"], ["", "def", "main", "(", ")", ":", "\n", "    ", "logging", ".", "info", "(", "\"Build dataset...\"", ")", "\n", "dataset", "=", "build_dataset", "(", "opt", ",", "[", "opt", ".", "input", "[", "0", "]", ",", "opt", ".", "input", "[", "0", "]", ",", "opt", ".", "input", "[", "1", "]", ",", "opt", ".", "input", "[", "1", "]", "]", ",", "opt", ".", "vocab", ",", "device", ",", "train", "=", "False", ")", "\n", "\n", "fields", "=", "dataset", ".", "fields", "\n", "\n", "pad_ids", "=", "{", "\"src\"", ":", "fields", "[", "\"src\"", "]", ".", "pad_id", ",", "\n", "\"task1_tgt\"", ":", "fields", "[", "\"task1_tgt\"", "]", ".", "pad_id", ",", "\n", "\"task2_tgt\"", ":", "fields", "[", "\"task2_tgt\"", "]", ".", "pad_id", "}", "\n", "vocab_sizes", "=", "{", "\"src\"", ":", "len", "(", "fields", "[", "\"src\"", "]", ".", "vocab", ")", ",", "\n", "\"task1_tgt\"", ":", "len", "(", "fields", "[", "\"task1_tgt\"", "]", ".", "vocab", ")", ",", "\n", "\"task2_tgt\"", ":", "len", "(", "fields", "[", "\"task2_tgt\"", "]", ".", "vocab", ")", "}", "\n", "\n", "# load checkpoint from model_path", "\n", "logging", ".", "info", "(", "\"Load checkpoint from %s.\"", "%", "opt", ".", "model_path", ")", "\n", "checkpoint", "=", "torch", ".", "load", "(", "opt", ".", "model_path", ",", "map_location", "=", "lambda", "storage", ",", "loc", ":", "storage", ")", "\n", "\n", "logging", ".", "info", "(", "\"Build model...\"", ")", "\n", "model", "=", "NMTModel", ".", "load_model", "(", "checkpoint", "[", "\"opt\"", "]", ",", "pad_ids", ",", "vocab_sizes", ",", "checkpoint", "[", "\"model\"", "]", ")", ".", "to", "(", "device", ")", ".", "eval", "(", ")", "\n", "\n", "logging", ".", "info", "(", "\"Start translation...\"", ")", "\n", "with", "torch", ".", "set_grad_enabled", "(", "False", ")", ":", "\n", "        ", "translate", "(", "dataset", ",", "fields", ",", "model", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sent-level-supervised.train.valid": [[26, 63], ["model.eval", "enumerate", "beaver.utils.calculate_bleu", "beaver.utils.calculate_bleu", "beaver.utils.metric.calculate_rouge", "beaver.utils.metric.calculate_rouge", "logging.info", "saver.save", "model", "model.topk", "model.state_dict", "criterion_task1", "criterion_task2", "valid_dataset.fields[].decode", "valid_dataset.fields[].decode", "valid_dataset.fields[].decode", "valid_dataset.fields[].decode"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.metric.calculate_bleu", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.metric.calculate_bleu", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.metric.calculate_rouge", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.metric.calculate_rouge", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.saver.Saver.save", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode"], ["def", "valid", "(", "model", ",", "criterion_task1", ",", "criterion_task2", ",", "valid_dataset", ",", "step", ")", ":", "\n", "    ", "model", ".", "eval", "(", ")", "\n", "total_n", "=", "0", "\n", "total_task1_loss", "=", "total_task2_loss", "=", "0.0", "\n", "task1_hypothesis", ",", "task1_references", "=", "[", "]", ",", "[", "]", "\n", "task2_hypothesis", ",", "task2_references", "=", "[", "]", ",", "[", "]", "\n", "\n", "for", "i", ",", "(", "batch", ",", "flag", ")", "in", "enumerate", "(", "valid_dataset", ")", ":", "\n", "\n", "        ", "scores", "=", "model", "(", "batch", ".", "src", ",", "batch", ".", "tgt", ",", "flag", ")", "\n", "if", "flag", ":", "\n", "            ", "loss", "=", "criterion_task1", "(", "scores", ",", "batch", ".", "tgt", ")", "\n", "", "else", ":", "\n", "            ", "loss", "=", "criterion_task2", "(", "scores", ",", "batch", ".", "tgt", ")", "\n", "", "_", ",", "predictions", "=", "scores", ".", "topk", "(", "k", "=", "1", ",", "dim", "=", "-", "1", ")", "\n", "\n", "if", "flag", ":", "# task1", "\n", "            ", "total_task1_loss", "+=", "loss", ".", "data", "\n", "task1_hypothesis", "+=", "[", "valid_dataset", ".", "fields", "[", "\"task1_tgt\"", "]", ".", "decode", "(", "p", ")", "for", "p", "in", "predictions", "]", "\n", "task1_references", "+=", "[", "valid_dataset", ".", "fields", "[", "\"task1_tgt\"", "]", ".", "decode", "(", "t", ")", "for", "t", "in", "batch", ".", "tgt", "]", "\n", "", "else", ":", "\n", "            ", "total_task2_loss", "+=", "loss", ".", "data", "\n", "task2_hypothesis", "+=", "[", "valid_dataset", ".", "fields", "[", "\"task2_tgt\"", "]", ".", "decode", "(", "p", ")", "for", "p", "in", "predictions", "]", "\n", "task2_references", "+=", "[", "valid_dataset", ".", "fields", "[", "\"task2_tgt\"", "]", ".", "decode", "(", "t", ")", "for", "t", "in", "batch", ".", "tgt", "]", "\n", "\n", "", "total_n", "+=", "1", "\n", "\n", "", "bleu_task1", "=", "calculate_bleu", "(", "task1_hypothesis", ",", "task1_references", ")", "\n", "bleu_task2", "=", "calculate_bleu", "(", "task2_hypothesis", ",", "task2_references", ")", "\n", "rouge1_task1", ",", "rouge2_task1", "=", "calculate_rouge", "(", "task1_hypothesis", ",", "task1_references", ")", "\n", "rouge1_task2", ",", "rouge2_task2", "=", "calculate_rouge", "(", "task2_hypothesis", ",", "task2_references", ")", "\n", "mean_task1_loss", "=", "total_task1_loss", "/", "total_n", "\n", "mean_task2_loss", "=", "total_task2_loss", "/", "total_n", "\n", "logging", ".", "info", "(", "\"loss-task1: %.2f \\t loss-task2 %.2f \\t bleu-task1: %3.2f\\t bleu-task2: %3.2f \\t rouge1-task1: %3.2f \\t rouge1-task2: %3.2f \\t rouge2-task1: %3.2f \\t rouge2-task2: %3.2f\"", "\n", "%", "(", "mean_task1_loss", ",", "mean_task2_loss", ",", "bleu_task1", ",", "bleu_task2", ",", "rouge1_task1", ",", "rouge1_task2", ",", "rouge2_task1", ",", "rouge2_task2", ")", ")", "\n", "checkpoint", "=", "{", "\"model\"", ":", "model", ".", "state_dict", "(", ")", ",", "\"opt\"", ":", "opt", "}", "\n", "saver", ".", "save", "(", "checkpoint", ",", "step", ",", "mean_task1_loss", ",", "mean_task2_loss", ",", "bleu_task1", ",", "bleu_task2", ",", "rouge1_task1", ",", "rouge1_task2", ",", "rouge2_task1", ",", "rouge2_task2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sent-level-supervised.train.train": [[65, 107], ["model.zero_grad", "enumerate", "model", "criterion_task2.backward", "criterion_task1", "criterion_task2", "optimizer.step", "model.zero_grad", "torch.mean", "torch.mean", "logging.info", "model.train", "torch.mean", "torch.mean", "torch.set_grad_enabled", "torch.set_grad_enabled", "train.valid", "torch.log", "torch.log", "batch.score.view", "batch.score.view"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.loss.optimizers.WarmAdam.step", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.train", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.valid"], ["", "def", "train", "(", "model", ",", "criterion_task1", ",", "criterion_task2", ",", "optimizer", ",", "train_dataset", ",", "valid_dataset", ")", ":", "\n", "    ", "total_task1_loss", "=", "total_task2_loss", "=", "0.0", "\n", "model", ".", "zero_grad", "(", ")", "\n", "for", "i", ",", "(", "batch", ",", "flag", ")", "in", "enumerate", "(", "train_dataset", ")", ":", "\n", "\n", "        ", "scores", ",", "ext_scores", "=", "model", "(", "batch", ".", "src", ",", "batch", ".", "tgt", ",", "flag", ",", "True", ")", "\n", "if", "flag", ":", "\n", "            ", "loss", "=", "criterion_task1", "(", "scores", ",", "batch", ".", "tgt", ")", "\n", "", "else", ":", "\n", "            ", "loss", "=", "criterion_task2", "(", "scores", ",", "batch", ".", "tgt", ")", "\n", "\n", "", "if", "not", "flag", ":", "\n", "            ", "if", "True", ":", "\n", "                ", "loss2", "=", "torch", ".", "mean", "(", "(", "ext_scores", "-", "torch", ".", "log", "(", "batch", ".", "score", ".", "view", "(", "1", ",", "-", "1", ")", "+", "1e-6", ")", ")", "**", "2", ")", "\n", "loss", "=", "loss", "+", "1.0", "*", "loss2", "\n", "", "else", ":", "\n", "                ", "loss2", "=", "-", "torch", ".", "mean", "(", "ext_scores", "*", "(", "batch", ".", "score", ".", "view", "(", "1", ",", "-", "1", ")", ")", ")", "\n", "loss", "=", "loss", "+", "10.0", "*", "loss2", "\n", "\n", "", "", "loss", ".", "backward", "(", ")", "\n", "\n", "if", "flag", ":", "# task1", "\n", "            ", "total_task1_loss", "+=", "loss", ".", "data", "\n", "", "else", ":", "\n", "            ", "total_task2_loss", "+=", "loss", ".", "data", "\n", "\n", "", "if", "(", "i", "+", "1", ")", "%", "opt", ".", "grad_accum", "==", "0", ":", "\n", "            ", "optimizer", ".", "step", "(", ")", "\n", "model", ".", "zero_grad", "(", ")", "\n", "\n", "if", "optimizer", ".", "n_step", "%", "opt", ".", "report_every", "==", "0", ":", "\n", "                ", "mean_task1_loss", "=", "total_task1_loss", "/", "opt", ".", "report_every", "/", "opt", ".", "grad_accum", "*", "2", "\n", "mean_task2_loss", "=", "total_task2_loss", "/", "opt", ".", "report_every", "/", "opt", ".", "grad_accum", "*", "2", "\n", "logging", ".", "info", "(", "\"step: %7d\\t loss-task1: %.4f \\t loss-task2: %.4f\"", "\n", "%", "(", "optimizer", ".", "n_step", ",", "mean_task1_loss", ",", "mean_task2_loss", ")", ")", "\n", "total_task1_loss", "=", "total_task2_loss", "=", "0.0", "\n", "\n", "", "if", "optimizer", ".", "n_step", "%", "opt", ".", "save_every", "==", "0", ":", "\n", "                ", "with", "torch", ".", "set_grad_enabled", "(", "False", ")", ":", "\n", "                    ", "valid", "(", "model", ",", "criterion_task1", ",", "criterion_task2", ",", "valid_dataset", ",", "optimizer", ".", "n_step", ")", "\n", "", "model", ".", "train", "(", ")", "\n", "", "", "del", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sent-level-supervised.train.main": [[109, 132], ["logging.info", "beaver.data.build_dataset", "beaver.data.build_dataset", "logging.info", "beaver.model.NMTModel.load_model().to", "beaver.loss.LabelSmoothingLoss().to", "beaver.loss.LabelSmoothingLoss().to", "beaver.loss.WarmAdam", "logging.info", "train.train", "len", "len", "len", "int", "NMTModel.load_model().to.parameters", "beaver.model.NMTModel.load_model", "beaver.loss.LabelSmoothingLoss", "beaver.loss.LabelSmoothingLoss", "opt.train_from.split"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.utils.build_dataset", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.utils.build_dataset", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.train", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.nmt_model.NMTModel.load_model"], ["", "", "def", "main", "(", ")", ":", "\n", "    ", "logging", ".", "info", "(", "\"Build dataset...\"", ")", "\n", "train_dataset", "=", "build_dataset", "(", "opt", ",", "opt", ".", "train", ",", "opt", ".", "vocab", ",", "device", ",", "train", "=", "True", ")", "\n", "valid_dataset", "=", "build_dataset", "(", "opt", ",", "opt", ".", "valid", ",", "opt", ".", "vocab", ",", "device", ",", "train", "=", "False", ")", "\n", "fields", "=", "valid_dataset", ".", "fields", "=", "train_dataset", ".", "fields", "\n", "logging", ".", "info", "(", "\"Build model...\"", ")", "\n", "\n", "pad_ids", "=", "{", "\"src\"", ":", "fields", "[", "\"src\"", "]", ".", "pad_id", ",", "\n", "\"task1_tgt\"", ":", "fields", "[", "\"task1_tgt\"", "]", ".", "pad_id", ",", "\n", "\"task2_tgt\"", ":", "fields", "[", "\"task2_tgt\"", "]", ".", "pad_id", "}", "\n", "vocab_sizes", "=", "{", "\"src\"", ":", "len", "(", "fields", "[", "\"src\"", "]", ".", "vocab", ")", ",", "\n", "\"task1_tgt\"", ":", "len", "(", "fields", "[", "\"task1_tgt\"", "]", ".", "vocab", ")", ",", "\n", "\"task2_tgt\"", ":", "len", "(", "fields", "[", "\"task2_tgt\"", "]", ".", "vocab", ")", "}", "\n", "\n", "model", "=", "NMTModel", ".", "load_model", "(", "opt", ",", "pad_ids", ",", "vocab_sizes", ",", "cls_id1", "=", "None", ",", "cls_id2", "=", "None", ")", ".", "to", "(", "device", ")", "\n", "criterion_task1", "=", "LabelSmoothingLoss", "(", "opt", ".", "label_smoothing", ",", "vocab_sizes", "[", "\"task1_tgt\"", "]", ",", "pad_ids", "[", "\"task1_tgt\"", "]", ")", ".", "to", "(", "device", ")", "\n", "criterion_task2", "=", "LabelSmoothingLoss", "(", "opt", ".", "label_smoothing", ",", "vocab_sizes", "[", "\"task2_tgt\"", "]", ",", "pad_ids", "[", "\"task2_tgt\"", "]", ")", ".", "to", "(", "device", ")", "\n", "\n", "n_step", "=", "int", "(", "opt", ".", "train_from", ".", "split", "(", "\"-\"", ")", "[", "-", "1", "]", ")", "if", "opt", ".", "train_from", "else", "1", "\n", "optimizer", "=", "WarmAdam", "(", "model", ".", "parameters", "(", ")", ",", "opt", ".", "lr", ",", "opt", ".", "hidden_size", ",", "opt", ".", "warm_up", ",", "n_step", ")", "\n", "\n", "logging", ".", "info", "(", "\"start training...\"", ")", "\n", "train", "(", "model", ",", "criterion_task1", ",", "criterion_task2", ",", "optimizer", ",", "train_dataset", ",", "valid_dataset", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.translate.translate": [[17, 49], ["sorted", "sorted", "logging.info", "beaver.infer.beam_search", "zip", "open", "out_file.write", "out_file.write", "zip", "open", "out_file.write", "out_file.write", "len", "logging.info", "len", "logging.info", "fields[].decode", "fields[].decode"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.translator.beam_search", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode"], ["def", "translate", "(", "dataset", ",", "fields", ",", "model", ")", ":", "\n", "\n", "    ", "already_1", ",", "hypothesis_1", ",", "references_1", "=", "0", ",", "[", "]", ",", "[", "]", "\n", "already_2", ",", "hypothesis_2", ",", "references_2", "=", "0", ",", "[", "]", ",", "[", "]", "\n", "\n", "for", "batch", ",", "flag", "in", "dataset", ":", "\n", "        ", "predictions", "=", "beam_search", "(", "opt", ",", "model", ",", "batch", ".", "src", ",", "fields", ",", "flag", ")", "\n", "\n", "if", "flag", ":", "\n", "            ", "hypothesis_1", "+=", "[", "fields", "[", "\"task1_tgt\"", "]", ".", "decode", "(", "p", ")", "for", "p", "in", "predictions", "]", "\n", "already_1", "+=", "len", "(", "predictions", ")", "\n", "logging", ".", "info", "(", "\"Task 1: %7d/%7d\"", "%", "(", "already_1", ",", "dataset", ".", "task1_dataset", ".", "num_examples", ")", ")", "\n", "", "else", ":", "\n", "            ", "hypothesis_2", "+=", "[", "fields", "[", "\"task2_tgt\"", "]", ".", "decode", "(", "p", ")", "for", "p", "in", "predictions", "]", "\n", "already_2", "+=", "len", "(", "predictions", ")", "\n", "logging", ".", "info", "(", "\"Task 2: %7d/%7d\"", "%", "(", "already_2", ",", "dataset", ".", "task2_dataset", ".", "num_examples", ")", ")", "\n", "\n", "", "", "origin_1", "=", "sorted", "(", "zip", "(", "hypothesis_1", ",", "dataset", ".", "task1_dataset", ".", "seed", ")", ",", "key", "=", "lambda", "t", ":", "t", "[", "1", "]", ")", "\n", "hypothesis_1", "=", "[", "h", "for", "h", ",", "_", "in", "origin_1", "]", "\n", "\n", "with", "open", "(", "opt", ".", "output", "[", "0", "]", ",", "\"w\"", ",", "encoding", "=", "\"UTF-8\"", ")", "as", "out_file", ":", "\n", "        ", "out_file", ".", "write", "(", "\"\\n\"", ".", "join", "(", "hypothesis_1", ")", ")", "\n", "out_file", ".", "write", "(", "\"\\n\"", ")", "\n", "\n", "", "origin_2", "=", "sorted", "(", "zip", "(", "hypothesis_2", ",", "dataset", ".", "task2_dataset", ".", "seed", ")", ",", "key", "=", "lambda", "t", ":", "t", "[", "1", "]", ")", "\n", "hypothesis_2", "=", "[", "h", "for", "h", ",", "_", "in", "origin_2", "]", "\n", "\n", "with", "open", "(", "opt", ".", "output", "[", "1", "]", ",", "\"w\"", ",", "encoding", "=", "\"UTF-8\"", ")", "as", "out_file", ":", "\n", "        ", "out_file", ".", "write", "(", "\"\\n\"", ".", "join", "(", "hypothesis_2", ")", ")", "\n", "out_file", ".", "write", "(", "\"\\n\"", ")", "\n", "\n", "", "logging", ".", "info", "(", "\"Translation finished. \"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.translate.main": [[51, 74], ["logging.info", "beaver.data.build_dataset", "logging.info", "torch.load", "logging.info", "beaver.model.NMTModel.load_model().to().eval", "logging.info", "len", "len", "len", "torch.set_grad_enabled", "translate.translate", "beaver.model.NMTModel.load_model().to", "beaver.model.NMTModel.load_model"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.utils.build_dataset", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.translate.translate", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.nmt_model.NMTModel.load_model"], ["", "def", "main", "(", ")", ":", "\n", "    ", "logging", ".", "info", "(", "\"Build dataset...\"", ")", "\n", "dataset", "=", "build_dataset", "(", "opt", ",", "[", "opt", ".", "input", "[", "0", "]", ",", "opt", ".", "input", "[", "0", "]", ",", "opt", ".", "input", "[", "1", "]", ",", "opt", ".", "input", "[", "1", "]", "]", ",", "opt", ".", "vocab", ",", "device", ",", "train", "=", "False", ")", "\n", "\n", "fields", "=", "dataset", ".", "fields", "\n", "\n", "pad_ids", "=", "{", "\"src\"", ":", "fields", "[", "\"src\"", "]", ".", "pad_id", ",", "\n", "\"task1_tgt\"", ":", "fields", "[", "\"task1_tgt\"", "]", ".", "pad_id", ",", "\n", "\"task2_tgt\"", ":", "fields", "[", "\"task2_tgt\"", "]", ".", "pad_id", "}", "\n", "vocab_sizes", "=", "{", "\"src\"", ":", "len", "(", "fields", "[", "\"src\"", "]", ".", "vocab", ")", ",", "\n", "\"task1_tgt\"", ":", "len", "(", "fields", "[", "\"task1_tgt\"", "]", ".", "vocab", ")", ",", "\n", "\"task2_tgt\"", ":", "len", "(", "fields", "[", "\"task2_tgt\"", "]", ".", "vocab", ")", "}", "\n", "\n", "# load checkpoint from model_path", "\n", "logging", ".", "info", "(", "\"Load checkpoint from %s.\"", "%", "opt", ".", "model_path", ")", "\n", "checkpoint", "=", "torch", ".", "load", "(", "opt", ".", "model_path", ",", "map_location", "=", "lambda", "storage", ",", "loc", ":", "storage", ")", "\n", "\n", "logging", ".", "info", "(", "\"Build model...\"", ")", "\n", "model", "=", "NMTModel", ".", "load_model", "(", "checkpoint", "[", "\"opt\"", "]", ",", "pad_ids", ",", "vocab_sizes", ",", "checkpoint", "[", "\"model\"", "]", ")", ".", "to", "(", "device", ")", ".", "eval", "(", ")", "\n", "\n", "logging", ".", "info", "(", "\"Start translation...\"", ")", "\n", "with", "torch", ".", "set_grad_enabled", "(", "False", ")", ":", "\n", "        ", "translate", "(", "dataset", ",", "fields", ",", "model", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train._split_into_words": [[28, 31], ["list", "itertools.chain", "_.split"], "function", ["None"], ["total_n", "=", "0", "\n", "total_task1_loss", "=", "total_task2_loss", "=", "0.0", "\n", "task1_hypothesis", ",", "task1_references", "=", "[", "]", ",", "[", "]", "\n", "task2_hypothesis", ",", "task2_references", "=", "[", "]", ",", "[", "]", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.my_union_lcs": [[32, 45], ["set", "train._split_into_words", "len", "train._split_into_words", "set", "len", "lcs_union.union.union", "my_recon_lcs"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train._split_into_words", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train._split_into_words"], ["\n", "for", "i", ",", "(", "batch", ",", "flag", ")", "in", "enumerate", "(", "valid_dataset", ")", ":", "\n", "\n", "        ", "scores", "=", "model", "(", "batch", ".", "src", ",", "batch", ".", "tgt", ",", "flag", ")", "\n", "if", "flag", ":", "\n", "            ", "loss", "=", "criterion_task1", "(", "scores", ",", "batch", ".", "tgt", ")", "\n", "", "else", ":", "\n", "            ", "loss", "=", "criterion_task2", "(", "scores", ",", "batch", ".", "tgt", ")", "\n", "", "_", ",", "predictions", "=", "scores", ".", "topk", "(", "k", "=", "1", ",", "dim", "=", "-", "1", ")", "\n", "\n", "if", "flag", ":", "# task1", "\n", "            ", "total_task1_loss", "+=", "loss", ".", "data", "\n", "task1_hypothesis", "+=", "[", "valid_dataset", ".", "fields", "[", "\"task1_tgt\"", "]", ".", "decode", "(", "p", ")", "for", "p", "in", "predictions", "]", "\n", "task1_references", "+=", "[", "valid_dataset", ".", "fields", "[", "\"task1_tgt\"", "]", ".", "decode", "(", "t", ")", "for", "t", "in", "batch", ".", "tgt", "]", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train._lcs_table": [[46, 58], ["len", "len", "range", "range", "range", "max"], "function", ["None"], ["", "else", ":", "\n", "            ", "total_task2_loss", "+=", "loss", ".", "data", "\n", "task2_hypothesis", "+=", "[", "valid_dataset", ".", "fields", "[", "\"task2_tgt\"", "]", ".", "decode", "(", "p", ")", "for", "p", "in", "predictions", "]", "\n", "task2_references", "+=", "[", "valid_dataset", ".", "fields", "[", "\"task2_tgt\"", "]", ".", "decode", "(", "t", ")", "for", "t", "in", "batch", ".", "tgt", "]", "\n", "\n", "", "total_n", "+=", "1", "\n", "\n", "", "bleu_task1", "=", "calculate_bleu", "(", "task1_hypothesis", ",", "task1_references", ")", "\n", "bleu_task2", "=", "calculate_bleu", "(", "task2_hypothesis", ",", "task2_references", ")", "\n", "rouge1_task1", ",", "rouge2_task1", "=", "calculate_rouge", "(", "task1_hypothesis", ",", "task1_references", ")", "\n", "rouge1_task2", ",", "rouge2_task2", "=", "calculate_rouge", "(", "task2_hypothesis", ",", "task2_references", ")", "\n", "mean_task1_loss", "=", "total_task1_loss", "/", "total_n", "\n", "mean_task2_loss", "=", "total_task2_loss", "/", "total_n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train._backtrack_norec": [[59, 74], ["len", "len", "lcs.insert"], "function", ["None"], ["logging", ".", "info", "(", "\"loss-task1: %.2f \\t loss-task2 %.2f \\t bleu-task1: %3.2f\\t bleu-task2: %3.2f \\t rouge1-task1: %3.2f \\t rouge1-task2: %3.2f \\t rouge2-task1: %3.2f \\t rouge2-task2: %3.2f\"", "\n", "%", "(", "mean_task1_loss", ",", "mean_task2_loss", ",", "bleu_task1", ",", "bleu_task2", ",", "rouge1_task1", ",", "rouge1_task2", ",", "rouge2_task1", ",", "rouge2_task2", ")", ")", "\n", "checkpoint", "=", "{", "\"model\"", ":", "model", ".", "state_dict", "(", ")", ",", "\"opt\"", ":", "opt", "}", "\n", "saver", ".", "save", "(", "checkpoint", ",", "step", ",", "mean_task1_loss", ",", "mean_task2_loss", ",", "bleu_task1", ",", "bleu_task2", ",", "rouge1_task1", ",", "rouge1_task2", ",", "rouge2_task1", ",", "rouge2_task2", ")", "\n", "\n", "\n", "", "def", "train", "(", "model", ",", "criterion_task1", ",", "criterion_task2", ",", "optimizer", ",", "train_dataset", ",", "valid_dataset", ")", ":", "\n", "    ", "total_task1_loss", "=", "total_task2_loss", "=", "0.0", "\n", "model", ".", "zero_grad", "(", ")", "\n", "for", "i", ",", "(", "batch", ",", "flag", ")", "in", "enumerate", "(", "train_dataset", ")", ":", "\n", "\n", "        ", "scores", ",", "ext_scores", "=", "model", "(", "batch", ".", "src", ",", "batch", ".", "tgt", ",", "flag", ",", "True", ")", "\n", "if", "flag", ":", "\n", "            ", "loss", "=", "criterion_task1", "(", "scores", ",", "batch", ".", "tgt", ")", "\n", "", "else", ":", "\n", "            ", "loss", "=", "criterion_task2", "(", "scores", ",", "batch", ".", "tgt", ")", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.lcs_ind": [[76, 79], ["train._lcs_table", "train._backtrack_norec"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train._lcs_table", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train._backtrack_norec"], ["", "if", "not", "flag", ":", "\n", "            ", "if", "True", ":", "\n", "                ", "loss2", "=", "torch", ".", "mean", "(", "(", "ext_scores", "-", "torch", ".", "log", "(", "batch", ".", "score", ".", "view", "(", "1", ",", "-", "1", ")", "+", "1e-6", ")", ")", "**", "2", ")", "\n", "loss", "=", "loss", "+", "1.0", "*", "loss2", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train._find_union": [[80, 83], ["sorted", "list", "set().union", "set"], "function", ["None"], ["", "else", ":", "\n", "                ", "loss2", "=", "-", "torch", ".", "mean", "(", "ext_scores", "*", "(", "batch", ".", "score", ".", "view", "(", "1", ",", "-", "1", ")", ")", ")", "\n", "loss", "=", "loss", "+", "10.0", "*", "loss2", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train._union_lcs": [[84, 87], ["train.lcs_ind", "train._find_union"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.lcs_ind", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train._find_union"], ["", "", "loss", ".", "backward", "(", ")", "\n", "\n", "if", "flag", ":", "# task1", "\n", "            ", "total_task1_loss", "+=", "loss", ".", "data", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.calc_rouge_L": [[88, 131], ["candidate.replace", "reference.replace", "sum", "sum", "collections.Counter", "collections.Counter", "six.ensure_str().split", "s.split", "s.split", "map", "map", "print", "print", "collections.Counter.update", "collections.Counter.update", "train._union_lcs", "train.calc_rouge_L.get_sents"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train._union_lcs"], ["", "else", ":", "\n", "            ", "total_task2_loss", "+=", "loss", ".", "data", "\n", "\n", "", "if", "(", "i", "+", "1", ")", "%", "opt", ".", "grad_accum", "==", "0", ":", "\n", "            ", "optimizer", ".", "step", "(", ")", "\n", "model", ".", "zero_grad", "(", ")", "\n", "\n", "if", "optimizer", ".", "n_step", "%", "opt", ".", "report_every", "==", "0", ":", "\n", "                ", "mean_task1_loss", "=", "total_task1_loss", "/", "opt", ".", "report_every", "/", "opt", ".", "grad_accum", "*", "2", "\n", "mean_task2_loss", "=", "total_task2_loss", "/", "opt", ".", "report_every", "/", "opt", ".", "grad_accum", "*", "2", "\n", "logging", ".", "info", "(", "\"step: %7d\\t loss-task1: %.4f \\t loss-task2: %.4f\"", "\n", "%", "(", "optimizer", ".", "n_step", ",", "mean_task1_loss", ",", "mean_task2_loss", ")", ")", "\n", "total_task1_loss", "=", "total_task2_loss", "=", "0.0", "\n", "\n", "", "if", "optimizer", ".", "n_step", "%", "opt", ".", "save_every", "==", "0", ":", "\n", "                ", "with", "torch", ".", "set_grad_enabled", "(", "False", ")", ":", "\n", "                    ", "valid", "(", "model", ",", "criterion_task1", ",", "criterion_task2", ",", "valid_dataset", ",", "optimizer", ".", "n_step", ")", "\n", "", "model", ".", "train", "(", ")", "\n", "", "", "del", "loss", "\n", "\n", "\n", "", "", "def", "main", "(", ")", ":", "\n", "    ", "logging", ".", "info", "(", "\"Build dataset...\"", ")", "\n", "train_dataset", "=", "build_dataset", "(", "opt", ",", "opt", ".", "train", ",", "opt", ".", "vocab", ",", "device", ",", "train", "=", "True", ")", "\n", "valid_dataset", "=", "build_dataset", "(", "opt", ",", "opt", ".", "valid", ",", "opt", ".", "vocab", ",", "device", ",", "train", "=", "False", ")", "\n", "fields", "=", "valid_dataset", ".", "fields", "=", "train_dataset", ".", "fields", "\n", "logging", ".", "info", "(", "\"Build model...\"", ")", "\n", "\n", "pad_ids", "=", "{", "\"src\"", ":", "fields", "[", "\"src\"", "]", ".", "pad_id", ",", "\n", "\"task1_tgt\"", ":", "fields", "[", "\"task1_tgt\"", "]", ".", "pad_id", ",", "\n", "\"task2_tgt\"", ":", "fields", "[", "\"task2_tgt\"", "]", ".", "pad_id", "}", "\n", "vocab_sizes", "=", "{", "\"src\"", ":", "len", "(", "fields", "[", "\"src\"", "]", ".", "vocab", ")", ",", "\n", "\"task1_tgt\"", ":", "len", "(", "fields", "[", "\"task1_tgt\"", "]", ".", "vocab", ")", ",", "\n", "\"task2_tgt\"", ":", "len", "(", "fields", "[", "\"task2_tgt\"", "]", ".", "vocab", ")", "}", "\n", "\n", "model", "=", "NMTModel", ".", "load_model", "(", "opt", ",", "pad_ids", ",", "vocab_sizes", ",", "cls_id1", "=", "None", ",", "cls_id2", "=", "None", ")", ".", "to", "(", "device", ")", "\n", "criterion_task1", "=", "LabelSmoothingLoss", "(", "opt", ".", "label_smoothing", ",", "vocab_sizes", "[", "\"task1_tgt\"", "]", ",", "pad_ids", "[", "\"task1_tgt\"", "]", ")", ".", "to", "(", "device", ")", "\n", "criterion_task2", "=", "LabelSmoothingLoss", "(", "opt", ".", "label_smoothing", ",", "vocab_sizes", "[", "\"task2_tgt\"", "]", ",", "pad_ids", "[", "\"task2_tgt\"", "]", ")", ".", "to", "(", "device", ")", "\n", "\n", "n_step", "=", "int", "(", "opt", ".", "train_from", ".", "split", "(", "\"-\"", ")", "[", "-", "1", "]", ")", "if", "opt", ".", "train_from", "else", "1", "\n", "optimizer", "=", "WarmAdam", "(", "model", ".", "parameters", "(", ")", ",", "opt", ".", "lr", ",", "opt", ".", "hidden_size", ",", "opt", ".", "warm_up", ",", "n_step", ")", "\n", "\n", "logging", ".", "info", "(", "\"start training...\"", ")", "\n", "train", "(", "model", ",", "criterion_task1", ",", "criterion_task2", ",", "optimizer", ",", "train_dataset", ",", "valid_dataset", ")", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.calc_sim": [[132, 140], ["beaver.sim.utils.Example", "beaver.sim.utils.Example.populate_embeddings", "model.torchify_batch", "model.encode", "model.cosine", "len", "beaver.sim.utils.Example.embeddings.append"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.utils.Example.populate_embeddings", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.ParaModel.torchify_batch", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.encode"], ["\n", "\n", "", "if", "__name__", "==", "'__main__'", ":", "\n", "    ", "main", "(", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.valid": [[151, 191], ["model.eval", "enumerate", "beaver.utils.calculate_bleu", "beaver.utils.calculate_bleu", "beaver.utils.metric.calculate_rouge", "beaver.utils.metric.calculate_rouge", "logging.info", "saver.save", "zip", "model", "beaver.infer.greedy_search", "train.valid.roul"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.metric.calculate_bleu", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.metric.calculate_bleu", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.metric.calculate_rouge", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.metric.calculate_rouge", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.utils.saver.Saver.save", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.translator.greedy_search"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.train": [[193, 294], ["model.train", "model.zero_grad", "enumerate", "torch.set_grad_enabled", "torch.set_grad_enabled", "train.valid", "model.eval", "batch.tgt[].view", "criterion_task2.backward", "torch.no_grad", "torch.no_grad", "beaver.infer.greedy_search", "max", "enumerate", "torch.stack", "torch.stack", "torch.cat", "torch.cat", "model", "model.train", "torch.Tensor().to", "torch.Tensor().to", "model", "model.train", "model", "optimizer.step", "model.zero_grad", "beaver.infer.sampling", "max", "enumerate", "torch.stack", "torch.stack", "torch.cat", "torch.cat", "torch.full().long().to", "torch.full().long().to", "torch.cat", "torch.cat", "criterion_task1", "criterion_task2", "criterion_task1", "criterion_task2", "logging.info", "model.train", "torch.full().long().to", "torch.full().long().to", "torch.cat", "torch.cat", "weights_greedy.append", "train_dataset.fields[].decode_ori", "train_dataset.fields[].decode_word", "train.calc_sim", "weights_greedy.append", "torch.Tensor", "torch.Tensor", "criterion_task1", "criterion_task2", "torch.set_grad_enabled", "torch.set_grad_enabled", "train.valid", "weights_sample.append", "train_dataset.fields[].decode_ori", "train_dataset.fields[].decode_ori", "train.calc_sim", "weights_sample.append", "x.size", "torch.full().long", "torch.full().long", "train.calc_rouge_L", "batch.en_vec[].view", "train.calc_rouge_L", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "x.size", "torch.full().long", "torch.full().long", "train.calc_rouge_L", "batch.en_vec[].view", "train.calc_rouge_L", "train_dataset.fields[].decode_word", "train_dataset.fields[].decode_word", "criterion_task1", "criterion_task2", "train_dataset.fields[].decode_word", "train_dataset.fields[].decode_word", "torch.full", "torch.full", "torch.full", "torch.full", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "p.size", "p.size"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.train", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.valid", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.translator.greedy_search", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.train", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.train", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.loss.optimizers.WarmAdam.step", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.infer.translator.sampling", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.train", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode_ori", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode_word", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.calc_sim", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.valid", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode_ori", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode_ori", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.calc_sim", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.calc_rouge_L", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.calc_rouge_L", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.calc_rouge_L", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.calc_rouge_L", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode_word", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode_word", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode_word", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.field.Field.decode_word"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.main": [[296, 321], ["beaver.sim.reload_models.load_sim_model", "logging.info", "beaver.data.build_dataset", "beaver.data.build_dataset", "logging.info", "beaver.model.NMTModel.load_model().to", "beaver.loss.MyLabelSmoothingLoss().to", "beaver.loss.MyLabelSmoothingLoss().to", "beaver.loss.WarmAdam", "logging.info", "train.train", "len", "len", "len", "NMTModel.load_model().to.parameters", "beaver.model.NMTModel.load_model", "beaver.loss.MyLabelSmoothingLoss", "beaver.loss.MyLabelSmoothingLoss"], "function", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.load_sim_model", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.utils.build_dataset", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.data.utils.build_dataset", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.rl-sim.train.train", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.model.nmt_model.NMTModel.load_model"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.utils.Example.__init__": [[87, 90], ["sentence.strip().lower", "sentence.strip"], "methods", ["None"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.utils.Example.populate_embeddings": [[91, 99], ["utils.Example.sentence.split", "utils.lookup", "len", "utils.Example.embeddings.append"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.utils.lookup"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.utils.get_words": [[8, 41], ["collections.Counter", "len", "len", "collections.Counter.update", "collections.Counter", "utils.get_words.update_counter"], "function", ["None"], ["def", "build_dataset", "(", "opt", ",", "data_path", ",", "vocab_path", ",", "device", ",", "train", "=", "True", ")", ":", "\n", "    ", "task1_source_path", "=", "data_path", "[", "0", "]", "\n", "task1_target_path", "=", "data_path", "[", "1", "]", "\n", "task2_source_path", "=", "data_path", "[", "2", "]", "\n", "task2_target_path", "=", "data_path", "[", "3", "]", "\n", "\n", "if", "train", ":", "\n", "      ", "score_path1", ",", "score_path2", "=", "opt", ".", "score_file1", ",", "opt", ".", "score_file2", "\n", "", "else", ":", "\n", "      ", "score_path1", "=", "score_path2", "=", "None", "\n", "\n", "", "source_field", "=", "Field", "(", "unk", "=", "True", ",", "pad", "=", "True", ",", "bos", "=", "False", ",", "eos", "=", "False", ")", "\n", "translation_target_field", "=", "Field", "(", "unk", "=", "True", ",", "pad", "=", "True", ",", "bos", "=", "True", ",", "eos", "=", "True", ")", "\n", "summary_target_field", "=", "Field", "(", "unk", "=", "True", ",", "pad", "=", "True", ",", "bos", "=", "True", ",", "eos", "=", "True", ")", "\n", "\n", "source_vocab", ",", "target_vocab", "=", "vocab_path", "\n", "source_special", "=", "source_field", ".", "special", "\n", "translation_target_special", "=", "translation_target_field", ".", "special", "\n", "summary_target_special", "=", "summary_target_field", ".", "special", "\n", "\n", "with", "open", "(", "source_vocab", ",", "encoding", "=", "\"UTF-8\"", ")", "as", "f", ":", "\n", "        ", "source_words", "=", "[", "line", ".", "strip", "(", ")", "for", "line", "in", "f", "]", "\n", "", "with", "open", "(", "target_vocab", ",", "encoding", "=", "\"UTF-8\"", ")", "as", "f", ":", "\n", "        ", "target_words", "=", "[", "line", ".", "strip", "(", ")", "for", "line", "in", "f", "]", "\n", "\n", "", "if", "opt", ".", "mono", ":", "\n", "# source\u548c\u6458\u8981target\u5171\u4eab\u8bcd\u8868", "\n", "        ", "source_special", "=", "summary_target_special", "=", "sorted", "(", "set", "(", "source_special", "+", "summary_target_special", ")", ")", "\n", "\n", "", "source_field", ".", "load_vocab", "(", "source_words", ",", "source_special", ")", "\n", "translation_target_field", ".", "load_vocab", "(", "target_words", ",", "translation_target_special", ")", "\n", "\n", "if", "opt", ".", "mono", ":", "\n", "        ", "summary_target_field", ".", "load_vocab", "(", "source_words", ",", "summary_target_special", ")", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.utils.get_minibatches_idx": [[42, 59], ["numpy.arange", "range", "list", "numpy.random.shuffle", "minibatches.append", "minibatches.append", "zip", "range", "len"], "function", ["None"], ["", "else", ":", "\n", "        ", "summary_target_field", ".", "load_vocab", "(", "target_words", ",", "summary_target_special", ")", "\n", "\n", "", "data1", "=", "TranslationDataset", "(", "task1_source_path", ",", "task1_target_path", ",", "opt", ".", "batch_size", ",", "device", ",", "train", ",", "\n", "{", "'src'", ":", "source_field", ",", "'tgt'", ":", "summary_target_field", "}", ",", "score_path1", ")", "\n", "\n", "data2", "=", "TranslationDataset", "(", "task2_source_path", ",", "task2_target_path", ",", "opt", ".", "batch_size", ",", "device", ",", "train", ",", "\n", "{", "'src'", ":", "source_field", ",", "'tgt'", ":", "translation_target_field", "}", ",", "score_path2", ")", "\n", "return", "Dataset", "(", "data1", ",", "data2", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.utils.max_pool": [[60, 67], ["torch.FloatTensor().zero_", "range", "out.cuda.cuda", "len", "torch.FloatTensor", "torch.max", "x.size", "x.size"], "function", ["None"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.utils.mean_pool": [[68, 75], ["torch.FloatTensor().zero_", "range", "out.cuda.cuda", "len", "torch.mean", "torch.FloatTensor", "x.size", "x.size"], "function", ["None"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.utils.lookup": [[76, 85], ["w.lower.lower"], "function", ["None"], []], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.ParaModel.__init__": [[27, 35], ["torch.Module.__init__", "torch.nn.modules.distance.CosineSimilarity", "torch.nn.modules.distance.CosineSimilarity", "torch.nn.modules.distance.CosineSimilarity"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.__init__"], ["    ", "def", "__init__", "(", "self", ",", "args", ",", "vocab", ")", ":", "\n", "        ", "super", "(", "ParaModel", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "args", "=", "args", "\n", "self", ".", "vocab", "=", "vocab", "\n", "self", ".", "gpu", "=", "args", ".", "gpu", "\n", "\n", "self", ".", "cosine", "=", "CosineSimilarity", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.ParaModel.compute_mask": [[36, 47], ["lengths.cpu.cpu.cpu", "torch.max", "torch.max", "torch.max", "torch.max", "torch.max", "torch.max", "torch.max", "torch.max", "torch.max", "[].expand", "lengths[].expand_as", "torch.autograd.Variable", "torch.autograd.Variable", "torch.autograd.Variable", "mask.cuda.cuda.float", "mask.cuda.cuda.cuda", "lengths.cpu.cpu.size", "torch.arange().long", "torch.arange().long", "torch.arange().long", "torch.arange().long", "torch.arange().long", "torch.arange().long", "torch.arange().long", "torch.arange().long", "torch.arange().long", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange"], "methods", ["None"], ["", "def", "compute_mask", "(", "self", ",", "lengths", ")", ":", "\n", "\n", "        ", "lengths", "=", "lengths", ".", "cpu", "(", ")", "\n", "max_len", "=", "torch", ".", "max", "(", "lengths", ")", "\n", "range_row", "=", "torch", ".", "arange", "(", "0", ",", "max_len", ")", ".", "long", "(", ")", "[", "None", ",", ":", "]", ".", "expand", "(", "lengths", ".", "size", "(", ")", "[", "0", "]", ",", "max_len", ")", "\n", "mask", "=", "lengths", "[", ":", ",", "None", "]", ".", "expand_as", "(", "range_row", ")", "\n", "mask", "=", "range_row", "<", "mask", "\n", "mask", "=", "Variable", "(", "mask", ".", "float", "(", ")", ")", "\n", "if", "self", ".", "gpu", ">=", "0", ":", "\n", "            ", "mask", "=", "mask", ".", "cuda", "(", ")", "\n", "", "return", "mask", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.ParaModel.torchify_batch": [[48, 74], ["len", "numpy.zeros", "numpy.zeros", "enumerate", "len", "torch.autograd.Variable", "torch.autograd.Variable", "torch.autograd.Variable", "torch.from_numpy().float().long", "torch.from_numpy().float().long", "torch.from_numpy().float().long", "torch.from_numpy().float().long", "torch.from_numpy().float().long", "torch.from_numpy().float().long", "torch.from_numpy().float().long", "torch.from_numpy().float().long", "torch.from_numpy().float().long", "reload_models.ParaModel.compute_mask", "idxs.cuda.cuda.cuda", "lengths.cuda.cuda.cuda", "masks.cuda.cuda.cuda", "len", "len", "torch.from_numpy().long", "torch.from_numpy().long", "torch.from_numpy().long", "torch.from_numpy().long", "torch.from_numpy().long", "torch.from_numpy().long", "torch.from_numpy().long", "torch.from_numpy().long", "torch.from_numpy().long", "torch.from_numpy().long", "torch.from_numpy().long", "torch.from_numpy().long", "torch.from_numpy().long", "torch.from_numpy().long", "torch.from_numpy().long", "torch.from_numpy().long", "torch.from_numpy().long", "torch.from_numpy().long", "torch.from_numpy().float", "torch.from_numpy().float", "torch.from_numpy().float", "torch.from_numpy().float", "torch.from_numpy().float", "torch.from_numpy().float", "torch.from_numpy().float", "torch.from_numpy().float", "torch.from_numpy().float", "len", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.ParaModel.compute_mask"], ["", "def", "torchify_batch", "(", "self", ",", "batch", ")", ":", "\n", "\n", "        ", "max_len", "=", "0", "\n", "for", "i", "in", "batch", ":", "\n", "            ", "if", "len", "(", "i", ".", "embeddings", ")", ">", "max_len", ":", "\n", "                ", "max_len", "=", "len", "(", "i", ".", "embeddings", ")", "\n", "\n", "", "", "batch_len", "=", "len", "(", "batch", ")", "\n", "\n", "np_sents", "=", "np", ".", "zeros", "(", "(", "batch_len", ",", "max_len", ")", ",", "dtype", "=", "'int32'", ")", "\n", "np_lens", "=", "np", ".", "zeros", "(", "(", "batch_len", ",", ")", ",", "dtype", "=", "'int32'", ")", "\n", "\n", "for", "i", ",", "ex", "in", "enumerate", "(", "batch", ")", ":", "\n", "            ", "np_sents", "[", "i", ",", ":", "len", "(", "ex", ".", "embeddings", ")", "]", "=", "ex", ".", "embeddings", "\n", "np_lens", "[", "i", "]", "=", "len", "(", "ex", ".", "embeddings", ")", "\n", "\n", "", "idxs", ",", "lengths", ",", "masks", "=", "Variable", "(", "torch", ".", "from_numpy", "(", "np_sents", ")", ".", "long", "(", ")", ")", ",", "torch", ".", "from_numpy", "(", "np_lens", ")", ".", "float", "(", ")", ".", "long", "(", ")", ",", "self", ".", "compute_mask", "(", "torch", ".", "from_numpy", "(", "np_lens", ")", ".", "long", "(", ")", ")", "\n", "\n", "if", "self", ".", "gpu", ">=", "0", ":", "\n", "            ", "idxs", "=", "idxs", ".", "cuda", "(", ")", "\n", "lengths", "=", "lengths", ".", "cuda", "(", ")", "\n", "masks", "=", "masks", ".", "cuda", "(", ")", "\n", "\n", "", "return", "idxs", ",", "lengths", ",", "masks", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.ParaModel.scoring_function": [[75, 80], ["reload_models.ParaModel.encode", "reload_models.ParaModel.encode", "reload_models.ParaModel.cosine"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.encode", "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.encode"], ["", "def", "scoring_function", "(", "self", ",", "g_idxs1", ",", "g_mask1", ",", "g_lengths1", ",", "g_idxs2", ",", "g_mask2", ",", "g_lengths2", ")", ":", "\n", "\n", "        ", "g1", "=", "self", ".", "encode", "(", "g_idxs1", ",", "g_mask1", ",", "g_lengths1", ")", "\n", "g2", "=", "self", ".", "encode", "(", "g_idxs2", ",", "g_mask2", ",", "g_lengths2", ")", "\n", "return", "self", ".", "cosine", "(", "g1", ",", "g2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.__init__": [[83, 91], ["reload_models.ParaModel.__init__", "torch.Embedding", "torch.Embedding", "torch.Embedding", "len", "reload_models.WordAveraging.cuda"], "methods", ["home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.__init__"], ["    ", "def", "__init__", "(", "self", ",", "args", ",", "vocab", ")", ":", "\n", "        ", "super", "(", "WordAveraging", ",", "self", ")", ".", "__init__", "(", "args", ",", "vocab", ")", "\n", "\n", "self", ".", "vocab", "=", "vocab", "\n", "self", ".", "embedding", "=", "nn", ".", "Embedding", "(", "len", "(", "self", ".", "vocab", ")", ",", "self", ".", "args", ".", "dim", ")", "\n", "\n", "if", "args", ".", "gpu", ">=", "0", ":", "\n", "           ", "self", ".", "cuda", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.WordAveraging.encode": [[92, 97], ["reload_models.WordAveraging.embedding", "reload_models.WordAveraging.sum", "torch.autograd.Variable", "torch.autograd.Variable", "torch.autograd.Variable", "lengths[].float"], "methods", ["None"], ["", "", "def", "encode", "(", "self", ",", "idxs", ",", "mask", ",", "lengths", ")", ":", "\n", "        ", "word_embs", "=", "self", ".", "embedding", "(", "idxs", ")", "\n", "word_embs", "=", "word_embs", "*", "mask", "[", ":", ",", ":", ",", "None", "]", "\n", "g", "=", "word_embs", ".", "sum", "(", "dim", "=", "1", ")", "/", "Variable", "(", "lengths", "[", ":", ",", "None", "]", ".", "float", "(", ")", ")", "\n", "return", "g", "\n", "", "", ""]], "home.repos.pwc.inspect_result.zdou0830_crosslingual_summarization_semantic.sim.reload_models.load_sim_model": [[10, 24], ["torch.load", "torch.load", "torch.load", "reload_models.WordAveraging", "WordAveraging.load_state_dict"], "function", ["None"], ["def", "load_sim_model", "(", "load_file", ")", ":", "\n", "    ", "model", "=", "torch", ".", "load", "(", "load_file", ")", "\n", "\n", "state_dict", "=", "model", "[", "'state_dict'", "]", "\n", "model_args", "=", "model", "[", "'args'", "]", "\n", "vocab", "=", "model", "[", "'vocab'", "]", "\n", "#vocab_fr = model['vocab_fr']", "\n", "optimizer", "=", "model", "[", "'optimizer'", "]", "\n", "epoch", "=", "model", "[", "'epoch'", "]", "\n", "\n", "model", "=", "WordAveraging", "(", "model_args", ",", "vocab", ")", "\n", "model", ".", "load_state_dict", "(", "state_dict", ")", "\n", "\n", "return", "model", "\n", "\n"]]}