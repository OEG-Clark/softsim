{"home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.opts.parse": [[5, 55], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args", "dict", "opts.display_info", "Exception", "os.makedirs", "eval", "setattr", "os.path.isdir"], "function", ["home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.opts.display_info"], ["def", "parse", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", "description", "=", "'BC learning for image classification'", ")", "\n", "\n", "# General settings", "\n", "parser", ".", "add_argument", "(", "'--dataset'", ",", "required", "=", "True", ",", "choices", "=", "[", "'cifar10'", ",", "'cifar100'", "]", ")", "\n", "parser", ".", "add_argument", "(", "'--netType'", ",", "required", "=", "True", ",", "choices", "=", "[", "'convnet'", "]", ")", "\n", "parser", ".", "add_argument", "(", "'--data'", ",", "required", "=", "True", ",", "help", "=", "'Path to dataset'", ")", "\n", "parser", ".", "add_argument", "(", "'--nTrials'", ",", "type", "=", "int", ",", "default", "=", "10", ")", "\n", "parser", ".", "add_argument", "(", "'--save'", ",", "default", "=", "'None'", ",", "help", "=", "'Directory to save the results'", ")", "\n", "parser", ".", "add_argument", "(", "'--gpu'", ",", "type", "=", "int", ",", "default", "=", "0", ")", "\n", "\n", "# Learning settings", "\n", "parser", ".", "add_argument", "(", "'--BC'", ",", "action", "=", "'store_true'", ",", "help", "=", "'BC learning'", ")", "\n", "parser", ".", "add_argument", "(", "'--plus'", ",", "action", "=", "'store_true'", ",", "help", "=", "'Use BC+'", ")", "\n", "parser", ".", "add_argument", "(", "'--nEpochs'", ",", "type", "=", "int", ",", "default", "=", "-", "1", ")", "\n", "parser", ".", "add_argument", "(", "'--LR'", ",", "type", "=", "float", ",", "default", "=", "-", "1", ",", "help", "=", "'Initial learning rate'", ")", "\n", "parser", ".", "add_argument", "(", "'--schedule'", ",", "type", "=", "float", ",", "nargs", "=", "'*'", ",", "default", "=", "-", "1", ",", "help", "=", "'When to divide the LR'", ")", "\n", "parser", ".", "add_argument", "(", "'--warmup'", ",", "type", "=", "int", ",", "default", "=", "-", "1", ",", "help", "=", "'Number of epochs to warm up'", ")", "\n", "parser", ".", "add_argument", "(", "'--batchSize'", ",", "type", "=", "int", ",", "default", "=", "-", "1", ")", "\n", "parser", ".", "add_argument", "(", "'--weightDecay'", ",", "type", "=", "float", ",", "default", "=", "5e-4", ")", "\n", "parser", ".", "add_argument", "(", "'--momentum'", ",", "type", "=", "float", ",", "default", "=", "0.9", ")", "\n", "\n", "opt", "=", "parser", ".", "parse_args", "(", ")", "\n", "if", "opt", ".", "plus", "and", "not", "opt", ".", "BC", ":", "\n", "        ", "raise", "Exception", "(", "'Using only --plus option is invalid.'", ")", "\n", "\n", "# Dataset details", "\n", "", "if", "opt", ".", "dataset", "==", "'cifar10'", ":", "\n", "        ", "opt", ".", "nClasses", "=", "10", "\n", "", "else", ":", "# cifar100", "\n", "        ", "opt", ".", "nClasses", "=", "100", "\n", "\n", "# Default settings", "\n", "", "default_settings", "=", "dict", "(", ")", "\n", "default_settings", "[", "'cifar10'", "]", "=", "{", "\n", "'convnet'", ":", "{", "'nEpochs'", ":", "250", ",", "'LR'", ":", "0.1", ",", "'schedule'", ":", "[", "0.4", ",", "0.6", ",", "0.8", "]", ",", "'warmup'", ":", "0", ",", "'batchSize'", ":", "128", "}", "\n", "}", "\n", "default_settings", "[", "'cifar100'", "]", "=", "{", "\n", "'convnet'", ":", "{", "'nEpochs'", ":", "250", ",", "'LR'", ":", "0.1", ",", "'schedule'", ":", "[", "0.4", ",", "0.6", ",", "0.8", "]", ",", "'warmup'", ":", "0", ",", "'batchSize'", ":", "128", "}", "\n", "}", "\n", "for", "key", "in", "[", "'nEpochs'", ",", "'LR'", ",", "'schedule'", ",", "'warmup'", ",", "'batchSize'", "]", ":", "\n", "        ", "if", "eval", "(", "'opt.{}'", ".", "format", "(", "key", ")", ")", "==", "-", "1", ":", "\n", "            ", "setattr", "(", "opt", ",", "key", ",", "default_settings", "[", "opt", ".", "dataset", "]", "[", "opt", ".", "netType", "]", "[", "key", "]", ")", "\n", "\n", "", "", "if", "opt", ".", "save", "!=", "'None'", "and", "not", "os", ".", "path", ".", "isdir", "(", "opt", ".", "save", ")", ":", "\n", "        ", "os", ".", "makedirs", "(", "opt", ".", "save", ")", "\n", "\n", "", "display_info", "(", "opt", ")", "\n", "\n", "return", "opt", "\n", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.opts.display_info": [[57, 78], ["print", "print", "print", "print", "print", "print", "print", "print", "print", "print", "print", "print"], "function", ["None"], ["", "def", "display_info", "(", "opt", ")", ":", "\n", "    ", "if", "opt", ".", "BC", ":", "\n", "        ", "if", "opt", ".", "plus", ":", "\n", "            ", "learning", "=", "'BC+'", "\n", "", "else", ":", "\n", "            ", "learning", "=", "'BC'", "\n", "", "", "else", ":", "\n", "        ", "learning", "=", "'standard'", "\n", "\n", "", "print", "(", "'+------------------------------+'", ")", "\n", "print", "(", "'| CIFAR classification'", ")", "\n", "print", "(", "'+------------------------------+'", ")", "\n", "print", "(", "'| dataset  : {}'", ".", "format", "(", "opt", ".", "dataset", ")", ")", "\n", "print", "(", "'| netType  : {}'", ".", "format", "(", "opt", ".", "netType", ")", ")", "\n", "print", "(", "'| learning : {}'", ".", "format", "(", "learning", ")", ")", "\n", "print", "(", "'| nEpochs  : {}'", ".", "format", "(", "opt", ".", "nEpochs", ")", ")", "\n", "print", "(", "'| LRInit   : {}'", ".", "format", "(", "opt", ".", "LR", ")", ")", "\n", "print", "(", "'| schedule : {}'", ".", "format", "(", "opt", ".", "schedule", ")", ")", "\n", "print", "(", "'| warmup   : {}'", ".", "format", "(", "opt", ".", "warmup", ")", ")", "\n", "print", "(", "'| batchSize: {}'", ".", "format", "(", "opt", ".", "batchSize", ")", ")", "\n", "print", "(", "'+------------------------------+'", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.main.main": [[17, 23], ["opts.parse", "chainer.cuda.get_device_from_id().use", "range", "print", "main.train", "chainer.cuda.get_device_from_id"], "function", ["home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.opts.parse", "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.train.Trainer.train"], ["def", "main", "(", ")", ":", "\n", "    ", "opt", "=", "opts", ".", "parse", "(", ")", "\n", "chainer", ".", "cuda", ".", "get_device_from_id", "(", "opt", ".", "gpu", ")", ".", "use", "(", ")", "\n", "for", "i", "in", "range", "(", "1", ",", "opt", ".", "nTrials", "+", "1", ")", ":", "\n", "        ", "print", "(", "'+-- Trial {} --+'", ".", "format", "(", "i", ")", ")", "\n", "train", "(", "opt", ",", "i", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.main.train": [[25, 46], ["model.to_gpu", "chainer.optimizers.NesterovAG", "chainer.optimizers.NesterovAG.setup", "chainer.optimizers.NesterovAG.add_hook", "dataset.setup", "train.Trainer", "range", "getattr", "chainer.optimizer.WeightDecay", "train.Trainer.train", "train.Trainer.val", "sys.stderr.write", "sys.stdout.write", "sys.stdout.flush", "chainer.serializers.save_npz", "os.path.join"], "function", ["home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.dataset.setup", "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.dataset.setup", "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.train.Trainer.train", "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.train.Trainer.val"], ["", "", "def", "train", "(", "opt", ",", "trial", ")", ":", "\n", "    ", "model", "=", "getattr", "(", "models", ",", "opt", ".", "netType", ")", "(", "opt", ".", "nClasses", ")", "\n", "model", ".", "to_gpu", "(", ")", "\n", "optimizer", "=", "chainer", ".", "optimizers", ".", "NesterovAG", "(", "lr", "=", "opt", ".", "LR", ",", "momentum", "=", "opt", ".", "momentum", ")", "\n", "optimizer", ".", "setup", "(", "model", ")", "\n", "optimizer", ".", "add_hook", "(", "chainer", ".", "optimizer", ".", "WeightDecay", "(", "opt", ".", "weightDecay", ")", ")", "\n", "train_iter", ",", "val_iter", "=", "dataset", ".", "setup", "(", "opt", ")", "\n", "trainer", "=", "Trainer", "(", "model", ",", "optimizer", ",", "train_iter", ",", "val_iter", ",", "opt", ")", "\n", "\n", "for", "epoch", "in", "range", "(", "1", ",", "opt", ".", "nEpochs", "+", "1", ")", ":", "\n", "        ", "train_loss", ",", "train_top1", "=", "trainer", ".", "train", "(", "epoch", ")", "\n", "val_top1", "=", "trainer", ".", "val", "(", ")", "\n", "sys", ".", "stderr", ".", "write", "(", "'\\r\\033[K'", ")", "\n", "sys", ".", "stdout", ".", "write", "(", "\n", "'| Epoch: {}/{} | Train: LR {}  Loss {:.3f}  top1 {:.2f} | Val: top1 {:.2f}\\n'", ".", "format", "(", "\n", "epoch", ",", "opt", ".", "nEpochs", ",", "trainer", ".", "optimizer", ".", "lr", ",", "train_loss", ",", "train_top1", ",", "val_top1", ")", ")", "\n", "sys", ".", "stdout", ".", "flush", "(", ")", "\n", "\n", "", "if", "opt", ".", "save", "!=", "'None'", ":", "\n", "        ", "chainer", ".", "serializers", ".", "save_npz", "(", "\n", "os", ".", "path", ".", "join", "(", "opt", ".", "save", ",", "'model_trial{}.npz'", ".", "format", "(", "trial", ")", ")", ",", "model", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.train.Trainer.__init__": [[12, 20], ["time.time", "len"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "model", ",", "optimizer", ",", "train_iter", ",", "val_iter", ",", "opt", ")", ":", "\n", "        ", "self", ".", "model", "=", "model", "\n", "self", ".", "optimizer", "=", "optimizer", "\n", "self", ".", "train_iter", "=", "train_iter", "\n", "self", ".", "val_iter", "=", "val_iter", "\n", "self", ".", "opt", "=", "opt", "\n", "self", ".", "n_batches", "=", "(", "len", "(", "train_iter", ".", "dataset", ")", "-", "1", ")", "//", "opt", ".", "batchSize", "+", "1", "\n", "self", ".", "start_time", "=", "time", ".", "time", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.train.Trainer.train": [[21, 58], ["train.Trainer.lr_schedule", "enumerate", "train.Trainer.train_iter.reset", "len", "chainer.dataset.concat_examples", "chainer.dataset.concat_examples", "chainer.dataset.concat_examples", "chainer.dataset.concat_examples", "chainer.Variable", "chainer.Variable", "chainer.Variable", "chainer.Variable", "chainer.Variable", "chainer.Variable", "chainer.Variable", "chainer.Variable", "train.Trainer.optimizer.zero_grads", "train.Trainer.model", "chainer.softmax_cross_entropy.backward", "train.Trainer.optimizer.update", "sys.stderr.write", "sys.stderr.flush", "chainer.cuda.to_gpu", "chainer.cuda.to_gpu", "chainer.cuda.to_gpu", "chainer.cuda.to_gpu", "utils.kl_divergence", "chainer.accuracy", "chainer.accuracy", "chainer.softmax_cross_entropy", "chainer.softmax_cross_entropy", "chainer.accuracy", "chainer.accuracy", "float", "len", "float", "len", "time.time", "utils.to_hms", "utils.to_hms", "chainer.argmax", "chainer.argmax", "len"], "methods", ["home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.train.Trainer.lr_schedule", "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.utils.kl_divergence", "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.utils.to_hms", "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.utils.to_hms"], ["", "def", "train", "(", "self", ",", "epoch", ")", ":", "\n", "        ", "self", ".", "optimizer", ".", "lr", "=", "self", ".", "lr_schedule", "(", "epoch", ")", "\n", "train_loss", "=", "0", "\n", "train_acc", "=", "0", "\n", "for", "i", ",", "batch", "in", "enumerate", "(", "self", ".", "train_iter", ")", ":", "\n", "            ", "x_array", ",", "t_array", "=", "chainer", ".", "dataset", ".", "concat_examples", "(", "batch", ")", "\n", "x", "=", "chainer", ".", "Variable", "(", "cuda", ".", "to_gpu", "(", "x_array", ")", ")", "\n", "t", "=", "chainer", ".", "Variable", "(", "cuda", ".", "to_gpu", "(", "t_array", ")", ")", "\n", "self", ".", "optimizer", ".", "zero_grads", "(", ")", "\n", "y", "=", "self", ".", "model", "(", "x", ")", "\n", "if", "self", ".", "opt", ".", "BC", ":", "\n", "                ", "loss", "=", "utils", ".", "kl_divergence", "(", "y", ",", "t", ")", "\n", "acc", "=", "F", ".", "accuracy", "(", "y", ",", "F", ".", "argmax", "(", "t", ",", "axis", "=", "1", ")", ")", "\n", "", "else", ":", "\n", "                ", "loss", "=", "F", ".", "softmax_cross_entropy", "(", "y", ",", "t", ")", "\n", "acc", "=", "F", ".", "accuracy", "(", "y", ",", "t", ")", "\n", "\n", "", "loss", ".", "backward", "(", ")", "\n", "self", ".", "optimizer", ".", "update", "(", ")", "\n", "train_loss", "+=", "float", "(", "loss", ".", "data", ")", "*", "len", "(", "t", ".", "data", ")", "\n", "train_acc", "+=", "float", "(", "acc", ".", "data", ")", "*", "len", "(", "t", ".", "data", ")", "\n", "\n", "elapsed_time", "=", "time", ".", "time", "(", ")", "-", "self", ".", "start_time", "\n", "progress", "=", "(", "self", ".", "n_batches", "*", "(", "epoch", "-", "1", ")", "+", "i", "+", "1", ")", "*", "1.0", "/", "(", "self", ".", "n_batches", "*", "self", ".", "opt", ".", "nEpochs", ")", "\n", "eta", "=", "elapsed_time", "/", "progress", "-", "elapsed_time", "\n", "\n", "line", "=", "'* Epoch: {}/{} ({}/{}) | Train: LR {} | Time: {} (ETA: {})'", ".", "format", "(", "\n", "epoch", ",", "self", ".", "opt", ".", "nEpochs", ",", "i", "+", "1", ",", "self", ".", "n_batches", ",", "\n", "self", ".", "optimizer", ".", "lr", ",", "utils", ".", "to_hms", "(", "elapsed_time", ")", ",", "utils", ".", "to_hms", "(", "eta", ")", ")", "\n", "sys", ".", "stderr", ".", "write", "(", "'\\r\\033[K'", "+", "line", ")", "\n", "sys", ".", "stderr", ".", "flush", "(", ")", "\n", "\n", "", "self", ".", "train_iter", ".", "reset", "(", ")", "\n", "train_loss", "/=", "len", "(", "self", ".", "train_iter", ".", "dataset", ")", "\n", "train_top1", "=", "100", "*", "(", "1", "-", "train_acc", "/", "len", "(", "self", ".", "train_iter", ".", "dataset", ")", ")", "\n", "\n", "return", "train_loss", ",", "train_top1", "\n", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.train.Trainer.val": [[59, 75], ["train.Trainer.val_iter.reset", "chainer.dataset.concat_examples", "chainer.dataset.concat_examples", "chainer.dataset.concat_examples", "chainer.dataset.concat_examples", "chainer.Variable", "chainer.Variable", "chainer.Variable", "chainer.Variable", "chainer.Variable", "chainer.Variable", "chainer.Variable", "chainer.Variable", "chainer.softmax", "chainer.softmax", "chainer.accuracy", "chainer.accuracy", "chainer.cuda.to_gpu", "chainer.cuda.to_gpu", "chainer.cuda.to_gpu", "chainer.cuda.to_gpu", "train.Trainer.model", "float", "len", "len"], "methods", ["None"], ["", "def", "val", "(", "self", ")", ":", "\n", "        ", "self", ".", "model", ".", "train", "=", "False", "\n", "val_acc", "=", "0", "\n", "for", "batch", "in", "self", ".", "val_iter", ":", "\n", "            ", "x_array", ",", "t_array", "=", "chainer", ".", "dataset", ".", "concat_examples", "(", "batch", ")", "\n", "x", "=", "chainer", ".", "Variable", "(", "cuda", ".", "to_gpu", "(", "x_array", ")", ",", "volatile", "=", "True", ")", "\n", "t", "=", "chainer", ".", "Variable", "(", "cuda", ".", "to_gpu", "(", "t_array", ")", ",", "volatile", "=", "True", ")", "\n", "y", "=", "F", ".", "softmax", "(", "self", ".", "model", "(", "x", ")", ")", "\n", "acc", "=", "F", ".", "accuracy", "(", "y", ",", "t", ")", "\n", "val_acc", "+=", "float", "(", "acc", ".", "data", ")", "*", "len", "(", "t", ".", "data", ")", "\n", "\n", "", "self", ".", "val_iter", ".", "reset", "(", ")", "\n", "self", ".", "model", ".", "train", "=", "True", "\n", "val_top1", "=", "100", "*", "(", "1", "-", "val_acc", "/", "len", "(", "self", ".", "val_iter", ".", "dataset", ")", ")", "\n", "\n", "return", "val_top1", "\n", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.train.Trainer.lr_schedule": [[76, 83], ["numpy.array", "sum", "numpy.power"], "methods", ["None"], ["", "def", "lr_schedule", "(", "self", ",", "epoch", ")", ":", "\n", "        ", "divide_epoch", "=", "np", ".", "array", "(", "[", "self", ".", "opt", ".", "nEpochs", "*", "i", "for", "i", "in", "self", ".", "opt", ".", "schedule", "]", ")", "\n", "decay", "=", "sum", "(", "epoch", ">", "divide_epoch", ")", "\n", "if", "epoch", "<=", "self", ".", "opt", ".", "warmup", ":", "\n", "            ", "decay", "=", "1", "\n", "\n", "", "return", "self", ".", "opt", ".", "LR", "*", "np", ".", "power", "(", "0.1", ",", "decay", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.dataset.ImageDataset.__init__": [[11, 32], ["chainer.datasets.TupleDataset", "dataset.ImageDataset.preprocess_setup", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array"], "methods", ["home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.dataset.ImageDataset.preprocess_setup"], ["    ", "def", "__init__", "(", "self", ",", "images", ",", "labels", ",", "opt", ",", "train", "=", "True", ")", ":", "\n", "        ", "self", ".", "base", "=", "chainer", ".", "datasets", ".", "TupleDataset", "(", "images", ",", "labels", ")", "\n", "self", ".", "opt", "=", "opt", "\n", "self", ".", "train", "=", "train", "\n", "self", ".", "mix", "=", "(", "opt", ".", "BC", "and", "train", ")", "\n", "if", "opt", ".", "dataset", "==", "'cifar10'", ":", "\n", "            ", "if", "opt", ".", "plus", ":", "\n", "                ", "self", ".", "mean", "=", "np", ".", "array", "(", "[", "4.60", ",", "2.24", ",", "-", "6.84", "]", ")", "\n", "self", ".", "std", "=", "np", ".", "array", "(", "[", "55.9", ",", "53.7", ",", "56.5", "]", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "mean", "=", "np", ".", "array", "(", "[", "125.3", ",", "123.0", ",", "113.9", "]", ")", "\n", "self", ".", "std", "=", "np", ".", "array", "(", "[", "63.0", ",", "62.1", ",", "66.7", "]", ")", "\n", "", "", "else", ":", "\n", "            ", "if", "opt", ".", "plus", ":", "\n", "                ", "self", ".", "mean", "=", "np", ".", "array", "(", "[", "7.37", ",", "2.13", ",", "-", "9.50", "]", ")", "\n", "self", ".", "std", "=", "np", ".", "array", "(", "[", "57.6", ",", "54.0", ",", "58.5", "]", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "mean", "=", "np", ".", "array", "(", "[", "129.3", ",", "124.1", ",", "112.4", "]", ")", "\n", "self", ".", "std", "=", "np", ".", "array", "(", "[", "68.2", ",", "65.4", ",", "70.4", "]", ")", "\n", "\n", "", "", "self", ".", "preprocess_funcs", "=", "self", ".", "preprocess_setup", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.dataset.ImageDataset.__len__": [[33, 35], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "base", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.dataset.ImageDataset.preprocess_setup": [[36, 51], ["normalize", "utils.horizontal_flip", "utils.padding", "utils.random_crop", "normalize"], "methods", ["home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.utils.normalize", "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.utils.horizontal_flip", "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.utils.padding", "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.utils.random_crop", "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.utils.normalize"], ["", "def", "preprocess_setup", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "opt", ".", "plus", ":", "\n", "            ", "normalize", "=", "U", ".", "zero_mean", "\n", "", "else", ":", "\n", "            ", "normalize", "=", "U", ".", "normalize", "\n", "", "if", "self", ".", "train", ":", "\n", "            ", "funcs", "=", "[", "normalize", "(", "self", ".", "mean", ",", "self", ".", "std", ")", ",", "\n", "U", ".", "horizontal_flip", "(", ")", ",", "\n", "U", ".", "padding", "(", "4", ")", ",", "\n", "U", ".", "random_crop", "(", "32", ")", ",", "\n", "]", "\n", "", "else", ":", "\n", "            ", "funcs", "=", "[", "normalize", "(", "self", ".", "mean", ",", "self", ".", "std", ")", "]", "\n", "\n", "", "return", "funcs", "\n", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.dataset.ImageDataset.preprocess": [[52, 57], ["f"], "methods", ["None"], ["", "def", "preprocess", "(", "self", ",", "image", ")", ":", "\n", "        ", "for", "f", "in", "self", ".", "preprocess_funcs", ":", "\n", "            ", "image", "=", "f", "(", "image", ")", "\n", "\n", "", "return", "image", "\n", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.dataset.ImageDataset.get_example": [[58, 88], ["dataset.ImageDataset.preprocess", "dataset.ImageDataset.preprocess", "numpy.array", "numpy.eye", "dataset.ImageDataset.preprocess().astype", "numpy.array", "random.random", "numpy.std", "numpy.std", "dataset.ImageDataset.preprocess", "random.randint", "random.randint", "numpy.sqrt", "len", "len"], "methods", ["home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.dataset.ImageDataset.preprocess", "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.dataset.ImageDataset.preprocess", "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.dataset.ImageDataset.preprocess"], ["", "def", "get_example", "(", "self", ",", "i", ")", ":", "\n", "        ", "if", "self", ".", "mix", ":", "# Training phase of BC learning", "\n", "            ", "while", "True", ":", "# Select two training examples", "\n", "                ", "image1", ",", "label1", "=", "self", ".", "base", "[", "random", ".", "randint", "(", "0", ",", "len", "(", "self", ".", "base", ")", "-", "1", ")", "]", "\n", "image2", ",", "label2", "=", "self", ".", "base", "[", "random", ".", "randint", "(", "0", ",", "len", "(", "self", ".", "base", ")", "-", "1", ")", "]", "\n", "if", "label1", "!=", "label2", ":", "\n", "                    ", "break", "\n", "", "", "image1", "=", "self", ".", "preprocess", "(", "image1", ")", "\n", "image2", "=", "self", ".", "preprocess", "(", "image2", ")", "\n", "\n", "# Mix two images", "\n", "r", "=", "np", ".", "array", "(", "random", ".", "random", "(", ")", ")", "\n", "if", "self", ".", "opt", ".", "plus", ":", "\n", "                ", "g1", "=", "np", ".", "std", "(", "image1", ")", "\n", "g2", "=", "np", ".", "std", "(", "image2", ")", "\n", "p", "=", "1.0", "/", "(", "1", "+", "g1", "/", "g2", "*", "(", "1", "-", "r", ")", "/", "r", ")", "\n", "image", "=", "(", "(", "image1", "*", "p", "+", "image2", "*", "(", "1", "-", "p", ")", ")", "/", "np", ".", "sqrt", "(", "p", "**", "2", "+", "(", "1", "-", "p", ")", "**", "2", ")", ")", ".", "astype", "(", "np", ".", "float32", ")", "\n", "", "else", ":", "\n", "                ", "image", "=", "(", "image1", "*", "r", "+", "image2", "*", "(", "1", "-", "r", ")", ")", ".", "astype", "(", "np", ".", "float32", ")", "\n", "\n", "# Mix two labels", "\n", "", "eye", "=", "np", ".", "eye", "(", "self", ".", "opt", ".", "nClasses", ")", "\n", "label", "=", "(", "eye", "[", "label1", "]", "*", "r", "+", "eye", "[", "label2", "]", "*", "(", "1", "-", "r", ")", ")", ".", "astype", "(", "np", ".", "float32", ")", "\n", "\n", "", "else", ":", "# Training phase of standard learning or testing phase", "\n", "            ", "image", ",", "label", "=", "self", ".", "base", "[", "i", "]", "\n", "image", "=", "self", ".", "preprocess", "(", "image", ")", ".", "astype", "(", "np", ".", "float32", ")", "\n", "label", "=", "np", ".", "array", "(", "label", ",", "dtype", "=", "np", ".", "int32", ")", "\n", "\n", "", "return", "image", ",", "label", "\n", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.dataset.setup": [[90, 118], ["dataset.ImageDataset", "dataset.ImageDataset", "chainer.iterators.MultiprocessIterator", "chainer.iterators.SerialIterator", "numpy.concatenate().reshape", "numpy.concatenate", "dataset.setup.unpickle"], "function", ["None"], ["", "", "def", "setup", "(", "opt", ")", ":", "\n", "    ", "def", "unpickle", "(", "fn", ")", ":", "\n", "        ", "with", "open", "(", "fn", ",", "'rb'", ")", "as", "f", ":", "\n", "            ", "data", "=", "cPickle", ".", "load", "(", "f", ")", "\n", "", "return", "data", "\n", "\n", "", "if", "opt", ".", "dataset", "==", "'cifar10'", ":", "\n", "        ", "train", "=", "[", "unpickle", "(", "os", ".", "path", ".", "join", "(", "opt", ".", "data", ",", "'data_batch_{}'", ".", "format", "(", "i", ")", ")", ")", "for", "i", "in", "range", "(", "1", ",", "6", ")", "]", "\n", "train_images", "=", "np", ".", "concatenate", "(", "[", "d", "[", "'data'", "]", "for", "d", "in", "train", "]", ")", ".", "reshape", "(", "(", "-", "1", ",", "3", ",", "32", ",", "32", ")", ")", "\n", "train_labels", "=", "np", ".", "concatenate", "(", "[", "d", "[", "'labels'", "]", "for", "d", "in", "train", "]", ")", "\n", "val", "=", "unpickle", "(", "os", ".", "path", ".", "join", "(", "opt", ".", "data", ",", "'test_batch'", ")", ")", "\n", "val_images", "=", "val", "[", "'data'", "]", ".", "reshape", "(", "(", "-", "1", ",", "3", ",", "32", ",", "32", ")", ")", "\n", "val_labels", "=", "val", "[", "'labels'", "]", "\n", "", "else", ":", "\n", "        ", "train", "=", "unpickle", "(", "os", ".", "path", ".", "join", "(", "opt", ".", "data", ",", "'train'", ")", ")", "\n", "train_images", "=", "train", "[", "'data'", "]", ".", "reshape", "(", "-", "1", ",", "3", ",", "32", ",", "32", ")", "\n", "train_labels", "=", "train", "[", "'fine_labels'", "]", "\n", "val", "=", "unpickle", "(", "os", ".", "path", ".", "join", "(", "opt", ".", "data", ",", "'test'", ")", ")", "\n", "val_images", "=", "val", "[", "'data'", "]", ".", "reshape", "(", "(", "-", "1", ",", "3", ",", "32", ",", "32", ")", ")", "\n", "val_labels", "=", "val", "[", "'fine_labels'", "]", "\n", "\n", "# Iterator setup", "\n", "", "train_data", "=", "ImageDataset", "(", "train_images", ",", "train_labels", ",", "opt", ",", "train", "=", "True", ")", "\n", "val_data", "=", "ImageDataset", "(", "val_images", ",", "val_labels", ",", "opt", ",", "train", "=", "False", ")", "\n", "train_iter", "=", "chainer", ".", "iterators", ".", "MultiprocessIterator", "(", "train_data", ",", "opt", ".", "batchSize", ",", "repeat", "=", "False", ")", "\n", "val_iter", "=", "chainer", ".", "iterators", ".", "SerialIterator", "(", "val_data", ",", "opt", ".", "batchSize", ",", "repeat", "=", "False", ",", "shuffle", "=", "False", ")", "\n", "\n", "return", "train_iter", ",", "val_iter", "\n", "", ""]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.utils.padding": [[6, 11], ["numpy.pad"], "function", ["None"], ["def", "padding", "(", "pad", ")", ":", "\n", "    ", "def", "f", "(", "image", ")", ":", "\n", "        ", "return", "np", ".", "pad", "(", "image", ",", "(", "(", "0", ",", "0", ")", ",", "(", "pad", ",", "pad", ")", ",", "(", "pad", ",", "pad", ")", ")", ",", "'constant'", ")", "\n", "\n", "", "return", "f", "\n", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.utils.random_crop": [[13, 21], ["random.randint", "random.randint"], "function", ["None"], ["", "def", "random_crop", "(", "size", ")", ":", "\n", "    ", "def", "f", "(", "image", ")", ":", "\n", "        ", "_", ",", "h", ",", "w", "=", "image", ".", "shape", "\n", "p", "=", "random", ".", "randint", "(", "0", ",", "h", "-", "size", ")", "\n", "q", "=", "random", ".", "randint", "(", "0", ",", "w", "-", "size", ")", "\n", "return", "image", "[", ":", ",", "p", ":", "p", "+", "size", ",", "q", ":", "q", "+", "size", "]", "\n", "\n", "", "return", "f", "\n", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.utils.horizontal_flip": [[23, 30], ["random.randint"], "function", ["None"], ["", "def", "horizontal_flip", "(", ")", ":", "\n", "    ", "def", "f", "(", "image", ")", ":", "\n", "        ", "if", "random", ".", "randint", "(", "0", ",", "1", ")", ":", "\n", "            ", "image", "=", "image", "[", ":", ",", ":", ",", ":", ":", "-", "1", "]", "\n", "", "return", "image", "\n", "\n", "", "return", "f", "\n", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.utils.normalize": [[32, 37], ["None"], "function", ["None"], ["", "def", "normalize", "(", "mean", ",", "std", ")", ":", "\n", "    ", "def", "f", "(", "image", ")", ":", "\n", "        ", "return", "(", "image", "-", "mean", "[", ":", ",", "None", ",", "None", "]", ")", "/", "std", "[", ":", ",", "None", ",", "None", "]", "\n", "\n", "", "return", "f", "\n", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.utils.zero_mean": [[40, 46], ["numpy.mean"], "function", ["None"], ["", "def", "zero_mean", "(", "mean", ",", "std", ")", ":", "\n", "    ", "def", "f", "(", "image", ")", ":", "\n", "        ", "image_mean", "=", "np", ".", "mean", "(", "image", ",", "keepdims", "=", "True", ")", "\n", "return", "(", "image", "-", "image_mean", "-", "mean", "[", ":", ",", "None", ",", "None", "]", ")", "/", "std", "[", ":", ",", "None", ",", "None", "]", "\n", "\n", "", "return", "f", "\n", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.utils.kl_divergence": [[48, 53], ["chainer.sum", "chainer.sum", "chainer.log", "chainer.log_softmax", "t.data.nonzero", "t.data.nonzero"], "function", ["None"], ["", "def", "kl_divergence", "(", "y", ",", "t", ")", ":", "\n", "    ", "entropy", "=", "-", "F", ".", "sum", "(", "t", "[", "t", ".", "data", ".", "nonzero", "(", ")", "]", "*", "F", ".", "log", "(", "t", "[", "t", ".", "data", ".", "nonzero", "(", ")", "]", ")", ")", "\n", "crossEntropy", "=", "-", "F", ".", "sum", "(", "t", "*", "F", ".", "log_softmax", "(", "y", ")", ")", "\n", "\n", "return", "(", "crossEntropy", "-", "entropy", ")", "/", "y", ".", "shape", "[", "0", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.None.utils.to_hms": [[55, 65], ["int", "int", "int"], "function", ["None"], ["", "def", "to_hms", "(", "time", ")", ":", "\n", "    ", "h", "=", "int", "(", "time", "//", "3600", ")", "\n", "m", "=", "int", "(", "(", "time", "-", "h", "*", "3600", ")", "//", "60", ")", "\n", "s", "=", "int", "(", "time", "-", "h", "*", "3600", "-", "m", "*", "60", ")", "\n", "if", "h", ">", "0", ":", "\n", "        ", "line", "=", "'{}h{:02d}m'", ".", "format", "(", "h", ",", "m", ")", "\n", "", "else", ":", "\n", "        ", "line", "=", "'{}m{:02d}s'", ".", "format", "(", "m", ",", "s", ")", "\n", "\n", "", "return", "line", "\n", "", ""]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.models.convnet.ConvNet.__init__": [[10, 25], ["chainer.Chain.__init__", "chainer.Chain.__init__", "chainer.Chain.__init__", "convbnrelu.ConvBNReLU", "convbnrelu.ConvBNReLU", "convbnrelu.ConvBNReLU", "convbnrelu.ConvBNReLU", "convbnrelu.ConvBNReLU", "convbnrelu.ConvBNReLU", "convbnrelu.ConvBNReLU", "convbnrelu.ConvBNReLU", "chainer.Linear", "chainer.Linear", "chainer.Linear", "chainer.Linear", "chainer.Linear", "chainer.Linear", "chainer.Linear", "chainer.Linear", "chainer.Linear", "chainer.initializers.Uniform", "chainer.initializers.Uniform", "chainer.initializers.Uniform", "chainer.initializers.Uniform", "chainer.initializers.Uniform", "chainer.initializers.Uniform", "chainer.initializers.Uniform", "chainer.initializers.Uniform", "chainer.initializers.Uniform", "math.sqrt", "math.sqrt", "math.sqrt"], "methods", ["home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.models.convbnrelu.ConvBNReLU.__init__", "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.models.convbnrelu.ConvBNReLU.__init__", "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.models.convbnrelu.ConvBNReLU.__init__"], ["    ", "def", "__init__", "(", "self", ",", "n_classes", ")", ":", "\n", "        ", "super", "(", "ConvNet", ",", "self", ")", ".", "__init__", "(", "\n", "conv11", "=", "ConvBNReLU", "(", "3", ",", "64", ",", "3", ",", "pad", "=", "1", ")", ",", "\n", "conv12", "=", "ConvBNReLU", "(", "64", ",", "64", ",", "3", ",", "pad", "=", "1", ")", ",", "\n", "conv21", "=", "ConvBNReLU", "(", "64", ",", "128", ",", "3", ",", "pad", "=", "1", ")", ",", "\n", "conv22", "=", "ConvBNReLU", "(", "128", ",", "128", ",", "3", ",", "pad", "=", "1", ")", ",", "\n", "conv31", "=", "ConvBNReLU", "(", "128", ",", "256", ",", "3", ",", "pad", "=", "1", ")", ",", "\n", "conv32", "=", "ConvBNReLU", "(", "256", ",", "256", ",", "3", ",", "pad", "=", "1", ")", ",", "\n", "conv33", "=", "ConvBNReLU", "(", "256", ",", "256", ",", "3", ",", "pad", "=", "1", ")", ",", "\n", "conv34", "=", "ConvBNReLU", "(", "256", ",", "256", ",", "3", ",", "pad", "=", "1", ")", ",", "\n", "fc4", "=", "L", ".", "Linear", "(", "256", "*", "4", "*", "4", ",", "1024", ",", "initialW", "=", "Uniform", "(", "1.", "/", "math", ".", "sqrt", "(", "256", "*", "4", "*", "4", ")", ")", ")", ",", "\n", "fc5", "=", "L", ".", "Linear", "(", "1024", ",", "1024", ",", "initialW", "=", "Uniform", "(", "1.", "/", "math", ".", "sqrt", "(", "1024", ")", ")", ")", ",", "\n", "fc6", "=", "L", ".", "Linear", "(", "1024", ",", "n_classes", ",", "initialW", "=", "Uniform", "(", "1.", "/", "math", ".", "sqrt", "(", "1024", ")", ")", ")", "\n", ")", "\n", "self", ".", "train", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.models.convnet.ConvNet.__call__": [[26, 45], ["convnet.ConvNet.conv11", "convnet.ConvNet.conv12", "chainer.max_pooling_2d", "chainer.max_pooling_2d", "chainer.max_pooling_2d", "convnet.ConvNet.conv21", "convnet.ConvNet.conv22", "chainer.max_pooling_2d", "chainer.max_pooling_2d", "chainer.max_pooling_2d", "convnet.ConvNet.conv31", "convnet.ConvNet.conv32", "convnet.ConvNet.conv33", "convnet.ConvNet.conv34", "chainer.max_pooling_2d", "chainer.max_pooling_2d", "chainer.max_pooling_2d", "chainer.dropout", "chainer.dropout", "chainer.dropout", "chainer.dropout", "chainer.dropout", "chainer.dropout", "convnet.ConvNet.fc6", "chainer.relu", "chainer.relu", "chainer.relu", "chainer.relu", "chainer.relu", "chainer.relu", "convnet.ConvNet.fc4", "convnet.ConvNet.fc5"], "methods", ["None"], ["", "def", "__call__", "(", "self", ",", "x", ")", ":", "\n", "        ", "h", "=", "self", ".", "conv11", "(", "x", ",", "self", ".", "train", ")", "\n", "h", "=", "self", ".", "conv12", "(", "h", ",", "self", ".", "train", ")", "\n", "h", "=", "F", ".", "max_pooling_2d", "(", "h", ",", "2", ")", "\n", "\n", "h", "=", "self", ".", "conv21", "(", "h", ",", "self", ".", "train", ")", "\n", "h", "=", "self", ".", "conv22", "(", "h", ",", "self", ".", "train", ")", "\n", "h", "=", "F", ".", "max_pooling_2d", "(", "h", ",", "2", ")", "\n", "\n", "h", "=", "self", ".", "conv31", "(", "h", ",", "self", ".", "train", ")", "\n", "h", "=", "self", ".", "conv32", "(", "h", ",", "self", ".", "train", ")", "\n", "h", "=", "self", ".", "conv33", "(", "h", ",", "self", ".", "train", ")", "\n", "h", "=", "self", ".", "conv34", "(", "h", ",", "self", ".", "train", ")", "\n", "h", "=", "F", ".", "max_pooling_2d", "(", "h", ",", "2", ")", "\n", "\n", "h", "=", "F", ".", "dropout", "(", "F", ".", "relu", "(", "self", ".", "fc4", "(", "h", ")", ")", ",", "train", "=", "self", ".", "train", ")", "\n", "h", "=", "F", ".", "dropout", "(", "F", ".", "relu", "(", "self", ".", "fc5", "(", "h", ")", ")", ",", "train", "=", "self", ".", "train", ")", "\n", "\n", "return", "self", ".", "fc6", "(", "h", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.models.convbnrelu.ConvBNReLU.__init__": [[7, 13], ["chainer.initializers.HeNormal", "chainer.initializers.HeNormal", "chainer.initializers.HeNormal", "chainer.initializers.HeNormal", "chainer.initializers.HeNormal", "chainer.initializers.HeNormal", "chainer.initializers.HeNormal", "chainer.initializers.HeNormal", "chainer.initializers.HeNormal", "chainer.Chain.__init__", "chainer.Chain.__init__", "chainer.Chain.__init__", "chainer.Convolution2D", "chainer.Convolution2D", "chainer.Convolution2D", "chainer.BatchNormalization", "chainer.BatchNormalization", "chainer.BatchNormalization"], "methods", ["home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.models.convbnrelu.ConvBNReLU.__init__", "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.models.convbnrelu.ConvBNReLU.__init__", "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.models.convbnrelu.ConvBNReLU.__init__"], ["    ", "def", "__init__", "(", "self", ",", "in_channels", ",", "out_channels", ",", "ksize", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "\n", "initialW", "=", "chainer", ".", "initializers", ".", "HeNormal", "(", ")", ",", "nobias", "=", "True", ")", ":", "\n", "        ", "super", "(", "ConvBNReLU", ",", "self", ")", ".", "__init__", "(", "\n", "conv", "=", "L", ".", "Convolution2D", "(", "in_channels", ",", "out_channels", ",", "ksize", ",", "stride", ",", "pad", ",", "\n", "initialW", "=", "initialW", ",", "nobias", "=", "nobias", ")", ",", "\n", "bn", "=", "L", ".", "BatchNormalization", "(", "out_channels", ",", "eps", "=", "1e-5", ")", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.mil-tokyo_bc_learning_image.models.convbnrelu.ConvBNReLU.__call__": [[15, 20], ["convbnrelu.ConvBNReLU.conv", "convbnrelu.ConvBNReLU.bn", "chainer.relu", "chainer.relu", "chainer.relu"], "methods", ["None"], ["", "def", "__call__", "(", "self", ",", "x", ",", "train", ")", ":", "\n", "        ", "h", "=", "self", ".", "conv", "(", "x", ")", "\n", "h", "=", "self", ".", "bn", "(", "h", ",", "test", "=", "not", "train", ")", "\n", "\n", "return", "F", ".", "relu", "(", "h", ")", "\n", "", "", ""]]}