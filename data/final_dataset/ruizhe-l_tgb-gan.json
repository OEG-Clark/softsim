{"home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.data_loader.load_file": [[9, 39], ["path.strip.strip", "os.path.isfile", "IOError", "path.strip.split", "nibabel.load", "numpy.array().astype", "numpy.genfromtxt", "numpy.load", "PIL.Image.open", "numpy.array", "numpy.array"], "function", ["None"], ["def", "load_file", "(", "path", ",", "dtype", "=", "np", ".", "float32", ")", ":", "\n", "# Since there are some errors for catching exception, now just use if", "\n", "    ", "path", "=", "path", ".", "strip", "(", ")", "\n", "assert", "os", ".", "path", ".", "isfile", "(", "path", ")", ",", "'File {} not found!'", ".", "format", "(", "path", ")", "\n", "suffix", "=", "path", ".", "split", "(", "'.'", ")", "[", "-", "1", "]", "\n", "# Nifty load", "\n", "if", "suffix", "in", "[", "'gz'", ",", "'nii'", "]", ":", "\n", "        ", "data", "=", "nib", ".", "load", "(", "path", ")", "\n", "return", "np", ".", "array", "(", "data", ".", "dataobj", ")", ".", "astype", "(", "dtype", ")", "\n", "\n", "# text to ndarray", "\n", "", "if", "suffix", "==", "'txt'", ":", "\n", "        ", "data", "=", "np", ".", "genfromtxt", "(", "path", ",", "dtype", ")", "\n", "return", "data", "\n", "\n", "# npy load", "\n", "", "if", "suffix", "==", "'npy'", ":", "\n", "        ", "data", "=", "np", ".", "load", "(", "path", ")", "\n", "return", "data", "\n", "\n", "# PIL load", "\n", "", "try", ":", "\n", "        ", "data", "=", "Image", ".", "open", "(", "path", ")", "\n", "", "except", ":", "\n", "        ", "pass", "\n", "", "else", ":", "\n", "        ", "return", "np", ".", "array", "(", "data", ",", "dtype", ")", "\n", "\n", "\n", "", "raise", "IOError", "(", "'Invalid data type: {}'", "%", "path", ")", "", "", ""]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_saver.save_str": [[7, 10], ["open", "f.write", "utils.util.dict_to_str"], "function", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.dict_to_str"], ["def", "save_str", "(", "data_dict", ",", "filename", ",", "idx", ")", ":", "\n", "    ", "with", "open", "(", "filename", ",", "'a+'", ")", "as", "f", ":", "\n", "        ", "f", ".", "write", "(", "'{}: {}\\n'", ".", "format", "(", "idx", ",", "U", ".", "dict_to_str", "(", "data_dict", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_saver.save_img": [[11, 20], ["os.path.exists", "os.makedirs", "numpy.concatenate", "PIL.Image.fromarray().save", "PIL.Image.fromarray"], "function", ["None"], ["", "", "def", "save_img", "(", "data_dict", ",", "filepath", ",", "idx", ")", ":", "\n", "    ", "if", "data_dict", "is", "None", "or", "not", "data_dict", ":", "\n", "        ", "return", "\n", "", "if", "not", "os", ".", "path", ".", "exists", "(", "filepath", ")", ":", "\n", "        ", "os", ".", "makedirs", "(", "filepath", ")", "\n", "", "for", "k", "in", "data_dict", ":", "\n", "        ", "imgs", "=", "data_dict", "[", "k", "]", "\n", "imgs", "=", "np", ".", "concatenate", "(", "imgs", ",", "0", ")", "\n", "Image", ".", "fromarray", "(", "imgs", ")", ".", "save", "(", "'{}/idx_{}_{}.png'", ".", "format", "(", "filepath", ",", "idx", ",", "k", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.process_methods.min_max": [[10, 13], ["numpy.min", "numpy.max", "numpy.min"], "function", ["None"], ["def", "min_max", "(", "x", ")", ":", "\n", "    ", "_x", "=", "(", "x", "-", "np", ".", "min", "(", "x", ")", ")", "/", "(", "np", ".", "max", "(", "x", ")", "-", "np", ".", "min", "(", "x", ")", ")", "\n", "return", "_x", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.process_methods.zero_mean": [[14, 17], ["numpy.std", "numpy.mean"], "function", ["None"], ["", "def", "zero_mean", "(", "x", ")", ":", "\n", "    ", "_x", "=", "(", "x", "-", "np", ".", "mean", "(", "x", ")", ")", "/", "np", ".", "std", "(", "x", ")", "\n", "return", "_x", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.process_methods.median_mean": [[18, 21], ["numpy.std", "numpy.median"], "function", ["None"], ["", "def", "median_mean", "(", "x", ")", ":", "\n", "    ", "_x", "=", "(", "x", "-", "np", ".", "median", "(", "x", ")", ")", "/", "np", ".", "std", "(", "x", ")", "\n", "return", "_x", "\n", "# ----------------------------------------------------", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.process_methods.one_hot": [[24, 39], ["type", "numpy.zeros", "range", "type", "numpy.zeros", "range", "Exception", "numpy.max", "numpy.min", "list", "numpy.min", "numpy.min", "len", "numpy.all", "list", "len"], "function", ["None"], ["", "def", "one_hot", "(", "x", ",", "n_class", ")", ":", "\n", "    ", "if", "type", "(", "n_class", ")", "is", "int", ":", "\n", "        ", "class_interval", "=", "(", "np", ".", "max", "(", "x", ")", "-", "np", ".", "min", "(", "x", ")", ")", "/", "(", "n_class", "-", "1", ")", "\n", "x_", "=", "np", ".", "zeros", "(", "list", "(", "x", ".", "shape", ")", "+", "[", "n_class", "]", ")", "\n", "for", "i", "in", "range", "(", "n_class", ")", ":", "\n", "            ", "cur_baseline", "=", "np", ".", "min", "(", "x", ")", "+", "class_interval", "*", "(", "i", "-", "0.5", ")", "\n", "cur_topline", "=", "np", ".", "min", "(", "x", ")", "+", "class_interval", "*", "(", "i", "+", "0.5", ")", "\n", "x_", "[", "...", ",", "i", "]", "[", "np", ".", "all", "(", "[", "x", ">=", "cur_baseline", ",", "x", "<", "cur_topline", "]", ",", "0", ")", "]", "=", "1", "\n", "", "", "elif", "type", "(", "n_class", ")", "in", "[", "list", ",", "tuple", ",", "np", ".", "ndarray", "]", ":", "\n", "        ", "x_", "=", "np", ".", "zeros", "(", "list", "(", "x", ".", "shape", ")", "+", "[", "len", "(", "n_class", ")", "]", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "n_class", ")", ")", ":", "\n", "            ", "x_", "[", "...", ",", "i", "]", "[", "x", "==", "n_class", "[", "i", "]", "]", "=", "1", "\n", "", "", "else", ":", "\n", "        ", "raise", "Exception", "(", "'Wrong type of n_class.'", ")", "\n", "", "return", "x_", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.process_methods.channel_check": [[40, 48], ["numpy.expand_dims", "numpy.reshape", "list"], "function", ["None"], ["", "def", "channel_check", "(", "x", ",", "n_channel", ")", ":", "\n", "    ", "_x", "=", "x", "\n", "if", "not", "x", ".", "shape", ":", "\n", "        ", "_x", "=", "np", ".", "expand_dims", "(", "_x", ",", "-", "1", ")", "\n", "", "elif", "x", ".", "shape", "[", "-", "1", "]", "!=", "n_channel", ":", "\n", "        ", "assert", "n_channel", "==", "1", "and", "x", ".", "shape", "[", "-", "1", "]", "!=", "3", ",", "'Expect channel {}, actual shape {}.'", ".", "format", "(", "n_channel", ",", "x", ".", "shape", ")", "\n", "_x", "=", "np", ".", "reshape", "(", "x", ",", "list", "(", "x", ".", "shape", ")", "+", "[", "1", "]", ")", "\n", "", "return", "_x", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.process_methods.rgb2gray": [[52, 56], ["numpy.dot"], "function", ["None"], ["", "def", "rgb2gray", "(", "x", ")", ":", "\n", "    ", "assert", "x", ".", "shape", "[", "-", "1", "]", "==", "3", ",", "'Not RGB image!'", "\n", "_x", "=", "np", ".", "dot", "(", "x", "[", "...", ",", ":", "3", "]", ",", "[", "0.299", ",", "0.587", ",", "0.114", "]", ")", "\n", "return", "_x", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.process_methods.resize2d": [[57, 62], ["cv2.resize"], "function", ["None"], ["", "def", "resize2d", "(", "x", ",", "new_size", ")", ":", "\n", "    ", "if", "new_size", "is", "None", ":", "\n", "        ", "return", "x", "\n", "", "_x", "=", "cv2", ".", "resize", "(", "x", ",", "new_size", "[", ":", ":", "-", "1", "]", ")", "\n", "return", "_x", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.process_methods.resize3d": [[63, 73], ["scipy.zoom", "numpy.all", "numpy.array"], "function", ["None"], ["", "def", "resize3d", "(", "x", ",", "new_size", ")", ":", "\n", "    ", "if", "new_size", "is", "None", ":", "\n", "        ", "return", "x", "\n", "", "sx", "=", "x", ".", "shape", "[", "0", "]", "\n", "sy", "=", "x", ".", "shape", "[", "1", "]", "\n", "sz", "=", "x", ".", "shape", "[", "2", "]", "\n", "zoom", "=", "[", "new_size", "[", "0", "]", "/", "sx", ",", "new_size", "[", "1", "]", "/", "sy", ",", "new_size", "[", "2", "]", "/", "sz", "]", "\n", "_x", "=", "nd", ".", "zoom", "(", "x", ",", "zoom", "=", "zoom", ")", "\n", "assert", "np", ".", "all", "(", "_x", ".", "shape", "[", "0", ":", "3", "]", "==", "np", ".", "array", "(", "new_size", ")", ")", ",", "'Fail to resize 3d image: expect {}, got {}.'", ".", "format", "(", "new_size", ",", "_x", ".", "shape", "[", "0", ":", "3", "]", ")", "\n", "return", "_x", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.process_methods.dencecrf": [[74, 105], ["numpy.array", "numpy.array", "np.transpose.reshape", "numpy.transpose", "pydensecrf.DenseCRF", "dcrf.DenseCRF.setUnaryEnergy", "pydensecrf.utils.create_pairwise_gaussian", "pydensecrf.utils.create_pairwise_bilateral", "dcrf.DenseCRF.addPairwiseEnergy", "dcrf.DenseCRF.addPairwiseEnergy", "dcrf.DenseCRF.inference", "numpy.transpose", "numpy.reshape", "len", "len", "numpy.prod", "np.transpose.copy", "len"], "function", ["None"], ["", "def", "dencecrf", "(", "x", ",", "y", ",", "nlabels", ",", "w1", ",", "w2", ",", "alpha", ",", "beta", ",", "gamma", ",", "iteration", "=", "5", ")", ":", "\n", "\n", "    ", "_x", "=", "np", ".", "array", "(", "x", ")", "\n", "_y", "=", "np", ".", "array", "(", "y", ",", "np", ".", "float32", ")", "\n", "\n", "assert", "len", "(", "_x", ".", "shape", ")", "==", "len", "(", "_y", ".", "shape", ")", ",", "'Shape of x and y should be (..., nchannels), (..., nlabels)'", "\n", "assert", "_y", ".", "shape", "[", "-", "1", "]", "==", "nlabels", ",", "'Expect y.shape (...,{}), got {}'", ".", "format", "(", "nlabels", ",", "_y", ".", "shape", ")", "\n", "\n", "_y", "=", "_y", ".", "reshape", "(", "(", "-", "1", ",", "nlabels", ")", ")", "\n", "_y", "=", "np", ".", "transpose", "(", "_y", ",", "(", "1", ",", "0", ")", ")", "\n", "\n", "d", "=", "dcrf", ".", "DenseCRF", "(", "np", ".", "prod", "(", "_x", ".", "shape", "[", "0", ":", "-", "1", "]", ")", ",", "nlabels", ")", "\n", "d", ".", "setUnaryEnergy", "(", "_y", ".", "copy", "(", "order", "=", "'C'", ")", ")", "\n", "\n", "imgdim", "=", "len", "(", "_x", ".", "shape", ")", "-", "1", "\n", "\n", "gamma", "=", "(", "gamma", ",", ")", "*", "imgdim", "\n", "alpha", "=", "(", "alpha", ",", ")", "*", "imgdim", "\n", "beta", "=", "(", "beta", ",", ")", "*", "_x", ".", "shape", "[", "-", "1", "]", "\n", "\n", "featG", "=", "create_pairwise_gaussian", "(", "gamma", ",", "_x", ".", "shape", "[", "0", ":", "-", "1", "]", ")", "# g", "\n", "featB", "=", "create_pairwise_bilateral", "(", "alpha", ",", "beta", ",", "_x", ",", "imgdim", ")", "#a b", "\n", "\n", "d", ".", "addPairwiseEnergy", "(", "featG", ",", "w2", ")", "# w2", "\n", "d", ".", "addPairwiseEnergy", "(", "featB", ",", "w1", ")", "# w1", "\n", "\n", "out", "=", "d", ".", "inference", "(", "iteration", ")", "\n", "out", "=", "np", ".", "transpose", "(", "out", ",", "(", "1", ",", "0", ")", ")", "\n", "out", "=", "np", ".", "reshape", "(", "out", ",", "y", ".", "shape", ")", "\n", "\n", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.softmax": [[5, 8], ["numpy.exp", "numpy.sum", "numpy.max"], "function", ["None"], ["def", "softmax", "(", "prob_map", ",", "axis", "=", "-", "1", ")", ":", "\n", "    ", "e", "=", "np", ".", "exp", "(", "prob_map", "-", "np", ".", "max", "(", "prob_map", ")", ")", "\n", "return", "e", "/", "np", ".", "sum", "(", "e", ",", "axis", ",", "keepdims", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.cross_entropy": [[9, 13], ["tuple", "range", "numpy.sum", "numpy.ndim", "numpy.log"], "function", ["None"], ["", "def", "cross_entropy", "(", "pred", ",", "gt", ",", "epsilon", "=", "1e-9", ")", ":", "\n", "    ", "axis", "=", "tuple", "(", "range", "(", "np", ".", "ndim", "(", "pred", ")", "-", "1", ")", ")", "# if np.ndim(pred) > 1 else -1", "\n", "ce", "=", "-", "np", ".", "sum", "(", "gt", "*", "np", ".", "log", "(", "pred", "+", "epsilon", ")", ",", "axis", ")", "/", "pred", ".", "shape", "[", "0", "]", "\n", "return", "ce", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.mean_squared_error": [[14, 19], ["numpy.mean", "numpy.ndim", "numpy.expand_dims", "numpy.square"], "function", ["None"], ["", "def", "mean_squared_error", "(", "pred", ",", "gt", ")", ":", "\n", "    ", "if", "np", ".", "ndim", "(", "gt", ")", "<", "2", ":", "\n", "        ", "gt", "=", "np", ".", "expand_dims", "(", "gt", ",", "-", "1", ")", "\n", "", "mse", "=", "np", ".", "mean", "(", "np", ".", "square", "(", "pred", "-", "gt", ")", ",", "-", "1", ")", "\n", "return", "mse", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.true_positive": [[20, 23], ["tuple", "numpy.sum", "range", "numpy.logical_and", "numpy.ndim"], "function", ["None"], ["", "def", "true_positive", "(", "pred", ",", "gt", ")", ":", "\n", "    ", "axis", "=", "tuple", "(", "range", "(", "1", ",", "np", ".", "ndim", "(", "pred", ")", "-", "1", ")", ")", "# if np.ndim(pred) > 1 else -1", "\n", "return", "np", ".", "sum", "(", "np", ".", "logical_and", "(", "pred", "==", "gt", ",", "gt", "==", "1", ")", ",", "axis", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.true_negative": [[24, 27], ["tuple", "numpy.sum", "range", "numpy.logical_and", "numpy.ndim"], "function", ["None"], ["", "def", "true_negative", "(", "pred", ",", "gt", ")", ":", "\n", "    ", "axis", "=", "tuple", "(", "range", "(", "1", ",", "np", ".", "ndim", "(", "pred", ")", "-", "1", ")", ")", "# if np.ndim(pred) > 1 else -1", "\n", "return", "np", ".", "sum", "(", "np", ".", "logical_and", "(", "pred", "==", "gt", ",", "gt", "==", "0", ")", ",", "axis", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.false_positive": [[28, 31], ["tuple", "numpy.sum", "range", "numpy.logical_and", "numpy.ndim"], "function", ["None"], ["", "def", "false_positive", "(", "pred", ",", "gt", ")", ":", "\n", "    ", "axis", "=", "tuple", "(", "range", "(", "1", ",", "np", ".", "ndim", "(", "pred", ")", "-", "1", ")", ")", "# if np.ndim(pred) > 1 else -1", "\n", "return", "np", ".", "sum", "(", "np", ".", "logical_and", "(", "pred", "!=", "gt", ",", "pred", "==", "1", ")", ",", "axis", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.false_negative": [[32, 35], ["tuple", "numpy.sum", "range", "numpy.logical_and", "numpy.ndim"], "function", ["None"], ["", "def", "false_negative", "(", "pred", ",", "gt", ")", ":", "\n", "    ", "axis", "=", "tuple", "(", "range", "(", "1", ",", "np", ".", "ndim", "(", "pred", ")", "-", "1", ")", ")", "# if np.ndim(pred) > 1 else -1", "\n", "return", "np", ".", "sum", "(", "np", ".", "logical_and", "(", "pred", "!=", "gt", ",", "pred", "==", "0", ")", ",", "axis", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.precision": [[36, 40], ["eval_methods.true_positive", "eval_methods.false_positive"], "function", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.true_positive", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.false_positive"], ["", "def", "precision", "(", "pred", ",", "gt", ",", "epsilon", "=", "1e-9", ")", ":", "\n", "    ", "tp", "=", "true_positive", "(", "pred", ",", "gt", ")", "\n", "fp", "=", "false_positive", "(", "pred", ",", "gt", ")", "\n", "return", "tp", "/", "(", "tp", "+", "fp", "+", "epsilon", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.recall": [[41, 45], ["eval_methods.true_positive", "eval_methods.false_negative"], "function", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.true_positive", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.false_negative"], ["", "def", "recall", "(", "pred", ",", "gt", ",", "epsilon", "=", "1e-9", ")", ":", "\n", "    ", "tp", "=", "true_positive", "(", "pred", ",", "gt", ")", "\n", "fn", "=", "false_negative", "(", "pred", ",", "gt", ")", "\n", "return", "tp", "/", "(", "tp", "+", "fn", "+", "epsilon", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.sensitivity": [[46, 48], ["eval_methods.recall"], "function", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.recall"], ["", "def", "sensitivity", "(", "pred", ",", "gt", ",", "epsilon", "=", "1e-9", ")", ":", "\n", "    ", "return", "recall", "(", "pred", ",", "gt", ",", "epsilon", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.specificity": [[49, 53], ["eval_methods.true_negative", "eval_methods.false_positive"], "function", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.true_negative", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.false_positive"], ["", "def", "specificity", "(", "pred", ",", "gt", ",", "epsilon", "=", "1e-9", ")", ":", "\n", "    ", "tn", "=", "true_negative", "(", "pred", ",", "gt", ")", "\n", "fp", "=", "false_positive", "(", "pred", ",", "gt", ")", "\n", "return", "tn", "/", "(", "tn", "+", "fp", "+", "epsilon", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.accuracy": [[54, 60], ["tuple", "numpy.mean", "range", "numpy.equal", "numpy.ndim"], "function", ["None"], ["", "def", "accuracy", "(", "pred", ",", "gt", ")", ":", "\n", "    ", "\"\"\" equal(pred, gt) / all(pred, gt)\n        (tp + tn) / (tp + tn + fp + fn)\n    \"\"\"", "\n", "axis", "=", "tuple", "(", "range", "(", "1", ",", "np", ".", "ndim", "(", "pred", ")", ")", ")", "# if np.ndim(pred) > 1 else -1", "\n", "return", "np", ".", "mean", "(", "np", ".", "equal", "(", "pred", ",", "gt", ")", ",", "axis", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.dice_coefficient": [[61, 69], ["tuple", "numpy.sum", "numpy.sum", "range", "numpy.ndim"], "function", ["None"], ["", "def", "dice_coefficient", "(", "pred", ",", "gt", ",", "epsilon", "=", "1e-9", ")", ":", "\n", "    ", "\"\"\" 2 * intersection(pred, gt) / (pred + gt) \n        2 * tp / (2*tp + fp + fn)\n    \"\"\"", "\n", "axis", "=", "tuple", "(", "range", "(", "1", ",", "np", ".", "ndim", "(", "pred", ")", "-", "1", ")", ")", "# if np.ndim(pred) > 1 else -1", "\n", "intersection", "=", "np", ".", "sum", "(", "pred", "*", "gt", ",", "axis", ")", "\n", "sum_", "=", "np", ".", "sum", "(", "pred", "+", "gt", ",", "axis", ")", "\n", "return", "2", "*", "intersection", "/", "(", "sum_", "+", "epsilon", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.iou": [[70, 78], ["tuple", "numpy.sum", "range", "numpy.sum", "numpy.ndim"], "function", ["None"], ["", "def", "iou", "(", "pred", ",", "gt", ",", "epsilon", "=", "1e-9", ")", ":", "\n", "    ", "\"\"\" intersection(pred, gt) / union(pred, gt)\n        tp / (tp + fp + fn)\n    \"\"\"", "\n", "axis", "=", "tuple", "(", "range", "(", "1", ",", "np", ".", "ndim", "(", "pred", ")", "-", "1", ")", ")", "# if np.ndim(pred) > 1 else -1", "\n", "intersection", "=", "np", ".", "sum", "(", "pred", "*", "gt", ",", "axis", ")", "\n", "union", "=", "np", ".", "sum", "(", "pred", "+", "gt", ",", "axis", ")", "-", "intersection", "\n", "return", "intersection", "/", "(", "union", "+", "epsilon", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.auc": [[79, 81], ["None"], "function", ["None"], ["", "def", "auc", "(", "pred", ",", "gt", ")", ":", "\n", "    ", "pass", "\n", "# ----------------------------------------------------------", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.dict_append": [[3, 15], ["old_dict[].append"], "function", ["None"], ["def", "dict_append", "(", "old_dict", ",", "new_dict", ")", ":", "\n", "    ", "if", "new_dict", "is", "None", ":", "\n", "        ", "return", "old_dict", "\n", "", "if", "old_dict", "is", "None", "or", "not", "old_dict", ":", "\n", "        ", "for", "key", "in", "new_dict", ":", "\n", "            ", "old_dict", "[", "key", "]", "=", "[", "]", "\n", "\n", "", "", "for", "key", "in", "old_dict", ":", "\n", "        ", "assert", "key", "in", "new_dict", ",", "'No key \"{}\" in old dict!'", ".", "format", "(", "key", ")", "\n", "old_dict", "[", "key", "]", ".", "append", "(", "new_dict", "[", "key", "]", ")", "\n", "\n", "", "return", "old_dict", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.dict_concat": [[16, 31], ["numpy.concatenate", "numpy.ndim", "numpy.ndim"], "function", ["None"], ["", "def", "dict_concat", "(", "old_dict", ",", "new_dict", ",", "axis", "=", "0", ")", ":", "\n", "    ", "if", "new_dict", "is", "None", ":", "\n", "        ", "return", "old_dict", "\n", "", "if", "old_dict", "is", "None", "or", "not", "old_dict", ":", "\n", "        ", "old_dict", "=", "new_dict", "\n", "", "else", ":", "\n", "        ", "for", "key", "in", "old_dict", ":", "\n", "            ", "assert", "key", "in", "new_dict", ",", "'No key \"{}\" in old dict!'", ".", "format", "(", "key", ")", "\n", "old_v", "=", "old_dict", "[", "key", "]", "\n", "new_v", "=", "new_dict", "[", "key", "]", "\n", "old_v", "=", "[", "old_v", "]", "if", "np", ".", "ndim", "(", "old_v", ")", "==", "0", "else", "old_v", "\n", "new_v", "=", "[", "new_v", "]", "if", "np", ".", "ndim", "(", "new_v", ")", "==", "0", "else", "new_v", "\n", "old_dict", "[", "key", "]", "=", "np", ".", "concatenate", "(", "(", "old_v", ",", "new_v", ")", ",", "axis", ")", "\n", "\n", "", "", "return", "old_dict", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.dict_add": [[33, 42], ["None"], "function", ["None"], ["", "def", "dict_add", "(", "old_dict", ",", "new_dict", ")", ":", "\n", "    ", "if", "new_dict", "is", "None", ":", "\n", "        ", "return", "old_dict", "\n", "", "if", "old_dict", "is", "None", ":", "\n", "        ", "old_dict", "=", "new_dict", "\n", "", "else", ":", "\n", "        ", "for", "key", "in", "new_dict", ":", "\n", "            ", "old_dict", "[", "key", "]", "+=", "new_dict", "[", "key", "]", "\n", "", "", "return", "old_dict", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.dict_list2arr": [[43, 46], ["numpy.array"], "function", ["None"], ["", "def", "dict_list2arr", "(", "d", ")", ":", "\n", "    ", "for", "key", "in", "d", ":", "\n", "        ", "d", "[", "key", "]", "=", "np", ".", "array", "(", "d", "[", "key", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.dict_to_str": [[47, 67], ["numpy.array", "evaluation_dict.get", "numpy.mean", "numpy.mean", "type", "numpy.ndim"], "function", ["None"], ["", "", "def", "dict_to_str", "(", "evaluation_dict", ",", "axis", "=", "0", ")", ":", "\n", "    ", "if", "evaluation_dict", "is", "None", "or", "not", "evaluation_dict", ":", "\n", "        ", "return", "''", "\n", "", "o_s", "=", "''", "\n", "for", "key", "in", "evaluation_dict", ":", "\n", "        ", "value", "=", "np", ".", "array", "(", "evaluation_dict", ".", "get", "(", "key", ")", ")", "\n", "if", "value", ".", "size", ">=", "2", ":", "\n", "            ", "mean", "=", "np", ".", "mean", "(", "value", ",", "axis", ")", "#[1:]", "\n", "", "else", ":", "\n", "            ", "mean", "=", "np", ".", "mean", "(", "value", ",", "axis", ")", "\n", "", "if", "type", "(", "mean", ")", "in", "[", "int", ",", "float", ",", "np", ".", "float32", ",", "np", ".", "float64", "]", ":", "\n", "            ", "mean", "=", "[", "mean", "]", "\n", "", "if", "np", ".", "ndim", "(", "mean", ")", ">", "1", ":", "\n", "            ", "continue", "\n", "", "mean", "=", "[", "'%.4f'", "%", "m", "for", "m", "in", "mean", "]", "\n", "o_s", "+=", "'%s: '", "%", "key", "\n", "for", "s", "in", "mean", ":", "\n", "            ", "o_s", "+=", "'%s '", "%", "s", "\n", "", "o_s", "+=", "'  '", "\n", "", "return", "o_s", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.recale_array": [[69, 79], ["numpy.array", "np.array.astype", "numpy.min", "numpy.max"], "function", ["None"], ["", "def", "recale_array", "(", "array", ",", "nmin", "=", "None", ",", "nmax", "=", "None", ",", "tmin", "=", "0", ",", "tmax", "=", "255", ",", "dtype", "=", "np", ".", "uint8", ")", ":", "\n", "    ", "array", "=", "np", ".", "array", "(", "array", ")", "\n", "if", "nmin", "is", "None", ":", "\n", "        ", "nmin", "=", "np", ".", "min", "(", "array", ")", "\n", "", "array", "=", "array", "-", "nmin", "\n", "if", "nmax", "is", "None", ":", "\n", "        ", "nmax", "=", "np", ".", "max", "(", "array", ")", "+", "1e-9", "\n", "", "array", "=", "array", "/", "nmax", "\n", "array", "=", "(", "array", "*", "(", "tmax", "-", "tmin", ")", ")", "-", "tmin", "\n", "return", "array", ".", "astype", "(", "dtype", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.gray2rgb": [[80, 82], ["numpy.stack"], "function", ["None"], ["", "def", "gray2rgb", "(", "img", ")", ":", "\n", "    ", "return", "np", ".", "stack", "(", "(", "img", ",", ")", "*", "3", ",", "axis", "=", "-", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.combine_2d_imgs_from_tensor": [[83, 99], ["numpy.concatenate", "util.recale_array", "gray2rgb.reshape", "imgs.append", "util.gray2rgb", "len", "len", "len"], "function", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.recale_array", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.gray2rgb"], ["", "def", "combine_2d_imgs_from_tensor", "(", "img_list", ")", ":", "\n", "    ", "imgs", "=", "[", "]", "\n", "combined", "=", "None", "\n", "for", "im", "in", "img_list", ":", "\n", "        ", "assert", "len", "(", "im", ".", "shape", ")", "==", "3", "or", "len", "(", "im", ".", "shape", ")", "==", "4", "and", "im", ".", "shape", "[", "-", "1", "]", "in", "[", "1", ",", "3", "]", ",", "'Only accept gray or rgb 2d images with shape [n, x, y] or  [n, x, y, c], where c = 1 (gray) or 3 (rgb).'", "\n", "if", "im", ".", "shape", "[", "-", "1", "]", "!=", "3", ":", "\n", "            ", "if", "len", "(", "im", ".", "shape", ")", "==", "4", ":", "\n", "                ", "im", "=", "im", "[", "...", ",", "0", "]", "\n", "", "im", "=", "gray2rgb", "(", "im", ")", "\n", "\n", "", "im", "=", "recale_array", "(", "im", ")", "\n", "im", "=", "im", ".", "reshape", "(", "-", "1", ",", "im", ".", "shape", "[", "-", "2", "]", ",", "im", ".", "shape", "[", "-", "1", "]", ")", "\n", "imgs", ".", "append", "(", "im", ")", "\n", "", "combined", "=", "np", ".", "concatenate", "(", "imgs", ",", "1", ")", "\n", "return", "combined", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.cls_model.ClsModel.__init__": [[13, 20], ["models.model.Model.__init__"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg._UpSampling.__init__"], ["    ", "def", "__init__", "(", "self", ",", "net", ",", "x_suffix", ",", "y_suffix", ",", "m_suffix", "=", "None", ",", "dropout", "=", "0", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "net", ")", "\n", "self", ".", "_x_suffix", "=", "x_suffix", "\n", "self", ".", "_y_suffix", "=", "y_suffix", "\n", "self", ".", "_m_suffix", "=", "m_suffix", "\n", "\n", "self", ".", "dropout", "=", "dropout", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.cls_model.ClsModel.get_grads": [[21, 29], ["tape.gradient", "tensorflow.GradientTape", "cls_model.ClsModel.net", "cls_model.ClsModel._get_loss"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.cls_model.ClsModel._get_loss"], ["", "def", "get_grads", "(", "self", ",", "data_dict", ")", ":", "\n", "        ", "xs", "=", "data_dict", "[", "self", ".", "_x_suffix", "]", "\n", "\n", "with", "tf", ".", "GradientTape", "(", ")", "as", "tape", ":", "\n", "            ", "logits", "=", "self", ".", "net", "(", "xs", ",", "self", ".", "dropout", ",", "True", ")", "\n", "loss", "=", "self", ".", "_get_loss", "(", "logits", ",", "data_dict", ")", "\n", "", "grads", "=", "tape", ".", "gradient", "(", "loss", ",", "self", ".", "net", ".", "trainable_variables", ")", "\n", "return", "grads", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.cls_model.ClsModel.eval": [[30, 57], ["cls_model.ClsModel.net", "cls_model.ClsModel._get_loss", "utils.eval_methods.mean_squared_error", "kwargs.get", "kwargs.get", "kwargs.get", "eval_results.update", "eval_results.update", "eval_results.update", "cls_model.ClsModel._mc_eval"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.cls_model.ClsModel._get_loss", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_methods.mean_squared_error", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.cls_model.ClsModel._mc_eval"], ["", "def", "eval", "(", "self", ",", "data_dict", ",", "**", "kwargs", ")", ":", "\n", "        ", "xs", "=", "data_dict", "[", "self", ".", "_x_suffix", "]", "\n", "ys", "=", "data_dict", "[", "self", ".", "_y_suffix", "]", "[", "...", ",", "2", ":", "3", "]", "\n", "\n", "\n", "logits", "=", "self", ".", "net", "(", "xs", ",", "0", ",", "False", ")", "\n", "\n", "loss", "=", "self", ".", "_get_loss", "(", "logits", ",", "data_dict", ")", "\n", "mse", "=", "EM", ".", "mean_squared_error", "(", "logits", ",", "ys", ")", "\n", "\n", "eval_results", "=", "{", "'loss'", ":", "loss", ",", "\n", "'mse'", ":", "mse", "}", "\n", "\n", "need_preds", "=", "kwargs", ".", "get", "(", "'need_preds'", ",", "False", ")", "\n", "if", "need_preds", ":", "\n", "            ", "eval_results", ".", "update", "(", "{", "'pred'", ":", "logits", "}", ")", "\n", "\n", "", "need_all_info", "=", "kwargs", ".", "get", "(", "'need_all_info'", ",", "False", ")", "\n", "if", "need_all_info", ":", "\n", "            ", "all_info", "=", "data_dict", "[", "self", ".", "_y_suffix", "]", "[", "...", ",", ":", "3", "]", "\n", "eval_results", ".", "update", "(", "{", "'all_info'", ":", "all_info", "}", ")", "\n", "\n", "", "mc_eval", "=", "kwargs", ".", "get", "(", "'mc_eval'", ",", "None", ")", "\n", "if", "mc_eval", "is", "not", "None", ":", "\n", "            ", "eval_results", ".", "update", "(", "{", "'mc'", ":", "self", ".", "_mc_eval", "(", "xs", ",", "mc_eval", ")", "}", ")", "\n", "\n", "", "return", "eval_results", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.cls_model.ClsModel.predict": [[58, 60], ["cls_model.ClsModel.net"], "methods", ["None"], ["", "def", "predict", "(", "self", ",", "data_dict", ")", ":", "\n", "        ", "return", "self", ".", "net", "(", "data_dict", "[", "self", ".", "_x_suffix", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.cls_model.ClsModel._get_loss": [[61, 65], ["tensorflow.losses.mse"], "methods", ["None"], ["", "def", "_get_loss", "(", "self", ",", "logits", ",", "data_dict", ")", ":", "\n", "        ", "ys", "=", "data_dict", "[", "self", ".", "_y_suffix", "]", "[", "...", ",", "2", ":", "3", "]", "\n", "loss", "=", "tf", ".", "losses", ".", "mse", "(", "logits", ",", "ys", ")", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.cls_model.ClsModel._mc_eval": [[67, 75], ["numpy.zeros", "range", "cls_model.ClsModel.net"], "methods", ["None"], ["", "def", "_mc_eval", "(", "self", ",", "xs", ",", "mc_setting", ")", ":", "\n", "        ", "t_stochastic", "=", "mc_setting", "[", "'t_stochastic'", "]", "\n", "dropout", "=", "mc_setting", "[", "'dropout'", "]", "\n", "ages", "=", "np", ".", "zeros", "(", "(", "xs", ".", "shape", "[", "0", "]", ",", "t_stochastic", ")", ")", "\n", "for", "i", "in", "range", "(", "t_stochastic", ")", ":", "\n", "            ", "logits", "=", "self", ".", "net", "(", "xs", ",", "dropout", ",", "False", ")", "\n", "ages", "[", "...", ",", "i", ":", "i", "+", "1", "]", "=", "logits", "\n", "", "return", "ages", "", "", "", ""]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.model_wgan_gp_reg.GANModel.__init__": [[13, 22], ["models.model.Model.__init__"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg._UpSampling.__init__"], ["    ", "def", "__init__", "(", "self", ",", "net", ",", "x_suffix", ",", "y_suffix", ",", "age_suffix", "=", "None", ",", "g_alpha", "=", "10", ",", "g_beta", "=", "0.1", ",", "g_lambda", "=", "10", ",", "dropout", "=", "0", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "net", ")", "\n", "self", ".", "_x_suffix", "=", "x_suffix", "\n", "self", ".", "_y_suffix", "=", "y_suffix", "\n", "self", ".", "_age_suffix", "=", "age_suffix", "\n", "self", ".", "_alpha", "=", "g_alpha", "\n", "self", ".", "_beta", "=", "g_beta", "\n", "self", ".", "_lambda", "=", "g_lambda", "\n", "self", ".", "dropout", "=", "dropout", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.model_wgan_gp_reg.GANModel.get_grads": [[23, 40], ["gen_tape.gradient", "disc_tape.gradient", "tensorflow.GradientTape", "tensorflow.GradientTape", "gen_reg", "disc", "disc", "model_wgan_gp_reg.GANModel._get_gen_loss", "model_wgan_gp_reg.GANModel._get_disc_loss"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.model_wgan_gp_reg.GANModel._get_gen_loss", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.model_wgan_gp_reg.GANModel._get_disc_loss"], ["", "def", "get_grads", "(", "self", ",", "data_dict", ")", ":", "\n", "        ", "xs", "=", "data_dict", "[", "self", ".", "_x_suffix", "]", "\n", "ys", "=", "data_dict", "[", "self", ".", "_y_suffix", "]", "\n", "gen_reg", "=", "self", ".", "net", "[", "0", "]", "\n", "disc", "=", "self", ".", "net", "[", "1", "]", "\n", "\n", "with", "tf", ".", "GradientTape", "(", ")", "as", "gen_tape", ",", "tf", ".", "GradientTape", "(", ")", "as", "disc_tape", ":", "\n", "            ", "gen_logits", ",", "reg_logits", "=", "gen_reg", "(", "xs", ",", "self", ".", "dropout", ",", "True", ")", "\n", "disc_gen_logits", "=", "disc", "(", "gen_logits", ",", "self", ".", "dropout", ",", "True", ")", "\n", "disc_real_logits", "=", "disc", "(", "ys", ",", "self", ".", "dropout", ",", "True", ")", "\n", "\n", "gen_loss", "=", "self", ".", "_get_gen_loss", "(", "disc_gen_logits", ",", "gen_logits", ",", "reg_logits", ",", "data_dict", ")", "[", "0", "]", "\n", "disc_loss", "=", "self", ".", "_get_disc_loss", "(", "disc_real_logits", ",", "disc_gen_logits", ",", "gen_logits", ",", "ys", ",", "True", ")", "[", "0", "]", "\n", "\n", "", "gen_grads", "=", "gen_tape", ".", "gradient", "(", "gen_loss", ",", "self", ".", "net", "[", "0", "]", ".", "trainable_variables", ")", "\n", "disc_grads", "=", "disc_tape", ".", "gradient", "(", "disc_loss", ",", "self", ".", "net", "[", "1", "]", ".", "trainable_variables", ")", "\n", "return", "gen_grads", ",", "disc_grads", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.model_wgan_gp_reg.GANModel.eval": [[41, 76], ["gen_reg", "disc", "disc", "model_wgan_gp_reg.GANModel._get_gen_loss", "model_wgan_gp_reg.GANModel._get_disc_loss", "kwargs.get", "kwargs.get", "kwargs.get", "eval_results.update", "eval_results.update", "eval_results.update", "model_wgan_gp_reg.GANModel._get_imgs_eval"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.model_wgan_gp_reg.GANModel._get_gen_loss", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.model_wgan_gp_reg.GANModel._get_disc_loss", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.model_wgan_gp_reg.GANModel._get_imgs_eval"], ["", "def", "eval", "(", "self", ",", "data_dict", ",", "**", "kwargs", ")", ":", "\n", "        ", "xs", "=", "data_dict", "[", "self", ".", "_x_suffix", "]", "\n", "ys", "=", "data_dict", "[", "self", ".", "_y_suffix", "]", "\n", "\n", "gen_reg", "=", "self", ".", "net", "[", "0", "]", "\n", "disc", "=", "self", ".", "net", "[", "1", "]", "\n", "\n", "gen_logits", ",", "reg_logits", "=", "gen_reg", "(", "xs", ",", "0.", ",", "False", ")", "\n", "disc_gen_logits", "=", "disc", "(", "gen_logits", ",", "0.", ",", "False", ")", "\n", "disc_real_logits", "=", "disc", "(", "ys", ",", "0.", ",", "False", ")", "\n", "\n", "total_gen_loss", ",", "gen_loss", ",", "l1_loss", ",", "age_loss", "=", "self", ".", "_get_gen_loss", "(", "disc_gen_logits", ",", "gen_logits", ",", "reg_logits", ",", "data_dict", ")", "\n", "total_disc_loss", ",", "disc_loss", "=", "self", ".", "_get_disc_loss", "(", "disc_real_logits", ",", "disc_gen_logits", ",", "gen_logits", ",", "ys", ",", "False", ")", "\n", "\n", "eval_results", "=", "{", "'loss'", ":", "total_gen_loss", ",", "\n", "'gen_loss'", ":", "gen_loss", ",", "\n", "'disc_loss'", ":", "disc_loss", ",", "\n", "'disc_gp_loss'", ":", "total_disc_loss", ",", "\n", "'gen_mae'", ":", "l1_loss", ",", "\n", "'age_mse'", ":", "age_loss", "}", "\n", "\n", "need_preds", "=", "kwargs", ".", "get", "(", "'need_preds'", ",", "False", ")", "\n", "if", "need_preds", ":", "\n", "            ", "eval_results", ".", "update", "(", "{", "'pred'", ":", "reg_logits", "}", ")", "\n", "\n", "", "need_all_info", "=", "kwargs", ".", "get", "(", "'need_all_info'", ",", "False", ")", "\n", "if", "need_all_info", ":", "\n", "            ", "all_info", "=", "data_dict", "[", "self", ".", "_age_suffix", "]", "\n", "eval_results", ".", "update", "(", "{", "'all_info'", ":", "all_info", "}", ")", "\n", "\n", "", "need_imgs", "=", "kwargs", ".", "get", "(", "'need_imgs'", ",", "None", ")", "\n", "if", "need_imgs", "is", "not", "None", ":", "\n", "            ", "eval_results", ".", "update", "(", "{", "'imgs'", ":", "self", ".", "_get_imgs_eval", "(", "xs", ",", "ys", ",", "gen_logits", ")", "}", ")", "\n", "\n", "", "return", "eval_results", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.model_wgan_gp_reg.GANModel.predict": [[77, 79], ["None"], "methods", ["None"], ["", "def", "predict", "(", "self", ",", "data_dict", ")", ":", "\n", "        ", "return", "self", ".", "net", "[", "0", "]", "(", "data_dict", "[", "self", ".", "_x_suffix", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.model_wgan_gp_reg.GANModel._get_gen_loss": [[80, 95], ["tensorflow.losses.mae", "tensorflow.losses.mse", "tensorflow.reduce_mean", "tensorflow.reduce_mean", "tensorflow.reduce_mean", "tensorflow.reduce_mean", "range", "range", "range"], "methods", ["None"], ["", "def", "_get_gen_loss", "(", "self", ",", "disc_gen_logits", ",", "gen_logits", ",", "reg_logits", ",", "data_dict", ")", ":", "\n", "        ", "ys", "=", "data_dict", "[", "self", ".", "_y_suffix", "]", "\n", "ages", "=", "data_dict", "[", "self", ".", "_age_suffix", "]", "[", "...", ",", "2", ":", "3", "]", "\n", "\n", "gan_loss", "=", "-", "tf", ".", "reduce_mean", "(", "disc_gen_logits", ")", "\n", "l1_loss", "=", "tf", ".", "losses", ".", "mae", "(", "gen_logits", ",", "ys", ")", "\n", "age_loss", "=", "tf", ".", "losses", ".", "mse", "(", "reg_logits", ",", "ages", ")", "\n", "\n", "\n", "gan_loss", "=", "tf", ".", "reduce_mean", "(", "gan_loss", ",", "range", "(", "1", ",", "gan_loss", ".", "ndim", ")", ")", "\n", "l1_loss", "=", "tf", ".", "reduce_mean", "(", "l1_loss", ",", "range", "(", "1", ",", "l1_loss", ".", "ndim", ")", ")", "\n", "age_loss", "=", "tf", ".", "reduce_mean", "(", "age_loss", ",", "range", "(", "1", ",", "l1_loss", ".", "ndim", ")", ")", "\n", "\n", "# cv2.imwrite('/data/psxrl3/results/gen.png', np.array(gen_logits[0,...,50,0] * 255))", "\n", "return", "gan_loss", "+", "self", ".", "_alpha", "*", "l1_loss", "+", "self", ".", "_beta", "*", "age_loss", ",", "gan_loss", ",", "l1_loss", ",", "age_loss", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.model_wgan_gp_reg.GANModel._get_disc_loss": [[96, 109], ["tensorflow.random.uniform", "gp_tape.gradient", "tensorflow.sqrt", "tensorflow.reduce_mean", "tensorflow.GradientTape", "gp_tape.watch", "tensorflow.reduce_sum", "tensorflow.reduce_mean", "tensorflow.reduce_mean", "tensorflow.square"], "methods", ["None"], ["", "def", "_get_disc_loss", "(", "self", ",", "disc_real_logits", ",", "disc_gen_logits", ",", "gen_logits", ",", "ys", ",", "training", ")", ":", "\n", "        ", "alpha", "=", "tf", ".", "random", ".", "uniform", "(", "shape", "=", "[", "ys", ".", "shape", "[", "0", "]", ",", "1", ",", "1", ",", "1", ",", "1", "]", ",", "minval", "=", "0.", ",", "maxval", "=", "1.", ")", "\n", "inter_sample", "=", "gen_logits", "*", "alpha", "+", "ys", "*", "(", "1", "-", "alpha", ")", "\n", "\n", "with", "tf", ".", "GradientTape", "(", ")", "as", "gp_tape", ":", "\n", "            ", "gp_tape", ".", "watch", "(", "inter_sample", ")", "\n", "inter_score", "=", "self", ".", "net", "[", "1", "]", "(", "inter_sample", ",", "self", ".", "dropout", ",", "training", ")", "\n", "", "gp_gradients", "=", "gp_tape", ".", "gradient", "(", "inter_score", ",", "inter_sample", ")", "\n", "gp_gradients_norm", "=", "tf", ".", "sqrt", "(", "tf", ".", "reduce_sum", "(", "tf", ".", "square", "(", "gp_gradients", ")", ",", "axis", "=", "[", "1", ",", "2", ",", "3", ",", "4", "]", ")", ")", "\n", "gp_loss", "=", "tf", ".", "reduce_mean", "(", "(", "gp_gradients_norm", "-", "1.0", ")", "**", "2", ")", "\n", "disc_loss", "=", "tf", ".", "reduce_mean", "(", "disc_gen_logits", ")", "-", "tf", ".", "reduce_mean", "(", "disc_real_logits", ")", "\n", "\n", "return", "disc_loss", "+", "gp_loss", "*", "self", ".", "_lambda", ",", "disc_loss", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.model_wgan_gp_reg.GANModel.gradient_penalty": [[110, 118], ["tensorflow.random.uniform", "tensorflow.sqrt", "tensorflow.reduce_mean", "tensorflow.gradients", "tensorflow.reduce_sum", "tensorflow.square"], "methods", ["None"], ["", "def", "gradient_penalty", "(", "self", ",", "gen_logits", ",", "ys", ")", ":", "\n", "        ", "alpha", "=", "tf", ".", "random", ".", "uniform", "(", "shape", "=", "[", "ys", ".", "shape", "[", "0", "]", ",", "1", ",", "1", ",", "1", ",", "1", "]", ",", "minval", "=", "0.", ",", "maxval", "=", "1.", ")", "\n", "differences", "=", "gen_logits", "-", "ys", "\n", "interpolates", "=", "ys", "+", "(", "alpha", "*", "differences", ")", "\n", "gradients", "=", "tf", ".", "gradients", "(", "self", ".", "net", "[", "1", "]", "(", "interpolates", ")", ",", "[", "interpolates", "]", ")", "[", "0", "]", "\n", "slopes", "=", "tf", ".", "sqrt", "(", "tf", ".", "reduce_sum", "(", "tf", ".", "square", "(", "gradients", ")", ",", "reduction_indices", "=", "[", "1", ",", "2", ",", "3", ",", "4", "]", ")", ")", "\n", "gradient_penalty", "=", "tf", ".", "reduce_mean", "(", "(", "slopes", "-", "1.", ")", "**", "2", ")", "\n", "return", "gradient_penalty", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.model_wgan_gp_reg.GANModel._get_imgs_eval": [[119, 132], ["numpy.array", "range", "range", "utils.util.combine_2d_imgs_from_tensor", "int", "numpy.concatenate", "range"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.combine_2d_imgs_from_tensor"], ["", "def", "_get_imgs_eval", "(", "self", ",", "xs", ",", "ys", ",", "prob", ")", ":", "\n", "        ", "prob", "=", "np", ".", "array", "(", "prob", ")", "\n", "img_dict", "=", "{", "}", "\n", "n_class", "=", "ys", ".", "shape", "[", "-", "1", "]", "\n", "n_slice", "=", "10", "\n", "for", "c", "in", "range", "(", "n_class", ")", ":", "\n", "            ", "imgs", "=", "None", "\n", "for", "n", "in", "range", "(", "ys", ".", "shape", "[", "0", "]", ")", ":", "\n", "                ", "idx", "=", "[", "int", "(", "ys", ".", "shape", "[", "-", "2", "]", "//", "n_slice", "*", "(", "s", "+", "0.5", ")", ")", "for", "s", "in", "range", "(", "n_slice", ")", "]", "\n", "img", "=", "U", ".", "combine_2d_imgs_from_tensor", "(", "[", "xs", "[", "n", ",", "...", ",", "idx", ",", "c", "]", ",", "ys", "[", "n", ",", "...", ",", "idx", ",", "c", "]", ",", "prob", "[", "n", ",", "...", ",", "idx", ",", "c", "]", "]", ")", "\n", "imgs", "=", "img", "if", "imgs", "is", "None", "else", "np", ".", "concatenate", "(", "(", "imgs", ",", "img", ")", ",", "0", ")", "\n", "", "img_dict", "=", "{", "'class %d'", "%", "c", ":", "imgs", "}", "\n", "", "return", "img_dict", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.trainer_tf.Trainer.__init__": [[10, 12], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "model", ")", ":", "\n", "        ", "self", ".", "model", "=", "model", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.trainer_tf.Trainer.train": [[14, 112], ["float", "range", "tensorflow.train.Checkpoint", "print", "float", "time.time", "range", "optimizer.learning_rate.numpy", "type", "os.path.exists", "os.makedirs", "len", "net_args.update", "open", "f.write", "time.time", "range", "print", "utils.util.dict_append", "utils.util.dict_append", "tensorflow.train.Checkpoint.write", "type", "str", "int", "range", "trainer_tf.Trainer._grads_div", "time.time", "trainer_tf.Trainer.eval", "trainer_tf.Trainer.eval", "utils.eval_saver.save_str", "utils.eval_saver.save_str", "open", "f.write", "int", "train_provider", "trainer_tf.Trainer.model.get_grads", "trainer_tf.Trainer._grads_add", "type", "range", "optimizer.apply_gradients", "utils.eval_saver.save_img", "utils.eval_saver.save_img", "numpy.mean", "tensorflow.train.Checkpoint.write", "numpy.mean", "time.time", "str", "len", "len", "len", "optimizer[].apply_gradients", "zip", "time.time", "utils.util.dict_to_str", "utils.util.dict_to_str", "zip"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.dict_append", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.dict_append", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.trainer_tf.Trainer._grads_div", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.trainer_tf.Trainer.eval", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.trainer_tf.Trainer.eval", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_saver.save_str", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_saver.save_str", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.models.model_wgan_gp_reg.GANModel.get_grads", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.trainer_tf.Trainer._grads_add", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_saver.save_img", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.eval_saver.save_img", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.dict_to_str", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.dict_to_str"], ["", "def", "train", "(", "self", ",", "\n", "train_provider", ",", "\n", "validation_provider", ",", "\n", "epochs", ",", "\n", "batch_size", ",", "\n", "output_path", ",", "\n", "optimizer", "=", "None", ",", "\n", "learning_rate", "=", "None", ",", "\n", "mini_batch_size", "=", "None", ",", "\n", "eval_frequency", "=", "1", ",", "\n", "is_save_train_imgs", "=", "False", ",", "\n", "is_save_valid_imgs", "=", "True", ",", "\n", "max_save_batch", "=", "float", "(", "'inf'", ")", ")", ":", "\n", "\n", "        ", "if", "learning_rate", "is", "None", ":", "\n", "            ", "learning_rate", "=", "optimizer", ".", "learning_rate", ".", "numpy", "(", ")", "\n", "", "if", "type", "(", "learning_rate", ")", "is", "not", "list", ":", "\n", "            ", "learning_rate", "=", "[", "learning_rate", "]", "\n", "", "iters", "=", "train_provider", ".", "size", "/", "batch_size", "\n", "assert", "iters", ">", "0", "and", "iters", "%", "1", "==", "0", ",", "'batch size {} does not match the data size {}.'", ".", "format", "(", "batch_size", ",", "train_provider", ".", "size", ")", "\n", "mini_batch_size", "=", "batch_size", "if", "mini_batch_size", "is", "None", "else", "mini_batch_size", "\n", "mini_iters", "=", "batch_size", "/", "mini_batch_size", "\n", "assert", "mini_iters", ">", "0", "and", "mini_iters", "%", "1", "==", "0", ",", "'mini batch size {} does not match the batch size {}.'", ".", "format", "(", "mini_batch_size", ",", "batch_size", ")", "\n", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "output_path", ")", ":", "\n", "            ", "os", ".", "makedirs", "(", "output_path", ")", "\n", "\n", "", "nets", "=", "self", ".", "model", ".", "net", "if", "type", "(", "self", ".", "model", ".", "net", ")", "is", "list", "else", "[", "self", ".", "model", ".", "net", "]", "\n", "net_args", "=", "{", "}", "\n", "for", "i", "in", "range", "(", "len", "(", "nets", ")", ")", ":", "\n", "            ", "net_args", ".", "update", "(", "{", "'net%d'", "%", "i", ":", "nets", "[", "i", "]", "}", ")", "\n", "", "ckpt", "=", "tf", ".", "train", ".", "Checkpoint", "(", "**", "net_args", ")", "\n", "\n", "start_message", "=", "(", "'Start training: epochs {}, learning rate {}, batch size {}, mini-batch size {}, training data {}, validation data {}.'", "\n", ".", "format", "(", "epochs", ",", "[", "str", "(", "lr", ")", "for", "lr", "in", "learning_rate", "]", ",", "batch_size", ",", "mini_batch_size", ",", "train_provider", ".", "size", ",", "validation_provider", ".", "size", ")", ")", "\n", "print", "(", "start_message", ")", "\n", "with", "open", "(", "output_path", "+", "'/train_log.txt'", ",", "'a+'", ")", "as", "f", ":", "\n", "                ", "f", ".", "write", "(", "start_message", "+", "'\\n'", ")", "\n", "\n", "", "train_eval_str", "=", "{", "}", "\n", "valid_eval_str", "=", "{", "}", "\n", "best_loss", "=", "float", "(", "'inf'", ")", "\n", "time_start", "=", "time", ".", "time", "(", ")", "\n", "for", "ep", "in", "range", "(", "epochs", ")", ":", "# TODO: change it back", "\n", "            ", "ep_time_start", "=", "time", ".", "time", "(", ")", "\n", "for", "_", "in", "range", "(", "int", "(", "iters", ")", ")", ":", "\n", "                ", "grads", "=", "None", "\n", "for", "_", "in", "range", "(", "int", "(", "mini_iters", ")", ")", ":", "\n", "                    ", "feed_dict", "=", "train_provider", "(", "mini_batch_size", ")", "\n", "mini_grads", "=", "self", ".", "model", ".", "get_grads", "(", "feed_dict", ")", "\n", "grads", "=", "self", ".", "_grads_add", "(", "grads", ",", "mini_grads", ")", "\n", "", "grads", "=", "self", ".", "_grads_div", "(", "grads", ",", "mini_iters", ")", "\n", "if", "type", "(", "grads", ")", "is", "tuple", ":", "\n", "                    ", "assert", "len", "(", "optimizer", ")", "==", "len", "(", "grads", ")", ",", "'Number of optimizer should equal to number of networks.'", "\n", "for", "gi", "in", "range", "(", "len", "(", "grads", ")", ")", ":", "\n", "                        ", "optimizer", "[", "gi", "]", ".", "apply_gradients", "(", "zip", "(", "grads", "[", "gi", "]", ",", "self", ".", "model", ".", "net", "[", "gi", "]", ".", "trainable_variables", ")", ")", "\n", "", "", "else", ":", "\n", "                    ", "optimizer", ".", "apply_gradients", "(", "zip", "(", "grads", ",", "self", ".", "model", ".", "net", ".", "trainable_variables", ")", ")", "\n", "", "", "ep_train_time", "=", "time", ".", "time", "(", ")", "-", "ep_time_start", "\n", "ep_eval_time", "=", "0", "\n", "if", "ep", "%", "eval_frequency", "==", "0", "or", "ep", "==", "epochs", "-", "1", ":", "\n", "                ", "ep_train_eval", "=", "self", ".", "eval", "(", "train_provider", ",", "batch_size", "=", "mini_batch_size", ",", "print_str", "=", "False", ",", "need_imgs", "=", "is_save_train_imgs", ",", "max_save_batch", "=", "max_save_batch", ")", "\n", "ep_valid_eval", "=", "self", ".", "eval", "(", "validation_provider", ",", "batch_size", "=", "mini_batch_size", ",", "print_str", "=", "False", ",", "need_imgs", "=", "is_save_valid_imgs", ",", "max_save_batch", "=", "max_save_batch", ")", "\n", "ep_eval_time", "=", "time", ".", "time", "(", ")", "-", "ep_train_time", "-", "ep_time_start", "\n", "if", "is_save_train_imgs", ":", "\n", "                    ", "save_img", "(", "ep_train_eval", "[", "1", "]", ",", "'{}/train_imgs/'", ".", "format", "(", "output_path", ")", ",", "ep", ")", "\n", "ep_train_eval", "=", "ep_train_eval", "[", "0", "]", "\n", "", "if", "is_save_valid_imgs", ":", "\n", "                    ", "save_img", "(", "ep_valid_eval", "[", "1", "]", ",", "'{}/valid_imgs/'", ".", "format", "(", "output_path", ")", ",", "ep", ")", "\n", "ep_valid_eval", "=", "ep_valid_eval", "[", "0", "]", "\n", "", "save_str", "(", "ep_train_eval", ",", "'{}/train_eval.txt'", ".", "format", "(", "output_path", ")", ",", "ep", ")", "\n", "save_str", "(", "ep_valid_eval", ",", "'{}/valid_eval.txt'", ".", "format", "(", "output_path", ")", ",", "ep", ")", "\n", "# save best ckpt", "\n", "if", "np", ".", "mean", "(", "ep_valid_eval", "[", "'loss'", "]", ")", "<", "best_loss", ":", "\n", "                    ", "ckpt", ".", "write", "(", "output_path", "+", "'/ckpt/best'", ")", "\n", "best_loss", "=", "np", ".", "mean", "(", "ep_valid_eval", "[", "'loss'", "]", ")", "\n", "\n", "# time_ep_save_imgs_end = time.time()", "\n", "", "", "train_log", "=", "(", "'epoch {} ------ time cost: overall {:.1f} ------ step training {:.1f} ------ step evaluation {:.1f} ------ learning rate: {} ------'", "\n", ".", "format", "(", "ep", ",", "time", ".", "time", "(", ")", "-", "time_start", ",", "ep_train_time", ",", "ep_eval_time", ",", "[", "str", "(", "lr", ")", "for", "lr", "in", "learning_rate", "]", ")", ")", "\n", "\n", "if", "ep", "%", "eval_frequency", "==", "0", "or", "ep", "==", "epochs", "-", "1", ":", "\n", "                ", "train_log", "+=", "(", "'\\n  train      : {}'", ".", "format", "(", "U", ".", "dict_to_str", "(", "ep_train_eval", ")", ")", "+", "'\\n  validation : {}'", ".", "format", "(", "U", ".", "dict_to_str", "(", "ep_valid_eval", ")", ")", ")", "\n", "\n", "", "print", "(", "train_log", ")", "\n", "with", "open", "(", "output_path", "+", "'/train_log.txt'", ",", "'a+'", ")", "as", "f", ":", "\n", "                ", "f", ".", "write", "(", "train_log", "+", "'\\n'", ")", "\n", "\n", "", "train_eval_str", "=", "U", ".", "dict_append", "(", "train_eval_str", ",", "ep_train_eval", ")", "\n", "valid_eval_str", "=", "U", ".", "dict_append", "(", "valid_eval_str", ",", "ep_valid_eval", ")", "\n", "\n", "# TODO add early stopping and best ckpt save", "\n", "# TODO add tensorboard summary", "\n", "ckpt", ".", "write", "(", "output_path", "+", "'/ckpt/final'", ")", "\n", "\n", "\n", "", "return", "train_eval_str", ",", "valid_eval_str", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.trainer_tf.Trainer.restore": [[113, 120], ["range", "tensorflow.train.Checkpoint", "tensorflow.train.Checkpoint.restore", "len", "net_args.update", "type"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.trainer_tf.Trainer.restore"], ["", "def", "restore", "(", "self", ",", "ckpt_path", ")", ":", "\n", "        ", "nets", "=", "self", ".", "model", ".", "net", "if", "type", "(", "self", ".", "model", ".", "net", ")", "is", "list", "else", "[", "self", ".", "model", ".", "net", "]", "\n", "net_args", "=", "{", "}", "\n", "for", "i", "in", "range", "(", "len", "(", "nets", ")", ")", ":", "\n", "            ", "net_args", ".", "update", "(", "{", "'net%d'", "%", "i", ":", "nets", "[", "i", "]", "}", ")", "\n", "", "ckpt", "=", "tf", ".", "train", ".", "Checkpoint", "(", "**", "net_args", ")", "\n", "ckpt", ".", "restore", "(", "ckpt_path", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.trainer_tf.Trainer.eval": [[122, 170], ["kwargs.get", "kwargs.get", "kwargs.get", "kwargs.get", "time.time", "range", "float", "type", "time.time", "trainer_tf.Trainer.model.eval", "print", "trainer_tf.Trainer.model.eval", "utils.util.dict_concat", "trainer_tf.Trainer.model.eval", "utils.util.dict_concat", "print", "print", "print", "time.time", "print", "data_provider", "trainer_tf.Trainer.pop", "utils.util.dict_append", "print", "data_provider", "trainer_tf.Trainer.pop", "utils.util.dict_append", "time.time", "utils.util.dict_to_str"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.trainer_tf.Trainer.eval", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.trainer_tf.Trainer.eval", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.dict_concat", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.trainer_tf.Trainer.eval", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.dict_concat", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.dict_append", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.dict_append", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.dict_to_str"], ["", "def", "eval", "(", "self", ",", "data_in", ",", "**", "kwargs", ")", ":", "\n", "        ", "batch_size", "=", "kwargs", ".", "get", "(", "'batch_size'", ",", "1", ")", "\n", "print_str", "=", "kwargs", ".", "get", "(", "'print_str'", ",", "True", ")", "\n", "need_imgs", "=", "kwargs", ".", "get", "(", "'need_imgs'", ",", "False", ")", "\n", "max_save_batch", "=", "kwargs", ".", "get", "(", "'max_save_batch'", ",", "float", "(", "'inf'", ")", ")", "\n", "if", "type", "(", "data_in", ")", "is", "dict", ":", "\n", "            ", "time_start", "=", "time", ".", "time", "(", ")", "\n", "eval_dict", "=", "self", ".", "model", ".", "eval", "(", "data_in", ",", "**", "kwargs", ")", "\n", "time_cost", "=", "time", ".", "time", "(", ")", "-", "time_start", "\n", "if", "print_str", ":", "\n", "                ", "print", "(", "'Evaluation time cost is {:.1f}'", ".", "format", "(", "time_cost", ")", ")", "\n", "", "return", "eval_dict", "\n", "\n", "", "data_provider", "=", "data_in", "\n", "ndata", "=", "data_provider", ".", "size", "\n", "m", "=", "ndata", "//", "batch_size", "\n", "n", "=", "ndata", "%", "batch_size", "\n", "results", "=", "{", "}", "\n", "imgs", "=", "{", "}", "\n", "saved_batch_count", "=", "0", "\n", "if", "print_str", ":", "\n", "            ", "print", "(", "'Evaluating {} data...'", ".", "format", "(", "ndata", ")", ",", "end", "=", "''", ")", "\n", "", "time_start", "=", "time", ".", "time", "(", ")", "\n", "for", "i", "in", "range", "(", "m", ")", ":", "\n", "            ", "sub_results", "=", "self", ".", "model", ".", "eval", "(", "data_provider", "(", "batch_size", ")", ",", "**", "kwargs", ")", "\n", "sub_imgs", "=", "sub_results", ".", "pop", "(", "'imgs'", ")", "if", "'imgs'", "in", "sub_results", "else", "None", "\n", "results", "=", "U", ".", "dict_concat", "(", "results", ",", "sub_results", ")", "\n", "if", "need_imgs", "and", "sub_imgs", "is", "not", "None", "and", "saved_batch_count", "<", "max_save_batch", ":", "\n", "                ", "imgs", "=", "U", ".", "dict_append", "(", "imgs", ",", "sub_imgs", ")", "\n", "saved_batch_count", "+=", "1", "\n", "", "if", "print_str", ":", "\n", "                ", "print", "(", "'\\r\\tEvalated {}/{} data'", ".", "format", "(", "batch_size", "*", "(", "i", "+", "1", ")", ",", "ndata", ")", ",", "end", "=", "''", ")", "\n", "", "", "if", "n", ">", "0", ":", "\n", "            ", "sub_results", "=", "self", ".", "model", ".", "eval", "(", "data_provider", "(", "n", ")", ",", "**", "kwargs", ")", "\n", "sub_imgs", "=", "sub_results", ".", "pop", "(", "'imgs'", ")", "if", "'imgs'", "in", "sub_results", "else", "None", "\n", "results", "=", "U", ".", "dict_concat", "(", "results", ",", "sub_results", ")", "\n", "if", "need_imgs", "and", "sub_imgs", "is", "not", "None", "and", "saved_batch_count", "<", "max_save_batch", ":", "\n", "                ", "imgs", "=", "U", ".", "dict_append", "(", "imgs", ",", "sub_imgs", ")", "\n", "saved_batch_count", "+=", "1", "\n", "", "", "if", "print_str", ":", "\n", "            ", "print", "(", "'\\r\\tEvalated {}/{} data'", ".", "format", "(", "ndata", ",", "ndata", ")", ")", "\n", "time_cost", "=", "time", ".", "time", "(", ")", "-", "time_start", "\n", "print", "(", "'Time cost is {:.1f}'", ".", "format", "(", "time_cost", ")", ")", "\n", "print", "(", "'  {}'", ".", "format", "(", "U", ".", "dict_to_str", "(", "results", ")", ")", ")", "\n", "", "if", "need_imgs", ":", "\n", "            ", "return", "results", ",", "imgs", "\n", "", "else", ":", "\n", "            ", "return", "results", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.trainer_tf.Trainer.predict": [[171, 190], ["range", "type", "time.time", "trainer_tf.Trainer.model.predict", "print", "trainer_tf.Trainer.model.predict", "trainer_tf.Trainer.model.predict", "time.time", "data_provider", "numpy.concatenate", "data_provider", "numpy.concatenate"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.trainer_tf.Trainer.predict", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.trainer_tf.Trainer.predict", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.trainer_tf.Trainer.predict"], ["", "", "def", "predict", "(", "self", ",", "data_in", ",", "batch_size", "=", "1", ")", ":", "\n", "        ", "if", "type", "(", "data_in", ")", "is", "dict", ":", "\n", "            ", "time_start", "=", "time", ".", "time", "(", ")", "\n", "predictions", "=", "self", ".", "model", ".", "predict", "(", "data_in", ")", "\n", "time_cost", "=", "time", ".", "time", "(", ")", "-", "time_start", "\n", "print", "(", "'Prediction time cost is {:.1f}'", ".", "format", "(", "time_cost", ")", ")", "\n", "return", "predictions", "\n", "", "data_provider", "=", "data_in", "\n", "ndata", "=", "data_provider", ".", "size", "\n", "m", "=", "ndata", "//", "batch_size", "\n", "n", "=", "ndata", "%", "batch_size", "\n", "predictions", "=", "None", "\n", "for", "_", "in", "range", "(", "m", ")", ":", "\n", "            ", "sub_predictions", "=", "self", ".", "model", ".", "predict", "(", "data_provider", "(", "batch_size", ")", ")", "\n", "predictions", "=", "np", ".", "concatenate", "(", "(", "predictions", ",", "sub_predictions", ")", ",", "0", ")", "if", "predictions", "is", "not", "None", "else", "sub_predictions", "\n", "", "if", "n", ">", "0", ":", "\n", "            ", "sub_predictions", "=", "self", ".", "model", ".", "predict", "(", "data_provider", "(", "n", ")", ")", "\n", "predictions", "=", "np", ".", "concatenate", "(", "(", "predictions", ",", "sub_predictions", ")", ",", "0", ")", "if", "predictions", "is", "not", "None", "else", "sub_predictions", "\n", "", "return", "predictions", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.trainer_tf.Trainer._grads_add": [[191, 207], ["type", "enumerate", "range", "len", "enumerate"], "methods", ["None"], ["", "def", "_grads_add", "(", "self", ",", "grads", ",", "mini_grads", ")", ":", "\n", "        ", "if", "grads", "is", "None", ":", "\n", "            ", "grads", "=", "mini_grads", "\n", "", "else", ":", "\n", "            ", "if", "type", "(", "grads", ")", "is", "not", "tuple", ":", "\n", "                ", "for", "i", ",", "g", "in", "enumerate", "(", "mini_grads", ")", ":", "\n", "                    ", "if", "g", "is", "not", "None", ":", "\n", "                        ", "grads", "[", "i", "]", "+=", "g", "\n", "", "", "", "else", ":", "\n", "                ", "for", "gi", "in", "range", "(", "len", "(", "grads", ")", ")", ":", "\n", "                    ", "sub_grads", "=", "grads", "[", "gi", "]", "\n", "sub_mini_grads", "=", "mini_grads", "[", "gi", "]", "\n", "for", "i", ",", "g", "in", "enumerate", "(", "sub_mini_grads", ")", ":", "\n", "                        ", "if", "g", "is", "not", "None", ":", "\n", "                            ", "sub_grads", "[", "i", "]", "+=", "g", "\n", "", "", "", "", "", "return", "grads", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.trainer_tf.Trainer._grads_div": [[208, 221], ["type", "range", "range", "len", "len", "range", "len"], "methods", ["None"], ["", "def", "_grads_div", "(", "self", ",", "grads", ",", "n", ")", ":", "\n", "        ", "if", "n", "!=", "1", ":", "\n", "            ", "if", "type", "(", "grads", ")", "is", "not", "tuple", ":", "\n", "                ", "for", "i", "in", "range", "(", "len", "(", "grads", ")", ")", ":", "\n", "                    ", "if", "grads", "[", "i", "]", "is", "not", "None", ":", "\n", "                        ", "grads", "[", "i", "]", "/=", "n", "\n", "", "", "", "else", ":", "\n", "                ", "for", "gi", "in", "range", "(", "len", "(", "grads", ")", ")", ":", "\n", "                    ", "sub_grads", "=", "grads", "[", "gi", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "sub_grads", ")", ")", ":", "\n", "                        ", "if", "sub_grads", "[", "i", "]", "is", "not", "None", ":", "\n", "                            ", "sub_grads", "[", "i", "]", "/=", "n", "\n", "", "", "", "", "", "return", "grads", "", "", "", ""]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.learning_rate.StepDecayLearningRate.__init__": [[4, 10], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "learning_rate", ",", "decay_step", ",", "decay_rate", ",", "data_size", ",", "batch_size", ")", ":", "\n", "        ", "self", ".", "_lr", "=", "learning_rate", "\n", "self", ".", "_iteration", "=", "data_size", "//", "batch_size", "\n", "self", ".", "_decay_step", "=", "decay_step", "\n", "self", ".", "_decay_rate", "=", "decay_rate", "\n", "self", ".", "_idx", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.learning_rate.StepDecayLearningRate.__call__": [[11, 17], ["None"], "methods", ["None"], ["", "def", "__call__", "(", "self", ")", ":", "\n", "        ", "self", ".", "_idx", "+=", "1", "\n", "if", "self", ".", "_idx", "/", "self", ".", "_iteration", ">", "self", ".", "_decay_step", ":", "\n", "            ", "self", ".", "_lr", "*=", "self", ".", "_decay_rate", "\n", "self", ".", "_idx", "=", "1", "\n", "", "return", "self", ".", "_lr", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.learning_rate.StepDecayLearningRate.__str__": [[18, 20], ["None"], "methods", ["None"], ["", "def", "__str__", "(", "self", ")", ":", "\n", "        ", "return", "'{:g}'", ".", "format", "(", "self", ".", "_lr", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_processor.Processor.pre_process": [[8, 22], ["None"], "methods", ["None"], ["@", "abstractmethod", "\n", "def", "pre_process", "(", "self", ",", "data_dict", ")", ":", "\n", "        ", "\"\"\"Abstract method, need to be inherited for pre-processing.\n        Parameters\n        ----------\n        data_dict: dict\n            Dictionary for all of the input data.\n\n        Returns\n        -------\n        dict\n            Dictionary for all the data after processing.\n            Size won't change if no resize operation.\n        \"\"\"", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_processor.Processor.post_process": [[24, 38], ["None"], "methods", ["None"], ["", "@", "abstractmethod", "\n", "def", "post_process", "(", "self", ",", "data_dict", ")", ":", "\n", "        ", "\"\"\"Abstract method, need to be inherited for post-processing.\n        Parameters\n        ----------\n        data_dict: dict\n            Dictionary for all of the input data.\n\n        Returns\n        -------\n        dict\n            Dictionary for all the data after processing.\n            Size won't change if no resize operation.\n        \"\"\"", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_processor.SimpleImageProcessor.__init__": [[86, 98], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "pre", "=", "None", ",", "post", "=", "None", ")", ":", "\n", "        ", "self", ".", "_pre", "=", "pre", "\n", "self", ".", "_post", "=", "post", "\n", "self", ".", "_mdict", "=", "{", "\n", "'min-max'", ":", "M", ".", "min_max", ",", "\n", "'zero-mean'", ":", "M", ".", "zero_mean", ",", "\n", "'median-mean'", ":", "M", ".", "median_mean", ",", "\n", "'one-hot'", ":", "M", ".", "one_hot", ",", "\n", "'rgb2gray'", ":", "M", ".", "rgb2gray", ",", "\n", "'resize2d'", ":", "M", ".", "resize2d", ",", "\n", "'resize3d'", ":", "M", ".", "resize3d", ",", "\n", "'channelcheck'", ":", "M", ".", "channel_check", "\n", "#TODO new method add here", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_processor.SimpleImageProcessor.pre_process": [[102, 128], ["data_processor.SimpleImageProcessor._process", "data_dict.update"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_processor.SimpleImageProcessor._process"], ["", "def", "pre_process", "(", "self", ",", "data_dict", ")", ":", "\n", "        ", "\"\"\"A basic pre processing pipline. TODO: Modify as required\n\n        Parameters\n        ----------\n        data_dict: dict\n            Dictionary for all of the input data.\n\n        Returns\n        -------\n        dict\n            Dictionary for all the data after processing.\n            Size won't change if no resize operation.\n\n        \"\"\"", "\n", "if", "self", ".", "_pre", "is", "None", ":", "\n", "            ", "return", "data_dict", "\n", "\n", "", "for", "key", "in", "self", ".", "_pre", ":", "\n", "            ", "for", "augm", "in", "self", ".", "_pre", "[", "key", "]", ":", "\n", "                ", "if", "key", "in", "data_dict", ":", "\n", "                    ", "item", "=", "data_dict", "[", "key", "]", "\n", "new_item", "=", "self", ".", "_process", "(", "item", ",", "augm", ")", "\n", "data_dict", ".", "update", "(", "{", "key", ":", "new_item", "}", ")", "\n", "\n", "", "", "", "return", "data_dict", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_processor.SimpleImageProcessor.post_process": [[129, 136], ["None"], "methods", ["None"], ["", "def", "post_process", "(", "self", ",", "data_dict", ")", ":", "\n", "        ", "\"\"\"Post processing method\n        TODO\n        \"\"\"", "\n", "if", "self", ".", "_pre", "is", "None", ":", "\n", "            ", "return", "data_dict", "\n", "", "return", "data_dict", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_processor.SimpleImageProcessor._process": [[137, 158], ["type", "type", "callable"], "methods", ["None"], ["", "def", "_process", "(", "self", ",", "data", ",", "augm", ")", ":", "\n", "        ", "\"\"\"Process data according to accepted augments.\n\n        Parameters\n        ----------\n            data: ndarray\n                Data need to be processed.\n            augm: str or dict\n                Method name or a list of method name and required augments (e.g. ['resize2d', (512,512)]).\n                Custom method is allowed here. If it is, the augm should like [function, {'arg1': arg1, 'arg2': arg2, ...}]\n\n        \"\"\"", "\n", "if", "type", "(", "augm", ")", "is", "str", ":", "\n", "            ", "assert", "augm", "in", "self", ".", "_mdict", ",", "'Method \"{}\" not found!'", ".", "format", "(", "augm", ")", "\n", "return", "self", ".", "_mdict", "[", "augm", "]", "(", "data", ")", "\n", "", "if", "type", "(", "augm", ")", "is", "tuple", ":", "\n", "# custom process method", "\n", "            ", "if", "callable", "(", "augm", "[", "0", "]", ")", ":", "\n", "                ", "return", "augm", "[", "0", "]", "(", "data", ",", "**", "augm", "[", "1", "]", ")", "\n", "", "assert", "augm", "[", "0", "]", "in", "self", ".", "_mdict", ",", "'Method \"{}\" not found!'", ".", "format", "(", "augm", "[", "0", "]", ")", "\n", "return", "self", ".", "_mdict", "[", "augm", "[", "0", "]", "]", "(", "data", ",", "augm", "[", "1", "]", ")", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_provider.DataProvider.__init__": [[48, 81], ["data_provider.DataProvider._shuffle_data", "len", "type", "glob.glob", "data_provider.DataProvider._load_data", "type", "type", "type", "numpy.zeros", "ValueError", "len", "data_provider.DataProvider._build_temp_folder", "len"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_provider.DataProvider._shuffle_data", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_provider.DataProvider._load_data", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_provider.DataProvider._build_temp_folder"], ["def", "__init__", "(", "self", ",", "\n", "data", ",", "\n", "data_suffix", ",", "\n", "processor", "=", "None", ",", "\n", "temp_dir", "=", "None", ",", "\n", "is_pre_load", "=", "False", ",", "\n", "is_shuffle", "=", "False", ")", ":", "\n", "        ", "assert", "len", "(", "data_suffix", ")", ">", "0", ",", "'Empty suffix!'", "\n", "self", ".", "_org_suffix", "=", "data_suffix", "[", "0", "]", "\n", "self", ".", "_other_suffix", "=", "data_suffix", "[", "1", ":", "]", "\n", "self", ".", "_is_shuffle", "=", "is_shuffle", "\n", "self", ".", "_temp_dir", "=", "temp_dir", "\n", "\n", "self", ".", "_processor", "=", "processor", "\n", "\n", "self", ".", "_file_list", "=", "None", "\n", "self", ".", "_all_data", "=", "None", "\n", "if", "type", "(", "data", ")", "is", "str", ":", "\n", "            ", "self", ".", "_file_list", "=", "glob", ".", "glob", "(", "data", ")", "\n", "", "elif", "type", "(", "data", ")", "is", "list", "or", "type", "(", "data", ")", "is", "np", ".", "ndarray", ":", "\n", "            ", "self", ".", "_file_list", "=", "data", "\n", "", "elif", "type", "(", "data", ")", "is", "dict", ":", "\n", "            ", "self", ".", "_all_data", "=", "data", "\n", "self", ".", "_file_list", "=", "np", ".", "zeros", "(", "len", "(", "self", ".", "_all_data", ")", ")", "\n", "", "else", ":", "\n", "            ", "raise", "ValueError", "(", "'Only accept one of (search_path, file_list, data_dict).'", ")", "\n", "", "self", ".", "_shuffle_data", "(", ")", "\n", "self", ".", "_cur_i", "=", "0", "\n", "if", "self", ".", "_all_data", "is", "None", "and", "self", ".", "_file_list", "is", "not", "None", ":", "\n", "            ", "if", "is_pre_load", ":", "\n", "                ", "self", ".", "_all_data", "=", "self", ".", "_load_data", "(", "len", "(", "self", ".", "_file_list", ")", ")", "\n", "", "elif", "self", ".", "_temp_dir", "is", "not", "None", ":", "\n", "                ", "self", ".", "_build_temp_folder", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_provider.DataProvider.__call__": [[82, 116], ["data_provider.DataProvider._next_idx", "numpy.array", "len", "data_dict.update", "data_dict.update", "data_dict.update", "range", "data_provider.DataProvider._load_temp_file", "data_provider.DataProvider._load_data"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_provider.DataProvider._next_idx", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_provider.DataProvider._load_temp_file", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_provider.DataProvider._load_data"], ["", "", "", "def", "__call__", "(", "self", ",", "n", ")", ":", "\n", "        ", "\"\"\"Require images.\n\n        Parameters\n        ----------\n        n: int\n            The number of images required.\n\n        Returns\n        -------\n        dict\n            A dictionary of ndarray data:\n                {\n                    'data_suffix':      ndarray,\n                    'other_suffix 1':   ndarray,\n                    'other_suffix 1':   ndarray,\n                    ...\n                }\n            The shape of ndarray will be (n, x, y, ..., c).\n                n is the number of data, which caller asked.\n                x, y, ... is the size of data.\n                c is the number of channels (for label is the numebr of classes).\n        \"\"\"", "\n", "data_dict", "=", "{", "}", "\n", "if", "self", ".", "_all_data", "is", "not", "None", ":", "\n", "            ", "idx_list", "=", "np", ".", "array", "(", "range", "(", "self", ".", "_cur_i", ",", "self", ".", "_cur_i", "+", "n", ")", ")", "%", "len", "(", "self", ".", "_file_list", ")", "\n", "for", "key", "in", "self", ".", "_all_data", ":", "\n", "                ", "data_dict", ".", "update", "(", "{", "key", ":", "self", ".", "_all_data", "[", "key", "]", "[", "idx_list", "]", "}", ")", "\n", "", "self", ".", "_next_idx", "(", "n", ")", "\n", "", "elif", "self", ".", "_temp_dir", "is", "not", "None", ":", "\n", "            ", "data_dict", ".", "update", "(", "self", ".", "_load_temp_file", "(", "n", ")", ")", "\n", "", "else", ":", "\n", "            ", "data_dict", ".", "update", "(", "self", ".", "_load_data", "(", "n", ")", ")", "\n", "", "return", "data_dict", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_provider.DataProvider.size": [[117, 120], ["len", "len"], "methods", ["None"], ["", "@", "property", "\n", "def", "size", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "_file_list", ")", "if", "self", ".", "_file_list", "is", "not", "None", "else", "len", "(", "self", ".", "_all_data", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_provider.DataProvider._load_data": [[121, 161], ["range", "utils.util.dict_list2arr", "data_provider.DataProvider.update", "utils.util.dict_append", "data_provider.DataProvider._next_idx", "x_name.replace", "data_provider.DataProvider.update", "data_provider.DataProvider._processor.pre_process", "utils.data_loader.load_file", "utils.data_loader.load_file"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.dict_list2arr", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.dict_append", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_provider.DataProvider._next_idx", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_processor.SimpleImageProcessor.pre_process", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.data_loader.load_file", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.data_loader.load_file"], ["", "def", "_load_data", "(", "self", ",", "n", ")", ":", "\n", "        ", "\"\"\"Load and process data one by one\n\n        Parameters\n        ----------\n        n: int\n            The number of images loaded.\n\n        Returns\n        -------\n        dict\n            A dictionary of ndarray data:\n                {\n                    'data_suffix':      ndarray,\n                    'other_suffix 1':   ndarray,\n                    'other_suffix 1':   ndarray,\n                    ...\n                }\n            The shape of ndarray will be (n, x, y, ..., c).\n                n is the number of data, which caller asked.\n                x, y, ... is the size of data.\n                c is the number of channels (for label is the numebr of classes).\n        \"\"\"", "\n", "data_dict", "=", "{", "}", "\n", "for", "_", "in", "range", "(", "n", ")", ":", "\n", "            ", "sub_data_dict", "=", "{", "}", "\n", "x_name", "=", "self", ".", "_file_list", "[", "self", ".", "_cur_i", "]", "\n", "sub_data_dict", ".", "update", "(", "{", "self", ".", "_org_suffix", ":", "L", ".", "load_file", "(", "x_name", ")", "}", ")", "\n", "\n", "for", "o_suffix", "in", "self", ".", "_other_suffix", ":", "\n", "                ", "o_name", "=", "x_name", ".", "replace", "(", "self", ".", "_org_suffix", ",", "o_suffix", ")", "\n", "sub_data_dict", ".", "update", "(", "{", "o_suffix", ":", "L", ".", "load_file", "(", "o_name", ")", "}", ")", "\n", "# process", "\n", "", "if", "self", ".", "_processor", "is", "not", "None", ":", "\n", "                ", "sub_data_dict", "=", "self", ".", "_processor", ".", "pre_process", "(", "sub_data_dict", ")", "\n", "\n", "", "data_dict", "=", "U", ".", "dict_append", "(", "data_dict", ",", "sub_data_dict", ")", "\n", "self", ".", "_next_idx", "(", ")", "\n", "", "U", ".", "dict_list2arr", "(", "data_dict", ")", "\n", "return", "data_dict", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_provider.DataProvider._build_temp_folder": [[162, 178], ["print", "os.path.exists", "os.makedirs", "range", "print", "shutil.rmtree", "len", "data_provider.DataProvider._load_data", "new_filelist.append", "numpy.save", "time.strftime", "str().split", "str", "time.time"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_provider.DataProvider._load_data"], ["", "def", "_build_temp_folder", "(", "self", ")", ":", "\n", "        ", "self", ".", "_temp_dir", "+=", "'/temp'", "+", "time", ".", "strftime", "(", "'%Y%m%d-%H%M%S-'", ")", "+", "str", "(", "time", ".", "time", "(", ")", ")", ".", "split", "(", "'.'", ")", "[", "-", "1", "]", "\n", "print", "(", "'Building temp folder \\'{}\\' ...'", ".", "format", "(", "self", ".", "_temp_dir", ")", ")", "\n", "# temp_dir = tempfile.TemporaryDirectory()", "\n", "\n", "if", "os", ".", "path", ".", "exists", "(", "self", ".", "_temp_dir", ")", ":", "\n", "            ", "shutil", ".", "rmtree", "(", "self", ".", "_temp_dir", ",", "ignore_errors", "=", "True", ")", "\n", "", "os", ".", "makedirs", "(", "self", ".", "_temp_dir", ")", "\n", "new_filelist", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "self", ".", "_file_list", ")", ")", ":", "\n", "            ", "data_dict", "=", "self", ".", "_load_data", "(", "1", ")", "\n", "temp_filepath", "=", "'{}/temp_dict_{}.npy'", ".", "format", "(", "self", ".", "_temp_dir", ",", "i", ")", "\n", "new_filelist", ".", "append", "(", "temp_filepath", ")", "\n", "np", ".", "save", "(", "temp_filepath", ",", "data_dict", ")", "\n", "", "self", ".", "_file_list", "=", "new_filelist", "\n", "print", "(", "'Processed temp files were saved.'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_provider.DataProvider._load_temp_file": [[179, 189], ["os.path.exists", "range", "numpy.load().item", "data_provider.DataProvider._next_idx", "utils.util.dict_concat", "numpy.load"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_provider.DataProvider._next_idx", "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.utils.util.dict_concat"], ["", "def", "_load_temp_file", "(", "self", ",", "n", ")", ":", "\n", "        ", "assert", "self", ".", "_temp_dir", "is", "not", "None", ",", "'Temp dir is None'", "\n", "assert", "os", ".", "path", ".", "exists", "(", "self", ".", "_temp_dir", ")", ",", "'Can\\'t find temp directory \\'{}\\''", ".", "format", "(", "self", ".", "_temp_dir", ")", "\n", "data_dict", "=", "{", "}", "\n", "for", "_", "in", "range", "(", "n", ")", ":", "\n", "            ", "temp_filename", "=", "self", ".", "_file_list", "[", "self", ".", "_cur_i", "]", "\n", "sub_data_dict", "=", "np", ".", "load", "(", "temp_filename", ",", "allow_pickle", "=", "'TRUE'", ")", ".", "item", "(", ")", "\n", "self", ".", "_next_idx", "(", ")", "\n", "data_dict", "=", "U", ".", "dict_concat", "(", "data_dict", ",", "sub_data_dict", ")", "\n", "", "return", "data_dict", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_provider.DataProvider._next_idx": [[190, 201], ["len", "data_provider.DataProvider._shuffle_data", "len"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_provider.DataProvider._shuffle_data"], ["", "def", "_next_idx", "(", "self", ",", "n", "=", "1", ")", ":", "\n", "        ", "\"\"\"Cycle index.\n        Parameters\n        ----------\n        n: int, optional\n            The value needs to be added\u3002\n        \"\"\"", "\n", "self", ".", "_cur_i", "+=", "n", "\n", "if", "self", ".", "_cur_i", ">=", "len", "(", "self", ".", "_file_list", ")", ":", "\n", "            ", "self", ".", "_cur_i", "=", "self", ".", "_cur_i", "%", "len", "(", "self", ".", "_file_list", ")", "\n", "self", ".", "_shuffle_data", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.core.data_provider.DataProvider._shuffle_data": [[202, 210], ["numpy.random.permutation", "len"], "methods", ["None"], ["", "", "def", "_shuffle_data", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "_is_shuffle", ":", "\n", "            ", "shuffle_idx", "=", "np", ".", "random", ".", "permutation", "(", "len", "(", "self", ".", "_file_list", ")", ")", "\n", "if", "self", ".", "_file_list", "is", "not", "None", ":", "\n", "                ", "self", ".", "_file_list", "=", "[", "self", ".", "_file_list", "[", "i", "]", "for", "i", "in", "shuffle_idx", "]", "\n", "", "if", "self", ".", "_all_data", "is", "not", "None", ":", "\n", "                ", "for", "key", "in", "self", ".", "_all_data", ":", "\n", "                    ", "self", ".", "_all_data", "[", "key", "]", "=", "self", ".", "_all_data", "[", "key", "]", "[", "shuffle_idx", "]", "", "", "", "", "", "", ""]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.vgg3d.VGG3D.__init__": [[6, 23], ["tensorflow.keras.Model.__init__", "dict", "dict", "range", "tensorflow.keras.layers.Flatten", "tensorflow.keras.layers.Dense", "tensorflow.keras.layers.Dense", "tensorflow.keras.layers.Dense", "tensorflow.keras.layers.Dense", "str", "vgg3d._DownSampling", "tensorflow.keras.layers.MaxPool3D"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg._UpSampling.__init__"], ["    ", "def", "__init__", "(", "self", ",", "n_layer", ",", "root_filters", ",", "kernal_size", "=", "3", ",", "pool_size", "=", "2", ",", "use_bn", "=", "True", ",", "use_res", "=", "True", ",", "padding", "=", "'SAME'", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "dw_layers", "=", "dict", "(", ")", "\n", "self", ".", "max_pools", "=", "dict", "(", ")", "\n", "for", "layer", "in", "range", "(", "n_layer", ")", ":", "\n", "            ", "filters", "=", "2", "**", "layer", "*", "root_filters", "\n", "dict_key", "=", "str", "(", "n_layer", "-", "layer", "-", "1", ")", "\n", "dw", "=", "_DownSampling", "(", "filters", ",", "kernal_size", ",", "'dw_%d'", "%", "layer", ",", "use_bn", ",", "use_res", ")", "\n", "self", ".", "dw_layers", "[", "dict_key", "]", "=", "dw", "\n", "pool", "=", "layers", ".", "MaxPool3D", "(", "pool_size", ",", "padding", "=", "padding", ")", "\n", "self", ".", "max_pools", "[", "dict_key", "]", "=", "pool", "\n", "\n", "", "self", ".", "flat", "=", "layers", ".", "Flatten", "(", ")", "\n", "self", ".", "f1", "=", "layers", ".", "Dense", "(", "2048", ",", "use_bias", "=", "True", ",", "name", "=", "'f1'", ")", "\n", "self", ".", "f2", "=", "layers", ".", "Dense", "(", "512", ",", "use_bias", "=", "True", ",", "name", "=", "'f2'", ")", "\n", "self", ".", "f3", "=", "layers", ".", "Dense", "(", "64", ",", "use_bias", "=", "True", ",", "name", "=", "'f3'", ")", "\n", "self", ".", "f_out", "=", "layers", ".", "Dense", "(", "1", ",", "use_bias", "=", "False", ",", "name", "=", "'f_out'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.vgg3d.VGG3D.__call__": [[25, 49], ["dict", "len", "range", "vgg3d.VGG3D.flat", "vgg3d.VGG3D.f1", "tensorflow.nn.relu", "tensorflow.nn.dropout", "vgg3d.VGG3D.f2", "tensorflow.nn.relu", "tensorflow.nn.dropout", "vgg3d.VGG3D.f3", "tensorflow.nn.relu", "tensorflow.nn.dropout", "vgg3d.VGG3D.f_out", "str"], "methods", ["None"], ["", "@", "tf", ".", "function", "\n", "def", "__call__", "(", "self", ",", "x_in", ",", "drop_rate", ",", "training", ")", ":", "\n", "        ", "dw_tensors", "=", "dict", "(", ")", "\n", "x", "=", "x_in", "\n", "n_layer", "=", "len", "(", "self", ".", "dw_layers", ")", "\n", "for", "i", "in", "range", "(", "n_layer", ")", ":", "\n", "            ", "dict_key", "=", "str", "(", "n_layer", "-", "i", "-", "1", ")", "\n", "dw_tensors", "[", "dict_key", "]", "=", "self", ".", "dw_layers", "[", "dict_key", "]", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "dw_tensors", "[", "dict_key", "]", "\n", "x", "=", "self", ".", "max_pools", "[", "dict_key", "]", "(", "x", ")", "\n", "\n", "", "x", "=", "self", ".", "flat", "(", "x", ")", "\n", "x", "=", "self", ".", "f1", "(", "x", ")", "\n", "x", "=", "tf", ".", "nn", ".", "relu", "(", "x", ")", "\n", "x", "=", "tf", ".", "nn", ".", "dropout", "(", "x", ",", "drop_rate", ")", "\n", "x", "=", "self", ".", "f2", "(", "x", ")", "\n", "x", "=", "tf", ".", "nn", ".", "relu", "(", "x", ")", "\n", "x", "=", "tf", ".", "nn", ".", "dropout", "(", "x", ",", "drop_rate", ")", "\n", "x", "=", "self", ".", "f3", "(", "x", ")", "\n", "x", "=", "tf", ".", "nn", ".", "relu", "(", "x", ")", "\n", "x", "=", "tf", ".", "nn", ".", "dropout", "(", "x", ",", "drop_rate", ")", "\n", "x", "=", "self", ".", "f_out", "(", "x", ")", "\n", "# x = tf.nn.relu(x)", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.vgg3d._DownSampling.__init__": [[54, 71], ["tensorflow.keras.layers.Layer.__init__", "tensorflow.keras.layers.Conv3D", "tensorflow.keras.layers.Conv3D", "tensorflow.keras.layers.BatchNormalization", "tensorflow.keras.layers.BatchNormalization", "vgg3d._Residual"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg._UpSampling.__init__"], ["    ", "def", "__init__", "(", "self", ",", "filters", ",", "kernel_size", ",", "name", ",", "use_bn", "=", "True", ",", "use_res", "=", "True", ",", "padding", "=", "'SAME'", ",", "use_bias", "=", "True", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "name", "=", "name", ")", "\n", "self", ".", "use_bn", "=", "use_bn", "\n", "self", ".", "use_res", "=", "use_res", "\n", "# stddev = np.sqrt(2/(kernel_size**2*filters))", "\n", "self", ".", "conv1", "=", "layers", ".", "Conv3D", "(", "filters", ",", "kernel_size", ",", "padding", "=", "padding", ",", "use_bias", "=", "use_bias", ",", "\n", "# kernel_initializer=initializers.TruncatedNormal(stddev=stddev),", "\n", "name", "=", "'conv1'", ")", "\n", "self", ".", "conv2", "=", "layers", ".", "Conv3D", "(", "filters", ",", "kernel_size", ",", "padding", "=", "padding", ",", "use_bias", "=", "use_bias", ",", "\n", "# kernel_initializer=initializers.TruncatedNormal(stddev=stddev),", "\n", "name", "=", "'conv2'", ")", "\n", "\n", "if", "use_bn", ":", "\n", "            ", "self", ".", "bn1", "=", "layers", ".", "BatchNormalization", "(", "momentum", "=", "0.99", ",", "name", "=", "'bn1'", ")", "\n", "self", ".", "bn2", "=", "layers", ".", "BatchNormalization", "(", "momentum", "=", "0.99", ",", "name", "=", "'bn2'", ")", "\n", "", "if", "use_res", ":", "\n", "            ", "self", ".", "res", "=", "_Residual", "(", "'res'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.vgg3d._DownSampling.__call__": [[72, 91], ["vgg3d._DownSampling.conv1", "tensorflow.nn.relu", "vgg3d._DownSampling.conv2", "tensorflow.nn.relu", "vgg3d._DownSampling.bn1", "vgg3d._DownSampling.bn2", "vgg3d._DownSampling.res"], "methods", ["None"], ["", "", "def", "__call__", "(", "self", ",", "x_in", ",", "drop_rate", ",", "training", "=", "True", ")", ":", "\n", "# conv1", "\n", "        ", "x", "=", "self", ".", "conv1", "(", "x_in", ")", "\n", "# x = tf.nn.dropout(x, drop_rate)", "\n", "if", "self", ".", "use_bn", ":", "\n", "            ", "x", "=", "self", ".", "bn1", "(", "x", ",", "training", "=", "training", ")", "\n", "", "x", "=", "tf", ".", "nn", ".", "relu", "(", "x", ")", "\n", "\n", "# conv2", "\n", "x", "=", "self", ".", "conv2", "(", "x", ")", "\n", "# x = tf.nn.dropout(x, drop_rate)", "\n", "if", "self", ".", "use_bn", ":", "\n", "            ", "x", "=", "self", ".", "bn2", "(", "x", ",", "training", "=", "training", ")", "\n", "\n", "", "if", "self", ".", "use_res", ":", "\n", "            ", "x", "=", "self", ".", "res", "(", "x_in", ",", "x", ")", "\n", "", "x", "=", "tf", ".", "nn", ".", "relu", "(", "x", ")", "\n", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.vgg3d._Residual.__init__": [[94, 96], ["tensorflow.keras.layers.Layer.__init__"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg._UpSampling.__init__"], ["    ", "def", "__init__", "(", "self", ",", "name_scope", ")", ":", "\n", "        ", "super", "(", "_Residual", ",", "self", ")", ".", "__init__", "(", "name", "=", "name_scope", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.vgg3d._Residual.call": [[97, 104], ["tensorflow.concat", "tensorflow.zeros", "list"], "methods", ["None"], ["", "def", "call", "(", "self", ",", "x1", ",", "x2", ")", ":", "\n", "        ", "if", "x1", ".", "shape", "[", "-", "1", "]", "<", "x2", ".", "shape", "[", "-", "1", "]", ":", "\n", "            ", "x", "=", "tf", ".", "concat", "(", "[", "x1", ",", "tf", ".", "zeros", "(", "list", "(", "x1", ".", "shape", "[", ":", "-", "1", "]", ")", "+", "[", "x2", ".", "shape", "[", "-", "1", "]", "-", "x1", ".", "shape", "[", "-", "1", "]", "]", ")", "]", ",", "axis", "=", "-", "1", ")", "\n", "", "else", ":", "\n", "            ", "x", "=", "x1", "[", "...", ",", ":", "x2", ".", "shape", "[", "-", "1", "]", "]", "\n", "", "x", "=", "x", "+", "x2", "\n", "return", "x", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg.GEN_REG.__init__": [[8, 12], ["tensorflow.keras.Model.__init__"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg._UpSampling.__init__"], ["    ", "def", "__init__", "(", "self", ",", "gen", ",", "reg", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "gen", "=", "gen", "\n", "self", ".", "reg", "=", "reg", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg.GEN_REG.__call__": [[13, 17], ["gan_reg.GEN_REG.gen", "gan_reg.GEN_REG.reg"], "methods", ["None"], ["", "def", "__call__", "(", "self", ",", "x_in", ",", "drop_rate", ",", "training", "=", "False", ")", ":", "\n", "        ", "x1", "=", "self", ".", "gen", "(", "x_in", ",", "drop_rate", ",", "training", ")", "\n", "x2", "=", "self", ".", "reg", "(", "x1", ",", "drop_rate", ",", "training", ")", "\n", "return", "x1", ",", "x2", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg.Discriminator.__init__": [[20, 29], ["tensorflow.keras.Model.__init__", "gan_reg._DownSampling", "gan_reg._DownSampling", "gan_reg._DownSampling", "gan_reg._DownSampling", "tensorflow.keras.layers.Conv3D"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg._UpSampling.__init__"], ["    ", "def", "__init__", "(", "self", ",", "kernal_size", "=", "3", ",", "use_bn", "=", "True", ",", "padding", "=", "'SAME'", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "dw1", "=", "_DownSampling", "(", "64", ",", "kernal_size", ",", "'dw1'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "\n", "self", ".", "dw2", "=", "_DownSampling", "(", "128", ",", "kernal_size", ",", "'dw2'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "\n", "self", ".", "dw3", "=", "_DownSampling", "(", "256", ",", "kernal_size", ",", "'dw3'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "\n", "self", ".", "dw4", "=", "_DownSampling", "(", "512", ",", "kernal_size", ",", "'dw4'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "\n", "\n", "self", ".", "conv_out", "=", "layers", ".", "Conv3D", "(", "1", ",", "kernal_size", ",", "strides", "=", "1", ",", "padding", "=", "padding", ",", "use_bias", "=", "False", ",", "name", "=", "'conv_out'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg.Discriminator.__call__": [[30, 40], ["gan_reg.Discriminator.dw1", "gan_reg.Discriminator.dw2", "gan_reg.Discriminator.dw3", "gan_reg.Discriminator.dw4", "gan_reg.Discriminator.conv_out"], "methods", ["None"], ["", "def", "__call__", "(", "self", ",", "x_in", ",", "drop_rate", "=", "0", ",", "training", "=", "False", ")", ":", "\n", "        ", "x", "=", "self", ".", "dw1", "(", "x_in", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "dw2", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "dw3", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "dw4", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "\n", "x", "=", "self", ".", "conv_out", "(", "x", ")", "\n", "# x = tf.nn.sigmoid(x)", "\n", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg.Gen_encoder.__init__": [[42, 51], ["tensorflow.keras.Model.__init__", "gan_reg._DownSampling", "gan_reg._DownSampling", "gan_reg._DownSampling", "gan_reg._DownSampling", "gan_reg._DownSampling"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg._UpSampling.__init__"], ["    ", "def", "__init__", "(", "self", ",", "kernal_size", "=", "3", ",", "use_bn", "=", "True", ",", "padding", "=", "'SAME'", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\n", "\n", "self", ".", "dw1", "=", "_DownSampling", "(", "64", ",", "kernal_size", ",", "'dw1'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "# 48", "\n", "self", ".", "dw2", "=", "_DownSampling", "(", "128", ",", "kernal_size", ",", "'dw2'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "# 24", "\n", "self", ".", "dw3", "=", "_DownSampling", "(", "256", ",", "kernal_size", ",", "'dw3'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "# 12", "\n", "self", ".", "dw4", "=", "_DownSampling", "(", "512", ",", "kernal_size", ",", "'dw4'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "# 6", "\n", "self", ".", "dw5", "=", "_DownSampling", "(", "512", ",", "kernal_size", ",", "'dw5'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "# 3", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg.Gen_encoder.__call__": [[52, 61], ["gan_reg.Gen_encoder.dw1", "gan_reg.Gen_encoder.dw2", "gan_reg.Gen_encoder.dw3", "gan_reg.Gen_encoder.dw4", "gan_reg.Gen_encoder.dw5"], "methods", ["None"], ["", "@", "tf", ".", "function", "\n", "def", "__call__", "(", "self", ",", "x_in", ",", "drop_rate", "=", "0", ",", "training", "=", "False", ")", ":", "\n", "        ", "x", "=", "self", ".", "dw1", "(", "x_in", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "dw2", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "dw3", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "dw4", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "dw5", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg.Gen_decoder.__init__": [[63, 73], ["tensorflow.keras.Model.__init__", "gan_reg._UpSampling", "gan_reg._UpSampling", "gan_reg._UpSampling", "gan_reg._UpSampling", "gan_reg._UpSampling", "tensorflow.keras.layers.Conv3D"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg._UpSampling.__init__"], ["    ", "def", "__init__", "(", "self", ",", "output_channels", ",", "kernal_size", "=", "3", ",", "use_bn", "=", "True", ",", "padding", "=", "'SAME'", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "up1", "=", "_UpSampling", "(", "512", ",", "kernal_size", ",", "'up1'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "\n", "self", ".", "up2", "=", "_UpSampling", "(", "512", ",", "kernal_size", ",", "'up2'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "\n", "self", ".", "up3", "=", "_UpSampling", "(", "256", ",", "kernal_size", ",", "'up3'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "\n", "self", ".", "up4", "=", "_UpSampling", "(", "128", ",", "kernal_size", ",", "'up4'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "\n", "self", ".", "up5", "=", "_UpSampling", "(", "64", ",", "kernal_size", ",", "'up5'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "\n", "\n", "self", ".", "conv_out", "=", "layers", ".", "Conv3D", "(", "output_channels", ",", "1", ",", "padding", "=", "padding", ",", "use_bias", "=", "False", ",", "name", "=", "'conv_out'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg.Gen_decoder.__call__": [[74, 86], ["gan_reg.Gen_decoder.up1", "gan_reg.Gen_decoder.up2", "gan_reg.Gen_decoder.up3", "gan_reg.Gen_decoder.up4", "gan_reg.Gen_decoder.up5", "gan_reg.Gen_decoder.conv_out", "tensorflow.nn.relu"], "methods", ["None"], ["", "@", "tf", ".", "function", "\n", "def", "__call__", "(", "self", ",", "x_in", ",", "drop_rate", "=", "0", ",", "training", "=", "False", ")", ":", "\n", "\n", "        ", "x", "=", "self", ".", "up1", "(", "x_in", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "up2", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "up3", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "up4", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "up5", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "\n", "x", "=", "self", ".", "conv_out", "(", "x", ")", "\n", "x", "=", "tf", ".", "nn", ".", "relu", "(", "x", ")", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg.Generator.__init__": [[89, 107], ["tensorflow.keras.Model.__init__", "gan_reg._DownSampling", "gan_reg._DownSampling", "gan_reg._DownSampling", "gan_reg._DownSampling", "gan_reg._DownSampling", "gan_reg._UpSampling", "gan_reg._UpSampling", "gan_reg._UpSampling", "gan_reg._UpSampling", "gan_reg._UpSampling", "tensorflow.keras.layers.Conv3D"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg._UpSampling.__init__"], ["    ", "def", "__init__", "(", "self", ",", "output_channels", ",", "kernal_size", "=", "3", ",", "use_bn", "=", "True", ",", "padding", "=", "'SAME'", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\n", "\n", "self", ".", "dw1", "=", "_DownSampling", "(", "64", ",", "kernal_size", ",", "'dw1'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "# 48", "\n", "self", ".", "dw2", "=", "_DownSampling", "(", "128", ",", "kernal_size", ",", "'dw2'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "# 24", "\n", "self", ".", "dw3", "=", "_DownSampling", "(", "256", ",", "kernal_size", ",", "'dw3'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "# 12", "\n", "self", ".", "dw4", "=", "_DownSampling", "(", "512", ",", "kernal_size", ",", "'dw4'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "# 6", "\n", "self", ".", "dw5", "=", "_DownSampling", "(", "512", ",", "kernal_size", ",", "'dw5'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "# 3", "\n", "# self.dw6 = _DownSampling(512, kernal_size, 'dw6', use_bn=use_bn, padding=padding)", "\n", "\n", "self", ".", "up1", "=", "_UpSampling", "(", "512", ",", "kernal_size", ",", "'up1'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "\n", "self", ".", "up2", "=", "_UpSampling", "(", "512", ",", "kernal_size", ",", "'up2'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "\n", "self", ".", "up3", "=", "_UpSampling", "(", "256", ",", "kernal_size", ",", "'up3'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "\n", "self", ".", "up4", "=", "_UpSampling", "(", "128", ",", "kernal_size", ",", "'up4'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "\n", "self", ".", "up5", "=", "_UpSampling", "(", "64", ",", "kernal_size", ",", "'up5'", ",", "use_bn", "=", "use_bn", ",", "padding", "=", "padding", ")", "\n", "# self.up6 = _UpSampling(64, kernal_size, 'up6', use_bn=use_bn, padding=padding)", "\n", "self", ".", "conv_out", "=", "layers", ".", "Conv3D", "(", "output_channels", ",", "1", ",", "padding", "=", "padding", ",", "use_bias", "=", "False", ",", "name", "=", "'conv_out'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg.Generator.__call__": [[108, 127], ["gan_reg.Generator.dw1", "gan_reg.Generator.dw2", "gan_reg.Generator.dw3", "gan_reg.Generator.dw4", "gan_reg.Generator.dw5", "gan_reg.Generator.up1", "gan_reg.Generator.up2", "gan_reg.Generator.up3", "gan_reg.Generator.up4", "gan_reg.Generator.up5", "gan_reg.Generator.conv_out", "tensorflow.nn.relu"], "methods", ["None"], ["", "@", "tf", ".", "function", "\n", "def", "__call__", "(", "self", ",", "x_in", ",", "drop_rate", "=", "0", ",", "training", "=", "False", ")", ":", "\n", "        ", "x", "=", "self", ".", "dw1", "(", "x_in", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "dw2", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "dw3", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "dw4", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "dw5", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "# x = self.dw6(x, drop_rate, training)", "\n", "\n", "x", "=", "self", ".", "up1", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "up2", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "up3", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "up4", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "x", "=", "self", ".", "up5", "(", "x", ",", "drop_rate", ",", "training", ")", "\n", "# x = self.up6(x, drop_rate, training)", "\n", "\n", "x", "=", "self", ".", "conv_out", "(", "x", ")", "\n", "x", "=", "tf", ".", "nn", ".", "relu", "(", "x", ")", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg._DownSampling.__init__": [[130, 141], ["tensorflow.keras.layers.Layer.__init__", "numpy.sqrt", "tensorflow.keras.layers.Conv3D", "tensorflow.keras.layers.BatchNormalization", "tensorflow.keras.initializers.TruncatedNormal"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg._UpSampling.__init__"], ["    ", "def", "__init__", "(", "self", ",", "filters", ",", "kernel_size", ",", "name", ",", "pool_size", "=", "2", ",", "use_bn", "=", "True", ",", "use_res", "=", "True", ",", "padding", "=", "'SAME'", ",", "use_bias", "=", "True", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "name", "=", "name", ")", "\n", "self", ".", "use_bn", "=", "use_bn", "\n", "self", ".", "use_res", "=", "use_res", "\n", "stddev", "=", "np", ".", "sqrt", "(", "2", "/", "(", "kernel_size", "**", "2", "*", "filters", ")", ")", "\n", "self", ".", "conv", "=", "layers", ".", "Conv3D", "(", "filters", ",", "kernel_size", ",", "strides", "=", "pool_size", ",", "padding", "=", "padding", ",", "use_bias", "=", "use_bias", ",", "\n", "kernel_initializer", "=", "initializers", ".", "TruncatedNormal", "(", "stddev", "=", "stddev", ")", ",", "\n", "name", "=", "'conv'", ")", "\n", "\n", "if", "use_bn", ":", "\n", "            ", "self", ".", "bn", "=", "layers", ".", "BatchNormalization", "(", "momentum", "=", "0.99", ",", "name", "=", "'bn'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg._DownSampling.__call__": [[142, 151], ["gan_reg._DownSampling.conv", "tensorflow.nn.dropout", "tensorflow.nn.relu", "gan_reg._DownSampling.bn"], "methods", ["None"], ["", "", "def", "__call__", "(", "self", ",", "x_in", ",", "drop_rate", ",", "training", ")", ":", "\n", "# conv1", "\n", "        ", "x", "=", "self", ".", "conv", "(", "x_in", ")", "\n", "x", "=", "tf", ".", "nn", ".", "dropout", "(", "x", ",", "drop_rate", ")", "\n", "if", "self", ".", "use_bn", ":", "\n", "            ", "x", "=", "self", ".", "bn", "(", "x", ",", "training", "=", "training", ")", "\n", "", "x", "=", "tf", ".", "nn", ".", "relu", "(", "x", ")", "\n", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg._UpSampling.__init__": [[155, 166], ["tensorflow.keras.layers.Layer.__init__", "numpy.sqrt", "tensorflow.keras.layers.Conv3DTranspose", "tensorflow.keras.layers.BatchNormalization", "tensorflow.keras.initializers.TruncatedNormal"], "methods", ["home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg._UpSampling.__init__"], ["    ", "def", "__init__", "(", "self", ",", "filters", ",", "kernel_size", ",", "name", ",", "concat_or_add", "=", "'concat'", ",", "use_bn", "=", "True", ",", "padding", "=", "'SAME'", ",", "use_bias", "=", "True", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "name", "=", "name", ")", "\n", "self", ".", "use_bn", "=", "use_bn", "\n", "self", ".", "concat_or_add", "=", "concat_or_add", "\n", "stddev", "=", "np", ".", "sqrt", "(", "2", "/", "(", "kernel_size", "**", "2", "*", "filters", ")", ")", "\n", "self", ".", "deconv", "=", "layers", ".", "Conv3DTranspose", "(", "filters", "//", "2", ",", "kernel_size", ",", "strides", "=", "2", ",", "padding", "=", "padding", ",", "use_bias", "=", "use_bias", ",", "\n", "kernel_initializer", "=", "initializers", ".", "TruncatedNormal", "(", "stddev", "=", "stddev", ")", ",", "\n", "name", "=", "'deconv'", ")", "\n", "\n", "if", "use_bn", ":", "\n", "            ", "self", ".", "bn_deconv", "=", "layers", ".", "BatchNormalization", "(", "momentum", "=", "0.99", ",", "name", "=", "'bn_deconv'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ruizhe-l_tgb-gan.nets.gan_reg._UpSampling.__call__": [[167, 176], ["gan_reg._UpSampling.deconv", "tensorflow.nn.dropout", "tensorflow.nn.relu", "gan_reg._UpSampling.bn_deconv"], "methods", ["None"], ["", "", "def", "__call__", "(", "self", ",", "x_in", ",", "drop_rate", ",", "training", ")", ":", "\n", "# deconv", "\n", "        ", "x", "=", "self", ".", "deconv", "(", "x_in", ")", "\n", "x", "=", "tf", ".", "nn", ".", "dropout", "(", "x", ",", "drop_rate", ")", "\n", "if", "self", ".", "use_bn", ":", "\n", "            ", "x", "=", "self", ".", "bn_deconv", "(", "x", ",", "training", "=", "training", ")", "\n", "", "x", "=", "tf", ".", "nn", ".", "relu", "(", "x", ")", "\n", "\n", "return", "x", "\n", "", "", ""]]}