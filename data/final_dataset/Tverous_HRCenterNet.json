{"home.repos.pwc.inspect_result.Tverous_HRCenterNet.None.evaluate.main": [[25, 57], ["utils.utility.csv_preprocess", "print", "models.HRCenterNet.HRCenterNet", "model.to.load_state_dict", "model.to.to", "model.to.eval", "range", "print", "len", "print", "torch.load", "len", "print", "PIL.Image.open().convert", "test_tx", "image_tensor.unsqueeze_.unsqueeze_", "torch.autograd.Variable", "inp.to.to", "model.to.", "evaluate._nms", "print", "len", "PIL.Image.open"], "function", ["home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.utility.csv_preprocess", "home.repos.pwc.inspect_result.Tverous_HRCenterNet.models.HRCenterNet.HRCenterNet", "home.repos.pwc.inspect_result.Tverous_HRCenterNet.None.test._nms"], ["def", "main", "(", "args", ")", ":", "\n", "\n", "    ", "val_list", "=", "csv_preprocess", "(", "args", ".", "csv_path", ")", "\n", "print", "(", "\"found\"", ",", "len", "(", "val_list", ")", ",", "\"of images\"", ")", "\n", "\n", "if", "not", "(", "args", ".", "log_dir", "==", "None", ")", ":", "\n", "        ", "print", "(", "\"Load checkpoint from \"", "+", "args", ".", "log_dir", ")", "\n", "checkpoint", "=", "torch", ".", "load", "(", "args", ".", "log_dir", ",", "map_location", "=", "device", ")", "\n", "\n", "", "model", "=", "HRCenterNet", "(", ")", "\n", "model", ".", "load_state_dict", "(", "checkpoint", "[", "'model'", "]", ")", "\n", "model", "=", "model", ".", "to", "(", "device", ")", "\n", "model", ".", "eval", "(", ")", "\n", "\n", "iou_sum", "=", "0.", "\n", "\n", "for", "i", "in", "range", "(", "len", "(", "val_list", ")", ")", ":", "\n", "        ", "print", "(", "args", ".", "data_dir", "+", "val_list", "[", "i", "]", "[", "0", "]", ")", "\n", "img", "=", "Image", ".", "open", "(", "args", ".", "data_dir", "+", "val_list", "[", "i", "]", "[", "0", "]", ")", ".", "convert", "(", "\"RGB\"", ")", "\n", "\n", "image_tensor", "=", "test_tx", "(", "img", ")", "\n", "image_tensor", "=", "image_tensor", ".", "unsqueeze_", "(", "0", ")", "\n", "inp", "=", "Variable", "(", "image_tensor", ")", "\n", "inp", "=", "inp", ".", "to", "(", "device", ",", "dtype", "=", "torch", ".", "float", ")", "\n", "predict", "=", "model", "(", "inp", ")", "\n", "\n", "iou", "=", "_nms", "(", "args", ",", "img", ",", "predict", ",", "val_list", ",", "i", ",", "nms_score", "=", "0.3", ",", "iou_threshold", "=", "0.1", ")", "\n", "print", "(", "'IoU: '", ",", "iou", ")", "\n", "\n", "iou_sum", "=", "iou_sum", "+", "iou", "\n", "\n", "", "print", "(", "'Average IoU: '", ",", "iou_sum", "/", "len", "(", "val_list", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.None.evaluate._nms": [[58, 136], ["list", "list", "numpy.asarray().copy", "torchvision.ops.nms", "range", "utils.utility.calc_iou", "predict.data.cpu().numpy", "predict.data.cpu().numpy", "predict.data.cpu().numpy", "predict.data.cpu().numpy", "predict.data.cpu().numpy", "numpy.where", "list.append", "list.append", "len", "print", "list.append", "list.append", "torch.FloatTensor", "len", "skimage.draw.rectangle_perimeter", "range", "print", "PIL.Image.fromarray().save", "numpy.asarray", "torch.flatten", "len", "skimage.draw.rectangle_perimeter", "torchvision.transforms.functional.resize", "predict.data.cpu", "predict.data.cpu", "predict.data.cpu", "predict.data.cpu", "predict.data.cpu", "heatmap.reshape", "torch.FloatTensor", "int", "int", "int", "int", "PIL.Image.fromarray"], "function", ["home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.utility.calc_iou"], ["", "def", "_nms", "(", "args", ",", "img", ",", "predict", ",", "val_list", ",", "dindex", ",", "nms_score", ",", "iou_threshold", ")", ":", "\n", "\n", "    ", "bbox", "=", "list", "(", ")", "\n", "score_list", "=", "list", "(", ")", "\n", "im_draw", "=", "np", ".", "asarray", "(", "torchvision", ".", "transforms", ".", "functional", ".", "resize", "(", "img", ",", "(", "img", ".", "size", "[", "1", "]", ",", "img", ".", "size", "[", "0", "]", ")", ")", ")", ".", "copy", "(", ")", "\n", "\n", "heatmap", "=", "predict", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "0", ",", "...", "]", "\n", "offset_y", "=", "predict", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "1", ",", "...", "]", "\n", "offset_x", "=", "predict", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "2", ",", "...", "]", "\n", "width_map", "=", "predict", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "3", ",", "...", "]", "\n", "height_map", "=", "predict", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "4", ",", "...", "]", "\n", "\n", "for", "i", "in", "np", ".", "where", "(", "heatmap", ".", "reshape", "(", "-", "1", ",", "1", ")", ">=", "nms_score", ")", "[", "0", "]", ":", "\n", "\n", "        ", "row", "=", "i", "//", "output_size", "\n", "col", "=", "i", "-", "row", "*", "output_size", "\n", "\n", "bias_x", "=", "offset_x", "[", "row", ",", "col", "]", "*", "(", "img", ".", "size", "[", "1", "]", "/", "output_size", ")", "\n", "bias_y", "=", "offset_y", "[", "row", ",", "col", "]", "*", "(", "img", ".", "size", "[", "0", "]", "/", "output_size", ")", "\n", "\n", "width", "=", "width_map", "[", "row", ",", "col", "]", "*", "output_size", "*", "(", "img", ".", "size", "[", "1", "]", "/", "output_size", ")", "\n", "height", "=", "height_map", "[", "row", ",", "col", "]", "*", "output_size", "*", "(", "img", ".", "size", "[", "0", "]", "/", "output_size", ")", "\n", "\n", "score_list", ".", "append", "(", "heatmap", "[", "row", ",", "col", "]", ")", "\n", "\n", "row", "=", "row", "*", "(", "img", ".", "size", "[", "1", "]", "/", "output_size", ")", "+", "bias_y", "\n", "col", "=", "col", "*", "(", "img", ".", "size", "[", "0", "]", "/", "output_size", ")", "+", "bias_x", "\n", "\n", "top", "=", "row", "-", "width", "//", "2", "\n", "left", "=", "col", "-", "height", "//", "2", "\n", "bottom", "=", "row", "+", "width", "//", "2", "\n", "right", "=", "col", "+", "height", "//", "2", "\n", "\n", "start", "=", "(", "top", ",", "left", ")", "\n", "end", "=", "(", "bottom", ",", "right", ")", "\n", "\n", "bbox", ".", "append", "(", "[", "top", ",", "left", ",", "bottom", ",", "right", "]", ")", "\n", "\n", "", "if", "len", "(", "bbox", ")", "==", "0", ":", "\n", "        ", "print", "(", "'No object was found in the image'", ")", "\n", "bbox", ".", "append", "(", "[", "0", ",", "0", ",", "0", ",", "0", "]", ")", "\n", "score_list", ".", "append", "(", "0", ")", "\n", "\n", "", "_nms_index", "=", "torchvision", ".", "ops", ".", "nms", "(", "torch", ".", "FloatTensor", "(", "bbox", ")", ",", "scores", "=", "torch", ".", "flatten", "(", "torch", ".", "FloatTensor", "(", "score_list", ")", ")", ",", "iou_threshold", "=", "iou_threshold", ")", "\n", "\n", "for", "k", "in", "range", "(", "len", "(", "_nms_index", ")", ")", ":", "\n", "\n", "        ", "top", ",", "left", ",", "bottom", ",", "right", "=", "bbox", "[", "_nms_index", "[", "k", "]", "]", "\n", "\n", "start", "=", "(", "top", ",", "left", ")", "\n", "end", "=", "(", "bottom", ",", "right", ")", "\n", "\n", "rr", ",", "cc", "=", "rectangle_perimeter", "(", "start", ",", "end", "=", "end", ",", "shape", "=", "(", "img", ".", "size", "[", "1", "]", ",", "img", ".", "size", "[", "0", "]", ")", ")", "\n", "\n", "im_draw", "[", "rr", ",", "cc", "]", "=", "(", "255", ",", "0", ",", "0", ")", "\n", "\n", "", "if", "args", ".", "save_img", ":", "\n", "        ", "for", "j", "in", "range", "(", "1", ",", "len", "(", "val_list", "[", "dindex", "]", "[", "1", "]", ")", ")", ":", "\n", "            ", "x", ",", "y", ",", "width", ",", "height", "=", "val_list", "[", "dindex", "]", "[", "1", "]", "[", "j", "]", "[", "1", ":", "5", "]", "\n", "\n", "top", "=", "y", "-", "height", "//", "2", "\n", "left", "=", "x", "-", "width", "//", "2", "\n", "bottom", "=", "y", "+", "height", "//", "2", "\n", "right", "=", "x", "+", "width", "//", "2", "\n", "\n", "start", "=", "(", "int", "(", "top", ")", ",", "int", "(", "left", ")", ")", "\n", "end", "=", "(", "int", "(", "bottom", ")", ",", "int", "(", "right", ")", ")", "\n", "\n", "rr", ",", "cc", "=", "rectangle_perimeter", "(", "start", ",", "end", "=", "end", ",", "shape", "=", "(", "img", ".", "size", "[", "1", "]", ",", "img", ".", "size", "[", "0", "]", ")", ")", "\n", "\n", "im_draw", "[", "rr", ",", "cc", "]", "=", "(", "0", ",", "0", ",", "255", ")", "\n", "\n", "", "print", "(", "'save image to '", ",", "args", ".", "output_dir", "+", "val_list", "[", "dindex", "]", "[", "0", "]", ")", "\n", "Image", ".", "fromarray", "(", "im_draw", ")", ".", "save", "(", "args", ".", "output_dir", "+", "val_list", "[", "dindex", "]", "[", "0", "]", ")", "\n", "\n", "", "iou", "=", "calc_iou", "(", "bbox", ",", "_nms_index", ",", "val_list", ",", "dindex", ",", "imshape", "=", "(", "img", ".", "size", "[", "1", "]", ",", "img", ".", "size", "[", "0", "]", ")", ")", "\n", "\n", "return", "iou", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.None.train.main": [[18, 41], ["dict", "utils.utility.csv_preprocess", "print", "datasets.HanDataset.dataset_generator", "torch.utils.data.DataLoader", "train.train", "len", "utils.utility.csv_preprocess", "print", "datasets.HanDataset.dataset_generator", "torch.utils.data.DataLoader", "torch.load", "os.path.exists", "os.makedirs", "len"], "function", ["home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.utility.csv_preprocess", "home.repos.pwc.inspect_result.Tverous_HRCenterNet.datasets.HanDataset.dataset_generator", "home.repos.pwc.inspect_result.Tverous_HRCenterNet.None.train.train", "home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.utility.csv_preprocess", "home.repos.pwc.inspect_result.Tverous_HRCenterNet.datasets.HanDataset.dataset_generator"], ["def", "main", "(", "args", ")", ":", "\n", "\n", "    ", "dataloader", "=", "dict", "(", ")", "\n", "\n", "train_list", "=", "csv_preprocess", "(", "args", ".", "train_csv_path", ")", "\n", "print", "(", "\"found\"", ",", "len", "(", "train_list", ")", ",", "\"of images for training\"", ")", "\n", "train_set", "=", "dataset_generator", "(", "args", ".", "train_data_dir", ",", "train_list", ",", "crop_size", ",", "args", ".", "crop_ratio", ",", "output_size", ",", "train", "=", "True", ")", "\n", "dataloader", "[", "'train'", "]", "=", "torch", ".", "utils", ".", "data", ".", "DataLoader", "(", "train_set", ",", "batch_size", "=", "args", ".", "batch_size", ",", "shuffle", "=", "True", ")", "\n", "\n", "if", "args", ".", "val", ":", "\n", "        ", "val_list", "=", "csv_preprocess", "(", "args", ".", "val_csv_path", ")", "\n", "print", "(", "\"found\"", ",", "len", "(", "val_list", ")", ",", "\"of images for validation\"", ")", "\n", "val_set", "=", "dataset_generator", "(", "args", ".", "val_data_dir", ",", "val_list", ",", "crop_size", ",", "0", ",", "output_size", ",", "train", "=", "False", ")", "\n", "dataloader", "[", "'val'", "]", "=", "torch", ".", "utils", ".", "data", ".", "DataLoader", "(", "val_set", ",", "batch_size", "=", "1", ",", "shuffle", "=", "False", ")", "\n", "\n", "", "checkpoint", "=", "None", "\n", "if", "not", "(", "args", ".", "log_dir", "==", "None", ")", ":", "\n", "        ", "checkpoint", "=", "torch", ".", "load", "(", "args", ".", "log_dir", ",", "map_location", "=", "device", ")", "\n", "\n", "", "if", "not", "os", ".", "path", ".", "exists", "(", "args", ".", "weight_dir", ")", ":", "\n", "        ", "os", ".", "makedirs", "(", "args", ".", "weight_dir", ")", "\n", "\n", "", "train", "(", "args", ",", "dataloader", ",", "checkpoint", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.None.train.train": [[42, 105], ["dict", "models.HRCenterNet.HRCenterNet", "torch.optim.Adam", "model.to.to", "torch.optim.Adam.zero_grad", "range", "model.to.parameters", "print", "model.to.load_state_dict", "torch.optim.Adam.load_state_dict", "model.to.train", "enumerate", "print", "sample[].to", "sample[].to", "model.to.", "utils.losses.calc_loss", "sys.stdout.write", "sys.stdout.write", "sys.stdout.write", "sys.stdout.flush", "utils.losses.calc_loss.backward", "torch.optim.Adam.step", "torch.optim.Adam.zero_grad", "train.evaluate", "print", "print", "torch.save", "print", "print", "torch.save", "str", "torch.optim.Adam.state_dict", "model.to.state_dict", "torch.optim.Adam.state_dict", "model.to.state_dict", "str", "len", "len"], "function", ["home.repos.pwc.inspect_result.Tverous_HRCenterNet.models.HRCenterNet.HRCenterNet", "home.repos.pwc.inspect_result.Tverous_HRCenterNet.None.train.train", "home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.losses.calc_loss", "home.repos.pwc.inspect_result.Tverous_HRCenterNet.None.train.evaluate"], ["", "def", "train", "(", "args", ",", "dataloader", ",", "checkpoint", "=", "None", ")", ":", "\n", "\n", "    ", "num_epochs", "=", "args", ".", "epoch", "\n", "loss_average", "=", "0.", "\n", "best_iou", "=", "-", "1.", "\n", "metrics", "=", "dict", "(", ")", "\n", "\n", "model", "=", "HRCenterNet", "(", ")", "\n", "optimizer", "=", "torch", ".", "optim", ".", "Adam", "(", "model", ".", "parameters", "(", ")", ",", "lr", "=", "args", ".", "lr", ")", "\n", "model", "=", "model", ".", "to", "(", "device", ")", "\n", "\n", "if", "not", "(", "checkpoint", "==", "None", ")", ":", "\n", "        ", "print", "(", "\"Load checkpoint from \"", "+", "args", ".", "log_dir", ")", "\n", "model", ".", "load_state_dict", "(", "checkpoint", "[", "'model'", "]", ")", "\n", "optimizer", ".", "load_state_dict", "(", "checkpoint", "[", "'optimizer'", "]", ")", "\n", "best_iou", "=", "checkpoint", "[", "'best_iou'", "]", "\n", "\n", "", "optimizer", ".", "zero_grad", "(", ")", "\n", "\n", "for", "epoch", "in", "range", "(", "num_epochs", ")", ":", "\n", "        ", "loss", "=", "0.", "\n", "model", ".", "train", "(", ")", "\n", "\n", "for", "batch_idx", ",", "sample", "in", "enumerate", "(", "dataloader", "[", "'train'", "]", ")", ":", "\n", "            ", "inputs", "=", "sample", "[", "'image'", "]", ".", "to", "(", "device", ",", "dtype", "=", "torch", ".", "float", ")", "\n", "labels", "=", "sample", "[", "'labels'", "]", ".", "to", "(", "device", ",", "dtype", "=", "torch", ".", "float", ")", "\n", "\n", "outputs", "=", "model", "(", "inputs", ")", "\n", "\n", "loss", "=", "calc_loss", "(", "outputs", ",", "labels", ",", "metrics", ")", "\n", "\n", "loss_average", "=", "loss_average", "+", "metrics", "[", "'loss'", "]", "\n", "sys", ".", "stdout", ".", "write", "(", "'\\r'", ")", "\n", "sys", ".", "stdout", ".", "write", "(", "'Training: Epoch[%3d/%3d] Iter[%3d/%3d] Loss: %.5f heatmap_loss: %.4f size_loss: %.4f offset_loss: %.4f'", "\n", "%", "(", "epoch", "+", "1", ",", "num_epochs", ",", "batch_idx", ",", "(", "len", "(", "dataloader", "[", "'train'", "]", ".", "dataset", ")", "//", "(", "args", ".", "batch_size", ")", ")", "+", "1", ",", "\n", "metrics", "[", "'loss'", "]", ",", "metrics", "[", "'heatmap'", "]", ",", "metrics", "[", "'size'", "]", ",", "metrics", "[", "'offset'", "]", ")", ")", "\n", "sys", ".", "stdout", ".", "write", "(", "' average loss: %.5f'", "%", "(", "loss_average", "/", "(", "(", "(", "len", "(", "dataloader", "[", "'train'", "]", ".", "dataset", ")", "//", "(", "args", ".", "batch_size", ")", ")", "+", "1", ")", "*", "epoch", "+", "(", "batch_idx", "+", "1", ")", ")", ")", ")", "\n", "sys", ".", "stdout", ".", "flush", "(", ")", "\n", "\n", "loss", ".", "backward", "(", ")", "\n", "\n", "optimizer", ".", "step", "(", ")", "\n", "optimizer", ".", "zero_grad", "(", ")", "\n", "\n", "", "print", "(", ")", "\n", "if", "args", ".", "val", ":", "\n", "            ", "avg_iou", "=", "evaluate", "(", "dataloader", ",", "model", ")", "\n", "print", "(", "'Average IoU: '", ",", "avg_iou", ")", "\n", "if", "avg_iou", ">", "best_iou", ":", "\n", "                ", "print", "(", "'IoU improve from'", ",", "best_iou", ",", "'to'", ",", "avg_iou", ")", "\n", "best_iou", "=", "avg_iou", "\n", "print", "(", "'Saving model to'", ",", "args", ".", "weight_dir", ",", "'best.pth.tar'", ")", "\n", "torch", ".", "save", "(", "{", "'best_iou'", ":", "best_iou", ",", "\n", "'optimizer'", ":", "optimizer", ".", "state_dict", "(", ")", ",", "\n", "'model'", ":", "model", ".", "state_dict", "(", ")", "}", ",", "\n", "args", ".", "weight_dir", "+", "'best.pth.tar'", ")", "\n", "\n", "", "", "if", "(", "epoch", "%", "args", ".", "save_epoch", ")", "==", "0", ":", "\n", "            ", "print", "(", "'Saving model to {}{}.pth.tar'", ".", "format", "(", "args", ".", "weight_dir", ",", "str", "(", "epoch", ")", ")", ")", "\n", "torch", ".", "save", "(", "{", "'best_iou'", ":", "best_iou", ",", "\n", "'optimizer'", ":", "optimizer", ".", "state_dict", "(", ")", ",", "\n", "'model'", ":", "model", ".", "state_dict", "(", ")", "}", ",", "\n", "args", ".", "weight_dir", "+", "str", "(", "epoch", ")", "+", "'.pth.tar'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.None.train.evaluate": [[108, 124], ["model.eval", "enumerate", "tqdm.tqdm", "len", "torch.no_grad", "sample[].to", "sample[].to", "model", "utils.utility._nms_eval_iou", "img_width.item", "img_height.item"], "function", ["home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.utility._nms_eval_iou"], ["", "", "", "def", "evaluate", "(", "dataloader", ",", "model", ")", ":", "\n", "\n", "    ", "iou_sum", "=", "0.", "\n", "model", ".", "eval", "(", ")", "\n", "\n", "for", "batch_idx", ",", "sample", "in", "enumerate", "(", "tqdm", "(", "dataloader", "[", "'val'", "]", ",", "ascii", "=", "True", ",", "desc", "=", "'Evaluation'", ")", ")", ":", "\n", "        ", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "inputs", "=", "sample", "[", "'image'", "]", ".", "to", "(", "device", ",", "dtype", "=", "torch", ".", "float", ")", "\n", "labels", "=", "sample", "[", "'labels'", "]", ".", "to", "(", "device", ",", "dtype", "=", "torch", ".", "float", ")", "\n", "outputs", "=", "model", "(", "inputs", ")", "\n", "img_width", ",", "img_height", "=", "sample", "[", "'img_size'", "]", "\n", "iou", "=", "_nms_eval_iou", "(", "labels", ",", "outputs", ",", "img_width", ".", "item", "(", ")", ",", "img_height", ".", "item", "(", ")", ",", "output_size", ",", "nms_score", "=", "0.3", ",", "iou_threshold", "=", "0.1", ")", "\n", "\n", "iou_sum", "=", "iou_sum", "+", "iou", "\n", "\n", "", "", "return", "iou_sum", "/", "len", "(", "dataloader", "[", "'val'", "]", ".", "dataset", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.None.test.main": [[24, 50], ["models.HRCenterNet.HRCenterNet", "model.to.load_state_dict", "model.to.to", "model.to.eval", "os.listdir", "print", "torch.load", "os.path.exists", "os.makedirs", "PIL.Image.open().convert", "test_tx", "image_tensor.unsqueeze_.unsqueeze_", "torch.autograd.Variable", "inp.to.to", "model.to.", "test._nms", "print", "PIL.Image.fromarray().save", "PIL.Image.open", "PIL.Image.fromarray"], "function", ["home.repos.pwc.inspect_result.Tverous_HRCenterNet.models.HRCenterNet.HRCenterNet", "home.repos.pwc.inspect_result.Tverous_HRCenterNet.None.test._nms"], ["def", "main", "(", "args", ")", ":", "\n", "\n", "    ", "if", "not", "(", "args", ".", "log_dir", "==", "None", ")", ":", "\n", "        ", "print", "(", "\"Load checkpoint from \"", "+", "args", ".", "log_dir", ")", "\n", "checkpoint", "=", "torch", ".", "load", "(", "args", ".", "log_dir", ",", "map_location", "=", "\"cpu\"", ")", "\n", "\n", "", "model", "=", "HRCenterNet", "(", ")", "\n", "model", ".", "load_state_dict", "(", "checkpoint", "[", "'model'", "]", ")", "\n", "model", "=", "model", ".", "to", "(", "device", ")", "\n", "model", ".", "eval", "(", ")", "\n", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "args", ".", "output_dir", ")", ":", "\n", "        ", "os", ".", "makedirs", "(", "args", ".", "output_dir", ")", "\n", "\n", "", "for", "file", "in", "os", ".", "listdir", "(", "args", ".", "data_dir", ")", ":", "\n", "        ", "img", "=", "Image", ".", "open", "(", "args", ".", "data_dir", "+", "file", ")", ".", "convert", "(", "\"RGB\"", ")", "\n", "\n", "image_tensor", "=", "test_tx", "(", "img", ")", "\n", "image_tensor", "=", "image_tensor", ".", "unsqueeze_", "(", "0", ")", "\n", "inp", "=", "Variable", "(", "image_tensor", ")", "\n", "inp", "=", "inp", ".", "to", "(", "device", ",", "dtype", "=", "torch", ".", "float", ")", "\n", "predict", "=", "model", "(", "inp", ")", "\n", "\n", "out_img", "=", "_nms", "(", "args", ",", "img", ",", "predict", ",", "nms_score", "=", "0.3", ",", "iou_threshold", "=", "0.1", ")", "\n", "print", "(", "'saving image to '", ",", "args", ".", "output_dir", "+", "file", ")", "\n", "Image", ".", "fromarray", "(", "out_img", ")", ".", "save", "(", "args", ".", "output_dir", "+", "file", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.None.test._nms": [[52, 105], ["list", "list", "numpy.asarray().copy", "torchvision.ops.nms", "range", "predict.data.cpu().numpy", "predict.data.cpu().numpy", "predict.data.cpu().numpy", "predict.data.cpu().numpy", "predict.data.cpu().numpy", "numpy.where", "list.append", "list.append", "torch.FloatTensor", "len", "skimage.draw.rectangle_perimeter", "numpy.asarray", "torch.flatten", "torchvision.transforms.functional.resize", "predict.data.cpu", "predict.data.cpu", "predict.data.cpu", "predict.data.cpu", "predict.data.cpu", "heatmap.reshape", "torch.FloatTensor"], "function", ["None"], ["", "", "def", "_nms", "(", "args", ",", "img", ",", "predict", ",", "nms_score", ",", "iou_threshold", ")", ":", "\n", "\n", "    ", "bbox", "=", "list", "(", ")", "\n", "score_list", "=", "list", "(", ")", "\n", "im_draw", "=", "np", ".", "asarray", "(", "torchvision", ".", "transforms", ".", "functional", ".", "resize", "(", "img", ",", "(", "img", ".", "size", "[", "1", "]", ",", "img", ".", "size", "[", "0", "]", ")", ")", ")", ".", "copy", "(", ")", "\n", "\n", "heatmap", "=", "predict", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "0", ",", "...", "]", "\n", "offset_y", "=", "predict", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "1", ",", "...", "]", "\n", "offset_x", "=", "predict", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "2", ",", "...", "]", "\n", "width_map", "=", "predict", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "3", ",", "...", "]", "\n", "height_map", "=", "predict", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "4", ",", "...", "]", "\n", "\n", "\n", "for", "j", "in", "np", ".", "where", "(", "heatmap", ".", "reshape", "(", "-", "1", ",", "1", ")", ">=", "nms_score", ")", "[", "0", "]", ":", "\n", "\n", "        ", "row", "=", "j", "//", "output_size", "\n", "col", "=", "j", "-", "row", "*", "output_size", "\n", "\n", "bias_x", "=", "offset_x", "[", "row", ",", "col", "]", "*", "(", "img", ".", "size", "[", "1", "]", "/", "output_size", ")", "\n", "bias_y", "=", "offset_y", "[", "row", ",", "col", "]", "*", "(", "img", ".", "size", "[", "0", "]", "/", "output_size", ")", "\n", "\n", "width", "=", "width_map", "[", "row", ",", "col", "]", "*", "output_size", "*", "(", "img", ".", "size", "[", "1", "]", "/", "output_size", ")", "\n", "height", "=", "height_map", "[", "row", ",", "col", "]", "*", "output_size", "*", "(", "img", ".", "size", "[", "0", "]", "/", "output_size", ")", "\n", "\n", "score_list", ".", "append", "(", "heatmap", "[", "row", ",", "col", "]", ")", "\n", "\n", "row", "=", "row", "*", "(", "img", ".", "size", "[", "1", "]", "/", "output_size", ")", "+", "bias_y", "\n", "col", "=", "col", "*", "(", "img", ".", "size", "[", "0", "]", "/", "output_size", ")", "+", "bias_x", "\n", "\n", "top", "=", "row", "-", "width", "//", "2", "\n", "left", "=", "col", "-", "height", "//", "2", "\n", "bottom", "=", "row", "+", "width", "//", "2", "\n", "right", "=", "col", "+", "height", "//", "2", "\n", "\n", "start", "=", "(", "top", ",", "left", ")", "\n", "end", "=", "(", "bottom", ",", "right", ")", "\n", "\n", "bbox", ".", "append", "(", "[", "top", ",", "left", ",", "bottom", ",", "right", "]", ")", "\n", "\n", "", "_nms_index", "=", "torchvision", ".", "ops", ".", "nms", "(", "torch", ".", "FloatTensor", "(", "bbox", ")", ",", "scores", "=", "torch", ".", "flatten", "(", "torch", ".", "FloatTensor", "(", "score_list", ")", ")", ",", "iou_threshold", "=", "iou_threshold", ")", "\n", "\n", "for", "k", "in", "range", "(", "len", "(", "_nms_index", ")", ")", ":", "\n", "\n", "        ", "top", ",", "left", ",", "bottom", ",", "right", "=", "bbox", "[", "_nms_index", "[", "k", "]", "]", "\n", "\n", "start", "=", "(", "top", ",", "left", ")", "\n", "end", "=", "(", "bottom", ",", "right", ")", "\n", "\n", "rr", ",", "cc", "=", "rectangle_perimeter", "(", "start", ",", "end", "=", "end", ",", "shape", "=", "(", "img", ".", "size", "[", "1", "]", ",", "img", ".", "size", "[", "0", "]", ")", ")", "\n", "\n", "im_draw", "[", "rr", ",", "cc", "]", "=", "(", "255", ",", "0", ",", "0", ")", "\n", "\n", "", "return", "im_draw", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.utility.csv_preprocess": [[7, 25], ["pandas.read_csv", "list", "pd.read_csv.iterrows", "list", "[].split", "range", "list.append", "len", "list.append", "int", "int", "int", "int", "int", "int"], "function", ["None"], ["def", "csv_preprocess", "(", "csv", ")", ":", "\n", "\n", "    ", "df", "=", "pd", ".", "read_csv", "(", "csv", ")", "\n", "label_list", "=", "list", "(", ")", "\n", "\n", "for", "index", ",", "row", "in", "df", ".", "iterrows", "(", ")", ":", "\n", "\n", "        ", "bbox_list", "=", "list", "(", ")", "\n", "bbox_list_gt", "=", "df", ".", "iloc", "[", "index", "]", "[", "'labels'", "]", ".", "split", "(", "\" \"", ")", "\n", "\n", "for", "j", "in", "range", "(", "0", ",", "len", "(", "bbox_list_gt", ")", ",", "5", ")", ":", "\n", "\n", "            ", "uid", ",", "x", ",", "y", ",", "width", ",", "height", "=", "bbox_list_gt", "[", "j", ":", "j", "+", "5", "]", "\n", "bbox_list", ".", "append", "(", "[", "uid", ",", "int", "(", "x", ")", "+", "int", "(", "width", ")", "//", "2", ",", "int", "(", "y", ")", "+", "int", "(", "height", ")", "//", "2", ",", "int", "(", "width", ")", ",", "int", "(", "height", ")", "]", ")", "\n", "\n", "", "label_list", ".", "append", "(", "[", "df", ".", "iloc", "[", "index", "]", "[", "'image_id'", "]", ",", "bbox_list", "]", ")", "\n", "\n", "", "return", "label_list", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.utility.calc_iou": [[27, 67], ["numpy.zeros", "numpy.zeros", "range", "range", "numpy.multiply().sum", "len", "int", "int", "int", "int", "skimage.draw.rectangle", "len", "skimage.draw.rectangle", "numpy.multiply", "np.zeros.sum", "np.zeros.sum"], "function", ["None"], ["", "def", "calc_iou", "(", "bbox_pred", ",", "_nms_index", ",", "val_list", ",", "dindex", ",", "imshape", ")", ":", "\n", "    ", "mask_pred", "=", "np", ".", "zeros", "(", "imshape", ")", "\n", "mask_gt", "=", "np", ".", "zeros", "(", "imshape", ")", "\n", "\n", "for", "i", "in", "range", "(", "len", "(", "_nms_index", ")", ")", ":", "\n", "\n", "        ", "top", ",", "left", ",", "bottom", ",", "right", "=", "bbox_pred", "[", "_nms_index", "[", "i", "]", "]", "\n", "\n", "top", "=", "int", "(", "top", ")", "\n", "left", "=", "int", "(", "left", ")", "\n", "bottom", "=", "int", "(", "bottom", ")", "\n", "right", "=", "int", "(", "right", ")", "\n", "\n", "start", "=", "(", "top", ",", "left", ")", "\n", "end", "=", "(", "bottom", ",", "right", ")", "\n", "\n", "rrf", ",", "ccf", "=", "rectangle", "(", "start", ",", "end", "=", "end", ",", "shape", "=", "mask_pred", ".", "shape", ")", "\n", "\n", "mask_pred", "[", "rrf", ",", "ccf", "]", "=", "1", "\n", "\n", "", "for", "j", "in", "range", "(", "1", ",", "len", "(", "val_list", "[", "dindex", "]", "[", "1", "]", ")", ")", ":", "\n", "        ", "x", ",", "y", ",", "width", ",", "height", "=", "val_list", "[", "dindex", "]", "[", "1", "]", "[", "j", "]", "[", "1", ":", "5", "]", "\n", "\n", "\n", "top", "=", "y", "-", "height", "//", "2", "\n", "left", "=", "x", "-", "width", "//", "2", "\n", "bottom", "=", "y", "+", "height", "//", "2", "\n", "right", "=", "x", "+", "width", "//", "2", "\n", "\n", "start", "=", "(", "top", ",", "left", ")", "\n", "end", "=", "(", "bottom", ",", "right", ")", "\n", "\n", "rrf", ",", "ccf", "=", "rectangle", "(", "start", ",", "end", "=", "end", ",", "shape", "=", "mask_gt", ".", "shape", ")", "\n", "\n", "mask_gt", "[", "rrf", ",", "ccf", "]", "=", "1", "\n", "\n", "", "intersection", "=", "np", ".", "multiply", "(", "mask_pred", ",", "mask_gt", ")", ".", "sum", "(", ")", "\n", "iou", "=", "intersection", "/", "(", "mask_pred", ".", "sum", "(", ")", "+", "mask_gt", ".", "sum", "(", ")", "-", "intersection", ")", "\n", "\n", "return", "iou", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.utility._nms_eval_iou": [[68, 78], ["utility.get_pred_mask", "utility.get_gt_mask", "numpy.multiply().sum", "numpy.multiply", "get_pred_mask.sum", "get_gt_mask.sum"], "function", ["home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.utility.get_pred_mask", "home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.utility.get_gt_mask"], ["", "def", "_nms_eval_iou", "(", "gt", ",", "predict", ",", "img_width", ",", "img_height", ",", "output_size", ",", "nms_score", ",", "iou_threshold", ")", ":", "\n", "\n", "\n", "    ", "mask_pred", "=", "get_pred_mask", "(", "predict", ",", "img_width", ",", "img_height", ",", "output_size", ",", "nms_score", ",", "iou_threshold", ")", "\n", "mask_gt", "=", "get_gt_mask", "(", "gt", ",", "img_width", ",", "img_height", ",", "output_size", ")", "\n", "\n", "intersection", "=", "np", ".", "multiply", "(", "mask_pred", ",", "mask_gt", ")", ".", "sum", "(", ")", "\n", "iou", "=", "intersection", "/", "(", "mask_pred", ".", "sum", "(", ")", "+", "mask_gt", ".", "sum", "(", ")", "-", "intersection", ")", "\n", "\n", "return", "iou", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.utility.get_pred_mask": [[79, 140], ["list", "list", "torchvision.ops.nms", "numpy.zeros", "range", "predict.data.cpu().numpy", "predict.data.cpu().numpy", "predict.data.cpu().numpy", "predict.data.cpu().numpy", "predict.data.cpu().numpy", "numpy.where", "list.append", "list.append", "len", "print", "list.append", "list.append", "torch.FloatTensor", "len", "int", "int", "int", "int", "skimage.draw.rectangle", "torch.flatten", "predict.data.cpu", "predict.data.cpu", "predict.data.cpu", "predict.data.cpu", "predict.data.cpu", "heatmap.reshape", "torch.FloatTensor"], "function", ["None"], ["", "def", "get_pred_mask", "(", "predict", ",", "img_width", ",", "img_height", ",", "output_size", ",", "nms_score", ",", "iou_threshold", ")", ":", "\n", "    ", "bbox", "=", "list", "(", ")", "\n", "score_list", "=", "list", "(", ")", "\n", "\n", "heatmap", "=", "predict", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "0", ",", "...", "]", "\n", "offset_y", "=", "predict", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "1", ",", "...", "]", "\n", "offset_x", "=", "predict", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "2", ",", "...", "]", "\n", "width_map", "=", "predict", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "3", ",", "...", "]", "\n", "height_map", "=", "predict", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "4", ",", "...", "]", "\n", "\n", "for", "i", "in", "np", ".", "where", "(", "heatmap", ".", "reshape", "(", "-", "1", ",", "1", ")", ">=", "nms_score", ")", "[", "0", "]", ":", "\n", "\n", "        ", "row", "=", "i", "//", "output_size", "\n", "col", "=", "i", "-", "row", "*", "output_size", "\n", "\n", "bias_x", "=", "offset_x", "[", "row", ",", "col", "]", "*", "(", "img_height", "/", "output_size", ")", "\n", "bias_y", "=", "offset_y", "[", "row", ",", "col", "]", "*", "(", "img_width", "/", "output_size", ")", "\n", "\n", "width", "=", "width_map", "[", "row", ",", "col", "]", "*", "output_size", "*", "(", "img_height", "/", "output_size", ")", "\n", "height", "=", "height_map", "[", "row", ",", "col", "]", "*", "output_size", "*", "(", "img_width", "/", "output_size", ")", "\n", "\n", "score_list", ".", "append", "(", "heatmap", "[", "row", ",", "col", "]", ")", "\n", "\n", "row", "=", "row", "*", "(", "img_height", "/", "output_size", ")", "+", "bias_y", "\n", "col", "=", "col", "*", "(", "img_width", "/", "output_size", ")", "+", "bias_x", "\n", "\n", "top", "=", "row", "-", "width", "//", "2", "\n", "left", "=", "col", "-", "height", "//", "2", "\n", "bottom", "=", "row", "+", "width", "//", "2", "\n", "right", "=", "col", "+", "height", "//", "2", "\n", "\n", "start", "=", "(", "top", ",", "left", ")", "\n", "end", "=", "(", "bottom", ",", "right", ")", "\n", "\n", "bbox", ".", "append", "(", "[", "top", ",", "left", ",", "bottom", ",", "right", "]", ")", "\n", "\n", "", "if", "len", "(", "bbox", ")", "==", "0", ":", "\n", "        ", "print", "(", "'No object was found in the image'", ")", "\n", "bbox", ".", "append", "(", "[", "0", ",", "0", ",", "0", ",", "0", "]", ")", "\n", "score_list", ".", "append", "(", "0", ")", "\n", "\n", "", "_nms_index", "=", "torchvision", ".", "ops", ".", "nms", "(", "torch", ".", "FloatTensor", "(", "bbox", ")", ",", "scores", "=", "torch", ".", "flatten", "(", "torch", ".", "FloatTensor", "(", "score_list", ")", ")", ",", "iou_threshold", "=", "iou_threshold", ")", "\n", "\n", "mask_pred", "=", "np", ".", "zeros", "(", "(", "img_height", ",", "img_width", ")", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "_nms_index", ")", ")", ":", "\n", "\n", "        ", "top", ",", "left", ",", "bottom", ",", "right", "=", "bbox", "[", "_nms_index", "[", "i", "]", "]", "\n", "\n", "top", "=", "int", "(", "top", ")", "\n", "left", "=", "int", "(", "left", ")", "\n", "bottom", "=", "int", "(", "bottom", ")", "\n", "right", "=", "int", "(", "right", ")", "\n", "\n", "start", "=", "(", "top", ",", "left", ")", "\n", "end", "=", "(", "bottom", ",", "right", ")", "\n", "\n", "rrf", ",", "ccf", "=", "rectangle", "(", "start", ",", "end", "=", "end", ",", "shape", "=", "mask_pred", ".", "shape", ")", "\n", "\n", "mask_pred", "[", "rrf", ",", "ccf", "]", "=", "1", "\n", "\n", "", "return", "mask_pred", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.utility.get_gt_mask": [[141, 192], ["list", "numpy.zeros", "range", "gt.data.cpu().numpy", "gt.data.cpu().numpy", "gt.data.cpu().numpy", "gt.data.cpu().numpy", "gt.data.cpu().numpy", "numpy.where", "list.append", "len", "int", "int", "int", "int", "skimage.draw.rectangle", "gt.data.cpu", "gt.data.cpu", "gt.data.cpu", "gt.data.cpu", "gt.data.cpu", "heatmap_gt.reshape"], "function", ["None"], ["", "def", "get_gt_mask", "(", "gt", ",", "img_width", ",", "img_height", ",", "output_size", ")", ":", "\n", "    ", "bbox_gt", "=", "list", "(", ")", "\n", "\n", "heatmap_gt", "=", "gt", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "...", ",", "1", "]", "\n", "offset_y_gt", "=", "gt", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "...", ",", "2", "]", "\n", "offset_x_gt", "=", "gt", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "...", ",", "3", "]", "\n", "width_map_gt", "=", "gt", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "...", ",", "4", "]", "\n", "height_map_gt", "=", "gt", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "...", ",", "5", "]", "\n", "\n", "for", "j", "in", "np", ".", "where", "(", "heatmap_gt", ".", "reshape", "(", "-", "1", ",", "1", ")", "==", "1", ")", "[", "0", "]", ":", "\n", "\n", "        ", "row", "=", "j", "//", "output_size", "\n", "col", "=", "j", "-", "row", "*", "output_size", "\n", "\n", "bias_x_gt", "=", "offset_x_gt", "[", "row", ",", "col", "]", "*", "(", "img_height", "/", "output_size", ")", "\n", "bias_y_gt", "=", "offset_y_gt", "[", "row", ",", "col", "]", "*", "(", "img_width", "/", "output_size", ")", "\n", "\n", "width", "=", "width_map_gt", "[", "row", ",", "col", "]", "*", "output_size", "*", "(", "img_height", "/", "output_size", ")", "\n", "height", "=", "height_map_gt", "[", "row", ",", "col", "]", "*", "output_size", "*", "(", "img_width", "/", "output_size", ")", "\n", "\n", "row", "=", "row", "*", "(", "img_height", "/", "output_size", ")", "+", "bias_y_gt", "\n", "col", "=", "col", "*", "(", "img_width", "/", "output_size", ")", "+", "bias_x_gt", "\n", "\n", "top", "=", "row", "-", "width", "//", "2", "\n", "left", "=", "col", "-", "height", "//", "2", "\n", "bottom", "=", "row", "+", "width", "//", "2", "\n", "right", "=", "col", "+", "height", "//", "2", "\n", "\n", "start", "=", "(", "top", ",", "left", ")", "\n", "end", "=", "(", "bottom", ",", "right", ")", "\n", "\n", "bbox_gt", ".", "append", "(", "[", "top", ",", "left", ",", "bottom", ",", "right", "]", ")", "\n", "\n", "", "mask_gt", "=", "np", ".", "zeros", "(", "(", "img_height", ",", "img_width", ")", ")", "\n", "\n", "for", "j", "in", "range", "(", "len", "(", "bbox_gt", ")", ")", ":", "\n", "        ", "top", ",", "left", ",", "bottom", ",", "right", "=", "bbox_gt", "[", "j", "]", "\n", "\n", "top", "=", "int", "(", "top", ")", "\n", "left", "=", "int", "(", "left", ")", "\n", "bottom", "=", "int", "(", "bottom", ")", "\n", "right", "=", "int", "(", "right", ")", "\n", "\n", "start", "=", "(", "top", ",", "left", ")", "\n", "end", "=", "(", "bottom", ",", "right", ")", "\n", "\n", "rrf", ",", "ccf", "=", "rectangle", "(", "start", ",", "end", "=", "end", ",", "shape", "=", "mask_gt", ".", "shape", ")", "\n", "\n", "mask_gt", "[", "rrf", ",", "ccf", "]", "=", "1", "\n", "\n", "", "return", "mask_gt", "\n", "", ""]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.losses.calc_loss": [[3, 23], ["torch.sign", "torch.sum", "losses.heatmap_loss", "losses.size_loss", "losses.offset_loss", "all_loss.item"], "function", ["home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.losses.heatmap_loss", "home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.losses.size_loss", "home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.losses.offset_loss"], ["def", "calc_loss", "(", "pred", ",", "gt", ",", "metrics", ")", ":", "\n", "\n", "    ", "mask", "=", "torch", ".", "sign", "(", "gt", "[", "...", ",", "1", "]", ")", "\n", "N", "=", "torch", ".", "sum", "(", "mask", ")", "\n", "\n", "if", "N", "==", "0", ":", "\n", "        ", "N", "=", "1", "\n", "\n", "", "_heatmap_loss", "=", "heatmap_loss", "(", "pred", ",", "gt", ",", "mask", ",", "metrics", ")", "\n", "_size_loss", "=", "size_loss", "(", "pred", ",", "gt", ",", "mask", ",", "metrics", ")", "\n", "_offset_loss", "=", "offset_loss", "(", "pred", ",", "gt", ",", "mask", ",", "metrics", ")", "\n", "\n", "all_loss", "=", "(", "-", "1", "*", "_heatmap_loss", "+", "10.", "*", "_size_loss", "+", "5.", "*", "_offset_loss", ")", "/", "N", "\n", "\n", "metrics", "[", "'loss'", "]", "=", "all_loss", ".", "item", "(", ")", "\n", "metrics", "[", "'heatmap'", "]", "=", "(", "-", "1", "*", "_heatmap_loss", "/", "N", ")", ".", "item", "(", ")", "\n", "metrics", "[", "'size'", "]", "=", "(", "10.", "*", "_size_loss", "/", "N", ")", ".", "item", "(", ")", "\n", "metrics", "[", "'offset'", "]", "=", "(", "5.", "*", "_offset_loss", "/", "N", ")", ".", "item", "(", ")", "\n", "\n", "return", "all_loss", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.losses.heatmap_loss": [[24, 37], ["torch.flatten", "torch.flatten", "torch.flatten", "torch.sum", "torch.log", "torch.log"], "function", ["None"], ["", "def", "heatmap_loss", "(", "pred", ",", "gt", ",", "mask", ",", "metrics", ")", ":", "\n", "\n", "    ", "alpha", "=", "2.", "\n", "beta", "=", "4.", "\n", "\n", "heatmap_gt_rate", "=", "torch", ".", "flatten", "(", "gt", "[", "...", ",", ":", "1", "]", ")", "\n", "heatmap_gt", "=", "torch", ".", "flatten", "(", "gt", "[", "...", ",", "1", ":", "2", "]", ")", "\n", "heatmap_pred", "=", "torch", ".", "flatten", "(", "pred", "[", ":", ",", ":", "1", ",", "...", "]", ")", "\n", "\n", "heatloss", "=", "torch", ".", "sum", "(", "heatmap_gt", "*", "(", "(", "1", "-", "heatmap_pred", ")", "**", "alpha", ")", "*", "torch", ".", "log", "(", "heatmap_pred", "+", "1e-9", ")", "+", "\n", "(", "1", "-", "heatmap_gt", ")", "*", "(", "(", "1", "-", "heatmap_gt_rate", ")", "**", "beta", ")", "*", "(", "heatmap_pred", "**", "alpha", ")", "*", "torch", ".", "log", "(", "1", "-", "heatmap_pred", "+", "1e-9", ")", ")", "\n", "\n", "return", "heatloss", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.losses.offset_loss": [[38, 43], ["torch.sum", "torch.abs", "torch.abs"], "function", ["None"], ["", "def", "offset_loss", "(", "pred", ",", "gt", ",", "mask", ",", "metrics", ")", ":", "\n", "\n", "    ", "offsetloss", "=", "torch", ".", "sum", "(", "torch", ".", "abs", "(", "gt", "[", "...", ",", "2", "]", "-", "pred", "[", ":", ",", "1", ",", "...", "]", "*", "mask", ")", "+", "torch", ".", "abs", "(", "gt", "[", "...", ",", "3", "]", "-", "pred", "[", ":", ",", "2", ",", "...", "]", "*", "mask", ")", ")", "\n", "\n", "return", "offsetloss", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.utils.losses.size_loss": [[44, 49], ["torch.sum", "torch.abs", "torch.abs"], "function", ["None"], ["", "def", "size_loss", "(", "pred", ",", "gt", ",", "mask", ",", "metrics", ")", ":", "\n", "\n", "    ", "sizeloss", "=", "torch", ".", "sum", "(", "torch", ".", "abs", "(", "gt", "[", "...", ",", "4", "]", "-", "pred", "[", ":", ",", "3", ",", "...", "]", "*", "mask", ")", "+", "torch", ".", "abs", "(", "gt", "[", "...", ",", "5", "]", "-", "pred", "[", ":", ",", "4", ",", "...", "]", "*", "mask", ")", ")", "\n", "\n", "return", "sizeloss", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.datasets.HanDataset.HanDataset.__init__": [[18, 27], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "data_list", ",", "image_path", ",", "crop_ratio", ",", "crop_size", ",", "output_size", ",", "transform", "=", "None", ",", "train", "=", "False", ")", ":", "\n", "\n", "        ", "self", ".", "data_list", "=", "data_list", "\n", "self", ".", "image_path", "=", "image_path", "\n", "self", ".", "transform", "=", "transform", "\n", "self", ".", "crop_ratio", "=", "crop_ratio", "\n", "self", ".", "crop_size", "=", "crop_size", "\n", "self", ".", "output_size", "=", "output_size", "\n", "self", ".", "train", "=", "train", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.datasets.HanDataset.HanDataset.__len__": [[28, 31], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "\n", "        ", "return", "len", "(", "self", ".", "data_list", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.datasets.HanDataset.HanDataset.__getitem__": [[32, 101], ["PIL.Image.open().convert", "numpy.zeros", "torchvision.transforms.functional.resize", "numpy.random.randint", "numpy.random.randint", "HanDataset.HanDataset.crop", "torchvision.transforms.functional.resize", "numpy.maximum", "HanDataset.HanDataset.transform", "PIL.Image.open", "numpy.random.randint", "numpy.exp().reshape", "numpy.exp().reshape", "numpy.exp", "numpy.exp", "int", "int", "int", "int", "int", "int", "int", "int", "int", "int", "numpy.arange", "numpy.arange"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "idx", ")", ":", "\n", "\n", "        ", "file_name", "=", "self", ".", "data_list", "[", "idx", "]", "[", "0", "]", "\n", "img", "=", "Image", ".", "open", "(", "self", ".", "image_path", "+", "file_name", ")", ".", "convert", "(", "'RGB'", ")", "\n", "\n", "origin_pic_width", ",", "origin_pic_height", "=", "img", ".", "size", "\n", "output_width", ",", "output_height", "=", "(", "self", ".", "output_size", ",", "self", ".", "output_size", ")", "\n", "\n", "label", "=", "np", ".", "zeros", "(", "(", "output_height", ",", "output_width", ",", "6", ")", ")", "\n", "\n", "if", "origin_pic_height", "<", "self", ".", "crop_size", "or", "origin_pic_width", "<", "self", ".", "crop_size", ":", "\n", "            ", "img", "=", "torchvision", ".", "transforms", ".", "functional", ".", "resize", "(", "img", ",", "(", "self", ".", "crop_size", ",", "self", ".", "crop_size", ")", ")", "\n", "\n", "", "pic_width", ",", "pic_height", "=", "img", ".", "size", "\n", "_CROPPED", "=", "False", "\n", "\n", "if", "np", ".", "random", ".", "randint", "(", "0", ",", "101", ")", "<", "self", ".", "crop_ratio", "*", "100", "and", "pic_height", ">=", "self", ".", "crop_size", "and", "pic_width", ">=", "self", ".", "crop_size", ":", "\n", "\n", "            ", "top", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "pic_height", "-", "self", ".", "crop_size", "+", "1", ")", "\n", "left", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "pic_width", "-", "self", ".", "crop_size", "+", "1", ")", "\n", "img", "=", "img", ".", "crop", "(", "(", "left", ",", "top", ",", "left", "+", "self", ".", "crop_size", ",", "top", "+", "self", ".", "crop_size", ")", ")", "\n", "_CROPPED", "=", "True", "\n", "centerX", "=", "(", "2", "*", "left", "+", "self", ".", "crop_size", ")", "/", "2", "\n", "centerY", "=", "(", "2", "*", "top", "+", "self", ".", "crop_size", ")", "/", "2", "\n", "offsetX", "=", "(", "centerX", "-", "self", ".", "crop_size", "/", "2", ")", "*", "self", ".", "output_size", "/", "self", ".", "crop_size", "\n", "offsetY", "=", "(", "centerY", "-", "self", ".", "crop_size", "/", "2", ")", "*", "self", ".", "output_size", "/", "self", ".", "crop_size", "\n", "", "else", ":", "\n", "\n", "            ", "top", "=", "0", "\n", "left", "=", "0", "\n", "img", "=", "torchvision", ".", "transforms", ".", "functional", ".", "resize", "(", "img", ",", "(", "self", ".", "crop_size", ",", "self", ".", "crop_size", ")", ")", "\n", "offsetX", "=", "0", "\n", "offsetY", "=", "0", "\n", "\n", "", "for", "annotation", "in", "self", ".", "data_list", "[", "idx", "]", "[", "1", "]", ":", "\n", "\n", "            ", "if", "_CROPPED", ":", "\n", "                ", "x_c", "=", "annotation", "[", "1", "]", "*", "(", "pic_width", "/", "origin_pic_width", ")", "*", "(", "output_width", "/", "self", ".", "crop_size", ")", "-", "offsetX", "\n", "y_c", "=", "annotation", "[", "2", "]", "*", "(", "pic_height", "/", "origin_pic_height", ")", "*", "(", "output_height", "/", "self", ".", "crop_size", ")", "-", "offsetY", "\n", "width", "=", "annotation", "[", "3", "]", "*", "(", "pic_width", "/", "origin_pic_width", ")", "*", "(", "output_width", "/", "self", ".", "crop_size", ")", "\n", "height", "=", "annotation", "[", "4", "]", "*", "(", "pic_height", "/", "origin_pic_height", ")", "*", "(", "output_height", "/", "self", ".", "crop_size", ")", "\n", "", "else", ":", "\n", "                ", "x_c", "=", "annotation", "[", "1", "]", "*", "(", "output_width", "/", "origin_pic_width", ")", "\n", "y_c", "=", "annotation", "[", "2", "]", "*", "(", "output_height", "/", "origin_pic_height", ")", "\n", "width", "=", "annotation", "[", "3", "]", "*", "(", "output_width", "/", "origin_pic_width", ")", "\n", "height", "=", "annotation", "[", "4", "]", "*", "(", "output_height", "/", "origin_pic_height", ")", "\n", "\n", "", "if", "x_c", ">=", "self", ".", "output_size", "or", "y_c", ">=", "self", ".", "output_size", "or", "x_c", "<=", "0", "or", "y_c", "<=", "0", ":", "\n", "                ", "continue", "\n", "\n", "", "heatmap", "=", "(", "(", "np", ".", "exp", "(", "-", "(", "(", "(", "np", ".", "arange", "(", "output_width", ")", "-", "x_c", ")", "/", "(", "width", "/", "10", ")", ")", "**", "2", ")", "/", "2", ")", ")", ".", "reshape", "(", "1", ",", "-", "1", ")", "\n", "*", "(", "np", ".", "exp", "(", "-", "(", "(", "(", "np", ".", "arange", "(", "output_height", ")", "-", "y_c", ")", "/", "(", "height", "/", "10", ")", ")", "**", "2", ")", "/", "2", ")", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", ")", "\n", "\n", "label", "[", ":", ",", ":", ",", "0", "]", "=", "np", ".", "maximum", "(", "label", "[", ":", ",", ":", ",", "0", "]", ",", "heatmap", "[", ":", ",", ":", "]", ")", "\n", "label", "[", "int", "(", "y_c", "//", "1", ")", ",", "int", "(", "x_c", "//", "1", ")", ",", "1", "]", "=", "1", "\n", "label", "[", "int", "(", "y_c", "//", "1", ")", ",", "int", "(", "x_c", "//", "1", ")", ",", "2", "]", "=", "y_c", "%", "1", "\n", "label", "[", "int", "(", "y_c", "//", "1", ")", ",", "int", "(", "x_c", "//", "1", ")", ",", "3", "]", "=", "x_c", "%", "1", "\n", "label", "[", "int", "(", "y_c", "//", "1", ")", ",", "int", "(", "x_c", "//", "1", ")", ",", "4", "]", "=", "height", "/", "self", ".", "output_size", "\n", "label", "[", "int", "(", "y_c", "//", "1", ")", ",", "int", "(", "x_c", "//", "1", ")", ",", "5", "]", "=", "width", "/", "self", ".", "output_size", "\n", "\n", "", "if", "self", ".", "transform", ":", "\n", "            ", "img", "=", "self", ".", "transform", "(", "img", ")", "\n", "\n", "", "if", "self", ".", "train", ":", "\n", "            ", "sample", "=", "{", "'image'", ":", "img", ",", "'labels'", ":", "label", "}", "\n", "", "elif", "not", "self", ".", "train", ":", "\n", "            ", "sample", "=", "{", "'image'", ":", "img", ",", "'labels'", ":", "label", ",", "'img_size'", ":", "[", "origin_pic_width", ",", "origin_pic_height", "]", "}", "\n", "\n", "", "return", "sample", "", "", "", ""]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.datasets.HanDataset.dataset_generator": [[6, 15], ["torchvision.transforms.Compose", "HanDataset.HanDataset", "torchvision.transforms.ToTensor"], "function", ["None"], ["def", "dataset_generator", "(", "data_dir", ",", "data_list", ",", "crop_size", ",", "crop_ratio", ",", "output_size", ",", "train", "=", "False", ")", ":", "\n", "\n", "    ", "train_tx", "=", "torchvision", ".", "transforms", ".", "Compose", "(", "[", "\n", "torchvision", ".", "transforms", ".", "ToTensor", "(", ")", ",", "\n", "]", ")", "\n", "\n", "data_set", "=", "HanDataset", "(", "data_list", ",", "data_dir", ",", "crop_ratio", ",", "crop_size", ",", "output_size", ",", "transform", "=", "train_tx", ",", "train", "=", "train", ")", "\n", "\n", "return", "data_set", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.models.modules.Bottleneck.__init__": [[6, 17], ["torch.nn.Module.__init__", "torch.nn.Conv2d", "torch.nn.BatchNorm2d", "torch.nn.Conv2d", "torch.nn.BatchNorm2d", "torch.nn.Conv2d", "torch.nn.BatchNorm2d", "torch.nn.ReLU"], "methods", ["home.repos.pwc.inspect_result.Tverous_HRCenterNet.models.HRCenterNet._HRCenterNet.__init__"], ["def", "__init__", "(", "self", ",", "inplanes", ",", "planes", ",", "stride", "=", "1", ",", "downsample", "=", "None", ",", "bn_momentum", "=", "0.1", ")", ":", "\n", "        ", "super", "(", "Bottleneck", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "conv1", "=", "nn", ".", "Conv2d", "(", "inplanes", ",", "planes", ",", "kernel_size", "=", "1", ",", "bias", "=", "False", ")", "\n", "self", ".", "bn1", "=", "nn", ".", "BatchNorm2d", "(", "planes", ",", "momentum", "=", "bn_momentum", ")", "\n", "self", ".", "conv2", "=", "nn", ".", "Conv2d", "(", "planes", ",", "planes", ",", "kernel_size", "=", "3", ",", "stride", "=", "stride", ",", "padding", "=", "1", ",", "bias", "=", "False", ")", "\n", "self", ".", "bn2", "=", "nn", ".", "BatchNorm2d", "(", "planes", ",", "momentum", "=", "bn_momentum", ")", "\n", "self", ".", "conv3", "=", "nn", ".", "Conv2d", "(", "planes", ",", "planes", "*", "self", ".", "expansion", ",", "kernel_size", "=", "1", ",", "bias", "=", "False", ")", "\n", "self", ".", "bn3", "=", "nn", ".", "BatchNorm2d", "(", "planes", "*", "self", ".", "expansion", ",", "momentum", "=", "bn_momentum", ")", "\n", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "self", ".", "downsample", "=", "downsample", "\n", "self", ".", "stride", "=", "stride", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.models.modules.Bottleneck.forward": [[18, 39], ["modules.Bottleneck.conv1", "modules.Bottleneck.bn1", "modules.Bottleneck.relu", "modules.Bottleneck.conv2", "modules.Bottleneck.bn2", "modules.Bottleneck.relu", "modules.Bottleneck.conv3", "modules.Bottleneck.bn3", "modules.Bottleneck.relu", "modules.Bottleneck.downsample"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "residual", "=", "x", "\n", "\n", "out", "=", "self", ".", "conv1", "(", "x", ")", "\n", "out", "=", "self", ".", "bn1", "(", "out", ")", "\n", "out", "=", "self", ".", "relu", "(", "out", ")", "\n", "\n", "out", "=", "self", ".", "conv2", "(", "out", ")", "\n", "out", "=", "self", ".", "bn2", "(", "out", ")", "\n", "out", "=", "self", ".", "relu", "(", "out", ")", "\n", "\n", "out", "=", "self", ".", "conv3", "(", "out", ")", "\n", "out", "=", "self", ".", "bn3", "(", "out", ")", "\n", "\n", "if", "self", ".", "downsample", "is", "not", "None", ":", "\n", "            ", "residual", "=", "self", ".", "downsample", "(", "x", ")", "\n", "\n", "", "out", "+=", "residual", "\n", "out", "=", "self", ".", "relu", "(", "out", ")", "\n", "\n", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.models.modules.BasicBlock.__init__": [[83, 92], ["torch.nn.Module.__init__", "torch.nn.Conv2d", "torch.nn.BatchNorm2d", "torch.nn.ReLU", "torch.nn.Conv2d", "torch.nn.BatchNorm2d"], "methods", ["home.repos.pwc.inspect_result.Tverous_HRCenterNet.models.HRCenterNet._HRCenterNet.__init__"], ["def", "__init__", "(", "self", ",", "inplanes", ",", "planes", ",", "stride", "=", "1", ",", "downsample", "=", "None", ",", "bn_momentum", "=", "0.1", ")", ":", "\n", "        ", "super", "(", "BasicBlock", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "conv1", "=", "nn", ".", "Conv2d", "(", "inplanes", ",", "planes", ",", "kernel_size", "=", "3", ",", "stride", "=", "stride", ",", "padding", "=", "1", ",", "bias", "=", "False", ")", "\n", "self", ".", "bn1", "=", "nn", ".", "BatchNorm2d", "(", "planes", ",", "momentum", "=", "bn_momentum", ")", "\n", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "self", ".", "conv2", "=", "nn", ".", "Conv2d", "(", "inplanes", ",", "planes", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "padding", "=", "1", ",", "bias", "=", "False", ")", "\n", "self", ".", "bn2", "=", "nn", ".", "BatchNorm2d", "(", "planes", ",", "momentum", "=", "bn_momentum", ")", "\n", "self", ".", "downsample", "=", "downsample", "\n", "self", ".", "stride", "=", "stride", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.models.modules.BasicBlock.forward": [[93, 110], ["modules.BasicBlock.conv1", "modules.BasicBlock.bn1", "modules.BasicBlock.relu", "modules.BasicBlock.conv2", "modules.BasicBlock.bn2", "modules.BasicBlock.relu", "modules.BasicBlock.downsample"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "residual", "=", "x", "\n", "\n", "out", "=", "self", ".", "conv1", "(", "x", ")", "\n", "out", "=", "self", ".", "bn1", "(", "out", ")", "\n", "out", "=", "self", ".", "relu", "(", "out", ")", "\n", "\n", "out", "=", "self", ".", "conv2", "(", "out", ")", "\n", "out", "=", "self", ".", "bn2", "(", "out", ")", "\n", "\n", "if", "self", ".", "downsample", "is", "not", "None", ":", "\n", "            ", "residual", "=", "self", ".", "downsample", "(", "x", ")", "\n", "\n", "", "out", "+=", "residual", "\n", "out", "=", "self", ".", "relu", "(", "out", ")", "\n", "\n", "return", "out", "", "", "", ""]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.models.HRCenterNet.StageModule.__init__": [[7, 54], ["torch.nn.Module.__init__", "torch.nn.ModuleList", "range", "torch.nn.ModuleList", "range", "torch.nn.ReLU", "torch.nn.Sequential", "HRCenterNet.StageModule.branches.append", "HRCenterNet.StageModule.fuse_layers.append", "range", "models.modules.BasicBlock", "models.modules.BasicBlock", "models.modules.BasicBlock", "models.modules.BasicBlock", "torch.nn.ModuleList", "HRCenterNet.StageModule.fuse_layers[].append", "torch.nn.Sequential", "HRCenterNet.StageModule.fuse_layers[].append", "torch.nn.Sequential", "range", "ops.append", "HRCenterNet.StageModule.fuse_layers[].append", "torch.nn.Conv2d", "torch.nn.BatchNorm2d", "torch.nn.Upsample", "ops.append", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Conv2d", "torch.nn.BatchNorm2d", "torch.nn.Conv2d", "torch.nn.BatchNorm2d", "torch.nn.ReLU"], "methods", ["home.repos.pwc.inspect_result.Tverous_HRCenterNet.models.HRCenterNet._HRCenterNet.__init__"], ["    ", "def", "__init__", "(", "self", ",", "stage", ",", "output_branches", ",", "c", ",", "bn_momentum", ")", ":", "\n", "        ", "super", "(", "StageModule", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "stage", "=", "stage", "\n", "self", ".", "output_branches", "=", "output_branches", "\n", "\n", "self", ".", "branches", "=", "nn", ".", "ModuleList", "(", ")", "\n", "for", "i", "in", "range", "(", "self", ".", "stage", ")", ":", "\n", "            ", "w", "=", "c", "*", "(", "2", "**", "i", ")", "\n", "branch", "=", "nn", ".", "Sequential", "(", "\n", "BasicBlock", "(", "w", ",", "w", ",", "bn_momentum", "=", "bn_momentum", ")", ",", "\n", "BasicBlock", "(", "w", ",", "w", ",", "bn_momentum", "=", "bn_momentum", ")", ",", "\n", "BasicBlock", "(", "w", ",", "w", ",", "bn_momentum", "=", "bn_momentum", ")", ",", "\n", "BasicBlock", "(", "w", ",", "w", ",", "bn_momentum", "=", "bn_momentum", ")", ",", "\n", ")", "\n", "self", ".", "branches", ".", "append", "(", "branch", ")", "\n", "\n", "", "self", ".", "fuse_layers", "=", "nn", ".", "ModuleList", "(", ")", "\n", "# for each output_branches (i.e. each branch in all cases but the very last one)", "\n", "for", "i", "in", "range", "(", "self", ".", "output_branches", ")", ":", "\n", "            ", "self", ".", "fuse_layers", ".", "append", "(", "nn", ".", "ModuleList", "(", ")", ")", "\n", "for", "j", "in", "range", "(", "self", ".", "stage", ")", ":", "# for each branch", "\n", "                ", "if", "i", "==", "j", ":", "\n", "                    ", "self", ".", "fuse_layers", "[", "-", "1", "]", ".", "append", "(", "nn", ".", "Sequential", "(", ")", ")", "# Used in place of \"None\" because it is callable", "\n", "", "elif", "i", "<", "j", ":", "\n", "                    ", "self", ".", "fuse_layers", "[", "-", "1", "]", ".", "append", "(", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Conv2d", "(", "c", "*", "(", "2", "**", "j", ")", ",", "c", "*", "(", "2", "**", "i", ")", ",", "kernel_size", "=", "(", "1", ",", "1", ")", ",", "stride", "=", "(", "1", ",", "1", ")", ",", "bias", "=", "False", ")", ",", "\n", "nn", ".", "BatchNorm2d", "(", "c", "*", "(", "2", "**", "i", ")", ",", "eps", "=", "1e-05", ",", "momentum", "=", "0.1", ",", "affine", "=", "True", ",", "track_running_stats", "=", "True", ")", ",", "\n", "nn", ".", "Upsample", "(", "scale_factor", "=", "(", "2.0", "**", "(", "j", "-", "i", ")", ")", ",", "mode", "=", "'nearest'", ")", ",", "\n", ")", ")", "\n", "", "elif", "i", ">", "j", ":", "\n", "                    ", "ops", "=", "[", "]", "\n", "for", "k", "in", "range", "(", "i", "-", "j", "-", "1", ")", ":", "\n", "                        ", "ops", ".", "append", "(", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Conv2d", "(", "c", "*", "(", "2", "**", "j", ")", ",", "c", "*", "(", "2", "**", "j", ")", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "stride", "=", "(", "2", ",", "2", ")", ",", "padding", "=", "(", "1", ",", "1", ")", ",", "\n", "bias", "=", "False", ")", ",", "\n", "nn", ".", "BatchNorm2d", "(", "c", "*", "(", "2", "**", "j", ")", ",", "eps", "=", "1e-05", ",", "momentum", "=", "0.1", ",", "affine", "=", "True", ",", "\n", "track_running_stats", "=", "True", ")", ",", "\n", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", ",", "\n", ")", ")", "\n", "", "ops", ".", "append", "(", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Conv2d", "(", "c", "*", "(", "2", "**", "j", ")", ",", "c", "*", "(", "2", "**", "i", ")", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "stride", "=", "(", "2", ",", "2", ")", ",", "padding", "=", "(", "1", ",", "1", ")", ",", "\n", "bias", "=", "False", ")", ",", "\n", "nn", ".", "BatchNorm2d", "(", "c", "*", "(", "2", "**", "i", ")", ",", "eps", "=", "1e-05", ",", "momentum", "=", "0.1", ",", "affine", "=", "True", ",", "track_running_stats", "=", "True", ")", ",", "\n", ")", ")", "\n", "self", ".", "fuse_layers", "[", "-", "1", "]", ".", "append", "(", "nn", ".", "Sequential", "(", "*", "ops", ")", ")", "\n", "\n", "", "", "", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.models.HRCenterNet.StageModule.forward": [[55, 72], ["range", "range", "len", "len", "branch", "len", "range", "len", "HRCenterNet.StageModule.relu", "zip", "len", "x_fused.append"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "assert", "len", "(", "self", ".", "branches", ")", "==", "len", "(", "x", ")", "\n", "\n", "x", "=", "[", "branch", "(", "b", ")", "for", "branch", ",", "b", "in", "zip", "(", "self", ".", "branches", ",", "x", ")", "]", "\n", "\n", "x_fused", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "self", ".", "fuse_layers", ")", ")", ":", "\n", "            ", "for", "j", "in", "range", "(", "0", ",", "len", "(", "self", ".", "branches", ")", ")", ":", "\n", "                ", "if", "j", "==", "0", ":", "\n", "                    ", "x_fused", ".", "append", "(", "self", ".", "fuse_layers", "[", "i", "]", "[", "0", "]", "(", "x", "[", "0", "]", ")", ")", "\n", "", "else", ":", "\n", "                    ", "x_fused", "[", "i", "]", "=", "x_fused", "[", "i", "]", "+", "self", ".", "fuse_layers", "[", "i", "]", "[", "j", "]", "(", "x", "[", "j", "]", ")", "\n", "\n", "", "", "", "for", "i", "in", "range", "(", "len", "(", "x_fused", ")", ")", ":", "\n", "            ", "x_fused", "[", "i", "]", "=", "self", ".", "relu", "(", "x_fused", "[", "i", "]", ")", "\n", "\n", "", "return", "x_fused", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.models.HRCenterNet._HRCenterNet.__init__": [[75, 161], ["torch.nn.Module.__init__", "torch.nn.Conv2d", "torch.nn.BatchNorm2d", "torch.nn.Conv2d", "torch.nn.BatchNorm2d", "torch.nn.ReLU", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.ModuleList", "torch.nn.Sequential", "torch.nn.ModuleList", "torch.nn.Sequential", "torch.nn.ModuleList", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Conv2d", "torch.nn.BatchNorm2d", "models.modules.Bottleneck", "models.modules.Bottleneck", "models.modules.Bottleneck", "models.modules.Bottleneck", "HRCenterNet.StageModule", "HRCenterNet.StageModule", "HRCenterNet.StageModule", "HRCenterNet.StageModule", "HRCenterNet.StageModule", "HRCenterNet.StageModule", "HRCenterNet.StageModule", "HRCenterNet.StageModule", "torch.nn.Conv2d", "torch.nn.BatchNorm2d", "torch.nn.ReLU", "torch.nn.Conv2d", "torch.nn.Sigmoid", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Conv2d", "torch.nn.BatchNorm2d", "torch.nn.ReLU", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Conv2d", "torch.nn.BatchNorm2d", "torch.nn.ReLU", "torch.nn.Conv2d", "torch.nn.BatchNorm2d", "torch.nn.ReLU", "torch.nn.Conv2d", "torch.nn.BatchNorm2d", "torch.nn.ReLU"], "methods", ["home.repos.pwc.inspect_result.Tverous_HRCenterNet.models.HRCenterNet._HRCenterNet.__init__"], ["    ", "def", "__init__", "(", "self", ",", "c", "=", "48", ",", "nof_joints", "=", "17", ",", "bn_momentum", "=", "0.1", ")", ":", "\n", "        ", "super", "(", "_HRCenterNet", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "# Input (stem net)", "\n", "self", ".", "conv1", "=", "nn", ".", "Conv2d", "(", "3", ",", "64", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "stride", "=", "(", "2", ",", "2", ")", ",", "padding", "=", "(", "1", ",", "1", ")", ",", "bias", "=", "False", ")", "\n", "self", ".", "bn1", "=", "nn", ".", "BatchNorm2d", "(", "64", ",", "eps", "=", "1e-05", ",", "momentum", "=", "bn_momentum", ",", "affine", "=", "True", ",", "track_running_stats", "=", "True", ")", "\n", "self", ".", "conv2", "=", "nn", ".", "Conv2d", "(", "64", ",", "64", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "stride", "=", "(", "2", ",", "2", ")", ",", "padding", "=", "(", "1", ",", "1", ")", ",", "bias", "=", "False", ")", "\n", "self", ".", "bn2", "=", "nn", ".", "BatchNorm2d", "(", "64", ",", "eps", "=", "1e-05", ",", "momentum", "=", "bn_momentum", ",", "affine", "=", "True", ",", "track_running_stats", "=", "True", ")", "\n", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "\n", "# Stage 1 (layer1)      - First group of bottleneck (resnet) modules", "\n", "downsample", "=", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Conv2d", "(", "64", ",", "256", ",", "kernel_size", "=", "(", "1", ",", "1", ")", ",", "stride", "=", "(", "1", ",", "1", ")", ",", "bias", "=", "False", ")", ",", "\n", "nn", ".", "BatchNorm2d", "(", "256", ",", "eps", "=", "1e-05", ",", "momentum", "=", "bn_momentum", ",", "affine", "=", "True", ",", "track_running_stats", "=", "True", ")", ",", "\n", ")", "\n", "self", ".", "layer1", "=", "nn", ".", "Sequential", "(", "\n", "Bottleneck", "(", "64", ",", "64", ",", "downsample", "=", "downsample", ")", ",", "\n", "Bottleneck", "(", "256", ",", "64", ")", ",", "\n", "Bottleneck", "(", "256", ",", "64", ")", ",", "\n", "Bottleneck", "(", "256", ",", "64", ")", ",", "\n", ")", "\n", "\n", "# Fusion layer 1 (transition1)      - Creation of the first two branches (one full and one half resolution)", "\n", "self", ".", "transition1", "=", "nn", ".", "ModuleList", "(", "[", "\n", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Conv2d", "(", "256", ",", "c", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "stride", "=", "(", "1", ",", "1", ")", ",", "padding", "=", "(", "1", ",", "1", ")", ",", "bias", "=", "False", ")", ",", "\n", "nn", ".", "BatchNorm2d", "(", "c", ",", "eps", "=", "1e-05", ",", "momentum", "=", "bn_momentum", ",", "affine", "=", "True", ",", "track_running_stats", "=", "True", ")", ",", "\n", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", ",", "\n", ")", ",", "\n", "nn", ".", "Sequential", "(", "nn", ".", "Sequential", "(", "# Double Sequential to fit with official pretrained weights", "\n", "nn", ".", "Conv2d", "(", "256", ",", "c", "*", "(", "2", "**", "1", ")", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "stride", "=", "(", "2", ",", "2", ")", ",", "padding", "=", "(", "1", ",", "1", ")", ",", "bias", "=", "False", ")", ",", "\n", "nn", ".", "BatchNorm2d", "(", "c", "*", "(", "2", "**", "1", ")", ",", "eps", "=", "1e-05", ",", "momentum", "=", "bn_momentum", ",", "affine", "=", "True", ",", "track_running_stats", "=", "True", ")", ",", "\n", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", ",", "\n", ")", ")", ",", "\n", "]", ")", "\n", "\n", "# Stage 2 (stage2)      - Second module with 1 group of bottleneck (resnet) modules. This has 2 branches", "\n", "self", ".", "stage2", "=", "nn", ".", "Sequential", "(", "\n", "StageModule", "(", "stage", "=", "2", ",", "output_branches", "=", "2", ",", "c", "=", "c", ",", "bn_momentum", "=", "bn_momentum", ")", ",", "\n", ")", "\n", "\n", "# Fusion layer 2 (transition2)      - Creation of the third branch (1/4 resolution)", "\n", "self", ".", "transition2", "=", "nn", ".", "ModuleList", "(", "[", "\n", "nn", ".", "Sequential", "(", ")", ",", "# None,   - Used in place of \"None\" because it is callable", "\n", "nn", ".", "Sequential", "(", ")", ",", "# None,   - Used in place of \"None\" because it is callable", "\n", "nn", ".", "Sequential", "(", "nn", ".", "Sequential", "(", "# Double Sequential to fit with official pretrained weights", "\n", "nn", ".", "Conv2d", "(", "c", "*", "(", "2", "**", "1", ")", ",", "c", "*", "(", "2", "**", "2", ")", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "stride", "=", "(", "2", ",", "2", ")", ",", "padding", "=", "(", "1", ",", "1", ")", ",", "bias", "=", "False", ")", ",", "\n", "nn", ".", "BatchNorm2d", "(", "c", "*", "(", "2", "**", "2", ")", ",", "eps", "=", "1e-05", ",", "momentum", "=", "bn_momentum", ",", "affine", "=", "True", ",", "track_running_stats", "=", "True", ")", ",", "\n", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", ",", "\n", ")", ")", ",", "# ToDo Why the new branch derives from the \"upper\" branch only?", "\n", "]", ")", "\n", "\n", "# Stage 3 (stage3)      - Third module with 4 groups of bottleneck (resnet) modules. This has 3 branches", "\n", "self", ".", "stage3", "=", "nn", ".", "Sequential", "(", "\n", "StageModule", "(", "stage", "=", "3", ",", "output_branches", "=", "3", ",", "c", "=", "c", ",", "bn_momentum", "=", "bn_momentum", ")", ",", "\n", "StageModule", "(", "stage", "=", "3", ",", "output_branches", "=", "3", ",", "c", "=", "c", ",", "bn_momentum", "=", "bn_momentum", ")", ",", "\n", "StageModule", "(", "stage", "=", "3", ",", "output_branches", "=", "3", ",", "c", "=", "c", ",", "bn_momentum", "=", "bn_momentum", ")", ",", "\n", "StageModule", "(", "stage", "=", "3", ",", "output_branches", "=", "3", ",", "c", "=", "c", ",", "bn_momentum", "=", "bn_momentum", ")", ",", "\n", ")", "\n", "\n", "# Fusion layer 3 (transition3)      - Creation of the fourth branch (1/8 resolution)", "\n", "self", ".", "transition3", "=", "nn", ".", "ModuleList", "(", "[", "\n", "nn", ".", "Sequential", "(", ")", ",", "# None,   - Used in place of \"None\" because it is callable", "\n", "nn", ".", "Sequential", "(", ")", ",", "# None,   - Used in place of \"None\" because it is callable", "\n", "nn", ".", "Sequential", "(", ")", ",", "# None,   - Used in place of \"None\" because it is callable", "\n", "nn", ".", "Sequential", "(", "nn", ".", "Sequential", "(", "# Double Sequential to fit with official pretrained weights", "\n", "nn", ".", "Conv2d", "(", "c", "*", "(", "2", "**", "2", ")", ",", "c", "*", "(", "2", "**", "3", ")", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "stride", "=", "(", "2", ",", "2", ")", ",", "padding", "=", "(", "1", ",", "1", ")", ",", "bias", "=", "False", ")", ",", "\n", "nn", ".", "BatchNorm2d", "(", "c", "*", "(", "2", "**", "3", ")", ",", "eps", "=", "1e-05", ",", "momentum", "=", "bn_momentum", ",", "affine", "=", "True", ",", "track_running_stats", "=", "True", ")", ",", "\n", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", ",", "\n", ")", ")", ",", "# ToDo Why the new branch derives from the \"upper\" branch only?", "\n", "]", ")", "\n", "\n", "# Stage 4 (stage4)      - Fourth module with 3 groups of bottleneck (resnet) modules. This has 4 branches", "\n", "self", ".", "stage4", "=", "nn", ".", "Sequential", "(", "\n", "StageModule", "(", "stage", "=", "4", ",", "output_branches", "=", "4", ",", "c", "=", "c", ",", "bn_momentum", "=", "bn_momentum", ")", ",", "\n", "StageModule", "(", "stage", "=", "4", ",", "output_branches", "=", "4", ",", "c", "=", "c", ",", "bn_momentum", "=", "bn_momentum", ")", ",", "\n", "StageModule", "(", "stage", "=", "4", ",", "output_branches", "=", "1", ",", "c", "=", "c", ",", "bn_momentum", "=", "bn_momentum", ")", ",", "\n", ")", "\n", "\n", "# Final layer (final_layer)", "\n", "self", ".", "final_layer", "=", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Conv2d", "(", "c", ",", "32", ",", "kernel_size", "=", "(", "1", ",", "1", ")", ",", "stride", "=", "(", "1", ",", "1", ")", ")", ",", "\n", "nn", ".", "BatchNorm2d", "(", "32", ",", "eps", "=", "1e-05", ",", "momentum", "=", "bn_momentum", ",", "affine", "=", "True", ",", "track_running_stats", "=", "True", ")", ",", "\n", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", ",", "\n", "nn", ".", "Conv2d", "(", "32", ",", "nof_joints", ",", "kernel_size", "=", "(", "1", ",", "1", ")", ",", "stride", "=", "(", "1", ",", "1", ")", ")", ",", "\n", "nn", ".", "Sigmoid", "(", ")", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.models.HRCenterNet._HRCenterNet.forward": [[163, 196], ["HRCenterNet._HRCenterNet.conv1", "HRCenterNet._HRCenterNet.bn1", "HRCenterNet._HRCenterNet.relu", "HRCenterNet._HRCenterNet.conv2", "HRCenterNet._HRCenterNet.bn2", "HRCenterNet._HRCenterNet.relu", "HRCenterNet._HRCenterNet.layer1", "HRCenterNet._HRCenterNet.stage2", "HRCenterNet._HRCenterNet.stage3", "HRCenterNet._HRCenterNet.stage4", "HRCenterNet._HRCenterNet.final_layer", "trans"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "x", "=", "self", ".", "conv1", "(", "x", ")", "\n", "x", "=", "self", ".", "bn1", "(", "x", ")", "\n", "x", "=", "self", ".", "relu", "(", "x", ")", "\n", "x", "=", "self", ".", "conv2", "(", "x", ")", "\n", "x", "=", "self", ".", "bn2", "(", "x", ")", "\n", "x", "=", "self", ".", "relu", "(", "x", ")", "\n", "\n", "x", "=", "self", ".", "layer1", "(", "x", ")", "\n", "x", "=", "[", "trans", "(", "x", ")", "for", "trans", "in", "self", ".", "transition1", "]", "# Since now, x is a list (# == nof branches)", "\n", "\n", "x", "=", "self", ".", "stage2", "(", "x", ")", "\n", "# x = [trans(x[-1]) for trans in self.transition2]    # New branch derives from the \"upper\" branch only", "\n", "x", "=", "[", "\n", "self", ".", "transition2", "[", "0", "]", "(", "x", "[", "0", "]", ")", ",", "\n", "self", ".", "transition2", "[", "1", "]", "(", "x", "[", "1", "]", ")", ",", "\n", "self", ".", "transition2", "[", "2", "]", "(", "x", "[", "-", "1", "]", ")", "\n", "]", "# New branch derives from the \"upper\" branch only", "\n", "\n", "x", "=", "self", ".", "stage3", "(", "x", ")", "\n", "# x = [trans(x) for trans in self.transition3]    # New branch derives from the \"upper\" branch only", "\n", "x", "=", "[", "\n", "self", ".", "transition3", "[", "0", "]", "(", "x", "[", "0", "]", ")", ",", "\n", "self", ".", "transition3", "[", "1", "]", "(", "x", "[", "1", "]", ")", ",", "\n", "self", ".", "transition3", "[", "2", "]", "(", "x", "[", "2", "]", ")", ",", "\n", "self", ".", "transition3", "[", "3", "]", "(", "x", "[", "-", "1", "]", ")", "\n", "]", "# New branch derives from the \"upper\" branch only", "\n", "\n", "x", "=", "self", ".", "stage4", "(", "x", ")", "\n", "\n", "x", "=", "self", ".", "final_layer", "(", "x", "[", "0", "]", ")", "\n", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.Tverous_HRCenterNet.models.HRCenterNet.HRCenterNet": [[197, 202], ["HRCenterNet._HRCenterNet"], "function", ["None"], ["", "", "def", "HRCenterNet", "(", ")", ":", "\n", "\n", "    ", "model", "=", "_HRCenterNet", "(", "32", ",", "5", ",", "0.1", ")", "\n", "\n", "return", "model", "\n", "", ""]]}