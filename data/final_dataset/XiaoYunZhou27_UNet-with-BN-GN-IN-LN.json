{"home.repos.pwc.inspect_result.XiaoYunZhou27_UNet-with-BN-GN-IN-LN.None.Unet_with_BN_IN_LN_GN.unet_model": [[43, 143], ["tensorflow.reshape", "collections.OrderedDict", "range", "range", "tensorflow.layers.conv2d", "tensorflow.cast", "tensorflow.subtract", "tensorflow.concat", "numpy.sqrt", "range", "numpy.sqrt", "tensorflow.layers.conv2d_transpose", "tensorflow.nn.relu", "tensorflow.concat", "range", "tensorflow.nn.softmax", "tensorflow.reduce_mean", "tensorflow.summary.scalar", "tensorflow.reduce_mean", "tensorflow.summary.scalar", "range", "range", "range", "tensorflow.train.get_global_step", "tensorflow.train.LoggingTensorHook", "tensorflow.train.piecewise_constant", "tensorflow.train.MomentumOptimizer", "tf.train.MomentumOptimizer.minimize", "tensorflow.estimator.EstimatorSpec", "tensorflow.train.LoggingTensorHook", "tensorflow.estimator.EstimatorSpec", "tensorflow.estimator.EstimatorSpec", "tensorflow.layers.conv2d", "tensorflow.nn.relu", "tensorflow.layers.max_pooling2d", "tensorflow.layers.dropout", "tensorflow.layers.conv2d", "tensorflow.nn.relu", "tensorflow.truncated_normal_initializer", "tensorflow.constant_initializer", "tensorflow.greater_equal", "tensorflow.nn.softmax_cross_entropy_with_logits_v2", "tensorflow.nn.softmax_cross_entropy_with_logits_v2", "tensorflow.slice", "tensorflow.cast", "Unet_with_BN_IN_LN_GN.IoU_calculation", "tensorflow.summary.scalar", "tensorflow.slice", "tensorflow.summary.image", "tensorflow.slice", "tensorflow.summary.image", "tensorflow.layers.dropout", "tensorflow.truncated_normal_initializer", "tensorflow.constant_initializer", "tensorflow.layers.dropout", "tensorflow.train.get_global_step", "tensorflow.truncated_normal_initializer", "tensorflow.constant_initializer", "tensorflow.truncated_normal_initializer", "tensorflow.constant_initializer", "tensorflow.slice", "tensorflow.stop_gradient", "tensorflow.stop_gradient", "tensorflow.stop_gradient", "tensorflow.slice", "tensorflow.nn.softmax"], "function", ["home.repos.pwc.inspect_result.XiaoYunZhou27_UNet-with-BN-GN-IN-LN.None.Unet_with_BN_IN_LN_GN.IoU_calculation"], ["def", "unet_model", "(", "features", ",", "labels", ",", "mode", ")", ":", "\n", "\n", "    ", "features", "=", "tf", ".", "reshape", "(", "features", ",", "[", "BATCH_SIZE", ",", "IMAGE_SIZE", ",", "IMAGE_SIZE", ",", "N_CHANNEL", "]", ")", "\n", "features_out", "=", "OrderedDict", "(", ")", "\n", "\n", "for", "layer", "in", "range", "(", "0", ",", "N_BLOCK", ")", ":", "\n", "\n", "        ", "feature_num", "=", "(", "2", "**", "layer", ")", "*", "N_FEATURE", "\n", "stddev", "=", "np", ".", "sqrt", "(", "2", "/", "(", "CONV_SIZE", "**", "2", "*", "feature_num", ")", ")", "\n", "\n", "for", "layer_conv", "in", "range", "(", "0", ",", "N_CONV", ")", ":", "\n", "\n", "            ", "features", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "features", ",", "filters", "=", "feature_num", ",", "kernel_size", "=", "CONV_SIZE", ",", "\n", "activation", "=", "None", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "tf", ".", "truncated_normal_initializer", "(", "stddev", "=", "stddev", ")", ",", "\n", "bias_initializer", "=", "tf", ".", "constant_initializer", "(", "value", "=", "0.1", ")", ")", "\n", "features", "=", "tf", ".", "nn", ".", "relu", "(", "tf", ".", "layers", ".", "dropout", "(", "inputs", "=", "features", ",", "rate", "=", "DROPOUT_RATE", ")", ")", "\n", "\n", "", "features_out", "[", "layer", "]", "=", "features", "\n", "\n", "if", "layer", "<", "N_BLOCK", "-", "1", ":", "\n", "            ", "features", "=", "tf", ".", "layers", ".", "max_pooling2d", "(", "inputs", "=", "features_out", "[", "layer", "]", ",", "pool_size", "=", "2", ",", "strides", "=", "2", ")", "\n", "\n", "", "", "for", "layer", "in", "range", "(", "N_BLOCK", "-", "2", ",", "-", "1", ",", "-", "1", ")", ":", "\n", "\n", "        ", "if", "layer", "==", "N_BLOCK", "-", "2", ":", "\n", "            ", "features", "=", "features_out", "[", "N_BLOCK", "-", "1", "]", "\n", "\n", "", "feature_num", "=", "(", "2", "**", "layer", ")", "*", "N_FEATURE", "\n", "stddev", "=", "np", ".", "sqrt", "(", "2", "/", "(", "CONV_SIZE", "**", "2", "*", "feature_num", ")", ")", "\n", "\n", "features", "=", "tf", ".", "layers", ".", "conv2d_transpose", "(", "inputs", "=", "features", ",", "filters", "=", "feature_num", ",", "strides", "=", "2", ",", "padding", "=", "'same'", ",", "\n", "kernel_size", "=", "CONV_SIZE", ",", "activation", "=", "None", ",", "\n", "kernel_initializer", "=", "tf", ".", "truncated_normal_initializer", "(", "stddev", "=", "stddev", ")", ",", "\n", "bias_initializer", "=", "tf", ".", "constant_initializer", "(", "value", "=", "0.1", ")", ")", "\n", "features", "=", "tf", ".", "nn", ".", "relu", "(", "tf", ".", "layers", ".", "dropout", "(", "inputs", "=", "features", ",", "rate", "=", "DROPOUT_RATE", ")", ")", "\n", "features", "=", "tf", ".", "concat", "(", "[", "features_out", "[", "layer", "]", ",", "features", "]", ",", "axis", "=", "3", ")", "\n", "\n", "for", "layer_conv", "in", "range", "(", "0", ",", "N_CONV", ")", ":", "\n", "\n", "            ", "features", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "features", ",", "filters", "=", "feature_num", ",", "kernel_size", "=", "CONV_SIZE", ",", "\n", "activation", "=", "None", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "tf", ".", "truncated_normal_initializer", "(", "stddev", "=", "stddev", ")", ",", "\n", "bias_initializer", "=", "tf", ".", "constant_initializer", "(", "value", "=", "0.1", ")", ")", "\n", "features", "=", "tf", ".", "nn", ".", "relu", "(", "tf", ".", "layers", ".", "dropout", "(", "inputs", "=", "features", ",", "rate", "=", "DROPOUT_RATE", ")", ")", "\n", "\n", "", "", "logits", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "features", ",", "filters", "=", "N_CLASS", ",", "kernel_size", "=", "1", ",", "\n", "activation", "=", "None", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "tf", ".", "truncated_normal_initializer", "(", "stddev", "=", "stddev", ")", ",", "\n", "bias_initializer", "=", "tf", ".", "constant_initializer", "(", "value", "=", "0.1", ")", ")", "\n", "\n", "classes_1", "=", "tf", ".", "cast", "(", "x", "=", "tf", ".", "greater_equal", "(", "x", "=", "tf", ".", "slice", "(", "input_", "=", "tf", ".", "nn", ".", "softmax", "(", "logits", "=", "logits", ")", ",", "\n", "begin", "=", "[", "0", ",", "0", ",", "0", ",", "1", "]", ",", "\n", "size", "=", "[", "-", "1", ",", "-", "1", ",", "-", "1", ",", "N_CLASS", "-", "1", "]", ")", ",", "\n", "y", "=", "0.5", ")", ",", "\n", "dtype", "=", "tf", ".", "int32", ")", "\n", "class_0", "=", "tf", ".", "subtract", "(", "x", "=", "1", ",", "y", "=", "classes_1", ")", "\n", "classes", "=", "tf", ".", "concat", "(", "values", "=", "[", "class_0", ",", "classes_1", "]", ",", "axis", "=", "3", ")", "\n", "\n", "predictions", "=", "{", "\"probabilities\"", ":", "tf", ".", "nn", ".", "softmax", "(", "logits", "=", "logits", ",", "name", "=", "\"probabilities\"", ")", ",", "\n", "\"classes\"", ":", "classes", "}", "\n", "\n", "if", "mode", "==", "tf", ".", "estimator", ".", "ModeKeys", ".", "TRAIN", ":", "\n", "        ", "loss", "=", "tf", ".", "reduce_mean", "(", "tf", ".", "nn", ".", "softmax_cross_entropy_with_logits_v2", "(", "labels", "=", "tf", ".", "stop_gradient", "(", "labels", ")", ",", "logits", "=", "logits", ")", ")", "\n", "tf", ".", "summary", ".", "scalar", "(", "'loss'", ",", "loss", ")", "\n", "", "if", "mode", "==", "tf", ".", "estimator", ".", "ModeKeys", ".", "EVAL", ":", "\n", "        ", "loss", "=", "tf", ".", "reduce_mean", "(", "tf", ".", "nn", ".", "softmax_cross_entropy_with_logits_v2", "(", "labels", "=", "tf", ".", "stop_gradient", "(", "labels", ")", ",", "logits", "=", "tf", ".", "stop_gradient", "(", "logits", ")", ")", ")", "\n", "tf", ".", "summary", ".", "scalar", "(", "'loss'", ",", "loss", ")", "\n", "\n", "", "if", "mode", "!=", "tf", ".", "estimator", ".", "ModeKeys", ".", "PREDICT", ":", "\n", "\n", "        ", "for", "index", "in", "range", "(", "1", ",", "N_CLASS", ")", ":", "\n", "            ", "labels_slice", "=", "tf", ".", "slice", "(", "labels", ",", "[", "0", ",", "0", ",", "0", ",", "index", "]", ",", "[", "-", "1", ",", "-", "1", ",", "-", "1", ",", "1", "]", ")", "\n", "classes_slice", "=", "tf", ".", "cast", "(", "x", "=", "tf", ".", "slice", "(", "classes", ",", "[", "0", ",", "0", ",", "0", ",", "index", "]", ",", "[", "-", "1", ",", "-", "1", ",", "-", "1", ",", "1", "]", ")", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "IoU", "=", "IoU_calculation", "(", "labels_slice", "=", "labels_slice", ",", "classes_slice", "=", "classes_slice", ")", "\n", "tf", ".", "summary", ".", "scalar", "(", "\"IoU_%s\"", "%", "(", "index", ")", ",", "IoU", ")", "\n", "\n", "", "for", "index", "in", "range", "(", "1", ",", "N_CLASS", ")", ":", "\n", "            ", "segmentation", "=", "tf", ".", "slice", "(", "predictions", "[", "'probabilities'", "]", ",", "[", "0", ",", "0", ",", "0", ",", "index", "]", ",", "[", "-", "1", ",", "-", "1", ",", "-", "1", ",", "1", "]", ")", "\n", "tf", ".", "summary", ".", "image", "(", "\"segmentation_%s\"", "%", "(", "index", ")", ",", "segmentation", ",", "BATCH_SIZE", ")", "\n", "\n", "", "for", "index", "in", "range", "(", "1", ",", "N_CLASS", ")", ":", "\n", "            ", "groundtruth", "=", "tf", ".", "slice", "(", "labels", ",", "[", "0", ",", "0", ",", "0", ",", "index", "]", ",", "[", "-", "1", ",", "-", "1", ",", "-", "1", ",", "1", "]", ")", "\n", "tf", ".", "summary", ".", "image", "(", "\"groundtruth_%s\"", "%", "(", "index", ")", ",", "groundtruth", ",", "BATCH_SIZE", ")", "\n", "\n", "", "", "if", "mode", "==", "tf", ".", "estimator", ".", "ModeKeys", ".", "TRAIN", ":", "\n", "        ", "step", "=", "tf", ".", "train", ".", "get_global_step", "(", ")", "\n", "logging_hook_train", "=", "tf", ".", "train", ".", "LoggingTensorHook", "(", "{", "\"step\"", ":", "step", ",", "\"loss\"", ":", "loss", ",", "\"IoU\"", ":", "IoU", "}", ",", "every_n_iter", "=", "STEP_LOGGING", ")", "\n", "lr", "=", "tf", ".", "train", ".", "piecewise_constant", "(", "x", "=", "step", ",", "boundaries", "=", "BOUNDARIES", ",", "values", "=", "VALUES", ")", "\n", "\n", "optimizer", "=", "tf", ".", "train", ".", "MomentumOptimizer", "(", "learning_rate", "=", "lr", ",", "momentum", "=", "0.9", ")", "\n", "train_op", "=", "optimizer", ".", "minimize", "(", "loss", "=", "loss", ",", "global_step", "=", "tf", ".", "train", ".", "get_global_step", "(", ")", ")", "\n", "return", "tf", ".", "estimator", ".", "EstimatorSpec", "(", "mode", "=", "mode", ",", "loss", "=", "loss", ",", "train_op", "=", "train_op", ",", "training_hooks", "=", "[", "logging_hook_train", "]", ")", "\n", "\n", "", "if", "mode", "==", "tf", ".", "estimator", ".", "ModeKeys", ".", "EVAL", ":", "\n", "        ", "logging_hook_eval", "=", "tf", ".", "train", ".", "LoggingTensorHook", "(", "{", "\"IoU\"", ":", "IoU", "}", ",", "every_n_iter", "=", "1", ")", "\n", "return", "tf", ".", "estimator", ".", "EstimatorSpec", "(", "mode", "=", "mode", ",", "loss", "=", "loss", ",", "evaluation_hooks", "=", "[", "logging_hook_eval", "]", ")", "\n", "\n", "", "if", "mode", "==", "tf", ".", "estimator", ".", "ModeKeys", ".", "PREDICT", ":", "\n", "        ", "return", "tf", ".", "estimator", ".", "EstimatorSpec", "(", "mode", "=", "mode", ",", "predictions", "=", "predictions", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.XiaoYunZhou27_UNet-with-BN-GN-IN-LN.None.Unet_with_BN_IN_LN_GN.IoU_calculation": [[144, 155], ["tensorflow.multiply", "tensorflow.add", "tensorflow.divide", "tensorflow.equal", "tensorflow.count_nonzero", "tensorflow.cast", "tensorflow.cast", "tensorflow.count_nonzero", "tensorflow.count_nonzero"], "function", ["None"], ["", "", "def", "IoU_calculation", "(", "labels_slice", ",", "classes_slice", ")", ":", "\n", "\n", "    ", "And", "=", "tf", ".", "multiply", "(", "labels_slice", ",", "classes_slice", ")", "\n", "Or", "=", "tf", ".", "add", "(", "labels_slice", ",", "classes_slice", ")", "\n", "if", "tf", ".", "equal", "(", "tf", ".", "count_nonzero", "(", "Or", ")", ",", "0", ")", "==", "True", ":", "\n", "        ", "Or_tmp", "=", "1", "\n", "", "else", ":", "\n", "        ", "Or_tmp", "=", "tf", ".", "count_nonzero", "(", "Or", ")", "\n", "", "IoU", "=", "tf", ".", "divide", "(", "tf", ".", "cast", "(", "tf", ".", "count_nonzero", "(", "And", ")", ",", "tf", ".", "float32", ")", ",", "tf", ".", "cast", "(", "Or_tmp", ",", "tf", ".", "float32", ")", ")", "\n", "\n", "return", "IoU", "\n", "\n"]], "home.repos.pwc.inspect_result.XiaoYunZhou27_UNet-with-BN-GN-IN-LN.None.Unet_with_BN_IN_LN_GN.parser": [[156, 167], ["tensorflow.parse_single_example", "tensorflow.decode_raw", "tensorflow.reshape", "tensorflow.decode_raw", "tensorflow.reshape", "tensorflow.FixedLenFeature", "tensorflow.FixedLenFeature"], "function", ["None"], ["", "def", "parser", "(", "record", ")", ":", "\n", "\n", "    ", "features", "=", "tf", ".", "parse_single_example", "(", "record", ",", "\n", "features", "=", "{", "'Image'", ":", "tf", ".", "FixedLenFeature", "(", "[", "]", ",", "tf", ".", "string", ")", ",", "\n", "'Label'", ":", "tf", ".", "FixedLenFeature", "(", "[", "]", ",", "tf", ".", "string", ")", "}", ")", "\n", "Images", "=", "tf", ".", "decode_raw", "(", "features", "[", "\"Image\"", "]", ",", "tf", ".", "float32", ")", "\n", "Images", "=", "tf", ".", "reshape", "(", "Images", ",", "[", "IMAGE_SIZE", ",", "IMAGE_SIZE", "]", ")", "\n", "Labels", "=", "tf", ".", "decode_raw", "(", "features", "[", "'Label'", "]", ",", "tf", ".", "float32", ")", "\n", "Labels", "=", "tf", ".", "reshape", "(", "Labels", ",", "[", "IMAGE_SIZE", ",", "IMAGE_SIZE", ",", "N_CLASS", "]", ")", "\n", "\n", "return", "Images", ",", "Labels", "\n", "\n"]], "home.repos.pwc.inspect_result.XiaoYunZhou27_UNet-with-BN-GN-IN-LN.None.Unet_with_BN_IN_LN_GN.Train_input_fn": [[168, 180], ["tensorflow.data.TFRecordDataset", "dataset.batch.map", "dataset.batch.shuffle", "dataset.batch.repeat", "dataset.batch.batch", "dataset.batch.make_one_shot_iterator", "dataset.make_one_shot_iterator.get_next"], "function", ["None"], ["", "def", "Train_input_fn", "(", ")", ":", "\n", "\n", "    ", "dataset", "=", "tf", ".", "data", ".", "TFRecordDataset", "(", "FLAGS", ".", "Train_record", ")", "\n", "dataset", "=", "dataset", ".", "map", "(", "parser", ")", "\n", "\n", "dataset", "=", "dataset", ".", "shuffle", "(", "SHUFFLE", ")", "\n", "dataset", "=", "dataset", ".", "repeat", "(", "1", ")", "\n", "dataset", "=", "dataset", ".", "batch", "(", "BATCH_SIZE", ")", "\n", "iterator", "=", "dataset", ".", "make_one_shot_iterator", "(", ")", "\n", "features", ",", "labels", "=", "iterator", ".", "get_next", "(", ")", "\n", "\n", "return", "features", ",", "labels", "\n", "\n"]], "home.repos.pwc.inspect_result.XiaoYunZhou27_UNet-with-BN-GN-IN-LN.None.Unet_with_BN_IN_LN_GN.Eval_input_fn": [[181, 193], ["tensorflow.data.TFRecordDataset", "dataset.batch.map", "dataset.batch.shuffle", "dataset.batch.repeat", "dataset.batch.batch", "dataset.batch.make_one_shot_iterator", "dataset.make_one_shot_iterator.get_next"], "function", ["None"], ["", "def", "Eval_input_fn", "(", ")", ":", "\n", "\n", "    ", "dataset", "=", "tf", ".", "data", ".", "TFRecordDataset", "(", "FLAGS", ".", "Eval_record", ")", "\n", "dataset", "=", "dataset", ".", "map", "(", "parser", ")", "\n", "\n", "dataset", "=", "dataset", ".", "shuffle", "(", "SHUFFLE", ")", "\n", "dataset", "=", "dataset", ".", "repeat", "(", ")", "\n", "dataset", "=", "dataset", ".", "batch", "(", "BATCH_SIZE", ")", "\n", "iterator", "=", "dataset", ".", "make_one_shot_iterator", "(", ")", "\n", "features", ",", "labels", "=", "iterator", ".", "get_next", "(", ")", "\n", "\n", "return", "features", ",", "labels", "\n", "\n"]], "home.repos.pwc.inspect_result.XiaoYunZhou27_UNet-with-BN-GN-IN-LN.None.Unet_with_BN_IN_LN_GN.Test_input_fn": [[194, 204], ["tensorflow.data.TFRecordDataset", "dataset.batch.map", "dataset.batch.batch", "dataset.batch.make_one_shot_iterator", "dataset.make_one_shot_iterator.get_next"], "function", ["None"], ["", "def", "Test_input_fn", "(", ")", ":", "\n", "\n", "    ", "dataset", "=", "tf", ".", "data", ".", "TFRecordDataset", "(", "FLAGS", ".", "Test_record", ")", "\n", "dataset", "=", "dataset", ".", "map", "(", "parser", ")", "\n", "\n", "dataset", "=", "dataset", ".", "batch", "(", "BATCH_SIZE", ")", "\n", "iterator", "=", "dataset", ".", "make_one_shot_iterator", "(", ")", "\n", "features", ",", "labels", "=", "iterator", ".", "get_next", "(", ")", "\n", "\n", "return", "features", ",", "labels", "\n", "\n"]], "home.repos.pwc.inspect_result.XiaoYunZhou27_UNet-with-BN-GN-IN-LN.None.Unet_with_BN_IN_LN_GN.main": [[205, 228], ["tensorflow.ConfigProto", "tensorflow.estimator.RunConfig", "tensorflow.estimator.Estimator", "tensorflow.estimator.TrainSpec", "tensorflow.estimator.EvalSpec", "tensorflow.estimator.train_and_evaluate", "tf.estimator.Estimator.predict", "print", "scipy.savemat"], "function", ["None"], ["", "def", "main", "(", "unused_argv", ")", ":", "\n", "\n", "    ", "config", "=", "tf", ".", "ConfigProto", "(", ")", "\n", "config", ".", "gpu_options", ".", "allow_growth", "=", "True", "\n", "\n", "run_config", "=", "tf", ".", "estimator", ".", "RunConfig", "(", "session_config", "=", "config", ",", "\n", "save_checkpoints_steps", "=", "STEP_LOGGING", ",", "\n", "save_summary_steps", "=", "STEP_LOGGING", ",", "\n", "keep_checkpoint_max", "=", "10", ",", "\n", "log_step_count_steps", "=", "STEP_MAX", ")", "\n", "acnn", "=", "tf", ".", "estimator", ".", "Estimator", "(", "model_fn", "=", "unet_model", ",", "model_dir", "=", "FLAGS", ".", "Model_dir", ",", "config", "=", "run_config", ")", "\n", "\n", "train_spec", "=", "tf", ".", "estimator", ".", "TrainSpec", "(", "input_fn", "=", "Train_input_fn", ",", "max_steps", "=", "STEP_MAX", ")", "\n", "eval_spec", "=", "tf", ".", "estimator", ".", "EvalSpec", "(", "input_fn", "=", "Eval_input_fn", ",", "steps", "=", "STEP_EVAL", ",", "start_delay_secs", "=", "STEP_MAX", ",", "throttle_secs", "=", "STEP_MAX", ")", "\n", "tf", ".", "estimator", ".", "train_and_evaluate", "(", "acnn", ",", "train_spec", ",", "eval_spec", ")", "\n", "\n", "predictions", "=", "acnn", ".", "predict", "(", "input_fn", "=", "Test_input_fn", ")", "\n", "Num", "=", "0", "\n", "for", "pred_dict", "in", "predictions", ":", "\n", "        ", "Num", "=", "Num", "+", "1", "\n", "Classes", "=", "pred_dict", "[", "'probabilities'", "]", "\n", "sio", ".", "savemat", "(", "FLAGS", ".", "Model_dir", "+", "'Classes_%s.mat'", "%", "(", "Num", ")", ",", "{", "'Classes'", ":", "Classes", "}", ")", "\n", "", "print", "(", "Num", ")", "\n", "\n"]]}