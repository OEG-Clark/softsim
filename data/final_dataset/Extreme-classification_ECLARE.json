{"home.repos.pwc.inspect_result.Extreme-classification_ECLARE.ECLARE.main.load_embeddings": [[25, 55], ["print", "os.path.exists", "print", "fname.endswith", "fname.endswith", "print", "numpy.loadtxt", "numpy.zeros", "torch.from_numpy", "torch.nn.init.kaiming_uniform_", "torch.load", "numpy.load", "numpy.loadtxt", "libs.append_padding_embedding", "torch.from_numpy", "torch.from_numpy"], "function", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.append_padding_embedding"], ["def", "load_embeddings", "(", "params", ")", ":", "\n", "    ", "\"\"\"Load word embeddings from numpy file\n    * Support for:\n        - loading pre-trained embeddings\n        - loading head embeddings\n    * vocabulary_dims must match #rows in embeddings\n    \"\"\"", "\n", "fname", "=", "params", ".", "embeddings", "\n", "print", "(", "fname", ")", "\n", "if", "os", ".", "path", ".", "exists", "(", "fname", ")", ":", "\n", "        ", "print", "(", "\"Loading embeddings from file: {}\"", ".", "format", "(", "fname", ")", ")", "\n", "if", "fname", ".", "endswith", "(", "\"pkl\"", ")", ":", "\n", "            ", "embeddings", "=", "torch", ".", "load", "(", "fname", ")", "\n", "", "if", "fname", ".", "endswith", "(", "'npy'", ")", ":", "\n", "            ", "embeddings", "=", "np", ".", "load", "(", "fname", ")", "\n", "indices", "=", "np", ".", "loadtxt", "(", "params", ".", "feature_indices", ",", "dtype", "=", "np", ".", "int", ")", "\n", "embeddings", "=", "embeddings", "[", "indices", "]", "\n", "embeddings", "=", "utils", ".", "append_padding_embedding", "(", "embeddings", ")", "\n", "weight", "=", "torch", ".", "from_numpy", "(", "embeddings", ")", "\n", "embeddings", "=", "{", "'weight'", ":", "torch", ".", "from_numpy", "(", "embeddings", ")", "}", "\n", "", "", "else", ":", "\n", "        ", "print", "(", "\"Using random init\"", ")", "\n", "indices", "=", "np", ".", "loadtxt", "(", "params", ".", "feature_indices", ",", "dtype", "=", "np", ".", "int", ")", "\n", "embeddings", "=", "np", ".", "zeros", "(", "(", "indices", ".", "size", "+", "1", ",", "\n", "params", ".", "embedding_dims", ")", ",", "\n", "dtype", "=", "np", ".", "float32", ")", "\n", "weight", "=", "torch", ".", "from_numpy", "(", "embeddings", ")", "\n", "torch", ".", "nn", ".", "init", ".", "kaiming_uniform_", "(", "weight", ")", "\n", "embeddings", "=", "{", "'weight'", ":", "weight", "}", "\n", "", "return", "embeddings", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.ECLARE.main.train": [[57, 73], ["model.fit"], "function", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree.fit"], ["", "def", "train", "(", "model", ",", "params", ")", ":", "\n", "    ", "model", ".", "fit", "(", "\n", "data_dir", "=", "params", ".", "data_dir", ",", "model_dir", "=", "params", ".", "model_dir", ",", "\n", "result_dir", "=", "params", ".", "result_dir", ",", "dataset", "=", "params", ".", "dataset", ",", "\n", "data", "=", "{", "'X'", ":", "None", ",", "'Y'", ":", "None", "}", ",", "\n", "tr_feat_fname", "=", "params", ".", "tr_feat_fname", ",", "\n", "val_feat_fname", "=", "params", ".", "val_feat_fname", ",", "\n", "tr_label_fname", "=", "params", ".", "tr_label_fname", ",", "\n", "val_label_fname", "=", "params", ".", "val_label_fname", ",", "\n", "num_workers", "=", "params", ".", "num_workers", ",", "normalize_features", "=", "params", ".", "normalize", ",", "\n", "validate", "=", "params", ".", "validate", ",", "\n", "keep_invalid", "=", "params", ".", "keep_invalid", ",", "\n", "shortlist_method", "=", "params", ".", "cluster_method", ",", "\n", "validate_after", "=", "params", ".", "validate_after", ",", "\n", "feature_indices", "=", "params", ".", "feature_indices", ",", "\n", "label_indices", "=", "params", ".", "label_indices", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.ECLARE.main.inference": [[75, 93], ["model.predict", "libs.save_predictions"], "function", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.predict", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.save_predictions"], ["", "def", "inference", "(", "model", ",", "params", ")", ":", "\n", "    ", "predicted_labels", "=", "model", ".", "predict", "(", "\n", "data_dir", "=", "params", ".", "data_dir", ",", "\n", "dataset", "=", "params", ".", "dataset", ",", "\n", "model_dir", "=", "params", ".", "model_dir", ",", "\n", "ts_label_fname", "=", "params", ".", "ts_label_fname", ",", "\n", "ts_feat_fname", "=", "params", ".", "ts_feat_fname", ",", "\n", "normalize_features", "=", "params", ".", "normalize", ",", "\n", "num_workers", "=", "params", ".", "num_workers", ",", "\n", "top_k", "=", "params", ".", "top_k", ",", "\n", "data", "=", "{", "'X'", ":", "None", ",", "'Y'", ":", "None", "}", ",", "\n", "keep_invalid", "=", "params", ".", "keep_invalid", ",", "\n", "feature_indices", "=", "params", ".", "feature_indices", ",", "\n", "label_indices", "=", "params", ".", "label_indices", ",", "\n", "shortlist_method", "=", "params", ".", "cluster_method", ")", "\n", "# Real number of labels", "\n", "utils", ".", "save_predictions", "(", "predicted_labels", ",", "params", ".", "result_dir", ",", "\n", "prefix", "=", "params", ".", "pred_fname", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.ECLARE.main.extract": [[95, 99], ["model.extract", "os.path.join", "torch.save"], "function", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.extract", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree.save"], ["", "def", "extract", "(", "model", ",", "params", ")", ":", "\n", "    ", "embeddings", "=", "model", ".", "extract", "(", "params", ".", "model_dir", ")", "\n", "emb_p", "=", "os", ".", "path", ".", "join", "(", "params", ".", "model_dir", ",", "\"embeddings.pkl\"", ")", "\n", "torch", ".", "save", "(", "embeddings", ",", "emb_p", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.ECLARE.main.get_documents": [[101, 127], ["model.get_document", "numpy.save", "os.path.join"], "function", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.get_document", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree.save"], ["", "def", "get_documents", "(", "model", ",", "params", ")", ":", "\n", "    ", "\"\"\"Generates document embeddings\n    Parameters\n    ----------\n    model: ECLARE\n        train this model (typically ECLARE model)\n    params: NameSpace\n        parameter of the model\n    \"\"\"", "\n", "documents", "=", "model", ".", "get_document", "(", "\n", "data_dir", "=", "params", ".", "data_dir", ",", "\n", "dataset", "=", "params", ".", "dataset", ",", "\n", "model_dir", "=", "params", ".", "model_dir", ",", "\n", "ts_feat_fname", "=", "params", ".", "ts_feat_fname", ",", "\n", "normalize_features", "=", "params", ".", "normalize", ",", "\n", "num_workers", "=", "params", ".", "num_workers", ",", "\n", "data", "=", "{", "'X'", ":", "None", ",", "'Y'", ":", "None", "}", ",", "\n", "keep_invalid", "=", "params", ".", "keep_invalid", ",", "\n", "feature_indices", "=", "params", ".", "feature_indices", ",", "\n", "label_indices", "=", "params", ".", "label_indices", ",", "\n", "shortlist_method", "=", "params", ".", "cluster_method", ",", "\n", "if_labels", "=", "False", ",", "\n", ")", "\n", "np", ".", "save", "(", "os", ".", "path", ".", "join", "(", "params", ".", "result_dir", ",", "\n", "params", ".", "pred_fname", ")", ",", "\n", "documents", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.ECLARE.main.get_labels": [[129, 155], ["model.get_document", "numpy.save", "os.path.join"], "function", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.get_document", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree.save"], ["", "def", "get_labels", "(", "model", ",", "params", ")", ":", "\n", "    ", "\"\"\"Generates label embeddings\n    Parameters\n    ----------\n    model: ECLARE\n        train this model (typically ECLARE model)\n    params: NameSpace\n        parameter of the model\n    \"\"\"", "\n", "documents", "=", "model", ".", "get_document", "(", "\n", "data_dir", "=", "params", ".", "data_dir", ",", "\n", "dataset", "=", "params", ".", "dataset", ",", "\n", "model_dir", "=", "params", ".", "model_dir", ",", "\n", "ts_feat_fname", "=", "params", ".", "ts_feat_fname", ",", "\n", "normalize_features", "=", "params", ".", "normalize", ",", "\n", "num_workers", "=", "params", ".", "num_workers", ",", "\n", "data", "=", "{", "'X'", ":", "None", ",", "'Y'", ":", "None", "}", ",", "\n", "keep_invalid", "=", "params", ".", "keep_invalid", ",", "\n", "feature_indices", "=", "params", ".", "feature_indices", ",", "\n", "label_indices", "=", "params", ".", "label_indices", ",", "\n", "shortlist_method", "=", "params", ".", "cluster_method", ",", "\n", "if_labels", "=", "True", ",", "\n", ")", "\n", "np", ".", "save", "(", "os", ".", "path", ".", "join", "(", "params", ".", "result_dir", ",", "\n", "params", ".", "pred_fname", ")", ",", "\n", "documents", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.ECLARE.main.construct_network": [[156, 163], ["models.ECLAREpp", "models.ECLAREfe", "NotImplementedError"], "function", ["None"], ["", "def", "construct_network", "(", "params", ")", ":", "\n", "    ", "if", "params", ".", "model_fname", "in", "[", "'ECLARE++'", ",", "'ECLARE-S'", "]", ":", "\n", "        ", "return", "dp", ".", "ECLAREpp", "(", "params", ")", "\n", "", "elif", "params", ".", "model_fname", "in", "[", "'ECLARE'", ",", "'ECLARE-v'", "]", ":", "\n", "        ", "return", "dp", ".", "ECLAREfe", "(", "params", ")", "\n", "", "else", ":", "\n", "        ", "raise", "NotImplementedError", "(", "\"Not tested yet!\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.ECLARE.main.construct_model": [[165, 171], ["libs.ModelECLARE", "libs.ModelECLAREfe", "libs.ModelECLAREpp"], "function", ["None"], ["", "", "def", "construct_model", "(", "params", ",", "net", ",", "criterion", ",", "optimizer", ",", "shorty", ")", ":", "\n", "    ", "if", "params", ".", "model_fname", "in", "[", "'ECLARE'", ",", "'ECLARE-v'", "]", ":", "\n", "        ", "return", "mw", ".", "ModelECLAREfe", "(", "params", ",", "net", ",", "criterion", ",", "optimizer", ",", "shorty", ")", "\n", "", "elif", "params", ".", "model_fname", "in", "[", "'ECLARE++'", "]", ":", "\n", "        ", "return", "mw", ".", "ModelECLAREpp", "(", "params", ",", "net", ",", "criterion", ",", "optimizer", ",", "shorty", ")", "\n", "", "return", "mw", ".", "ModelECLARE", "(", "params", ",", "net", ",", "criterion", ",", "optimizer", ",", "shorty", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.ECLARE.main.main": [[173, 208], ["torch.manual_seed", "torch.cuda.manual_seed_all", "numpy.random.seed", "main.construct_network", "main.load_embeddings", "construct_network.initialize_embeddings", "print", "torch.nn.BCEWithLogitsLoss", "libs.Optimizer", "main.construct_model", "construct_model.transfer_to_devices", "main.train", "main.construct_model", "construct_model.transfer_to_devices", "main.inference", "main.construct_model", "construct_model.transfer_to_devices", "main.extract", "NotImplementedError"], "function", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.ECLARE.main.construct_network", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.ECLARE.main.load_embeddings", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.initialize_embeddings", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.ECLARE.main.construct_model", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.transfer_to_devices", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.train", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.ECLARE.main.construct_model", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.transfer_to_devices", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.ECLARE.main.inference", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.ECLARE.main.construct_model", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.transfer_to_devices", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.extract"], ["", "def", "main", "(", "params", ")", ":", "\n", "    ", "\"\"\"\n        Main function\n    \"\"\"", "\n", "torch", ".", "manual_seed", "(", "params", ".", "tree_idx", "+", "1", ")", "\n", "torch", ".", "cuda", ".", "manual_seed_all", "(", "params", ".", "tree_idx", "+", "1", ")", "\n", "np", ".", "random", ".", "seed", "(", "params", ".", "tree_idx", "+", "1", ")", "\n", "params", ".", "label_padding_index", "=", "params", ".", "num_labels", "\n", "net", "=", "construct_network", "(", "params", ")", "\n", "embeddings", "=", "load_embeddings", "(", "params", ")", "\n", "net", ".", "initialize_embeddings", "(", "embeddings", ")", "\n", "print", "(", "\"Model parameters: \"", ",", "params", ")", "\n", "if", "params", ".", "mode", "==", "'train'", ":", "\n", "# NOTE: Use last index as padding label", "\n", "        ", "criterion", "=", "torch", ".", "nn", ".", "BCEWithLogitsLoss", "(", "reduction", "=", "'mean'", ")", "\n", "optimizer", "=", "optimizer_utils", ".", "Optimizer", "(", "\n", "opt_type", "=", "params", ".", "optim", ",", "momentum", "=", "params", ".", "momentum", ",", "\n", "freeze_embeddings", "=", "params", ".", "freeze_embeddings", ",", "\n", "weight_decay", "=", "params", ".", "weight_decay", ")", "\n", "model", "=", "construct_model", "(", "params", ",", "net", ",", "criterion", ",", "optimizer", ",", "None", ")", "\n", "model", ".", "transfer_to_devices", "(", ")", "\n", "train", "(", "model", ",", "params", ")", "\n", "\n", "", "elif", "params", ".", "mode", "==", "'predict'", ":", "\n", "        ", "model", "=", "construct_model", "(", "params", ",", "net", ",", "None", ",", "None", ",", "None", ")", "\n", "model", ".", "transfer_to_devices", "(", ")", "\n", "inference", "(", "model", ",", "params", ")", "\n", "\n", "", "elif", "params", ".", "mode", "==", "'extract'", ":", "\n", "        ", "model", "=", "construct_model", "(", "params", ",", "net", ",", "None", ",", "None", ",", "None", ")", "\n", "model", ".", "transfer_to_devices", "(", ")", "\n", "extract", "(", "model", ",", "params", ")", "\n", "\n", "", "else", ":", "\n", "        ", "raise", "NotImplementedError", "(", "\"Unknown mode!\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.merge_split_predictions.CombineResults.__init__": [[10, 13], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "ftype", ")", ":", "\n", "        ", "self", ".", "label_mapping", "=", "[", "]", "# Mapping from new to original in each decile", "\n", "self", ".", "ftype", "=", "ftype", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.merge_split_predictions.CombineResults.read_predictions": [[14, 21], ["scipy.io.loadmat", "xclib.data.data_utils.read_sparse_file", "scipy.sparse.load_npz"], "methods", ["None"], ["", "def", "read_predictions", "(", "self", ",", "fname", ")", ":", "\n", "        ", "if", "self", ".", "ftype", "==", "'mat'", ":", "\n", "            ", "return", "loadmat", "(", "fname", ")", "[", "'predicted_labels'", "]", "\n", "", "elif", "self", ".", "ftype", "==", "'txt'", ":", "\n", "            ", "return", "data_utils", ".", "read_sparse_file", "(", "fname", ")", "\n", "", "elif", "self", ".", "ftype", "==", "'npz'", ":", "\n", "            ", "return", "load_npz", "(", "fname", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.merge_split_predictions.CombineResults.write_predictions": [[22, 30], ["print", "scipy.io.savemat", "xclib.data.data_utils.write_sparse_file", "scipy.sparse.save_npz"], "methods", ["None"], ["", "", "def", "write_predictions", "(", "self", ",", "file", ",", "fname", ")", ":", "\n", "        ", "print", "(", "\"Saving at %s\"", "%", "(", "fname", ")", ")", "\n", "if", "self", ".", "ftype", "==", "'mat'", ":", "\n", "            ", "savemat", "(", "fname", ",", "{", "'predicted_labels'", ":", "file", "}", ")", "\n", "", "elif", "self", ".", "ftype", "==", "'txt'", ":", "\n", "            ", "data_utils", ".", "write_sparse_file", "(", "file", ",", "fname", ")", "\n", "", "elif", "self", ".", "ftype", "==", "'npz'", ":", "\n", "            ", "save_npz", "(", "fname", ",", "file", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.merge_split_predictions.CombineResults.read_mapping": [[31, 33], ["numpy.loadtxt"], "methods", ["None"], ["", "", "def", "read_mapping", "(", "self", ",", "fname", ",", "_set", ")", ":", "\n", "        ", "self", ".", "label_mapping", "=", "np", ".", "loadtxt", "(", "fname", ",", "dtype", "=", "np", ".", "int32", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.merge_split_predictions.CombineResults.map_to_original": [[34, 40], ["mat.nonzero", "numpy.array().squeeze", "list", "scipy.sparse.csr_matrix", "map", "numpy.array", "numpy.array"], "methods", ["None"], ["", "def", "map_to_original", "(", "self", ",", "mat", ",", "label_map", ",", "n_cols", ")", ":", "\n", "        ", "n_rows", "=", "mat", ".", "shape", "[", "0", "]", "\n", "row_idx", ",", "col_idx", "=", "mat", ".", "nonzero", "(", ")", "\n", "vals", "=", "np", ".", "array", "(", "mat", "[", "row_idx", ",", "col_idx", "]", ")", ".", "squeeze", "(", ")", "\n", "col_indices", "=", "list", "(", "map", "(", "lambda", "x", ":", "label_map", "[", "x", "]", ",", "col_idx", ")", ")", "\n", "return", "csr_matrix", "(", "(", "vals", ",", "(", "row_idx", ",", "np", ".", "array", "(", "col_indices", ")", ")", ")", ",", "shape", "=", "(", "n_rows", ",", "n_cols", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.merge_split_predictions.CombineResults.combine": [[41, 46], ["merge_split_predictions.CombineResults.read_mapping", "merge_split_predictions.CombineResults.read_predictions", "merge_split_predictions.CombineResults.map_to_original", "merge_split_predictions.CombineResults.tocsr"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.merge_split_predictions.CombineResults.read_mapping", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.merge_split_predictions.CombineResults.read_predictions", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.merge_split_predictions.CombineResults.map_to_original"], ["", "def", "combine", "(", "self", ",", "num_labels", ",", "fname_predictions", ",", "fname_mapping", ",", "_set", "=", "'test'", ",", "ftype", "=", "'npz'", ")", ":", "\n", "        ", "self", ".", "read_mapping", "(", "fname_mapping", ",", "_set", ")", "\n", "pred", "=", "self", ".", "read_predictions", "(", "fname_predictions", ")", "\n", "pred_mapped", "=", "self", ".", "map_to_original", "(", "pred", ".", "tocsr", "(", ")", ",", "self", ".", "label_mapping", ",", "num_labels", ")", "\n", "return", "pred_mapped", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.merge_split_predictions.main": [[48, 59], ["int", "merge_split_predictions.CombineResults", "os.path.join", "os.path.join", "merge_split_predictions.CombineResults.combine", "merge_split_predictions.CombineResults.write_predictions", "print", "os.path.join"], "function", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.merge_split_predictions.CombineResults.combine", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.merge_split_predictions.CombineResults.write_predictions"], ["", "", "def", "main", "(", ")", ":", "\n", "    ", "result_dir", "=", "sys", ".", "argv", "[", "1", "]", "\n", "suffix_predictions", "=", "sys", ".", "argv", "[", "2", "]", "\n", "mapping_dir", "=", "sys", ".", "argv", "[", "3", "]", "\n", "num_labels", "=", "int", "(", "sys", ".", "argv", "[", "4", "]", ")", "\n", "cr", "=", "CombineResults", "(", "'npz'", ")", "\n", "fname_predictions", "=", "os", ".", "path", ".", "join", "(", "result_dir", ",", "\"XC\"", ",", "suffix_predictions", ")", "\n", "fname_mapping", "=", "os", ".", "path", ".", "join", "(", "mapping_dir", ",", "\"labels_split.txt\"", ")", "\n", "predicted_labels", "=", "cr", ".", "combine", "(", "num_labels", ",", "fname_predictions", ",", "fname_mapping", ")", "\n", "cr", ".", "write_predictions", "(", "predicted_labels", ",", "os", ".", "path", ".", "join", "(", "result_dir", ",", "suffix_predictions", ")", ")", "\n", "print", "(", "\"Results combined!\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.evaluate.load_overlap": [[12, 25], ["numpy.asarray", "numpy.asarray", "os.path.exists", "print", "os.path.join", "numpy.loadtxt", "print", "os.path.join"], "function", ["None"], ["def", "load_overlap", "(", "data_dir", ",", "filter_label_file", "=", "'filter_labels.txt'", ")", ":", "\n", "    ", "docs", "=", "np", ".", "asarray", "(", "[", "]", ")", "\n", "lbs", "=", "np", ".", "asarray", "(", "[", "]", ")", "\n", "if", "os", ".", "path", ".", "exists", "(", "os", ".", "path", ".", "join", "(", "data_dir", ",", "filter_label_file", ")", ")", ":", "\n", "        ", "filter_lbs", "=", "np", ".", "loadtxt", "(", "os", ".", "path", ".", "join", "(", "\n", "data_dir", ",", "filter_label_file", ")", ",", "dtype", "=", "np", ".", "int32", ")", "\n", "if", "filter_lbs", ".", "size", ">", "0", ":", "\n", "            ", "docs", "=", "filter_lbs", "[", ":", ",", "0", "]", "\n", "lbs", "=", "filter_lbs", "[", ":", ",", "1", "]", "\n", "", "", "else", ":", "\n", "        ", "print", "(", "\"Overlap not found\"", ")", "\n", "", "print", "(", "\"Overlap is:\"", ",", "docs", ".", "size", ")", "\n", "return", "docs", ",", "lbs", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.evaluate._remove_overlap": [[27, 32], ["score_mat.tocsr.tocsr", "score_mat.tocsr.eliminate_zeros"], "function", ["None"], ["", "def", "_remove_overlap", "(", "score_mat", ",", "docs", ",", "lbs", ")", ":", "\n", "    ", "score_mat", "[", "docs", ",", "lbs", "]", "=", "0", "\n", "score_mat", "=", "score_mat", ".", "tocsr", "(", ")", "\n", "score_mat", ".", "eliminate_zeros", "(", ")", "\n", "return", "score_mat", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.evaluate.main": [[34, 51], ["evaluate._remove_overlap", "xclib.read_sparse_file", "xclib.compute_inv_propesity", "xclib.Metrics", "evaluate._remove_overlap", "print", "xc_metrics.Metrics.eval", "print", "xclib.read_sparse_file().tolil", "scipy.sparse.load_npz().tolil", "xclib.format", "xclib.recall", "xclib.read_sparse_file", "scipy.sparse.load_npz"], "function", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.evaluate._remove_overlap", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.evaluate._remove_overlap", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.eval"], ["", "def", "main", "(", "targets_label_file", ",", "train_label_file", ",", "predictions_file", ",", "A", ",", "B", ",", "docs", ",", "lbls", ")", ":", "\n", "    ", "true_labels", "=", "_remove_overlap", "(", "\n", "data_utils", ".", "read_sparse_file", "(", "\n", "targets_label_file", ",", "force_header", "=", "True", ")", ".", "tolil", "(", ")", ",", "\n", "docs", ",", "lbls", ")", "\n", "trn_labels", "=", "data_utils", ".", "read_sparse_file", "(", "\n", "train_label_file", ",", "force_header", "=", "True", ")", "\n", "inv_propen", "=", "xc_metrics", ".", "compute_inv_propesity", "(", "trn_labels", ",", "A", "=", "A", ",", "B", "=", "B", ")", "\n", "acc", "=", "xc_metrics", ".", "Metrics", "(", "\n", "true_labels", ",", "inv_psp", "=", "inv_propen", ",", "remove_invalid", "=", "False", ")", "\n", "predicted_labels", "=", "_remove_overlap", "(", "\n", "load_npz", "(", "predictions_file", "+", "'.npz'", ")", ".", "tolil", "(", ")", ",", "\n", "docs", ",", "lbls", ")", "\n", "rec", "=", "xc_metrics", ".", "recall", "(", "predicted_labels", ",", "true_labels", ",", "k", "=", "10", ")", "[", "-", "1", "]", "*", "100", "\n", "print", "(", "\"R@10=%0.2f\"", "%", "(", "rec", ")", ")", "\n", "args", "=", "acc", ".", "eval", "(", "predicted_labels", ",", "5", ")", "\n", "print", "(", "xc_metrics", ".", "format", "(", "*", "args", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.label_features_split.main": [[9, 39], ["xclib.read_sparse_file", "xclib.read_sparse_file", "xclib.read_sparse_file", "numpy.intersect1d", "numpy.union1d", "os.path.join", "numpy.savetxt", "os.path.join", "numpy.savetxt", "os.path.join", "numpy.savetxt", "print", "json.dump", "numpy.where", "numpy.where", "numpy.where", "numpy.where", "numpy.where", "open", "os.path.join", "du.read_sparse_file.getnnz", "du.read_sparse_file.getnnz", "du.read_sparse_file.getnnz", "du.read_sparse_file.getnnz", "yft_x[].getnnz"], "function", ["None"], ["def", "main", "(", ")", ":", "\n", "    ", "data_dir", "=", "sys", ".", "argv", "[", "1", "]", "\n", "trn_x", "=", "du", ".", "read_sparse_file", "(", "sys", ".", "argv", "[", "2", "]", ")", "\n", "trn_y", "=", "du", ".", "read_sparse_file", "(", "sys", ".", "argv", "[", "3", "]", ")", "\n", "yft_x", "=", "du", ".", "read_sparse_file", "(", "sys", ".", "argv", "[", "4", "]", ")", "\n", "tmp_mdata", "=", "sys", ".", "argv", "[", "5", "]", "\n", "assert", "trn_x", ".", "shape", "[", "0", "]", "==", "trn_y", ".", "shape", "[", "0", "]", ",", "\"Number of instances must be same in features and labels\"", "\n", "num_labels", "=", "trn_y", ".", "shape", "[", "1", "]", "\n", "valid_trn_x", "=", "np", ".", "where", "(", "trn_x", ".", "getnnz", "(", "axis", "=", "1", ")", ">", "0", ")", "[", "0", "]", "\n", "valid_trn_y", "=", "np", ".", "where", "(", "trn_y", ".", "getnnz", "(", "axis", "=", "1", ")", ">", "0", ")", "[", "0", "]", "\n", "valid_idx", "=", "np", ".", "intersect1d", "(", "valid_trn_x", ",", "valid_trn_y", ")", "\n", "trn_x", "=", "trn_x", "[", "valid_idx", "]", "\n", "trn_y", "=", "trn_y", "[", "valid_idx", "]", "\n", "features", "=", "np", ".", "where", "(", "trn_x", ".", "getnnz", "(", "axis", "=", "0", ")", ">", "0", ")", "[", "0", "]", "\n", "labels", "=", "np", ".", "where", "(", "trn_y", ".", "getnnz", "(", "axis", "=", "0", ")", ">", "0", ")", "[", "0", "]", "\n", "v_lbs_wrds", "=", "np", ".", "where", "(", "yft_x", "[", "labels", "]", ".", "getnnz", "(", "axis", "=", "0", ")", ">", "0", ")", "[", "0", "]", "\n", "union_fts", "=", "np", ".", "union1d", "(", "v_lbs_wrds", ",", "features", ")", "\n", "path", "=", "os", ".", "path", ".", "join", "(", "tmp_mdata", ",", "'features_split.txt'", ")", "\n", "np", ".", "savetxt", "(", "path", ",", "union_fts", ",", "fmt", "=", "'%d'", ")", "\n", "path", "=", "os", ".", "path", ".", "join", "(", "tmp_mdata", ",", "'labels_split.txt'", ")", "\n", "np", ".", "savetxt", "(", "path", ",", "labels", ",", "fmt", "=", "'%d'", ")", "\n", "path", "=", "os", ".", "path", ".", "join", "(", "tmp_mdata", ",", "'v_lbs_fts_split.txt'", ")", "\n", "np", ".", "savetxt", "(", "path", ",", "union_fts", ",", "fmt", "=", "'%d'", ")", "\n", "params", "=", "\"{},{},{},{}\"", ".", "format", "(", "union_fts", ".", "size", ",", "num_labels", ",", "\n", "labels", ".", "size", ",", "union_fts", ".", "size", ")", "\n", "print", "(", "params", ")", "\n", "stats_obj", "=", "{", "'header'", ":", "'num_features,num_labels,valid_num_labels, valid_num_features'", "}", "\n", "stats_obj", "[", "'all'", "]", "=", "params", "\n", "json", ".", "dump", "(", "stats_obj", ",", "open", "(", "os", ".", "path", ".", "join", "(", "\n", "tmp_mdata", ",", "\"split_stats.json\"", ")", ",", "'w'", ")", ",", "indent", "=", "4", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.merge_outputs._score_compute": [[6, 9], ["numpy.exp"], "function", ["None"], ["def", "_score_compute", "(", "score", ",", "factor", "=", "1", ")", ":", "\n", "    ", "score", ".", "__dict__", "[", "'data'", "]", "=", "np", ".", "exp", "(", "score", ".", "__dict__", "[", "'data'", "]", ")", "/", "factor", "\n", "return", "score", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.GraphBase.__init__": [[14, 21], ["network.GraphBase._set_params", "super().__init__", "models.get_functions", "models.get_functions"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._set_params", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.get_functions", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.get_functions"], ["    ", "def", "__init__", "(", "self", ",", "params", ")", ":", "\n", "        ", "self", ".", "_set_params", "(", "params", ")", "\n", "super", "(", "GraphBase", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "vocabulary_dims", "=", "params", ".", "vocabulary_dims", "+", "1", "\n", "self", ".", "embedding_dims", "=", "params", ".", "embedding_dims", "\n", "self", ".", "num_labels", "=", "params", ".", "num_labels", "\n", "self", ".", "embed", "=", "tl", ".", "get_functions", "(", "self", ".", "embeddings", ")", "[", "0", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.GraphBase._set_params": [[22, 36], ["libs.utils.fetch_json"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.fetch_json"], ["", "def", "_set_params", "(", "self", ",", "params", ")", ":", "\n", "        ", "self", ".", "topk_edges", "=", "params", ".", "top_k", "\n", "self", ".", "labelfts_transform", "=", "None", "\n", "params", ".", "trans_config_lbl", "=", "None", "\n", "transform_config_dict", "=", "fetch_json", "(", "params", ".", "trans_method", ",", "params", ")", "\n", "self", ".", "embeddings", "=", "transform_config_dict", "[", "'embedding'", "]", "\n", "self", ".", "transform", "=", "transform_config_dict", "[", "'trans_emb'", "]", "\n", "self", ".", "lblfts_transform", "=", "transform_config_dict", "[", "'trans_gph'", "]", "\n", "self", ".", "to_clusters", "=", "None", "\n", "self", ".", "filters", "=", "None", "\n", "self", ".", "degree", "=", "params", ".", "degree", "\n", "self", ".", "fixed_lbs", "=", "params", ".", "freeze_embeddings", "\n", "self", ".", "lbs_params", "=", "None", "\n", "self", ".", "offset", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.GraphBase._construct_classifier": [[37, 39], ["None"], "methods", ["None"], ["", "def", "_construct_classifier", "(", "self", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.GraphBase._construct_transform": [[40, 42], ["models.Transform", "models.Transform", "models.get_functions", "models.get_functions"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.get_functions", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.get_functions"], ["", "def", "_construct_transform", "(", "self", ",", "trans_config", ")", ":", "\n", "        ", "return", "tl", ".", "Transform", "(", "tl", ".", "get_functions", "(", "trans_config", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.GraphBase.representation_dims": [[43, 46], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "representation_dims", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "embed", ".", "embedding_dim", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.GraphBase.encode": [[47, 64], ["network.GraphBase.embed"], "methods", ["None"], ["", "def", "encode", "(", "self", ",", "batch_data", ",", "return_course", "=", "False", ")", ":", "\n", "        ", "\"\"\"encode documents\n        Parameters:\n        -----------\n        batch_data: dict\n            batch_data['X']: torch.Tensor\n                dense feature vector or\n                feature indices in case of sparse features\n            batch_data['X_w]: torch.Tensor\n                feature weights in case of sparse features\n\n        Returns\n        -------\n        out: torch.Tensor\n            encoding of a document\n        \"\"\"", "\n", "return", "self", ".", "embed", "(", "batch_data", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.GraphBase.forward": [[65, 80], ["network.GraphBase.encode"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh.encode"], ["", "def", "forward", "(", "self", ",", "batch_data", ")", ":", "\n", "        ", "\"\"\"Forward pass\n        Parameters:\n        -----------\n        batch_data: dict\n            batch_data['X']: torch.Tensor\n                dense feature vector or\n                feature indices in case of sparse features\n            batch_data['X_w]: torch.Tensor\n                feature weights in case of sparse features\n        Returns\n        -------\n        out: logits for each label\n        \"\"\"", "\n", "return", "self", ".", "encode", "(", "batch_data", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.GraphBase.to": [[81, 84], ["network.GraphBase.embed.to"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to"], ["", "def", "to", "(", "self", ")", ":", "\n", "        ", "self", ".", "embed", ".", "to", "(", ")", "\n", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.GraphBase.num_trainable_params": [[85, 88], ["sum", "p.numel", "network.GraphBase.parameters"], "methods", ["None"], ["", "@", "property", "\n", "def", "num_trainable_params", "(", "self", ")", ":", "\n", "        ", "return", "sum", "(", "p", ".", "numel", "(", ")", "for", "p", "in", "self", ".", "parameters", "(", ")", "if", "p", ".", "requires_grad", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.GraphBase.model_size": [[89, 92], ["math.pow"], "methods", ["None"], ["", "@", "property", "\n", "def", "model_size", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "num_trainable_params", "*", "4", "/", "math", ".", "pow", "(", "2", ",", "20", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.GraphBase._init_": [[93, 95], ["network.GraphBase.embed._init_"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._init_"], ["", "def", "_init_", "(", "self", ",", "words", ",", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "embed", ".", "_init_", "(", "words", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh.__init__": [[98, 104], ["network.GraphBase.__init__", "network.ECLAREh._sparse_matrix", "network.ECLAREh._construct_classifier", "network.ECLAREh._construct_transform"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._sparse_matrix", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._construct_classifier", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.GraphBase._construct_transform"], ["    ", "def", "__init__", "(", "self", ",", "params", ")", ":", "\n", "        ", "super", "(", "ECLAREh", ",", "self", ")", ".", "__init__", "(", "params", ")", "\n", "self", ".", "_sparse_matrix", "(", "params", ")", "\n", "self", ".", "clf_from_fts", ",", "self", ".", "clf_from_wts", "=", "self", ".", "_construct_classifier", "(", "\n", "params", ")", "\n", "self", ".", "transform", "=", "self", ".", "_construct_transform", "(", "self", ".", "transform", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh.encode": [[105, 113], ["network.ECLAREh.transform", "network.GraphBase.encode", "batch_data[].cuda"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh.encode"], ["", "def", "encode", "(", "self", ",", "batch_data", ",", "return_course", "=", "False", ")", ":", "\n", "        ", "if", "batch_data", "[", "'is_sparse'", "]", ":", "\n", "            ", "embed", "=", "super", "(", "ECLAREh", ",", "self", ")", ".", "encode", "(", "batch_data", ")", "\n", "", "else", ":", "\n", "            ", "embed", "=", "batch_data", "[", "'X'", "]", ".", "cuda", "(", ")", "\n", "", "if", "return_course", ":", "\n", "            ", "return", "embed", "\n", "", "return", "self", ".", "transform", "(", "embed", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._create_mapping": [[114, 122], ["scipy.lil_matrix", "numpy.concatenate", "numpy.concatenate", "scipy.lil_matrix.tocsr", "list", "len", "map", "enumerate", "numpy.tile"], "methods", ["None"], ["", "def", "_create_mapping", "(", "self", ",", "clusters", ",", "num_lbs", ")", ":", "\n", "        ", "to_cluster", "=", "sp", ".", "lil_matrix", "(", "(", "len", "(", "clusters", ")", ",", "num_lbs", ")", ",", "dtype", "=", "np", ".", "float", ")", "\n", "rows", "=", "np", ".", "concatenate", "(", "list", "(", "\n", "map", "(", "lambda", "x", ":", "np", ".", "tile", "(", "x", "[", "0", "]", ",", "x", "[", "1", "]", ".", "size", ")", ",", "\n", "enumerate", "(", "clusters", ")", ")", ")", ")", "\n", "cols", "=", "np", ".", "concatenate", "(", "clusters", ")", "\n", "to_cluster", "[", "rows", ",", "cols", "]", "=", "1", "\n", "return", "to_cluster", ".", "tocsr", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._padded": [[123, 128], ["scipy.csr_matrix.tocoo", "scipy.csr_matrix", "scipy.csr_matrix.sort_indices"], "methods", ["None"], ["", "def", "_padded", "(", "self", ",", "mat", ",", "new_shape", ")", ":", "\n", "        ", "mat", "=", "mat", ".", "tocoo", "(", ")", "\n", "mat", "=", "sp", ".", "csr_matrix", "(", "(", "mat", ".", "data", ",", "(", "mat", ".", "row", ",", "mat", ".", "col", ")", ")", ",", "shape", "=", "new_shape", ")", "\n", "mat", ".", "sort_indices", "(", ")", "\n", "return", "mat", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._load_lblft": [[129, 140], ["network.ECLAREh.sort_indices", "network.ECLAREh.tocsr", "network.ECLAREh.to_clusters.dot", "sklearn.preprocessing.normalize", "network.ECLAREh._padded"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.normalize", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._padded"], ["", "def", "_load_lblft", "(", "self", ",", "params", ",", "return_padded", "=", "False", ")", ":", "\n", "        ", "label_word", "=", "params", ".", "lblft", "\n", "if", "self", ".", "to_clusters", "is", "not", "None", ":", "\n", "            ", "label_word", "=", "self", ".", "to_clusters", ".", "dot", "(", "label_word", ")", "\n", "label_word", "=", "normalize", "(", "label_word", ",", "norm", "=", "'l2'", ")", "\n", "\n", "", "if", "return_padded", ":", "\n", "            ", "row", ",", "col", "=", "label_word", ".", "shape", "\n", "label_word", "=", "self", ".", "_padded", "(", "label_word", ",", "(", "row", "+", "1", ",", "col", ")", ")", "\n", "", "label_word", ".", "sort_indices", "(", ")", "\n", "return", "label_word", ".", "tocsr", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._load_graph": [[141, 157], ["params.graph.copy", "libs.utils.normalize_graph", "network.ECLAREh.sort_indices", "network.ECLAREh.tocsr", "network.ECLAREh.to_clusters.dot", "network.ECLAREh.dot().tocsr", "print", "xclib.utils.sparse.retain_topk", "libs.utils.print_stats", "network.ECLAREh._padded", "network.ECLAREh.dot", "network.ECLAREh.to_clusters.transpose"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.normalize_graph", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.print_stats", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._padded", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.transpose"], ["", "def", "_load_graph", "(", "self", ",", "params", ",", "return_padded", "=", "False", ",", "train", "=", "True", ")", ":", "\n", "        ", "graph", "=", "params", ".", "graph", ".", "copy", "(", ")", "\n", "\n", "if", "self", ".", "to_clusters", "is", "not", "None", ":", "\n", "            ", "graph", "=", "self", ".", "to_clusters", ".", "dot", "(", "graph", ")", "\n", "graph", "=", "graph", ".", "dot", "(", "self", ".", "to_clusters", ".", "transpose", "(", ")", ")", ".", "tocsr", "(", ")", "\n", "print", "(", "\"Squeezing Graph\"", ",", "self", ".", "topk_edges", ")", "\n", "graph", "=", "xs", ".", "retain_topk", "(", "graph", ",", "k", "=", "self", ".", "topk_edges", ")", "\n", "print_stats", "(", "graph", ")", "\n", "", "graph", "=", "normalize_graph", "(", "graph", ")", "\n", "\n", "if", "return_padded", ":", "\n", "            ", "row", ",", "col", "=", "graph", ".", "shape", "\n", "graph", "=", "self", ".", "_padded", "(", "graph", ",", "(", "row", "+", "1", ",", "col", "+", "1", ")", ")", "\n", "", "graph", ".", "sort_indices", "(", ")", "\n", "return", "graph", ".", "tocsr", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._set_params": [[158, 175], ["network.GraphBase._set_params", "network.ECLAREh._create_mapping"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._set_params", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._create_mapping"], ["", "def", "_set_params", "(", "self", ",", "params", ")", ":", "\n", "        ", "super", "(", "ECLAREh", ",", "self", ")", ".", "_set_params", "(", "params", ")", "\n", "self", ".", "use_classifier_wts", "=", "params", ".", "use_classifier_wts", "\n", "num_lbs", "=", "params", ".", "lblft", ".", "shape", "[", "0", "]", "\n", "if", "params", ".", "clusters", "is", "not", "None", ":", "\n", "            ", "self", ".", "to_clusters", "=", "self", ".", "_create_mapping", "(", "params", ".", "clusters", ",", "num_lbs", ")", "\n", "", "self", ".", "label_padding_idx", "=", "None", "\n", "self", ".", "sparse_clf", "=", "False", "\n", "self", ".", "sparse_emb", "=", "False", "\n", "self", ".", "sparse_gph", "=", "False", "\n", "self", ".", "graph_train", "=", "None", "\n", "self", ".", "use_bias", "=", "False", "\n", "self", ".", "fixed_lbs", "=", "params", ".", "freeze_embeddings", "\n", "self", ".", "lbs_params", "=", "None", "\n", "self", ".", "offset", "=", "0", "\n", "_order0", "=", "self", ".", "embeddings", "[", "'order'", "]", "[", "0", "]", "\n", "self", ".", "embeddings", "[", "_order0", "]", "[", "'sparse'", "]", "=", "self", ".", "sparse_emb", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._BSMatComp": [[176, 180], ["torch.sparse_coo_tensor", "torch.sparse_coo_tensor", "torch.sparse_coo_tensor", "torch.sparse_coo_tensor", "torch.sparse_coo_tensor._coalesced_", "torch.sparse_coo_tensor._coalesced_"], "methods", ["None"], ["", "def", "_BSMatComp", "(", "self", ",", "index", ",", "values", ",", "shape", ")", ":", "\n", "        ", "mat", "=", "torch", ".", "sparse_coo_tensor", "(", "index", ",", "values", ",", "shape", ")", "\n", "mat", ".", "_coalesced_", "(", "True", ")", "\n", "return", "mat", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._BSMat": [[181, 189], ["mat.tocoo.tocoo.tocsr", "mat.tocoo.tocoo.sort_indices", "mat.tocoo.tocoo.tocoo", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "torch.Size", "torch.Size", "torch.Size", "torch.Size", "network.ECLAREh._BSMatComp", "numpy.vstack"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._BSMatComp"], ["", "def", "_BSMat", "(", "self", ",", "mat", ")", ":", "\n", "        ", "mat", "=", "mat", ".", "tocsr", "(", ")", "\n", "mat", ".", "sort_indices", "(", ")", "\n", "mat", "=", "mat", ".", "tocoo", "(", ")", "\n", "values", "=", "torch", ".", "FloatTensor", "(", "mat", ".", "data", ")", "\n", "index", "=", "torch", ".", "LongTensor", "(", "np", ".", "vstack", "(", "[", "mat", ".", "row", ",", "mat", ".", "col", "]", ")", ")", "\n", "shape", "=", "torch", ".", "Size", "(", "mat", ".", "shape", ")", "\n", "return", "self", ".", "_BSMatComp", "(", "index", ",", "values", ",", "shape", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh.forward": [[190, 194], ["network.ECLAREh.encode", "network.ECLAREh._get_lbl_fts", "network.ECLAREh.clf_from_wts"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh.encode", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._get_lbl_fts"], ["", "def", "forward", "(", "self", ",", "batch_data", ")", ":", "\n", "        ", "input", "=", "self", ".", "encode", "(", "batch_data", ")", "\n", "label_fts", "=", "self", ".", "_get_lbl_fts", "(", ")", "\n", "return", "self", ".", "clf_from_wts", "(", "input", ",", "label_fts", ",", "None", ",", "None", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._predict": [[195, 198], ["network.ECLAREh.encode", "network.ECLAREh.clf_from_wts"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh.encode"], ["", "def", "_predict", "(", "self", ",", "batch_data", ")", ":", "\n", "        ", "input", "=", "self", ".", "encode", "(", "batch_data", ")", "\n", "return", "self", ".", "clf_from_wts", "(", "input", ",", "None", ",", "None", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._traverse": [[199, 201], ["smat.dot"], "methods", ["None"], ["", "def", "_traverse", "(", "self", ",", "smat", ")", ":", "\n", "        ", "return", "smat", ".", "dot", "(", "self", ".", "graph_pred", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh.get_weights": [[202, 206], ["network.ECLAREh.clf_from_fts.get_weights", "network.ECLAREh.clf_from_wts.get_weights"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.get_weights", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.get_weights"], ["", "def", "get_weights", "(", "self", ")", ":", "\n", "        ", "clf0", "=", "self", ".", "clf_from_fts", ".", "get_weights", "(", ")", "\n", "clf1", "=", "self", ".", "clf_from_wts", ".", "get_weights", "(", ")", "\n", "return", "{", "'words'", ":", "clf0", ",", "'classifier'", ":", "clf1", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._get_lbl_fts": [[207, 214], ["network.ECLAREh.clf_from_fts", "network.ECLAREh._setup_graph", "network.ECLAREh.clf_from_fts"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._setup_graph"], ["", "def", "_get_lbl_fts", "(", "self", ",", "*", "args", ")", ":", "\n", "        ", "if", "self", ".", "fixed_lbs", "and", "self", ".", "lbs_params", "is", "None", ":", "\n", "            ", "self", ".", "_setup_graph", "(", "not", "self", ".", "_device", "==", "'cpu'", ")", "\n", "", "if", "self", ".", "fixed_lbs", ":", "\n", "            ", "return", "self", ".", "clf_from_fts", "(", "self", ".", "lbs_params", ",", "None", ")", "\n", "", "return", "self", ".", "clf_from_fts", "(", "self", ".", "label_word", ",", "self", ".", "graph_train", ",", "\n", "weights", "=", "self", ".", "embed", ".", "weight", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._pred_init": [[215, 221], ["network.ECLAREh.clf_from_wts._setup", "network.ECLAREh._get_lbl_fts", "print", "print"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._setup", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._get_lbl_fts"], ["", "def", "_pred_init", "(", "self", ")", ":", "\n", "        ", "self", ".", "clf_from_wts", ".", "_setup", "(", "self", ".", "_get_lbl_fts", "(", ")", ")", "\n", "if", "self", ".", "clf_from_wts", "is", "not", "None", ":", "\n", "            ", "print", "(", "self", ".", "clf_from_wts", ".", "stats", ")", "\n", "", "if", "self", ".", "clf_from_fts", "is", "not", "None", ":", "\n", "            ", "print", "(", "self", ".", "clf_from_fts", ".", "stats", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._eval": [[222, 225], ["network.ECLAREh.eval", "network.ECLAREh._pred_init"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.eval", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._pred_init"], ["", "", "def", "_eval", "(", "self", ")", ":", "\n", "        ", "self", ".", "eval", "(", ")", "\n", "self", ".", "_pred_init", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._train": [[226, 229], ["network.ECLAREh.clf_from_wts.clean", "network.ECLAREh.train"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine.clean", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.train"], ["", "def", "_train", "(", "self", ")", ":", "\n", "        ", "self", ".", "clf_from_wts", ".", "clean", "(", ")", "\n", "self", ".", "train", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._setup_graph": [[230, 251], ["network.ECLAREh.label_word.cuda", "network.ECLAREh.graph_train.cuda", "network.ECLAREh.label_word.cpu", "network.ECLAREh.graph_train.cpu", "network.ECLAREh.embed.weight.detach().cpu", "range", "range", "range", "network.ECLAREh.label_word.cpu().mm", "network.ECLAREh.graph_train.cpu().mm", "network.ECLAREh.lbs_params.append", "network.ECLAREh.lbs_params[].cuda", "network.ECLAREh.lbs_params[].cpu", "network.ECLAREh.embed.weight.detach", "network.ECLAREh.label_word.cpu", "network.ECLAREh.graph_train.cpu"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu"], ["", "def", "_setup_graph", "(", "self", ",", "to_cuda", "=", "True", ")", ":", "\n", "        ", "if", "not", "self", ".", "fixed_lbs", ":", "\n", "            ", "if", "to_cuda", ":", "\n", "                ", "self", ".", "label_word", "=", "self", ".", "label_word", ".", "cuda", "(", ")", "\n", "self", ".", "graph_train", "=", "self", ".", "graph_train", ".", "cuda", "(", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "label_word", "=", "self", ".", "label_word", ".", "cpu", "(", ")", "\n", "self", ".", "graph_train", "=", "self", ".", "graph_train", ".", "cpu", "(", ")", "\n", "", "", "else", ":", "\n", "            ", "if", "self", ".", "lbs_params", "is", "None", ":", "\n", "                ", "tokens", "=", "self", ".", "embed", ".", "weight", ".", "detach", "(", ")", ".", "cpu", "(", ")", "\n", "self", ".", "lbs_params", "=", "[", "self", ".", "label_word", ".", "cpu", "(", ")", ".", "mm", "(", "tokens", ")", "]", "\n", "for", "_", "in", "range", "(", "1", ",", "self", ".", "degree", ")", ":", "\n", "                    ", "_params", "=", "self", ".", "graph_train", ".", "cpu", "(", ")", ".", "mm", "(", "self", ".", "lbs_params", "[", "-", "1", "]", ")", "\n", "self", ".", "lbs_params", ".", "append", "(", "_params", ")", "\n", "", "", "if", "to_cuda", ":", "\n", "                ", "for", "x", "in", "range", "(", "self", ".", "degree", ")", ":", "\n", "                    ", "self", ".", "lbs_params", "[", "x", "]", "=", "self", ".", "lbs_params", "[", "x", "]", ".", "cuda", "(", ")", "\n", "", "", "else", ":", "\n", "                ", "for", "x", "in", "range", "(", "self", ".", "degree", ")", ":", "\n", "                    ", "self", ".", "lbs_params", "[", "x", "]", "=", "self", ".", "lbs_params", "[", "x", "]", ".", "cpu", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh.to": [[252, 259], ["network.ECLAREh.embed.to", "network.ECLAREh.transform.to", "network.ECLAREh.clf_from_wts.to", "network.ECLAREh.clf_from_fts.to", "network.ECLAREh._setup_graph"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._setup_graph"], ["", "", "", "", "def", "to", "(", "self", ")", ":", "\n", "        ", "self", ".", "_device", "=", "\"cuda:0\"", "\n", "self", ".", "embed", ".", "to", "(", ")", "\n", "self", ".", "transform", ".", "to", "(", ")", "\n", "self", ".", "clf_from_wts", ".", "to", "(", ")", "\n", "self", ".", "clf_from_fts", ".", "to", "(", ")", "\n", "self", ".", "_setup_graph", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh.cpu": [[260, 267], ["network.ECLAREh.embed.cpu", "network.ECLAREh.transform.cpu", "network.ECLAREh.clf_from_wts.cpu", "network.ECLAREh.clf_from_fts.cpu", "network.ECLAREh._setup_graph"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._setup_graph"], ["", "def", "cpu", "(", "self", ")", ":", "\n", "        ", "self", ".", "_device", "=", "\"cpu\"", "\n", "self", ".", "embed", "=", "self", ".", "embed", ".", "cpu", "(", ")", "\n", "self", ".", "transform", "=", "self", ".", "transform", ".", "cpu", "(", ")", "\n", "self", ".", "clf_from_wts", "=", "self", ".", "clf_from_wts", ".", "cpu", "(", ")", "\n", "self", ".", "clf_from_fts", "=", "self", ".", "clf_from_fts", ".", "cpu", "(", ")", "\n", "self", ".", "_setup_graph", "(", "to_cuda", "=", "False", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._construct_classifier": [[268, 286], ["models.GraphConv", "models.GraphConv", "models.GraphCombine", "models.GraphCombine", "int"], "methods", ["None"], ["", "def", "_construct_classifier", "(", "self", ",", "params", ")", ":", "\n", "        ", "clf0", ",", "clf1", "=", "None", ",", "None", "\n", "clf0", "=", "linear_layer", ".", "GraphConv", "(", "\n", "input_size", "=", "self", ".", "representation_dims", ",", "\n", "label_features", "=", "params", ".", "label_features", ",", "\n", "sparse", "=", "self", ".", "sparse_gph", ",", "padding_idx", "=", "self", ".", "label_padding_idx", ",", "\n", "name", "=", "\"GCN\"", ",", "reduction", "=", "'add'", ",", "degree", "=", "self", ".", "degree", ",", "\n", "graph_layer", "=", "self", ".", "lblfts_transform", "\n", ")", "\n", "clf1", "=", "linear_layer", ".", "GraphCombine", "(", "\n", "input_size", "=", "self", ".", "representation_dims", ",", "\n", "output_size", "=", "int", "(", "self", ".", "num_labels", "+", "self", ".", "offset", ")", ",", "\n", "use_classifier_wts", "=", "params", ".", "use_classifier_wts", ",", "\n", "sparse", "=", "self", ".", "sparse_clf", ",", "\n", "padding_idx", "=", "self", ".", "label_padding_idx", ",", "\n", "degree", "=", "self", ".", "degree", ",", "bias", "=", "self", ".", "use_bias", "\n", ")", "\n", "return", "clf0", ",", "clf1", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._sparse_matrix": [[287, 291], ["network.ECLAREh._BSMat", "network.ECLAREh._BSMat", "network.ECLAREh._load_graph", "network.ECLAREh._load_lblft", "network.ECLAREh._load_graph"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._BSMat", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._BSMat", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._load_graph", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._load_lblft", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._load_graph"], ["", "def", "_sparse_matrix", "(", "self", ",", "params", ")", ":", "\n", "        ", "self", ".", "label_word", "=", "self", ".", "_BSMat", "(", "self", ".", "_load_lblft", "(", "params", ")", ")", "\n", "self", ".", "graph_train", "=", "self", ".", "_BSMat", "(", "self", ".", "_load_graph", "(", "params", ")", ")", "\n", "self", ".", "graph_pred", "=", "self", ".", "_load_graph", "(", "params", ",", "train", "=", "False", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._init_": [[292, 296], ["network.ECLAREh.embed._init_", "network.ECLAREh.clf_from_fts._init_", "network.ECLAREh.clf_from_wts._init_"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._init_", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._init_", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._init_"], ["", "def", "_init_", "(", "self", ",", "words", ",", "clf", ")", ":", "\n", "        ", "self", ".", "embed", ".", "_init_", "(", "words", ")", "\n", "self", ".", "clf_from_fts", ".", "_init_", "(", "clf", ")", "\n", "self", ".", "clf_from_wts", ".", "_init_", "(", "clf", ",", "self", ".", "label_word", ",", "self", ".", "graph_train", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt.__init__": [[299, 301], ["network.ECLAREh.__init__"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__"], ["    ", "def", "__init__", "(", "self", ",", "params", ")", ":", "\n", "        ", "super", "(", "ECLAREt", ",", "self", ")", ".", "__init__", "(", "params", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._set_params": [[302, 308], ["network.ECLAREh._set_params"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._set_params"], ["", "def", "_set_params", "(", "self", ",", "params", ")", ":", "\n", "        ", "super", "(", "ECLAREt", ",", "self", ")", ".", "_set_params", "(", "params", ")", "\n", "self", ".", "sparse_clf", "=", "True", "\n", "self", ".", "sparse_emb", "=", "True", "\n", "self", ".", "use_bias", "=", "False", "\n", "self", ".", "offset", "=", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._fixed_forward": [[309, 316], ["network.ECLAREt.encode", "list", "network.ECLAREt._get_lbl_fts", "network.ECLAREt.clf_from_wts", "batch_data[].cuda", "batch_data[].cuda", "map", "numpy.arange", "torch.embedding", "torch.embedding"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh.encode", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._get_lbl_fts"], ["", "def", "_fixed_forward", "(", "self", ",", "batch_data", ")", ":", "\n", "        ", "input", "=", "self", ".", "encode", "(", "batch_data", ")", "\n", "Y_r", ",", "shorty", "=", "batch_data", "[", "'Y_r'", "]", ".", "cuda", "(", ")", ",", "batch_data", "[", "'f_shoty'", "]", ".", "cuda", "(", ")", "\n", "data", "=", "list", "(", "map", "(", "lambda", "x", ":", "F", ".", "embedding", "(", "\n", "shorty", ",", "self", ".", "lbs_params", "[", "x", "]", ",", "sparse", "=", "False", ")", ",", "np", ".", "arange", "(", "self", ".", "degree", ")", ")", ")", "\n", "label_fts", "=", "self", ".", "_get_lbl_fts", "(", "data", ",", "None", ",", "None", ")", "\n", "return", "self", ".", "clf_from_wts", "(", "input", ",", "label_fts", ",", "Y_r", ",", "shorty", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._train_forward": [[317, 327], ["network.ECLAREt.encode", "network.ECLAREt._BSMatComp().cuda", "network.ECLAREt._BSMatComp().cuda", "batch_data[].cuda", "torch.embedding", "torch.embedding", "network.ECLAREt._get_lbl_fts", "network.ECLAREt.clf_from_wts", "batch_data[].cuda", "batch_data[].cuda", "network.ECLAREt._BSMatComp", "network.ECLAREt._BSMatComp"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh.encode", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._get_lbl_fts", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._BSMatComp", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._BSMatComp"], ["", "def", "_train_forward", "(", "self", ",", "batch_data", ")", ":", "\n", "        ", "input", "=", "self", ".", "encode", "(", "batch_data", ")", "\n", "label_wrd", "=", "self", ".", "_BSMatComp", "(", "*", "batch_data", "[", "'shoty_lf'", "]", ")", ".", "cuda", "(", ")", "\n", "graph_trn", "=", "self", ".", "_BSMatComp", "(", "*", "batch_data", "[", "'shoty_lg'", "]", ")", ".", "cuda", "(", ")", "\n", "lbl_fts", "=", "batch_data", "[", "'lf'", "]", ".", "cuda", "(", ")", "\n", "weights", "=", "F", ".", "embedding", "(", "lbl_fts", ",", "self", ".", "embed", ".", "weight", ",", "sparse", "=", "True", ")", "\n", "Y_r", ",", "shorty", "=", "batch_data", "[", "'Y_r'", "]", ".", "cuda", "(", ")", ",", "batch_data", "[", "'f_shoty'", "]", ".", "cuda", "(", ")", "\n", "\n", "label_fts", "=", "self", ".", "_get_lbl_fts", "(", "label_wrd", ",", "graph_trn", ",", "weights", ")", "\n", "return", "self", ".", "clf_from_wts", "(", "input", ",", "label_fts", ",", "Y_r", ",", "shorty", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt.forward": [[328, 333], ["network.ECLAREt._fixed_forward", "network.ECLAREt._train_forward"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._fixed_forward", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._train_forward"], ["", "def", "forward", "(", "self", ",", "batch_data", ")", ":", "\n", "        ", "if", "self", ".", "fixed_lbs", ":", "\n", "            ", "return", "self", ".", "_fixed_forward", "(", "batch_data", ")", "\n", "", "else", ":", "\n", "            ", "return", "self", ".", "_train_forward", "(", "batch_data", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._predict": [[334, 337], ["network.ECLAREt.encode", "network.ECLAREt.clf_from_wts", "batch_data[].cuda"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh.encode"], ["", "", "def", "_predict", "(", "self", ",", "batch_data", ")", ":", "\n", "        ", "input", "=", "self", ".", "encode", "(", "batch_data", ")", "\n", "return", "self", ".", "clf_from_wts", "(", "input", ",", "None", ",", "batch_data", "[", "'Y_s'", "]", ".", "cuda", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._get_lbl_fts": [[338, 352], ["network.ECLAREt.clf_from_fts", "network.ECLAREt._setup_graph", "network.ECLAREt.clf_from_fts", "network.ECLAREt._BSMat().to", "network.ECLAREt._BSMat", "network.ECLAREt._BSMat"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._setup_graph", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._BSMat", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._BSMat"], ["", "def", "_get_lbl_fts", "(", "self", ",", "lbf", "=", "None", ",", "graph", "=", "None", ",", "wts", "=", "None", ")", ":", "\n", "        ", "if", "self", ".", "fixed_lbs", "and", "self", ".", "lbs_params", "is", "None", ":", "\n", "            ", "self", ".", "_setup_graph", "(", "not", "self", ".", "_device", "==", "'cpu'", ")", "\n", "", "if", "self", ".", "fixed_lbs", ":", "\n", "            ", "if", "lbf", "is", "None", ":", "\n", "                ", "lbf", "=", "self", ".", "lbs_params", "\n", "", "return", "self", ".", "clf_from_fts", "(", "lbf", ",", "None", ")", "\n", "", "if", "graph", "is", "None", ":", "\n", "            ", "graph", "=", "self", ".", "_BSMat", "(", "self", ".", "graph_train", ")", ".", "to", "(", "self", ".", "_device", ")", "\n", "", "if", "lbf", "is", "None", ":", "\n", "            ", "lbf", "=", "self", ".", "_BSMat", "(", "self", ".", "label_word", ")", "\n", "", "if", "wts", "is", "None", ":", "\n", "            ", "wts", "=", "self", ".", "embed", ".", "weight", "\n", "", "return", "self", ".", "clf_from_fts", "(", "lbf", ",", "graph", ",", "weights", "=", "wts", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._setup_graph": [[353, 372], ["print", "network.ECLAREt.embed.weight.detach().cpu", "network.ECLAREt._BSMat().cpu", "network.ECLAREt._BSMat().cpu", "range", "numpy.arange", "numpy.arange", "network.ECLAREt.mm", "network.ECLAREt.mm", "network.ECLAREt.lbs_params.append", "network.ECLAREt.lbs_params[].cuda", "network.ECLAREt.lbs_params[].cpu", "network.ECLAREt.embed.weight.detach", "network.ECLAREt._BSMat", "network.ECLAREt._BSMat"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._BSMat", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._BSMat"], ["", "def", "_setup_graph", "(", "self", ",", "to_cuda", "=", "True", ")", ":", "\n", "        ", "if", "self", ".", "fixed_lbs", ":", "\n", "            ", "if", "self", ".", "lbs_params", "is", "None", ":", "\n", "                ", "print", "(", "\"Pre storing word embeddings\"", ")", "\n", "tokens", "=", "self", ".", "embed", ".", "weight", ".", "detach", "(", ")", ".", "cpu", "(", ")", "\n", "lbl_params", "=", "self", ".", "_BSMat", "(", "self", ".", "label_word", ")", ".", "cpu", "(", ")", "\n", "self", ".", "lbs_params", "=", "[", "lbl_params", ".", "mm", "(", "tokens", ")", "]", "\n", "graph", "=", "self", ".", "_BSMat", "(", "self", ".", "graph_train", ")", ".", "cpu", "(", ")", "\n", "for", "_", "in", "range", "(", "1", ",", "self", ".", "degree", ")", ":", "\n", "                    ", "_params", "=", "graph", ".", "mm", "(", "self", ".", "lbs_params", "[", "-", "1", "]", ")", "\n", "self", ".", "lbs_params", ".", "append", "(", "_params", ")", "\n", "\n", "", "", "if", "to_cuda", ":", "\n", "                ", "for", "x", "in", "np", ".", "arange", "(", "self", ".", "degree", ")", ":", "\n", "                    ", "self", ".", "lbs_params", "[", "x", "]", "=", "self", ".", "lbs_params", "[", "x", "]", ".", "cuda", "(", ")", "\n", "", "", "else", ":", "\n", "                ", "for", "x", "in", "np", ".", "arange", "(", "self", ".", "degree", ")", ":", "\n", "                    ", "self", ".", "lbs_params", "[", "x", "]", "=", "self", ".", "lbs_params", "[", "x", "]", ".", "cpu", "(", ")", "\n", "", "", "", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._sparse_matrix": [[373, 377], ["network.ECLAREt._load_lblft", "network.ECLAREt._load_graph", "network.ECLAREt._load_graph"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._load_lblft", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._load_graph", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._load_graph"], ["", "def", "_sparse_matrix", "(", "self", ",", "params", ")", ":", "\n", "        ", "self", ".", "label_word", "=", "self", ".", "_load_lblft", "(", "params", ",", "True", ")", "\n", "self", ".", "graph_train", "=", "self", ".", "_load_graph", "(", "params", ",", "True", ")", "\n", "self", ".", "graph_pred", "=", "self", ".", "_load_graph", "(", "params", ",", "True", ",", "False", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREt._init_": [[378, 384], ["network.ECLAREt.embed._init_", "network.ECLAREt.clf_from_fts._init_", "network.ECLAREt._BSMat().cpu", "network.ECLAREt._BSMat().cpu", "network.ECLAREt.clf_from_wts._init_", "network.ECLAREt._BSMat", "network.ECLAREt._BSMat"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._init_", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._init_", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._init_", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._BSMat", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._BSMat"], ["", "def", "_init_", "(", "self", ",", "words", ",", "clf", ")", ":", "\n", "        ", "self", ".", "embed", ".", "_init_", "(", "words", ")", "\n", "self", ".", "clf_from_fts", ".", "_init_", "(", "clf", ")", "\n", "_label_wrds", "=", "self", ".", "_BSMat", "(", "self", ".", "label_word", ")", ".", "cpu", "(", ")", "\n", "_label_gph", "=", "self", ".", "_BSMat", "(", "self", ".", "graph_train", ")", ".", "cpu", "(", ")", "\n", "self", ".", "clf_from_wts", ".", "_init_", "(", "clf", ",", "_label_wrds", ",", "_label_gph", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.custom_embeddings.CustomEmbedding.__init__": [[11, 39], ["super().__init__", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "torch.device", "torch.device", "torch.device", "torch.device", "custom_embeddings.CustomEmbedding.reset_parameters", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine.reset_parameters"], ["def", "__init__", "(", "self", ",", "num_embeddings", ",", "embedding_dim", ",", "padding_idx", "=", "None", ",", "\n", "max_norm", "=", "None", ",", "norm_type", "=", "2", ",", "scale_grad_by_freq", "=", "False", ",", "\n", "sparse", "=", "False", ",", "device", "=", "\"cuda:0\"", ")", ":", "\n", "        ", "\"\"\"\n            Args:\n                num_embeddings: int: vocalubary size\n                embedding_dim: int: dimension for embeddings\n                padding_idx: int: index for <PAD>; embedding is not updated\n                max_norm: \n                norm_type: int: default: 2\n                scale_grad_by_freq: boolean: True/False\n                sparse: boolean: sparse or dense gradients\n        \"\"\"", "\n", "super", "(", "CustomEmbedding", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "num_embeddings", "=", "num_embeddings", "\n", "self", ".", "embedding_dim", "=", "embedding_dim", "\n", "self", ".", "padding_idx", "=", "padding_idx", "\n", "_offset", "=", "0", "\n", "if", "self", ".", "padding_idx", "is", "not", "None", ":", "\n", "            ", "_offset", "=", "1", "\n", "", "self", ".", "max_norm", "=", "max_norm", "\n", "self", ".", "norm_type", "=", "norm_type", "\n", "self", ".", "scale_grad_by_freq", "=", "scale_grad_by_freq", "\n", "self", ".", "weight", "=", "Parameter", "(", "torch", ".", "Tensor", "(", "\n", "num_embeddings", "+", "_offset", ",", "embedding_dim", ")", ")", "\n", "self", ".", "sparse", "=", "sparse", "\n", "self", ".", "device", "=", "torch", ".", "device", "(", "device", ")", "\n", "self", ".", "reset_parameters", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.custom_embeddings.CustomEmbedding.reset_parameters": [[40, 47], ["torch.nn.init.kaiming_uniform_", "torch.nn.init.kaiming_uniform_", "torch.nn.init.kaiming_uniform_", "torch.nn.init.kaiming_uniform_", "custom_embeddings.CustomEmbedding.weight.data[].fill_"], "methods", ["None"], ["", "def", "reset_parameters", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n            Reset weights\n        \"\"\"", "\n", "torch", ".", "nn", ".", "init", ".", "kaiming_uniform_", "(", "self", ".", "weight", ")", "\n", "if", "self", ".", "padding_idx", "is", "not", "None", ":", "\n", "            ", "self", ".", "weight", ".", "data", "[", "self", ".", "padding_idx", "]", ".", "fill_", "(", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.custom_embeddings.CustomEmbedding.to": [[48, 53], ["super().to", "element.to"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to"], ["", "", "def", "to", "(", "self", ",", "element", "=", "None", ")", ":", "\n", "        ", "if", "element", "is", "None", ":", "\n", "            ", "super", "(", ")", ".", "to", "(", "self", ".", "device", ")", "\n", "", "else", ":", "\n", "            ", "return", "element", ".", "to", "(", "self", ".", "device", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.custom_embeddings.CustomEmbedding.forward": [[54, 69], ["torch.embedding_bag", "torch.embedding_bag", "custom_embeddings.CustomEmbedding.to", "custom_embeddings.CustomEmbedding.to", "custom_embeddings.CustomEmbedding.to"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to"], ["", "", "def", "forward", "(", "self", ",", "X", ",", "_div", "=", "False", ")", ":", "\n", "        ", "\"\"\"\n            Forward pass for embedding layer\n            Args:\n                features: dt.TLong: (batch_size, max_features_in_a_batch)\n                weights: torch.Tensor: (batch_size, max_features_in_a_batch)\n                _div: boolean: weighted sum or weighted average.\n            Returns:\n                out: torch.Tensor: embedding for each sample (batch_size, embedding_dims)\n        \"\"\"", "\n", "out", "=", "F", ".", "embedding_bag", "(", "self", ".", "to", "(", "X", "[", "'X_ind'", "]", ")", ",", "self", ".", "weight", ",", "self", ".", "to", "(", "X", "[", "'X_ptr'", "]", ")", ",", "\n", "self", ".", "max_norm", ",", "self", ".", "norm_type", ",", "\n", "self", ".", "scale_grad_by_freq", ",", "'sum'", ",", "self", ".", "sparse", ",", "\n", "self", ".", "to", "(", "X", "[", "'X_wts'", "]", ")", ",", "False", ")", "\n", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.custom_embeddings.CustomEmbedding._init_": [[70, 72], ["custom_embeddings.CustomEmbedding.weight.data.copy_"], "methods", ["None"], ["", "def", "_init_", "(", "self", ",", "words", ")", ":", "\n", "        ", "self", ".", "weight", ".", "data", ".", "copy_", "(", "words", "[", "'weight'", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.custom_embeddings.CustomEmbedding.__repr__": [[73, 87], ["s.format"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "s", "=", "'{name}({num_embeddings}, {embedding_dim}, {device}'", "\n", "if", "self", ".", "padding_idx", "is", "not", "None", ":", "\n", "            ", "s", "+=", "', padding_idx={padding_idx}'", "\n", "", "if", "self", ".", "max_norm", "is", "not", "None", ":", "\n", "            ", "s", "+=", "', max_norm={max_norm}'", "\n", "", "if", "self", ".", "norm_type", "!=", "2", ":", "\n", "            ", "s", "+=", "', norm_type={norm_type}'", "\n", "", "if", "self", ".", "scale_grad_by_freq", "is", "not", "False", ":", "\n", "            ", "s", "+=", "', scale_grad_by_freq={scale_grad_by_freq}'", "\n", "", "if", "self", ".", "sparse", "is", "not", "False", ":", "\n", "            ", "s", "+=", "', sparse=True'", "\n", "", "s", "+=", "')'", "\n", "return", "s", ".", "format", "(", "name", "=", "self", ".", "__class__", ".", "__name__", ",", "**", "self", ".", "__dict__", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphConv.__init__": [[17, 36], ["torch.Module.__init__", "numpy.arange", "linear_layer.GraphConv.reset_parameters", "linear_layer.GraphConv.__setattr__", "models.get_functions"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine.reset_parameters", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.get_functions"], ["    ", "def", "__init__", "(", "self", ",", "input_size", ",", "label_features", ",", "padding_idx", "=", "None", ",", "\n", "device", "=", "\"cuda:0\"", ",", "sparse", "=", "False", ",", "name", "=", "None", ",", "degree", "=", "2", ",", "\n", "bias", "=", "False", ",", "graph_layer", "=", "\"\"", ",", "reduction", "=", "'max'", ")", ":", "\n", "        ", "super", "(", "GraphConv", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "device", "=", "device", "\n", "if", "name", "is", "not", "None", ":", "\n", "            ", "self", ".", "name", "=", "name", "\n", "", "else", ":", "\n", "            ", "self", ".", "name", "=", "self", ".", "__class__", ".", "__name__", "\n", "", "self", ".", "input_size", "=", "input_size", "\n", "self", ".", "label_features", "=", "label_features", "\n", "self", ".", "sparse", "=", "sparse", "\n", "self", ".", "_bias", "=", "bias", "\n", "self", ".", "padding_idx", "=", "padding_idx", "\n", "self", ".", "graph_layer", "=", "graph_layer", "\n", "self", ".", "degree", "=", "degree", "\n", "for", "idx", "in", "np", ".", "arange", "(", "self", ".", "degree", ")", ":", "\n", "            ", "self", ".", "__setattr__", "(", "'func_%d'", "%", "idx", ",", "tl", ".", "get_functions", "(", "graph_layer", ")", "[", "0", "]", ")", "\n", "", "self", ".", "reset_parameters", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphConv._learn": [[37, 44], ["labels_fts.mm", "numpy.arange", "graph_lbl.mm", "order_p.append"], "methods", ["None"], ["", "def", "_learn", "(", "self", ",", "labels_fts", ",", "graph_lbl", ",", "weights", ")", ":", "\n", "        ", "Ut", "=", "labels_fts", ".", "mm", "(", "weights", ")", "\n", "order_p", "=", "[", "self", "[", "0", "]", "(", "Ut", ")", "]", "\n", "for", "idx", "in", "np", ".", "arange", "(", "1", ",", "self", ".", "degree", ")", ":", "\n", "            ", "Ut", "=", "graph_lbl", ".", "mm", "(", "Ut", ")", "\n", "order_p", ".", "append", "(", "self", "[", "idx", "]", "(", "Ut", ")", ")", "\n", "", "return", "order_p", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphConv._fixed": [[45, 47], ["list", "map", "numpy.arange"], "methods", ["None"], ["", "def", "_fixed", "(", "self", ",", "fts", ")", ":", "\n", "        ", "return", "list", "(", "map", "(", "lambda", "x", ":", "self", "[", "x", "]", "(", "fts", "[", "x", "]", ")", ",", "np", ".", "arange", "(", "self", ".", "degree", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphConv.forward": [[48, 53], ["linear_layer.GraphConv._fixed", "linear_layer.GraphConv._learn"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphConv._fixed", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphConv._learn"], ["", "def", "forward", "(", "self", ",", "labels_fts", ",", "graph_lbl", ",", "weights", "=", "None", ")", ":", "\n", "        ", "if", "weights", "is", "None", ":", "\n", "            ", "return", "self", ".", "_fixed", "(", "labels_fts", ")", "\n", "", "else", ":", "\n", "            ", "return", "self", ".", "_learn", "(", "labels_fts", ",", "graph_lbl", ",", "weights", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphConv.to": [[54, 58], ["super().to"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to"], ["", "", "def", "to", "(", "self", ")", ":", "\n", "        ", "\"\"\"Transfer to device\n        \"\"\"", "\n", "super", "(", ")", ".", "to", "(", "self", ".", "device", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphConv.reset_parameters": [[59, 63], ["None"], "methods", ["None"], ["", "def", "reset_parameters", "(", "self", ")", ":", "\n", "        ", "\"\"\"Initialize vectors\n        \"\"\"", "\n", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphConv.extra_repr": [[64, 67], ["s.format"], "methods", ["None"], ["", "def", "extra_repr", "(", "self", ")", ":", "\n", "        ", "s", "=", "\"input={input_size}, output={label_features}, sparse={sparse}\"", "\n", "return", "s", ".", "format", "(", "**", "self", ".", "__dict__", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphConv.stats": [[68, 76], ["numpy.arange", "s.append", "linear_layer.add_intend"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.add_intend"], ["", "@", "property", "\n", "def", "stats", "(", "self", ")", ":", "\n", "        ", "name", "=", "self", ".", "name", "\n", "s", "=", "[", "]", "\n", "for", "idx", "in", "np", ".", "arange", "(", "self", ".", "degree", ")", ":", "\n", "            ", "s", ".", "append", "(", "add_intend", "(", "\"a(%d) = %s\"", "%", "(", "idx", ",", "self", "[", "idx", "]", ".", "stats", ")", ")", ")", "\n", "", "s", "=", "\"{}:(\\n{})\"", ".", "format", "(", "name", ",", "''", ".", "join", "(", "s", ")", ")", "\n", "return", "s", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphConv._init_": [[77, 79], ["None"], "methods", ["None"], ["", "def", "_init_", "(", "self", ",", "words", ")", ":", "\n", "        ", "pass", "\n", "# if self.weight is not None:", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphConv.__getitem__": [[82, 84], ["linear_layer.GraphConv.__getattr__"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.Transform.__getattr__"], ["", "def", "__getitem__", "(", "self", ",", "idx", ")", ":", "\n", "        ", "return", "self", ".", "__getattr__", "(", "'func_%d'", "%", "idx", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine.__init__": [[87, 121], ["torch.Module.__init__", "models.spectral_attention", "linear_layer.GraphCombine.reset_parameters", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "linear_layer.GraphCombine.register_parameter", "linear_layer.GraphCombine.register_parameter", "linear_layer.GraphCombine.register_parameter", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine.reset_parameters"], ["    ", "def", "__init__", "(", "self", ",", "input_size", ",", "output_size", ",", "bias", "=", "True", ",", "reduction", "=", "'max'", ",", "\n", "use_classifier_wts", "=", "False", ",", "padding_idx", "=", "None", ",", "name", "=", "'Linear'", ",", "\n", "device", "=", "\"cuda:0\"", ",", "sparse", "=", "False", ",", "degree", "=", "1", ")", ":", "\n", "        ", "super", "(", "GraphCombine", ",", "self", ")", ".", "__init__", "(", ")", "\n", "if", "name", "is", "not", "None", ":", "\n", "            ", "self", ".", "name", "=", "name", "\n", "", "else", ":", "\n", "            ", "self", ".", "name", "=", "self", ".", "__class__", ".", "__name__", "\n", "", "self", ".", "device", "=", "device", "# Useful in case of multiple GPUs", "\n", "self", ".", "input_size", "=", "input_size", "\n", "self", ".", "output_size", "=", "output_size", "\n", "self", ".", "use_classifier_wts", "=", "use_classifier_wts", "\n", "self", ".", "sparse", "=", "sparse", "\n", "self", ".", "padding_idx", "=", "padding_idx", "\n", "self", ".", "weight_decay", "=", "False", "\n", "self", ".", "degree", "=", "degree", "\n", "if", "self", ".", "use_classifier_wts", ":", "\n", "            ", "if", "bias", ":", "\n", "                ", "if", "self", ".", "sparse", ":", "\n", "                    ", "self", ".", "bias", "=", "Parameter", "(", "torch", ".", "Tensor", "(", "self", ".", "output_size", ",", "1", ")", ")", "\n", "", "else", ":", "\n", "                    ", "self", ".", "bias", "=", "Parameter", "(", "torch", ".", "Tensor", "(", "self", ".", "output_size", ")", ")", "\n", "", "", "else", ":", "\n", "                ", "self", ".", "register_parameter", "(", "'bias'", ",", "None", ")", "\n", "", "self", ".", "weight", "=", "Parameter", "(", "torch", ".", "Tensor", "(", "self", ".", "output_size", ",", "\n", "self", ".", "input_size", ")", ")", "\n", "self", ".", "degree", "+=", "1", "\n", "", "else", ":", "\n", "            ", "self", ".", "register_parameter", "(", "'bias'", ",", "None", ")", "\n", "self", ".", "register_parameter", "(", "'weight'", ",", "None", ")", "\n", "", "self", ".", "pre_build", "=", "[", "None", ",", "None", "]", "\n", "self", ".", "attention", "=", "tl", ".", "spectral_attention", "(", "self", ".", "input_size", ",", "self", ".", "degree", ")", "\n", "self", ".", "print", "=", "False", "\n", "self", ".", "reset_parameters", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._get_clf": [[122, 127], ["torch.embedding", "torch.embedding", "torch.embedding"], "methods", ["None"], ["", "def", "_get_clf", "(", "self", ",", "wts", ",", "shorty", "=", "None", ",", "sparse", "=", "True", ",", "padding_idx", "=", "None", ")", ":", "\n", "        ", "if", "shorty", "is", "not", "None", "and", "wts", "is", "not", "None", ":", "\n", "            ", "return", "F", ".", "embedding", "(", "shorty", ",", "wts", ",", "sparse", "=", "sparse", ",", "\n", "padding_idx", "=", "padding_idx", ")", "\n", "", "return", "wts", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._rebuild": [[128, 140], ["torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "linear_layer.GraphCombine.attention", "linear_layer.GraphCombine._get_clf", "linear_layer.GraphCombine.append", "linear_layer.GraphCombine._get_clf"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._get_clf", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._get_clf"], ["", "def", "_rebuild", "(", "self", ",", "lclf", ",", "shorty", "=", "None", ")", ":", "\n", "        ", "if", "self", ".", "pre_build", "[", "0", "]", "is", "None", ":", "\n", "            ", "if", "self", ".", "use_classifier_wts", ":", "\n", "                ", "lclf", ".", "append", "(", "self", ".", "_get_clf", "(", "self", ".", "weight", ",", "shorty", ",", "\n", "True", ",", "self", ".", "padding_idx", ")", ")", "\n", "\n", "", "lclf", "=", "torch", ".", "stack", "(", "lclf", ",", "dim", "=", "1", ")", "\n", "lclf", "=", "self", ".", "attention", "(", "lclf", ",", "self", ".", "print", ")", "\n", "bias", "=", "self", ".", "_get_clf", "(", "self", ".", "bias", ",", "shorty", ",", "True", ",", "self", ".", "padding_idx", ")", "\n", "", "else", ":", "\n", "            ", "lclf", ",", "bias", "=", "self", ".", "pre_build", "\n", "", "return", "lclf", ",", "bias", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine.forward": [[141, 153], ["linear_layer.GraphCombine._rebuild", "linear_layer.GraphCombine._get_clf", "input.unsqueeze.unsqueeze.unsqueeze", "input.unsqueeze.unsqueeze.bmm().squeeze", "input.unsqueeze.bmm().squeeze.squeeze", "torch.linear", "torch.linear", "torch.linear", "linear_layer.GraphCombine._get_clf().squeeze", "input.unsqueeze.unsqueeze.bmm", "linear_layer.GraphCombine.permute", "linear_layer.GraphCombine._get_clf"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._rebuild", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._get_clf", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._get_clf"], ["", "def", "forward", "(", "self", ",", "input", ",", "lbl_ft", ",", "shorty", "=", "None", ",", "shorty_f", "=", "None", ")", ":", "\n", "        ", "lclf", ",", "bias", "=", "self", ".", "_rebuild", "(", "lbl_ft", ",", "shorty_f", ")", "\n", "if", "shorty", "is", "not", "None", ":", "\n", "            ", "lclf", "=", "self", ".", "_get_clf", "(", "lclf", ",", "shorty", ",", "sparse", "=", "False", ")", "\n", "input", "=", "input", ".", "unsqueeze", "(", "1", ")", "\n", "out", "=", "input", ".", "bmm", "(", "lclf", ".", "permute", "(", "0", ",", "2", ",", "1", ")", ")", ".", "squeeze", "(", ")", "\n", "if", "bias", "is", "not", "None", ":", "\n", "                ", "bias", "=", "self", ".", "_get_clf", "(", "bias", ",", "shorty", ",", "sparse", "=", "False", ")", ".", "squeeze", "(", ")", "\n", "out", "+=", "bias", "\n", "", "return", "out", ".", "squeeze", "(", ")", "\n", "", "else", ":", "\n", "            ", "return", "F", ".", "linear", "(", "input", ",", "lclf", ",", "bias", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._setup": [[154, 161], ["linear_layer.GraphCombine._rebuild"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._rebuild"], ["", "", "def", "_setup", "(", "self", ",", "lbl_ft", ")", ":", "\n", "        ", "self", ".", "print", "=", "True", "\n", "lclf", ",", "bias", "=", "self", ".", "_rebuild", "(", "lbl_ft", ",", "None", ")", "\n", "if", "bias", "is", "not", "None", ":", "\n", "            ", "bias", "=", "bias", "+", "0", "\n", "", "self", ".", "pre_build", "=", "[", "lclf", ",", "bias", "]", "\n", "self", ".", "print", "=", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine.to": [[162, 170], ["super().to", "linear_layer.GraphCombine.pre_build[].to", "linear_layer.GraphCombine.pre_build[].to"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to"], ["", "def", "to", "(", "self", ")", ":", "\n", "        ", "\"\"\"Transfer to device\n        \"\"\"", "\n", "if", "self", ".", "pre_build", "[", "0", "]", "is", "not", "None", ":", "\n", "            ", "self", ".", "pre_build", "[", "0", "]", "=", "self", ".", "pre_build", "[", "0", "]", ".", "to", "(", "self", ".", "device", ")", "\n", "", "if", "self", ".", "pre_build", "[", "1", "]", "is", "not", "None", ":", "\n", "            ", "self", ".", "pre_build", "[", "1", "]", "=", "self", ".", "pre_build", "[", "1", "]", ".", "to", "(", "self", ".", "device", ")", "\n", "", "super", "(", ")", ".", "to", "(", "self", ".", "device", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine.cpu": [[171, 177], ["super().cpu", "linear_layer.GraphCombine.pre_build[].cpu", "linear_layer.GraphCombine.pre_build[].cpu"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu"], ["", "def", "cpu", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "pre_build", "[", "0", "]", "is", "not", "None", ":", "\n", "            ", "self", ".", "pre_build", "[", "0", "]", "=", "self", ".", "pre_build", "[", "0", "]", ".", "cpu", "(", ")", "\n", "", "if", "self", ".", "pre_build", "[", "1", "]", "is", "not", "None", ":", "\n", "            ", "self", ".", "pre_build", "[", "1", "]", "=", "self", ".", "pre_build", "[", "1", "]", ".", "cpu", "(", ")", "\n", "", "return", "super", "(", ")", ".", "cpu", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine.reset_parameters": [[178, 187], ["math.sqrt", "linear_layer.GraphCombine.weight.data.uniform_", "linear_layer.GraphCombine.bias.data.fill_"], "methods", ["None"], ["", "def", "reset_parameters", "(", "self", ")", ":", "\n", "        ", "\"\"\"Initialize vectors\n        \"\"\"", "\n", "stdv", "=", "1.", "/", "math", ".", "sqrt", "(", "self", ".", "input_size", ")", "\n", "if", "self", ".", "weight", "is", "not", "None", ":", "\n", "            ", "self", ".", "weight", ".", "data", ".", "uniform_", "(", "-", "stdv", ",", "stdv", ")", "\n", "\n", "", "if", "self", ".", "bias", "is", "not", "None", ":", "\n", "            ", "self", ".", "bias", ".", "data", ".", "fill_", "(", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine.get_wts": [[188, 197], ["linear_layer.GraphCombine.bias.detach().cpu().numpy", "linear_layer.GraphCombine.weight.detach().cpu().numpy", "linear_layer.GraphCombine.bias.detach().cpu", "linear_layer.GraphCombine.weight.detach().cpu", "linear_layer.GraphCombine.bias.detach", "linear_layer.GraphCombine.weight.detach"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu"], ["", "", "def", "get_wts", "(", "self", ")", ":", "\n", "        ", "\"\"\"Get wts as dictionary\n        \"\"\"", "\n", "parameters", "=", "{", "}", "\n", "if", "self", ".", "bias", "is", "not", "None", ":", "\n", "            ", "parameters", "[", "'bias'", "]", "=", "self", ".", "bias", ".", "detach", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "", "if", "self", ".", "use_classifier_wts", ":", "\n", "            ", "parameters", "[", "'weight'", "]", "=", "self", ".", "weight", ".", "detach", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "", "return", "parameters", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine.extra_repr": [[198, 204], ["s.format", "str"], "methods", ["None"], ["", "def", "extra_repr", "(", "self", ")", ":", "\n", "        ", "s", "=", "\"output_size={output_size}, sparse={sparse}\"", "\n", "if", "self", ".", "use_classifier_wts", ":", "\n", "            ", "s", "+=", "\", bias={}\"", ".", "format", "(", "str", "(", "self", ".", "bias", "is", "not", "None", ")", ")", "\n", "s", "+=", "\", weight={}\"", ".", "format", "(", "(", "self", ".", "input_size", ",", "self", ".", "output_size", ")", ")", "\n", "", "return", "s", ".", "format", "(", "**", "self", ".", "__dict__", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine.stats": [[205, 208], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "stats", "(", "self", ")", ":", "\n", "        ", "return", "\"\"", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine.clean": [[209, 214], ["None"], "methods", ["None"], ["", "def", "clean", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "pre_build", "[", "0", "]", "is", "not", "None", ":", "\n", "            ", "self", ".", "pre_build", "[", "0", "]", "=", "None", "\n", "", "if", "self", ".", "pre_build", "[", "1", "]", "is", "not", "None", ":", "\n", "            ", "self", ".", "pre_build", "[", "1", "]", "=", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._init_": [[215, 224], ["print", "words[].cpu", "lbl_wrds.mm", "numpy.arange", "linear_layer.GraphCombine.weight.data.copy_", "print", "graph.mm"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu"], ["", "", "def", "_init_", "(", "self", ",", "words", ",", "lbl_wrds", ",", "graph", ")", ":", "\n", "        ", "if", "self", ".", "use_classifier_wts", ":", "\n", "            ", "print", "(", "\"Initializing with precomputed features\"", ")", "\n", "embeddings", "=", "words", "[", "'weight'", "]", ".", "cpu", "(", ")", "\n", "v0", "=", "lbl_wrds", ".", "mm", "(", "embeddings", ")", "\n", "for", "i", "in", "np", ".", "arange", "(", "self", ".", "degree", "-", "2", ")", ":", "\n", "                ", "print", "(", "\"graph:\"", ",", "i", ")", "\n", "v0", "=", "graph", ".", "mm", "(", "v0", ")", "\n", "", "self", ".", "weight", ".", "data", ".", "copy_", "(", "v0", ")", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.add_intend": [[10, 14], ["str.split", "list", "map"], "function", ["None"], ["def", "add_intend", "(", "str", ",", "num_intend", "=", "1", ")", ":", "\n", "    ", "_s", "=", "str", ".", "split", "(", "\"\\n\"", ")", "\n", "_s", "=", "_s", "[", "0", "]", "+", "\"\\n\"", "+", "\"\\n\"", ".", "join", "(", "list", "(", "map", "(", "lambda", "x", ":", "\"\\t\"", "+", "x", ",", "_s", "[", "1", ":", "]", ")", ")", ")", "\n", "return", "_s", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.scaled_spectral.__init__": [[10, 16], ["torch.Module.__init__", "torch.utils.spectral_norm", "torch.utils.spectral_norm", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "transform_layer.scaled_spectral.k.data.fill_", "transform_layer.scaled_spectral.init", "torch.Linear", "torch.Linear", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.spectral_attention.init"], ["    ", "def", "__init__", "(", "self", ",", "hidd_dims", ",", "k", "=", "1", ")", ":", "\n", "        ", "super", "(", "scaled_spectral", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "layer", "=", "nn", ".", "utils", ".", "spectral_norm", "(", "nn", ".", "Linear", "(", "hidd_dims", ",", "hidd_dims", ")", ")", "\n", "self", ".", "k", "=", "Parameter", "(", "torch", ".", "Tensor", "(", "1", ",", "1", ")", ")", "\n", "self", ".", "k", ".", "data", ".", "fill_", "(", "k", ")", "\n", "self", ".", "init", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.scaled_spectral.forward": [[17, 19], ["transform_layer.scaled_spectral.layer"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "input", ")", ":", "\n", "        ", "return", "self", ".", "k", "*", "self", ".", "layer", "(", "input", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.scaled_spectral.extra_repr": [[20, 22], ["transform_layer.scaled_spectral.k.data.numpy"], "methods", ["None"], ["", "def", "extra_repr", "(", "self", ")", ":", "\n", "        ", "return", "\"spectral_radius = {}\"", ".", "format", "(", "self", ".", "k", ".", "data", ".", "numpy", "(", ")", ".", "shape", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.scaled_spectral.stats": [[23, 26], ["transform_layer.scaled_spectral.k.detach().cpu().numpy", "transform_layer.scaled_spectral.k.detach().cpu", "transform_layer.scaled_spectral.k.detach"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu"], ["", "@", "property", "\n", "def", "stats", "(", "self", ")", ":", "\n", "        ", "return", "\"%f\"", "%", "(", "self", ".", "k", ".", "detach", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "[", "0", ",", "0", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.scaled_spectral.init": [[27, 30], ["torch.init.eye_", "torch.init.eye_", "torch.init.constant_", "torch.init.constant_"], "methods", ["None"], ["", "def", "init", "(", "self", ")", ":", "\n", "        ", "nn", ".", "init", ".", "eye_", "(", "self", ".", "layer", ".", "weight", ")", "\n", "nn", ".", "init", ".", "constant_", "(", "self", ".", "layer", ".", "bias", ",", "0.0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.spectral_attention.__init__": [[33, 41], ["torch.Module.__init__", "torch.Dropout", "torch.Dropout", "torch.utils.spectral_norm", "torch.utils.spectral_norm", "torch.utils.spectral_norm", "torch.utils.spectral_norm", "torch.ReLU", "torch.ReLU", "torch.Softmax", "torch.Softmax", "transform_layer.spectral_attention.init", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.spectral_attention.init"], ["    ", "def", "__init__", "(", "self", ",", "input_dims", ",", "degree", ",", "norm", "=", "\"softmax\"", ")", ":", "\n", "        ", "super", "(", "spectral_attention", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "drop", "=", "nn", ".", "Dropout", "(", "p", "=", "0.2", ")", "\n", "self", ".", "trans", "=", "nn", ".", "utils", ".", "spectral_norm", "(", "nn", ".", "Linear", "(", "input_dims", ",", "input_dims", ",", "True", ")", ")", "\n", "self", ".", "layer", "=", "nn", ".", "utils", ".", "spectral_norm", "(", "nn", ".", "Linear", "(", "input_dims", "*", "degree", ",", "degree", ",", "False", ")", ")", "\n", "self", ".", "nl", "=", "nn", ".", "ReLU", "(", ")", "\n", "self", ".", "softmax", "=", "nn", ".", "Softmax", "(", "dim", "=", "1", ")", "\n", "self", ".", "init", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.spectral_attention.attented": [[42, 58], ["transform_layer.spectral_attention.trans", "transform_layer.spectral_attention.layer", "transform_layer.spectral_attention.softmax", "transform_layer.spectral_attention.nl", "transform_layer.spectral_attention.flatten", "transform_layer.spectral_attention.squeeze", "transform_layer.spectral_attention.drop"], "methods", ["None"], ["", "def", "attented", "(", "self", ",", "input", ",", "debug", "=", "False", ")", ":", "\n", "        ", "_input", "=", "self", ".", "trans", "(", "self", ".", "nl", "(", "self", ".", "drop", "(", "input", ")", ")", ")", "\n", "logits", "=", "self", ".", "layer", "(", "_input", ".", "flatten", "(", "start_dim", "=", "1", ")", ")", "\n", "attn_wts", "=", "self", ".", "softmax", "(", "logits", ".", "squeeze", "(", ")", ")", "\n", "# if debug:", "\n", "#     wts = attn_wts.detach().unsqueeze(1)", "\n", "#     v = wts[:, :,:2].bmm(input[:,:2,:]).squeeze()", "\n", "#     u = wts.bmm(input).squeeze() - v", "\n", "#     print(v.shape, u.shape)", "\n", "#     v = torch.norm(v.detach(), dim=1).squeeze().numpy()", "\n", "#     u = torch.norm(u.detach(), dim=1).squeeze().numpy()", "\n", "#     weights = np.vstack([v, u]).T", "\n", "#     np.save(\"norm.npy\", weights)", "\n", "#     print(np.mean(weights, axis=0))", "\n", "#     print(attn_wts.mean(axis=0).detach().cpu().numpy())", "\n", "return", "attn_wts", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.spectral_attention.forward": [[59, 61], ["transform_layer.spectral_attention.attented().unsqueeze().bmm().squeeze", "transform_layer.spectral_attention.attented().unsqueeze().bmm", "transform_layer.spectral_attention.attented().unsqueeze", "transform_layer.spectral_attention.attented"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.spectral_attention.attented"], ["", "def", "forward", "(", "self", ",", "input", ",", "debug", "=", "False", ")", ":", "\n", "        ", "return", "self", ".", "attented", "(", "input", ",", "debug", ")", ".", "unsqueeze", "(", "1", ")", ".", "bmm", "(", "input", ")", ".", "squeeze", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.spectral_attention.init": [[62, 66], ["torch.init.xavier_uniform_", "torch.init.xavier_uniform_", "torch.init.xavier_uniform_", "torch.init.xavier_uniform_", "transform_layer.spectral_attention.trans.bias.data.fill_"], "methods", ["None"], ["", "def", "init", "(", "self", ")", ":", "\n", "        ", "nn", ".", "init", ".", "xavier_uniform_", "(", "self", ".", "layer", ".", "weight", ")", "\n", "nn", ".", "init", ".", "xavier_uniform_", "(", "self", ".", "trans", ".", "weight", ")", "\n", "self", ".", "trans", ".", "bias", ".", "data", ".", "fill_", "(", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.coff.__init__": [[69, 78], ["torch.Module.__init__", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "transform_layer.coff.k.data.fill_", "torch.Identity", "torch.Identity", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Sigmoid", "torch.Sigmoid", "torch.Tanh", "torch.Tanh"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input_dims", ",", "fill_val", "=", "1", ",", "nl", "=", "None", ")", ":", "\n", "        ", "super", "(", "coff", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "k", "=", "Parameter", "(", "torch", ".", "Tensor", "(", "1", ",", "input_dims", ")", ")", "\n", "self", ".", "k", ".", "data", ".", "fill_", "(", "fill_val", ")", "\n", "self", ".", "nl", "=", "nn", ".", "Identity", "(", ")", "\n", "if", "nl", "==", "\"sigmoid\"", ":", "\n", "            ", "self", ".", "nl", "=", "nn", ".", "Sigmoid", "(", ")", "\n", "", "elif", "nl", "==", "\"tanh\"", ":", "\n", "            ", "self", ".", "nl", "=", "nn", ".", "Tanh", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.coff.forward": [[79, 81], ["transform_layer.coff.nl"], "methods", ["None"], ["", "", "def", "forward", "(", "self", ",", "input", ")", ":", "\n", "        ", "return", "self", ".", "nl", "(", "self", ".", "k", ")", "*", "input", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.coff.extra_repr": [[82, 84], ["transform_layer.coff.nl().data.numpy", "transform_layer.coff.nl"], "methods", ["None"], ["", "def", "extra_repr", "(", "self", ")", ":", "\n", "        ", "return", "\"coff = {}\"", ".", "format", "(", "self", ".", "nl", "(", "self", ".", "k", ")", ".", "data", ".", "numpy", "(", ")", ".", "shape", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.coff.stats": [[85, 88], ["transform_layer.coff.nl().detach().mean().cpu().numpy", "transform_layer.coff.nl().detach().mean().cpu", "transform_layer.coff.nl().detach().mean", "transform_layer.coff.nl().detach", "transform_layer.coff.nl"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu"], ["", "@", "property", "\n", "def", "stats", "(", "self", ")", ":", "\n", "        ", "return", "\"%0.2f\"", "%", "(", "self", ".", "nl", "(", "self", ".", "k", ")", ".", "detach", "(", ")", ".", "mean", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.Rpp.__init__": [[91, 110], ["torch.Module.__init__", "torch.Sequential", "torch.Sequential", "transform_layer.scaled_spectral", "elements.append", "elements.append", "torch.ReLU", "torch.ReLU", "elements.append", "torch.Dropout", "torch.Dropout", "torch.LeakyReLU", "torch.LeakyReLU"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input_size", ",", "output_size", ",", "dropout", ",", "nonLin", "=", "\"r\"", ",", "k", "=", "1", ")", ":", "\n", "        ", "super", "(", "Rpp", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "name", "=", "\"SR\"", "\n", "self", ".", "input_size", "=", "input_size", "\n", "self", ".", "output_size", "=", "output_size", "\n", "self", ".", "dropout", "=", "dropout", "\n", "self", ".", "nonLin", "=", "nonLin", "\n", "self", ".", "padding_size", "=", "self", ".", "output_size", "-", "self", ".", "input_size", "\n", "elements", "=", "[", "]", "\n", "if", "self", ".", "nonLin", "==", "'r'", ":", "\n", "            ", "elements", ".", "append", "(", "nn", ".", "ReLU", "(", ")", ")", "\n", "", "elif", "self", ".", "nonLin", "==", "'lr'", ":", "\n", "            ", "elements", ".", "append", "(", "nn", ".", "LeakyReLU", "(", ")", ")", "\n", "", "else", ":", "\n", "            ", "pass", "\n", "", "if", "dropout", ">", "0.0", ":", "\n", "            ", "elements", ".", "append", "(", "nn", ".", "Dropout", "(", "p", "=", "dropout", ")", ")", "\n", "", "self", ".", "nonLin", "=", "nn", ".", "Sequential", "(", "*", "elements", ")", "\n", "self", ".", "scaling", "=", "scaled_spectral", "(", "self", ".", "input_size", ",", "k", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.Rpp.forward": [[111, 113], ["transform_layer.Rpp.scaling", "transform_layer.Rpp.nonLin"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "embed", ")", ":", "\n", "        ", "return", "self", ".", "scaling", "(", "self", ".", "nonLin", "(", "embed", ")", ")", "+", "embed", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.Rpp.stats": [[114, 119], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "stats", "(", "self", ")", ":", "\n", "        ", "name", "=", "self", ".", "name", "\n", "s", "=", "\"{}(K={})\"", ".", "format", "(", "name", ",", "self", ".", "scaling", ".", "stats", ")", "\n", "return", "s", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.CRpp.__init__": [[122, 127], ["transform_layer.Rpp.__init__", "transform_layer.coff"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input_size", ",", "output_size", ",", "dropout", ",", "nonLin", "=", "\"r\"", ",", "\n", "k", "=", "1", ",", "non_linearity", "=", "\"sigmoid\"", ",", "fill_val", "=", "0", ")", ":", "\n", "        ", "super", "(", "CRpp", ",", "self", ")", ".", "__init__", "(", "input_size", ",", "output_size", ",", "\n", "dropout", ",", "nonLin", ",", "k", ")", "\n", "self", ".", "a", "=", "coff", "(", "input_size", ",", "fill_val", ",", "non_linearity", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.CRpp.forward": [[128, 130], ["transform_layer.CRpp.a", "transform_layer.Rpp.forward"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.forward"], ["", "def", "forward", "(", "self", ",", "embed", ")", ":", "\n", "        ", "return", "self", ".", "a", "(", "super", "(", "CRpp", ",", "self", ")", ".", "forward", "(", "embed", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.CRpp.stats": [[131, 137], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "stats", "(", "self", ")", ":", "\n", "        ", "name", "=", "self", ".", "name", "\n", "s", "=", "\"{}(A={}, K={})\"", ".", "format", "(", "\n", "name", ",", "self", ".", "a", ".", "stats", ",", "self", ".", "scaling", ".", "stats", ")", "\n", "return", "s", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.Transform.__init__": [[158, 162], ["torch.Module.__init__", "torch.Sequential", "torch.Sequential"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__"], ["def", "__init__", "(", "self", ",", "modules", ",", "device", "=", "\"cuda:0\"", ")", ":", "\n", "        ", "super", "(", "Transform", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "device", "=", "device", "\n", "self", ".", "transform", "=", "nn", ".", "Sequential", "(", "*", "modules", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.Transform.forward": [[163, 172], ["transform_layer.Transform.transform"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "embed", ")", ":", "\n", "        ", "\"\"\"\n            Forward pass for transform layer\n            Args:\n                embed: torch.Tensor: document representation\n            Returns:\n                embed: torch.Tensor: transformed document representation\n        \"\"\"", "\n", "return", "self", ".", "transform", "(", "embed", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.Transform.to": [[173, 175], ["super().to"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to"], ["", "def", "to", "(", "self", ")", ":", "\n", "        ", "super", "(", ")", ".", "to", "(", "self", ".", "device", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.Transform.__getattr__": [[176, 186], ["AttributeError", "super().__getattr__", "super().__getattr__", "module.__getattribute__", "module.__getattr__"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.Transform.__getattr__", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.Transform.__getattr__", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.Transform.__getattr__"], ["", "def", "__getattr__", "(", "self", ",", "attr", ")", ":", "\n", "        ", "try", ":", "\n", "            ", "return", "super", "(", ")", ".", "__getattr__", "(", "attr", ")", "\n", "", "except", "AttributeError", ":", "\n", "            ", "for", "module", "in", "super", "(", ")", ".", "__getattr__", "(", "'transform'", ")", ":", "\n", "                ", "try", ":", "\n", "                    ", "return", "module", ".", "__getattribute__", "(", "attr", ")", "\n", "", "except", "AttributeError", ":", "\n", "                    ", "return", "module", ".", "__getattr__", "(", "attr", ")", "\n", "", "", "", "raise", "AttributeError", "(", "\"{} not found\"", ".", "format", "(", "attr", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.transform_layer.get_functions": [[187, 189], ["list", "map"], "function", ["None"], ["", "", "def", "get_functions", "(", "obj", ",", "params", "=", "None", ")", ":", "\n", "    ", "return", "list", "(", "map", "(", "lambda", "x", ":", "elements", "[", "x", "]", "(", "**", "obj", "[", "x", "]", ")", ",", "obj", "[", "'order'", "]", ")", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.__init__": [[21, 35], ["torch.Module.__init__", "extreme_classifier.ECLAREBase._load_lblft", "extreme_classifier.ECLAREBase._load_graph", "libs.tree.build_tree", "torch.Sequential", "torch.Sequential", "torch.Sequential"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._load_lblft", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._load_graph"], ["    ", "def", "__init__", "(", "self", ",", "params", ")", ":", "\n", "        ", "super", "(", "ECLAREBase", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "params", "=", "params", "\n", "self", ".", "lblft_npz", "=", "self", ".", "_load_lblft", "(", "params", ")", "\n", "self", ".", "graph_npz", "=", "self", ".", "_load_graph", "(", "params", ")", "\n", "self", ".", "Xs", "=", "None", "\n", "self", ".", "degree", "=", "params", ".", "degree", "\n", "self", ".", "tree", "=", "Tree", "(", "b_factors", "=", "params", ".", "b_factors", ",", "\n", "method", "=", "params", ".", "cluster_method", ",", "\n", "leaf_size", "=", "params", ".", "num_labels", ",", "\n", "force_shallow", "=", "params", ".", "force_shallow", ")", "\n", "self", ".", "m_size", "=", "0", "\n", "self", ".", "depth", "=", "-", "1", "\n", "self", ".", "depth_node", "=", "nn", ".", "Sequential", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._load_lblft": [[36, 48], ["numpy.loadtxt", "numpy.loadtxt", "os.path.join", "scipy.lil_matrix", "scipy.hstack().tocsr", "sklearn.preprocessing.normalize", "sklearn.preprocessing.normalize.sort_indices", "sklearn.preprocessing.normalize.tocsr", "du.read_sparse_file", "sklearn.preprocessing.normalize.tocsc", "scipy.hstack"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.normalize"], ["", "def", "_load_lblft", "(", "self", ",", "params", ")", ":", "\n", "        ", "v_lbl", "=", "np", ".", "loadtxt", "(", "params", ".", "label_indices", ",", "dtype", "=", "np", ".", "int", ")", "\n", "label_features", "=", "np", ".", "loadtxt", "(", "params", ".", "v_lbl_fts", ",", "dtype", "=", "np", ".", "int", ")", "\n", "label_word", "=", "os", ".", "path", ".", "join", "(", "\n", "params", ".", "data_dir", ",", "params", ".", "dataset", ",", "params", ".", "label_words", ")", "\n", "label_word", "=", "du", ".", "read_sparse_file", "(", "label_word", ")", "[", "v_lbl", "]", "\n", "label_word", "=", "label_word", ".", "tocsc", "(", ")", "[", ":", ",", "label_features", "]", "\n", "padd", "=", "sp", ".", "lil_matrix", "(", "(", "v_lbl", ".", "size", ",", "1", ")", ")", "\n", "label_word", "=", "sp", ".", "hstack", "(", "[", "label_word", ",", "padd", "]", ")", ".", "tocsr", "(", ")", "\n", "label_word", "=", "normalize", "(", "label_word", ",", "norm", "=", "'l2'", ")", "\n", "label_word", ".", "sort_indices", "(", ")", "\n", "return", "label_word", ".", "tocsr", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._load_graph": [[49, 90], ["print", "os.path.join", "os.path.exists", "du.read_sparse_file", "numpy.loadtxt", "numpy.ones", "scipy.diags", "print", "trn_y.dot().tocsr.dot().tocsr.dot().tocsr", "trn_y.dot().tocsr.dot().tocsr.eliminate_zeros", "os.path.exists", "libs.utils.PrunedWalk().simulate", "scipy.save_npz", "scipy.load_npz", "os.path.join", "os.path.join", "trn_y.dot().tocsr.dot().tocsr.tocsc", "print", "numpy.asarray", "[].cpu().numpy", "sklearn.preprocessing.normalize", "graph.tocsr.tocsr.tolil", "graph.tocsr.tocsr.tocsr", "os.path.join", "os.path.join", "numpy.where", "trn_y.dot().tocsr.dot().tocsr.dot", "extreme_classifier.ECLAREBase.lblft_npz.dot", "libs.utils.PrunedWalk", "numpy.ravel", "[].cpu", "trn_y.dot().tocsr.dot().tocsr.sum", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.PrunedWalk.simulate", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.normalize", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load"], ["", "def", "_load_graph", "(", "self", ",", "params", ")", ":", "\n", "        ", "print", "(", "os", ".", "path", ".", "join", "(", "params", ".", "model_dir", ",", "params", ".", "graph_name", ")", ")", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "os", ".", "path", ".", "join", "(", "\n", "params", ".", "model_dir", ",", "params", ".", "graph_name", ")", ")", ":", "\n", "            ", "trn_y", "=", "du", ".", "read_sparse_file", "(", "\n", "os", ".", "path", ".", "join", "(", "params", ".", "data_dir", ",", "params", ".", "dataset", ",", "\n", "params", ".", "tr_label_fname", ")", ")", "\n", "valid_lbs", "=", "np", ".", "loadtxt", "(", "params", ".", "label_indices", ",", "dtype", "=", "int", ")", "\n", "trn_y", "=", "trn_y", ".", "tocsc", "(", ")", "[", ":", ",", "valid_lbs", "]", "\n", "\n", "n_lbs", "=", "valid_lbs", ".", "size", "\n", "diag", "=", "np", ".", "ones", "(", "n_lbs", ",", "dtype", "=", "np", ".", "int", ")", "\n", "\n", "if", "params", ".", "verbose", ">", "0", ":", "\n", "                ", "verbose_labels", "=", "np", ".", "where", "(", "\n", "np", ".", "ravel", "(", "trn_y", ".", "sum", "(", "axis", "=", "0", ")", ">", "params", ".", "verbose", ")", ")", "[", "0", "]", "\n", "print", "(", "\"Verbose_labels:\"", ",", "verbose_labels", ".", "size", ")", "\n", "diag", "[", "verbose_labels", "]", "=", "0", "\n", "", "else", ":", "\n", "                ", "verbose_labels", "=", "np", ".", "asarray", "(", "[", "]", ")", "\n", "", "diag", "=", "sp", ".", "diags", "(", "diag", ",", "shape", "=", "(", "n_lbs", ",", "n_lbs", ")", ")", "\n", "print", "(", "\"Avg: labels\"", ",", "trn_y", ".", "nnz", "/", "trn_y", ".", "shape", "[", "0", "]", ")", "\n", "trn_y", "=", "trn_y", ".", "dot", "(", "diag", ")", ".", "tocsr", "(", ")", "\n", "trn_y", ".", "eliminate_zeros", "(", ")", "\n", "yf", "=", "None", "\n", "if", "os", ".", "path", ".", "exists", "(", "params", ".", "embeddings", ")", ":", "\n", "                ", "emb", "=", "torch", ".", "load", "(", "params", ".", "embeddings", ")", "[", "'weight'", "]", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "yf", "=", "normalize", "(", "self", ".", "lblft_npz", ".", "dot", "(", "emb", ")", ")", "\n", "", "graph", "=", "PrunedWalk", "(", "trn_y", ",", "yf", "=", "yf", ")", ".", "simulate", "(", "\n", "params", ".", "walk_len", ",", "params", ".", "p_reset", ",", "\n", "params", ".", "top_k", ",", "max_dist", "=", "params", ".", "prune_max_dist", ")", "\n", "if", "verbose_labels", ".", "size", ">", "0", ":", "\n", "                ", "graph", "=", "graph", ".", "tolil", "(", ")", "\n", "graph", "[", "verbose_labels", ",", "verbose_labels", "]", "=", "1", "\n", "graph", "=", "graph", ".", "tocsr", "(", ")", "\n", "", "sp", ".", "save_npz", "(", "os", ".", "path", ".", "join", "(", "\n", "params", ".", "model_dir", ",", "params", ".", "graph_name", ")", ",", "graph", ")", "\n", "", "else", ":", "\n", "            ", "graph", "=", "sp", ".", "load_npz", "(", "os", ".", "path", ".", "join", "(", "\n", "params", ".", "model_dir", ",", "params", ".", "graph_name", ")", ")", "\n", "", "return", "graph", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.build": [[91, 111], ["libs.utils.normalize_graph", "os.path.exists", "extreme_classifier.ECLAREBase.tree.fit", "extreme_classifier.ECLAREBase._setup", "extreme_classifier.ECLAREBase.save", "extreme_classifier.ECLAREBase.load", "print", "isinstance", "libs.utils.normalize_graph.dot", "scipy.issparse", "sklearn.preprocessing.normalize", "print", "libs.utils.normalize_graph.dot().tocsr", "xclib.utils.sparse.retain_topk().tocsr", "print", "print", "exit", "libs.utils.normalize_graph.dot", "xclib.utils.sparse.retain_topk", "xclib.utils.sparse.retain_topk().tocsr.tocsr"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.normalize_graph", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree.fit", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._setup", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree.save", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.normalize"], ["", "def", "build", "(", "self", ",", "lbl_cnt", "=", "None", ",", "label_idx", "=", "None", ",", "verbose_lbs", "=", "None", ",", "model_dir", "=", "None", ")", ":", "\n", "        ", "n_gph", "=", "normalize_graph", "(", "self", ".", "graph_npz", ")", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "model_dir", "+", "\"/clusters.pkl\"", ")", ":", "\n", "            ", "if", "self", ".", "params", ".", "cluster_method", "==", "'AugParabel'", ":", "\n", "                ", "print", "(", "\"Augmenting graphs\"", ")", "\n", "if", "isinstance", "(", "lbl_cnt", ",", "np", ".", "ndarray", ")", ":", "\n", "                    ", "lbl_cnt", "=", "n_gph", ".", "dot", "(", "normalize", "(", "lbl_cnt", ")", ")", "\n", "", "elif", "sp", ".", "issparse", "(", "lbl_cnt", ")", ":", "\n", "                    ", "print", "(", "\"Avg features\"", ",", "lbl_cnt", ".", "nnz", "/", "lbl_cnt", ".", "shape", "[", "0", "]", ")", "\n", "lbl_cnt", "=", "n_gph", ".", "dot", "(", "lbl_cnt", ")", ".", "tocsr", "(", ")", "\n", "lbl_cnt", "=", "retain_topk", "(", "lbl_cnt", ".", "tocsr", "(", ")", ",", "k", "=", "1000", ")", ".", "tocsr", "(", ")", "\n", "print", "(", "\"Avg features\"", ",", "lbl_cnt", ".", "nnz", "/", "lbl_cnt", ".", "shape", "[", "0", "]", ")", "\n", "", "else", ":", "\n", "                    ", "print", "(", "\"Do not understand the type\"", ")", "\n", "exit", "(", "0", ")", "\n", "", "", "self", ".", "tree", ".", "fit", "(", "label_idx", ",", "verbose_lbs", ",", "lbl_cnt", ")", "\n", "self", ".", "_setup", "(", ")", "\n", "self", ".", "save", "(", "model_dir", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "load", "(", "model_dir", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._setup": [[112, 117], ["extreme_classifier.ECLAREBase.tree.hash_map_array[]._get_hash", "extreme_classifier.ECLAREBase.tree.hash_map_array[]._get_weights"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.hash_map_index._get_hash", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.hash_map_index._get_weights"], ["", "", "def", "_setup", "(", "self", ")", ":", "\n", "        ", "self", ".", "C", "=", "self", ".", "tree", ".", "C", "\n", "self", ".", "height", "=", "self", ".", "tree", ".", "height", "\n", "self", ".", "leaf_hash", "=", "self", ".", "tree", ".", "hash_map_array", "[", "-", "1", "]", ".", "_get_hash", "(", ")", "\n", "self", ".", "leaf_weit", "=", "self", ".", "tree", ".", "hash_map_array", "[", "-", "1", "]", ".", "_get_weights", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._layer": [[118, 127], ["network.ECLAREh", "network.ECLAREt", "network.GraphBase", "print"], "methods", ["None"], ["", "def", "_layer", "(", "self", ",", "params", ",", "model", ")", ":", "\n", "        ", "if", "model", "==", "\"ECLAREh\"", ":", "\n", "            ", "return", "ECLAREh", "(", "params", ")", "\n", "", "elif", "model", "==", "\"ECLAREt\"", ":", "\n", "            ", "return", "ECLAREt", "(", "params", ")", "\n", "", "elif", "model", "==", "\"Base\"", ":", "\n", "            ", "return", "GraphBase", "(", "params", ")", "\n", "", "else", ":", "\n", "            ", "print", "(", "\"{}:Kuch bhi\"", ".", "format", "(", "self", ".", "__class__", ".", "__name__", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._add_layer": [[128, 142], ["extreme_classifier.ECLAREBase.depth_node.parameters", "extreme_classifier.ECLAREBase._layer", "extreme_classifier.ECLAREBase.depth_node.parameters", "params.numel"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._layer"], ["", "", "def", "_add_layer", "(", "self", ",", "depth", ")", ":", "\n", "        ", "hash_map_obj", "=", "self", ".", "tree", ".", "hash_map_array", "[", "depth", "]", "\n", "params", "=", "self", ".", "params", "\n", "params", ".", "num_labels", "=", "hash_map_obj", ".", "size", "\n", "params", ".", "clusters", "=", "hash_map_obj", ".", "clusters", "\n", "params", ".", "prev_cluster", "=", "self", ".", "tree", ".", "hash_map_array", "[", "depth", "-", "1", "]", ".", "clusters", "\n", "params", ".", "label_padding_index", "=", "hash_map_obj", ".", "padding_idx", "\n", "params", ".", "lblft", "=", "self", ".", "lblft_npz", "\n", "params", ".", "graph", "=", "self", ".", "graph_npz", "\n", "for", "_params", "in", "self", ".", "depth_node", ".", "parameters", "(", ")", ":", "\n", "            ", "_params", ".", "requires_grad", "=", "False", "\n", "", "self", ".", "depth_node", "=", "self", ".", "_layer", "(", "params", ",", "params", ".", "layers", "[", "depth", "]", ")", "\n", "for", "params", "in", "self", ".", "depth_node", ".", "parameters", "(", ")", ":", "\n", "            ", "self", ".", "m_size", "+=", "params", ".", "numel", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._get_encoder": [[143, 147], ["extreme_classifier.ECLAREBase._layer", "extreme_classifier.ECLAREBase._init_"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._layer", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._init_"], ["", "", "def", "_get_encoder", "(", "self", ")", ":", "\n", "        ", "encoder", "=", "self", ".", "_layer", "(", "self", ".", "params", ",", "\"Base\"", ")", "\n", "encoder", ".", "_init_", "(", "self", ".", "word_wts", ")", "\n", "return", "encoder", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.scores": [[148, 150], ["extreme_classifier.ECLAREBase.depth_node"], "methods", ["None"], ["", "def", "scores", "(", "self", ",", "batch", ",", "depth", "=", "0", ")", ":", "\n", "        ", "return", "self", ".", "depth_node", "(", "batch", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.forward": [[151, 156], ["extreme_classifier.ECLAREBase.scores"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.scores"], ["", "def", "forward", "(", "self", ",", "batch", ",", "depth", "=", "None", ")", ":", "\n", "        ", "if", "depth", "is", "None", ":", "\n", "            ", "depth", "=", "self", ".", "depth", "\n", "", "scores", "=", "self", ".", "scores", "(", "batch", ",", "depth", "=", "depth", ")", "\n", "return", "scores", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._predict": [[157, 159], ["torch.logsigmoid", "torch.logsigmoid", "torch.logsigmoid", "extreme_classifier.ECLAREBase.depth_node._predict"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._predict"], ["", "def", "_predict", "(", "self", ",", "batch", ")", ":", "\n", "        ", "return", "F", ".", "logsigmoid", "(", "self", ".", "depth_node", ".", "_predict", "(", "batch", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.traverse_graph": [[160, 162], ["extreme_classifier.ECLAREBase.depth_node._traverse"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._traverse"], ["", "def", "traverse_graph", "(", "self", ",", "smat", ",", "depth", "=", "0", ")", ":", "\n", "        ", "return", "self", ".", "depth_node", ".", "_traverse", "(", "smat", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._clusters": [[163, 165], ["extreme_classifier.ECLAREBase.tree._get_cluster_depth"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree._get_cluster_depth"], ["", "def", "_clusters", "(", "self", ",", "depth", "=", "None", ")", ":", "\n", "        ", "return", "self", ".", "tree", ".", "_get_cluster_depth", "(", "depth", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._prep_for_depth": [[166, 174], ["extreme_classifier.ECLAREBase._add_layer", "extreme_classifier.ECLAREBase._call_back", "extreme_classifier.ECLAREBase._initialize_next_layer", "extreme_classifier.ECLAREBase.depth_node._init_"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._add_layer", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREfe._call_back", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREfe._initialize_next_layer", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.linear_layer.GraphCombine._init_"], ["", "def", "_prep_for_depth", "(", "self", ",", "depth", ",", "initialize", "=", "True", ",", "disable_grad", "=", "True", ")", ":", "\n", "        ", "if", "initialize", ":", "\n", "            ", "self", ".", "_initialize_next_layer", "(", "depth", ")", "\n", "", "self", ".", "_add_layer", "(", "depth", ")", "\n", "if", "initialize", ":", "\n", "            ", "self", ".", "depth_node", ".", "_init_", "(", "self", ".", "word_wts", ",", "self", ".", "word_wts", ")", "\n", "", "self", ".", "_call_back", "(", ")", "\n", "self", ".", "depth", "=", "depth", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._build_predict": [[175, 177], ["None"], "methods", ["None"], ["", "def", "_build_predict", "(", "self", ",", "dataloader", ",", "depth", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.eval": [[178, 180], ["extreme_classifier.ECLAREBase.depth_node._eval"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._eval"], ["", "def", "eval", "(", "self", ",", "depth", "=", "None", ")", ":", "\n", "        ", "self", ".", "depth_node", ".", "_eval", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.train": [[181, 185], ["extreme_classifier.ECLAREBase.depth_node.to", "extreme_classifier.ECLAREBase.depth_node._train", "extreme_classifier.ECLAREBase._call_back"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh._train", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREfe._call_back"], ["", "def", "train", "(", "self", ")", ":", "\n", "        ", "self", ".", "depth_node", ".", "to", "(", ")", "\n", "self", ".", "depth_node", ".", "_train", "(", ")", "\n", "self", ".", "_call_back", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.initialize_embeddings": [[186, 188], ["None"], "methods", ["None"], ["", "def", "initialize_embeddings", "(", "self", ",", "weights", ")", ":", "\n", "        ", "self", ".", "word_wts", "=", "weights", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.init_clf_embeddings": [[189, 191], ["None"], "methods", ["None"], ["", "def", "init_clf_embeddings", "(", "self", ",", "weights", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to": [[192, 194], ["extreme_classifier.ECLAREBase.depth_node.to"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to"], ["", "def", "to", "(", "self", ")", ":", "\n", "        ", "self", ".", "depth_node", ".", "to", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu": [[195, 197], ["extreme_classifier.ECLAREBase.depth_node.cpu"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu"], ["", "def", "cpu", "(", "self", ")", ":", "\n", "        ", "self", ".", "depth_node", ".", "cpu", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._call_back": [[198, 200], ["None"], "methods", ["None"], ["", "def", "_call_back", "(", "self", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._initialize_next_layer": [[201, 203], ["None"], "methods", ["None"], ["", "def", "_initialize_next_layer", "(", "self", ",", "depth", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.label_words": [[204, 212], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "label_words", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Designed to be used only with k>1\n        \"\"\"", "\n", "if", "self", ".", "params", ".", "layers", "[", "self", ".", "depth", "]", "in", "[", "\"ECLAREt\"", "]", ":", "\n", "            ", "return", "self", ".", "depth_node", ".", "label_word", "\n", "", "return", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.graph": [[213, 224], ["numpy.arange", "gph.dot.dot.tocsr", "gph.dot.dot.dot"], "methods", ["None"], ["", "@", "property", "\n", "def", "graph", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Designed to be used only with k>1\n        \"\"\"", "\n", "if", "self", ".", "params", ".", "layers", "[", "self", ".", "depth", "]", "in", "[", "\"ECLAREt\"", "]", ":", "\n", "            ", "gph", "=", "self", ".", "depth_node", ".", "graph_pred", "\n", "for", "_", "in", "np", ".", "arange", "(", "1", ",", "self", ".", "degree", "-", "1", ")", ":", "\n", "                ", "gph", "=", "gph", ".", "dot", "(", "gph", ")", "\n", "", "return", "gph", ".", "tocsr", "(", ")", "\n", "", "return", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.model_size": [[225, 228], ["numpy.power"], "methods", ["None"], ["", "@", "property", "\n", "def", "model_size", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "m_size", "*", "4", "/", "np", ".", "power", "(", "2", ",", "20", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.get_weights": [[229, 234], ["range", "extreme_classifier.ECLAREBase.get_weights", "str"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.get_weights"], ["", "def", "get_weights", "(", "self", ")", ":", "\n", "        ", "clf_label_fts", "=", "{", "}", "\n", "for", "depth", "in", "range", "(", "self", ".", "height", ")", ":", "\n", "            ", "clf_label_fts", "[", "str", "(", "depth", ")", "]", "=", "self", "[", "0", "]", ".", "get_weights", "(", ")", "\n", "", "return", "clf_label_fts", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.save": [[235, 238], ["extreme_classifier.ECLAREBase.tree.save"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree.save"], ["", "def", "save", "(", "self", ",", "fname", ")", ":", "\n", "        ", "fname", "=", "fname", "+", "\"/clusters.pkl\"", "\n", "self", ".", "tree", ".", "save", "(", "fname", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.load": [[239, 243], ["extreme_classifier.ECLAREBase.tree.load", "extreme_classifier.ECLAREBase._setup"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._setup"], ["", "def", "load", "(", "self", ",", "fname", ")", ":", "\n", "        ", "fname", "=", "fname", "+", "\"/clusters.pkl\"", "\n", "self", ".", "tree", ".", "load", "(", "fname", ")", "\n", "self", ".", "_setup", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.offset": [[244, 247], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "offset", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "depth_node", ".", "offset", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.isleaf": [[248, 251], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "isleaf", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "depth", "==", "self", ".", "tree", ".", "height", "-", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREpp.__init__": [[256, 258], ["extreme_classifier.ECLAREBase.__init__"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__"], ["def", "__init__", "(", "self", ",", "params", ")", ":", "\n", "        ", "super", "(", "ECLAREpp", ",", "self", ")", ".", "__init__", "(", "params", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREpp._initialize_next_layer": [[259, 263], ["print", "extreme_classifier.ECLAREpp.depth_node.embed.state_dict"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.state_dict"], ["", "def", "_initialize_next_layer", "(", "self", ",", "depth", ")", ":", "\n", "        ", "if", "depth", ">", "0", ":", "\n", "            ", "print", "(", "\"Setting from top layer\"", ")", "\n", "self", ".", "word_wts", "=", "self", ".", "depth_node", ".", "embed", ".", "state_dict", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREfe.__init__": [[268, 270], ["extreme_classifier.ECLAREBase.__init__"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__"], ["def", "__init__", "(", "self", ",", "params", ")", ":", "\n", "        ", "super", "(", "ECLAREfe", ",", "self", ")", ".", "__init__", "(", "params", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREfe._initialize_next_layer": [[271, 273], ["None"], "methods", ["None"], ["", "def", "_initialize_next_layer", "(", "self", ",", "depth", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREfe.build": [[274, 284], ["libs.utils.normalize_graph", "os.path.exists", "extreme_classifier.ECLAREfe.tree.fit", "extreme_classifier.ECLAREfe._setup", "extreme_classifier.ECLAREfe.save", "extreme_classifier.ECLAREfe.load", "sklearn.preprocessing.normalize", "libs.utils.normalize_graph.dot"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.normalize_graph", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree.fit", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._setup", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree.save", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.normalize"], ["", "def", "build", "(", "self", ",", "lbl_cnt", "=", "None", ",", "label_idx", "=", "None", ",", "verbose_lbs", "=", "None", ",", "model_dir", "=", "None", ")", ":", "\n", "        ", "n_gph", "=", "normalize_graph", "(", "self", ".", "graph_npz", ")", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "model_dir", "+", "\"/clusters.pkl\"", ")", ":", "\n", "            ", "if", "self", ".", "params", ".", "cluster_method", "==", "'AugParabel'", ":", "\n", "                ", "lbl_cnt", "=", "normalize", "(", "n_gph", ".", "dot", "(", "lbl_cnt", ")", ")", "\n", "", "self", ".", "tree", ".", "fit", "(", "label_idx", ",", "verbose_lbs", ",", "lbl_cnt", ")", "\n", "self", ".", "_setup", "(", ")", "\n", "self", ".", "save", "(", "model_dir", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "load", "(", "model_dir", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREfe._call_back": [[285, 289], ["print", "extreme_classifier.ECLAREfe.depth_node.embed.parameters"], "methods", ["None"], ["", "", "def", "_call_back", "(", "self", ")", ":", "\n", "        ", "print", "(", "\"Disabling gradients !!\"", ")", "\n", "for", "params", "in", "self", ".", "depth_node", ".", "embed", ".", "parameters", "(", ")", ":", "\n", "            ", "params", ".", "requires_grad", "=", "False", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tracking.Tracking.__init__": [[9, 22], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "checkpoint_history", "=", "3", "\n", "self", ".", "mean_train_loss", "=", "[", "]", "\n", "self", ".", "mean_val_loss", "=", "[", "]", "\n", "self", ".", "saved_models", "=", "[", "]", "\n", "self", ".", "val_precision", "=", "[", "]", "\n", "self", ".", "val_ndcg", "=", "[", "]", "\n", "self", ".", "train_time", "=", "0", "\n", "self", ".", "validation_time", "=", "0", "\n", "self", ".", "shortlist_time", "=", "0", "\n", "self", ".", "saved_checkpoints", "=", "[", "]", "\n", "self", ".", "last_saved_epoch", "=", "-", "1", "\n", "self", ".", "last_epoch", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tracking.Tracking.save": [[23, 25], ["_pickle.dump", "open"], "methods", ["None"], ["", "def", "save", "(", "self", ",", "fname", ")", ":", "\n", "        ", "pickle", ".", "dump", "(", "self", ",", "open", "(", "fname", ",", "'wb'", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tracking.Tracking.load": [[26, 28], ["_pickle.load", "open"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load"], ["", "def", "load", "(", "self", ",", "fname", ")", ":", "\n", "        ", "self", "=", "pickle", ".", "load", "(", "open", "(", "fname", ",", "'rb'", ")", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.parameters.Parameters.__init__": [[14, 18], ["argparse.ArgumentParser", "parameters.Parameters._construct"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.parameters.Parameters._construct"], ["def", "__init__", "(", "self", ",", "description", ")", ":", "\n", "        ", "self", ".", "parser", "=", "argparse", ".", "ArgumentParser", "(", "description", ")", "\n", "self", ".", "params", "=", "None", "\n", "self", ".", "_construct", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.parameters.Parameters._construct": [[19, 85], ["parameters.Parameters.parser.add_argument", "parameters.Parameters.parser.add_argument", "parameters.Parameters.parser.add_argument", "parameters.Parameters.parser.add_argument", "parameters.Parameters.parser.add_argument", "parameters.Parameters.parser.add_argument", "parameters.Parameters.parser.add_argument", "parameters.Parameters.parser.add_argument", "parameters.Parameters.parser.add_argument", "parameters.Parameters.parser.add_argument"], "methods", ["None"], ["", "def", "_construct", "(", "self", ")", ":", "\n", "        ", "self", ".", "parser", ".", "add_argument", "(", "\n", "'--data_dir'", ",", "\n", "dest", "=", "'data_dir'", ",", "\n", "action", "=", "'store'", ",", "\n", "type", "=", "str", ",", "\n", "help", "=", "'path to main data directory'", ")", "\n", "self", ".", "parser", ".", "add_argument", "(", "\n", "'--dataset'", ",", "\n", "dest", "=", "'dataset'", ",", "\n", "action", "=", "'store'", ",", "\n", "type", "=", "str", ",", "\n", "help", "=", "'dataset name'", ")", "\n", "self", ".", "parser", ".", "add_argument", "(", "\n", "'--model_dir'", ",", "\n", "dest", "=", "'model_dir'", ",", "\n", "action", "=", "'store'", ",", "\n", "type", "=", "str", ",", "\n", "help", "=", "'directory to store models'", ")", "\n", "self", ".", "parser", ".", "add_argument", "(", "\n", "'--result_dir'", ",", "\n", "dest", "=", "'result_dir'", ",", "\n", "action", "=", "'store'", ",", "\n", "type", "=", "str", ",", "\n", "help", "=", "'directory to store results'", ")", "\n", "self", ".", "parser", ".", "add_argument", "(", "\n", "'--emb_dir'", ",", "\n", "action", "=", "'store'", ",", "\n", "type", "=", "str", ",", "\n", "default", "=", "\"random\"", ",", "\n", "help", "=", "'directory of word embeddings'", ")", "\n", "self", ".", "parser", ".", "add_argument", "(", "\n", "'--model_fname'", ",", "\n", "dest", "=", "'model_fname'", ",", "\n", "default", "=", "'model'", ",", "\n", "action", "=", "'store'", ",", "\n", "type", "=", "str", ",", "\n", "help", "=", "'model file name'", ")", "\n", "self", ".", "parser", ".", "add_argument", "(", "\n", "'--config'", ",", "\n", "dest", "=", "'config'", ",", "\n", "default", "=", "'base.json'", ",", "\n", "action", "=", "'store'", ",", "\n", "type", "=", "str", ",", "\n", "help", "=", "'model config files'", ")", "\n", "self", ".", "parser", ".", "add_argument", "(", "\n", "'--mode'", ",", "\n", "dest", "=", "'mode'", ",", "\n", "default", "=", "'predict'", ",", "\n", "action", "=", "'store'", ",", "\n", "type", "=", "str", ",", "\n", "help", "=", "'model mode'", ")", "\n", "self", ".", "parser", ".", "add_argument", "(", "\n", "'--tree_idx'", ",", "\n", "dest", "=", "'tree_idx'", ",", "\n", "default", "=", "-", "1", ",", "\n", "action", "=", "'store'", ",", "\n", "type", "=", "int", ",", "\n", "help", "=", "'model instance id'", ")", "\n", "self", ".", "parser", ".", "add_argument", "(", "\n", "'--pred_fname'", ",", "\n", "dest", "=", "'pred_fname'", ",", "\n", "default", "=", "\"test_predictions\"", ",", "\n", "action", "=", "'store'", ",", "\n", "type", "=", "str", ",", "\n", "help", "=", "'prediction fname'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.parameters.Parameters.parse_args": [[87, 101], ["parameters.Parameters.parser.parse_args", "libs.fetch_json", "_json[].items", "_json[].items", "_json[].keys", "numpy.loadtxt"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.parameters.Parameters.parse_args", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.fetch_json"], ["", "def", "parse_args", "(", "self", ")", ":", "\n", "        ", "self", ".", "params", "=", "self", ".", "parser", ".", "parse_args", "(", ")", "\n", "_json", "=", "utils", ".", "fetch_json", "(", "self", ".", "params", ".", "config", ",", "self", ".", "params", ")", "\n", "for", "key", ",", "val", "in", "_json", "[", "\"DEFAULT\"", "]", ".", "items", "(", ")", ":", "\n", "            ", "self", ".", "params", ".", "__dict__", "[", "key", "]", "=", "val", "\n", "", "for", "key", ",", "val", "in", "_json", "[", "self", ".", "params", ".", "model_fname", "]", ".", "items", "(", ")", ":", "\n", "            ", "self", ".", "params", ".", "__dict__", "[", "key", "]", "=", "val", "\n", "\n", "", "for", "key", "in", "_json", "[", "\"SETUP\"", "]", ".", "keys", "(", ")", ":", "\n", "            ", "over", "=", "_json", "[", "\"SETUP\"", "]", "[", "key", "]", "[", "\"over\"", "]", "\n", "action", "=", "_json", "[", "\"SETUP\"", "]", "[", "key", "]", "[", "\"action\"", "]", "\n", "if", "action", "==", "\"size\"", ":", "\n", "                ", "_data", "=", "np", ".", "loadtxt", "(", "self", ".", "params", ".", "__dict__", "[", "over", "]", ")", "\n", "self", ".", "params", ".", "__dict__", "[", "key", "]", "=", "_data", ".", "size", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.parameters.Parameters.load": [[102, 104], ["vars().update", "json.load", "vars", "open"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load"], ["", "", "", "def", "load", "(", "self", ",", "fname", ")", ":", "\n", "        ", "vars", "(", "self", ".", "params", ")", ".", "update", "(", "json", ".", "load", "(", "open", "(", "fname", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.parameters.Parameters.save": [[105, 108], ["print", "json.dump", "vars", "vars", "open"], "methods", ["None"], ["", "def", "save", "(", "self", ",", "fname", ")", ":", "\n", "        ", "print", "(", "vars", "(", "self", ".", "params", ")", ")", "\n", "json", ".", "dump", "(", "vars", "(", "self", ".", "params", ")", ",", "open", "(", "fname", ",", "'w'", ")", ",", "indent", "=", "4", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetSparse.__init__": [[72, 120], ["dataset_base.DatasetBase.__init__", "NotImplementedError", "dataset.DatasetSparse._remove_samples_wo_features_and_labels", "dataset.DatasetSparse._process_labels", "shortlist_handler.ShortlistHandlerSimple", "NotImplementedError"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase._remove_samples_wo_features_and_labels", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase._process_labels"], ["def", "__init__", "(", "self", ",", "data_dir", ",", "fname_features", ",", "fname_labels", ",", "data", "=", "None", ",", "\n", "model_dir", "=", "''", ",", "mode", "=", "'train'", ",", "feature_indices", "=", "None", ",", "\n", "label_indices", "=", "None", ",", "keep_invalid", "=", "False", ",", "\n", "normalize_features", "=", "True", ",", "normalize_labels", "=", "False", ",", "\n", "num_clf_partitions", "=", "1", ",", "size_shortlist", "=", "-", "1", ",", "num_centroids", "=", "1", ",", "\n", "feature_type", "=", "'sparse'", ",", "shortlist_method", "=", "'static'", ",", "\n", "shorty", "=", "None", ",", "label_type", "=", "'sparse'", ",", "shortlist_in_memory", "=", "True", ",", "\n", "shorty_path", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n            Expects 'libsvm' format with header\n            Args:\n                data_file: str: File name for the set\n        \"\"\"", "\n", "super", "(", ")", ".", "__init__", "(", "data_dir", ",", "fname_features", ",", "fname_labels", ",", "data", ",", "\n", "model_dir", ",", "mode", ",", "feature_indices", ",", "label_indices", ",", "\n", "keep_invalid", ",", "normalize_features", ",", "normalize_labels", ",", "\n", "feature_type", ",", "label_type", "=", "label_type", ")", "\n", "if", "self", ".", "labels", "is", "None", ":", "\n", "            ", "NotImplementedError", "(", "\n", "\"No support for shortlist w/o any label, \\\n                    consider using dense dataset.\"", ")", "\n", "", "self", ".", "feature_type", "=", "feature_type", "\n", "self", ".", "num_centroids", "=", "num_centroids", "\n", "self", ".", "num_clf_partitions", "=", "num_clf_partitions", "\n", "self", ".", "shortlist_in_memory", "=", "shortlist_in_memory", "\n", "self", ".", "size_shortlist", "=", "size_shortlist", "\n", "self", ".", "multiple_cent_mapping", "=", "None", "\n", "self", ".", "shortlist_method", "=", "shortlist_method", "\n", "self", ".", "offset", "=", "0", "\n", "indices", "=", "None", "\n", "if", "self", ".", "mode", "==", "'train'", ":", "\n", "# Remove samples w/o any feature or label", "\n", "            ", "indices", "=", "self", ".", "_remove_samples_wo_features_and_labels", "(", ")", "\n", "\n", "", "if", "not", "keep_invalid", ":", "\n", "# Remove labels w/o any positive instance", "\n", "            ", "self", ".", "_process_labels", "(", "model_dir", ")", "\n", "\n", "", "if", "shortlist_method", "==", "'simple'", ":", "\n", "            ", "self", ".", "offset", "+=", "1", "\n", "self", ".", "shortlist", "=", "ShortlistHandlerSimple", "(", "\n", "self", ".", "num_labels", ",", "model_dir", ",", "num_clf_partitions", ",", "\n", "mode", ",", "size_shortlist", ",", "num_centroids", ",", "\n", "shortlist_in_memory", ",", "self", ".", "multiple_cent_mapping", ")", "\n", "", "else", ":", "\n", "            ", "raise", "NotImplementedError", "(", "\n", "\"Unknown shortlist method: {}!\"", ".", "format", "(", "shortlist_method", ")", ")", "\n", "", "self", ".", "label_padding_index", "=", "self", ".", "num_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetSparse._get_ext_head": [[121, 125], ["numpy.where"], "methods", ["None"], ["", "def", "_get_ext_head", "(", "self", ",", "freq", ",", "threshold", ")", ":", "\n", "        ", "\"\"\"Get super-head labels i.e. too many positive points\n        \"\"\"", "\n", "return", "np", ".", "where", "(", "freq", ">=", "threshold", ")", "[", "0", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetSparse._process_labels_train": [[126, 144], ["super()._process_labels_train", "print", "dataset.DatasetSparse.labels.frequency", "dataset.DatasetSparse._get_ext_head", "numpy.arange", "numpy.append"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase._process_labels_train", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.frequency", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetSparse._get_ext_head"], ["", "def", "_process_labels_train", "(", "self", ",", "data_obj", ",", "_ext_head_threshold", ")", ":", "\n", "        ", "\"\"\"Process labels for train data\n            - Remove labels without any training instance\n            - Handle multiple centroids\n        \"\"\"", "\n", "super", "(", ")", ".", "_process_labels_train", "(", "data_obj", ")", "\n", "data_obj", "[", "'ext_head'", "]", "=", "None", "\n", "data_obj", "[", "'multiple_cent_mapping'", "]", "=", "None", "\n", "print", "(", "\"Valid labels after processing: \"", ",", "self", ".", "num_labels", ")", "\n", "if", "self", ".", "num_centroids", "!=", "1", ":", "\n", "            ", "freq", "=", "self", ".", "labels", ".", "frequency", "(", ")", "\n", "self", ".", "_ext_head", "=", "self", ".", "_get_ext_head", "(", "freq", ",", "_ext_head_threshold", ")", "\n", "self", ".", "multiple_cent_mapping", "=", "np", ".", "arange", "(", "self", ".", "num_labels", ")", "\n", "for", "idx", "in", "self", ".", "_ext_head", ":", "\n", "                ", "self", ".", "multiple_cent_mapping", "=", "np", ".", "append", "(", "\n", "self", ".", "multiple_cent_mapping", ",", "[", "idx", "]", "*", "self", ".", "num_centroids", ")", "\n", "", "data_obj", "[", "'ext_head'", "]", "=", "self", ".", "_ext_head", "\n", "data_obj", "[", "'multiple_cent_mapping'", "]", "=", "self", ".", "multiple_cent_mapping", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetSparse._process_labels_predict": [[145, 155], ["super()._process_labels_predict"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase._process_labels_predict"], ["", "", "def", "_process_labels_predict", "(", "self", ",", "data_obj", ")", ":", "\n", "        ", "\"\"\"Process labels for test data\n        \"\"\"", "\n", "super", "(", ")", ".", "_process_labels_predict", "(", "data_obj", ")", "\n", "try", ":", "\n", "            ", "self", ".", "_ext_head", "=", "data_obj", "[", "'ext_head'", "]", "\n", "self", ".", "multiple_cent_mapping", "=", "data_obj", "[", "'multiple_cent_mapping'", "]", "\n", "", "except", "KeyError", ":", "\n", "            ", "self", ".", "_ext_head", "=", "None", "\n", "self", ".", "multiple_cent_mapping", "=", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetSparse._process_labels_retrain_w_shortlist": [[156, 172], ["super()._process_labels_predict", "print", "dataset.DatasetSparse.labels.frequency", "dataset.DatasetSparse._get_ext_head", "numpy.arange", "numpy.append"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase._process_labels_predict", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.frequency", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetSparse._get_ext_head"], ["", "", "def", "_process_labels_retrain_w_shortlist", "(", "self", ",", "data_obj", ",", "\n", "_ext_head_threshold", ")", ":", "\n", "        ", "\"\"\"Process labels for retrain with shortlist\n        Useful for training labels shortlist after OVA training\n        \"\"\"", "\n", "super", "(", ")", ".", "_process_labels_predict", "(", "data_obj", ")", "\n", "if", "self", ".", "num_centroids", "!=", "1", ":", "\n", "            ", "print", "(", "\"Creating multiple centroid mappings..\"", ")", "\n", "freq", "=", "self", ".", "labels", ".", "frequency", "(", ")", "\n", "self", ".", "_ext_head", "=", "self", ".", "_get_ext_head", "(", "freq", ",", "_ext_head_threshold", ")", "\n", "self", ".", "multiple_cent_mapping", "=", "np", ".", "arange", "(", "self", ".", "num_labels", ")", "\n", "for", "idx", "in", "self", ".", "_ext_head", ":", "\n", "                ", "self", ".", "multiple_cent_mapping", "=", "np", ".", "append", "(", "\n", "self", ".", "multiple_cent_mapping", ",", "[", "idx", "]", "*", "self", ".", "num_centroids", ")", "\n", "", "data_obj", "[", "'ext_head'", "]", "=", "self", ".", "_ext_head", "\n", "data_obj", "[", "'multiple_cent_mapping'", "]", "=", "self", ".", "multiple_cent_mapping", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetSparse._process_labels": [[173, 193], ["os.path.join", "dataset.DatasetSparse._process_labels_train", "_pickle.dump", "open", "_pickle.load", "dataset.DatasetSparse._process_labels_retrain_w_shortlist", "_pickle.dump", "_pickle.load", "dataset.DatasetSparse._process_labels_predict", "open", "open", "open"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase._process_labels_train", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetSparse._process_labels_retrain_w_shortlist", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase._process_labels_predict"], ["", "", "def", "_process_labels", "(", "self", ",", "model_dir", ",", "_ext_head_threshold", "=", "10000", ")", ":", "\n", "        ", "\"\"\"\n            Process labels to handle labels without any training instance;\n            Handle multiple centroids if required\n        \"\"\"", "\n", "data_obj", "=", "{", "}", "\n", "fname", "=", "os", ".", "path", ".", "join", "(", "\n", "model_dir", ",", "'labels_params.pkl'", "if", "self", ".", "_split", "is", "None", "else", "\n", "\"labels_params_split_{}.pkl\"", ".", "format", "(", "self", ".", "_split", ")", ")", "\n", "if", "self", ".", "mode", "==", "'train'", ":", "\n", "            ", "self", ".", "_process_labels_train", "(", "data_obj", ",", "_ext_head_threshold", ")", "\n", "pickle", ".", "dump", "(", "data_obj", ",", "open", "(", "fname", ",", "'wb'", ")", ")", "\n", "", "elif", "self", ".", "mode", "==", "'retrain_w_shortlist'", ":", "\n", "            ", "data_obj", "=", "pickle", ".", "load", "(", "open", "(", "fname", ",", "'rb'", ")", ")", "\n", "self", ".", "_process_labels_retrain_w_shortlist", "(", "\n", "data_obj", ",", "_ext_head_threshold", ")", "\n", "pickle", ".", "dump", "(", "data_obj", ",", "open", "(", "fname", ",", "'wb'", ")", ")", "\n", "", "else", ":", "\n", "            ", "data_obj", "=", "pickle", ".", "load", "(", "open", "(", "fname", ",", "'rb'", ")", ")", "\n", "self", ".", "_process_labels_predict", "(", "data_obj", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetSparse.get_shortlist": [[194, 201], ["None"], "methods", ["None"], ["", "", "def", "get_shortlist", "(", "self", ",", "index", ")", ":", "\n", "        ", "\"\"\"\n            Get data with shortlist for given data index\n        \"\"\"", "\n", "if", "not", "self", ".", "use_shortlist", ":", "\n", "            ", "return", "None", "\n", "", "return", "self", ".", "shortlist", "[", "index", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetSparse.__getitem__": [[202, 221], ["dataset.DatasetSparse.get_shortlist"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase.get_shortlist"], ["", "def", "__getitem__", "(", "self", ",", "index", ")", ":", "\n", "        ", "\"\"\"Get features and labels for index\n        Arguments\n        ---------\n        index: int\n            data for this index\n        Returns\n        -------\n        features: np.ndarray or tuple\n            for dense: np.ndarray\n            for sparse: feature indices and their weights\n        labels: tuple\n            shortlist: label indices in the shortlist\n            labels_mask: 1 for relevant; 0 otherwise\n            dist: distance (used during prediction only)\n        \"\"\"", "\n", "x", "=", "self", ".", "features", "[", "index", "]", "\n", "y", "=", "self", ".", "get_shortlist", "(", "index", ")", "\n", "return", "x", ",", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetDense.__init__": [[261, 293], ["dataset_base.DatasetBase.__init__", "dataset.DatasetDense._remove_samples_wo_features_and_labels", "dataset.DatasetDense._process_labels"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase._remove_samples_wo_features_and_labels", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase._process_labels"], ["def", "__init__", "(", "self", ",", "data_dir", ",", "fname_features", ",", "fname_labels", ",", "data", "=", "None", ",", "\n", "model_dir", "=", "''", ",", "mode", "=", "'train'", ",", "feature_indices", "=", "None", ",", "\n", "label_indices", "=", "None", ",", "keep_invalid", "=", "False", ",", "\n", "normalize_features", "=", "True", ",", "normalize_labels", "=", "False", ",", "\n", "num_clf_partitions", "=", "1", ",", "feature_type", "=", "'sparse'", ",", "\n", "label_type", "=", "'dense'", ")", ":", "\n", "        ", "\"\"\"\n            Expects 'libsvm' format with header\n            Args:\n                data_file: str: File name for the set\n            Can Support datasets w/o any label\n        \"\"\"", "\n", "super", "(", ")", ".", "__init__", "(", "data_dir", ",", "fname_features", ",", "fname_labels", ",", "data", ",", "\n", "model_dir", ",", "mode", ",", "feature_indices", ",", "label_indices", ",", "\n", "keep_invalid", ",", "normalize_features", ",", "normalize_labels", ",", "\n", "feature_type", ",", "label_type", ")", "\n", "if", "self", ".", "mode", "==", "'train'", ":", "\n", "# Remove samples w/o any feature or label", "\n", "            ", "self", ".", "_remove_samples_wo_features_and_labels", "(", ")", "\n", "", "if", "not", "keep_invalid", "and", "self", ".", "labels", ".", "_valid", ":", "\n", "# Remove labels w/o any positive instance", "\n", "            ", "self", ".", "_process_labels", "(", "model_dir", ")", "\n", "", "self", ".", "feature_type", "=", "feature_type", "\n", "self", ".", "partitioner", "=", "None", "\n", "self", ".", "num_clf_partitions", "=", "1", "\n", "if", "self", ".", "labels", ".", "_valid", ":", "# If no labels are provided", "\n", "            ", "self", ".", "num_clf_partitions", "=", "num_clf_partitions", "\n", "", "if", "self", ".", "mode", "==", "'train'", ":", "\n", "            ", "assert", "self", ".", "labels", ".", "_valid", ",", "\"Labels can not be None while training.\"", "\n", "\n", "# TODO Take care of this select and padding index", "\n", "", "self", ".", "label_padding_index", "=", "self", ".", "num_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetDense.__getitem__": [[294, 307], ["None"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "index", ")", ":", "\n", "        ", "\"\"\"\n            Get features and labels for index\n            Args:\n                index: for this sample\n            Returns:\n                features: : non zero entries\n                labels: : numpy array\n\n        \"\"\"", "\n", "x", "=", "self", ".", "features", "[", "index", "]", "\n", "y", "=", "self", ".", "labels", "[", "index", "]", "\n", "return", "x", ",", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetGraph.__init__": [[355, 381], ["dataset.DatasetSparse.__init__", "numpy.ones", "NotImplementedError"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__"], ["def", "__init__", "(", "self", ",", "data_dir", ",", "fname_features", ",", "fname_labels", ",", "data", "=", "None", ",", "\n", "model_dir", "=", "''", ",", "mode", "=", "'train'", ",", "feature_indices", "=", "None", ",", "\n", "label_indices", "=", "None", ",", "keep_invalid", "=", "False", ",", "\n", "normalize_features", "=", "True", ",", "normalize_labels", "=", "False", ",", "\n", "num_clf_partitions", "=", "1", ",", "size_shortlist", "=", "-", "1", ",", "num_centroids", "=", "1", ",", "\n", "feature_type", "=", "'sparse'", ",", "shorty", "=", "None", ",", "label_type", "=", "'Parabel'", ",", "\n", "shortlist_in_memory", "=", "True", ")", ":", "\n", "        ", "\"\"\"\n            Expects 'libsvm' format with header\n            Args:\n                data_file: str: File name for the set\n        \"\"\"", "\n", "super", "(", ")", ".", "__init__", "(", "data_dir", ",", "fname_features", ",", "fname_labels", ",", "data", ",", "\n", "model_dir", ",", "mode", ",", "feature_indices", ",", "label_indices", ",", "\n", "keep_invalid", ",", "normalize_features", ",", "normalize_labels", ",", "\n", "num_clf_partitions", ",", "size_shortlist", ",", "num_centroids", ",", "\n", "feature_type", ",", "\"simple\"", ",", "shorty", ",", "\n", "label_type", ",", "shortlist_in_memory", ")", "\n", "\n", "if", "self", ".", "labels", "is", "None", ":", "\n", "            ", "NotImplementedError", "(", "\n", "\"No support for shortlist w/o any label, \\\n                    consider using dense dataset.\"", ")", "\n", "", "self", ".", "place_holder", "=", "np", ".", "ones", "(", "(", "1", ",", "1", ")", ",", "dtype", "=", "np", ".", "int", ")", "\n", "self", ".", "data_have_shortlist", "=", "False", "\n", "self", ".", "use_shortlist", "=", "False", "\n", "# self.features.add_padding()", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetGraph._prep_for_depth": [[383, 386], ["dataset.DatasetGraph.labels._prep_for_clusters"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels._prep_for_clusters"], ["", "def", "_prep_for_depth", "(", "self", ",", "use_shortlist", ",", "clusters", ")", ":", "\n", "        ", "self", ".", "use_shortlist", "=", "use_shortlist", "\n", "self", ".", "labels", ".", "_prep_for_clusters", "(", "use_shortlist", ",", "clusters", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetGraph.__getitem__": [[387, 407], ["dataset.DatasetGraph.get_shortlist", "dataset.DatasetGraph.get_shortlist"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase.get_shortlist", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase.get_shortlist"], ["", "def", "__getitem__", "(", "self", ",", "index", ")", ":", "\n", "        ", "\"\"\"Get features and labels for index\n        Arguments\n        ---------\n        index: int\n            data for this index\n        Returns\n        -------\n        features: np.ndarray or tuple\n            for dense: np.ndarray\n            for sparse: feature indices and their weights\n        labels: tuple\n            shortlist: label indices in the shortlist\n            labels_mask: 1 for relevant; 0 otherwise\n            dist: distance (used during prediction only)\n        \"\"\"", "\n", "x", "=", "self", ".", "features", "[", "index", "]", "\n", "if", "self", ".", "mode", "==", "\"test\"", ":", "\n", "            ", "return", "x", ",", "self", ".", "place_holder", ",", "self", ".", "get_shortlist", "(", "index", ")", "\n", "", "return", "x", ",", "self", ".", "labels", "[", "index", "]", ",", "self", ".", "get_shortlist", "(", "index", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetGraph.build_shortlist": [[408, 431], ["dataset.DatasetGraph.get_stats", "print", "numpy.arange", "numpy.concatenate", "numpy.concatenate", "scipy.sparse.lil_matrix", "shorty.dot().tocsr.dot().tocsr.dot().tocsr", "dataset.DatasetGraph.shortlist.update_shortlist", "list", "list", "print", "map", "map", "shorty.dot().tocsr.dot().tocsr.dot", "numpy.arange", "numpy.arange"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase.get_stats", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerSimple.update_shortlist"], ["", "def", "build_shortlist", "(", "self", ",", "shorty", ",", "net", ")", ":", "\n", "        ", "if", "shorty", "is", "not", "None", ":", "\n", "            ", "_", ",", "_", ",", "n_lbs", "=", "self", ".", "get_stats", "(", ")", "\n", "_", ",", "o_lbs", "=", "shorty", ".", "shape", "\n", "mf", "=", "net", ".", "C", "[", "net", ".", "depth", "]", "\n", "print", "(", "\"net depth is\"", ",", "net", ".", "depth", ",", "net", ".", "height", ",", "n_lbs", ")", "\n", "self", ".", "mf", "=", "mf", "\n", "Xs", "=", "np", ".", "arange", "(", "mf", ")", "\n", "rows", "=", "np", ".", "concatenate", "(", "list", "(", "\n", "map", "(", "lambda", "x", ":", "[", "x", "]", "*", "mf", ",", "np", ".", "arange", "(", "o_lbs", ")", ")", "\n", ")", ")", "\n", "cols", "=", "np", ".", "concatenate", "(", "list", "(", "\n", "map", "(", "lambda", "x", ":", "Xs", "+", "x", "*", "mf", ",", "np", ".", "arange", "(", "o_lbs", ")", ")", "\n", ")", ")", "\n", "if", "net", ".", "depth", "==", "net", ".", "height", "-", "2", ":", "\n", "                ", "print", "(", "\"In leaf in dalaloader\"", ")", "\n", "cols", "=", "net", ".", "leaf_hash", "[", "cols", "]", "\n", "rows", "=", "rows", "[", "cols", "!=", "n_lbs", "]", "\n", "cols", "=", "cols", "[", "cols", "!=", "n_lbs", "]", "\n", "", "to_beam", "=", "lil_matrix", "(", "(", "o_lbs", ",", "n_lbs", "+", "1", ")", ")", "\n", "to_beam", "[", "rows", ",", "cols", "]", "=", "1", "\n", "shorty", "=", "shorty", ".", "dot", "(", "to_beam", ")", ".", "tocsr", "(", ")", "\n", "self", ".", "shortlist", ".", "update_shortlist", "(", "shorty", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetGraph.get_shortlist": [[432, 439], ["None"], "methods", ["None"], ["", "", "def", "get_shortlist", "(", "self", ",", "index", ")", ":", "\n", "        ", "\"\"\"\n            Get data with shortlist for given data index\n        \"\"\"", "\n", "if", "self", ".", "shortlist", ".", "shortlist", "is", "None", ":", "\n", "            ", "return", "None", "\n", "", "return", "self", ".", "shortlist", "[", "index", "]", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.construct_dataset": [[11, 25], ["dataset.DatasetGraph"], "function", ["None"], ["def", "construct_dataset", "(", "data_dir", ",", "fname_features", ",", "fname_labels", ",", "data", "=", "None", ",", "\n", "model_dir", "=", "''", ",", "mode", "=", "'train'", ",", "size_shortlist", "=", "-", "1", ",", "\n", "normalize_features", "=", "True", ",", "normalize_labels", "=", "True", ",", "\n", "keep_invalid", "=", "False", ",", "num_centroids", "=", "1", ",", "\n", "feature_type", "=", "'sparse'", ",", "num_clf_partitions", "=", "1", ",", "\n", "feature_indices", "=", "None", ",", "label_indices", "=", "None", ",", "\n", "shortlist_method", "=", "'static'", ",", "shorty", "=", "None", ",", "\n", "classifier_type", "=", "None", ",", "shorty_path", "=", "None", ")", ":", "\n", "\n", "    ", "return", "DatasetGraph", "(", "\n", "data_dir", ",", "fname_features", ",", "fname_labels", ",", "data", ",", "model_dir", ",", "mode", ",", "\n", "feature_indices", ",", "label_indices", ",", "keep_invalid", ",", "normalize_features", ",", "\n", "normalize_labels", ",", "num_clf_partitions", ",", "size_shortlist", ",", "\n", "num_centroids", ",", "feature_type", ",", "shorty", ",", "\"Graph\"", ",", "shortlist_method", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn.construct_collate_fn.__init__": [[37, 55], ["collate_fn.construct_collate_fn._get_docs", "collate_fn.construct_collate_fn._batcher", "collate_fn.construct_collate_fn.sparse_label_fts.tocsr", "sparse_graph.tocsr"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn.construct_collate_fn._get_docs", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn.construct_collate_fn._batcher"], ["    ", "def", "__init__", "(", "self", ",", "feature_type", ",", "use_shortlist", "=", "False", ",", "freeze_params", "=", "False", ",", "\n", "num_partitions", "=", "1", ",", "sparse_label_fts", "=", "None", ",", "traverse", "=", "True", ",", "\n", "sparse_graph", "=", "None", ",", "padding_idx", "=", "0", ",", "num_labels", "=", "-", "1", ",", "mode", "=", "\"test\"", ")", ":", "\n", "        ", "self", ".", "num_partitions", "=", "num_partitions", "\n", "self", ".", "padding_idx", "=", "padding_idx", "\n", "self", ".", "sparse_label_fts", "=", "sparse_label_fts", "\n", "self", ".", "sparse_graph", "=", "sparse_graph", "\n", "self", ".", "traverse", "=", "traverse", "\n", "self", ".", "freeze_params", "=", "freeze_params", "\n", "if", "self", ".", "sparse_label_fts", "is", "not", "None", ":", "\n", "            ", "self", ".", "sparse_label_fts", "=", "self", ".", "sparse_label_fts", ".", "tocsr", "(", ")", "\n", "", "if", "self", ".", "sparse_graph", "is", "not", "None", ":", "\n", "            ", "self", ".", "sparse_graph", "=", "sparse_graph", ".", "tocsr", "(", ")", "\n", "", "self", ".", "n_lbs", "=", "num_labels", "\n", "self", ".", "use_shortlist", "=", "use_shortlist", "\n", "self", ".", "collate_docs", "=", "self", ".", "_get_docs", "(", "feature_type", ")", "\n", "self", ".", "mode", "=", "mode", "\n", "self", ".", "batcher", "=", "self", ".", "_batcher", "(", "sparse_label_fts", ",", "use_shortlist", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn.construct_collate_fn.setup": [[56, 58], ["None"], "methods", ["None"], ["", "def", "setup", "(", "self", ",", "dataset", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn.construct_collate_fn.__call__": [[59, 61], ["collate_fn.construct_collate_fn.batcher"], "methods", ["None"], ["", "def", "__call__", "(", "self", ",", "batch", ")", ":", "\n", "        ", "return", "self", ".", "batcher", "(", "batch", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn.construct_collate_fn._batcher": [[62, 76], ["print", "print"], "methods", ["None"], ["", "def", "_batcher", "(", "self", ",", "sparse_label_fts", ",", "use_shortlist", ")", ":", "\n", "        ", "if", "sparse_label_fts", "is", "not", "None", ":", "\n", "            ", "if", "use_shortlist", ":", "\n", "                ", "if", "self", ".", "traverse", ":", "\n", "                    ", "print", "(", "\"traversing the graph\"", ")", "\n", "return", "self", ".", "collate_fn_shorty_lbf_rl", "\n", "", "else", ":", "\n", "                    ", "print", "(", "\"Not traversing the graph\"", ")", "\n", "return", "self", ".", "collate_fn_shorty_lbf", "\n", "", "", "return", "self", ".", "collate_fn_full", "\n", "", "else", ":", "\n", "            ", "if", "use_shortlist", ":", "\n", "                ", "return", "self", ".", "collate_fn_shorty", "\n", "", "return", "self", ".", "collate_fn_full", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn.construct_collate_fn._get_docs": [[77, 84], ["print"], "methods", ["None"], ["", "", "def", "_get_docs", "(", "self", ",", "feature_type", ")", ":", "\n", "        ", "if", "feature_type", "==", "'dense'", ":", "\n", "            ", "return", "self", ".", "collate_fn_docs_dense", "\n", "", "elif", "feature_type", "==", "'sparse'", ":", "\n", "            ", "return", "self", ".", "collate_fn_docs_sparse", "\n", "", "else", ":", "\n", "            ", "print", "(", "\"Kuch bhi\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn.construct_collate_fn.collate_fn_docs_dense": [[85, 92], ["torch.stack().type", "len", "numpy.arange().reshape", "torch.stack", "numpy.arange", "list", "map", "torch.from_numpy"], "methods", ["None"], ["", "", "def", "collate_fn_docs_dense", "(", "self", ",", "batch", ",", "b_data", ")", ":", "\n", "        ", "b_data", "[", "'X'", "]", "=", "torch", ".", "stack", "(", "list", "(", "\n", "map", "(", "lambda", "x", ":", "torch", ".", "from_numpy", "(", "x", "[", "0", "]", ")", ",", "batch", ")", "\n", ")", ",", "0", ")", ".", "type", "(", "torch", ".", "FloatTensor", ")", "\n", "b_data", "[", "'batch_size'", "]", "=", "len", "(", "batch", ")", "\n", "b_data", "[", "'idx'", "]", "=", "np", ".", "arange", "(", "b_data", "[", "'batch_size'", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "b_data", "[", "'is_sparse'", "]", "=", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn.construct_collate_fn.collate_fn_docs_sparse": [[93, 103], ["scipy.vstack().tocsr", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "len", "numpy.arange().reshape", "scipy.vstack", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "numpy.arange", "list", "len", "map"], "methods", ["None"], ["", "def", "collate_fn_docs_sparse", "(", "self", ",", "batch", ",", "b_data", ")", ":", "\n", "        ", "s_docs", "=", "sp", ".", "vstack", "(", "list", "(", "map", "(", "lambda", "x", ":", "x", "[", "0", "]", ",", "batch", ")", ")", ")", ".", "tocsr", "(", ")", "\n", "b_data", "[", "'X_ptr'", "]", "=", "torch", ".", "from_numpy", "(", "\n", "s_docs", ".", "indptr", "[", ":", "-", "1", "]", ")", ".", "type", "(", "torch", ".", "LongTensor", ")", "\n", "b_data", "[", "'X_ind'", "]", "=", "torch", ".", "from_numpy", "(", "\n", "s_docs", ".", "indices", ")", ".", "type", "(", "torch", ".", "LongTensor", ")", "\n", "b_data", "[", "'X_wts'", "]", "=", "torch", ".", "from_numpy", "(", "s_docs", ".", "data", ")", ".", "type", "(", "torch", ".", "FloatTensor", ")", "\n", "b_data", "[", "'batch_size'", "]", "=", "len", "(", "batch", ")", "\n", "b_data", "[", "'idx'", "]", "=", "np", ".", "arange", "(", "len", "(", "batch", ")", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "b_data", "[", "'is_sparse'", "]", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn.construct_collate_fn.collate_fn_shorty_lbf_rl": [[104, 138], ["collate_fn.construct_collate_fn.collate_docs", "scipy.vstack().tocsr", "scipy.vstack().tocsr.dot", "torch.from_numpy", "torch.zeros", "torch.arange", "collate_fn._paddedbatch", "numpy.where", "collate_fn.construct_collate_fn.sparse_graph[].tocsc", "shoty_lg[].tocsr", "[].tocsr", "collate_fn._block_sparse_matrix", "torch.from_numpy().type", "collate_fn._block_sparse_matrix", "map", "scipy.vstack().tocsc", "numpy.take_along_axis().todense", "torch.from_numpy().type", "scipy.vstack", "numpy.where", "zip", "list", "sp.vstack().tocsr.dot.getnnz", "torch.from_numpy", "scipy.vstack", "numpy.take_along_axis", "torch.from_numpy", "map", "[].tocsr.getnnz", "[].tocsr.tocsc", "list", "_paddedbatch.numpy", "map"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn._paddedbatch", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn._block_sparse_matrix", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn._block_sparse_matrix"], ["", "def", "collate_fn_shorty_lbf_rl", "(", "self", ",", "batch", ")", ":", "\n", "        ", "b_data", "=", "{", "}", "\n", "self", ".", "collate_docs", "(", "batch", ",", "b_data", ")", "\n", "Y_s", "=", "sp", ".", "vstack", "(", "list", "(", "map", "(", "lambda", "x", ":", "x", "[", "2", "]", ",", "batch", ")", ")", ")", ".", "tocsr", "(", ")", "\n", "# print(Y_s.shape, self.sparse_graph.shape)", "\n", "s_nbr", "=", "Y_s", ".", "dot", "(", "self", ".", "sparse_graph", ")", "\n", "lbl_pred", "=", "np", ".", "where", "(", "s_nbr", ".", "getnnz", "(", "axis", "=", "0", ")", ">", "0", ")", "[", "0", "]", "\n", "\n", "f_shoty", "=", "torch", ".", "from_numpy", "(", "lbl_pred", ")", "\n", "b_data", "[", "'f_shoty'", "]", "=", "f_shoty", "\n", "\n", "if", "not", "self", ".", "freeze_params", ":", "\n", "            ", "shoty_lg", "=", "self", ".", "sparse_graph", "[", "lbl_pred", "]", ".", "tocsc", "(", ")", "\n", "shoty_lg", "=", "shoty_lg", "[", ":", ",", "lbl_pred", "]", ".", "tocsr", "(", ")", "\n", "shoty_lf", "=", "self", ".", "sparse_label_fts", "[", "lbl_pred", "]", "\n", "lf", "=", "np", ".", "where", "(", "shoty_lf", ".", "getnnz", "(", "axis", "=", "0", ")", ">", "0", ")", "[", "0", "]", "\n", "shoty_lf", "=", "shoty_lf", ".", "tocsc", "(", ")", "[", ":", ",", "lf", "]", ".", "tocsr", "(", ")", "\n", "b_data", "[", "'shoty_lg'", "]", "=", "_block_sparse_matrix", "(", "shoty_lg", ")", "\n", "b_data", "[", "'lf'", "]", "=", "torch", ".", "from_numpy", "(", "lf", ")", ".", "type", "(", "torch", ".", "LongTensor", ")", "\n", "b_data", "[", "'shoty_lf'", "]", "=", "_block_sparse_matrix", "(", "shoty_lf", ")", "\n", "\n", "", "Y_r", "=", "torch", ".", "zeros", "(", "self", ".", "n_lbs", "+", "1", ",", "dtype", "=", "torch", ".", "long", ")", "\n", "Y_r", "[", "f_shoty", "]", "=", "torch", ".", "arange", "(", "lbl_pred", ".", "size", ",", "dtype", "=", "torch", ".", "long", ")", "\n", "indptr", ",", "indices", "=", "s_nbr", ".", "indptr", ",", "s_nbr", ".", "indices", "\n", "_Y_s", "=", "_paddedbatch", "(", "map", "(", "lambda", "x", ":", "indices", "[", "x", "[", "0", "]", ":", "x", "[", "1", "]", "]", ",", "\n", "zip", "(", "indptr", "[", ":", "-", "1", "]", ",", "indptr", "[", "1", ":", "]", ")", ")", ",", "\n", "self", ".", "n_lbs", ",", "dtype", "=", "torch", ".", "LongTensor", ")", "\n", "b_data", "[", "'Y_r'", "]", "=", "Y_r", "[", "_Y_s", "]", "\n", "if", "self", ".", "mode", "==", "\"train\"", ":", "\n", "            ", "Y", "=", "sp", ".", "vstack", "(", "list", "(", "map", "(", "lambda", "x", ":", "x", "[", "1", "]", ",", "batch", ")", ")", ")", ".", "tocsc", "(", ")", "\n", "# print(Y.shape)", "\n", "Y", "=", "np", ".", "take_along_axis", "(", "Y", ",", "_Y_s", ".", "numpy", "(", ")", ",", "axis", "=", "1", ")", ".", "todense", "(", ")", "\n", "b_data", "[", "'Y'", "]", "=", "torch", ".", "from_numpy", "(", "Y", ")", ".", "type", "(", "torch", ".", "FloatTensor", ")", "\n", "", "return", "b_data", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn.construct_collate_fn.collate_fn_shorty_lbf": [[139, 173], ["collate_fn.construct_collate_fn.collate_docs", "scipy.vstack().tocsr", "collate_fn._paddedbatch", "torch.unique", "torch.unique.numpy", "torch.zeros", "torch.arange", "map", "collate_fn.construct_collate_fn.sparse_graph[].tocsc", "shoty_lg[].tocsr", "[].tocsr", "torch.from_numpy().type", "collate_fn._block_sparse_matrix", "collate_fn._block_sparse_matrix", "scipy.vstack().tocsc", "numpy.take_along_axis().todense", "torch.from_numpy().type", "scipy.vstack", "zip", "numpy.where", "list", "torch.from_numpy", "scipy.vstack", "numpy.take_along_axis", "torch.from_numpy", "map", "[].tocsr.getnnz", "[].tocsr.tocsc", "list", "_paddedbatch.numpy", "map"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn._paddedbatch", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn._block_sparse_matrix", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn._block_sparse_matrix"], ["", "def", "collate_fn_shorty_lbf", "(", "self", ",", "batch", ")", ":", "\n", "        ", "b_data", "=", "{", "}", "\n", "self", ".", "collate_docs", "(", "batch", ",", "b_data", ")", "\n", "\n", "Y_s", "=", "sp", ".", "vstack", "(", "list", "(", "map", "(", "lambda", "x", ":", "x", "[", "2", "]", ",", "batch", ")", ")", ")", ".", "tocsr", "(", ")", "\n", "indptr", ",", "indices", "=", "Y_s", ".", "indptr", ",", "Y_s", ".", "indices", "\n", "Y_s", "=", "_paddedbatch", "(", "map", "(", "lambda", "x", ":", "indices", "[", "x", "[", "0", "]", ":", "x", "[", "1", "]", "]", ",", "\n", "zip", "(", "indptr", "[", ":", "-", "1", "]", ",", "indptr", "[", "1", ":", "]", ")", ")", ",", "\n", "self", ".", "n_lbs", ",", "dtype", "=", "torch", ".", "LongTensor", ")", "\n", "\n", "f_shoty", "=", "torch", ".", "unique", "(", "Y_s", ")", "\n", "b_data", "[", "'f_shoty'", "]", "=", "f_shoty", "\n", "lbl_pred", "=", "f_shoty", ".", "numpy", "(", ")", "\n", "\n", "if", "not", "self", ".", "freeze_params", ":", "\n", "            ", "shoty_lg", "=", "self", ".", "sparse_graph", "[", "lbl_pred", "]", ".", "tocsc", "(", ")", "\n", "shoty_lg", "=", "shoty_lg", "[", ":", ",", "lbl_pred", "]", ".", "tocsr", "(", ")", "\n", "shoty_lf", "=", "self", ".", "sparse_label_fts", "[", "lbl_pred", "]", "\n", "lf", "=", "np", ".", "where", "(", "shoty_lf", ".", "getnnz", "(", "axis", "=", "0", ")", ">", "0", ")", "[", "0", "]", "\n", "shoty_lf", "=", "shoty_lf", ".", "tocsc", "(", ")", "[", ":", ",", "lf", "]", ".", "tocsr", "(", ")", "\n", "b_data", "[", "'lf'", "]", "=", "torch", ".", "from_numpy", "(", "lf", ")", ".", "type", "(", "torch", ".", "LongTensor", ")", "\n", "b_data", "[", "'shoty_lg'", "]", "=", "_block_sparse_matrix", "(", "shoty_lg", ")", "\n", "b_data", "[", "'shoty_lf'", "]", "=", "_block_sparse_matrix", "(", "shoty_lf", ")", "\n", "\n", "", "Y_r", "=", "torch", ".", "zeros", "(", "self", ".", "n_lbs", "+", "1", ",", "dtype", "=", "torch", ".", "long", ")", "\n", "Y_r", "[", "f_shoty", "]", "=", "torch", ".", "arange", "(", "lbl_pred", ".", "size", ",", "dtype", "=", "torch", ".", "long", ")", "\n", "b_data", "[", "'Y_r'", "]", "=", "Y_r", "[", "Y_s", "]", "\n", "\n", "if", "self", ".", "mode", "==", "\"train\"", ":", "\n", "            ", "Y", "=", "sp", ".", "vstack", "(", "list", "(", "map", "(", "lambda", "x", ":", "x", "[", "1", "]", ",", "batch", ")", ")", ")", ".", "tocsc", "(", ")", "\n", "# print(Y.shape)", "\n", "Y", "=", "np", ".", "take_along_axis", "(", "Y", ",", "Y_s", ".", "numpy", "(", ")", ",", "axis", "=", "1", ")", ".", "todense", "(", ")", "\n", "b_data", "[", "'Y'", "]", "=", "torch", ".", "from_numpy", "(", "Y", ")", ".", "type", "(", "torch", ".", "FloatTensor", ")", "\n", "", "return", "b_data", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn.construct_collate_fn.collate_fn_shorty": [[174, 198], ["collate_fn.construct_collate_fn.collate_docs", "scipy.vstack().tocsr", "collate_fn._paddedbatch", "collate_fn._paddedbatch", "map", "scipy.vstack().tocsc", "numpy.take_along_axis().todense", "torch.from_numpy().type", "map", "scipy.vstack", "zip", "zip", "list", "scipy.vstack", "numpy.take_along_axis", "torch.from_numpy", "map", "list", "b_data[].numpy", "map"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn._paddedbatch", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn._paddedbatch"], ["", "def", "collate_fn_shorty", "(", "self", ",", "batch", ")", ":", "\n", "        ", "\"\"\"\n            Combine each sample in a batch with shortlist\n            For sparse features\n        \"\"\"", "\n", "b_data", "=", "{", "}", "\n", "self", ".", "collate_docs", "(", "batch", ",", "b_data", ")", "\n", "\n", "Y_s", "=", "sp", ".", "vstack", "(", "list", "(", "map", "(", "lambda", "x", ":", "x", "[", "2", "]", ",", "batch", ")", ")", ")", ".", "tocsr", "(", ")", "\n", "indptr", ",", "indices", ",", "data", "=", "Y_s", ".", "indptr", ",", "Y_s", ".", "indices", ",", "Y_s", ".", "data", "\n", "\n", "b_data", "[", "'Y_s'", "]", "=", "_paddedbatch", "(", "map", "(", "lambda", "x", ":", "indices", "[", "x", "[", "0", "]", ":", "x", "[", "1", "]", "]", ",", "\n", "zip", "(", "indptr", "[", ":", "-", "1", "]", ",", "indptr", "[", "1", ":", "]", ")", ")", ",", "\n", "self", ".", "n_lbs", ",", "dtype", "=", "torch", ".", "LongTensor", ")", "\n", "\n", "if", "self", ".", "mode", "==", "\"train\"", ":", "\n", "            ", "Y", "=", "sp", ".", "vstack", "(", "list", "(", "map", "(", "lambda", "x", ":", "x", "[", "0", "]", "[", "1", "]", ",", "batch", ")", ")", ")", ".", "tocsc", "(", ")", "\n", "Y", "=", "np", ".", "take_along_axis", "(", "Y", ",", "b_data", "[", "'Y_s'", "]", ".", "numpy", "(", ")", ",", "axis", "=", "1", ")", ".", "todense", "(", ")", "\n", "b_data", "[", "'Y'", "]", "=", "torch", ".", "from_numpy", "(", "Y", ")", ".", "type", "(", "torch", ".", "FloatTensor", ")", "\n", "\n", "", "b_data", "[", "'Y_d'", "]", "=", "_paddedbatch", "(", "map", "(", "lambda", "x", ":", "data", "[", "x", "[", "0", "]", ":", "x", "[", "1", "]", "]", ",", "\n", "zip", "(", "indptr", "[", ":", "-", "1", "]", ",", "indptr", "[", "1", ":", "]", ")", ")", ",", "\n", "-", "np", ".", "inf", ",", "dtype", "=", "torch", ".", "FloatTensor", ")", "\n", "return", "b_data", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn.construct_collate_fn.collate_fn_full": [[199, 210], ["collate_fn.construct_collate_fn.collate_docs", "torch.from_numpy().type", "torch.from_numpy", "scipy.vstack().todense", "scipy.vstack", "list", "map"], "methods", ["None"], ["", "def", "collate_fn_full", "(", "self", ",", "batch", ")", ":", "\n", "        ", "\"\"\"\n            Combine each sample in a batch\n            For dense features\n        \"\"\"", "\n", "b_data", "=", "{", "}", "\n", "self", ".", "collate_docs", "(", "batch", ",", "b_data", ")", "\n", "if", "self", ".", "mode", "==", "\"train\"", ":", "\n", "            ", "b_data", "[", "'Y'", "]", "=", "torch", ".", "from_numpy", "(", "sp", ".", "vstack", "(", "\n", "list", "(", "map", "(", "lambda", "x", ":", "x", "[", "1", "]", ",", "batch", ")", ")", ")", ".", "todense", "(", ")", ")", ".", "type", "(", "torch", ".", "FloatTensor", ")", "\n", "", "return", "b_data", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn._block_sparse_matrix": [[8, 13], ["torch.LongTensor", "torch.FloatTensor", "torch.Size", "numpy.vstack", "label_words.nonzero"], "function", ["None"], ["def", "_block_sparse_matrix", "(", "label_words", ")", ":", "\n", "    ", "indx", "=", "torch", ".", "LongTensor", "(", "np", ".", "vstack", "(", "[", "*", "label_words", ".", "nonzero", "(", ")", "]", ")", ")", "\n", "data", "=", "torch", ".", "FloatTensor", "(", "label_words", ".", "data", ")", "\n", "shape", "=", "torch", ".", "Size", "(", "label_words", ".", "shape", ")", "\n", "return", "indx", ",", "data", ",", "shape", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn._to_sparse_matrix": [[15, 27], ["numpy.arange().reshape", "numpy.zeros", "scipy.lil_matrix", "scipy.lil_matrix", "numpy.ones().tolist", "cols.tolist.tolist", "sp.lil_matrix.tocsc", "numpy.arange", "numpy.ones"], "function", ["None"], ["", "def", "_to_sparse_matrix", "(", "cols", ",", "flags", ",", "num_lbls", ")", ":", "\n", "    ", "num_inst", "=", "cols", ".", "shape", "[", "0", "]", "\n", "rows", "=", "np", ".", "arange", "(", "num_inst", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "s_flg", "=", "np", ".", "zeros", "(", "(", "num_inst", ",", "num_lbls", ")", ")", "\n", "s_mat", "=", "sp", ".", "lil_matrix", "(", "(", "num_inst", ",", "num_lbls", ")", ")", "\n", "s_flg", "=", "sp", ".", "lil_matrix", "(", "(", "num_inst", ",", "num_lbls", ")", ")", "\n", "s_flg", "[", "rows", ",", "cols", "]", "=", "flags", "\n", "data", "=", "np", ".", "ones", "(", "cols", ".", "shape", ")", ".", "tolist", "(", ")", "\n", "cols", "=", "cols", ".", "tolist", "(", ")", "\n", "s_mat", ".", "rows", "[", ":", "]", "=", "cols", "\n", "s_mat", ".", "data", "[", ":", "]", "=", "data", "\n", "return", "s_mat", ",", "s_flg", ".", "tocsc", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.collate_fn._paddedbatch": [[29, 34], ["torch.nn.utils.rnn.pad_sequence", "list", "map", "torch.from_numpy().type", "torch.from_numpy"], "function", ["None"], ["", "def", "_paddedbatch", "(", "Var", ",", "padding_val", ",", "\n", "dtype", "=", "torch", ".", "FloatTensor", ",", "*", "args", ")", ":", "\n", "    ", "return", "torch", ".", "nn", ".", "utils", ".", "rnn", ".", "pad_sequence", "(", "\n", "list", "(", "map", "(", "lambda", "x", ":", "torch", ".", "from_numpy", "(", "x", ")", ".", "type", "(", "dtype", ")", ",", "Var", ")", ")", ",", "\n", "batch_first", "=", "True", ",", "padding_value", "=", "padding_val", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model.ModelECLARE.__init__": [[14, 17], ["model_base.ModelBase.__init__"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__"], ["    ", "def", "__init__", "(", "self", ",", "params", ",", "net", ",", "criterion", ",", "optimizer", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "ModelECLARE", ",", "self", ")", ".", "__init__", "(", "params", ",", "net", ",", "criterion", ",", "\n", "optimizer", ",", "*", "args", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model.ModelECLAREpp.__init__": [[19, 22], ["model_base.ModelBase.__init__"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__"], ["    ", "def", "__init__", "(", "self", ",", "params", ",", "net", ",", "criterion", ",", "optimizer", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "ModelECLAREpp", ",", "self", ")", ".", "__init__", "(", "params", ",", "net", ",", "criterion", ",", "\n", "optimizer", ",", "*", "args", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model.ModelECLAREpp.get_lbl_cent": [[23, 31], ["model.ModelECLAREpp.net._get_encoder", "sklearn.preprocessing.normalize", "y.transpose().dot", "model.ModelECLAREpp._doc_embed", "y.transpose"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._get_encoder", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.normalize", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._doc_embed", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.transpose"], ["", "def", "get_lbl_cent", "(", "self", ",", "dataset", ")", ":", "\n", "        ", "encoder", "=", "self", ".", "net", ".", "_get_encoder", "(", ")", "\n", "dataset", ".", "mode", "=", "\"test\"", "\n", "docs", "=", "normalize", "(", "self", ".", "_doc_embed", "(", "dataset", ",", "0", ",", "encoder", ",", "True", ")", ")", "\n", "dataset", ".", "mode", "=", "\"train\"", "\n", "y", "=", "dataset", ".", "labels", ".", "Y", "\n", "lbl_cnt", "=", "y", ".", "transpose", "(", ")", ".", "dot", "(", "docs", ")", "\n", "return", "lbl_cnt", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model.ModelECLAREfe.__init__": [[34, 38], ["model_base.ModelBase.__init__"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__"], ["    ", "def", "__init__", "(", "self", ",", "params", ",", "net", ",", "criterion", ",", "optimizer", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "ModelECLAREfe", ",", "self", ")", ".", "__init__", "(", "params", ",", "net", ",", "criterion", ",", "\n", "optimizer", ",", "*", "args", ",", "**", "kwargs", ")", "\n", "self", ".", "lbl_cnt", "=", "params", ".", "lbl_cnt", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model.ModelECLAREfe._prep_for_depth": [[39, 64], ["torch.manual_seed", "torch.cuda.manual_seed_all", "numpy.random.seed", "model.ModelECLAREfe.logger.info", "model.ModelECLAREfe._prep_ds_for_depth", "model.ModelECLAREfe.net.cpu", "model.ModelECLAREfe.net._prep_for_depth", "print", "model.ModelECLAREfe.optimizer.construct", "model.ModelECLAREfe._prep_dl_for_depth", "model.ModelECLAREfe._doc_embed", "libs.construct", "model.ModelECLAREfe._doc_embed", "libs.construct"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_ds_for_depth", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_for_depth", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.construct", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_dl_for_depth", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._doc_embed", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.construct", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._doc_embed", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.construct"], ["", "def", "_prep_for_depth", "(", "self", ",", "depth", ",", "train_ds", ",", "valid_ds", ")", ":", "\n", "        ", "torch", ".", "manual_seed", "(", "self", ".", "tree_idx", ")", "\n", "torch", ".", "cuda", ".", "manual_seed_all", "(", "self", ".", "tree_idx", ")", "\n", "np", ".", "random", ".", "seed", "(", "self", ".", "tree_idx", ")", "\n", "self", ".", "logger", ".", "info", "(", "\"learning for depth %d\"", "%", "(", "depth", ")", ")", "\n", "train_ds", ".", "mode", "=", "'test'", "\n", "self", ".", "_prep_ds_for_depth", "(", "depth", ",", "train_ds", ",", "valid_ds", ")", "\n", "self", ".", "net", ".", "cpu", "(", ")", "\n", "self", ".", "net", ".", "_prep_for_depth", "(", "depth", ")", "\n", "print", "(", "self", ".", "net", ")", "\n", "if", "depth", "==", "0", ":", "\n", "            ", "document", "=", "self", ".", "_doc_embed", "(", "train_ds", ",", "0", ",", "self", ".", "net", ".", "depth_node", ",", "True", ")", "\n", "train_ds", ".", "feature_type", "=", "\"dense\"", "\n", "train_ds", ".", "features", "=", "feat", ".", "construct", "(", "\"\"", ",", "\"\"", ",", "document", ",", "False", ",", "\"dense\"", ")", "\n", "\n", "document", "=", "self", ".", "_doc_embed", "(", "valid_ds", ",", "0", ",", "self", ".", "net", ".", "depth_node", ",", "True", ")", "\n", "valid_ds", ".", "feature_type", "=", "\"dense\"", "\n", "valid_ds", ".", "features", "=", "feat", ".", "construct", "(", "\"\"", ",", "\"\"", ",", "document", ",", "False", ",", "\"dense\"", ")", "\n", "\n", "", "self", ".", "learning_rate", "=", "self", ".", "lrs", "[", "depth", "]", "\n", "self", ".", "dlr_step", "=", "self", ".", "dlr_steps", "[", "depth", "]", "\n", "self", ".", "optimizer", ".", "learning_rate", "=", "self", ".", "lrs", "[", "depth", "]", "\n", "self", ".", "optimizer", ".", "construct", "(", "self", ".", "net", ".", "depth_node", ",", "None", ")", "\n", "train_ds", ".", "mode", "=", "'train'", "\n", "return", "self", ".", "_prep_dl_for_depth", "(", "depth", ",", "train_ds", ",", "valid_ds", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model.ModelECLAREfe.get_lbl_cent": [[65, 73], ["model.ModelECLAREfe.net._get_encoder", "sklearn.preprocessing.normalize", "sklearn.preprocessing.normalize", "model.ModelECLAREfe._doc_embed", "y.transpose().dot", "y.transpose"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._get_encoder", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.normalize", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.normalize", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._doc_embed", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.transpose"], ["", "def", "get_lbl_cent", "(", "self", ",", "dataset", ")", ":", "\n", "        ", "encoder", "=", "self", ".", "net", ".", "_get_encoder", "(", ")", "\n", "dataset", ".", "mode", "=", "\"test\"", "\n", "docs", "=", "normalize", "(", "self", ".", "_doc_embed", "(", "dataset", ",", "0", ",", "encoder", ",", "True", ")", ")", "\n", "dataset", ".", "mode", "=", "\"train\"", "\n", "y", "=", "dataset", ".", "labels", ".", "Y", "\n", "lbl_cnt", "=", "normalize", "(", "y", ".", "transpose", "(", ")", ".", "dot", "(", "docs", ")", ")", "\n", "return", "lbl_cnt", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model.ModelECLAREfe.predict": [[74, 95], ["model.ModelECLAREfe.net.load", "model.ModelECLAREfe._create_dataset", "model.ModelECLAREfe.net._get_encoder", "model.ModelECLAREfe._doc_embed", "libs.construct", "model.ModelECLAREfe._predict", "model.ModelECLAREfe._print_stats", "os.path.join"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._create_dataset", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._get_encoder", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._doc_embed", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.construct", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._predict", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._print_stats"], ["", "def", "predict", "(", "self", ",", "data_dir", ",", "model_dir", ",", "dataset", ",", "data", "=", "None", ",", "\n", "ts_feat_fname", "=", "'tst_X_Xf.txt'", ",", "ts_label_fname", "=", "'tst_X_Y.txt'", ",", "\n", "batch_size", "=", "256", ",", "num_workers", "=", "6", ",", "keep_invalid", "=", "False", ",", "\n", "feature_indices", "=", "None", ",", "label_indices", "=", "None", ",", "\n", "normalize_features", "=", "True", ",", "normalize_labels", "=", "False", ",", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "net", ".", "load", "(", "fname", "=", "model_dir", ")", "\n", "dataset", "=", "self", ".", "_create_dataset", "(", "\n", "os", ".", "path", ".", "join", "(", "data_dir", ",", "dataset", ")", ",", "fname_features", "=", "ts_feat_fname", ",", "\n", "fname_labels", "=", "ts_label_fname", ",", "data", "=", "data", ",", "\n", "keep_invalid", "=", "keep_invalid", ",", "normalize_features", "=", "normalize_features", ",", "\n", "normalize_labels", "=", "normalize_labels", ",", "mode", "=", "'test'", ",", "\n", "feature_indices", "=", "feature_indices", ",", "label_indices", "=", "label_indices", ")", "\n", "\n", "encoder", "=", "self", ".", "net", ".", "_get_encoder", "(", ")", "\n", "docs", "=", "self", ".", "_doc_embed", "(", "dataset", ",", "0", ",", "encoder", ",", "True", ")", "\n", "dataset", ".", "feature_type", "=", "\"dense\"", "\n", "dataset", ".", "features", "=", "feat", ".", "construct", "(", "\"\"", ",", "\"\"", ",", "docs", ",", "False", ",", "\"dense\"", ")", "\n", "predicted_labels", ",", "_", "=", "self", ".", "_predict", "(", "dataset", ",", "model_dir", ",", "**", "kwargs", ")", "\n", "\n", "self", ".", "_print_stats", "(", "dataset", ".", "labels", ".", "ground_truth", ",", "predicted_labels", ")", "\n", "return", "predicted_labels", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase.__init__": [[36, 52], ["shortlist_handler.ShortlistHandlerBase._create_partitioner", "shortlist_handler.ShortlistHandlerBase.partitioner.get_padding_indices"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase._create_partitioner"], ["def", "__init__", "(", "self", ",", "num_labels", ",", "model_dir", "=", "''", ",", "\n", "num_clf_partitions", "=", "1", ",", "mode", "=", "'train'", ",", "\n", "size_shortlist", "=", "-", "1", ",", "num_centroids", "=", "1", ",", "\n", "label_mapping", "=", "None", ")", ":", "\n", "        ", "self", ".", "model_dir", "=", "model_dir", "\n", "self", ".", "num_centroids", "=", "num_centroids", "\n", "self", ".", "num_clf_partitions", "=", "num_clf_partitions", "\n", "self", ".", "size_shortlist", "=", "size_shortlist", "\n", "self", ".", "mode", "=", "mode", "\n", "self", ".", "num_labels", "=", "num_labels", "\n", "self", ".", "label_mapping", "=", "label_mapping", "\n", "# self._create_shortlist(shortlist)", "\n", "self", ".", "_create_partitioner", "(", ")", "\n", "self", ".", "label_padding_index", "=", "self", ".", "num_labels", "\n", "if", "self", ".", "num_clf_partitions", ">", "1", ":", "\n", "            ", "self", ".", "label_padding_index", "=", "self", ".", "partitioner", ".", "get_padding_indices", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase._create_shortlist": [[53, 58], ["None"], "methods", ["None"], ["", "", "def", "_create_shortlist", "(", "self", ",", "shortlist", ")", ":", "\n", "        ", "\"\"\"\n            Create structure to hold shortlist\n        \"\"\"", "\n", "self", ".", "shortlist", "=", "shortlist", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase.query": [[59, 61], ["shortlist_handler.ShortlistHandlerBase.shortlist"], "methods", ["None"], ["", "def", "query", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "shortlist", "(", "*", "args", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase._create_partitioner": [[62, 80], ["Partitioner", "shortlist_handler.ShortlistHandlerBase.partitioner.save", "Partitioner", "shortlist_handler.ShortlistHandlerBase.partitioner.load", "os.path.join", "os.path.join"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree.save", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load"], ["", "def", "_create_partitioner", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n            Create partiotionar to for splitted classifier\n        \"\"\"", "\n", "self", ".", "partitioner", "=", "None", "\n", "if", "self", ".", "num_clf_partitions", ">", "1", ":", "\n", "            ", "if", "self", ".", "mode", "==", "'train'", ":", "\n", "                ", "self", ".", "partitioner", "=", "Partitioner", "(", "\n", "self", ".", "num_labels", ",", "self", ".", "num_clf_partitions", ",", "\n", "padding", "=", "False", ",", "contiguous", "=", "True", ")", "\n", "self", ".", "partitioner", ".", "save", "(", "os", ".", "path", ".", "join", "(", "\n", "self", ".", "model_dir", ",", "'partitionar.pkl'", ")", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "partitioner", "=", "Partitioner", "(", "\n", "self", ".", "num_labels", ",", "self", ".", "num_clf_partitions", ",", "\n", "padding", "=", "False", ",", "contiguous", "=", "True", ")", "\n", "self", ".", "partitioner", ".", "load", "(", "os", ".", "path", ".", "join", "(", "\n", "self", ".", "model_dir", ",", "'partitionar.pkl'", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase._pad_seq": [[81, 85], ["indices.extend", "dist.extend", "len"], "methods", ["None"], ["", "", "", "def", "_pad_seq", "(", "self", ",", "indices", ",", "dist", ")", ":", "\n", "        ", "_pad_length", "=", "self", ".", "size_shortlist", "-", "len", "(", "indices", ")", "\n", "indices", ".", "extend", "(", "[", "self", ".", "label_padding_index", "]", "*", "_pad_length", ")", "\n", "dist", ".", "extend", "(", "[", "100", "]", "*", "_pad_length", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase._remap_multiple_representations": [[86, 101], ["numpy.asarray", "dict", "enumerate", "zip", "list", "_func", "list", "list", "len", "shortlist_handler.ShortlistHandlerBase._pad_seq", "map", "dict.get", "dict.items"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase._pad_seq"], ["", "def", "_remap_multiple_representations", "(", "self", ",", "indices", ",", "vals", ",", "\n", "_func", "=", "min", ",", "_limit", "=", "1e5", ")", ":", "\n", "        ", "\"\"\"\n            Remap multiple centroids to original labels\n        \"\"\"", "\n", "indices", "=", "np", ".", "asarray", "(", "\n", "list", "(", "map", "(", "lambda", "x", ":", "self", ".", "label_mapping", "[", "x", "]", ",", "indices", ")", ")", ")", "\n", "_dict", "=", "dict", "(", "{", "}", ")", "\n", "for", "id", ",", "ind", "in", "enumerate", "(", "indices", ")", ":", "\n", "            ", "_dict", "[", "ind", "]", "=", "_func", "(", "_dict", ".", "get", "(", "ind", ",", "_limit", ")", ",", "vals", "[", "id", "]", ")", "\n", "", "indices", ",", "values", "=", "zip", "(", "*", "_dict", ".", "items", "(", ")", ")", "\n", "indices", ",", "values", "=", "list", "(", "indices", ")", ",", "list", "(", "values", ")", "\n", "if", "len", "(", "indices", ")", "<", "self", ".", "size_shortlist", ":", "\n", "            ", "self", ".", "_pad_seq", "(", "indices", ",", "values", ")", "\n", "", "return", "indices", ",", "values", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase._adjust_shortlist": [[102, 129], ["list", "set", "enumerate", "numpy.asarray", "numpy.asarray", "numpy.asarray", "len", "numpy.random.choice", "list", "filter", "len", "len", "len", "len", "operator.itemgetter", "set"], "methods", ["None"], ["", "def", "_adjust_shortlist", "(", "self", ",", "pos_labels", ",", "shortlist", ",", "dist", ",", "min_nneg", "=", "100", ")", ":", "\n", "        ", "\"\"\"\n            Adjust shortlist for a instance\n            Training: Add positive labels to the shortlist\n            Inference: Return shortlist with label mask\n        \"\"\"", "\n", "if", "self", ".", "mode", "==", "'train'", ":", "\n", "# TODO: Adjust dist as well", "\n", "# If number of positives are more than shortlist_size", "\n", "            ", "if", "len", "(", "pos_labels", ")", ">", "self", ".", "size_shortlist", ":", "\n", "                ", "_ind", "=", "np", ".", "random", ".", "choice", "(", "\n", "len", "(", "pos_labels", ")", ",", "size", "=", "self", ".", "size_shortlist", "-", "min_nneg", ",", "replace", "=", "False", ")", "\n", "pos_labels", "=", "list", "(", "operator", ".", "itemgetter", "(", "*", "_ind", ")", "(", "pos_labels", ")", ")", "\n", "", "neg_labels", "=", "list", "(", "\n", "filter", "(", "lambda", "x", ":", "x", "not", "in", "set", "(", "pos_labels", ")", ",", "shortlist", ")", ")", "\n", "diff", "=", "self", ".", "size_shortlist", "-", "len", "(", "pos_labels", ")", "\n", "labels_mask", "=", "[", "1", "]", "*", "len", "(", "pos_labels", ")", "\n", "dist", "=", "[", "2", "]", "*", "len", "(", "pos_labels", ")", "+", "dist", "[", ":", "diff", "]", "\n", "shortlist", "=", "pos_labels", "+", "neg_labels", "[", ":", "diff", "]", "\n", "labels_mask", "=", "labels_mask", "+", "[", "0", "]", "*", "diff", "\n", "", "else", ":", "\n", "            ", "labels_mask", "=", "[", "0", "]", "*", "self", ".", "size_shortlist", "\n", "pos_labels", "=", "set", "(", "pos_labels", ")", "\n", "for", "idx", ",", "item", "in", "enumerate", "(", "shortlist", ")", ":", "\n", "                ", "if", "item", "in", "pos_labels", ":", "\n", "                    ", "labels_mask", "[", "idx", "]", "=", "1", "\n", "", "", "", "return", "np", ".", "asarray", "(", "shortlist", ")", ",", "np", ".", "asarray", "(", "labels_mask", ")", ",", "np", ".", "asarray", "(", "dist", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase._get_sl_one": [[130, 141], ["shortlist_handler.ShortlistHandlerBase.query", "shortlist_handler.ShortlistHandlerBase._adjust_shortlist"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerSimple.query", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase._adjust_shortlist"], ["", "def", "_get_sl_one", "(", "self", ",", "index", ",", "pos_labels", ")", ":", "\n", "        ", "if", "self", ".", "shortlist", ".", "data_init", ":", "\n", "            ", "shortlist", ",", "dist", "=", "self", ".", "query", "(", "index", ")", "\n", "# Remap to original labels if multiple centroids are used", "\n", "shortlist", ",", "labels_mask", ",", "dist", "=", "self", ".", "_adjust_shortlist", "(", "\n", "pos_labels", ",", "shortlist", ",", "dist", ")", "\n", "", "else", ":", "\n", "            ", "shortlist", "=", "[", "0", "]", "*", "self", ".", "size_shortlist", "\n", "labels_mask", "=", "[", "0", "]", "*", "self", ".", "size_shortlist", "\n", "dist", "=", "[", "0", "]", "*", "self", ".", "size_shortlist", "\n", "", "return", "shortlist", ",", "labels_mask", ",", "dist", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase._get_sl_partitioned": [[142, 166], ["shortlist_handler.ShortlistHandlerBase.partitioner.split_indices", "shortlist_handler.ShortlistHandlerBase.query", "range", "range", "shortlist_handler.ShortlistHandlerBase._adjust_shortlist", "shortlist.append", "labels_mask.append", "dist.append", "shortlist_handler.ShortlistHandlerBase.partitioner.map_to_original", "shortlist.append", "labels_mask.append", "dist.append", "_shortlist[].tolist", "_dist[].tolist"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerSimple.query", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase._adjust_shortlist", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.tools.merge_split_predictions.CombineResults.map_to_original"], ["", "def", "_get_sl_partitioned", "(", "self", ",", "index", ",", "pos_labels", ")", ":", "\n", "# Partition labels", "\n", "        ", "pos_labels", "=", "self", ".", "partitioner", ".", "split_indices", "(", "pos_labels", ")", "\n", "if", "self", ".", "shortlist", ".", "data_init", ":", "# Shortlist is initialized", "\n", "            ", "_shortlist", ",", "_dist", "=", "self", ".", "query", "(", "index", ")", "\n", "shortlist", ",", "labels_mask", ",", "dist", ",", "rev_map", "=", "[", "]", ",", "[", "]", ",", "[", "]", ",", "[", "]", "\n", "# Get shortlist for each classifier", "\n", "for", "idx", "in", "range", "(", "self", ".", "num_clf_partitions", ")", ":", "\n", "                ", "__shortlist", ",", "__labels_mask", ",", "__dist", "=", "self", ".", "_adjust_shortlist", "(", "\n", "pos_labels", "[", "idx", "]", ",", "\n", "_shortlist", "[", "idx", "]", ".", "tolist", "(", ")", ",", "\n", "_dist", "[", "idx", "]", ".", "tolist", "(", ")", ")", "\n", "shortlist", ".", "append", "(", "__shortlist", ")", "\n", "labels_mask", ".", "append", "(", "__labels_mask", ")", "\n", "dist", ".", "append", "(", "__dist", ")", "\n", "rev_map", "+=", "self", ".", "partitioner", ".", "map_to_original", "(", "__shortlist", ",", "idx", ")", "\n", "", "", "else", ":", "# Shortlist is un-initialized", "\n", "            ", "shortlist", ",", "labels_mask", ",", "dist", "=", "[", "]", ",", "[", "]", ",", "[", "]", "\n", "for", "idx", "in", "range", "(", "self", ".", "num_clf_partitions", ")", ":", "\n", "                ", "shortlist", ".", "append", "(", "[", "0", "]", "*", "self", ".", "size_shortlist", ")", "\n", "labels_mask", ".", "append", "(", "[", "0", "]", "*", "self", ".", "size_shortlist", ")", "\n", "dist", ".", "append", "(", "[", "0", "]", "*", "self", ".", "size_shortlist", ")", "\n", "", "rev_map", "=", "[", "0", "]", "*", "self", ".", "size_shortlist", "*", "self", ".", "num_clf_partitions", "# Dummy", "\n", "", "return", "shortlist", ",", "labels_mask", ",", "dist", ",", "rev_map", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase.get_shortlist": [[167, 175], ["shortlist_handler.ShortlistHandlerBase._get_sl_partitioned", "shortlist_handler.ShortlistHandlerBase._get_sl_one"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase._get_sl_partitioned", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerSimple._get_sl_one"], ["", "def", "get_shortlist", "(", "self", ",", "index", ",", "pos_labels", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n            Get data with shortlist for given data index\n        \"\"\"", "\n", "if", "self", ".", "num_clf_partitions", ">", "1", ":", "\n", "            ", "return", "self", ".", "_get_sl_partitioned", "(", "index", ",", "pos_labels", ")", "\n", "", "else", ":", "\n", "            ", "return", "self", ".", "_get_sl_one", "(", "index", ",", "pos_labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerBase.get_partition_indices": [[176, 178], ["shortlist_handler.ShortlistHandlerBase.partitioner.get_indices"], "methods", ["None"], ["", "", "def", "get_partition_indices", "(", "self", ",", "index", ")", ":", "\n", "        ", "return", "self", ".", "partitioner", ".", "get_indices", "(", "index", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerSimple.__init__": [[205, 213], ["shortlist_handler.ShortlistHandlerBase.__init__", "shortlist_handler.ShortlistHandlerSimple._create_shortlist", "print"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerSimple._create_shortlist"], ["def", "__init__", "(", "self", ",", "num_labels", ",", "model_dir", "=", "''", ",", "num_clf_partitions", "=", "1", ",", "\n", "mode", "=", "'train'", ",", "size_shortlist", "=", "-", "1", ",", "num_centroids", "=", "1", ",", "\n", "in_memory", "=", "True", ",", "label_mapping", "=", "None", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "num_labels", ",", "model_dir", ",", "num_clf_partitions", ",", "\n", "mode", ",", "size_shortlist", ",", "num_centroids", ",", "label_mapping", ")", "\n", "self", ".", "in_memory", "=", "in_memory", "\n", "self", ".", "_create_shortlist", "(", ")", "\n", "print", "(", "\"Simple: This is a simple shortlist handler\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerSimple.query": [[214, 217], ["None"], "methods", ["None"], ["", "def", "query", "(", "self", ",", "index", ")", ":", "\n", "        ", "shorty", "=", "self", ".", "shortlist", "[", "index", "]", "\n", "return", "shorty", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerSimple._get_sl_one": [[218, 220], ["None"], "methods", ["None"], ["", "def", "_get_sl_one", "(", "self", ",", "index", ",", "pos_labels", ")", ":", "\n", "        ", "return", "self", ".", "shortlist", "[", "index", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerSimple._create_shortlist": [[221, 226], ["None"], "methods", ["None"], ["", "def", "_create_shortlist", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n            Create structure to hold shortlist\n        \"\"\"", "\n", "self", ".", "shortlist", "=", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerSimple.update_shortlist": [[227, 234], ["print"], "methods", ["None"], ["", "def", "update_shortlist", "(", "self", ",", "shortlist", ",", "random_neg", "=", "-", "1", ")", ":", "\n", "        ", "\"\"\"\n            Update label shortlist for each instance\n        \"\"\"", "\n", "self", ".", "shortlist", "=", "shortlist", "\n", "n_inst", ",", "_", "=", "shortlist", ".", "shape", "\n", "print", "(", "\"Average shortlist size\"", ",", "shortlist", ".", "nnz", "/", "n_inst", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerSimple.__len__": [[235, 237], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "shortlist", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.shortlist_handler.ShortlistHandlerSimple.__getitem__": [[238, 240], ["None"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "index", ")", ":", "\n", "        ", "return", "self", ".", "shortlist", "[", "index", "]", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.__init__": [[23, 33], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "opt_type", "=", "'Adam'", ",", "learning_rate", "=", "0.01", ",", "\n", "momentum", "=", "0.9", ",", "weight_decay", "=", "0.0", ",", "nesterov", "=", "True", ",", "\n", "freeze_embeddings", "=", "False", ")", ":", "\n", "        ", "self", ".", "opt_type", "=", "opt_type", "\n", "self", ".", "optimizer", "=", "[", "]", "\n", "self", ".", "weight_decay", "=", "weight_decay", "\n", "self", ".", "learning_rate", "=", "learning_rate", "\n", "self", ".", "momentum", "=", "momentum", "\n", "self", ".", "nesterov", "=", "nesterov", "\n", "self", ".", "freeze_embeddings", "=", "freeze_embeddings", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer._get_opt": [[34, 56], ["SparseSGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "NotImplementedError", "torch.optim.SparseAdam", "torch.optim.SparseAdam", "torch.optim.SparseAdam", "torch.optim.SparseAdam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam"], "methods", ["None"], ["", "def", "_get_opt", "(", "self", ",", "params", ",", "is_sparse", ")", ":", "\n", "        ", "if", "self", ".", "opt_type", "==", "'SGD'", ":", "\n", "            ", "if", "is_sparse", ":", "\n", "                ", "return", "SparseSGD", "(", "\n", "params", ",", "\n", "lr", "=", "self", ".", "learning_rate", ",", "\n", "momentum", "=", "self", ".", "momentum", ",", "\n", ")", "\n", "", "else", ":", "\n", "                ", "return", "torch", ".", "optim", ".", "SGD", "(", "\n", "params", ",", "\n", "lr", "=", "self", ".", "learning_rate", ",", "\n", "momentum", "=", "self", ".", "momentum", ",", "\n", "weight_decay", "=", "self", ".", "weight_decay", "\n", ")", "\n", "", "", "elif", "self", ".", "opt_type", "==", "'Adam'", ":", "\n", "            ", "if", "is_sparse", ":", "\n", "                ", "return", "torch", ".", "optim", ".", "SparseAdam", "(", "params", ")", "\n", "", "else", ":", "\n", "                ", "return", "torch", ".", "optim", ".", "Adam", "(", "params", ")", "\n", "", "", "else", ":", "\n", "            ", "raise", "NotImplementedError", "(", "\"Unknown optimizer!\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.construct": [[57, 76], ["optimizer_utils.Optimizer.get_params", "optimizer_utils.Optimizer.clear", "enumerate", "zip", "optimizer_utils.Optimizer.optimizer.append", "optimizer_utils.Optimizer.optimizer.append", "optimizer_utils.Optimizer._get_opt"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.get_params", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.clear", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer._get_opt"], ["", "", "def", "construct", "(", "self", ",", "model", ",", "lr", "=", "0.01", ")", ":", "\n", "        ", "\"\"\"\n            Get optimizer.\n            Args:\n                model: torch.nn.Module: network\n                params: : parameters\n                freeze_embeddings: boolean: specify if embeddings need to be trained\n            Returns:\n                optimizer: torch.optim: optimizer as per given specifications  \n        \"\"\"", "\n", "model_params", ",", "is_sparse", "=", "self", ".", "get_params", "(", "model", ",", "lr", ")", "\n", "self", ".", "clear", "(", ")", "\n", "self", ".", "optimizer", "=", "[", "]", "\n", "for", "_", ",", "item", "in", "enumerate", "(", "zip", "(", "model_params", ",", "is_sparse", ")", ")", ":", "\n", "            ", "if", "item", "[", "0", "]", ":", "\n", "                ", "self", ".", "optimizer", ".", "append", "(", "self", ".", "_get_opt", "(", "\n", "params", "=", "item", "[", "0", "]", ",", "is_sparse", "=", "item", "[", "1", "]", ")", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "optimizer", ".", "append", "(", "None", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.adjust_lr": [[77, 89], ["param_group.keys"], "methods", ["None"], ["", "", "", "def", "adjust_lr", "(", "self", ",", "dlr_factor", ")", ":", "\n", "        ", "\"\"\"\n            Adjust learning rate\n            Args:\n                dlr_factor: float: dynamic learning rate factor\n        \"\"\"", "\n", "for", "opt", "in", "self", ".", "optimizer", ":", "\n", "            ", "if", "opt", ":", "\n", "                ", "for", "param_group", "in", "opt", ".", "param_groups", ":", "\n", "                    ", "param_group", "[", "'lr'", "]", "*=", "dlr_factor", "\n", "if", "'weight_decay'", "in", "param_group", ".", "keys", "(", ")", ":", "\n", "                        ", "param_group", "[", "'weight_decay'", "]", "*=", "dlr_factor", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.clear": [[90, 94], ["None"], "methods", ["None"], ["", "", "", "", "", "def", "clear", "(", "self", ")", ":", "\n", "        ", "for", "opt", "in", "self", ".", "optimizer", ":", "\n", "            ", "if", "opt", ":", "\n", "                ", "del", "opt", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.step": [[95, 99], ["opt.step"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.step"], ["", "", "", "def", "step", "(", "self", ")", ":", "\n", "        ", "for", "opt", "in", "self", ".", "optimizer", ":", "\n", "            ", "if", "opt", ":", "\n", "                ", "opt", ".", "step", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.zero_grad": [[100, 104], ["opt.zero_grad"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.zero_grad"], ["", "", "", "def", "zero_grad", "(", "self", ")", ":", "\n", "        ", "for", "opt", "in", "self", ".", "optimizer", ":", "\n", "            ", "if", "opt", ":", "\n", "                ", "opt", ".", "zero_grad", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.load_state_dict": [[105, 109], ["enumerate", "optimizer_utils.Optimizer.optimizer[].load_state_dict"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.load_state_dict"], ["", "", "", "def", "load_state_dict", "(", "self", ",", "sd", ")", ":", "\n", "        ", "for", "idx", ",", "item", "in", "enumerate", "(", "sd", ")", ":", "\n", "            ", "if", "item", ":", "\n", "                ", "self", ".", "optimizer", "[", "idx", "]", ".", "load_state_dict", "(", "item", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.state_dict": [[110, 118], ["out_states.append", "out_states.append", "item.state_dict"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.state_dict"], ["", "", "", "def", "state_dict", "(", "self", ")", ":", "\n", "        ", "out_states", "=", "[", "]", "\n", "for", "item", "in", "self", ".", "optimizer", ":", "\n", "            ", "if", "item", ":", "\n", "                ", "out_states", ".", "append", "(", "item", ".", "state_dict", "(", ")", ")", "\n", "", "else", ":", "\n", "                ", "out_states", ".", "append", "(", "None", ")", "\n", "", "", "return", "out_states", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.get_params": [[119, 145], ["list", "list", "list", "module_dict.items", "net.embed.parameters", "val.__dict__.get", "val.__dict__.get", "val.named_parameters", "optimizer_utils.Optimizer.net_params[].append", "optimizer_utils.Optimizer.net_params[].append", "list", "params.size", "list", "params.size"], "methods", ["None"], ["", "def", "get_params", "(", "self", ",", "net", ",", "args", ")", ":", "\n", "        ", "self", ".", "net_params", "=", "{", "}", "\n", "self", ".", "net_params", "[", "'sparse'", "]", "=", "list", "(", ")", "\n", "self", ".", "net_params", "[", "'dense'", "]", "=", "list", "(", ")", "\n", "self", ".", "net_params", "[", "'no_grad'", "]", "=", "list", "(", ")", "\n", "if", "self", ".", "freeze_embeddings", ":", "\n", "            ", "for", "params", "in", "net", ".", "embed", ".", "parameters", "(", ")", ":", "\n", "                ", "params", ".", "requires_grad", "=", "False", "\n", "", "", "module_dict", "=", "net", ".", "__dict__", "[", "'_modules'", "]", "\n", "for", "m_name", ",", "val", "in", "module_dict", ".", "items", "(", ")", ":", "\n", "            ", "is_sparse", "=", "val", ".", "__dict__", ".", "get", "(", "\"sparse\"", ",", "False", ")", "\n", "is_decay", "=", "val", ".", "__dict__", ".", "get", "(", "\"weight_decay\"", ",", "False", ")", "\n", "lr", "=", "self", ".", "learning_rate", "\n", "for", "p_name", ",", "params", "in", "val", ".", "named_parameters", "(", ")", ":", "\n", "                ", "_decay", ",", "key", "=", "0", ",", "\"dense\"", "\n", "if", "list", "(", "params", ".", "size", "(", ")", ")", "[", "0", "]", ">", "1000", ":", "\n", "                    ", "_decay", "=", "self", ".", "weight_decay", "if", "is_decay", "else", "0", "\n", "", "if", "params", ".", "requires_grad", ":", "\n", "                    ", "if", "is_sparse", "and", "list", "(", "params", ".", "size", "(", ")", ")", "[", "0", "]", ">", "1000", ":", "\n", "                        ", "key", "=", "\"sparse\"", "\n", "", "self", ".", "net_params", "[", "key", "]", ".", "append", "(", "\n", "{", "\"params\"", ":", "params", ",", "\"lr\"", ":", "lr", ",", "\"weight_decay\"", ":", "_decay", "}", ")", "\n", "", "else", ":", "\n", "                    ", "self", ".", "net_params", "[", "'no_grad'", "]", ".", "append", "(", "params", ")", "\n", "", "", "", "return", "[", "self", ".", "net_params", "[", "'sparse'", "]", ",", "self", ".", "net_params", "[", "'dense'", "]", "]", ",", "[", "True", ",", "False", "]", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.__init__": [[20, 53], ["model_base.ModelBase.get_logger", "libs.utils.load_overlap", "tracking.Tracking", "os.path.join"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.get_logger", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.load_overlap"], ["    ", "def", "__init__", "(", "self", ",", "params", ",", "net", ",", "criterion", ",", "optimizer", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "net", "=", "net", "\n", "self", ".", "criterion", "=", "criterion", "\n", "self", ".", "optimizer", "=", "optimizer", "\n", "self", ".", "learning_rate", "=", "0.001", "\n", "self", ".", "current_epoch", "=", "0", "\n", "self", ".", "last_saved_epoch", "=", "-", "1", "\n", "self", ".", "model_dir", "=", "params", ".", "model_dir", "\n", "self", ".", "label_padding_index", "=", "params", ".", "label_padding_index", "\n", "self", ".", "last_epoch", "=", "0", "\n", "self", ".", "feature_type", "=", "params", ".", "feature_type", "\n", "self", ".", "shortlist_size", "=", "-", "1", "\n", "self", ".", "dlr_step", "=", "0", "\n", "self", ".", "dlr_factor", "=", "params", ".", "dlr_factor", "\n", "self", ".", "progress_step", "=", "500", "\n", "self", ".", "verbose_lbs", "=", "params", ".", "verbose", "\n", "self", ".", "freeze_embeddings", "=", "params", ".", "freeze_embeddings", "\n", "self", ".", "model_fname", "=", "params", ".", "model_fname", "\n", "self", ".", "tree_idx", "=", "params", ".", "tree_idx", "+", "1", "\n", "self", ".", "logger", "=", "self", ".", "get_logger", "(", "name", "=", "self", ".", "model_fname", ")", "\n", "self", ".", "embedding_dims", "=", "params", ".", "embedding_dims", "\n", "self", ".", "filter_docs", ",", "self", ".", "filter_lbls", "=", "load_overlap", "(", "\n", "os", ".", "path", ".", "join", "(", "params", ".", "data_dir", ",", "params", ".", "dataset", ")", ",", "\n", "params", ".", "label_indices", ",", "filter_label_file", "=", "params", ".", "filter_labels", ")", "\n", "self", ".", "method", "=", "params", ".", "cluster_method", "\n", "self", ".", "lrs", "=", "params", ".", "depth_lrs", "\n", "self", ".", "call_back", "=", "params", ".", "call_backs", "\n", "self", ".", "beam", "=", "params", ".", "beam_size", "\n", "self", ".", "batch_size", "=", "params", ".", "batch_sizes", "\n", "self", ".", "dlr_steps", "=", "params", ".", "dlr_steps", "\n", "self", ".", "model_dir", "=", "params", ".", "model_dir", "\n", "self", ".", "traverse", "=", "params", ".", "traverse", "\n", "self", ".", "tracking", "=", "Tracking", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.transfer_to_devices": [[54, 56], ["model_base.ModelBase.net.to"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to"], ["", "def", "transfer_to_devices", "(", "self", ")", ":", "\n", "        ", "self", ".", "net", ".", "to", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_ds": [[57, 67], ["model_base.ModelBase.net._clusters", "_dataset._prep_for_depth", "_dataset.build_shortlist", "model_base.ModelBase._prep_dl", "model_base.ModelBase._predict_depth", "model_base.ModelBase._print_stats", "numpy.bool"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase._clusters", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_for_depth", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.DatasetGraph.build_shortlist", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_dl", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._predict_depth", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._print_stats"], ["", "def", "_prep_ds", "(", "self", ",", "depth", ",", "_dataset", ",", "mode", "=", "'train'", ")", ":", "\n", "        ", "_pred", ",", "trav", "=", "None", ",", "self", ".", "traverse", "\n", "if", "depth", ">", "0", ":", "\n", "            ", "_dataloader", "=", "self", ".", "_prep_dl", "(", "\n", "depth", "-", "1", ",", "_dataset", ",", "mode", "=", "'test'", ",", "traverse", "=", "trav", ")", "\n", "_pred", ",", "_", "=", "self", ".", "_predict_depth", "(", "depth", "-", "1", ",", "_dataloader", ",", "trav", ")", "\n", "self", ".", "_print_stats", "(", "_dataset", ".", "labels", ".", "ground_truth", ",", "_pred", ")", "\n", "", "clusters", "=", "self", ".", "net", ".", "_clusters", "(", "depth", ")", "\n", "_dataset", ".", "_prep_for_depth", "(", "np", ".", "bool", "(", "depth", ">", "0", ")", ",", "clusters", ")", "\n", "_dataset", ".", "build_shortlist", "(", "_pred", ",", "self", ".", "net", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._traverse_graph": [[68, 89], ["model_base.ModelBase.logger.info", "numpy.exp", "numpy.ceil", "enumerate", "scipy.vstack().tocsr", "print", "shorty.tocsr.tocsr.tocsr", "print", "numpy.log", "range", "time.time", "model_base.ModelBase.net.traverse_graph", "mats.append", "numpy.min", "numpy.max", "shorty.tocsr.tocsr.multiply", "scipy.vstack().tocsr.multiply", "numpy.min", "numpy.max", "model_base.ModelBase.logger.info", "min", "time.time", "xclib.utils.sparse.retain_topk", "scipy.vstack"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.traverse_graph"], ["", "def", "_traverse_graph", "(", "self", ",", "shorty", ",", "k", ",", "batch", "=", "512", ")", ":", "\n", "        ", "self", ".", "logger", ".", "info", "(", "\"Traversing graph: %d\"", "%", "k", ")", "\n", "num_inst", ",", "_", "=", "shorty", ".", "shape", "\n", "shorty", ".", "data", "[", ":", "]", "=", "np", ".", "exp", "(", "shorty", ".", "data", ")", "\n", "batches_inst", "=", "np", ".", "ceil", "(", "num_inst", "/", "batch", ")", "\n", "mats", ",", "batch_pred_time", "=", "[", "]", ",", "0", "\n", "for", "idx", ",", "i", "in", "enumerate", "(", "range", "(", "0", ",", "num_inst", ",", "batch", ")", ")", ":", "\n", "            ", "if", "idx", "%", "500", "==", "0", ":", "\n", "                ", "self", ".", "logger", ".", "info", "(", "\"Traversing [%d/%d]\"", "%", "(", "idx", ",", "batches_inst", ")", ")", "\n", "", "start", ",", "end", "=", "i", ",", "min", "(", "i", "+", "batch", ",", "num_inst", ")", "\n", "begin", "=", "time", ".", "time", "(", ")", "\n", "sub_mat", "=", "self", ".", "net", ".", "traverse_graph", "(", "shorty", "[", "start", ":", "end", "]", ")", "\n", "batch_pred_time", "+=", "time", ".", "time", "(", ")", "-", "begin", "\n", "mats", ".", "append", "(", "retain_topk", "(", "sub_mat", ",", "k", "=", "k", ")", ")", "\n", "", "t_shorty", "=", "sp", ".", "vstack", "(", "mats", ")", ".", "tocsr", "(", ")", "\n", "print", "(", "\"After traversing\"", ",", "np", ".", "min", "(", "t_shorty", ".", "data", ")", ",", "np", ".", "max", "(", "t_shorty", ".", "data", ")", ")", "\n", "shorty", "=", "shorty", ".", "multiply", "(", "0.5", ")", "+", "t_shorty", ".", "multiply", "(", "0.5", ")", "\n", "shorty", "=", "shorty", ".", "tocsr", "(", ")", "\n", "print", "(", "\"After traversing\"", ",", "np", ".", "min", "(", "shorty", ".", "data", ")", ",", "np", ".", "max", "(", "shorty", ".", "data", ")", ")", "\n", "shorty", ".", "data", "[", ":", "]", "=", "np", ".", "log", "(", "shorty", ".", "data", ")", "\n", "return", "shorty", ",", "batch_pred_time", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_dl": [[90, 102], ["model_base.ModelBase._create_dl", "model_base.ModelBase._create_dl", "numpy.bool", "numpy.bool"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._create_dl", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._create_dl"], ["", "def", "_prep_dl", "(", "self", ",", "d", ",", "_dataset", ",", "mode", ",", "traverse", "=", "False", ")", ":", "\n", "        ", "if", "mode", "==", "\"train\"", ":", "\n", "            ", "return", "self", ".", "_create_dl", "(", "_dataset", ",", "batch_size", "=", "self", ".", "batch_size", "[", "d", "]", ",", "\n", "num_workers", "=", "6", ",", "shuffle", "=", "True", ",", "\n", "mode", "=", "mode", ",", "use_shortlist", "=", "np", ".", "bool", "(", "d", ">", "0", ")", ",", "\n", "sparse_label_fts", "=", "self", ".", "net", ".", "label_words", ",", "\n", "sparse_graph_fts", "=", "self", ".", "net", ".", "graph", ")", "\n", "\n", "", "else", ":", "\n", "            ", "return", "self", ".", "_create_dl", "(", "_dataset", ",", "batch_size", "=", "self", ".", "batch_size", "[", "d", "]", ",", "\n", "num_workers", "=", "6", ",", "shuffle", "=", "False", ",", "traverse", "=", "False", ",", "\n", "mode", "=", "mode", ",", "use_shortlist", "=", "np", ".", "bool", "(", "d", ">", "0", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_ds_for_depth": [[103, 106], ["model_base.ModelBase._prep_ds", "model_base.ModelBase._prep_ds"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_ds", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_ds"], ["", "", "def", "_prep_ds_for_depth", "(", "self", ",", "depth", ",", "train_dataset", ",", "valid_dataset", ")", ":", "\n", "        ", "self", ".", "_prep_ds", "(", "depth", ",", "valid_dataset", ",", "mode", "=", "'test'", ")", "\n", "self", ".", "_prep_ds", "(", "depth", ",", "train_dataset", ",", "mode", "=", "'train'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_dl_for_depth": [[107, 111], ["model_base.ModelBase._prep_dl", "model_base.ModelBase._prep_dl"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_dl", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_dl"], ["", "def", "_prep_dl_for_depth", "(", "self", ",", "depth", ",", "train_dataset", ",", "valid_dataset", ")", ":", "\n", "        ", "valid_dl", "=", "self", ".", "_prep_dl", "(", "depth", ",", "valid_dataset", ",", "mode", "=", "'test'", ")", "\n", "train_dl", "=", "self", ".", "_prep_dl", "(", "depth", ",", "train_dataset", ",", "mode", "=", "'train'", ")", "\n", "return", "train_dl", ",", "valid_dl", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_for_depth": [[112, 126], ["torch.manual_seed", "torch.cuda.manual_seed_all", "numpy.random.seed", "model_base.ModelBase.logger.info", "model_base.ModelBase._prep_ds_for_depth", "model_base.ModelBase.net.cpu", "model_base.ModelBase.net._prep_for_depth", "print", "model_base.ModelBase.optimizer.construct", "model_base.ModelBase._prep_dl_for_depth"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_ds_for_depth", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_for_depth", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.construct", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_dl_for_depth"], ["", "def", "_prep_for_depth", "(", "self", ",", "depth", ",", "train_ds", ",", "valid_ds", ")", ":", "\n", "        ", "torch", ".", "manual_seed", "(", "self", ".", "tree_idx", ")", "\n", "torch", ".", "cuda", ".", "manual_seed_all", "(", "self", ".", "tree_idx", ")", "\n", "np", ".", "random", ".", "seed", "(", "self", ".", "tree_idx", ")", "\n", "self", ".", "logger", ".", "info", "(", "\"learning for depth %d\"", "%", "(", "depth", ")", ")", "\n", "self", ".", "_prep_ds_for_depth", "(", "depth", ",", "train_ds", ",", "valid_ds", ")", "\n", "self", ".", "net", ".", "cpu", "(", ")", "\n", "self", ".", "net", ".", "_prep_for_depth", "(", "depth", ")", "\n", "print", "(", "self", ".", "net", ")", "\n", "self", ".", "learning_rate", "=", "self", ".", "lrs", "[", "depth", "]", "\n", "self", ".", "dlr_step", "=", "self", ".", "dlr_steps", "[", "depth", "]", "\n", "self", ".", "optimizer", ".", "learning_rate", "=", "self", ".", "learning_rate", "\n", "self", ".", "optimizer", ".", "construct", "(", "self", ".", "net", ".", "depth_node", ",", "None", ")", "\n", "return", "self", ".", "_prep_dl_for_depth", "(", "depth", ",", "train_ds", ",", "valid_ds", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._create_dataset": [[127, 149], ["dataset.construct_dataset"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset.construct_dataset"], ["", "def", "_create_dataset", "(", "self", ",", "data_dir", ",", "fname_features", ",", "fname_labels", "=", "None", ",", "\n", "data", "=", "None", ",", "mode", "=", "'predict'", ",", "normalize_features", "=", "True", ",", "\n", "normalize_labels", "=", "False", ",", "feature_type", "=", "None", ",", "\n", "keep_invalid", "=", "False", ",", "feature_indices", "=", "None", ",", "\n", "label_indices", "=", "None", ",", "size_shortlist", "=", "None", ",", "\n", "shortlist_method", "=", "'static'", ",", "shorty", "=", "None", ",", "\n", "classifier_type", "=", "\"GraphXMLTree\"", ")", ":", "\n", "        ", "size_shortlist", "=", "self", ".", "shortlist_size", "if", "size_shortlist", "is", "None", "else", "size_shortlist", "\n", "feature_type", "=", "self", ".", "feature_type", "if", "feature_type", "is", "None", "else", "feature_type", "\n", "_dataset", "=", "construct_dataset", "(", "\n", "data_dir", "=", "data_dir", ",", "fname_features", "=", "fname_features", ",", "\n", "fname_labels", "=", "fname_labels", ",", "data", "=", "data", ",", "\n", "model_dir", "=", "self", ".", "model_dir", ",", "size_shortlist", "=", "size_shortlist", ",", "\n", "mode", "=", "mode", ",", "normalize_features", "=", "normalize_features", ",", "\n", "normalize_labels", "=", "normalize_labels", ",", "keep_invalid", "=", "keep_invalid", ",", "\n", "num_centroids", "=", "1", ",", "feature_type", "=", "feature_type", ",", "\n", "num_clf_partitions", "=", "1", ",", "feature_indices", "=", "feature_indices", ",", "\n", "label_indices", "=", "label_indices", ",", "shortlist_method", "=", "shortlist_method", ",", "\n", "shorty", "=", "shorty", ",", "classifier_type", "=", "classifier_type", ")", "\n", "return", "_dataset", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._create_dl": [[150, 170], ["collate_fn.construct_collate_fn.construct_collate_fn", "torch.utils.data.DataLoader", "collate_fn.construct_collate_fn.construct_collate_fn.setup"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.setup"], ["", "def", "_create_dl", "(", "self", ",", "dataset", ",", "batch_size", "=", "128", ",", "num_workers", "=", "4", ",", "\n", "shuffle", "=", "False", ",", "use_shortlist", "=", "False", ",", "mode", "=", "'test'", ",", "\n", "sparse_label_fts", "=", "None", ",", "sparse_graph_fts", "=", "None", ",", "\n", "traverse", "=", "True", ")", ":", "\n", "        ", "\"\"\"\n            Create data loader for given dataset\n        \"\"\"", "\n", "collate_fn", "=", "construct_collate_fn", "(", "\n", "dataset", ".", "feature_type", ",", "use_shortlist", ",", "\n", "sparse_label_fts", "=", "sparse_label_fts", ",", "\n", "sparse_graph", "=", "sparse_graph_fts", ",", "\n", "padding_idx", "=", "dataset", ".", "features", ".", "num_features", ",", "\n", "num_labels", "=", "dataset", ".", "num_labels", ",", "traverse", "=", "traverse", ",", "\n", "freeze_params", "=", "self", ".", "freeze_embeddings", ",", "mode", "=", "mode", ")", "\n", "if", "mode", "==", "'train'", ":", "\n", "            ", "collate_fn", ".", "setup", "(", "dataset", ")", "\n", "", "dt_loader", "=", "DataLoader", "(", "dataset", ",", "batch_size", "=", "batch_size", ",", "\n", "num_workers", "=", "num_workers", ",", "shuffle", "=", "shuffle", ",", "\n", "collate_fn", "=", "collate_fn", ")", "\n", "return", "dt_loader", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.get_logger": [[171, 179], ["logging.basicConfig", "logging.getLogger", "logging.getLogger.setLevel"], "methods", ["None"], ["", "def", "get_logger", "(", "self", ",", "name", "=", "'CoXML'", ",", "level", "=", "logging", ".", "INFO", ")", ":", "\n", "        ", "\"\"\"\n            Return logging object!\n        \"\"\"", "\n", "logging", ".", "basicConfig", "(", "level", "=", "level", ",", "stream", "=", "sys", ".", "stdout", ")", "\n", "logger", "=", "logging", ".", "getLogger", "(", "name", ")", "\n", "logger", ".", "setLevel", "(", "logging", ".", "INFO", ")", "\n", "return", "logger", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._compute_loss": [[180, 184], ["out_ans.get_device", "batch_data[].to", "model_base.ModelBase.criterion().to", "model_base.ModelBase.criterion"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to"], ["", "def", "_compute_loss", "(", "self", ",", "out_ans", ",", "batch_data", ")", ":", "\n", "        ", "device", "=", "out_ans", ".", "get_device", "(", ")", "\n", "_true", "=", "batch_data", "[", "'Y'", "]", ".", "to", "(", "device", ")", "\n", "return", "self", ".", "criterion", "(", "out_ans", ",", "_true", ")", ".", "to", "(", "device", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._step": [[185, 208], ["model_base.ModelBase.net.to", "model_base.ModelBase.net.train", "torch.set_grad_enabled", "enumerate", "model_base.ModelBase.net.cpu", "len", "model_base.ModelBase.net.forward", "model_base.ModelBase._compute_loss", "model_base.ModelBase.backward", "model_base.ModelBase.optimizer.step", "model_base.ModelBase.optimizer.zero_grad", "model_base.ModelBase.item", "model_base.ModelBase.logger.info"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.train", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.forward", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._compute_loss", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.step", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.zero_grad"], ["", "def", "_step", "(", "self", ",", "data_loader", ",", "batch_div", "=", "False", ")", ":", "\n", "        ", "\"\"\"\n            Training step\n        \"\"\"", "\n", "self", ".", "net", ".", "to", "(", ")", "\n", "self", ".", "net", ".", "train", "(", ")", "\n", "torch", ".", "set_grad_enabled", "(", "True", ")", "\n", "num_batches", ",", "mean_loss", "=", "len", "(", "data_loader", ")", ",", "0", "\n", "for", "batch_idx", ",", "batch_data", "in", "enumerate", "(", "data_loader", ")", ":", "\n", "            ", "batch_size", "=", "batch_data", "[", "'batch_size'", "]", "\n", "out_ans", "=", "self", ".", "net", ".", "forward", "(", "batch_data", ")", "\n", "loss", "=", "self", ".", "_compute_loss", "(", "out_ans", ",", "batch_data", ")", "\n", "mean_loss", "+=", "loss", ".", "item", "(", ")", "*", "batch_size", "\n", "loss", ".", "backward", "(", ")", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "if", "batch_idx", "%", "self", ".", "progress_step", "==", "0", ":", "\n", "                ", "self", ".", "logger", ".", "info", "(", "\n", "\"Training progress: [{}/{}]\"", ".", "format", "(", "\n", "batch_idx", ",", "num_batches", ")", ")", "\n", "", "del", "batch_data", "\n", "", "self", ".", "net", ".", "cpu", "(", ")", "\n", "return", "mean_loss", "/", "data_loader", ".", "dataset", ".", "num_instances", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._print_stats": [[209, 222], ["model_base.ModelBase.evaluate", "model_base.ModelBase.tracking.val_precision.append", "model_base.ModelBase.tracking.val_precision.append", "model_base.ModelBase.logger.info", "model_base.ModelBase.logger.info"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.evaluate"], ["", "def", "_print_stats", "(", "self", ",", "Y", ",", "mat", ")", ":", "\n", "        ", "_prec", ",", "_ndcg", ",", "_recall", "=", "self", ".", "evaluate", "(", "Y", ",", "mat", ")", "\n", "_max_k", "=", "_recall", ".", "size", "\n", "self", ".", "tracking", ".", "val_precision", ".", "append", "(", "_prec", ")", "\n", "self", ".", "tracking", ".", "val_precision", ".", "append", "(", "_ndcg", ")", "\n", "self", ".", "logger", ".", "info", "(", "\"R@{}: {}, R@{}: {}, R@{}: {}, R@{}: {}\"", ".", "format", "(", "\n", "1", ",", "_recall", "[", "0", "]", "*", "100", ",", "3", ",", "_recall", "[", "2", "]", "*", "100", ",", "\n", "self", ".", "beam", ",", "_recall", "[", "self", ".", "beam", "-", "1", "]", "*", "100", ",", "\n", "_max_k", ",", "_recall", "[", "_max_k", "-", "1", "]", "*", "100", ")", ")", "\n", "self", ".", "logger", ".", "info", "(", "\"P@{}: {}, P@{}: {}, P@{}: {}, P@{}: {}\"", ".", "format", "(", "\n", "1", ",", "_prec", "[", "0", "]", "*", "100", ",", "3", ",", "_prec", "[", "2", "]", "*", "100", ",", "\n", "self", ".", "beam", ",", "_prec", "[", "self", ".", "beam", "-", "1", "]", "*", "100", ",", "\n", "_max_k", ",", "_prec", "[", "_max_k", "-", "1", "]", "*", "100", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.validate": [[223, 230], ["model_base.ModelBase._predict_depth", "model_base.ModelBase._print_stats"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._predict_depth", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._print_stats"], ["", "def", "validate", "(", "self", ",", "valid_loader", ",", "model_dir", "=", "None", ",", "epoch", "=", "None", ")", ":", "\n", "        ", "predicted_labels", ",", "prediction_time", "=", "self", ".", "_predict_depth", "(", "\n", "self", ".", "net", ".", "depth", ",", "valid_loader", ")", "\n", "self", ".", "tracking", ".", "validation_time", "=", "self", ".", "tracking", ".", "validation_time", "+", "prediction_time", "\n", "Y", "=", "valid_loader", ".", "dataset", ".", "labels", ".", "ground_truth", "\n", "self", ".", "_print_stats", "(", "Y", ",", "predicted_labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._predict_depth": [[231, 270], ["model_base.ModelBase.net.cpu", "model_base.ModelBase.net.eval", "torch.set_grad_enabled", "torch.cuda.empty_cache", "model_base.ModelBase.net.to", "len", "scipy.sparse.lil_matrix", "enumerate", "xclib.utils.sparse.retain_topk", "model_base.ModelBase.logger.info", "model_base.ModelBase.net.cpu", "time.time", "model_base.ModelBase.net._predict", "model_base.ModelBase._update_in_sparse", "[].tocsr.tocsr", "model_base.ModelBase.logger.info", "model_base.ModelBase._traverse_graph", "[].tocsr", "[].tocsr.tocsr", "batch_data[].cuda", "batch_data[].cuda", "torch.add", "torch.topk", "time.time", "torch.add.cpu().numpy", "batch_data[].cuda.cpu().numpy", "model_base.ModelBase.logger.info", "torch.add.cpu", "batch_data[].cuda.cpu", "[].tocsr.tocsc"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.eval", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._predict", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._update_in_sparse", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._traverse_graph", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu"], ["", "def", "_predict_depth", "(", "self", ",", "depth", ",", "data_loader", ",", "traverse", "=", "True", ",", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "net", ".", "cpu", "(", ")", "\n", "self", ".", "net", ".", "eval", "(", ")", "\n", "torch", ".", "set_grad_enabled", "(", "False", ")", "\n", "torch", ".", "cuda", ".", "empty_cache", "(", ")", "\n", "self", ".", "net", ".", "to", "(", ")", "\n", "num_inst", "=", "data_loader", ".", "dataset", ".", "num_instances", "\n", "num_lbls", "=", "data_loader", ".", "dataset", ".", "num_labels", "\n", "num_batches", "=", "len", "(", "data_loader", ")", "\n", "pred_lbs", "=", "lil_matrix", "(", "(", "num_inst", ",", "num_lbls", "+", "self", ".", "net", ".", "offset", ")", ")", "\n", "batch_pred_time", ",", "count", "=", "0", ",", "0", "\n", "for", "batch_idx", ",", "batch_data", "in", "enumerate", "(", "data_loader", ")", ":", "\n", "            ", "time_begin", "=", "time", ".", "time", "(", ")", "\n", "score", "=", "self", ".", "net", ".", "_predict", "(", "batch_data", ")", "\n", "if", "depth", ">", "0", ":", "\n", "                ", "index", "=", "batch_data", "[", "'Y_s'", "]", ".", "cuda", "(", ")", "\n", "_val", "=", "batch_data", "[", "'Y_d'", "]", ".", "cuda", "(", ")", "\n", "score", "=", "torch", ".", "add", "(", "_val", ",", "score", ")", "\n", "", "else", ":", "\n", "                ", "score", ",", "index", "=", "torch", ".", "topk", "(", "score", ",", "self", ".", "beam", ")", "\n", "", "batch_pred_time", "+=", "time", ".", "time", "(", ")", "-", "time_begin", "\n", "score", ",", "index", "=", "score", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ",", "index", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "self", ".", "_update_in_sparse", "(", "count", ",", "index", ",", "score", ",", "pred_lbs", ")", "\n", "if", "batch_idx", "%", "self", ".", "progress_step", "==", "0", ":", "\n", "                ", "self", ".", "logger", ".", "info", "(", "\"Prediction progress: [{}/{}]\"", ".", "format", "(", "\n", "batch_idx", ",", "num_batches", ")", ")", "\n", "", "count", "+=", "index", ".", "shape", "[", "0", "]", "\n", "", "pred_lbs", "=", "retain_topk", "(", "pred_lbs", ".", "tocsr", "(", ")", ",", "copy", "=", "False", ",", "k", "=", "self", ".", "beam", ")", "\n", "if", "traverse", ":", "\n", "            ", "self", ".", "logger", ".", "info", "(", "\"Traversing graph for predictions\"", ")", "\n", "pred_lbs", ",", "_time", "=", "self", ".", "_traverse_graph", "(", "pred_lbs", ",", "self", ".", "beam", ",", "\n", "self", ".", "batch_size", "[", "depth", "]", ")", "\n", "batch_pred_time", "+=", "_time", "\n", "", "avg_time", "=", "batch_pred_time", "*", "1000", "/", "pred_lbs", ".", "shape", "[", "0", "]", "\n", "self", ".", "logger", ".", "info", "(", "\"Avg pred time {:0.4f} ms\"", ".", "format", "(", "avg_time", ")", ")", "\n", "if", "self", ".", "net", ".", "offset", ":", "\n", "            ", "pred_lbs", "=", "pred_lbs", ".", "tocsc", "(", ")", "[", ":", ",", ":", "-", "1", "]", ".", "tocsr", "(", ")", "\n", "", "self", ".", "net", ".", "cpu", "(", ")", "\n", "return", "pred_lbs", ".", "tocsr", "(", ")", ",", "batch_pred_time", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._train_depth": [[271, 302], ["model_base.ModelBase._prep_for_depth", "os.path.join", "os.path.exists", "range", "model_base.ModelBase.save", "model_base.ModelBase.logger.info", "model_base.ModelBase.load", "time.time", "model_base.ModelBase._step", "time.time", "model_base.ModelBase.tracking.mean_train_loss.append", "model_base.ModelBase.logger.info", "model_base.ModelBase.validate", "model_base.ModelBase._adjust_parameters", "model_base.ModelBase.validate", "model_base.ModelBase.save", "str"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_for_depth", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree.save", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._step", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.validate", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._adjust_parameters", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.validate", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree.save"], ["", "def", "_train_depth", "(", "self", ",", "train_ds", ",", "valid_ds", ",", "model_dir", ",", "\n", "depth", ",", "validate_after", "=", "5", ")", ":", "\n", "\n", "        ", "train_dl", ",", "valid_dl", "=", "self", ".", "_prep_for_depth", "(", "depth", ",", "train_ds", ",", "valid_ds", ")", "\n", "fname", "=", "os", ".", "path", ".", "join", "(", "model_dir", ",", "self", ".", "model_fname", "+", "\n", "\"-depth=%d_params.pkl\"", "%", "(", "depth", ")", ")", "\n", "if", "os", ".", "path", ".", "exists", "(", "fname", ")", ":", "\n", "            ", "self", ".", "logger", ".", "info", "(", "\"Using pre-trained at \"", "+", "str", "(", "depth", ")", ")", "\n", "self", ".", "load", "(", "model_dir", ",", "depth", ")", "\n", "return", "\n", "", "num_epochs", "=", "self", ".", "call_back", "[", "depth", "]", "\n", "counter_next_decay", "=", "self", ".", "dlr_step", "\n", "for", "epoch", "in", "range", "(", "0", ",", "num_epochs", ")", ":", "\n", "            ", "if", "counter_next_decay", "==", "0", ":", "\n", "                ", "self", ".", "_adjust_parameters", "(", ")", "\n", "counter_next_decay", "=", "self", ".", "dlr_step", "\n", "", "start_time", "=", "time", ".", "time", "(", ")", "\n", "tr_avg_loss", "=", "self", ".", "_step", "(", "train_dl", ")", "\n", "end_time", "=", "time", ".", "time", "(", ")", "\n", "self", ".", "tracking", ".", "mean_train_loss", ".", "append", "(", "tr_avg_loss", ")", "\n", "self", ".", "tracking", ".", "train_time", "+=", "end_time", "-", "start_time", "\n", "self", ".", "logger", ".", "info", "(", "\"Epoch: {}, loss: {}, time: {} sec\"", ".", "format", "(", "\n", "epoch", ",", "tr_avg_loss", ",", "end_time", "-", "start_time", ")", ")", "\n", "if", "valid_dl", "is", "not", "None", "and", "epoch", "%", "validate_after", "==", "0", ":", "\n", "                ", "self", ".", "validate", "(", "valid_dl", ",", "model_dir", ",", "epoch", ")", "\n", "self", ".", "save", "(", "model_dir", ",", "depth", ")", "\n", "", "counter_next_decay", "-=", "1", "\n", "self", ".", "tracking", ".", "last_epoch", "+=", "1", "\n", "", "if", "valid_dl", "is", "not", "None", "and", "not", "(", "epoch", "%", "validate_after", "==", "0", ")", ":", "\n", "            ", "self", ".", "validate", "(", "valid_dl", ",", "model_dir", ",", "epoch", ")", "\n", "", "self", ".", "save", "(", "model_dir", ",", "depth", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._fit": [[303, 316], ["numpy.arange", "model_base.ModelBase.tracking.save", "model_base.ModelBase.logger.info", "len", "model_base.ModelBase._train_depth", "torch.set_grad_enabled", "torch.cuda.empty_cache", "os.path.join"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree.save", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._train_depth"], ["", "def", "_fit", "(", "self", ",", "train_ds", ",", "valid_ds", ",", "model_dir", ",", "result_dir", ",", "validate_after", "=", "5", ")", ":", "\n", "        ", "for", "depth", "in", "np", ".", "arange", "(", "len", "(", "self", ".", "batch_size", ")", ")", ":", "\n", "            ", "self", ".", "_train_depth", "(", "train_ds", ",", "valid_ds", ",", "model_dir", ",", "\n", "depth", ",", "validate_after", ")", "\n", "torch", ".", "set_grad_enabled", "(", "False", ")", "\n", "torch", ".", "cuda", ".", "empty_cache", "(", ")", "\n", "\n", "", "self", ".", "tracking", ".", "save", "(", "os", ".", "path", ".", "join", "(", "result_dir", ",", "'training_statistics.pkl'", ")", ")", "\n", "self", ".", "logger", ".", "info", "(", "\n", "\"Training time: {} sec, Validation time: {} sec\"", "\n", "\", Shortlist time: {} sec, Model size: {} MB\"", ".", "format", "(", "\n", "self", ".", "tracking", ".", "train_time", ",", "self", ".", "tracking", ".", "validation_time", ",", "\n", "self", ".", "tracking", ".", "shortlist_time", ",", "self", ".", "net", ".", "model_size", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.get_lbl_cent": [[317, 323], ["dataset.labels.Y.transpose", "dataset.labels.Y.transpose.dot().tocsr", "xclib.utils.sparse.retain_topk().tocsr", "dataset.labels.Y.transpose.dot", "xclib.utils.sparse.retain_topk", "xclib.utils.sparse.retain_topk().tocsr.tocsr"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.transpose"], ["", "def", "get_lbl_cent", "(", "self", ",", "dataset", ")", ":", "\n", "        ", "_labels", "=", "dataset", ".", "labels", ".", "Y", ".", "transpose", "(", ")", "\n", "_features", "=", "dataset", ".", "features", ".", "X", "\n", "lbl_cnt", "=", "_labels", ".", "dot", "(", "_features", ")", ".", "tocsr", "(", ")", "\n", "lbl_cnt", "=", "retain_topk", "(", "lbl_cnt", ".", "tocsr", "(", ")", ",", "k", "=", "1000", ")", ".", "tocsr", "(", ")", "\n", "return", "lbl_cnt", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.build_net": [[324, 338], ["model_base.ModelBase.get_lbl_cent", "numpy.ravel", "print", "time.time", "model_base.ModelBase.net.build", "time.time", "dataset.labels.Y.sum", "numpy.asarray", "numpy.arange", "numpy.where", "numpy.where"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.get_lbl_cent", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREfe.build"], ["", "def", "build_net", "(", "self", ",", "dataset", ")", ":", "\n", "        ", "labels_repr", "=", "self", ".", "get_lbl_cent", "(", "dataset", ")", "\n", "freq_y", "=", "np", ".", "ravel", "(", "dataset", ".", "labels", ".", "Y", ".", "sum", "(", "axis", "=", "0", ")", ")", "\n", "verb_lbs", ",", "norm_lbs", "=", "np", ".", "asarray", "(", "[", "]", ")", ",", "np", ".", "arange", "(", "freq_y", ".", "size", ")", "\n", "if", "self", ".", "verbose_lbs", ">", "0", ":", "\n", "            ", "verb_lbs", "=", "np", ".", "where", "(", "freq_y", ">", "self", ".", "verbose_lbs", ")", "[", "0", "]", "\n", "norm_lbs", "=", "np", ".", "where", "(", "freq_y", "<=", "self", ".", "verbose_lbs", ")", "[", "0", "]", "\n", "", "print", "(", "\"Label centroids shape:\"", ",", "labels_repr", ".", "shape", ")", "\n", "build_start", "=", "time", ".", "time", "(", ")", "\n", "self", ".", "net", ".", "build", "(", "labels_repr", ",", "norm_lbs", ",", "verb_lbs", ",", "\n", "model_dir", "=", "self", ".", "model_dir", ")", "\n", "build_end", "=", "time", ".", "time", "(", ")", "\n", "build_time", "=", "build_end", "-", "build_start", "\n", "self", ".", "tracking", ".", "train_time", "+=", "build_time", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.fit": [[339, 374], ["model_base.ModelBase.logger.info", "model_base.ModelBase._create_dataset", "model_base.ModelBase.build_net", "model_base.ModelBase._fit", "os.path.join", "model_base.ModelBase.logger.info", "model_base.ModelBase._create_dataset", "model_base.ModelBase._filter_labels", "os.path.join"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._create_dataset", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.build_net", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._fit", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._create_dataset", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._filter_labels"], ["", "def", "fit", "(", "self", ",", "data_dir", ",", "model_dir", ",", "result_dir", ",", "dataset", ",", "\n", "data", "=", "None", ",", "tr_feat_fname", "=", "'trn_X_Xf.txt'", ",", "\n", "tr_label_fname", "=", "'trn_X_Y.txt'", ",", "val_feat_fname", "=", "'tst_X_Xf.txt'", ",", "\n", "val_label_fname", "=", "'tst_X_Y.txt'", ",", "num_workers", "=", "4", ",", "\n", "init_epoch", "=", "0", ",", "keep_invalid", "=", "False", ",", "\n", "feature_indices", "=", "None", ",", "label_indices", "=", "None", ",", "normalize_features", "=", "True", ",", "\n", "normalize_labels", "=", "False", ",", "validate", "=", "False", ",", "\n", "validate_after", "=", "5", ",", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "logger", ".", "info", "(", "\"Loading training data.\"", ")", "\n", "\n", "train_dataset", "=", "self", ".", "_create_dataset", "(", "\n", "os", ".", "path", ".", "join", "(", "data_dir", ",", "dataset", ")", ",", "\n", "fname_features", "=", "tr_feat_fname", ",", "\n", "fname_labels", "=", "tr_label_fname", ",", "\n", "data", "=", "data", ",", "mode", "=", "'train'", ",", "\n", "keep_invalid", "=", "keep_invalid", ",", "\n", "normalize_features", "=", "normalize_features", ",", "\n", "normalize_labels", "=", "normalize_labels", ",", "\n", "feature_indices", "=", "feature_indices", ",", "\n", "label_indices", "=", "label_indices", ")", "\n", "if", "validate", ":", "\n", "            ", "self", ".", "logger", ".", "info", "(", "\"Loading validation data.\"", ")", "\n", "valid", "=", "self", ".", "_create_dataset", "(", "\n", "os", ".", "path", ".", "join", "(", "data_dir", ",", "dataset", ")", ",", "\n", "fname_features", "=", "val_feat_fname", ",", "\n", "fname_labels", "=", "val_label_fname", ",", "\n", "data", "=", "{", "'X'", ":", "None", ",", "'Y'", ":", "None", "}", ",", "mode", "=", "'test'", ",", "\n", "keep_invalid", "=", "keep_invalid", ",", "\n", "normalize_features", "=", "normalize_features", ",", "\n", "normalize_labels", "=", "normalize_labels", ",", "\n", "feature_indices", "=", "feature_indices", ",", "\n", "label_indices", "=", "label_indices", ")", "\n", "valid", ".", "labels", ".", "Y", "=", "self", ".", "_filter_labels", "(", "valid", ".", "labels", ".", "Y", ")", "\n", "", "self", ".", "build_net", "(", "train_dataset", ")", "\n", "self", ".", "_fit", "(", "train_dataset", ",", "valid", ",", "model_dir", ",", "result_dir", ",", "validate_after", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.predict": [[375, 390], ["model_base.ModelBase.net.load", "model_base.ModelBase._create_dataset", "model_base.ModelBase._predict", "model_base.ModelBase._print_stats", "os.path.join"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._create_dataset", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._predict", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._print_stats"], ["", "def", "predict", "(", "self", ",", "data_dir", ",", "model_dir", ",", "dataset", ",", "data", "=", "None", ",", "\n", "ts_feat_fname", "=", "'tst_X_Xf.txt'", ",", "ts_label_fname", "=", "'tst_X_Y.txt'", ",", "\n", "batch_size", "=", "256", ",", "num_workers", "=", "6", ",", "keep_invalid", "=", "False", ",", "\n", "feature_indices", "=", "None", ",", "label_indices", "=", "None", ",", "\n", "normalize_features", "=", "True", ",", "normalize_labels", "=", "False", ",", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "net", ".", "load", "(", "fname", "=", "model_dir", ")", "\n", "dataset", "=", "self", ".", "_create_dataset", "(", "\n", "os", ".", "path", ".", "join", "(", "data_dir", ",", "dataset", ")", ",", "fname_features", "=", "ts_feat_fname", ",", "\n", "fname_labels", "=", "ts_label_fname", ",", "data", "=", "data", ",", "\n", "keep_invalid", "=", "keep_invalid", ",", "normalize_features", "=", "normalize_features", ",", "\n", "normalize_labels", "=", "normalize_labels", ",", "mode", "=", "'test'", ",", "\n", "feature_indices", "=", "feature_indices", ",", "label_indices", "=", "label_indices", ")", "\n", "predicted_labels", ",", "_", "=", "self", ".", "_predict", "(", "dataset", ",", "model_dir", ",", "**", "kwargs", ")", "\n", "self", ".", "_print_stats", "(", "dataset", ".", "labels", ".", "ground_truth", ",", "predicted_labels", ")", "\n", "return", "predicted_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._predict": [[391, 400], ["model_base.ModelBase.logger.info", "range", "model_base.ModelBase._prep_dl", "model_base.ModelBase._predict_depth", "model_base.ModelBase.logger.info", "model_base.ModelBase._prep_ds", "model_base.ModelBase.net._prep_for_depth", "model_base.ModelBase.load"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_dl", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._predict_depth", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_ds", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_for_depth", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load"], ["", "def", "_predict", "(", "self", ",", "dataset", ",", "model_dir", ",", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "logger", ".", "info", "(", "\"Preping the classifile\"", ")", "\n", "for", "depth", "in", "range", "(", "0", ",", "self", ".", "net", ".", "height", ")", ":", "\n", "            ", "self", ".", "logger", ".", "info", "(", "\"Predicting for depth {}\"", ".", "format", "(", "depth", ")", ")", "\n", "self", ".", "_prep_ds", "(", "depth", ",", "dataset", ",", "mode", "=", "'test'", ")", "\n", "self", ".", "net", ".", "_prep_for_depth", "(", "depth", ",", "initialize", "=", "False", ")", "\n", "self", ".", "load", "(", "model_dir", ",", "depth", ")", "\n", "", "data_loader", "=", "self", ".", "_prep_dl", "(", "depth", ",", "dataset", ",", "mode", "=", "'test'", ")", "\n", "return", "self", ".", "_predict_depth", "(", "depth", ",", "data_loader", ",", "self", ".", "traverse", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.extract": [[401, 408], ["model_base.ModelBase.net.load", "model_base.ModelBase.net._prep_for_depth", "model_base.ModelBase.load", "torch.set_grad_enabled", "torch.cuda.empty_cache", "model_base.ModelBase.net.depth_node.embed.cpu().state_dict", "model_base.ModelBase.net.depth_node.embed.cpu"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_for_depth", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.state_dict", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu"], ["", "def", "extract", "(", "self", ",", "model_dir", ")", ":", "\n", "        ", "self", ".", "net", ".", "load", "(", "fname", "=", "model_dir", ")", "\n", "self", ".", "net", ".", "_prep_for_depth", "(", "0", ",", "initialize", "=", "False", ")", "\n", "self", ".", "load", "(", "model_dir", ",", "0", ")", "\n", "torch", ".", "set_grad_enabled", "(", "False", ")", "\n", "torch", ".", "cuda", ".", "empty_cache", "(", ")", "\n", "return", "self", ".", "net", ".", "depth_node", ".", "embed", ".", "cpu", "(", ")", ".", "state_dict", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.get_document": [[409, 428], ["model_base.ModelBase.net.load", "model_base.ModelBase.net._prep_for_depth", "model_base.ModelBase.load", "model_base.ModelBase._create_dataset", "model_base.ModelBase.net.cpu", "print", "model_base.ModelBase.net.to", "model_base.ModelBase._doc_embed", "os.path.join"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_for_depth", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._create_dataset", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._doc_embed"], ["", "def", "get_document", "(", "self", ",", "data_dir", ",", "model_dir", ",", "dataset", ",", "data", "=", "None", ",", "\n", "ts_feat_fname", "=", "'tst_X_Xf.txt'", ",", "if_labels", "=", "False", ",", "\n", "batch_size", "=", "256", ",", "num_workers", "=", "6", ",", "keep_invalid", "=", "False", ",", "\n", "feature_indices", "=", "None", ",", "label_indices", "=", "None", ",", "\n", "normalize_features", "=", "True", ",", "normalize_labels", "=", "False", ",", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "net", ".", "load", "(", "fname", "=", "model_dir", ")", "\n", "self", ".", "net", ".", "_prep_for_depth", "(", "0", ",", "initialize", "=", "False", ")", "\n", "self", ".", "load", "(", "model_dir", ",", "0", ")", "\n", "dataset", "=", "self", ".", "_create_dataset", "(", "\n", "os", ".", "path", ".", "join", "(", "data_dir", ",", "dataset", ")", ",", "fname_features", "=", "ts_feat_fname", ",", "\n", "fname_labels", "=", "ts_feat_fname", ",", "data", "=", "data", ",", "\n", "keep_invalid", "=", "keep_invalid", ",", "normalize_features", "=", "normalize_features", ",", "\n", "normalize_labels", "=", "normalize_labels", ",", "mode", "=", "'test'", ",", "\n", "feature_indices", "=", "feature_indices", ",", "label_indices", "=", "label_indices", ")", "\n", "self", ".", "net", ".", "cpu", "(", ")", "\n", "print", "(", "self", ".", "net", ")", "\n", "self", ".", "net", ".", "to", "(", ")", "\n", "docs", "=", "self", ".", "_doc_embed", "(", "dataset", ",", "0", ",", "self", ".", "net", ".", "depth_node", ",", "if_labels", ")", "\n", "return", "docs", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._doc_embed": [[429, 446], ["encoder.to", "torch.set_grad_enabled", "torch.cuda.empty_cache", "encoder.eval", "model_base.ModelBase._prep_dl", "len", "enumerate", "encoder.cpu", "numpy.vstack", "numpy.vstack.append", "encoder.encode().cpu().numpy", "model_base.ModelBase.logger.info", "encoder.encode().cpu", "encoder.encode"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.to", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.eval", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._prep_dl", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.cpu", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.network.ECLAREh.encode"], ["", "def", "_doc_embed", "(", "self", ",", "dataset", ",", "depth", ",", "encoder", ",", "return_coarse", "=", "False", ",", "**", "kwargs", ")", ":", "\n", "        ", "encoder", ".", "to", "(", ")", "\n", "torch", ".", "set_grad_enabled", "(", "False", ")", "\n", "torch", ".", "cuda", ".", "empty_cache", "(", ")", "\n", "encoder", ".", "eval", "(", ")", "\n", "data_loader", "=", "self", ".", "_prep_dl", "(", "depth", ",", "dataset", ",", "mode", "=", "'test'", ")", "\n", "num_batches", "=", "len", "(", "data_loader", ")", "\n", "docs", "=", "[", "]", "\n", "for", "batch_idx", ",", "batch_data", "in", "enumerate", "(", "data_loader", ")", ":", "\n", "            ", "docs", ".", "append", "(", "encoder", ".", "encode", "(", "\n", "batch_data", ",", "return_coarse", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ")", "\n", "if", "batch_idx", "%", "self", ".", "progress_step", "==", "0", ":", "\n", "                ", "self", ".", "logger", ".", "info", "(", "\"Fectching progress: [{}/{}]\"", ".", "format", "(", "\n", "batch_idx", ",", "num_batches", ")", ")", "\n", "", "", "encoder", ".", "cpu", "(", ")", "\n", "docs", "=", "np", ".", "vstack", "(", "docs", ")", "\n", "return", "docs", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._update_in_sparse": [[447, 451], ["numpy.arange().reshape", "numpy.arange"], "methods", ["None"], ["", "def", "_update_in_sparse", "(", "self", ",", "counter", ",", "predicted_label_index", ",", "predicted_label_scores", ",", "sparse_mat", ")", ":", "\n", "        ", "index", "=", "np", ".", "arange", "(", "\n", "predicted_label_index", ".", "shape", "[", "0", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "+", "counter", "\n", "sparse_mat", "[", "index", ",", "predicted_label_index", "]", "=", "predicted_label_scores", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._adjust_parameters": [[452, 458], ["model_base.ModelBase.optimizer.adjust_lr", "max", "model_base.ModelBase.logger.info"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.adjust_lr"], ["", "def", "_adjust_parameters", "(", "self", ")", ":", "\n", "        ", "self", ".", "optimizer", ".", "adjust_lr", "(", "self", ".", "dlr_factor", ")", "\n", "self", ".", "learning_rate", "*=", "self", ".", "dlr_factor", "\n", "self", ".", "dlr_step", "=", "max", "(", "5", ",", "self", ".", "dlr_step", "//", "2", ")", "\n", "self", ".", "logger", ".", "info", "(", "\n", "\"Adjusted learning rate to: {}\"", ".", "format", "(", "self", ".", "learning_rate", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.save": [[459, 463], ["os.path.join", "torch.save", "model_base.ModelBase.net.state_dict"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree.save", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.state_dict"], ["", "def", "save", "(", "self", ",", "model_dir", ",", "depth", ",", "*", "args", ")", ":", "\n", "        ", "fname", "=", "self", ".", "model_fname", "+", "\"-depth=%d\"", "%", "(", "depth", ")", "\n", "file_path", "=", "os", ".", "path", ".", "join", "(", "model_dir", ",", "fname", "+", "\"_params.pkl\"", ")", "\n", "torch", ".", "save", "(", "self", ".", "net", ".", "state_dict", "(", ")", ",", "file_path", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.load": [[464, 470], ["os.path.join", "model_base.ModelBase.net.load_state_dict", "model_base.ModelBase.transfer_to_devices", "torch.load"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.optimizer_utils.Optimizer.load_state_dict", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.transfer_to_devices", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load"], ["", "def", "load", "(", "self", ",", "model_dir", ",", "depth", ",", "\n", "label_padding_index", "=", "None", ",", "*", "args", ")", ":", "\n", "        ", "fname", "=", "self", ".", "model_fname", "+", "\"-depth=%d\"", "%", "(", "depth", ")", "\n", "file_path", "=", "os", ".", "path", ".", "join", "(", "model_dir", ",", "fname", "+", "\"_params.pkl\"", ")", "\n", "self", ".", "net", ".", "load_state_dict", "(", "torch", ".", "load", "(", "file_path", ")", ")", "\n", "self", ".", "transfer_to_devices", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._evaluate": [[471, 477], ["predicted_labels.tocsr", "xclib.Metrics", "xclib.recall", "xclib.Metrics.eval", "predicted_labels.tocsr"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.models.extreme_classifier.ECLAREBase.eval"], ["", "def", "_evaluate", "(", "self", ",", "true_labels", ",", "predicted_labels", ")", ":", "\n", "        ", "pmat", "=", "predicted_labels", ".", "tocsr", "(", ")", "\n", "acc", "=", "xc", ".", "Metrics", "(", "true_labels", ")", "\n", "rec", "=", "xc", ".", "recall", "(", "pmat", ",", "true_labels", ",", "self", ".", "beam", ")", "\n", "_p", ",", "_n", "=", "acc", ".", "eval", "(", "predicted_labels", ".", "tocsr", "(", ")", ",", "self", ".", "beam", ")", "\n", "return", "_p", ",", "_n", ",", "rec", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase.evaluate": [[478, 485], ["model_base.ModelBase._evaluate", "model_base.ModelBase._filter_labels", "model_base.ModelBase._filter_labels"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._evaluate", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._filter_labels", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._filter_labels"], ["", "def", "evaluate", "(", "self", ",", "true_labels", ",", "predicted_labels", ",", "_filter", "=", "True", ")", ":", "\n", "        ", "if", "self", ".", "net", ".", "depth", "==", "self", ".", "net", ".", "height", "-", "1", "and", "_filter", ":", "\n", "            ", "true_labels", "=", "self", ".", "_filter_labels", "(", "true_labels", ")", "\n", "_predicted_labels", "=", "self", ".", "_filter_labels", "(", "predicted_labels", ")", "\n", "", "else", ":", "\n", "            ", "_predicted_labels", "=", "predicted_labels", "\n", "", "return", "self", ".", "_evaluate", "(", "true_labels", ",", "_predicted_labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.model_base.ModelBase._filter_labels": [[486, 495], ["len", "model_base.ModelBase.logger.info", "score_mat.copy().tolil", "return_score_mat.tocsr.tocsr.tocsr", "score_mat.copy"], "methods", ["None"], ["", "def", "_filter_labels", "(", "self", ",", "score_mat", ")", ":", "\n", "        ", "if", "len", "(", "self", ".", "filter_docs", ")", ">", "0", ":", "\n", "            ", "self", ".", "logger", ".", "info", "(", "\"Filtering labels to remove overlap\"", ")", "\n", "return_score_mat", "=", "score_mat", ".", "copy", "(", ")", ".", "tolil", "(", ")", "\n", "return_score_mat", "[", "self", ".", "filter_docs", ",", "self", ".", "filter_lbls", "]", "=", "0", "\n", "return_score_mat", "=", "return_score_mat", ".", "tocsr", "(", ")", "\n", "return", "return_score_mat", "\n", "", "else", ":", "\n", "            ", "return", "score_mat", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase.__init__": [[11, 28], ["dataset_base.DatasetBase.load_data", "dataset_base.DatasetBase.index_select"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase.load_data", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.index_select"], ["    ", "def", "__init__", "(", "self", ",", "data_dir", ",", "fname_features", ",", "fname_labels", ",", "\n", "data", "=", "None", ",", "model_dir", "=", "''", ",", "mode", "=", "'train'", ",", "\n", "feature_indices", "=", "None", ",", "label_indices", "=", "None", ",", "\n", "keep_invalid", "=", "False", ",", "normalize_features", "=", "True", ",", "\n", "normalize_lables", "=", "False", ",", "feature_type", "=", "'sparse'", ",", "\n", "label_type", "=", "'dense'", ")", ":", "\n", "        ", "self", ".", "data_dir", "=", "data_dir", "\n", "self", ".", "mode", "=", "mode", "\n", "self", ".", "features", ",", "self", ".", "labels", "=", "self", ".", "load_data", "(", "\n", "data_dir", ",", "fname_features", ",", "fname_labels", ",", "data", ",", "\n", "normalize_features", ",", "normalize_lables", ",", "\n", "feature_type", ",", "label_type", ")", "\n", "self", ".", "_split", "=", "None", "\n", "self", ".", "index_select", "(", "feature_indices", ",", "label_indices", ")", "\n", "self", ".", "model_dir", "=", "model_dir", "\n", "self", ".", "data_dir", "=", "data_dir", "\n", "self", ".", "label_padding_index", "=", "self", ".", "num_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase._remove_samples_wo_features_and_labels": [[29, 39], ["dataset_base.DatasetBase.features.get_valid", "dataset_base.DatasetBase.features.index_select", "dataset_base.DatasetBase.labels.get_valid", "numpy.intersect1d", "dataset_base.DatasetBase.labels.index_select"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.get_valid", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.index_select", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.get_valid", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.index_select"], ["", "def", "_remove_samples_wo_features_and_labels", "(", "self", ")", ":", "\n", "        ", "\"\"\"Remove instances if they don't have any feature or label\n        \"\"\"", "\n", "indices", "=", "self", ".", "features", ".", "get_valid", "(", "axis", "=", "1", ")", "\n", "if", "self", ".", "labels", "is", "not", "None", ":", "\n", "            ", "indices_labels", "=", "self", ".", "labels", ".", "get_valid", "(", "axis", "=", "1", ")", "\n", "indices", "=", "np", ".", "intersect1d", "(", "indices", ",", "indices_labels", ")", "\n", "self", ".", "labels", ".", "index_select", "(", "indices", ",", "axis", "=", "0", ")", "\n", "", "self", ".", "features", ".", "index_select", "(", "indices", ",", "axis", "=", "0", ")", "\n", "return", "indices", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase.index_select": [[40, 52], ["numpy.loadtxt", "dataset_base.DatasetBase.labels.index_select", "numpy.loadtxt", "dataset_base.DatasetBase.features.index_select"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.index_select", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.index_select"], ["", "def", "index_select", "(", "self", ",", "feature_indices", ",", "label_indices", ")", ":", "\n", "        ", "\"\"\"Transform feature and label matrix to specified\n        features/labels only\n        \"\"\"", "\n", "if", "label_indices", "is", "not", "None", ":", "\n", "            ", "self", ".", "_split", "=", "None", "\n", "label_indices", "=", "np", ".", "loadtxt", "(", "label_indices", ",", "dtype", "=", "np", ".", "int", ")", "\n", "self", ".", "labels", ".", "index_select", "(", "label_indices", ",", "axis", "=", "1", ")", "\n", "", "if", "feature_indices", "is", "not", "None", ":", "\n", "            ", "self", ".", "_split", "=", "None", "\n", "feature_indices", "=", "np", ".", "loadtxt", "(", "feature_indices", ",", "dtype", "=", "np", ".", "int", ")", "\n", "self", ".", "features", ".", "index_select", "(", "feature_indices", ",", "axis", "=", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase.load_features": [[53, 60], ["features.construct"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.construct"], ["", "", "def", "load_features", "(", "self", ",", "data_dir", ",", "fname", ",", "X", ",", "\n", "normalize_features", ",", "feature_type", ")", ":", "\n", "        ", "\"\"\"Load features from given file\n        Features can also be supplied directly\n        \"\"\"", "\n", "return", "construct_f", "(", "data_dir", ",", "fname", ",", "X", ",", "\n", "normalize_features", ",", "feature_type", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase.load_labels": [[61, 75], ["labels.construct.construct", "print", "labels.construct.construct.normalize", "print", "labels.construct.construct.binarize"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.construct", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.normalize", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.binarize"], ["", "def", "load_labels", "(", "self", ",", "data_dir", ",", "fname", ",", "Y", ",", "normalize_labels", ",", "label_type", ")", ":", "\n", "        ", "\"\"\"Load labels from given file\n        Labels can also be supplied directly\n        \"\"\"", "\n", "labels", "=", "construct_l", "(", "data_dir", ",", "fname", ",", "Y", ",", "normalize_labels", ",", "\n", "label_type", ")", "# Pass dummy labels if required", "\n", "if", "normalize_labels", ":", "\n", "            ", "if", "self", ".", "mode", "==", "'train'", ":", "# Handle non-binary labels", "\n", "                ", "print", "(", "\"Non-binary labels encountered in train; Normalizing.\"", ")", "\n", "labels", ".", "normalize", "(", "norm", "=", "'max'", ",", "copy", "=", "False", ")", "\n", "", "else", ":", "\n", "                ", "print", "(", "\"Non-binary labels encountered in test/val; Binarizing.\"", ")", "\n", "labels", ".", "binarize", "(", ")", "\n", "", "", "return", "labels", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase.load_data": [[76, 86], ["dataset_base.DatasetBase.load_features", "dataset_base.DatasetBase.load_labels"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase.load_features", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase.load_labels"], ["", "def", "load_data", "(", "self", ",", "data_dir", ",", "fname_f", ",", "fname_l", ",", "data", ",", "\n", "normalize_features", "=", "True", ",", "normalize_labels", "=", "False", ",", "\n", "feature_type", "=", "'sparse'", ",", "label_type", "=", "'dense'", ")", ":", "\n", "        ", "\"\"\"Load features and labels from file in libsvm format or pickle\n        \"\"\"", "\n", "features", "=", "self", ".", "load_features", "(", "\n", "data_dir", ",", "fname_f", ",", "data", "[", "'X'", "]", ",", "normalize_features", ",", "feature_type", ")", "\n", "labels", "=", "self", ".", "load_labels", "(", "\n", "data_dir", ",", "fname_l", ",", "data", "[", "'Y'", "]", ",", "normalize_labels", ",", "label_type", ")", "\n", "return", "features", ",", "labels", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase.num_instances": [[87, 90], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "num_instances", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "features", ".", "num_instances", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase.num_features": [[91, 94], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "num_features", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "features", ".", "num_features", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase.num_labels": [[95, 98], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "num_labels", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "labels", ".", "num_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase.get_stats": [[99, 103], ["None"], "methods", ["None"], ["", "def", "get_stats", "(", "self", ")", ":", "\n", "        ", "\"\"\"Get dataset statistics\n        \"\"\"", "\n", "return", "self", ".", "num_instances", ",", "self", ".", "num_features", ",", "self", ".", "num_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase._process_labels_train": [[104, 111], ["dataset_base.DatasetBase.labels.remove_invalid"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.remove_invalid"], ["", "def", "_process_labels_train", "(", "self", ",", "data_obj", ")", ":", "\n", "        ", "\"\"\"Process labels for train data\n            - Remove labels without any training instance\n        \"\"\"", "\n", "data_obj", "[", "'num_labels'", "]", "=", "self", ".", "num_labels", "\n", "valid_labels", "=", "self", ".", "labels", ".", "remove_invalid", "(", ")", "\n", "data_obj", "[", "'valid_labels'", "]", "=", "valid_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase._process_labels_predict": [[112, 119], ["dataset_base.DatasetBase.labels.index_select"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.index_select"], ["", "def", "_process_labels_predict", "(", "self", ",", "data_obj", ")", ":", "\n", "        ", "\"\"\"Process labels for test data\n           Only use valid labels i.e. which had atleast one training\n           example\n        \"\"\"", "\n", "valid_labels", "=", "data_obj", "[", "'valid_labels'", "]", "\n", "self", ".", "labels", ".", "index_select", "(", "valid_labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase._process_labels": [[120, 131], ["os.path.join", "dataset_base.DatasetBase._process_labels_train", "_pickle.dump", "_pickle.load", "dataset_base.DatasetBase._process_labels_predict", "open", "open"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase._process_labels_train", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase._process_labels_predict"], ["", "def", "_process_labels", "(", "self", ",", "model_dir", ")", ":", "\n", "        ", "\"\"\"Process labels to handle labels without any training instance;\n        \"\"\"", "\n", "data_obj", "=", "{", "}", "\n", "fname", "=", "os", ".", "path", ".", "join", "(", "model_dir", ",", "'labels_params.pkl'", ")", "\n", "if", "self", ".", "mode", "==", "'train'", ":", "\n", "            ", "self", ".", "_process_labels_train", "(", "data_obj", ")", "\n", "pickle", ".", "dump", "(", "data_obj", ",", "open", "(", "fname", ",", "'wb'", ")", ")", "\n", "", "else", ":", "\n", "            ", "data_obj", "=", "pickle", ".", "load", "(", "open", "(", "fname", ",", "'rb'", ")", ")", "\n", "self", ".", "_process_labels_predict", "(", "data_obj", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase.__len__": [[132, 134], ["None"], "methods", ["None"], ["", "", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "num_instances", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.dataset_base.DatasetBase.__getitem__": [[135, 152], ["None"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "index", ")", ":", "\n", "        ", "\"\"\"Get features and labels for index\n        Arguments\n        ---------\n        index: int\n            data for this index\n        Returns\n        -------\n        features: np.ndarray or tuple\n            for dense: np.ndarray\n            for sparse: feature indices and their weights\n        labels: np.ndarray\n            1 when relevant; 0 otherwise\n        \"\"\"", "\n", "x", "=", "self", ".", "features", "[", "index", "]", "\n", "y", "=", "self", ".", "labels", "[", "index", "]", "\n", "return", "x", ",", "y", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.PrunedWalk.__init__": [[77, 83], ["xclib.utils.graph.RandomWalk.__init__", "print"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__"], ["    ", "def", "__init__", "(", "self", ",", "Y", ",", "valid_labels", "=", "None", ",", "yf", "=", "None", ")", ":", "\n", "        ", "super", "(", "PrunedWalk", ",", "self", ")", ".", "__init__", "(", "Y", ",", "valid_labels", ")", "\n", "self", ".", "yf", "=", "yf", "\n", "if", "self", ".", "yf", "is", "not", "None", ":", "\n", "            ", "self", ".", "yf", "=", "yf", "[", "self", ".", "valid_labels", "]", "\n", "print", "(", "self", ".", "yf", ".", "shape", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.PrunedWalk.simulate": [[84, 134], ["utils.PrunedWalk.Y.transpose().tocsr", "utils.PrunedWalk.sort_indices", "utils.PrunedWalk.eliminate_zeros", "enumerate", "print", "scipy.vstack().tocsr", "scipy.vstack().tocsr.nonzero", "scipy.coo_matrix", "xclib.utils.sparse._map", "xclib.utils.sparse._map", "xclib.utils.sparse._map.tocsr", "numpy.arange", "xclib.utils.graph._random_walk", "numpy.arange().reshape", "numpy.repeat().flatten", "scipy.coo_matrix", "xclib.utils.sparse.retain_topk.sum_duplicates", "xclib.utils.sparse.retain_topk.tocsr", "xclib.utils.sparse.retain_topk.sort_indices", "xclib.utils.sparse.retain_topk.diagonal", "xclib.utils.sparse.retain_topk.diagonal", "numpy.sum", "xclib.utils.sparse.retain_topk.setdiag", "scipy.vstack().tocsr.append", "utils.PrunedWalk.Y.transpose", "print", "min", "xclib.utils.sparse.retain_topk.nonzero", "numpy.sum", "xclib.utils.sparse.retain_topk.eliminate_zeros", "xclib.utils.sparse.retain_topk", "scipy.vstack", "numpy.arange", "numpy.repeat", "numpy.ravel", "numpy.sum"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.transpose"], ["", "", "def", "simulate", "(", "self", ",", "walk_to", "=", "100", ",", "p_reset", "=", "0.2", ",", "k", "=", "None", ",", "b_size", "=", "1000", ",", "max_dist", "=", "2", ")", ":", "\n", "        ", "q_lbl", "=", "self", ".", "Y", ".", "indices", "\n", "q_rng", "=", "self", ".", "Y", ".", "indptr", "\n", "trn_y", "=", "self", ".", "Y", ".", "transpose", "(", ")", ".", "tocsr", "(", ")", "\n", "trn_y", ".", "sort_indices", "(", ")", "\n", "trn_y", ".", "eliminate_zeros", "(", ")", "\n", "l_qry", "=", "trn_y", ".", "indices", "\n", "l_rng", "=", "trn_y", ".", "indptr", "\n", "n_lbs", "=", "self", ".", "Y", ".", "shape", "[", "1", "]", "\n", "zeros", "=", "0", "\n", "mats", "=", "[", "]", "\n", "pruned_edges", "=", "0", "\n", "for", "p_idx", ",", "idx", "in", "enumerate", "(", "np", ".", "arange", "(", "0", ",", "n_lbs", ",", "b_size", ")", ")", ":", "\n", "            ", "if", "p_idx", "%", "50", "==", "0", ":", "\n", "                ", "print", "(", "\"INFO:WALK: completed [ %d/%d ]\"", "%", "(", "idx", ",", "n_lbs", ")", ")", "\n", "", "start", ",", "end", "=", "idx", ",", "min", "(", "idx", "+", "b_size", ",", "n_lbs", ")", "\n", "cols", ",", "data", "=", "graph", ".", "_random_walk", "(", "q_rng", ",", "q_lbl", ",", "l_rng", ",", "l_qry", ",", "walk_to", ",", "\n", "p_reset", ",", "start", "=", "start", ",", "end", "=", "end", ")", "\n", "rows", "=", "np", ".", "arange", "(", "end", "-", "start", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "rows", "=", "np", ".", "repeat", "(", "rows", ",", "walk_to", ",", "axis", "=", "1", ")", ".", "flatten", "(", ")", "\n", "mat", "=", "sp", ".", "coo_matrix", "(", "(", "data", ",", "(", "rows", ",", "cols", ")", ")", ",", "dtype", "=", "np", ".", "float32", ",", "\n", "shape", "=", "(", "end", "-", "start", ",", "n_lbs", ")", ")", "\n", "mat", ".", "sum_duplicates", "(", ")", "\n", "mat", "=", "mat", ".", "tocsr", "(", ")", "\n", "mat", ".", "sort_indices", "(", ")", "\n", "if", "self", ".", "yf", "is", "not", "None", ":", "\n", "                ", "_rows", ",", "_cols", "=", "mat", ".", "nonzero", "(", ")", "\n", "_lbf", "=", "self", ".", "yf", "[", "start", "+", "_rows", "]", "\n", "_dist", "=", "1", "-", "np", ".", "ravel", "(", "np", ".", "sum", "(", "_lbf", "*", "self", ".", "yf", "[", "_cols", "]", ",", "axis", "=", "1", ")", ")", "\n", "mat", ".", "data", "[", "_dist", ">", "max_dist", "]", "=", "0", "\n", "pruned_edges", "+=", "np", ".", "sum", "(", "_dist", ">", "max_dist", ")", "\n", "mat", ".", "eliminate_zeros", "(", ")", "\n", "", "diag", "=", "mat", ".", "diagonal", "(", "k", "=", "start", ")", "\n", "if", "k", "is", "not", "None", ":", "\n", "                ", "mat", "=", "xs", ".", "retain_topk", "(", "mat", ",", "k", "=", "k", ")", "\n", "", "_diag", "=", "mat", ".", "diagonal", "(", "k", "=", "start", ")", "\n", "_diag", "[", "_diag", "==", "0", "]", "=", "diag", "[", "_diag", "==", "0", "]", "\n", "zeros", "+=", "np", ".", "sum", "(", "_diag", "==", "0", ")", "\n", "_diag", "[", "_diag", "==", "0", "]", "=", "1", "\n", "mat", ".", "setdiag", "(", "_diag", ",", "k", "=", "start", ")", "\n", "mats", ".", "append", "(", "mat", ")", "\n", "del", "rows", ",", "cols", "\n", "", "print", "(", "\"INFO:WALK: completed [ %d/%d ]\"", "%", "(", "n_lbs", ",", "n_lbs", ")", ")", "\n", "mats", "=", "sp", ".", "vstack", "(", "mats", ")", ".", "tocsr", "(", ")", "\n", "rows", ",", "cols", "=", "mats", ".", "nonzero", "(", ")", "\n", "r_mat", "=", "sp", ".", "coo_matrix", "(", "(", "mats", ".", "data", ",", "(", "rows", ",", "cols", ")", ")", ",", "dtype", "=", "np", ".", "float32", ",", "\n", "shape", "=", "(", "self", ".", "num_lbls", ",", "self", ".", "num_lbls", ")", ")", "\n", "r_mat", "=", "xs", ".", "_map", "(", "r_mat", ",", "self", ".", "valid_labels", ",", "axis", "=", "0", ",", "shape", "=", "r_mat", ".", "shape", ")", "\n", "r_mat", "=", "xs", ".", "_map", "(", "r_mat", ",", "self", ".", "valid_labels", ",", "axis", "=", "1", ",", "shape", "=", "r_mat", ".", "shape", ")", "\n", "return", "r_mat", ".", "tocsr", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.normalize_graph": [[9, 19], ["r_diags.dot().dot.diagonal", "print", "numpy.sqrt", "numpy.sqrt", "scipy.diags", "scipy.diags", "sp.diags.dot().dot", "r_diags.dot().dot.eliminate_zeros", "numpy.sum", "numpy.ravel", "numpy.ravel", "sp.diags.dot", "r_diags.dot().dot.sum", "r_diags.dot().dot.sum"], "function", ["None"], ["def", "normalize_graph", "(", "mat", ",", "axis", "=", "1", ")", ":", "\n", "    ", "diags", "=", "mat", ".", "diagonal", "(", ")", "\n", "print", "(", "\"Zero Diagonals:\"", ",", "np", ".", "sum", "(", "diags", "==", "0", ")", ")", "\n", "col_nnz", "=", "np", ".", "sqrt", "(", "1", "/", "np", ".", "ravel", "(", "mat", ".", "sum", "(", "axis", "=", "0", ")", ")", ")", "\n", "row_nnz", "=", "np", ".", "sqrt", "(", "1", "/", "np", ".", "ravel", "(", "mat", ".", "sum", "(", "axis", "=", "1", ")", ")", ")", "\n", "c_diags", "=", "sp", ".", "diags", "(", "col_nnz", ")", "\n", "r_diags", "=", "sp", ".", "diags", "(", "row_nnz", ")", "\n", "mat", "=", "r_diags", ".", "dot", "(", "mat", ")", ".", "dot", "(", "c_diags", ")", "\n", "mat", ".", "eliminate_zeros", "(", ")", "\n", "return", "mat", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.load_overlap": [[21, 41], ["numpy.asarray", "numpy.asarray", "os.path.exists", "print", "os.path.join", "print", "numpy.loadtxt", "os.path.join", "numpy.loadtxt", "numpy.arange", "max", "numpy.ones", "numpy.where", "max", "max"], "function", ["None"], ["", "def", "load_overlap", "(", "data_dir", ",", "valid_labels", ",", "filter_label_file", "=", "'filter_labels'", ")", ":", "\n", "    ", "docs", "=", "np", ".", "asarray", "(", "[", "]", ")", "\n", "lbs", "=", "np", ".", "asarray", "(", "[", "]", ")", "\n", "if", "os", ".", "path", ".", "exists", "(", "os", ".", "path", ".", "join", "(", "data_dir", ",", "filter_label_file", ")", ")", ":", "\n", "        ", "print", "(", "\"Loading from pre-build file\"", ")", "\n", "filter_lbs", "=", "np", ".", "loadtxt", "(", "os", ".", "path", ".", "join", "(", "\n", "data_dir", ",", "filter_label_file", ")", ",", "dtype", "=", "np", ".", "int32", ")", "\n", "if", "filter_lbs", ".", "size", ">", "0", ":", "\n", "            ", "docs", "=", "filter_lbs", "[", ":", ",", "0", "]", "\n", "lbs", "=", "filter_lbs", "[", ":", ",", "1", "]", "\n", "valid_labels", "=", "np", ".", "loadtxt", "(", "valid_labels", ",", "dtype", "=", "np", ".", "int32", ")", "\n", "max_lbl", "=", "max", "(", "max", "(", "lbs", ")", ",", "max", "(", "valid_labels", ")", ")", "+", "1", "\n", "hash_key", "=", "np", ".", "ones", "(", "max_lbl", ")", "*", "-", "1", "\n", "hash_key", "[", "valid_labels", "]", "=", "np", ".", "arange", "(", "valid_labels", ".", "size", ")", "\n", "lbs_remapped", "=", "hash_key", "[", "lbs", "]", "\n", "valid_idx", "=", "np", ".", "where", "(", "lbs_remapped", "!=", "-", "1", ")", "[", "0", "]", "\n", "docs", "=", "docs", "[", "valid_idx", "]", "\n", "lbs", "=", "lbs_remapped", "[", "valid_idx", "]", "\n", "", "", "print", "(", "\"Overlap is:\"", ",", "docs", ".", "size", ")", "\n", "return", "docs", ",", "lbs", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.append_padding_embedding": [[43, 47], ["numpy.zeros", "numpy.vstack"], "function", ["None"], ["", "def", "append_padding_embedding", "(", "embeddings", ")", ":", "\n", "    ", "embedding_dim", "=", "embeddings", ".", "shape", "[", "1", "]", "\n", "app", "=", "np", ".", "zeros", "(", "(", "1", ",", "embedding_dim", ")", ")", "\n", "return", "np", ".", "vstack", "(", "[", "embeddings", ",", "app", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.save_predictions": [[49, 51], ["scipy.save_npz", "os.path.join"], "function", ["None"], ["", "def", "save_predictions", "(", "preds", ",", "result_dir", ",", "prefix", "=", "'predictions'", ")", ":", "\n", "    ", "sp", ".", "save_npz", "(", "os", ".", "path", ".", "join", "(", "result_dir", ",", "'{}.npz'", ".", "format", "(", "prefix", ")", ")", ",", "preds", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.resolve_schema_args": [[53, 67], ["re.findall", "str", "jfile.replace.replace", "jfile.replace.find", "isinstance", "str"], "function", ["None"], ["", "def", "resolve_schema_args", "(", "jfile", ",", "ARGS", ")", ":", "\n", "    ", "\"\"\"\n        Reads JSON and complete the parameters from ARGS\n    \"\"\"", "\n", "arguments", "=", "re", ".", "findall", "(", "r\"#ARGS\\.(.+?);\"", ",", "jfile", ")", "\n", "for", "arg", "in", "arguments", ":", "\n", "        ", "replace", "=", "'#ARGS.%s;'", "%", "(", "arg", ")", "\n", "to", "=", "str", "(", "ARGS", ".", "__dict__", "[", "arg", "]", ")", "\n", "if", "jfile", ".", "find", "(", "'\\\"#ARGS.%s;\\\"'", "%", "(", "arg", ")", ")", "!=", "-", "1", ":", "\n", "            ", "replace", "=", "'\\\"#ARGS.%s;\\\"'", "%", "(", "arg", ")", "\n", "if", "isinstance", "(", "ARGS", ".", "__dict__", "[", "arg", "]", ",", "str", ")", ":", "\n", "                ", "to", "=", "str", "(", "\"\\\"\"", "+", "ARGS", ".", "__dict__", "[", "arg", "]", "+", "\"\\\"\"", ")", "\n", "", "", "jfile", "=", "jfile", ".", "replace", "(", "replace", ",", "to", ")", "\n", "", "return", "jfile", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.fetch_json": [[69, 74], ["json.loads", "open", "utils.resolve_schema_args", "f.readlines"], "function", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.resolve_schema_args"], ["", "def", "fetch_json", "(", "file", ",", "ARGS", ")", ":", "\n", "    ", "with", "open", "(", "file", ",", "encoding", "=", "'utf-8'", ")", "as", "f", ":", "\n", "        ", "file", "=", "''", ".", "join", "(", "f", ".", "readlines", "(", ")", ")", "\n", "schema", "=", "resolve_schema_args", "(", "file", ",", "ARGS", ")", "\n", "", "return", "json", ".", "loads", "(", "schema", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.utils.print_stats": [[136, 141], ["mat.copy", "mat.copy.sum", "print", "numpy.max", "numpy.min", "numpy.std"], "function", ["None"], ["", "", "def", "print_stats", "(", "mat", ",", "k", "=", "10", ")", ":", "\n", "    ", "_mat", "=", "mat", ".", "copy", "(", ")", "\n", "_mat", ".", "__dict__", "[", "'data'", "]", "[", ":", "]", "=", "1", "\n", "freqs", "=", "_mat", ".", "sum", "(", "axis", "=", "1", ")", "\n", "print", "(", "np", ".", "max", "(", "freqs", ")", ",", "np", ".", "min", "(", "freqs", ")", ",", "np", ".", "std", "(", "freqs", ")", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.FeaturesBase.__init__": [[47, 50], ["features.FeaturesBase.load"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load"], ["def", "__init__", "(", "self", ",", "data_dir", ",", "fname", ",", "X", "=", "None", ")", ":", "\n", "        ", "self", ".", "X", "=", "self", ".", "load", "(", "data_dir", ",", "fname", ",", "X", ")", "\n", "self", ".", "padding", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.FeaturesBase.frequency": [[51, 53], ["numpy.array().ravel", "numpy.array", "features.FeaturesBase.X.sum"], "methods", ["None"], ["", "def", "frequency", "(", "self", ",", "axis", "=", "0", ")", ":", "\n", "        ", "return", "np", ".", "array", "(", "self", ".", "X", ".", "sum", "(", "axis", "=", "axis", ")", ")", ".", "ravel", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.FeaturesBase.get_invalid": [[54, 56], ["numpy.where", "features.FeaturesBase.frequency"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.frequency"], ["", "def", "get_invalid", "(", "self", ",", "axis", "=", "0", ")", ":", "\n", "        ", "return", "np", ".", "where", "(", "self", ".", "frequency", "(", "axis", ")", "==", "0", ")", "[", "0", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.FeaturesBase.get_valid": [[57, 59], ["numpy.where", "features.FeaturesBase.frequency"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.frequency"], ["", "def", "get_valid", "(", "self", ",", "axis", "=", "0", ")", ":", "\n", "        ", "return", "np", ".", "where", "(", "self", ".", "frequency", "(", "axis", ")", ">", "0", ")", "[", "0", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.FeaturesBase.remove_invalid": [[60, 64], ["features.FeaturesBase.get_valid", "features.FeaturesBase.index_select"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.get_valid", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.index_select"], ["", "def", "remove_invalid", "(", "self", ",", "axis", "=", "0", ")", ":", "\n", "        ", "indices", "=", "self", ".", "get_valid", "(", "axis", ")", "\n", "self", ".", "index_select", "(", "indices", ")", "\n", "return", "indices", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.FeaturesBase._select_instances": [[65, 67], ["None"], "methods", ["None"], ["", "def", "_select_instances", "(", "self", ",", "indices", ")", ":", "\n", "        ", "self", ".", "X", "=", "self", ".", "X", "[", "indices", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.FeaturesBase._select_features": [[68, 71], ["None"], "methods", ["None"], ["", "def", "_select_features", "(", "self", ",", "indices", ")", ":", "\n", "# Not valid in general case", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.FeaturesBase.index_select": [[72, 83], ["features.FeaturesBase._select_instances", "features.FeaturesBase._select_features", "NotImplementedError"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase._select_instances", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.SparseFeatures._select_features"], ["", "def", "index_select", "(", "self", ",", "indices", ",", "axis", "=", "1", ",", "fname", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n            Choose only selected labels or instances\n        \"\"\"", "\n", "# TODO: Load and select from file", "\n", "if", "axis", "==", "0", ":", "\n", "            ", "self", ".", "_select_instances", "(", "indices", ")", "\n", "", "elif", "axis", "==", "1", ":", "\n", "            ", "self", ".", "_select_features", "(", "indices", ")", "\n", "", "else", ":", "\n", "            ", "raise", "NotImplementedError", "(", "\"Unknown Axis.\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.FeaturesBase.load": [[84, 97], ["os.path.join", "os.path.join.lower().endswith", "os.path.join.lower().endswith", "os.path.join.lower", "_pickle.load", "xclib.data.data_utils.read_sparse_file", "NotImplementedError", "open", "os.path.join.lower"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load"], ["", "", "def", "load", "(", "self", ",", "data_dir", ",", "fname", ",", "X", ")", ":", "\n", "        ", "if", "X", "is", "not", "None", ":", "\n", "            ", "return", "X", "\n", "", "else", ":", "\n", "            ", "assert", "fname", "is", "not", "None", ",", "\"Filename can not be None.\"", "\n", "fname", "=", "os", ".", "path", ".", "join", "(", "data_dir", ",", "fname", ")", "\n", "if", "fname", ".", "lower", "(", ")", ".", "endswith", "(", "'.pkl'", ")", ":", "\n", "                ", "return", "pickle", ".", "load", "(", "open", "(", "fname", ",", "'rb'", ")", ")", "[", "'X'", "]", "\n", "", "elif", "fname", ".", "lower", "(", ")", ".", "endswith", "(", "'.txt'", ")", ":", "\n", "                ", "return", "data_utils", ".", "read_sparse_file", "(", "\n", "fname", ",", "dtype", "=", "np", ".", "float", ")", "\n", "", "else", ":", "\n", "                ", "raise", "NotImplementedError", "(", "\"Unknown file extension\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.FeaturesBase.num_instances": [[98, 101], ["None"], "methods", ["None"], ["", "", "", "@", "property", "\n", "def", "num_instances", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "X", ".", "shape", "[", "0", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.FeaturesBase.num_features": [[102, 105], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "num_features", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "X", ".", "shape", "[", "1", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.FeaturesBase.shape": [[106, 109], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "shape", "(", "self", ")", ":", "\n", "        ", "return", "(", "self", ".", "num_instances", ",", "self", ".", "num_features", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.FeaturesBase.__getitem__": [[110, 112], ["None"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "index", ")", ":", "\n", "        ", "return", "self", ".", "X", "[", "index", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.DenseFeatures.__init__": [[129, 131], ["features.FeaturesBase.__init__"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__"], ["def", "__init__", "(", "self", ",", "data_dir", ",", "fname", ",", "X", "=", "None", ",", "normalize", "=", "False", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "data_dir", ",", "fname", ",", "X", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.DenseFeatures._select_features": [[132, 134], ["None"], "methods", ["None"], ["", "def", "_select_features", "(", "self", ",", "indices", ")", ":", "\n", "        ", "self", ".", "X", "=", "self", ".", "X", "[", ":", ",", "indices", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.DenseFeatures.normalize": [[135, 138], ["print", "sklearn.preprocessing.normalize"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.normalize"], ["", "def", "normalize", "(", "self", ",", "norm", "=", "'l2'", ",", "copy", "=", "False", ")", ":", "\n", "        ", "print", "(", "\"Normalizing data\"", ")", "\n", "self", ".", "X", "=", "scale", "(", "self", ".", "X", ",", "copy", "=", "copy", ",", "norm", "=", "norm", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.DenseFeatures.frequency": [[139, 141], ["numpy.array().ravel", "numpy.array", "features.DenseFeatures.X.astype().sum", "features.DenseFeatures.X.astype"], "methods", ["None"], ["", "def", "frequency", "(", "self", ",", "axis", "=", "0", ")", ":", "\n", "        ", "return", "np", ".", "array", "(", "self", ".", "X", ".", "astype", "(", "np", ".", "bool", ")", ".", "sum", "(", "axis", "=", "axis", ")", ")", ".", "ravel", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.SparseFeatures.__init__": [[157, 161], ["features.FeaturesBase.__init__", "features.SparseFeatures.normalize"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.normalize"], ["def", "__init__", "(", "self", ",", "data_dir", ",", "fname", ",", "X", "=", "None", ",", "normalize", "=", "False", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "data_dir", ",", "fname", ",", "X", ")", "\n", "if", "normalize", ":", "\n", "            ", "self", ".", "normalize", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.SparseFeatures.normalize": [[162, 164], ["sklearn.preprocessing.normalize"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.normalize"], ["", "", "def", "normalize", "(", "self", ",", "norm", "=", "'l2'", ",", "copy", "=", "False", ")", ":", "\n", "        ", "self", ".", "X", "=", "scale", "(", "self", ".", "X", ",", "copy", "=", "copy", ",", "norm", "=", "norm", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.SparseFeatures._select_features": [[165, 167], ["None"], "methods", ["None"], ["", "def", "_select_features", "(", "self", ",", "indices", ")", ":", "\n", "        ", "self", ".", "X", "=", "self", ".", "X", "[", ":", ",", "indices", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.SparseFeatures.frequency": [[168, 170], ["numpy.array().ravel", "numpy.array", "features.SparseFeatures.X.astype().sum", "features.SparseFeatures.X.astype"], "methods", ["None"], ["", "def", "frequency", "(", "self", ",", "axis", "=", "0", ")", ":", "\n", "        ", "return", "np", ".", "array", "(", "self", ".", "X", ".", "astype", "(", "np", ".", "bool", ")", ".", "sum", "(", "axis", "=", "axis", ")", ")", ".", "ravel", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.SparseFeatures.__getitem__": [[171, 173], ["None"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "index", ")", ":", "\n", "        ", "return", "self", ".", "X", "[", "index", "]", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.features.construct": [[8, 33], ["features.SparseFeatures", "features.DenseFeatures", "SequentialFeatures", "NotImplementedError"], "function", ["None"], ["def", "construct", "(", "data_dir", ",", "fname", ",", "X", "=", "None", ",", "normalize", "=", "False", ",", "_type", "=", "'sparse'", ")", ":", "\n", "    ", "\"\"\"Construct feature class based on given parameters\n    Arguments\n    ----------\n    data_dir: str\n        data directory\n    fname: str\n        load data from this file\n    X: csr_matrix or None, optional, default=None\n        data is already provided\n    normalize: boolean, optional, default=False\n        Normalize the data or not\n    _type: str, optional, default=sparse\n        -sparse\n        -dense\n        -sequential\n    \"\"\"", "\n", "if", "_type", "==", "'sparse'", ":", "\n", "        ", "return", "SparseFeatures", "(", "data_dir", ",", "fname", ",", "X", ",", "normalize", ")", "\n", "", "elif", "_type", "==", "'dense'", ":", "\n", "        ", "return", "DenseFeatures", "(", "data_dir", ",", "fname", ",", "X", ",", "normalize", ")", "\n", "", "elif", "_type", "==", "'sequential'", ":", "\n", "        ", "return", "SequentialFeatures", "(", "data_dir", ",", "fname", ",", "X", ")", "\n", "", "else", ":", "\n", "        ", "raise", "NotImplementedError", "(", "\"Unknown feature type\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.hash_map_index.__init__": [[159, 170], ["numpy.zeros"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "clusters", ",", "label_to_idx", ",", "total_elements", ",", "total_valid_nodes", ",", "padding_idx", "=", "None", ")", ":", "\n", "        ", "self", ".", "clusters", "=", "clusters", "\n", "self", ".", "padding_idx", "=", "padding_idx", "\n", "self", ".", "total_elements", "=", "total_elements", "\n", "self", ".", "size", "=", "total_valid_nodes", "\n", "self", ".", "weights", "=", "None", "\n", "if", "padding_idx", "is", "not", "None", ":", "\n", "            ", "self", ".", "weights", "=", "np", ".", "zeros", "(", "(", "self", ".", "total_elements", ")", ",", "np", ".", "float", ")", "\n", "self", ".", "weights", "[", "label_to_idx", "==", "padding_idx", "]", "=", "-", "np", ".", "inf", "\n", "\n", "", "self", ".", "hash_map", "=", "label_to_idx", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.hash_map_index._get_hash": [[171, 173], ["None"], "methods", ["None"], ["", "def", "_get_hash", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "hash_map", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.hash_map_index._get_weights": [[174, 176], ["None"], "methods", ["None"], ["", "def", "_get_weights", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "weights", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree.__init__": [[179, 187], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "b_factors", "=", "[", "2", "]", ",", "M", "=", "1", ",", "method", "=", "'random'", ",", "\n", "leaf_size", "=", "0", ",", "force_shallow", "=", "True", ")", ":", "\n", "        ", "self", ".", "b_factors", "=", "b_factors", "\n", "self", ".", "C", "=", "[", "]", "\n", "self", ".", "method", "=", "method", "\n", "self", ".", "leaf_size", "=", "leaf_size", "\n", "self", ".", "force_shallow", "=", "force_shallow", "\n", "self", ".", "height", "=", "2", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree.fit": [[188, 216], ["print", "tree.build_tree._parabel", "len", "print", "isinstance", "print", "tree.build_tree.hash_map_array.append", "print", "lbl_repr.tocsr.tocsr.tocsr", "tree.hash_map_index", "numpy.concatenate"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree._parabel"], ["", "def", "fit", "(", "self", ",", "label_index", "=", "[", "]", ",", "verbose_label_index", "=", "[", "]", ",", "lbl_repr", "=", "None", ")", ":", "\n", "        ", "self", ".", "num_labels", "=", "lbl_repr", ".", "shape", "[", "0", "]", "\n", "clusters", "=", "[", "label_index", "]", "\n", "self", ".", "hash_map_array", "=", "[", "]", "\n", "print", "(", "\"Total verbose labels\"", ",", "verbose_label_index", ".", "size", ")", "\n", "\n", "if", "len", "(", "lbl_repr", ".", "shape", ")", ">", "2", ":", "\n", "            ", "print", "(", "\"Using multi objective kmeans++\"", ")", "\n", "b_kmeans", "=", "b_kmeans_dense_multi", "\n", "\n", "", "elif", "isinstance", "(", "lbl_repr", ",", "np", ".", "ndarray", ")", ":", "\n", "            ", "print", "(", "\"Using dense kmeans++\"", ")", "\n", "b_kmeans", "=", "b_kmeans_dense", "\n", "\n", "", "else", ":", "\n", "            ", "lbl_repr", "=", "lbl_repr", ".", "tocsr", "(", ")", "\n", "b_kmeans", "=", "b_kmeans_sparse", "\n", "\n", "", "if", "self", ".", "method", "==", "\"NoCluster\"", ":", "\n", "            ", "self", ".", "height", "=", "1", "\n", "print", "(", "\"No need to create splits\"", ")", "\n", "n_lb", "=", "self", ".", "num_labels", "\n", "self", ".", "hash_map_array", ".", "append", "(", "hash_map_index", "(", "\n", "None", ",", "np", ".", "concatenate", "(", "clusters", ")", ",", "n_lb", ",", "n_lb", ",", "n_lb", ")", ")", "\n", "return", "\n", "\n", "", "self", ".", "_parabel", "(", "lbl_repr", ",", "clusters", ",", "[", "verbose_label_index", "]", ",", "\n", "b_kmeans", ",", "self", ".", "force_shallow", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree._parabel": [[217, 274], ["numpy.int", "print", "numpy.full", "enumerate", "tree.build_tree.hash_map_array.append", "print", "print", "tree.build_tree.hash_map_array.append", "tree.build_tree.C.append", "tree.hash_map_index", "print", "list", "tree.cluster_labels", "tree.hash_map_index", "max", "len", "print", "numpy.arange", "len", "numpy.arange().reshape", "len", "tree._merge_tree", "numpy.arange", "list", "numpy.floor", "map", "numpy.log2", "numpy.arange"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.cluster_labels", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree._merge_tree"], ["", "def", "_parabel", "(", "self", ",", "labels", ",", "clusters", ",", "verbose_label_index", ",", "\n", "splitter", "=", "None", ",", "force_shallow", "=", "True", ")", ":", "\n", "        ", "depth", "=", "0", "\n", "T_verb_lbl", "=", "verbose_label_index", "[", "0", "]", ".", "size", "\n", "while", "True", ":", "\n", "            ", "orignal_num_nodes", "=", "2", "**", "self", ".", "b_factors", "[", "depth", "]", "\n", "n_child_nodes", "=", "orignal_num_nodes", "\n", "if", "self", ".", "num_labels", "/", "n_child_nodes", "<", "T_verb_lbl", "or", "len", "(", "self", ".", "b_factors", ")", "==", "1", ":", "\n", "                ", "if", "T_verb_lbl", ">", "0", ":", "\n", "                    ", "add_at", "=", "np", ".", "floor", "(", "np", ".", "log2", "(", "self", ".", "num_labels", "/", "T_verb_lbl", ")", ")", "+", "1", "\n", "addition", "=", "2", "**", "(", "self", ".", "b_factors", "[", "depth", "]", "-", "add_at", ")", "\n", "n_child_nodes", "+=", "addition", "\n", "", "", "depth", "+=", "1", "\n", "print", "(", "\"Building tree at height %d with nodes: %d\"", "%", "\n", "(", "depth", ",", "n_child_nodes", ")", ")", "\n", "if", "n_child_nodes", ">=", "self", ".", "num_labels", ":", "\n", "                ", "print", "(", "\"No need to do clustering\"", ")", "\n", "clusters", "=", "list", "(", "np", ".", "arange", "(", "self", ".", "num_labels", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", ")", "\n", "", "else", ":", "\n", "                ", "clusters", ",", "verbose_label_index", "=", "cluster_labels", "(", "\n", "labels", ",", "clusters", ",", "verbose_label_index", ",", "\n", "orignal_num_nodes", ",", "splitter", ")", "\n", "if", "depth", "==", "len", "(", "self", ".", "b_factors", ")", ":", "\n", "                    ", "clusters", ",", "verbose_label_index", "=", "_merge_tree", "(", "\n", "clusters", ",", "verbose_label_index", ",", "True", ")", "\n", "", "", "self", ".", "hash_map_array", ".", "append", "(", "\n", "hash_map_index", "(", "\n", "clusters", ",", "\n", "np", ".", "arange", "(", "n_child_nodes", ")", ",", "\n", "n_child_nodes", ",", "\n", "n_child_nodes", "\n", ")", "\n", ")", "\n", "self", ".", "C", ".", "append", "(", "max", "(", "list", "(", "map", "(", "lambda", "x", ":", "x", ".", "size", ",", "clusters", ")", ")", ")", ")", "\n", "if", "depth", "==", "len", "(", "self", ".", "b_factors", ")", ":", "\n", "                ", "print", "(", "\"Preparing Leaf\"", ")", "\n", "break", "\n", "\n", "", "", "self", ".", "height", "=", "depth", "+", "1", "\n", "self", ".", "max_node_idx", "=", "np", ".", "int", "(", "n_child_nodes", "*", "self", ".", "C", "[", "-", "1", "]", ")", "\n", "print", "(", "\"Building tree at height %d with max leafs: %d\"", "%", "\n", "(", "self", ".", "height", ",", "self", ".", "max_node_idx", ")", ")", "\n", "_labels_path_array", "=", "np", ".", "full", "(", "\n", "(", "self", ".", "max_node_idx", ")", ",", "self", ".", "num_labels", ",", "\n", "dtype", "=", "np", ".", "int", ")", "\n", "for", "idx", ",", "c", "in", "enumerate", "(", "clusters", ")", ":", "\n", "            ", "index", "=", "np", ".", "arange", "(", "c", ".", "size", ")", "+", "idx", "*", "self", ".", "C", "[", "-", "1", "]", "\n", "_labels_path_array", "[", "index", "]", "=", "clusters", "[", "idx", "]", "\n", "", "self", ".", "hash_map_array", ".", "append", "(", "\n", "hash_map_index", "(", "None", ",", "\n", "_labels_path_array", ",", "\n", "self", ".", "max_node_idx", ",", "\n", "self", ".", "num_labels", ",", "\n", "self", ".", "num_labels", ")", ")", "\n", "print", "(", "\"Sparsity of leaf is %0.2f\"", "%", "\n", "(", "(", "1", "-", "(", "self", ".", "num_labels", "/", "self", ".", "max_node_idx", ")", ")", "*", "100", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree._get_cluster_depth": [[275, 277], ["None"], "methods", ["None"], ["", "def", "_get_cluster_depth", "(", "self", ",", "depth", ")", ":", "\n", "        ", "return", "self", ".", "hash_map_array", "[", "depth", "]", ".", "clusters", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree.load": [[278, 280], ["_pickle.load", "open"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load"], ["", "def", "load", "(", "self", ",", "fname", ")", ":", "\n", "        ", "self", ".", "__dict__", "=", "pik", ".", "load", "(", "open", "(", "fname", ",", "'rb'", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.build_tree.save": [[281, 283], ["_pickle.dump", "open"], "methods", ["None"], ["", "def", "save", "(", "self", ",", "fname", ")", ":", "\n", "        ", "pik", ".", "dump", "(", "self", ".", "__dict__", ",", "open", "(", "fname", ",", "'wb'", ")", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree._normalize": [[15, 18], ["sklearn.preprocessing.normalize"], "function", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.normalize"], ["def", "_normalize", "(", "X", ",", "norm", "=", "'l2'", ")", ":", "\n", "    ", "X", "=", "scale", "(", "X", ",", "norm", "=", "'l2'", ")", "\n", "return", "X", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.b_kmeans_dense_multi": [[20, 45], ["tree._normalize", "tree._normalize", "numpy.random.randint", "numpy.dot", "list", "numpy.squeeze", "numpy.squeeze", "numpy.random.randint", "numpy.array_split", "tree._normalize", "numpy.dot", "tree._normalize", "numpy.dot", "map", "numpy.argsort", "numpy.vstack", "numpy.vstack", "numpy.sum", "numpy.mean", "numpy.mean", "numpy.sum", "numpy.sum"], "function", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree._normalize", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree._normalize", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree._normalize", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree._normalize"], ["", "def", "b_kmeans_dense_multi", "(", "fts_lbl", ",", "index", ",", "metric", "=", "'cosine'", ",", "tol", "=", "1e-4", ",", "leakage", "=", "None", ")", ":", "\n", "    ", "lbl_cent", "=", "_normalize", "(", "np", ".", "squeeze", "(", "fts_lbl", "[", ":", ",", "0", ",", ":", "]", ")", ")", "\n", "lbl_fts", "=", "_normalize", "(", "np", ".", "squeeze", "(", "fts_lbl", "[", ":", ",", "1", ",", ":", "]", ")", ")", "\n", "if", "lbl_cent", ".", "shape", "[", "0", "]", "==", "1", ":", "\n", "        ", "return", "[", "index", "]", "\n", "", "cluster", "=", "np", ".", "random", ".", "randint", "(", "low", "=", "0", ",", "high", "=", "lbl_cent", ".", "shape", "[", "0", "]", ",", "size", "=", "(", "2", ")", ")", "\n", "while", "cluster", "[", "0", "]", "==", "cluster", "[", "1", "]", ":", "\n", "        ", "cluster", "=", "np", ".", "random", ".", "randint", "(", "low", "=", "0", ",", "high", "=", "lbl_cent", ".", "shape", "[", "0", "]", ",", "size", "=", "(", "2", ")", ")", "\n", "", "_centeroids", "=", "lbl_cent", "[", "cluster", "]", "\n", "_sim", "=", "np", ".", "dot", "(", "lbl_cent", ",", "_centeroids", ".", "T", ")", "\n", "old_sim", ",", "new_sim", "=", "-", "1000000", ",", "-", "2", "\n", "while", "new_sim", "-", "old_sim", ">=", "tol", ":", "\n", "        ", "c_lbs", "=", "np", ".", "array_split", "(", "np", ".", "argsort", "(", "_sim", "[", ":", ",", "1", "]", "-", "_sim", "[", ":", ",", "0", "]", ")", ",", "2", ")", "\n", "_centeroids", "=", "_normalize", "(", "np", ".", "vstack", "(", "[", "\n", "np", ".", "mean", "(", "lbl_cent", "[", "x", ",", ":", "]", ",", "axis", "=", "0", ")", "for", "x", "in", "c_lbs", "\n", "]", ")", ")", "\n", "_sim_1", "=", "np", ".", "dot", "(", "lbl_cent", ",", "_centeroids", ".", "T", ")", "\n", "_centeroids", "=", "_normalize", "(", "np", ".", "vstack", "(", "[", "\n", "np", ".", "mean", "(", "lbl_fts", "[", "x", ",", ":", "]", ",", "axis", "=", "0", ")", "for", "x", "in", "c_lbs", "\n", "]", ")", ")", "\n", "_sim_2", "=", "np", ".", "dot", "(", "lbl_fts", ",", "_centeroids", ".", "T", ")", "\n", "_sim", "=", "_sim_1", "+", "_sim_2", "\n", "old_sim", ",", "new_sim", "=", "new_sim", ",", "np", ".", "sum", "(", "[", "np", ".", "sum", "(", "_sim", "[", "c_lbs", "[", "0", "]", ",", "0", "]", ")", ",", "\n", "np", ".", "sum", "(", "_sim", "[", "c_lbs", "[", "1", "]", ",", "1", "]", ")", "]", ")", "\n", "", "return", "list", "(", "map", "(", "lambda", "x", ":", "index", "[", "x", "]", ",", "c_lbs", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.b_kmeans_dense": [[47, 71], ["tree._normalize", "numpy.random.randint", "numpy.dot", "list", "numpy.random.randint", "numpy.array_split", "tree._normalize", "numpy.dot", "map", "numpy.argsort", "numpy.vstack", "numpy.sum", "numpy.mean", "numpy.sum", "enumerate"], "function", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree._normalize", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree._normalize"], ["", "def", "b_kmeans_dense", "(", "labels_features", ",", "index", ",", "metric", "=", "'cosine'", ",", "tol", "=", "1e-4", ",", "leakage", "=", "None", ")", ":", "\n", "    ", "labels_features", "=", "_normalize", "(", "labels_features", ")", "\n", "if", "labels_features", ".", "shape", "[", "0", "]", "==", "1", ":", "\n", "        ", "return", "[", "index", "]", "\n", "", "cluster", "=", "np", ".", "random", ".", "randint", "(", "low", "=", "0", ",", "high", "=", "labels_features", ".", "shape", "[", "0", "]", ",", "size", "=", "(", "2", ")", ")", "\n", "while", "cluster", "[", "0", "]", "==", "cluster", "[", "1", "]", ":", "\n", "        ", "cluster", "=", "np", ".", "random", ".", "randint", "(", "\n", "low", "=", "0", ",", "high", "=", "labels_features", ".", "shape", "[", "0", "]", ",", "size", "=", "(", "2", ")", ")", "\n", "", "_centeroids", "=", "labels_features", "[", "cluster", "]", "\n", "_similarity", "=", "np", ".", "dot", "(", "labels_features", ",", "_centeroids", ".", "T", ")", "\n", "old_sim", ",", "new_sim", "=", "-", "1000000", ",", "-", "2", "\n", "while", "new_sim", "-", "old_sim", ">=", "tol", ":", "\n", "        ", "clustered_lbs", "=", "np", ".", "array_split", "(", "\n", "np", ".", "argsort", "(", "_similarity", "[", ":", ",", "1", "]", "-", "_similarity", "[", ":", ",", "0", "]", ")", ",", "2", ")", "\n", "_centeroids", "=", "_normalize", "(", "np", ".", "vstack", "(", "[", "\n", "np", ".", "mean", "(", "labels_features", "[", "x", ",", ":", "]", ",", "axis", "=", "0", ")", "for", "x", "in", "clustered_lbs", "\n", "]", ")", ")", "\n", "_similarity", "=", "np", ".", "dot", "(", "labels_features", ",", "_centeroids", ".", "T", ")", "\n", "old_sim", ",", "new_sim", "=", "new_sim", ",", "np", ".", "sum", "(", "\n", "[", "np", ".", "sum", "(", "\n", "_similarity", "[", "indx", ",", "i", "]", "\n", ")", "for", "i", ",", "indx", "in", "enumerate", "(", "clustered_lbs", ")", "]", ")", "\n", "\n", "", "return", "list", "(", "map", "(", "lambda", "x", ":", "index", "[", "x", "]", ",", "clustered_lbs", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.b_kmeans_sparse": [[73, 92], ["tree._normalize", "numpy.random.randint", "tree._normalize", "tree._sdist", "list", "numpy.random.randint", "labels_features[].todense", "numpy.array_split", "tree._normalize", "tree._sdist", "map", "numpy.argsort", "numpy.vstack", "numpy.sum", "labels_features[].mean", "numpy.sum", "numpy.sum"], "function", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree._normalize", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree._normalize", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree._sdist", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree._normalize", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree._sdist"], ["", "def", "b_kmeans_sparse", "(", "labels_features", ",", "index", ",", "metric", "=", "'cosine'", ",", "tol", "=", "1e-4", ",", "leakage", "=", "None", ")", ":", "\n", "    ", "labels_features", "=", "_normalize", "(", "labels_features", ")", "\n", "if", "labels_features", ".", "shape", "[", "0", "]", "==", "1", ":", "\n", "        ", "return", "[", "index", "]", "\n", "", "cluster", "=", "np", ".", "random", ".", "randint", "(", "low", "=", "0", ",", "high", "=", "labels_features", ".", "shape", "[", "0", "]", ",", "size", "=", "(", "2", ")", ")", "\n", "while", "cluster", "[", "0", "]", "==", "cluster", "[", "1", "]", ":", "\n", "        ", "cluster", "=", "np", ".", "random", ".", "randint", "(", "\n", "low", "=", "0", ",", "high", "=", "labels_features", ".", "shape", "[", "0", "]", ",", "size", "=", "(", "2", ")", ")", "\n", "", "_centeroids", "=", "_normalize", "(", "labels_features", "[", "cluster", "]", ".", "todense", "(", ")", ")", "\n", "_sim", "=", "_sdist", "(", "labels_features", ",", "_centeroids", ")", "\n", "old_sim", ",", "new_sim", "=", "-", "1000000", ",", "-", "2", "\n", "while", "new_sim", "-", "old_sim", ">=", "tol", ":", "\n", "        ", "c_lbs", "=", "np", ".", "array_split", "(", "np", ".", "argsort", "(", "_sim", "[", ":", ",", "1", "]", "-", "_sim", "[", ":", ",", "0", "]", ")", ",", "2", ")", "\n", "_centeroids", "=", "_normalize", "(", "np", ".", "vstack", "(", "[", "\n", "labels_features", "[", "x", ",", ":", "]", ".", "mean", "(", "axis", "=", "0", ")", "for", "x", "in", "c_lbs", "]", ")", ")", "\n", "_sim", "=", "_sdist", "(", "labels_features", ",", "_centeroids", ")", "\n", "old_sim", ",", "new_sim", "=", "new_sim", ",", "np", ".", "sum", "(", "[", "\n", "np", ".", "sum", "(", "_sim", "[", "c_lbs", "[", "0", "]", ",", "0", "]", ")", ",", "np", ".", "sum", "(", "_sim", "[", "c_lbs", "[", "1", "]", ",", "1", "]", ")", "]", ")", "\n", "", "return", "list", "(", "map", "(", "lambda", "x", ":", "index", "[", "x", "]", ",", "c_lbs", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree._sdist": [[94, 96], ["XA.dot", "XB.transpose"], "function", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.transpose"], ["", "def", "_sdist", "(", "XA", ",", "XB", ",", "norm", "=", "None", ")", ":", "\n", "    ", "return", "XA", ".", "dot", "(", "XB", ".", "transpose", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree._merge_tree": [[98, 111], ["print", "numpy.log2", "len", "numpy.asarray", "print", "print", "numpy.asarray", "numpy.asarray"], "function", ["None"], ["", "def", "_merge_tree", "(", "cluster", ",", "verbose_label_index", ",", "avg_size", "=", "0", ",", "force", "=", "False", ")", ":", "\n", "    ", "if", "cluster", "[", "0", "]", ".", "size", "<", "verbose_label_index", "[", "0", "]", ".", "size", ":", "\n", "        ", "print", "(", "\"Merging trees\"", ",", "np", ".", "log2", "(", "len", "(", "cluster", ")", ")", ")", "\n", "return", "cluster", "+", "verbose_label_index", ",", "[", "np", ".", "asarray", "(", "[", "]", ")", "]", "\n", "", "elif", "verbose_label_index", "[", "0", "]", ".", "size", ">", "0", "and", "force", ":", "\n", "        ", "if", "verbose_label_index", ".", "shape", "[", "0", "]", ">", "0", ":", "\n", "            ", "print", "(", "\"Force Merging trees\"", ")", "\n", "return", "cluster", "+", "verbose_label_index", ",", "[", "np", ".", "asarray", "(", "[", "]", ")", "]", "\n", "", "else", ":", "\n", "            ", "print", "(", "\"Nothing else to do\"", ")", "\n", "return", "cluster", ",", "[", "np", ".", "asarray", "(", "[", "]", ")", "]", "\n", "", "", "else", ":", "\n", "        ", "return", "cluster", ",", "verbose_label_index", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.cluster_labels": [[113, 151], ["time.time", "min", "tree._merge_tree", "len", "functools.reduce", "time.time", "print", "tree._merge_tree", "map", "len", "numpy.mean", "splitter", "list", "map"], "function", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree._merge_tree", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree._merge_tree"], ["", "", "def", "cluster_labels", "(", "labels", ",", "clusters", ",", "verbose_label_index", ",", "num_nodes", ",", "splitter", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "least", "=", "min", "(", "16", ",", "num_nodes", ")", "\n", "clusters", ",", "verbose_label_index", "=", "_merge_tree", "(", "clusters", ",", "verbose_label_index", ")", "\n", "while", "len", "(", "clusters", ")", "<", "num_nodes", ":", "\n", "        ", "temp_cluster_list", "=", "functools", ".", "reduce", "(", "\n", "operator", ".", "iconcat", ",", "\n", "map", "(", "lambda", "x", ":", "splitter", "(", "labels", "[", "x", "]", ",", "x", ")", ",", "\n", "clusters", ")", ",", "[", "]", ")", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "print", "(", "\"Total clusters {}\"", ".", "format", "(", "len", "(", "temp_cluster_list", ")", ")", ",", "\n", "\"Avg. Cluster size {}\"", ".", "format", "(", "\n", "np", ".", "mean", "(", "list", "(", "map", "(", "len", ",", "temp_cluster_list", "+", "verbose_label_index", ")", ")", ")", ")", ",", "\n", "\"Total time {} sec\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "clusters", "=", "temp_cluster_list", "\n", "clusters", ",", "verbose_label_index", "=", "_merge_tree", "(", "\n", "clusters", ",", "verbose_label_index", ")", "\n", "del", "temp_cluster_list", "\n", "# print(cpu_count()-1)", "\n", "# with Pool(6) as p:", "\n", "#     while len(clusters) < num_nodes:", "\n", "#         temp_cluster_list = functools.reduce(", "\n", "#             operator.iconcat,", "\n", "#             p.starmap(", "\n", "#                 splitter,", "\n", "#                 map(lambda cluster: (labels[cluster], cluster),", "\n", "#                     clusters)", "\n", "#             ), [])", "\n", "#         end = time.time()", "\n", "#         print(\"Total clusters {}\".format(len(temp_cluster_list)),", "\n", "#               \"Avg. Cluster size {}\".format(", "\n", "#                   np.mean(list(map(len, temp_cluster_list+verbose_label_index)))),", "\n", "#               \"Total time {} sec\".format(end-start))", "\n", "#         clusters = temp_cluster_list", "\n", "#         clusters, verbose_label_index = _merge_tree(", "\n", "#             clusters, verbose_label_index)", "\n", "#         del temp_cluster_list", "\n", "", "return", "clusters", ",", "verbose_label_index", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.tree.representative": [[153, 156], ["numpy.ravel", "numpy.sum", "numpy.dot", "numpy.argmax"], "function", ["None"], ["", "def", "representative", "(", "lbl_fts", ")", ":", "\n", "    ", "scores", "=", "np", ".", "ravel", "(", "np", ".", "sum", "(", "np", ".", "dot", "(", "lbl_fts", ",", "lbl_fts", ".", "T", ")", ",", "axis", "=", "1", ")", ")", "\n", "return", "lbl_fts", "[", "np", ".", "argmax", "(", "scores", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.__init__": [[50, 52], ["labels.LabelsBase.load"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load"], ["def", "__init__", "(", "self", ",", "data_dir", ",", "fname", ",", "Y", "=", "None", ")", ":", "\n", "        ", "self", ".", "Y", "=", "self", ".", "load", "(", "data_dir", ",", "fname", ",", "Y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase._select_instances": [[53, 55], ["None"], "methods", ["None"], ["", "def", "_select_instances", "(", "self", ",", "indices", ")", ":", "\n", "        ", "self", ".", "Y", "=", "self", ".", "Y", "[", "indices", "]", "if", "self", ".", "_valid", "else", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase._select_labels": [[56, 58], ["None"], "methods", ["None"], ["", "def", "_select_labels", "(", "self", ",", "indices", ")", ":", "\n", "        ", "self", ".", "Y", "=", "self", ".", "Y", "[", ":", ",", "indices", "]", "if", "self", ".", "_valid", "else", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.normalize": [[59, 61], ["sklearn.preprocessing.normalize"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.normalize"], ["", "def", "normalize", "(", "self", ",", "norm", "=", "'max'", ",", "copy", "=", "False", ")", ":", "\n", "        ", "self", ".", "Y", "=", "scale", "(", "self", ".", "Y", ",", "copy", "=", "copy", ",", "norm", "=", "norm", ")", "if", "self", ".", "_valid", "else", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load": [[62, 76], ["os.path.join", "os.path.join.lower().endswith", "os.path.join.lower().endswith", "os.path.join.lower", "_pickle.load", "xclib.data.data_utils.read_sparse_file", "NotImplementedError", "open", "os.path.join.lower"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.load"], ["", "def", "load", "(", "self", ",", "data_dir", ",", "fname", ",", "Y", ")", ":", "\n", "        ", "if", "Y", "is", "not", "None", ":", "\n", "            ", "return", "Y", "\n", "", "elif", "fname", "is", "None", ":", "\n", "            ", "return", "None", "\n", "", "else", ":", "\n", "            ", "fname", "=", "os", ".", "path", ".", "join", "(", "data_dir", ",", "fname", ")", "\n", "if", "fname", ".", "lower", "(", ")", ".", "endswith", "(", "'.pkl'", ")", ":", "\n", "                ", "return", "pickle", ".", "load", "(", "open", "(", "fname", ",", "'rb'", ")", ")", "[", "'Y'", "]", "\n", "", "elif", "fname", ".", "lower", "(", ")", ".", "endswith", "(", "'.txt'", ")", ":", "\n", "                ", "return", "data_utils", ".", "read_sparse_file", "(", "\n", "fname", ",", "dtype", "=", "np", ".", "float", ",", "safe_read", "=", "False", ")", "\n", "", "else", ":", "\n", "                ", "raise", "NotImplementedError", "(", "\"Unknown file extension\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.get_invalid": [[77, 79], ["numpy.where", "labels.LabelsBase.frequency"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.frequency"], ["", "", "", "def", "get_invalid", "(", "self", ",", "axis", "=", "0", ")", ":", "\n", "        ", "return", "np", ".", "where", "(", "self", ".", "frequency", "(", "axis", ")", "==", "0", ")", "[", "0", "]", "if", "self", ".", "_valid", "else", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.get_valid": [[80, 82], ["numpy.where", "labels.LabelsBase.frequency"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.frequency"], ["", "def", "get_valid", "(", "self", ",", "axis", "=", "0", ")", ":", "\n", "        ", "return", "np", ".", "where", "(", "self", ".", "frequency", "(", "axis", ")", ">", "0", ")", "[", "0", "]", "if", "self", ".", "_valid", "else", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.remove_invalid": [[83, 87], ["labels.LabelsBase.get_valid", "labels.LabelsBase.index_select"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.get_valid", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.index_select"], ["", "def", "remove_invalid", "(", "self", ",", "axis", "=", "0", ")", ":", "\n", "        ", "indices", "=", "self", ".", "get_valid", "(", "axis", ")", "\n", "self", ".", "index_select", "(", "indices", ")", "\n", "return", "indices", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.binarize": [[88, 91], ["None"], "methods", ["None"], ["", "def", "binarize", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "_valid", ":", "\n", "            ", "self", ".", "Y", ".", "data", "[", ":", "]", "=", "1.0", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.index_select": [[92, 103], ["labels.LabelsBase._select_instances", "labels.LabelsBase._select_labels", "NotImplementedError"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase._select_instances", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase._select_labels"], ["", "", "def", "index_select", "(", "self", ",", "indices", ",", "axis", "=", "1", ",", "fname", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n            Choose only selected labels or instances\n        \"\"\"", "\n", "# TODO: Load and select from file", "\n", "if", "axis", "==", "0", ":", "\n", "            ", "self", ".", "_select_instances", "(", "indices", ")", "\n", "", "elif", "axis", "==", "1", ":", "\n", "            ", "self", ".", "_select_labels", "(", "indices", ")", "\n", "", "else", ":", "\n", "            ", "NotImplementedError", "(", "\"Unknown Axis.\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.frequency": [[104, 107], ["numpy.array().ravel", "numpy.array", "labels.LabelsBase.Y.astype().sum", "labels.LabelsBase.Y.astype"], "methods", ["None"], ["", "", "def", "frequency", "(", "self", ",", "axis", "=", "0", ")", ":", "\n", "        ", "return", "np", ".", "array", "(", "self", ".", "Y", ".", "astype", "(", "np", ".", "bool", ")", ".", "sum", "(", "axis", "=", "axis", ")", ")", ".", "ravel", "(", ")", "if", "self", ".", "_valid", "else", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.transpose": [[108, 110], ["labels.LabelsBase.Y.transpose"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.transpose"], ["", "def", "transpose", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "Y", ".", "transpose", "(", ")", "if", "self", ".", "_valid", "else", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase._valid": [[111, 114], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "_valid", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "Y", "is", "not", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.num_instances": [[115, 118], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "num_instances", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "Y", ".", "shape", "[", "0", "]", "if", "self", ".", "_valid", "else", "-", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.num_labels": [[119, 122], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "num_labels", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "Y", ".", "shape", "[", "1", "]", "if", "self", ".", "_valid", "else", "-", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.shape": [[123, 126], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "shape", "(", "self", ")", ":", "\n", "        ", "return", "(", "self", ".", "num_instances", ",", "self", ".", "num_labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.setup": [[127, 130], ["None"], "methods", ["None"], ["", "def", "setup", "(", "self", ",", "aug", ")", ":", "\n", "        ", "self", ".", "_setup", "=", "True", "\n", "self", ".", "label", "=", "self", ".", "Y", "+", "aug", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.__getitem__": [[131, 133], ["None"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "index", ")", ":", "\n", "        ", "return", "self", ".", "Y", "[", "index", "]", "if", "self", ".", "_valid", "else", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.DenseLabels.__init__": [[149, 152], ["labels.LabelsBase.__init__"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__"], ["def", "__init__", "(", "self", ",", "data_dir", ",", "fname", ",", "Y", "=", "None", ",", "normalize", "=", "False", ")", ":", "\n", "        ", "self", ".", "_setup", "=", "False", "\n", "super", "(", ")", ".", "__init__", "(", "data_dir", ",", "fname", ",", "Y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.DenseLabels.__getitem__": [[153, 159], ["numpy.array().reshape", "numpy.array().reshape", "numpy.array", "numpy.array", "labels.DenseLabels.Y[].todense", "labels.DenseLabels.label[].todense"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "index", ")", ":", "\n", "        ", "if", "self", ".", "_setup", ":", "\n", "            ", "return", "np", ".", "array", "(", "self", ".", "label", "[", "index", "]", ".", "todense", "(", ")", ",", "\n", "dtype", "=", "np", ".", "float", ")", ".", "reshape", "(", "self", ".", "num_labels", ")", "\n", "", "return", "np", ".", "array", "(", "self", ".", "Y", "[", "index", "]", ".", "todense", "(", ")", ",", "\n", "dtype", "=", "np", ".", "float", ")", ".", "reshape", "(", "self", ".", "num_labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.SparseLabels.__init__": [[174, 176], ["labels.LabelsBase.__init__"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__"], ["def", "__init__", "(", "self", ",", "data_dir", ",", "fname", ",", "Y", "=", "None", ",", "normalize", "=", "False", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "data_dir", ",", "fname", ",", "Y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.SparseLabels.__getitem__": [[177, 181], ["None"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "index", ")", ":", "\n", "        ", "y", "=", "self", ".", "Y", "[", "index", "]", ".", "indices", "\n", "w", "=", "self", ".", "Y", "[", "index", "]", ".", "data", "\n", "return", "y", ",", "w", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__": [[196, 201], ["labels.LabelsBase.__init__"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__init__"], ["def", "__init__", "(", "self", ",", "data_dir", ",", "fname", ",", "Y", "=", "None", ",", "normalize", "=", "False", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "data_dir", ",", "fname", ",", "Y", ")", "\n", "self", ".", "labels", "=", "self", ".", "Y", "\n", "self", ".", "use_shorty", "=", "False", "\n", "self", ".", "is_leaf", "=", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels._new_indexs": [[202, 221], ["labels.GraphLabels.GraphLabels.tocsr().astype", "labels.GraphLabels.GraphLabels.Y.copy", "scipy.lil_matrix", "scipy.hstack().tocsr", "scipy.lil_matrix", "numpy.concatenate", "labels.GraphLabels.GraphLabels.Y.dot", "labels.GraphLabels.GraphLabels.eliminate_zeros", "len", "list", "labels.GraphLabels.GraphLabels.tocsr", "scipy.hstack", "len", "map", "enumerate", "numpy.concatenate", "numpy.tile"], "methods", ["None"], ["", "def", "_new_indexs", "(", "self", ",", "clusters", ")", ":", "\n", "        ", "if", "clusters", "is", "None", "or", "len", "(", "clusters", ")", "==", "self", ".", "num_labels", ":", "\n", "            ", "labels", "=", "self", ".", "Y", ".", "copy", "(", ")", "\n", "pad", "=", "sp", ".", "lil_matrix", "(", "(", "self", ".", "Y", ".", "shape", "[", "0", "]", ",", "1", ")", ",", "\n", "dtype", "=", "np", ".", "int", ")", "\n", "labels", "=", "sp", ".", "hstack", "(", "[", "labels", ",", "pad", "]", ")", ".", "tocsr", "(", ")", "\n", "self", ".", "is_leaf", "=", "True", "\n", "", "else", ":", "\n", "            ", "labels", "=", "sp", ".", "lil_matrix", "(", "(", "self", ".", "Y", ".", "shape", "[", "1", "]", ",", "len", "(", "clusters", ")", ")", ",", "\n", "dtype", "=", "np", ".", "int", ")", "\n", "cols", "=", "np", ".", "concatenate", "(", "list", "(", "\n", "map", "(", "lambda", "x", ":", "np", ".", "tile", "(", "x", "[", "0", "]", ",", "x", "[", "1", "]", ".", "size", ")", ",", "\n", "enumerate", "(", "clusters", ")", ")", "\n", ")", ")", "\n", "labels", "[", "np", ".", "concatenate", "(", "clusters", ")", ",", "cols", "]", "=", "1", "\n", "labels", "=", "self", ".", "Y", ".", "dot", "(", "labels", ")", "\n", "labels", ".", "eliminate_zeros", "(", ")", "\n", "labels", ".", "__dict__", "[", "'data'", "]", "[", ":", "]", "=", "1", "\n", "", "return", "labels", ".", "tocsr", "(", ")", ".", "astype", "(", "np", ".", "float", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels._prep_for_clusters": [[222, 225], ["labels.GraphLabels._new_indexs"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels._new_indexs"], ["", "def", "_prep_for_clusters", "(", "self", ",", "use_shorty", ",", "clusters", ")", ":", "\n", "        ", "self", ".", "use_shorty", "=", "use_shorty", "\n", "self", ".", "labels", "=", "self", ".", "_new_indexs", "(", "clusters", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.__getitem__": [[226, 228], ["None"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "index", ")", ":", "\n", "        ", "return", "self", ".", "labels", "[", "index", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.num_labels": [[229, 234], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "num_labels", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "is_leaf", ":", "\n", "            ", "return", "self", ".", "labels", ".", "shape", "[", "1", "]", "-", "1", "\n", "", "return", "self", ".", "labels", ".", "shape", "[", "1", "]", "if", "self", ".", "_valid", "else", "-", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.remove_invalid": [[235, 240], ["labels.GraphLabels.get_valid", "labels.GraphLabels.index_select"], "methods", ["home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.get_valid", "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.LabelsBase.index_select"], ["", "def", "remove_invalid", "(", "self", ",", "axis", "=", "0", ")", ":", "\n", "        ", "indices", "=", "self", ".", "get_valid", "(", "axis", ")", "\n", "self", ".", "index_select", "(", "indices", ")", "\n", "self", ".", "labels", "=", "self", ".", "Y", "\n", "return", "indices", "\n", "\n"]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.GraphLabels.ground_truth": [[241, 246], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "ground_truth", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "is_leaf", ":", "\n", "            ", "return", "self", ".", "Y", "\n", "", "return", "self", ".", "labels", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Extreme-classification_ECLARE.libs.labels.construct": [[9, 36], ["labels.LabelsBase", "labels.SparseLabels", "labels.DenseLabels", "labels.GraphLabels", "NotImplementedError"], "function", ["None"], ["def", "construct", "(", "data_dir", ",", "fname", ",", "Y", "=", "None", ",", "normalize", "=", "False", ",", "_type", "=", "'sparse'", ")", ":", "\n", "    ", "\"\"\"Construct label class based on given parameters\n    Arguments\n    ----------\n    data_dir: str\n        data directory\n    fname: str\n        load data from this file\n    Y: csr_matrix or None, optional, default=None\n        data is already provided\n    normalize: boolean, optional, default=False\n        Normalize the labels or not\n        Useful in case of non binary labels\n    _type: str, optional, default=sparse\n        -sparse or dense\n    \"\"\"", "\n", "if", "fname", "is", "None", "and", "Y", "is", "None", ":", "# No labels are provided", "\n", "        ", "return", "LabelsBase", "(", "data_dir", ",", "fname", ",", "Y", ")", "\n", "", "else", ":", "\n", "        ", "if", "_type", "==", "'sparse'", ":", "\n", "            ", "return", "SparseLabels", "(", "data_dir", ",", "fname", ",", "Y", ",", "normalize", ")", "\n", "", "elif", "_type", "==", "'dense'", ":", "\n", "            ", "return", "DenseLabels", "(", "data_dir", ",", "fname", ",", "Y", ",", "normalize", ")", "\n", "", "elif", "_type", "==", "'Graph'", ":", "\n", "            ", "return", "GraphLabels", "(", "data_dir", ",", "fname", ",", "Y", ",", "normalize", ")", "\n", "", "else", ":", "\n", "            ", "raise", "NotImplementedError", "(", "\"Unknown label type\"", ")", "\n", "\n"]]}