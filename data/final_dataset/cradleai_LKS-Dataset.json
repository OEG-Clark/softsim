{"home.repos.pwc.inspect_result.cradleai_LKS-Dataset.None.prepro_wsi.clear_temp": [[26, 33], ["subprocess.call", "print"], "function", ["None"], ["def", "clear_temp", "(", ")", ":", "\n", "    ", "\"\"\"\n    Vips stores alot in temp, use this code to clear temp while the script is running.\n    \"\"\"", "\n", "clr_tmp", "=", "[", "\"del\"", ",", "\"/q/f/s\"", ",", "r\"%TEMP%\\*\"", "]", "\n", "subprocess", ".", "call", "(", "clr_tmp", ",", "shell", "=", "True", ")", "\n", "print", "(", "\"Temp files are cleared\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.cradleai_LKS-Dataset.None.prepro_wsi.preprocess_image": [[34, 63], ["fname.replace", "os.path.join", "os.makedirs", "os.path.join", "print", "subprocess.call", "print", "subprocess.call", "print", "subprocess.call", "os.remove", "os.rename", "patch_dir.replace"], "function", ["None"], ["", "def", "preprocess_image", "(", "dsplit", ",", "_class", ",", "fname", ")", ":", "\n", "    ", "\"\"\"\n    This function will preprocess the WSI \"fname\"\n    and store files in the directory \"./TARGET_DPATH/dsplit/_class/name\"\n    \"\"\"", "\n", "name", "=", "fname", ".", "replace", "(", "\".tif\"", ",", "\"\"", ")", "\n", "target_dir", "=", "os", ".", "path", ".", "join", "(", "TARGET_DPATH", ",", "dsplit", ",", "_class", ",", "name", ")", "\n", "os", ".", "makedirs", "(", "target_dir", ",", "exist_ok", "=", "True", ")", "\n", "\n", "bigtif", "=", "os", ".", "path", ".", "join", "(", "SOURCE_DPATH", ",", "dsplit", ",", "fname", ")", "\n", "croptif", "=", "'%s/temp.tif'", "%", "TARGET_DPATH", "\n", "lowres", "=", "'%s/lowres.jpg'", "%", "target_dir", "\n", "patch_dir", "=", "'%s/highres_patches'", "%", "target_dir", "\n", "\n", "print", "(", "\"Center cropping %s\"", "%", "name", ")", "\n", "vips_crop", "=", "[", "\"vips\"", ",", "\"smartcrop\"", ",", "bigtif", ",", "croptif", ",", "\"40000\"", ",", "\"40000\"", ",", "\n", "\"--interesting\"", ",", "\"VIPS_INTERESTING_CENTRE\"", "]", "\n", "subprocess", ".", "call", "(", "vips_crop", ",", "shell", "=", "True", ")", "\n", "print", "(", "\"Creating lowres image for %s\"", "%", "name", ")", "\n", "vips_resize", "=", "[", "\"vips\"", ",", "\"shrink\"", ",", "croptif", ",", "lowres", ",", "\"40\"", ",", "\"40\"", "]", "\n", "subprocess", ".", "call", "(", "vips_resize", ",", "shell", "=", "True", ")", "\n", "print", "(", "\"Creating highres patches for %s\"", "%", "name", ")", "\n", "vips_patch", "=", "[", "\"vips\"", ",", "\"dzsave\"", ",", "croptif", ",", "patch_dir", ",", "\n", "\"--suffix\"", ",", "\".jpg[Q=100]\"", ",", "\"--tile-size\"", ",", "\"1000\"", ",", "\n", "\"--overlap\"", ",", "\"0\"", ",", "\"--depth\"", ",", "\"one\"", "]", "\n", "subprocess", ".", "call", "(", "vips_patch", ",", "shell", "=", "True", ")", "\n", "\n", "os", ".", "remove", "(", "croptif", ")", "\n", "os", ".", "rename", "(", "\"%s_files\"", "%", "patch_dir", ",", "patch_dir", ".", "replace", "(", "\"files\"", ",", "\"patches\"", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.cradleai_LKS-Dataset.None.prepro_wsi.main": [[66, 79], ["open", "csv.reader", "next", "os.makedirs", "prepro_wsi.preprocess_image", "os.path.join"], "function", ["home.repos.pwc.inspect_result.cradleai_LKS-Dataset.None.prepro_wsi.preprocess_image"], ["", "def", "main", "(", ")", ":", "\n", "    ", "\"\"\"This function will parse the labels and image paths in both Train and Test sets\n       and call the preprocess function for each WSI.\n    \"\"\"", "\n", "for", "dsplit", "in", "[", "\"Train\"", ",", "\"Test\"", "]", ":", "\n", "        ", "with", "open", "(", "SOURCE_DPATH", "+", "\"/%s_Labels.csv\"", "%", "dsplit", ")", "as", "csv_file", ":", "\n", "            ", "csv_reader", "=", "csv", ".", "reader", "(", "csv_file", ",", "delimiter", "=", "','", ")", "\n", "next", "(", "csv_reader", ")", "\n", "for", "row", "in", "csv_reader", ":", "\n", "                ", "fname", "=", "row", "[", "0", "]", "\n", "_class", "=", "row", "[", "1", "]", "\n", "os", ".", "makedirs", "(", "os", ".", "path", ".", "join", "(", "TARGET_DPATH", ",", "_class", ")", ",", "exist_ok", "=", "True", ")", "\n", "preprocess_image", "(", "dsplit", ",", "_class", ",", "fname", ")", "\n", "\n"]]}