{"home.repos.pwc.inspect_result.h-tayyarmadabushi_semeval_2022_task2-idiomaticity.SubTaskB.SubTask2Evaluator.load_csv": [[4, 15], ["list", "open", "csv.reader", "list.append"], "function", ["None"], ["def", "load_csv", "(", "path", ")", ":", "\n", "  ", "header", "=", "None", "\n", "data", "=", "list", "(", ")", "\n", "with", "open", "(", "path", ",", "encoding", "=", "'utf-8'", ")", "as", "csvfile", ":", "\n", "    ", "reader", "=", "csv", ".", "reader", "(", "csvfile", ")", "\n", "for", "row", "in", "reader", ":", "\n", "      ", "if", "header", "is", "None", ":", "\n", "        ", "header", "=", "row", "\n", "continue", "\n", "", "data", ".", "append", "(", "row", ")", "\n", "", "", "return", "header", ",", "data", "\n", "\n"]], "home.repos.pwc.inspect_result.h-tayyarmadabushi_semeval_2022_task2-idiomaticity.SubTaskB.SubTask2Evaluator._score": [[17, 66], ["any", "dict", "list", "list", "list", "list", "list", "list", "scipy.stats.spearmanr", "scipy.stats.spearmanr", "scipy.stats.spearmanr", "len", "Exception", "float", "float", "list.append", "list.append", "list.append", "list.append", "list.append", "list.append", "submission_headers.index", "gold_headers.index", "elem[].split", "submission_headers.index", "submission_headers.index", "submission_headers.index", "submission_headers.index", "gold_headers.index", "gold_headers.index", "gold_headers.index", "gold_headers.index"], "function", ["None"], ["", "def", "_score", "(", "submission_data", ",", "submission_headers", ",", "gold_data", ",", "gold_headers", ",", "languages", ",", "settings", ")", ":", "\n", "\n", "# ['ID', 'Language', 'Setting', 'Sim']", "\n", "# ['ID', 'DataID', 'Language', 'sim', 'otherID']", "\n", "\n", "  ", "filtered_submission_data", "=", "[", "i", "for", "i", "in", "submission_data", "if", "i", "[", "submission_headers", ".", "index", "(", "'Language'", ")", "]", "in", "languages", "and", "i", "[", "submission_headers", ".", "index", "(", "'Setting'", ")", "]", "in", "settings", "]", "\n", "if", "any", "(", "[", "(", "i", "[", "submission_headers", ".", "index", "(", "'Sim'", ")", "]", "==", "''", ")", "for", "i", "in", "filtered_submission_data", "]", ")", ":", "\n", "    ", "return", "None", ",", "None", ",", "None", "\n", "\n", "", "filtered_submission_dict", "=", "dict", "(", ")", "\n", "for", "elem", "in", "filtered_submission_data", ":", "\n", "    ", "filtered_submission_dict", "[", "elem", "[", "submission_headers", ".", "index", "(", "'ID'", ")", "]", "]", "=", "elem", "[", "submission_headers", ".", "index", "(", "'Sim'", ")", "]", "\n", "\n", "## Generate gold ", "\n", "", "if", "len", "(", "settings", ")", ">", "1", ":", "\n", "    ", "raise", "Exception", "(", "\"This script does not work for multiple Settings (Submission IDs not unique)\"", ")", "\n", "", "else", ":", "\n", "    ", "gold_data", "=", "[", "i", "for", "i", "in", "gold_data", "if", "i", "[", "gold_headers", ".", "index", "(", "'Language'", ")", "]", "in", "languages", "]", "\n", "\n", "", "gold_labels_all", "=", "list", "(", ")", "\n", "predictions_all", "=", "list", "(", ")", "\n", "\n", "gold_labels_sts", "=", "list", "(", ")", "\n", "predictions_sts", "=", "list", "(", ")", "\n", "\n", "gold_labels_no_sts", "=", "list", "(", ")", "\n", "predictions_no_sts", "=", "list", "(", ")", "\n", "\n", "for", "elem", "in", "gold_data", ":", "\n", "    ", "this_sim", "=", "elem", "[", "gold_headers", ".", "index", "(", "'sim'", ")", "]", "\n", "if", "this_sim", "==", "''", ":", "\n", "      ", "this_sim", "=", "filtered_submission_dict", "[", "elem", "[", "gold_headers", ".", "index", "(", "'otherID'", ")", "]", "]", "\n", "", "this_sim", "=", "float", "(", "this_sim", ")", "\n", "this_prediction", "=", "float", "(", "filtered_submission_dict", "[", "elem", "[", "gold_headers", ".", "index", "(", "'ID'", ")", "]", "]", ")", "\n", "\n", "gold_labels_all", ".", "append", "(", "this_sim", ")", "\n", "predictions_all", ".", "append", "(", "this_prediction", ")", "\n", "\n", "if", "elem", "[", "gold_headers", ".", "index", "(", "'DataID'", ")", "]", ".", "split", "(", "'.'", ")", "[", "2", "]", "==", "'sts'", ":", "\n", "      ", "gold_labels_sts", ".", "append", "(", "this_sim", ")", "\n", "predictions_sts", ".", "append", "(", "this_prediction", ")", "\n", "", "else", ":", "\n", "      ", "gold_labels_no_sts", ".", "append", "(", "this_sim", ")", "\n", "predictions_no_sts", ".", "append", "(", "this_prediction", ")", "\n", "\n", "", "", "corel_all", ",", "pvalue", "=", "spearmanr", "(", "gold_labels_all", ",", "predictions_all", ")", "\n", "corel_sts", ",", "pvalue", "=", "spearmanr", "(", "gold_labels_sts", ",", "predictions_sts", ")", "\n", "corel_no_sts", ",", "pvalue", "=", "spearmanr", "(", "gold_labels_no_sts", ",", "predictions_no_sts", ")", "\n", "return", "(", "corel_all", ",", "corel_sts", ",", "corel_no_sts", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.h-tayyarmadabushi_semeval_2022_task2-idiomaticity.SubTaskB.SubTask2Evaluator.evaluate_submission": [[67, 101], ["SubTask2Evaluator.load_csv", "SubTask2Evaluator.load_csv", "print", "sys.exit", "print", "sys.exit", "int", "SubTask2Evaluator._score", "output.append", "int", "int", "print", "sys.exit"], "function", ["home.repos.pwc.inspect_result.h-tayyarmadabushi_semeval_2022_task2-idiomaticity.SubTaskA.SubTask1Evaluator.load_csv", "home.repos.pwc.inspect_result.h-tayyarmadabushi_semeval_2022_task2-idiomaticity.SubTaskA.SubTask1Evaluator.load_csv", "home.repos.pwc.inspect_result.h-tayyarmadabushi_semeval_2022_task2-idiomaticity.SubTaskA.SubTask1Evaluator._score"], ["", "def", "evaluate_submission", "(", "submission_file", ",", "gold_labels", ")", ":", "\n", "  ", "submission_headers", ",", "submission_data", "=", "load_csv", "(", "submission_file", ")", "\n", "gold_headers", ",", "gold_data", "=", "load_csv", "(", "gold_labels", ")", "\n", "\n", "if", "submission_headers", "!=", "[", "'ID'", ",", "'Language'", ",", "'Setting'", ",", "'Sim'", "]", ":", "\n", "    ", "print", "(", "\"ERROR: Incorrect submission format\"", ",", "file", "=", "sys", ".", "stderr", ")", "\n", "sys", ".", "exit", "(", ")", "\n", "", "if", "gold_headers", "!=", "[", "'ID'", ",", "'DataID'", ",", "'Language'", ",", "'sim'", ",", "'otherID'", "]", ":", "\n", "    ", "print", "(", "\"ERROR: Incorrect gold labels data format (did you use the correct file?)\"", ",", "file", "=", "sys", ".", "stderr", ")", "\n", "sys", ".", "exit", "(", ")", "\n", "\n", "", "submission_ids", "=", "[", "int", "(", "i", "[", "0", "]", ")", "for", "i", "in", "submission_data", "]", "\n", "gold_ids", "=", "[", "int", "(", "i", "[", "0", "]", ")", "for", "i", "in", "gold_data", "]", "+", "[", "int", "(", "i", "[", "-", "1", "]", ")", "for", "i", "in", "gold_data", "if", "i", "[", "-", "1", "]", "!=", "''", "]", "\n", "\n", "for", "id", "in", "submission_ids", ":", "\n", "    ", "if", "not", "id", "in", "gold_ids", ":", "\n", "      ", "print", "(", "\"ERROR: Submission file contains IDs that gold data does not - this could be because you submitted the wrong results (dev results instead of evaluation results) or because your submission file is corrupted\"", ",", "file", "=", "sys", ".", "stderr", ")", "\n", "sys", ".", "exit", "(", ")", "\n", "\n", "", "", "output", "=", "[", "[", "'Settings'", ",", "'Languages'", ",", "\"Spearman Rank ALL\"", ",", "\"Spearman Rank Idiom Data\"", ",", "\"Spearman Rank STS Data\"", "]", "]", "\n", "for", "languages", ",", "settings", "in", "[", "\n", "[", "[", "'EN'", "]", ",", "[", "'pre_train'", "]", "]", ",", "\n", "[", "[", "'PT'", "]", ",", "[", "'pre_train'", "]", "]", ",", "\n", "[", "[", "'EN'", ",", "'PT'", "]", ",", "[", "'pre_train'", "]", "]", ",", "\n", "\n", "[", "[", "'EN'", "]", ",", "[", "'fine_tune'", "]", "]", ",", "\n", "[", "[", "'PT'", "]", ",", "[", "'fine_tune'", "]", "]", ",", "\n", "[", "[", "'EN'", ",", "'PT'", "]", ",", "[", "'fine_tune'", "]", "]", ",", "\n", "]", ":", "\n", "    ", "corel_all", ",", "corel_sts", ",", "corel_no_sts", "=", "_score", "(", "submission_data", ",", "submission_headers", ",", "gold_data", ",", "gold_headers", ",", "languages", ",", "settings", ")", "\n", "this_entry", "=", "[", "','", ".", "join", "(", "settings", ")", ",", "','", ".", "join", "(", "languages", ")", ",", "corel_all", ",", "corel_no_sts", ",", "corel_sts", "]", "\n", "output", ".", "append", "(", "this_entry", ")", "\n", "\n", "", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.h-tayyarmadabushi_semeval_2022_task2-idiomaticity.SubTaskA.SubTask1Evaluator.load_csv": [[5, 16], ["list", "open", "csv.reader", "list.append"], "function", ["None"], ["def", "load_csv", "(", "path", ")", ":", "\n", "  ", "header", "=", "None", "\n", "data", "=", "list", "(", ")", "\n", "with", "open", "(", "path", ",", "encoding", "=", "'utf-8'", ")", "as", "csvfile", ":", "\n", "    ", "reader", "=", "csv", ".", "reader", "(", "csvfile", ")", "\n", "for", "row", "in", "reader", ":", "\n", "      ", "if", "header", "is", "None", ":", "\n", "        ", "header", "=", "row", "\n", "continue", "\n", "", "data", ".", "append", "(", "row", ")", "\n", "", "", "return", "header", ",", "data", "\n", "\n"]], "home.repos.pwc.inspect_result.h-tayyarmadabushi_semeval_2022_task2-idiomaticity.SubTaskA.SubTask1Evaluator._score": [[19, 47], ["any", "sklearn.metrics.f1_score", "len", "int", "int", "print", "sys.exit", "int", "int", "len", "int", "submission_headers.index", "gold_headers.index", "submission_headers.index", "submission_headers.index", "submission_headers.index", "gold_headers.index"], "function", ["None"], ["", "def", "_score", "(", "submission_data", ",", "submission_headers", ",", "gold_data", ",", "gold_headers", ",", "languages", ",", "settings", ")", ":", "\n", "\n", "  ", "if", "len", "(", "settings", ")", "==", "2", ":", "\n", "    ", "assert", "len", "(", "languages", ")", "==", "2", "\n", "gold_data", "=", "gold_data", "+", "gold_data", "\n", "\n", "", "filtered_submission_data", "=", "[", "i", "for", "i", "in", "submission_data", "if", "i", "[", "submission_headers", ".", "index", "(", "'Language'", ")", "]", "in", "languages", "and", "i", "[", "submission_headers", ".", "index", "(", "'Setting'", ")", "]", "in", "settings", "]", "\n", "submission_ids", "=", "[", "int", "(", "i", "[", "submission_headers", ".", "index", "(", "'ID'", ")", "]", ")", "for", "i", "in", "filtered_submission_data", "]", "\n", "\n", "filtered_gold_data", "=", "[", "i", "for", "i", "in", "gold_data", "if", "int", "(", "i", "[", "gold_headers", ".", "index", "(", "'ID'", ")", "]", ")", "in", "submission_ids", "]", "\n", "\n", "gold_ids", "=", "[", "int", "(", "i", "[", "0", "]", ")", "for", "i", "in", "filtered_gold_data", "]", "\n", "\n", "if", "submission_ids", "!=", "gold_ids", ":", "\n", "    ", "print", "(", "\"ERROR: IDs in Submission file do not match IDs in gold file!\"", ")", "\n", "sys", ".", "exit", "(", ")", "\n", "\n", "", "y_pred", "=", "[", "i", "[", "submission_headers", ".", "index", "(", "'Label'", ")", "]", "for", "i", "in", "filtered_submission_data", "]", "\n", "y_true", "=", "[", "i", "[", "gold_headers", ".", "index", "(", "'Label'", ")", "]", "for", "i", "in", "filtered_gold_data", "]", "\n", "\n", "if", "any", "(", "[", "(", "i", "==", "''", ")", "for", "i", "in", "y_pred", "]", ")", ":", "\n", "    ", "return", "None", ",", "None", ",", "None", "\n", "\n", "", "y_pred", "=", "[", "int", "(", "i", ")", "for", "i", "in", "y_pred", "]", "\n", "y_true", "=", "[", "int", "(", "i", ")", "for", "i", "in", "y_true", "]", "\n", "f1_macro", "=", "f1_score", "(", "y_true", ",", "y_pred", ",", "average", "=", "'macro'", ")", "\n", "\n", "return", "f1_macro", "\n", "\n"]], "home.repos.pwc.inspect_result.h-tayyarmadabushi_semeval_2022_task2-idiomaticity.SubTaskA.SubTask1Evaluator.evaluate_submission": [[49, 79], ["SubTask1Evaluator.load_csv", "SubTask1Evaluator.load_csv", "print", "sys.exit", "print", "sys.exit", "SubTask1Evaluator._score", "output.append"], "function", ["home.repos.pwc.inspect_result.h-tayyarmadabushi_semeval_2022_task2-idiomaticity.SubTaskA.SubTask1Evaluator.load_csv", "home.repos.pwc.inspect_result.h-tayyarmadabushi_semeval_2022_task2-idiomaticity.SubTaskA.SubTask1Evaluator.load_csv", "home.repos.pwc.inspect_result.h-tayyarmadabushi_semeval_2022_task2-idiomaticity.SubTaskA.SubTask1Evaluator._score"], ["", "def", "evaluate_submission", "(", "submission_file", ",", "gold_labels", ")", ":", "\n", "\n", "  ", "submission_headers", ",", "submission_data", "=", "load_csv", "(", "submission_file", ")", "\n", "gold_headers", ",", "gold_data", "=", "load_csv", "(", "gold_labels", ")", "\n", "\n", "if", "submission_headers", "!=", "[", "'ID'", ",", "'Language'", ",", "'Setting'", ",", "'Label'", "]", ":", "\n", "    ", "print", "(", "\"ERROR: Incorrect submission format\"", ",", "file", "=", "sys", ".", "stderr", ")", "\n", "sys", ".", "exit", "(", ")", "\n", "\n", "", "if", "gold_headers", "!=", "[", "'ID'", ",", "'DataID'", ",", "'Language'", ",", "'Label'", "]", ":", "\n", "    ", "print", "(", "\"ERROR: Incorrect gold labels data format (did you use the correct file?)\"", ",", "file", "=", "sys", ".", "stderr", ")", "\n", "sys", ".", "exit", "(", ")", "\n", "\n", "", "output", "=", "[", "[", "'Settings'", ",", "'Languages'", ",", "\"F1 Score (Macro)\"", "]", "]", "\n", "\n", "for", "languages", ",", "settings", "in", "[", "\n", "[", "[", "'EN'", "]", ",", "[", "'zero_shot'", "]", "]", ",", "\n", "[", "[", "'PT'", "]", ",", "[", "'zero_shot'", "]", "]", ",", "\n", "[", "[", "'EN'", ",", "'PT'", "]", ",", "[", "'zero_shot'", "]", "]", ",", "\n", "\n", "[", "[", "'EN'", "]", ",", "[", "'one_shot'", "]", "]", ",", "\n", "[", "[", "'PT'", "]", ",", "[", "'one_shot'", "]", "]", ",", "\n", "[", "[", "'EN'", ",", "'PT'", "]", ",", "[", "'one_shot'", "]", "]", ",", "\n", "\n", "]", ":", "\n", "    ", "f1_macro", "=", "_score", "(", "submission_data", ",", "submission_headers", ",", "gold_data", ",", "gold_headers", ",", "languages", ",", "settings", ")", "\n", "this_entry", "=", "[", "','", ".", "join", "(", "settings", ")", ",", "','", ".", "join", "(", "languages", ")", ",", "f1_macro", "]", "\n", "output", ".", "append", "(", "this_entry", ")", "\n", "\n", "", "return", "output", "\n", "\n"]]}