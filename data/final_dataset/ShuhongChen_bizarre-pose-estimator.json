{"home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.fermat.Model.__init__": [[13, 55], ["pl.LightningModule.__init__", "fermat.Model.save_hyperparameters", "ResnetFeatureExtractor().eval", "PretrainedKeypointDetector().eval", "TT.Resize", "nn.ModuleDict", "nn.BCEWithLogitsLoss", "nn.MSELoss", "fermat.ResnetFeatureExtractor", "fermat.PretrainedKeypointDetector", "fermat.Model.resnet.parameters", "fermat.Model.rcnn.parameters", "fermat.ResnetFeatureConverter", "nn.Sequential", "nn.Sequential", "nn.Sequential", "TT.Resize", "nn.Conv2d", "nn.ReLU", "nn.BatchNorm2d", "nn.Conv2d", "nn.Conv2d", "nn.LeakyReLU", "nn.BatchNorm2d", "_util.ResBlock", "_util.ResBlock", "_util.ResBlock", "_util.ResBlock", "_util.ResBlock", "_util.ResBlock", "_util.ResBlock", "_util.ResBlock", "_util.ResBlock", "_util.ResBlock", "nn.Conv2d"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__init__"], ["    ", "def", "__init__", "(", "self", ",", "bargs", ",", "pargs", ",", "largs", ",", "margs", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "hparams", ".", "bargs", "=", "bargs", "\n", "self", ".", "hparams", ".", "pargs", "=", "pargs", "\n", "self", ".", "hparams", ".", "largs", "=", "largs", "\n", "self", ".", "hparams", ".", "margs", "=", "margs", "\n", "self", ".", "save_hyperparameters", "(", ")", "\n", "\n", "# set up frozen pretrained networks", "\n", "self", ".", "resnet", "=", "ResnetFeatureExtractor", "(", "margs", ".", "resnet_inferserve_query", ")", ".", "eval", "(", ")", "\n", "self", ".", "rcnn", "=", "PretrainedKeypointDetector", "(", ")", ".", "eval", "(", ")", "\n", "for", "param", "in", "[", "*", "self", ".", "resnet", ".", "parameters", "(", ")", ",", "*", "self", ".", "rcnn", ".", "parameters", "(", ")", "]", ":", "\n", "            ", "param", ".", "requires_grad", "=", "False", "\n", "\n", "# set up keypoint detector head", "\n", "", "self", ".", "size", "=", "margs", ".", "size", "\n", "self", ".", "resizer", "=", "TT", ".", "Resize", "(", "self", ".", "size", ")", "\n", "self", ".", "keypoint_head", "=", "nn", ".", "ModuleDict", "(", "{", "\n", "'converter_resnet'", ":", "ResnetFeatureConverter", "(", "self", ".", "size", ")", ",", "\n", "'matcher_rcnn'", ":", "nn", ".", "Sequential", "(", "\n", "TT", ".", "Resize", "(", "14", ")", ",", "\n", "nn", ".", "Conv2d", "(", "128", ",", "512", ",", "kernel_size", "=", "3", ",", "padding", "=", "1", ",", "padding_mode", "=", "'replicate'", ")", ",", "\n", "nn", ".", "ReLU", "(", ")", ",", "\n", "nn", ".", "BatchNorm2d", "(", "512", ")", ",", "\n", ")", ",", "\n", "'converter_rcnn'", ":", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Conv2d", "(", "512", ",", "32", ",", "kernel_size", "=", "1", ",", "padding", "=", "0", ")", ",", "\n", "self", ".", "resizer", ",", "\n", ")", ",", "\n", "'head'", ":", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Conv2d", "(", "128", "+", "32", "+", "3", ",", "128", ",", "kernel_size", "=", "3", ",", "padding", "=", "1", ",", "padding_mode", "=", "'replicate'", ")", ",", "\n", "nn", ".", "LeakyReLU", "(", ")", ",", "\n", "nn", ".", "BatchNorm2d", "(", "128", ")", ",", "\n", "util_hm", ".", "ResBlock", "(", "3", ",", "64", ",", "3", ",", "channels_in", "=", "128", ")", ",", "\n", "util_hm", ".", "ResBlock", "(", "3", ",", "32", ",", "3", ",", "channels_in", "=", "64", ")", ",", "\n", "nn", ".", "Conv2d", "(", "32", ",", "17", "+", "8", ",", "kernel_size", "=", "3", ",", "padding", "=", "1", ",", "padding_mode", "=", "'replicate'", ")", ",", "\n", ")", ",", "\n", "}", ")", "\n", "self", ".", "bce_logits", "=", "nn", ".", "BCEWithLogitsLoss", "(", "reduction", "=", "'none'", ")", "\n", "self", ".", "mse", "=", "nn", ".", "MSELoss", "(", "reduction", "=", "'mean'", ")", "\n", "self", ".", "lambda_match", "=", "margs", ".", "lambda_match", "\n", "return", "\n", "", "def", "loss_match", "(", "self", ",", "gt", ",", "pred", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.fermat.Model.loss_match": [[55, 58], ["fermat.Model.mse", "gt.detach"], "methods", ["None"], ["", "def", "loss_match", "(", "self", ",", "gt", ",", "pred", ")", ":", "\n", "        ", "gt", "=", "gt", ".", "detach", "(", ")", "if", "gt", "is", "not", "None", "else", "None", "# new in v5+", "\n", "return", "self", ".", "mse", "(", "(", "gt", ",", "pred", ")", "[", "gt", "is", "None", "]", ",", "pred", ")", "\n", "# return ((1-wean)*self.mse((gt,pred)[gt is None], pred))", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.fermat.Model.loss": [[59, 81], ["fermat.Model.bce_logits", "fermat.Model.resizer", "torch.no_grad", "_util.pcp", "_util.pcp", "_util.pcp", "_util.pcp", "_util.pcp", "_util.pcp", "_util.pcp", "_util.pcp", "_util.pcp", "_util.pcp", "_util.pck", "_util.pck", "_util.pck", "_util.pck", "_util.pck", "_util.pck", "_util.pck", "_util.pck", "_util.pck", "_util.pck", "_util.pdj", "_util.pdj", "_util.pdj", "_util.pdj", "_util.pdj", "_util.oks", "_util.oks", "_util.oks", "_util.oks", "_util.oks", "_util.oks", "_util.oks", "_util.oks", "_util.oks", "_util.oks"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pdj", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pdj", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pdj", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pdj", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pdj", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks"], ["", "def", "loss", "(", "self", ",", "gt", ",", "pred", ",", "return_more", "=", "False", ")", ":", "\n", "# expects gt/pred is {keypoint_heatmaps: (bs,17+8,h,w)}", "\n", "# expects pred heatmaps in logits (pre-sigmoid)", "\n", "# expects keypoints in dict if return_more", "\n", "# if keypoint_loss_weights in gt, will apply", "\n", "        ", "ans", "=", "{", "}", "\n", "if", "'keypoint_heatmaps'", "in", "gt", "and", "'keypoint_heatmaps'", "in", "pred", ":", "\n", "            ", "bce", "=", "self", ".", "bce_logits", "(", "pred", "[", "'keypoint_heatmaps'", "]", ",", "self", ".", "resizer", "(", "gt", "[", "'keypoint_heatmaps'", "]", ")", ")", "\n", "wt", "=", "1", "if", "'keypoint_loss_weights'", "not", "in", "gt", "else", "gt", "[", "'keypoint_loss_weights'", "]", "[", ":", ",", ":", ",", "None", ",", "None", "]", "\n", "ans", "[", "'loss'", "]", "=", "wt", "*", "bce", "\n", "", "if", "return_more", ":", "\n", "            ", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "                ", "q", "=", "gt", "[", "'keypoints'", "]", "[", ":", ",", ":", "17", ",", ":", "2", "]", ",", "gt", "[", "'bbox'", "]", ",", "pred", "[", "'keypoints'", "]", "[", ":", ",", ":", "17", ",", ":", "2", "]", "\n", "mpl", "=", "gt", "[", "'mean_part_lengths'", "]", "\n", "ans", "[", "'pcp_50'", "]", "=", "util_keypoints", ".", "pcp", "(", "*", "q", ",", "k", "=", "0.5", ")", "[", "'correct_parts'", "]", "\n", "ans", "[", "'pcpm_50'", "]", "=", "util_keypoints", ".", "pcp", "(", "*", "q", ",", "k", "=", "0.5", ",", "m", "=", "mpl", ")", "[", "'correct_parts'", "]", "\n", "ans", "[", "'pckh_20'", "]", "=", "util_keypoints", ".", "pck", "(", "*", "q", ",", "k", "=", "0.2", ",", "mode", "=", "'h'", ")", "[", "'correct_joints'", "]", "\n", "ans", "[", "'pckh_50'", "]", "=", "util_keypoints", ".", "pck", "(", "*", "q", ",", "k", "=", "0.5", ",", "mode", "=", "'h'", ")", "[", "'correct_joints'", "]", "\n", "ans", "[", "'pdj_20'", "]", "=", "util_keypoints", ".", "pdj", "(", "*", "q", ",", "k", "=", "0.2", ")", "[", "'correct_joints'", "]", "\n", "ans", "[", "'oks_50'", "]", "=", "util_keypoints", ".", "oks", "(", "*", "q", ",", "thresh", "=", "0.5", ")", "[", "'correct_joints'", "]", "\n", "ans", "[", "'oks_75'", "]", "=", "util_keypoints", ".", "oks", "(", "*", "q", ",", "thresh", "=", "0.75", ")", "[", "'correct_joints'", "]", "\n", "", "", "return", "ans", "\n", "", "def", "forward", "(", "self", ",", "x", ",", "smoothing", "=", "None", ",", "return_more", "=", "False", ",", "inference", "=", "True", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.fermat.Model.forward": [[81, 136], ["fermat.Model.resnet.eval", "fermat.Model.resizer", "torch.cat", "torch.no_grad", "fermat.Model.resnet", "fermat.Model.rcnn.eval", "torch.no_grad", "fermat.Model.resizer", "torch.sigmoid", "hms.view().argmax", "torch.stack", "torch.sigmoid", "max", "kornia.filters.gaussian_blur2d", "kornia.filters.gaussian_blur2d.view().argmax", "torch.stack", "fermat.Model.rcnn", "max", "hms.view", "kornia.filters.gaussian_blur2d.view", "int"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "smoothing", "=", "None", ",", "return_more", "=", "False", ",", "inference", "=", "True", ")", ":", "\n", "# extract backbone features", "\n", "        ", "self", ".", "resnet", ".", "eval", "(", ")", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "feats_resnet", "=", "self", ".", "resnet", "(", "x", ")", "\n", "", "feats_resnet_convert", "=", "self", ".", "resizer", "(", "self", ".", "keypoint_head", "[", "'converter_resnet'", "]", "(", "feats_resnet", ")", ")", "\n", "if", "not", "inference", ":", "\n", "            ", "self", ".", "rcnn", ".", "eval", "(", ")", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "                ", "feats_rcnn", "=", "self", ".", "rcnn", "(", "x", ",", "return_more", "=", "return_more", ")", "[", "'features_last'", "]", "\n", "", "", "else", ":", "\n", "            ", "feats_rcnn", "=", "None", "\n", "\n", "# matching", "\n", "", "feats_match", "=", "self", ".", "keypoint_head", "[", "'matcher_rcnn'", "]", "(", "feats_resnet_convert", ")", "\n", "feats", "=", "torch", ".", "cat", "(", "[", "\n", "self", ".", "resizer", "(", "x", ")", ",", "\n", "feats_resnet_convert", ",", "\n", "self", ".", "keypoint_head", "[", "'converter_rcnn'", "]", "(", "feats_match", ")", ",", "\n", "]", ",", "dim", "=", "1", ")", "\n", "\n", "# apply head", "\n", "hms", "=", "self", ".", "keypoint_head", "[", "'head'", "]", "(", "feats", ")", "\n", "ans", "=", "{", "\n", "'keypoint_heatmaps'", ":", "hms", ",", "\n", "'features_match'", ":", "(", "feats_rcnn", ",", "feats_match", ")", ",", "\n", "}", "\n", "if", "return_more", ":", "\n", "            ", "ans", "[", "'features_resnet'", "]", "=", "feats_resnet", "\n", "ans", "[", "'features_rcnn'", "]", "=", "feats_rcnn", "\n", "if", "smoothing", "is", "None", ":", "\n", "                ", "ans", "[", "'keypoint_heatmaps_prob'", "]", "=", "torch", ".", "sigmoid", "(", "hms", ")", "\n", "kps", "=", "hms", ".", "view", "(", "hms", ".", "shape", "[", "0", "]", ",", "hms", ".", "shape", "[", "1", "]", ",", "-", "1", ")", ".", "argmax", "(", "-", "1", ")", "\n", "kps", "=", "torch", ".", "stack", "(", "[", "\n", "kps", "//", "hms", ".", "shape", "[", "2", "]", "*", "(", "x", ".", "shape", "[", "2", "]", "/", "hms", ".", "shape", "[", "2", "]", ")", ",", "\n", "kps", "%", "hms", ".", "shape", "[", "3", "]", "*", "(", "x", ".", "shape", "[", "3", "]", "/", "hms", ".", "shape", "[", "3", "]", ")", ",", "\n", "]", ",", "dim", "=", "2", ")", "\n", "", "else", ":", "\n", "                ", "hmp", "=", "torch", ".", "sigmoid", "(", "hms", ")", "\n", "ksig", "=", "max", "(", "hmp", ".", "shape", "[", "-", "2", ":", "]", ")", "*", "smoothing", "\n", "kern", "=", "max", "(", "3", ",", "int", "(", "ksig", ")", "*", "2", "+", "1", ")", "\n", "hmps", "=", "kornia", ".", "filters", ".", "gaussian_blur2d", "(", "\n", "hmp", ",", "\n", "kernel_size", "=", "(", "kern", ",", "kern", ")", ",", "\n", "sigma", "=", "(", "ksig", ",", "ksig", ")", ",", "\n", "border_type", "=", "'reflect'", ",", "\n", ")", "\n", "kps", "=", "hmps", ".", "view", "(", "hmps", ".", "shape", "[", "0", "]", ",", "hmps", ".", "shape", "[", "1", "]", ",", "-", "1", ")", ".", "argmax", "(", "-", "1", ")", "\n", "kps", "=", "torch", ".", "stack", "(", "[", "\n", "kps", "//", "hmps", ".", "shape", "[", "2", "]", "*", "(", "x", ".", "shape", "[", "2", "]", "/", "hmps", ".", "shape", "[", "2", "]", ")", ",", "\n", "kps", "%", "hmps", ".", "shape", "[", "3", "]", "*", "(", "x", ".", "shape", "[", "3", "]", "/", "hmps", ".", "shape", "[", "3", "]", ")", ",", "\n", "]", ",", "dim", "=", "2", ")", "\n", "ans", "[", "'keypoint_heatmaps_prob'", "]", "=", "hmps", "\n", "", "ans", "[", "'keypoints'", "]", "=", "kps", "\n", "", "return", "ans", "\n", "", "def", "training_step", "(", "self", ",", "batch", ",", "batch_idx", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.fermat.Model.training_step": [[136, 149], ["fermat.Model.forward", "fermat.Model.loss", "fermat.Model.loss_match", "loss[].mean", "fermat.Model.log", "fermat.Model.log", "fermat.Model.log"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.Injector.forward", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.alaska.Model.loss", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.fermat.Model.loss_match"], ["", "def", "training_step", "(", "self", ",", "batch", ",", "batch_idx", ")", ":", "\n", "# wean = self.wean_function(self.wean_epochs)", "\n", "# write(f'train: w({self.wean_epochs})={wean}\\n', './temp/wean.txt', 'a')", "\n", "        ", "pred", "=", "self", ".", "forward", "(", "batch", "[", "'image'", "]", ",", "return_more", "=", "False", ",", "inference", "=", "False", ")", "\n", "loss", "=", "self", ".", "loss", "(", "batch", ",", "pred", ",", "return_more", "=", "False", ")", "\n", "loss_match", "=", "self", ".", "loss_match", "(", "*", "pred", "[", "'features_match'", "]", ")", "\n", "loss_agg", "=", "loss", "[", "'loss'", "]", ".", "mean", "(", ")", "\n", "loss_fin", "=", "loss_agg", "+", "self", ".", "lambda_match", "*", "loss_match", "\n", "self", ".", "log", "(", "'train_loss'", ",", "loss_fin", ",", "sync_dist", "=", "True", ")", "\n", "self", ".", "log", "(", "'train_loss_heatmap'", ",", "loss_agg", ",", "sync_dist", "=", "True", ")", "\n", "self", ".", "log", "(", "'train_loss_match'", ",", "loss_match", ",", "sync_dist", "=", "True", ")", "\n", "return", "{", "\n", "'loss'", ":", "loss_fin", ",", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.fermat.Model.validation_step": [[150, 168], ["fermat.Model.forward", "fermat.Model.loss", "fermat.Model.loss_match", "fermat.Model.log", "fermat.Model.log", "fermat.Model.log", "v.float().mean", "fermat.Model.items", "v.float"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.Injector.forward", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.alaska.Model.loss", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.fermat.Model.loss_match"], ["", "def", "validation_step", "(", "self", ",", "batch", ",", "batch_idx", ")", ":", "\n", "# wean = self.wean_function(self.wean_epochs)", "\n", "# write(f'val: w({self.wean_epochs})={wean}\\n', './temp/wean.txt', 'a')", "\n", "        ", "pred", "=", "self", ".", "forward", "(", "batch", "[", "'image'", "]", ",", "return_more", "=", "True", ",", "inference", "=", "False", ")", "\n", "loss", "=", "self", ".", "loss", "(", "batch", ",", "pred", ",", "return_more", "=", "True", ")", "\n", "loss_match", "=", "self", ".", "loss_match", "(", "*", "pred", "[", "'features_match'", "]", ")", "\n", "# for k,v in loss.items():", "\n", "#     self.log(f'val_{k}', v.float().mean(), sync_dist=True)", "\n", "# return", "\n", "ans", "=", "{", "\n", "f'val_{met}'", ":", "v", ".", "float", "(", ")", ".", "mean", "(", ")", "\n", "for", "met", ",", "v", "in", "loss", ".", "items", "(", ")", "\n", "}", "\n", "ans", "[", "'val_loss_match'", "]", "=", "loss_match", "\n", "self", ".", "log", "(", "'val_loss'", ",", "ans", "[", "'val_loss'", "]", "+", "self", ".", "lambda_match", "*", "loss_match", ",", "sync_dist", "=", "True", ")", "\n", "self", ".", "log", "(", "'val_loss_heatmap'", ",", "ans", "[", "'val_loss'", "]", ",", "sync_dist", "=", "True", ")", "\n", "self", ".", "log", "(", "'val_loss_match'", ",", "loss_match", ",", "sync_dist", "=", "True", ")", "\n", "return", "ans", "\n", "", "def", "validation_epoch_end", "(", "self", ",", "outputs", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.fermat.Model.validation_epoch_end": [[168, 173], ["fermat.Model.log", "torch.stack().mean", "torch.stack"], "methods", ["None"], ["", "def", "validation_epoch_end", "(", "self", ",", "outputs", ")", ":", "\n", "# self.wean_epochs += 1", "\n", "        ", "for", "met", "in", "outputs", "[", "0", "]", ":", "\n", "            ", "self", ".", "log", "(", "met", ",", "torch", ".", "stack", "(", "[", "o", "[", "met", "]", "for", "o", "in", "outputs", "]", ")", ".", "mean", "(", ")", ",", "sync_dist", "=", "True", ")", "\n", "", "return", "\n", "", "def", "configure_optimizers", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.fermat.Model.configure_optimizers": [[173, 185], ["torch.optim.Adam", "fermat.Model.keypoint_head.parameters"], "methods", ["None"], ["", "def", "configure_optimizers", "(", "self", ")", ":", "\n", "        ", "opt", "=", "torch", ".", "optim", ".", "Adam", "(", "\n", "self", ".", "keypoint_head", ".", "parameters", "(", ")", ",", "\n", "lr", "=", "self", ".", "hparams", ".", "margs", ".", "lr", ",", "\n", ")", "\n", "# sched = torch.optim.lr_scheduler.CosineAnnealingLR(", "\n", "#     opt,", "\n", "#     T_max=self.hparams.margs.max_epochs,", "\n", "#     eta_min=0,", "\n", "# )", "\n", "# return [opt,], [sched,]", "\n", "return", "opt", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.fermat.ResnetFeatureConverter.__init__": [[190, 203], ["nn.Module.__init__", "TT.Resize", "nn.Conv2d", "nn.Conv2d", "nn.Conv2d", "nn.Conv2d", "nn.Conv2d", "nn.LeakyReLU", "nn.BatchNorm2d"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__init__"], ["    ", "def", "__init__", "(", "self", ",", "size", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "size", "=", "size", "\n", "self", ".", "resizer", "=", "TT", ".", "Resize", "(", "self", ".", "size", ")", "\n", "self", ".", "conv1", "=", "nn", ".", "Conv2d", "(", "64", ",", "64", ",", "kernel_size", "=", "1", ",", "padding", "=", "0", ")", "\n", "self", ".", "layer1", "=", "nn", ".", "Conv2d", "(", "256", ",", "64", ",", "kernel_size", "=", "1", ",", "padding", "=", "0", ")", "\n", "self", ".", "layer2", "=", "nn", ".", "Conv2d", "(", "512", ",", "64", ",", "kernel_size", "=", "1", ",", "padding", "=", "0", ")", "\n", "self", ".", "layer3", "=", "nn", ".", "Conv2d", "(", "1024", ",", "64", ",", "kernel_size", "=", "1", ",", "padding", "=", "0", ")", "\n", "# self.layer4 = nn.Conv2d(2048, 128, kernel_size=1, padding=0)", "\n", "self", ".", "head", "=", "nn", ".", "Conv2d", "(", "64", "*", "4", ",", "128", ",", "kernel_size", "=", "3", ",", "padding", "=", "1", ",", "padding_mode", "=", "'replicate'", ")", "\n", "self", ".", "relu", "=", "nn", ".", "LeakyReLU", "(", ")", "\n", "self", ".", "batchnorm", "=", "nn", ".", "BatchNorm2d", "(", "64", "*", "4", ")", "\n", "return", "\n", "", "def", "forward", "(", "self", ",", "feats_resnet", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.fermat.ResnetFeatureConverter.forward": [[203, 211], ["fermat.ResnetFeatureConverter.head", "fermat.ResnetFeatureConverter.relu", "fermat.ResnetFeatureConverter.batchnorm", "torch.cat", "fermat.ResnetFeatureConverter.resizer", "fermat.ResnetFeatureConverter.resizer", "fermat.ResnetFeatureConverter.resizer", "fermat.ResnetFeatureConverter.resizer", "fermat.ResnetFeatureConverter.conv1", "fermat.ResnetFeatureConverter.layer1", "fermat.ResnetFeatureConverter.layer2", "fermat.ResnetFeatureConverter.layer3"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "feats_resnet", ")", ":", "\n", "        ", "return", "self", ".", "head", "(", "self", ".", "relu", "(", "self", ".", "batchnorm", "(", "torch", ".", "cat", "(", "[", "\n", "self", ".", "resizer", "(", "self", ".", "conv1", "(", "feats_resnet", "[", "'conv1'", "]", ")", ")", ",", "\n", "self", ".", "resizer", "(", "self", ".", "layer1", "(", "feats_resnet", "[", "'layer1'", "]", ")", ")", ",", "\n", "self", ".", "resizer", "(", "self", ".", "layer2", "(", "feats_resnet", "[", "'layer2'", "]", ")", ")", ",", "\n", "self", ".", "resizer", "(", "self", ".", "layer3", "(", "feats_resnet", "[", "'layer3'", "]", ")", ")", ",", "\n", "# self.resizer(self.layer4(feats_resnet['layer4'])),", "\n", "]", ",", "dim", "=", "1", ")", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.fermat.ResnetFeatureExtractor.__init__": [[215, 272], ["nn.Module.__init__", "tv.models.resnet50", "TT.Resize", "TT.Normalize", "torch.hub.load", "TT.Resize", "TT.Normalize", "_train.danbooru_tagger.models.kate.Model.load_from_checkpoint", "TT.Resize"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__init__"], ["    ", "def", "__init__", "(", "self", ",", "inferserve_query", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "inferserve_query", "=", "inferserve_query", "\n", "if", "self", ".", "inferserve_query", "==", "'torchvision'", ":", "\n", "# use pytorch pretrained resnet50", "\n", "            ", "self", ".", "inferserve", "=", "None", "\n", "self", ".", "base_hparams", "=", "None", "\n", "resnet", "=", "tv", ".", "models", ".", "resnet50", "(", "pretrained", "=", "True", ")", "\n", "\n", "self", ".", "resize", "=", "TT", ".", "Resize", "(", "256", ")", "\n", "self", ".", "resnet_preprocess", "=", "TT", ".", "Normalize", "(", "mean", "=", "[", "0.485", ",", "0.456", ",", "0.406", "]", ",", "std", "=", "[", "0.229", ",", "0.224", ",", "0.225", "]", ")", "\n", "self", ".", "conv1", "=", "resnet", ".", "conv1", "\n", "self", ".", "bn1", "=", "resnet", ".", "bn1", "\n", "self", ".", "relu", "=", "resnet", ".", "relu", "#   64ch, 128p (assuming 256p input)", "\n", "self", ".", "maxpool", "=", "resnet", ".", "maxpool", "\n", "self", ".", "layer1", "=", "resnet", ".", "layer1", "#  256ch,  64p", "\n", "self", ".", "layer2", "=", "resnet", ".", "layer2", "#  512ch,  32p", "\n", "self", ".", "layer3", "=", "resnet", ".", "layer3", "# 1024ch,  16p", "\n", "# self.layer4 = resnet.layer4  # 2048ch,   8p", "\n", "", "elif", "self", ".", "inferserve_query", "==", "'rf5'", ":", "\n", "# use rf5 resnet50", "\n", "            ", "self", ".", "inferserve", "=", "None", "\n", "self", ".", "base_hparams", "=", "None", "\n", "resnet", "=", "torch", ".", "hub", ".", "load", "(", "'RF5/danbooru-pretrained'", ",", "'resnet50'", ")", "\n", "\n", "self", ".", "resize", "=", "TT", ".", "Resize", "(", "256", ")", "\n", "self", ".", "resnet_preprocess", "=", "TT", ".", "Normalize", "(", "mean", "=", "[", "0.7137", ",", "0.6628", ",", "0.6519", "]", ",", "std", "=", "[", "0.2970", ",", "0.3017", ",", "0.2979", "]", ")", "\n", "self", ".", "conv1", "=", "resnet", "[", "0", "]", "[", "0", "]", "\n", "self", ".", "bn1", "=", "resnet", "[", "0", "]", "[", "1", "]", "\n", "self", ".", "relu", "=", "resnet", "[", "0", "]", "[", "2", "]", "#   64ch, 128p (assuming 256p input)", "\n", "self", ".", "maxpool", "=", "resnet", "[", "0", "]", "[", "3", "]", "\n", "self", ".", "layer1", "=", "resnet", "[", "0", "]", "[", "4", "]", "#  256ch,  64p", "\n", "self", ".", "layer2", "=", "resnet", "[", "0", "]", "[", "5", "]", "#  512ch,  32p", "\n", "self", ".", "layer3", "=", "resnet", "[", "0", "]", "[", "6", "]", "# 1024ch,  16p", "\n", "# self.layer4 = resnet[0][7]  # 2048ch,   8p", "\n", "", "else", ":", "\n", "# use pretrained kate, danbooru-specific", "\n", "# self.inferserve = util_serve.infer_ckpt(self.inferserve_query)", "\n", "# base = Classifier.load_from_checkpoint(self.inferserve['fn'])", "\n", "            ", "self", ".", "inferserve", "=", "None", "\n", "base", "=", "Classifier", ".", "load_from_checkpoint", "(", "\n", "'./_train/danbooru_tagger/runs/waning_kate_vulcan0001/checkpoints/'", "\n", "'epoch=0022-val_f2=0.4461-val_loss=0.0766.ckpt'", "\n", ")", "\n", "self", ".", "base_hparams", "=", "base", ".", "hparams", "\n", "\n", "self", ".", "resize", "=", "TT", ".", "Resize", "(", "base", ".", "hparams", ".", "largs", ".", "danbooru_sfw", ".", "size", ")", "\n", "self", ".", "resnet_preprocess", "=", "base", ".", "resnet_preprocess", "\n", "self", ".", "conv1", "=", "base", ".", "resnet", ".", "conv1", "\n", "self", ".", "bn1", "=", "base", ".", "resnet", ".", "bn1", "\n", "self", ".", "relu", "=", "base", ".", "resnet", ".", "relu", "#   64ch, 128p (assuming 256p input)", "\n", "self", ".", "maxpool", "=", "base", ".", "resnet", ".", "maxpool", "\n", "self", ".", "layer1", "=", "base", ".", "resnet", ".", "layer1", "#  256ch,  64p", "\n", "self", ".", "layer2", "=", "base", ".", "resnet", ".", "layer2", "#  512ch,  32p", "\n", "self", ".", "layer3", "=", "base", ".", "resnet", ".", "layer3", "# 1024ch,  16p", "\n", "# self.layer4 = base.resnet.layer4  # 2048ch,   8p", "\n", "", "return", "\n", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.fermat.ResnetFeatureExtractor.forward": [[272, 290], ["fermat.ResnetFeatureExtractor.resize", "fermat.ResnetFeatureExtractor.resnet_preprocess", "fermat.ResnetFeatureExtractor.conv1", "fermat.ResnetFeatureExtractor.bn1", "fermat.ResnetFeatureExtractor.relu", "fermat.ResnetFeatureExtractor.maxpool", "fermat.ResnetFeatureExtractor.layer1", "fermat.ResnetFeatureExtractor.layer2", "fermat.ResnetFeatureExtractor.layer3"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "ans", "=", "{", "}", "\n", "x", "=", "self", ".", "resize", "(", "x", ")", "\n", "x", "=", "self", ".", "resnet_preprocess", "(", "x", ")", "\n", "x", "=", "self", ".", "conv1", "(", "x", ")", "\n", "x", "=", "self", ".", "bn1", "(", "x", ")", "\n", "x", "=", "self", ".", "relu", "(", "x", ")", "\n", "ans", "[", "'conv1'", "]", "=", "x", "\n", "x", "=", "self", ".", "maxpool", "(", "x", ")", "\n", "x", "=", "self", ".", "layer1", "(", "x", ")", "\n", "ans", "[", "'layer1'", "]", "=", "x", "\n", "x", "=", "self", ".", "layer2", "(", "x", ")", "\n", "ans", "[", "'layer2'", "]", "=", "x", "\n", "x", "=", "self", ".", "layer3", "(", "x", ")", "\n", "ans", "[", "'layer3'", "]", "=", "x", "\n", "# x = self.layer4(x)", "\n", "# ans['layer4'] = x", "\n", "return", "ans", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.fermat.PretrainedKeypointDetector.__init__": [[292, 322], ["nn.Module.__init__", "detectron2.config.get_cfg", "fermat.PretrainedKeypointDetector.cfg.merge_from_file", "detectron2.model_zoo.get_checkpoint_url", "detectron2.engine.DefaultPredictor", "fermat.PretrainedKeypointDetector.model.parameters", "TT.Resize", "detectron2.model_zoo.get_config_file"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__init__"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\n", "# setup rcnn model", "\n", "self", ".", "cfg", "=", "detectron2", ".", "config", ".", "get_cfg", "(", ")", "\n", "self", ".", "cfg", ".", "merge_from_file", "(", "detectron2", ".", "model_zoo", ".", "get_config_file", "(", "\n", "'COCO-Keypoints/keypoint_rcnn_R_101_FPN_3x.yaml'", "\n", ")", ")", "\n", "self", ".", "cfg", ".", "MODEL", ".", "ROI_HEADS", ".", "SCORE_THRESH_TEST", "=", "0.0", "\n", "self", ".", "cfg", ".", "MODEL", ".", "WEIGHTS", "=", "detectron2", ".", "model_zoo", ".", "get_checkpoint_url", "(", "\n", "'COCO-Keypoints/keypoint_rcnn_R_101_FPN_3x.yaml'", "\n", ")", "\n", "self", ".", "cfg", "[", "'MODEL'", "]", "[", "'DEVICE'", "]", "=", "'cpu'", "\n", "self", ".", "predictor", "=", "detectron2", ".", "engine", ".", "DefaultPredictor", "(", "self", ".", "cfg", ")", "\n", "self", ".", "model", "=", "self", ".", "predictor", ".", "model", "\n", "\n", "# # change roi head", "\n", "# self.cfg.MODEL.ROI_KEYPOINT_HEAD.NUM_KEYPOINTS = 17+8", "\n", "# self.model.roi_heads.keypoint_head.score_lowres = nn.ConvTranspose2d(", "\n", "#     512, 17+8, kernel_size=(4, 4), stride=(2, 2), padding=(1, 1),", "\n", "# )", "\n", "\n", "# freeze all params", "\n", "for", "param", "in", "self", ".", "model", ".", "parameters", "(", ")", ":", "\n", "            ", "param", ".", "requires_grad", "=", "False", "\n", "\n", "# preprocessing", "\n", "", "self", ".", "size", "=", "800", "\n", "self", ".", "resize", "=", "TT", ".", "Resize", "(", "self", ".", "size", ")", "\n", "return", "\n", "", "def", "forward", "(", "self", ",", "img", ",", "return_more", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.fermat.PretrainedKeypointDetector.forward": [[322, 367], ["fermat.PretrainedKeypointDetector.model.preprocess_image", "fermat.PretrainedKeypointDetector.model.backbone.eval", "range", "torch.no_grad", "fermat.PretrainedKeypointDetector.model.backbone", "detectron2.structures.instances.Instances", "roi.keypoint_pooler", "range", "len", "fermat.PretrainedKeypointDetector.resize().flip", "detectron2.structures.boxes.Boxes", "torch.tensor", "fermat.PretrainedKeypointDetector.resize", "torch.tensor"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor"], ["", "def", "forward", "(", "self", ",", "img", ",", "return_more", "=", "False", ")", ":", "\n", "# assumes img.shape = (bs, rgb, h, w)", "\n", "        ", "h", ",", "w", "=", "img", ".", "shape", "[", "2", ":", "]", "\n", "x", "=", "[", "{", "'image'", ":", "i", ",", "'height'", ":", "h", ",", "'width'", ":", "w", "}", "for", "i", "in", "255", "*", "self", ".", "resize", "(", "img", ")", ".", "flip", "(", "1", ")", "]", "\n", "images", "=", "self", ".", "model", ".", "preprocess_image", "(", "x", ")", "\n", "self", ".", "model", ".", "backbone", ".", "eval", "(", ")", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "features", "=", "self", ".", "model", ".", "backbone", "(", "images", ".", "tensor", ")", "\n", "\n", "# forces them to use my bboxes", "\n", "", "h", ",", "w", "=", "images", "[", "0", "]", ".", "shape", "[", "1", ":", "]", "\n", "detected_instances", "=", "[", "\n", "detectron2", ".", "structures", ".", "instances", ".", "Instances", "(", "\n", "image_size", "=", "(", "h", ",", "w", ")", ",", "\n", "pred_boxes", "=", "detectron2", ".", "structures", ".", "boxes", ".", "Boxes", "(", "torch", ".", "tensor", "(", "[", "\n", "0", ",", "0", ",", "h", ",", "w", ",", "\n", "]", ",", "device", "=", "images", ".", "device", ")", "[", "None", "]", ")", ",", "\n", "pred_classes", "=", "torch", ".", "tensor", "(", "[", "0", ",", "]", ",", "device", "=", "images", ".", "device", ")", ",", "\n", ")", "\n", "for", "_", "in", "range", "(", "img", ".", "shape", "[", "0", "]", ")", "\n", "]", "\n", "\n", "# roi_heads.forward_with_given_boxes, in StandardROIHeads", "\n", "# results = self.model.roi_heads.forward_with_given_boxes(features, detected_instances)", "\n", "# results = self.model.roi_heads._forward_keypoint(features, detected_instances)", "\n", "roi", "=", "self", ".", "model", ".", "roi_heads", "\n", "_instances", "=", "detected_instances", "\n", "if", "roi", ".", "keypoint_pooler", "is", "not", "None", ":", "\n", "            ", "_features", "=", "[", "features", "[", "f", "]", "for", "f", "in", "roi", ".", "keypoint_in_features", "]", "\n", "#boxes = [x.proposal_boxes if self.training else x.pred_boxes for x in instances]", "\n", "_boxes", "=", "[", "x", ".", "pred_boxes", "for", "x", "in", "_instances", "]", "\n", "_features", "=", "roi", ".", "keypoint_pooler", "(", "_features", ",", "_boxes", ")", "\n", "", "else", ":", "\n", "            ", "_features", "=", "{", "f", ":", "features", "[", "f", "]", "for", "f", "in", "roi", ".", "keypoint_in_features", "}", "\n", "\n", "# roi_heads.keypoint_head.forward, in BaseKeypointRCNNHead", "\n", "# pred_keypoint_logits = roi.keypoint_head.layers(_features)", "\n", "# return {'keypoint_heatmaps': pred_keypoint_logits, 'locals': locals()}", "\n", "\n", "# get last feature layer", "\n", "", "fl", "=", "_features", "\n", "for", "i", "in", "range", "(", "len", "(", "roi", ".", "keypoint_head", ")", "-", "1", ")", ":", "\n", "            ", "fl", "=", "roi", ".", "keypoint_head", "[", "i", "]", "(", "fl", ")", "\n", "", "feats_last", "=", "fl", "# 256p input -> 512ch, 14p", "\n", "return", "{", "'features_last'", ":", "feats_last", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.passup.Model.__init__": [[13, 44], ["pl.LightningModule.__init__", "passup.Model.save_hyperparameters", "ResnetFeatureExtractor().eval", "PretrainedKeypointDetector().eval", "TT.Resize", "nn.ModuleDict", "nn.BCEWithLogitsLoss", "passup.ResnetFeatureExtractor", "passup.PretrainedKeypointDetector", "passup.Model.resnet.parameters", "passup.Model.rcnn.parameters", "passup.ResnetFeatureConverter", "nn.Conv2d", "nn.Sequential", "nn.Conv2d", "nn.LeakyReLU", "nn.BatchNorm2d", "_util.ResBlock", "_util.ResBlock", "_util.ResBlock", "_util.ResBlock", "_util.ResBlock", "_util.ResBlock", "_util.ResBlock", "_util.ResBlock", "_util.ResBlock", "_util.ResBlock", "nn.Conv2d"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__init__"], ["    ", "def", "__init__", "(", "self", ",", "bargs", ",", "pargs", ",", "largs", ",", "margs", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "hparams", ".", "bargs", "=", "bargs", "\n", "self", ".", "hparams", ".", "pargs", "=", "pargs", "\n", "self", ".", "hparams", ".", "largs", "=", "largs", "\n", "self", ".", "hparams", ".", "margs", "=", "margs", "\n", "self", ".", "save_hyperparameters", "(", ")", "\n", "\n", "# set up frozen pretrained networks", "\n", "self", ".", "resnet", "=", "ResnetFeatureExtractor", "(", "margs", ".", "resnet_inferserve_query", ")", ".", "eval", "(", ")", "\n", "self", ".", "rcnn", "=", "PretrainedKeypointDetector", "(", ")", ".", "eval", "(", ")", "\n", "for", "param", "in", "[", "*", "self", ".", "resnet", ".", "parameters", "(", ")", ",", "*", "self", ".", "rcnn", ".", "parameters", "(", ")", "]", ":", "\n", "            ", "param", ".", "requires_grad", "=", "False", "\n", "\n", "# set up keypoint detector head", "\n", "", "self", ".", "size", "=", "margs", ".", "size", "\n", "self", ".", "resizer", "=", "TT", ".", "Resize", "(", "self", ".", "size", ")", "\n", "self", ".", "keypoint_head", "=", "nn", ".", "ModuleDict", "(", "{", "\n", "'converter_resnet'", ":", "ResnetFeatureConverter", "(", "self", ".", "size", ")", ",", "\n", "'converter_rcnn'", ":", "nn", ".", "Conv2d", "(", "17", ",", "32", ",", "kernel_size", "=", "1", ",", "padding", "=", "0", ")", ",", "\n", "'head'", ":", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Conv2d", "(", "128", "+", "32", "+", "3", ",", "128", ",", "kernel_size", "=", "3", ",", "padding", "=", "1", ",", "padding_mode", "=", "'replicate'", ")", ",", "\n", "nn", ".", "LeakyReLU", "(", ")", ",", "\n", "nn", ".", "BatchNorm2d", "(", "128", ")", ",", "\n", "util_hm", ".", "ResBlock", "(", "3", ",", "64", ",", "3", ",", "channels_in", "=", "128", ")", ",", "\n", "util_hm", ".", "ResBlock", "(", "3", ",", "32", ",", "3", ",", "channels_in", "=", "64", ")", ",", "\n", "nn", ".", "Conv2d", "(", "32", ",", "17", "+", "8", ",", "kernel_size", "=", "3", ",", "padding", "=", "1", ",", "padding_mode", "=", "'replicate'", ")", ",", "\n", ")", ",", "\n", "}", ")", "\n", "self", ".", "bce_logits", "=", "nn", ".", "BCEWithLogitsLoss", "(", "reduction", "=", "'none'", ")", "\n", "return", "\n", "", "def", "loss", "(", "self", ",", "gt", ",", "pred", ",", "return_more", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.passup.Model.loss": [[44, 66], ["passup.Model.bce_logits", "passup.Model.resizer", "torch.no_grad", "_util.pcp", "_util.pcp", "_util.pcp", "_util.pcp", "_util.pcp", "_util.pcp", "_util.pcp", "_util.pcp", "_util.pcp", "_util.pcp", "_util.pck", "_util.pck", "_util.pck", "_util.pck", "_util.pck", "_util.pck", "_util.pck", "_util.pck", "_util.pck", "_util.pck", "_util.pdj", "_util.pdj", "_util.pdj", "_util.pdj", "_util.pdj", "_util.oks", "_util.oks", "_util.oks", "_util.oks", "_util.oks", "_util.oks", "_util.oks", "_util.oks", "_util.oks", "_util.oks"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pdj", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pdj", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pdj", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pdj", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pdj", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks"], ["", "def", "loss", "(", "self", ",", "gt", ",", "pred", ",", "return_more", "=", "False", ")", ":", "\n", "# expects gt/pred is {keypoint_heatmaps: (bs,17+8,h,w)}", "\n", "# expects pred heatmaps in logits (pre-sigmoid)", "\n", "# expects keypoints in dict if return_more", "\n", "# if keypoint_loss_weights in gt, will apply", "\n", "        ", "ans", "=", "{", "}", "\n", "if", "'keypoint_heatmaps'", "in", "gt", "and", "'keypoint_heatmaps'", "in", "pred", ":", "\n", "            ", "bce", "=", "self", ".", "bce_logits", "(", "pred", "[", "'keypoint_heatmaps'", "]", ",", "self", ".", "resizer", "(", "gt", "[", "'keypoint_heatmaps'", "]", ")", ")", "\n", "wt", "=", "1", "if", "'keypoint_loss_weights'", "not", "in", "gt", "else", "gt", "[", "'keypoint_loss_weights'", "]", "[", ":", ",", ":", ",", "None", ",", "None", "]", "\n", "ans", "[", "'loss'", "]", "=", "wt", "*", "bce", "\n", "", "if", "return_more", ":", "\n", "            ", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "                ", "q", "=", "gt", "[", "'keypoints'", "]", "[", ":", ",", ":", "17", ",", ":", "2", "]", ",", "gt", "[", "'bbox'", "]", ",", "pred", "[", "'keypoints'", "]", "[", ":", ",", ":", "17", ",", ":", "2", "]", "\n", "mpl", "=", "gt", "[", "'mean_part_lengths'", "]", "\n", "ans", "[", "'pcp_50'", "]", "=", "util_keypoints", ".", "pcp", "(", "*", "q", ",", "k", "=", "0.5", ")", "[", "'correct_parts'", "]", "\n", "ans", "[", "'pcpm_50'", "]", "=", "util_keypoints", ".", "pcp", "(", "*", "q", ",", "k", "=", "0.5", ",", "m", "=", "mpl", ")", "[", "'correct_parts'", "]", "\n", "ans", "[", "'pckh_20'", "]", "=", "util_keypoints", ".", "pck", "(", "*", "q", ",", "k", "=", "0.2", ",", "mode", "=", "'h'", ")", "[", "'correct_joints'", "]", "\n", "ans", "[", "'pckh_50'", "]", "=", "util_keypoints", ".", "pck", "(", "*", "q", ",", "k", "=", "0.5", ",", "mode", "=", "'h'", ")", "[", "'correct_joints'", "]", "\n", "ans", "[", "'pdj_20'", "]", "=", "util_keypoints", ".", "pdj", "(", "*", "q", ",", "k", "=", "0.2", ")", "[", "'correct_joints'", "]", "\n", "ans", "[", "'oks_50'", "]", "=", "util_keypoints", ".", "oks", "(", "*", "q", ",", "thresh", "=", "0.5", ")", "[", "'correct_joints'", "]", "\n", "ans", "[", "'oks_75'", "]", "=", "util_keypoints", ".", "oks", "(", "*", "q", ",", "thresh", "=", "0.75", ")", "[", "'correct_joints'", "]", "\n", "", "", "return", "ans", "\n", "", "def", "forward", "(", "self", ",", "x", ",", "smoothing", "=", "None", ",", "return_more", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.passup.Model.forward": [[66, 107], ["passup.Model.rcnn.eval", "passup.Model.resnet.eval", "torch.cat", "torch.no_grad", "passup.Model.resnet", "passup.Model.rcnn", "passup.Model.resizer", "passup.Model.resizer", "passup.Model.resizer", "torch.sigmoid", "hms.view().argmax", "torch.stack", "torch.sigmoid", "max", "kornia.filters.gaussian_blur2d", "kornia.filters.gaussian_blur2d.view().argmax", "torch.stack", "max", "hms.view", "kornia.filters.gaussian_blur2d.view", "int"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "smoothing", "=", "None", ",", "return_more", "=", "False", ")", ":", "\n", "        ", "self", ".", "rcnn", ".", "eval", "(", ")", "\n", "self", ".", "resnet", ".", "eval", "(", ")", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "feats_resnet", "=", "self", ".", "resnet", "(", "x", ")", "\n", "feats_rcnn", "=", "self", ".", "rcnn", "(", "x", ",", "return_more", "=", "return_more", ")", "\n", "", "feats", "=", "torch", ".", "cat", "(", "[", "\n", "self", ".", "resizer", "(", "x", ")", ",", "\n", "self", ".", "resizer", "(", "self", ".", "keypoint_head", "[", "'converter_resnet'", "]", "(", "feats_resnet", ")", ")", ",", "\n", "self", ".", "resizer", "(", "self", ".", "keypoint_head", "[", "'converter_rcnn'", "]", "(", "feats_rcnn", "[", "'keypoint_heatmaps'", "]", ")", ")", ",", "\n", "]", ",", "dim", "=", "1", ")", "\n", "hms", "=", "self", ".", "keypoint_head", "[", "'head'", "]", "(", "feats", ")", "\n", "ans", "=", "{", "'keypoint_heatmaps'", ":", "hms", "}", "\n", "if", "return_more", ":", "\n", "            ", "ans", "[", "'features_resnet'", "]", "=", "feats_resnet", "\n", "ans", "[", "'features_rcnn'", "]", "=", "feats_rcnn", "\n", "if", "smoothing", "is", "None", ":", "\n", "                ", "ans", "[", "'keypoint_heatmaps_prob'", "]", "=", "torch", ".", "sigmoid", "(", "hms", ")", "\n", "kps", "=", "hms", ".", "view", "(", "hms", ".", "shape", "[", "0", "]", ",", "hms", ".", "shape", "[", "1", "]", ",", "-", "1", ")", ".", "argmax", "(", "-", "1", ")", "\n", "kps", "=", "torch", ".", "stack", "(", "[", "\n", "kps", "//", "hms", ".", "shape", "[", "2", "]", "*", "(", "x", ".", "shape", "[", "2", "]", "/", "hms", ".", "shape", "[", "2", "]", ")", ",", "\n", "kps", "%", "hms", ".", "shape", "[", "3", "]", "*", "(", "x", ".", "shape", "[", "3", "]", "/", "hms", ".", "shape", "[", "3", "]", ")", ",", "\n", "]", ",", "dim", "=", "2", ")", "\n", "", "else", ":", "\n", "                ", "hmp", "=", "torch", ".", "sigmoid", "(", "hms", ")", "\n", "ksig", "=", "max", "(", "hmp", ".", "shape", "[", "-", "2", ":", "]", ")", "*", "smoothing", "\n", "kern", "=", "max", "(", "3", ",", "int", "(", "ksig", ")", "*", "2", "+", "1", ")", "\n", "hmps", "=", "kornia", ".", "filters", ".", "gaussian_blur2d", "(", "\n", "hmp", ",", "\n", "kernel_size", "=", "(", "kern", ",", "kern", ")", ",", "\n", "sigma", "=", "(", "ksig", ",", "ksig", ")", ",", "\n", "border_type", "=", "'reflect'", ",", "\n", ")", "\n", "kps", "=", "hmps", ".", "view", "(", "hmps", ".", "shape", "[", "0", "]", ",", "hmps", ".", "shape", "[", "1", "]", ",", "-", "1", ")", ".", "argmax", "(", "-", "1", ")", "\n", "kps", "=", "torch", ".", "stack", "(", "[", "\n", "kps", "//", "hmps", ".", "shape", "[", "2", "]", "*", "(", "x", ".", "shape", "[", "2", "]", "/", "hmps", ".", "shape", "[", "2", "]", ")", ",", "\n", "kps", "%", "hmps", ".", "shape", "[", "3", "]", "*", "(", "x", ".", "shape", "[", "3", "]", "/", "hmps", ".", "shape", "[", "3", "]", ")", ",", "\n", "]", ",", "dim", "=", "2", ")", "\n", "ans", "[", "'keypoint_heatmaps_prob'", "]", "=", "hmps", "\n", "", "ans", "[", "'keypoints'", "]", "=", "kps", "\n", "", "return", "ans", "\n", "", "def", "training_step", "(", "self", ",", "batch", ",", "batch_idx", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.passup.Model.training_step": [[107, 114], ["passup.Model.forward", "passup.Model.loss", "loss[].mean", "passup.Model.log"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.Injector.forward", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.alaska.Model.loss"], ["", "def", "training_step", "(", "self", ",", "batch", ",", "batch_idx", ")", ":", "\n", "        ", "pred", "=", "self", ".", "forward", "(", "batch", "[", "'image'", "]", ",", "return_more", "=", "False", ")", "\n", "loss", "=", "self", ".", "loss", "(", "batch", ",", "pred", ",", "return_more", "=", "False", ")", "\n", "loss_agg", "=", "loss", "[", "'loss'", "]", ".", "mean", "(", ")", "\n", "self", ".", "log", "(", "'train_loss'", ",", "loss_agg", ",", "sync_dist", "=", "True", ")", "\n", "return", "{", "\n", "'loss'", ":", "loss_agg", ",", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.passup.Model.validation_step": [[115, 127], ["passup.Model.forward", "passup.Model.loss", "passup.Model.log", "v.float().mean", "passup.Model.items", "v.float"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.Injector.forward", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.alaska.Model.loss"], ["", "def", "validation_step", "(", "self", ",", "batch", ",", "batch_idx", ")", ":", "\n", "        ", "pred", "=", "self", ".", "forward", "(", "batch", "[", "'image'", "]", ",", "return_more", "=", "True", ")", "\n", "loss", "=", "self", ".", "loss", "(", "batch", ",", "pred", ",", "return_more", "=", "True", ")", "\n", "# for k,v in loss.items():", "\n", "#     self.log(f'val_{k}', v.float().mean(), sync_dist=True)", "\n", "# return", "\n", "ans", "=", "{", "\n", "f'val_{met}'", ":", "v", ".", "float", "(", ")", ".", "mean", "(", ")", "\n", "for", "met", ",", "v", "in", "loss", ".", "items", "(", ")", "\n", "}", "\n", "self", ".", "log", "(", "'val_loss'", ",", "ans", "[", "'val_loss'", "]", ",", "sync_dist", "=", "True", ")", "\n", "return", "ans", "\n", "", "def", "validation_epoch_end", "(", "self", ",", "outputs", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.passup.Model.validation_epoch_end": [[127, 131], ["passup.Model.log", "torch.stack().mean", "torch.stack"], "methods", ["None"], ["", "def", "validation_epoch_end", "(", "self", ",", "outputs", ")", ":", "\n", "        ", "for", "met", "in", "outputs", "[", "0", "]", ":", "\n", "            ", "self", ".", "log", "(", "met", ",", "torch", ".", "stack", "(", "[", "o", "[", "met", "]", "for", "o", "in", "outputs", "]", ")", ".", "mean", "(", ")", ",", "sync_dist", "=", "True", ")", "\n", "", "return", "\n", "", "def", "configure_optimizers", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.passup.Model.configure_optimizers": [[131, 142], ["torch.optim.Adam", "torch.optim.lr_scheduler.CosineAnnealingLR", "passup.Model.keypoint_head.parameters"], "methods", ["None"], ["", "def", "configure_optimizers", "(", "self", ")", ":", "\n", "        ", "opt", "=", "torch", ".", "optim", ".", "Adam", "(", "\n", "self", ".", "keypoint_head", ".", "parameters", "(", ")", ",", "\n", "lr", "=", "self", ".", "hparams", ".", "margs", ".", "lr", ",", "\n", ")", "\n", "sched", "=", "torch", ".", "optim", ".", "lr_scheduler", ".", "CosineAnnealingLR", "(", "\n", "opt", ",", "\n", "T_max", "=", "self", ".", "hparams", ".", "margs", ".", "max_epochs", ",", "\n", "eta_min", "=", "0", ",", "\n", ")", "\n", "return", "[", "opt", ",", "]", ",", "[", "sched", ",", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.passup.ResnetFeatureConverter.__init__": [[147, 160], ["nn.Module.__init__", "TT.Resize", "nn.Conv2d", "nn.Conv2d", "nn.Conv2d", "nn.Conv2d", "nn.Conv2d", "nn.LeakyReLU", "nn.BatchNorm2d"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__init__"], ["    ", "def", "__init__", "(", "self", ",", "size", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "size", "=", "size", "\n", "self", ".", "resizer", "=", "TT", ".", "Resize", "(", "self", ".", "size", ")", "\n", "self", ".", "conv1", "=", "nn", ".", "Conv2d", "(", "64", ",", "64", ",", "kernel_size", "=", "1", ",", "padding", "=", "0", ")", "\n", "self", ".", "layer1", "=", "nn", ".", "Conv2d", "(", "256", ",", "64", ",", "kernel_size", "=", "1", ",", "padding", "=", "0", ")", "\n", "self", ".", "layer2", "=", "nn", ".", "Conv2d", "(", "512", ",", "64", ",", "kernel_size", "=", "1", ",", "padding", "=", "0", ")", "\n", "self", ".", "layer3", "=", "nn", ".", "Conv2d", "(", "1024", ",", "64", ",", "kernel_size", "=", "1", ",", "padding", "=", "0", ")", "\n", "# self.layer4 = nn.Conv2d(2048, 128, kernel_size=1, padding=0)", "\n", "self", ".", "head", "=", "nn", ".", "Conv2d", "(", "64", "*", "4", ",", "128", ",", "kernel_size", "=", "3", ",", "padding", "=", "1", ",", "padding_mode", "=", "'replicate'", ")", "\n", "self", ".", "relu", "=", "nn", ".", "LeakyReLU", "(", ")", "\n", "self", ".", "batchnorm", "=", "nn", ".", "BatchNorm2d", "(", "64", "*", "4", ")", "\n", "return", "\n", "", "def", "forward", "(", "self", ",", "feats_resnet", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.passup.ResnetFeatureConverter.forward": [[160, 168], ["passup.ResnetFeatureConverter.head", "passup.ResnetFeatureConverter.relu", "passup.ResnetFeatureConverter.batchnorm", "torch.cat", "passup.ResnetFeatureConverter.resizer", "passup.ResnetFeatureConverter.resizer", "passup.ResnetFeatureConverter.resizer", "passup.ResnetFeatureConverter.resizer", "passup.ResnetFeatureConverter.conv1", "passup.ResnetFeatureConverter.layer1", "passup.ResnetFeatureConverter.layer2", "passup.ResnetFeatureConverter.layer3"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "feats_resnet", ")", ":", "\n", "        ", "return", "self", ".", "head", "(", "self", ".", "relu", "(", "self", ".", "batchnorm", "(", "torch", ".", "cat", "(", "[", "\n", "self", ".", "resizer", "(", "self", ".", "conv1", "(", "feats_resnet", "[", "'conv1'", "]", ")", ")", ",", "\n", "self", ".", "resizer", "(", "self", ".", "layer1", "(", "feats_resnet", "[", "'layer1'", "]", ")", ")", ",", "\n", "self", ".", "resizer", "(", "self", ".", "layer2", "(", "feats_resnet", "[", "'layer2'", "]", ")", ")", ",", "\n", "self", ".", "resizer", "(", "self", ".", "layer3", "(", "feats_resnet", "[", "'layer3'", "]", ")", ")", ",", "\n", "# self.resizer(self.layer4(feats_resnet['layer4'])),", "\n", "]", ",", "dim", "=", "1", ")", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.passup.ResnetFeatureExtractor.__init__": [[172, 229], ["nn.Module.__init__", "tv.models.resnet50", "TT.Resize", "TT.Normalize", "torch.hub.load", "TT.Resize", "TT.Normalize", "_train.danbooru_tagger.models.kate.Model.load_from_checkpoint", "TT.Resize"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__init__"], ["    ", "def", "__init__", "(", "self", ",", "inferserve_query", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "inferserve_query", "=", "inferserve_query", "\n", "if", "self", ".", "inferserve_query", "==", "'torchvision'", ":", "\n", "# use pytorch pretrained resnet50", "\n", "            ", "self", ".", "inferserve", "=", "None", "\n", "self", ".", "base_hparams", "=", "None", "\n", "resnet", "=", "tv", ".", "models", ".", "resnet50", "(", "pretrained", "=", "True", ")", "\n", "\n", "self", ".", "resize", "=", "TT", ".", "Resize", "(", "256", ")", "\n", "self", ".", "resnet_preprocess", "=", "TT", ".", "Normalize", "(", "mean", "=", "[", "0.485", ",", "0.456", ",", "0.406", "]", ",", "std", "=", "[", "0.229", ",", "0.224", ",", "0.225", "]", ")", "\n", "self", ".", "conv1", "=", "resnet", ".", "conv1", "\n", "self", ".", "bn1", "=", "resnet", ".", "bn1", "\n", "self", ".", "relu", "=", "resnet", ".", "relu", "#   64ch, 128p (assuming 256p input)", "\n", "self", ".", "maxpool", "=", "resnet", ".", "maxpool", "\n", "self", ".", "layer1", "=", "resnet", ".", "layer1", "#  256ch,  64p", "\n", "self", ".", "layer2", "=", "resnet", ".", "layer2", "#  512ch,  32p", "\n", "self", ".", "layer3", "=", "resnet", ".", "layer3", "# 1024ch,  16p", "\n", "# self.layer4 = resnet.layer4  # 2048ch,   8p", "\n", "", "elif", "self", ".", "inferserve_query", "==", "'rf5'", ":", "\n", "# use rf5 resnet50", "\n", "            ", "self", ".", "inferserve", "=", "None", "\n", "self", ".", "base_hparams", "=", "None", "\n", "resnet", "=", "torch", ".", "hub", ".", "load", "(", "'RF5/danbooru-pretrained'", ",", "'resnet50'", ")", "\n", "\n", "self", ".", "resize", "=", "TT", ".", "Resize", "(", "256", ")", "\n", "self", ".", "resnet_preprocess", "=", "TT", ".", "Normalize", "(", "mean", "=", "[", "0.7137", ",", "0.6628", ",", "0.6519", "]", ",", "std", "=", "[", "0.2970", ",", "0.3017", ",", "0.2979", "]", ")", "\n", "self", ".", "conv1", "=", "resnet", "[", "0", "]", "[", "0", "]", "\n", "self", ".", "bn1", "=", "resnet", "[", "0", "]", "[", "1", "]", "\n", "self", ".", "relu", "=", "resnet", "[", "0", "]", "[", "2", "]", "#   64ch, 128p (assuming 256p input)", "\n", "self", ".", "maxpool", "=", "resnet", "[", "0", "]", "[", "3", "]", "\n", "self", ".", "layer1", "=", "resnet", "[", "0", "]", "[", "4", "]", "#  256ch,  64p", "\n", "self", ".", "layer2", "=", "resnet", "[", "0", "]", "[", "5", "]", "#  512ch,  32p", "\n", "self", ".", "layer3", "=", "resnet", "[", "0", "]", "[", "6", "]", "# 1024ch,  16p", "\n", "# self.layer4 = resnet[0][7]  # 2048ch,   8p", "\n", "", "else", ":", "\n", "# use pretrained kate, danbooru-specific", "\n", "# self.inferserve = util_serve.infer_ckpt(self.inferserve_query)", "\n", "# base = Classifier.load_from_checkpoint(self.inferserve['fn'])", "\n", "            ", "self", ".", "inferserve", "=", "None", "\n", "base", "=", "Classifier", ".", "load_from_checkpoint", "(", "\n", "'./_train/danbooru_tagger/runs/waning_kate_vulcan0001/checkpoints/'", "\n", "'epoch=0022-val_f2=0.4461-val_loss=0.0766.ckpt'", "\n", ")", "\n", "self", ".", "base_hparams", "=", "base", ".", "hparams", "\n", "\n", "self", ".", "resize", "=", "TT", ".", "Resize", "(", "base", ".", "hparams", ".", "largs", ".", "danbooru_sfw", ".", "size", ")", "\n", "self", ".", "resnet_preprocess", "=", "base", ".", "resnet_preprocess", "\n", "self", ".", "conv1", "=", "base", ".", "resnet", ".", "conv1", "\n", "self", ".", "bn1", "=", "base", ".", "resnet", ".", "bn1", "\n", "self", ".", "relu", "=", "base", ".", "resnet", ".", "relu", "#   64ch, 128p (assuming 256p input)", "\n", "self", ".", "maxpool", "=", "base", ".", "resnet", ".", "maxpool", "\n", "self", ".", "layer1", "=", "base", ".", "resnet", ".", "layer1", "#  256ch,  64p", "\n", "self", ".", "layer2", "=", "base", ".", "resnet", ".", "layer2", "#  512ch,  32p", "\n", "self", ".", "layer3", "=", "base", ".", "resnet", ".", "layer3", "# 1024ch,  16p", "\n", "# self.layer4 = base.resnet.layer4  # 2048ch,   8p", "\n", "", "return", "\n", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.passup.ResnetFeatureExtractor.forward": [[229, 247], ["passup.ResnetFeatureExtractor.resize", "passup.ResnetFeatureExtractor.resnet_preprocess", "passup.ResnetFeatureExtractor.conv1", "passup.ResnetFeatureExtractor.bn1", "passup.ResnetFeatureExtractor.relu", "passup.ResnetFeatureExtractor.maxpool", "passup.ResnetFeatureExtractor.layer1", "passup.ResnetFeatureExtractor.layer2", "passup.ResnetFeatureExtractor.layer3"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "ans", "=", "{", "}", "\n", "x", "=", "self", ".", "resize", "(", "x", ")", "\n", "x", "=", "self", ".", "resnet_preprocess", "(", "x", ")", "\n", "x", "=", "self", ".", "conv1", "(", "x", ")", "\n", "x", "=", "self", ".", "bn1", "(", "x", ")", "\n", "x", "=", "self", ".", "relu", "(", "x", ")", "\n", "ans", "[", "'conv1'", "]", "=", "x", "\n", "x", "=", "self", ".", "maxpool", "(", "x", ")", "\n", "x", "=", "self", ".", "layer1", "(", "x", ")", "\n", "ans", "[", "'layer1'", "]", "=", "x", "\n", "x", "=", "self", ".", "layer2", "(", "x", ")", "\n", "ans", "[", "'layer2'", "]", "=", "x", "\n", "x", "=", "self", ".", "layer3", "(", "x", ")", "\n", "ans", "[", "'layer3'", "]", "=", "x", "\n", "# x = self.layer4(x)", "\n", "# ans['layer4'] = x", "\n", "return", "ans", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.passup.PretrainedKeypointDetector.__init__": [[249, 269], ["nn.Module.__init__", "detectron2.config.get_cfg", "passup.PretrainedKeypointDetector.cfg.merge_from_file", "detectron2.model_zoo.get_checkpoint_url", "detectron2.engine.DefaultPredictor", "TT.Resize", "detectron2.model_zoo.get_config_file"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__init__"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\n", "# setup rcnn model", "\n", "self", ".", "cfg", "=", "detectron2", ".", "config", ".", "get_cfg", "(", ")", "\n", "self", ".", "cfg", ".", "merge_from_file", "(", "detectron2", ".", "model_zoo", ".", "get_config_file", "(", "\n", "'COCO-Keypoints/keypoint_rcnn_R_101_FPN_3x.yaml'", "\n", ")", ")", "\n", "self", ".", "cfg", ".", "MODEL", ".", "ROI_HEADS", ".", "SCORE_THRESH_TEST", "=", "0.0", "\n", "self", ".", "cfg", ".", "MODEL", ".", "WEIGHTS", "=", "detectron2", ".", "model_zoo", ".", "get_checkpoint_url", "(", "\n", "'COCO-Keypoints/keypoint_rcnn_R_101_FPN_3x.yaml'", "\n", ")", "\n", "self", ".", "cfg", "[", "'MODEL'", "]", "[", "'DEVICE'", "]", "=", "'cpu'", "\n", "self", ".", "predictor", "=", "detectron2", ".", "engine", ".", "DefaultPredictor", "(", "self", ".", "cfg", ")", "\n", "self", ".", "model", "=", "self", ".", "predictor", ".", "model", "\n", "\n", "# preprocessing", "\n", "self", ".", "size", "=", "800", "\n", "self", ".", "resize", "=", "TT", ".", "Resize", "(", "self", ".", "size", ")", "\n", "return", "\n", "", "def", "forward", "(", "self", ",", "img", ",", "return_more", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.passup.PretrainedKeypointDetector.forward": [[269, 320], ["passup.PretrainedKeypointDetector.model.preprocess_image", "passup.PretrainedKeypointDetector.model.backbone", "passup.PretrainedKeypointDetector.model._postprocess", "torch.cat", "passup.PretrainedKeypointDetector.model.roi_heads", "passup.PretrainedKeypointDetector.model.roi_heads.forward_with_given_boxes", "torch.stack", "detectron2.structures.instances.Instances", "passup.PretrainedKeypointDetector.resize().flip", "detectron2.structures.instances.Instances", "range", "r[].pred_boxes.tensor.detach().cpu().numpy", "k[].flip", "detectron2.structures.boxes.Boxes", "torch.tensor", "passup.PretrainedKeypointDetector.resize", "detectron2.structures.boxes.Boxes", "torch.tensor", "r[].pred_boxes.tensor.detach().cpu", "torch.tensor", "torch.tensor", "r[].pred_boxes.tensor.detach"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.numpy", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor"], ["", "def", "forward", "(", "self", ",", "img", ",", "return_more", "=", "False", ")", ":", "\n", "# assumes img.shape = (bs, rgb, h, w)", "\n", "        ", "h", ",", "w", "=", "img", ".", "shape", "[", "2", ":", "]", "\n", "x", "=", "[", "{", "'image'", ":", "i", ",", "'height'", ":", "h", ",", "'width'", ":", "w", "}", "for", "i", "in", "255", "*", "self", ".", "resize", "(", "img", ")", ".", "flip", "(", "1", ")", "]", "\n", "images", "=", "self", ".", "model", ".", "preprocess_image", "(", "x", ")", "\n", "features", "=", "self", ".", "model", ".", "backbone", "(", "images", ".", "tensor", ")", "\n", "if", "False", ":", "\n", "# roi heads will fuckin re-predict bboxes", "\n", "            ", "proposals", "=", "[", "\n", "detectron2", ".", "structures", ".", "instances", ".", "Instances", "(", "\n", "image_size", "=", "images", "[", "0", "]", ".", "shape", "[", "1", ":", "]", ",", "\n", "proposal_boxes", "=", "detectron2", ".", "structures", ".", "boxes", ".", "Boxes", "(", "torch", ".", "tensor", "(", "[", "\n", "0", ",", "0", ",", "*", "images", "[", "0", "]", ".", "shape", "[", "1", ":", "]", ",", "\n", "]", ",", "device", "=", "images", ".", "device", ")", "[", "None", "]", ")", ",", "\n", "objectness_logits", "=", "torch", ".", "tensor", "(", "[", "1.0", ",", "]", ",", "device", "=", "images", ".", "device", ")", ",", "\n", ")", ",", "\n", "]", "*", "img", ".", "shape", "[", "0", "]", "\n", "results", ",", "_", "=", "self", ".", "model", ".", "roi_heads", "(", "images", ",", "features", ",", "proposals", ",", "None", ")", "\n", "", "else", ":", "\n", "# forces them to use my bboxes", "\n", "            ", "h", ",", "w", "=", "images", "[", "0", "]", ".", "shape", "[", "1", ":", "]", "\n", "detected_instances", "=", "[", "\n", "detectron2", ".", "structures", ".", "instances", ".", "Instances", "(", "\n", "image_size", "=", "(", "h", ",", "w", ")", ",", "\n", "pred_boxes", "=", "detectron2", ".", "structures", ".", "boxes", ".", "Boxes", "(", "torch", ".", "tensor", "(", "[", "\n", "0", ",", "0", ",", "h", ",", "w", ",", "\n", "]", ",", "device", "=", "images", ".", "device", ")", "[", "None", "]", ")", ",", "\n", "pred_classes", "=", "torch", ".", "tensor", "(", "[", "0", ",", "]", ",", "device", "=", "images", ".", "device", ")", ",", "\n", ")", "\n", "for", "_", "in", "range", "(", "img", ".", "shape", "[", "0", "]", ")", "\n", "]", "\n", "results", "=", "self", ".", "model", ".", "roi_heads", ".", "forward_with_given_boxes", "(", "features", ",", "detected_instances", ")", "\n", "", "results", "=", "self", ".", "model", ".", "_postprocess", "(", "results", ",", "x", ",", "images", ".", "image_sizes", ")", "\n", "hms", "=", "torch", ".", "cat", "(", "[", "r", "[", "'instances'", "]", ".", "pred_keypoint_heatmaps", "for", "r", "in", "results", "]", ")", "\n", "ans", "=", "{", "'keypoint_heatmaps'", ":", "hms", "}", "\n", "if", "return_more", ":", "\n", "            ", "ans", "[", "'results'", "]", "=", "results", "\n", "ans", "[", "'images'", "]", "=", "images", "\n", "ans", "[", "'features'", "]", "=", "features", "\n", "ans", "[", "'detected_instances'", "]", "=", "detected_instances", "\n", "ans", "[", "'bboxes'", "]", "=", "[", "\n", "(", "(", "b", ",", "a", ")", ",", "(", "d", "-", "b", ",", "c", "-", "a", ")", ")", "\n", "for", "r", "in", "results", "\n", "for", "a", ",", "b", ",", "c", ",", "d", "in", "r", "[", "'instances'", "]", ".", "pred_boxes", ".", "tensor", ".", "detach", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "]", "\n", "ans", "[", "'keypoints'", "]", "=", "torch", ".", "stack", "(", "[", "\n", "k", "[", ":", ",", ":", "2", "]", ".", "flip", "(", "1", ")", "\n", "for", "r", "in", "results", "\n", "for", "k", "in", "r", "[", "'instances'", "]", ".", "pred_keypoints", "\n", "]", ")", "\n", "", "return", "ans", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.kate.Model.__init__": [[9, 32], ["pl.LightningModule.__init__", "kate.Model.save_hyperparameters", "jread", "tv.models.resnet50", "nn.Linear", "TT.Normalize", "nn.BCEWithLogitsLoss", "len"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__init__", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.jread"], ["    ", "def", "__init__", "(", "self", ",", "bargs", ",", "pargs", ",", "largs", ",", "margs", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "hparams", ".", "bargs", "=", "bargs", "\n", "self", ".", "hparams", ".", "pargs", "=", "pargs", "\n", "self", ".", "hparams", ".", "largs", "=", "largs", "\n", "self", ".", "hparams", ".", "margs", "=", "margs", "\n", "self", ".", "save_hyperparameters", "(", ")", "\n", "\n", "# read rulebook", "\n", "# see ./hack/snips/danbooru_intently_combatively.py for preprocessing", "\n", "self", ".", "filter_subset", "=", "largs", ".", "danbooru_sfw", ".", "filter_subset", "\n", "self", ".", "filter_rules", "=", "largs", ".", "danbooru_sfw", ".", "filter_rules", "\n", "self", ".", "fn_rules", "=", "f'{bargs.dn}/_data/danbooru/_filters/{self.filter_subset}_{self.filter_rules}_rules.json'", "\n", "self", ".", "rules", "=", "jread", "(", "self", ".", "fn_rules", ")", "\n", "\n", "# setup resnet", "\n", "self", ".", "resnet", "=", "tv", ".", "models", ".", "resnet50", "(", "pretrained", "=", "True", ")", "\n", "self", ".", "resnet", ".", "fc", "=", "nn", ".", "Linear", "(", "self", ".", "resnet", ".", "fc", ".", "in_features", ",", "len", "(", "self", ".", "rules", ")", ")", "\n", "self", ".", "resnet_preprocess", "=", "TT", ".", "Normalize", "(", "mean", "=", "[", "0.485", ",", "0.456", ",", "0.406", "]", ",", "std", "=", "[", "0.229", ",", "0.224", ",", "0.225", "]", ")", "\n", "\n", "# loss", "\n", "self", ".", "bce", "=", "nn", ".", "BCEWithLogitsLoss", "(", "reduction", "=", "'none'", ")", "\n", "return", "\n", "", "def", "loss", "(", "self", ",", "gt", ",", "pred", ",", "weights", "=", "None", ",", "reduce", "=", "True", ",", "return_more", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.kate.Model.loss": [[32, 46], ["kate.Model.bce", "wbce.mean", "torch.no_grad"], "methods", ["None"], ["", "def", "loss", "(", "self", ",", "gt", ",", "pred", ",", "weights", "=", "None", ",", "reduce", "=", "True", ",", "return_more", "=", "False", ")", ":", "\n", "# expects gt is one-hot float", "\n", "# expects pred is pre-softmax values", "\n", "        ", "bce", "=", "self", ".", "bce", "(", "pred", ",", "gt", ")", "\n", "wbce", "=", "(", "1", "if", "weights", "is", "None", "else", "weights", ")", "*", "bce", "\n", "ans", "=", "{", "'loss'", ":", "wbce", ".", "mean", "(", ")", "if", "reduce", "else", "wbce", "}", "\n", "if", "return_more", ":", "\n", "            ", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "                ", "bing", ",", "binp", "=", "gt", ">", "0.5", ",", "pred", ">", "0", "\n", "ans", "[", "'tp'", "]", "=", "(", "bing", "&", "binp", ")", ".", "float", "(", ")", "\n", "ans", "[", "'fn'", "]", "=", "(", "bing", "&", "~", "binp", ")", ".", "float", "(", ")", "\n", "ans", "[", "'fp'", "]", "=", "(", "~", "bing", "&", "binp", ")", ".", "float", "(", ")", "\n", "ans", "[", "'tn'", "]", "=", "(", "~", "bing", "&", "~", "binp", ")", ".", "float", "(", ")", "\n", "", "", "return", "ans", "\n", "", "def", "forward", "(", "self", ",", "rgb", ",", "return_more", "=", "True", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.kate.Model.forward": [[46, 54], ["kate.Model.resnet_preprocess", "kate.Model.resnet", "torch.sigmoid"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "rgb", ",", "return_more", "=", "True", ")", ":", "\n", "        ", "normed", "=", "self", ".", "resnet_preprocess", "(", "rgb", ")", "\n", "out_raw", "=", "self", ".", "resnet", "(", "normed", ")", "\n", "out", "=", "{", "'raw'", ":", "out_raw", "}", "\n", "if", "return_more", ":", "\n", "            ", "out", "[", "'prob'", "]", "=", "torch", ".", "sigmoid", "(", "out_raw", ")", "\n", "out", "[", "'pred'", "]", "=", "out_raw", ">", "0", "\n", "", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.kate.Model.training_step": [[55, 69], ["kate.Model.forward", "kate.Model.loss", "kate.Model.log"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.Injector.forward", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.alaska.Model.loss"], ["", "def", "training_step", "(", "self", ",", "batch", ",", "batch_idx", ")", ":", "\n", "# unpack", "\n", "        ", "rgb", "=", "batch", "[", "'image'", "]", "\n", "lab", "=", "batch", "[", "'label'", "]", "\n", "weights", "=", "batch", "[", "'weights'", "]", "\n", "\n", "# predict", "\n", "pred", "=", "self", ".", "forward", "(", "rgb", ",", "return_more", "=", "False", ")", "\n", "loss", "=", "self", ".", "loss", "(", "lab", ",", "pred", "[", "'raw'", "]", ",", "weights", "=", "weights", ",", "reduce", "=", "True", ",", "return_more", "=", "False", ")", "\n", "\n", "# log", "\n", "self", ".", "log", "(", "'train_loss'", ",", "loss", "[", "'loss'", "]", ")", "\n", "return", "{", "\n", "'loss'", ":", "loss", "[", "'loss'", "]", ",", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.kate.Model.validation_step": [[70, 89], ["kate.Model.forward", "kate.Model.loss", "kate.Model.log", "loss[].sum", "loss[].sum", "loss[].sum", "loss[].sum", "len"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.Injector.forward", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.alaska.Model.loss"], ["", "def", "validation_step", "(", "self", ",", "batch", ",", "batch_idx", ")", ":", "\n", "# unpack", "\n", "        ", "rgb", "=", "batch", "[", "'image'", "]", "\n", "lab", "=", "batch", "[", "'label'", "]", "\n", "weights", "=", "batch", "[", "'weights'", "]", "\n", "\n", "# predict", "\n", "pred", "=", "self", ".", "forward", "(", "rgb", ",", "return_more", "=", "False", ")", "\n", "loss", "=", "self", ".", "loss", "(", "lab", ",", "pred", "[", "'raw'", "]", ",", "weights", "=", "weights", ",", "reduce", "=", "True", ",", "return_more", "=", "True", ")", "\n", "\n", "# log", "\n", "self", ".", "log", "(", "'val_loss'", ",", "loss", "[", "'loss'", "]", ")", "\n", "return", "{", "\n", "'val_loss'", ":", "loss", "[", "'loss'", "]", ",", "\n", "'_tp'", ":", "loss", "[", "'tp'", "]", ".", "sum", "(", "0", ")", ",", "\n", "'_tn'", ":", "loss", "[", "'tn'", "]", ".", "sum", "(", "0", ")", ",", "\n", "'_fp'", ":", "loss", "[", "'fp'", "]", ".", "sum", "(", "0", ")", ",", "\n", "'_fn'", ":", "loss", "[", "'fn'", "]", ".", "sum", "(", "0", ")", ",", "\n", "'_cnt'", ":", "len", "(", "rgb", ")", ",", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.kate.Model.validation_epoch_end": [[90, 130], ["ans.items", "kate.Model.log", "kate.Model.log", "kate.Model.log", "kate.Model.log", "kate.Model.log", "kate.Model.log", "len", "kate.Model.log", "acc.mean", "rec.mean", "pre.mean", "f1.mean", "f2.mean", "f5.mean", "outputs[].keys", "l.startswith"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.keys"], ["", "def", "validation_epoch_end", "(", "self", ",", "outputs", ")", ":", "\n", "        ", "labels", "=", "[", "l", "for", "l", "in", "outputs", "[", "0", "]", ".", "keys", "(", ")", "if", "l", ".", "startswith", "(", "'val_'", ")", "]", "\n", "ans", "=", "{", "l", ":", "0", "for", "l", "in", "labels", "}", "\n", "for", "output", "in", "outputs", ":", "\n", "            ", "for", "label", "in", "labels", ":", "\n", "                ", "ans", "[", "label", "]", "+=", "output", "[", "label", "]", "\n", "", "", "for", "label", "in", "labels", ":", "\n", "            ", "ans", "[", "label", "]", "/=", "len", "(", "outputs", ")", "\n", "", "for", "k", ",", "v", "in", "ans", ".", "items", "(", ")", ":", "\n", "            ", "self", ".", "log", "(", "k", ",", "v", ")", "\n", "\n", "", "cnt", "=", "tp", "=", "tn", "=", "fp", "=", "fn", "=", "0", "\n", "for", "o", "in", "outputs", ":", "\n", "            ", "cnt", "+=", "o", "[", "'_cnt'", "]", "\n", "tp", "+=", "o", "[", "'_tp'", "]", "\n", "tn", "+=", "o", "[", "'_tn'", "]", "\n", "fp", "+=", "o", "[", "'_fp'", "]", "\n", "fn", "+=", "o", "[", "'_fn'", "]", "\n", "", "tp", "/=", "cnt", "\n", "tn", "/=", "cnt", "\n", "fp", "/=", "cnt", "\n", "fn", "/=", "cnt", "\n", "# cnt = sum([o['_cnt'] for o in outputs])", "\n", "# tp = torch.stack([o['_tp'] for o in outputs]).sum(0) / cnt", "\n", "# tn = torch.stack([o['_tn'] for o in outputs]).sum(0) / cnt", "\n", "# fp = torch.stack([o['_fp'] for o in outputs]).sum(0) / cnt", "\n", "# fn = torch.stack([o['_fn'] for o in outputs]).sum(0) / cnt", "\n", "acc", "=", "tp", "+", "tn", "\n", "rec", "=", "tp", "/", "(", "tp", "+", "fn", ")", ";", "rec", "[", "rec", "!=", "rec", "]", "=", "1.0", "\n", "pre", "=", "tp", "/", "(", "tp", "+", "fp", ")", ";", "pre", "[", "pre", "!=", "pre", "]", "=", "0.0", "\n", "f1", "=", "2", "*", "tp", "/", "(", "2", "*", "tp", "+", "fn", "+", "fp", ")", ";", "f1", "[", "f1", "!=", "f1", "]", "=", "1.0", "\n", "f2", "=", "5", "*", "tp", "/", "(", "5", "*", "tp", "+", "4", "*", "fn", "+", "fp", ")", ";", "f2", "[", "f2", "!=", "f2", "]", "=", "1.0", "\n", "f5", "=", "1.5", "*", "tp", "/", "(", "1.5", "*", "tp", "+", "0.25", "*", "fn", "+", "fp", ")", ";", "f5", "[", "f5", "!=", "f5", "]", "=", "1.0", "\n", "self", ".", "log", "(", "'val_acc'", ",", "acc", ".", "mean", "(", ")", ")", "\n", "self", ".", "log", "(", "'val_rec'", ",", "rec", ".", "mean", "(", ")", ")", "\n", "self", ".", "log", "(", "'val_pre'", ",", "pre", ".", "mean", "(", ")", ")", "\n", "self", ".", "log", "(", "'val_f1'", ",", "f1", ".", "mean", "(", ")", ")", "\n", "self", ".", "log", "(", "'val_f2'", ",", "f2", ".", "mean", "(", ")", ")", "\n", "self", ".", "log", "(", "'val_f5'", ",", "f5", ".", "mean", "(", ")", ")", "\n", "return", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.kate.Model.configure_optimizers": [[132, 143], ["torch.optim.Adam", "torch.optim.lr_scheduler.CosineAnnealingLR", "kate.Model.parameters"], "methods", ["None"], ["", "def", "configure_optimizers", "(", "self", ")", ":", "\n", "        ", "opt", "=", "torch", ".", "optim", ".", "Adam", "(", "\n", "self", ".", "parameters", "(", ")", ",", "\n", "lr", "=", "self", ".", "hparams", ".", "margs", ".", "lr", ",", "\n", ")", "\n", "sched", "=", "torch", ".", "optim", ".", "lr_scheduler", ".", "CosineAnnealingLR", "(", "\n", "opt", ",", "\n", "T_max", "=", "100", ",", "\n", "eta_min", "=", "0", ",", "\n", ")", "\n", "return", "[", "opt", ",", "]", ",", "[", "sched", ",", "]", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.alaska.Model.__init__": [[9, 48], ["pl.LightningModule.__init__", "alaska.Model.save_hyperparameters", "tv.models.segmentation.deeplabv3_resnet101", "nn.Sequential", "nn.Sequential", "TT.Normalize", "nn.CrossEntropyLoss", "tv.models.segmentation.deeplabv3.ASPP", "nn.Conv2d", "nn.BatchNorm2d", "nn.LeakyReLU", "nn.Conv2d", "nn.BatchNorm2d", "nn.LeakyReLU", "nn.Conv2d", "nn.BatchNorm2d", "nn.LeakyReLU", "nn.Conv2d", "nn.BatchNorm2d", "nn.LeakyReLU", "nn.Conv2d"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__init__"], ["    ", "def", "__init__", "(", "self", ",", "bargs", ",", "pargs", ",", "largs", ",", "margs", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "hparams", ".", "bargs", "=", "bargs", "\n", "self", ".", "hparams", ".", "pargs", "=", "pargs", "\n", "self", ".", "hparams", ".", "largs", "=", "largs", "\n", "self", ".", "hparams", ".", "margs", "=", "margs", "\n", "self", ".", "save_hyperparameters", "(", ")", "\n", "\n", "# setup deeplab", "\n", "self", ".", "deeplab", "=", "tv", ".", "models", ".", "segmentation", ".", "deeplabv3_resnet101", "(", "\n", "pretrained", "=", "True", ",", "progress", "=", "True", ",", "\n", ")", "\n", "self", ".", "deeplab", ".", "aux_classifier", "=", "None", "\n", "# for param in self.deeplab.backbone.parameters():", "\n", "#     param.requires_grad = False", "\n", "self", ".", "deeplab", ".", "classifier", "=", "nn", ".", "Sequential", "(", "\n", "# tv.models.segmentation.deeplabv3.DeepLabHead(2048, 2)[0],", "\n", "tv", ".", "models", ".", "segmentation", ".", "deeplabv3", ".", "ASPP", "(", "2048", ",", "[", "12", ",", "24", ",", "36", "]", ")", ",", "\n", "nn", ".", "Conv2d", "(", "256", ",", "64", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "padding", "=", "1", ")", ",", "\n", "nn", ".", "BatchNorm2d", "(", "64", ")", ",", "\n", "nn", ".", "LeakyReLU", "(", ")", ",", "\n", "nn", ".", "Conv2d", "(", "64", ",", "16", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "padding", "=", "1", ")", ",", "\n", "nn", ".", "BatchNorm2d", "(", "16", ")", ",", "\n", "nn", ".", "LeakyReLU", "(", ")", ",", "\n", ")", "\n", "self", ".", "final_head", "=", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Conv2d", "(", "16", "+", "3", ",", "16", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "padding", "=", "1", ")", ",", "\n", "nn", ".", "BatchNorm2d", "(", "16", ")", ",", "\n", "nn", ".", "LeakyReLU", "(", ")", ",", "\n", "nn", ".", "Conv2d", "(", "16", ",", "8", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "padding", "=", "1", ")", ",", "\n", "nn", ".", "BatchNorm2d", "(", "8", ")", ",", "\n", "nn", ".", "LeakyReLU", "(", ")", ",", "\n", "nn", ".", "Conv2d", "(", "8", ",", "2", ",", "kernel_size", "=", "1", ",", "stride", "=", "1", ")", ",", "\n", ")", "\n", "self", ".", "deeplab_preprocess", "=", "TT", ".", "Normalize", "(", "mean", "=", "[", "0.485", ",", "0.456", ",", "0.406", "]", ",", "std", "=", "[", "0.229", ",", "0.224", ",", "0.225", "]", ")", "\n", "\n", "# loss", "\n", "self", ".", "cel", "=", "nn", ".", "CrossEntropyLoss", "(", "reduction", "=", "'none'", ")", "\n", "return", "\n", "", "def", "loss", "(", "self", ",", "gt", ",", "pred", ",", "reduce", "=", "True", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.alaska.Model.loss": [[48, 68], ["alaska.Model.cel().mean", "torch.no_grad", "alaska.Model.cel", "alaska.Model.mean", "f1.mean", "acc.mean", "rec.mean", "pre.mean"], "methods", ["None"], ["", "def", "loss", "(", "self", ",", "gt", ",", "pred", ",", "reduce", "=", "True", ")", ":", "\n", "# expects gt is long of class labels", "\n", "# expects pred is pre-softmax values", "\n", "        ", "cel", "=", "self", ".", "cel", "(", "pred", ",", "gt", ")", ".", "mean", "(", "(", "1", ",", "2", ")", ")", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "bing", ",", "binp", "=", "gt", ">", "0.5", ",", "pred", "[", ":", ",", "1", "]", ">", "pred", "[", ":", ",", "0", "]", "\n", "tp", "=", "(", "bing", "&", "binp", ")", ".", "float", "(", ")", ".", "mean", "(", "(", "1", ",", "2", ")", ")", "\n", "fn", "=", "(", "bing", "&", "~", "binp", ")", ".", "float", "(", ")", ".", "mean", "(", "(", "1", ",", "2", ")", ")", "\n", "fp", "=", "(", "~", "bing", "&", "binp", ")", ".", "float", "(", ")", ".", "mean", "(", "(", "1", ",", "2", ")", ")", "\n", "tn", "=", "(", "~", "bing", "&", "~", "binp", ")", ".", "float", "(", ")", ".", "mean", "(", "(", "1", ",", "2", ")", ")", "\n", "f1", "=", "2", "*", "tp", "/", "(", "2", "*", "tp", "+", "fn", "+", "fp", ")", ";", "f1", "[", "f1", "!=", "f1", "]", "=", "1.0", "\n", "acc", "=", "tp", "+", "tn", "\n", "rec", "=", "tp", "/", "(", "tp", "+", "fn", ")", ";", "rec", "[", "rec", "!=", "rec", "]", "=", "0.0", "\n", "pre", "=", "tp", "/", "(", "tp", "+", "fp", ")", ";", "pre", "[", "pre", "!=", "pre", "]", "=", "0.0", "\n", "", "return", "{", "\n", "'loss'", ":", "cel", ".", "mean", "(", ")", "if", "reduce", "else", "cel", ",", "\n", "'f1'", ":", "f1", ".", "mean", "(", ")", "if", "reduce", "else", "f1", ",", "\n", "'acc'", ":", "acc", ".", "mean", "(", ")", "if", "reduce", "else", "acc", ",", "\n", "'rec'", ":", "rec", ".", "mean", "(", ")", "if", "reduce", "else", "rec", ",", "\n", "'pre'", ":", "pre", ".", "mean", "(", ")", "if", "reduce", "else", "pre", ",", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.alaska.Model.forward": [[69, 84], ["alaska.Model.deeplab_preprocess", "alaska.Model.final_head", "alaska.Model.deeplab", "torch.cat", "torch.softmax", "torch.max"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "rgb", ",", "return_more", "=", "True", ")", ":", "\n", "# preprocess", "\n", "        ", "normed", "=", "self", ".", "deeplab_preprocess", "(", "rgb", ")", "\n", "stackin", "=", "normed", "\n", "\n", "# forward pass", "\n", "out_dl", "=", "self", ".", "deeplab", "(", "normed", ")", "[", "'out'", "]", "\n", "out_fin", "=", "self", ".", "final_head", "(", "torch", ".", "cat", "(", "[", "\n", "out_dl", ",", "stackin", ",", "\n", "]", ",", "dim", "=", "1", ")", ")", "\n", "out", "=", "{", "'raw'", ":", "out_fin", "}", "\n", "if", "return_more", ":", "\n", "            ", "out", "[", "'softmax'", "]", "=", "torch", ".", "softmax", "(", "out_fin", ",", "dim", "=", "1", ")", "\n", "out", "[", "'max'", "]", "=", "torch", ".", "max", "(", "out_fin", ",", "dim", "=", "1", ")", ".", "indices", "\n", "", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.alaska.Model.training_step": [[85, 106], ["alaska.Model.forward", "alaska.Model.loss", "alaska.Model.log"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.Injector.forward", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.alaska.Model.loss"], ["", "def", "training_step", "(", "self", ",", "batch", ",", "batch_idx", ")", ":", "\n", "# unpack", "\n", "        ", "x", "=", "batch", "\n", "rgb", "=", "x", "[", "'image_composite'", "]", "\n", "seg", "=", "(", "x", "[", "'image_fg'", "]", "[", ":", ",", "-", "1", "]", ">", "0.5", ")", ".", "long", "(", ")", "\n", "\n", "# predict", "\n", "pred", "=", "self", ".", "forward", "(", "rgb", ",", "return_more", "=", "False", ")", "\n", "loss", "=", "self", ".", "loss", "(", "seg", ",", "pred", "[", "'raw'", "]", ")", "\n", "\n", "# log", "\n", "for", "k", ",", "v", "in", "{", "\n", "'train_loss'", ":", "loss", "[", "'loss'", "]", ",", "\n", "'train_f1'", ":", "loss", "[", "'f1'", "]", ",", "\n", "'train_acc'", ":", "loss", "[", "'acc'", "]", ",", "\n", "'train_rec'", ":", "loss", "[", "'rec'", "]", ",", "\n", "'train_pre'", ":", "loss", "[", "'pre'", "]", ",", "\n", "}", ".", "items", "(", ")", ":", "\n", "            ", "self", ".", "log", "(", "k", ",", "v", ")", "\n", "", "return", "{", "\n", "'loss'", ":", "loss", "[", "'loss'", "]", ",", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.alaska.Model.validation_step": [[107, 124], ["alaska.Model.forward", "alaska.Model.loss", "OrderedDict"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.Injector.forward", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.alaska.Model.loss"], ["", "def", "validation_step", "(", "self", ",", "batch", ",", "batch_idx", ")", ":", "\n", "# unpack", "\n", "        ", "x", "=", "batch", "\n", "rgb", "=", "x", "[", "'image_composite'", "]", "\n", "seg", "=", "(", "x", "[", "'image_fg'", "]", "[", ":", ",", "-", "1", "]", ">", "0.5", ")", ".", "long", "(", ")", "\n", "\n", "# predict", "\n", "pred", "=", "self", ".", "forward", "(", "rgb", ",", "return_more", "=", "False", ")", "\n", "loss", "=", "self", ".", "loss", "(", "seg", ",", "pred", "[", "'raw'", "]", ")", "\n", "\n", "# log", "\n", "return", "OrderedDict", "(", "{", "\n", "'val_loss'", ":", "loss", "[", "'loss'", "]", ",", "\n", "'val_f1'", ":", "loss", "[", "'f1'", "]", ",", "\n", "'val_acc'", ":", "loss", "[", "'acc'", "]", ",", "\n", "'val_rec'", ":", "loss", "[", "'rec'", "]", ",", "\n", "'val_pre'", ":", "loss", "[", "'pre'", "]", ",", "\n", "}", ")", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.alaska.Model.validation_epoch_end": [[125, 136], ["ans.items", "len", "alaska.Model.log", "outputs[].keys", "l.startswith"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.keys"], ["", "def", "validation_epoch_end", "(", "self", ",", "outputs", ")", ":", "\n", "        ", "labels", "=", "[", "l", "for", "l", "in", "outputs", "[", "0", "]", ".", "keys", "(", ")", "if", "l", ".", "startswith", "(", "'val_'", ")", "]", "\n", "ans", "=", "{", "l", ":", "0", "for", "l", "in", "labels", "}", "\n", "for", "output", "in", "outputs", ":", "\n", "            ", "for", "label", "in", "labels", ":", "\n", "                ", "ans", "[", "label", "]", "+=", "output", "[", "label", "]", "\n", "", "", "for", "label", "in", "labels", ":", "\n", "            ", "ans", "[", "label", "]", "/=", "len", "(", "outputs", ")", "\n", "", "for", "k", ",", "v", "in", "ans", ".", "items", "(", ")", ":", "\n", "            ", "self", ".", "log", "(", "k", ",", "v", ")", "\n", "", "return", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator.models.alaska.Model.configure_optimizers": [[138, 149], ["torch.optim.Adam", "torch.optim.lr_scheduler.CosineAnnealingLR", "alaska.Model.parameters"], "methods", ["None"], ["", "def", "configure_optimizers", "(", "self", ")", ":", "\n", "        ", "opt", "=", "torch", ".", "optim", ".", "Adam", "(", "\n", "self", ".", "parameters", "(", ")", ",", "\n", "lr", "=", "self", ".", "hparams", ".", "margs", ".", "lr", ",", "\n", ")", "\n", "sched", "=", "torch", ".", "optim", ".", "lr_scheduler", ".", "CosineAnnealingLR", "(", "\n", "opt", ",", "\n", "T_max", "=", "100", ",", "\n", "eta_min", "=", "0", ",", "\n", ")", "\n", "return", "[", "opt", ",", "]", ",", "[", "sched", ",", "]", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._scripts.danbooru_tagger.infer": [[21, 43], ["torch.cat().to", "danbooru_tagger..eval", "torch.no_grad", "danbooru_tagger..forward", "torch.cat", "torch.sigmoid().cpu().numpy", "zip", "I().resize_square().alpha_bg().convert().tensor", "torch.sigmoid().cpu", "I().resize_square().alpha_bg().convert", "torch.sigmoid", "I().resize_square().alpha_bg", "I().resize_square", "I"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.Injector.forward", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.numpy", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.convert", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.alpha_bg", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_square"], ["def", "infer", "(", "self", ",", "images", ",", "return_more", "=", "True", ")", ":", "\n", "# images: list of images", "\n", "    ", "imgs", "=", "torch", ".", "cat", "(", "[", "\n", "I", "(", "img", ")", "\n", ".", "resize_square", "(", "self", ".", "hparams", ".", "largs", ".", "danbooru_sfw", ".", "size", ")", "\n", ".", "alpha_bg", "(", "c", "=", "'w'", ")", "\n", ".", "convert", "(", "'RGB'", ")", "\n", ".", "tensor", "(", ")", "[", "None", ",", "]", "\n", "for", "img", "in", "images", "\n", "]", ")", ".", "to", "(", "self", ".", "device", ")", "\n", "self", ".", "eval", "(", ")", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "        ", "out", "=", "self", ".", "forward", "(", "imgs", ",", "return_more", "=", "False", ")", "\n", "", "if", "return_more", ":", "\n", "        ", "out", "[", "'prob_dict'", "]", "=", "[", "\n", "{", "\n", "r", "[", "'name'", "]", ":", "p", "\n", "for", "r", ",", "p", "in", "zip", "(", "self", ".", "rules", ",", "x", ")", "\n", "}", "\n", "for", "x", "in", "torch", ".", "sigmoid", "(", "out", "[", "'raw'", "]", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "]", "\n", "", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._scripts.pose_estimator.abbox": [[27, 39], ["I().np", "len", "np.any().nonzero", "np.any().nonzero", "np.asarray", "np.asarray", "max", "min", "max", "min", "I", "len", "len", "int", "int", "int", "int", "np.any", "np.any", "np.asarray.min", "np.asarray.max", "np.asarray.min", "np.asarray.max"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.np"], ["def", "abbox", "(", "img", ",", "thresh", "=", "0.5", ",", "allow_empty", "=", "False", ")", ":", "\n", "# get bbox from alpha image, at threshold", "\n", "    ", "img", "=", "I", "(", "img", ")", ".", "np", "(", ")", "\n", "assert", "len", "(", "img", ")", "in", "[", "1", ",", "4", "]", ",", "'image must be mode L or RGBA'", "\n", "a", "=", "img", "[", "-", "1", "]", ">", "thresh", "\n", "xlim", "=", "np", ".", "any", "(", "a", ",", "axis", "=", "1", ")", ".", "nonzero", "(", ")", "[", "0", "]", "\n", "ylim", "=", "np", ".", "any", "(", "a", ",", "axis", "=", "0", ")", ".", "nonzero", "(", ")", "[", "0", "]", "\n", "if", "len", "(", "xlim", ")", "==", "0", "and", "allow_empty", ":", "xlim", "=", "np", ".", "asarray", "(", "[", "0", ",", "a", ".", "shape", "[", "0", "]", "]", ")", "\n", "if", "len", "(", "ylim", ")", "==", "0", "and", "allow_empty", ":", "ylim", "=", "np", ".", "asarray", "(", "[", "0", ",", "a", ".", "shape", "[", "1", "]", "]", ")", "\n", "axmin", ",", "axmax", "=", "max", "(", "int", "(", "xlim", ".", "min", "(", ")", "-", "1", ")", ",", "0", ")", ",", "min", "(", "int", "(", "xlim", ".", "max", "(", ")", "+", "1", ")", ",", "a", ".", "shape", "[", "0", "]", ")", "\n", "aymin", ",", "aymax", "=", "max", "(", "int", "(", "ylim", ".", "min", "(", ")", "-", "1", ")", ",", "0", ")", ",", "min", "(", "int", "(", "ylim", ".", "max", "(", ")", "+", "1", ")", ",", "a", ".", "shape", "[", "1", "]", ")", "\n", "return", "[", "(", "axmin", ",", "aymin", ")", ",", "(", "axmax", "-", "axmin", ",", "aymax", "-", "aymin", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._scripts.pose_estimator.infer_segmentation": [[40, 56], ["pose_estimator..eval", "I().resize_min().convert().alpha_bg().convert().pil", "[].to", "TF.to_pil_image().resize", "pose_estimator.abbox", "anss.append", "torch.no_grad", "pose_estimator..", "I", "I().resize_min().convert().alpha_bg().convert", "TF.to_pil_image", "TF.to_tensor", "[].float().cpu", "I().resize_min().convert().alpha_bg", "[].float", "I().resize_min().convert", "I().resize_min", "I"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.abbox", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.convert", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.alpha_bg", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.convert", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_min"], ["", "def", "infer_segmentation", "(", "self", ",", "images", ",", "bbox_thresh", "=", "0.5", ",", "return_more", "=", "True", ")", ":", "\n", "    ", "anss", "=", "[", "]", "\n", "_size", "=", "self", ".", "hparams", ".", "largs", ".", "bg_seg", ".", "size", "\n", "self", ".", "eval", "(", ")", "\n", "for", "img", "in", "images", ":", "\n", "        ", "oimg", "=", "img", "\n", "# img = a2bg(resize_min(img, _size).convert('RGBA'),1).convert('RGB')", "\n", "img", "=", "I", "(", "img", ")", ".", "resize_min", "(", "_size", ")", ".", "convert", "(", "'RGBA'", ")", ".", "alpha_bg", "(", "1", ")", ".", "convert", "(", "'RGB'", ")", ".", "pil", "(", ")", "\n", "timg", "=", "TF", ".", "to_tensor", "(", "img", ")", "[", "None", "]", ".", "to", "(", "self", ".", "device", ")", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "out", "=", "self", "(", "timg", ")", "\n", "", "ans", "=", "TF", ".", "to_pil_image", "(", "out", "[", "'softmax'", "]", "[", "0", ",", "1", "]", ".", "float", "(", ")", ".", "cpu", "(", ")", ")", ".", "resize", "(", "oimg", ".", "size", "[", ":", ":", "-", "1", "]", ")", "\n", "ans", "=", "{", "'segmentation'", ":", "I", "(", "ans", ")", "}", "\n", "ans", "[", "'bbox'", "]", "=", "abbox", "(", "ans", "[", "'segmentation'", "]", ",", "thresh", "=", "bbox_thresh", ",", "allow_empty", "=", "True", ")", "\n", "anss", ".", "append", "(", "ans", ")", "\n", "", "return", "anss", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._scripts.pose_estimator.infer_pose": [[68, 112], ["pose_estimator..eval", "pose_estimator.infer_segmentation", "zip", "_util.cropbox_sequence", "_util.cropbox_inverse", "_util.cropbox", "img.convert().alpha().convert.convert().alpha().convert", "[].to", "[].cpu().numpy", "_util.cropbox_points", "anss.append", "torch.no_grad", "pose_estimator..", "resize_square_dry", "img.convert().alpha().convert.convert().alpha", "[].cpu", "img.convert().alpha().convert.tensor", "img.convert().alpha().convert.convert"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._scripts.pose_retrieval.infer_segmentation", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_sequence", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_inverse", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.convert", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.numpy", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_points", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_square_dry", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.alpha", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.convert"], ["def", "infer_pose", "(", "self", ",", "segmenter", ",", "images", ",", "smoothing", "=", "0.1", ",", "pad_factor", "=", "1", ")", ":", "\n", "    ", "self", ".", "eval", "(", ")", "\n", "try", ":", "\n", "        ", "largs", "=", "self", ".", "hparams", ".", "largs", ".", "adds_keypoints", "\n", "", "except", ":", "\n", "        ", "largs", "=", "self", ".", "hparams", ".", "largs", ".", "danbooru_coco", "\n", "", "_s", "=", "largs", ".", "size", "\n", "_p", "=", "_s", "*", "largs", ".", "padding", "\n", "anss", "=", "[", "]", "\n", "segs", "=", "infer_segmentation", "(", "segmenter", ",", "images", ")", "\n", "for", "img", ",", "seg", "in", "zip", "(", "images", ",", "segs", ")", ":", "\n", "# segment", "\n", "        ", "oimg", "=", "img", "\n", "ans", "=", "{", "\n", "'segmentation_output'", ":", "seg", ",", "\n", "}", "\n", "bbox", "=", "seg", "[", "'bbox'", "]", "\n", "cb", "=", "u2d", ".", "cropbox_sequence", "(", "[", "\n", "# crop to bbox, resize to square, pad sides", "\n", "[", "bbox", "[", "0", "]", ",", "bbox", "[", "1", "]", ",", "bbox", "[", "1", "]", "]", ",", "\n", "resize_square_dry", "(", "bbox", "[", "1", "]", ",", "_s", ")", ",", "\n", "[", "-", "_p", "*", "pad_factor", "/", "2", ",", "_s", "+", "_p", "*", "pad_factor", ",", "_s", "]", ",", "\n", "]", ")", "\n", "icb", "=", "u2d", ".", "cropbox_inverse", "(", "oimg", ".", "size", ",", "*", "cb", ")", "\n", "img", "=", "u2d", ".", "cropbox", "(", "img", ",", "*", "cb", ")", "\n", "img", "=", "img", ".", "convert", "(", "'RGBA'", ")", ".", "alpha", "(", "0", ")", ".", "convert", "(", "'RGB'", ")", "\n", "ans", "[", "'bbox'", "]", "=", "bbox", "\n", "ans", "[", "'cropbox'", "]", "=", "cb", "\n", "ans", "[", "'cropbox_inverse'", "]", "=", "icb", "\n", "ans", "[", "'input_image'", "]", "=", "img", "\n", "\n", "# pose estim", "\n", "timg", "=", "img", ".", "tensor", "(", ")", "[", "None", "]", ".", "to", "(", "self", ".", "device", ")", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "out", "=", "self", "(", "timg", ",", "smoothing", "=", "smoothing", ",", "return_more", "=", "True", ")", "\n", "", "ans", "[", "'out'", "]", "=", "out", "\n", "\n", "# post-process keypoints", "\n", "kps", "=", "out", "[", "'keypoints'", "]", "[", "0", "]", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "kps", "=", "u2d", ".", "cropbox_points", "(", "kps", ",", "*", "icb", ")", "\n", "ans", "[", "'keypoints'", "]", "=", "kps", "\n", "\n", "anss", ".", "append", "(", "ans", ")", "\n", "", "return", "anss", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._scripts.pose_estimator._visualize": [[115, 128], ["v.dot.rect", "isinstance", "zip", "np.asarray", "v.dot.line", "v.dot.dot", "len"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rect", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.line", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.dot"], ["", "def", "_visualize", "(", "image", "=", "None", ",", "bbox", "=", "None", ",", "keypoints", "=", "None", ")", ":", "\n", "    ", "v", "=", "image", "\n", "if", "bbox", "is", "not", "None", ":", "\n", "        ", "v", "=", "v", ".", "rect", "(", "*", "bbox", ",", "c", "=", "'r'", ",", "w", "=", "2", ")", "\n", "", "if", "keypoints", "is", "not", "None", ":", "\n", "        ", "if", "isinstance", "(", "keypoints", ",", "dict", ")", ":", "\n", "            ", "keypoints", "=", "np", ".", "asarray", "(", "[", "keypoints", "[", "k", "]", "for", "k", "in", "ukey", ".", "coco_keypoints", "]", ")", "\n", "", "for", "(", "a", ",", "b", ")", ",", "c", "in", "zip", "(", "ukey", ".", "coco_parts", ",", "ukey", ".", "coco_part_colors", ")", ":", "\n", "            ", "v", "=", "v", ".", "line", "(", "keypoints", "[", "a", "]", ",", "keypoints", "[", "b", "]", ",", "w", "=", "5", ",", "c", "=", "c", ")", "\n", "", "keypoints", "=", "keypoints", "[", ":", "len", "(", "ukey", ".", "coco_keypoints", ")", "]", "\n", "for", "kp", "in", "keypoints", ":", "\n", "            ", "v", "=", "v", ".", "dot", "(", "kp", ",", "s", "=", "5", ",", "c", "=", "'r'", ")", "\n", "", "", "return", "v", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._scripts.character_segmenter.abbox": [[21, 33], ["I().np", "len", "np.any().nonzero", "np.any().nonzero", "np.asarray", "np.asarray", "max", "min", "max", "min", "I", "len", "len", "int", "int", "int", "int", "np.any", "np.any", "np.asarray.min", "np.asarray.max", "np.asarray.min", "np.asarray.max"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.np"], ["def", "abbox", "(", "img", ",", "thresh", "=", "0.5", ",", "allow_empty", "=", "False", ")", ":", "\n", "# get bbox from alpha image, at threshold", "\n", "    ", "img", "=", "I", "(", "img", ")", ".", "np", "(", ")", "\n", "assert", "len", "(", "img", ")", "in", "[", "1", ",", "4", "]", ",", "'image must be mode L or RGBA'", "\n", "a", "=", "img", "[", "-", "1", "]", ">", "thresh", "\n", "xlim", "=", "np", ".", "any", "(", "a", ",", "axis", "=", "1", ")", ".", "nonzero", "(", ")", "[", "0", "]", "\n", "ylim", "=", "np", ".", "any", "(", "a", ",", "axis", "=", "0", ")", ".", "nonzero", "(", ")", "[", "0", "]", "\n", "if", "len", "(", "xlim", ")", "==", "0", "and", "allow_empty", ":", "xlim", "=", "np", ".", "asarray", "(", "[", "0", ",", "a", ".", "shape", "[", "0", "]", "]", ")", "\n", "if", "len", "(", "ylim", ")", "==", "0", "and", "allow_empty", ":", "ylim", "=", "np", ".", "asarray", "(", "[", "0", ",", "a", ".", "shape", "[", "1", "]", "]", ")", "\n", "axmin", ",", "axmax", "=", "max", "(", "int", "(", "xlim", ".", "min", "(", ")", "-", "1", ")", ",", "0", ")", ",", "min", "(", "int", "(", "xlim", ".", "max", "(", ")", "+", "1", ")", ",", "a", ".", "shape", "[", "0", "]", ")", "\n", "aymin", ",", "aymax", "=", "max", "(", "int", "(", "ylim", ".", "min", "(", ")", "-", "1", ")", ",", "0", ")", ",", "min", "(", "int", "(", "ylim", ".", "max", "(", ")", "+", "1", ")", ",", "a", ".", "shape", "[", "1", "]", ")", "\n", "return", "[", "(", "axmin", ",", "aymin", ")", ",", "(", "axmax", "-", "axmin", ",", "aymax", "-", "aymin", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._scripts.character_segmenter.infer": [[34, 50], ["character_segmenter..eval", "I().resize_min().convert().alpha_bg().convert().pil", "[].to", "TF.to_pil_image().resize", "character_segmenter.abbox", "anss.append", "torch.no_grad", "character_segmenter..", "I", "I().resize_min().convert().alpha_bg().convert", "TF.to_pil_image", "TF.to_tensor", "[].float().cpu", "I().resize_min().convert().alpha_bg", "[].float", "I().resize_min().convert", "I().resize_min", "I"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.abbox", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.convert", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.alpha_bg", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.convert", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_min"], ["", "def", "infer", "(", "self", ",", "images", ",", "bbox_thresh", "=", "0.5", ",", "return_more", "=", "True", ")", ":", "\n", "    ", "anss", "=", "[", "]", "\n", "_size", "=", "self", ".", "hparams", ".", "largs", ".", "bg_seg", ".", "size", "\n", "self", ".", "eval", "(", ")", "\n", "for", "img", "in", "images", ":", "\n", "        ", "oimg", "=", "img", "\n", "# img = a2bg(resize_min(img, _size).convert('RGBA'),1).convert('RGB')", "\n", "img", "=", "I", "(", "img", ")", ".", "resize_min", "(", "_size", ")", ".", "convert", "(", "'RGBA'", ")", ".", "alpha_bg", "(", "1", ")", ".", "convert", "(", "'RGB'", ")", ".", "pil", "(", ")", "\n", "timg", "=", "TF", ".", "to_tensor", "(", "img", ")", "[", "None", "]", ".", "to", "(", "self", ".", "device", ")", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "out", "=", "self", "(", "timg", ")", "\n", "", "ans", "=", "TF", ".", "to_pil_image", "(", "out", "[", "'softmax'", "]", "[", "0", ",", "1", "]", ".", "float", "(", ")", ".", "cpu", "(", ")", ")", ".", "resize", "(", "oimg", ".", "size", "[", ":", ":", "-", "1", "]", ")", "\n", "ans", "=", "{", "'segmentation'", ":", "I", "(", "ans", ")", "}", "\n", "ans", "[", "'bbox'", "]", "=", "abbox", "(", "ans", "[", "'segmentation'", "]", ",", "thresh", "=", "bbox_thresh", ",", "allow_empty", "=", "True", ")", "\n", "anss", ".", "append", "(", "ans", ")", "\n", "", "return", "anss", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._scripts.pose_retrieval.abbox": [[26, 38], ["I().np", "len", "np.any().nonzero", "np.any().nonzero", "np.asarray", "np.asarray", "max", "min", "max", "min", "I", "len", "len", "int", "int", "int", "int", "np.any", "np.any", "np.asarray.min", "np.asarray.max", "np.asarray.min", "np.asarray.max"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.np"], ["def", "abbox", "(", "img", ",", "thresh", "=", "0.5", ",", "allow_empty", "=", "False", ")", ":", "\n", "# get bbox from alpha image, at threshold", "\n", "    ", "img", "=", "I", "(", "img", ")", ".", "np", "(", ")", "\n", "assert", "len", "(", "img", ")", "in", "[", "1", ",", "4", "]", ",", "'image must be mode L or RGBA'", "\n", "a", "=", "img", "[", "-", "1", "]", ">", "thresh", "\n", "xlim", "=", "np", ".", "any", "(", "a", ",", "axis", "=", "1", ")", ".", "nonzero", "(", ")", "[", "0", "]", "\n", "ylim", "=", "np", ".", "any", "(", "a", ",", "axis", "=", "0", ")", ".", "nonzero", "(", ")", "[", "0", "]", "\n", "if", "len", "(", "xlim", ")", "==", "0", "and", "allow_empty", ":", "xlim", "=", "np", ".", "asarray", "(", "[", "0", ",", "a", ".", "shape", "[", "0", "]", "]", ")", "\n", "if", "len", "(", "ylim", ")", "==", "0", "and", "allow_empty", ":", "ylim", "=", "np", ".", "asarray", "(", "[", "0", ",", "a", ".", "shape", "[", "1", "]", "]", ")", "\n", "axmin", ",", "axmax", "=", "max", "(", "int", "(", "xlim", ".", "min", "(", ")", "-", "1", ")", ",", "0", ")", ",", "min", "(", "int", "(", "xlim", ".", "max", "(", ")", "+", "1", ")", ",", "a", ".", "shape", "[", "0", "]", ")", "\n", "aymin", ",", "aymax", "=", "max", "(", "int", "(", "ylim", ".", "min", "(", ")", "-", "1", ")", ",", "0", ")", ",", "min", "(", "int", "(", "ylim", ".", "max", "(", ")", "+", "1", ")", ",", "a", ".", "shape", "[", "1", "]", ")", "\n", "return", "[", "(", "axmin", ",", "aymin", ")", ",", "(", "axmax", "-", "axmin", ",", "aymax", "-", "aymin", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._scripts.pose_retrieval.infer_segmentation": [[39, 55], ["pose_retrieval..eval", "I().resize_min().convert().alpha_bg().convert().pil", "[].to", "TF.to_pil_image().resize", "pose_retrieval.abbox", "anss.append", "torch.no_grad", "pose_retrieval..", "I", "I().resize_min().convert().alpha_bg().convert", "TF.to_pil_image", "TF.to_tensor", "[].float().cpu", "I().resize_min().convert().alpha_bg", "[].float", "I().resize_min().convert", "I().resize_min", "I"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.abbox", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.convert", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.alpha_bg", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.convert", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_min"], ["", "def", "infer_segmentation", "(", "self", ",", "images", ",", "bbox_thresh", "=", "0.5", ",", "return_more", "=", "True", ")", ":", "\n", "    ", "anss", "=", "[", "]", "\n", "_size", "=", "self", ".", "hparams", ".", "largs", ".", "bg_seg", ".", "size", "\n", "self", ".", "eval", "(", ")", "\n", "for", "img", "in", "images", ":", "\n", "        ", "oimg", "=", "img", "\n", "# img = a2bg(resize_min(img, _size).convert('RGBA'),1).convert('RGB')", "\n", "img", "=", "I", "(", "img", ")", ".", "resize_min", "(", "_size", ")", ".", "convert", "(", "'RGBA'", ")", ".", "alpha_bg", "(", "1", ")", ".", "convert", "(", "'RGB'", ")", ".", "pil", "(", ")", "\n", "timg", "=", "TF", ".", "to_tensor", "(", "img", ")", "[", "None", "]", ".", "to", "(", "self", ".", "device", ")", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "out", "=", "self", "(", "timg", ")", "\n", "", "ans", "=", "TF", ".", "to_pil_image", "(", "out", "[", "'softmax'", "]", "[", "0", ",", "1", "]", ".", "float", "(", ")", ".", "cpu", "(", ")", ")", ".", "resize", "(", "oimg", ".", "size", "[", ":", ":", "-", "1", "]", ")", "\n", "ans", "=", "{", "'segmentation'", ":", "I", "(", "ans", ")", "}", "\n", "ans", "[", "'bbox'", "]", "=", "abbox", "(", "ans", "[", "'segmentation'", "]", ",", "thresh", "=", "bbox_thresh", ",", "allow_empty", "=", "True", ")", "\n", "anss", ".", "append", "(", "ans", ")", "\n", "", "return", "anss", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._scripts.pose_retrieval.infer_pose": [[68, 112], ["pose_retrieval..eval", "pose_retrieval.infer_segmentation", "zip", "_util.cropbox_sequence", "_util.cropbox_inverse", "_util.cropbox", "img.convert().alpha().convert.convert().alpha().convert", "[].to", "[].cpu().numpy", "_util.cropbox_points", "anss.append", "torch.no_grad", "pose_retrieval..", "resize_square_dry", "img.convert().alpha().convert.convert().alpha", "[].cpu", "img.convert().alpha().convert.tensor", "img.convert().alpha().convert.convert"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._scripts.pose_retrieval.infer_segmentation", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_sequence", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_inverse", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.convert", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.numpy", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_points", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_square_dry", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.alpha", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.convert"], ["def", "infer_pose", "(", "self", ",", "segmenter", ",", "images", ",", "smoothing", "=", "0.1", ",", "pad_factor", "=", "1", ")", ":", "\n", "    ", "self", ".", "eval", "(", ")", "\n", "try", ":", "\n", "        ", "largs", "=", "self", ".", "hparams", ".", "largs", ".", "adds_keypoints", "\n", "", "except", ":", "\n", "        ", "largs", "=", "self", ".", "hparams", ".", "largs", ".", "danbooru_coco", "\n", "", "_s", "=", "largs", ".", "size", "\n", "_p", "=", "_s", "*", "largs", ".", "padding", "\n", "anss", "=", "[", "]", "\n", "segs", "=", "infer_segmentation", "(", "segmenter", ",", "images", ")", "\n", "for", "img", ",", "seg", "in", "zip", "(", "images", ",", "segs", ")", ":", "\n", "# segment", "\n", "        ", "oimg", "=", "img", "\n", "ans", "=", "{", "\n", "'segmentation_output'", ":", "seg", ",", "\n", "}", "\n", "bbox", "=", "seg", "[", "'bbox'", "]", "\n", "cb", "=", "u2d", ".", "cropbox_sequence", "(", "[", "\n", "# crop to bbox, resize to square, pad sides", "\n", "[", "bbox", "[", "0", "]", ",", "bbox", "[", "1", "]", ",", "bbox", "[", "1", "]", "]", ",", "\n", "resize_square_dry", "(", "bbox", "[", "1", "]", ",", "_s", ")", ",", "\n", "[", "-", "_p", "*", "pad_factor", "/", "2", ",", "_s", "+", "_p", "*", "pad_factor", ",", "_s", "]", ",", "\n", "]", ")", "\n", "icb", "=", "u2d", ".", "cropbox_inverse", "(", "oimg", ".", "size", ",", "*", "cb", ")", "\n", "img", "=", "u2d", ".", "cropbox", "(", "img", ",", "*", "cb", ")", "\n", "img", "=", "img", ".", "convert", "(", "'RGBA'", ")", ".", "alpha", "(", "0", ")", ".", "convert", "(", "'RGB'", ")", "\n", "ans", "[", "'bbox'", "]", "=", "bbox", "\n", "ans", "[", "'cropbox'", "]", "=", "cb", "\n", "ans", "[", "'cropbox_inverse'", "]", "=", "icb", "\n", "ans", "[", "'input_image'", "]", "=", "img", "\n", "\n", "# pose estim", "\n", "timg", "=", "img", ".", "tensor", "(", ")", "[", "None", "]", ".", "to", "(", "self", ".", "device", ")", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "out", "=", "self", "(", "timg", ",", "smoothing", "=", "smoothing", ",", "return_more", "=", "True", ")", "\n", "", "ans", "[", "'out'", "]", "=", "out", "\n", "\n", "# post-process keypoints", "\n", "kps", "=", "out", "[", "'keypoints'", "]", "[", "0", "]", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "kps", "=", "u2d", ".", "cropbox_points", "(", "kps", ",", "*", "icb", ")", "\n", "ans", "[", "'keypoints'", "]", "=", "kps", "\n", "\n", "anss", ".", "append", "(", "ans", ")", "\n", "", "return", "anss", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._scripts.pose_retrieval._": [[117, 123], ["read_bns", "pload", "sorted", "list", "set", "set", "int"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.read_bns", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.pload"], ["", "def", "_", "(", ")", ":", "\n", "# intersect w/ full-body", "\n", "    ", "bns", "=", "read_bns", "(", "'./_data/danbooru/_filters/intently.csv'", ")", "\n", "bns_fb", "=", "pload", "(", "'./_data/danbooru/preprocessed/pose_descriptors/full_body.pkl'", ")", "\n", "bns", "=", "sorted", "(", "list", "(", "set", "(", "[", "int", "(", "i", ")", "for", "i", "in", "bns", "]", ")", "&", "set", "(", "bns_fb", ")", ")", ")", "\n", "return", "bns", "\n", "", "bns", "=", "_", "(", ")", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._scripts.pose_retrieval.retrieve_nearest": [[127, 133], ["scipy.spatial.distance.pdist", "neighbors.kneighbors", "_util.cropbox_points"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_points"], ["def", "retrieve_nearest", "(", "neighbors", ",", "keypoints", ",", "cropbox", ")", ":", "\n", "    ", "d", "=", "scipy", ".", "spatial", ".", "distance", ".", "pdist", "(", "\n", "u2d", ".", "cropbox_points", "(", "keypoints", ",", "*", "cropbox", ")", "\n", ")", "\n", "dist", ",", "idx", "=", "neighbors", ".", "kneighbors", "(", "d", "[", "None", "]", ")", "\n", "return", "dist", ",", "idx", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table.__init__": [[229, 241], ["util_v1.Table.parse"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table.parse"], ["    ", "def", "__init__", "(", "self", ",", "\n", "table", ",", "\n", "delimiter", "=", "' '", ",", "\n", "orientation", "=", "'br'", ",", "\n", "double_colon", "=", "True", ",", "\n", ")", ":", "\n", "        ", "self", ".", "delimiter", "=", "delimiter", "\n", "self", ".", "orientation", "=", "orientation", "\n", "self", ".", "t", "=", "Table", ".", "parse", "(", "\n", "table", ",", "delimiter", ",", "orientation", ",", "double_colon", ",", "\n", ")", "\n", "return", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table.__str__": [[243, 245], ["util_v1.Table.render"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table.render"], ["", "def", "__str__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "render", "(", ")", "\n", "", "def", "__repr__", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table.__repr__": [[245, 247], ["util_v1.Table.render"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table.render"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "render", "(", ")", "\n", "", "def", "render", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table.render": [[247, 364], ["copy.deepcopy", "len", "range", "enumerate", "enumerate", "enumerate", "util_v1.Table._spec", "len", "min", "max", "range", "enumerate", "enumerate", "enumerate", "util_v1.Table._put", "max", "enumerate", "eval", "eval.count", "max", "max", "eval.split", "min", "max", "len", "util_v1.Table._put", "str", "util_v1.Table._put", "util_v1.Table._put", "util_v1.Table._put", "util_v1.Table._put", "l.rjust", "l.ljust", "eval.split", "len", "len", "len", "len", "_repl", "_repl", "_repl", "_repl", "eval.split"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._spec", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._put", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._put", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._put", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._put", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._put", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._put"], ["", "def", "render", "(", "self", ")", ":", "\n", "# set up empty entry", "\n", "        ", "empty", "=", "(", "''", ",", "Table", ".", "_spec", "(", "self", ".", "orientation", ",", "transpose", "=", "False", ")", ")", "\n", "\n", "# calculate table size", "\n", "t", "=", "copy", ".", "deepcopy", "(", "self", ".", "t", ")", "\n", "totalrows", "=", "len", "(", "t", ")", "\n", "totalcols", "=", "[", "len", "(", "r", ")", "for", "r", "in", "t", "]", "\n", "assert", "min", "(", "totalcols", ")", "==", "max", "(", "totalcols", ")", "\n", "totalcols", "=", "totalcols", "[", "0", "]", "\n", "\n", "# string-ify", "\n", "for", "i", "in", "range", "(", "totalrows", ")", ":", "\n", "            ", "for", "j", "in", "range", "(", "totalcols", ")", ":", "\n", "                ", "x", ",", "s", "=", "t", "[", "i", "]", "[", "j", "]", "\n", "sp", "=", "s", "[", "11", "]", "\n", "if", "sp", ":", "x", "=", "eval", "(", "f'f\"{{{x}{sp}}}\"'", ")", "\n", "Table", ".", "_put", "(", "(", "str", "(", "x", ")", ",", "s", ")", ",", "t", ",", "(", "i", ",", "j", ")", ",", "empty", ")", "\n", "\n", "# expand delimiters", "\n", "", "", "_repl", "=", "lambda", "s", ":", "s", "[", ":", "2", "]", "+", "(", "1", ",", "0", ",", "0", ",", "0", ",", "0", ")", "+", "s", "[", "7", ":", "10", "]", "+", "(", "1", ",", ")", "+", "s", "[", "11", ":", "]", "if", "s", "[", "2", "]", "else", "s", "[", ":", "2", "]", "+", "(", "0", ",", "0", ",", "0", ",", "0", ",", "0", ")", "+", "s", "[", "7", ":", "10", "]", "+", "(", "1", ",", ")", "+", "s", "[", "11", ":", "]", "\n", "for", "i", ",", "row", "in", "enumerate", "(", "t", ")", ":", "\n", "            ", "for", "j", ",", "(", "x", ",", "s_own", ")", "in", "enumerate", "(", "row", ")", ":", "\n", "# expand delim_up(^)", "\n", "                ", "if", "s_own", "[", "3", "]", ":", "\n", "                    ", "u", ",", "v", "=", "i", ",", "j", "\n", "while", "0", "<=", "u", ":", "\n", "                        ", "_", ",", "s", "=", "t", "[", "u", "]", "[", "v", "]", "\n", "if", "(", "i", ",", "j", ")", "!=", "(", "u", ",", "v", ")", "and", "(", "s", "[", "2", "]", "and", "not", "s", "[", "10", "]", ")", ":", "break", "\n", "Table", ".", "_put", "(", "(", "x", ",", "_repl", "(", "s", ")", ")", ",", "t", ",", "(", "u", ",", "v", ")", ",", "empty", ")", "\n", "u", "-=", "1", "\n", "\n", "# expand delim_down(v)", "\n", "", "", "if", "s_own", "[", "4", "]", ":", "\n", "                    ", "u", ",", "v", "=", "i", ",", "j", "\n", "while", "u", "<", "totalrows", ":", "\n", "                        ", "_", ",", "s", "=", "t", "[", "u", "]", "[", "v", "]", "\n", "if", "(", "i", ",", "j", ")", "!=", "(", "u", ",", "v", ")", "and", "(", "s", "[", "2", "]", "and", "not", "s", "[", "10", "]", ")", ":", "break", "\n", "Table", ".", "_put", "(", "(", "x", ",", "_repl", "(", "s", ")", ")", ",", "t", ",", "(", "u", ",", "v", ")", ",", "empty", ")", "\n", "u", "+=", "1", "\n", "\n", "# expand delim_right(>)", "\n", "", "", "if", "s_own", "[", "5", "]", ":", "\n", "                    ", "u", ",", "v", "=", "i", ",", "j", "\n", "while", "v", "<", "totalcols", ":", "\n", "                        ", "_", ",", "s", "=", "t", "[", "u", "]", "[", "v", "]", "\n", "if", "(", "i", ",", "j", ")", "!=", "(", "u", ",", "v", ")", "and", "(", "s", "[", "2", "]", "and", "not", "s", "[", "10", "]", ")", ":", "break", "\n", "Table", ".", "_put", "(", "(", "x", ",", "_repl", "(", "s", ")", ")", ",", "t", ",", "(", "u", ",", "v", ")", ",", "empty", ")", "\n", "v", "+=", "1", "\n", "\n", "# expand delim_left(<)", "\n", "", "", "if", "s_own", "[", "6", "]", ":", "\n", "                    ", "u", ",", "v", "=", "i", ",", "j", "\n", "while", "0", "<=", "v", ":", "\n", "                        ", "_", ",", "s", "=", "t", "[", "u", "]", "[", "v", "]", "\n", "if", "(", "i", ",", "j", ")", "!=", "(", "u", ",", "v", ")", "and", "(", "s", "[", "2", "]", "and", "not", "s", "[", "10", "]", ")", ":", "break", "\n", "Table", ".", "_put", "(", "(", "x", ",", "_repl", "(", "s", ")", ")", ",", "t", ",", "(", "u", ",", "v", ")", ",", "empty", ")", "\n", "v", "-=", "1", "\n", "\n", "# justification calculation", "\n", "", "", "", "", "widths", "=", "[", "0", ",", "]", "*", "totalcols", "# j", "\n", "heights", "=", "[", "0", ",", "]", "*", "totalrows", "# i", "\n", "for", "i", ",", "row", "in", "enumerate", "(", "t", ")", ":", "\n", "            ", "for", "j", ",", "(", "x", ",", "s", ")", "in", "enumerate", "(", "row", ")", ":", "\n", "# height caclulation", "\n", "                ", "heights", "[", "i", "]", "=", "max", "(", "heights", "[", "i", "]", ",", "x", ".", "count", "(", "'\\n'", ")", ")", "\n", "\n", "# width calculation; non-delim fillers no contribution", "\n", "if", "s", "[", "2", "]", "or", "not", "s", "[", "10", "]", ":", "\n", "                    ", "w", "=", "max", "(", "len", "(", "q", ")", "for", "q", "in", "x", ".", "split", "(", "'\\n'", ")", ")", "\n", "widths", "[", "j", "]", "=", "max", "(", "widths", "[", "j", "]", ",", "w", ")", "\n", "# no newline ==> height=1", "\n", "", "", "", "heights", "=", "[", "h", "+", "1", "for", "h", "in", "heights", "]", "\n", "\n", "# render table", "\n", "rend", "=", "[", "]", "\n", "roff", "=", "0", "\n", "for", "i", ",", "row", "in", "enumerate", "(", "t", ")", ":", "\n", "            ", "for", "j", ",", "(", "x", ",", "s", ")", "in", "enumerate", "(", "row", ")", ":", "\n", "                ", "w", ",", "h", "=", "widths", "[", "j", "]", ",", "heights", "[", "i", "]", "\n", "\n", "# expand fillers and delimiters", "\n", "if", "s", "[", "2", "]", "or", "s", "[", "10", "]", ":", "\n", "                    ", "xs", "=", "x", ".", "split", "(", "'\\n'", ")", "\n", "xw0", "=", "min", "(", "len", "(", "l", ")", "for", "l", "in", "xs", ")", "\n", "xw1", "=", "max", "(", "len", "(", "l", ")", "for", "l", "in", "xs", ")", "\n", "xh", "=", "len", "(", "xs", ")", "\n", "if", "(", "xw0", "==", "xw1", "==", "w", ")", "and", "(", "xh", "==", "h", ")", ":", "\n", "                        ", "pass", "\n", "", "elif", "xw0", "==", "xw1", "==", "w", ":", "\n", "                        ", "x", "=", "'\\n'", ".", "join", "(", "[", "xs", "[", "0", "]", ",", "]", "*", "h", ")", "\n", "", "elif", "xh", "==", "h", ":", "\n", "                        ", "x", "=", "'\\n'", ".", "join", "(", "[", "(", "l", "[", "0", "]", "if", "l", "else", "''", ")", "*", "w", "for", "l", "in", "xs", "]", ")", "\n", "", "else", ":", "\n", "                        ", "x", "=", "x", "[", "0", "]", "if", "x", "else", "' '", "\n", "x", "=", "'\\n'", ".", "join", "(", "[", "x", "*", "w", ",", "]", "*", "h", ")", "\n", "\n", "# justify horizontally", "\n", "", "", "x", "=", "[", "\n", "l", ".", "rjust", "(", "w", ")", "if", "s", "[", "0", "]", "else", "l", ".", "ljust", "(", "w", ")", "\n", "for", "l", "in", "x", ".", "split", "(", "'\\n'", ")", "\n", "]", "\n", "\n", "# justify vertically", "\n", "plus", "=", "[", "' '", "*", "w", ",", "]", "*", "(", "h", "-", "len", "(", "x", ")", ")", "\n", "x", "=", "plus", "+", "x", "if", "not", "s", "[", "1", "]", "else", "x", "+", "plus", "\n", "\n", "# input to table", "\n", "for", "r", ",", "xline", "in", "enumerate", "(", "x", ")", ":", "\n", "                    ", "Table", ".", "_put", "(", "xline", ",", "rend", ",", "(", "roff", "+", "r", ",", "j", ")", ",", "None", ")", "\n", "", "", "roff", "+=", "h", "\n", "\n", "# return rendered string", "\n", "", "return", "'\\n'", ".", "join", "(", "[", "''", ".", "join", "(", "r", ")", "for", "r", "in", "rend", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._spec": [[366, 387], ["s.lower.lower.index", "s.lower.lower.lower", "int", "int", "int", "int", "int", "int", "int", "int", "int", "int", "int", "any"], "methods", ["None"], ["", "def", "_spec", "(", "s", ",", "transpose", "=", "False", ")", ":", "\n", "        ", "if", "':'", "in", "s", ":", "\n", "            ", "i", "=", "s", ".", "index", "(", "':'", ")", "\n", "sp", "=", "s", "[", "i", ":", "]", "\n", "s", "=", "s", "[", ":", "i", "]", "\n", "", "else", ":", "\n", "            ", "sp", "=", "''", "\n", "s", "=", "s", ".", "lower", "(", ")", "\n", "", "return", "(", "\n", "int", "(", "'r'", "in", "s", ")", ",", "#  0:: 0:left(l)   1:right(r)", "\n", "int", "(", "'t'", "in", "s", ")", ",", "#  1:: 0:bottom(b) 1:top(t)", "\n", "int", "(", "any", "(", "[", "i", "in", "s", "for", "i", "in", "[", "'.'", ",", "'<'", ",", "'>'", ",", "'^'", ",", "'v'", "]", "]", ")", ")", ",", "#  2:: delim_here(.)", "\n", "int", "(", "'^'", "in", "s", "if", "not", "transpose", "else", "'<'", "in", "s", ")", ",", "#  3:: delim_up(^)", "\n", "int", "(", "'v'", "in", "s", "if", "not", "transpose", "else", "'>'", "in", "s", ")", ",", "#  4:: delim_down(v)", "\n", "int", "(", "'>'", "in", "s", "if", "not", "transpose", "else", "'v'", "in", "s", ")", ",", "#  5:: delim_right(>)", "\n", "int", "(", "'<'", "in", "s", "if", "not", "transpose", "else", "'^'", "in", "s", ")", ",", "#  6:: delim_left(<)", "\n", "int", "(", "'+'", "in", "s", ")", ",", "#  7:: subtable(+)", "\n", "int", "(", "'-'", "in", "s", "if", "not", "transpose", "else", "'|'", "in", "s", ")", ",", "#  8:: subtable_horiz(-)", "\n", "int", "(", "'|'", "in", "s", "if", "not", "transpose", "else", "'-'", "in", "s", ")", ",", "#  9:: subtable_vert(|)", "\n", "int", "(", "'_'", "in", "s", ")", ",", "# 10:: fill(_); if delim, overwrite; else fit", "\n", "sp", ",", "# 11:: special(:) f-string for numbers", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._put": [[388, 396], ["len", "t.append", "len", "t[].append"], "methods", ["None"], ["", "def", "_put", "(", "obj", ",", "t", ",", "ij", ",", "empty", ")", ":", "\n", "        ", "i", ",", "j", "=", "ij", "\n", "while", "i", ">=", "len", "(", "t", ")", ":", "\n", "            ", "t", ".", "append", "(", "[", "]", ")", "\n", "", "while", "j", ">=", "len", "(", "t", "[", "i", "]", ")", ":", "\n", "            ", "t", "[", "i", "]", ".", "append", "(", "empty", ")", "\n", "", "t", "[", "i", "]", "[", "j", "]", "=", "obj", "\n", "return", "\n", "", "def", "parse", "(", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table.parse": [[396, 515], ["enumerate", "len", "enumerate", "enumerate", "util_v1.Table._spec", "enumerate", "max", "enumerate", "util_v1.Table._spec", "range", "row.append", "enumerate", "list", "tuple", "util_v1.Table._put", "len", "len", "range", "enumerate", "enumerate", "enumerate", "enumerate", "len", "max", "max", "max", "util_v1.Table._put", "enumerate", "util_v1.Table._put", "util_v1.Table._put", "type", "len", "type", "util_v1.Table._spec", "item.split", "len", "max", "len", "util_v1.Table._put", "util_v1.Table._put", "type", "util_v1.Table._spec", "util_v1.Table._spec", "len", "len", "max", "util_v1.Table._put", "util_v1.Table._put"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._spec", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._spec", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._put", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._put", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._put", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._put", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._spec", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._put", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._put", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._spec", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._spec", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._put", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.Table._put"], ["", "def", "parse", "(", "\n", "table", ",", "\n", "delimiter", "=", "' '", ",", "\n", "orientation", "=", "'br'", ",", "\n", "double_colon", "=", "True", ",", "\n", ")", ":", "\n", "# disabling transpose", "\n", "        ", "transpose", "=", "False", "\n", "\n", "# set up empty entry", "\n", "empty", "=", "(", "''", ",", "Table", ".", "_spec", "(", "orientation", ",", "transpose", ")", ")", "\n", "\n", "# transpose", "\n", "t", "=", "[", "]", "\n", "for", "i", ",", "row", "in", "enumerate", "(", "table", ")", ":", "\n", "            ", "for", "j", ",", "item", "in", "enumerate", "(", "row", ")", ":", "\n", "                ", "ij", "=", "(", "i", ",", "j", ")", "if", "not", "transpose", "else", "(", "j", ",", "i", ")", "\n", "if", "type", "(", "item", ")", "==", "tuple", "and", "len", "(", "item", ")", "==", "2", "and", "type", "(", "item", "[", "1", "]", ")", "==", "str", ":", "\n", "                    ", "item", "=", "(", "item", "[", "0", "]", ",", "Table", ".", "_spec", "(", "item", "[", "1", "]", ",", "transpose", ")", ")", "\n", "", "elif", "double_colon", "and", "type", "(", "item", ")", "==", "str", "and", "'::'", "in", "item", ":", "\n", "                    ", "x", ",", "s", "=", "item", ".", "split", "(", "'::'", ")", "\n", "item", "=", "(", "x", ",", "Table", ".", "_spec", "(", "s", ",", "transpose", ")", ")", "\n", "", "else", ":", "\n", "                    ", "item", "=", "(", "item", ",", "Table", ".", "_spec", "(", "orientation", ",", "transpose", ")", ")", "\n", "", "Table", ".", "_put", "(", "item", ",", "t", ",", "ij", ",", "empty", ")", "\n", "\n", "# normalization", "\n", "", "", "maxcol", "=", "0", "\n", "maxrow", "=", "len", "(", "t", ")", "\n", "for", "i", ",", "row", "in", "enumerate", "(", "t", ")", ":", "\n", "# take element number into account", "\n", "            ", "maxcol", "=", "max", "(", "maxcol", ",", "len", "(", "[", "i", "for", "i", "in", "row", "if", "not", "i", "[", "1", "]", "[", "2", "]", "]", ")", ")", "\n", "\n", "# take subtables into account", "\n", "for", "j", ",", "(", "x", ",", "s", ")", "in", "enumerate", "(", "row", ")", ":", "\n", "                ", "if", "s", "[", "7", "]", ":", "\n", "                    ", "r", "=", "len", "(", "x", ")", "\n", "maxrow", "=", "max", "(", "maxrow", ",", "i", "+", "r", ")", "\n", "c", "=", "max", "(", "len", "(", "q", ")", "for", "q", "in", "x", ")", "\n", "maxcol", "=", "max", "(", "maxcol", ",", "j", "+", "c", ")", "\n", "", "elif", "s", "[", "8", "]", ":", "\n", "                    ", "c", "=", "len", "(", "x", ")", "\n", "maxcol", "=", "max", "(", "maxcol", ",", "j", "+", "c", ")", "\n", "", "elif", "s", "[", "9", "]", ":", "\n", "                    ", "r", "=", "len", "(", "x", ")", "\n", "maxrow", "=", "max", "(", "maxrow", ",", "i", "+", "r", ")", "\n", "", "", "", "totalcols", "=", "2", "*", "maxcol", "+", "1", "\n", "totalrows", "=", "maxrow", "\n", "t", "+=", "[", "[", "]", "]", "*", "(", "totalrows", "-", "len", "(", "t", ")", ")", "\n", "newt", "=", "[", "]", "\n", "delim", "=", "(", "delimiter", ",", "Table", ".", "_spec", "(", "'._'", "+", "orientation", ",", "transpose", ")", ")", "\n", "for", "i", ",", "row", "in", "enumerate", "(", "t", ")", ":", "\n", "            ", "wasd", "=", "False", "\n", "tcount", "=", "0", "\n", "for", "j", "in", "range", "(", "totalcols", ")", ":", "\n", "                ", "item", "=", "t", "[", "i", "]", "[", "tcount", "]", "if", "tcount", "<", "len", "(", "t", "[", "i", "]", ")", "else", "empty", "\n", "isd", "=", "item", "[", "1", "]", "[", "2", "]", "\n", "if", "wasd", "and", "isd", ":", "\n", "                    ", "Table", ".", "_put", "(", "empty", ",", "newt", ",", "(", "i", ",", "j", ")", ",", "empty", ")", "\n", "wasd", "=", "False", "\n", "", "elif", "wasd", "and", "not", "isd", ":", "\n", "                    ", "Table", ".", "_put", "(", "item", ",", "newt", ",", "(", "i", ",", "j", ")", ",", "empty", ")", "\n", "tcount", "+=", "1", "\n", "wasd", "=", "False", "\n", "", "elif", "not", "wasd", "and", "isd", ":", "\n", "                    ", "Table", ".", "_put", "(", "item", ",", "newt", ",", "(", "i", ",", "j", ")", ",", "empty", ")", "\n", "tcount", "+=", "1", "\n", "wasd", "=", "True", "\n", "", "elif", "not", "wasd", "and", "not", "isd", ":", "\n", "                    ", "Table", ".", "_put", "(", "delim", ",", "newt", ",", "(", "i", ",", "j", ")", ",", "empty", ")", "\n", "wasd", "=", "True", "\n", "", "", "", "t", "=", "newt", "\n", "\n", "# normalization: add dummy last column for delimiter", "\n", "for", "row", "in", "t", ":", "\n", "            ", "row", ".", "append", "(", "empty", ")", "\n", "\n", "# expand subtables", "\n", "", "delim_cols", "=", "[", "i", "for", "i", "in", "range", "(", "totalcols", ")", "if", "i", "%", "2", "==", "0", "]", "\n", "while", "True", ":", "\n", "# find a table", "\n", "            ", "ij", "=", "None", "\n", "for", "i", ",", "row", "in", "enumerate", "(", "t", ")", ":", "\n", "                ", "for", "j", ",", "item", "in", "enumerate", "(", "row", ")", ":", "\n", "                    ", "st", ",", "s", "=", "item", "\n", "if", "s", "[", "7", "]", ":", "\n", "                        ", "ij", "=", "i", ",", "j", ",", "7", ",", "st", ",", "s", "\n", "break", "\n", "", "elif", "s", "[", "8", "]", ":", "\n", "                        ", "ij", "=", "i", ",", "j", ",", "8", ",", "st", ",", "s", "\n", "break", "\n", "", "elif", "s", "[", "9", "]", ":", "\n", "                        ", "ij", "=", "i", ",", "j", ",", "9", ",", "st", ",", "s", "\n", "break", "\n", "", "", "if", "ij", "is", "not", "None", ":", "break", "\n", "", "if", "ij", "is", "None", ":", "break", "\n", "\n", "# replace its specs", "\n", "i", ",", "j", ",", "k", ",", "st", ",", "s", "=", "ij", "\n", "s", "=", "list", "(", "s", ")", "\n", "s", "[", "7", "]", "=", "s", "[", "8", "]", "=", "s", "[", "9", "]", "=", "0", "\n", "s", "=", "tuple", "(", "s", ")", "\n", "\n", "# expand it", "\n", "if", "k", "==", "7", ":", "# 2d table", "\n", "                ", "for", "x", ",", "row", "in", "enumerate", "(", "st", ")", ":", "\n", "                    ", "for", "y", ",", "obj", "in", "enumerate", "(", "row", ")", ":", "\n", "                        ", "a", "=", "i", "+", "x", "if", "not", "transpose", "else", "i", "+", "y", "\n", "b", "=", "j", "+", "2", "*", "y", "if", "not", "transpose", "else", "j", "+", "2", "*", "x", "\n", "Table", ".", "_put", "(", "(", "obj", ",", "s", ")", ",", "t", ",", "(", "a", ",", "b", ")", ",", "None", ")", "\n", "", "", "", "if", "k", "==", "8", ":", "# subtable_horiz", "\n", "                ", "for", "y", ",", "obj", "in", "enumerate", "(", "st", ")", ":", "\n", "                    ", "Table", ".", "_put", "(", "(", "obj", ",", "s", ")", ",", "t", ",", "(", "i", ",", "j", "+", "2", "*", "y", ")", ",", "None", ")", "\n", "", "", "if", "k", "==", "9", ":", "# subtable_vert", "\n", "                ", "for", "x", ",", "obj", "in", "enumerate", "(", "st", ")", ":", "\n", "                    ", "Table", ".", "_put", "(", "(", "obj", ",", "s", ")", ",", "t", ",", "(", "i", "+", "x", ",", "j", ")", ",", "None", ")", "\n", "\n", "# return, finally", "\n", "", "", "", "return", "t", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.mkfile": [[107, 111], ["util_v1.mkdir", "fn.split"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.mkdir"], ["", "def", "mkfile", "(", "fn", ",", "parents", "=", "True", ",", "exist_ok", "=", "True", ")", ":", "\n", "    ", "dn", "=", "'/'", ".", "join", "(", "fn", ".", "split", "(", "'/'", ")", "[", ":", "-", "1", "]", ")", "\n", "mkdir", "(", "dn", ",", "parents", "=", "parents", ",", "exist_ok", "=", "exist_ok", ")", "\n", "return", "fn", "\n", "", "def", "mkdir", "(", "dn", ",", "parents", "=", "True", ",", "exist_ok", "=", "True", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.mkdir": [[111, 114], ["pathlib.Path().mkdir", "pathlib.Path"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.mkdir"], ["", "def", "mkdir", "(", "dn", ",", "parents", "=", "True", ",", "exist_ok", "=", "True", ")", ":", "\n", "    ", "pathlib", ".", "Path", "(", "dn", ")", ".", "mkdir", "(", "parents", "=", "parents", ",", "exist_ok", "=", "exist_ok", ")", "\n", "return", "dn", "if", "(", "not", "dn", "[", "-", "1", "]", "==", "'/'", "or", "dn", "==", "'/'", ")", "else", "dn", "[", ":", "-", "1", "]", "\n", "", "def", "fnstrip", "(", "fn", ",", "return_more", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.fnstrip": [[114, 136], ["fn.split", "fn.split", "len", "argparse.Namespace", "len"], "function", ["None"], ["", "def", "fnstrip", "(", "fn", ",", "return_more", "=", "False", ")", ":", "\n", "    ", "dspl", "=", "fn", ".", "split", "(", "'/'", ")", "\n", "dn", "=", "'/'", ".", "join", "(", "dspl", "[", ":", "-", "1", "]", ")", "if", "len", "(", "dspl", ")", ">", "1", "else", "'.'", "\n", "fn", "=", "dspl", "[", "-", "1", "]", "\n", "fspl", "=", "fn", ".", "split", "(", "'.'", ")", "\n", "if", "len", "(", "fspl", ")", "==", "1", ":", "\n", "        ", "bn", "=", "fspl", "[", "0", "]", "\n", "ext", "=", "''", "\n", "", "else", ":", "\n", "        ", "bn", "=", "'.'", ".", "join", "(", "fspl", "[", ":", "-", "1", "]", ")", "\n", "ext", "=", "fspl", "[", "-", "1", "]", "\n", "", "if", "return_more", ":", "\n", "        ", "return", "Namespace", "(", "\n", "dn", "=", "dn", ",", "\n", "fn", "=", "fn", ",", "\n", "path", "=", "f'{dn}/{fn}'", ",", "\n", "bn_path", "=", "f'{dn}/{bn}'", ",", "\n", "bn", "=", "bn", ",", "\n", "ext", "=", "ext", ",", "\n", ")", "\n", "", "else", ":", "\n", "        ", "return", "bn", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.read": [[144, 149], ["open", "handle.read"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.read"], ["", "", "def", "read", "(", "fn", ",", "mode", "=", "'r'", ",", "buffering", "=", "-", "1", ",", "encoding", "=", "None", ",", "\n", "errors", "=", "None", ",", "newline", "=", "None", ",", "closefd", "=", "True", ",", "opener", "=", "None", ")", ":", "\n", "    ", "with", "open", "(", "fn", ",", "mode", "=", "mode", ",", "buffering", "=", "buffering", ",", "encoding", "=", "encoding", ",", "\n", "errors", "=", "errors", ",", "newline", "=", "newline", ",", "closefd", "=", "closefd", ",", "opener", "=", "opener", ")", "as", "handle", ":", "\n", "        ", "return", "handle", ".", "read", "(", ")", "\n", "", "", "def", "write", "(", "text", ",", "fn", ",", "mode", "=", "'w'", ",", "buffering", "=", "-", "1", ",", "encoding", "=", "None", ",", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.write": [[149, 154], ["open", "handle.write"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.write"], ["", "", "def", "write", "(", "text", ",", "fn", ",", "mode", "=", "'w'", ",", "buffering", "=", "-", "1", ",", "encoding", "=", "None", ",", "\n", "errors", "=", "None", ",", "newline", "=", "None", ",", "closefd", "=", "True", ",", "opener", "=", "None", ")", ":", "\n", "    ", "with", "open", "(", "fn", ",", "mode", "=", "mode", ",", "buffering", "=", "buffering", ",", "encoding", "=", "encoding", ",", "\n", "errors", "=", "errors", ",", "newline", "=", "newline", ",", "closefd", "=", "closefd", ",", "opener", "=", "opener", ")", "as", "handle", ":", "\n", "        ", "return", "handle", ".", "write", "(", "text", ")", "\n", "", "", "def", "read_bns", "(", "fn", ",", "safe", "=", "False", ",", "sort", "=", "False", ",", "sort_key", "=", "None", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.read_bns": [[154, 166], ["sorted", "safe_basenames", "read().split", "util_v1.read"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.read"], ["", "", "def", "read_bns", "(", "fn", ",", "safe", "=", "False", ",", "sort", "=", "False", ",", "sort_key", "=", "None", ")", ":", "\n", "    ", "ans", "=", "[", "\n", "line", "\n", "for", "line", "in", "read", "(", "fn", ")", ".", "split", "(", "'\\n'", ")", "\n", "if", "line", "!=", "''", "\n", "]", "\n", "if", "sort", ":", "\n", "        ", "ans", "=", "sorted", "(", "ans", ",", "key", "=", "sort_key", ")", "\n", "", "if", "safe", ":", "\n", "        ", "return", "safe_basenames", "(", "ans", ")", "\n", "", "else", ":", "\n", "        ", "return", "ans", "\n", "", "", "def", "safe_bns", "(", "bns", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.safe_bns": [[166, 171], ["np.array"], "function", ["None"], ["", "", "def", "safe_bns", "(", "bns", ")", ":", "\n", "    ", "try", ":", "\n", "        ", "return", "np", ".", "array", "(", "bns", ",", "dtype", "=", "np", ".", "string_", ")", "\n", "", "except", ":", "\n", "        ", "return", "bns", "\n", "", "", "def", "safe_bn", "(", "bn", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.safe_bn": [[171, 176], ["np.string_"], "function", ["None"], ["", "", "def", "safe_bn", "(", "bn", ")", ":", "\n", "    ", "try", ":", "\n", "        ", "return", "np", ".", "string_", "(", "bn", ")", "\n", "", "except", ":", "\n", "        ", "return", "bn", "\n", "", "", "def", "unsafe_bns", "(", "bns", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.unsafe_bns": [[176, 178], ["util_v1.unsafe_bn"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.unsafe_bn"], ["", "", "def", "unsafe_bns", "(", "bns", ")", ":", "\n", "    ", "return", "[", "unsafe_bn", "(", "q", ")", "for", "q", "in", "bns", "]", "\n", "", "def", "unsafe_bn", "(", "bn", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.unsafe_bn": [[178, 180], ["str"], "function", ["None"], ["", "def", "unsafe_bn", "(", "bn", ")", ":", "\n", "    ", "return", "str", "(", "bn", ",", "encoding", "=", "'utf-8'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.pload": [[182, 185], ["open", "pickle.load"], "function", ["None"], ["def", "pload", "(", "fn", ",", "mode", "=", "'rb'", ")", ":", "\n", "    ", "with", "open", "(", "fn", ",", "mode", ")", "as", "handle", ":", "\n", "        ", "return", "pickle", ".", "load", "(", "handle", ")", "\n", "", "", "def", "pdump", "(", "obj", ",", "fn", ",", "mode", "=", "'wb'", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.pdump": [[185, 188], ["open", "pickle.dump"], "function", ["None"], ["", "", "def", "pdump", "(", "obj", ",", "fn", ",", "mode", "=", "'wb'", ")", ":", "\n", "    ", "with", "open", "(", "fn", ",", "mode", ")", "as", "handle", ":", "\n", "        ", "return", "pickle", ".", "dump", "(", "obj", ",", "handle", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.jread": [[190, 193], ["open", "json.load"], "function", ["None"], ["def", "jread", "(", "fn", ",", "mode", "=", "'r'", ")", ":", "\n", "    ", "with", "open", "(", "fn", ",", "mode", ")", "as", "handle", ":", "\n", "        ", "return", "json", ".", "load", "(", "handle", ")", "\n", "", "", "def", "jwrite", "(", "x", ",", "fn", ",", "mode", "=", "'w'", ",", "indent", "=", "'\\t'", ",", "sort_keys", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.jwrite": [[193, 196], ["open", "json.dump"], "function", ["None"], ["", "", "def", "jwrite", "(", "x", ",", "fn", ",", "mode", "=", "'w'", ",", "indent", "=", "'\\t'", ",", "sort_keys", "=", "False", ")", ":", "\n", "    ", "with", "open", "(", "fn", ",", "mode", ")", "as", "handle", ":", "\n", "        ", "return", "json", ".", "dump", "(", "x", ",", "handle", ",", "indent", "=", "indent", ",", "sort_keys", "=", "sort_keys", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.mem": [[204, 212], ["psutil.Process().memory_info", "units[].lower", "psutil.Process", "os.getpid"], "function", ["None"], ["def", "mem", "(", "units", "=", "'m'", ")", ":", "\n", "    ", "return", "psutil", ".", "Process", "(", "os", ".", "getpid", "(", ")", ")", ".", "memory_info", "(", ")", ".", "rss", "/", "{", "\n", "'b'", ":", "1", ",", "\n", "'k'", ":", "1e3", ",", "\n", "'m'", ":", "1e6", ",", "\n", "'g'", ":", "1e9", ",", "\n", "'t'", ":", "1e12", ",", "\n", "}", "[", "units", "[", "0", "]", ".", "lower", "(", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.chunk_cols": [[213, 215], ["range", "len"], "function", ["None"], ["", "def", "chunk_cols", "(", "x", ",", "n", ")", ":", "\n", "    ", "return", "[", "x", "[", "i", ":", "i", "+", "n", "]", "for", "i", "in", "range", "(", "0", ",", "len", "(", "x", ")", ",", "n", ")", "]", "\n", "", "def", "chunk_rows", "(", "x", ",", "n", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.chunk_rows": [[215, 217], ["util_v1.chunk_cols", "int", "math.ceil", "len"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.chunk_cols"], ["", "def", "chunk_rows", "(", "x", ",", "n", ")", ":", "\n", "    ", "return", "chunk_cols", "(", "x", ",", "int", "(", "math", ".", "ceil", "(", "len", "(", "x", ")", "/", "n", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.__init__": [[54, 124], ["isinstance", "isinstance", "twodee_v0.diam", "PIL.Image.open", "isinstance", "isinstance", "twodee_v0.uri2img", "len", "np.issubdtype", "isinstance", "twodee_v0.I.data.getbands", "len", "twodee_v0.I.data.transpose", "tuple", "isinstance", "len", "twodee_v0.I.data.astype", "np.issubdtype", "len", "twodee_v0.I.data.permute", "len", "twodee_v0.I.data.astype"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.diam", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.uri2img", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.transpose"], ["    ", "def", "__init__", "(", "self", ",", "data", ")", ":", "\n", "# preprocess stream-type to pil", "\n", "        ", "if", "isinstance", "(", "data", ",", "str", ")", ":", "\n", "            ", "data", "=", "Image", ".", "open", "(", "data", ")", "\n", "", "elif", "isinstance", "(", "data", ",", "bytes", ")", ":", "\n", "            ", "data", "=", "uri2img", "(", "data", ")", "\n", "", "self", ".", "data", "=", "data", "\n", "\n", "# massage to canonical forms", "\n", "if", "isinstance", "(", "self", ".", "data", ",", "Image", ".", "Image", ")", ":", "\n", "# canon: pil image", "\n", "            ", "self", ".", "dtype", "=", "'pil'", "\n", "self", ".", "mode", "=", "self", ".", "data", ".", "mode", "\n", "self", ".", "shape", "=", "(", "\n", "len", "(", "self", ".", "data", ".", "getbands", "(", ")", ")", ",", "\n", "self", ".", "data", ".", "size", "[", "1", "]", ",", "\n", "self", ".", "data", ".", "size", "[", "0", "]", ",", "\n", ")", "\n", "self", ".", "size", "=", "self", ".", "shape", "[", "1", ":", "]", "\n", "", "elif", "isinstance", "(", "self", ".", "data", ",", "np", ".", "ndarray", ")", ":", "\n", "# canon: float(ch,h,w)", "\n", "            ", "if", "len", "(", "self", ".", "data", ".", "shape", ")", "==", "2", ":", "\n", "                ", "self", ".", "data", "=", "self", ".", "data", "[", "None", ",", "]", "\n", "", "elif", "len", "(", "self", ".", "data", ".", "shape", ")", "==", "4", ":", "\n", "                ", "assert", "self", ".", "data", ".", "shape", "[", "0", "]", "==", "1", "\n", "self", ".", "data", "=", "self", ".", "data", "[", "0", "]", "\n", "", "if", "self", ".", "data", ".", "shape", "[", "0", "]", "not", "in", "[", "1", ",", "3", ",", "4", "]", ":", "\n", "                ", "self", ".", "data", "=", "self", ".", "data", ".", "transpose", "(", "2", ",", "0", ",", "1", ")", "\n", "", "if", "np", ".", "issubdtype", "(", "self", ".", "data", ".", "dtype", ",", "np", ".", "floating", ")", ":", "\n", "                ", "pass", "\n", "", "elif", "self", ".", "data", ".", "dtype", "==", "np", ".", "bool", ":", "\n", "                ", "self", ".", "data", "=", "self", ".", "data", ".", "astype", "(", "np", ".", "float", ")", "\n", "", "elif", "np", ".", "issubdtype", "(", "self", ".", "data", ".", "dtype", ",", "np", ".", "integer", ")", ":", "\n", "                ", "self", ".", "data", "=", "self", ".", "data", ".", "astype", "(", "np", ".", "float", ")", "/", "255.0", "\n", "", "self", ".", "dtype", "=", "'np'", "\n", "self", ".", "mode", "=", "{", "\n", "1", ":", "'L'", ",", "\n", "3", ":", "'RGB'", ",", "\n", "4", ":", "'RGBA'", ",", "\n", "}", "[", "self", ".", "data", ".", "shape", "[", "0", "]", "]", "\n", "self", ".", "shape", "=", "self", ".", "data", ".", "shape", "\n", "self", ".", "size", "=", "self", ".", "shape", "[", "1", ":", "]", "\n", "", "elif", "isinstance", "(", "self", ".", "data", ",", "torch", ".", "Tensor", ")", ":", "\n", "# canon: (ch,h,w)", "\n", "# assumes values in [0,1]", "\n", "            ", "if", "len", "(", "self", ".", "data", ".", "shape", ")", "==", "2", ":", "\n", "                ", "self", ".", "data", "=", "self", ".", "data", "[", "None", ",", "]", "\n", "", "elif", "len", "(", "self", ".", "data", ".", "shape", ")", "==", "4", ":", "\n", "                ", "assert", "self", ".", "data", ".", "shape", "[", "0", "]", "==", "1", "\n", "self", ".", "data", "=", "self", ".", "data", "[", "0", "]", "\n", "", "if", "self", ".", "data", ".", "shape", "[", "0", "]", "not", "in", "[", "1", ",", "3", ",", "4", "]", ":", "\n", "                ", "self", ".", "data", "=", "self", ".", "data", ".", "permute", "(", "2", ",", "0", ",", "1", ")", "\n", "", "self", ".", "dtype", "=", "'torch'", "\n", "self", ".", "mode", "=", "{", "\n", "1", ":", "'L'", ",", "\n", "3", ":", "'RGB'", ",", "\n", "4", ":", "'RGBA'", ",", "\n", "}", "[", "self", ".", "data", ".", "shape", "[", "0", "]", "]", "\n", "self", ".", "shape", "=", "tuple", "(", "self", ".", "data", ".", "shape", ")", "\n", "self", ".", "size", "=", "self", ".", "shape", "[", "1", ":", "]", "\n", "", "elif", "isinstance", "(", "self", ".", "data", ",", "I", ")", ":", "\n", "            ", "self", ".", "dtype", "=", "self", ".", "data", ".", "dtype", "\n", "self", ".", "mode", "=", "self", ".", "data", ".", "mode", "\n", "self", ".", "shape", "=", "self", ".", "data", ".", "shape", "\n", "self", ".", "size", "=", "self", ".", "data", ".", "size", "\n", "self", ".", "data", "=", "self", ".", "data", ".", "data", "\n", "", "else", ":", "\n", "            ", "assert", "0", ",", "'data not understood'", "\n", "", "self", ".", "diam", "=", "diam", "(", "self", ".", "size", ")", "\n", "return", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.convert": [[126, 128], ["twodee_v0.I", "twodee_v0.I.pil"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil"], ["", "def", "convert", "(", "self", ",", "mode", ")", ":", "\n", "        ", "return", "I", "(", "self", ".", "pil", "(", "mode", "=", "mode", ")", ")", "\n", "", "def", "invert", "(", "self", ",", "invert_alpha", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.invert": [[128, 136], ["twodee_v0.I.np", "twodee_v0.I", "twodee_v0.I", "np.concatenate", "twodee_v0.I.np"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.np", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.np"], ["", "def", "invert", "(", "self", ",", "invert_alpha", "=", "False", ")", ":", "\n", "        ", "data", "=", "self", ".", "np", "(", ")", "\n", "if", "self", ".", "mode", "==", "'RGBA'", "and", "not", "invert_alpha", ":", "\n", "            ", "return", "I", "(", "np", ".", "concatenate", "(", "[", "\n", "1", "-", "data", "[", ":", "3", "]", ",", "data", "[", "3", ":", "]", ",", "\n", "]", ")", ")", "\n", "", "else", ":", "\n", "            ", "return", "I", "(", "1", "-", "self", ".", "np", "(", ")", ")", "\n", "", "", "def", "pil", "(", "self", ",", "mode", "=", "None", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil": [[136, 150], ["TF.to_pil_image.convert", "PIL.Image.fromarray", "twodee_v0.I.data.clip", "TF.to_pil_image", "twodee_v0.I.data.float().clamp().cpu", "data.transpose", "twodee_v0.I.data.float().clamp", "twodee_v0.I.data.float"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.convert", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.transpose"], ["", "", "def", "pil", "(", "self", ",", "mode", "=", "None", ")", ":", "\n", "        ", "if", "self", ".", "dtype", "==", "'pil'", ":", "\n", "            ", "ans", "=", "self", ".", "data", "\n", "", "elif", "self", ".", "dtype", "==", "'np'", ":", "\n", "            ", "data", "=", "255", "*", "self", ".", "data", ".", "clip", "(", "0", ",", "1", ")", "\n", "ans", "=", "Image", ".", "fromarray", "(", "(", "\n", "data", ".", "transpose", "(", "1", ",", "2", ",", "0", ")", "if", "data", ".", "shape", "[", "0", "]", "!=", "1", "\n", "else", "data", "[", "0", "]", "\n", ")", ".", "astype", "(", "np", ".", "uint8", ")", ")", "\n", "", "elif", "self", ".", "dtype", "==", "'torch'", ":", "\n", "            ", "ans", "=", "TF", ".", "to_pil_image", "(", "self", ".", "data", ".", "float", "(", ")", ".", "clamp", "(", "0", ",", "1", ")", ".", "cpu", "(", ")", ")", "\n", "", "else", ":", "\n", "            ", "assert", "0", ",", "'data not understood'", "\n", "", "return", "ans", "if", "mode", "is", "None", "else", "ans", ".", "convert", "(", "mode", ")", "\n", "", "def", "p", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.p": [[150, 152], ["twodee_v0.I.pil"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil"], ["", "def", "p", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "pil", "(", "*", "args", ",", "**", "kwargs", ")", "\n", "", "def", "pimg", "(", "self", ",", "mode", "=", "None", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pimg": [[152, 154], ["twodee_v0.I.pil"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil"], ["", "def", "pimg", "(", "self", ",", "mode", "=", "None", ")", ":", "\n", "        ", "return", "self", ".", "pil", "(", "mode", "=", "mode", ")", "\n", "", "def", "np", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.np": [[154, 162], ["twodee_v0.I", "np.asarray", "twodee_v0.I.data.cpu().numpy", "twodee_v0.I.data.cpu"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.numpy"], ["", "def", "np", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "dtype", "==", "'pil'", ":", "\n", "            ", "return", "I", "(", "np", ".", "asarray", "(", "self", ".", "data", ")", ")", ".", "data", "\n", "", "elif", "self", ".", "dtype", "==", "'np'", ":", "\n", "            ", "return", "self", ".", "data", "\n", "", "elif", "self", ".", "dtype", "==", "'torch'", ":", "\n", "            ", "return", "self", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "", "assert", "0", ",", "'data not understood'", "\n", "", "def", "n", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.n": [[162, 164], ["twodee_v0.I.np"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.np"], ["", "def", "n", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "np", "(", ")", "\n", "", "def", "numpy", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.numpy": [[164, 166], ["twodee_v0.I.np"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.np"], ["", "def", "numpy", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "np", "(", ")", "\n", "", "def", "nimg", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.nimg": [[166, 168], ["twodee_v0.I.np"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.np"], ["", "def", "nimg", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "np", "(", ")", "\n", "", "def", "uint8", "(", "self", ",", "ch_last", "=", "True", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.uint8": [[168, 171], ["ans.transpose", "twodee_v0.I.np"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.transpose", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.np"], ["", "def", "uint8", "(", "self", ",", "ch_last", "=", "True", ")", ":", "\n", "        ", "ans", "=", "(", "self", ".", "np", "(", ")", "*", "255", ")", ".", "astype", "(", "np", ".", "uint8", ")", "\n", "return", "ans", ".", "transpose", "(", "1", ",", "2", ",", "0", ")", "if", "ch_last", "else", "ans", "\n", "", "def", "cv2", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.cv2": [[171, 173], ["twodee_v0.I.uint8"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.uint8"], ["", "def", "cv2", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "uint8", "(", "ch_last", "=", "True", ")", "[", "...", ",", ":", ":", "-", "1", "]", "\n", "", "def", "bgr", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.bgr": [[173, 179], ["twodee_v0.I.np", "twodee_v0.I", "twodee_v0.I"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.np"], ["", "def", "bgr", "(", "self", ")", ":", "\n", "        ", "x", "=", "self", ".", "np", "(", ")", "\n", "if", "self", ".", "mode", "==", "'RGBA'", ":", "\n", "            ", "return", "I", "(", "x", "[", "[", "2", ",", "1", ",", "0", ",", "3", "]", "]", ")", "\n", "", "else", ":", "\n", "            ", "return", "I", "(", "x", "[", ":", ":", "-", "1", "]", ")", "\n", "", "", "def", "tensor", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor": [[179, 187], ["TF.to_tensor", "torch.from_numpy", "twodee_v0.I.data.copy"], "methods", ["None"], ["", "", "def", "tensor", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "dtype", "==", "'pil'", ":", "\n", "            ", "return", "TF", ".", "to_tensor", "(", "self", ".", "data", ")", "\n", "", "elif", "self", ".", "dtype", "==", "'np'", ":", "\n", "            ", "return", "torch", ".", "from_numpy", "(", "self", ".", "data", ".", "copy", "(", ")", ")", "\n", "", "elif", "self", ".", "dtype", "==", "'torch'", ":", "\n", "            ", "return", "self", ".", "data", "\n", "", "assert", "0", ",", "'data not understood'", "\n", "", "def", "t", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.t": [[187, 189], ["twodee_v0.I.tensor"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor"], ["", "def", "t", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "tensor", "(", ")", "\n", "", "def", "torch", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.torch": [[189, 191], ["twodee_v0.I.tensor"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor"], ["", "def", "torch", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "tensor", "(", ")", "\n", "", "def", "timg", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.timg": [[191, 193], ["twodee_v0.I.tensor"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor"], ["", "def", "timg", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "tensor", "(", ")", "\n", "", "def", "save", "(", "self", ",", "fn", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.save": [[193, 196], ["twodee_v0.I.pil().save", "twodee_v0.I.pil"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.save", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil"], ["", "def", "save", "(", "self", ",", "fn", ")", ":", "\n", "        ", "self", ".", "pil", "(", ")", ".", "save", "(", "fn", ")", "\n", "return", "fn", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rescale": [[198, 202], ["twodee_v0.I.resize", "twodee_v0.rescale_dry"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.rescale_dry"], ["", "def", "rescale", "(", "self", ",", "factor", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n", "        ", "return", "self", ".", "resize", "(", "\n", "rescale_dry", "(", "self", ".", "size", ",", "factor", ")", ",", "\n", "resample", "=", "resample", ",", "antialias", "=", "antialias", ",", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize": [[203, 219], ["twodee_v0.pixel_ij", "twodee_v0.I", "twodee_v0.I.data.resize", "twodee_v0.I.resize", "twodee_v0.I", "getattr", "twodee_v0.I", "TF.resize", "resample.upper", "twodee_v0.I.pil", "getattr", "resample.upper"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil"], ["", "def", "resize", "(", "self", ",", "s", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n", "        ", "s", "=", "pixel_ij", "(", "s", ",", "rounding", "=", "True", ")", "\n", "if", "self", ".", "dtype", "==", "'pil'", ":", "\n", "            ", "return", "I", "(", "self", ".", "data", ".", "resize", "(", "\n", "s", "[", ":", ":", "-", "1", "]", ",", "resample", "=", "getattr", "(", "Image", ",", "resample", ".", "upper", "(", ")", ")", ",", "\n", ")", ")", "\n", "", "elif", "self", ".", "dtype", "==", "'np'", ":", "\n", "            ", "return", "I", "(", "self", ".", "pil", "(", ")", ")", ".", "resize", "(", "s", ",", "resample", "=", "resample", ")", "\n", "", "elif", "self", ".", "dtype", "==", "'torch'", ":", "\n", "            ", "return", "I", "(", "TF", ".", "resize", "(", "\n", "self", ".", "data", ",", "\n", "s", ",", "\n", "interpolation", "=", "getattr", "(", "TF", ".", "InterpolationMode", ",", "resample", ".", "upper", "(", ")", ")", ",", "\n", "# antialias=antialias,", "\n", ")", ")", "\n", "", "assert", "0", ",", "'data not understood'", "\n", "", "def", "resize_w", "(", "self", ",", "s", "=", "512", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize_w": [[219, 222], ["twodee_v0.I.resize"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize"], ["", "def", "resize_w", "(", "self", ",", "s", "=", "512", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n", "        ", "h", ",", "w", "=", "self", ".", "size", "\n", "return", "self", ".", "resize", "(", "(", "h", "*", "s", "/", "w", ",", "s", ")", ")", "\n", "", "def", "resize_h", "(", "self", ",", "s", "=", "512", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize_h": [[222, 225], ["twodee_v0.I.resize"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize"], ["", "def", "resize_h", "(", "self", ",", "s", "=", "512", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n", "        ", "h", ",", "w", "=", "self", ".", "size", "\n", "return", "self", ".", "resize", "(", "(", "s", ",", "w", "*", "s", "/", "h", ")", ")", "\n", "", "def", "resize_max", "(", "self", ",", "s", "=", "512", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize_max": [[225, 228], ["twodee_v0.resize_max_dry", "twodee_v0.I.resize"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_max_dry", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize"], ["", "def", "resize_max", "(", "self", ",", "s", "=", "512", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n", "        ", "dry", "=", "resize_max_dry", "(", "self", ".", "size", ",", "s", "=", "s", ")", "\n", "return", "self", ".", "resize", "(", "dry", ",", "resample", "=", "resample", ")", "\n", "", "def", "resize_min", "(", "self", ",", "s", "=", "512", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize_min": [[228, 231], ["twodee_v0.resize_min_dry", "twodee_v0.I.resize"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_min_dry", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize"], ["", "def", "resize_min", "(", "self", ",", "s", "=", "512", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n", "        ", "dry", "=", "resize_min_dry", "(", "self", ".", "size", ",", "s", "=", "s", ")", "\n", "return", "self", ".", "resize", "(", "dry", ",", "resample", "=", "resample", ")", "\n", "", "def", "resize_square", "(", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize_square": [[231, 250], ["twodee_v0.I.resize_max().tensor", "twodee_v0.resize_square_dry", "TF.pad", "twodee_v0.I", "twodee_v0.I.resize_max"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_square_dry", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_max"], ["", "def", "resize_square", "(", "\n", "self", ",", "s", "=", "512", ",", "\n", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ",", "\n", "fill", "=", "0", ",", "padding_mode", "=", "'constant'", ",", "\n", ")", ":", "\n", "        ", "res", "=", "self", ".", "resize_max", "(", "s", "=", "s", ",", "resample", "=", "resample", ",", "antialias", "=", "antialias", ")", ".", "tensor", "(", ")", "\n", "dry", "=", "resize_square_dry", "(", "res", ",", "s", "=", "s", ")", "\n", "fc", "=", "dry", "[", "0", "]", "\n", "pad", "=", "TF", ".", "pad", "(", "\n", "res", ",", "\n", "padding", "=", "[", "\n", "-", "fc", "[", "1", "]", ",", "# left", "\n", "-", "fc", "[", "0", "]", ",", "# top", "\n", "s", "+", "fc", "[", "1", "]", "-", "res", ".", "shape", "[", "2", "]", ",", "# right", "\n", "s", "+", "fc", "[", "0", "]", "-", "res", ".", "shape", "[", "1", "]", ",", "# bottom", "\n", "]", ",", "\n", "fill", "=", "fill", ",", "padding_mode", "=", "padding_mode", ",", "\n", ")", "\n", "return", "I", "(", "pad", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rw": [[251, 253], ["twodee_v0.I.resize_w"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize_w"], ["", "def", "rw", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "resize_w", "(", "*", "args", ",", "**", "kwargs", ")", "\n", "", "def", "rh", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rh": [[253, 255], ["twodee_v0.I.resize_h"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize_h"], ["", "def", "rh", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "resize_h", "(", "*", "args", ",", "**", "kwargs", ")", "\n", "", "def", "rmax", "(", "self", ",", "s", "=", "512", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rmax": [[255, 257], ["twodee_v0.I.resize_max"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_max"], ["", "def", "rmax", "(", "self", ",", "s", "=", "512", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n", "        ", "return", "self", ".", "resize_max", "(", "s", "=", "s", ",", "resample", "=", "resample", ",", "antialias", "=", "antialias", ")", "\n", "", "def", "rmin", "(", "self", ",", "s", "=", "512", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rmin": [[257, 259], ["twodee_v0.I.resize_min"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_min"], ["", "def", "rmin", "(", "self", ",", "s", "=", "512", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n", "        ", "return", "self", ".", "resize_min", "(", "s", "=", "s", ",", "resample", "=", "resample", ",", "antialias", "=", "antialias", ")", "\n", "", "def", "rsqr", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rsqr": [[259, 261], ["twodee_v0.I.resize_square"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_square"], ["", "def", "rsqr", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "resize_square", "(", "*", "args", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.transpose": [[263, 271], ["twodee_v0.I", "twodee_v0.I.data.transpose", "twodee_v0.I", "np.swapaxes", "twodee_v0.I", "twodee_v0.I.data.permute"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.transpose"], ["", "def", "transpose", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "dtype", "==", "'pil'", ":", "\n", "            ", "return", "I", "(", "self", ".", "data", ".", "transpose", "(", "method", "=", "Image", ".", "TRANSPOSE", ")", ")", "\n", "", "elif", "self", ".", "dtype", "==", "'np'", ":", "\n", "            ", "return", "I", "(", "np", ".", "swapaxes", "(", "self", ".", "data", ",", "1", ",", "2", ")", ")", "\n", "", "elif", "self", ".", "dtype", "==", "'torch'", ":", "\n", "            ", "return", "I", "(", "self", ".", "data", ".", "permute", "(", "0", ",", "2", ",", "1", ")", ")", "\n", "", "assert", "0", ",", "'data not understood'", "\n", "", "def", "T", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.T": [[271, 273], ["twodee_v0.I.transpose"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.transpose"], ["", "def", "T", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "transpose", "(", ")", "\n", "", "def", "fliph", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.fliph": [[273, 281], ["twodee_v0.I", "twodee_v0.I.data.transpose", "twodee_v0.I", "twodee_v0.I", "twodee_v0.I.data.flip"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.transpose"], ["", "def", "fliph", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "dtype", "==", "'pil'", ":", "\n", "            ", "return", "I", "(", "self", ".", "data", ".", "transpose", "(", "method", "=", "Image", ".", "FLIP_LEFT_RIGHT", ")", ")", "\n", "", "elif", "self", ".", "dtype", "==", "'np'", ":", "\n", "            ", "return", "I", "(", "self", ".", "data", "[", "...", ",", ":", ":", "-", "1", "]", ")", "\n", "", "elif", "self", ".", "dtype", "==", "'torch'", ":", "\n", "            ", "return", "I", "(", "self", ".", "data", ".", "flip", "(", "dims", "=", "(", "2", ",", ")", ")", ")", "\n", "", "assert", "0", ",", "'data not understood'", "\n", "", "def", "flipv", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.flipv": [[281, 289], ["twodee_v0.I", "twodee_v0.I.data.transpose", "twodee_v0.I", "twodee_v0.I", "twodee_v0.I.data.flip"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.transpose"], ["", "def", "flipv", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "dtype", "==", "'pil'", ":", "\n", "            ", "return", "I", "(", "self", ".", "data", ".", "transpose", "(", "method", "=", "Image", ".", "FLIP_TOP_BOTTOM", ")", ")", "\n", "", "elif", "self", ".", "dtype", "==", "'np'", ":", "\n", "            ", "return", "I", "(", "self", ".", "data", "[", ":", ",", ":", ":", "-", "1", "]", ")", "\n", "", "elif", "self", ".", "dtype", "==", "'torch'", ":", "\n", "            ", "return", "I", "(", "self", ".", "data", ".", "flip", "(", "dims", "=", "(", "1", ",", ")", ")", ")", "\n", "", "assert", "0", ",", "'data not understood'", "\n", "", "def", "rotate", "(", "self", ",", "deg", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rotate": [[289, 301], ["twodee_v0.I.rotate90", "twodee_v0.I.rotate180", "twodee_v0.I.rotate270"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rotate90", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rotate180", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rotate270"], ["", "def", "rotate", "(", "self", ",", "deg", ")", ":", "\n", "        ", "if", "deg", "==", "0", ":", "\n", "            ", "return", "self", "\n", "", "elif", "deg", "==", "90", ":", "\n", "            ", "return", "self", ".", "rotate90", "(", ")", "\n", "", "elif", "deg", "==", "180", ":", "\n", "            ", "return", "self", ".", "rotate180", "(", ")", "\n", "", "elif", "deg", "==", "270", ":", "\n", "            ", "return", "self", ".", "rotate270", "(", ")", "\n", "", "elif", "deg", "==", "360", ":", "\n", "            ", "return", "self", "\n", "", "assert", "0", ",", "'data not understood'", "\n", "", "def", "rotate90", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rotate90": [[301, 306], ["twodee_v0.I", "twodee_v0.I.data.transpose", "twodee_v0.I.transpose().flipv", "twodee_v0.I.transpose"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.transpose", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.flipv", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.transpose"], ["", "def", "rotate90", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "dtype", "==", "'pil'", ":", "\n", "            ", "return", "I", "(", "self", ".", "data", ".", "transpose", "(", "method", "=", "Image", ".", "ROTATE_90", ")", ")", "\n", "", "elif", "self", ".", "dtype", "in", "[", "'np'", ",", "'torch'", "]", ":", "\n", "            ", "return", "self", ".", "transpose", "(", ")", ".", "flipv", "(", ")", "\n", "", "", "def", "rotate180", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rotate180": [[306, 311], ["twodee_v0.I", "twodee_v0.I.data.transpose", "twodee_v0.I.fliph().flipv", "twodee_v0.I.fliph"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.transpose", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.flipv", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.fliph"], ["", "", "def", "rotate180", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "dtype", "==", "'pil'", ":", "\n", "            ", "return", "I", "(", "self", ".", "data", ".", "transpose", "(", "method", "=", "Image", ".", "ROTATE_180", ")", ")", "\n", "", "elif", "self", ".", "dtype", "in", "[", "'np'", ",", "'torch'", "]", ":", "\n", "            ", "return", "self", ".", "fliph", "(", ")", ".", "flipv", "(", ")", "\n", "", "", "def", "rotate270", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rotate270": [[311, 316], ["twodee_v0.I", "twodee_v0.I.data.transpose", "twodee_v0.I.transpose().fliph", "twodee_v0.I.transpose"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.transpose", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.fliph", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.transpose"], ["", "", "def", "rotate270", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "dtype", "==", "'pil'", ":", "\n", "            ", "return", "I", "(", "self", ".", "data", ".", "transpose", "(", "method", "=", "Image", ".", "ROTATE_270", ")", ")", "\n", "", "elif", "self", ".", "dtype", "in", "[", "'np'", ",", "'torch'", "]", ":", "\n", "            ", "return", "self", ".", "transpose", "(", ")", ".", "fliph", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.cropbox": [[318, 330], ["twodee_v0.pixel_ij", "twodee_v0.pixel_ij", "twodee_v0.I", "twodee_v0.pixel_ij", "TF.resized_crop", "twodee_v0.I.pil().convert", "getattr", "twodee_v0.I.pil", "resample.upper"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.convert", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil"], ["", "", "def", "cropbox", "(", "self", ",", "from_corner", ",", "from_size", ",", "to_size", "=", "None", ",", "resample", "=", "'bilinear'", ")", ":", "\n", "        ", "from_corner", "=", "pixel_ij", "(", "from_corner", ",", "rounding", "=", "True", ")", "\n", "from_size", "=", "pixel_ij", "(", "from_size", ",", "rounding", "=", "True", ")", "\n", "to_size", "=", "pixel_ij", "(", "to_size", ",", "rounding", "=", "True", ")", "if", "to_size", "!=", "None", "else", "from_size", "\n", "return", "I", "(", "TF", ".", "resized_crop", "(", "\n", "self", ".", "pil", "(", ")", ".", "convert", "(", "'RGBA'", ")", ",", "\n", "from_corner", "[", "0", "]", ",", "\n", "from_corner", "[", "1", "]", ",", "\n", "from_size", "[", "0", "]", ",", "\n", "from_size", "[", "1", "]", ",", "\n", "to_size", ",", "\n", "interpolation", "=", "getattr", "(", "TF", ".", "InterpolationMode", ",", "resample", ".", "upper", "(", ")", ")", ",", "\n", ")", ")", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.cb": [[331, 333], ["twodee_v0.I.cropbox"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox"], ["", "def", "cb", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "cropbox", "(", "*", "args", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.alpha_composite": [[335, 346], ["twodee_v0.I.pil().convert", "I().pil().convert", "twodee_v0.I", "twodee_v0.I.pil", "twodee_v0.I", "twodee_v0.I.pil", "twodee_v0.I.pil", "twodee_v0.I.np", "PIL.Image.alpha_composite", "np.asarray", "twodee_v0.I", "twodee_v0.I", "twodee_v0.I"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.convert", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.convert", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.np", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.alpha_composite"], ["", "def", "alpha_composite", "(", "self", ",", "img", ",", "opacity", "=", "1.0", ")", ":", "\n", "        ", "a", "=", "self", ".", "pil", "(", ")", ".", "convert", "(", "'RGBA'", ")", "\n", "b", "=", "I", "(", "img", ")", ".", "pil", "(", ")", ".", "convert", "(", "'RGBA'", ")", "\n", "if", "opacity", "==", "0", ":", "\n", "            ", "return", "I", "(", "a", ")", "\n", "# elif opacity==1:", "\n", "#     return I(b)", "\n", "", "else", ":", "\n", "            ", "b", "=", "I", "(", "b", ")", ".", "np", "(", ")", "*", "np", ".", "asarray", "(", "[", "1", ",", "1", ",", "1", ",", "opacity", "]", ")", "[", ":", ",", "None", ",", "None", "]", "\n", "b", "=", "I", "(", "b", ")", ".", "pil", "(", ")", "\n", "return", "I", "(", "Image", ".", "alpha_composite", "(", "a", ",", "b", ")", ")", "\n", "", "", "def", "alpha_bg", "(", "self", ",", "c", "=", "0.5", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.alpha_bg": [[346, 348], ["iblank().alpha_composite", "twodee_v0.iblank"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.alpha_composite", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.iblank"], ["", "", "def", "alpha_bg", "(", "self", ",", "c", "=", "0.5", ")", ":", "\n", "        ", "return", "iblank", "(", "self", ".", "size", ",", "c", "=", "c", ")", ".", "alpha_composite", "(", "self", ",", "opacity", "=", "1.0", ")", "\n", "", "def", "alpha_bbox", "(", "self", ",", "thresh", "=", "0.5", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.alpha_bbox": [[348, 350], ["twodee_v0.I.alpha_bbox"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.alpha_bbox"], ["", "def", "alpha_bbox", "(", "self", ",", "thresh", "=", "0.5", ")", ":", "\n", "        ", "return", "alpha_bbox", "(", "self", ",", "thresh", "=", "thresh", ")", "\n", "", "def", "as_alpha", "(", "self", ",", "c", "=", "0", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.as_alpha": [[350, 352], ["iblank().alpha", "twodee_v0.iblank"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.alpha", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.iblank"], ["", "def", "as_alpha", "(", "self", ",", "c", "=", "0", ")", ":", "\n", "        ", "return", "iblank", "(", "self", ".", "size", ",", "c", "=", "c", ")", ".", "alpha", "(", "self", ")", "\n", "", "def", "alpha", "(", "self", ",", "a", "=", "1.0", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.alpha": [[352, 358], ["twodee_v0.I", "twodee_v0.I", "twodee_v0.I.pil().convert", "twodee_v0.I", "twodee_v0.I", "np.concatenate", "type", "twodee_v0.I.pil", "np.ones", "twodee_v0.I.numpy", "a.numpy"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.convert", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.numpy", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.numpy"], ["", "def", "alpha", "(", "self", ",", "a", "=", "1.0", ")", ":", "\n", "# setter, converts to rgba", "\n", "        ", "rgba", "=", "I", "(", "self", ".", "pil", "(", ")", ".", "convert", "(", "'RGBA'", ")", ")", "\n", "a", "=", "I", "(", "a", "*", "np", ".", "ones", "(", "self", ".", "size", ")", ")", "if", "type", "(", "a", ")", "in", "[", "float", ",", "int", "]", "else", "I", "(", "a", ")", "\n", "return", "I", "(", "np", ".", "concatenate", "(", "[", "\n", "rgba", ".", "numpy", "(", ")", "[", ":", "-", "1", "]", ",", "a", ".", "numpy", "(", ")", "[", "-", "1", ":", "]", ",", "\n", "]", ")", ")", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.acomp": [[360, 362], ["twodee_v0.I.alpha_composite"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.alpha_composite"], ["", "def", "acomp", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "alpha_composite", "(", "*", "args", ",", "**", "kwargs", ")", "\n", "", "def", "abg", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.abg": [[362, 364], ["twodee_v0.I.alpha_bg"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.alpha_bg"], ["", "def", "abg", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "alpha_bg", "(", "*", "args", ",", "**", "kwargs", ")", "\n", "", "def", "abbox", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.abbox": [[364, 366], ["twodee_v0.I.alpha_bbox"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.alpha_bbox"], ["", "def", "abbox", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "alpha_bbox", "(", "*", "args", ",", "**", "kwargs", ")", "\n", "", "def", "aa", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.aa": [[366, 368], ["twodee_v0.I.as_alpha"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.as_alpha"], ["", "def", "aa", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "as_alpha", "(", "*", "args", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.left": [[370, 372], ["twodee_v0.igrid"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.igrid"], ["", "def", "left", "(", "self", ",", "img", ",", "bg", "=", "'k'", ")", ":", "\n", "        ", "return", "igrid", "(", "[", "img", ",", "self", "]", ",", "bg", "=", "bg", ")", "\n", "", "def", "right", "(", "self", ",", "img", ",", "bg", "=", "'k'", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.right": [[372, 374], ["twodee_v0.igrid"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.igrid"], ["", "def", "right", "(", "self", ",", "img", ",", "bg", "=", "'k'", ")", ":", "\n", "        ", "return", "igrid", "(", "[", "self", ",", "img", "]", ",", "bg", "=", "bg", ")", "\n", "", "def", "top", "(", "self", ",", "img", ",", "bg", "=", "'k'", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.top": [[374, 376], ["twodee_v0.igrid"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.igrid"], ["", "def", "top", "(", "self", ",", "img", ",", "bg", "=", "'k'", ")", ":", "\n", "        ", "return", "igrid", "(", "[", "[", "img", ",", "]", ",", "[", "self", ",", "]", "]", ",", "bg", "=", "bg", ")", "\n", "", "def", "bottom", "(", "self", ",", "img", ",", "bg", "=", "'k'", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.bottom": [[376, 378], ["twodee_v0.igrid"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.igrid"], ["", "def", "bottom", "(", "self", ",", "img", ",", "bg", "=", "'k'", ")", ":", "\n", "        ", "return", "igrid", "(", "[", "[", "self", ",", "]", ",", "[", "img", ",", "]", "]", ",", "bg", "=", "bg", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rect": [[380, 393], ["twodee_v0.pixel_ij", "twodee_v0.pixel_ij", "max", "twodee_v0.c255", "twodee_v0.c255", "twodee_v0.I.pil().copy", "PIL.ImageDraw.Draw", "PIL.ImageDraw.Draw.rectangle", "twodee_v0.I", "round", "twodee_v0.I.pil"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.c255", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.c255", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil"], ["", "def", "rect", "(", "self", ",", "corner", ",", "size", ",", "w", "=", "1", ",", "c", "=", "'r'", ",", "f", "=", "None", ")", ":", "\n", "        ", "corner", "=", "pixel_ij", "(", "corner", ",", "rounding", "=", "True", ")", "\n", "size", "=", "pixel_ij", "(", "size", ",", "rounding", "=", "True", ")", "\n", "w", "=", "max", "(", "1", ",", "round", "(", "w", ")", ")", "\n", "c", "=", "c255", "(", "c", ")", "\n", "f", "=", "c255", "(", "f", ")", "\n", "ans", "=", "self", ".", "pil", "(", "mode", "=", "'RGBA'", ")", ".", "copy", "(", ")", "\n", "d", "=", "ImageDraw", ".", "Draw", "(", "ans", ")", "\n", "d", ".", "rectangle", "(", "\n", "[", "corner", "[", "1", "]", ",", "corner", "[", "0", "]", ",", "corner", "[", "1", "]", "+", "size", "[", "1", "]", "-", "1", ",", "corner", "[", "0", "]", "+", "size", "[", "0", "]", "-", "1", "]", ",", "\n", "fill", "=", "f", ",", "outline", "=", "c", ",", "width", "=", "w", ",", "\n", ")", "\n", "return", "I", "(", "ans", ")", "\n", "", "def", "bbox", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.bbox": [[393, 395], ["twodee_v0.I.rect"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rect"], ["", "def", "bbox", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "rect", "(", "*", "args", ",", "**", "kwargs", ")", "\n", "", "def", "border", "(", "self", ",", "w", "=", "1", ",", "c", "=", "'r'", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.border": [[395, 400], ["twodee_v0.I.rect"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rect"], ["", "def", "border", "(", "self", ",", "w", "=", "1", ",", "c", "=", "'r'", ")", ":", "\n", "        ", "return", "self", ".", "rect", "(", "\n", "(", "0", ",", "0", ")", ",", "\n", "self", ".", "size", ",", "\n", "w", "=", "w", ",", "c", "=", "c", ",", "f", "=", "None", ",", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.dot": [[401, 411], ["twodee_v0.c255", "twodee_v0.pixel_ij", "twodee_v0.I.pil().copy", "PIL.ImageDraw.Draw", "PIL.ImageDraw.Draw.ellipse", "twodee_v0.I", "twodee_v0.I.pil"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.c255", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil"], ["", "def", "dot", "(", "self", ",", "point", ",", "s", "=", "1", ",", "c", "=", "'r'", ")", ":", "\n", "        ", "c", "=", "c255", "(", "c", ")", "\n", "x", ",", "y", "=", "pixel_ij", "(", "point", ",", "rounding", "=", "False", ")", "\n", "ans", "=", "self", ".", "pil", "(", "mode", "=", "'RGBA'", ")", ".", "copy", "(", ")", "\n", "d", "=", "ImageDraw", ".", "Draw", "(", "ans", ")", "\n", "d", ".", "ellipse", "(", "\n", "[", "(", "y", "-", "s", ",", "x", "-", "s", ")", ",", "(", "y", "+", "s", ",", "x", "+", "s", ")", "]", ",", "\n", "fill", "=", "c", ",", "\n", ")", "\n", "return", "I", "(", "ans", ")", "\n", "", "def", "point", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.point": [[411, 413], ["twodee_v0.I.dot"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.dot"], ["", "def", "point", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "dot", "(", "*", "args", ",", "**", "kwargs", ")", "\n", "", "def", "line", "(", "self", ",", "a", ",", "b", ",", "w", "=", "1", ",", "c", "=", "'r'", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.line": [[413, 422], ["twodee_v0.pixel_ij", "twodee_v0.pixel_ij", "twodee_v0.c255", "max", "twodee_v0.I.pil().copy", "PIL.ImageDraw.Draw", "PIL.ImageDraw.Draw.line", "twodee_v0.I", "round", "twodee_v0.I.pil"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.c255", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.line", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil"], ["", "def", "line", "(", "self", ",", "a", ",", "b", ",", "w", "=", "1", ",", "c", "=", "'r'", ")", ":", "\n", "        ", "a", "=", "pixel_ij", "(", "a", ",", "rounding", "=", "False", ")", "\n", "b", "=", "pixel_ij", "(", "b", ",", "rounding", "=", "False", ")", "\n", "c", "=", "c255", "(", "c", ")", "\n", "w", "=", "max", "(", "1", ",", "round", "(", "w", ")", ")", "\n", "ans", "=", "self", ".", "pil", "(", "mode", "=", "'RGBA'", ")", ".", "copy", "(", ")", "\n", "d", "=", "ImageDraw", ".", "Draw", "(", "ans", ")", "\n", "d", ".", "line", "(", "[", "a", "[", ":", ":", "-", "1", "]", ",", "(", "b", "[", "1", "]", "-", "1", ",", "b", "[", "0", "]", "-", "1", ")", "]", ",", "fill", "=", "c", ",", "width", "=", "w", ")", "\n", "return", "I", "(", "ans", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.text": [[424, 444], ["twodee_v0.itext", "t.pil.pil.pil", "twodee_v0.I.pil", "twodee_v0.I.paste", "twodee_v0.I", "twodee_v0.pixel_ij", "anchor[].lower", "anchor[].lower"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.itext", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij"], ["", "def", "text", "(", "self", ",", "text", ",", "pos", ",", "s", "=", "12", ",", "anchor", "=", "'tl'", ",", "c", "=", "'m'", ",", "bg", "=", "'k'", ",", "spacing", "=", "None", ",", "padding", "=", "0", ")", ":", "\n", "        ", "t", "=", "itext", "(", "\n", "text", ",", "s", "=", "s", ",", "c", "=", "c", ",", "bg", "=", "bg", ",", "\n", "spacing", "=", "spacing", ",", "padding", "=", "padding", ",", "\n", ")", "\n", "x", ",", "y", "=", "pos", "\n", "x", "=", "{", "\n", "'t'", ":", "x", ",", "\n", "'b'", ":", "x", "-", "t", ".", "size", "[", "0", "]", ",", "\n", "'c'", ":", "x", "-", "t", ".", "size", "[", "0", "]", "/", "2", ",", "\n", "}", "[", "anchor", "[", "0", "]", ".", "lower", "(", ")", "]", "\n", "y", "=", "{", "\n", "'l'", ":", "y", ",", "\n", "'r'", ":", "y", "-", "t", ".", "size", "[", "1", "]", ",", "\n", "'c'", ":", "y", "-", "t", ".", "size", "[", "1", "]", "/", "2", ",", "\n", "}", "[", "anchor", "[", "1", "]", ".", "lower", "(", ")", "]", "\n", "t", "=", "t", ".", "pil", "(", "'RGBA'", ")", "\n", "ans", "=", "self", ".", "pil", "(", "'RGBA'", ")", "\n", "ans", ".", "paste", "(", "t", ",", "pixel_ij", "(", "(", "y", ",", "x", ")", ",", "rounding", "=", "True", ")", ",", "t", ")", "\n", "return", "I", "(", "ans", ")", "\n", "", "def", "caption", "(", "self", ",", "text", ",", "s", "=", "24", ",", "pos", "=", "'t'", ",", "c", "=", "'w'", ",", "bg", "=", "'k'", ",", "spacing", "=", "None", ",", "padding", "=", "None", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.caption": [[444, 456], ["pos[].lower", "twodee_v0.itext", "twodee_v0.I.top", "twodee_v0.I.bottom", "twodee_v0.I.left", "twodee_v0.I.right"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.itext", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.top", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.bottom", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.left", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.right"], ["", "def", "caption", "(", "self", ",", "text", ",", "s", "=", "24", ",", "pos", "=", "'t'", ",", "c", "=", "'w'", ",", "bg", "=", "'k'", ",", "spacing", "=", "None", ",", "padding", "=", "None", ")", ":", "\n", "        ", "pos", "=", "pos", "[", "0", "]", ".", "lower", "(", ")", "\n", "t", "=", "itext", "(", "text", ",", "s", "=", "s", ",", "c", "=", "c", ",", "bg", "=", "bg", ",", "spacing", "=", "spacing", ",", "padding", "=", "padding", ")", "\n", "if", "pos", "==", "'t'", ":", "\n", "            ", "return", "self", ".", "top", "(", "t", ")", "\n", "", "elif", "pos", "==", "'b'", ":", "\n", "            ", "return", "self", ".", "bottom", "(", "t", ")", "\n", "", "elif", "pos", "==", "'l'", ":", "\n", "            ", "return", "self", ".", "left", "(", "t", ")", "\n", "", "elif", "pos", "==", "'r'", ":", "\n", "            ", "return", "self", ".", "right", "(", "t", ")", "\n", "", "assert", "0", ",", "'data not understood'", "\n", "", "def", "cap", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.cap": [[456, 458], ["twodee_v0.I.caption"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.caption"], ["", "def", "cap", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "caption", "(", "*", "args", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I._repr_png_": [[460, 464], ["io.BytesIO", "twodee_v0.I.pil().save", "io.BytesIO.getvalue", "twodee_v0.I.pil"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.save", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil"], ["", "def", "_repr_png_", "(", "self", ")", ":", "\n", "        ", "bio", "=", "io", ".", "BytesIO", "(", ")", "\n", "self", ".", "pil", "(", ")", ".", "save", "(", "bio", ",", "'PNG'", ")", "\n", "return", "bio", ".", "getvalue", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.img2uri": [[40, 44], ["io.BytesIO", "img.save", "base64.b64encode", "io.BytesIO.getvalue"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.save"], ["def", "img2uri", "(", "img", ")", ":", "\n", "    ", "bio", "=", "io", ".", "BytesIO", "(", ")", "\n", "img", ".", "save", "(", "bio", ",", "'PNG'", ")", "\n", "return", "base64", ".", "b64encode", "(", "bio", ".", "getvalue", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.uri2img": [[45, 47], ["PIL.Image.open", "io.BytesIO", "base64.b64decode"], "function", ["None"], ["", "def", "uri2img", "(", "uri", ")", ":", "\n", "    ", "return", "Image", ".", "open", "(", "io", ".", "BytesIO", "(", "base64", ".", "b64decode", "(", "uri", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pimg": [[467, 469], ["twodee_v0.I.pil", "twodee_v0.I"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil"], ["", "", "def", "pimg", "(", "x", ")", ":", "\n", "    ", "return", "I", "(", "x", ")", ".", "pil", "(", ")", "\n", "", "def", "nimg", "(", "x", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.nimg": [[469, 471], ["twodee_v0.I.numpy", "twodee_v0.I"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.numpy"], ["", "def", "nimg", "(", "x", ")", ":", "\n", "    ", "return", "I", "(", "x", ")", ".", "numpy", "(", ")", "\n", "", "def", "timg", "(", "x", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.timg": [[471, 473], ["twodee_v0.I.tensor", "twodee_v0.I"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor"], ["", "def", "timg", "(", "x", ")", ":", "\n", "    ", "return", "I", "(", "x", ")", ".", "tensor", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_rounder": [[475, 484], ["round", "math.ceil", "math.floor"], "function", ["None"], ["", "def", "pixel_rounder", "(", "n", ",", "mode", ")", ":", "\n", "    ", "if", "mode", "==", "True", "or", "mode", "==", "'round'", ":", "\n", "        ", "return", "round", "(", "n", ")", "\n", "", "elif", "mode", "==", "'ceil'", ":", "\n", "        ", "return", "math", ".", "ceil", "(", "n", ")", "\n", "", "elif", "mode", "==", "'floor'", ":", "\n", "        ", "return", "math", ".", "floor", "(", "n", ")", "\n", "", "else", ":", "\n", "        ", "return", "n", "\n", "", "", "def", "pixel_ij", "(", "x", ",", "rounding", "=", "True", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij": [[484, 489], ["isinstance", "tuple", "x.tolist.tolist", "twodee_v0.pixel_rounder", "isinstance", "isinstance"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_rounder"], ["", "", "def", "pixel_ij", "(", "x", ",", "rounding", "=", "True", ")", ":", "\n", "    ", "if", "isinstance", "(", "x", ",", "np", ".", "ndarray", ")", ":", "\n", "        ", "x", "=", "x", ".", "tolist", "(", ")", "\n", "", "return", "tuple", "(", "pixel_rounder", "(", "i", ",", "rounding", ")", "for", "i", "in", "(", "\n", "x", "if", "isinstance", "(", "x", ",", "tuple", ")", "or", "isinstance", "(", "x", ",", "list", ")", "else", "(", "x", ",", "x", ")", "\n", ")", ")", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.diam": [[490, 498], ["np.sqrt", "isinstance", "isinstance", "isinstance"], "function", ["None"], ["", "def", "diam", "(", "x", ")", ":", "\n", "    ", "if", "isinstance", "(", "x", ",", "tuple", ")", "or", "isinstance", "(", "x", ",", "list", ")", ":", "\n", "        ", "h", ",", "w", "=", "x", "[", "-", "2", ":", "]", "\n", "", "elif", "isinstance", "(", "x", ",", "I", ")", ":", "\n", "        ", "h", ",", "w", "=", "x", ".", "size", "\n", "", "else", ":", "\n", "        ", "h", ",", "w", "=", "x", ".", "shape", "[", "-", "2", ":", "]", "\n", "", "return", "np", ".", "sqrt", "(", "h", "**", "2", "+", "w", "**", "2", ")", "\n", "", "def", "rescale", "(", "x", ",", "factor", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.rescale": [[498, 500], ["x.rescale"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.rescale"], ["", "def", "rescale", "(", "x", ",", "factor", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n", "    ", "return", "x", ".", "rescale", "(", "factor", ",", "resample", "=", "resample", ",", "antialias", "=", "antialias", ")", "\n", "", "def", "rescale_dry", "(", "x", ",", "factor", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.rescale_dry": [[500, 503], ["isinstance", "isinstance", "twodee_v0.I"], "function", ["None"], ["", "def", "rescale_dry", "(", "x", ",", "factor", ")", ":", "\n", "    ", "h", ",", "w", "=", "x", "[", "-", "2", ":", "]", "if", "isinstance", "(", "x", ",", "tuple", ")", "or", "isinstance", "(", "x", ",", "list", ")", "else", "I", "(", "x", ")", ".", "size", "\n", "return", "(", "h", "*", "factor", ",", "w", "*", "factor", ")", "\n", "", "def", "resize_max", "(", "x", ",", "s", "=", "512", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_max": [[503, 505], ["twodee_v0.I.resize_max", "twodee_v0.I"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_max"], ["", "def", "resize_max", "(", "x", ",", "s", "=", "512", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n", "    ", "return", "I", "(", "x", ")", ".", "resize_max", "(", "s", "=", "s", ",", "resample", "=", "resample", ",", "antialias", "=", "antialias", ")", "\n", "", "def", "resize_max_dry", "(", "x", ",", "s", "=", "512", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_max_dry": [[505, 512], ["isinstance", "isinstance", "twodee_v0.I", "int", "int"], "function", ["None"], ["", "def", "resize_max_dry", "(", "x", ",", "s", "=", "512", ")", ":", "\n", "# returns size", "\n", "    ", "h", ",", "w", "=", "x", "[", "-", "2", ":", "]", "if", "isinstance", "(", "x", ",", "tuple", ")", "or", "isinstance", "(", "x", ",", "list", ")", "else", "I", "(", "x", ")", ".", "size", "\n", "return", "(", "\n", "(", "s", ",", "int", "(", "w", "*", "s", "/", "h", ")", ")", ",", "\n", "(", "int", "(", "h", "*", "s", "/", "w", ")", ",", "s", ")", ",", "\n", ")", "[", "h", "<", "w", "]", "\n", "", "def", "resize_min", "(", "x", ",", "s", "=", "512", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_min": [[512, 514], ["twodee_v0.I.resize_min", "twodee_v0.I"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_min"], ["", "def", "resize_min", "(", "x", ",", "s", "=", "512", ",", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ")", ":", "\n", "    ", "return", "I", "(", "x", ")", ".", "resize_min", "(", "s", "=", "s", ",", "resample", "=", "resample", ",", "antialias", "=", "antialias", ")", "\n", "", "def", "resize_min_dry", "(", "x", ",", "s", "=", "512", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_min_dry": [[514, 521], ["isinstance", "isinstance", "twodee_v0.I", "int", "int"], "function", ["None"], ["", "def", "resize_min_dry", "(", "x", ",", "s", "=", "512", ")", ":", "\n", "# returns size", "\n", "    ", "h", ",", "w", "=", "x", "[", "-", "2", ":", "]", "if", "isinstance", "(", "x", ",", "tuple", ")", "or", "isinstance", "(", "x", ",", "list", ")", "else", "I", "(", "x", ")", ".", "size", "\n", "return", "(", "\n", "(", "s", ",", "int", "(", "w", "*", "s", "/", "h", ")", ")", ",", "\n", "(", "int", "(", "h", "*", "s", "/", "w", ")", ",", "s", ")", ",", "\n", ")", "[", "w", "<", "h", "]", "\n", "", "def", "resize_square", "(", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_square": [[521, 529], ["twodee_v0.I.resize_square", "twodee_v0.I"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_square"], ["", "def", "resize_square", "(", "\n", "x", ",", "s", "=", "512", ",", "\n", "resample", "=", "'bilinear'", ",", "antialias", "=", "False", ",", "\n", "fill", "=", "0", ",", "padding_mode", "=", "'constant'", ",", "\n", ")", ":", "\n", "    ", "return", "I", "(", "x", ")", ".", "resize_square", "(", "\n", "s", "=", "s", ",", "resample", "=", "resample", ",", "antialias", "=", "antialias", ",", "\n", "fill", "=", "fill", ",", "padding_mode", "=", "padding_mode", ",", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_square_dry": [[530, 540], ["isinstance", "isinstance", "twodee_v0.I", "max"], "function", ["None"], ["", "def", "resize_square_dry", "(", "x", ",", "s", "=", "512", ")", ":", "\n", "# returns a forward cropbox", "\n", "    ", "h", ",", "w", "=", "x", "[", "-", "2", ":", "]", "if", "isinstance", "(", "x", ",", "tuple", ")", "or", "isinstance", "(", "x", ",", "list", ")", "else", "I", "(", "x", ")", ".", "size", "\n", "from_corner", "=", "(", "\n", "(", "0", ",", "-", "(", "h", "-", "w", ")", "//", "2", ")", ",", "\n", "(", "-", "(", "w", "-", "h", ")", "//", "2", ",", "0", ")", ",", "\n", ")", "[", "h", "<", "w", "]", "\n", "from_size", "=", "(", "max", "(", "h", ",", "w", ")", ",", ")", "*", "2", "\n", "to_size", "=", "(", "s", ",", "s", ")", "\n", "return", "(", "from_corner", ",", "from_size", ",", "to_size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox": [[542, 545], ["twodee_v0.I.cropbox", "twodee_v0.I"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox"], ["", "def", "cropbox", "(", "x", ",", "from_corner", ",", "from_size", ",", "to_size", "=", "None", ",", "resample", "=", "'bilinear'", ")", ":", "\n", "    ", "return", "I", "(", "x", ")", ".", "cropbox", "(", "\n", "from_corner", ",", "from_size", ",", "to_size", ",", "resample", "=", "resample", ",", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_compose": [[546, 556], ["twodee_v0.pixel_ij", "twodee_v0.pixel_ij"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij"], ["", "def", "cropbox_compose", "(", "cba", ",", "cbb", ")", ":", "\n", "# compose two cropboxes", "\n", "    ", "fca", ",", "fsa", ",", "tsa", "=", "[", "pixel_ij", "(", "q", ",", "rounding", "=", "False", ")", "for", "q", "in", "cba", "]", "\n", "fcb", ",", "fsb", ",", "tsb", "=", "[", "pixel_ij", "(", "q", ",", "rounding", "=", "False", ")", "for", "q", "in", "cbb", "]", "\n", "sfx", "=", "fsa", "[", "0", "]", "/", "tsa", "[", "0", "]", "\n", "sfy", "=", "fsa", "[", "1", "]", "/", "tsa", "[", "1", "]", "\n", "fc", "=", "fca", "[", "0", "]", "+", "fcb", "[", "0", "]", "*", "sfx", ",", "fca", "[", "1", "]", "+", "fcb", "[", "1", "]", "*", "sfy", "\n", "fs", "=", "fsb", "[", "0", "]", "*", "sfx", ",", "fsb", "[", "1", "]", "*", "sfy", "\n", "ts", "=", "tsb", "\n", "return", "fc", ",", "fs", ",", "ts", "\n", "", "def", "cropbox_sequence", "(", "cropboxes", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_sequence": [[556, 563], ["range", "twodee_v0.cropbox_compose", "len"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_compose"], ["", "def", "cropbox_sequence", "(", "cropboxes", ")", ":", "\n", "# compose multiple cropboxes in sequence", "\n", "    ", "ans", "=", "cropboxes", "[", "-", "1", "]", "\n", "for", "c", "in", "range", "(", "len", "(", "cropboxes", ")", "-", "2", ",", "-", "1", ",", "-", "1", ")", ":", "\n", "        ", "cb", "=", "cropboxes", "[", "c", "]", "\n", "ans", "=", "cropbox_compose", "(", "cb", ",", "ans", ")", "\n", "", "return", "ans", "\n", "", "def", "cropbox_points", "(", "pts", ",", "from_corner", ",", "from_size", ",", "to_size", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_points": [[563, 573], ["np.asarray", "twodee_v0.pixel_ij", "twodee_v0.pixel_ij", "twodee_v0.pixel_ij", "np.asarray", "np.asarray", "len"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij"], ["", "def", "cropbox_points", "(", "pts", ",", "from_corner", ",", "from_size", ",", "to_size", ")", ":", "\n", "# apply cropbox to points", "\n", "    ", "pts", "=", "np", ".", "asarray", "(", "pts", ")", "\n", "assert", "len", "(", "pts", ".", "shape", ")", "==", "2", "and", "pts", ".", "shape", "[", "1", "]", "==", "2", "\n", "fc", "=", "pixel_ij", "(", "from_corner", ",", "rounding", "=", "False", ")", "\n", "fs", "=", "pixel_ij", "(", "from_size", ",", "rounding", "=", "False", ")", "\n", "ts", "=", "pixel_ij", "(", "to_size", ",", "rounding", "=", "False", ")", "\n", "fc", "=", "np", ".", "asarray", "(", "fc", ")", "[", "None", ",", "]", "\n", "sf", "=", "np", ".", "asarray", "(", "[", "ts", "[", "0", "]", "/", "fs", "[", "0", "]", ",", "ts", "[", "1", "]", "/", "fs", "[", "1", "]", "]", ")", "[", "None", ",", "]", "\n", "return", "(", "pts", "-", "fc", ")", "*", "sf", "\n", "", "def", "cropbox_bbox", "(", "bbox", ",", "from_corner", ",", "from_size", ",", "to_size", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_bbox": [[573, 583], ["twodee_v0.cropbox_points", "float", "float", "float", "float"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_points"], ["", "def", "cropbox_bbox", "(", "bbox", ",", "from_corner", ",", "from_size", ",", "to_size", ")", ":", "\n", "# apply cropbox to bbox", "\n", "    ", "pts", "=", "[", "\n", "bbox", "[", "0", "]", ",", "\n", "(", "bbox", "[", "1", "]", "[", "0", "]", "+", "bbox", "[", "0", "]", "[", "0", "]", ",", "bbox", "[", "1", "]", "[", "1", "]", "+", "bbox", "[", "0", "]", "[", "1", "]", ")", ",", "\n", "]", "\n", "ans", "=", "cropbox_points", "(", "pts", ",", "from_corner", ",", "from_size", ",", "to_size", ")", "\n", "return", "[", "\n", "(", "float", "(", "ans", "[", "0", ",", "0", "]", ")", ",", "float", "(", "ans", "[", "0", ",", "1", "]", ")", ")", ",", "\n", "(", "float", "(", "ans", "[", "1", ",", "0", "]", "-", "ans", "[", "0", ",", "0", "]", ")", ",", "float", "(", "ans", "[", "1", ",", "1", "]", "-", "ans", "[", "0", ",", "1", "]", ")", ")", ",", "\n", "]", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_inverse": [[584, 596], ["twodee_v0.pixel_ij", "twodee_v0.pixel_ij", "twodee_v0.pixel_ij", "twodee_v0.pixel_ij"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij"], ["", "def", "cropbox_inverse", "(", "origin_size", ",", "from_corner", ",", "from_size", ",", "to_size", ")", ":", "\n", "# origin_size: original image size", "\n", "# from_corner/from_size/to_size: of cropbox to invert", "\n", "    ", "origin_size", "=", "pixel_ij", "(", "origin_size", ",", "rounding", "=", "False", ")", "\n", "from_corner", "=", "pixel_ij", "(", "from_corner", ",", "rounding", "=", "False", ")", "\n", "from_size", "=", "pixel_ij", "(", "from_size", ",", "rounding", "=", "False", ")", "\n", "to_size", "=", "pixel_ij", "(", "to_size", ",", "rounding", "=", "False", ")", "\n", "sx", ",", "sy", "=", "to_size", "[", "0", "]", "/", "from_size", "[", "0", "]", ",", "to_size", "[", "1", "]", "/", "from_size", "[", "1", "]", "\n", "return", "[", "\n", "(", "-", "from_corner", "[", "0", "]", "*", "sx", ",", "-", "from_corner", "[", "1", "]", "*", "sy", ")", ",", "\n", "(", "origin_size", "[", "0", "]", "*", "sx", ",", "origin_size", "[", "1", "]", "*", "sy", ")", ",", "\n", "origin_size", ",", "\n", "]", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_bbox_square": [[597, 606], ["twodee_v0.cropbox_sequence", "twodee_v0.resize_square_dry"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_sequence", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.resize_square_dry"], ["", "def", "cropbox_bbox_square", "(", "bbox", ",", "s", "=", "512", ",", "padding", "=", "0", ")", ":", "\n", "# focuses + zooms out", "\n", "# padding is additional to s", "\n", "    ", "pd", "=", "padding", "\n", "fins", "=", "s", "+", "2", "*", "padding", "\n", "return", "cropbox_sequence", "(", "[", "\n", "[", "bbox", "[", "0", "]", ",", "bbox", "[", "1", "]", ",", "bbox", "[", "1", "]", "]", ",", "\n", "resize_square_dry", "(", "bbox", "[", "1", "]", ",", "s", "=", "s", ")", ",", "\n", "[", "(", "-", "pd", ",", "-", "pd", ")", ",", "(", "fins", ",", "fins", ")", ",", "(", "fins", ",", "fins", ")", "]", ",", "\n", "]", ")", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_borders": [[607, 617], ["twodee_v0.pixel_ij", "twodee_v0.pixel_ij", "twodee_v0.pixel_ij"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij"], ["", "def", "cropbox_borders", "(", "from_size", ",", "top_bottom", ",", "left_right", ")", ":", "\n", "# returns cropbox that removes borders", "\n", "# from_size: size of image to crop", "\n", "    ", "h", ",", "w", "=", "pixel_ij", "(", "from_size", ",", "rounding", "=", "False", ")", "\n", "t", ",", "b", "=", "pixel_ij", "(", "top_bottom", ",", "rounding", "=", "False", ")", "\n", "l", ",", "r", "=", "pixel_ij", "(", "left_right", ",", "rounding", "=", "False", ")", "\n", "return", "[", "\n", "(", "t", ",", "l", ")", ",", "# from_corner", "\n", "(", "h", "-", "t", "-", "b", ",", "w", "-", "l", "-", "r", ")", ",", "# from_size", "\n", "(", "h", "-", "t", "-", "b", ",", "w", "-", "l", "-", "r", ")", ",", "# to_size", "\n", "]", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_resize": [[618, 624], ["twodee_v0.pixel_ij", "twodee_v0.pixel_ij"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij"], ["", "def", "cropbox_resize", "(", "from_size", ",", "to_size", ")", ":", "\n", "# dummy forward cropbox of resize operation", "\n", "    ", "return", "[", "\n", "(", "0", ",", "0", ")", ",", "# from_corner", "\n", "pixel_ij", "(", "from_size", ",", "rounding", "=", "False", ")", ",", "# from_size", "\n", "pixel_ij", "(", "to_size", ",", "rounding", "=", "False", ")", ",", "# to_size", "\n", "]", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.cropbox_to_mask": [[625, 641], ["twodee_v0.pixel_ij", "np.zeros", "twodee_v0.pixel_ij", "twodee_v0.pixel_ij", "twodee_v0.pixel_ij", "twodee_v0.pixel_ij", "max", "min", "max", "min", "max", "min", "max", "min", "math.ceil", "math.floor", "math.ceil", "math.floor"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij"], ["", "def", "cropbox_to_mask", "(", "origin_size", ",", "from_corner", ",", "from_size", ",", "conservative", "=", "True", ")", ":", "\n", "    ", "s", "=", "pixel_ij", "(", "origin_size", ",", "rounding", "=", "True", ")", "\n", "if", "conservative", ":", "\n", "# smaller active area, do rounding myself", "\n", "        ", "x", ",", "y", "=", "pixel_ij", "(", "from_corner", ",", "rounding", "=", "False", ")", "\n", "h", ",", "w", "=", "pixel_ij", "(", "from_size", ",", "rounding", "=", "False", ")", "\n", "t", ",", "b", "=", "max", "(", "0", ",", "math", ".", "ceil", "(", "x", ")", ")", ",", "min", "(", "math", ".", "floor", "(", "x", "+", "h", ")", ",", "s", "[", "0", "]", ")", "\n", "l", ",", "r", "=", "max", "(", "0", ",", "math", ".", "ceil", "(", "y", ")", ")", ",", "min", "(", "math", ".", "floor", "(", "y", "+", "w", ")", ",", "s", "[", "1", "]", ")", "\n", "", "else", ":", "\n", "        ", "x", ",", "y", "=", "pixel_ij", "(", "from_corner", ",", "rounding", "=", "True", ")", "\n", "h", ",", "w", "=", "pixel_ij", "(", "from_size", ",", "rounding", "=", "True", ")", "\n", "t", ",", "b", "=", "max", "(", "0", ",", "x", ")", ",", "min", "(", "x", "+", "h", ",", "s", "[", "0", "]", ")", "\n", "l", ",", "r", "=", "max", "(", "0", ",", "y", ")", ",", "min", "(", "y", "+", "w", ",", "s", "[", "1", "]", ")", "\n", "", "ans", "=", "np", ".", "zeros", "(", "s", ")", "\n", "ans", "[", "t", ":", "b", ",", "l", ":", "r", "]", "=", "1", "\n", "return", "ans", "[", "None", ",", "]", "\n", "", "def", "bbox_lim", "(", "bbox", ",", "xlim", "=", "None", ",", "ylim", "=", "None", ",", "blim", "=", "None", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.bbox_lim": [[641, 668], ["twodee_v0.bbox_lim", "np.clip", "np.clip", "np.clip", "np.clip", "isinstance", "isinstance", "isinstance", "isinstance"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.bbox_lim"], ["", "def", "bbox_lim", "(", "bbox", ",", "xlim", "=", "None", ",", "ylim", "=", "None", ",", "blim", "=", "None", ")", ":", "\n", "# box limits", "\n", "    ", "if", "blim", "is", "not", "None", ":", "\n", "        ", "assert", "xlim", "is", "None", "and", "ylim", "is", "None", "\n", "(", "x", ",", "y", ")", ",", "(", "h", ",", "w", ")", "=", "blim", "\n", "return", "bbox_lim", "(", "bbox", ",", "xlim", "=", "(", "x", ",", "x", "+", "h", ")", ",", "ylim", "=", "(", "y", ",", "y", "+", "w", ")", ")", "\n", "\n", "# x or y-range limits", "\n", "", "else", ":", "\n", "        ", "assert", "xlim", "is", "not", "None", "or", "ylim", "is", "not", "None", "\n", "(", "a", ",", "b", ")", ",", "(", "h", ",", "w", ")", "=", "bbox", "\n", "u", ",", "v", "=", "a", "+", "h", ",", "b", "+", "w", "\n", "if", "xlim", "is", "not", "None", ":", "\n", "            ", "if", "isinstance", "(", "xlim", ",", "tuple", ")", "or", "isinstance", "(", "xlim", ",", "list", ")", ":", "\n", "                ", "x0", ",", "x1", "=", "xlim", "\n", "", "else", ":", "\n", "                ", "x0", "=", "x1", "=", "xlim", "\n", "", "a", "=", "np", ".", "clip", "(", "a", ",", "a_min", "=", "x0", ",", "a_max", "=", "x1", ")", "\n", "u", "=", "np", ".", "clip", "(", "u", ",", "a_min", "=", "x0", ",", "a_max", "=", "x1", ")", "\n", "", "if", "ylim", "is", "not", "None", ":", "\n", "            ", "if", "isinstance", "(", "ylim", ",", "tuple", ")", "or", "isinstance", "(", "ylim", ",", "list", ")", ":", "\n", "                ", "y0", ",", "y1", "=", "ylim", "\n", "", "else", ":", "\n", "                ", "y0", "=", "y1", "=", "ylim", "\n", "", "b", "=", "np", ".", "clip", "(", "b", ",", "a_min", "=", "y0", ",", "a_max", "=", "y1", ")", "\n", "v", "=", "np", ".", "clip", "(", "v", ",", "a_min", "=", "y0", ",", "a_max", "=", "y1", ")", "\n", "", "return", "(", "a", ",", "b", ")", ",", "(", "u", "-", "a", ",", "v", "-", "b", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.c255": [[670, 696], ["isinstance", "isinstance", "isinstance", "tuple", "int", "len", "len", "int"], "function", ["None"], ["", "", "def", "c255", "(", "c", ")", ":", "\n", "# color format utility", "\n", "    ", "if", "c", "is", "None", ":", "\n", "        ", "return", "None", "\n", "", "if", "isinstance", "(", "c", ",", "str", ")", ":", "\n", "        ", "c", "=", "{", "\n", "'r'", ":", "(", "1", ",", "0", ",", "0", ")", ",", "\n", "'g'", ":", "(", "0", ",", "1", ",", "0", ")", ",", "\n", "'b'", ":", "(", "0", ",", "0", ",", "1", ")", ",", "\n", "'k'", ":", "0", ",", "\n", "'w'", ":", "1", ",", "\n", "'t'", ":", "(", "0", ",", "1", ",", "1", ")", ",", "\n", "'m'", ":", "(", "1", ",", "0", ",", "1", ")", ",", "\n", "'y'", ":", "(", "1", ",", "1", ",", "0", ")", ",", "\n", "'a'", ":", "(", "0", ",", "0", ",", "0", ",", "0", ")", ",", "\n", "}", "[", "c", "]", "\n", "", "if", "isinstance", "(", "c", ",", "list", ")", "or", "isinstance", "(", "c", ",", "tuple", ")", ":", "\n", "        ", "if", "len", "(", "c", ")", "==", "3", ":", "\n", "            ", "c", "=", "c", "+", "(", "1", ",", ")", "\n", "", "elif", "len", "(", "c", ")", "==", "1", ":", "\n", "            ", "c", "=", "(", "c", ",", "c", ",", "c", ",", "1", ")", "\n", "", "c", "=", "tuple", "(", "int", "(", "255", "*", "q", ")", "for", "q", "in", "c", ")", "\n", "", "else", ":", "\n", "        ", "c", "=", "int", "(", "255", "*", "c", ")", "\n", "c", "=", "(", "c", ",", "c", ",", "c", ",", "255", ")", "\n", "", "return", "c", "\n", "", "def", "ucolors", "(", "num_colors", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.ucolors": [[696, 705], ["np.arange", "colors.append", "colorsys.hls_to_rgb", "np.random.rand", "np.random.rand"], "function", ["None"], ["", "def", "ucolors", "(", "num_colors", ")", ":", "\n", "# uniform color generator", "\n", "    ", "colors", "=", "[", "]", "\n", "for", "i", "in", "np", ".", "arange", "(", "0.", ",", "360.", ",", "360.", "/", "num_colors", ")", ":", "\n", "        ", "hue", "=", "i", "/", "360.", "\n", "lightness", "=", "(", "50", "+", "np", ".", "random", ".", "rand", "(", ")", "*", "10", ")", "/", "100.", "\n", "saturation", "=", "(", "90", "+", "np", ".", "random", ".", "rand", "(", ")", "*", "10", ")", "/", "100.", "\n", "colors", ".", "append", "(", "colorsys", ".", "hls_to_rgb", "(", "hue", ",", "lightness", ",", "saturation", ")", ")", "\n", "", "return", "colors", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.iblank": [[707, 715], ["twodee_v0.pixel_ij", "twodee_v0.c255", "twodee_v0.I.resize", "max", "twodee_v0.I", "PIL.Image.fromarray", "np.asarray"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_ij", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.c255", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.resize"], ["", "def", "iblank", "(", "size", ",", "c", "=", "(", "0", ",", "0", ",", "0", ",", "1", ")", ")", ":", "\n", "    ", "size", "=", "pixel_ij", "(", "size", ",", "rounding", "=", "True", ")", "\n", "assert", "max", "(", "size", ")", "<", "4098", "*", "2", "\n", "if", "c", "is", "None", ":", "c", "=", "'a'", "\n", "c", "=", "c255", "(", "c", ")", "\n", "return", "I", "(", "Image", ".", "fromarray", "(", "\n", "np", ".", "asarray", "(", "c", ",", "dtype", "=", "np", ".", "uint8", ")", "[", "None", ",", "None", "]", "\n", ")", ")", ".", "resize", "(", "size", ",", "resample", "=", "'nearest'", ")", "\n", "", "def", "alpha_composite", "(", "a", ",", "b", ",", "opacity", "=", "1.0", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.alpha_composite": [[715, 717], ["twodee_v0.I.alpha_composite", "twodee_v0.I"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.alpha_composite"], ["", "def", "alpha_composite", "(", "a", ",", "b", ",", "opacity", "=", "1.0", ")", ":", "\n", "    ", "return", "I", "(", "a", ")", ".", "alpha_composite", "(", "b", ",", "opacity", "=", "opacity", ")", "\n", "", "def", "alpha_bg", "(", "x", ",", "c", "=", "0.5", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.alpha_bg": [[717, 719], ["twodee_v0.I.alpha_bg", "twodee_v0.I"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.alpha_bg"], ["", "def", "alpha_bg", "(", "x", ",", "c", "=", "0.5", ")", ":", "\n", "    ", "return", "I", "(", "x", ")", ".", "alpha_bg", "(", "c", "=", "c", ")", "\n", "", "def", "alpha_bbox", "(", "img", ",", "thresh", "=", "0.5", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.alpha_bbox": [[719, 733], ["img.np", "len", "np.max", "np.max", "np.where", "np.where", "len", "whx.min", "len", "why.min", "whx.max", "why.max"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.np"], ["", "def", "alpha_bbox", "(", "img", ",", "thresh", "=", "0.5", ")", ":", "\n", "    ", "h", ",", "w", "=", "img", ".", "size", "\n", "rgba", "=", "img", ".", "np", "(", ")", "\n", "assert", "len", "(", "rgba", ")", "in", "[", "1", ",", "4", "]", "\n", "a", "=", "rgba", "[", "-", "1", "]", "\n", "x", "=", "np", ".", "max", "(", "a", ",", "axis", "=", "1", ")", ">", "thresh", "\n", "y", "=", "np", ".", "max", "(", "a", ",", "axis", "=", "0", ")", ">", "thresh", "\n", "whx", "=", "np", ".", "where", "(", "x", ")", "[", "0", "]", "\n", "why", "=", "np", ".", "where", "(", "y", ")", "[", "0", "]", "\n", "x0", ",", "x1", "=", "(", "whx", ".", "min", "(", ")", ",", "whx", ".", "max", "(", ")", "+", "1", ")", "if", "len", "(", "whx", ")", ">", "0", "else", "(", "0", ",", "h", ")", "\n", "y0", ",", "y1", "=", "(", "why", ".", "min", "(", ")", ",", "why", ".", "max", "(", ")", "+", "1", ")", "if", "len", "(", "why", ")", ">", "0", "else", "(", "0", ",", "w", ")", "\n", "fc", "=", "x0", ",", "y0", "\n", "s", "=", "x1", "-", "x0", ",", "y1", "-", "y0", "\n", "return", "fc", ",", "s", "\n", "", "def", "igrid", "(", "imgs", ",", "just", "=", "True", ",", "bg", "=", "'k'", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.igrid": [[733, 777], ["isinstance", "any", "len", "max", "np.zeros", "np.zeros", "range", "np.cumsum", "PIL.Image.new", "range", "twodee_v0.I.alpha_bg", "range", "np.max", "[].repeat", "np.cumsum", "range", "isinstance", "len", "int", "int", "twodee_v0.I", "isinstance", "len", "row.append", "twodee_v0.I", "np.cumsum.max", "I().alpha_bg.paste", "np.cumsum", "twodee_v0.I.pil", "np.max", "int", "int"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.alpha_bg", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.pil"], ["", "def", "igrid", "(", "imgs", ",", "just", "=", "True", ",", "bg", "=", "'k'", ")", ":", "\n", "# repackage", "\n", "    ", "assert", "isinstance", "(", "imgs", ",", "list", ")", "\n", "if", "any", "(", "isinstance", "(", "i", ",", "list", ")", "for", "i", "in", "imgs", ")", ":", "\n", "        ", "x", "=", "[", "\n", "[", "j", "for", "j", "in", "i", "]", "if", "isinstance", "(", "i", ",", "list", ")", "else", "[", "i", ",", "]", "\n", "for", "i", "in", "imgs", "\n", "]", "\n", "", "else", ":", "\n", "        ", "x", "=", "[", "[", "i", "for", "i", "in", "imgs", "]", ",", "]", "\n", "\n", "# get sizes", "\n", "", "nrows", "=", "len", "(", "x", ")", "\n", "ncols", "=", "max", "(", "len", "(", "row", ")", "for", "row", "in", "x", ")", "\n", "hs", "=", "np", ".", "zeros", "(", "(", "nrows", ",", "ncols", ")", ")", "\n", "ws", "=", "np", ".", "zeros", "(", "(", "nrows", ",", "ncols", ")", ")", "\n", "for", "r", "in", "range", "(", "nrows", ")", ":", "\n", "        ", "row", "=", "x", "[", "r", "]", "\n", "for", "c", "in", "range", "(", "ncols", ")", ":", "\n", "            ", "if", "c", "==", "len", "(", "row", ")", ":", "row", ".", "append", "(", "None", ")", "\n", "item", "=", "row", "[", "c", "]", "\n", "if", "item", "is", "None", ":", "\n", "                ", "hs", "[", "r", ",", "c", "]", "=", "ws", "[", "r", ",", "c", "]", "=", "0", "\n", "", "else", ":", "\n", "                ", "item", "=", "I", "(", "item", ")", "\n", "hs", "[", "r", ",", "c", "]", ",", "ws", "[", "r", ",", "c", "]", "=", "item", ".", "size", "\n", "", "row", "[", "c", "]", "=", "item", "\n", "", "", "offx", "=", "np", ".", "cumsum", "(", "np", ".", "max", "(", "hs", ",", "axis", "=", "1", ")", ")", "\n", "if", "just", ":", "\n", "        ", "offy", "=", "np", ".", "cumsum", "(", "np", ".", "max", "(", "ws", ",", "axis", "=", "0", ")", ")", "[", "None", ",", "...", "]", ".", "repeat", "(", "nrows", ",", "0", ")", "\n", "", "else", ":", "\n", "        ", "offy", "=", "np", ".", "cumsum", "(", "ws", ",", "axis", "=", "1", ")", "\n", "\n", "# composite", "\n", "", "ans", "=", "Image", ".", "new", "(", "'RGBA'", ",", "(", "int", "(", "offy", ".", "max", "(", ")", ")", ",", "int", "(", "offx", "[", "-", "1", "]", ")", ")", ")", "\n", "for", "r", "in", "range", "(", "nrows", ")", ":", "\n", "        ", "for", "c", "in", "range", "(", "ncols", ")", ":", "\n", "            ", "item", "=", "x", "[", "r", "]", "[", "c", "]", "\n", "if", "item", "is", "not", "None", ":", "\n", "                ", "ox", "=", "offx", "[", "r", "-", "1", "]", "if", "r", ">", "0", "else", "0", "\n", "oy", "=", "offy", "[", "r", ",", "c", "-", "1", "]", "if", "c", ">", "0", "else", "0", "\n", "ans", ".", "paste", "(", "item", ".", "pil", "(", "mode", "=", "'RGBA'", ")", ",", "(", "int", "(", "oy", ")", ",", "int", "(", "ox", ")", ")", ")", "\n", "", "", "", "ans", "=", "I", "(", "ans", ")", ".", "alpha_bg", "(", "bg", ")", "\n", "return", "ans", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.itext": [[784, 867], ["str", "max", "facing.lower.lower", "PIL.ImageFont.truetype", "PIL.ImageDraw.Draw", "PIL.ImageDraw.Draw.multiline_textsize", "pos.lower.lower", "PIL.Image.new", "PIL.ImageDraw.Draw", "PIL.ImageDraw.Draw.multiline_text", "twodee_v0.I", "round", "math.ceil", "math.ceil", "twodee_v0.c255", "twodee_v0.c255", "PIL.Image.new", "ans.rotate.rotate", "ans.rotate.rotate", "ans.rotate.rotate"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.c255", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.c255", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rotate", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rotate", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.rotate"], ["", "def", "itext", "(", "\n", "text", ",", "\n", "s", "=", "24", ",", "\n", "facing", "=", "'right'", ",", "# write in this direction", "\n", "pos", "=", "'left'", ",", "# align to this position", "\n", "c", "=", "'w'", ",", "\n", "bg", "=", "'k'", ",", "\n", "h", "=", "None", ",", "\n", "w", "=", "None", ",", "\n", "spacing", "=", "None", ",", "# between lines", "\n", "padding", "=", "None", ",", "# around entire thing", "\n", "force_size", "=", "False", ",", "\n", ")", ":", "\n", "# text image utility", "\n", "    ", "text", "=", "str", "(", "text", ")", "\n", "s", "=", "max", "(", "1", ",", "round", "(", "s", ")", ")", "\n", "spacing", "=", "math", ".", "ceil", "(", "s", "*", "4", "/", "10", ")", "if", "spacing", "is", "None", "else", "spacing", "\n", "padding", "=", "math", ".", "ceil", "(", "s", "*", "4", "/", "10", ")", "if", "padding", "is", "None", "else", "padding", "\n", "facing", "=", "facing", ".", "lower", "(", ")", "\n", "if", "facing", "in", "[", "'u'", ",", "'up'", ",", "'d'", ",", "'down'", "]", ":", "\n", "        ", "h", ",", "w", "=", "w", ",", "h", "\n", "", "c", ",", "bg", "=", "c255", "(", "c", ")", ",", "c255", "(", "bg", ")", "\n", "f", "=", "PIL", ".", "ImageFont", ".", "truetype", "(", "FN_ARIAL", ",", "s", ")", "\n", "\n", "td", "=", "PIL", ".", "ImageDraw", ".", "Draw", "(", "Image", ".", "new", "(", "'RGBA'", ",", "(", "1", ",", "1", ")", ",", "(", "0", ",", "0", ",", "0", ",", "0", ")", ")", ")", "\n", "tw", ",", "th", "=", "td", ".", "multiline_textsize", "(", "text", ",", "font", "=", "f", ",", "spacing", "=", "spacing", ")", "\n", "if", "not", "force_size", ":", "\n", "        ", "if", "h", "and", "h", "<", "th", ":", "h", "=", "th", "\n", "if", "w", "and", "w", "<", "tw", ":", "w", "=", "tw", "\n", "", "h", "=", "h", "or", "th", "+", "2", "*", "padding", "\n", "w", "=", "w", "or", "tw", "+", "2", "*", "padding", "\n", "\n", "pos", "=", "pos", ".", "lower", "(", ")", "\n", "an", "=", "None", "\n", "if", "pos", "in", "[", "'c'", ",", "'center'", "]", ":", "\n", "        ", "xy", "=", "(", "w", "//", "2", ",", "h", "//", "2", ")", "\n", "an", "=", "'mm'", "\n", "align", "=", "'center'", "\n", "", "elif", "pos", "in", "[", "'l'", ",", "'lc'", ",", "'cl'", ",", "'left'", "]", ":", "\n", "        ", "xy", "=", "(", "padding", ",", "h", "//", "2", ")", "\n", "an", "=", "'lm'", "\n", "align", "=", "'left'", "\n", "", "elif", "pos", "in", "[", "'r'", ",", "'rc'", ",", "'cr'", ",", "'right'", "]", ":", "\n", "        ", "xy", "=", "(", "w", "-", "padding", ",", "h", "//", "2", ")", "\n", "an", "=", "'rm'", "\n", "align", "=", "'right'", "\n", "", "elif", "pos", "in", "[", "'t'", ",", "'tc'", ",", "'ct'", ",", "'top'", "]", ":", "\n", "        ", "xy", "=", "(", "w", "//", "2", ",", "padding", ")", "\n", "an", "=", "'ma'", "\n", "align", "=", "'center'", "\n", "", "elif", "pos", "in", "[", "'b'", ",", "'bc'", ",", "'cb'", ",", "'bottom'", "]", ":", "\n", "        ", "xy", "=", "(", "w", "//", "2", ",", "h", "-", "padding", ")", "\n", "an", "=", "'md'", "\n", "align", "=", "'center'", "\n", "", "elif", "pos", "in", "[", "'tl'", ",", "'lt'", "]", ":", "\n", "        ", "xy", "=", "(", "padding", ",", "padding", ")", "\n", "align", "=", "'left'", "\n", "", "elif", "pos", "in", "[", "'bl'", ",", "'lb'", "]", ":", "\n", "        ", "xy", "=", "(", "padding", ",", "h", "-", "padding", "-", "th", ")", "\n", "align", "=", "'left'", "\n", "", "elif", "pos", "in", "[", "'tr'", ",", "'rt'", "]", ":", "\n", "        ", "xy", "=", "(", "w", "-", "padding", "-", "tw", ",", "padding", ")", "\n", "align", "=", "'right'", "\n", "", "elif", "pos", "in", "[", "'br'", ",", "'rb'", "]", ":", "\n", "        ", "xy", "=", "(", "w", "-", "padding", "-", "tw", ",", "h", "-", "padding", "-", "th", ")", "\n", "align", "=", "'right'", "\n", "", "else", ":", "\n", "        ", "assert", "False", ",", "'pos not understood'", "\n", "\n", "", "ans", "=", "Image", ".", "new", "(", "'RGBA'", ",", "(", "w", ",", "h", ")", ",", "bg", ")", "\n", "d", "=", "PIL", ".", "ImageDraw", ".", "Draw", "(", "ans", ")", "\n", "d", ".", "multiline_text", "(", "\n", "xy", ",", "text", ",", "fill", "=", "c", ",", "font", "=", "f", ",", "anchor", "=", "an", ",", "\n", "spacing", "=", "spacing", ",", "align", "=", "align", ",", "\n", ")", "\n", "\n", "if", "facing", "in", "[", "'l'", ",", "'left'", "]", ":", "\n", "        ", "ans", "=", "ans", ".", "rotate", "(", "180", ")", "\n", "", "elif", "facing", "in", "[", "'u'", ",", "'up'", "]", ":", "\n", "        ", "ans", "=", "ans", ".", "rotate", "(", "90", ",", "expand", "=", "True", ")", "\n", "", "elif", "facing", "in", "[", "'d'", ",", "'down'", "]", ":", "\n", "        ", "ans", "=", "ans", ".", "rotate", "(", "-", "90", ",", "expand", "=", "True", ")", "\n", "", "return", "I", "(", "ans", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.pixel_logit": [[871, 874], ["torch.log"], "function", ["None"], ["", "def", "pixel_logit", "(", "x", ",", "pixel_margin", "=", "1", ")", ":", "\n", "    ", "x", "=", "(", "x", "*", "(", "255", "-", "2", "*", "pixel_margin", ")", "+", "pixel_margin", ")", "/", "255", "\n", "return", "torch", ".", "log", "(", "x", "/", "(", "1", "-", "x", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.pytorch_v1.cupy_launch": [[51, 53], ["cupy.cuda.compile_with_cache().get_function", "cupy.cuda.compile_with_cache"], "function", ["None"], ["", "def", "cupy_launch", "(", "func", ",", "kernel", ")", ":", "\n", "    ", "return", "cupy", ".", "cuda", ".", "compile_with_cache", "(", "kernel", ")", ".", "get_function", "(", "func", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.pytorch_v1.reset_parameters": [[54, 59], ["model.children", "hasattr", "layer.reset_parameters"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.pytorch_v1.reset_parameters"], ["", "def", "reset_parameters", "(", "model", ")", ":", "\n", "    ", "for", "layer", "in", "model", ".", "children", "(", ")", ":", "\n", "        ", "if", "hasattr", "(", "layer", ",", "'reset_parameters'", ")", ":", "\n", "            ", "layer", ".", "reset_parameters", "(", ")", "\n", "", "", "return", "model", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.pytorch_v1.channel_squeeze": [[60, 64], ["x.reshape"], "function", ["None"], ["", "def", "channel_squeeze", "(", "x", ",", "dim", "=", "1", ")", ":", "\n", "    ", "a", "=", "x", ".", "shape", "[", ":", "dim", "]", "\n", "b", "=", "x", ".", "shape", "[", "dim", "+", "2", ":", "]", "\n", "return", "x", ".", "reshape", "(", "*", "a", ",", "-", "1", ",", "*", "b", ")", "\n", "", "def", "channel_unsqueeze", "(", "x", ",", "shape", ",", "dim", "=", "1", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.pytorch_v1.channel_unsqueeze": [[64, 68], ["x.reshape"], "function", ["None"], ["", "def", "channel_unsqueeze", "(", "x", ",", "shape", ",", "dim", "=", "1", ")", ":", "\n", "    ", "a", "=", "x", ".", "shape", "[", ":", "dim", "]", "\n", "b", "=", "x", ".", "shape", "[", "dim", "+", "1", ":", "]", "\n", "return", "x", ".", "reshape", "(", "*", "a", ",", "*", "shape", ",", "*", "b", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.LambdaLayer.__init__": [[9, 12], ["nn.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__init__"], ["    ", "def", "__init__", "(", "self", ",", "func", ")", ":", "\n", "        ", "super", "(", "LambdaLayer", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "func", "=", "func", "\n", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.LambdaLayer.forward": [[12, 14], ["helper_models_v0.LambdaLayer.func"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "self", ".", "func", "(", "x", ")", "\n", "", "", "class", "AbsoluteValue", "(", "nn", ".", "Module", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.AbsoluteValue.__init__": [[15, 18], ["nn.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__init__"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", "AbsoluteValue", ",", "self", ")", ".", "__init__", "(", ")", "\n", "return", "\n", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.AbsoluteValue.forward": [[18, 20], ["torch.abs"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "torch", ".", "abs", "(", "x", ")", "\n", "", "", "class", "MaskedImageLossL1", "(", "nn", ".", "Module", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.MaskedImageLossL1.__init__": [[21, 24], ["nn.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__init__"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", "MaskedImageLossL1", ",", "self", ")", ".", "__init__", "(", ")", "\n", "return", "\n", "", "def", "forward", "(", "self", ",", "alpha", ",", "gt", ",", "pred", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.MaskedImageLossL1.forward": [[24, 26], ["None"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "alpha", ",", "gt", ",", "pred", ")", ":", "\n", "        ", "return", "(", "alpha", "*", "(", "gt", "-", "pred", ")", ".", "abs", "(", ")", ".", "mean", "(", "dim", "=", "1", ",", "keepdim", "=", "True", ")", ")", ".", "mean", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.PositionalEncoding.__init__": [[28, 40], ["nn.Module.__init__", "np.linspace", "helper_models_v0.PositionalEncoding.register_buffer", "torch.tensor", "np.exp", "np.log", "np.log"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__init__", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor"], ["    ", "def", "__init__", "(", "self", ",", "phases", ",", "freq_min", "=", "1", ",", "freq_max", "=", "10000", ")", ":", "\n", "        ", "super", "(", "PositionalEncoding", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "phases", "=", "phases", "\n", "self", ".", "freq_min", "=", "freq_min", "\n", "self", ".", "freq_max", "=", "freq_max", "\n", "self", ".", "size", "=", "2", "*", "phases", "# for sin and cos", "\n", "ls", "=", "np", ".", "linspace", "(", "0", ",", "1", ",", "phases", ")", "\n", "mult", "=", "torch", ".", "tensor", "(", "np", ".", "exp", "(", "\n", "ls", "*", "np", ".", "log", "(", "freq_max", ")", "+", "(", "1", "-", "ls", ")", "*", "np", ".", "log", "(", "freq_min", ")", "\n", ")", ")", "*", "(", "2", "*", "np", ".", "pi", ")", "\n", "self", ".", "register_buffer", "(", "'multiplier'", ",", "mult", ")", "\n", "return", "\n", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.PositionalEncoding.forward": [[40, 47], ["torch.stack().flatten", "torch.stack().flatten.float", "x.unsqueeze", "torch.stack", "torch.sin", "torch.cos"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "t", "=", "x", ".", "unsqueeze", "(", "-", "1", ")", "*", "self", ".", "multiplier", "\n", "t", "=", "torch", ".", "stack", "(", "[", "\n", "torch", ".", "sin", "(", "t", ")", ",", "\n", "torch", ".", "cos", "(", "t", ")", ",", "\n", "]", ",", "dim", "=", "-", "1", ")", ".", "flatten", "(", "-", "2", ")", "\n", "return", "t", ".", "float", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.ResBlock.__init__": [[49, 90], ["nn.Module.__init__", "OrderedDict", "range", "nn.Sequential", "OrderedDict", "nn.Sequential", "nn.Conv2d", "activation", "normalization", "activation", "normalization"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__init__"], ["    ", "def", "__init__", "(", "self", ",", "\n", "depth", ",", "channels", ",", "kernel", ",", "\n", "channels_in", "=", "None", ",", "# in case different from channels", "\n", "activation", "=", "nn", ".", "ReLU", ",", "\n", "normalization", "=", "nn", ".", "BatchNorm2d", ",", "\n", ")", ":", "\n", "# activation()", "\n", "# normalization(channels)", "\n", "        ", "super", "(", "ResBlock", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "depth", "=", "depth", "\n", "self", ".", "channels", "=", "channels", "\n", "self", ".", "channels_in", "=", "channels_in", "\n", "self", ".", "kernel", "=", "kernel", "\n", "self", ".", "activation", "=", "activation", "\n", "self", ".", "normalization", "=", "normalization", "\n", "\n", "# create sequential network", "\n", "od", "=", "OrderedDict", "(", ")", "\n", "for", "i", "in", "range", "(", "depth", ")", ":", "\n", "            ", "chin", "=", "channels_in", "if", "channels_in", "is", "not", "None", "and", "i", "==", "0", "else", "channels", "\n", "od", "[", "f'conv{i}'", "]", "=", "nn", ".", "Conv2d", "(", "\n", "chin", ",", "channels", ",", "\n", "kernel_size", "=", "kernel", ",", "padding", "=", "kernel", "//", "2", ",", "\n", "bias", "=", "True", ",", "padding_mode", "=", "'replicate'", ",", "\n", ")", "\n", "if", "activation", "is", "not", "None", ":", "\n", "                ", "od", "[", "f'act{i}'", "]", "=", "activation", "(", ")", "\n", "", "if", "normalization", "is", "not", "None", ":", "\n", "                ", "od", "[", "f'norm{i}'", "]", "=", "normalization", "(", "channels", ")", "\n", "", "", "self", ".", "net", "=", "nn", ".", "Sequential", "(", "od", ")", "\n", "\n", "# last activation/normalization", "\n", "od_tail", "=", "OrderedDict", "(", ")", "\n", "if", "activation", "is", "not", "None", ":", "\n", "            ", "od_tail", "[", "f'act{depth}'", "]", "=", "activation", "(", ")", "\n", "", "if", "normalization", "is", "not", "None", ":", "\n", "            ", "od_tail", "[", "f'norm{depth}'", "]", "=", "normalization", "(", "channels", ")", "\n", "", "self", ".", "net_tail", "=", "nn", ".", "Sequential", "(", "od_tail", ")", "\n", "return", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.ResBlock.forward": [[91, 100], ["helper_models_v0.ResBlock.net_tail", "helper_models_v0.ResBlock.net_tail", "body", "helper_models_v0.ResBlock.net"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "if", "self", ".", "channels_in", "is", "None", ":", "\n", "            ", "return", "self", ".", "net_tail", "(", "x", "+", "self", ".", "net", "(", "x", ")", ")", "\n", "", "else", ":", "\n", "            ", "head", "=", "self", ".", "net", "[", "0", "]", "(", "x", ")", "\n", "t", "=", "head", "\n", "for", "body", "in", "self", ".", "net", "[", "1", ":", "]", ":", "\n", "                ", "t", "=", "body", "(", "t", ")", "\n", "", "return", "self", ".", "net_tail", "(", "head", "+", "t", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.Interpolator2d.__init__": [[103, 110], ["nn.Module.__init__", "type"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__init__"], ["    ", "def", "__init__", "(", "self", ",", "size", "=", "None", ",", "mode", "=", "'nearest'", ")", ":", "\n", "# will work as long as batch dim matches", "\n", "# modes: nearest, bilinear, bicubic, area (downscaling)", "\n", "        ", "super", "(", "Interpolator2d", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "size", "=", "(", "size", ",", "size", ")", "if", "type", "(", "size", ")", "==", "int", "else", "size", "\n", "self", ".", "mode", "=", "mode", "\n", "return", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.Interpolator2d.forward": [[111, 124], ["torch.cat", "type", "TF.interpolate"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "size", "=", "None", ",", "mode", "=", "None", ")", ":", "\n", "# local vars override defaults", "\n", "        ", "size", "=", "size", "or", "self", ".", "size", "\n", "size", "=", "(", "size", ",", "size", ")", "if", "type", "(", "size", ")", "==", "int", "else", "size", "\n", "mode", "=", "mode", "or", "self", ".", "mode", "\n", "return", "torch", ".", "cat", "(", "[", "\n", "TF", ".", "interpolate", "(", "\n", "t", ",", "size", "=", "size", ",", "mode", "=", "mode", ",", "\n", "# align_corners=not mode in ['nearest', 'area'],", "\n", ")", "\n", "if", "t", ".", "shape", "[", "-", "2", ":", "]", "!=", "self", ".", "size", "else", "t", "\n", "for", "t", "in", "x", "if", "t", "is", "not", "None", "\n", "]", ",", "dim", "=", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.Injector.__init__": [[127, 189], ["nn.Module.__init__", "helper_models_v0.Injector.__init__._conv_and_tail"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__init__"], ["    ", "def", "__init__", "(", "self", ",", "\n", "size", ",", "# input image height/width", "\n", "depth", ",", "# of the resnet", "\n", "channels_input", ",", "\n", "channels_preprocess", ",", "# on input", "\n", "channels_input_aux", ",", "# list", "\n", "channels_resnet", ",", "\n", "kernel", ",", "\n", "activation", "=", "nn", ".", "ReLU", ",", "\n", "normalization", "=", "nn", ".", "BatchNorm2d", ",", "\n", "interpolation_mode", "=", "'bicubic'", ",", "\n", ")", ":", "\n", "# activation()", "\n", "# normalization(channels)", "\n", "        ", "super", "(", "Injector", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "size", "=", "(", "size", ",", "size", ")", "if", "type", "(", "size", ")", "==", "int", "else", "size", "\n", "self", ".", "depth", "=", "depth", "\n", "self", ".", "channels_input", "=", "channels_input", "\n", "self", ".", "channels_preprocess", "=", "channels_preprocess", "\n", "self", ".", "channels_input_aux", "=", "channels_input_aux", "\n", "self", ".", "channels_resnet", "=", "channels_resnet", "\n", "self", ".", "kernel", "=", "kernel", "\n", "self", ".", "activation", "=", "activation", "\n", "self", ".", "normalization", "=", "normalization", "\n", "self", ".", "interpolation_mode", "=", "interpolation_mode", "\n", "\n", "# adds activation and normalization to tail of conv", "\n", "def", "_conv_and_tail", "(", "c_in", ",", "c_out", ")", ":", "\n", "            ", "od", "=", "OrderedDict", "(", ")", "\n", "od", "[", "'conv'", "]", "=", "nn", ".", "Conv2d", "(", "\n", "c_in", ",", "c_out", ",", "\n", "kernel_size", "=", "kernel", ",", "padding", "=", "kernel", "//", "2", ",", "\n", "padding_mode", "=", "'replicate'", ",", "\n", ")", "\n", "if", "activation", "is", "not", "None", ":", "\n", "                ", "od", "[", "'act'", "]", "=", "activation", "(", ")", "\n", "", "if", "normalization", "is", "not", "None", ":", "\n", "                ", "od", "[", "'norm'", "]", "=", "normalization", "(", "c_out", ")", "\n", "", "return", "nn", ".", "Sequential", "(", "od", ")", "\n", "\n", "# create input preprocessor", "\n", "", "self", ".", "net_preprocessor", "=", "_conv_and_tail", "(", "\n", "channels_input", ",", "channels_preprocess", ",", "\n", ")", "\n", "\n", "# create aux input interpolator", "\n", "self", ".", "net_interpolator", "=", "Interpolator2d", "(", "\n", "size", ",", "mode", "=", "interpolation_mode", ",", "\n", ")", "\n", "\n", "# create converter to resnet channels", "\n", "self", ".", "net_resnet_converter", "=", "_conv_and_tail", "(", "\n", "sum", "(", "channels_input_aux", ")", "+", "channels_preprocess", ",", "\n", "channels_resnet", ",", "\n", ")", "\n", "\n", "# create resnet", "\n", "self", ".", "net_resnet", "=", "ResBlock", "(", "\n", "depth", ",", "channels_resnet", ",", "kernel", ",", "\n", "activation", "=", "activation", ",", "normalization", "=", "normalization", ",", "\n", ")", "\n", "return", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.helper_models_v0.Injector.forward": [[190, 200], ["helper_models_v0.Injector.net_interpolator", "helper_models_v0.Injector.net_preprocessor", "helper_models_v0.Injector.net_interpolator", "helper_models_v0.Injector.net_resnet_converter", "helper_models_v0.Injector.net_resnet"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "x_aux", ")", ":", "\n", "# preprocess input and cat with aux input", "\n", "        ", "t", "=", "self", ".", "net_interpolator", "(", "[", "x", ",", "]", ")", "\n", "t", "=", "self", ".", "net_preprocessor", "(", "t", ")", "\n", "t", "=", "self", ".", "net_interpolator", "(", "x_aux", "+", "[", "t", ",", "]", ")", "\n", "\n", "# feed through resnet", "\n", "t", "=", "self", ".", "net_resnet_converter", "(", "t", ")", "\n", "t", "=", "self", ".", "net_resnet", "(", "t", ")", "\n", "return", "t", "\n", "", "", ""]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendADDSKeypoints.__init__": [[217, 276], ["jread", "sorted", "mkdir", "cat_old[].index", "int", "list", "os.path.isfile", "load", "keypoints_v0.DatabackendADDSKeypoints.keys", "torch.tensor", "torch.tensor", "keypoints_v0.pcp", "out[].mean().numpy", "dump", "id2bn.values", "np.asarray", "torch.tensor.append", "torch.tensor.append", "np.stack", "np.asarray", "torch.zeros_like", "i[].split", "int", "int", "int", "int", "np.asarray", "out[].mean", "np.round", "np.round", "np.round", "np.round", "chunk"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.jread", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.mkdir", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.keys", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.numpy"], ["    ", "def", "__init__", "(", "self", ",", "bargs", ",", "pargs", ",", "force_preprocess_mean_part_lengths", "=", "False", ")", ":", "\n", "        ", "self", ".", "bargs", "=", "bargs", "\n", "self", ".", "pargs", "=", "pargs", "\n", "self", ".", "dn", "=", "f'{bargs.dn}/data/anime_drawings_dataset'", "\n", "self", ".", "fn_annotations", "=", "f'{self.dn}/raw/annotations.json'", "\n", "self", ".", "annotations", "=", "jread", "(", "self", ".", "fn_annotations", ")", "\n", "self", ".", "keyset", "=", "self", ".", "annotations", "[", "'categories'", "]", "[", "0", "]", "[", "'name'", "]", "\n", "\n", "# setup mappings", "\n", "cat_old", "=", "self", ".", "annotations", "[", "'categories'", "]", "[", "0", "]", "\n", "key_new2old", "=", "[", "\n", "cat_old", "[", "'keypoints'", "]", ".", "index", "(", "i", ")", "\n", "for", "i", "in", "coco_keypoints", "\n", "]", "\n", "id2bn", "=", "{", "i", "[", "'id'", "]", ":", "int", "(", "i", "[", "'file_name'", "]", ".", "split", "(", "'.'", ")", "[", "0", "]", ")", "for", "i", "in", "self", ".", "annotations", "[", "'images'", "]", "}", "\n", "id2size", "=", "{", "i", "[", "'id'", "]", ":", "(", "i", "[", "'height'", "]", ",", "i", "[", "'width'", "]", ")", "for", "i", "in", "self", ".", "annotations", "[", "'images'", "]", "}", "\n", "\n", "# parse annotations", "\n", "self", ".", "bns", "=", "sorted", "(", "list", "(", "id2bn", ".", "values", "(", ")", ")", ")", "\n", "self", ".", "sizes", "=", "{", "\n", "id2bn", "[", "an", "[", "'id'", "]", "]", ":", "id2size", "[", "an", "[", "'id'", "]", "]", "\n", "for", "an", "in", "self", ".", "annotations", "[", "'images'", "]", "\n", "}", "\n", "self", ".", "keypoints", "=", "{", "\n", "id2bn", "[", "an", "[", "'image_id'", "]", "]", ":", "np", ".", "asarray", "(", "[", "\n", "(", "k", "[", "1", "]", ",", "k", "[", "0", "]", ",", "k", "[", "2", "]", ")", "for", "k", "in", "chunk", "(", "an", "[", "'keypoints'", "]", ",", "3", ")", "\n", "]", ")", "[", "key_new2old", "]", "\n", "for", "an", "in", "self", ".", "annotations", "[", "'annotations'", "]", "\n", "# if an['category_id']==1", "\n", "# and an['dataset_id']==1", "\n", "}", "\n", "self", ".", "bboxes", "=", "{", "\n", "id2bn", "[", "an", "[", "'image_id'", "]", "]", ":", "[", "\n", "(", "int", "(", "np", ".", "round", "(", "an", "[", "'bbox'", "]", "[", "1", "]", ")", ")", ",", "int", "(", "np", ".", "round", "(", "an", "[", "'bbox'", "]", "[", "0", "]", ")", ")", ")", ",", "\n", "(", "int", "(", "np", ".", "round", "(", "an", "[", "'bbox'", "]", "[", "3", "]", "-", "an", "[", "'bbox'", "]", "[", "1", "]", ")", ")", ",", "int", "(", "np", ".", "round", "(", "an", "[", "'bbox'", "]", "[", "2", "]", "-", "an", "[", "'bbox'", "]", "[", "0", "]", ")", ")", ")", ",", "\n", "]", "\n", "for", "an", "in", "self", ".", "annotations", "[", "'annotations'", "]", "\n", "# if an['category_id']==1", "\n", "# and an['dataset_id']==1", "\n", "}", "\n", "\n", "# get mean part length (for pcpm)", "\n", "self", ".", "fn_mean_part_lengths", "=", "mkdir", "(", "f'{self.dn}/preprocessed/mean_part_lengths.pkl'", ")", "\n", "if", "not", "force_preprocess_mean_part_lengths", "and", "os", ".", "path", ".", "isfile", "(", "self", ".", "fn_mean_part_lengths", ")", ":", "\n", "            ", "self", ".", "mean_part_lengths", "=", "load", "(", "self", ".", "fn_mean_part_lengths", ")", "\n", "", "else", ":", "\n", "            ", "bns", "=", "self", ".", "keys", "(", ")", "\n", "kps", "=", "[", "]", "\n", "bxs", "=", "[", "]", "\n", "for", "bn", "in", "bns", ":", "\n", "                ", "x", "=", "self", "[", "bn", "]", "\n", "kps", ".", "append", "(", "x", "[", "'keypoints'", "]", "[", ":", ",", ":", "2", "]", ")", "\n", "bxs", ".", "append", "(", "np", ".", "asarray", "(", "x", "[", "'bbox'", "]", ")", ")", "\n", "", "kps", "=", "torch", ".", "tensor", "(", "np", ".", "stack", "(", "kps", ")", ")", "\n", "bxs", "=", "torch", ".", "tensor", "(", "np", ".", "asarray", "(", "bxs", ")", ")", "\n", "out", "=", "pcp", "(", "kps", ",", "bxs", ",", "torch", ".", "zeros_like", "(", "kps", ")", ")", "\n", "self", ".", "mean_part_lengths", "=", "out", "[", "'part_lengths'", "]", ".", "mean", "(", "0", ")", ".", "numpy", "(", ")", "\n", "dump", "(", "self", ".", "mean_part_lengths", ",", "self", ".", "fn_mean_part_lengths", ")", "\n", "", "return", "\n", "", "def", "__getitem__", "(", "self", ",", "bn", ",", "return_more", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendADDSKeypoints.__getitem__": [[276, 282], ["None"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "bn", ",", "return_more", "=", "False", ")", ":", "\n", "        ", "return", "{", "\n", "'bn'", ":", "bn", ",", "\n", "'keypoints'", ":", "self", ".", "keypoints", "[", "bn", "]", ",", "\n", "'bbox'", ":", "self", ".", "bboxes", "[", "bn", "]", ",", "\n", "'size'", ":", "self", ".", "sizes", "[", "bn", "]", ",", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendADDSKeypoints.__len__": [[283, 285], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "bns", ")", "\n", "", "def", "__iter__", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendADDSKeypoints.__iter__": [[285, 299], ["it", "len", "len", "keypoints_v0.DatabackendADDSKeypoints.x.keys"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.keys"], ["", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "class", "it", ":", "\n", "            ", "def", "__init__", "(", "self", ",", "x", ")", ":", "\n", "                ", "self", ".", "x", "=", "x", "\n", "self", ".", "idx", "=", "0", "\n", "", "def", "__next__", "(", "self", ")", ":", "\n", "                ", "i", "=", "self", ".", "idx", "\n", "if", "i", ">=", "len", "(", "self", ")", ":", "\n", "                    ", "raise", "StopIteration", "\n", "", "self", ".", "idx", "+=", "1", "\n", "return", "self", ".", "x", "[", "self", ".", "x", ".", "keys", "(", ")", "[", "i", "]", "]", "\n", "", "def", "__len__", "(", "self", ")", ":", "\n", "                ", "return", "len", "(", "self", ".", "x", ")", "\n", "", "", "return", "it", "(", "self", ")", "\n", "", "def", "keys", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendADDSKeypoints.keys": [[299, 301], ["None"], "methods", ["None"], ["", "def", "keys", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "bns", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__init__": [[305, 364], ["jread", "sorted", "mkdir", "cat_old[].index", "int", "list", "os.path.isfile", "load", "keypoints_v0.DatabackendDanbooruCOCOKeypoints.keys", "torch.tensor", "torch.tensor", "util_keypoints.pcp", "out[].mean().numpy", "dump", "id2bn.values", "np.asarray", "torch.tensor.append", "torch.tensor.append", "np.stack", "np.asarray", "torch.zeros_like", "i[].split", "int", "int", "int", "int", "np.asarray", "out[].mean", "np.round", "np.round", "np.round", "np.round", "chunk"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.jread", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.util_v1.mkdir", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.keys", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp", "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.numpy"], ["    ", "def", "__init__", "(", "self", ",", "bargs", ",", "pargs", ",", "force_preprocess_mean_part_lengths", "=", "False", ")", ":", "\n", "        ", "self", ".", "bargs", "=", "bargs", "\n", "self", ".", "pargs", "=", "pargs", "\n", "self", ".", "dn", "=", "f'{bargs.dn}/data/anime_drawings_dataset/danbooru_coco'", "\n", "self", ".", "fn_annotations", "=", "f'{self.dn}/raw/annotations.json'", "\n", "self", ".", "annotations", "=", "jread", "(", "self", ".", "fn_annotations", ")", "\n", "self", ".", "keyset", "=", "self", ".", "annotations", "[", "'categories'", "]", "[", "0", "]", "[", "'name'", "]", "\n", "\n", "# setup mappings", "\n", "cat_old", "=", "self", ".", "annotations", "[", "'categories'", "]", "[", "0", "]", "\n", "key_new2old", "=", "[", "\n", "cat_old", "[", "'keypoints'", "]", ".", "index", "(", "i", ")", "\n", "for", "i", "in", "coco_keypoints", "\n", "]", "\n", "id2bn", "=", "{", "i", "[", "'id'", "]", ":", "int", "(", "i", "[", "'file_name'", "]", ".", "split", "(", "'.'", ")", "[", "0", "]", ")", "for", "i", "in", "self", ".", "annotations", "[", "'images'", "]", "}", "\n", "id2size", "=", "{", "i", "[", "'id'", "]", ":", "(", "i", "[", "'height'", "]", ",", "i", "[", "'width'", "]", ")", "for", "i", "in", "self", ".", "annotations", "[", "'images'", "]", "}", "\n", "\n", "# parse annotations", "\n", "self", ".", "bns", "=", "sorted", "(", "list", "(", "id2bn", ".", "values", "(", ")", ")", ")", "\n", "self", ".", "sizes", "=", "{", "\n", "id2bn", "[", "an", "[", "'id'", "]", "]", ":", "id2size", "[", "an", "[", "'id'", "]", "]", "\n", "for", "an", "in", "self", ".", "annotations", "[", "'images'", "]", "\n", "}", "\n", "self", ".", "keypoints", "=", "{", "\n", "id2bn", "[", "an", "[", "'image_id'", "]", "]", ":", "np", ".", "asarray", "(", "[", "\n", "(", "k", "[", "1", "]", ",", "k", "[", "0", "]", ",", "k", "[", "2", "]", ")", "for", "k", "in", "chunk", "(", "an", "[", "'keypoints'", "]", ",", "3", ")", "\n", "]", ")", "[", "key_new2old", "]", "\n", "for", "an", "in", "self", ".", "annotations", "[", "'annotations'", "]", "\n", "# if an['category_id']==1", "\n", "# and an['dataset_id']==1", "\n", "}", "\n", "self", ".", "bboxes", "=", "{", "\n", "id2bn", "[", "an", "[", "'image_id'", "]", "]", ":", "[", "\n", "(", "int", "(", "np", ".", "round", "(", "an", "[", "'bbox'", "]", "[", "1", "]", ")", ")", ",", "int", "(", "np", ".", "round", "(", "an", "[", "'bbox'", "]", "[", "0", "]", ")", ")", ")", ",", "\n", "(", "int", "(", "np", ".", "round", "(", "an", "[", "'bbox'", "]", "[", "3", "]", "-", "an", "[", "'bbox'", "]", "[", "1", "]", ")", ")", ",", "int", "(", "np", ".", "round", "(", "an", "[", "'bbox'", "]", "[", "2", "]", "-", "an", "[", "'bbox'", "]", "[", "0", "]", ")", ")", ")", ",", "\n", "]", "\n", "for", "an", "in", "self", ".", "annotations", "[", "'annotations'", "]", "\n", "# if an['category_id']==1", "\n", "# and an['dataset_id']==1", "\n", "}", "\n", "\n", "# get mean part length (for pcpm)", "\n", "self", ".", "fn_mean_part_lengths", "=", "mkdir", "(", "f'{self.dn}/preprocessed/mean_part_lengths.pkl'", ")", "\n", "if", "not", "force_preprocess_mean_part_lengths", "and", "os", ".", "path", ".", "isfile", "(", "self", ".", "fn_mean_part_lengths", ")", ":", "\n", "            ", "self", ".", "mean_part_lengths", "=", "load", "(", "self", ".", "fn_mean_part_lengths", ")", "\n", "", "else", ":", "\n", "            ", "bns", "=", "self", ".", "keys", "(", ")", "\n", "kps", "=", "[", "]", "\n", "bxs", "=", "[", "]", "\n", "for", "bn", "in", "bns", ":", "\n", "                ", "x", "=", "self", "[", "bn", "]", "\n", "kps", ".", "append", "(", "x", "[", "'keypoints'", "]", "[", ":", ",", ":", "2", "]", ")", "\n", "bxs", ".", "append", "(", "np", ".", "asarray", "(", "x", "[", "'bbox'", "]", ")", ")", "\n", "", "kps", "=", "torch", ".", "tensor", "(", "np", ".", "stack", "(", "kps", ")", ")", "\n", "bxs", "=", "torch", ".", "tensor", "(", "np", ".", "asarray", "(", "bxs", ")", ")", "\n", "out", "=", "util_keypoints", ".", "pcp", "(", "kps", ",", "bxs", ",", "torch", ".", "zeros_like", "(", "kps", ")", ")", "\n", "self", ".", "mean_part_lengths", "=", "out", "[", "'part_lengths'", "]", ".", "mean", "(", "0", ")", ".", "numpy", "(", ")", "\n", "dump", "(", "self", ".", "mean_part_lengths", ",", "self", ".", "fn_mean_part_lengths", ")", "\n", "", "return", "\n", "", "def", "__getitem__", "(", "self", ",", "bn", ",", "return_more", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__getitem__": [[364, 370], ["None"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "bn", ",", "return_more", "=", "False", ")", ":", "\n", "        ", "return", "{", "\n", "'bn'", ":", "bn", ",", "\n", "'keypoints'", ":", "self", ".", "keypoints", "[", "bn", "]", ",", "\n", "'bbox'", ":", "self", ".", "bboxes", "[", "bn", "]", ",", "\n", "'size'", ":", "self", ".", "sizes", "[", "bn", "]", ",", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__len__": [[371, 373], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "bns", ")", "\n", "", "def", "__iter__", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.__iter__": [[373, 387], ["it", "len", "len", "keypoints_v0.DatabackendDanbooruCOCOKeypoints.x.keys"], "methods", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.keys"], ["", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "class", "it", ":", "\n", "            ", "def", "__init__", "(", "self", ",", "x", ")", ":", "\n", "                ", "self", ".", "x", "=", "x", "\n", "self", ".", "idx", "=", "0", "\n", "", "def", "__next__", "(", "self", ")", ":", "\n", "                ", "i", "=", "self", ".", "idx", "\n", "if", "i", ">=", "len", "(", "self", ")", ":", "\n", "                    ", "raise", "StopIteration", "\n", "", "self", ".", "idx", "+=", "1", "\n", "return", "self", ".", "x", "[", "self", ".", "x", ".", "keys", "(", ")", "[", "i", "]", "]", "\n", "", "def", "__len__", "(", "self", ")", ":", "\n", "                ", "return", "len", "(", "self", ".", "x", ")", "\n", "", "", "return", "it", "(", "self", ")", "\n", "", "def", "keys", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.DatabackendDanbooruCOCOKeypoints.keys": [[387, 389], ["None"], "methods", ["None"], ["", "def", "keys", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "bns", "\n", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pcp": [[102, 135], ["gt_kps[].float", "gt_bbox.float.float", "torch.norm", "len", "torch.norm", "yes.float().mean", "gt_bbox[].max", "yes.float"], "function", ["None"], ["def", "pcp", "(", "gt_kps", ",", "gt_bbox", ",", "pred_kps", ",", "k", "=", "0.5", ",", "m", "=", "None", ",", "return_more", "=", "True", ")", ":", "\n", "# convert to batched", "\n", "    ", "unsq", "=", "len", "(", "gt_kps", ".", "shape", ")", "==", "2", "\n", "if", "unsq", ":", "\n", "        ", "gt_kps", "=", "gt_kps", "[", "None", "]", "\n", "gt_bbox", "=", "gt_bbox", "[", "None", "]", "\n", "pred_kps", "=", "pred_kps", "[", "None", "]", "\n", "", "gt_kps", "=", "gt_kps", "[", "...", ",", ":", "2", "]", ".", "float", "(", ")", "\n", "gt_bbox", "=", "gt_bbox", ".", "float", "(", ")", "\n", "pred_kps", "=", "pred_kps", "[", "...", ",", ":", "2", "]", "\n", "\n", "# normalize coordinates (wrt max bbox dim)", "\n", "bbox_from", "=", "gt_bbox", "[", ":", ",", "None", ",", "0", "]", "\n", "bbox_size", "=", "gt_bbox", "[", ":", ",", "1", "]", ".", "max", "(", "dim", "=", "1", ")", ".", "values", "[", ":", ",", "None", ",", "None", "]", "\n", "gt_kps", "=", "(", "gt_kps", "-", "bbox_from", ")", "/", "bbox_size", "\n", "pred_kps", "=", "(", "pred_kps", "-", "bbox_from", ")", "/", "bbox_size", "\n", "\n", "# threshold distance", "\n", "d", "=", "torch", ".", "norm", "(", "gt_kps", "-", "pred_kps", ",", "dim", "=", "2", ")", "\n", "if", "m", "is", "None", ":", "\n", "        ", "l", "=", "gt_kps", "[", ":", ",", "coco_parts", "]", "\n", "l", "=", "torch", ".", "norm", "(", "l", "[", ":", ",", ":", ",", "0", "]", "-", "l", "[", ":", ",", ":", ",", "1", "]", ",", "dim", "=", "2", ")", "\n", "", "else", ":", "\n", "# m: 14-dim vector of mean lengths (norm wrt max bbox dim)", "\n", "        ", "l", "=", "m", "[", "None", ",", ":", "]", "\n", "", "yes", "=", "(", "d", "[", ":", ",", "coco_parts", "]", "<=", "k", "*", "l", "[", "...", ",", "None", "]", ")", ".", "all", "(", "dim", "=", "-", "1", ")", "\n", "ans", "=", "{", "'metric'", ":", "yes", ".", "float", "(", ")", ".", "mean", "(", "dim", "=", "1", ")", "}", "\n", "if", "return_more", ":", "\n", "        ", "ans", "[", "'joint_distances'", "]", "=", "d", "\n", "ans", "[", "'part_lengths'", "]", "=", "l", "\n", "ans", "[", "'correct_parts'", "]", "=", "yes", "\n", "# ans['locals'] = locals()", "\n", "", "return", "ans", "\n", "", "def", "pck", "(", "gt_kps", ",", "gt_bbox", ",", "pred_kps", ",", "k", "=", "0.5", ",", "mode", "=", "'h'", ",", "return_more", "=", "True", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck": [[135, 177], ["gt_kps[].float", "gt_bbox.float.float", "torch.norm", "len", "torch.norm", "yes.float().mean", "gt_bbox[].max", "torch.norm", "torch.norm", "yes.float"], "function", ["None"], ["", "def", "pck", "(", "gt_kps", ",", "gt_bbox", ",", "pred_kps", ",", "k", "=", "0.5", ",", "mode", "=", "'h'", ",", "return_more", "=", "True", ")", ":", "\n", "# convert to batched", "\n", "    ", "unsq", "=", "len", "(", "gt_kps", ".", "shape", ")", "==", "2", "\n", "if", "unsq", ":", "\n", "        ", "gt_kps", "=", "gt_kps", "[", "None", "]", "\n", "gt_bbox", "=", "gt_bbox", "[", "None", "]", "\n", "pred_kps", "=", "pred_kps", "[", "None", "]", "\n", "", "gt_kps", "=", "gt_kps", "[", "...", ",", ":", "2", "]", ".", "float", "(", ")", "\n", "gt_bbox", "=", "gt_bbox", ".", "float", "(", ")", "\n", "pred_kps", "=", "pred_kps", "[", "...", ",", ":", "2", "]", "\n", "\n", "# normalize coordinates (wrt max bbox dim)", "\n", "bbox_from", "=", "gt_bbox", "[", ":", ",", "None", ",", "0", "]", "\n", "bbox_size", "=", "gt_bbox", "[", ":", ",", "1", "]", ".", "max", "(", "dim", "=", "1", ")", ".", "values", "[", ":", ",", "None", ",", "None", "]", "\n", "gt_kps", "=", "(", "gt_kps", "-", "bbox_from", ")", "/", "bbox_size", "\n", "pred_kps", "=", "(", "pred_kps", "-", "bbox_from", ")", "/", "bbox_size", "\n", "\n", "# threshold distance", "\n", "d", "=", "torch", ".", "norm", "(", "gt_kps", "-", "pred_kps", ",", "dim", "=", "2", ")", "\n", "if", "mode", "==", "'h'", ":", "\n", "# pck(h)", "\n", "# approx. head size as clavicle to nose", "\n", "        ", "l", "=", "torch", ".", "norm", "(", "\n", "gt_kps", "[", ":", ",", "0", "]", "-", "(", "gt_kps", "[", ":", ",", "5", "]", "+", "gt_kps", "[", ":", ",", "6", "]", ")", "/", "2", ",", "\n", "dim", "=", "1", ",", "\n", ")", "\n", "", "elif", "mode", "==", "'pdj'", ":", "\n", "# pdj: hip_left - shoulder_right", "\n", "        ", "l", "=", "torch", ".", "norm", "(", "gt_kps", "[", ":", ",", "11", "]", "-", "gt_kps", "[", ":", ",", "6", "]", ",", "dim", "=", "1", ")", "\n", "", "elif", "mode", "==", "'bbox_diag'", ":", "\n", "# bbox diagonal", "\n", "        ", "l", "=", "torch", ".", "norm", "(", "gt_bbox", "[", ":", ",", "1", "]", "/", "bbox_size", "[", ":", ",", "0", "]", ",", "dim", "=", "1", ")", "\n", "", "else", ":", "\n", "        ", "assert", "0", ",", "f'mode {mode} not understood'", "\n", "", "yes", "=", "d", "<=", "k", "*", "l", "[", ":", ",", "None", "]", "\n", "ans", "=", "{", "'metric'", ":", "yes", ".", "float", "(", ")", ".", "mean", "(", "dim", "=", "1", ")", "}", "\n", "if", "return_more", ":", "\n", "        ", "ans", "[", "'joint_distances'", "]", "=", "d", "\n", "ans", "[", "'joint_thresholds'", "]", "=", "l", "\n", "ans", "[", "'correct_joints'", "]", "=", "yes", "\n", "# ans['locals'] = locals()", "\n", "", "return", "ans", "\n", "", "def", "pdj", "(", "gt_kps", ",", "gt_bbox", ",", "pred_kps", ",", "k", "=", "0.2", ",", "return_more", "=", "True", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pdj": [[177, 179], ["keypoints_v0.pck"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.pck"], ["", "def", "pdj", "(", "gt_kps", ",", "gt_bbox", ",", "pred_kps", ",", "k", "=", "0.2", ",", "return_more", "=", "True", ")", ":", "\n", "    ", "return", "pck", "(", "gt_kps", ",", "gt_bbox", ",", "pred_kps", ",", "k", "=", "k", ",", "mode", "=", "'pdj'", ",", "return_more", "=", "return_more", ")", "\n", "", "def", "oks", "(", "gt_kps", ",", "gt_bbox", ",", "pred_kps", ",", "thresh", "=", "0.5", ",", "return_more", "=", "True", ")", ":", "\n"]], "home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.keypoints_v0.oks": [[179, 212], ["gt_kps[].float", "gt_bbox.float.float", "torch.norm", "torch.exp", "len", "torch.sqrt", "torch.tensor", "yes.float().mean", "gt_bbox[].max", "yes.float"], "function", ["home.repos.pwc.inspect_result.ShuhongChen_bizarre-pose-estimator._util.twodee_v0.I.tensor"], ["", "def", "oks", "(", "gt_kps", ",", "gt_bbox", ",", "pred_kps", ",", "thresh", "=", "0.5", ",", "return_more", "=", "True", ")", ":", "\n", "# convert to batched", "\n", "    ", "unsq", "=", "len", "(", "gt_kps", ".", "shape", ")", "==", "2", "\n", "if", "unsq", ":", "\n", "        ", "gt_kps", "=", "gt_kps", "[", "None", "]", "\n", "gt_bbox", "=", "gt_bbox", "[", "None", "]", "\n", "pred_kps", "=", "pred_kps", "[", "None", "]", "\n", "", "gt_kps", "=", "gt_kps", "[", "...", ",", ":", "2", "]", ".", "float", "(", ")", "\n", "gt_bbox", "=", "gt_bbox", ".", "float", "(", ")", "\n", "pred_kps", "=", "pred_kps", "[", "...", ",", ":", "2", "]", "\n", "\n", "# normalize coordinates (wrt max bbox dim)", "\n", "bbox_from", "=", "gt_bbox", "[", ":", ",", "None", ",", "0", "]", "\n", "bbox_size", "=", "gt_bbox", "[", ":", ",", "1", "]", ".", "max", "(", "dim", "=", "1", ")", ".", "values", "[", ":", ",", "None", ",", "None", "]", "\n", "gt_kps", "=", "(", "gt_kps", "-", "bbox_from", ")", "/", "bbox_size", "\n", "pred_kps", "=", "(", "pred_kps", "-", "bbox_from", ")", "/", "bbox_size", "\n", "# bbox_diag = torch.norm(gt_bbox[:,1]/bbox_size[:,0], dim=1)", "\n", "\n", "# threshold distance", "\n", "d", "=", "torch", ".", "norm", "(", "gt_kps", "-", "pred_kps", ",", "dim", "=", "2", ")", "\n", "# s = bbox_diag[:,None]", "\n", "s", "=", "torch", ".", "sqrt", "(", "gt_bbox", "[", ":", ",", "1", ",", "0", "]", "*", "gt_bbox", "[", ":", ",", "1", ",", "1", "]", "/", "bbox_size", "[", ":", ",", "0", ",", "0", "]", "**", "2", ")", "[", ":", ",", "None", "]", "\n", "sig", "=", "torch", ".", "tensor", "(", "coco_oks_sigmas", ",", "device", "=", "d", ".", "device", ")", "[", "None", "]", "\n", "ok", "=", "torch", ".", "exp", "(", "-", "d", "**", "2", "/", "(", "2", "*", "s", "**", "2", "*", "sig", "**", "2", ")", ")", "\n", "yes", "=", "ok", ">=", "thresh", "\n", "ans", "=", "{", "'metric'", ":", "yes", ".", "float", "(", ")", ".", "mean", "(", "dim", "=", "1", ")", "}", "\n", "if", "return_more", ":", "\n", "        ", "ans", "[", "'joint_distances'", "]", "=", "d", "\n", "ans", "[", "'keypoint_similarities'", "]", "=", "ok", "\n", "ans", "[", "'correct_joints'", "]", "=", "yes", "\n", "ans", "[", "'bbox_sqrt_area'", "]", "=", "s", "[", ":", ",", "0", "]", "\n", "# ans['locals'] = locals()", "\n", "", "return", "ans", "\n", "\n"]]}