{"home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.InstanceNormalization.__init__": [[68, 71], ["super().__init__"], "methods", ["home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.maintrain.__init__"], ["  ", "def", "__init__", "(", "self", ",", "epsilon", "=", "1e-5", ")", ":", "\n", "    ", "super", "(", "InstanceNormalization", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "epsilon", "=", "epsilon", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.InstanceNormalization.build": [[72, 84], ["ops.InstanceNormalization.add_weight", "ops.InstanceNormalization.add_weight", "tensorflow.random_normal_initializer"], "methods", ["None"], ["", "def", "build", "(", "self", ",", "input_shape", ")", ":", "\n", "    ", "self", ".", "scale", "=", "self", ".", "add_weight", "(", "\n", "name", "=", "'scale'", ",", "\n", "shape", "=", "input_shape", "[", "-", "1", ":", "]", ",", "\n", "initializer", "=", "tf", ".", "random_normal_initializer", "(", "1.", ",", "0.02", ")", ",", "\n", "trainable", "=", "True", ")", "\n", "\n", "self", ".", "offset", "=", "self", ".", "add_weight", "(", "\n", "name", "=", "'offset'", ",", "\n", "shape", "=", "input_shape", "[", "-", "1", ":", "]", ",", "\n", "initializer", "=", "'zeros'", ",", "\n", "trainable", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.InstanceNormalization.call": [[85, 90], ["tensorflow.nn.moments", "tensorflow.math.rsqrt"], "methods", ["None"], ["", "def", "call", "(", "self", ",", "x", ")", ":", "\n", "    ", "mean", ",", "variance", "=", "tf", ".", "nn", ".", "moments", "(", "x", ",", "axes", "=", "[", "1", ",", "2", "]", ",", "keepdims", "=", "True", ")", "\n", "inv", "=", "tf", ".", "math", ".", "rsqrt", "(", "variance", "+", "self", ".", "epsilon", ")", "\n", "normalized", "=", "(", "x", "-", "mean", ")", "*", "inv", "\n", "return", "self", ".", "scale", "*", "normalized", "+", "self", ".", "offset", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.conv2d": [[16, 18], ["Conv2D"], "function", ["None"], ["def", "conv2d", "(", "input_", ",", "output_dim", ",", "kernel_size", "=", "3", ",", "stride", "=", "2", ",", "padding", "=", "\"SAME\"", ",", "biased", "=", "True", ")", ":", "\n", "    ", "return", "Conv2D", "(", "output_dim", ",", "kernel_size", "=", "[", "kernel_size", ",", "kernel_size", "]", ",", "strides", "=", "[", "stride", ",", "stride", "]", ",", "padding", "=", "padding", ",", "use_bias", "=", "biased", ")", "(", "input_", ")", "\n", "", "def", "deconv2d", "(", "input_", ",", "output_dim", ",", "kernel_size", "=", "4", ",", "stride", "=", "2", ",", "padding", "=", "\"SAME\"", ",", "biased", "=", "True", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.deconv2d": [[18, 20], ["Conv2DTranspose"], "function", ["None"], ["", "def", "deconv2d", "(", "input_", ",", "output_dim", ",", "kernel_size", "=", "4", ",", "stride", "=", "2", ",", "padding", "=", "\"SAME\"", ",", "biased", "=", "True", ")", ":", "\n", "    ", "return", "Conv2DTranspose", "(", "output_dim", ",", "kernel_size", "=", "[", "kernel_size", ",", "kernel_size", "]", ",", "strides", "=", "[", "stride", ",", "stride", "]", ",", "padding", "=", "padding", ",", "use_bias", "=", "biased", ")", "(", "input_", ")", "\n", "", "def", "DSC", "(", "input_", ",", "output_dim", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "padding", "=", "\"SAME\"", ",", "scale", "=", "1", ",", "biased", "=", "True", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.DSC": [[20, 22], ["SeparableConv2D"], "function", ["None"], ["", "def", "DSC", "(", "input_", ",", "output_dim", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "padding", "=", "\"SAME\"", ",", "scale", "=", "1", ",", "biased", "=", "True", ")", ":", "\n", "    ", "return", "SeparableConv2D", "(", "input_", ".", "shape", "[", "-", "1", "]", ",", "kernel_size", "=", "[", "kernel_size", ",", "kernel_size", "]", ",", "strides", "=", "[", "stride", ",", "stride", "]", ",", "padding", "=", "padding", ",", "depth_multiplier", "=", "scale", ",", "use_bias", "=", "biased", ")", "(", "input_", ")", "\n", "", "def", "MDSC", "(", "input_", ",", "output_dim", ",", "kernel_list", "=", "[", "3", ",", "5", "]", ",", "stride", "=", "1", ",", "padding", "=", "\"SAME\"", ",", "scale", "=", "1", ",", "biased", "=", "True", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.MDSC": [[22, 30], ["range", "concatenate", "ops.conv2d", "len", "DepthwiseConv2D", "depthoutput_list.append", "DepthwiseConv2D."], "function", ["home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.conv2d"], ["", "def", "MDSC", "(", "input_", ",", "output_dim", ",", "kernel_list", "=", "[", "3", ",", "5", "]", ",", "stride", "=", "1", ",", "padding", "=", "\"SAME\"", ",", "scale", "=", "1", ",", "biased", "=", "True", ")", ":", "\n", "    ", "depthoutput_list", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "kernel_list", ")", ")", ":", "\n", "        ", "depth_output", "=", "DepthwiseConv2D", "(", "kernel_size", "=", "kernel_list", "[", "i", "]", ",", "strides", "=", "stride", ",", "padding", "=", "padding", ",", "depth_multiplier", "=", "scale", ")", "\n", "depthoutput_list", ".", "append", "(", "depth_output", "(", "input_", ")", ")", "\n", "", "output", "=", "concatenate", "(", "depthoutput_list", ",", "axis", "=", "-", "1", ")", "\n", "output", "=", "conv2d", "(", "output", ",", "output_dim", ",", "kernel_size", "=", "1", ",", "stride", "=", "1", ",", "padding", "=", "padding", ",", "biased", "=", "biased", ")", "\n", "return", "output", "\n", "", "def", "SDC", "(", "input_", ",", "output_dim", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "dilation", "=", "2", ",", "padding", "=", "'SAME'", ",", "biased", "=", "True", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.SDC": [[30, 42], ["tensorflow.expand_dims", "tensorflow.squeeze", "Conv3D", "Conv2D"], "function", ["None"], ["", "def", "SDC", "(", "input_", ",", "output_dim", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "dilation", "=", "2", ",", "padding", "=", "'SAME'", ",", "biased", "=", "True", ")", ":", "\n", "    ", "\"\"\"\n    Smoothed dilated conv2d via the Separable and Shared Convolution (SSC) without BN or relu.\n    \"\"\"", "\n", "input_dim", "=", "input_", ".", "shape", "[", "-", "1", "]", "\n", "fix_w_size", "=", "dilation", "*", "2", "-", "1", "\n", "eo", "=", "tf", ".", "expand_dims", "(", "input_", ",", "-", "1", ")", "\n", "o", "=", "Conv3D", "(", "1", ",", "kernel_size", "=", "[", "fix_w_size", ",", "fix_w_size", ",", "1", "]", ",", "strides", "=", "[", "stride", ",", "stride", ",", "stride", "]", ",", "padding", "=", "padding", ",", "use_bias", "=", "biased", ")", "(", "eo", ")", "\n", "o", "=", "eo", "+", "o", "\n", "o", "=", "tf", ".", "squeeze", "(", "o", ",", "-", "1", ")", "\n", "o", "=", "Conv2D", "(", "output_dim", ",", "kernel_size", "=", "[", "kernel_size", ",", "kernel_size", "]", ",", "strides", "=", "[", "stride", ",", "stride", "]", ",", "padding", "=", "padding", ",", "dilation_rate", "=", "(", "dilation", ",", "dilation", ")", ",", "use_bias", "=", "biased", ")", "(", "o", ")", "\n", "return", "o", "\n", "", "def", "SDRB", "(", "input_", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "dilation", "=", "2", ",", "training", "=", "False", ",", "biased", "=", "True", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.SDRB": [[42, 50], ["ops.SDC", "ops.batch_norm", "ops.relu", "ops.SDC", "ops.batch_norm", "ops.relu", "input_.get_shape"], "function", ["home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.SDC", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.batch_norm", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.relu", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.SDC", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.batch_norm", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.relu"], ["", "def", "SDRB", "(", "input_", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "dilation", "=", "2", ",", "training", "=", "False", ",", "biased", "=", "True", ")", ":", "\n", "    ", "output_dim", "=", "input_", ".", "get_shape", "(", ")", "[", "-", "1", "]", "\n", "sconv1", "=", "SDC", "(", "input_", ",", "output_dim", ",", "kernel_size", ",", "stride", ",", "dilation", ",", "biased", "=", "biased", ")", "\n", "sconv1", "=", "batch_norm", "(", "sconv1", ",", "training", ")", "\n", "sconv1", "=", "relu", "(", "sconv1", ")", "\n", "sconv2", "=", "SDC", "(", "sconv1", ",", "output_dim", ",", "kernel_size", ",", "stride", ",", "dilation", ",", "biased", "=", "biased", ")", "\n", "sconv2", "=", "batch_norm", "(", "sconv2", ",", "training", ")", "\n", "return", "relu", "(", "sconv2", "+", "input_", ")", "\n", "", "def", "relu", "(", "input_", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.relu": [[50, 52], ["ReLU"], "function", ["None"], ["", "def", "relu", "(", "input_", ")", ":", "\n", "    ", "return", "ReLU", "(", ")", "(", "input_", ")", "\n", "", "def", "lrelu", "(", "input_", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.lrelu": [[52, 54], ["LeakyReLU"], "function", ["None"], ["", "def", "lrelu", "(", "input_", ")", ":", "\n", "    ", "return", "LeakyReLU", "(", ")", "(", "input_", ")", "\n", "", "def", "avg_pooling", "(", "input_", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ",", "padding", "=", "\"same\"", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.avg_pooling": [[54, 56], ["tensorflow.keras.layers.AveragePooling2D"], "function", ["None"], ["", "def", "avg_pooling", "(", "input_", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ",", "padding", "=", "\"same\"", ")", ":", "\n", "    ", "return", "tf", ".", "keras", ".", "layers", ".", "AveragePooling2D", "(", "(", "kernel_size", ",", "kernel_size", ")", ",", "stride", ",", "padding", ")", "(", "input_", ")", "\n", "", "def", "max_pooling", "(", "input_", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ",", "padding", "=", "\"same\"", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.max_pooling": [[56, 58], ["tensorflow.keras.layers.MaxPool2D"], "function", ["None"], ["", "def", "max_pooling", "(", "input_", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ",", "padding", "=", "\"same\"", ")", ":", "\n", "    ", "return", "tf", ".", "keras", ".", "layers", ".", "MaxPool2D", "(", "(", "kernel_size", ",", "kernel_size", ")", ",", "stride", ",", "padding", ")", "(", "input_", ")", "\n", "", "def", "dropout", "(", "input_", ",", "rate", "=", "0.2", ",", "training", "=", "True", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.dropout": [[58, 63], ["tensorflow.keras.layers.Dropout"], "function", ["None"], ["", "def", "dropout", "(", "input_", ",", "rate", "=", "0.2", ",", "training", "=", "True", ")", ":", "\n", "    ", "\"\"\"\n    rate\u662f\u4e22\u6389\u591a\u5c11\u795e\u7ecf\u5143.\n    \"\"\"", "\n", "return", "tf", ".", "keras", ".", "layers", ".", "Dropout", "(", "rate", ")", "(", "input_", ",", "training", ")", "\n", "", "def", "GAP", "(", "input_", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.GAP": [[63, 65], ["GlobalAveragePooling2D"], "function", ["None"], ["", "def", "GAP", "(", "input_", ")", ":", "\n", "    ", "return", "GlobalAveragePooling2D", "(", ")", "(", "input_", ")", "\n", "", "def", "batch_norm", "(", "input_", ",", "training", "=", "True", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.batch_norm": [[65, 67], ["BatchNormalization"], "function", ["None"], ["", "def", "batch_norm", "(", "input_", ",", "training", "=", "True", ")", ":", "\n", "    ", "return", "BatchNormalization", "(", ")", "(", "input_", ",", "training", ")", "\n", "", "class", "InstanceNormalization", "(", "tf", ".", "keras", ".", "layers", ".", "Layer", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.instance_norm": [[91, 93], ["ops.InstanceNormalization"], "function", ["None"], ["", "", "def", "instance_norm", "(", "input_", ")", ":", "\n", "    ", "return", "InstanceNormalization", "(", ")", "(", "input_", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.norm": [[94, 101], ["BatchNormalization", "ops.InstanceNormalization"], "function", ["None"], ["", "def", "norm", "(", "input_", ",", "norm", "=", "'batch_norm'", ",", "training", "=", "True", ")", ":", "\n", "    ", "if", "norm", "==", "None", ":", "\n", "        ", "return", "input_", "\n", "", "elif", "norm", "==", "'batch_norm'", ":", "\n", "        ", "return", "BatchNormalization", "(", ")", "(", "input_", ",", "training", ")", "\n", "", "elif", "norm", "==", "'instance_norm'", ":", "\n", "        ", "return", "InstanceNormalization", "(", ")", "(", "input_", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.act": [[102, 109], ["ReLU", "LeakyReLU"], "function", ["None"], ["", "", "def", "act", "(", "input_", ",", "activation", "=", "'relu'", ")", ":", "\n", "    ", "if", "activation", "==", "None", ":", "\n", "        ", "return", "input_", "\n", "", "elif", "activation", "==", "'relu'", ":", "\n", "        ", "return", "ReLU", "(", ")", "(", "input_", ")", "\n", "", "elif", "activation", "==", "'lrelu'", ":", "\n", "        ", "return", "LeakyReLU", "(", "alpha", "=", "0.2", ")", "(", "input_", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.diydecay": [[111, 120], ["int"], "function", ["None"], ["", "", "def", "diydecay", "(", "steps", ",", "baselr", ",", "cycle_step", "=", "100000", ",", "decay_steps", "=", "100", ",", "decay_rate", "=", "0.96", ")", ":", "\n", "    ", "n", "=", "steps", "//", "cycle_step", "\n", "clr", "=", "baselr", "*", "(", "0.8", "**", "n", ")", "\n", "steps", "=", "steps", "-", "n", "*", "cycle_step", "\n", "k", "=", "steps", "//", "decay_steps", "\n", "i", "=", "(", "-", "1", ")", "**", "k", "\n", "step", "=", "(", "(", "i", "+", "1", ")", "/", "2", ")", "*", "steps", "-", "i", "*", "(", "(", "k", "+", "1", ")", "//", "2", ")", "*", "decay_steps", "\n", "dlr", "=", "clr", "*", "decay_rate", "**", "(", "int", "(", "step", ")", ")", "\n", "return", "dlr", "\n", "", "def", "decay", "(", "global_steps", ",", "baselr", ",", "start_decay_step", "=", "100000", ",", "cycle_step", "=", "100000", ",", "decay_steps", "=", "100", ",", "decay_rate", "=", "0.96", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.decay": [[120, 125], ["numpy.where", "numpy.greater_equal", "ops.diydecay"], "function", ["home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.diydecay"], ["", "def", "decay", "(", "global_steps", ",", "baselr", ",", "start_decay_step", "=", "100000", ",", "cycle_step", "=", "100000", ",", "decay_steps", "=", "100", ",", "decay_rate", "=", "0.96", ")", ":", "\n", "    ", "lr", "=", "np", ".", "where", "(", "np", ".", "greater_equal", "(", "global_steps", ",", "start_decay_step", ")", ",", "\n", "diydecay", "(", "global_steps", "-", "start_decay_step", ",", "baselr", ",", "cycle_step", ",", "decay_steps", ",", "decay_rate", ")", ",", "\n", "baselr", ")", "\n", "return", "lr", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.l2_loss": [[126, 128], ["tensorflow.sqrt", "tensorflow.reduce_sum"], "function", ["None"], ["", "def", "l2_loss", "(", "x", ")", ":", "\n", "    ", "return", "tf", ".", "sqrt", "(", "tf", ".", "reduce_sum", "(", "x", "**", "2", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.randomflip": [[129, 137], ["numpy.rot90", "numpy.flip"], "function", ["None"], ["", "def", "randomflip", "(", "input_", ",", "n", ")", ":", "\n", "#\u751f\u6210-3\u52302\u7684\u968f\u673a\u6574\u6570\uff0c-1\u987a\u65f6\u948890\u5ea6\uff0c-2\u987a\u65f6\u9488180\uff0c-3\u987a\u65f6\u9488270,0\u5782\u76f4\u7ffb\u8f6c\uff0c1\u6c34\u5e73\u7ffb\u8f6c\uff0c2\u4e0d\u53d8", "\n", "    ", "if", "n", "<", "0", ":", "\n", "        ", "return", "np", ".", "rot90", "(", "input_", ",", "n", ")", "\n", "", "elif", "-", "1", "<", "n", "<", "2", ":", "\n", "        ", "return", "np", ".", "flip", "(", "input_", ",", "n", ")", "\n", "", "else", ":", "\n", "        ", "return", "input_", "\n", "", "", "def", "read_img", "(", "datapath", ",", "scale", "=", "255", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.read_img": [[137, 140], ["gdaldiy.imgread"], "function", ["home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.gdaldiy.imgread"], ["", "", "def", "read_img", "(", "datapath", ",", "scale", "=", "255", ")", ":", "\n", "    ", "img", "=", "imgread", "(", "datapath", ")", "/", "scale", "\n", "return", "img", "\n", "", "def", "read_imgs", "(", "datapath", ",", "scale", "=", "255", ",", "k", "=", "2", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.read_imgs": [[140, 150], ["len", "range", "numpy.concatenate", "tensorflow.convert_to_tensor", "ops.read_img", "ops.randomflip", "img_list.append"], "function", ["home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.read_img", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.randomflip"], ["", "def", "read_imgs", "(", "datapath", ",", "scale", "=", "255", ",", "k", "=", "2", ")", ":", "\n", "    ", "img_list", "=", "[", "]", "\n", "l", "=", "len", "(", "datapath", ")", "\n", "for", "i", "in", "range", "(", "l", ")", ":", "\n", "        ", "img", "=", "read_img", "(", "datapath", "[", "i", "]", ",", "scale", ")", "\n", "img", "=", "randomflip", "(", "img", ",", "k", ")", "\n", "img", "=", "img", "[", "np", ".", "newaxis", ",", ":", "]", "\n", "img_list", ".", "append", "(", "img", ")", "\n", "", "imgs", "=", "np", ".", "concatenate", "(", "img_list", ",", "axis", "=", "0", ")", "\n", "return", "tf", ".", "convert_to_tensor", "(", "imgs", ",", "tf", ".", "float32", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.read_labels": [[151, 162], ["len", "range", "numpy.concatenate", "ops.rgb_to_gray", "tensorflow.convert_to_tensor", "gdaldiy.imgread", "ops.randomflip", "img_list.append"], "function", ["home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.rgb_to_gray", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.gdaldiy.imgread", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.randomflip"], ["", "def", "read_labels", "(", "datapath", ",", "k", "=", "2", ")", ":", "\n", "    ", "img_list", "=", "[", "]", "\n", "l", "=", "len", "(", "datapath", ")", "\n", "for", "i", "in", "range", "(", "l", ")", ":", "\n", "        ", "img", "=", "imgread", "(", "datapath", "[", "i", "]", ")", "\n", "img", "=", "randomflip", "(", "img", ",", "k", ")", "\n", "img", "=", "img", "[", "np", ".", "newaxis", ",", ":", "]", "\n", "img_list", ".", "append", "(", "img", ")", "\n", "", "imgs", "=", "np", ".", "concatenate", "(", "img_list", ",", "axis", "=", "0", ")", "\n", "imgs", "=", "rgb_to_gray", "(", "imgs", ")", "\n", "return", "tf", ".", "convert_to_tensor", "(", "imgs", ",", "tf", ".", "float32", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.rgb_to_gray": [[167, 178], ["numpy.zeros().astype", "np.zeros().astype.astype", "len", "enumerate", "enumerate", "numpy.zeros", "rgb_colors.items", "numpy.where", "rgb_colors.items", "numpy.where", "tuple", "numpy.asarray", "numpy.asarray"], "function", ["None"], ["def", "rgb_to_gray", "(", "rgb_mask", ")", ":", "\n", "    ", "label", "=", "(", "np", ".", "zeros", "(", "rgb_mask", ".", "shape", "[", ":", "3", "]", "+", "tuple", "(", "[", "1", "]", ")", ")", ")", ".", "astype", "(", "np", ".", "uint8", ")", "\n", "if", "len", "(", "rgb_mask", ".", "shape", ")", "==", "4", ":", "\n", "        ", "for", "gray", ",", "(", "class_name", ",", "rgb_values", ")", "in", "enumerate", "(", "rgb_colors", ".", "items", "(", ")", ")", ":", "\n", "            ", "match_pixs", "=", "np", ".", "where", "(", "(", "rgb_mask", "==", "np", ".", "asarray", "(", "rgb_values", ")", ")", ".", "astype", "(", "np", ".", "uint8", ")", ".", "sum", "(", "-", "1", ")", "==", "3", ")", "\n", "label", "[", "match_pixs", "]", "=", "gray", "\n", "", "", "else", ":", "\n", "        ", "for", "gray", ",", "(", "class_name", ",", "rgb_values", ")", "in", "enumerate", "(", "rgb_colors", ".", "items", "(", ")", ")", ":", "\n", "            ", "match_pixs", "=", "np", ".", "where", "(", "(", "rgb_mask", "==", "np", ".", "asarray", "(", "rgb_values", ")", ")", ".", "astype", "(", "np", ".", "uint8", ")", "==", "1", ")", "\n", "label", "[", "match_pixs", "]", "=", "gray", "\n", "", "", "return", "label", ".", "astype", "(", "np", ".", "uint8", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.label_to_rgb": [[180, 191], ["numpy.argmax", "enumerate", "np.zeros().astype.astype", "len", "numpy.zeros().astype", "numpy.zeros().astype", "rgb_colors.items", "numpy.where", "numpy.zeros", "numpy.zeros", "tuple"], "function", ["None"], ["", "def", "label_to_rgb", "(", "labels", ")", ":", "\n", "    ", "max_index", "=", "np", ".", "argmax", "(", "labels", ",", "axis", "=", "-", "1", ")", "#\u7b2c\u4e09\u7ef4\u4e0a\u6700\u5927\u503c\u7684\u7d22\u5f15\uff0c\u8fd4\u56de\u5176\u4ed6\u7ef4\u5ea6\uff0c\u5e76\u5728\u5e76\u5bf9\u4f4d\u7f6e\u586b\u4e0a\u6700\u5927\u503c\u4e4b\u7d22\u5f15", "\n", "n", "=", "len", "(", "labels", ".", "shape", ")", "-", "1", "\n", "if", "labels", ".", "shape", "[", "-", "1", "]", "<", "3", ":", "\n", "        ", "rgb", "=", "(", "np", ".", "zeros", "(", "labels", ".", "shape", "[", ":", "n", "]", ")", ")", ".", "astype", "(", "np", ".", "uint8", ")", "\n", "", "else", ":", "\n", "        ", "rgb", "=", "(", "np", ".", "zeros", "(", "labels", ".", "shape", "[", ":", "n", "]", "+", "tuple", "(", "[", "3", "]", ")", ")", ")", ".", "astype", "(", "np", ".", "uint8", ")", "\n", "", "for", "gray", ",", "(", "class_name", ",", "rgb_values", ")", "in", "enumerate", "(", "rgb_colors", ".", "items", "(", ")", ")", ":", "\n", "        ", "match_pixs", "=", "np", ".", "where", "(", "max_index", "==", "gray", ")", "\n", "rgb", "[", "match_pixs", "]", "=", "rgb_values", "\n", "", "return", "rgb", ".", "astype", "(", "np", ".", "uint8", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.down_sample": [[192, 197], ["tensorflow.one_hot", "ops.avg_pooling", "tensorflow.argmax", "tensorflow.cast"], "function", ["home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.avg_pooling"], ["", "def", "down_sample", "(", "input_", ",", "kernel_size", ",", "classes", ")", ":", "\n", "    ", "onehot", "=", "tf", ".", "one_hot", "(", "tf", ".", "cast", "(", "input_", ",", "dtype", "=", "tf", ".", "int32", ")", ",", "classes", ")", "\n", "onehot", "=", "avg_pooling", "(", "onehot", ",", "kernel_size", ",", "kernel_size", ")", "\n", "onehot", "=", "tf", ".", "argmax", "(", "onehot", ",", "axis", "=", "-", "1", ")", "\n", "return", "onehot", "", "", ""]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.CDFM3SF.CDFM3SF": [[9, 67], ["tensorflow.keras.layers.Input", "tensorflow.keras.layers.Input", "tensorflow.keras.layers.Input", "ops.relu", "ops.relu", "ops.max_pooling", "ops.relu", "tensorflow.concat", "ops.relu", "ops.max_pooling", "ops.relu", "tensorflow.concat", "ops.relu", "ops.max_pooling", "ops.relu", "ops.SDRB", "ops.SDRB", "ops.SDRB", "ops.SDRB", "ops.SDRB", "ops.SDRB", "tensorflow.concat", "ops.relu", "ops.deconv2d", "tensorflow.concat", "ops.relu", "ops.conv2d", "ops.deconv2d", "tensorflow.concat", "ops.relu", "ops.conv2d", "ops.deconv2d", "tensorflow.concat", "ops.relu", "ops.conv2d", "tensorflow.keras.Model", "ops.conv2d", "ops.batch_norm", "ops.conv2d", "ops.batch_norm", "ops.conv2d", "ops.batch_norm", "ops.batch_norm", "ops.batch_norm", "ops.batch_norm", "ops.batch_norm", "ops.batch_norm", "ops.MDSC", "ops.MDSC", "ops.MDSC", "ops.MDSC", "ops.DSC", "ops.DSC", "ops.DSC", "ops.DSC"], "function", ["home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.relu", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.relu", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.max_pooling", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.relu", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.relu", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.max_pooling", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.relu", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.relu", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.max_pooling", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.relu", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.SDRB", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.SDRB", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.SDRB", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.SDRB", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.SDRB", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.SDRB", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.relu", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.deconv2d", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.relu", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.conv2d", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.deconv2d", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.relu", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.conv2d", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.deconv2d", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.relu", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.conv2d", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.conv2d", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.batch_norm", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.conv2d", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.batch_norm", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.conv2d", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.batch_norm", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.batch_norm", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.batch_norm", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.batch_norm", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.batch_norm", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.batch_norm", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.MDSC", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.MDSC", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.MDSC", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.MDSC", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.DSC", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.DSC", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.DSC", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.DSC"], ["def", "CDFM3SF", "(", "input_dim", ",", "gf_dim", "=", "64", ",", "reuse", "=", "False", ",", "training", "=", "False", ",", "name", "=", "\"CD-FM3SF\"", ")", ":", "\n", "# dropout_rate = 0.8", "\n", "    ", "input_", "=", "tf", ".", "keras", ".", "layers", ".", "Input", "(", "shape", "=", "[", "None", ",", "None", ",", "input_dim", "[", "0", "]", "]", ")", "\n", "input_1", "=", "tf", ".", "keras", ".", "layers", ".", "Input", "(", "shape", "=", "[", "None", ",", "None", ",", "input_dim", "[", "1", "]", "]", ")", "\n", "input_2", "=", "tf", ".", "keras", ".", "layers", ".", "Input", "(", "shape", "=", "[", "None", ",", "None", ",", "input_dim", "[", "2", "]", "]", ")", "\n", "e10", "=", "relu", "(", "conv2d", "(", "input_", ",", "gf_dim", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ")", ")", "\n", "e1", "=", "relu", "(", "batch_norm", "(", "MDSC", "(", "e10", ",", "gf_dim", ",", "stride", "=", "1", ")", ",", "training", ")", ")", "\n", "e1", "=", "e10", "+", "e1", "\n", "# e1 is (128 x 128 x self.gf_dim)", "\n", "p1", "=", "max_pooling", "(", "e1", ",", "2", ",", "2", ")", "\n", "e20", "=", "relu", "(", "conv2d", "(", "input_1", ",", "gf_dim", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ")", ")", "\n", "c120", "=", "tf", ".", "concat", "(", "[", "p1", ",", "e20", "]", ",", "axis", "=", "-", "1", ")", "\n", "e2", "=", "relu", "(", "batch_norm", "(", "MDSC", "(", "c120", ",", "gf_dim", ",", "stride", "=", "1", ")", ",", "training", ")", ")", "\n", "e2", "=", "p1", "+", "e20", "+", "e2", "\n", "# e2 is (64 x 64 x self.gf_dim*2)", "\n", "p2", "=", "max_pooling", "(", "e2", ",", "3", ",", "3", ")", "\n", "e30", "=", "relu", "(", "conv2d", "(", "input_2", ",", "gf_dim", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ")", ")", "\n", "c230", "=", "tf", ".", "concat", "(", "[", "p2", ",", "e30", "]", ",", "axis", "=", "-", "1", ")", "\n", "e3", "=", "relu", "(", "batch_norm", "(", "MDSC", "(", "c230", ",", "gf_dim", ",", "stride", "=", "1", ")", ",", "training", ")", ")", "\n", "e3", "=", "p2", "+", "e30", "+", "e3", "\n", "# e3 is (32 x 32 x self.gf_dim*4)", "\n", "p3", "=", "max_pooling", "(", "e3", ",", "2", ",", "2", ")", "\n", "e4", "=", "relu", "(", "batch_norm", "(", "MDSC", "(", "p3", ",", "gf_dim", ",", "stride", "=", "1", ")", ",", "training", ")", ")", "\n", "# e3 is (32 x 32 x self.gf_dim*4)", "\n", "e4", "=", "p3", "+", "e4", "\n", "# e3 = tf.concat([e13,e3],axis=-1)", "\n", "# e3 = e3 + s3", "\n", "\n", "r1", "=", "SDRB", "(", "e4", ",", "3", ",", "1", ",", "2", ",", "training", ")", "\n", "r2", "=", "SDRB", "(", "r1", ",", "3", ",", "1", ",", "2", ",", "training", ")", "\n", "r3", "=", "SDRB", "(", "r2", ",", "3", ",", "1", ",", "3", ",", "training", ")", "\n", "r4", "=", "SDRB", "(", "r3", ",", "3", ",", "1", ",", "3", ",", "training", ")", "\n", "r5", "=", "SDRB", "(", "r4", ",", "3", ",", "1", ",", "4", ",", "training", ")", "\n", "r6", "=", "SDRB", "(", "r5", ",", "3", ",", "1", ",", "4", ",", "training", ")", "\n", "# d3 = tf.nn.dropout(d3, dropout_rate)", "\n", "d1", "=", "tf", ".", "concat", "(", "[", "e4", ",", "r2", ",", "r4", ",", "r6", "]", ",", "axis", "=", "-", "1", ")", "\n", "d1", "=", "relu", "(", "batch_norm", "(", "DSC", "(", "d1", ",", "gf_dim", "*", "2", ",", "stride", "=", "1", ")", ",", "training", ")", ")", "\n", "# d3 is (32 x 32 x self.gf_dim*8*2)", "\n", "d1", "=", "deconv2d", "(", "d1", ",", "gf_dim", ",", "stride", "=", "2", ")", "\n", "# d4 = tf.nn.dropout(d4, dropout_rate)", "\n", "d1", "=", "tf", ".", "concat", "(", "[", "d1", ",", "e3", "]", ",", "3", ")", "\n", "d1", "=", "relu", "(", "batch_norm", "(", "DSC", "(", "d1", ",", "gf_dim", ",", "stride", "=", "1", ")", ",", "training", ")", ")", "\n", "output3", "=", "conv2d", "(", "d1", ",", "1", ",", "stride", "=", "1", ")", "\n", "# d3 is (32 x 32 x self.gf_dim*8*2)", "\n", "d2", "=", "deconv2d", "(", "d1", ",", "gf_dim", ",", "stride", "=", "3", ")", "\n", "# d4 = tf.nn.dropout(d4, dropout_rate)", "\n", "d2", "=", "tf", ".", "concat", "(", "[", "d2", ",", "e2", "]", ",", "3", ")", "\n", "d2", "=", "relu", "(", "batch_norm", "(", "DSC", "(", "d2", ",", "gf_dim", ",", "stride", "=", "1", ")", ",", "training", ")", ")", "\n", "# d4 is (16 x 16 x self.gf_dim*8*2)", "\n", "output2", "=", "conv2d", "(", "d2", ",", "1", ",", "stride", "=", "1", ")", "\n", "d3", "=", "deconv2d", "(", "d2", ",", "gf_dim", ")", "\n", "# d5 = tf.nn.dropout(d5, dropout_rate)", "\n", "d3", "=", "tf", ".", "concat", "(", "[", "d3", ",", "e1", "]", ",", "3", ")", "\n", "# d5 is (32 x 32 x self.gf_dim*4*2)", "\n", "d3", "=", "relu", "(", "batch_norm", "(", "DSC", "(", "d3", ",", "gf_dim", ",", "stride", "=", "1", ")", ",", "training", ")", ")", "\n", "output1", "=", "conv2d", "(", "d3", ",", "1", ",", "stride", "=", "1", ")", "\n", "# d8 is (256 x 256 x output_c_dim)", "\n", "return", "tf", ".", "keras", ".", "Model", "(", "[", "input_", ",", "input_1", ",", "input_2", "]", ",", "[", "output1", ",", "output2", ",", "output3", "]", ",", "name", "=", "name", ")", "\n", "# model = generator_unet([4,6,3])", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.maintrain.__init__": [[97, 102], ["object.__init__", "CDFM3SF.CDFM3SF.CDFM3SF", "tensorflow.keras.optimizers.Adam", "tensorflow.train.Checkpoint"], "methods", ["home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.maintrain.__init__", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.CDFM3SF.CDFM3SF"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", "maintrain", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "Net", "=", "CDFM3SF", "(", "args", ".", "bands", ",", "training", "=", "True", ",", "name", "=", "\"CD-FM3SF\"", ")", "\n", "self", ".", "ag_optimizer", "=", "tf", ".", "keras", ".", "optimizers", ".", "Adam", "(", "args", ".", "base_lr", ",", "args", ".", "beta1", ",", "args", ".", "beta2", ")", "\n", "self", ".", "ckpt", "=", "tf", ".", "train", ".", "Checkpoint", "(", "Net", "=", "self", ".", "Net", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.maintrain.train_step": [[103, 123], ["train.maintrain.ag_optimizer.lr.assign", "a_tape.gradient", "train.maintrain.ag_optimizer.apply_gradients", "tensorflow.GradientTape", "train.maintrain.Net", "range", "zip", "tensorflow.nn.sigmoid", "len", "tensorflow.reduce_mean", "loss_list.append", "tensorflow.expand_dims", "tensorflow.nn.sigmoid_cross_entropy_with_logits", "ops.down_sample", "tensorflow.cast"], "methods", ["home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.down_sample"], ["", "@", "tf", ".", "function", "\n", "def", "train_step", "(", "self", ",", "image_list", ",", "label", ",", "lr", ")", ":", "\n", "        ", "self", ".", "ag_optimizer", ".", "lr", ".", "assign", "(", "lr", ")", "\n", "with", "tf", ".", "GradientTape", "(", "persistent", "=", "True", ")", "as", "a_tape", ":", "\n", "            ", "logits", "=", "self", ".", "Net", "(", "image_list", ")", "\n", "loss_list", "=", "[", "]", "\n", "loss_w_list", "=", "[", "1", ",", "0.1", ",", "0.01", "]", "\n", "cost_sum", "=", "0", "\n", "labels", "=", "label", "\n", "down_list", "=", "[", "1", ",", "2", ",", "6", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "image_list", ")", ")", ":", "\n", "                ", "if", "i", ">", "0", ":", "\n", "                    ", "labels", "=", "tf", ".", "expand_dims", "(", "down_sample", "(", "label", "[", ":", ",", ":", ",", ":", ",", "0", "]", ",", "down_list", "[", "i", "]", ",", "2", ")", ",", "-", "1", ")", "\n", "", "cost", "=", "tf", ".", "reduce_mean", "(", "tf", ".", "nn", ".", "sigmoid_cross_entropy_with_logits", "(", "labels", "=", "tf", ".", "cast", "(", "labels", ",", "dtype", "=", "tf", ".", "float32", ")", ",", "logits", "=", "logits", "[", "i", "]", ")", ")", "\n", "loss_list", ".", "append", "(", "cost", ")", "\n", "cost_sum", "=", "cost_sum", "+", "cost", "*", "loss_w_list", "[", "i", "]", "\n", "", "", "grads_ag", "=", "a_tape", ".", "gradient", "(", "cost_sum", ",", "self", ".", "Net", ".", "trainable_variables", ")", "\n", "self", ".", "ag_optimizer", ".", "apply_gradients", "(", "zip", "(", "grads_ag", ",", "self", ".", "Net", ".", "trainable_variables", ")", ")", "\n", "\n", "return", "cost_sum", ",", "tf", ".", "nn", ".", "sigmoid", "(", "logits", "[", "0", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.maintrain.train": [[124, 173], ["print", "tensorflow.summary.create_file_writer", "tensorflow.train.CheckpointManager", "len", "range", "train.maintrain.ckpt.restore", "print", "int", "random.shuffle", "name.replace", "name.replace", "name.replace", "numpy.random.randint", "ops.read_imgs", "ops.read_imgs", "ops.read_imgs", "ops.read_labels", "tensorflow.convert_to_tensor", "train.maintrain.train_step", "tensorflow.train.CheckpointManager.save", "exit", "path.split", "ops.decay", "tensorflow.train.CheckpointManager.save", "train.get_write_picture", "gdaldiy.imgwrite", "print", "tensorflow.summary.create_file_writer.as_default", "tensorflow.summary.scalar", "ops.read_imgs.numpy", "ops.read_labels.numpy", "logitss.numpy", "numpy.uint8", "str", "str", "l.numpy", "l.numpy", "str", "str"], "methods", ["home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.read_imgs", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.read_imgs", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.read_imgs", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.read_labels", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.maintrain.train_step", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.save", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.ops.decay", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.save", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.get_write_picture", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.gdaldiy.imgwrite"], ["", "def", "train", "(", "self", ",", "x_datalists", ",", "y_datalists", ")", ":", "\n", "        ", "print", "(", "'Start Training'", ")", "\n", "#\u5b58\u50a8\u8bad\u7ec3\u65e5\u5fd7", "\n", "train_summary_writer", "=", "tf", ".", "summary", ".", "create_file_writer", "(", "args", ".", "snapshot_dir", ")", "\n", "ckpt_manager", "=", "tf", ".", "train", ".", "CheckpointManager", "(", "self", ".", "ckpt", ",", "args", ".", "snapshot_dir", ",", "max_to_keep", "=", "100", ")", "\n", "if", "ckpt_manager", ".", "latest_checkpoint", ":", "\n", "            ", "self", ".", "ckpt", ".", "restore", "(", "ckpt_manager", ".", "latest_checkpoint", ")", "\n", "print", "(", "'Latest checkpoint restored!!'", ")", "\n", "path", "=", "ckpt_manager", ".", "latest_checkpoint", "\n", "step", "=", "int", "(", "path", ".", "split", "(", "'-'", ")", "[", "-", "1", "]", ")", "\n", "", "else", ":", "\n", "            ", "step", "=", "1", "\n", "", "leny", "=", "len", "(", "y_datalists", ")", "\n", "start_epoch", "=", "(", "step", "*", "args", ".", "batch_size", ")", "//", "leny", "+", "1", "\n", "start", "=", "(", "step", "-", "(", "start_epoch", "-", "1", ")", "*", "(", "leny", "//", "args", ".", "batch_size", ")", ")", "*", "args", ".", "batch_size", "\n", "for", "epoch", "in", "range", "(", "start_epoch", ",", "args", ".", "epoch", ")", ":", "#\u8bad\u7ec3epoch\u6570       ", "\n", "#\u6bcf\u8bad\u7ec3\u4e00\u4e2aepoch\uff0c\u5c31\u6253\u4e71\u4e00\u4e0bx\u57df\u56fe\u50cf\u987a\u5e8f", "\n", "            ", "shuffle", "(", "y_datalists", ")", "#\u6bcf\u8bad\u7ec3\u4e00\u4e2aepoch\uff0c\u5c31\u6253\u4e71\u4e00\u4e0by\u57df\u56fe\u50cf\u987a\u5e8f           ", "\n", "data_list", "=", "[", "name", ".", "replace", "(", "'labelclips'", ",", "'DNclips'", ")", "for", "name", "in", "y_datalists", "]", "\n", "data_list1", "=", "[", "name", ".", "replace", "(", "'10m'", ",", "'20m'", ")", "for", "name", "in", "data_list", "]", "\n", "data_list2", "=", "[", "name", ".", "replace", "(", "'10m'", ",", "'60m'", ")", "for", "name", "in", "data_list", "]", "\n", "while", "(", "start", "+", "args", ".", "batch_size", ")", "<", "leny", ":", "\n", "                ", "k", "=", "np", ".", "random", ".", "randint", "(", "low", "=", "-", "3", ",", "high", "=", "3", ")", "\n", "batch_input_img", "=", "read_imgs", "(", "data_list", "[", "start", ":", "start", "+", "args", ".", "batch_size", "]", ",", "10000", ",", "k", ")", "\n", "batch_input_img1", "=", "read_imgs", "(", "data_list1", "[", "start", ":", "start", "+", "args", ".", "batch_size", "]", ",", "10000", ",", "k", ")", "\n", "batch_input_img2", "=", "read_imgs", "(", "data_list2", "[", "start", ":", "start", "+", "args", ".", "batch_size", "]", ",", "10000", ",", "k", ")", "\n", "batch_input_label", "=", "read_labels", "(", "y_datalists", "[", "start", ":", "start", "+", "args", ".", "batch_size", "]", ",", "k", ")", "\n", "lr", "=", "tf", ".", "convert_to_tensor", "(", "decay", "(", "step", ",", "args", ".", "base_lr", ")", ",", "tf", ".", "float32", ")", "\n", "l", ",", "logitss", "=", "self", ".", "train_step", "(", "[", "batch_input_img", ",", "batch_input_img1", ",", "batch_input_img2", "]", ",", "\n", "batch_input_label", ",", "\n", "lr", ")", "#\u5f97\u5230\u6bcf\u4e2astep\u4e2d\u7684\u751f\u6210\u5668\u548c\u5224\u522b\u5668loss", "\n", "step", "=", "step", "+", "1", "\n", "start", "=", "start", "+", "args", ".", "batch_size", "\n", "if", "step", "%", "args", ".", "summary_pred_every", "==", "0", ":", "#\u6bcf\u8fc7summary_pred_every\u6b21\u4fdd\u5b58\u8bad\u7ec3\u65e5\u5fd7", "\n", "                    ", "with", "train_summary_writer", ".", "as_default", "(", ")", ":", "\n", "                        ", "tf", ".", "summary", ".", "scalar", "(", "'loss'", ",", "l", ".", "numpy", "(", ")", ",", "step", ")", "\n", "", "", "if", "step", "%", "args", ".", "save_pred_every", "==", "0", ":", "#\u6bcf\u8fc7summary_pred_every\u6b21\u4fdd\u5b58\u8bad\u7ec3\u65e5\u5fd7", "\n", "                    ", "ckpt_manager", ".", "save", "(", "checkpoint_number", "=", "step", ")", "\n", "", "if", "step", "%", "args", ".", "write_pred_every", "==", "0", ":", "#\u6bcf\u8fc7write_pred_every\u6b21\u5199\u4e00\u4e0b\u8bad\u7ec3\u7684\u53ef\u89c6\u5316\u7ed3\u679c", "\n", "                    ", "write_image", "=", "get_write_picture", "(", "batch_input_img", ".", "numpy", "(", ")", ",", "\n", "batch_input_label", ".", "numpy", "(", ")", ",", "\n", "logitss", ".", "numpy", "(", ")", ")", "#\u5f97\u5230\u8bad\u7ec3\u7684\u53ef\u89c6\u5316\u7ed3\u679c", "\n", "write_image_name", "=", "args", ".", "out_dir", "+", "\"/out\"", "+", "str", "(", "epoch", ")", "+", "'_'", "+", "str", "(", "step", ")", "+", "\".png\"", "#\u5f85\u4fdd\u5b58\u7684\u8bad\u7ec3\u53ef\u89c6\u5316\u7ed3\u679c\u8def\u5f84\u4e0e\u540d\u79f0", "\n", "imgwrite", "(", "write_image_name", ",", "np", ".", "uint8", "(", "write_image", ")", ")", "#\u4fdd\u5b58\u8bad\u7ec3\u7684\u53ef\u89c6\u5316\u7ed3\u679c", "\n", "print", "(", "str", "(", "epoch", ")", ",", "str", "(", "step", ")", ",", "l", ".", "numpy", "(", ")", ")", "\n", "", "", "start", "=", "0", "\n", "if", "epoch", "==", "40", ":", "\n", "                ", "ckpt_manager", ".", "save", "(", "checkpoint_number", "=", "epoch", ")", "\n", "exit", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.save": [[53, 60], ["os.path.join", "os.path.join", "saver.save", "print", "os.path.exists", "os.path.exists", "os.makedirs", "os.makedirs"], "function", ["home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.save"], ["def", "save", "(", "saver", ",", "sess", ",", "logdir", ",", "step", ")", ":", "#\u4fdd\u5b58\u6a21\u578b\u7684save\u51fd\u6570", "\n", "   ", "model_name", "=", "'model'", "#\u4fdd\u5b58\u7684\u6a21\u578b\u540d\u524d\u7f00", "\n", "checkpoint_path", "=", "os", ".", "path", ".", "join", "(", "logdir", ",", "model_name", ")", "#\u6a21\u578b\u7684\u4fdd\u5b58\u8def\u5f84\u4e0e\u540d\u79f0", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "logdir", ")", ":", "#\u5982\u679c\u8def\u5f84\u4e0d\u5b58\u5728\u5373\u521b\u5efa", "\n", "      ", "os", ".", "makedirs", "(", "logdir", ")", "\n", "", "saver", ".", "save", "(", "sess", ",", "checkpoint_path", ",", "global_step", "=", "step", ")", "#\u4fdd\u5b58\u6a21\u578b", "\n", "print", "(", "'The checkpoint has been created.'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.cv_inv_proc": [[61, 64], ["img_rgb.astype"], "function", ["None"], ["", "def", "cv_inv_proc", "(", "img", ")", ":", "#cv_inv_proc\u51fd\u6570\u5c06\u8bfb\u53d6\u56fe\u7247\u65f6\u5f52\u4e00\u5316\u7684\u56fe\u7247\u8fd8\u539f\u6210\u539f\u56fe", "\n", "    ", "img_rgb", "=", "(", "img", "+", "1", ")", "*", "127.5", "\n", "return", "img_rgb", ".", "astype", "(", "np", ".", "float32", ")", "#\u8fd4\u56debgr\u683c\u5f0f\u7684\u56fe\u50cf\uff0c\u65b9\u4fbfcv2\u5199\u56fe\u50cf", "\n", "", "def", "acv_inv_proc", "(", "img", ")", ":", "#cv_inv_proc\u51fd\u6570\u5c06\u8bfb\u53d6\u56fe\u7247\u65f6\u5f52\u4e00\u5316\u7684\u56fe\u7247\u8fd8\u539f\u6210\u539f\u56fe", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.acv_inv_proc": [[64, 67], ["img_rgb.astype"], "function", ["None"], ["", "def", "acv_inv_proc", "(", "img", ")", ":", "#cv_inv_proc\u51fd\u6570\u5c06\u8bfb\u53d6\u56fe\u7247\u65f6\u5f52\u4e00\u5316\u7684\u56fe\u7247\u8fd8\u539f\u6210\u539f\u56fe", "\n", "    ", "img_rgb", "=", "img", "*", "255.0", "\n", "return", "img_rgb", ".", "astype", "(", "np", ".", "float32", ")", "#\u8fd4\u56debgr\u683c\u5f0f\u7684\u56fe\u50cf\uff0c\u65b9\u4fbfcv2\u5199\u56fe\u50cf ", "\n", "", "def", "get_write_picture", "(", "batch_x_image", ",", "batch_label_image", ",", "pre", ")", ":", "#get_write_picture\u51fd\u6570\u5f97\u5230\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\u7684\u53ef\u89c6\u5316\u7ed3\u679c", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.get_write_picture": [[67, 79], ["numpy.percentile", "train.acv_inv_proc", "train.acv_inv_proc", "numpy.concatenate", "numpy.concatenate", "numpy.concatenate"], "function", ["home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.acv_inv_proc", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.acv_inv_proc"], ["", "def", "get_write_picture", "(", "batch_x_image", ",", "batch_label_image", ",", "pre", ")", ":", "#get_write_picture\u51fd\u6570\u5f97\u5230\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\u7684\u53ef\u89c6\u5316\u7ed3\u679c", "\n", "    ", "batch_x_image", "=", "batch_x_image", "[", "0", "]", "[", ":", ",", ":", ",", "[", "0", ",", "1", ",", "2", "]", "]", "\n", "low", ",", "high", "=", "np", ".", "percentile", "(", "batch_x_image", ",", "(", "2", ",", "98", ")", ")", "\n", "batch_x_image", "[", "low", ">", "batch_x_image", "]", "=", "low", "\n", "batch_x_image", "[", "batch_x_image", ">", "high", "]", "=", "high", "\n", "rescaled_img", "=", "(", "batch_x_image", "-", "low", ")", "/", "(", "high", "-", "low", ")", "\n", "x_image", "=", "acv_inv_proc", "(", "rescaled_img", ")", "#\u8fd8\u539fx\u57df\u7684\u56fe\u50cf", "\n", "\n", "label", "=", "batch_label_image", "[", "0", "]", "*", "255", "#\u8fd8\u539fx\u57df\u7684\u56fe\u50cf", "\n", "pre", "=", "acv_inv_proc", "(", "pre", "[", "0", "]", ">", "0.5", ")", "#\u8fd8\u539fy\u57df\u7684\u56fe\u50cf", "\n", "row1", "=", "np", ".", "concatenate", "(", "(", "x_image", ",", "np", ".", "concatenate", "(", "(", "label", ",", "label", ",", "label", ")", ",", "axis", "=", "2", ")", ",", "np", ".", "concatenate", "(", "(", "pre", ",", "pre", ",", "pre", ")", ",", "axis", "=", "2", ")", ")", ",", "axis", "=", "1", ")", "#\u5f97\u5230\u8bad\u7ec3\u4e2d\u53ef\u89c6\u5316\u7ed3\u679c\u7684\u7b2c\u4e00\u884c", "\n", "return", "row1", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.make_train_data_list": [[80, 88], ["glob.glob", "range", "os.path.join", "os.path.join", "len", "glob.glob", "range", "os.path.join", "os.path.join", "len", "image_path_lists.append"], "function", ["None"], ["", "def", "make_train_data_list", "(", "data_path", ")", ":", "#make_train_data_list\u51fd\u6570\u5f97\u5230\u8bad\u7ec3\u4e2d\u7684x\u57df\u548cy\u57df\u7684\u56fe\u50cf\u8def\u5f84\u540d\u79f0\u5217\u8868", "\n", "    ", "filepath", "=", "glob", ".", "glob", "(", "os", ".", "path", ".", "join", "(", "data_path", ",", "\"*\"", ")", ")", "#\u8bfb\u53d6\u5168\u90e8\u7684x\u57df\u56fe\u50cf\u8def\u5f84\u540d\u79f0\u5217\u8868", "\n", "image_path_lists", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "filepath", ")", ")", ":", "\n", "         ", "path", "=", "glob", ".", "glob", "(", "os", ".", "path", ".", "join", "(", "filepath", "[", "i", "]", ",", "\"*\"", ")", ")", "\n", "for", "j", "in", "range", "(", "len", "(", "path", ")", ")", ":", "\n", "             ", "image_path_lists", ".", "append", "(", "path", "[", "j", "]", ")", "#\u5c06x\u57df\u56fe\u50cf\u6570\u91cf\u4e0ey\u57df\u56fe\u50cf\u6570\u91cf\u5bf9\u9f50", "\n", "", "", "return", "image_path_lists", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.l1_loss": [[89, 91], ["tensorflow.reduce_mean", "tensorflow.abs", "tensorflow.cast", "tensorflow.cast"], "function", ["None"], ["", "def", "l1_loss", "(", "src", ",", "dst", ")", ":", "#\u5b9a\u4e49l1_loss", "\n", "    ", "return", "tf", ".", "reduce_mean", "(", "tf", ".", "abs", "(", "tf", ".", "cast", "(", "src", ",", "tf", ".", "float32", ")", "-", "tf", ".", "cast", "(", "dst", ",", "tf", ".", "float32", ")", ")", ")", "\n", "", "def", "l2_loss", "(", "x", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.l2_loss": [[91, 93], ["tensorflow.sqrt", "tensorflow.reduce_sum"], "function", ["None"], ["", "def", "l2_loss", "(", "x", ")", ":", "\n", "    ", "return", "tf", ".", "sqrt", "(", "tf", ".", "reduce_sum", "(", "x", "**", "2", ")", ")", "\n", "", "def", "gan_loss", "(", "src", ",", "dst", ")", ":", "#\u5b9a\u4e49gan_loss\uff0c\u5728\u8fd9\u91cc\u7528\u4e86\u4e8c\u8303\u6570", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.gan_loss": [[93, 95], ["tensorflow.reduce_mean", "tensorflow.cast", "tensorflow.cast"], "function", ["None"], ["", "def", "gan_loss", "(", "src", ",", "dst", ")", ":", "#\u5b9a\u4e49gan_loss\uff0c\u5728\u8fd9\u91cc\u7528\u4e86\u4e8c\u8303\u6570", "\n", "    ", "return", "tf", ".", "reduce_mean", "(", "(", "tf", ".", "cast", "(", "src", ",", "tf", ".", "float32", ")", "-", "tf", ".", "cast", "(", "dst", ",", "tf", ".", "float32", ")", ")", "**", "2", ")", "\n", "", "class", "maintrain", "(", "object", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.main": [[174, 186], ["tensorflow.config.experimental.list_physical_devices", "tensorflow.config.experimental.set_memory_growth", "train.make_train_data_list", "train.make_train_data_list", "train.maintrain", "maintrain.train", "os.path.exists", "os.path.exists", "os.makedirs", "os.makedirs", "os.path.exists", "os.path.exists", "os.makedirs", "os.makedirs"], "function", ["home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.make_train_data_list", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.make_train_data_list", "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.train.maintrain.train"], ["", "", "", "", "def", "main", "(", ")", ":", "\n", "    ", "gpus", "=", "tf", ".", "config", ".", "experimental", ".", "list_physical_devices", "(", "device_type", "=", "'GPU'", ")", "#\u83b7\u53d6GPU\u5217\u8868", "\n", "tf", ".", "config", ".", "experimental", ".", "set_memory_growth", "(", "gpus", "[", "0", "]", ",", "True", ")", "#\u8bbe\u7f6eGPU\u52a8\u6001\u7533\u8bf7)])", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "args", ".", "snapshot_dir", ")", ":", "#\u5982\u679c\u4fdd\u5b58\u6a21\u578b\u53c2\u6570\u7684\u6587\u4ef6\u5939\u4e0d\u5b58\u5728\u5219\u521b\u5efa", "\n", "        ", "os", ".", "makedirs", "(", "args", ".", "snapshot_dir", ")", "\n", "", "if", "not", "os", ".", "path", ".", "exists", "(", "args", ".", "out_dir", ")", ":", "#\u5982\u679c\u4fdd\u5b58\u8bad\u7ec3\u4e2d\u53ef\u89c6\u5316\u8f93\u51fa\u7684\u6587\u4ef6\u5939\u4e0d\u5b58\u5728\u5219\u521b\u5efa", "\n", "        ", "os", ".", "makedirs", "(", "args", ".", "out_dir", ")", "\n", "", "x_datalists", "=", "make_train_data_list", "(", "args", ".", "x_train_data_path", ")", "#\u5f97\u5230\u6570\u91cf\u76f8\u540c\u7684x\u57df\u548cy\u57df\u56fe\u50cf\u8def\u5f84\u540d\u79f0\u5217\u8868", "\n", "y_datalists", "=", "make_train_data_list", "(", "args", ".", "y_train_data_path", ")", "\n", "\n", "maintrain_object", "=", "maintrain", "(", ")", "\n", "maintrain_object", ".", "train", "(", "x_datalists", ",", "y_datalists", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.gdaldiy.imgread": [[14, 26], ["gdal.Open", "gdal.Open.ReadAsArray", "img_arr.swapaxes.swapaxes", "img_arr.swapaxes.swapaxes"], "function", ["None"], ["def", "imgread", "(", "path", ")", ":", "\n", "    ", "img", "=", "gdal", ".", "Open", "(", "path", ")", "\n", "# col = img.RasterXSize #col", "\n", "# row = img.RasterYSize #row", "\n", "# img_arr = img.ReadAsArray(0,0,col,row) #\u8bbe\u7f6e\u8bfb\u53d6\u56fe\u50cf\u7684\u8303\u56f4(\u5bbd/\u9ad8)", "\n", "c", "=", "img", ".", "RasterCount", "\n", "img_arr", "=", "img", ".", "ReadAsArray", "(", ")", "#\u8bfb\u53d6\u6574\u5e45\u56fe\u50cf", "\n", "if", "c", ">", "1", ":", "\n", "        ", "img_arr", "=", "img_arr", ".", "swapaxes", "(", "1", ",", "0", ")", "\n", "img_arr", "=", "img_arr", ".", "swapaxes", "(", "2", ",", "1", ")", "\n", "", "del", "img", "\n", "return", "img_arr", "\n", "", "def", "imgwrite", "(", "path", ",", "narray", ",", "compress", "=", "\"None\"", ")", ":", "\n"]], "home.repos.pwc.inspect_result.Neooolee_WHUS2-CD.None.gdaldiy.imgwrite": [[26, 48], ["range", "len", "len", "gdal.GetDriverByName", "gdal.GetDriverByName.Create", "driver.Create.GetRasterBand().WriteArray", "dt_name.lower", "len", "gdal.GetDriverByName", "gdal.GetDriverByName.Create", "range", "driver.Create.GetRasterBand", "driver.Create.GetRasterBand().WriteArray", "driver.Create.GetRasterBand"], "function", ["None"], ["", "def", "imgwrite", "(", "path", ",", "narray", ",", "compress", "=", "\"None\"", ")", ":", "\n", "    ", "s", "=", "narray", ".", "shape", "\n", "dt_name", "=", "narray", ".", "dtype", ".", "name", "\n", "for", "i", "in", "range", "(", "len", "(", "list1", ")", ")", ":", "\n", "        ", "if", "list1", "[", "i", "]", "in", "dt_name", ".", "lower", "(", ")", ":", "\n", "            ", "datatype", "=", "list2", "[", "i", "]", "\n", "break", "\n", "", "else", ":", "\n", "            ", "datatype", "=", "list2", "[", "0", "]", "\n", "", "", "if", "len", "(", "s", ")", "==", "2", ":", "\n", "        ", "row", ",", "col", ",", "c", "=", "s", "[", "0", "]", ",", "s", "[", "1", "]", ",", "1", "\n", "driver", "=", "gdal", ".", "GetDriverByName", "(", "'GTiff'", ")", "\n", "dataset", "=", "driver", ".", "Create", "(", "path", ",", "col", ",", "row", ",", "c", ",", "datatype", ",", "options", "=", "[", "\"COMPRESS=\"", "+", "compress", "]", ")", "#GDAL\u5b58\u50a8\u4e3a\u5bbd/\u957f/\u6ce2\u6bb5->\u5217/\u884c/\u901a\u9053", "\n", "dataset", ".", "GetRasterBand", "(", "1", ")", ".", "WriteArray", "(", "narray", ")", "\n", "del", "dataset", "\n", "", "elif", "len", "(", "s", ")", "==", "3", ":", "\n", "        ", "row", ",", "col", ",", "c", "=", "s", "[", "0", "]", ",", "s", "[", "1", "]", ",", "s", "[", "2", "]", "\n", "driver", "=", "gdal", ".", "GetDriverByName", "(", "'GTiff'", ")", "\n", "dataset", "=", "driver", ".", "Create", "(", "path", ",", "col", ",", "row", ",", "c", ",", "datatype", ")", "\n", "for", "i", "in", "range", "(", "c", ")", ":", "\n", "            ", "dataset", ".", "GetRasterBand", "(", "i", "+", "1", ")", ".", "WriteArray", "(", "narray", "[", ":", ",", ":", ",", "i", "]", ")", "\n", "", "del", "dataset", "\n", "", "", ""]]}