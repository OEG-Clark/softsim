{"home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.models.JunyukRecurrentNet.__init__": [[7, 65], ["tensorflow.split", "tensorflow.shape", "tensorflow.variable_scope", "tensorflow.contrib.rnn.BasicLSTMCell", "range", "tensorflow.reshape", "tensorflow.layers.conv2d", "tensorflow.layers.conv2d", "tensorflow.layers.conv2d", "numpy.prod", "tensorflow.reshape", "tensorflow.layers.dense", "tensorflow.contrib.rnn.BasicLSTMCell.", "tensorflow.layers.dense", "tensorflow.reshape", "tensorflow.layers.conv2d_transpose", "tensorflow.layers.conv2d_transpose", "tensorflow.layers.conv2d_transpose", "outputs.append", "tensorflow.concat", "tensorflow.stack", "tensorflow.concat", "tensorflow.shape", "tensorflow.layers.conv2d.get_shape"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "OBS", ",", "STATE", ",", "FLAGS", ",", "scope", "=", "\"\"", ",", "num_channels", "=", "12", ",", "reuse", "=", "False", ",", "nlstm", "=", "1024", ",", "num_steps", "=", "10", ",", "self_predict", "=", "False", ",", "label", "=", "None", ")", ":", "\n", "        ", "self", ".", "num_channels", "=", "num_channels", "\n", "self", ".", "STATE", "=", "tf", ".", "split", "(", "STATE", "[", "0", "]", ",", "2", ",", "axis", "=", "1", ")", "\n", "batch_size", "=", "tf", ".", "shape", "(", "OBS", ")", "[", "0", "]", "\n", "\n", "\"\"\"Otherwise use a autoregressive model\"\"\"", "\n", "self", ".", "OBS", "=", "OBS", "\n", "\n", "with", "tf", ".", "variable_scope", "(", "\"conv_model_\"", "+", "scope", ",", "reuse", "=", "reuse", ")", ":", "\n", "            ", "input_val", "=", "self", ".", "OBS", "\n", "outputs", "=", "[", "]", "\n", "state", "=", "self", ".", "STATE", "\n", "lstm", "=", "tf", ".", "contrib", ".", "rnn", ".", "BasicLSTMCell", "(", "nlstm", ",", "name", "=", "'prod_lstm'", ")", "\n", "\n", "for", "i", "in", "range", "(", "num_steps", ")", ":", "\n", "                ", "conv1", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "input_val", ",", "filters", "=", "64", ",", "kernel_size", "=", "(", "8", ",", "8", ")", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'c1'", ",", "\n", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "conv2", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "conv1", ",", "filters", "=", "128", ",", "kernel_size", "=", "(", "6", ",", "6", ")", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'c2'", ",", "\n", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "conv3", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "conv2", ",", "filters", "=", "128", ",", "kernel_size", "=", "(", "4", ",", "4", ")", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'c3'", ",", "\n", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "nh", "=", "np", ".", "prod", "(", "[", "v", ".", "value", "for", "v", "in", "conv3", ".", "get_shape", "(", ")", "[", "1", ":", "]", "]", ")", "\n", "\n", "flat", "=", "tf", ".", "reshape", "(", "conv3", ",", "[", "batch_size", ",", "nh", "]", ")", "\n", "\n", "fc1", "=", "tf", ".", "layers", ".", "dense", "(", "flat", ",", "1024", ",", "name", "=", "'pre_rec_fc'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "reuse", "=", "reuse", ")", "\n", "\n", "output", ",", "state", "=", "lstm", "(", "fc1", ",", "state", ")", "\n", "\n", "if", "i", "==", "0", ":", "\n", "                    ", "state_next", "=", "state", "\n", "\n", "", "output", "=", "tf", ".", "layers", ".", "dense", "(", "output", ",", "128", "*", "11", "*", "11", ",", "reuse", "=", "reuse", ",", "name", "=", "'deconv_dense'", ")", "\n", "output", "=", "tf", ".", "reshape", "(", "output", ",", "(", "batch_size", ",", "128", ",", "11", ",", "11", ")", ")", "\n", "\n", "deconv1", "=", "tf", ".", "layers", ".", "conv2d_transpose", "(", "output", ",", "128", ",", "kernel_size", "=", "(", "4", ",", "4", ")", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'deconv1'", ",", "\n", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "deconv2", "=", "tf", ".", "layers", ".", "conv2d_transpose", "(", "deconv1", ",", "128", ",", "kernel_size", "=", "(", "6", ",", "6", ")", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'deconv2'", ",", "\n", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "deconv3", "=", "tf", ".", "layers", ".", "conv2d_transpose", "(", "deconv2", ",", "3", ",", "kernel_size", "=", "(", "8", ",", "8", ")", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'deconv3'", ",", "\n", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "\n", "new_input_val", "=", "deconv3", "[", ":", ",", ":", ",", "2", ":", "-", "2", ",", "2", ":", "-", "2", "]", "\n", "outputs", ".", "append", "(", "new_input_val", ")", "\n", "input_val", "=", "tf", ".", "concat", "(", "[", "input_val", "[", ":", ",", "3", ":", ",", ":", ",", ":", "]", ",", "new_input_val", "]", ",", "axis", "=", "1", ")", "\n", "reuse", "=", "True", "\n", "\n", "final_output", "=", "tf", ".", "stack", "(", "outputs", ",", "axis", "=", "1", ")", "\n", "\n", "", "final_output", "=", "tf", ".", "reshape", "(", "final_output", ",", "(", "tf", ".", "shape", "(", "final_output", ")", "[", "0", "]", ",", "num_steps", "*", "3", ",", "84", ",", "84", ")", ")", "\n", "self", ".", "final_output", "=", "final_output", "\n", "self", ".", "final_state", "=", "[", "tf", ".", "concat", "(", "state_next", ",", "axis", "=", "1", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.models.PhysNetV2.__init__": [[68, 133], ["tensorflow.reshape", "tensorflow.shape", "tensorflow.variable_scope", "range", "tensorflow.stack", "tensorflow.layers.conv2d", "utils.residual_block", "tensorflow.layers.conv2d", "utils.residual_block", "tensorflow.reshape", "states.append", "tensorflow.reshape", "utils.residual_block", "tensorflow.layers.conv2d_transpose", "utils.residual_block", "tensorflow.layers.conv2d_transpose", "tensorflow.reshape", "outputs.append", "tensorflow.concat", "tensorflow.clip_by_value", "utils.convlstm", "utils.spatial_mem", "tensorflow.shape"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.residual_block", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.residual_block", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.residual_block", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.residual_block", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.convlstm", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.spatial_mem"], ["    ", "def", "__init__", "(", "self", ",", "OBS", ",", "STATE", ",", "FLAGS", ",", "scope", "=", "\"\"", ",", "num_channels", "=", "12", ",", "reuse", "=", "False", ",", "num_steps", "=", "10", ",", "self_predict", "=", "False", ",", "label", "=", "None", ",", "bypass_res", "=", "False", ",", "training", "=", "False", ")", ":", "\n", "        ", "self", ".", "num_channels", "=", "num_channels", "\n", "self", ".", "STATE", "=", "STATE", "\n", "batch_size", "=", "tf", ".", "shape", "(", "OBS", ")", "[", "0", "]", "\n", "\n", "\"\"\"Otherwise use a autoregressive model\"\"\"", "\n", "self", ".", "OBS", "=", "OBS", "\n", "\n", "with", "tf", ".", "variable_scope", "(", "\"conv_model_\"", "+", "scope", ",", "reuse", "=", "reuse", ")", ":", "\n", "            ", "input_val", "=", "self", ".", "OBS", "\n", "outputs", "=", "[", "]", "\n", "state", "=", "self", ".", "STATE", "\n", "states", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "num_steps", ")", ":", "\n", "                ", "inp", "=", "conv1", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "input_val", ",", "filters", "=", "64", ",", "kernel_size", "=", "(", "8", ",", "8", ")", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'c1'", ",", "\n", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "\n", "inp", "=", "residual_block", "(", "inp", ",", "64", ",", "training", ",", "'channels_first'", ",", "name", "=", "'rb_{}'", ".", "format", "(", "0", ")", ",", "reuse", "=", "reuse", ")", "\n", "inp", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "inp", ",", "filters", "=", "64", ",", "kernel_size", "=", "(", "4", ",", "4", ")", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "leaky_relu", ",", "name", "=", "'c2'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "inp", "=", "residual_block", "(", "inp", ",", "64", ",", "training", ",", "'channels_first'", ",", "name", "=", "'rb_{}'", ".", "format", "(", "1", ")", ",", "reuse", "=", "reuse", ")", "\n", "\n", "inp", "=", "tf", ".", "reshape", "(", "inp", ",", "[", "batch_size", ",", "64", ",", "21", ",", "21", "]", ")", "\n", "\n", "if", "i", "==", "0", ":", "\n", "                    ", "self", ".", "conv_encode", "=", "inp", "\n", "\n", "", "if", "FLAGS", ".", "convlstm", ":", "\n", "                    ", "state", ",", "output", ",", "d_state", "=", "convlstm", "(", "inp", ",", "state", ",", "FLAGS", ",", "reuse", "=", "reuse", ",", "bypass_res", "=", "bypass_res", ")", "\n", "", "else", ":", "\n", "                    ", "state", ",", "output", ",", "d_state", "=", "spatial_mem", "(", "inp", ",", "state", ",", "FLAGS", ",", "reuse", "=", "reuse", ",", "bypass_res", "=", "bypass_res", ")", "\n", "\n", "", "states", ".", "append", "(", "state", ")", "\n", "\n", "if", "i", "==", "0", ":", "\n", "                    ", "state_next", "=", "state", "\n", "\n", "", "output", "=", "tf", ".", "reshape", "(", "output", ",", "(", "batch_size", ",", "64", ",", "21", ",", "21", ")", ")", "\n", "\n", "output", "=", "residual_block", "(", "output", ",", "64", ",", "training", ",", "'channels_first'", ",", "name", "=", "'drb_{}'", ".", "format", "(", "0", ")", ",", "reuse", "=", "reuse", ")", "\n", "\n", "output", "=", "tf", ".", "layers", ".", "conv2d_transpose", "(", "output", ",", "64", ",", "kernel_size", "=", "(", "4", ",", "4", ")", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'dc1'", ",", "\n", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ")", "\n", "\n", "output", "=", "residual_block", "(", "output", ",", "64", ",", "training", ",", "'channels_first'", ",", "name", "=", "'drb_{}'", ".", "format", "(", "1", ")", ",", "reuse", "=", "reuse", ")", "\n", "output", "=", "tf", ".", "layers", ".", "conv2d_transpose", "(", "output", ",", "3", ",", "kernel_size", "=", "(", "8", ",", "8", ")", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'output_conv'", ",", "\n", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ")", "\n", "\n", "new_input_val", "=", "tf", ".", "reshape", "(", "output", ",", "(", "batch_size", ",", "3", ",", "84", ",", "84", ")", ")", "\n", "outputs", ".", "append", "(", "new_input_val", "[", ":", ",", ":", "3", ",", ":", ",", ":", "]", ")", "\n", "input_val", "=", "tf", ".", "concat", "(", "[", "input_val", "[", ":", ",", "3", ":", ",", ":", ",", ":", "]", ",", "new_input_val", "[", ":", ",", ":", "3", ",", ":", ",", ":", "]", "]", ",", "axis", "=", "1", ")", "\n", "input_val", "=", "tf", ".", "clip_by_value", "(", "input_val", ",", "0", ",", "1", ")", "\n", "reuse", "=", "True", "\n", "\n", "", "final_output", "=", "tf", ".", "stack", "(", "outputs", ",", "axis", "=", "1", ")", "\n", "\n", "", "final_output", "=", "tf", ".", "reshape", "(", "final_output", ",", "(", "tf", ".", "shape", "(", "final_output", ")", "[", "0", "]", ",", "num_steps", "*", "3", ",", "84", ",", "84", ")", ")", "\n", "self", ".", "final_output", "=", "final_output", "\n", "self", ".", "final_state", "=", "state_next", "\n", "self", ".", "states", "=", "states", "\n", "self", ".", "d_state", "=", "d_state", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.models.PhysActionRollout.__init__": [[136, 241], ["tensorflow.shape", "tensorflow.reshape", "tensorflow.reshape", "tensorflow.shape", "tensorflow.reshape", "tensorflow.variable_scope", "range", "tensorflow.stack", "tensorflow.variable_scope", "tensorflow.layers.conv2d", "utils.residual_block", "tensorflow.layers.conv2d", "utils.residual_block", "tensorflow.reshape", "tensorflow.gather", "tensorflow.tile", "utils.spatial_mem", "tensorflow.reshape", "utils.residual_block", "tensorflow.layers.conv2d_transpose", "utils.residual_block", "tensorflow.layers.conv2d_transpose", "tensorflow.reshape", "tensorflow.tile", "tensorflow.layers.conv2d", "utils.residual_block", "tensorflow.layers.conv2d", "utils.residual_block", "tensorflow.reshape", "policy_fn", "tensorflow.gather", "tensorflow.tile", "tensorflow.stop_gradient", "utils.spatial_mem", "tensorflow.reshape", "utils.residual_block", "tensorflow.layers.conv2d_transpose", "utils.residual_block", "tensorflow.layers.conv2d_transpose", "tensorflow.reshape", "outputs.append", "tensorflow.concat", "tensorflow.clip_by_value", "tensorflow.shape", "tensorflow.eye", "tensorflow.reshape", "tensorflow.reshape", "tensorflow.eye", "tensorflow.squeeze", "tensorflow.reshape", "tensorflow.shape", "bool", "tensorflow.shape", "tensorflow.shape", "tensorflow.shape", "tensorflow.shape"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.residual_block", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.residual_block", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.spatial_mem", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.residual_block", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.residual_block", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.residual_block", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.residual_block", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.spatial_mem", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.residual_block", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.residual_block"], ["    ", "def", "__init__", "(", "self", ",", "OBS", ",", "OBS_ORIG", ",", "STATE", ",", "policy_fn", ",", "FLAGS", ",", "n", ",", "ACTION", ",", "scope", "=", "\"\"", ",", "num_channels", "=", "12", ",", "reuse", "=", "False", ",", "num_steps", "=", "10", ",", "self_predict", "=", "False", ",", "label", "=", "None", ",", "bypass_res", "=", "False", ",", "training", "=", "False", ")", ":", "\n", "        ", "self", ".", "num_channels", "=", "num_channels", "\n", "STATE_ORIG", "=", "STATE", "\n", "STATE", "=", "STATE", "[", "0", "]", "\n", "self", ".", "STATE", "=", "STATE", "\n", "self", ".", "OBS", "=", "OBS", "\n", "\n", "orig_state_shape", "=", "tf", ".", "shape", "(", "STATE", ")", "\n", "batch_size", "=", "tf", ".", "shape", "(", "OBS", ")", "[", "0", "]", "\n", "\n", "STATE", "=", "[", "tf", ".", "reshape", "(", "tf", ".", "tile", "(", "tf", ".", "reshape", "(", "STATE", ",", "(", "tf", ".", "shape", "(", "STATE", ")", "[", "0", "]", ",", "1", ",", "64", ",", "21", ",", "21", ")", ")", ",", "(", "1", ",", "FLAGS", ".", "i2a_action_n", ",", "1", ",", "1", ",", "1", ")", ")", ",", "(", "FLAGS", ".", "i2a_action_n", "*", "tf", ".", "shape", "(", "STATE", ")", "[", "0", "]", ",", "64", ",", "21", ",", "21", ")", ")", "]", "\n", "with", "tf", ".", "variable_scope", "(", "\"conv_model_\"", "+", "scope", ",", "reuse", "=", "reuse", ")", ":", "\n", "            ", "input_val", "=", "self", ".", "OBS", "\n", "outputs", "=", "[", "]", "\n", "state", "=", "STATE", "\n", "states", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "num_steps", ")", ":", "\n", "                ", "inp", "=", "conv1", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "input_val", ",", "filters", "=", "64", ",", "kernel_size", "=", "(", "8", ",", "8", ")", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'c1'", ",", "\n", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "\n", "inp", "=", "residual_block", "(", "inp", ",", "64", ",", "training", ",", "'channels_first'", ",", "name", "=", "'rb_{}'", ".", "format", "(", "0", ")", ",", "reuse", "=", "reuse", ")", "\n", "inp", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "inp", ",", "filters", "=", "64", ",", "kernel_size", "=", "(", "4", ",", "4", ")", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "leaky_relu", ",", "name", "=", "'c2'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "inp", "=", "residual_block", "(", "inp", ",", "64", ",", "training", ",", "'channels_first'", ",", "name", "=", "'rb_{}'", ".", "format", "(", "1", ")", ",", "reuse", "=", "reuse", ")", "\n", "\n", "inp", "=", "tf", ".", "reshape", "(", "inp", ",", "[", "batch_size", ",", "64", ",", "21", ",", "21", "]", ")", "\n", "\n", "action", "=", "policy_fn", "(", "OBS", ",", "sample", "=", "True", ",", "reuse", "=", "bool", "(", "i", ")", ")", "\n", "action", "=", "tf", ".", "gather", "(", "tf", ".", "eye", "(", "n", ")", ",", "tf", ".", "squeeze", "(", "action", ")", ",", "axis", "=", "0", ")", "\n", "action", "=", "tf", ".", "tile", "(", "tf", ".", "reshape", "(", "action", ",", "(", "tf", ".", "shape", "(", "action", ")", "[", "0", "]", ",", "n", ",", "1", ",", "1", ")", ")", ",", "(", "1", ",", "1", ",", "21", ",", "21", ")", ")", "\n", "action", "=", "tf", ".", "stop_gradient", "(", "action", ")", "\n", "\n", "state", ",", "output", ",", "d_state", "=", "spatial_mem", "(", "inp", ",", "state", ",", "FLAGS", ",", "reuse", "=", "reuse", ",", "bypass_res", "=", "bypass_res", ",", "action", "=", "action", ")", "\n", "\n", "if", "i", "==", "0", ":", "\n", "                    ", "state_next", "=", "state", "\n", "\n", "", "output", "=", "tf", ".", "reshape", "(", "output", ",", "(", "batch_size", ",", "64", ",", "21", ",", "21", ")", ")", "\n", "\n", "output", "=", "residual_block", "(", "output", ",", "64", ",", "training", ",", "'channels_first'", ",", "name", "=", "'drb_{}'", ".", "format", "(", "0", ")", ",", "reuse", "=", "reuse", ")", "\n", "\n", "output", "=", "tf", ".", "layers", ".", "conv2d_transpose", "(", "output", ",", "64", ",", "kernel_size", "=", "(", "4", ",", "4", ")", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'dc1'", ",", "\n", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ")", "\n", "\n", "output", "=", "residual_block", "(", "output", ",", "64", ",", "training", ",", "'channels_first'", ",", "name", "=", "'drb_{}'", ".", "format", "(", "1", ")", ",", "reuse", "=", "reuse", ")", "\n", "output", "=", "tf", ".", "layers", ".", "conv2d_transpose", "(", "output", ",", "3", ",", "kernel_size", "=", "(", "8", ",", "8", ")", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'output_conv'", ",", "\n", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ")", "\n", "\n", "new_input_val", "=", "tf", ".", "reshape", "(", "output", ",", "(", "batch_size", ",", "3", ",", "84", ",", "84", ")", ")", "\n", "outputs", ".", "append", "(", "new_input_val", "[", ":", ",", ":", "3", ",", ":", ",", ":", "]", ")", "\n", "input_val", "=", "tf", ".", "concat", "(", "[", "input_val", "[", ":", ",", "3", ":", ",", ":", ",", ":", "]", ",", "new_input_val", "[", ":", ",", ":", "3", ",", ":", ",", ":", "]", "]", ",", "axis", "=", "1", ")", "\n", "input_val", "=", "tf", ".", "clip_by_value", "(", "input_val", ",", "0", ",", "1", ")", "\n", "reuse", "=", "True", "\n", "\n", "", "final_output", "=", "tf", ".", "stack", "(", "outputs", ",", "axis", "=", "1", ")", "\n", "\n", "", "final_output", "=", "tf", ".", "reshape", "(", "final_output", ",", "(", "tf", ".", "shape", "(", "final_output", ")", "[", "0", "]", ",", "num_steps", "*", "3", ",", "84", ",", "84", ")", ")", "\n", "self", ".", "encode_output", "=", "final_output", "\n", "\n", "state_next", "=", "tf", ".", "reshape", "(", "state_next", "[", "0", "]", ",", "(", "orig_state_shape", "[", "0", "]", ",", "FLAGS", ".", "i2a_action_n", ",", "64", ",", "21", ",", "21", ")", ")", "\n", "state_next", "=", "state_next", "[", ":", ",", "0", ",", ":", ",", ":", ",", ":", "]", "\n", "self", ".", "final_state", "=", "[", "state_next", "]", "\n", "\n", "\n", "with", "tf", ".", "variable_scope", "(", "\"conv_model_\"", "+", "scope", ",", "reuse", "=", "True", ")", ":", "\n", "            ", "input_val", "=", "OBS_ORIG", "\n", "outputs", "=", "[", "]", "\n", "state", "=", "STATE_ORIG", "\n", "batch_size", "=", "tf", ".", "shape", "(", "OBS_ORIG", ")", "[", "0", "]", "\n", "\n", "inp", "=", "conv1", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "input_val", ",", "filters", "=", "64", ",", "kernel_size", "=", "(", "8", ",", "8", ")", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'c1'", ",", "\n", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "\n", "inp", "=", "residual_block", "(", "inp", ",", "64", ",", "training", ",", "'channels_first'", ",", "name", "=", "'rb_{}'", ".", "format", "(", "0", ")", ",", "reuse", "=", "reuse", ")", "\n", "inp", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "inp", ",", "filters", "=", "64", ",", "kernel_size", "=", "(", "4", ",", "4", ")", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "leaky_relu", ",", "name", "=", "'c2'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "inp", "=", "residual_block", "(", "inp", ",", "64", ",", "training", ",", "'channels_first'", ",", "name", "=", "'rb_{}'", ".", "format", "(", "1", ")", ",", "reuse", "=", "reuse", ")", "\n", "\n", "inp", "=", "tf", ".", "reshape", "(", "inp", ",", "[", "batch_size", ",", "64", ",", "21", ",", "21", "]", ")", "\n", "\n", "action", "=", "tf", ".", "gather", "(", "tf", ".", "eye", "(", "n", ")", ",", "ACTION", ",", "axis", "=", "0", ")", "\n", "action", "=", "tf", ".", "tile", "(", "tf", ".", "reshape", "(", "action", ",", "(", "tf", ".", "shape", "(", "action", ")", "[", "0", "]", ",", "n", ",", "1", ",", "1", ")", ")", ",", "(", "1", ",", "1", ",", "21", ",", "21", ")", ")", "\n", "state", ",", "output", ",", "d_state", "=", "spatial_mem", "(", "inp", ",", "state", ",", "FLAGS", ",", "reuse", "=", "reuse", ",", "bypass_res", "=", "bypass_res", ",", "action", "=", "action", ")", "\n", "\n", "output", "=", "tf", ".", "reshape", "(", "output", ",", "(", "batch_size", ",", "64", ",", "21", ",", "21", ")", ")", "\n", "\n", "output", "=", "residual_block", "(", "output", ",", "64", ",", "training", ",", "'channels_first'", ",", "name", "=", "'drb_{}'", ".", "format", "(", "0", ")", ",", "reuse", "=", "reuse", ")", "\n", "\n", "output", "=", "tf", ".", "layers", ".", "conv2d_transpose", "(", "output", ",", "64", ",", "kernel_size", "=", "(", "4", ",", "4", ")", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'dc1'", ",", "\n", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ")", "\n", "\n", "output", "=", "residual_block", "(", "output", ",", "64", ",", "training", ",", "'channels_first'", ",", "name", "=", "'drb_{}'", ".", "format", "(", "1", ")", ",", "reuse", "=", "reuse", ")", "\n", "output", "=", "tf", ".", "layers", ".", "conv2d_transpose", "(", "output", ",", "3", ",", "kernel_size", "=", "(", "8", ",", "8", ")", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'output_conv'", ",", "\n", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ")", "\n", "\n", "new_input_val", "=", "tf", ".", "reshape", "(", "output", ",", "(", "batch_size", ",", "3", ",", "84", ",", "84", ")", ")", "\n", "\n", "", "self", ".", "final_output", "=", "new_input_val", "\n", "", "", ""]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.ConvPolicy.__init__": [[41, 296], ["print", "baselines.common.distributions.make_pdtype", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.to_float", "tensorflow.transpose", "tensorflow.zeros", "train_batch.ConvPolicy.pd.sample", "train_batch.ConvPolicy.pd.neglogp", "numpy.zeros", "tensorflow.reshape", "tensorflow.reshape", "tensorflow.variable_scope", "numpy.prod", "tensorflow.reshape", "tensorflow.nn.relu", "tensorflow.math.tanh", "tensorflow.nn.softmax", "tensorflow.nn.softmax_cross_entropy_with_logits", "tensorflow.concat", "numpy.zeros", "tensorflow.placeholder", "numpy.zeros", "tensorflow.placeholder", "model_fn", "tensorflow.variable_scope", "model_fn", "tensorflow.layers.conv2d", "tensorflow.layers.conv2d", "tensorflow.reduce_mean", "tensorflow.layers.conv2d", "tensorflow.layers.conv2d", "tensorflow.layers.conv2d", "tensorflow.layers.conv2d", "tensorflow.layers.conv2d", "tensorflow.layers.conv2d", "tensorflow.concat", "tensorflow.layers.dense", "tensorflow.layers.dense", "train_batch.ConvPolicy.pdtype.pdfromflat", "train_batch.ConvPolicy.pdtype.pdfromlatent", "tensorflow.variable_scope", "train_batch.ConvPolicy.__init__.i2a_policy"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer.sample"], ["    ", "def", "__init__", "(", "self", ",", "sess", ",", "env", ",", "FLAGS", ",", "model_fn", ",", "reuse", "=", "False", ")", ":", "\n", "# Construct the model for training", "\n", "        ", "print", "(", "env", ".", "observation_space", ")", "\n", "\n", "ob_space", "=", "env", ".", "observation_space", "\n", "self", ".", "pdtype", "=", "make_pdtype", "(", "env", ".", "action_space", ")", "\n", "\n", "self", ".", "states", "=", "None", "\n", "\n", "if", "FLAGS", ".", "pm", "or", "FLAGS", ".", "pm_rollouts", ":", "\n", "            ", "if", "FLAGS", ".", "model", "==", "'physnet'", ":", "\n", "                ", "self", ".", "initial_state", "=", "np", ".", "zeros", "(", "(", "FLAGS", ".", "nenvs", ",", "64", ",", "21", ",", "21", ")", ")", "\n", "STATE", "=", "tf", ".", "placeholder", "(", "shape", "=", "(", "None", ",", "64", ",", "21", ",", "21", ")", ",", "dtype", "=", "tf", ".", "float32", ",", "name", "=", "'SpatialMem'", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "initial_state", "=", "np", ".", "zeros", "(", "(", "FLAGS", ".", "nenvs", ",", "2048", ")", ")", "\n", "STATE", "=", "tf", ".", "placeholder", "(", "shape", "=", "(", "None", ",", "1024", "*", "2", ")", ",", "dtype", "=", "tf", ".", "float32", ",", "name", "=", "'SpatialMem'", ")", "\n", "", "", "else", ":", "\n", "            ", "self", ".", "initial_state", "=", "np", ".", "zeros", "(", "1", ")", "\n", "\n", "", "STATE", "=", "tf", ".", "placeholder", "(", "shape", "=", "(", "None", ",", "64", ",", "21", ",", "21", ")", ",", "dtype", "=", "tf", ".", "float32", ",", "name", "=", "'SpatialMem'", ")", "\n", "\n", "X", "=", "control_x", "=", "tf", ".", "placeholder", "(", "shape", "=", "(", "None", ",", ")", "+", "ob_space", ".", "shape", ",", "dtype", "=", "ob_space", ".", "dtype", ",", "name", "=", "'Ob_control'", ")", "\n", "X_IM", "=", "tf", ".", "placeholder", "(", "shape", "=", "(", "None", ",", "84", ",", "84", ",", "12", ")", ",", "dtype", "=", "ob_space", ".", "dtype", ",", "name", "=", "'Ob'", ")", "\n", "MASK", "=", "tf", ".", "placeholder", "(", "shape", "=", "(", "None", ")", ",", "dtype", "=", "tf", ".", "float32", ",", "name", "=", "'Mask'", ")", "\n", "ACTION", "=", "tf", ".", "placeholder", "(", "shape", "=", "(", "None", ")", ",", "dtype", "=", "tf", ".", "int32", ",", "name", "=", "'action'", ")", "\n", "self", ".", "ACTION", "=", "ACTION", "\n", "\n", "self", ".", "STATE", "=", "STATE", "\n", "self", ".", "MASK", "=", "MASK", "\n", "\n", "if", "FLAGS", ".", "model", "==", "'physnet'", ":", "\n", "            ", "state_mask", "=", "tf", ".", "reshape", "(", "MASK", ",", "(", "-", "1", ",", "1", ",", "1", ",", "1", ")", ")", "\n", "state", "=", "STATE", "*", "(", "1", "-", "state_mask", ")", "\n", "", "else", ":", "\n", "            ", "state_mask", "=", "tf", ".", "reshape", "(", "MASK", ",", "(", "-", "1", ",", "1", ")", ")", "\n", "state", "=", "STATE", "*", "(", "1", "-", "state_mask", ")", "\n", "\n", "", "if", "not", "FLAGS", ".", "dm_control", ":", "\n", "            ", "X", "=", "X_IM", "\n", "\n", "", "processed_x", "=", "tf", ".", "to_float", "(", "X_IM", ")", "\n", "processed_x", "=", "processed_x", "/", "255.", "\n", "processed_x", "=", "tf", ".", "transpose", "(", "processed_x", ",", "perm", "=", "(", "0", ",", "3", ",", "1", ",", "2", ")", ")", "\n", "\n", "final_state", "=", "tf", ".", "zeros", "(", "1", ")", "\n", "\n", "if", "FLAGS", ".", "pm", ":", "\n", "            ", "if", "FLAGS", ".", "i2a", ":", "\n", "                ", "self", ".", "phys_model", "=", "model_fn", "(", "processed_x", ",", "[", "state", "]", ",", "FLAGS", ",", "num_steps", "=", "FLAGS", ".", "pred_steps", ",", "reuse", "=", "reuse", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"policy_model\"", ",", "reuse", "=", "reuse", ")", ":", "\n", "                    ", "final_output", "=", "tf", ".", "stop_gradient", "(", "self", ".", "phys_model", ".", "final_output", ")", "\n", "output", "=", "tf", ".", "reshape", "(", "tf", ".", "stop_gradient", "(", "final_output", ")", ",", "(", "tf", ".", "shape", "(", "processed_x", ")", "[", "0", "]", "*", "FLAGS", ".", "pred_steps", ",", "3", ",", "84", ",", "84", ")", ")", "\n", "\n", "conv1", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "tf", ".", "stop_gradient", "(", "output", ")", ",", "filters", "=", "32", ",", "kernel_size", "=", "[", "3", ",", "3", "]", ",", "strides", "=", "(", "8", ",", "8", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'encode_c1'", ",", "data_format", "=", "'channels_first'", ")", "\n", "conv2", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "conv1", ",", "filters", "=", "64", ",", "kernel_size", "=", "[", "4", ",", "4", "]", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'encode_c2'", ",", "data_format", "=", "'channels_first'", ")", "\n", "conv3", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "conv2", ",", "filters", "=", "64", ",", "kernel_size", "=", "[", "3", ",", "3", "]", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'encode_c3'", ",", "data_format", "=", "'channels_first'", ")", "\n", "nh", "=", "np", ".", "prod", "(", "[", "v", ".", "value", "for", "v", "in", "conv3", ".", "get_shape", "(", ")", "[", "1", ":", "]", "]", ")", "\n", "output_flat", "=", "tf", ".", "reshape", "(", "conv3", ",", "(", "-", "1", ",", "nh", ")", ")", "\n", "output_encode", "=", "tf", ".", "layers", ".", "dense", "(", "output_flat", ",", "256", ",", "name", "=", "'flatten_new'", ",", "reuse", "=", "reuse", ")", "\n", "output", "=", "tf", ".", "reshape", "(", "output_encode", ",", "(", "tf", ".", "shape", "(", "processed_x", ")", "[", "0", "]", ",", "FLAGS", ".", "pred_steps", ",", "256", ")", ")", "\n", "encode_lstm", "=", "tf", ".", "contrib", ".", "rnn", ".", "BasicLSTMCell", "(", "256", ",", "name", "=", "\"encode_lstm\"", ")", "\n", "\n", "with", "tf", ".", "variable_scope", "(", "\"init\"", ",", "reuse", "=", "reuse", ")", ":", "\n", "                        ", "start_state", "=", "tf", ".", "get_variable", "(", "'init_state'", ",", "shape", "=", "(", "1", ",", "512", ")", ",", "initializer", "=", "tf", ".", "initializers", ".", "zeros", "(", ")", ",", "trainable", "=", "False", ")", "\n", "\n", "", "encode_state", "=", "tf", ".", "split", "(", "tf", ".", "tile", "(", "start_state", ",", "(", "tf", ".", "shape", "(", "processed_x", ")", "[", "0", "]", ",", "1", ")", ")", ",", "2", ",", "axis", "=", "1", ")", "\n", "\n", "for", "i", "in", "range", "(", "FLAGS", ".", "pred_steps", "-", "1", ",", "-", "1", ",", "-", "1", ")", ":", "\n", "                        ", "output_i", "=", "output", "[", ":", ",", "i", "]", "\n", "hidden", ",", "encode_state", "=", "encode_lstm", "(", "output_i", ",", "encode_state", ")", "\n", "# encode_state = tf.squeeze(encode_state[0]), tf.squeeze(encode_state[1])", "\n", "\n", "", "encode_state", "=", "tf", ".", "tile", "(", "hidden", ",", "(", "1", ",", "5", ")", ")", "\n", "\n", "", "", "elif", "FLAGS", ".", "i2a_action", ":", "\n", "\n", "                ", "def", "i2a_policy", "(", "inp", ",", "action", "=", "None", ",", "reuse", "=", "False", ",", "sample", "=", "False", ")", ":", "\n", "                    ", "with", "tf", ".", "variable_scope", "(", "\"policy_copy\"", ",", "reuse", "=", "reuse", ")", ":", "\n", "                        ", "conv1", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "inp", ",", "filters", "=", "32", ",", "kernel_size", "=", "[", "3", ",", "3", "]", ",", "strides", "=", "(", "8", ",", "8", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'i2a_encode_c1'", ",", "data_format", "=", "'channels_first'", ")", "\n", "conv2", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "conv1", ",", "filters", "=", "64", ",", "kernel_size", "=", "[", "4", ",", "4", "]", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'i2a_encode_c2'", ",", "data_format", "=", "'channels_first'", ")", "\n", "conv3", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "conv2", ",", "filters", "=", "64", ",", "kernel_size", "=", "[", "3", ",", "3", "]", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'i2a_encode_c3'", ",", "data_format", "=", "'channels_first'", ")", "\n", "nh", "=", "np", ".", "prod", "(", "[", "v", ".", "value", "for", "v", "in", "conv3", ".", "get_shape", "(", ")", "[", "1", ":", "]", "]", ")", "\n", "output_flat", "=", "tf", ".", "reshape", "(", "conv3", ",", "(", "-", "1", ",", "nh", ")", ")", "\n", "i2a_pd", ",", "_", "=", "self", ".", "pdtype", ".", "pdfromlatent", "(", "output_flat", ")", "\n", "\n", "if", "sample", ":", "\n", "                            ", "return", "i2a_pd", ".", "sample", "(", ")", "\n", "", "else", ":", "\n", "                            ", "return", "i2a_pd", ".", "logits", "\n", "\n", "", "", "", "batch", "=", "tf", ".", "shape", "(", "processed_x", ")", "\n", "processed_x_tile", "=", "tf", ".", "reshape", "(", "tf", ".", "tile", "(", "tf", ".", "reshape", "(", "processed_x", ",", "(", "batch", "[", "0", "]", ",", "1", ",", "batch", "[", "1", "]", ",", "batch", "[", "2", "]", ",", "batch", "[", "3", "]", ")", ")", ",", "(", "1", ",", "FLAGS", ".", "i2a_action_n", ",", "1", ",", "1", ",", "1", ")", ")", ",", "(", "batch", "[", "0", "]", "*", "FLAGS", ".", "i2a_action_n", ",", "12", ",", "84", ",", "84", ")", ")", "\n", "self", ".", "phys_model", "=", "PhysActionRollout", "(", "processed_x_tile", ",", "processed_x", ",", "[", "state", "]", ",", "i2a_policy", ",", "FLAGS", ",", "env", ".", "action_space", ".", "n", ",", "ACTION", ",", "num_steps", "=", "FLAGS", ".", "pred_steps", ",", "reuse", "=", "reuse", ")", "\n", "final_output", "=", "self", ".", "phys_model", ".", "encode_output", "\n", "\n", "with", "tf", ".", "variable_scope", "(", "\"policy_model\"", ",", "reuse", "=", "reuse", ")", ":", "\n", "\n", "                    ", "output", "=", "tf", ".", "reshape", "(", "tf", ".", "stop_gradient", "(", "final_output", ")", ",", "(", "tf", ".", "shape", "(", "processed_x_tile", ")", "[", "0", "]", "*", "FLAGS", ".", "pred_steps", ",", "3", ",", "84", ",", "84", ")", ")", "\n", "\n", "conv1", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "tf", ".", "stop_gradient", "(", "output", ")", ",", "filters", "=", "32", ",", "kernel_size", "=", "[", "3", ",", "3", "]", ",", "strides", "=", "(", "8", ",", "8", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'encode_c1'", ",", "data_format", "=", "'channels_first'", ")", "\n", "conv2", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "conv1", ",", "filters", "=", "64", ",", "kernel_size", "=", "[", "4", ",", "4", "]", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'encode_c2'", ",", "data_format", "=", "'channels_first'", ")", "\n", "conv3", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "conv2", ",", "filters", "=", "64", ",", "kernel_size", "=", "[", "3", ",", "3", "]", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'encode_c3'", ",", "data_format", "=", "'channels_first'", ")", "\n", "\n", "\n", "nh", "=", "np", ".", "prod", "(", "[", "v", ".", "value", "for", "v", "in", "conv3", ".", "get_shape", "(", ")", "[", "1", ":", "]", "]", ")", "\n", "output_flat", "=", "tf", ".", "reshape", "(", "conv3", ",", "(", "-", "1", ",", "nh", ")", ")", "\n", "output_encode", "=", "tf", ".", "layers", ".", "dense", "(", "output_flat", ",", "256", ",", "name", "=", "'flatten_new'", ",", "reuse", "=", "reuse", ")", "\n", "output", "=", "tf", ".", "reshape", "(", "output_encode", ",", "(", "tf", ".", "shape", "(", "processed_x_tile", ")", "[", "0", "]", ",", "FLAGS", ".", "pred_steps", ",", "256", ")", ")", "\n", "encode_lstm", "=", "tf", ".", "contrib", ".", "rnn", ".", "BasicLSTMCell", "(", "256", ",", "name", "=", "\"encode_lstm\"", ")", "\n", "\n", "with", "tf", ".", "variable_scope", "(", "\"init\"", ",", "reuse", "=", "reuse", ")", ":", "\n", "                        ", "start_state", "=", "tf", ".", "get_variable", "(", "'init_state'", ",", "shape", "=", "(", "1", ",", "512", ")", ",", "initializer", "=", "tf", ".", "initializers", ".", "zeros", "(", ")", ",", "trainable", "=", "False", ")", "\n", "\n", "", "encode_state", "=", "tf", ".", "split", "(", "tf", ".", "tile", "(", "start_state", ",", "(", "tf", ".", "shape", "(", "processed_x_tile", ")", "[", "0", "]", ",", "1", ")", ")", ",", "2", ",", "axis", "=", "1", ")", "\n", "\n", "for", "i", "in", "range", "(", "FLAGS", ".", "pred_steps", "-", "1", ",", "-", "1", ",", "-", "1", ")", ":", "\n", "                        ", "output_i", "=", "output", "[", ":", ",", "i", "]", "\n", "hidden", ",", "encode_state", "=", "encode_lstm", "(", "output_i", ",", "encode_state", ")", "\n", "\n", "", "encode_state", "=", "tf", ".", "reshape", "(", "hidden", ",", "(", "batch", "[", "0", "]", ",", "FLAGS", ".", "i2a_action_n", "*", "256", ")", ")", "\n", "\n", "\n", "\n", "", "", "else", ":", "\n", "                ", "self", ".", "phys_model", "=", "model_fn", "(", "processed_x", ",", "[", "state", "]", ",", "FLAGS", ",", "num_steps", "=", "FLAGS", ".", "pred_steps", ",", "reuse", "=", "reuse", ")", "\n", "processed_x", "=", "tf", ".", "concat", "(", "[", "processed_x", ",", "self", ".", "phys_model", ".", "final_output", "]", ",", "axis", "=", "1", ")", "\n", "\n", "if", "FLAGS", ".", "balance_frames", ":", "\n", "                    ", "processed_x", "=", "processed_x", "[", ":", ",", "-", "12", ":", "]", "\n", "\n", "", "", "final_state", "=", "self", ".", "phys_model", ".", "final_state", "[", "0", "]", "\n", "\n", "\n", "", "if", "FLAGS", ".", "pm_rollouts", ":", "\n", "            ", "with", "tf", ".", "variable_scope", "(", "\"policy_model\"", ",", "reuse", "=", "reuse", ")", ":", "\n", "                ", "self", ".", "phys_model", "=", "model_fn", "(", "processed_x", ",", "[", "state", "]", ",", "FLAGS", ",", "num_steps", "=", "FLAGS", ".", "pred_steps", ",", "reuse", "=", "reuse", ")", "\n", "final_state", "=", "self", ".", "phys_model", ".", "final_state", "[", "0", "]", "\n", "reward_c1", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "tf", ".", "stop_gradient", "(", "self", ".", "phys_model", ".", "final_output", ")", ",", "filters", "=", "32", ",", "kernel_size", "=", "[", "4", ",", "4", "]", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'reward_c1'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "reward_c2", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "reward_c1", ",", "filters", "=", "32", ",", "kernel_size", "=", "[", "4", ",", "4", "]", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'reward_c2'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "reward", "=", "tf", ".", "reduce_mean", "(", "tf", ".", "reduce_max", "(", "reward_c2", ",", "[", "2", ",", "3", "]", ")", ",", "[", "1", "]", ")", "\n", "\n", "", "", "with", "tf", ".", "variable_scope", "(", "\"policy_model\"", ",", "reuse", "=", "reuse", ")", ":", "\n", "\n", "            ", "if", "FLAGS", ".", "joint_policy", ":", "\n", "                ", "conv1", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "tf", ".", "stop_gradient", "(", "self", ".", "phys_model", ".", "conv_encode", ")", ",", "filters", "=", "32", ",", "kernel_size", "=", "[", "3", ",", "3", "]", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'c1'", ",", "data_format", "=", "'channels_first'", ")", "\n", "conv2", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "conv1", ",", "filters", "=", "64", ",", "kernel_size", "=", "[", "4", ",", "4", "]", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'c2'", ",", "data_format", "=", "'channels_first'", ")", "\n", "conv3", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "conv2", ",", "filters", "=", "64", ",", "kernel_size", "=", "[", "3", ",", "3", "]", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'c3'", ",", "data_format", "=", "'channels_first'", ")", "\n", "", "else", ":", "\n", "                ", "conv1", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "tf", ".", "stop_gradient", "(", "processed_x", ")", ",", "filters", "=", "32", ",", "kernel_size", "=", "[", "8", ",", "8", "]", ",", "strides", "=", "(", "4", ",", "4", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'c1'", ",", "data_format", "=", "'channels_first'", ")", "\n", "conv2", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "conv1", ",", "filters", "=", "64", ",", "kernel_size", "=", "[", "4", ",", "4", "]", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'c2'", ",", "data_format", "=", "'channels_first'", ")", "\n", "conv3", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "conv2", ",", "filters", "=", "64", ",", "kernel_size", "=", "[", "3", ",", "3", "]", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'c3'", ",", "data_format", "=", "'channels_first'", ")", "\n", "\n", "", "nh", "=", "np", ".", "prod", "(", "[", "v", ".", "value", "for", "v", "in", "conv3", ".", "get_shape", "(", ")", "[", "1", ":", "]", "]", ")", "\n", "flat", "=", "tf", ".", "reshape", "(", "conv3", ",", "[", "-", "1", ",", "nh", "]", ")", "\n", "\n", "if", "FLAGS", ".", "i2a", "or", "FLAGS", ".", "i2a_action", ":", "\n", "                ", "flat", "=", "tf", ".", "concat", "(", "[", "flat", ",", "encode_state", "]", ",", "axis", "=", "1", ")", "\n", "\n", "", "vf", "=", "tf", ".", "layers", ".", "dense", "(", "flat", ",", "1", ",", "name", "=", "'vf'", ")", "[", ":", ",", "0", "]", "\n", "flat", "=", "tf", ".", "nn", ".", "relu", "(", "flat", ")", "\n", "\n", "if", "FLAGS", ".", "order", ">", "1", ":", "\n", "                ", "act_flat", "=", "tf", ".", "layers", ".", "dense", "(", "flat", ",", "actions", "*", "FLAGS", ".", "order", ")", "\n", "self", ".", "pd", "=", "self", ".", "pdtype", ".", "pdfromflat", "(", "act_flat", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "pd", ",", "_", "=", "self", ".", "pdtype", ".", "pdfromlatent", "(", "flat", ")", "\n", "\n", "", "", "a0", "=", "self", ".", "pd", ".", "sample", "(", ")", "\n", "neglogp0", "=", "self", ".", "pd", ".", "neglogp", "(", "a0", ")", "\n", "\n", "if", "FLAGS", ".", "dm_control", ":", "\n", "            ", "self", ".", "a0", "=", "tf", ".", "math", ".", "tanh", "(", "a0", ")", "\n", "\n", "", "if", "FLAGS", ".", "i2a_action", ":", "\n", "            ", "with", "tf", ".", "variable_scope", "(", "\"conv_model_\"", ",", "reuse", "=", "reuse", ")", ":", "\n", "                ", "i2a_logit", "=", "i2a_policy", "(", "processed_x", ",", "sample", "=", "False", ",", "reuse", "=", "True", ")", "\n", "", "policy_labels", "=", "tf", ".", "nn", ".", "softmax", "(", "self", ".", "pd", ".", "logits", ")", "\n", "self", ".", "policy_copy_loss", "=", "tf", ".", "nn", ".", "softmax_cross_entropy_with_logits", "(", "labels", "=", "tf", ".", "stop_gradient", "(", "policy_labels", ")", ",", "logits", "=", "i2a_logit", ")", "\n", "\n", "# Set value function prediction to not be influenced by future state predictions", "\n", "", "self", ".", "vf", "=", "vf", "\n", "\n", "if", "FLAGS", ".", "pm_rollouts", ":", "\n", "            ", "future_pred", "=", "tf", ".", "concat", "(", "[", "processed_x", ",", "self", ".", "phys_model", ".", "final_output", "]", ",", "axis", "=", "1", ")", "\n", "future_pred", "=", "future_pred", "[", ":", ",", "-", "12", ":", "]", "\n", "\n", "with", "tf", ".", "variable_scope", "(", "\"policy_model\"", ",", "reuse", "=", "True", ")", ":", "\n", "\n", "                ", "conv1", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "tf", ".", "stop_gradient", "(", "future_pred", ")", ",", "filters", "=", "32", ",", "kernel_size", "=", "[", "8", ",", "8", "]", ",", "strides", "=", "(", "4", ",", "4", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'c1'", ",", "data_format", "=", "'channels_first'", ")", "\n", "conv2", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "conv1", ",", "filters", "=", "64", ",", "kernel_size", "=", "[", "4", ",", "4", "]", ",", "strides", "=", "(", "2", ",", "2", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'c2'", ",", "data_format", "=", "'channels_first'", ")", "\n", "conv3", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "conv2", ",", "filters", "=", "64", ",", "kernel_size", "=", "[", "3", ",", "3", "]", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ",", "name", "=", "'c3'", ",", "data_format", "=", "'channels_first'", ")", "\n", "nh", "=", "np", ".", "prod", "(", "[", "v", ".", "value", "for", "v", "in", "conv3", ".", "get_shape", "(", ")", "[", "1", ":", "]", "]", ")", "\n", "flat", "=", "tf", ".", "reshape", "(", "conv3", ",", "[", "-", "1", ",", "nh", "]", ")", "\n", "\n", "if", "FLAGS", ".", "i2a", ":", "\n", "                    ", "flat", "=", "tf", ".", "concat", "(", "[", "flat", ",", "encode_state", "]", ",", "axis", "=", "1", ")", "\n", "\n", "", "future_vf", "=", "tf", ".", "layers", ".", "dense", "(", "flat", ",", "1", ",", "name", "=", "'vf'", ")", "[", ":", ",", "0", "]", "\n", "\n", "", "self", ".", "reward", "=", "reward", "\n", "self", ".", "future_vf", "=", "future_vf", "\n", "self", ".", "total_val", "=", "reward", "+", "(", "FLAGS", ".", "gamma", "**", "3", ")", "*", "future_vf", "\n", "\n", "vf", "=", "0.1", "*", "tf", ".", "maximum", "(", "self", ".", "total_val", ",", "vf", ")", "+", "0.9", "*", "vf", "\n", "\n", "", "def", "step", "(", "ob", ",", "state", ",", "done", ",", "ob_im", "=", "None", ")", ":", "\n", "            ", "if", "FLAGS", ".", "pm_rollouts", "or", "FLAGS", ".", "pm", ":", "\n", "                ", "if", "FLAGS", ".", "dm_control", ":", "\n", "                    ", "return", "sess", ".", "run", "(", "[", "a0", ",", "vf", ",", "final_state", ",", "neglogp0", "]", ",", "{", "X", ":", "ob", ",", "STATE", ":", "state", ",", "MASK", ":", "done", ",", "X_IM", ":", "ob_im", "}", ")", "\n", "", "else", ":", "\n", "                    ", "return", "sess", ".", "run", "(", "[", "a0", ",", "vf", ",", "final_state", ",", "neglogp0", "]", ",", "{", "X", ":", "ob", ",", "STATE", ":", "state", ",", "MASK", ":", "done", "}", ")", "\n", "", "", "else", ":", "\n", "                ", "if", "ob_im", "is", "not", "None", ":", "\n", "                    ", "return", "sess", ".", "run", "(", "[", "a0", ",", "vf", ",", "final_state", ",", "neglogp0", "]", ",", "{", "X", ":", "ob", ",", "X_IM", ":", "ob_im", "}", ")", "\n", "", "else", ":", "\n", "                    ", "return", "sess", ".", "run", "(", "[", "a0", ",", "vf", ",", "final_state", ",", "neglogp0", "]", ",", "{", "X", ":", "ob", ",", "X_IM", ":", "ob", "}", ")", "\n", "\n", "", "", "", "def", "value", "(", "ob", ",", "state", ",", "done", ",", "ob_im", "=", "None", ")", ":", "\n", "            ", "if", "FLAGS", ".", "pm_rollouts", "or", "FLAGS", ".", "pm", ":", "\n", "                ", "if", "FLAGS", ".", "dm_control", ":", "\n", "                    ", "return", "sess", ".", "run", "(", "vf", ",", "{", "X", ":", "ob", ",", "STATE", ":", "state", ",", "MASK", ":", "done", ",", "X_IM", ":", "ob_im", "}", ")", "\n", "", "else", ":", "\n", "                    ", "return", "sess", ".", "run", "(", "vf", ",", "{", "X", ":", "ob", ",", "STATE", ":", "state", ",", "MASK", ":", "done", "}", ")", "\n", "", "", "else", ":", "\n", "                ", "if", "ob_im", "is", "not", "None", ":", "\n", "                    ", "return", "sess", ".", "run", "(", "vf", ",", "{", "X", ":", "ob", ",", "X_IM", ":", "ob_im", "}", ")", "\n", "", "else", ":", "\n", "                    ", "return", "sess", ".", "run", "(", "vf", ",", "{", "X", ":", "ob", ",", "X_IM", ":", "ob", "}", ")", "\n", "\n", "\n", "", "", "", "self", ".", "step", "=", "step", "\n", "self", ".", "value", "=", "value", "\n", "self", ".", "final_state", "=", "final_state", "\n", "self", ".", "a0", "=", "a0", "\n", "\n", "self", ".", "X", "=", "X", "\n", "self", ".", "X_IM", "=", "X_IM", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.Runner.__init__": [[300, 309], ["baselines.common.runners.AbstractEnvRunner.__init__"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.__init__"], ["    ", "def", "__init__", "(", "self", ",", "env", ",", "model", ",", "nsteps", ",", "gamma", ",", "lam", ",", "FLAGS", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "env", "=", "env", ",", "model", "=", "model", ",", "nsteps", "=", "nsteps", ")", "\n", "self", ".", "lam", "=", "lam", "\n", "self", ".", "gamma", "=", "gamma", "\n", "self", ".", "FLAGS", "=", "FLAGS", "\n", "\n", "if", "FLAGS", ".", "dm_control", ":", "\n", "            ", "self", ".", "obs_im", "=", "self", ".", "obs", "[", "'pixels'", "]", "\n", "self", ".", "obs_flat", "=", "self", ".", "obs", "[", "'flat'", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.Runner.run": [[310, 403], ["numpy.asarray", "numpy.asarray", "numpy.asarray", "numpy.asarray", "numpy.asarray", "numpy.asarray", "numpy.asarray", "numpy.asarray", "numpy.zeros_like", "numpy.zeros_like", "numpy.zeros_like", "numpy.zeros_like", "numpy.zeros_like", "reversed", "range", "range", "train_batch.Runner.model.value", "train_batch.Runner.model.value", "range", "train_batch.Runner.model.step", "numpy.asarray.append", "numpy.asarray.append", "numpy.asarray.append", "numpy.asarray.append", "numpy.asarray.append", "numpy.asarray.append", "train_batch.Runner.env.step", "numpy.asarray.append", "numpy.asarray.append", "train_batch.Runner.model.step", "numpy.asarray.append", "numpy.asarray.append", "numpy.asarray.append", "numpy.asarray.append", "numpy.asarray.append", "train_batch.Runner.env.step", "numpy.asarray.append", "numpy.asarray.append", "numpy.array", "range", "map", "train_batch.Runner.obs_flat.copy", "train_batch.Runner.obs_im.copy", "info.get", "train_batch.Runner.obs.copy", "info.get", "epinfos.append", "epinfos.append"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step"], ["", "", "def", "run", "(", "self", ")", ":", "\n", "        ", "mb_obs", ",", "mb_actions", ",", "mb_neglogacs", ",", "mb_rewards", ",", "mb_dones", ",", "mb_values", ",", "mb_im_obs", "=", "[", "]", ",", "[", "]", ",", "[", "]", ",", "[", "]", ",", "[", "]", ",", "[", "]", ",", "[", "]", "\n", "mb_states", "=", "[", "self", ".", "states", "]", "\n", "epinfos", "=", "[", "]", "\n", "\n", "FLAGS", "=", "self", ".", "FLAGS", "\n", "\n", "if", "FLAGS", ".", "dm_control", ":", "\n", "            ", "for", "_", "in", "range", "(", "self", ".", "nsteps", ")", ":", "\n", "                ", "actions", ",", "values", ",", "self", ".", "states", ",", "neglogacs", "=", "self", ".", "model", ".", "step", "(", "self", ".", "obs_flat", ",", "self", ".", "states", ",", "self", ".", "dones", ",", "self", ".", "obs_im", ")", "\n", "mb_obs", ".", "append", "(", "self", ".", "obs_flat", ".", "copy", "(", ")", ")", "\n", "mb_actions", ".", "append", "(", "actions", ")", "\n", "mb_values", ".", "append", "(", "values", ")", "\n", "mb_neglogacs", ".", "append", "(", "neglogacs", ")", "\n", "mb_im_obs", ".", "append", "(", "self", ".", "obs_im", ".", "copy", "(", ")", ")", "\n", "mb_dones", ".", "append", "(", "self", ".", "dones", ")", "\n", "self", ".", "obs", ",", "rewards", ",", "self", ".", "dones", ",", "infos", "=", "self", ".", "env", ".", "step", "(", "actions", ")", "\n", "for", "info", "in", "infos", ":", "\n", "                    ", "maybeepinfo", "=", "info", ".", "get", "(", "'episode'", ")", "\n", "if", "maybeepinfo", ":", "epinfos", ".", "append", "(", "maybeepinfo", ")", "\n", "", "mb_rewards", ".", "append", "(", "rewards", ")", "\n", "mb_states", ".", "append", "(", "self", ".", "states", ")", "\n", "self", ".", "obs_im", "=", "self", ".", "obs", "[", "'pixels'", "]", "\n", "self", ".", "obs_flat", "=", "self", ".", "obs", "[", "'flat'", "]", "\n", "\n", "", "self", ".", "obs", "=", "self", ".", "obs_flat", "\n", "", "else", ":", "\n", "            ", "for", "_", "in", "range", "(", "self", ".", "nsteps", ")", ":", "\n", "                ", "actions", ",", "values", ",", "self", ".", "states", ",", "neglogacs", "=", "self", ".", "model", ".", "step", "(", "self", ".", "obs", ",", "self", ".", "states", ",", "self", ".", "dones", ")", "\n", "mb_obs", ".", "append", "(", "self", ".", "obs", ".", "copy", "(", ")", ")", "\n", "mb_actions", ".", "append", "(", "actions", ")", "\n", "mb_values", ".", "append", "(", "values", ")", "\n", "mb_neglogacs", ".", "append", "(", "neglogacs", ")", "\n", "mb_dones", ".", "append", "(", "self", ".", "dones", ")", "\n", "self", ".", "obs", "[", ":", "]", ",", "rewards", ",", "self", ".", "dones", ",", "infos", "=", "self", ".", "env", ".", "step", "(", "actions", ")", "\n", "for", "info", "in", "infos", ":", "\n", "                    ", "maybeepinfo", "=", "info", ".", "get", "(", "'episode'", ")", "\n", "if", "maybeepinfo", ":", "epinfos", ".", "append", "(", "maybeepinfo", ")", "\n", "", "mb_rewards", ".", "append", "(", "rewards", ")", "\n", "mb_states", ".", "append", "(", "self", ".", "states", ")", "\n", "\n", "", "", "mb_states", "=", "np", ".", "asarray", "(", "mb_states", "[", ":", "-", "1", "]", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "\n", "mb_obs", "=", "np", ".", "asarray", "(", "mb_obs", ",", "dtype", "=", "self", ".", "obs", ".", "dtype", ")", "\n", "mb_rewards", "=", "np", ".", "asarray", "(", "mb_rewards", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "mb_actions", "=", "np", ".", "asarray", "(", "mb_actions", ")", "\n", "mb_values", "=", "np", ".", "asarray", "(", "mb_values", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "mb_neglogacs", "=", "np", ".", "asarray", "(", "mb_neglogacs", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "mb_dones", "=", "np", ".", "asarray", "(", "mb_dones", ",", "dtype", "=", "np", ".", "bool", ")", "\n", "\n", "if", "FLAGS", ".", "dm_control", ":", "\n", "            ", "last_value", "=", "self", ".", "model", ".", "value", "(", "self", ".", "obs", ",", "self", ".", "states", ",", "self", ".", "dones", ",", "self", ".", "obs_im", ")", "\n", "", "else", ":", "\n", "            ", "last_value", "=", "self", ".", "model", ".", "value", "(", "self", ".", "obs", ",", "self", ".", "states", ",", "self", ".", "dones", ")", "\n", "mb_im_obs", "=", "mb_obs", "\n", "\n", "", "mb_im_obs", "=", "np", ".", "asarray", "(", "mb_im_obs", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "\n", "# Now compute values and advantages", "\n", "mb_returns", "=", "np", ".", "zeros_like", "(", "mb_rewards", ")", "\n", "mb_advs", "=", "np", ".", "zeros_like", "(", "mb_rewards", ")", "\n", "\n", "# Now compute future 3 reward and future 3 value", "\n", "mb_frs", "=", "np", ".", "zeros_like", "(", "mb_rewards", ")", "\n", "mb_fvs", "=", "np", ".", "zeros_like", "(", "mb_rewards", ")", "\n", "mb_valid", "=", "np", ".", "zeros_like", "(", "mb_rewards", ")", "\n", "\n", "mb_valid", "[", ":", "-", "3", "]", "=", "1.", "\n", "\n", "last_gae_estimate", "=", "0", "\n", "for", "t", "in", "reversed", "(", "range", "(", "self", ".", "nsteps", ")", ")", ":", "\n", "            ", "if", "t", "==", "self", ".", "nsteps", "-", "1", ":", "\n", "                ", "done", "=", "np", ".", "array", "(", "self", ".", "dones", ")", "\n", "td", "=", "mb_rewards", "[", "t", "]", "+", "self", ".", "gamma", "*", "last_value", "*", "(", "1", "-", "done", ")", "-", "mb_values", "[", "t", "]", "\n", "", "else", ":", "\n", "                ", "done", "=", "mb_dones", "[", "t", "+", "1", "]", "\n", "td", "=", "mb_rewards", "[", "t", "]", "+", "self", ".", "gamma", "*", "mb_values", "[", "t", "+", "1", "]", "*", "(", "1", "-", "done", ")", "-", "mb_values", "[", "t", "]", "\n", "\n", "", "mb_advs", "[", "t", "]", "=", "last_gae_estimate", "=", "td", "+", "self", ".", "gamma", "*", "self", ".", "lam", "*", "last_gae_estimate", "*", "(", "1", "-", "done", ")", "\n", "\n", "if", "t", "<", "self", ".", "nsteps", "-", "3", ":", "\n", "                ", "future_done", "=", "done", "\n", "\n", "for", "i", "in", "range", "(", "3", ")", ":", "\n", "                    ", "future_done", "=", "(", "future_done", "*", "mb_dones", "[", "t", "+", "i", "]", ")", "\n", "\n", "", "mb_fvs", "[", "t", "]", "=", "mb_returns", "[", "t", "+", "3", "]", "*", "future_done", "\n", "mb_frs", "[", "t", "]", "=", "mb_returns", "[", "t", "]", "-", "(", "self", ".", "gamma", "**", "3", ")", "*", "mb_fvs", "[", "t", "]", "\n", "\n", "", "", "mb_returns", "=", "mb_values", "+", "mb_advs", "\n", "\n", "# Flaten so time is on the second axises and batch is on the first", "\n", "return", "(", "*", "map", "(", "sf01", ",", "(", "mb_obs", ",", "mb_returns", ",", "mb_dones", ",", "mb_actions", ",", "mb_values", ",", "mb_neglogacs", ",", "mb_rewards", ",", "mb_states", ",", "mb_fvs", ",", "mb_frs", ",", "mb_valid", ",", "mb_im_obs", ")", ")", ",", "epinfos", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.sf01": [[404, 410], ["arr.swapaxes().reshape", "arr.swapaxes"], "function", ["None"], ["", "", "def", "sf01", "(", "arr", ")", ":", "\n", "    ", "\"\"\"\n    swap and then flatten axes 0 and 1\n    \"\"\"", "\n", "s", "=", "arr", ".", "shape", "\n", "return", "arr", ".", "swapaxes", "(", "0", ",", "1", ")", ".", "reshape", "(", "s", "[", "0", "]", "*", "s", "[", "1", "]", ",", "*", "s", "[", "2", ":", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.unflat": [[411, 417], ["arr.reshape"], "function", ["None"], ["", "def", "unflat", "(", "arr", ")", ":", "\n", "    ", "\"\"\"\n    swap and then flatten axes 0 and 1\n    \"\"\"", "\n", "s", "=", "arr", ".", "shape", "\n", "return", "arr", ".", "reshape", "(", "FLAGS", ".", "nenvs", ",", "FLAGS", ".", "nsteps", ",", "*", "s", "[", "1", ":", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.flat": [[418, 424], ["arr.reshape"], "function", ["None"], ["", "def", "flat", "(", "arr", ")", ":", "\n", "    ", "\"\"\"\n    swap and then flatten axes 0 and 1\n    \"\"\"", "\n", "s", "=", "arr", ".", "shape", "\n", "return", "arr", ".", "reshape", "(", "s", "[", "0", "]", "*", "s", "[", "1", "]", ",", "*", "s", "[", "2", ":", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.train": [[426, 772], ["int", "tensorflow.placeholder", "train_model.pdtype.sample_placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.train.AdamOptimizer", "train_model.pd.neglogp", "tensorflow.reduce_mean", "tensorflow.square", "tensorflow.exp", "tensorflow.reduce_mean", "tensorflow.zeros", "tensorflow.trainable_variables", "tensorflow.gradients", "tf.train.AdamOptimizer.apply_gradients", "train_batch.Runner", "baselines.common.tf_util.initialize", "baselines.logger.TensorBoardOutputFormat", "time.time", "collections.deque", "tqdm.tqdm", "env.close", "tensorflow.placeholder", "train_model.pd.entropy", "tensorflow.reduce_mean", "tensorflow.clip_by_value", "tensorflow.maximum", "tensorflow.reduce_mean", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.zeros", "tensorflow.reduce_mean", "tensorflow.trainable_variables", "tensorflow.gradients", "list", "zip", "tensorflow.clip_by_global_norm", "list", "tensorflow.clip_by_global_norm", "list", "tensorflow.trainable_variables", "tensorflow.reduce_mean", "tensorflow.gradients", "tensorflow.clip_by_global_norm", "list", "tf.train.AdamOptimizer.apply_gradients", "tensorflow.train.Saver", "tensorflow.train.Saver", "os.join", "os.join", "utils.optimistic_restore", "os.join", "range", "train_batch.Runner.run", "collections.deque.extend", "range", "numpy.mean", "time.time", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.square", "tensorflow.trainable_variables", "zip", "zip", "zip", "tensorflow.square", "zip", "tensorflow.get_collection", "tensorflow.train.Saver", "tensorflow.train.Saver", "tensorflow.train.Saver", "tf.train.Saver.restore", "os.join", "utils.optimistic_restore", "numpy.load", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.random.permutation", "range", "train_batch.unflat", "train_batch.unflat", "train_batch.unflat", "train_batch.unflat", "train_batch.unflat", "train_batch.flat", "train_batch.flat", "train_batch.flat", "train_batch.flat", "train_batch.flat", "zip", "baselines.common.explained_variance", "returns.mean", "returns.max", "returns.min", "train_batch.safemean", "train_batch.safemean", "baselines.logger.TensorBoardOutputFormat.writekvs", "tf.train.Saver.save", "tensorflow.reduce_mean", "tensorflow.reduce_mean", "tensorflow.where", "tensorflow.get_collection", "print", "print", "utils.optimistic_restore", "advs.mean", "advs.std", "sess.run", "sess.run", "mblossvals.append", "train_batch.unflat", "train_batch.unflat", "train_batch.unflat", "numpy.where", "max", "valid_idx.extend", "len", "range", "os.join", "train_batch.test_phys", "train_batch.test", "tensorflow.is_nan", "tensorflow.zeros_like", "train_batch.train.learn"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.close", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.optimistic_restore", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.Runner.run", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.optimistic_restore", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.unflat", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.unflat", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.unflat", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.unflat", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.unflat", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.flat", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.flat", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.flat", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.flat", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.flat", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.safemean", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.safemean", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.optimistic_restore", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.Runner.run", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.Runner.run", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.unflat", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.unflat", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.unflat", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.test_phys", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.test"], ["", "def", "train", "(", "sess", ",", "act_model", ",", "train_model", ",", "env", ",", "resume_iter", ",", "logdir", ",", "FLAGS", ")", ":", "\n", "    ", "nsteps", "=", "FLAGS", ".", "nsteps", "\n", "nminibatches", "=", "FLAGS", ".", "nminibatches", "\n", "ent_coef", "=", "FLAGS", ".", "ent_coeff", "\n", "vf_coef", "=", "FLAGS", ".", "vf_coef", "\n", "lr", "=", "FLAGS", ".", "lr", "\n", "exp", "=", "FLAGS", ".", "exp", "\n", "gamma", "=", "FLAGS", ".", "gamma", "\n", "lam", "=", "FLAGS", ".", "lam", "\n", "cliprate", "=", "FLAGS", ".", "cliprange", "\n", "env_id", "=", "FLAGS", ".", "env", "\n", "total_timesteps", "=", "int", "(", "1.1", "*", "FLAGS", ".", "num_timesteps", ")", "\n", "\n", "# Set up training labels", "\n", "R", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "[", "None", "]", ")", "\n", "A", "=", "train_model", ".", "pdtype", ".", "sample_placeholder", "(", "[", "None", "]", ")", "\n", "ADV", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "[", "None", "]", ")", "\n", "OLDNEGLOGPAC", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "[", "None", "]", ")", "\n", "LR", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "[", "]", ")", "\n", "CLIPRATE", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "[", "]", ")", "\n", "OLDVPRED", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "[", "None", "]", ")", "\n", "\n", "if", "FLAGS", ".", "dm_control", ":", "\n", "# PRED_LABEL = tf.placeholder(tf.float32, [None, env.observation_space.shape[0]])", "\n", "        ", "PRED_LABEL", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "[", "None", ",", "3", "*", "FLAGS", ".", "pred_steps", ",", "84", ",", "84", "]", ")", "\n", "", "else", ":", "\n", "        ", "if", "FLAGS", ".", "i2a_action", ":", "\n", "            ", "PRED_LABEL", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "[", "None", ",", "3", ",", "84", ",", "84", "]", ")", "\n", "", "else", ":", "\n", "            ", "PRED_LABEL", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "[", "None", ",", "3", "*", "FLAGS", ".", "pred_steps", ",", "84", ",", "84", "]", ")", "\n", "\n", "# Set up *optimizers", "\n", "", "", "optim", "=", "tf", ".", "train", ".", "AdamOptimizer", "(", "learning_rate", "=", "LR", ",", "epsilon", "=", "1e-5", ")", "\n", "\n", "neglogac", "=", "train_model", ".", "pd", ".", "neglogp", "(", "A", ")", "\n", "entropy", "=", "tf", ".", "reduce_mean", "(", "train_model", ".", "pd", ".", "entropy", "(", ")", ")", "\n", "\n", "# For now don't use value function clip loss", "\n", "vf_sq1", "=", "tf", ".", "square", "(", "train_model", ".", "vf", "-", "R", ")", "\n", "vf_loss", "=", ".5", "*", "tf", ".", "reduce_mean", "(", "vf_sq1", ")", "\n", "\n", "ratio", "=", "tf", ".", "exp", "(", "OLDNEGLOGPAC", "-", "neglogac", ")", "\n", "pg_adv1", "=", "-", "ADV", "*", "tf", ".", "clip_by_value", "(", "ratio", ",", "1.0", "-", "CLIPRATE", ",", "1", "+", "CLIPRATE", ")", "\n", "pg_adv2", "=", "-", "ADV", "*", "ratio", "\n", "pg_loss", "=", "tf", ".", "reduce_mean", "(", "tf", ".", "maximum", "(", "pg_adv1", ",", "pg_adv2", ")", ")", "\n", "\n", "loss", "=", "pg_loss", "-", "entropy", "*", "ent_coef", "+", "vf_coef", "*", "vf_loss", "\n", "\n", "copy_loss", "=", "tf", ".", "zeros", "(", "1", ")", "\n", "\n", "if", "FLAGS", ".", "i2a_action", ":", "\n", "        ", "copy_loss", "=", "tf", ".", "reduce_mean", "(", "train_model", ".", "policy_copy_loss", ")", "\n", "\n", "", "loss", "=", "loss", "+", "copy_loss", "\n", "\n", "\n", "if", "FLAGS", ".", "pm_rollouts", ":", "\n", "        ", "F_R", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "[", "None", "]", ")", "\n", "F_V", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "[", "None", "]", ")", "\n", "F_M", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "[", "None", "]", ")", "\n", "vf_rollout_loss", "=", ".01", "*", "(", "tf", ".", "reduce_mean", "(", "F_M", "*", "tf", ".", "square", "(", "train_model", ".", "reward", "-", "F_R", ")", ")", "+", "tf", ".", "reduce_mean", "(", "F_M", "*", "tf", ".", "square", "(", "train_model", ".", "future_vf", "-", "F_V", ")", ")", ")", "\n", "loss", "=", "loss", "+", "vf_coef", "*", "vf_rollout_loss", "\n", "", "else", ":", "\n", "        ", "vf_rollout_loss", "=", "tf", ".", "zeros", "(", "1", ")", "\n", "\n", "# Not the actual KL since we don't have the probabilities of old actions", "\n", "", "approx_kl", "=", ".5", "*", "tf", ".", "reduce_mean", "(", "tf", ".", "square", "(", "neglogac", "-", "OLDNEGLOGPAC", ")", ")", "\n", "\n", "# Add losses to output", "\n", "params", "=", "tf", ".", "trainable_variables", "(", "'policy_model'", ")", "\n", "\n", "if", "FLAGS", ".", "i2a_action", ":", "\n", "        ", "params", "=", "params", "+", "tf", ".", "trainable_variables", "(", "'conv_model_'", ")", "\n", "\n", "", "grads", "=", "tf", ".", "gradients", "(", "loss", ",", "params", ")", "\n", "\n", "checks", "=", "[", "]", "\n", "\n", "if", "FLAGS", ".", "joint_policy", ":", "\n", "        ", "params", "=", "tf", ".", "trainable_variables", "(", ")", "\n", "grads", "=", "tf", ".", "gradients", "(", "loss", ",", "params", ")", "\n", "gvs", "=", "list", "(", "zip", "(", "grads", ",", "params", ")", ")", "\n", "gvs", "=", "[", "(", "tf", ".", "where", "(", "tf", ".", "is_nan", "(", "grad", ")", ",", "tf", ".", "zeros_like", "(", "grad", ")", ",", "grad", ")", ",", "v", ")", "for", "(", "grad", ",", "v", ")", "in", "gvs", "if", "grad", "is", "not", "None", "]", "\n", "grads", ",", "params", "=", "zip", "(", "*", "gvs", ")", "\n", "capped_grads", ",", "_", "=", "tf", ".", "clip_by_global_norm", "(", "grads", ",", "FLAGS", ".", "max_grad_norm", ")", "\n", "gvs", "=", "list", "(", "zip", "(", "capped_grads", ",", "params", ")", ")", "\n", "", "else", ":", "\n", "        ", "capped_grads", ",", "_", "=", "tf", ".", "clip_by_global_norm", "(", "grads", ",", "FLAGS", ".", "max_grad_norm", ")", "\n", "gvs", "=", "list", "(", "zip", "(", "capped_grads", ",", "params", ")", ")", "\n", "\n", "", "_train", "=", "optim", ".", "apply_gradients", "(", "gvs", ")", "\n", "\n", "if", "FLAGS", ".", "pm", "or", "FLAGS", ".", "pm_rollouts", ":", "\n", "        ", "physics_params", "=", "tf", ".", "trainable_variables", "(", "'conv_model_'", ")", "\n", "loss_phys", "=", "tf", ".", "reduce_mean", "(", "tf", ".", "square", "(", "train_model", ".", "phys_model", ".", "final_output", "-", "PRED_LABEL", ")", ")", "\n", "grads_phys", "=", "tf", ".", "gradients", "(", "loss_phys", ",", "physics_params", ")", "\n", "capped_grads", ",", "_", "=", "tf", ".", "clip_by_global_norm", "(", "grads_phys", ",", "FLAGS", ".", "max_grad_norm", ")", "\n", "grads_phys", "=", "list", "(", "zip", "(", "capped_grads", ",", "physics_params", ")", ")", "\n", "_train_phys", "=", "optim", ".", "apply_gradients", "(", "grads_phys", ")", "\n", "\n", "\n", "", "if", "FLAGS", ".", "resume_physics_only", ":", "\n", "        ", "loader", "=", "tf", ".", "train", ".", "Saver", "(", "tf", ".", "get_collection", "(", "tf", ".", "GraphKeys", ".", "TRAINABLE_VARIABLES", ",", "scope", "=", "\"conv_model_\"", ")", ",", "max_to_keep", "=", "10", ")", "\n", "saver", "=", "tf", ".", "train", ".", "Saver", "(", "max_to_keep", "=", "10", ")", "\n", "", "elif", "FLAGS", ".", "resume_policy_only", ":", "\n", "        ", "loader", "=", "tf", ".", "train", ".", "Saver", "(", "tf", ".", "get_collection", "(", "tf", ".", "GraphKeys", ".", "TRAINABLE_VARIABLES", ",", "scope", "=", "\"policy_model\"", ")", ",", "max_to_keep", "=", "10", ")", "\n", "saver", "=", "tf", ".", "train", ".", "Saver", "(", "max_to_keep", "=", "10", ")", "\n", "", "else", ":", "\n", "        ", "saver", "=", "loader", "=", "tf", ".", "train", ".", "Saver", "(", "max_to_keep", "=", "10", ")", "\n", "\n", "", "if", "FLAGS", ".", "resume_iter", "!=", "-", "1", "or", "(", "not", "FLAGS", ".", "train", ")", ":", "\n", "        ", "model_file", "=", "osp", ".", "join", "(", "logdir", ",", "'model_{}'", ".", "format", "(", "FLAGS", ".", "resume_iter", ")", ")", "\n", "resume_iter", "=", "FLAGS", ".", "resume_iter", "\n", "try", ":", "\n", "            ", "loader", ".", "restore", "(", "sess", ",", "model_file", ")", "\n", "", "except", ":", "\n", "            ", "print", "(", "\"Mismatch between saved checked point and model parameters. Defaulting to optimistic saver. \"", ")", "\n", "print", "(", "\"This will possibly lead to errors\"", ")", "\n", "optimistic_restore", "(", "sess", ",", "model_file", ")", "\n", "\n", "", "", "if", "FLAGS", ".", "resume_goal", ":", "\n", "        ", "model_file", "=", "osp", ".", "join", "(", "logdir", ",", "'model_{}'", ".", "format", "(", "10000", ")", ")", "\n", "optimistic_restore", "(", "sess", ",", "model_file", ")", "\n", "", "elif", "FLAGS", ".", "resume_forage", ":", "\n", "        ", "model_file", "=", "osp", ".", "join", "(", "logdir", ",", "'model_{}'", ".", "format", "(", "10000", ")", ")", "\n", "optimistic_restore", "(", "sess", ",", "model_file", ")", "\n", "\n", "", "def", "learn", "(", "lr", ",", "cliprate", ",", "obs", ",", "returns", ",", "masks", ",", "actions", ",", "values", ",", "neglogpacs", ",", "obs_im", ",", "states", ",", "*", "rollouts", ")", ":", "\n", "        ", "advs", "=", "returns", "-", "values", "\n", "advs", "=", "(", "advs", "-", "advs", ".", "mean", "(", ")", ")", "/", "(", "advs", ".", "std", "(", ")", "+", "1e-8", ")", "\n", "td_map", "=", "{", "train_model", ".", "X", ":", "obs", ",", "LR", ":", "lr", ",", "CLIPRATE", ":", "cliprate", ",", "A", ":", "actions", ",", "ADV", ":", "advs", ",", "OLDNEGLOGPAC", ":", "neglogpacs", ",", "\n", "R", ":", "returns", ",", "OLDVPRED", ":", "values", ",", "train_model", ".", "X_IM", ":", "obs_im", "}", "\n", "\n", "if", "FLAGS", ".", "pm", "or", "FLAGS", ".", "pm_rollouts", ":", "\n", "            ", "td_map", "[", "train_model", ".", "STATE", "]", "=", "states", "\n", "td_map", "[", "train_model", ".", "MASK", "]", "=", "masks", "\n", "\n", "", "if", "FLAGS", ".", "pm_rollouts", ":", "\n", "            ", "f_v", ",", "f_r", ",", "f_m", "=", "rollouts", "\n", "td_map", "[", "F_V", "]", "=", "f_v", "\n", "td_map", "[", "F_R", "]", "=", "f_r", "\n", "td_map", "[", "F_M", "]", "=", "f_m", "\n", "\n", "", "try", ":", "\n", "            ", "return", "sess", ".", "run", "(", "[", "pg_loss", ",", "vf_loss", ",", "vf_rollout_loss", ",", "entropy", ",", "approx_kl", ",", "copy_loss", ",", "_train", "]", ",", "td_map", ")", "[", ":", "-", "1", "]", "\n", "", "except", ":", "\n", "            ", "return", "[", "0.0", ",", "0.0", ",", "0.0", ",", "0.0", ",", "0.0", "]", "\n", "\n", "", "", "if", "FLAGS", ".", "pm", "or", "FLAGS", ".", "pm_rollouts", ":", "\n", "        ", "def", "learn_phys", "(", "lr", ",", "label", ",", "obs", ",", "masks", ",", "states", ",", "obs_im", ",", "action", ")", ":", "\n", "            ", "td_map", "=", "{", "train_model", ".", "X_IM", ":", "obs_im", ",", "PRED_LABEL", ":", "label", ",", "LR", ":", "lr", ",", "train_model", ".", "STATE", ":", "states", ",", "train_model", ".", "MASK", ":", "masks", ",", "train_model", ".", "ACTION", ":", "action", "}", "\n", "\n", "return", "sess", ".", "run", "(", "[", "loss_phys", ",", "_train_phys", "]", ",", "td_map", ")", "[", ":", "-", "1", "]", "\n", "\n", "", "", "loss_names", "=", "[", "'pg_loss'", ",", "'vf_loss'", ",", "'vf_rollout_loss'", ",", "'entropy'", ",", "'approx_kl'", ",", "'copy_loss'", "]", "\n", "\n", "# Set up data collection", "\n", "runner", "=", "Runner", "(", "env", ",", "act_model", ",", "nsteps", ",", "gamma", ",", "lam", ",", "FLAGS", ")", "\n", "\n", "# Initialize Variables", "\n", "initialize", "(", ")", "\n", "\n", "# Set up logger", "\n", "logger", "=", "TensorBoardOutputFormat", "(", "osp", ".", "join", "(", "FLAGS", ".", "logdir", ",", "FLAGS", ".", "exp", ")", ")", "\n", "\n", "# Set up iterations of training", "\n", "total_iter", "=", "total_timesteps", "/", "nsteps", "\n", "nbatch", "=", "FLAGS", ".", "nenvs", "*", "nsteps", "\n", "nenvs", "=", "FLAGS", ".", "nenvs", "\n", "nbatch_train", "=", "nbatch", "//", "nminibatches", "\n", "nupdates", "=", "total_timesteps", "//", "nbatch", "\n", "noptsepochs", "=", "FLAGS", ".", "noptsepochs", "\n", "\n", "t_start", "=", "time", ".", "time", "(", ")", "\n", "epinfobuf", "=", "deque", "(", "maxlen", "=", "100", ")", "\n", "\n", "if", "FLAGS", ".", "finetune_physics", "and", "FLAGS", ".", "mixed_finetune", ":", "\n", "        ", "data_finetune", "=", "np", ".", "load", "(", "FLAGS", ".", "finetune_data", ")", "[", "'arr_0'", "]", "\n", "length_finetune", "=", "data_finetune", ".", "shape", "[", "0", "]", "\n", "\n", "if", "FLAGS", ".", "env", "==", "'sonic'", ":", "\n", "            ", "sonic_size", "=", "2", "\n", "init_state", "=", "np", ".", "zeros", "(", "(", "nbatch_train", "//", "sonic_size", ",", "64", ",", "21", ",", "21", ")", ")", "\n", "init_mask", "=", "np", ".", "zeros", "(", "(", "nbatch_train", "//", "sonic_size", ",", ")", ")", "\n", "", "else", ":", "\n", "            ", "init_state", "=", "np", ".", "zeros", "(", "(", "nbatch_train", "//", "2", ",", "64", ",", "21", ",", "21", ")", ")", "\n", "init_mask", "=", "np", ".", "zeros", "(", "(", "nbatch_train", "//", "2", ",", ")", ")", "\n", "\n", "\n", "", "", "phys_loss", ",", "loss", "=", "0", ",", "0", "\n", "label_finetune", "=", "None", "\n", "\n", "for", "update", "in", "tqdm", "(", "range", "(", "resume_iter", ",", "nupdates", ")", ")", ":", "\n", "        ", "obs", ",", "returns", ",", "masks", ",", "actions", ",", "values", ",", "neglogpacs", ",", "rewards", ",", "states", ",", "fvs", ",", "frs", ",", "fms", ",", "obs_im", ",", "epinfos", "=", "runner", ".", "run", "(", ")", "\n", "\n", "if", "not", "FLAGS", ".", "dm_control", ":", "\n", "            ", "obs_im", "=", "obs", "\n", "\n", "", "epinfobuf", ".", "extend", "(", "epinfos", ")", "\n", "mblossvals", "=", "[", "]", "\n", "mblossphys", "=", "[", "]", "\n", "\n", "frac", "=", "1", "-", "(", "update", "-", "1.0", ")", "/", "nupdates", "\n", "\n", "if", "FLAGS", ".", "env", "==", "'sonic'", "or", "FLAGS", ".", "dm_control", ":", "\n", "            ", "frac", "=", "1.0", "\n", "\n", "", "lrnow", "=", "frac", "*", "lr", "\n", "clipratenow", "=", "frac", "*", "cliprate", "\n", "\n", "for", "_", "in", "range", "(", "noptsepochs", ")", ":", "\n", "            ", "inds", "=", "np", ".", "random", ".", "permutation", "(", "nbatch", ")", "\n", "for", "start", "in", "range", "(", "0", ",", "nbatch", ",", "nbatch_train", ")", ":", "\n", "                ", "end", "=", "start", "+", "nbatch_train", "\n", "mbinds", "=", "inds", "[", "start", ":", "end", "]", "\n", "\n", "slices", "=", "(", "arr", "[", "mbinds", "]", "for", "arr", "in", "(", "obs", ",", "returns", ",", "masks", ",", "actions", ",", "values", ",", "neglogpacs", ",", "obs_im", ")", ")", "\n", "\n", "if", "FLAGS", ".", "pm", "or", "FLAGS", ".", "pm_rollouts", ":", "\n", "                    ", "mbstates", "=", "states", "[", "mbinds", "]", "\n", "", "else", ":", "\n", "                    ", "mbstates", "=", "None", "\n", "\n", "", "if", "FLAGS", ".", "pm_rollouts", ":", "\n", "                    ", "rollouts", "=", "(", "arr", "[", "mbinds", "]", "for", "arr", "in", "(", "fvs", ",", "frs", ",", "fms", ")", ")", "\n", "", "else", ":", "\n", "                    ", "rollouts", "=", "[", "]", "\n", "\n", "", "mblossvals", ".", "append", "(", "learn", "(", "lrnow", ",", "clipratenow", ",", "*", "slices", ",", "mbstates", ",", "*", "rollouts", ")", ")", "\n", "\n", "", "", "lossvals", "=", "np", ".", "mean", "(", "mblossvals", ",", "axis", "=", "0", ")", "\n", "\n", "if", "FLAGS", ".", "finetune_physics", ":", "\n", "            ", "state_unflat", "=", "unflat", "(", "states", ")", "\n", "mask_unflat", "=", "unflat", "(", "masks", ")", "\n", "obs_im_unflat", "=", "unflat", "(", "obs_im", ")", "\n", "obs_unflat", "=", "unflat", "(", "obs_im", ")", "\n", "\n", "\n", "label", "=", "[", "]", "\n", "\n", "state_unflat", "=", "unflat", "(", "states", ")", "[", ":", ",", ":", "-", "4", "]", "\n", "mask_unflat", "=", "unflat", "(", "masks", ")", "[", ":", ",", ":", "-", "4", "]", "\n", "action_unflat", "=", "unflat", "(", "actions", ")", "[", ":", ",", ":", "-", "4", "]", "\n", "obs_unflat", "=", "unflat", "(", "obs", ")", "\n", "label", "=", "obs_unflat", "[", ":", ",", "4", ":", ",", ":", ",", ":", ",", ":", "9", "]", "\n", "obs_unflat", "=", "obs_unflat", "[", ":", ",", ":", "-", "4", "]", "\n", "\n", "state", "=", "flat", "(", "state_unflat", ")", "\n", "mask", "=", "flat", "(", "mask_unflat", ")", "\n", "obs", "=", "flat", "(", "obs_unflat", ")", "\n", "label", "=", "flat", "(", "label", ")", "\n", "actions", "=", "flat", "(", "action_unflat", ")", "\n", "\n", "delete_idx", "=", "np", ".", "where", "(", "mask", ">", "0", ")", "[", "0", "]", "\n", "valid_idx", "=", "[", "]", "\n", "\n", "start_idx", "=", "0", "\n", "\n", "for", "d_ix", "in", "delete_idx", ":", "\n", "                ", "end_idx", "=", "max", "(", "start_idx", ",", "d_ix", "-", "3", ")", "\n", "valid_idx", ".", "extend", "(", "list", "(", "range", "(", "start_idx", ",", "end_idx", ")", ")", ")", "\n", "start_idx", "=", "d_ix", "\n", "\n", "", "state", "=", "state", "[", "valid_idx", "]", "\n", "mask", "=", "mask", "[", "valid_idx", "]", "\n", "obs", "=", "obs", "[", "valid_idx", "]", "\n", "label", "=", "label", "[", "valid_idx", "]", "\n", "actions", "=", "actions", "[", "valid_idx", "]", "\n", "\n", "obs_im", "=", "obs", "\n", "\n", "assert", "not", "FLAGS", ".", "dm_control", "\n", "\n", "\n", "#################################", "\n", "\n", "if", "len", "(", "label", ".", "shape", ")", "==", "4", ":", "\n", "                ", "label", "=", "np", ".", "transpose", "(", "label", ",", "axes", "=", "[", "0", ",", "3", ",", "1", ",", "2", "]", ")", "/", "255.", "\n", "\n", "", "if", "FLAGS", ".", "i2a_action", ":", "\n", "                ", "label", "=", "label", "[", ":", ",", ":", "3", "]", "\n", "\n", "\n", "", "if", "FLAGS", ".", "env", "==", "'sonic'", ":", "\n", "                ", "sonic_size", "=", "2", "\n", "incre_size", "=", "nbatch_train", "//", "sonic_size", "\n", "", "else", ":", "\n", "                ", "incre_size", "=", "nbatch_train", "\n", "\n", "", "phys_nbatch", "=", "label", ".", "shape", "[", "0", "]", "-", "incre_size", "-", "1", "\n", "\n", "if", "state", ".", "shape", "[", "0", "]", ">", "0", ":", "\n", "                ", "for", "_", "in", "range", "(", "FLAGS", ".", "finetune_epochs", ")", ":", "\n", "                    ", "inds", "=", "np", ".", "random", ".", "permutation", "(", "phys_nbatch", ")", "\n", "start", "=", "0", "\n", "for", "_", "in", "range", "(", "FLAGS", ".", "nminibatches", ")", ":", "\n", "                        ", "end", "=", "start", "+", "incre_size", "\n", "mbinds", "=", "inds", "[", "start", ":", "end", "]", "\n", "\n", "slices", "=", "list", "(", "(", "arr", "[", "mbinds", "]", "for", "arr", "in", "(", "label", ",", "obs", ",", "masks", ",", "states", ",", "obs_im", ",", "actions", ")", ")", ")", "\n", "loss", "=", "learn_phys", "(", "FLAGS", ".", "phys_lr", ",", "*", "slices", ")", "[", "0", "]", "\n", "\n", "start", "=", "end", "\n", "\n", "if", "start", ">", "inds", ".", "shape", "[", "0", "]", ":", "\n", "                            ", "start", "=", "0", "\n", "inds", "=", "np", ".", "random", ".", "permutation", "(", "phys_nbatch", ")", "\n", "\n", "\n", "", "", "", "", "", "t_now", "=", "time", ".", "time", "(", ")", "\n", "\n", "if", "update", "%", "FLAGS", ".", "log_interval", "==", "0", ":", "\n", "            ", "summary", "=", "{", "}", "\n", "for", "(", "lossval", ",", "lossname", ")", "in", "zip", "(", "lossvals", ",", "loss_names", ")", ":", "\n", "                ", "summary", "[", "lossname", "]", "=", "lossval", "\n", "\n", "", "if", "FLAGS", ".", "finetune_physics", ":", "\n", "                ", "if", "FLAGS", ".", "mixed_finetune", ":", "\n", "                    ", "summary", "[", "'finetune_phys_loss'", "]", "=", "phys_loss", "\n", "", "summary", "[", "'phys_loss'", "]", "=", "loss", "\n", "\n", "\n", "", "summary", "[", "\"explained_variance\"", "]", "=", "explained_variance", "(", "values", ",", "returns", ")", "\n", "summary", "[", "\"return_mean\"", "]", "=", "returns", ".", "mean", "(", ")", "\n", "summary", "[", "\"return_max\"", "]", "=", "returns", ".", "max", "(", ")", "\n", "summary", "[", "\"return_min\"", "]", "=", "returns", ".", "min", "(", ")", "\n", "summary", "[", "\"serial_timesteps\"", "]", "=", "update", "*", "nsteps", "\n", "summary", "[", "\"total_timesteps\"", "]", "=", "update", "*", "nbatch", "\n", "summary", "[", "\"nupdates\"", "]", "=", "update", "\n", "summary", "[", "\"fps\"", "]", "=", "update", "*", "nbatch", "/", "(", "t_now", "-", "t_start", ")", "\n", "summary", "[", "\"episode_reward_mean\"", "]", "=", "safemean", "(", "[", "epinfo", "[", "'r'", "]", "for", "epinfo", "in", "epinfobuf", "]", ")", "\n", "summary", "[", "\"episode_length_mean\"", "]", "=", "safemean", "(", "[", "epinfo", "[", "'l'", "]", "for", "epinfo", "in", "epinfobuf", "]", ")", "\n", "\n", "logger", ".", "writekvs", "(", "summary", ")", "\n", "\n", "", "if", "update", "%", "FLAGS", ".", "save_iter", "==", "0", ":", "\n", "            ", "saver", ".", "save", "(", "sess", ",", "osp", ".", "join", "(", "logdir", ",", "'model_{}'", ".", "format", "(", "update", ")", ")", ")", "\n", "test_env", "=", "None", "\n", "\n", "if", "FLAGS", ".", "test_phys", "and", "FLAGS", ".", "pm", ":", "\n", "                ", "test_phys", "(", "sess", ",", "act_model", ",", "logdir", ",", "'eval_{}.gif'", ".", "format", "(", "update", ")", ",", "FLAGS", ",", "test_env", ")", "\n", "", "else", ":", "\n", "                ", "test", "(", "sess", ",", "act_model", ",", "logdir", ",", "'eval_{}.gif'", ".", "format", "(", "update", ")", ",", "FLAGS", ",", "test_env", ")", "\n", "", "", "", "env", ".", "close", "(", ")", "\n", "return", "act_model", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.safemean": [[773, 775], ["numpy.mean", "len"], "function", ["None"], ["", "def", "safemean", "(", "xs", ")", ":", "\n", "    ", "return", "np", ".", "nan", "if", "len", "(", "xs", ")", "==", "0", "else", "np", ".", "mean", "(", "xs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.test": [[777, 852], ["os.join", "phys_3d_shooter.PhysEnv3D.reset", "frames.append", "numpy.array", "imageio.mimwrite", "tensorflow.train.Saver", "act_model.step", "phys_3d_shooter.PhysEnv3D.step", "baselines.common.vec_env.subproc_vec_env.SubprocVecEnv", "os.join", "range", "frames.append", "frames.append", "utils.make_dm_control", "utils.make_atari_env_custom", "tf.train.Saver.restore", "phys_3d_shooter.PhysEnv3D.seed", "train_batch.test.make_phys_env"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.reset", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.make_dm_control", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.make_atari_env_custom", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.seed"], ["", "def", "test", "(", "sess", ",", "act_model", ",", "logdir", ",", "name", ",", "FLAGS", ",", "env", "=", "None", ",", "load", "=", "False", ")", ":", "\n", "    ", "save_path", "=", "osp", ".", "join", "(", "logdir", ",", "name", ")", "\n", "\n", "if", "env", "is", "None", ":", "\n", "        ", "env_id", "=", "FLAGS", ".", "env", "\n", "if", "FLAGS", ".", "env", "!=", "'phys_env'", "and", "FLAGS", ".", "env", "!=", "'phys_env_alternate'", "and", "FLAGS", ".", "env", "!=", "'phys_env_shooter'", "and", "FLAGS", ".", "env", "!=", "\"phys_env_3d\"", "and", "FLAGS", ".", "env", "!=", "\"phys_env_3d_shooter\"", ":", "\n", "            ", "if", "FLAGS", ".", "dm_control", ":", "\n", "                ", "env", "=", "make_dm_control", "(", "env_id", "[", "0", "]", ",", "env_id", "[", "1", "]", ",", "1", ",", "FLAGS", ".", "seed", ",", "4", ",", "vis_reward", "=", "FLAGS", ".", "vis_reward", ")", "\n", "", "else", ":", "\n", "                ", "env", "=", "make_atari_env_custom", "(", "FLAGS", ".", "env", ",", "1", ",", "FLAGS", ".", "seed", "+", "100", ",", "4", ",", "random_action", "=", "FLAGS", ".", "random_action", ")", "\n", "", "", "else", ":", "\n", "            ", "def", "make_phys_env", "(", "rank", ")", ":", "\n", "                ", "def", "_thunk", "(", ")", ":", "\n", "                    ", "if", "FLAGS", ".", "env", "==", "'phys_env'", ":", "\n", "                        ", "env", "=", "phys_env", ".", "PhysEnv", "(", "order", "=", "FLAGS", ".", "order", ",", "frame_stack", "=", "4", ",", "pm_oracle", "=", "FLAGS", ".", "pm_oracle", ",", "\n", "pred_steps", "=", "FLAGS", ".", "pred_steps", ",", "balance_frames", "=", "FLAGS", ".", "balance_frames", ")", "\n", "", "elif", "FLAGS", ".", "env", "==", "'phys_env_alternate'", ":", "\n", "                        ", "env", "=", "phys_env_alternate", ".", "PhysEnv", "(", "order", "=", "FLAGS", ".", "order", ",", "frame_stack", "=", "4", ",", "pm_oracle", "=", "FLAGS", ".", "pm_oracle", ",", "\n", "pred_steps", "=", "FLAGS", ".", "pred_steps", ",", "balance_frames", "=", "FLAGS", ".", "balance_frames", ")", "\n", "", "elif", "FLAGS", ".", "env", "==", "'phys_env_shooter'", ":", "\n", "                        ", "env", "=", "phys_env_shooter", ".", "PhysEnv", "(", "order", "=", "FLAGS", ".", "order", ",", "frame_stack", "=", "4", ",", "pm_oracle", "=", "FLAGS", ".", "pm_oracle", ",", "\n", "pred_steps", "=", "FLAGS", ".", "pred_steps", ",", "balance_frames", "=", "FLAGS", ".", "balance_frames", ")", "\n", "", "elif", "FLAGS", ".", "env", "==", "\"phys_env_3d\"", ":", "\n", "                        ", "env", "=", "phys_3d", ".", "PhysEnv3D", "(", "order", "=", "FLAGS", ".", "order", ",", "frame_stack", "=", "4", ",", "pm_oracle", "=", "FLAGS", ".", "pm_oracle", ",", "\n", "pred_steps", "=", "FLAGS", ".", "pred_steps", ",", "balance_frames", "=", "FLAGS", ".", "balance_frames", ")", "\n", "", "elif", "FLAGS", ".", "env", "==", "\"phys_env_3d_shooter\"", ":", "\n", "                        ", "env", "=", "phys_3d_shooter", ".", "PhysEnv3D", "(", "order", "=", "FLAGS", ".", "order", ",", "frame_stack", "=", "4", ",", "pm_oracle", "=", "FLAGS", ".", "pm_oracle", ",", "\n", "pred_steps", "=", "FLAGS", ".", "pred_steps", ",", "balance_frames", "=", "FLAGS", ".", "balance_frames", ")", "\n", "", "env", ".", "seed", "(", "rank", ")", "\n", "return", "env", "\n", "", "return", "_thunk", "\n", "\n", "", "env", "=", "SubprocVecEnv", "(", "[", "make_phys_env", "(", "i", ")", "for", "i", "in", "range", "(", "1", ")", "]", ")", "\n", "\n", "", "", "if", "load", ":", "\n", "        ", "loader", "=", "tf", ".", "train", ".", "Saver", "(", "max_to_keep", "=", "10", ")", "\n", "\n", "if", "FLAGS", ".", "resume_iter", "!=", "-", "1", "or", "(", "not", "FLAGS", ".", "train", ")", ":", "\n", "            ", "model_file", "=", "osp", ".", "join", "(", "logdir", ",", "'model_{}'", ".", "format", "(", "FLAGS", ".", "resume_iter", ")", ")", "\n", "resume_iter", "=", "FLAGS", ".", "resume_iter", "\n", "try", ":", "\n", "                ", "loader", ".", "restore", "(", "sess", ",", "model_file", ")", "\n", "", "except", ":", "\n", "                ", "print", "(", "\"Mismatch between saved checked point and model parameters. Defaulting to optimistic saver. \"", ")", "\n", "optimistic_restore", "(", "sess", ",", "model_file", ")", "\n", "\n", "", "", "", "obs", "=", "env", ".", "reset", "(", ")", "\n", "frames", "=", "[", "]", "\n", "frames", ".", "append", "(", "obs", "[", "0", ",", ":", ",", ":", ",", "-", "3", ":", "]", ")", "\n", "\n", "done", "=", "False", "\n", "states", "=", "act_model", ".", "initial_state", "[", "0", ":", "1", "]", "\n", "dones", "=", "[", "False", "for", "_", "in", "range", "(", "1", ")", "]", "\n", "dones", "=", "np", ".", "array", "(", "dones", ")", "\n", "\n", "counter", "=", "0", "\n", "\n", "while", "not", "done", ":", "\n", "        ", "actions", ",", "values", ",", "states", ",", "neglogacs", "=", "act_model", ".", "step", "(", "obs", ",", "states", ",", "dones", ")", "\n", "obs", ",", "rewards", ",", "dones", ",", "_", "=", "env", ".", "step", "(", "actions", ")", "\n", "\n", "if", "FLAGS", ".", "pred_steps", ">", "0", "and", "(", "FLAGS", ".", "pm_oracle", ")", ":", "\n", "            ", "idx", "=", "-", "(", "FLAGS", ".", "pred_steps", "+", "1", ")", "*", "3", "\n", "frames", ".", "append", "(", "obs", "[", "0", ",", ":", ",", ":", ",", "idx", ":", "idx", "+", "3", "]", ")", "\n", "", "else", ":", "\n", "            ", "frames", ".", "append", "(", "obs", "[", "0", ",", ":", ",", ":", ",", "-", "3", ":", "]", ")", "\n", "\n", "", "done", "=", "dones", "[", "0", "]", "\n", "\n", "counter", "+=", "1", "\n", "\n", "if", "counter", ">", "100", ":", "\n", "            ", "break", "\n", "\n", "", "", "imageio", ".", "mimwrite", "(", "save_path", ",", "frames", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.test_phys": [[854, 935], ["os.join", "phys_3d_shooter.PhysEnv3D.reset", "frames.append", "numpy.array", "imageio.mimwrite", "tensorflow.train.Saver", "numpy.concatenate", "sess.run", "phys_3d_shooter.PhysEnv3D.step", "range", "frames.append", "baselines.common.vec_env.subproc_vec_env.SubprocVecEnv", "os.join", "range", "output_frame[].transpose", "pred_frames.append", "numpy.concatenate", "utils.make_dm_control", "utils.make_atari_env_custom", "tf.train.Saver.restore", "phys_3d_shooter.PhysEnv3D.seed", "train_batch.test.make_phys_env"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.reset", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.Runner.run", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.make_dm_control", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.make_atari_env_custom", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.seed"], ["", "def", "test_phys", "(", "sess", ",", "act_model", ",", "logdir", ",", "name", ",", "FLAGS", ",", "env", "=", "None", ",", "load", "=", "False", ")", ":", "\n", "    ", "save_path", "=", "osp", ".", "join", "(", "logdir", ",", "name", ")", "\n", "\n", "if", "env", "is", "None", ":", "\n", "        ", "env_id", "=", "FLAGS", ".", "env", "\n", "if", "FLAGS", ".", "env", "!=", "'phys_env'", "and", "FLAGS", ".", "env", "!=", "'phys_env_alternate'", "and", "FLAGS", ".", "env", "!=", "'phys_env_shooter'", "and", "FLAGS", ".", "env", "!=", "\"phys_env_3d\"", "and", "FLAGS", ".", "env", "!=", "\"phys_env_3d_shooter\"", ":", "\n", "            ", "if", "FLAGS", ".", "dm_control", ":", "\n", "                ", "env", "=", "make_dm_control", "(", "env_id", "[", "0", "]", ",", "env_id", "[", "1", "]", ",", "1", ",", "FLAGS", ".", "seed", ",", "4", ",", "vis_reward", "=", "FLAGS", ".", "vis_reward", ")", "\n", "", "else", ":", "\n", "                ", "env", "=", "make_atari_env_custom", "(", "FLAGS", ".", "env", ",", "1", ",", "FLAGS", ".", "seed", "+", "100", ",", "4", ",", "random_action", "=", "FLAGS", ".", "random_action", ")", "\n", "", "", "else", ":", "\n", "            ", "def", "make_phys_env", "(", "rank", ")", ":", "\n", "                ", "def", "_thunk", "(", ")", ":", "\n", "                    ", "if", "FLAGS", ".", "env", "==", "'phys_env'", ":", "\n", "                        ", "env", "=", "phys_env", ".", "PhysEnv", "(", "order", "=", "FLAGS", ".", "order", ",", "frame_stack", "=", "4", ",", "pm_oracle", "=", "FLAGS", ".", "pm_oracle", ",", "\n", "pred_steps", "=", "FLAGS", ".", "pred_steps", ",", "balance_frames", "=", "FLAGS", ".", "balance_frames", ")", "\n", "", "elif", "FLAGS", ".", "env", "==", "'phys_env_alternate'", ":", "\n", "                        ", "env", "=", "phys_env_alternate", ".", "PhysEnv", "(", "order", "=", "FLAGS", ".", "order", ",", "frame_stack", "=", "4", ",", "pm_oracle", "=", "FLAGS", ".", "pm_oracle", ",", "\n", "pred_steps", "=", "FLAGS", ".", "pred_steps", ",", "balance_frames", "=", "FLAGS", ".", "balance_frames", ")", "\n", "", "elif", "FLAGS", ".", "env", "==", "'phys_env_shooter'", ":", "\n", "                        ", "env", "=", "phys_env_shooter", ".", "PhysEnv", "(", "order", "=", "FLAGS", ".", "order", ",", "frame_stack", "=", "4", ",", "pm_oracle", "=", "FLAGS", ".", "pm_oracle", ",", "\n", "pred_steps", "=", "FLAGS", ".", "pred_steps", ",", "balance_frames", "=", "FLAGS", ".", "balance_frames", ")", "\n", "", "elif", "FLAGS", ".", "env", "==", "\"phys_env_3d\"", ":", "\n", "                        ", "env", "=", "phys_3d", ".", "PhysEnv3D", "(", "order", "=", "FLAGS", ".", "order", ",", "frame_stack", "=", "4", ",", "pm_oracle", "=", "FLAGS", ".", "pm_oracle", ",", "\n", "pred_steps", "=", "FLAGS", ".", "pred_steps", ",", "balance_frames", "=", "FLAGS", ".", "balance_frames", ")", "\n", "", "elif", "FLAGS", ".", "env", "==", "\"phys_env_3d_shooter\"", ":", "\n", "                        ", "env", "=", "phys_3d_shooter", ".", "PhysEnv3D", "(", "order", "=", "FLAGS", ".", "order", ",", "frame_stack", "=", "4", ",", "pm_oracle", "=", "FLAGS", ".", "pm_oracle", ",", "\n", "pred_steps", "=", "FLAGS", ".", "pred_steps", ",", "balance_frames", "=", "FLAGS", ".", "balance_frames", ")", "\n", "", "env", ".", "seed", "(", "rank", ")", "\n", "return", "env", "\n", "", "return", "_thunk", "\n", "\n", "", "env", "=", "SubprocVecEnv", "(", "[", "make_phys_env", "(", "i", ")", "for", "i", "in", "range", "(", "1", ")", "]", ")", "\n", "\n", "", "", "assert", "FLAGS", ".", "pm", "\n", "\n", "if", "load", ":", "\n", "        ", "loader", "=", "tf", ".", "train", ".", "Saver", "(", "max_to_keep", "=", "10", ")", "\n", "\n", "if", "FLAGS", ".", "resume_iter", "!=", "-", "1", "or", "(", "not", "FLAGS", ".", "train", ")", ":", "\n", "            ", "model_file", "=", "osp", ".", "join", "(", "logdir", ",", "'model_{}'", ".", "format", "(", "FLAGS", ".", "resume_iter", ")", ")", "\n", "resume_iter", "=", "FLAGS", ".", "resume_iter", "\n", "try", ":", "\n", "                ", "loader", ".", "restore", "(", "sess", ",", "model_file", ")", "\n", "", "except", ":", "\n", "                ", "print", "(", "\"Mismatch between saved checked point and model parameters. Defaulting to optimistic saver. \"", ")", "\n", "print", "(", "\"This will probably lead to errors\"", ")", "\n", "optimistic_restore", "(", "sess", ",", "model_file", ")", "\n", "\n", "", "", "", "obs", "=", "env", ".", "reset", "(", ")", "\n", "frames", "=", "[", "]", "\n", "frames", ".", "append", "(", "np", ".", "concatenate", "(", "[", "obs", "[", "0", ",", ":", ",", ":", ",", "-", "3", ":", "]", ",", "obs", "[", "0", ",", ":", ",", ":", ",", "-", "3", ":", "]", ",", "obs", "[", "0", ",", ":", ",", ":", ",", "-", "3", ":", "]", ",", "obs", "[", "0", ",", ":", ",", ":", ",", "-", "3", ":", "]", "]", ",", "axis", "=", "1", ")", ")", "\n", "\n", "done", "=", "False", "\n", "states", "=", "act_model", ".", "initial_state", "[", "0", ":", "1", "]", "\n", "dones", "=", "[", "False", "for", "_", "in", "range", "(", "1", ")", "]", "\n", "dones", "=", "np", ".", "array", "(", "dones", ")", "\n", "\n", "counter", "=", "0", "\n", "\n", "while", "not", "done", ":", "\n", "        ", "actions", ",", "states", ",", "output_frame", "=", "sess", ".", "run", "(", "[", "act_model", ".", "a0", ",", "act_model", ".", "final_state", ",", "act_model", ".", "phys_model", ".", "final_output", "]", ",", "{", "act_model", ".", "X", ":", "obs", ",", "act_model", ".", "STATE", ":", "states", ",", "act_model", ".", "MASK", ":", "dones", "}", ")", "\n", "obs", ",", "rewards", ",", "dones", ",", "_", "=", "env", ".", "step", "(", "actions", ")", "\n", "\n", "pred_frames", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "3", ")", ":", "\n", "            ", "pred_frame", "=", "output_frame", "[", "0", ",", "i", "*", "3", ":", "(", "i", "+", "1", ")", "*", "3", "]", ".", "transpose", "(", "1", ",", "2", ",", "0", ")", "\n", "pred_frame", "=", "(", "255", "*", "np", ".", "clip", "(", "pred_frame", ",", "0", ",", "1", ")", ")", ".", "astype", "(", "np", ".", "uint8", ")", "\n", "pred_frames", ".", "append", "(", "pred_frame", ")", "\n", "\n", "", "frames", ".", "append", "(", "np", ".", "concatenate", "(", "[", "obs", "[", "0", ",", ":", ",", ":", ",", "-", "3", ":", "]", "]", "+", "pred_frames", ",", "axis", "=", "1", ")", ")", "\n", "\n", "done", "=", "dones", "[", "0", "]", "\n", "\n", "counter", "+=", "1", "\n", "\n", "if", "counter", ">", "100", ":", "\n", "            ", "break", "\n", "\n", "", "", "imageio", ".", "mimwrite", "(", "save_path", ",", "frames", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.atari_eval": [[937, 977], ["utils.make_atari_env_custom", "tensorflow.InteractiveSession", "train_batch.ConvPolicy", "train_batch.ConvPolicy", "os.join", "FLAGS.exp.replace", "os.system", "os.system", "baselines.common.tf_util.initialize", "tensorflow.train.Saver", "os.join", "tf.train.Saver.restore", "utils.make_atari_env_custom.reset", "numpy.array", "numpy.save", "numpy.array", "ConvPolicy.step", "utils.make_atari_env_custom.step", "os.join", "info.get", "len", "range", "np.array.append", "print", "len"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.make_atari_env_custom", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.reset", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step"], ["", "def", "atari_eval", "(", "FLAGS", ")", ":", "\n", "    ", "env_id", "=", "FLAGS", ".", "env", "\n", "env", "=", "make_atari_env_custom", "(", "env_id", ",", "FLAGS", ".", "nenvs", ",", "FLAGS", ".", "seed", ",", "4", ",", "random_action", "=", "FLAGS", ".", "random_action", ",", "augment", "=", "True", ")", "\n", "sess", "=", "tf", ".", "InteractiveSession", "(", ")", "\n", "model_fn", "=", "PhysNetV2", "\n", "act_model", "=", "ConvPolicy", "(", "sess", ",", "env", ",", "FLAGS", ",", "model_fn", ",", "reuse", "=", "False", ")", "\n", "train_model", "=", "ConvPolicy", "(", "sess", ",", "env", ",", "FLAGS", ",", "model_fn", ",", "reuse", "=", "True", ")", "\n", "logdir", "=", "osp", ".", "join", "(", "FLAGS", ".", "logdir", ",", "FLAGS", ".", "exp", ")", "\n", "\n", "exp_trim", "=", "FLAGS", ".", "exp", ".", "replace", "(", "\"_test_noise\"", ",", "\"\"", ")", "\n", "command", "=", "\"gsutil cp -r 'gs://yilundu-rcall/results/{}/model_10000.*' {}/\"", ".", "format", "(", "exp_trim", ",", "logdir", ")", "\n", "err", "=", "os", ".", "system", "(", "command", ")", "\n", "\n", "initialize", "(", ")", "\n", "loader", "=", "tf", ".", "train", ".", "Saver", "(", "max_to_keep", "=", "10", ")", "\n", "model_file", "=", "osp", ".", "join", "(", "logdir", ",", "'model_10000'", ")", "\n", "loader", ".", "restore", "(", "sess", ",", "model_file", ")", "\n", "rewards", "=", "[", "]", "\n", "obs", "=", "env", ".", "reset", "(", ")", "\n", "states", "=", "act_model", ".", "initial_state", "\n", "\n", "while", "True", ":", "\n", "        ", "dones", "=", "[", "False", "for", "_", "in", "range", "(", "1", ")", "]", "\n", "dones", "=", "np", ".", "array", "(", "dones", ")", "\n", "done", "=", "False", "\n", "\n", "actions", ",", "values", ",", "states", ",", "neglogacs", "=", "act_model", ".", "step", "(", "obs", ",", "states", ",", "dones", ")", "\n", "obs", ",", "reward", ",", "dones", ",", "infos", "=", "env", ".", "step", "(", "actions", ")", "\n", "\n", "for", "info", "in", "infos", ":", "\n", "            ", "maybeepinfo", "=", "info", ".", "get", "(", "'episode'", ")", "\n", "if", "maybeepinfo", ":", "\n", "                ", "rewards", ".", "append", "(", "maybeepinfo", ")", "\n", "print", "(", "len", "(", "rewards", ")", ")", "\n", "\n", "", "", "if", "len", "(", "rewards", ")", ">", "100", ":", "\n", "            ", "break", "\n", "\n", "", "", "rewards", "=", "np", ".", "array", "(", "rewards", ")", "\n", "np", ".", "save", "(", "osp", ".", "join", "(", "logdir", ",", "\"rewards.npy\"", ")", ",", "rewards", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.main": [[978, 1055], ["tensorflow.InteractiveSession", "train_batch.ConvPolicy", "train_batch.ConvPolicy", "os.join", "baselines.common.tf_util.initialize", "baselines.common.vec_env.subproc_vec_env.SubprocVecEnv", "os.system", "os.system", "tensorflow.train.Saver", "train_batch.train", "utils.make_dm_control", "utils.make_atari_env_custom", "os.system", "os.system", "tensorflow.get_collection", "tf.train.Saver.restore", "train_batch.test_phys", "train_batch.test", "phys_3d_shooter.PhysEnv3D.seed", "train_batch.test.make_phys_env"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.train", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.make_dm_control", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.make_atari_env_custom", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.test_phys", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.test", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.seed"], ["", "def", "main", "(", "FLAGS", ")", ":", "\n", "    ", "env_id", "=", "FLAGS", ".", "env", "\n", "if", "FLAGS", ".", "env", "!=", "'phys_env'", "and", "FLAGS", ".", "env", "!=", "'phys_env_alternate'", "and", "FLAGS", ".", "env", "!=", "'phys_env_shooter'", "and", "FLAGS", ".", "env", "!=", "\"phys_env_3d\"", "and", "FLAGS", ".", "env", "!=", "\"phys_env_3d_shooter\"", ":", "\n", "        ", "if", "FLAGS", ".", "dm_control", ":", "\n", "            ", "env", "=", "make_dm_control", "(", "env_id", "[", "0", "]", ",", "env_id", "[", "1", "]", ",", "FLAGS", ".", "nenvs", ",", "FLAGS", ".", "seed", ",", "4", ",", "vis_reward", "=", "FLAGS", ".", "vis_reward", ")", "\n", "", "else", ":", "\n", "            ", "env", "=", "make_atari_env_custom", "(", "env_id", ",", "FLAGS", ".", "nenvs", ",", "FLAGS", ".", "seed", ",", "4", ",", "random_action", "=", "FLAGS", ".", "random_action", ",", "augment", "=", "FLAGS", ".", "augment", ",", "eps_random", "=", "FLAGS", ".", "eps_random", ",", "random_fix", "=", "FLAGS", ".", "random_fix", ")", "\n", "", "", "else", ":", "\n", "        ", "def", "make_phys_env", "(", "rank", ")", ":", "\n", "            ", "def", "_thunk", "(", ")", ":", "\n", "                ", "if", "FLAGS", ".", "env", "==", "'phys_env'", ":", "\n", "                    ", "env", "=", "phys_env", ".", "PhysEnv", "(", "order", "=", "FLAGS", ".", "order", ",", "frame_stack", "=", "4", ",", "pm_oracle", "=", "FLAGS", ".", "pm_oracle", ",", "\n", "pred_steps", "=", "FLAGS", ".", "pred_steps", ",", "balance_frames", "=", "FLAGS", ".", "balance_frames", ")", "\n", "", "elif", "FLAGS", ".", "env", "==", "'phys_env_alternate'", ":", "\n", "                    ", "env", "=", "phys_env_alternate", ".", "PhysEnv", "(", "order", "=", "FLAGS", ".", "order", ",", "frame_stack", "=", "4", ",", "pm_oracle", "=", "FLAGS", ".", "pm_oracle", ",", "\n", "pred_steps", "=", "FLAGS", ".", "pred_steps", ",", "balance_frames", "=", "FLAGS", ".", "balance_frames", ")", "\n", "", "elif", "FLAGS", ".", "env", "==", "'phys_env_shooter'", ":", "\n", "                    ", "env", "=", "phys_env_shooter", ".", "PhysEnv", "(", "order", "=", "FLAGS", ".", "order", ",", "frame_stack", "=", "4", ",", "pm_oracle", "=", "FLAGS", ".", "pm_oracle", ",", "\n", "pred_steps", "=", "FLAGS", ".", "pred_steps", ",", "balance_frames", "=", "FLAGS", ".", "balance_frames", ",", "pos", "=", "FLAGS", ".", "pos", ")", "\n", "", "elif", "FLAGS", ".", "env", "==", "\"phys_env_3d\"", ":", "\n", "                    ", "env", "=", "phys_3d", ".", "PhysEnv3D", "(", "order", "=", "FLAGS", ".", "order", ",", "frame_stack", "=", "4", ",", "pm_oracle", "=", "FLAGS", ".", "pm_oracle", ",", "\n", "pred_steps", "=", "FLAGS", ".", "pred_steps", ",", "balance_frames", "=", "FLAGS", ".", "balance_frames", ")", "\n", "", "elif", "FLAGS", ".", "env", "==", "\"phys_env_3d_shooter\"", ":", "\n", "                    ", "env", "=", "phys_3d_shooter", ".", "PhysEnv3D", "(", "order", "=", "FLAGS", ".", "order", ",", "frame_stack", "=", "4", ",", "pm_oracle", "=", "FLAGS", ".", "pm_oracle", ",", "\n", "pred_steps", "=", "FLAGS", ".", "pred_steps", ",", "balance_frames", "=", "FLAGS", ".", "balance_frames", ")", "\n", "\n", "", "env", ".", "seed", "(", "rank", ")", "\n", "return", "env", "\n", "", "return", "_thunk", "\n", "\n", "", "env", "=", "SubprocVecEnv", "(", "[", "make_phys_env", "(", "i", "+", "FLAGS", ".", "seed", ")", "for", "i", "in", "range", "(", "FLAGS", ".", "nenvs", ")", "]", ")", "\n", "\n", "", "sess", "=", "tf", ".", "InteractiveSession", "(", ")", "\n", "\n", "if", "FLAGS", ".", "model", "==", "'physnet'", ":", "\n", "        ", "model_fn", "=", "PhysNetV2", "\n", "", "else", ":", "\n", "        ", "model_fn", "=", "JunyukRecurrentNet", "\n", "\n", "", "if", "FLAGS", ".", "i2a_action", ":", "\n", "        ", "model_fn", "=", "PhysActionRollout", "\n", "\n", "", "act_model", "=", "ConvPolicy", "(", "sess", ",", "env", ",", "FLAGS", ",", "model_fn", ",", "reuse", "=", "False", ")", "\n", "train_model", "=", "ConvPolicy", "(", "sess", ",", "env", ",", "FLAGS", ",", "model_fn", ",", "reuse", "=", "True", ")", "\n", "\n", "logdir", "=", "osp", ".", "join", "(", "FLAGS", ".", "logdir", ",", "FLAGS", ".", "exp", ")", "\n", "\n", "resume_iter", "=", "FLAGS", ".", "resume_iter", "\n", "\n", "# Initialize Variables", "\n", "initialize", "(", ")", "\n", "\n", "if", "FLAGS", ".", "resume_goal", ":", "\n", "        ", "command", "=", "\"gsutil cp -r 'gs://yilundu-rcall/results/phys_env_1_phys/model_10000.*' {}/\"", ".", "format", "(", "logdir", ")", "\n", "err", "=", "os", ".", "system", "(", "command", ")", "\n", "", "elif", "FLAGS", ".", "resume_forage", ":", "\n", "        ", "command", "=", "\"gsutil cp -r 'gs://yilundu-rcall/results/phys_env_alternate_1_phys/model_10000.*' {}/\"", ".", "format", "(", "logdir", ")", "\n", "err", "=", "os", ".", "system", "(", "command", ")", "\n", "\n", "\n", "", "if", "(", "FLAGS", ".", "pm", "or", "FLAGS", ".", "pm_rollouts", ")", "and", "not", "FLAGS", ".", "pm_nova", ":", "\n", "        ", "phys_saver", "=", "tf", ".", "train", ".", "Saver", "(", "tf", ".", "get_collection", "(", "tf", ".", "GraphKeys", ".", "TRAINABLE_VARIABLES", ",", "scope", "=", "\"conv_model_\"", ")", ",", "max_to_keep", "=", "10", ")", "\n", "\n", "if", "FLAGS", ".", "blink", ":", "\n", "            ", "phys_model_file", "=", "pm_path_blink", "\n", "", "else", ":", "\n", "            ", "phys_model_file", "=", "FLAGS", ".", "pm_path", "\n", "\n", "", "if", "not", "FLAGS", ".", "i2a_action", ":", "\n", "            ", "phys_saver", ".", "restore", "(", "sess", ",", "phys_model_file", ")", "\n", "\n", "", "", "if", "FLAGS", ".", "train", ":", "\n", "        ", "train", "(", "sess", ",", "act_model", ",", "train_model", ",", "env", ",", "resume_iter", ",", "logdir", ",", "FLAGS", ")", "\n", "", "elif", "FLAGS", ".", "test_phys", ":", "\n", "        ", "test_phys", "(", "sess", ",", "act_model", ",", "logdir", ",", "'eval_{}_phys.gif'", ".", "format", "(", "resume_iter", ")", ",", "FLAGS", ",", "load", "=", "True", ")", "\n", "", "else", ":", "\n", "        ", "test", "(", "sess", ",", "act_model", ",", "logdir", ",", "'eval_{}.gif'", ".", "format", "(", "resume_iter", ")", ",", "FLAGS", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.batch_main": [[1057, 1099], ["easydict.EasyDict", "train_batch.main", "easydict.EasyDict", "train_batch.main", "FLAGS.copy", "FLAGS.copy"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.main", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.train_batch.main"], ["", "", "def", "batch_main", "(", ")", ":", "\n", "\n", "# Environments to run algorithm on", "\n", "    ", "envs", "=", "[", "\"PongNoFrameskip-v0\"", ",", "\"FrostbiteNoFrameskip-v0\"", ",", "\"DemonAttackNoFrameskip-v0\"", ",", "\"EnduroNoFrameskip-v0\"", ",", "\"AsteroidsNoFrameskip-v0\"", ",", "\n", "\"BreakoutNoFrameskip-v0\"", ",", "\"FishingDerbyNoFrameskip-v0\"", ",", "\"IceHockeyNoFrameskip-v0\"", ",", "\"TennisNoFrameskip-v0\"", ",", "\"AssaultNoFrameskip-v0\"", ",", "]", "\n", "\n", "# Physics Environments", "\n", "# envs = [\"phys_env\", \"phys_env_alternate\", \"phys_env_shooter\"]", "\n", "\n", "# Physics 3D Environments", "\n", "# envs = [\"phys_env_3d_shooter\", \"phys_env_3d\"]", "\n", "\n", "# Seeds to evaluate on", "\n", "seeds", "=", "[", "0", ",", "2", "]", "\n", "\n", "for", "env", "in", "envs", ":", "\n", "        ", "for", "seed", "in", "seeds", ":", "\n", "# # # ##################################", "\n", "# Run experiment with IPA", "\n", "            ", "flag_tmp", "=", "EasyDict", "(", "FLAGS", ".", "copy", "(", ")", ")", "\n", "flag_tmp", ".", "pm", "=", "True", "\n", "flag_tmp", ".", "finetune_physics", "=", "True", "\n", "name", "=", "'{}_{}_ipa'", ".", "format", "(", "env", ",", "seed", ")", "\n", "flag_tmp", ".", "logdir", "=", "\"results\"", "\n", "flag_tmp", ".", "exp", "=", "name", "\n", "flag_tmp", ".", "env", "=", "env", "\n", "flag_tmp", ".", "seed", "=", "seed", "\n", "\n", "main", "(", "flag_tmp", ")", "\n", "\n", "\n", "# # # ##################################", "\n", "# Run experiment with PPO", "\n", "flag_tmp", "=", "EasyDict", "(", "FLAGS", ".", "copy", "(", ")", ")", "\n", "flag_tmp", ".", "pm", "=", "False", "\n", "name", "=", "'{}_{}_ppo'", ".", "format", "(", "env", ",", "seed", ")", "\n", "flag_tmp", ".", "logdir", "=", "\"results\"", "\n", "flag_tmp", ".", "exp", "=", "name", "\n", "flag_tmp", ".", "env", "=", "env", "\n", "flag_tmp", ".", "seed", "=", "seed", "\n", "\n", "main", "(", "flag_tmp", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.WarpFrame.__init__": [[35, 46], ["gym.ObservationWrapper.__init__", "gym.spaces.Box"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.__init__"], ["    ", "def", "__init__", "(", "self", ",", "env", ",", "size", "=", "84", ",", "keep_obs", "=", "False", ")", ":", "\n", "        ", "\"\"\"Warp frames to 84x84 as done in the Nature paper and later work.\"\"\"", "\n", "gym", ".", "ObservationWrapper", ".", "__init__", "(", "self", ",", "env", ")", "\n", "self", ".", "width", "=", "size", "\n", "self", ".", "height", "=", "size", "\n", "\n", "if", "keep_obs", ":", "\n", "            ", "self", ".", "observation_space", "=", "env", ".", "observation_space", "\n", "", "else", ":", "\n", "            ", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "low", "=", "0", ",", "high", "=", "255", ",", "\n", "shape", "=", "(", "self", ".", "height", ",", "self", ".", "width", ",", "3", ")", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.WarpFrame.observation": [[47, 55], ["type", "cv2.resize", "cv2.resize"], "methods", ["None"], ["", "", "def", "observation", "(", "self", ",", "frame", ")", ":", "\n", "\n", "        ", "if", "type", "(", "frame", ")", "==", "OrderedDict", ":", "\n", "            ", "frame", "[", "'pixels'", "]", "=", "cv2", ".", "resize", "(", "frame", "[", "'pixels'", "]", ",", "(", "self", ".", "width", ",", "self", ".", "height", ")", ",", "interpolation", "=", "cv2", ".", "INTER_AREA", ")", "\n", "\n", "", "else", ":", "\n", "            ", "frame", "=", "cv2", ".", "resize", "(", "frame", ",", "(", "self", ".", "width", ",", "self", ".", "height", ")", ",", "interpolation", "=", "cv2", ".", "INTER_AREA", ")", "\n", "", "return", "frame", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.AugmentColor.__init__": [[57, 61], ["gym.Wrapper.__init__", "utils.AugmentColor._reset_random"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.__init__", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.AugmentColor._reset_random"], ["    ", "def", "__init__", "(", "self", ",", "env", ")", ":", "\n", "        ", "\"\"\"Warp frames to 84x84 as done in the Nature paper and later work.\"\"\"", "\n", "gym", ".", "Wrapper", ".", "__init__", "(", "self", ",", "env", ")", "\n", "self", ".", "_reset_random", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.AugmentColor.reset": [[63, 67], ["utils.AugmentColor._reset_random", "utils.AugmentColor.env.reset"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.AugmentColor._reset_random", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.reset"], ["", "def", "reset", "(", "self", ")", ":", "\n", "        ", "self", ".", "_reset_random", "(", ")", "\n", "ob", "=", "self", ".", "env", ".", "reset", "(", ")", "\n", "return", "ob", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.AugmentColor.step": [[68, 78], ["utils.AugmentColor.env.step", "PIL.Image.fromarray", "torchvision.transforms.functional.adjust_brightness", "torchvision.transforms.functional.adjust_contrast", "torchvision.transforms.functional.adjust_saturation", "torchvision.transforms.functional.adjust_hue", "numpy.array"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "ob", ",", "reward", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "ob", "=", "Image", ".", "fromarray", "(", "ob", ")", "\n", "ob", "=", "functional", ".", "adjust_brightness", "(", "ob", ",", "self", ".", "brightness", ")", "\n", "ob", "=", "functional", ".", "adjust_contrast", "(", "ob", ",", "self", ".", "contrast", ")", "\n", "ob", "=", "functional", ".", "adjust_saturation", "(", "ob", ",", "self", ".", "saturation", ")", "\n", "ob", "=", "functional", ".", "adjust_hue", "(", "ob", ",", "self", ".", "hue", ")", "\n", "ob_new", "=", "np", ".", "array", "(", "ob", ")", "\n", "# ob_new = np.clip(ob.astype(np.float32) + np.random.uniform(-10, 10, ob.shape), 0, 255).astype(np.uint8)", "\n", "return", "ob_new", ",", "reward", ",", "done", ",", "info", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.AugmentColor._reset_random": [[79, 84], ["numpy.random.uniform", "numpy.random.uniform", "numpy.random.uniform", "numpy.random.uniform"], "methods", ["None"], ["", "def", "_reset_random", "(", "self", ")", ":", "\n", "        ", "self", ".", "brightness", "=", "np", ".", "random", ".", "uniform", "(", "0.7", ",", "1.3", ")", "\n", "self", ".", "contrast", "=", "np", ".", "random", ".", "uniform", "(", "0.7", ",", "1.3", ")", "\n", "self", ".", "saturation", "=", "np", ".", "random", ".", "uniform", "(", "0.7", ",", "1.3", ")", "\n", "self", ".", "hue", "=", "np", ".", "random", ".", "uniform", "(", "0.0", ",", "0.3", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.FrameStack.__init__": [[87, 103], ["gym.Wrapper.__init__", "collections.deque", "gym.spaces.Box"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.__init__"], ["    ", "def", "__init__", "(", "self", ",", "env", ",", "k", ",", "keep_obs", "=", "False", ")", ":", "\n", "        ", "\"\"\"Stack k last frames.\n        Returns lazy array, which is much more memory efficient.\n        See Also\n        --------\n        rl_common.atari_wrappers.LazyFrames\n        \"\"\"", "\n", "gym", ".", "Wrapper", ".", "__init__", "(", "self", ",", "env", ")", "\n", "self", ".", "k", "=", "k", "\n", "self", ".", "frames", "=", "deque", "(", "[", "]", ",", "maxlen", "=", "k", ")", "\n", "shp", "=", "env", ".", "observation_space", ".", "shape", "\n", "\n", "if", "keep_obs", ":", "\n", "            ", "self", ".", "observation_space", "=", "env", ".", "observation_space", "\n", "", "else", ":", "\n", "            ", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "low", "=", "0", ",", "high", "=", "255", ",", "shape", "=", "(", "shp", "[", "0", "]", ",", "shp", "[", "1", "]", ",", "shp", "[", "2", "]", "*", "k", ")", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.FrameStack.reset": [[104, 114], ["utils.FrameStack.env.reset", "range", "utils.FrameStack._get_ob", "type", "utils.FrameStack.frames.append"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.reset", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.FrameStack._get_ob"], ["", "", "def", "reset", "(", "self", ")", ":", "\n", "        ", "ob", "=", "self", ".", "env", ".", "reset", "(", ")", "\n", "\n", "if", "type", "(", "ob", ")", "==", "OrderedDict", ":", "\n", "            ", "ob_frame", "=", "ob", "[", "'pixels'", "]", "\n", "", "else", ":", "\n", "            ", "ob_frame", "=", "ob", "\n", "", "for", "_", "in", "range", "(", "self", ".", "k", ")", ":", "\n", "            ", "self", ".", "frames", ".", "append", "(", "ob_frame", ")", "\n", "", "return", "self", ".", "_get_ob", "(", "ob", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.FrameStack.step": [[115, 122], ["utils.FrameStack.env.step", "type", "utils.FrameStack.frames.append", "utils.FrameStack.frames.append", "utils.FrameStack._get_ob"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.FrameStack._get_ob"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "ob", ",", "reward", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "if", "type", "(", "ob", ")", "==", "OrderedDict", ":", "\n", "            ", "self", ".", "frames", ".", "append", "(", "ob", "[", "'pixels'", "]", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "frames", ".", "append", "(", "ob", ")", "\n", "", "return", "self", ".", "_get_ob", "(", "ob", ")", ",", "reward", ",", "done", ",", "info", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.FrameStack._get_ob": [[123, 131], ["len", "type", "numpy.concatenate", "numpy.concatenate"], "methods", ["None"], ["", "def", "_get_ob", "(", "self", ",", "ob", ")", ":", "\n", "        ", "assert", "len", "(", "self", ".", "frames", ")", "==", "self", ".", "k", "\n", "\n", "if", "type", "(", "ob", ")", "==", "OrderedDict", ":", "\n", "            ", "ob", "[", "'pixels'", "]", "=", "np", ".", "concatenate", "(", "self", ".", "frames", ",", "axis", "=", "2", ")", "\n", "return", "ob", "\n", "", "else", ":", "\n", "            ", "return", "np", ".", "concatenate", "(", "self", ".", "frames", ",", "axis", "=", "2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.RandomRepeat.__init__": [[134, 136], ["gym.Wrapper.__init__"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.__init__"], ["    ", "def", "__init__", "(", "self", ",", "env", ")", ":", "\n", "        ", "gym", ".", "Wrapper", ".", "__init__", "(", "self", ",", "env", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.RandomRepeat.reset": [[137, 140], ["utils.RandomRepeat.env.reset"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.reset"], ["", "def", "reset", "(", "self", ")", ":", "\n", "        ", "ob", "=", "self", ".", "env", ".", "reset", "(", ")", "\n", "return", "ob", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.RandomRepeat.step": [[141, 149], ["utils.RandomRepeat.env.step", "utils.RandomRepeat.env.step", "random.uniform"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "ob", ",", "reward", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "\n", "while", "(", "not", "done", ")", "and", "(", "random", ".", "uniform", "(", "0", ",", "1", ")", "<", "0.5", ")", ":", "\n", "            ", "ob", ",", "temp_reward", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "reward", "+=", "temp_reward", "\n", "\n", "", "return", "ob", ",", "reward", ",", "done", ",", "info", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.EpsRandom.__init__": [[153, 156], ["gym.Wrapper.__init__"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.__init__"], ["    ", "def", "__init__", "(", "self", ",", "env", ")", ":", "\n", "        ", "gym", ".", "Wrapper", ".", "__init__", "(", "self", ",", "env", ")", "\n", "self", ".", "n", "=", "env", ".", "action_space", ".", "n", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.EpsRandom.reset": [[157, 160], ["utils.EpsRandom.env.reset"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.reset"], ["", "def", "reset", "(", "self", ")", ":", "\n", "        ", "ob", "=", "self", ".", "env", ".", "reset", "(", ")", "\n", "return", "ob", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.EpsRandom.step": [[161, 168], ["utils.EpsRandom.env.step", "random.uniform", "random.randint"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "if", "(", "random", ".", "uniform", "(", "0", ",", "1", ")", "<", "0.1", ")", ":", "\n", "            ", "action", "=", "random", ".", "randint", "(", "0", ",", "self", ".", "n", "-", "1", ")", "\n", "\n", "", "ob", ",", "reward", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "\n", "return", "ob", ",", "reward", ",", "done", ",", "info", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.MakeGym.__init__": [[171, 193], ["env.action_spec", "env.observation_spec", "list", "gym.spaces.Box", "gym.spaces.Box", "len"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "env", ")", ":", "\n", "# self.n = env.action_space.n", "\n", "        ", "act_spec", "=", "env", ".", "action_spec", "(", ")", "\n", "obs_spec", "=", "env", ".", "observation_spec", "(", ")", "\n", "\n", "total_dim", "=", "0", "\n", "for", "name", "in", "list", "(", "obs_spec", ")", ":", "\n", "            ", "if", "name", "!=", "\"pixels\"", ":", "\n", "                ", "if", "len", "(", "obs_spec", "[", "name", "]", ".", "shape", ")", "==", "0", ":", "\n", "                    ", "total_dim", "+=", "1", "\n", "", "else", ":", "\n", "                    ", "total_dim", "+=", "obs_spec", "[", "name", "]", ".", "shape", "[", "0", "]", "\n", "\n", "", "", "", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "low", "=", "-", "100.", ",", "high", "=", "100.", ",", "shape", "=", "(", "total_dim", ",", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "self", ".", "action_space", "=", "spaces", ".", "Box", "(", "low", "=", "act_spec", ".", "minimum", ",", "high", "=", "act_spec", ".", "maximum", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "self", ".", "reward_range", "=", "(", "0", ",", "1", ")", "\n", "self", ".", "metadata", "=", "{", "}", "\n", "self", ".", "env", "=", "env", "\n", "self", ".", "spec", "=", "\"shit\"", "\n", "\n", "# Max length of 1000", "\n", "self", ".", "counter", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.MakeGym.reset": [[194, 198], ["utils.MakeGym.env.reset", "utils.MakeGym._construct_ob"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.reset", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.MakeGym._construct_ob"], ["", "def", "reset", "(", "self", ")", ":", "\n", "        ", "timestep", ",", "reward", ",", "discount", ",", "ob", "=", "self", ".", "env", ".", "reset", "(", ")", "\n", "self", ".", "counter", "=", "0", "\n", "return", "self", ".", "_construct_ob", "(", "ob", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.MakeGym._construct_ob": [[199, 212], ["ob.keys", "numpy.concatenate", "collections.OrderedDict", "type", "state.append", "state.append"], "methods", ["None"], ["", "def", "_construct_ob", "(", "self", ",", "ob", ")", ":", "\n", "        ", "state", "=", "[", "]", "\n", "for", "key", "in", "ob", ".", "keys", "(", ")", ":", "\n", "            ", "if", "key", "!=", "'pixels'", ":", "\n", "                ", "if", "type", "(", "ob", "[", "key", "]", ")", "==", "np", ".", "float64", ":", "\n", "                    ", "state", ".", "append", "(", "[", "ob", "[", "key", "]", "]", ")", "\n", "", "else", ":", "\n", "                    ", "state", ".", "append", "(", "ob", "[", "key", "]", ")", "\n", "\n", "", "", "", "ob_flat", "=", "np", ".", "concatenate", "(", "state", ",", "axis", "=", "0", ")", "\n", "ob_dict", "=", "{", "'pixels'", ":", "ob", "[", "'pixels'", "]", ",", "'flat'", ":", "ob_flat", "}", "\n", "\n", "return", "OrderedDict", "(", "ob_dict", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.MakeGym.step": [[213, 229], ["utils.MakeGym.env.step", "utils.MakeGym._construct_ob"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.MakeGym._construct_ob"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "timestep", ",", "reward", ",", "discount", ",", "ob", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "\n", "if", "reward", "is", "None", ":", "\n", "            ", "reward", "=", "0.0", "\n", "\n", "", "done", "=", "False", "\n", "\n", "if", "self", ".", "counter", "==", "1000", ":", "\n", "            ", "self", ".", "counter", "=", "0", "\n", "done", "=", "True", "\n", "\n", "", "self", ".", "counter", "+=", "1", "\n", "info", "=", "{", "}", "\n", "\n", "return", "self", ".", "_construct_ob", "(", "ob", ")", ",", "reward", ",", "done", ",", "info", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.RandomFix.__init__": [[232, 236], ["gym.Wrapper.__init__"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.__init__"], ["    ", "def", "__init__", "(", "self", ",", "env", ")", ":", "\n", "        ", "gym", ".", "Wrapper", ".", "__init__", "(", "self", ",", "env", ")", "\n", "self", ".", "n", "=", "env", ".", "action_space", ".", "n", "\n", "self", ".", "counter", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.RandomFix.reset": [[237, 241], ["utils.RandomFix.env.reset"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.reset"], ["", "def", "reset", "(", "self", ")", ":", "\n", "        ", "ob", "=", "self", ".", "env", ".", "reset", "(", ")", "\n", "self", ".", "counter", "=", "0", "\n", "return", "ob", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.RandomFix.step": [[242, 254], ["utils.RandomFix.env.step", "range", "random.randint", "utils.RandomFix.env.step"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "ob", ",", "reward", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "\n", "if", "self", ".", "counter", "%", "5", "==", "0", ":", "\n", "            ", "for", "i", "in", "range", "(", "2", ")", ":", "\n", "                ", "if", "done", ":", "\n", "                    ", "break", "\n", "", "action", "=", "random", ".", "randint", "(", "0", ",", "self", ".", "n", "-", "1", ")", "\n", "ob", ",", "reward_tmp", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "reward", "=", "reward", "+", "reward_tmp", "\n", "\n", "", "", "return", "ob", ",", "reward", ",", "done", ",", "info", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer.__init__": [[555, 566], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "size", ")", ":", "\n", "        ", "\"\"\"Create Replay buffer.\n        Parameters\n        ----------\n        size: int\n            Max number of transitions to store in the buffer. When the buffer\n            overflows the old memories are dropped.\n        \"\"\"", "\n", "self", ".", "_storage", "=", "[", "]", "\n", "self", ".", "_maxsize", "=", "size", "\n", "self", ".", "_next_idx", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer.__len__": [[567, 569], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "_storage", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer.add": [[570, 583], ["len", "utils.ReplayBuffer._storage.extend", "list", "list", "list", "list"], "methods", ["None"], ["", "def", "add", "(", "self", ",", "ims", ")", ":", "\n", "        ", "batch_size", "=", "ims", ".", "shape", "[", "0", "]", "\n", "if", "self", ".", "_next_idx", ">=", "len", "(", "self", ".", "_storage", ")", ":", "\n", "            ", "self", ".", "_storage", ".", "extend", "(", "list", "(", "ims", ")", ")", "\n", "", "else", ":", "\n", "            ", "if", "batch_size", "+", "self", ".", "_next_idx", "<", "self", ".", "_maxsize", ":", "\n", "                ", "self", ".", "_storage", "[", "self", ".", "_next_idx", ":", "self", ".", "_next_idx", "+", "\n", "batch_size", "]", "=", "list", "(", "ims", ")", "\n", "", "else", ":", "\n", "                ", "split_idx", "=", "self", ".", "_maxsize", "-", "self", ".", "_next_idx", "\n", "self", ".", "_storage", "[", "self", ".", "_next_idx", ":", "]", "=", "list", "(", "ims", ")", "[", ":", "split_idx", "]", "\n", "self", ".", "_storage", "[", ":", "batch_size", "-", "split_idx", "]", "=", "list", "(", "ims", ")", "[", "split_idx", ":", "]", "\n", "", "", "self", ".", "_next_idx", "=", "(", "self", ".", "_next_idx", "+", "ims", ".", "shape", "[", "0", "]", ")", "%", "self", ".", "_maxsize", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer._encode_sample": [[584, 589], ["numpy.array", "ims.append"], "methods", ["None"], ["", "def", "_encode_sample", "(", "self", ",", "idxes", ")", ":", "\n", "        ", "ims", "=", "[", "]", "\n", "for", "i", "in", "idxes", ":", "\n", "            ", "ims", ".", "append", "(", "self", ".", "_storage", "[", "i", "]", ")", "\n", "", "return", "np", ".", "array", "(", "ims", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer.sample": [[590, 613], ["utils.ReplayBuffer._encode_sample", "random.randint", "range", "len"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer._encode_sample"], ["", "def", "sample", "(", "self", ",", "batch_size", ")", ":", "\n", "        ", "\"\"\"Sample a batch of experiences.\n        Parameters\n        ----------\n        batch_size: int\n            How many transitions to sample.\n        Returns\n        -------\n        obs_batch: np.array\n            batch of observations\n        act_batch: np.array\n            batch of actions executed given obs_batch\n        rew_batch: np.array\n            rewards received as results of executing act_batch\n        next_obs_batch: np.array\n            next set of observations seen after executing act_batch\n        done_mask: np.array\n            done_mask[i] = 1 if executing act_batch[i] resulted in\n            the end of an episode and 0 otherwise.\n        \"\"\"", "\n", "idxes", "=", "[", "random", ".", "randint", "(", "0", ",", "len", "(", "self", ".", "_storage", ")", "-", "1", ")", "\n", "for", "_", "in", "range", "(", "batch_size", ")", "]", "\n", "return", "self", ".", "_encode_sample", "(", "idxes", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.optimistic_restore": [[256, 273], ["tensorflow.train.NewCheckpointReader", "tf.train.NewCheckpointReader.get_variable_to_shape_map", "sorted", "tensorflow.train.Saver", "tf.train.Saver.restore", "tensorflow.variable_scope", "tensorflow.global_variables", "tensorflow.get_variable", "tf.get_variable.get_shape().as_list", "var.name.split", "restore_vars.append", "print", "var.name.split", "tf.get_variable.get_shape"], "function", ["None"], ["", "", "def", "optimistic_restore", "(", "session", ",", "save_file", ")", ":", "\n", "    ", "reader", "=", "tf", ".", "train", ".", "NewCheckpointReader", "(", "save_file", ")", "\n", "saved_shapes", "=", "reader", ".", "get_variable_to_shape_map", "(", ")", "\n", "var_names", "=", "sorted", "(", "[", "(", "var", ".", "name", ",", "var", ".", "name", ".", "split", "(", "':'", ")", "[", "0", "]", ")", "for", "var", "in", "tf", ".", "global_variables", "(", ")", "\n", "if", "var", ".", "name", ".", "split", "(", "':'", ")", "[", "0", "]", "in", "saved_shapes", "]", ")", "\n", "restore_vars", "=", "[", "]", "\n", "with", "tf", ".", "variable_scope", "(", "''", ",", "reuse", "=", "tf", ".", "AUTO_REUSE", ")", ":", "\n", "        ", "for", "var_name", ",", "saved_var_name", "in", "var_names", ":", "\n", "            ", "try", ":", "\n", "                ", "curr_var", "=", "tf", ".", "get_variable", "(", "saved_var_name", ")", "\n", "var_shape", "=", "curr_var", ".", "get_shape", "(", ")", ".", "as_list", "(", ")", "\n", "if", "var_shape", "==", "saved_shapes", "[", "saved_var_name", "]", ":", "\n", "                    ", "restore_vars", ".", "append", "(", "curr_var", ")", "\n", "", "", "except", ":", "\n", "                ", "print", "(", "\"Skipping variable {}\"", ".", "format", "(", "var_name", ")", ")", "\n", "", "", "", "saver", "=", "tf", ".", "train", ".", "Saver", "(", "restore_vars", ")", "\n", "saver", ".", "restore", "(", "session", ",", "save_file", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.make_atari_env_custom": [[275, 312], ["baselines.common.set_global_seeds", "baselines.common.vec_env.subproc_vec_env.SubprocVecEnv", "utils.WarpFrame", "baselines.common.atari_wrappers.EpisodicLifeEnv", "RandomFix.unwrapped.get_action_meanings", "baselines.common.atari_wrappers.FireResetEnv", "utils.AugmentColor", "baselines.common.atari_wrappers.ScaledFloatFrame", "baselines.common.atari_wrappers.ClipRewardEnv", "utils.FrameStack", "baselines.common.atari_wrappers.make_atari", "RandomFix.seed", "baselines.bench.Monitor", "utils.make_atari_env_custom.wrap_deepmind_custom"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.seed"], ["", "def", "make_atari_env_custom", "(", "env_id", ",", "num_env", ",", "seed", ",", "frame_stack", ",", "wrapper_kwargs", "=", "{", "}", ",", "start_index", "=", "0", ",", "random_action", "=", "False", ",", "eps_random", "=", "False", ",", "augment", "=", "False", ",", "clip_rewards", "=", "True", ",", "episode_life", "=", "True", ",", "random_fix", "=", "False", ",", "size", "=", "84", ")", ":", "\n", "    ", "\"\"\"\n    Create a wrapped, monitored SubprocVecEnv for Atari.\n    \"\"\"", "\n", "if", "wrapper_kwargs", "is", "None", ":", "wrapper_kwargs", "=", "{", "}", "\n", "\n", "def", "wrap_deepmind_custom", "(", "env", ",", "episode_life", "=", "True", ",", "clip_rewards", "=", "True", ",", "frame_stack", "=", "frame_stack", ",", "scale", "=", "False", ")", ":", "\n", "        ", "if", "episode_life", ":", "\n", "            ", "env", "=", "EpisodicLifeEnv", "(", "env", ")", "\n", "", "if", "'FIRE'", "in", "env", ".", "unwrapped", ".", "get_action_meanings", "(", ")", ":", "\n", "            ", "env", "=", "FireResetEnv", "(", "env", ")", "\n", "", "env", "=", "WarpFrame", "(", "env", ",", "size", "=", "size", ")", "\n", "if", "augment", ":", "\n", "            ", "env", "=", "AugmentColor", "(", "env", ")", "\n", "", "if", "scale", ":", "\n", "            ", "env", "=", "ScaledFloatFrame", "(", "env", ")", "\n", "", "if", "clip_rewards", ":", "\n", "            ", "env", "=", "ClipRewardEnv", "(", "env", ")", "\n", "", "if", "frame_stack", ":", "\n", "            ", "env", "=", "FrameStack", "(", "env", ",", "frame_stack", ")", "\n", "", "return", "env", "\n", "\n", "", "def", "make_env", "(", "rank", ")", ":", "# pylint: disable=C0111", "\n", "        ", "def", "_thunk", "(", ")", ":", "\n", "            ", "env", "=", "make_atari", "(", "env_id", ")", "\n", "env", ".", "seed", "(", "seed", "+", "rank", "if", "seed", "is", "not", "None", "else", "None", ")", "\n", "if", "random_action", ":", "\n", "                ", "env", "=", "RandomRepeat", "(", "env", ")", "\n", "", "if", "eps_random", ":", "\n", "                ", "env", "=", "EpsRandom", "(", "env", ")", "\n", "", "if", "random_fix", ":", "\n", "                ", "env", "=", "RandomFix", "(", "env", ")", "\n", "", "env", "=", "Monitor", "(", "env", ",", "logger", ".", "get_dir", "(", ")", "and", "os", ".", "path", ".", "join", "(", "logger", ".", "get_dir", "(", ")", ",", "str", "(", "rank", ")", ")", ",", "allow_early_resets", "=", "True", ")", "\n", "return", "wrap_deepmind_custom", "(", "env", ",", "episode_life", "=", "episode_life", ",", "clip_rewards", "=", "clip_rewards", ",", "**", "wrapper_kwargs", ")", "\n", "", "return", "_thunk", "\n", "", "set_global_seeds", "(", "seed", ")", "\n", "return", "SubprocVecEnv", "(", "[", "make_env", "(", "i", "+", "start_index", ")", "for", "i", "in", "range", "(", "num_env", ")", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.make_dm_control": [[314, 337], ["baselines.common.set_global_seeds", "baselines.common.vec_env.subproc_vec_env.SubprocVecEnv", "suite.load", "pixels.Wrapper", "utils.MakeGym", "utils.WarpFrame", "utils.FrameStack", "utils.make_dm_control.wrap_env"], "function", ["None"], ["", "def", "make_dm_control", "(", "domain_name", ",", "task_name", ",", "num_env", ",", "seed", ",", "frame_stack", ",", "vis_reward", "=", "False", ",", "wrapper_kwargs", "=", "{", "}", ",", "start_index", "=", "0", ")", ":", "\n", "    ", "\"\"\"\n    Create a wrapped, monitored SubprocVecEnv for Atari.\n    \"\"\"", "\n", "if", "wrapper_kwargs", "is", "None", ":", "wrapper_kwargs", "=", "{", "}", "\n", "\n", "def", "wrap_env", "(", "seed", ")", ":", "\n", "\n", "        ", "env", "=", "suite", ".", "load", "(", "domain_name", ",", "task_name", ",", "task_kwargs", "=", "{", "'random'", ":", "seed", "}", ",", "visualize_reward", "=", "vis_reward", ")", "\n", "env", "=", "pixels", ".", "Wrapper", "(", "env", ",", "pixels_only", "=", "False", ")", "\n", "env", "=", "MakeGym", "(", "env", ")", "\n", "env", "=", "WarpFrame", "(", "env", ",", "keep_obs", "=", "True", ")", "\n", "env", "=", "FrameStack", "(", "env", ",", "frame_stack", ",", "keep_obs", "=", "True", ")", "\n", "return", "env", "\n", "\n", "", "def", "make_env", "(", "rank", ")", ":", "# pylint: disable=C0111", "\n", "        ", "def", "_thunk", "(", ")", ":", "\n", "            ", "env", "=", "wrap_env", "(", "seed", "+", "rank", ")", "\n", "env", "=", "Monitor", "(", "env", ",", "logger", ".", "get_dir", "(", ")", "and", "os", ".", "path", ".", "join", "(", "logger", ".", "get_dir", "(", ")", ",", "str", "(", "rank", ")", ")", ")", "\n", "return", "env", "\n", "", "return", "_thunk", "\n", "", "set_global_seeds", "(", "seed", ")", "\n", "return", "SubprocVecEnv", "(", "[", "make_env", "(", "i", "+", "start_index", ")", "for", "i", "in", "range", "(", "num_env", ")", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.wrap_pad": [[339, 343], ["tensorflow.concat", "tensorflow.concat"], "function", ["None"], ["", "def", "wrap_pad", "(", "input", ",", "size", ")", ":", "\n", "    ", "M1", "=", "tf", ".", "concat", "(", "[", "input", "[", ":", ",", ":", ",", "-", "size", ":", ",", ":", "]", ",", "input", ",", "input", "[", ":", ",", ":", ",", "0", ":", "size", ",", ":", "]", "]", ",", "2", ")", "\n", "M1", "=", "tf", ".", "concat", "(", "[", "M1", "[", ":", ",", ":", ",", ":", ",", "-", "size", ":", "]", ",", "M1", ",", "M1", "[", ":", ",", ":", ",", ":", ",", "0", ":", "size", "]", "]", ",", "3", ")", "\n", "return", "M1", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.spatial_mem": [[345, 390], ["tf.layers.conv2d.get_shape", "tensorflow.concat", "tf.layers.conv2d.get_shape", "inp.get_shape", "tensorflow.concat", "tensorflow.variable_scope", "tensorflow.layers.conv2d", "range", "tensorflow.stack", "tensorflow.layers.conv2d", "tensorflow.concat", "tensorflow.layers.conv2d", "tensorflow.concat", "tensorflow.layers.conv2d", "outputs.append"], "function", ["None"], ["", "def", "spatial_mem", "(", "inp", ",", "state", ",", "FLAGS", ",", "reuse", "=", "False", ",", "scope", "=", "\"\"", ",", "bypass_res", "=", "False", ",", "action", "=", "None", ")", ":", "\n", "    ", "\"\"\"Computes representation on inp through spatial mem given inp of size nchw and state of nchw\"\"\"", "\n", "\n", "state", "=", "state", "[", "0", "]", "\n", "state_shape", "=", "state", ".", "get_shape", "(", ")", "\n", "state_channel", "=", "state", ".", "get_shape", "(", ")", "[", "1", "]", "\n", "input_channel", "=", "inp", ".", "get_shape", "(", ")", "[", "1", "]", "\n", "merge", "=", "tf", ".", "concat", "(", "[", "inp", ",", "state", "]", ",", "axis", "=", "1", ")", "\n", "merge_dim", "=", "state_channel", "+", "input_channel", "\n", "\n", "if", "action", "is", "not", "None", ":", "\n", "        ", "state", "=", "tf", ".", "concat", "(", "[", "action", ",", "state", "]", ",", "axis", "=", "1", ")", "\n", "\n", "", "with", "tf", ".", "variable_scope", "(", "\"spatial_mem\"", "+", "scope", ",", "reuse", "=", "reuse", ")", ":", "\n", "        ", "if", "not", "bypass_res", ":", "\n", "            ", "state_res", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "merge", ",", "filters", "=", "state_channel", ",", "kernel_size", "=", "(", "5", ",", "5", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'mem1'", ",", "data_format", "=", "'channels_first'", ",", "activation", "=", "tf", ".", "nn", ".", "elu", ")", "\n", "state_concat", "=", "tf", ".", "concat", "(", "[", "state", ",", "state_res", "]", ",", "axis", "=", "1", ")", "\n", "state", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "state_concat", ",", "filters", "=", "state_channel", ",", "kernel_size", "=", "(", "5", ",", "5", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'state_merge'", ",", "data_format", "=", "'channels_first'", ",", "activation", "=", "tf", ".", "nn", ".", "elu", ")", "\n", "\n", "# state = wrap_pad(state, 2)", "\n", "", "state_step", "=", "state_next", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "state", ",", "filters", "=", "state_channel", ",", "kernel_size", "=", "(", "5", ",", "5", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'dym1'", ",", "data_format", "=", "'channels_first'", ",", "activation", "=", "tf", ".", "nn", ".", "elu", ")", "\n", "\n", "outputs", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "1", ")", ":", "\n", "\n", "            ", "merge_step_1", "=", "tf", ".", "concat", "(", "[", "state_step", ",", "inp", "]", ",", "axis", "=", "1", ")", "\n", "# merge_step_1 = wrap_pad(merge_step_1, 1)", "\n", "output", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "merge_step_1", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'output'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "activation", "=", "tf", ".", "nn", ".", "elu", ")", "\n", "outputs", ".", "append", "(", "output", ")", "\n", "\n", "# if i != FLAGS.pred_steps -1:", "\n", "#     state_step = wrap_pad(state_step, 2)", "\n", "#     state_step = tf.layers.conv2d(inputs=state_step, filters=state_channel, kernel_size=(5, 5), strides=(1, 1),", "\n", "#                                   padding='same', name='dym1', data_format='channels_first', reuse=True, activation=tf.nn.elu)", "\n", "#     reuse = True", "\n", "\n", "", "output", "=", "tf", ".", "stack", "(", "outputs", ",", "axis", "=", "1", ")", "\n", "\n", "\n", "", "return", "[", "state_next", "]", ",", "output", ",", "state_step", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.convlstm": [[392, 444], ["tensorflow.split", "cell.get_shape", "inp.get_shape", "tensorflow.variable_scope", "tensorflow.layers.conv2d", "tensorflow.layers.conv2d", "tensorflow.layers.conv2d", "tensorflow.nn.sigmoid", "tensorflow.layers.conv2d", "tensorflow.layers.conv2d", "tensorflow.layers.conv2d", "tensorflow.nn.sigmoid", "tensorflow.layers.conv2d", "tensorflow.layers.conv2d", "tensorflow.layers.conv2d", "tensorflow.layers.conv2d", "tensorflow.layers.conv2d", "tensorflow.nn.sigmoid", "tensorflow.nn.tanh", "tensorflow.layers.conv2d", "tensorflow.concat", "tensorflow.nn.tanh"], "function", ["None"], ["", "def", "convlstm", "(", "inp", ",", "state", ",", "FLAGS", ",", "reuse", "=", "False", ",", "scope", "=", "\"\"", ",", "bypass_res", "=", "False", ")", ":", "\n", "    ", "\"\"\"Computes representation on inp through spatial mem given inp of size nchw and state of nchw\"\"\"", "\n", "\n", "state", "=", "state", "[", "0", "]", "\n", "cell", ",", "hidden", "=", "tf", ".", "split", "(", "state", ",", "2", ",", "axis", "=", "1", ")", "\n", "input_channel", "=", "cell", ".", "get_shape", "(", ")", "[", "1", "]", "\n", "output_channel", "=", "inp", ".", "get_shape", "(", ")", "[", "1", "]", "\n", "\n", "with", "tf", ".", "variable_scope", "(", "\"spatial_lstm\"", "+", "scope", ",", "reuse", "=", "reuse", ")", ":", "\n", "        ", "input_x", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "inp", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'ig'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "use_bias", "=", "False", ")", "\n", "input_h", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "hidden", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'hg'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "use_bias", "=", "False", ")", "\n", "input_c", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "cell", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'cg'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "\n", "inp_gate", "=", "tf", ".", "nn", ".", "sigmoid", "(", "input_x", "+", "input_h", "+", "input_c", ")", "\n", "\n", "forget_x", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "inp", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'if'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "use_bias", "=", "False", ")", "\n", "forget_h", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "hidden", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'hf'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "use_bias", "=", "False", ")", "\n", "forget_c", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "cell", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'cf'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "\n", "forget_gate", "=", "tf", ".", "nn", ".", "sigmoid", "(", "forget_x", "+", "forget_h", "+", "forget_c", ")", "\n", "\n", "\n", "input_act_x", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "inp", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'ii'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "use_bias", "=", "False", ")", "\n", "input_act_h", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "hidden", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'hi'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "\n", "inp", "=", "input_act_x", "+", "input_act_h", "\n", "\n", "output_x", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "inp", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'io'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "use_bias", "=", "False", ")", "\n", "output_h", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "hidden", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'ho'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "use_bias", "=", "False", ")", "\n", "output_c", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "cell", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'co'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "\n", "output_gate", "=", "tf", ".", "nn", ".", "sigmoid", "(", "output_x", "+", "output_h", "+", "output_c", ")", "\n", "\n", "cell_new", "=", "forget_gate", "*", "cell", "+", "inp_gate", "*", "tf", ".", "nn", ".", "tanh", "(", "inp", ")", "\n", "\n", "hidden_new", "=", "tf", ".", "nn", ".", "tanh", "(", "output_gate", "*", "cell_new", ")", "\n", "output", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "hidden_new", ",", "filters", "=", "output_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'creshape'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "state_next", "=", "tf", ".", "concat", "(", "[", "cell_new", ",", "hidden_new", "]", ",", "axis", "=", "1", ")", "\n", "\n", "", "return", "[", "state_next", "]", ",", "output", ",", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.conv2d_fixed_padding": [[446, 458], ["tensorflow.layers.conv2d", "fixed_padding", "tensorflow.variance_scaling_initializer"], "function", ["None"], ["", "def", "conv2d_fixed_padding", "(", "inputs", ",", "filters", ",", "kernel_size", ",", "strides", ",", "data_format", ",", "name", ")", ":", "\n", "  ", "\"\"\"Strided 2-D convolution with explicit padding.\"\"\"", "\n", "# The padding is consistent and is based only on `kernel_size`, not on the", "\n", "# dimensions of `inputs` (as opposed to using `tf.layers.conv2d` alone).", "\n", "if", "strides", ">", "1", ":", "\n", "    ", "inputs", "=", "fixed_padding", "(", "inputs", ",", "kernel_size", ",", "data_format", ")", "\n", "\n", "", "return", "tf", ".", "layers", ".", "conv2d", "(", "\n", "inputs", "=", "inputs", ",", "filters", "=", "filters", ",", "kernel_size", "=", "kernel_size", ",", "strides", "=", "strides", ",", "\n", "padding", "=", "(", "'SAME'", "if", "strides", "==", "1", "else", "'VALID'", ")", ",", "use_bias", "=", "False", ",", "\n", "kernel_initializer", "=", "tf", ".", "variance_scaling_initializer", "(", ")", ",", "\n", "data_format", "=", "data_format", ",", "name", "=", "name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.batch_norm": [[459, 467], ["tensorflow.layers.batch_normalization"], "function", ["None"], ["", "def", "batch_norm", "(", "inputs", ",", "training", ",", "data_format", ",", "name", ")", ":", "\n", "  ", "\"\"\"Performs a batch normalization using a standard set of parameters.\"\"\"", "\n", "# We set fused=True for a significant performance boost. See", "\n", "# https://www.tensorflow.org/performance/performance_guide#common_fused_ops", "\n", "return", "tf", ".", "layers", ".", "batch_normalization", "(", "\n", "inputs", "=", "inputs", ",", "axis", "=", "1", "if", "data_format", "==", "'channels_first'", "else", "3", ",", "\n", "momentum", "=", "_BATCH_NORM_DECAY", ",", "epsilon", "=", "_BATCH_NORM_EPSILON", ",", "center", "=", "True", ",", "\n", "scale", "=", "True", ",", "training", "=", "training", ",", "fused", "=", "True", ",", "name", "=", "name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.residual_block": [[469, 488], ["tensorflow.variable_scope", "tensorflow.nn.leaky_relu", "utils.conv2d_fixed_padding", "tensorflow.nn.leaky_relu", "utils.conv2d_fixed_padding", "utils.batch_norm", "utils.batch_norm"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.conv2d_fixed_padding", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.conv2d_fixed_padding", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.batch_norm", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.batch_norm"], ["", "def", "residual_block", "(", "inputs", ",", "filters", ",", "training", ",", "data_format", ",", "name", "=", "''", ",", "reuse", "=", "False", ",", "use_batch", "=", "False", ")", ":", "\n", "\n", "    ", "with", "tf", ".", "variable_scope", "(", "name", ",", "reuse", "=", "reuse", ")", ":", "\n", "        ", "shortcut", "=", "inputs", "\n", "\n", "if", "use_batch", ":", "\n", "            ", "inputs", "=", "batch_norm", "(", "inputs", ",", "training", ",", "data_format", ",", "name", "=", "'bn1'", ")", "\n", "\n", "", "inputs", "=", "tf", ".", "nn", ".", "leaky_relu", "(", "inputs", ")", "\n", "\n", "inputs", "=", "conv2d_fixed_padding", "(", "inputs", "=", "inputs", ",", "filters", "=", "filters", ",", "kernel_size", "=", "3", ",", "strides", "=", "1", ",", "data_format", "=", "data_format", ",", "name", "=", "'conv1'", ")", "\n", "\n", "if", "use_batch", ":", "\n", "            ", "inputs", "=", "batch_norm", "(", "inputs", ",", "training", ",", "data_format", ",", "name", "=", "'bn2'", ")", "\n", "\n", "", "inputs", "=", "tf", ".", "nn", ".", "leaky_relu", "(", "inputs", ")", "\n", "inputs", "=", "conv2d_fixed_padding", "(", "inputs", "=", "inputs", ",", "filters", "=", "filters", ",", "kernel_size", "=", "3", ",", "strides", "=", "1", ",", "data_format", "=", "data_format", ",", "name", "=", "'conv2'", ")", "\n", "\n", "", "return", "inputs", "+", "shortcut", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.check_image": [[490, 503], ["tensorflow.assert_equal", "list", "tf.identity.set_shape", "tensorflow.control_dependencies", "tensorflow.identity", "ValueError", "tf.identity.get_shape", "tensorflow.shape", "tf.identity.get_shape"], "function", ["None"], ["", "def", "check_image", "(", "image", ")", ":", "\n", "    ", "assertion", "=", "tf", ".", "assert_equal", "(", "tf", ".", "shape", "(", "image", ")", "[", "-", "1", "]", ",", "3", ",", "message", "=", "\"image must have 3 color channels\"", ")", "\n", "with", "tf", ".", "control_dependencies", "(", "[", "assertion", "]", ")", ":", "\n", "        ", "image", "=", "tf", ".", "identity", "(", "image", ")", "\n", "\n", "", "if", "image", ".", "get_shape", "(", ")", ".", "ndims", "not", "in", "(", "3", ",", "4", ")", ":", "\n", "        ", "raise", "ValueError", "(", "\"image must be either 3 or 4 dimensions\"", ")", "\n", "\n", "# make the last dimension 3 so that you can unstack the colors", "\n", "", "shape", "=", "list", "(", "image", ".", "get_shape", "(", ")", ")", "\n", "shape", "[", "-", "1", "]", "=", "3", "\n", "image", ".", "set_shape", "(", "shape", ")", "\n", "return", "image", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.rgb_to_lab": [[505, 544], ["tensorflow.name_scope", "utils.check_image", "tensorflow.reshape", "tensorflow.stop_gradient", "tensorflow.name_scope", "tensorflow.cast", "tensorflow.cast", "tensorflow.constant", "tensorflow.matmul", "tensorflow.name_scope", "tensorflow.multiply", "tensorflow.cast", "tensorflow.cast", "tensorflow.constant", "tensorflow.reshape", "tensorflow.matmul", "tensorflow.constant", "tensorflow.shape"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.check_image"], ["", "def", "rgb_to_lab", "(", "srgb", ")", ":", "\n", "    ", "with", "tf", ".", "name_scope", "(", "\"rgb_to_lab\"", ")", ":", "\n", "        ", "srgb", "=", "check_image", "(", "srgb", ")", "\n", "srgb_pixels", "=", "tf", ".", "reshape", "(", "srgb", ",", "[", "-", "1", ",", "3", "]", ")", "\n", "\n", "with", "tf", ".", "name_scope", "(", "\"srgb_to_xyz\"", ")", ":", "\n", "            ", "linear_mask", "=", "tf", ".", "cast", "(", "srgb_pixels", "<=", "0.04045", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "exponential_mask", "=", "tf", ".", "cast", "(", "srgb_pixels", ">", "0.04045", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "rgb_pixels", "=", "(", "srgb_pixels", "/", "12.92", "*", "linear_mask", ")", "+", "(", "(", "(", "srgb_pixels", "+", "0.055", ")", "/", "1.055", ")", "**", "2.4", ")", "*", "exponential_mask", "\n", "rgb_to_xyz", "=", "tf", ".", "constant", "(", "[", "\n", "#    X        Y          Z", "\n", "[", "0.412453", ",", "0.212671", ",", "0.019334", "]", ",", "# R", "\n", "[", "0.357580", ",", "0.715160", ",", "0.119193", "]", ",", "# G", "\n", "[", "0.180423", ",", "0.072169", ",", "0.950227", "]", ",", "# B", "\n", "]", ")", "\n", "xyz_pixels", "=", "tf", ".", "matmul", "(", "rgb_pixels", ",", "rgb_to_xyz", ")", "\n", "\n", "# https://en.wikipedia.org/wiki/Lab_color_space#CIELAB-CIEXYZ_conversions", "\n", "", "with", "tf", ".", "name_scope", "(", "\"xyz_to_cielab\"", ")", ":", "\n", "# convert to fx = f(X/Xn), fy = f(Y/Yn), fz = f(Z/Zn)", "\n", "\n", "# normalize for D65 white point", "\n", "            ", "xyz_normalized_pixels", "=", "tf", ".", "multiply", "(", "xyz_pixels", ",", "[", "1", "/", "0.950456", ",", "1.0", ",", "1", "/", "1.088754", "]", ")", "\n", "\n", "epsilon", "=", "6", "/", "29", "\n", "linear_mask", "=", "tf", ".", "cast", "(", "xyz_normalized_pixels", "<=", "(", "epsilon", "**", "3", ")", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "exponential_mask", "=", "tf", ".", "cast", "(", "xyz_normalized_pixels", ">", "(", "epsilon", "**", "3", ")", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "fxfyfz_pixels", "=", "(", "xyz_normalized_pixels", "/", "(", "3", "*", "epsilon", "**", "2", ")", "+", "4", "/", "29", ")", "*", "linear_mask", "+", "(", "xyz_normalized_pixels", "**", "(", "1", "/", "3", ")", ")", "*", "exponential_mask", "\n", "\n", "# convert to lab", "\n", "fxfyfz_to_lab", "=", "tf", ".", "constant", "(", "[", "\n", "#  l       a       b", "\n", "[", "0.0", ",", "500.0", ",", "0.0", "]", ",", "# fx", "\n", "[", "116.0", ",", "-", "500.0", ",", "200.0", "]", ",", "# fy", "\n", "[", "0.0", ",", "0.0", ",", "-", "200.0", "]", ",", "# fz", "\n", "]", ")", "\n", "lab_pixels", "=", "tf", ".", "matmul", "(", "fxfyfz_pixels", ",", "fxfyfz_to_lab", ")", "+", "tf", ".", "constant", "(", "[", "-", "16.0", ",", "0.0", ",", "0.0", "]", ")", "\n", "\n", "", "return", "tf", ".", "stop_gradient", "(", "tf", ".", "reshape", "(", "lab_pixels", ",", "tf", ".", "shape", "(", "srgb", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.preprocess_lab": [[545, 552], ["tensorflow.name_scope", "tensorflow.unstack", "tensorflow.stop_gradient", "tensorflow.stack"], "function", ["None"], ["", "", "def", "preprocess_lab", "(", "lab", ")", ":", "\n", "    ", "with", "tf", ".", "name_scope", "(", "\"preprocess_lab\"", ")", ":", "\n", "        ", "L_chan", ",", "a_chan", ",", "b_chan", "=", "tf", ".", "unstack", "(", "lab", ",", "axis", "=", "3", ")", "\n", "# L_chan: black and white with input range [0, 100]", "\n", "# a_chan/b_chan: color channels with input range ~[-110, 110], not exact", "\n", "# [0, 100] => [-1, 1],  ~[-110, 110] => [-1, 1]", "\n", "return", "tf", ".", "stop_gradient", "(", "tf", ".", "stack", "(", "[", "L_chan", "/", "50", "-", "1", ",", "a_chan", "/", "110", ",", "b_chan", "/", "110", "]", ",", "axis", "=", "3", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.generate.generate": [[17, 27], ["utils.construct_default_space", "range", "utils.step_simulation", "obs.append", "space.step"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_default_space", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_simulation", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step"], ["def", "generate", "(", "dim", ",", "num_sim", "=", "250", ")", ":", "\n", "    ", "screen", ",", "space", ",", "draw_options", "=", "construct_default_space", "(", ")", "\n", "obs", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "num_sim", ")", ":", "\n", "        ", "im", "=", "step_simulation", "(", "screen", ",", "space", ",", "draw_options", ")", "\n", "obs", ".", "append", "(", "im", ")", "\n", "space", ".", "step", "(", "0.01", ")", "\n", "\n", "", "return", "obs", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.generate.generate_simple": [[28, 68], ["utils.construct_space", "pymunk.Body", "pymunk.Circle", "numpy.random.randint", "tuple", "space.add", "pymunk.Segment", "space.add", "range", "numpy.random.randint", "utils.step_simulation", "obs.append", "space.step", "random.uniform", "random.uniform", "random.uniform"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_space", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer.add", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer.add", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_simulation", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step"], ["", "def", "generate_simple", "(", "dim", ",", "num_sim", "=", "500", ")", ":", "\n", "    ", "\"\"\"Only generate a simulation with 1 fixed wall location and one random ball\"\"\"", "\n", "space", ",", "screen", ",", "draw_options", "=", "construct_space", "(", "84", ")", "\n", "scene_color", "=", "(", "0", ",", "0", ",", "0", ")", "\n", "pos_low", "=", "0.1", "\n", "pos_high", "=", "0.9", "\n", "v_scale", "=", "200", "\n", "\n", "pos", "=", "dim", "*", "random", ".", "uniform", "(", "pos_low", ",", "pos_high", ")", ",", "10", "\n", "velocity", "=", "random", ".", "uniform", "(", "0.1", ",", "1", ")", "*", "v_scale", ",", "v_scale", "*", "random", ".", "uniform", "(", "-", "1", ",", "1", ")", "\n", "body", "=", "pm", ".", "Body", "(", "1", ",", "1", ")", "\n", "body", ".", "velocity", "=", "velocity", "\n", "body", ".", "position", "=", "pos", "\n", "shape", "=", "pm", ".", "Circle", "(", "body", ",", "np", ".", "random", ".", "randint", "(", "5", ",", "10", ")", ")", "\n", "\n", "shape", ".", "elasticity", "=", "0.95", "\n", "shape", ".", "friction", "=", "0.9", "\n", "idx", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "NUM_COLORS", ")", "\n", "shape", ".", "color", "=", "tuple", "(", "COLORS_TUPLE", "[", "idx", "]", ")", "\n", "\n", "space", ".", "add", "(", "body", ",", "shape", ")", "\n", "\n", "# Fix a horizontal wall at coordinate 70", "\n", "start_seg", "=", "(", "10", ",", "70", ")", "\n", "end_seg", "=", "(", "74", ",", "70", ")", "\n", "static_body", "=", "space", ".", "static_body", "\n", "seg", "=", "pm", ".", "Segment", "(", "static_body", ",", "start_seg", ",", "end_seg", ",", "0.0", ")", "\n", "seg", ".", "elasticity", "=", "0.95", "\n", "seg", ".", "friction", "=", "0.9", "\n", "\n", "space", ".", "add", "(", "seg", ")", "\n", "\n", "obs", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "num_sim", ")", ":", "\n", "        ", "im", "=", "step_simulation", "(", "screen", ",", "space", ",", "draw_options", ")", "\n", "obs", ".", "append", "(", "im", ")", "\n", "space", ".", "step", "(", "0.01", ")", "\n", "\n", "", "return", "obs", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.generate.generate_traj": [[70, 76], ["generate.generate", "numpy.stack"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.generate.generate"], ["", "def", "generate_traj", "(", "args", ")", ":", "\n", "    ", "obs", "=", "generate", "(", "84", ")", "\n", "obs", "=", "np", ".", "stack", "(", "obs", ")", "\n", "obs", "=", "obs", "[", ":", ":", "2", "]", "\n", "\n", "return", "obs", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.generate.generate_traj_simple": [[77, 83], ["generate.generate_simple", "numpy.stack"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.generate.generate_simple"], ["", "def", "generate_traj_simple", "(", "args", ")", ":", "\n", "    ", "obs", "=", "generate_simple", "(", "84", ")", "\n", "obs", "=", "np", ".", "stack", "(", "obs", ")", "\n", "obs", "=", "obs", "[", ":", ":", "2", "]", "\n", "\n", "return", "obs", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.generate.generate_trajs": [[84, 93], ["multiprocessing.pool.Pool", "numpy.stack", "multiprocessing.pool.Pool.map", "multiprocessing.pool.Pool.map"], "function", ["None"], ["", "def", "generate_trajs", "(", "traj_num", "=", "50000", ",", "simple", "=", "False", ")", ":", "\n", "    ", "args", "=", "[", "None", "]", "*", "traj_num", "\n", "pool", "=", "Pool", "(", ")", "\n", "if", "simple", ":", "\n", "        ", "total_obs", "=", "pool", ".", "map", "(", "generate_traj_simple", ",", "args", ")", "\n", "", "else", ":", "\n", "        ", "total_obs", "=", "pool", ".", "map", "(", "generate_traj", ",", "args", ")", "\n", "\n", "", "return", "np", ".", "stack", "(", "total_obs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d.PhysEnv3D.__init__": [[16, 38], ["pybullet.connect", "pybullet.setAdditionalSearchPath", "pybullet.setPhysicsEngineParameter", "gym.spaces.Discrete", "pybullet_data.getDataPath", "gym.spaces.Box", "gym.spaces.Box"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "order", "=", "1", ",", "frame_stack", "=", "1", ",", "pm_oracle", "=", "False", ",", "pred_steps", "=", "0", ",", "balance_frames", "=", "False", ")", ":", "\n", "        ", "self", ".", "frame_stack", "=", "frame_stack", "\n", "self", ".", "pm_oracle", "=", "pm_oracle", "\n", "self", ".", "pred_steps", "=", "pred_steps", "\n", "self", ".", "balance_frames", "=", "balance_frames", "\n", "\n", "self", ".", "client", "=", "p", ".", "connect", "(", "p", ".", "DIRECT", ")", "\n", "p", ".", "setAdditionalSearchPath", "(", "pybullet_data", ".", "getDataPath", "(", ")", ")", "\n", "p", ".", "setPhysicsEngineParameter", "(", "fixedTimeStep", "=", "1", "/", "15.", ",", "numSolverIterations", "=", "1", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "self", ".", "vs", "=", "[", "(", "-", "1", ",", "0", ")", ",", "(", "1", ",", "0", ")", ",", "(", "0", ",", "-", "1", ")", ",", "(", "0", ",", "1", ")", "]", "\n", "self", ".", "spec", "=", "\"trash\"", "\n", "\n", "\n", "if", "not", "pm_oracle", ":", "\n", "            ", "pred_steps", "=", "0", "\n", "\n", "", "if", "not", "balance_frames", ":", "\n", "            ", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "0", ",", "255", ",", "(", "84", ",", "84", ",", "3", "*", "(", "frame_stack", "+", "pred_steps", ")", ")", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "0", ",", "255", ",", "(", "84", ",", "84", ",", "3", "*", "(", "frame_stack", ")", ")", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "\n", "", "self", ".", "action_space", "=", "spaces", ".", "Discrete", "(", "4", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d.PhysEnv3D.step": [[39, 92], ["numpy.array().flatten", "pybullet.getBasePositionAndOrientation", "sum", "utils.step_3d_simulation", "phys_3d.PhysEnv3D.out_bounds", "phys_3d.PhysEnv3D.construct_obs", "utils.reset_3d_velocity", "utils.get_3d_image", "pybullet.getBasePositionAndOrientation", "list", "pybullet.resetBasePositionAndOrientation", "utils.respawn_rand_goal", "numpy.array", "abs", "zip"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_3d_simulation", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.out_bounds", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.construct_obs", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.reset_3d_velocity", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.get_3d_image", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.respawn_rand_goal"], ["", "def", "step", "(", "self", ",", "actions", ")", ":", "\n", "\n", "        ", "actions", "=", "np", ".", "array", "(", "actions", ")", ".", "flatten", "(", ")", "\n", "\n", "reward", "=", "0", "\n", "total_length", "=", "0", "\n", "\n", "info", "=", "{", "}", "\n", "\n", "obs", "=", "[", "get_3d_image", "(", "physicsClientId", "=", "self", ".", "client", ")", "]", "\n", "\n", "self", ".", "iter", "+=", "1", "\n", "\n", "for", "act", "in", "actions", ":", "\n", "            ", "pos", ",", "ori", "=", "p", ".", "getBasePositionAndOrientation", "(", "self", ".", "player_body", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "pos", "=", "list", "(", "pos", ")", "\n", "pos", "[", "0", "]", "=", "pos", "[", "0", "]", "+", "self", ".", "vs", "[", "act", "]", "[", "0", "]", "\n", "pos", "[", "1", "]", "=", "pos", "[", "1", "]", "+", "self", ".", "vs", "[", "act", "]", "[", "1", "]", "\n", "pos", "[", "2", "]", "=", "pos", "[", "2", "]", "\n", "\n", "p", ".", "resetBasePositionAndOrientation", "(", "self", ".", "player_body", ",", "pos", ",", "ori", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "\n", "", "goal_pos", ",", "_", "=", "p", ".", "getBasePositionAndOrientation", "(", "self", ".", "goal_body", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "\n", "dist", "=", "sum", "(", "abs", "(", "gp", "-", "p", ")", "for", "(", "gp", ",", "p", ")", "in", "zip", "(", "goal_pos", ",", "pos", ")", ")", "\n", "\n", "if", "dist", "<=", "1.5", ":", "\n", "            ", "reward", "=", "1", "\n", "respawn_rand_goal", "(", "self", ".", "goal_body", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "", "else", ":", "\n", "            ", "reward", "=", "0", "\n", "\n", "", "done", "=", "step_3d_simulation", "(", "self", ".", "player_body", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "\n", "if", "self", ".", "out_bounds", "(", "pos", ")", ":", "\n", "            ", "done", "=", "True", "\n", "\n", "", "ob", "=", "self", ".", "construct_obs", "(", "obs", ")", "\n", "self", ".", "total_reward", "+=", "reward", "\n", "self", ".", "total_length", "+=", "total_length", "\n", "\n", "reset_3d_velocity", "(", "self", ".", "bodies", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "\n", "if", "self", ".", "iter", ">", "1000", ":", "\n", "            ", "done", "=", "True", "\n", "\n", "", "if", "done", ":", "\n", "            ", "episode", "=", "{", "}", "\n", "episode", "[", "'r'", "]", "=", "self", ".", "total_reward", "\n", "episode", "[", "'l'", "]", "=", "self", ".", "total_length", "\n", "info", "[", "'episode'", "]", "=", "episode", "\n", "\n", "", "return", "ob", ",", "reward", ",", "done", ",", "info", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d.PhysEnv3D.out_bounds": [[93, 95], ["None"], "methods", ["None"], ["", "def", "out_bounds", "(", "self", ",", "pos", ")", ":", "\n", "        ", "return", "(", "pos", "[", "0", "]", "<", "-", "0.5", ")", "or", "(", "pos", "[", "0", "]", ">", "10.5", ")", "or", "(", "pos", "[", "1", "]", "<", "-", "0.5", ")", "or", "(", "pos", "[", "1", "]", ">", "10.5", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d.PhysEnv3D.seed": [[96, 99], ["numpy.random.seed"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.seed"], ["", "def", "seed", "(", "self", ",", "seed", ")", ":", "\n", "        ", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "self", ".", "seed", "=", "seed", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d.PhysEnv3D.reset": [[100, 137], ["pybullet.resetSimulation", "utils.construct_3d_space", "pybullet.setGravity", "pybullet.createVisualShape", "pybullet.createCollisionShape", "pybullet.createMultiBody", "utils.spawn_rand_goal_3d", "range", "phys_3d.PhysEnv3D.construct_obs", "utils.step_3d_simulation", "phys_3d.PhysEnv3D.frame_buffer.append", "utils.get_3d_image"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_3d_space", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.spawn_rand_goal_3d", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.construct_obs", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_3d_simulation", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.get_3d_image"], ["", "def", "reset", "(", "self", ")", ":", "\n", "        ", "p", ".", "resetSimulation", "(", "physicsClientId", "=", "self", ".", "client", ")", "\n", "bodies", "=", "construct_3d_space", "(", "min_obj", "=", "30", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "self", ".", "bodies", "=", "bodies", "\n", "p", ".", "setGravity", "(", "0", ",", "0", ",", "-", "10", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "\n", "self", ".", "iter", "=", "0", "\n", "\n", "# Construct the player sprite", "\n", "player_vid", "=", "p", ".", "createVisualShape", "(", "p", ".", "GEOM_SPHERE", ",", "radius", "=", "0.5", ",", "rgbaColor", "=", "(", "0.3", ",", "0.3", ",", "0.3", ",", "1", ")", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "player_cid", "=", "p", ".", "createCollisionShape", "(", "p", ".", "GEOM_SPHERE", ",", "radius", "=", "0.5", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "player_body", "=", "p", ".", "createMultiBody", "(", "1", ",", "baseVisualShapeIndex", "=", "player_vid", ",", "baseCollisionShapeIndex", "=", "player_cid", ",", "basePosition", "=", "[", "5", ",", "5", ",", "0.5", "]", ",", "baseOrientation", "=", "[", "0", ",", "0", ",", "0", ",", "1", "]", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "\n", "goal_body", "=", "spawn_rand_goal_3d", "(", "first", "=", "True", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "\n", "self", ".", "player_body", "=", "player_body", "\n", "self", ".", "goal_body", "=", "goal_body", "\n", "\n", "# g = space.add_collision_handler(collision_types['player'], collision_types['object'])", "\n", "# g.begin = remove_player", "\n", "\n", "# self.space = space", "\n", "# self.screen = screen", "\n", "# self.draw_options = draw_options", "\n", "# self.player_body = body", "\n", "\n", "self", ".", "total_reward", "=", "0", "\n", "self", ".", "total_length", "=", "0", "\n", "\n", "self", ".", "frame_buffer", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "self", ".", "frame_stack", ")", ":", "\n", "            ", "step_3d_simulation", "(", "self", ".", "player_body", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "self", ".", "frame_buffer", ".", "append", "(", "get_3d_image", "(", "physicsClientId", "=", "self", ".", "client", ")", ")", "\n", "\n", "", "obs", "=", "self", ".", "construct_obs", "(", ")", "\n", "return", "obs", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d.PhysEnv3D.render": [[138, 143], ["utils.get_3d_image", "plt.imshow", "plt.show"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.get_3d_image"], ["", "def", "render", "(", "self", ")", ":", "\n", "        ", "im", "=", "get_3d_image", "(", "physicsClientId", "=", "self", ".", "client", ")", "\n", "import", "matplotlib", ".", "pyplot", "as", "plt", "\n", "plt", ".", "imshow", "(", "im", ")", "\n", "plt", ".", "show", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d.PhysEnv3D.construct_obs": [[144, 172], ["phys_3d.PhysEnv3D.frame_buffer.extend", "numpy.concatenate", "utils.save_bullet_state", "range", "utils.restore_bullet_state", "obs.extend", "utils.get_3d_image", "utils.step_3d_simulation", "future_obs.append", "utils.get_3d_image"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.save_bullet_state", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.restore_bullet_state", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.get_3d_image", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_3d_simulation", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.get_3d_image"], ["", "def", "construct_obs", "(", "self", ",", "new_obs", "=", "None", ")", ":", "\n", "# Adds a frame into the frame buffer and returns the concatenated observation", "\n", "        ", "if", "new_obs", "is", "None", ":", "\n", "            ", "new_obs", "=", "[", "get_3d_image", "(", "physicsClientId", "=", "self", ".", "client", ")", "]", "\n", "\n", "# print(p.getBasePositionAndOrientation(1))", "\n", "# print(p.getBasePositionAndOrientation(2))", "\n", "", "self", ".", "frame_buffer", ".", "extend", "(", "new_obs", ")", "\n", "self", ".", "frame_buffer", "=", "self", ".", "frame_buffer", "[", "-", "self", ".", "frame_stack", ":", "]", "\n", "obs", "=", "self", ".", "frame_buffer", "\n", "\n", "if", "self", ".", "pred_steps", ">", "0", "and", "self", ".", "pm_oracle", ":", "\n", "            ", "snapshot", "=", "save_bullet_state", "(", "physicsClientId", "=", "self", ".", "client", ")", "\n", "future_obs", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "self", ".", "pred_steps", ")", ":", "\n", "                ", "step_3d_simulation", "(", "self", ".", "player_body", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "future_obs", ".", "append", "(", "get_3d_image", "(", "physicsClientId", "=", "self", ".", "client", ")", ")", "\n", "\n", "", "restore_bullet_state", "(", "snapshot", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "obs", ".", "extend", "(", "future_obs", ")", "\n", "\n", "# self.player_body.reward = 0", "\n", "\n", "", "if", "self", ".", "balance_frames", ":", "\n", "            ", "obs", "=", "obs", "[", "-", "self", ".", "frame_stack", ":", "]", "\n", "\n", "", "return", "np", ".", "concatenate", "(", "obs", ",", "axis", "=", "2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d.PhysEnv3D.close": [[173, 175], ["None"], "methods", ["None"], ["", "def", "close", "(", "self", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d.fetch_action": [[177, 179], ["int", "input"], "function", ["None"], ["", "", "def", "fetch_action", "(", ")", ":", "\n", "    ", "return", "int", "(", "input", "(", "\"Enter your move (0, 1, 2, 3) : \"", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env_alternate.PhysEnv.__init__": [[15, 34], ["phys_env_alternate.PhysEnv.reset", "gym.spaces.Discrete", "gym.spaces.Box", "gym.spaces.Box"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.reset"], ["    ", "def", "__init__", "(", "self", ",", "order", "=", "1", ",", "frame_stack", "=", "1", ",", "pm_oracle", "=", "False", ",", "pred_steps", "=", "0", ",", "balance_frames", "=", "False", ")", ":", "\n", "        ", "self", ".", "frame_stack", "=", "frame_stack", "\n", "self", ".", "pm_oracle", "=", "pm_oracle", "\n", "self", ".", "pred_steps", "=", "pred_steps", "\n", "self", ".", "balance_frames", "=", "balance_frames", "\n", "self", ".", "reset", "(", ")", "\n", "self", ".", "vs", "=", "[", "(", "-", "500", ",", "0", ")", ",", "(", "500", ",", "0", ")", ",", "(", "0", ",", "-", "500", ")", ",", "(", "0", ",", "500", ")", "]", "\n", "\n", "if", "not", "pm_oracle", ":", "\n", "            ", "pred_steps", "=", "0", "\n", "\n", "", "if", "not", "balance_frames", ":", "\n", "            ", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "0", ",", "255", ",", "(", "84", ",", "84", ",", "3", "*", "(", "frame_stack", "+", "pred_steps", ")", ")", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "0", ",", "255", ",", "(", "84", ",", "84", ",", "3", "*", "(", "frame_stack", ")", ")", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "\n", "", "self", ".", "order", "=", "order", "\n", "self", ".", "action_space", "=", "spaces", ".", "Discrete", "(", "4", ")", "\n", "self", ".", "spec", "=", "\"trash\"", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env_alternate.PhysEnv.step": [[35, 78], ["numpy.array().flatten", "numpy.array().flatten", "phys_env_alternate.PhysEnv.construct_obs", "phys_env_alternate.PhysEnv.space.step", "obs.append", "numpy.array", "numpy.array", "utils.step_simulation", "phys_env_alternate.PhysEnv.out_bounds", "phys_env_alternate.PhysEnv.construct_obs"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.construct_obs", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_simulation", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.out_bounds", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.construct_obs"], ["", "def", "step", "(", "self", ",", "actions", ")", ":", "\n", "\n", "        ", "actions", "=", "np", ".", "array", "(", "actions", ")", ".", "flatten", "(", ")", "\n", "\n", "reward", "=", "0", "\n", "total_length", "=", "0", "\n", "\n", "info", "=", "{", "}", "\n", "\n", "obs", "=", "[", "]", "\n", "\n", "for", "act", "in", "actions", ":", "\n", "            ", "dv", "=", "self", ".", "vs", "[", "act", "]", "\n", "v", "=", "self", ".", "player_body", ".", "velocity", "\n", "nv", "=", "(", "dv", "[", "0", "]", ",", "dv", "[", "1", "]", ")", "\n", "self", ".", "player_body", ".", "velocity", "=", "nv", "\n", "self", ".", "space", ".", "step", "(", "0.01", ")", "\n", "\n", "reward", "+=", "self", ".", "player_body", ".", "reward", "\n", "self", ".", "player_body", ".", "reward", "=", "0", "\n", "\n", "obs", ".", "append", "(", "step_simulation", "(", "self", ".", "screen", ",", "self", ".", "space", ",", "self", ".", "draw_options", ")", ")", "\n", "total_length", "+=", "1", "\n", "\n", "if", "self", ".", "player_body", ".", "done", "or", "self", ".", "out_bounds", "(", "self", ".", "player_body", ".", "position", ")", ":", "\n", "                ", "reward", "=", "-", "1", "\n", "self", ".", "total_reward", "+=", "reward", "\n", "self", ".", "total_length", "+=", "total_length", "\n", "done", "=", "True", "\n", "episode", "=", "{", "}", "\n", "episode", "[", "'r'", "]", "=", "self", ".", "total_reward", "\n", "episode", "[", "'l'", "]", "=", "self", ".", "total_length", "\n", "info", "[", "'episode'", "]", "=", "episode", "\n", "ob", "=", "self", ".", "construct_obs", "(", "obs", ")", "\n", "return", "ob", ",", "reward", ",", "done", ",", "info", "\n", "", "else", ":", "\n", "                ", "done", "=", "False", "\n", "\n", "", "", "ob", "=", "self", ".", "construct_obs", "(", "obs", ")", "\n", "self", ".", "total_reward", "+=", "reward", "\n", "self", ".", "total_length", "+=", "total_length", "\n", "\n", "return", "ob", ",", "reward", ",", "done", ",", "info", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env_alternate.PhysEnv.out_bounds": [[79, 81], ["None"], "methods", ["None"], ["", "def", "out_bounds", "(", "self", ",", "pos", ")", ":", "\n", "        ", "return", "(", "pos", "[", "0", "]", "<", "0", ")", "or", "(", "pos", "[", "0", "]", ">", "84", ")", "or", "(", "pos", "[", "1", "]", "<", "0", ")", "or", "(", "pos", "[", "1", "]", ">", "84", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env_alternate.PhysEnv.seed": [[82, 84], ["numpy.random.seed", "numpy.random.seed"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.seed", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.seed"], ["", "def", "seed", "(", "self", ",", "seed", ")", ":", "\n", "        ", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env_alternate.PhysEnv.reset": [[85, 154], ["utils.construct_default_space", "numpy.random.randint", "numpy.random.randint", "range", "pymunk.Body", "pymunk.Body", "pymunk.Circle", "pymunk.Circle", "space.add", "space.add_collision_handler", "space.add_collision_handler", "list", "phys_env_alternate.PhysEnv.construct_obs", "utils.construct_rand_box", "utils.construct_rand_circle", "numpy.zeros", "numpy.zeros", "random.uniform", "random.uniform", "random.uniform", "random.uniform"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_default_space", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer.add", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.construct_obs", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_rand_box", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_rand_circle"], ["", "def", "reset", "(", "self", ")", ":", "\n", "        ", "screen", ",", "space", ",", "draw_options", "=", "construct_default_space", "(", "no_object", "=", "True", ")", "\n", "\n", "obj_num", "=", "np", ".", "random", ".", "randint", "(", "3", ",", "8", ")", "\n", "\n", "for", "_", "in", "range", "(", "obj_num", ")", ":", "\n", "            ", "construct_rand_box", "(", "space", ",", "84", ")", "\n", "construct_rand_circle", "(", "space", ",", "84", ")", "\n", "\n", "# Construct the player sprite", "\n", "", "body", "=", "pm", ".", "Body", "(", "1", ",", "1", ")", "\n", "body", ".", "velocity", "=", "(", "0", ",", "0", ")", "\n", "body", ".", "position", "=", "(", "6", ",", "6", ")", "\n", "body", ".", "done", "=", "False", "\n", "body", ".", "reward", "=", "0", "\n", "\n", "shape", "=", "pm", ".", "Circle", "(", "body", ",", "4", ")", "\n", "shape", ".", "color", "=", "(", "0", ",", "0", ",", "255", ",", "255", ")", "\n", "shape", ".", "elasticity", "=", "0.95", "\n", "shape", ".", "friction", "=", "0.9", "\n", "shape", ".", "collision_type", "=", "collision_types", "[", "\"player\"", "]", "\n", "\n", "space", ".", "add", "(", "body", ",", "shape", ")", "\n", "\n", "def", "remove_player", "(", "arbiter", ",", "space", ",", "data", ")", ":", "\n", "            ", "player_shape", "=", "arbiter", ".", "shapes", "[", "0", "]", "\n", "player_shape", ".", "body", ".", "done", "=", "True", "\n", "# space.remove(player_shape, player_shape.body)", "\n", "return", "True", "\n", "\n", "", "def", "reward_player", "(", "arbiter", ",", "space", ",", "data", ")", ":", "\n", "            ", "player_shape", "=", "arbiter", ".", "shapes", "[", "0", "]", "\n", "target_shape", "=", "arbiter", ".", "shapes", "[", "1", "]", "\n", "player_shape", ".", "body", ".", "reward", "+=", "1", "\n", "\n", "dim", "=", "84", "\n", "pos_low", "=", "0.2", "\n", "pos_high", "=", "0.95", "\n", "pos", "=", "dim", "*", "random", ".", "uniform", "(", "pos_low", ",", "pos_high", ")", ",", "dim", "*", "random", ".", "uniform", "(", "pos_low", ",", "pos_high", ")", "\n", "\n", "v_scale", "=", "300", "\n", "velocity", "=", "v_scale", "*", "random", ".", "uniform", "(", "-", "1", ",", "1", ")", ",", "v_scale", "*", "random", ".", "uniform", "(", "-", "1", ",", "1", ")", "\n", "\n", "target_shape", ".", "body", ".", "position", "=", "pos", "\n", "target_shape", ".", "body", ".", "velocity", "=", "velocity", "\n", "\n", "# space.remove(player_shape, player_shape.body)", "\n", "return", "True", "\n", "\n", "", "dim", "=", "84", "\n", "\n", "g", "=", "space", ".", "add_collision_handler", "(", "collision_types", "[", "'player'", "]", ",", "collision_types", "[", "'box'", "]", ")", "\n", "g", ".", "begin", "=", "remove_player", "\n", "\n", "h", "=", "space", ".", "add_collision_handler", "(", "collision_types", "[", "'player'", "]", ",", "collision_types", "[", "'circle'", "]", ")", "\n", "h", ".", "begin", "=", "reward_player", "\n", "\n", "self", ".", "space", "=", "space", "\n", "self", ".", "screen", "=", "screen", "\n", "self", ".", "draw_options", "=", "draw_options", "\n", "self", ".", "player_body", "=", "body", "\n", "\n", "self", ".", "total_reward", "=", "0", "\n", "self", ".", "total_length", "=", "0", "\n", "\n", "self", ".", "frame_buffer", "=", "list", "(", "np", ".", "zeros", "(", "(", "self", ".", "frame_stack", ",", "84", ",", "84", ",", "3", ")", ",", "dtype", "=", "np", ".", "uint8", ")", ")", "\n", "\n", "obs", "=", "self", ".", "construct_obs", "(", ")", "\n", "return", "obs", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env_alternate.PhysEnv.render": [[155, 159], ["utils.step_simulation", "matplotlib.imshow", "matplotlib.show"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_simulation"], ["", "def", "render", "(", "self", ")", ":", "\n", "        ", "im", "=", "step_simulation", "(", "self", ".", "screen", ",", "self", ".", "space", ",", "self", ".", "draw_options", ")", "\n", "plt", ".", "imshow", "(", "im", ")", "\n", "plt", ".", "show", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env_alternate.PhysEnv.construct_obs": [[160, 186], ["phys_env_alternate.PhysEnv.frame_buffer.extend", "numpy.concatenate", "numpy.concatenate", "utils.save_state", "range", "utils.restore_state", "obs.extend", "utils.step_simulation", "phys_env_alternate.PhysEnv.space.step", "future_obs.append", "utils.step_simulation"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.save_state", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.restore_state", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_simulation", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_simulation"], ["", "def", "construct_obs", "(", "self", ",", "new_obs", "=", "None", ")", ":", "\n", "# Adds a frame into the frame buffer and returns the concatenated observation", "\n", "        ", "if", "new_obs", "is", "None", ":", "\n", "            ", "new_obs", "=", "[", "step_simulation", "(", "self", ".", "screen", ",", "self", ".", "space", ",", "self", ".", "draw_options", ")", "]", "\n", "\n", "", "self", ".", "frame_buffer", ".", "extend", "(", "new_obs", ")", "\n", "self", ".", "frame_buffer", "=", "self", ".", "frame_buffer", "[", "-", "self", ".", "frame_stack", ":", "]", "\n", "obs", "=", "self", ".", "frame_buffer", "\n", "\n", "if", "self", ".", "pred_steps", ">", "0", "and", "self", ".", "pm_oracle", ":", "\n", "            ", "snapshot", "=", "save_state", "(", "self", ".", "space", ")", "\n", "future_obs", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "self", ".", "pred_steps", ")", ":", "\n", "                ", "self", ".", "space", ".", "step", "(", "0.01", ")", "\n", "future_obs", ".", "append", "(", "step_simulation", "(", "self", ".", "screen", ",", "self", ".", "space", ",", "self", ".", "draw_options", ")", ")", "\n", "\n", "", "restore_state", "(", "snapshot", ")", "\n", "obs", ".", "extend", "(", "future_obs", ")", "\n", "\n", "", "self", ".", "player_body", ".", "reward", "=", "0", "\n", "\n", "if", "self", ".", "balance_frames", ":", "\n", "            ", "obs", "=", "obs", "[", "-", "self", ".", "frame_stack", ":", "]", "\n", "\n", "", "return", "np", ".", "concatenate", "(", "obs", ",", "axis", "=", "2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env_alternate.PhysEnv.close": [[187, 189], ["None"], "methods", ["None"], ["", "def", "close", "(", "self", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env_alternate.fetch_action": [[191, 193], ["int", "input"], "function", ["None"], ["", "", "def", "fetch_action", "(", ")", ":", "\n", "    ", "return", "int", "(", "input", "(", "\"Enter your move (0, 1, 2, 3) : \"", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env.PhysEnv.__init__": [[15, 34], ["phys_env.PhysEnv.reset", "gym.spaces.Discrete", "gym.spaces.Box", "gym.spaces.Box"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.reset"], ["    ", "def", "__init__", "(", "self", ",", "order", "=", "1", ",", "frame_stack", "=", "1", ",", "pm_oracle", "=", "False", ",", "pred_steps", "=", "0", ",", "balance_frames", "=", "False", ")", ":", "\n", "        ", "self", ".", "frame_stack", "=", "frame_stack", "\n", "self", ".", "pm_oracle", "=", "pm_oracle", "\n", "self", ".", "pred_steps", "=", "pred_steps", "\n", "self", ".", "balance_frames", "=", "balance_frames", "\n", "self", ".", "reset", "(", ")", "\n", "self", ".", "vs", "=", "[", "(", "-", "500", ",", "0", ")", ",", "(", "500", ",", "0", ")", ",", "(", "0", ",", "-", "500", ")", ",", "(", "0", ",", "500", ")", "]", "\n", "self", ".", "spec", "=", "\"trash\"", "\n", "\n", "if", "not", "pm_oracle", ":", "\n", "            ", "pred_steps", "=", "0", "\n", "\n", "", "if", "not", "balance_frames", ":", "\n", "            ", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "0", ",", "255", ",", "(", "84", ",", "84", ",", "3", "*", "(", "frame_stack", "+", "pred_steps", ")", ")", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "0", ",", "255", ",", "(", "84", ",", "84", ",", "3", "*", "(", "frame_stack", ")", ")", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "\n", "", "self", ".", "order", "=", "order", "\n", "self", ".", "action_space", "=", "spaces", ".", "Discrete", "(", "4", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env.PhysEnv.step": [[35, 79], ["numpy.array().flatten", "numpy.array().flatten", "phys_env.PhysEnv.construct_obs", "phys_env.PhysEnv.space.step", "obs.append", "utils.distance", "numpy.array", "numpy.array", "utils.step_simulation", "phys_env.PhysEnv.out_bounds", "phys_env.PhysEnv.construct_obs", "random.uniform", "random.uniform"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.construct_obs", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.distance", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_simulation", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.out_bounds", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.construct_obs"], ["", "def", "step", "(", "self", ",", "actions", ")", ":", "\n", "\n", "        ", "actions", "=", "np", ".", "array", "(", "actions", ")", ".", "flatten", "(", ")", "\n", "\n", "reward", "=", "0", "\n", "total_length", "=", "0", "\n", "\n", "info", "=", "{", "}", "\n", "\n", "obs", "=", "[", "]", "\n", "\n", "for", "act", "in", "actions", ":", "\n", "            ", "dv", "=", "self", ".", "vs", "[", "act", "]", "\n", "v", "=", "self", ".", "player_body", ".", "velocity", "\n", "nv", "=", "(", "dv", "[", "0", "]", ",", "dv", "[", "1", "]", ")", "\n", "self", ".", "player_body", ".", "velocity", "=", "nv", "\n", "\n", "self", ".", "space", ".", "step", "(", "0.01", ")", "\n", "obs", ".", "append", "(", "step_simulation", "(", "self", ".", "screen", ",", "self", ".", "space", ",", "self", ".", "draw_options", ")", ")", "\n", "total_length", "+=", "1", "\n", "\n", "if", "self", ".", "player_body", ".", "done", "or", "self", ".", "out_bounds", "(", "self", ".", "player_body", ".", "position", ")", ":", "\n", "                ", "reward", "=", "-", "1", "\n", "self", ".", "total_reward", "+=", "reward", "\n", "self", ".", "total_length", "+=", "total_length", "\n", "done", "=", "True", "\n", "episode", "=", "{", "}", "\n", "episode", "[", "'r'", "]", "=", "self", ".", "total_reward", "\n", "episode", "[", "'l'", "]", "=", "self", ".", "total_length", "\n", "info", "[", "'episode'", "]", "=", "episode", "\n", "ob", "=", "self", ".", "construct_obs", "(", "obs", ")", "\n", "return", "ob", ",", "reward", ",", "done", ",", "info", "\n", "", "else", ":", "\n", "                ", "done", "=", "False", "\n", "\n", "", "", "if", "distance", "(", "self", ".", "player_body", ",", "self", ".", "target_body", ")", "<", "10", ":", "\n", "            ", "reward", "=", "1", "\n", "self", ".", "target_body", ".", "position", "=", "84", "*", "random", ".", "uniform", "(", "0.1", ",", "0.9", ")", ",", "84", "*", "random", ".", "uniform", "(", "0.1", ",", "0.9", ")", "\n", "\n", "", "ob", "=", "self", ".", "construct_obs", "(", "obs", ")", "\n", "self", ".", "total_reward", "+=", "reward", "\n", "self", ".", "total_length", "+=", "total_length", "\n", "\n", "return", "ob", ",", "reward", ",", "done", ",", "info", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env.PhysEnv.out_bounds": [[80, 82], ["None"], "methods", ["None"], ["", "def", "out_bounds", "(", "self", ",", "pos", ")", ":", "\n", "        ", "return", "(", "pos", "[", "0", "]", "<", "0", ")", "or", "(", "pos", "[", "0", "]", ">", "84", ")", "or", "(", "pos", "[", "1", "]", "<", "0", ")", "or", "(", "pos", "[", "1", "]", ">", "84", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env.PhysEnv.seed": [[83, 85], ["numpy.random.seed", "numpy.random.seed"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.seed", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.seed"], ["", "def", "seed", "(", "self", ",", "seed", ")", ":", "\n", "        ", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env.PhysEnv.reset": [[86, 131], ["utils.construct_default_space", "pymunk.Body", "pymunk.Body", "pymunk.Circle", "pymunk.Circle", "space.add", "utils.spawn_rand_goal", "space.add_collision_handler", "list", "phys_env.PhysEnv.construct_obs", "numpy.zeros", "numpy.zeros"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_default_space", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer.add", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.spawn_rand_goal", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.construct_obs"], ["", "def", "reset", "(", "self", ")", ":", "\n", "        ", "screen", ",", "space", ",", "draw_options", "=", "construct_default_space", "(", "min_obj", "=", "7", ")", "\n", "\n", "# Construct the player sprite", "\n", "body", "=", "pm", ".", "Body", "(", "1", ",", "1", ")", "\n", "body", ".", "velocity", "=", "(", "0", ",", "0", ")", "\n", "body", ".", "position", "=", "(", "6", ",", "6", ")", "\n", "body", ".", "done", "=", "False", "\n", "body", ".", "reward", "=", "0", "\n", "\n", "shape", "=", "pm", ".", "Circle", "(", "body", ",", "4", ")", "\n", "shape", ".", "color", "=", "(", "0", ",", "0", ",", "255", ",", "255", ")", "\n", "shape", ".", "elasticity", "=", "0.95", "\n", "shape", ".", "friction", "=", "0.9", "\n", "shape", ".", "collision_type", "=", "collision_types", "[", "\"player\"", "]", "\n", "\n", "space", ".", "add", "(", "body", ",", "shape", ")", "\n", "\n", "t_body", "=", "spawn_rand_goal", "(", "space", ",", "84", ")", "\n", "\n", "self", ".", "target_body", "=", "t_body", "\n", "\n", "def", "remove_player", "(", "arbiter", ",", "space", ",", "data", ")", ":", "\n", "            ", "player_shape", "=", "arbiter", ".", "shapes", "[", "0", "]", "\n", "player_shape", ".", "body", ".", "done", "=", "True", "\n", "# space.remove(player_shape, player_shape.body)", "\n", "return", "True", "\n", "\n", "", "dim", "=", "84", "\n", "\n", "g", "=", "space", ".", "add_collision_handler", "(", "collision_types", "[", "'player'", "]", ",", "collision_types", "[", "'object'", "]", ")", "\n", "g", ".", "begin", "=", "remove_player", "\n", "\n", "self", ".", "space", "=", "space", "\n", "self", ".", "screen", "=", "screen", "\n", "self", ".", "draw_options", "=", "draw_options", "\n", "self", ".", "player_body", "=", "body", "\n", "\n", "self", ".", "total_reward", "=", "0", "\n", "self", ".", "total_length", "=", "0", "\n", "\n", "self", ".", "frame_buffer", "=", "list", "(", "np", ".", "zeros", "(", "(", "self", ".", "frame_stack", ",", "84", ",", "84", ",", "3", ")", ",", "dtype", "=", "np", ".", "uint8", ")", ")", "\n", "\n", "obs", "=", "self", ".", "construct_obs", "(", ")", "\n", "return", "obs", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env.PhysEnv.render": [[132, 136], ["utils.step_simulation", "matplotlib.imshow", "matplotlib.show"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_simulation"], ["", "def", "render", "(", "self", ")", ":", "\n", "        ", "im", "=", "step_simulation", "(", "self", ".", "screen", ",", "self", ".", "space", ",", "self", ".", "draw_options", ")", "\n", "plt", ".", "imshow", "(", "im", ")", "\n", "plt", ".", "show", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env.PhysEnv.construct_obs": [[137, 163], ["phys_env.PhysEnv.frame_buffer.extend", "numpy.concatenate", "numpy.concatenate", "utils.save_state", "range", "utils.restore_state", "obs.extend", "utils.step_simulation", "phys_env.PhysEnv.space.step", "future_obs.append", "utils.step_simulation"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.save_state", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.restore_state", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_simulation", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_simulation"], ["", "def", "construct_obs", "(", "self", ",", "new_obs", "=", "None", ")", ":", "\n", "# Adds a frame into the frame buffer and returns the concatenated observation", "\n", "        ", "if", "new_obs", "is", "None", ":", "\n", "            ", "new_obs", "=", "[", "step_simulation", "(", "self", ".", "screen", ",", "self", ".", "space", ",", "self", ".", "draw_options", ")", "]", "\n", "\n", "", "self", ".", "frame_buffer", ".", "extend", "(", "new_obs", ")", "\n", "self", ".", "frame_buffer", "=", "self", ".", "frame_buffer", "[", "-", "self", ".", "frame_stack", ":", "]", "\n", "obs", "=", "self", ".", "frame_buffer", "\n", "\n", "if", "self", ".", "pred_steps", ">", "0", "and", "self", ".", "pm_oracle", ":", "\n", "            ", "snapshot", "=", "save_state", "(", "self", ".", "space", ")", "\n", "future_obs", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "self", ".", "pred_steps", ")", ":", "\n", "                ", "self", ".", "space", ".", "step", "(", "0.01", ")", "\n", "future_obs", ".", "append", "(", "step_simulation", "(", "self", ".", "screen", ",", "self", ".", "space", ",", "self", ".", "draw_options", ")", ")", "\n", "\n", "", "restore_state", "(", "snapshot", ")", "\n", "obs", ".", "extend", "(", "future_obs", ")", "\n", "\n", "", "self", ".", "player_body", ".", "reward", "=", "0", "\n", "\n", "if", "self", ".", "balance_frames", ":", "\n", "            ", "obs", "=", "obs", "[", "-", "self", ".", "frame_stack", ":", "]", "\n", "\n", "", "return", "np", ".", "concatenate", "(", "obs", ",", "axis", "=", "2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env.PhysEnv.close": [[164, 166], ["None"], "methods", ["None"], ["", "def", "close", "(", "self", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env.fetch_action": [[168, 170], ["int", "input"], "function", ["None"], ["", "", "def", "fetch_action", "(", ")", ":", "\n", "    ", "return", "int", "(", "input", "(", "\"Enter your move (0, 1, 2, 3) : \"", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env_shooter.PhysEnv.__init__": [[16, 39], ["phys_env_shooter.PhysEnv.reset", "gym.spaces.Discrete", "gym.spaces.Box", "gym.spaces.Box", "range", "numpy.sin", "numpy.sin", "numpy.cos", "numpy.cos"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.reset"], ["    ", "def", "__init__", "(", "self", ",", "order", "=", "1", ",", "frame_stack", "=", "1", ",", "pm_oracle", "=", "False", ",", "pred_steps", "=", "0", ",", "balance_frames", "=", "False", ",", "actions", "=", "9", ",", "pos", "=", "False", ")", ":", "\n", "        ", "self", ".", "frame_stack", "=", "frame_stack", "\n", "self", ".", "pm_oracle", "=", "pm_oracle", "\n", "self", ".", "pred_steps", "=", "pred_steps", "\n", "self", ".", "balance_frames", "=", "balance_frames", "\n", "self", ".", "pos", "=", "pos", "\n", "self", ".", "spec", "=", "\"treahs\"", "\n", "self", ".", "reset", "(", ")", "\n", "\n", "v_scale", "=", "600", "\n", "pi", "=", "np", ".", "pi", "\n", "self", ".", "vs", "=", "[", "(", "v_scale", "*", "np", ".", "sin", "(", "pi", "*", "0.5", "*", "(", "i", ")", "/", "(", "actions", "-", "2", ")", ")", ",", "v_scale", "*", "np", ".", "cos", "(", "pi", "*", "(", "i", ")", "*", "0.5", "/", "(", "actions", "-", "2", ")", ")", ")", "for", "i", "in", "range", "(", "actions", "-", "1", ")", "]", "\n", "\n", "if", "not", "pm_oracle", ":", "\n", "            ", "pred_steps", "=", "0", "\n", "\n", "", "if", "not", "balance_frames", ":", "\n", "            ", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "0", ",", "255", ",", "(", "84", ",", "84", ",", "3", "*", "(", "frame_stack", "+", "pred_steps", ")", ")", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "0", ",", "255", ",", "(", "84", ",", "84", ",", "3", "*", "(", "frame_stack", ")", ")", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "\n", "", "self", ".", "order", "=", "order", "\n", "self", ".", "action_space", "=", "spaces", ".", "Discrete", "(", "actions", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env_shooter.PhysEnv.step": [[40, 87], ["numpy.array().flatten", "numpy.array().flatten", "phys_env_shooter.PhysEnv.construct_obs", "phys_env_shooter.PhysEnv.space.step", "phys_env_shooter.PhysEnv.out_bounds", "obs.append", "numpy.array", "numpy.array", "utils.step_simulation", "phys_env_shooter.PhysEnv.out_bounds", "phys_env_shooter.PhysEnv.construct_obs"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.construct_obs", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.out_bounds", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_simulation", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.out_bounds", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.construct_obs"], ["", "def", "step", "(", "self", ",", "actions", ")", ":", "\n", "\n", "        ", "actions", "=", "np", ".", "array", "(", "actions", ")", ".", "flatten", "(", ")", "\n", "\n", "reward", "=", "0", "\n", "total_length", "=", "0", "\n", "\n", "info", "=", "{", "}", "\n", "\n", "obs", "=", "[", "]", "\n", "\n", "for", "act", "in", "actions", ":", "\n", "            ", "if", "act", ">", "0", "and", "self", ".", "arrow_body", ".", "ready", ":", "\n", "# Launch object somehow", "\n", "                ", "self", ".", "arrow_body", ".", "position", "=", "(", "7", ",", "7", ")", "\n", "self", ".", "arrow_body", ".", "velocity", "=", "self", ".", "vs", "[", "act", "-", "1", "]", "\n", "self", ".", "arrow_body", ".", "ready", "=", "False", "\n", "\n", "", "self", ".", "space", ".", "step", "(", "0.01", ")", "\n", "reward", "+=", "self", ".", "player_body", ".", "reward", "\n", "self", ".", "player_body", ".", "reward", "=", "0", "\n", "\n", "if", "self", ".", "out_bounds", "(", "self", ".", "arrow_body", ".", "position", ")", ":", "\n", "                ", "self", ".", "arrow_body", ".", "ready", "=", "True", "\n", "\n", "", "obs", ".", "append", "(", "step_simulation", "(", "self", ".", "screen", ",", "self", ".", "space", ",", "self", ".", "draw_options", ")", ")", "\n", "total_length", "+=", "1", "\n", "\n", "if", "self", ".", "player_body", ".", "done", "or", "self", ".", "out_bounds", "(", "self", ".", "player_body", ".", "position", ")", ":", "\n", "                ", "reward", "=", "-", "1", "\n", "self", ".", "total_reward", "+=", "reward", "\n", "self", ".", "total_length", "+=", "total_length", "\n", "done", "=", "True", "\n", "episode", "=", "{", "}", "\n", "episode", "[", "'r'", "]", "=", "self", ".", "total_reward", "\n", "episode", "[", "'l'", "]", "=", "self", ".", "total_length", "\n", "info", "[", "'episode'", "]", "=", "episode", "\n", "ob", "=", "self", ".", "construct_obs", "(", "obs", ")", "\n", "return", "ob", ",", "reward", ",", "done", ",", "info", "\n", "", "else", ":", "\n", "                ", "done", "=", "False", "\n", "\n", "", "", "ob", "=", "self", ".", "construct_obs", "(", "obs", ")", "\n", "self", ".", "total_reward", "+=", "reward", "\n", "self", ".", "total_length", "+=", "total_length", "\n", "\n", "return", "ob", ",", "reward", ",", "done", ",", "info", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env_shooter.PhysEnv.out_bounds": [[88, 90], ["None"], "methods", ["None"], ["", "def", "out_bounds", "(", "self", ",", "pos", ")", ":", "\n", "        ", "return", "(", "pos", "[", "0", "]", "<", "0", ")", "or", "(", "pos", "[", "0", "]", ">", "84", ")", "or", "(", "pos", "[", "1", "]", "<", "0", ")", "or", "(", "pos", "[", "1", "]", ">", "84", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env_shooter.PhysEnv.seed": [[91, 93], ["numpy.random.seed", "numpy.random.seed"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.seed", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.seed"], ["", "def", "seed", "(", "self", ",", "seed", ")", ":", "\n", "        ", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env_shooter.PhysEnv.reset": [[94, 211], ["utils.construct_default_space", "numpy.random.randint", "numpy.random.randint", "range", "pymunk.Body", "pymunk.Body", "pymunk.Circle", "pymunk.Circle", "space.add", "pymunk.Body", "pymunk.Body", "pymunk.Circle", "pymunk.Circle", "space.add", "space.add_collision_handler", "space.add_collision_handler", "space.add_collision_handler", "space.add_collision_handler", "list", "phys_env_shooter.PhysEnv.construct_obs", "utils.construct_rand_box", "utils.construct_rand_circle", "numpy.zeros", "numpy.zeros", "random.uniform", "random.uniform", "random.uniform", "random.uniform", "random.uniform", "random.uniform"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_default_space", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer.add", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer.add", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.construct_obs", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_rand_box", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_rand_circle"], ["", "def", "reset", "(", "self", ")", ":", "\n", "        ", "screen", ",", "space", ",", "draw_options", "=", "construct_default_space", "(", "no_object", "=", "True", ")", "\n", "\n", "obj_num", "=", "np", ".", "random", ".", "randint", "(", "3", ",", "8", ")", "\n", "\n", "for", "_", "in", "range", "(", "obj_num", ")", ":", "\n", "            ", "construct_rand_box", "(", "space", ",", "84", ")", "\n", "construct_rand_circle", "(", "space", ",", "84", ")", "\n", "\n", "# Construct the player sprite", "\n", "", "body", "=", "pm", ".", "Body", "(", "1", ",", "1", ")", "\n", "body", ".", "velocity", "=", "(", "0", ",", "0", ")", "\n", "body", ".", "position", "=", "(", "5", ",", "5", ")", "\n", "body", ".", "done", "=", "False", "\n", "body", ".", "reward", "=", "0", "\n", "\n", "shape", "=", "pm", ".", "Circle", "(", "body", ",", "4", ")", "\n", "shape", ".", "color", "=", "(", "0", ",", "0", ",", "255", ",", "255", ")", "\n", "shape", ".", "elasticity", "=", "0.95", "\n", "shape", ".", "friction", "=", "0.9", "\n", "shape", ".", "collision_type", "=", "collision_types", "[", "\"player\"", "]", "\n", "\n", "space", ".", "add", "(", "body", ",", "shape", ")", "\n", "\n", "arrow_body", "=", "pm", ".", "Body", "(", "1", ",", "1", ",", "body_type", "=", "pm", ".", "Body", ".", "KINEMATIC", ")", "\n", "arrow_body", ".", "velocity", "=", "(", "0", ",", "0", ")", "\n", "arrow_body", ".", "position", "=", "(", "-", "10", ",", "-", "10", ")", "\n", "arrow_body", ".", "done", "=", "False", "\n", "arrow_body", ".", "reward", "=", "0", "\n", "arrow_body", ".", "ready", "=", "True", "\n", "\n", "arrow_shape", "=", "pm", ".", "Circle", "(", "arrow_body", ",", "2", ")", "\n", "arrow_shape", ".", "color", "=", "(", "0", ",", "255", ",", "0", ",", "255", ")", "\n", "arrow_shape", ".", "elasticity", "=", "0.95", "\n", "arrow_shape", ".", "friction", "=", "0.9", "\n", "arrow_shape", ".", "collision_type", "=", "collision_types", "[", "\"arrow\"", "]", "\n", "\n", "self", ".", "arrow_body", "=", "arrow_body", "\n", "\n", "space", ".", "add", "(", "arrow_body", ",", "arrow_shape", ")", "\n", "\n", "def", "remove_player", "(", "arbiter", ",", "space", ",", "data", ")", ":", "\n", "            ", "player_shape", "=", "arbiter", ".", "shapes", "[", "0", "]", "\n", "player_shape", ".", "body", ".", "done", "=", "True", "\n", "# space.remove(player_shape, player_shape.body)", "\n", "return", "True", "\n", "\n", "", "def", "reward_player", "(", "arbiter", ",", "space", ",", "data", ")", ":", "\n", "            ", "arrow_shape", "=", "arbiter", ".", "shapes", "[", "0", "]", "\n", "target_shape", "=", "arbiter", ".", "shapes", "[", "1", "]", "\n", "shape", ".", "body", ".", "reward", "+=", "1", "\n", "\n", "dim", "=", "84", "\n", "pos_low", "=", "0.2", "\n", "pos_high", "=", "0.95", "\n", "pos", "=", "dim", "*", "random", ".", "uniform", "(", "pos_low", ",", "pos_high", ")", ",", "dim", "*", "random", ".", "uniform", "(", "pos_low", ",", "pos_high", ")", "\n", "\n", "v_scale", "=", "300", "\n", "velocity", "=", "v_scale", "*", "random", ".", "uniform", "(", "-", "1", ",", "1", ")", ",", "v_scale", "*", "random", ".", "uniform", "(", "-", "1", ",", "1", ")", "\n", "\n", "target_shape", ".", "body", ".", "position", "=", "pos", "\n", "target_shape", ".", "body", ".", "velocity", "=", "velocity", "\n", "\n", "arrow_shape", ".", "body", ".", "position", "=", "(", "-", "10", ",", "-", "10", ")", "\n", "arrow_shape", ".", "body", ".", "velocity", "=", "(", "0", ",", "0", ")", "\n", "arrow_body", ".", "ready", "=", "True", "\n", "\n", "return", "True", "\n", "\n", "", "def", "punish_player", "(", "arbiter", ",", "space", ",", "data", ")", ":", "\n", "            ", "arrow_shape", "=", "arbiter", ".", "shapes", "[", "0", "]", "\n", "target_shape", "=", "arbiter", ".", "shapes", "[", "1", "]", "\n", "shape", ".", "body", ".", "reward", "-=", "1", "\n", "\n", "dim", "=", "84", "\n", "pos_low", "=", "0.2", "\n", "pos_high", "=", "0.95", "\n", "pos", "=", "dim", "*", "random", ".", "uniform", "(", "pos_low", ",", "pos_high", ")", ",", "dim", "*", "random", ".", "uniform", "(", "pos_low", ",", "pos_high", ")", "\n", "\n", "target_shape", ".", "body", ".", "position", "=", "pos", "\n", "\n", "arrow_shape", ".", "body", ".", "position", "=", "(", "-", "10", ",", "-", "10", ")", "\n", "arrow_shape", ".", "body", ".", "velocity", "=", "(", "0", ",", "0", ")", "\n", "arrow_body", ".", "ready", "=", "True", "\n", "\n", "return", "True", "\n", "\n", "", "dim", "=", "84", "\n", "\n", "g", "=", "space", ".", "add_collision_handler", "(", "collision_types", "[", "'player'", "]", ",", "collision_types", "[", "'box'", "]", ")", "\n", "g", ".", "begin", "=", "remove_player", "\n", "\n", "h", "=", "space", ".", "add_collision_handler", "(", "collision_types", "[", "'player'", "]", ",", "collision_types", "[", "'circle'", "]", ")", "\n", "h", ".", "begin", "=", "remove_player", "\n", "\n", "h", "=", "space", ".", "add_collision_handler", "(", "collision_types", "[", "'arrow'", "]", ",", "collision_types", "[", "'circle'", "]", ")", "\n", "h", ".", "begin", "=", "reward_player", "\n", "\n", "h", "=", "space", ".", "add_collision_handler", "(", "collision_types", "[", "'arrow'", "]", ",", "collision_types", "[", "'box'", "]", ")", "\n", "\n", "if", "self", ".", "pos", ":", "\n", "            ", "h", ".", "begin", "=", "reward_player", "\n", "", "else", ":", "\n", "            ", "h", ".", "begin", "=", "punish_player", "\n", "\n", "", "self", ".", "space", "=", "space", "\n", "self", ".", "screen", "=", "screen", "\n", "self", ".", "draw_options", "=", "draw_options", "\n", "self", ".", "player_body", "=", "body", "\n", "\n", "self", ".", "total_reward", "=", "0", "\n", "self", ".", "total_length", "=", "0", "\n", "\n", "self", ".", "frame_buffer", "=", "list", "(", "np", ".", "zeros", "(", "(", "self", ".", "frame_stack", ",", "84", ",", "84", ",", "3", ")", ",", "dtype", "=", "np", ".", "uint8", ")", ")", "\n", "\n", "obs", "=", "self", ".", "construct_obs", "(", ")", "\n", "return", "obs", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env_shooter.PhysEnv.render": [[212, 216], ["utils.step_simulation", "matplotlib.imshow", "matplotlib.show"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_simulation"], ["", "def", "render", "(", "self", ")", ":", "\n", "        ", "im", "=", "step_simulation", "(", "self", ".", "screen", ",", "self", ".", "space", ",", "self", ".", "draw_options", ")", "\n", "plt", ".", "imshow", "(", "im", ")", "\n", "plt", ".", "show", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env_shooter.PhysEnv.construct_obs": [[217, 245], ["phys_env_shooter.PhysEnv.frame_buffer.extend", "numpy.concatenate", "numpy.concatenate", "utils.save_state", "range", "utils.restore_state", "obs.extend", "utils.step_simulation", "phys_env_shooter.PhysEnv.space.step", "future_obs.append", "utils.step_simulation"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.save_state", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.restore_state", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_simulation", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_simulation"], ["", "def", "construct_obs", "(", "self", ",", "new_obs", "=", "None", ")", ":", "\n", "# Adds a frame into the frame buffer and returns the concatenated observation", "\n", "        ", "if", "new_obs", "is", "None", ":", "\n", "            ", "new_obs", "=", "[", "step_simulation", "(", "self", ".", "screen", ",", "self", ".", "space", ",", "self", ".", "draw_options", ")", "]", "\n", "\n", "", "self", ".", "frame_buffer", ".", "extend", "(", "new_obs", ")", "\n", "self", ".", "frame_buffer", "=", "self", ".", "frame_buffer", "[", "-", "self", ".", "frame_stack", ":", "]", "\n", "obs", "=", "self", ".", "frame_buffer", "\n", "\n", "if", "self", ".", "pred_steps", ">", "0", "and", "self", ".", "pm_oracle", ":", "\n", "            ", "snapshot", "=", "save_state", "(", "self", ".", "space", ")", "\n", "arrow_valid", "=", "self", ".", "arrow_body", ".", "ready", "\n", "future_obs", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "self", ".", "pred_steps", ")", ":", "\n", "                ", "self", ".", "space", ".", "step", "(", "0.01", ")", "\n", "future_obs", ".", "append", "(", "step_simulation", "(", "self", ".", "screen", ",", "self", ".", "space", ",", "self", ".", "draw_options", ")", ")", "\n", "\n", "", "restore_state", "(", "snapshot", ")", "\n", "self", ".", "arrow_body", ".", "ready", "=", "arrow_valid", "\n", "obs", ".", "extend", "(", "future_obs", ")", "\n", "\n", "", "self", ".", "player_body", ".", "reward", "=", "0", "\n", "\n", "if", "self", ".", "balance_frames", ":", "\n", "            ", "obs", "=", "obs", "[", "-", "self", ".", "frame_stack", ":", "]", "\n", "\n", "", "return", "np", ".", "concatenate", "(", "obs", ",", "axis", "=", "2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env_shooter.PhysEnv.close": [[246, 248], ["None"], "methods", ["None"], ["", "def", "close", "(", "self", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_env_shooter.fetch_action": [[250, 252], ["int", "input"], "function", ["None"], ["", "", "def", "fetch_action", "(", ")", ":", "\n", "    ", "return", "int", "(", "input", "(", "\"Enter your move (0, 1, 2, 3, 4, 5, 6, 7, 8) : \"", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_space": [[27, 47], ["pygame.Surface", "pymunk.Space", "pymunk.pygame_util.DrawOptions", "pymunk.pygame_util.DrawOptions", "pm.Space.add", "pymunk.Segment", "pymunk.Segment", "pymunk.Segment", "pymunk.Segment"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer.add"], ["_BATCH_NORM_DECAY", "=", "0.997", "\n", "_BATCH_NORM_EPSILON", "=", "1e-5", "\n", "DEFAULT_VERSION", "=", "2", "\n", "DEFAULT_DTYPE", "=", "tf", ".", "float32", "\n", "CASTABLE_TYPES", "=", "(", "tf", ".", "float16", ",", ")", "\n", "ALLOWED_TYPES", "=", "(", "DEFAULT_DTYPE", ",", ")", "+", "CASTABLE_TYPES", "\n", "\n", "class", "WarpFrame", "(", "gym", ".", "ObservationWrapper", ")", ":", "\n", "    ", "def", "__init__", "(", "self", ",", "env", ",", "size", "=", "84", ",", "keep_obs", "=", "False", ")", ":", "\n", "        ", "\"\"\"Warp frames to 84x84 as done in the Nature paper and later work.\"\"\"", "\n", "gym", ".", "ObservationWrapper", ".", "__init__", "(", "self", ",", "env", ")", "\n", "self", ".", "width", "=", "size", "\n", "self", ".", "height", "=", "size", "\n", "\n", "if", "keep_obs", ":", "\n", "            ", "self", ".", "observation_space", "=", "env", ".", "observation_space", "\n", "", "else", ":", "\n", "            ", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "low", "=", "0", ",", "high", "=", "255", ",", "\n", "shape", "=", "(", "self", ".", "height", ",", "self", ".", "width", ",", "3", ")", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "\n", "", "", "def", "observation", "(", "self", ",", "frame", ")", ":", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.reset_3d_velocity": [[49, 67], ["pybullet.getBaseVelocity", "pybullet.getBasePositionAndOrientation", "sum", "utils.reset_3d_velocity.oob_x"], "function", ["None"], ["        ", "if", "type", "(", "frame", ")", "==", "OrderedDict", ":", "\n", "            ", "frame", "[", "'pixels'", "]", "=", "cv2", ".", "resize", "(", "frame", "[", "'pixels'", "]", ",", "(", "self", ".", "width", ",", "self", ".", "height", ")", ",", "interpolation", "=", "cv2", ".", "INTER_AREA", ")", "\n", "\n", "", "else", ":", "\n", "            ", "frame", "=", "cv2", ".", "resize", "(", "frame", ",", "(", "self", ".", "width", ",", "self", ".", "height", ")", ",", "interpolation", "=", "cv2", ".", "INTER_AREA", ")", "\n", "", "return", "frame", "\n", "\n", "", "", "class", "AugmentColor", "(", "gym", ".", "Wrapper", ")", ":", "\n", "    ", "def", "__init__", "(", "self", ",", "env", ")", ":", "\n", "        ", "\"\"\"Warp frames to 84x84 as done in the Nature paper and later work.\"\"\"", "\n", "gym", ".", "Wrapper", ".", "__init__", "(", "self", ",", "env", ")", "\n", "self", ".", "_reset_random", "(", ")", "\n", "\n", "\n", "", "def", "reset", "(", "self", ")", ":", "\n", "        ", "self", ".", "_reset_random", "(", ")", "\n", "ob", "=", "self", ".", "env", ".", "reset", "(", ")", "\n", "return", "ob", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.save_bullet_state": [[69, 79], ["range", "pybullet.getNumBodies", "pybullet.getBasePositionAndOrientation", "pybullet.getBaseVelocity"], "function", ["None"], ["        ", "ob", ",", "reward", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "ob", "=", "Image", ".", "fromarray", "(", "ob", ")", "\n", "ob", "=", "functional", ".", "adjust_brightness", "(", "ob", ",", "self", ".", "brightness", ")", "\n", "ob", "=", "functional", ".", "adjust_contrast", "(", "ob", ",", "self", ".", "contrast", ")", "\n", "ob", "=", "functional", ".", "adjust_saturation", "(", "ob", ",", "self", ".", "saturation", ")", "\n", "ob", "=", "functional", ".", "adjust_hue", "(", "ob", ",", "self", ".", "hue", ")", "\n", "ob_new", "=", "np", ".", "array", "(", "ob", ")", "\n", "# ob_new = np.clip(ob.astype(np.float32) + np.random.uniform(-10, 10, ob.shape), 0, 255).astype(np.uint8)", "\n", "return", "ob_new", ",", "reward", ",", "done", ",", "info", "\n", "\n", "", "def", "_reset_random", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.restore_bullet_state": [[81, 87], ["state.items", "pybullet.resetBasePositionAndOrientation", "pybullet.resetBaseVelocity"], "function", ["None"], ["self", ".", "contrast", "=", "np", ".", "random", ".", "uniform", "(", "0.7", ",", "1.3", ")", "\n", "self", ".", "saturation", "=", "np", ".", "random", ".", "uniform", "(", "0.7", ",", "1.3", ")", "\n", "self", ".", "hue", "=", "np", ".", "random", ".", "uniform", "(", "0.0", ",", "0.3", ")", "\n", "\n", "\n", "", "", "class", "FrameStack", "(", "gym", ".", "Wrapper", ")", ":", "\n", "    ", "def", "__init__", "(", "self", ",", "env", ",", "k", ",", "keep_obs", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_3d_space": [[89, 117], ["pybullet.setGravity", "pybullet.createVisualShape", "pybullet.createCollisionShape", "pybullet.createMultiBody", "pybullet.changeDynamics", "range", "numpy.random.uniform", "numpy.random.uniform", "pybullet.createVisualShape", "pybullet.createCollisionShape", "pybullet.createMultiBody", "bodies.append", "pybullet.resetBaseVelocity", "pybullet.changeDynamics", "abs"], "function", ["None"], ["\n", "gym", ".", "Wrapper", ".", "__init__", "(", "self", ",", "env", ")", "\n", "self", ".", "k", "=", "k", "\n", "self", ".", "frames", "=", "deque", "(", "[", "]", ",", "maxlen", "=", "k", ")", "\n", "shp", "=", "env", ".", "observation_space", ".", "shape", "\n", "\n", "if", "keep_obs", ":", "\n", "            ", "self", ".", "observation_space", "=", "env", ".", "observation_space", "\n", "", "else", ":", "\n", "            ", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "low", "=", "0", ",", "high", "=", "255", ",", "shape", "=", "(", "shp", "[", "0", "]", ",", "shp", "[", "1", "]", ",", "shp", "[", "2", "]", "*", "k", ")", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "\n", "", "", "def", "reset", "(", "self", ")", ":", "\n", "        ", "ob", "=", "self", ".", "env", ".", "reset", "(", ")", "\n", "\n", "if", "type", "(", "ob", ")", "==", "OrderedDict", ":", "\n", "            ", "ob_frame", "=", "ob", "[", "'pixels'", "]", "\n", "", "else", ":", "\n", "            ", "ob_frame", "=", "ob", "\n", "", "for", "_", "in", "range", "(", "self", ".", "k", ")", ":", "\n", "            ", "self", ".", "frames", ".", "append", "(", "ob_frame", ")", "\n", "", "return", "self", ".", "_get_ob", "(", "ob", ")", "\n", "\n", "", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "ob", ",", "reward", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "if", "type", "(", "ob", ")", "==", "OrderedDict", ":", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_3d_shapes_space": [[119, 159], ["pybullet.setGravity", "pybullet.createVisualShape", "pybullet.createCollisionShape", "pybullet.createMultiBody", "pybullet.changeDynamics", "range", "range", "numpy.random.uniform", "numpy.random.uniform", "pybullet.createVisualShape", "pybullet.createCollisionShape", "pybullet.createMultiBody", "bodies.append", "pybullet.resetBaseVelocity", "pybullet.changeDynamics", "numpy.random.uniform", "numpy.random.uniform", "pybullet.createVisualShape", "pybullet.createCollisionShape", "pybullet.createMultiBody", "goals.append", "pybullet.resetBaseVelocity", "pybullet.changeDynamics", "abs", "abs"], "function", ["None"], ["", "else", ":", "\n", "            ", "self", ".", "frames", ".", "append", "(", "ob", ")", "\n", "", "return", "self", ".", "_get_ob", "(", "ob", ")", ",", "reward", ",", "done", ",", "info", "\n", "\n", "", "def", "_get_ob", "(", "self", ",", "ob", ")", ":", "\n", "        ", "assert", "len", "(", "self", ".", "frames", ")", "==", "self", ".", "k", "\n", "\n", "if", "type", "(", "ob", ")", "==", "OrderedDict", ":", "\n", "            ", "ob", "[", "'pixels'", "]", "=", "np", ".", "concatenate", "(", "self", ".", "frames", ",", "axis", "=", "2", ")", "\n", "return", "ob", "\n", "", "else", ":", "\n", "            ", "return", "np", ".", "concatenate", "(", "self", ".", "frames", ",", "axis", "=", "2", ")", "\n", "\n", "\n", "", "", "", "class", "RandomRepeat", "(", "gym", ".", "Wrapper", ")", ":", "\n", "    ", "def", "__init__", "(", "self", ",", "env", ")", ":", "\n", "        ", "gym", ".", "Wrapper", ".", "__init__", "(", "self", ",", "env", ")", "\n", "\n", "", "def", "reset", "(", "self", ")", ":", "\n", "        ", "ob", "=", "self", ".", "env", ".", "reset", "(", ")", "\n", "return", "ob", "\n", "\n", "", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "ob", ",", "reward", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "\n", "while", "(", "not", "done", ")", "and", "(", "random", ".", "uniform", "(", "0", ",", "1", ")", "<", "0.5", ")", ":", "\n", "            ", "ob", ",", "temp_reward", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "reward", "+=", "temp_reward", "\n", "\n", "", "return", "ob", ",", "reward", ",", "done", ",", "info", "\n", "\n", "\n", "\n", "", "", "class", "EpsRandom", "(", "gym", ".", "Wrapper", ")", ":", "\n", "    ", "def", "__init__", "(", "self", ",", "env", ")", ":", "\n", "        ", "gym", ".", "Wrapper", ".", "__init__", "(", "self", ",", "env", ")", "\n", "self", ".", "n", "=", "env", ".", "action_space", ".", "n", "\n", "\n", "", "def", "reset", "(", "self", ")", ":", "\n", "        ", "ob", "=", "self", ".", "env", ".", "reset", "(", ")", "\n", "return", "ob", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.get_3d_image": [[161, 175], ["pybullet.computeViewMatrix", "pybullet.computeProjectionMatrixFOV", "pybullet.getCameraImage"], "function", ["None"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "if", "(", "random", ".", "uniform", "(", "0", ",", "1", ")", "<", "0.1", ")", ":", "\n", "            ", "action", "=", "random", ".", "randint", "(", "0", ",", "self", ".", "n", "-", "1", ")", "\n", "\n", "", "ob", ",", "reward", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "\n", "return", "ob", ",", "reward", ",", "done", ",", "info", "\n", "\n", "\n", "", "", "class", "MakeGym", "(", ")", ":", "\n", "    ", "def", "__init__", "(", "self", ",", "env", ")", ":", "\n", "# self.n = env.action_space.n", "\n", "        ", "act_spec", "=", "env", ".", "action_spec", "(", ")", "\n", "obs_spec", "=", "env", ".", "observation_spec", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.spawn_rand_goal_3d": [[176, 186], ["pybullet.createVisualShape", "pybullet.createMultiBody", "numpy.random.randint"], "function", ["None"], ["total_dim", "=", "0", "\n", "for", "name", "in", "list", "(", "obs_spec", ")", ":", "\n", "            ", "if", "name", "!=", "\"pixels\"", ":", "\n", "                ", "if", "len", "(", "obs_spec", "[", "name", "]", ".", "shape", ")", "==", "0", ":", "\n", "                    ", "total_dim", "+=", "1", "\n", "", "else", ":", "\n", "                    ", "total_dim", "+=", "obs_spec", "[", "name", "]", ".", "shape", "[", "0", "]", "\n", "\n", "", "", "", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "low", "=", "-", "100.", ",", "high", "=", "100.", ",", "shape", "=", "(", "total_dim", ",", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "self", ".", "action_space", "=", "spaces", ".", "Box", "(", "low", "=", "act_spec", ".", "minimum", ",", "high", "=", "act_spec", ".", "maximum", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "self", ".", "reward_range", "=", "(", "0", ",", "1", ")", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.respawn_rand_goal": [[187, 191], ["numpy.random.randint", "pybullet.getBasePositionAndOrientation", "pybullet.resetBasePositionAndOrientation"], "function", ["None"], ["self", ".", "metadata", "=", "{", "}", "\n", "self", ".", "env", "=", "env", "\n", "self", ".", "spec", "=", "\"shit\"", "\n", "\n", "# Max length of 1000", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_3d_simulation": [[194, 211], ["range", "pybullet.getBaseVelocity", "sum", "pybullet.stepSimulation", "abs", "list"], "function", ["None"], ["", "def", "reset", "(", "self", ")", ":", "\n", "        ", "timestep", ",", "reward", ",", "discount", ",", "ob", "=", "self", ".", "env", ".", "reset", "(", ")", "\n", "self", ".", "counter", "=", "0", "\n", "return", "self", ".", "_construct_ob", "(", "ob", ")", "\n", "\n", "", "def", "_construct_ob", "(", "self", ",", "ob", ")", ":", "\n", "        ", "state", "=", "[", "]", "\n", "for", "key", "in", "ob", ".", "keys", "(", ")", ":", "\n", "            ", "if", "key", "!=", "'pixels'", ":", "\n", "                ", "if", "type", "(", "ob", "[", "key", "]", ")", "==", "np", ".", "float64", ":", "\n", "                    ", "state", ".", "append", "(", "[", "ob", "[", "key", "]", "]", ")", "\n", "", "else", ":", "\n", "                    ", "state", ".", "append", "(", "ob", "[", "key", "]", ")", "\n", "\n", "", "", "", "ob_flat", "=", "np", ".", "concatenate", "(", "state", ",", "axis", "=", "0", ")", "\n", "ob_dict", "=", "{", "'pixels'", ":", "ob", "[", "'pixels'", "]", ",", "'flat'", ":", "ob_flat", "}", "\n", "\n", "return", "OrderedDict", "(", "ob_dict", ")", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_3d_simulation_shooter": [[213, 259], ["range", "pybullet.getBaseVelocity", "sum", "pybullet.stepSimulation", "pybullet.getAABB", "pybullet.getOverlappingObjects", "pybullet.resetBasePositionAndOrientation", "abs", "list", "numpy.random.uniform", "numpy.random.uniform", "pybullet.resetBasePositionAndOrientation", "pybullet.resetBaseVelocity", "numpy.random.uniform", "numpy.random.uniform", "pybullet.resetBasePositionAndOrientation", "pybullet.resetBaseVelocity"], "function", ["None"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "timestep", ",", "reward", ",", "discount", ",", "ob", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "\n", "if", "reward", "is", "None", ":", "\n", "            ", "reward", "=", "0.0", "\n", "\n", "", "done", "=", "False", "\n", "\n", "if", "self", ".", "counter", "==", "1000", ":", "\n", "            ", "self", ".", "counter", "=", "0", "\n", "done", "=", "True", "\n", "\n", "", "self", ".", "counter", "+=", "1", "\n", "info", "=", "{", "}", "\n", "\n", "return", "self", ".", "_construct_ob", "(", "ob", ")", ",", "reward", ",", "done", ",", "info", "\n", "\n", "\n", "", "", "class", "RandomFix", "(", "gym", ".", "Wrapper", ")", ":", "\n", "    ", "def", "__init__", "(", "self", ",", "env", ")", ":", "\n", "        ", "gym", ".", "Wrapper", ".", "__init__", "(", "self", ",", "env", ")", "\n", "self", ".", "n", "=", "env", ".", "action_space", ".", "n", "\n", "self", ".", "counter", "=", "0", "\n", "\n", "", "def", "reset", "(", "self", ")", ":", "\n", "        ", "ob", "=", "self", ".", "env", ".", "reset", "(", ")", "\n", "self", ".", "counter", "=", "0", "\n", "return", "ob", "\n", "\n", "", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "ob", ",", "reward", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "\n", "if", "self", ".", "counter", "%", "5", "==", "0", ":", "\n", "            ", "for", "i", "in", "range", "(", "2", ")", ":", "\n", "                ", "if", "done", ":", "\n", "                    ", "break", "\n", "", "action", "=", "random", ".", "randint", "(", "0", ",", "self", ".", "n", "-", "1", ")", "\n", "ob", ",", "reward_tmp", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "reward", "=", "reward", "+", "reward_tmp", "\n", "\n", "", "", "return", "ob", ",", "reward", ",", "done", ",", "info", "\n", "\n", "\n", "", "", "def", "optimistic_restore", "(", "session", ",", "save_file", ")", ":", "\n", "    ", "reader", "=", "tf", ".", "train", ".", "NewCheckpointReader", "(", "save_file", ")", "\n", "saved_shapes", "=", "reader", ".", "get_variable_to_shape_map", "(", ")", "\n", "var_names", "=", "sorted", "(", "[", "(", "var", ".", "name", ",", "var", ".", "name", ".", "split", "(", "':'", ")", "[", "0", "]", ")", "for", "var", "in", "tf", ".", "global_variables", "(", ")", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.spawn_rand_goal": [[262, 280], ["pymunk.Body", "pymunk.Circle", "space.add"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer.add"], ["with", "tf", ".", "variable_scope", "(", "''", ",", "reuse", "=", "tf", ".", "AUTO_REUSE", ")", ":", "\n", "        ", "for", "var_name", ",", "saved_var_name", "in", "var_names", ":", "\n", "            ", "try", ":", "\n", "                ", "curr_var", "=", "tf", ".", "get_variable", "(", "saved_var_name", ")", "\n", "var_shape", "=", "curr_var", ".", "get_shape", "(", ")", ".", "as_list", "(", ")", "\n", "if", "var_shape", "==", "saved_shapes", "[", "saved_var_name", "]", ":", "\n", "                    ", "restore_vars", ".", "append", "(", "curr_var", ")", "\n", "", "", "except", ":", "\n", "                ", "print", "(", "\"Skipping variable {}\"", ".", "format", "(", "var_name", ")", ")", "\n", "", "", "", "saver", "=", "tf", ".", "train", ".", "Saver", "(", "restore_vars", ")", "\n", "saver", ".", "restore", "(", "session", ",", "save_file", ")", "\n", "\n", "\n", "", "def", "make_atari_env_custom", "(", "env_id", ",", "num_env", ",", "seed", ",", "frame_stack", ",", "wrapper_kwargs", "=", "{", "}", ",", "start_index", "=", "0", ",", "random_action", "=", "False", ",", "eps_random", "=", "False", ",", "augment", "=", "False", ",", "clip_rewards", "=", "True", ",", "episode_life", "=", "True", ",", "random_fix", "=", "False", ",", "size", "=", "84", ")", ":", "\n", "    ", "\"\"\"\n    Create a wrapped, monitored SubprocVecEnv for Atari.\n    \"\"\"", "\n", "if", "wrapper_kwargs", "is", "None", ":", "wrapper_kwargs", "=", "{", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_rand_body": [[282, 310], ["pymunk.Body", "random.randint", "numpy.random.randint", "space.add", "pymunk.Circle", "pymunk.Poly.create_box", "random.uniform", "random.uniform", "random.uniform", "random.uniform"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer.add"], ["        ", "if", "episode_life", ":", "\n", "            ", "env", "=", "EpisodicLifeEnv", "(", "env", ")", "\n", "", "if", "'FIRE'", "in", "env", ".", "unwrapped", ".", "get_action_meanings", "(", ")", ":", "\n", "            ", "env", "=", "FireResetEnv", "(", "env", ")", "\n", "", "env", "=", "WarpFrame", "(", "env", ",", "size", "=", "size", ")", "\n", "if", "augment", ":", "\n", "            ", "env", "=", "AugmentColor", "(", "env", ")", "\n", "", "if", "scale", ":", "\n", "            ", "env", "=", "ScaledFloatFrame", "(", "env", ")", "\n", "", "if", "clip_rewards", ":", "\n", "            ", "env", "=", "ClipRewardEnv", "(", "env", ")", "\n", "", "if", "frame_stack", ":", "\n", "            ", "env", "=", "FrameStack", "(", "env", ",", "frame_stack", ")", "\n", "", "return", "env", "\n", "\n", "", "def", "make_env", "(", "rank", ")", ":", "# pylint: disable=C0111", "\n", "        ", "def", "_thunk", "(", ")", ":", "\n", "            ", "env", "=", "make_atari", "(", "env_id", ")", "\n", "env", ".", "seed", "(", "seed", "+", "rank", "if", "seed", "is", "not", "None", "else", "None", ")", "\n", "if", "random_action", ":", "\n", "                ", "env", "=", "RandomRepeat", "(", "env", ")", "\n", "", "if", "eps_random", ":", "\n", "                ", "env", "=", "EpsRandom", "(", "env", ")", "\n", "", "if", "random_fix", ":", "\n", "                ", "env", "=", "RandomFix", "(", "env", ")", "\n", "", "env", "=", "Monitor", "(", "env", ",", "logger", ".", "get_dir", "(", ")", "and", "os", ".", "path", ".", "join", "(", "logger", ".", "get_dir", "(", ")", ",", "str", "(", "rank", ")", ")", ",", "allow_early_resets", "=", "True", ")", "\n", "return", "wrap_deepmind_custom", "(", "env", ",", "episode_life", "=", "episode_life", ",", "clip_rewards", "=", "clip_rewards", ",", "**", "wrapper_kwargs", ")", "\n", "", "return", "_thunk", "\n", "", "set_global_seeds", "(", "seed", ")", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_rand_box": [[312, 338], ["pymunk.Body", "pymunk.Poly.create_box", "numpy.random.randint", "space.add", "random.uniform", "random.uniform", "random.uniform", "random.uniform"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer.add"], ["\n", "\n", "", "def", "make_dm_control", "(", "domain_name", ",", "task_name", ",", "num_env", ",", "seed", ",", "frame_stack", ",", "vis_reward", "=", "False", ",", "wrapper_kwargs", "=", "{", "}", ",", "start_index", "=", "0", ")", ":", "\n", "    ", "\"\"\"\n    Create a wrapped, monitored SubprocVecEnv for Atari.\n    \"\"\"", "\n", "if", "wrapper_kwargs", "is", "None", ":", "wrapper_kwargs", "=", "{", "}", "\n", "\n", "def", "wrap_env", "(", "seed", ")", ":", "\n", "\n", "        ", "env", "=", "suite", ".", "load", "(", "domain_name", ",", "task_name", ",", "task_kwargs", "=", "{", "'random'", ":", "seed", "}", ",", "visualize_reward", "=", "vis_reward", ")", "\n", "env", "=", "pixels", ".", "Wrapper", "(", "env", ",", "pixels_only", "=", "False", ")", "\n", "env", "=", "MakeGym", "(", "env", ")", "\n", "env", "=", "WarpFrame", "(", "env", ",", "keep_obs", "=", "True", ")", "\n", "env", "=", "FrameStack", "(", "env", ",", "frame_stack", ",", "keep_obs", "=", "True", ")", "\n", "return", "env", "\n", "\n", "", "def", "make_env", "(", "rank", ")", ":", "# pylint: disable=C0111", "\n", "        ", "def", "_thunk", "(", ")", ":", "\n", "            ", "env", "=", "wrap_env", "(", "seed", "+", "rank", ")", "\n", "env", "=", "Monitor", "(", "env", ",", "logger", ".", "get_dir", "(", ")", "and", "os", ".", "path", ".", "join", "(", "logger", ".", "get_dir", "(", ")", ",", "str", "(", "rank", ")", ")", ")", "\n", "return", "env", "\n", "", "return", "_thunk", "\n", "", "set_global_seeds", "(", "seed", ")", "\n", "return", "SubprocVecEnv", "(", "[", "make_env", "(", "i", "+", "start_index", ")", "for", "i", "in", "range", "(", "num_env", ")", "]", ")", "\n", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_rand_circle": [[340, 366], ["pymunk.Body", "pymunk.Circle", "numpy.random.randint", "space.add", "random.uniform", "random.uniform", "random.uniform", "random.uniform"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer.add"], ["    ", "M1", "=", "tf", ".", "concat", "(", "[", "input", "[", ":", ",", ":", ",", "-", "size", ":", ",", ":", "]", ",", "input", ",", "input", "[", ":", ",", ":", ",", "0", ":", "size", ",", ":", "]", "]", ",", "2", ")", "\n", "M1", "=", "tf", ".", "concat", "(", "[", "M1", "[", ":", ",", ":", ",", ":", ",", "-", "size", ":", "]", ",", "M1", ",", "M1", "[", ":", ",", ":", ",", ":", ",", "0", ":", "size", "]", "]", ",", "3", ")", "\n", "return", "M1", "\n", "\n", "\n", "", "def", "spatial_mem", "(", "inp", ",", "state", ",", "FLAGS", ",", "reuse", "=", "False", ",", "scope", "=", "\"\"", ",", "bypass_res", "=", "False", ",", "action", "=", "None", ")", ":", "\n", "    ", "\"\"\"Computes representation on inp through spatial mem given inp of size nchw and state of nchw\"\"\"", "\n", "\n", "state", "=", "state", "[", "0", "]", "\n", "state_shape", "=", "state", ".", "get_shape", "(", ")", "\n", "state_channel", "=", "state", ".", "get_shape", "(", ")", "[", "1", "]", "\n", "input_channel", "=", "inp", ".", "get_shape", "(", ")", "[", "1", "]", "\n", "merge", "=", "tf", ".", "concat", "(", "[", "inp", ",", "state", "]", ",", "axis", "=", "1", ")", "\n", "merge_dim", "=", "state_channel", "+", "input_channel", "\n", "\n", "if", "action", "is", "not", "None", ":", "\n", "        ", "state", "=", "tf", ".", "concat", "(", "[", "action", ",", "state", "]", ",", "axis", "=", "1", ")", "\n", "\n", "", "with", "tf", ".", "variable_scope", "(", "\"spatial_mem\"", "+", "scope", ",", "reuse", "=", "reuse", ")", ":", "\n", "        ", "if", "not", "bypass_res", ":", "\n", "            ", "state_res", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "merge", ",", "filters", "=", "state_channel", ",", "kernel_size", "=", "(", "5", ",", "5", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'mem1'", ",", "data_format", "=", "'channels_first'", ",", "activation", "=", "tf", ".", "nn", ".", "elu", ")", "\n", "state_concat", "=", "tf", ".", "concat", "(", "[", "state", ",", "state_res", "]", ",", "axis", "=", "1", ")", "\n", "state", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "state_concat", ",", "filters", "=", "state_channel", ",", "kernel_size", "=", "(", "5", ",", "5", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'state_merge'", ",", "data_format", "=", "'channels_first'", ",", "activation", "=", "tf", ".", "nn", ".", "elu", ")", "\n", "\n", "# state = wrap_pad(state, 2)", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_rand_wall": [[368, 389], ["random.randint", "pymunk.Segment", "space.add", "numpy.random.uniform", "random.randint", "numpy.random.uniform", "numpy.random.uniform", "numpy.random.uniform"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.None.utils.ReplayBuffer.add"], ["padding", "=", "'same'", ",", "name", "=", "'dym1'", ",", "data_format", "=", "'channels_first'", ",", "activation", "=", "tf", ".", "nn", ".", "elu", ")", "\n", "\n", "outputs", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "1", ")", ":", "\n", "\n", "            ", "merge_step_1", "=", "tf", ".", "concat", "(", "[", "state_step", ",", "inp", "]", ",", "axis", "=", "1", ")", "\n", "# merge_step_1 = wrap_pad(merge_step_1, 1)", "\n", "output", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "merge_step_1", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'output'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "activation", "=", "tf", ".", "nn", ".", "elu", ")", "\n", "outputs", ".", "append", "(", "output", ")", "\n", "\n", "# if i != FLAGS.pred_steps -1:", "\n", "#     state_step = wrap_pad(state_step, 2)", "\n", "#     state_step = tf.layers.conv2d(inputs=state_step, filters=state_channel, kernel_size=(5, 5), strides=(1, 1),", "\n", "#                                   padding='same', name='dym1', data_format='channels_first', reuse=True, activation=tf.nn.elu)", "\n", "#     reuse = True", "\n", "\n", "", "output", "=", "tf", ".", "stack", "(", "outputs", ",", "axis", "=", "1", ")", "\n", "\n", "\n", "", "return", "[", "state_next", "]", ",", "output", ",", "state_step", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_default_space": [[391, 407], ["utils.construct_space", "numpy.random.randint", "numpy.random.randint", "range", "range", "utils.construct_rand_wall", "utils.construct_rand_body"], "function", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_space", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_rand_wall", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_rand_body"], ["\n", "", "def", "convlstm", "(", "inp", ",", "state", ",", "FLAGS", ",", "reuse", "=", "False", ",", "scope", "=", "\"\"", ",", "bypass_res", "=", "False", ")", ":", "\n", "    ", "\"\"\"Computes representation on inp through spatial mem given inp of size nchw and state of nchw\"\"\"", "\n", "\n", "state", "=", "state", "[", "0", "]", "\n", "cell", ",", "hidden", "=", "tf", ".", "split", "(", "state", ",", "2", ",", "axis", "=", "1", ")", "\n", "input_channel", "=", "cell", ".", "get_shape", "(", ")", "[", "1", "]", "\n", "output_channel", "=", "inp", ".", "get_shape", "(", ")", "[", "1", "]", "\n", "\n", "with", "tf", ".", "variable_scope", "(", "\"spatial_lstm\"", "+", "scope", ",", "reuse", "=", "reuse", ")", ":", "\n", "        ", "input_x", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "inp", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'ig'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "use_bias", "=", "False", ")", "\n", "input_h", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "hidden", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'hg'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "use_bias", "=", "False", ")", "\n", "input_c", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "cell", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'cg'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_simulation": [[409, 414], ["screen.fill", "space.debug_draw", "pygame.surfarray.array3d"], "function", ["None"], ["\n", "forget_x", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "inp", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'if'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "use_bias", "=", "False", ")", "\n", "forget_h", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "hidden", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'hf'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "use_bias", "=", "False", ")", "\n", "forget_c", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "cell", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.save_state": [[416, 424], ["space._get_bodies"], "function", ["None"], ["\n", "forget_gate", "=", "tf", ".", "nn", ".", "sigmoid", "(", "forget_x", "+", "forget_h", "+", "forget_c", ")", "\n", "\n", "\n", "input_act_x", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "inp", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'ii'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "use_bias", "=", "False", ")", "\n", "input_act_h", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "hidden", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'hi'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.restore_state": [[426, 431], ["snapshot.items"], "function", ["None"], ["\n", "output_x", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "inp", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'io'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "use_bias", "=", "False", ")", "\n", "output_h", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "hidden", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n", "padding", "=", "'same'", ",", "name", "=", "'ho'", ",", "data_format", "=", "'channels_first'", ",", "reuse", "=", "reuse", ",", "use_bias", "=", "False", ")", "\n", "output_c", "=", "tf", ".", "layers", ".", "conv2d", "(", "inputs", "=", "cell", ",", "filters", "=", "input_channel", ",", "kernel_size", "=", "(", "3", ",", "3", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.distance": [[433, 436], ["None"], "function", ["None"], ["\n", "output_gate", "=", "tf", ".", "nn", ".", "sigmoid", "(", "output_x", "+", "output_h", "+", "output_c", ")", "\n", "\n", "cell_new", "=", "forget_gate", "*", "cell", "+", "inp_gate", "*", "tf", ".", "nn", ".", "tanh", "(", "inp", ")", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.__init__": [[18, 40], ["pybullet.connect", "pybullet.setAdditionalSearchPath", "pybullet.setPhysicsEngineParameter", "gym.spaces.Discrete", "pybullet_data.getDataPath", "gym.spaces.Box", "gym.spaces.Box", "range", "math.sin", "math.cos"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "order", "=", "1", ",", "frame_stack", "=", "1", ",", "pm_oracle", "=", "False", ",", "pred_steps", "=", "0", ",", "balance_frames", "=", "False", ")", ":", "\n", "        ", "self", ".", "frame_stack", "=", "frame_stack", "\n", "self", ".", "pm_oracle", "=", "pm_oracle", "\n", "self", ".", "pred_steps", "=", "pred_steps", "\n", "self", ".", "balance_frames", "=", "balance_frames", "\n", "\n", "self", ".", "client", "=", "p", ".", "connect", "(", "p", ".", "DIRECT", ")", "\n", "p", ".", "setAdditionalSearchPath", "(", "pybullet_data", ".", "getDataPath", "(", ")", ")", "\n", "p", ".", "setPhysicsEngineParameter", "(", "fixedTimeStep", "=", "1", "/", "15.", ",", "numSolverIterations", "=", "1", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "self", ".", "vs", "=", "[", "[", "15", "*", "math", ".", "sin", "(", "i", "*", "math", ".", "pi", "/", "8", ")", ",", "15", "*", "math", ".", "cos", "(", "i", "*", "math", ".", "pi", "/", "8", ")", ",", "8", "]", "for", "i", "in", "range", "(", "9", ")", "]", "\n", "self", ".", "spec", "=", "\"trash\"", "\n", "\n", "\n", "if", "not", "pm_oracle", ":", "\n", "            ", "pred_steps", "=", "0", "\n", "\n", "", "if", "not", "balance_frames", ":", "\n", "            ", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "0", ",", "255", ",", "(", "84", ",", "84", ",", "3", "*", "(", "frame_stack", "+", "pred_steps", ")", ")", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "0", ",", "255", ",", "(", "84", ",", "84", ",", "3", "*", "(", "frame_stack", ")", ")", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "\n", "", "self", ".", "action_space", "=", "spaces", ".", "Discrete", "(", "9", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.step": [[41, 78], ["pybullet.getBasePositionAndOrientation", "pybullet.getBasePositionAndOrientation", "phys_3d_shooter.PhysEnv3D.out_bounds", "utils.step_3d_simulation_shooter", "phys_3d_shooter.PhysEnv3D.construct_obs", "utils.reset_3d_velocity", "utils.get_3d_image", "pybullet.resetBasePositionAndOrientation", "pybullet.resetBaseVelocity"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.out_bounds", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_3d_simulation_shooter", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.construct_obs", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.reset_3d_velocity", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.get_3d_image"], ["", "def", "step", "(", "self", ",", "act", ")", ":", "\n", "\n", "        ", "reward", "=", "0", "\n", "total_length", "=", "0", "\n", "pos", ",", "ori", "=", "p", ".", "getBasePositionAndOrientation", "(", "self", ".", "player_body", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "\n", "info", "=", "{", "}", "\n", "\n", "obs", "=", "[", "get_3d_image", "(", "physicsClientId", "=", "self", ".", "client", ")", "]", "\n", "\n", "self", ".", "iter", "+=", "1", "\n", "\n", "velocity", "=", "self", ".", "vs", "[", "act", "]", "\n", "pos", ",", "_", "=", "p", ".", "getBasePositionAndOrientation", "(", "self", ".", "bullet_body", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "\n", "if", "self", ".", "out_bounds", "(", "pos", ")", ":", "\n", "            ", "p", ".", "resetBasePositionAndOrientation", "(", "self", ".", "bullet_body", ",", "[", "2", ",", "2", ",", "0.5", "]", ",", "[", "0", ",", "0", ",", "0", ",", "1", "]", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "p", ".", "resetBaseVelocity", "(", "self", ".", "bullet_body", ",", "velocity", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "\n", "", "done", ",", "reward", "=", "step_3d_simulation_shooter", "(", "self", ".", "player_body", ",", "self", ".", "bullet_body", ",", "self", ".", "goals", ",", "self", ".", "bodies", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "ob", "=", "self", ".", "construct_obs", "(", "obs", ")", "\n", "\n", "self", ".", "total_reward", "+=", "reward", "\n", "self", ".", "total_length", "+=", "total_length", "\n", "\n", "reset_3d_velocity", "(", "self", ".", "bodies", "+", "self", ".", "goals", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "\n", "if", "self", ".", "iter", ">", "1000", ":", "\n", "            ", "done", "=", "True", "\n", "\n", "", "if", "done", ":", "\n", "            ", "episode", "=", "{", "}", "\n", "episode", "[", "'r'", "]", "=", "self", ".", "total_reward", "\n", "episode", "[", "'l'", "]", "=", "self", ".", "total_length", "\n", "info", "[", "'episode'", "]", "=", "episode", "\n", "\n", "", "return", "ob", ",", "reward", ",", "done", ",", "info", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.out_bounds": [[79, 81], ["None"], "methods", ["None"], ["", "def", "out_bounds", "(", "self", ",", "pos", ")", ":", "\n", "        ", "return", "(", "pos", "[", "0", "]", "<", "-", "0.5", ")", "or", "(", "pos", "[", "0", "]", ">", "10.5", ")", "or", "(", "pos", "[", "1", "]", "<", "-", "10.5", ")", "or", "(", "pos", "[", "1", "]", ">", "10.5", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.seed": [[82, 84], ["numpy.random.seed"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.seed"], ["", "def", "seed", "(", "self", ",", "seed", ")", ":", "\n", "        ", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.reset": [[85, 126], ["pybullet.resetSimulation", "utils.construct_3d_shapes_space", "pybullet.setGravity", "pybullet.createVisualShape", "pybullet.createCollisionShape", "pybullet.createMultiBody", "pybullet.createVisualShape", "pybullet.createCollisionShape", "pybullet.createMultiBody", "range", "phys_3d_shooter.PhysEnv3D.construct_obs", "utils.step_3d_simulation_shooter", "phys_3d_shooter.PhysEnv3D.frame_buffer.append", "utils.get_3d_image"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.construct_3d_shapes_space", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.construct_obs", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_3d_simulation_shooter", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.get_3d_image"], ["", "def", "reset", "(", "self", ")", ":", "\n", "        ", "p", ".", "resetSimulation", "(", ")", "\n", "bodies", ",", "goals", "=", "construct_3d_shapes_space", "(", "min_obj", "=", "5", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "self", ".", "bodies", "=", "bodies", "\n", "self", ".", "goals", "=", "goals", "\n", "p", ".", "setGravity", "(", "0", ",", "0", ",", "-", "10", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "\n", "self", ".", "iter", "=", "0", "\n", "\n", "# Construct the player sprite", "\n", "player_vid", "=", "p", ".", "createVisualShape", "(", "p", ".", "GEOM_SPHERE", ",", "radius", "=", "0.5", ",", "rgbaColor", "=", "(", "0.3", ",", "0.3", ",", "0.3", ",", "1", ")", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "player_cid", "=", "p", ".", "createCollisionShape", "(", "p", ".", "GEOM_SPHERE", ",", "radius", "=", "0.5", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "player_body", "=", "p", ".", "createMultiBody", "(", "1", ",", "baseVisualShapeIndex", "=", "player_vid", ",", "baseCollisionShapeIndex", "=", "player_cid", ",", "basePosition", "=", "[", "1", ",", "1", ",", "0.5", "]", ",", "baseOrientation", "=", "[", "0", ",", "0", ",", "0", ",", "1", "]", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "\n", "self", ".", "player_body", "=", "player_body", "\n", "\n", "bullet_vid", "=", "p", ".", "createVisualShape", "(", "p", ".", "GEOM_BOX", ",", "halfExtents", "=", "[", "0.5", ",", "0.5", ",", "0.5", "]", ",", "rgbaColor", "=", "(", "0", ",", "1", ",", "1", ",", "1", ")", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "bullet_cid", "=", "p", ".", "createCollisionShape", "(", "p", ".", "GEOM_BOX", ",", "halfExtents", "=", "[", "0.5", ",", "0.5", ",", "0.5", "]", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "bullet_body", "=", "p", ".", "createMultiBody", "(", "1", ",", "baseVisualShapeIndex", "=", "bullet_vid", ",", "baseCollisionShapeIndex", "=", "bullet_cid", ",", "basePosition", "=", "[", "30", ",", "30", ",", "0.5", "]", ",", "baseOrientation", "=", "[", "0", ",", "0", ",", "0", ",", "1", "]", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "\n", "self", ".", "bullet_body", "=", "bullet_body", "\n", "\n", "# g = space.add_collision_handler(collision_types['player'], collision_types['object'])", "\n", "# g.begin = remove_player", "\n", "\n", "# self.space = space", "\n", "# self.screen = screen", "\n", "# self.draw_options = draw_options", "\n", "# self.player_body = body", "\n", "\n", "self", ".", "total_reward", "=", "0", "\n", "self", ".", "total_length", "=", "0", "\n", "\n", "self", ".", "frame_buffer", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "self", ".", "frame_stack", ")", ":", "\n", "            ", "step_3d_simulation_shooter", "(", "self", ".", "player_body", ",", "self", ".", "bullet_body", ",", "self", ".", "goals", ",", "self", ".", "bodies", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "self", ".", "frame_buffer", ".", "append", "(", "get_3d_image", "(", "physicsClientId", "=", "self", ".", "client", ")", ")", "\n", "\n", "", "obs", "=", "self", ".", "construct_obs", "(", ")", "\n", "return", "obs", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.render": [[127, 132], ["utils.get_3d_image", "plt.imshow", "plt.show"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.get_3d_image"], ["", "def", "render", "(", "self", ")", ":", "\n", "        ", "im", "=", "get_3d_image", "(", "physicsClientId", "=", "self", ".", "client", ")", "\n", "import", "matplotlib", ".", "pyplot", "as", "plt", "\n", "plt", ".", "imshow", "(", "im", ")", "\n", "plt", ".", "show", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.construct_obs": [[133, 161], ["phys_3d_shooter.PhysEnv3D.frame_buffer.extend", "numpy.concatenate", "utils.save_bullet_state", "range", "utils.restore_bullet_state", "obs.extend", "utils.get_3d_image", "utils.step_3d_simulation", "future_obs.append", "utils.get_3d_image"], "methods", ["home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.save_bullet_state", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.restore_bullet_state", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.get_3d_image", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.step_3d_simulation", "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.utils.get_3d_image"], ["", "def", "construct_obs", "(", "self", ",", "new_obs", "=", "None", ")", ":", "\n", "# Adds a frame into the frame buffer and returns the concatenated observation", "\n", "        ", "if", "new_obs", "is", "None", ":", "\n", "            ", "new_obs", "=", "[", "get_3d_image", "(", "physicsClientId", "=", "self", ".", "client", ")", "]", "\n", "\n", "# print(p.getBasePositionAndOrientation(1))", "\n", "# print(p.getBasePositionAndOrientation(2))", "\n", "", "self", ".", "frame_buffer", ".", "extend", "(", "new_obs", ")", "\n", "self", ".", "frame_buffer", "=", "self", ".", "frame_buffer", "[", "-", "self", ".", "frame_stack", ":", "]", "\n", "obs", "=", "self", ".", "frame_buffer", "\n", "\n", "if", "self", ".", "pred_steps", ">", "0", "and", "self", ".", "pm_oracle", ":", "\n", "            ", "snapshot", "=", "save_bullet_state", "(", "physicsClientId", "=", "self", ".", "client", ")", "\n", "future_obs", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "self", ".", "pred_steps", ")", ":", "\n", "                ", "step_3d_simulation", "(", "self", ".", "player_body", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "future_obs", ".", "append", "(", "get_3d_image", "(", "physicsClientId", "=", "self", ".", "client", ")", ")", "\n", "\n", "", "restore_bullet_state", "(", "snapshot", ",", "physicsClientId", "=", "self", ".", "client", ")", "\n", "obs", ".", "extend", "(", "future_obs", ")", "\n", "\n", "# self.player_body.reward = 0", "\n", "\n", "", "if", "self", ".", "balance_frames", ":", "\n", "            ", "obs", "=", "obs", "[", "-", "self", ".", "frame_stack", ":", "]", "\n", "\n", "", "return", "np", ".", "concatenate", "(", "obs", ",", "axis", "=", "2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.PhysEnv3D.close": [[162, 164], ["None"], "methods", ["None"], ["", "def", "close", "(", "self", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.yilundu_task_agnostic_dynamics_prior.phys_env.phys_3d_shooter.fetch_action": [[166, 168], ["int", "input"], "function", ["None"], ["", "", "def", "fetch_action", "(", ")", ":", "\n", "    ", "return", "int", "(", "input", "(", "\"Enter your move (0, 1, 2, 3) : \"", ")", ")", "\n", "\n"]]}