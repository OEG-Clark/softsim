{"home.repos.pwc.inspect_result.Microsoft_nail_agent.None.run_nail_agent.main": [[20, 55], ["parser.parse_args", "jericho.FrotzEnv", "agent.nail.NailAgent", "jericho.FrotzEnv.reset", "range", "agent.nail.NailAgent.finalize", "agent.nail.NailAgent.take_action", "jericho.FrotzEnv.step", "agent.nail.NailAgent.observe", "print", "os.path.basename", "print", "jericho.FrotzEnv.reset"], "function", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.reset", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.nail.NailAgent.finalize", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.nail.NailAgent.take_action", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.nail.NailAgent.observe", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.reset"], ["def", "main", "(", ")", ":", "\n", "# Parse the arguments.", "\n", "    ", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "\n", "# Create the environment.", "\n", "env", "=", "FrotzEnv", "(", "args", ".", "game", ",", "seed", "=", "args", ".", "seed", ")", "\n", "\n", "# Create the NAIL agent.", "\n", "agent", "=", "NailAgent", "(", "seed", "=", "args", ".", "seed", ",", "env", "=", "env", ",", "rom_name", "=", "os", ".", "path", ".", "basename", "(", "args", ".", "game", ")", ")", "\n", "\n", "# Get the first observation from the environment.", "\n", "obs", "=", "env", ".", "reset", "(", ")", "\n", "\n", "# Run the agent on the environment for the specified number of steps.", "\n", "for", "step_num", "in", "range", "(", "args", ".", "steps", ")", ":", "\n", "# Get one action from the agent.", "\n", "        ", "action", "=", "agent", ".", "take_action", "(", "obs", ")", "\n", "\n", "# Pass the action to the environment.", "\n", "new_obs", ",", "score", ",", "done", ",", "info", "=", "env", ".", "step", "(", "action", ")", "\n", "\n", "# Update the agent.", "\n", "agent", ".", "observe", "(", "obs", ",", "action", ",", "score", ",", "new_obs", ",", "done", ")", "\n", "obs", "=", "new_obs", "\n", "\n", "# Output this step.", "\n", "print", "(", "\"Step {}   Action [{}]   Score {}\\n{}\"", ".", "format", "(", "step_num", ",", "action", ",", "score", ",", "obs", ")", ")", "\n", "\n", "# Check for done (such as on death).", "\n", "if", "done", ":", "\n", "            ", "print", "(", "\"Environment returned done=True. So reset the environment.\\n\"", ")", "\n", "obs", "=", "env", ".", "reset", "(", ")", "\n", "\n", "# Clean up the agent.", "\n", "", "", "agent", ".", "finalize", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.affordance_extractor.AffordanceExtractor.__init__": [[9, 11], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.affordance_extractor.AffordanceExtractor.extract_single_object_actions": [[13, 19], ["NotImplementedError"], "methods", ["None"], ["", "@", "abstractmethod", "\n", "def", "extract_single_object_actions", "(", "self", ",", "entity", ")", ":", "\n", "        ", "\"\"\" Generate actions afforded by the given entity.\n            Returns: List of (action, probability) tuples.\n        \"\"\"", "\n", "raise", "NotImplementedError", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.affordance_extractor.AffordanceExtractor.extract_double_object_actions": [[21, 27], ["NotImplementedError"], "methods", ["None"], ["", "@", "abstractmethod", "\n", "def", "extract_double_object_actions", "(", "self", ",", "entity1", ",", "entity2", ")", ":", "\n", "        ", "\"\"\" Generate actions afforded by the given entity pair.\n            Returns: List of (action, probability) tuples.\n        \"\"\"", "\n", "raise", "NotImplementedError", "(", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.__init__": [[16, 23], ["location.Inventory", "knowledge_graph.ConnectionGraph"], "methods", ["None"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "_locations", "=", "[", "]", "\n", "self", ".", "_player_location", "=", "None", "\n", "self", ".", "_init_loc", "=", "None", "\n", "self", ".", "_inventory", "=", "Inventory", "(", ")", "\n", "self", ".", "_connections", "=", "ConnectionGraph", "(", ")", "\n", "self", ".", "_unrecognized_words", "=", "gv", ".", "ILLEGAL_ACTIONS", "[", ":", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.locations": [[24, 27], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "locations", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_locations", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.add_location": [[28, 32], ["knowledge_graph.KnowledgeGraph._locations.append", "gv.event_stream.push", "event.NewLocationEvent"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.EventStream.push"], ["", "def", "add_location", "(", "self", ",", "new_location", ")", ":", "\n", "        ", "\"\"\" Adds a new location object and broadcasts a NewLocation event. \"\"\"", "\n", "self", ".", "_locations", ".", "append", "(", "new_location", ")", "\n", "gv", ".", "event_stream", ".", "push", "(", "NewLocationEvent", "(", "new_location", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.most_similar_location": [[33, 47], ["location.Location.extract_name", "knowledge_graph.KnowledgeGraph.locations_with_name", "fuzzywuzzy.fuzz.partial_ratio"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.extract_name", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.locations_with_name"], ["", "def", "most_similar_location", "(", "self", ",", "description", ")", ":", "\n", "        ", "\"\"\" Returns the location with the highest similarity to the given description. \"\"\"", "\n", "possible_name", "=", "Location", ".", "extract_name", "(", "description", ")", "\n", "existing_locs", "=", "self", ".", "locations_with_name", "(", "possible_name", ")", "\n", "if", "not", "existing_locs", ":", "\n", "            ", "existing_locs", "=", "self", ".", "_locations", "\n", "", "most_similar", "=", "None", "\n", "best_similarity", "=", "0", "\n", "for", "loc", "in", "existing_locs", ":", "\n", "            ", "similarity", "=", "fuzz", ".", "partial_ratio", "(", "loc", ".", "description", ",", "description", ")", "\n", "if", "similarity", ">", "best_similarity", ":", "\n", "                ", "best_similarity", "=", "similarity", "\n", "most_similar", "=", "loc", "\n", "", "", "return", "most_similar", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.locations_with_name": [[48, 51], ["None"], "methods", ["None"], ["", "def", "locations_with_name", "(", "self", ",", "location_name", ")", ":", "\n", "        ", "\"\"\" Returns all locations with a particular name. \"\"\"", "\n", "return", "[", "l", "for", "l", "in", "self", ".", "_locations", "if", "l", ".", "name", "==", "location_name", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.player_location": [[56, 63], ["gv.event_stream.push", "event.LocationChangedEvent"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.EventStream.push"], ["", "@", "player_location", ".", "setter", "\n", "def", "player_location", "(", "self", ",", "new_location", ")", ":", "\n", "        ", "\"\"\" Changes player location and broadcasts a LocationChangedEvent. \"\"\"", "\n", "if", "new_location", "==", "self", ".", "_player_location", ":", "\n", "            ", "return", "\n", "", "gv", ".", "event_stream", ".", "push", "(", "LocationChangedEvent", "(", "new_location", ")", ")", "\n", "self", ".", "_player_location", "=", "new_location", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.inventory": [[64, 67], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "inventory", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_inventory", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.connections": [[68, 71], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "connections", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_connections", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.add_connection": [[72, 75], ["knowledge_graph.KnowledgeGraph._connections.add"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.ConnectionGraph.add"], ["", "def", "add_connection", "(", "self", ",", "new_connection", ")", ":", "\n", "        ", "\"\"\" Adds a connection object. \"\"\"", "\n", "self", ".", "_connections", ".", "add", "(", "new_connection", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.reset": [[76, 83], ["knowledge_graph.KnowledgeGraph.inventory.reset", "location.reset"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.reset", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.reset"], ["", "def", "reset", "(", "self", ")", ":", "\n", "        ", "\"\"\"Returns the knowledge_graph to a state resembling the start of the\n        game. Note this does not remove discovered objects or locations. \"\"\"", "\n", "self", ".", "player_location", "=", "self", ".", "_init_loc", "\n", "self", ".", "inventory", ".", "reset", "(", ")", "\n", "for", "location", "in", "self", ".", "locations", ":", "\n", "            ", "location", ".", "reset", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.__str__": [[84, 101], ["str", "knowledge_graph.KnowledgeGraph.connections.outgoing", "loc.to_string"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.ConnectionGraph.outgoing", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.attribute.Attribute.to_string"], ["", "", "def", "__str__", "(", "self", ")", ":", "\n", "        ", "s", "=", "\"Knowledge Graph\\n\"", "\n", "if", "self", ".", "_player_location", "==", "None", ":", "\n", "            ", "s", "+=", "\"PlayerLocation: None\"", "\n", "", "else", ":", "\n", "            ", "s", "+=", "\"PlayerLocation: {}\"", ".", "format", "(", "self", ".", "_player_location", ".", "name", ")", "\n", "", "s", "+=", "\"\\n\"", "+", "str", "(", "self", ".", "inventory", ")", "\n", "s", "+=", "\"\\nKnownLocations:\"", "\n", "if", "self", ".", "_locations", ":", "\n", "            ", "for", "loc", "in", "self", ".", "_locations", ":", "\n", "                ", "s", "+=", "\"\\n\"", "+", "loc", ".", "to_string", "(", "\"  \"", ")", "\n", "outgoing", "=", "self", ".", "connections", ".", "outgoing", "(", "loc", ")", "\n", "if", "outgoing", ":", "\n", "                    ", "s", "+=", "\"\\n    Connections:\"", "\n", "for", "con", "in", "outgoing", ":", "\n", "                        ", "s", "+=", "\"\\n      {} --> {}\"", ".", "format", "(", "con", ".", "action", ",", "con", ".", "to_location", ".", "name", ")", "\n", "", "", "", "", "return", "s", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.ConnectionGraph.__init__": [[109, 112], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "_out_graph", "=", "{", "}", "# Location : [Outgoing Connections]", "\n", "self", ".", "_in_graph", "=", "{", "}", "# Location : [Incoming Connections]", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.ConnectionGraph.add": [[113, 129], ["gv.event_stream.push", "event.NewConnectionEvent", "knowledge_graph.ConnectionGraph._out_graph[].append", "knowledge_graph.ConnectionGraph._in_graph[].append"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.EventStream.push"], ["", "def", "add", "(", "self", ",", "connection", ")", ":", "\n", "        ", "\"\"\" Adds a new connection to the graph if it doesn't already exist. \"\"\"", "\n", "from_location", "=", "connection", ".", "from_location", "\n", "to_location", "=", "connection", ".", "to_location", "\n", "gv", ".", "event_stream", ".", "push", "(", "NewConnectionEvent", "(", "connection", ")", ")", "\n", "if", "from_location", "in", "self", ".", "_out_graph", ":", "\n", "            ", "if", "connection", "in", "self", ".", "_out_graph", "[", "from_location", "]", ":", "\n", "                ", "return", "\n", "", "self", ".", "_out_graph", "[", "from_location", "]", ".", "append", "(", "connection", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "_out_graph", "[", "from_location", "]", "=", "[", "connection", "]", "\n", "", "if", "to_location", "is", "not", "None", ":", "\n", "            ", "if", "to_location", "in", "self", ".", "_in_graph", ":", "\n", "                ", "self", ".", "_in_graph", "[", "to_location", "]", ".", "append", "(", "connection", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "_in_graph", "[", "to_location", "]", "=", "[", "connection", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.ConnectionGraph.incoming": [[130, 136], ["None"], "methods", ["None"], ["", "", "", "def", "incoming", "(", "self", ",", "location", ")", ":", "\n", "        ", "\"\"\" Returns a list of incoming connections to the given location. \"\"\"", "\n", "if", "location", "in", "self", ".", "_in_graph", ":", "\n", "            ", "return", "self", ".", "_in_graph", "[", "location", "]", "\n", "", "else", ":", "\n", "            ", "return", "[", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.ConnectionGraph.outgoing": [[137, 143], ["None"], "methods", ["None"], ["", "", "def", "outgoing", "(", "self", ",", "location", ")", ":", "\n", "        ", "\"\"\" Returns a list of outgoing connections from the given location. \"\"\"", "\n", "if", "location", "in", "self", ".", "_out_graph", ":", "\n", "            ", "return", "self", ".", "_out_graph", "[", "location", "]", "\n", "", "else", ":", "\n", "            ", "return", "[", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.ConnectionGraph.navigate": [[144, 154], ["knowledge_graph.ConnectionGraph.outgoing", "isinstance", "ValueError", "type"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.ConnectionGraph.outgoing"], ["", "", "def", "navigate", "(", "self", ",", "location", ",", "nav_action", ")", ":", "\n", "        ", "\"\"\"Returns the destination that is reached by performing nav_action\n        from location.\n        \"\"\"", "\n", "if", "not", "isinstance", "(", "nav_action", ",", "Action", ")", ":", "\n", "            ", "raise", "ValueError", "(", "\"Expected Action. Got {}\"", ".", "format", "(", "type", "(", "nav_action", ")", ")", ")", "\n", "", "for", "connection", "in", "self", ".", "outgoing", "(", "location", ")", ":", "\n", "            ", "if", "connection", ".", "action", "==", "nav_action", ":", "\n", "                ", "return", "connection", ".", "to_location", "\n", "", "", "return", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.ConnectionGraph.shortest_path": [[155, 171], ["knowledge_graph.ConnectionGraph.shortest_path", "len", "len"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.ConnectionGraph.shortest_path"], ["", "def", "shortest_path", "(", "self", ",", "start_location", ",", "end_location", ",", "path", "=", "[", "]", ")", ":", "\n", "        ", "\"\"\" Find the shortest path between start and end locations. \"\"\"", "\n", "if", "start_location", "==", "end_location", ":", "\n", "            ", "return", "path", "\n", "", "if", "start_location", "not", "in", "self", ".", "_out_graph", ":", "\n", "            ", "return", "None", "\n", "", "shortest", "=", "None", "\n", "for", "connection", "in", "self", ".", "_out_graph", "[", "start_location", "]", ":", "\n", "            ", "if", "connection", "not", "in", "path", ":", "\n", "                ", "newpath", "=", "self", ".", "shortest_path", "(", "connection", ".", "to_location", ",", "\n", "end_location", ",", "\n", "path", "+", "[", "connection", "]", ")", "\n", "if", "newpath", ":", "\n", "                    ", "if", "not", "shortest", "or", "len", "(", "newpath", ")", "<", "len", "(", "shortest", ")", ":", "\n", "                        ", "shortest", "=", "newpath", "\n", "", "", "", "", "return", "shortest", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.Connection.__init__": [[184, 189], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "from_location", ",", "action", ",", "to_location", "=", "None", ",", "message", "=", "''", ")", ":", "\n", "        ", "self", ".", "from_location", "=", "from_location", "\n", "self", ".", "to_location", "=", "to_location", "\n", "self", ".", "action", "=", "action", "\n", "self", ".", "message", "=", "message", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.Connection.__eq__": [[190, 196], ["isinstance"], "methods", ["None"], ["", "def", "__eq__", "(", "self", ",", "other", ")", ":", "\n", "        ", "if", "isinstance", "(", "self", ",", "other", ".", "__class__", ")", ":", "\n", "            ", "return", "self", ".", "action", "==", "other", ".", "action", "and", "self", ".", "from_location", "==", "other", ".", "from_location", "and", "self", ".", "to_location", "==", "other", ".", "to_location", "\n", "", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.Connection.to_string": [[197, 201], ["None"], "methods", ["None"], ["", "def", "to_string", "(", "self", ",", "prefix", "=", "''", ")", ":", "\n", "        ", "return", "prefix", "+", "\"{} --({})--> {}\"", ".", "format", "(", "self", ".", "from_location", ".", "name", ",", "\n", "self", ".", "action", ",", "\n", "self", ".", "to_location", ".", "name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.Connection.__str__": [[202, 204], ["knowledge_graph.Connection.to_string"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.attribute.Attribute.to_string"], ["", "def", "__str__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "to_string", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.Connection.__repr__": [[205, 207], ["str"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "str", "(", "self", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.Connection.__hash__": [[208, 210], ["hash", "knowledge_graph.Connection.text"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.ExamineAction.text"], ["", "def", "__hash__", "(", "self", ")", ":", "\n", "        ", "return", "hash", "(", "self", ".", "text", "(", ")", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.Action.__init__": [[12, 14], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "verb", ")", ":", "\n", "        ", "self", ".", "verb", "=", "verb", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.Action.text": [[15, 19], ["None"], "methods", ["None"], ["", "@", "abstractmethod", "\n", "def", "text", "(", "self", ")", ":", "\n", "        ", "\"\"\" Generate the text equivalent of a given action. \"\"\"", "\n", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.Action.validate": [[20, 28], ["None"], "methods", ["None"], ["", "def", "validate", "(", "self", ",", "response_text", ")", ":", "\n", "        ", "\"\"\"\n        Determine if an action has succeded based on the textual game's\n        textual response. Returns p(valid), the probability of the\n        action having succeded.\n\n        \"\"\"", "\n", "return", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.Action.apply": [[29, 36], ["None"], "methods", ["None"], ["", "def", "apply", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Apply the action to the knowledge_graph. The effects of applying\n        depend on which action being applied.\n\n        \"\"\"", "\n", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.Action.recognized": [[37, 43], ["action.Action.text().split", "action.Action.text"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.ExamineAction.text"], ["", "def", "recognized", "(", "self", ")", ":", "\n", "        ", "\"\"\" Returns true if action doesn't contain unrecognized words. \"\"\"", "\n", "for", "word", "in", "self", ".", "text", "(", ")", ".", "split", "(", "' '", ")", ":", "\n", "            ", "if", "word", "in", "gv", ".", "kg", ".", "_unrecognized_words", ":", "\n", "                ", "return", "False", "\n", "", "", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.Action.__str__": [[44, 46], ["action.Action.text"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.ExamineAction.text"], ["", "def", "__str__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "text", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.Action.__repr__": [[47, 49], ["action.Action.__str__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Inventory.__str__"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "__str__", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.Action.__hash__": [[50, 52], ["hash", "action.Action.text"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.ExamineAction.text"], ["", "def", "__hash__", "(", "self", ")", ":", "\n", "        ", "return", "hash", "(", "self", ".", "text", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.Action.__eq__": [[53, 55], ["action.Action.text", "other.text"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.ExamineAction.text", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.ExamineAction.text"], ["", "def", "__eq__", "(", "self", ",", "other", ")", ":", "\n", "        ", "return", "self", ".", "text", "(", ")", "==", "other", ".", "text", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.StandaloneAction.__init__": [[59, 61], ["action.Action.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "verb", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "verb", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.StandaloneAction.text": [[62, 64], ["None"], "methods", ["None"], ["", "def", "text", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "verb", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.SingleAction.__init__": [[68, 73], ["action.Action.__init__", "isinstance", "ValueError", "type"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "verb", ",", "entity", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "verb", ")", "\n", "if", "not", "isinstance", "(", "entity", ",", "Entity", ")", ":", "\n", "            ", "raise", "ValueError", "(", "\"Expected entity object, got {}\"", ".", "format", "(", "type", "(", "entity", ")", ")", ")", "\n", "", "self", ".", "entity", "=", "entity", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.SingleAction.text": [[74, 76], ["None"], "methods", ["None"], ["", "def", "text", "(", "self", ")", ":", "\n", "        ", "return", "\"{} {}\"", ".", "format", "(", "self", ".", "verb", ",", "self", ".", "entity", ".", "name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.DoubleAction.__init__": [[80, 89], ["action.Action.__init__", "isinstance", "ValueError", "isinstance", "ValueError", "type", "type"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "verb", ",", "entity1", ",", "preposition", ",", "entity2", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "verb", ")", "\n", "if", "not", "isinstance", "(", "entity1", ",", "Entity", ")", ":", "\n", "            ", "raise", "ValueError", "(", "\"Expected entity object, got {}\"", ".", "format", "(", "type", "(", "entity1", ")", ")", ")", "\n", "", "if", "not", "isinstance", "(", "entity2", ",", "Entity", ")", ":", "\n", "            ", "raise", "ValueError", "(", "\"Expected entity object, got {}\"", ".", "format", "(", "type", "(", "entity2", ")", ")", ")", "\n", "", "self", ".", "entity1", "=", "entity1", "\n", "self", ".", "prep", "=", "preposition", "\n", "self", ".", "entity2", "=", "entity2", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.DoubleAction.text": [[90, 93], ["None"], "methods", ["None"], ["", "def", "text", "(", "self", ")", ":", "\n", "        ", "return", "\"{} {} {} {}\"", ".", "format", "(", "self", ".", "verb", ",", "self", ".", "entity1", ".", "name", ",", "\n", "self", ".", "prep", ",", "self", ".", "entity2", ".", "name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.NavAction.__init__": [[96, 98], ["action.StandaloneAction.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["    ", "def", "__init__", "(", "self", ",", "verb", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "verb", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.NavAction.apply": [[99, 103], ["gv.kg.connections.navigate"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.ConnectionGraph.navigate"], ["", "def", "apply", "(", "self", ")", ":", "\n", "        ", "to_loc", "=", "gv", ".", "kg", ".", "connections", ".", "navigate", "(", "gv", ".", "kg", ".", "player_location", ",", "self", ")", "\n", "assert", "to_loc", ",", "\"Error: Unknown connection\"", "\n", "gv", ".", "kg", ".", "player_location", "=", "to_loc", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.ExamineAction.__init__": [[106, 109], ["action.Action.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["    ", "def", "__init__", "(", "self", ",", "entity_name", ":", "str", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "\"examine\"", ")", "\n", "self", ".", "entity_name", "=", "entity_name", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.ExamineAction.text": [[110, 112], ["None"], "methods", ["None"], ["", "def", "text", "(", "self", ")", ":", "\n", "        ", "return", "\"{} {}\"", ".", "format", "(", "self", ".", "verb", ",", "self", ".", "entity_name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.ExamineAction.apply": [[113, 116], ["entity.Entity.Entity", "gv.kg.player_location.add_entity"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_entity"], ["", "def", "apply", "(", "self", ")", ":", "\n", "        ", "entity", "=", "Entity", "(", "self", ".", "entity", ",", "response", ")", "\n", "gv", ".", "kg", ".", "player_location", ".", "add_entity", "(", "entity", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.TakeAction.__init__": [[119, 121], ["action.SingleAction.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["    ", "def", "__init__", "(", "self", ",", "entity", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "\"take\"", ",", "entity", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.TakeAction.apply": [[122, 130], ["player_loc.has_entity", "gv.kg.inventory.add_entity", "action.TakeAction.entity.add_attribute", "player_loc.del_entity", "gv.logger.warning"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.has_entity", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_entity", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_attribute", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.del_entity"], ["", "def", "apply", "(", "self", ")", ":", "\n", "        ", "player_loc", "=", "gv", ".", "kg", ".", "player_location", "\n", "if", "player_loc", ".", "has_entity", "(", "self", ".", "entity", ")", ":", "\n", "            ", "player_loc", ".", "del_entity", "(", "self", ".", "entity", ")", "\n", "", "else", ":", "\n", "            ", "gv", ".", "logger", ".", "warning", "(", "\"WARNING Took non-present entity {}\"", ".", "format", "(", "self", ".", "entity", ".", "name", ")", ")", "\n", "", "gv", ".", "kg", ".", "inventory", ".", "add_entity", "(", "self", ".", "entity", ")", "\n", "self", ".", "entity", ".", "add_attribute", "(", "gv", ".", "Portable", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.TakeAction.validate": [[131, 137], ["response_text.lower", "response_text.lower"], "methods", ["None"], ["", "def", "validate", "(", "self", ",", "response_text", ")", ":", "\n", "        ", "if", "'taken'", "in", "response_text", ".", "lower", "(", ")", "or", "'already'", "in", "response_text", ".", "lower", "(", ")", ":", "\n", "            ", "return", "1.", "\n", "", "else", ":", "\n", "            ", "return", "0.", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.TakeAllAction.__init__": [[140, 142], ["action.StandaloneAction.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "'take all'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.DropAction.__init__": [[145, 147], ["action.SingleAction.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["    ", "def", "__init__", "(", "self", ",", "entity", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "\"drop\"", ",", "entity", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.DropAction.apply": [[148, 153], ["gv.kg.inventory.remove", "gv.kg.player_location.add_entity", "action.DropAction.entity.add_attribute"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Inventory.remove", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_entity", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_attribute"], ["", "def", "apply", "(", "self", ")", ":", "\n", "        ", "assert", "self", ".", "entity", "in", "gv", ".", "kg", ".", "inventory", "\n", "gv", ".", "kg", ".", "inventory", ".", "remove", "(", "self", ".", "entity", ")", "\n", "gv", ".", "kg", ".", "player_location", ".", "add_entity", "(", "self", ".", "entity", ")", "\n", "self", ".", "entity", ".", "add_attribute", "(", "gv", ".", "Portable", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.DropAction.validate": [[154, 159], ["response_text.lower"], "methods", ["None"], ["", "def", "validate", "(", "self", ",", "response_text", ")", ":", "\n", "        ", "if", "'dropped'", "in", "response_text", ".", "lower", "(", ")", ":", "\n", "            ", "return", "1.", "\n", "", "else", ":", "\n", "            ", "return", "0.", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.OpenAction.__init__": [[162, 164], ["action.SingleAction.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["    ", "def", "__init__", "(", "self", ",", "entity", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "\"open\"", ",", "entity", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.OpenAction.apply": [[165, 168], ["action.OpenAction.entity.state.open", "action.OpenAction.entity.add_attribute"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.open", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_attribute"], ["", "def", "apply", "(", "self", ")", ":", "\n", "        ", "self", ".", "entity", ".", "state", ".", "open", "(", ")", "\n", "self", ".", "entity", ".", "add_attribute", "(", "gv", ".", "Openable", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.CloseAction.__init__": [[171, 173], ["action.SingleAction.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["    ", "def", "__init__", "(", "self", ",", "entity", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "\"close\"", ",", "entity", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.CloseAction.apply": [[174, 177], ["action.CloseAction.entity.state.close", "action.CloseAction.entity.add_attribute"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.close", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_attribute"], ["", "def", "apply", "(", "self", ")", ":", "\n", "        ", "self", ".", "entity", ".", "state", ".", "close", "(", ")", "\n", "self", ".", "entity", ".", "add_attribute", "(", "gv", ".", "Openable", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.LockAction.__init__": [[180, 182], ["action.SingleAction.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["    ", "def", "__init__", "(", "self", ",", "entity", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "\"lock\"", ",", "entity", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.LockAction.apply": [[183, 186], ["action.LockAction.entity.state.lock", "action.LockAction.entity.add_attribute"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.lock", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_attribute"], ["", "def", "apply", "(", "self", ")", ":", "\n", "        ", "self", ".", "entity", ".", "state", ".", "lock", "(", ")", "\n", "self", ".", "entity", ".", "add_attribute", "(", "gv", ".", "Lockable", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.LockWithAction.__init__": [[188, 190], ["action.DoubleAction.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["    ", "def", "__init__", "(", "self", ",", "entity1", ",", "entity2", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "\"lock\"", ",", "entity1", ",", "\"with\"", ",", "entity2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.LockWithAction.apply": [[191, 194], ["action.LockWithAction.entity1.state.lock", "action.LockWithAction.entity1.add_attribute"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.lock", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_attribute"], ["", "def", "apply", "(", "self", ")", ":", "\n", "        ", "self", ".", "entity1", ".", "state", ".", "lock", "(", ")", "\n", "self", ".", "entity1", ".", "add_attribute", "(", "gv", ".", "Lockable", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.UnlockAction.__init__": [[196, 198], ["action.SingleAction.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["    ", "def", "__init__", "(", "self", ",", "entity", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "\"unlock\"", ",", "entity", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.UnlockAction.apply": [[199, 202], ["action.UnlockAction.entity.state.unlock", "action.UnlockAction.entity.add_attribute"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.unlock", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_attribute"], ["", "def", "apply", "(", "self", ")", ":", "\n", "        ", "self", ".", "entity", ".", "state", ".", "unlock", "(", ")", "\n", "self", ".", "entity", ".", "add_attribute", "(", "gv", ".", "Lockable", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.UnlockWithAction.__init__": [[204, 206], ["action.DoubleAction.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["    ", "def", "__init__", "(", "self", ",", "entity1", ",", "entity2", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "\"unlock\"", ",", "entity1", ",", "\"with\"", ",", "entity2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.UnlockWithAction.apply": [[207, 210], ["action.UnlockWithAction.entity1.state.unlock", "action.UnlockWithAction.entity1.add_attribute"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.unlock", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_attribute"], ["", "def", "apply", "(", "self", ")", ":", "\n", "        ", "self", ".", "entity1", ".", "state", ".", "unlock", "(", ")", "\n", "self", ".", "entity1", ".", "add_attribute", "(", "gv", ".", "Lockable", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.TurnOnAction.__init__": [[212, 214], ["action.SingleAction.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["    ", "def", "__init__", "(", "self", ",", "entity", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "\"turn on\"", ",", "entity", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.TurnOnAction.apply": [[215, 218], ["action.TurnOnAction.entity.state.turn_on", "action.TurnOnAction.entity.add_attribute"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.turn_on", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_attribute"], ["", "def", "apply", "(", "self", ")", ":", "\n", "        ", "self", ".", "entity", ".", "state", ".", "turn_on", "(", ")", "\n", "self", ".", "entity", ".", "add_attribute", "(", "gv", ".", "Switchable", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.TurnOffAction.__init__": [[221, 223], ["action.SingleAction.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["    ", "def", "__init__", "(", "self", ",", "entity", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "\"turn off\"", ",", "entity", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.TurnOffAction.apply": [[224, 227], ["action.TurnOffAction.entity.state.turn_off", "action.TurnOffAction.entity.add_attribute"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.turn_off", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_attribute"], ["", "def", "apply", "(", "self", ")", ":", "\n", "        ", "self", ".", "entity", ".", "state", ".", "turn_off", "(", ")", "\n", "self", ".", "entity", ".", "add_attribute", "(", "gv", ".", "Switchable", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.ConsumeAction.__init__": [[231, 233], ["action.SingleAction.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "verb", ",", "entity", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "verb", ",", "entity", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.ConsumeAction.apply": [[234, 237], ["action.ConsumeAction.entity.state.remove", "action.ConsumeAction.entity.add_attribute"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Inventory.remove", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_attribute"], ["", "def", "apply", "(", "self", ")", ":", "\n", "        ", "self", ".", "entity", ".", "state", ".", "remove", "(", ")", "\n", "self", ".", "entity", ".", "add_attribute", "(", "gv", ".", "Edible", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.MoveItemAction.__init__": [[241, 243], ["action.DoubleAction.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "verb", ",", "entity1", ",", "prep", ",", "entity2", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "verb", ",", "entity1", ",", "prep", ",", "entity2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.MoveItemAction.apply": [[244, 248], ["None"], "methods", ["None"], ["", "def", "apply", "(", "self", ")", ":", "\n", "# TODO: Should entity contain a reference to its own container?", "\n", "# move_entity(self.entity1, source_container, self.entity2)", "\n", "        ", "pass", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.__init__": [[16, 24], ["entity.EntityState"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "name", ",", "location", ",", "description", "=", "''", ")", ":", "\n", "        ", "self", ".", "_names", "=", "[", "name", "]", "# List of names for the entity", "\n", "self", ".", "_description", "=", "description", "\n", "self", ".", "_action_records", "=", "{", "}", "# verb : (p_valid, result_text)", "\n", "self", ".", "_entities", "=", "[", "]", "\n", "self", ".", "_state", "=", "EntityState", "(", ")", "\n", "self", ".", "_attributes", "=", "[", "]", "\n", "self", ".", "_init_loc", "=", "location", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.name": [[29, 32], ["None"], "methods", ["None"], ["", "@", "name", ".", "setter", "\n", "def", "name", "(", "self", ",", "value", ")", ":", "\n", "        ", "self", ".", "_names", "[", "0", "]", "=", "value", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.names": [[33, 36], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "names", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_names", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.has_name": [[37, 39], ["None"], "methods", ["None"], ["", "def", "has_name", "(", "self", ",", "name", ")", ":", "\n", "        ", "return", "name", "in", "self", ".", "_names", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_name": [[40, 47], ["len", "len", "entity.Entity._names.insert", "entity.Entity._names.append", "new_name.split", "entity.Entity.name.split"], "methods", ["None"], ["", "def", "add_name", "(", "self", ",", "new_name", ")", ":", "\n", "        ", "if", "new_name", "in", "self", ".", "names", ":", "\n", "            ", "return", "\n", "", "if", "len", "(", "new_name", ".", "split", "(", "' '", ")", ")", "<", "len", "(", "self", ".", "name", ".", "split", "(", "' '", ")", ")", ":", "\n", "            ", "self", ".", "_names", ".", "insert", "(", "0", ",", "new_name", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "_names", ".", "append", "(", "new_name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.description": [[52, 55], ["None"], "methods", ["None"], ["", "@", "description", ".", "setter", "\n", "def", "description", "(", "self", ",", "value", ")", ":", "\n", "        ", "self", ".", "_description", "=", "value", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.action_records": [[56, 59], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "action_records", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_action_records", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_action_record": [[60, 69], ["gv.event_stream.push", "event.NewActionRecordEvent"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.EventStream.push"], ["", "def", "add_action_record", "(", "self", ",", "action", ",", "p_valid", ",", "result_text", ")", ":", "\n", "        ", "\"\"\"\n        Record an action that was applied to this object and the\n        resulting game text.\n\n        \"\"\"", "\n", "if", "action", "not", "in", "self", ".", "_action_records", "and", "p_valid", ">", ".5", ":", "\n", "            ", "gv", ".", "event_stream", ".", "push", "(", "event", ".", "NewActionRecordEvent", "(", "self", ",", "action", ",", "result_text", ")", ")", "\n", "", "self", ".", "_action_records", "[", "action", "]", "=", "(", "p_valid", ",", "result_text", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.has_action_record": [[70, 72], ["None"], "methods", ["None"], ["", "def", "has_action_record", "(", "self", ",", "action", ")", ":", "\n", "        ", "return", "action", "in", "self", ".", "_action_records", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_entity": [[73, 76], ["gv.event_stream.push", "entity.Entity._entities.append", "event.NewEntityEvent"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.EventStream.push"], ["", "def", "add_entity", "(", "self", ",", "entity", ")", ":", "\n", "        ", "gv", ".", "event_stream", ".", "push", "(", "event", ".", "NewEntityEvent", "(", "entity", ")", ")", "\n", "self", ".", "_entities", ".", "append", "(", "entity", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.del_entity": [[77, 79], ["entity.Entity._entities.remove"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Inventory.remove"], ["", "def", "del_entity", "(", "self", ",", "entity", ")", ":", "\n", "        ", "self", ".", "_entities", ".", "remove", "(", "entity", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.attributes": [[80, 83], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "attributes", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_failures", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_attribute": [[84, 88], ["gv.event_stream.push", "entity.Entity._attributes.append", "event.NewAttributeEvent"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.EventStream.push"], ["", "def", "add_attribute", "(", "self", ",", "attribute", ")", ":", "\n", "        ", "if", "attribute", "not", "in", "self", ".", "_attributes", ":", "\n", "            ", "gv", ".", "event_stream", ".", "push", "(", "event", ".", "NewAttributeEvent", "(", "self", ",", "attribute", ")", ")", "\n", "self", ".", "_attributes", ".", "append", "(", "attribute", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.state": [[89, 92], ["None"], "methods", ["None"], ["", "", "@", "property", "\n", "def", "state", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_state", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.reset": [[93, 102], ["entity.Entity.action_records.items", "to_remove.append"], "methods", ["None"], ["", "def", "reset", "(", "self", ")", ":", "\n", "        ", "\"\"\" Reset the entity to a state similar to when the game started. \"\"\"", "\n", "# Remove all successful action records", "\n", "to_remove", "=", "[", "]", "\n", "for", "action_record", ",", "(", "p_valid", ",", "result_text", ")", "in", "self", ".", "action_records", ".", "items", "(", ")", ":", "\n", "            ", "if", "p_valid", ">", ".5", ":", "\n", "                ", "to_remove", ".", "append", "(", "action_record", ")", "\n", "", "", "for", "action_record", "in", "to_remove", ":", "\n", "            ", "del", "self", ".", "action_records", "[", "action_record", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.to_string": [[103, 117], ["entity.Entity._action_records.items", "entity.to_string", "attribute.to_string", "util.clean"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.attribute.Attribute.to_string", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.attribute.Attribute.to_string", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.clean"], ["", "", "def", "to_string", "(", "self", ",", "prefix", "=", "''", ")", ":", "\n", "        ", "s", "=", "prefix", "+", "\"Entity: {}\"", ".", "format", "(", "self", ".", "name", ")", "\n", "if", "self", ".", "_action_records", ":", "\n", "            ", "for", "action", ",", "(", "p_valid", ",", "resp", ")", "in", "self", ".", "_action_records", ".", "items", "(", ")", ":", "\n", "                ", "if", "p_valid", ">", ".5", ":", "\n", "                    ", "s", "+=", "\"\\n  {}Action record: {} {} - {} (p={:.2f})\"", ".", "format", "(", "\n", "prefix", ",", "action", ",", "self", ".", "name", ",", "util", ".", "clean", "(", "resp", ")", "[", ":", "80", "]", ",", "p_valid", ")", "\n", "", "", "", "for", "entity", "in", "self", ".", "_entities", ":", "\n", "            ", "s", "+=", "\"\\n\"", "+", "prefix", "+", "entity", ".", "to_string", "(", "prefix", "+", "\"  \"", ")", "\n", "", "if", "self", ".", "_attributes", ":", "\n", "            ", "s", "+=", "\"\\n  \"", "+", "prefix", "+", "\"Attributes: \"", "\n", "for", "attribute", "in", "self", ".", "_attributes", ":", "\n", "                ", "s", "+=", "attribute", ".", "to_string", "(", ")", "+", "\" \"", "\n", "", "", "return", "s", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.__str__": [[118, 120], ["None"], "methods", ["None"], ["", "def", "__str__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "name", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.__repr__": [[121, 123], ["str"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "str", "(", "self", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.__init__": [[130, 132], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "exists", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.openable": [[133, 135], ["has_attr"], "methods", ["None"], ["", "def", "openable", "(", "self", ")", ":", "\n", "        ", "return", "has_attr", "(", "self", ",", "'is_open'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.open": [[136, 138], ["None"], "methods", ["None"], ["", "def", "open", "(", "self", ")", ":", "\n", "        ", "self", ".", "is_open", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.close": [[139, 141], ["None"], "methods", ["None"], ["", "def", "close", "(", "self", ")", ":", "\n", "        ", "self", ".", "is_open", "=", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.lockable": [[142, 144], ["has_attr"], "methods", ["None"], ["", "def", "lockable", "(", "self", ")", ":", "\n", "        ", "return", "has_attr", "(", "self", ",", "'is_locked'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.lock": [[145, 147], ["None"], "methods", ["None"], ["", "def", "lock", "(", "self", ")", ":", "\n", "        ", "self", ".", "is_locked", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.unlock": [[148, 150], ["None"], "methods", ["None"], ["", "def", "unlock", "(", "self", ")", ":", "\n", "        ", "self", ".", "is_locked", "=", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.switchable": [[151, 153], ["has_attr"], "methods", ["None"], ["", "def", "switchable", "(", "self", ")", ":", "\n", "        ", "return", "has_attr", "(", "self", ",", "'is_on'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.turn_on": [[154, 156], ["None"], "methods", ["None"], ["", "def", "turn_on", "(", "self", ")", ":", "\n", "        ", "self", ".", "is_on", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.turn_off": [[157, 159], ["None"], "methods", ["None"], ["", "def", "turn_off", "(", "self", ")", ":", "\n", "        ", "self", ".", "is_on", "=", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.remove": [[160, 162], ["None"], "methods", ["None"], ["", "def", "remove", "(", "self", ")", ":", "\n", "        ", "self", ".", "exists", "=", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.__str__": [[163, 165], ["None"], "methods", ["None"], ["", "def", "__str__", "(", "self", ")", ":", "\n", "        ", "pass", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.decision_module.DecisionModule.__init__": [[15, 19], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "_eagerness", "=", "0.", "\n", "self", ".", "_succ_cnt", "=", "0", "\n", "self", ".", "_fail_cnt", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.decision_module.DecisionModule.process_event_stream": [[20, 23], ["gv.event_stream.read", "decision_module.DecisionModule.process_event"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.EventStream.read", "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.process_event"], ["", "def", "process_event_stream", "(", "self", ")", ":", "\n", "        ", "for", "event", "in", "gv", ".", "event_stream", ".", "read", "(", ")", ":", "\n", "            ", "self", ".", "process_event", "(", "event", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.decision_module.DecisionModule.get_eagerness": [[25, 29], ["None"], "methods", ["None"], ["", "", "def", "get_eagerness", "(", "self", ")", ":", "\n", "        ", "\"\"\" Returns a float in [0,1] indicating how eager this module is to take\n        control. \"\"\"", "\n", "return", "self", ".", "_eagerness", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.decision_module.DecisionModule.record": [[31, 37], ["None"], "methods", ["None"], ["", "def", "record", "(", "self", ",", "action_successful", ")", ":", "\n", "        ", "\"\"\" Record whether an action succeeds or fails. \"\"\"", "\n", "if", "action_successful", ":", "\n", "            ", "self", ".", "_succ_cnt", "+=", "1", "\n", "", "else", ":", "\n", "            ", "self", ".", "_fail_cnt", "+=", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.decision_module.DecisionModule.get_success_percentage": [[39, 45], ["None"], "methods", ["None"], ["", "", "def", "get_success_percentage", "(", "self", ")", ":", "\n", "        ", "\"\"\" Returns the percentage of times the decision module is successful. \"\"\"", "\n", "try", ":", "\n", "            ", "return", "100.", "*", "self", ".", "_succ_cnt", "/", "(", "self", ".", "_succ_cnt", "+", "self", ".", "_fail_cnt", ")", "\n", "", "except", "ZeroDivisionError", ":", "\n", "            ", "return", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.decision_module.DecisionModule.process_event": [[47, 51], ["None"], "methods", ["None"], ["", "", "@", "abstractmethod", "\n", "def", "process_event", "(", "self", ",", "event", ")", ":", "\n", "        ", "\"\"\" Process an event from the event stream. \"\"\"", "\n", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.decision_module.DecisionModule.take_control": [[53, 57], ["None"], "methods", ["None"], ["", "@", "abstractmethod", "\n", "def", "take_control", "(", "self", ")", ":", "\n", "        ", "\"\"\" Generates a sequence of actions. \"\"\"", "\n", "pass", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.nail.NailAgent.__init__": [[20, 36], ["nail.NailAgent.setup_logging", "gv.rng.seed", "gv.dbg", "nail.NailAgent.knowledge_graph.__init__", "gv.event_stream.clear", "valid_detectors.learned_valid_detector.LearnedValidDetector", "decision_modules.Examiner", "decision_modules.Hoarder", "decision_modules.Navigator", "decision_modules.Interactor", "decision_modules.Idler", "decision_modules.YesNo", "decision_modules.YouHaveTo", "decision_modules.Darkness"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.nail.NailAgent.setup_logging", "home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.EventStream.clear"], ["def", "__init__", "(", "self", ",", "seed", ",", "env", ",", "rom_name", ",", "output_subdir", "=", "'.'", ")", ":", "\n", "        ", "self", ".", "setup_logging", "(", "rom_name", ",", "output_subdir", ")", "\n", "rng", ".", "seed", "(", "seed", ")", "\n", "dbg", "(", "\"RandomSeed: {}\"", ".", "format", "(", "seed", ")", ")", "\n", "self", ".", "knowledge_graph", "=", "gv", ".", "kg", "\n", "self", ".", "knowledge_graph", ".", "__init__", "(", ")", "# Re-initialize KnowledgeGraph", "\n", "gv", ".", "event_stream", ".", "clear", "(", ")", "\n", "self", ".", "modules", "=", "[", "Examiner", "(", "True", ")", ",", "Hoarder", "(", "True", ")", ",", "Navigator", "(", "True", ")", ",", "Interactor", "(", "True", ")", ",", "\n", "Idler", "(", "True", ")", ",", "YesNo", "(", "True", ")", ",", "YouHaveTo", "(", "True", ")", ",", "Darkness", "(", "True", ")", "]", "\n", "self", ".", "active_module", "=", "None", "\n", "self", ".", "action_generator", "=", "None", "\n", "self", ".", "first_step", "=", "True", "\n", "self", ".", "_valid_detector", "=", "LearnedValidDetector", "(", ")", "\n", "if", "env", "and", "rom_name", ":", "\n", "            ", "self", ".", "env", "=", "env", "\n", "self", ".", "step_num", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.nail.NailAgent.setup_logging": [[38, 52], ["os.path.join", "os.path.join", "os.path.join", "logging.basicConfig", "handler.close", "logging.root.removeHandler", "os.path.exists", "os.mkdir", "os.path.exists", "os.mkdir"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.close"], ["", "", "def", "setup_logging", "(", "self", ",", "rom_name", ",", "output_subdir", ")", ":", "\n", "        ", "\"\"\" Configure the logging facilities. \"\"\"", "\n", "for", "handler", "in", "logging", ".", "root", ".", "handlers", "[", ":", "]", ":", "\n", "            ", "handler", ".", "close", "(", ")", "\n", "logging", ".", "root", ".", "removeHandler", "(", "handler", ")", "\n", "", "self", ".", "logpath", "=", "os", ".", "path", ".", "join", "(", "output_subdir", ",", "'nail_logs'", ")", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "self", ".", "logpath", ")", ":", "\n", "            ", "os", ".", "mkdir", "(", "self", ".", "logpath", ")", "\n", "", "self", ".", "kgs_dir_path", "=", "os", ".", "path", ".", "join", "(", "output_subdir", ",", "'kgs'", ")", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "self", ".", "kgs_dir_path", ")", ":", "\n", "            ", "os", ".", "mkdir", "(", "self", ".", "kgs_dir_path", ")", "\n", "", "self", ".", "logpath", "=", "os", ".", "path", ".", "join", "(", "self", ".", "logpath", ",", "rom_name", ")", "\n", "logging", ".", "basicConfig", "(", "format", "=", "'%(message)s'", ",", "filename", "=", "self", ".", "logpath", "+", "'.log'", ",", "\n", "level", "=", "logging", ".", "DEBUG", ",", "filemode", "=", "'w'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.nail.NailAgent.elect_new_active_module": [[54, 66], ["gv.dbg", "nail.NailAgent.active_module.take_control", "nail.NailAgent.action_generator.send", "module.get_eagerness", "type"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.take_control", "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.get_eagerness"], ["", "def", "elect_new_active_module", "(", "self", ")", ":", "\n", "        ", "\"\"\" Selects the most eager module to take control. \"\"\"", "\n", "most_eager", "=", "0.", "\n", "for", "module", "in", "self", ".", "modules", ":", "\n", "            ", "eagerness", "=", "module", ".", "get_eagerness", "(", ")", "\n", "if", "eagerness", ">=", "most_eager", ":", "\n", "                ", "self", ".", "active_module", "=", "module", "\n", "most_eager", "=", "eagerness", "\n", "", "", "dbg", "(", "\"[NAIL](elect): {} Eagerness: {}\"", ".", "format", "(", "type", "(", "self", ".", "active_module", ")", ".", "__name__", ",", "most_eager", ")", ")", "\n", "self", ".", "action_generator", "=", "self", ".", "active_module", ".", "take_control", "(", ")", "\n", "self", ".", "action_generator", ".", "send", "(", "None", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.nail.NailAgent.generate_next_action": [[68, 81], ["nail.NailAgent.text", "nail.NailAgent.action_generator.send", "nail.NailAgent.consume_event_stream", "nail.NailAgent.elect_new_active_module"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.ExamineAction.text", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.nail.NailAgent.consume_event_stream", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.nail.NailAgent.elect_new_active_module"], ["", "def", "generate_next_action", "(", "self", ",", "observation", ")", ":", "\n", "        ", "\"\"\"Returns the action selected by the current active module and\n        selects a new active module if the current one is finished.\n\n        \"\"\"", "\n", "next_action", "=", "None", "\n", "while", "not", "next_action", ":", "\n", "            ", "try", ":", "\n", "                ", "next_action", "=", "self", ".", "action_generator", ".", "send", "(", "observation", ")", "\n", "", "except", "StopIteration", ":", "\n", "                ", "self", ".", "consume_event_stream", "(", ")", "\n", "self", ".", "elect_new_active_module", "(", ")", "\n", "", "", "return", "next_action", ".", "text", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.nail.NailAgent.consume_event_stream": [[83, 88], ["gv.event_stream.clear", "module.process_event_stream"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.EventStream.clear", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.decision_module.DecisionModule.process_event_stream"], ["", "def", "consume_event_stream", "(", "self", ")", ":", "\n", "        ", "\"\"\" Each module processes stored events then the stream is cleared. \"\"\"", "\n", "for", "module", "in", "self", ".", "modules", ":", "\n", "            ", "module", ".", "process_event_stream", "(", ")", "\n", "", "event_stream", ".", "clear", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.nail.NailAgent.take_action": [[90, 121], ["observation.strip.strip.strip", "nail.NailAgent.consume_event_stream", "nail.NailAgent.generate_next_action", "nail.NailAgent.env.get_player_location", "gv.dbg", "Location", "gv.kg.add_location", "nail.NailAgent.elect_new_active_module", "hasattr", "hasattr", "gv.dbg"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.nail.NailAgent.consume_event_stream", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.nail.NailAgent.generate_next_action", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.add_location", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.nail.NailAgent.elect_new_active_module"], ["", "def", "take_action", "(", "self", ",", "observation", ")", ":", "\n", "        ", "if", "self", ".", "env", ":", "\n", "# Add true locations to the .log file.", "\n", "            ", "loc", "=", "self", ".", "env", ".", "get_player_location", "(", ")", "\n", "if", "loc", "and", "hasattr", "(", "loc", ",", "'num'", ")", "and", "hasattr", "(", "loc", ",", "'name'", ")", "and", "loc", ".", "num", "and", "loc", ".", "name", ":", "\n", "                ", "dbg", "(", "\"[TRUE_LOC] {} \\\"{}\\\"\"", ".", "format", "(", "loc", ".", "num", ",", "loc", ".", "name", ")", ")", "\n", "\n", "# Output a snapshot of the kg.", "\n", "# with open(os.path.join(self.kgs_dir_path, str(self.step_num) + '.kng'), 'w') as f:", "\n", "#     f.write(str(self.knowledge_graph)+'\\n\\n')", "\n", "# self.step_num += 1", "\n", "\n", "", "", "observation", "=", "observation", ".", "strip", "(", ")", "\n", "if", "self", ".", "first_step", ":", "\n", "            ", "dbg", "(", "\"[NAIL] {}\"", ".", "format", "(", "observation", ")", ")", "\n", "self", ".", "first_step", "=", "False", "\n", "return", "'look'", "# Do a look to get rid of intro text", "\n", "\n", "", "if", "not", "kg", ".", "player_location", ":", "\n", "            ", "loc", "=", "Location", "(", "observation", ")", "\n", "kg", ".", "add_location", "(", "loc", ")", "\n", "kg", ".", "player_location", "=", "loc", "\n", "kg", ".", "_init_loc", "=", "loc", "\n", "\n", "", "self", ".", "consume_event_stream", "(", ")", "\n", "\n", "if", "not", "self", ".", "active_module", ":", "\n", "            ", "self", ".", "elect_new_active_module", "(", ")", "\n", "\n", "", "next_action", "=", "self", ".", "generate_next_action", "(", "observation", ")", "\n", "return", "next_action", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.nail.NailAgent.observe": [[123, 133], ["nail.NailAgent._valid_detector.action_valid", "gv.dbg", "gv.event_stream.push", "util.action_recognized", "gv.dbg", "event.NewTransitionEvent", "gv.kg.reset", "util.clean", "str", "module.get_eagerness"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.action_valid", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.EventStream.push", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.action_recognized", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.reset", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.clean", "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.get_eagerness"], ["", "def", "observe", "(", "self", ",", "obs", ",", "action", ",", "score", ",", "new_obs", ",", "terminal", ")", ":", "\n", "        ", "\"\"\" Observe will be used for learning from rewards. \"\"\"", "\n", "p_valid", "=", "self", ".", "_valid_detector", ".", "action_valid", "(", "action", ",", "new_obs", ")", "\n", "dbg", "(", "\"[VALID] p={:.3f} {}\"", ".", "format", "(", "p_valid", ",", "clean", "(", "new_obs", ")", ")", ")", "\n", "if", "kg", ".", "player_location", ":", "\n", "            ", "dbg", "(", "\"[EAGERNESS] {}\"", ".", "format", "(", "' '", ".", "join", "(", "[", "str", "(", "module", ".", "get_eagerness", "(", ")", ")", "for", "module", "in", "self", ".", "modules", "[", ":", "5", "]", "]", ")", ")", ")", "\n", "", "event_stream", ".", "push", "(", "NewTransitionEvent", "(", "obs", ",", "action", ",", "score", ",", "new_obs", ",", "terminal", ")", ")", "\n", "action_recognized", "(", "action", ",", "new_obs", ")", "# Update the unrecognized words", "\n", "if", "terminal", ":", "\n", "            ", "kg", ".", "reset", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.nail.NailAgent.finalize": [[135, 138], ["open", "f.write", "str"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.open"], ["", "", "def", "finalize", "(", "self", ")", ":", "\n", "        ", "with", "open", "(", "self", ".", "logpath", "+", "'.kng'", ",", "'w'", ")", "as", "f", ":", "\n", "            ", "f", ".", "write", "(", "str", "(", "self", ".", "knowledge_graph", ")", "+", "'\\n\\n'", ")", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity_detector.EntityDetector.__init__": [[9, 12], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "disallowed", "=", "[", "'i'", ",", "'you'", ",", "'it'", ",", "'north'", ",", "'south'", ",", "'east'", ",", "'west'", ",", "\n", "'northeast'", ",", "'northwest'", ",", "'southeast'", ",", "'southwest'", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity_detector.EntityDetector.detect": [[13, 16], ["NotImplementedError"], "methods", ["None"], ["", "@", "abstractmethod", "\n", "def", "detect", "(", "self", ",", "observation_text", ")", ":", "\n", "        ", "raise", "NotImplementedError", "(", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.__init__": [[12, 17], ["location.Location.extract_name"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.extract_name"], ["def", "__init__", "(", "self", ",", "description", "=", "''", ")", ":", "\n", "        ", "self", ".", "_name", "=", "self", ".", "extract_name", "(", "description", ")", "\n", "self", ".", "_description", "=", "description", "\n", "self", ".", "_entities", "=", "[", "]", "\n", "self", ".", "_action_records", "=", "{", "}", "# action : (p_valid, response)", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.name": [[18, 21], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "name", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_name", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.description": [[26, 29], ["None"], "methods", ["None"], ["", "@", "description", ".", "setter", "\n", "def", "description", "(", "self", ",", "value", ")", ":", "\n", "        ", "self", ".", "_description", "=", "value", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.extract_name": [[30, 37], ["description.strip", "description.strip.index"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "extract_name", "(", "description", ")", ":", "\n", "        ", "\"\"\" Extracts the name of a location from a description. \"\"\"", "\n", "stripped", "=", "description", ".", "strip", "(", ")", "\n", "if", "\"\\n\"", "in", "stripped", ":", "\n", "            ", "return", "stripped", "[", ":", "stripped", ".", "index", "(", "\"\\n\"", ")", "]", "\n", "", "return", "stripped", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.entities": [[38, 41], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "entities", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_entities", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_entity": [[42, 46], ["location.Location.has_entity_with_name", "gv.event_stream.push", "location.Location._entities.append", "event.NewEntityEvent"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.has_entity_with_name", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.EventStream.push"], ["", "def", "add_entity", "(", "self", ",", "entity", ")", ":", "\n", "        ", "if", "not", "self", ".", "has_entity_with_name", "(", "entity", ".", "name", ")", ":", "\n", "            ", "gv", ".", "event_stream", ".", "push", "(", "NewEntityEvent", "(", "entity", ")", ")", "\n", "self", ".", "_entities", ".", "append", "(", "entity", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.get_entity_by_name": [[47, 57], ["entity.has_name"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.has_name"], ["", "", "def", "get_entity_by_name", "(", "self", ",", "entity_name", ")", ":", "\n", "        ", "\"\"\"\n        Returns an entity with the given name if it exists at this\n        location or None if no such entity exists.\n\n        \"\"\"", "\n", "for", "entity", "in", "self", ".", "entities", ":", "\n", "            ", "if", "entity", ".", "has_name", "(", "entity_name", ")", ":", "\n", "                ", "return", "entity", "\n", "", "", "return", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.get_entity_by_description": [[58, 68], ["fuzzywuzzy.fuzz.partial_ratio"], "methods", ["None"], ["", "def", "get_entity_by_description", "(", "self", ",", "entity_description", ")", ":", "\n", "        ", "\"\"\"\n        Returns an entity with the given description if it exists at this\n        location or None if no such entity exists.\n\n        \"\"\"", "\n", "for", "entity", "in", "self", ".", "entities", ":", "\n", "            ", "if", "fuzz", ".", "partial_ratio", "(", "entity", ".", "description", ",", "entity_description", ")", ">", "95", ":", "\n", "                ", "return", "entity", "\n", "", "", "return", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.del_entity": [[69, 74], ["location.Location._entities.remove", "gv.logger.warning"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Inventory.remove"], ["", "def", "del_entity", "(", "self", ",", "entity", ")", ":", "\n", "        ", "if", "entity", "in", "self", ".", "_entities", ":", "\n", "            ", "self", ".", "_entities", ".", "remove", "(", "entity", ")", "\n", "", "else", ":", "\n", "            ", "gv", ".", "logger", ".", "warning", "(", "\"WARNING Location.del_entity could not find entity {}\"", ".", "format", "(", "entity", ".", "name", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.has_entity": [[75, 78], ["location.Location.has_entity_with_name", "location.Location.has_entity_with_description"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.has_entity_with_name", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.has_entity_with_description"], ["", "", "def", "has_entity", "(", "self", ",", "entity", ")", ":", "\n", "        ", "return", "self", ".", "has_entity_with_name", "(", "entity", ".", "name", ")", "or", "self", ".", "has_entity_with_description", "(", "entity", ".", "description", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.has_entity_with_name": [[79, 81], ["location.Location.get_entity_by_name"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.get_entity_by_name"], ["", "def", "has_entity_with_name", "(", "self", ",", "entity_name", ")", ":", "\n", "        ", "return", "self", ".", "get_entity_by_name", "(", "entity_name", ")", "is", "not", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.has_entity_with_description": [[82, 84], ["location.Location.get_entity_by_description"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.get_entity_by_description"], ["", "def", "has_entity_with_description", "(", "self", ",", "entity_description", ")", ":", "\n", "        ", "return", "self", ".", "get_entity_by_description", "(", "entity_description", ")", "is", "not", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.action_records": [[85, 88], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "action_records", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_action_records", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_action_record": [[89, 95], ["gv.event_stream.push", "isinstance", "ValueError", "event.NewActionRecordEvent", "type"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.EventStream.push"], ["", "def", "add_action_record", "(", "self", ",", "action", ",", "p_valid", ",", "result_text", ")", ":", "\n", "        ", "\"\"\" Records an action, the probability it succeeded, and the text response. \"\"\"", "\n", "if", "not", "isinstance", "(", "action", ",", "Action", ")", ":", "\n", "            ", "raise", "ValueError", "(", "\"Expected Action. Got {}\"", ".", "format", "(", "type", "(", "action", ")", ")", ")", "\n", "", "self", ".", "_action_records", "[", "action", "]", "=", "(", "p_valid", ",", "result_text", ")", "\n", "gv", ".", "event_stream", ".", "push", "(", "NewActionRecordEvent", "(", "self", ",", "action", ",", "result_text", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.has_action_record": [[96, 100], ["isinstance", "ValueError", "type"], "methods", ["None"], ["", "def", "has_action_record", "(", "self", ",", "action", ")", ":", "\n", "        ", "if", "not", "isinstance", "(", "action", ",", "Action", ")", ":", "\n", "            ", "raise", "ValueError", "(", "\"Expected Action. Got {}\"", ".", "format", "(", "type", "(", "action", ")", ")", ")", "\n", "", "return", "action", "in", "self", ".", "_action_records", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.get_action_record": [[101, 106], ["isinstance", "ValueError", "location.Location.has_action_record", "type"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.has_action_record"], ["", "def", "get_action_record", "(", "self", ",", "action", ")", ":", "\n", "        ", "\"\"\" Returns (p_valid, result_text) for an action or None if it doesn't exist. \"\"\"", "\n", "if", "not", "isinstance", "(", "action", ",", "Action", ")", ":", "\n", "            ", "raise", "ValueError", "(", "\"Expected Action. Got {}\"", ".", "format", "(", "type", "(", "action", ")", ")", ")", "\n", "", "return", "self", ".", "action_records", "[", "action", "]", "if", "self", ".", "has_action_record", "(", "action", ")", "else", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.reset": [[107, 120], ["entity.reset", "init_loc.add_entity", "to_remove.append", "location.Location.entities.remove"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.reset", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_entity", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Inventory.remove"], ["", "def", "reset", "(", "self", ")", ":", "\n", "        ", "\"\"\" Reset to a state resembling start of game. \"\"\"", "\n", "# Move all the entities back to their original locations", "\n", "to_remove", "=", "[", "]", "\n", "for", "entity", "in", "self", ".", "entities", ":", "\n", "            ", "entity", ".", "reset", "(", ")", "\n", "init_loc", "=", "entity", ".", "_init_loc", "\n", "if", "init_loc", "==", "self", ":", "\n", "                ", "continue", "\n", "", "init_loc", ".", "add_entity", "(", "entity", ")", "\n", "to_remove", ".", "append", "(", "entity", ")", "\n", "", "for", "entity", "in", "to_remove", ":", "\n", "            ", "self", ".", "entities", ".", "remove", "(", "entity", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.to_string": [[121, 126], ["entity.to_string"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.attribute.Attribute.to_string"], ["", "", "def", "to_string", "(", "self", ",", "prefix", "=", "''", ")", ":", "\n", "        ", "s", "=", "prefix", "+", "\"Location: {}\"", ".", "format", "(", "self", ".", "name", ")", "\n", "for", "entity", "in", "self", ".", "_entities", ":", "\n", "            ", "s", "+=", "\"\\n\"", "+", "entity", ".", "to_string", "(", "prefix", "+", "\"  \"", ")", "\n", "", "return", "s", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.__str__": [[127, 129], ["None"], "methods", ["None"], ["", "def", "__str__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "name", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.__repr__": [[130, 132], ["str"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "str", "(", "self", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Inventory.__init__": [[140, 143], ["location.Location.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "_name", "=", "'Inventory'", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Inventory.__iter__": [[144, 147], ["None"], "methods", ["None"], ["", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "self", ".", "_index", "=", "0", "\n", "return", "self", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Inventory.__next__": [[148, 154], ["len"], "methods", ["None"], ["", "def", "__next__", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "_index", "==", "len", "(", "self", ".", "entities", ")", ":", "\n", "            ", "raise", "StopIteration", "\n", "", "entity", "=", "self", ".", "entities", "[", "self", ".", "_index", "]", "\n", "self", ".", "_index", "+=", "1", "\n", "return", "entity", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Inventory.remove": [[155, 157], ["location.Inventory._entities.remove"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Inventory.remove"], ["", "def", "remove", "(", "self", ",", "entity", ")", ":", "\n", "        ", "self", ".", "_entities", ".", "remove", "(", "entity", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Inventory.__str__": [[158, 160], ["str"], "methods", ["None"], ["", "def", "__str__", "(", "self", ")", ":", "\n", "        ", "return", "\"Inventory: \"", "+", "str", "(", "', '", ".", "join", "(", "[", "item", ".", "name", "for", "item", "in", "self", ".", "entities", "]", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Inventory.__repr__": [[161, 163], ["str"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "str", "(", "self", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.first_sentence": [[7, 11], ["gv.nlp", "next().merge", "next"], "function", ["None"], ["def", "first_sentence", "(", "text", ")", ":", "\n", "    ", "\"\"\" Extracts the first sentence from text. \"\"\"", "\n", "tokens", "=", "gv", ".", "nlp", "(", "text", ")", "\n", "return", "next", "(", "tokens", ".", "sents", ")", ".", "merge", "(", ")", ".", "text", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.tokenize": [[13, 17], ["gv.nlp"], "function", ["None"], ["", "def", "tokenize", "(", "description", ")", ":", "\n", "    ", "\"\"\" Returns a list of tokens in a string. \"\"\"", "\n", "doc", "=", "gv", ".", "nlp", "(", "description", ")", "\n", "return", "[", "word", ".", "lower_", "for", "word", "in", "doc", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.clean": [[19, 22], ["s.replace().strip", "s.replace"], "function", ["None"], ["", "def", "clean", "(", "s", ")", ":", "\n", "    ", "\"\"\" Clean a string for compact output. \"\"\"", "\n", "return", "s", ".", "replace", "(", "'\\n'", ",", "' '", ")", ".", "strip", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.move_entity": [[24, 32], ["origin.has_entity", "origin.del_entity", "dest.add_entity", "gv.event_stream.push", "event.EntityMovedEvent"], "function", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.has_entity", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.del_entity", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_entity", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.EventStream.push"], ["", "def", "move_entity", "(", "entity", ",", "origin", ",", "dest", ")", ":", "\n", "    ", "\"\"\" Moves entity from origin to destination. \"\"\"", "\n", "assert", "origin", ".", "has_entity", "(", "entity", ")", ",", "\"Can't move entity {} that isn't present at origin {}\"", ".", "format", "(", "entity", ",", "origin", ")", "\n", "origin", ".", "del_entity", "(", "entity", ")", "\n", "dest", ".", "add_entity", "(", "entity", ")", "\n", "gv", ".", "event_stream", ".", "push", "(", "event", ".", "EntityMovedEvent", "(", "entity", ",", "origin", ",", "dest", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.get_unrecognized": [[51, 73], ["isinstance", "action.text.text", "p.match", "p.match.groups", "p.match.group", "action.text.split"], "function", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.ExamineAction.text", "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.you_have_to.YouHaveTo.match"], ["def", "get_unrecognized", "(", "action", ",", "response", ")", ":", "\n", "    ", "\"\"\"\n    Returns an unrecognized word based on the response or empty string.\n\n    Args:\n      action: The action that was taken\n      response: The textual response from the game\n\n    Returns: string containing the unrecognized word or\n    empty string if recognized.\n\n    \"\"\"", "\n", "if", "isinstance", "(", "action", ",", "Action", ")", ":", "\n", "        ", "action", "=", "action", ".", "text", "(", ")", "\n", "", "for", "p", "in", "COMPILED_REGEXPS", ":", "\n", "        ", "match", "=", "p", ".", "match", "(", "response", ")", "\n", "if", "match", ":", "\n", "            ", "if", "match", ".", "groups", "(", ")", ":", "\n", "                ", "return", "match", ".", "group", "(", "1", ")", "\n", "", "else", ":", "\n", "                ", "return", "action", ".", "split", "(", "' '", ")", "[", "0", "]", "\n", "", "", "", "return", "''", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.action_recognized": [[75, 89], ["util.get_unrecognized", "gv.dbg", "gv.kg._unrecognized_words.append"], "function", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.get_unrecognized"], ["", "def", "action_recognized", "(", "action", ",", "response", ")", ":", "\n", "    ", "\"\"\"\n    Returns True if the action was recognized based on the response.\n    Returns False if the action is not recognized and appends it to\n    the list of unrecognized_words.\n\n    \"\"\"", "\n", "unrecognized_word", "=", "get_unrecognized", "(", "action", ",", "response", ")", "\n", "if", "unrecognized_word", ":", "\n", "        ", "if", "unrecognized_word", "not", "in", "gv", ".", "kg", ".", "_unrecognized_words", ":", "\n", "            ", "gv", ".", "dbg", "(", "\"[UTIL] Added unrecognized word \\\"{}\\\"\"", ".", "format", "(", "unrecognized_word", ")", ")", "\n", "gv", ".", "kg", ".", "_unrecognized_words", ".", "append", "(", "unrecognized_word", ")", "\n", "", "return", "False", "\n", "", "return", "True", "\n", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.attribute.Attribute.__init__": [[7, 10], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "name", ",", "afforded_actions", ")", ":", "\n", "        ", "self", ".", "name", "=", "name", "\n", "self", ".", "afforded_actions", "=", "afforded_actions", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.attribute.Attribute.to_string": [[11, 13], ["None"], "methods", ["None"], ["", "def", "to_string", "(", "self", ",", "prefix", "=", "''", ")", ":", "\n", "        ", "return", "prefix", "+", "self", ".", "name", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.EventStream.__init__": [[9, 11], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "_stream", "=", "[", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.EventStream.push": [[12, 15], ["gv.dbg", "event.EventStream._stream.append", "type"], "methods", ["None"], ["", "def", "push", "(", "self", ",", "event", ")", ":", "\n", "        ", "gv", ".", "dbg", "(", "\"[LOG]({}) {}\"", ".", "format", "(", "type", "(", "event", ")", ".", "__name__", ",", "event", ".", "message", ")", ")", "\n", "self", ".", "_stream", ".", "append", "(", "event", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.EventStream.clear": [[16, 18], ["None"], "methods", ["None"], ["", "def", "clear", "(", "self", ")", ":", "\n", "        ", "del", "self", ".", "_stream", "[", ":", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.EventStream.read": [[19, 23], ["None"], "methods", ["None"], ["", "def", "read", "(", "self", ")", ":", "\n", "        ", "\"\"\" Iterate through the events in the stream. \"\"\"", "\n", "for", "event", "in", "self", ".", "_stream", ":", "\n", "            ", "yield", "event", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.Event.__init__": [[27, 29], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "message", ")", ":", "\n", "        ", "self", ".", "message", "=", "message", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.NewTransitionEvent.__init__": [[32, 40], ["event.Event.__init__", "util.clean"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.clean"], ["def", "__init__", "(", "self", ",", "obs", ",", "action", ",", "score", ",", "new_obs", ",", "terminal", ")", ":", "\n", "        ", "message", "=", "'\\\"{}\\\" --> {} Score={}'", ".", "format", "(", "action", ",", "util", ".", "clean", "(", "new_obs", ")", ",", "score", ")", "\n", "super", "(", ")", ".", "__init__", "(", "message", ")", "\n", "self", ".", "obs", "=", "obs", "\n", "self", ".", "action", "=", "action", "\n", "self", ".", "score", "=", "score", "\n", "self", ".", "new_obs", "=", "new_obs", "\n", "self", ".", "terminal", "=", "terminal", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.NewLocationEvent.__init__": [[43, 46], ["event.Event.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "new_location", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "new_location", ".", "name", ")", "\n", "self", ".", "new_location", "=", "new_location", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.NewEntityEvent.__init__": [[49, 53], ["event.Event.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "new_entity", ")", ":", "\n", "        ", "message", "=", "\"{}: {}\"", ".", "format", "(", "new_entity", ".", "name", ",", "new_entity", ".", "description", ")", "\n", "super", "(", ")", ".", "__init__", "(", "message", ")", "\n", "self", ".", "new_entity", "=", "new_entity", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.NewActionRecordEvent.__init__": [[56, 62], ["event.Event.__init__", "util.clean"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.clean"], ["def", "__init__", "(", "self", ",", "entity", ",", "action_record", ",", "result_text", ")", ":", "\n", "        ", "message", "=", "\"{} ==({})==> {}\"", ".", "format", "(", "entity", ",", "action_record", ",", "util", ".", "clean", "(", "result_text", ")", ")", "\n", "super", "(", ")", ".", "__init__", "(", "message", ")", "\n", "self", ".", "entity", "=", "entity", "\n", "self", ".", "action_record", "=", "action_record", "\n", "self", ".", "result_text", "=", "result_text", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.NewConnectionEvent.__init__": [[65, 69], ["event.Event.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "connection", ")", ":", "\n", "        ", "message", "=", "\"{} ==({})==> {}\"", ".", "format", "(", "connection", ".", "from_location", ",", "connection", ".", "action", ",", "connection", ".", "to_location", ")", "\n", "super", "(", ")", ".", "__init__", "(", "message", ")", "\n", "self", ".", "connection", "=", "connection", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.LocationChangedEvent.__init__": [[72, 75], ["event.Event.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "new_location", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "new_location", ".", "name", ")", "\n", "self", ".", "new_location", "=", "new_location", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.EntityMovedEvent.__init__": [[78, 83], ["event.Event.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "entity", ",", "origin", ",", "destination", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "\"EntityMoved\"", ")", "\n", "self", ".", "entity", "=", "entity", "\n", "self", ".", "origin", "=", "origin", "\n", "self", ".", "destination", "=", "destination", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.event.NewAttributeEvent.__init__": [[86, 90], ["event.Event.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "entity", ",", "new_attribute", ")", ":", "\n", "        ", "message", "=", "\"{} is {}\"", ".", "format", "(", "entity", ".", "name", ",", "new_attribute", ".", "name", ")", "\n", "super", "(", ")", ".", "__init__", "(", "message", ")", "\n", "self", ".", "new_attribute", "=", "new_attribute", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.valid_detector.ValidDetector.__init__": [[10, 12], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.valid_detector.ValidDetector.action_valid": [[14, 21], ["NotImplementedError"], "methods", ["None"], ["", "@", "abstractmethod", "\n", "def", "action_valid", "(", "self", ",", "action", ",", "response_text", ")", ":", "\n", "        ", "\"\"\"\n        Returns p(Valid), the probability that the action was valid.\n\n        \"\"\"", "\n", "raise", "NotImplementedError", "(", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.AffordableAttribute.__init__": [[32, 39], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "attribute_name", ",", "detection_verbs", ")", ":", "\n", "        ", "self", ".", "attribute_name", "=", "attribute_name", "\n", "self", ".", "detection_verbs", "=", "detection_verbs", "\n", "self", ".", "target_probs", "=", "[", "]", "\n", "self", ".", "known_actions_to_try", "=", "[", "]", "\n", "self", ".", "unknown_actions_to_exclude", "=", "[", "]", "\n", "self", ".", "known_action_extraction_threshold", "=", "0.15", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.__init__": [[46, 72], ["affordance_extractor.AffordanceExtractor.__init__", "CDLL", "lm_affordance_extractor.LmAffordanceExtractor.configure_ctypes", "lm_affordance_extractor.LmAffordanceExtractor.open_language_model", "lm_affordance_extractor.LmAffordanceExtractor.init_affordable_attributes", "lm_affordance_extractor.LmAffordanceExtractor.get_log_prob_calibration_thresholds", "lm_affordance_extractor.LmAffordanceExtractor.read_action_priors"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__", "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.configure_ctypes", "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.open_language_model", "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.init_affordable_attributes", "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.get_log_prob_calibration_thresholds", "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.read_action_priors"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "lib", "=", "CDLL", "(", "LM_READER_PATH", ")", "\n", "self", ".", "configure_ctypes", "(", "self", ".", "lib", ")", "\n", "self", ".", "forward_model", "=", "self", ".", "open_language_model", "(", "FORWARD_LM_PATH", ")", "\n", "self", ".", "affordable_attributes", "=", "[", "]", "\n", "self", ".", "affordable_attributes_by_name", "=", "{", "}", "\n", "self", ".", "attribute_probs", "=", "{", "}", "\n", "\n", "self", ".", "num_commands_to_return", "=", "30", "\n", "\n", "self", ".", "cached_unknown_actions", "=", "{", "}", "\n", "self", ".", "cached_extractions", "=", "{", "}", "\n", "\n", "self", ".", "init_affordable_attributes", "(", ")", "\n", "self", ".", "get_log_prob_calibration_thresholds", "(", ")", "\n", "self", ".", "unknown_action_extraction_threshold", "=", "0.4", "\n", "\n", "self", ".", "double_object_action_lp_offset", "=", "12.", "# Higher numbers give higher probs.", "\n", "self", ".", "double_object_action_lp_scale", "=", "2.0", "# Higher numbers give wider prob variance.", "\n", "self", ".", "double_object_action_extraction_threshold", "=", "0.05", "# Probably good to match the Idler's eagerness.", "\n", "self", ".", "cached_double_object_actions", "=", "{", "}", "\n", "\n", "self", ".", "action_prior_table", "=", "{", "}", "\n", "self", ".", "filtered_action_list", "=", "[", "]", "\n", "self", ".", "read_action_priors", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.__del__": [[73, 75], ["lm_affordance_extractor.LmAffordanceExtractor.lib.NgramTrieLM_Close"], "methods", ["None"], ["", "def", "__del__", "(", "self", ")", ":", "\n", "        ", "self", ".", "lib", ".", "NgramTrieLM_Close", "(", "self", ".", "forward_model", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.configure_ctypes": [[76, 85], ["None"], "methods", ["None"], ["", "def", "configure_ctypes", "(", "self", ",", "lib", ")", ":", "\n", "        ", "lib", ".", "NgramTrieLM_Open", ".", "argtypes", "=", "[", "c_char_p", ",", "c_int", ",", "c_int", "]", "\n", "lib", ".", "NgramTrieLM_Open", ".", "restype", "=", "c_void_p", "\n", "\n", "lib", ".", "NgramTrieLM_Close", ".", "argtypes", "=", "[", "c_void_p", "]", "\n", "lib", ".", "NgramTrieLM_Close", ".", "restype", "=", "None", "\n", "\n", "lib", ".", "NgramTrieLM_GetJointProb", ".", "argtypes", "=", "[", "c_void_p", ",", "c_char_p", ",", "c_int", "]", "\n", "lib", ".", "NgramTrieLM_GetJointProb", ".", "restype", "=", "c_uint", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.open_language_model": [[86, 91], ["lm_affordance_extractor.LmAffordanceExtractor.lib.NgramTrieLM_Open", "os.path.isfile", "print", "path.encode"], "methods", ["None"], ["", "def", "open_language_model", "(", "self", ",", "path", ")", ":", "\n", "        ", "if", "not", "os", ".", "path", ".", "isfile", "(", "path", "+", "'.utrie'", ")", ":", "\n", "            ", "print", "(", "\"Language model not found. Please follow the README steps to download it.\"", ")", "\n", "", "model", "=", "self", ".", "lib", ".", "NgramTrieLM_Open", "(", "path", ".", "encode", "(", "'utf-8'", ")", ",", "0", ",", "512", ")", "\n", "return", "model", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.get_joint_log_prob": [[92, 95], ["lm_affordance_extractor.LmAffordanceExtractor.lib.NgramTrieLM_GetJointProb", "string.encode"], "methods", ["None"], ["", "def", "get_joint_log_prob", "(", "self", ",", "model", ",", "string", ",", "order", ")", ":", "\n", "        ", "encoded_log_prob", "=", "self", ".", "lib", ".", "NgramTrieLM_GetJointProb", "(", "model", ",", "string", ".", "encode", "(", "'utf-8'", ")", ",", "order", ")", "\n", "return", "encoded_log_prob", "/", "-", "1000.", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.read_action_priors": [[96, 105], ["open", "open.close", "line[].split", "lm_affordance_extractor.LmAffordanceExtractor.filtered_action_list.append", "int"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.open", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.close"], ["", "def", "read_action_priors", "(", "self", ")", ":", "\n", "        ", "action_priors_file", "=", "open", "(", "ACTION_PRIORS_PATH", ",", "'r'", ")", "\n", "for", "line", "in", "action_priors_file", ":", "\n", "            ", "fields", "=", "line", "[", ":", "-", "1", "]", ".", "split", "(", "','", ")", "\n", "action_text", "=", "fields", "[", "0", "]", "\n", "prior", "=", "int", "(", "fields", "[", "1", "]", ")", "/", "8.", "\n", "self", ".", "action_prior_table", "[", "action_text", "]", "=", "prior", "\n", "self", ".", "filtered_action_list", ".", "append", "(", "action_text", ")", "\n", "", "action_priors_file", ".", "close", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.extract_single_object_actions": [[106, 147], ["lm_affordance_extractor.LmAffordanceExtractor.extract_unknown_actions_with_log_probs", "actions_to_try.sort", "id", "lm_affordance_extractor.LmAffordanceExtractor.estimate_attribute_prob", "lm_affordance_extractor.LmAffordanceExtractor.estimate_unknown_action_prob", "max", "id", "id", "actions_to_try.append", "unknown_actions_to_exclude.keys", "actions_to_try.append", "gv.rng.choice", "gv.rng.choice.", "action.SingleAction", "known_action"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.extract_unknown_actions_with_log_probs", "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.estimate_attribute_prob", "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.estimate_unknown_action_prob"], ["", "def", "extract_single_object_actions", "(", "self", ",", "entity", ")", ":", "\n", "        ", "if", "id", "(", "entity", ")", "in", "self", ".", "cached_extractions", ":", "\n", "            ", "return", "self", ".", "cached_extractions", "[", "id", "(", "entity", ")", "]", "\n", "\n", "# Collect known actions for the given entity.", "\n", "", "noun", "=", "entity", ".", "name", "\n", "actions_to_try", "=", "[", "]", "\n", "unknown_actions_to_exclude", "=", "{", "}", "\n", "for", "affordable_attribute", "in", "self", ".", "affordable_attributes", ":", "\n", "            ", "est_prob", "=", "self", ".", "estimate_attribute_prob", "(", "noun", ",", "affordable_attribute", ".", "attribute_name", ")", "\n", "if", "est_prob", ">=", "affordable_attribute", ".", "known_action_extraction_threshold", ":", "\n", "                ", "for", "known_action", "in", "affordable_attribute", ".", "known_actions_to_try", ":", "\n", "                    ", "actions_to_try", ".", "append", "(", "(", "known_action", "(", "entity", ")", ",", "est_prob", ")", ")", "\n", "", "for", "unknown_action", "in", "affordable_attribute", ".", "unknown_actions_to_exclude", ":", "\n", "                    ", "unknown_actions_to_exclude", "[", "unknown_action", "]", "=", "True", "\n", "\n", "# Collect unknown actions for the given entity.", "\n", "", "", "", "unknown_actions_to_try", "=", "self", ".", "extract_unknown_actions_with_log_probs", "(", "noun", ")", "\n", "\n", "for", "a_lp", "in", "unknown_actions_to_try", ":", "\n", "            ", "if", "a_lp", "[", "0", "]", "not", "in", "self", ".", "action_prior_table", ":", "\n", "                ", "self", ".", "action_prior_table", "[", "a_lp", "[", "0", "]", "]", "=", "-", "1.", "# Needs human review.", "\n", "\n", "", "", "for", "a_lp", "in", "unknown_actions_to_try", ":", "\n", "            ", "prob", "=", "self", ".", "estimate_unknown_action_prob", "(", "a_lp", "[", "1", "]", ")", "\n", "prob", "*=", "max", "(", "0.", ",", "self", ".", "action_prior_table", "[", "a_lp", "[", "0", "]", "]", ")", "# Treat unreviewed actions (-1) as 0.0", "\n", "if", "prob", ">", "self", ".", "unknown_action_extraction_threshold", ":", "\n", "                ", "action_text", "=", "a_lp", "[", "0", "]", "\n", "action_minus_the", "=", "action_text", "[", ":", "-", "4", "]", "\n", "if", "action_minus_the", "not", "in", "unknown_actions_to_exclude", ".", "keys", "(", ")", ":", "\n", "                    ", "if", "action_minus_the", "in", "self", ".", "unknown_actions_to_promote", ":", "\n", "                        ", "target_action", "=", "rng", ".", "choice", "(", "self", ".", "unknown_actions_to_promote", "[", "action_minus_the", "]", ")", "\n", "action_object", "=", "target_action", "(", "entity", ")", "\n", "", "else", ":", "\n", "                        ", "action_object", "=", "action", ".", "SingleAction", "(", "action_text", ",", "entity", ")", "\n", "", "actions_to_try", ".", "append", "(", "(", "action_object", ",", "prob", ")", ")", "\n", "\n", "# Sort by descending probability of expected value of taking the action.", "\n", "", "", "", "actions_to_try", ".", "sort", "(", "key", "=", "lambda", "tup", ":", "tup", "[", "1", "]", ",", "reverse", "=", "True", ")", "\n", "self", ".", "cached_extractions", "[", "id", "(", "entity", ")", "]", "=", "actions_to_try", "\n", "return", "actions_to_try", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.extract_double_object_actions": [[148, 172], ["sorted", "id", "id", "lm_affordance_extractor.LmAffordanceExtractor.get_joint_log_prob", "scored_actions.append", "action.DoubleAction", "math.exp", "min"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.get_joint_log_prob"], ["", "def", "extract_double_object_actions", "(", "self", ",", "entity1", ",", "entity2", ")", ":", "\n", "        ", "key", "=", "(", "id", "(", "entity1", ")", ",", "id", "(", "entity2", ")", ")", "\n", "if", "key", "in", "self", ".", "cached_double_object_actions", ":", "\n", "            ", "return", "self", ".", "cached_double_object_actions", "[", "key", "]", "\n", "\n", "", "action_prob_dict", "=", "{", "}", "\n", "num_actions", "=", "0", "\n", "tie_breaker", "=", "0.00000001", "\n", "for", "verb", ",", "prep", "in", "complex_verbs", ":", "\n", "            ", "phrase", "=", "verb", "+", "' the '", "+", "entity1", ".", "name", "+", "' '", "+", "prep", "+", "' the '", "+", "entity2", ".", "name", "\n", "log_prob", "=", "self", ".", "get_joint_log_prob", "(", "self", ".", "forward_model", ",", "phrase", ",", "5", ")", "\n", "num_actions", "+=", "1", "\n", "action_prob_dict", "[", "DoubleAction", "(", "verb", ",", "entity1", ",", "prep", ",", "entity2", ")", "]", "=", "log_prob", "+", "num_actions", "*", "tie_breaker", "\n", "\n", "", "sorted_actions", "=", "sorted", "(", "action_prob_dict", ",", "key", "=", "action_prob_dict", ".", "get", ",", "reverse", "=", "True", ")", "\n", "scored_actions", "=", "[", "]", "\n", "for", "action", "in", "sorted_actions", ":", "\n", "            ", "log_prob", "=", "action_prob_dict", "[", "action", "]", "\n", "prob", "=", "1.", "/", "(", "1.", "+", "math", ".", "exp", "(", "min", "(", "20.", ",", "-", "(", "log_prob", "+", "self", ".", "double_object_action_lp_offset", ")", "*", "self", ".", "double_object_action_lp_scale", ")", ")", ")", "\n", "if", "prob", ">", "self", ".", "double_object_action_extraction_threshold", ":", "\n", "                ", "scored_actions", ".", "append", "(", "(", "action", ",", "prob", ")", ")", "\n", "\n", "", "", "self", ".", "cached_double_object_actions", "[", "key", "]", "=", "scored_actions", "\n", "return", "scored_actions", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.estimate_attribute_prob": [[173, 194], ["lm_affordance_extractor.LmAffordanceExtractor.conditional_log_prob_of_attribute_given_noun", "lm_affordance_extractor.LmAffordanceExtractor.attribute_probs.keys"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.conditional_log_prob_of_attribute_given_noun"], ["", "def", "estimate_attribute_prob", "(", "self", ",", "entity_name", ",", "attribute_name", ")", ":", "\n", "        ", "combined_string", "=", "\"[{}][{}]\"", ".", "format", "(", "entity_name", ",", "attribute_name", ")", "\n", "if", "combined_string", "in", "self", ".", "attribute_probs", ".", "keys", "(", ")", ":", "\n", "            ", "return", "self", ".", "attribute_probs", "[", "combined_string", "]", "\n", "\n", "", "affordable_attribute", "=", "self", ".", "affordable_attributes_by_name", "[", "attribute_name", "]", "\n", "thresh_hi", "=", "affordable_attribute", ".", "thresholds", "[", "2", "]", "\n", "thresh_md", "=", "affordable_attribute", ".", "thresholds", "[", "1", "]", "\n", "thresh_lo", "=", "affordable_attribute", ".", "thresholds", "[", "0", "]", "\n", "log_prob", "=", "self", ".", "conditional_log_prob_of_attribute_given_noun", "(", "affordable_attribute", ".", "attribute_name", ",", "entity_name", ")", "\n", "if", "log_prob", ">=", "thresh_hi", ":", "\n", "            ", "est_prob", "=", "1.", "\n", "", "elif", "log_prob", "<=", "thresh_lo", ":", "\n", "            ", "est_prob", "=", "0.", "\n", "", "elif", "log_prob", ">=", "thresh_md", ":", "\n", "            ", "est_prob", "=", "0.5", "+", "0.5", "*", "(", "log_prob", "-", "thresh_md", ")", "/", "(", "thresh_hi", "-", "thresh_md", ")", "\n", "", "else", ":", "\n", "            ", "est_prob", "=", "0.5", "*", "(", "log_prob", "-", "thresh_lo", ")", "/", "(", "thresh_md", "-", "thresh_lo", ")", "\n", "\n", "", "self", ".", "attribute_probs", "[", "combined_string", "]", "=", "est_prob", "\n", "return", "est_prob", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.estimate_unknown_action_prob": [[195, 210], ["None"], "methods", ["None"], ["", "def", "estimate_unknown_action_prob", "(", "self", ",", "log_prob", ")", ":", "\n", "        ", "thresh_hi", "=", "self", ".", "unknown_action_calibration_thresholds", "[", "2", "]", "\n", "thresh_md", "=", "self", ".", "unknown_action_calibration_thresholds", "[", "1", "]", "\n", "thresh_lo", "=", "self", ".", "unknown_action_calibration_thresholds", "[", "0", "]", "\n", "\n", "if", "log_prob", ">=", "thresh_hi", ":", "\n", "            ", "est_prob", "=", "1.", "\n", "", "elif", "log_prob", "<=", "thresh_lo", ":", "\n", "            ", "est_prob", "=", "0.", "\n", "", "elif", "log_prob", ">=", "thresh_md", ":", "\n", "            ", "est_prob", "=", "0.5", "+", "0.5", "*", "(", "log_prob", "-", "thresh_md", ")", "/", "(", "thresh_hi", "-", "thresh_md", ")", "\n", "", "else", ":", "\n", "            ", "est_prob", "=", "0.5", "*", "(", "log_prob", "-", "thresh_lo", ")", "/", "(", "thresh_md", "-", "thresh_lo", ")", "\n", "\n", "", "return", "est_prob", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.conditional_log_prob_of_attribute_given_noun": [[211, 224], ["lm_affordance_extractor.LmAffordanceExtractor.get_joint_log_prob", "len", "lm_affordance_extractor.LmAffordanceExtractor.get_joint_log_prob"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.get_joint_log_prob", "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.get_joint_log_prob"], ["", "def", "conditional_log_prob_of_attribute_given_noun", "(", "self", ",", "attribute_name", ",", "noun", ")", ":", "\n", "        ", "affordable_attribute", "=", "self", ".", "affordable_attributes_by_name", "[", "attribute_name", "]", "\n", "overall_score", "=", "0.", "\n", "noun_phrase", "=", "'the '", "+", "noun", "\n", "log_prob_of_noun_phrase", "=", "self", ".", "get_joint_log_prob", "(", "self", ".", "forward_model", ",", "noun_phrase", ",", "5", ")", "\n", "for", "verb", "in", "affordable_attribute", ".", "detection_verbs", ":", "\n", "            ", "log_prob_of_verb_and_noun", "=", "self", ".", "get_joint_log_prob", "(", "self", ".", "forward_model", ",", "verb", "+", "' '", "+", "noun_phrase", ",", "5", ")", "\n", "score", "=", "log_prob_of_verb_and_noun", "-", "log_prob_of_noun_phrase", "# Conditional probability", "\n", "if", "score", ">", "0.", ":", "\n", "                ", "assert", "(", "score", "<=", "0.", ")", "\n", "", "overall_score", "+=", "score", "\n", "", "overall_score", "/=", "len", "(", "affordable_attribute", ".", "detection_verbs", ")", "\n", "return", "overall_score", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.calc_error_with_1_threshold": [[225, 233], ["None"], "methods", ["None"], ["", "def", "calc_error_with_1_threshold", "(", "self", ",", "score", ",", "threshold", ",", "i_noun", ",", "attrib", ")", ":", "\n", "        ", "if", "score", ">=", "threshold", ":", "\n", "            ", "est_prob", "=", "1.", "\n", "", "else", ":", "\n", "            ", "est_prob", "=", "0.", "\n", "", "target_prob", "=", "attrib", ".", "target_probs", "[", "i_noun", "]", "\n", "error", "=", "est_prob", "-", "target_prob", "\n", "return", "est_prob", ",", "target_prob", ",", "error", "*", "error", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.calc_error_with_3_thresholds": [[234, 246], ["None"], "methods", ["None"], ["", "def", "calc_error_with_3_thresholds", "(", "self", ",", "score", ",", "thresh_lo", ",", "thresh_md", ",", "thresh_hi", ",", "i_noun", ",", "attrib", ")", ":", "\n", "        ", "if", "score", ">=", "thresh_hi", ":", "\n", "            ", "est_prob", "=", "1.", "\n", "", "elif", "score", "<=", "thresh_lo", ":", "\n", "            ", "est_prob", "=", "0.", "\n", "", "elif", "score", ">=", "thresh_md", ":", "\n", "            ", "est_prob", "=", "0.5", "+", "0.5", "*", "(", "score", "-", "thresh_md", ")", "/", "(", "thresh_hi", "-", "thresh_md", ")", "\n", "", "else", ":", "\n", "            ", "est_prob", "=", "0.5", "*", "(", "score", "-", "thresh_lo", ")", "/", "(", "thresh_md", "-", "thresh_lo", ")", "\n", "", "target_prob", "=", "attrib", ".", "target_probs", "[", "i_noun", "]", "\n", "error", "=", "est_prob", "-", "target_prob", "\n", "return", "est_prob", ",", "target_prob", ",", "error", "*", "error", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.init_affordable_attributes": [[247, 306], ["open", "open.readlines", "open.close", "line[].split", "lm_affordance_extractor.AffordableAttribute", "lm_affordance_extractor.LmAffordanceExtractor.affordable_attributes.append"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.open", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.close"], ["", "def", "init_affordable_attributes", "(", "self", ")", ":", "\n", "# Create the affordable attributes, and load their detection verbs.", "\n", "        ", "attribute_detection_verbs", "=", "open", "(", "ATTR_DET_VERBS_PATH", ",", "encoding", "=", "'utf-8-sig'", ")", "\n", "lines", "=", "attribute_detection_verbs", ".", "readlines", "(", ")", "\n", "attribute_detection_verbs", ".", "close", "(", ")", "\n", "for", "line", "in", "lines", ":", "\n", "            ", "fields", "=", "line", "[", ":", "-", "1", "]", ".", "split", "(", "','", ")", "\n", "affordable_attribute", "=", "AffordableAttribute", "(", "fields", "[", "0", "]", ",", "fields", "[", "1", ":", "]", ")", "\n", "self", ".", "affordable_attributes", ".", "append", "(", "affordable_attribute", ")", "\n", "self", ".", "affordable_attributes_by_name", "[", "affordable_attribute", ".", "attribute_name", "]", "=", "affordable_attribute", "\n", "\n", "# Cache more attribute information.", "\n", "", "affordable_attribute", "=", "self", ".", "affordable_attributes_by_name", "[", "\"portable\"", "]", "\n", "affordable_attribute", ".", "known_actions_to_try", "=", "[", "Take", "]", "\n", "affordable_attribute", ".", "unknown_actions_to_exclude", "=", "[", "\"take\"", ",", "\"drop\"", ",", "\"give\"", ",", "\"put\"", ",", "\"place\"", ",", "\"set\"", ",", "\"get\"", ",", "\"leave\"", "]", "\n", "affordable_attribute", ".", "known_action_extraction_threshold", "=", "0.", "# LmAffordanceExtractor thinks everything should be taken.", "\n", "\n", "affordable_attribute", "=", "self", ".", "affordable_attributes_by_name", "[", "\"edible\"", "]", "\n", "affordable_attribute", ".", "known_actions_to_try", "=", "[", "Eat", ",", "Drink", "]", "\n", "affordable_attribute", ".", "unknown_actions_to_exclude", "=", "[", "\"eat\"", ",", "\"drink\"", ",", "\"swallow\"", ",", "\"consume\"", "]", "\n", "\n", "affordable_attribute", "=", "self", ".", "affordable_attributes_by_name", "[", "\"moveable\"", "]", "\n", "affordable_attribute", ".", "known_actions_to_try", "=", "[", "Move", ",", "Push", ",", "Pull", ",", "Lift", "]", "\n", "affordable_attribute", ".", "unknown_actions_to_exclude", "=", "[", "\"move\"", ",", "\"push\"", ",", "\"pull\"", ",", "\"drag\"", ",", "\"lift\"", "]", "\n", "\n", "affordable_attribute", "=", "self", ".", "affordable_attributes_by_name", "[", "\"switchable\"", "]", "\n", "affordable_attribute", ".", "known_actions_to_try", "=", "[", "TurnOn", "]", "\n", "affordable_attribute", ".", "unknown_actions_to_exclude", "=", "[", "\"turn on\"", ",", "\"switch on\"", ",", "\"turn off\"", ",", "\"switch off\"", ",", "\"start\"", ",", "\"stop\"", "]", "\n", "\n", "affordable_attribute", "=", "self", ".", "affordable_attributes_by_name", "[", "\"flammable\"", "]", "\n", "affordable_attribute", ".", "known_actions_to_try", "=", "[", "Light", "]", "\n", "affordable_attribute", ".", "unknown_actions_to_exclude", "=", "[", "\"light\"", ",", "\"ignite\"", ",", "\"extinguish\"", "]", "\n", "\n", "affordable_attribute", "=", "self", ".", "affordable_attributes_by_name", "[", "\"openable\"", "]", "\n", "affordable_attribute", ".", "known_actions_to_try", "=", "[", "Open", "]", "\n", "affordable_attribute", ".", "unknown_actions_to_exclude", "=", "[", "\"open\"", ",", "\"close\"", ",", "\"shut\"", "]", "\n", "\n", "affordable_attribute", "=", "self", ".", "affordable_attributes_by_name", "[", "\"lockable\"", "]", "\n", "affordable_attribute", ".", "known_actions_to_try", "=", "[", "Unlock", "]", "\n", "affordable_attribute", ".", "unknown_actions_to_exclude", "=", "[", "\"lock\"", ",", "\"unlock\"", "]", "\n", "\n", "affordable_attribute", "=", "self", ".", "affordable_attributes_by_name", "[", "\"container\"", "]", "\n", "affordable_attribute", ".", "known_actions_to_try", "=", "[", "Search", "]", "\n", "affordable_attribute", ".", "unknown_actions_to_exclude", "=", "[", "\"look in\"", ",", "\"search\"", ",", "\"search in\"", ",", "\"empty\"", ",", "\"fill\"", ",", "\"fill up\"", "]", "\n", "\n", "affordable_attribute", "=", "self", ".", "affordable_attributes_by_name", "[", "\"person\"", "]", "\n", "affordable_attribute", ".", "known_actions_to_try", "=", "[", "Talk", "]", "\n", "affordable_attribute", ".", "unknown_actions_to_exclude", "=", "[", "\"ask\"", ",", "\"talk to\"", ",", "\"help\"", ",", "\"hug\"", ",", "\"kiss\"", ",", "\"bribe\"", ",", "\"pay\"", "]", "\n", "\n", "affordable_attribute", "=", "self", ".", "affordable_attributes_by_name", "[", "\"enemy\"", "]", "\n", "affordable_attribute", ".", "known_actions_to_try", "=", "[", "Attack", ",", "Kill", "]", "\n", "affordable_attribute", ".", "unknown_actions_to_exclude", "=", "[", "\"attack\"", ",", "\"hit\"", ",", "\"kill\"", ",", "\"stab\"", ",", "\"slay\"", ",", "\"strangle\"", ",", "\"fight\"", ",", "\"strike\"", ",", "\"shoot\"", "]", "\n", "\n", "# Prepare the set of unknown actions to promote.", "\n", "self", ".", "unknown_actions_to_promote", "=", "{", "}", "\n", "for", "affordable_attribute", "in", "self", ".", "affordable_attributes", ":", "\n", "            ", "for", "unknown_action", "in", "affordable_attribute", ".", "unknown_actions_to_exclude", ":", "\n", "                ", "if", "unknown_action", "not", "in", "self", ".", "unknown_actions_to_promote", ":", "\n", "                    ", "self", ".", "unknown_actions_to_promote", "[", "unknown_action", "]", "=", "affordable_attribute", ".", "known_actions_to_try", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.get_log_prob_calibration_thresholds": [[307, 506], ["os.path.isfile", "print", "open", "open.write", "open", "open.readlines", "open.close", "open", "open.readlines", "open.close", "len", "range", "range", "range", "open.write", "open.close", "open", "open.readlines", "open.close", "line[].split", "target_nouns.append", "enumerate", "range", "range", "range", "range", "open.write", "line[].split", "int", "lm_affordance_extractor.LmAffordanceExtractor.extract_unknown_actions_with_log_probs", "print", "len", "lm_affordance_extractor.LmAffordanceExtractor.affordable_attributes[].target_probs.append", "len", "scores.append", "range", "len", "range", "len", "range", "len", "line[].split", "lm_affordance_extractor.LmAffordanceExtractor.conditional_log_prob_of_attribute_given_noun", "len", "lm_affordance_extractor.LmAffordanceExtractor.calc_error_with_1_threshold", "len", "lm_affordance_extractor.LmAffordanceExtractor.calc_error_with_3_thresholds", "len", "lm_affordance_extractor.LmAffordanceExtractor.calc_error_with_3_thresholds", "target_command_scores.keys", "max", "x_y_pairs.append", "float", "float", "float", "line[].split", "float", "float", "float", "int"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.open", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.open", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.close", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.open", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.close", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.close", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.open", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.EntityState.close", "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.extract_unknown_actions_with_log_probs", "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.conditional_log_prob_of_attribute_given_noun", "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.calc_error_with_1_threshold", "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.calc_error_with_3_thresholds", "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.calc_error_with_3_thresholds"], ["", "", "", "", "def", "get_log_prob_calibration_thresholds", "(", "self", ")", ":", "\n", "# Can previously computed thresholds be found?", "\n", "        ", "threshold_file_header", "=", "\"# Delete this line to recalculate the thresholds on the next run.\\n\"", "\n", "if", "os", ".", "path", ".", "isfile", "(", "CALIBRATION_THRESHOLDS_PATH", ")", ":", "\n", "            ", "thresholds_file", "=", "open", "(", "CALIBRATION_THRESHOLDS_PATH", ",", "'r'", ")", "\n", "lines", "=", "thresholds_file", ".", "readlines", "(", ")", "\n", "thresholds_file", ".", "close", "(", ")", "\n", "if", "len", "(", "lines", ")", ">", "0", ":", "\n", "                ", "if", "lines", "[", "0", "]", "==", "threshold_file_header", ":", "\n", "# Yes. Read them from the file.", "\n", "                    ", "line", "=", "lines", "[", "-", "1", "]", "\n", "fields", "=", "line", "[", ":", "-", "1", "]", ".", "split", "(", "'\\t'", ")", "\n", "assert", "fields", "[", "3", "]", "==", "\"unknown actions\"", "\n", "self", ".", "unknown_action_calibration_thresholds", "=", "(", "float", "(", "fields", "[", "0", "]", ")", ",", "float", "(", "fields", "[", "1", "]", ")", ",", "float", "(", "fields", "[", "2", "]", ")", ")", "\n", "for", "line", "in", "lines", "[", "1", ":", "-", "1", "]", ":", "\n", "                        ", "fields", "=", "line", "[", ":", "-", "1", "]", ".", "split", "(", "'\\t'", ")", "\n", "affordable_attribute", "=", "self", ".", "affordable_attributes_by_name", "[", "fields", "[", "3", "]", "]", "\n", "best_thresh_lo", "=", "float", "(", "fields", "[", "0", "]", ")", "\n", "best_thresh_md", "=", "float", "(", "fields", "[", "1", "]", ")", "\n", "best_thresh_hi", "=", "float", "(", "fields", "[", "2", "]", ")", "\n", "affordable_attribute", ".", "thresholds", "=", "(", "best_thresh_lo", ",", "best_thresh_md", ",", "best_thresh_hi", ")", "\n", "", "return", "\n", "\n", "# No, the thresholds cannot be found. So recompute them.", "\n", "", "", "", "print", "(", "\"Recomputing the log-prob calibration thesholds.\"", ")", "\n", "thresholds_file", "=", "open", "(", "CALIBRATION_THRESHOLDS_PATH", ",", "'w'", ")", "\n", "thresholds_file", ".", "write", "(", "threshold_file_header", ")", "\n", "\n", "# Load the target probs.", "\n", "target_nouns", "=", "[", "]", "\n", "target_attribute_scores", "=", "open", "(", "TARG_ATTR_SCORES_PATH", ",", "'r'", ")", "\n", "lines", "=", "target_attribute_scores", ".", "readlines", "(", ")", "\n", "target_attribute_scores", ".", "close", "(", ")", "\n", "for", "line", "in", "lines", "[", "1", ":", "]", ":", "\n", "            ", "fields", "=", "line", "[", ":", "-", "1", "]", ".", "split", "(", "','", ")", "\n", "target_nouns", ".", "append", "(", "fields", "[", "0", "]", ")", "\n", "scores", "=", "fields", "[", "1", ":", "]", "\n", "for", "i", ",", "score", "in", "enumerate", "(", "scores", ")", ":", "\n", "                ", "self", ".", "affordable_attributes", "[", "i", "]", ".", "target_probs", ".", "append", "(", "int", "(", "score", ")", "/", "8.", ")", "\n", "\n", "# Tune each attribute separately.", "\n", "", "", "mean_lowest_error", "=", "0.", "\n", "num_attributes_examined", "=", "0", "\n", "for", "affordable_attribute", "in", "self", ".", "affordable_attributes", ":", "\n", "# if attrib.name != \"enemy\":", "\n", "#     continue", "\n", "            ", "num_attributes_examined", "+=", "1", "\n", "scores", "=", "[", "]", "\n", "\n", "# Collect the raw scores for the target nouns.", "\n", "for", "i_noun", "in", "range", "(", "len", "(", "target_nouns", ")", ")", ":", "\n", "                ", "scores", ".", "append", "(", "self", ".", "conditional_log_prob_of_attribute_given_noun", "(", "affordable_attribute", ".", "attribute_name", ",", "target_nouns", "[", "i_noun", "]", ")", ")", "\n", "\n", "# Find the best middle threshold, for pinning to 0.5.", "\n", "", "lowest_error", "=", "100.", "\n", "best_thresh_md", "=", "-", "1", "\n", "for", "i_thresh", "in", "range", "(", "1000", ")", ":", "\n", "                ", "thresh", "=", "0.", "-", "i_thresh", "*", "0.01", "\n", "mean_squared_error", "=", "0.", "\n", "for", "i_noun", "in", "range", "(", "len", "(", "target_nouns", ")", ")", ":", "\n", "                    ", "est_prob", ",", "target_prob", ",", "squared_error", "=", "self", ".", "calc_error_with_1_threshold", "(", "scores", "[", "i_noun", "]", ",", "thresh", ",", "i_noun", ",", "affordable_attribute", ")", "\n", "mean_squared_error", "+=", "squared_error", "\n", "", "mean_squared_error", "/=", "len", "(", "target_nouns", ")", "\n", "if", "mean_squared_error", "<", "lowest_error", ":", "\n", "                    ", "lowest_error", "=", "mean_squared_error", "\n", "best_thresh_md", "=", "thresh", "\n", "\n", "", "", "lowest_error", "=", "100.", "\n", "best_thresh_hi", "=", "-", "1", "\n", "best_thresh_lo", "=", "-", "1", "\n", "thresh_lo", "=", "best_thresh_md", "\n", "thresh_md", "=", "best_thresh_md", "\n", "\n", "# Find the best hi threshold, for clipping to 1.", "\n", "for", "i", "in", "range", "(", "1000", ")", ":", "\n", "                ", "thresh_hi", "=", "thresh_md", "+", "i", "*", "0.01", "\n", "mean_squared_error", "=", "0.", "\n", "for", "i_noun", "in", "range", "(", "len", "(", "target_nouns", ")", ")", ":", "\n", "                    ", "est_prob", ",", "target_prob", ",", "squared_error", "=", "self", ".", "calc_error_with_3_thresholds", "(", "scores", "[", "i_noun", "]", ",", "thresh_lo", ",", "best_thresh_md", ",", "thresh_hi", ",", "i_noun", ",", "affordable_attribute", ")", "\n", "mean_squared_error", "+=", "squared_error", "\n", "", "mean_squared_error", "/=", "len", "(", "target_nouns", ")", "\n", "if", "mean_squared_error", "<", "lowest_error", ":", "\n", "                    ", "lowest_error", "=", "mean_squared_error", "\n", "best_thresh_hi", "=", "thresh_hi", "\n", "\n", "# Find the best lo threshold, for clipping to 0.", "\n", "", "", "for", "i", "in", "range", "(", "1000", ")", ":", "\n", "                ", "thresh_lo", "=", "thresh_md", "-", "i", "*", "0.01", "\n", "mean_squared_error", "=", "0.", "\n", "for", "i_noun", "in", "range", "(", "len", "(", "target_nouns", ")", ")", ":", "\n", "                    ", "est_prob", ",", "target_prob", ",", "squared_error", "=", "self", ".", "calc_error_with_3_thresholds", "(", "scores", "[", "i_noun", "]", ",", "thresh_lo", ",", "best_thresh_md", ",", "thresh_hi", ",", "i_noun", ",", "affordable_attribute", ")", "\n", "mean_squared_error", "+=", "squared_error", "\n", "", "mean_squared_error", "/=", "len", "(", "target_nouns", ")", "\n", "if", "mean_squared_error", "<", "lowest_error", ":", "\n", "                    ", "lowest_error", "=", "mean_squared_error", "\n", "best_thresh_lo", "=", "thresh_lo", "\n", "\n", "", "", "thresholds_file", ".", "write", "(", "\"{:7.3f}\\t{:7.3f}\\t{:7.3f}\\t{}\\n\"", ".", "format", "(", "best_thresh_lo", ",", "best_thresh_md", ",", "best_thresh_hi", ",", "affordable_attribute", ".", "attribute_name", ")", ")", "\n", "mean_lowest_error", "+=", "lowest_error", "\n", "affordable_attribute", ".", "thresholds", "=", "(", "best_thresh_lo", ",", "best_thresh_md", ",", "best_thresh_hi", ")", "\n", "\n", "# Now compute the calibration thresholds for unknown actions.", "\n", "\n", "# Load the target command scores. (The manual labels.)", "\n", "", "target_command_scores_file", "=", "open", "(", "TARG_CMD_SCORES_PATH", ",", "'r'", ")", "\n", "lines", "=", "target_command_scores_file", ".", "readlines", "(", ")", "\n", "target_command_scores_file", ".", "close", "(", ")", "\n", "target_command_scores", "=", "{", "}", "\n", "for", "line", "in", "lines", ":", "\n", "            ", "fields", "=", "line", "[", ":", "-", "1", "]", ".", "split", "(", "','", ")", "\n", "target_command_scores", "[", "fields", "[", "0", "]", "]", "=", "int", "(", "fields", "[", "1", "]", ")", "\n", "\n", "# Gather the numbers to be used for tuning.", "\n", "", "x_y_pairs", "=", "[", "]", "\n", "for", "noun", "in", "target_nouns", ":", "\n", "            ", "scored_actions", "=", "self", ".", "extract_unknown_actions_with_log_probs", "(", "noun", ")", "\n", "for", "scored_action", "in", "scored_actions", ":", "\n", "                ", "command", "=", "scored_action", "[", "0", "]", "+", "' '", "+", "noun", "\n", "if", "command", "in", "target_command_scores", ".", "keys", "(", ")", ":", "\n", "                    ", "lp", "=", "max", "(", "-", "25.0", ",", "scored_action", "[", "1", "]", ")", "\n", "prob_times_8", "=", "target_command_scores", "[", "command", "]", "\n", "x_y_pairs", ".", "append", "(", "(", "lp", ",", "prob_times_8", "/", "8.", ")", ")", "\n", "", "", "", "for", "x_y_pair", "in", "x_y_pairs", ":", "\n", "            ", "print", "(", "\"{}\\t{}\"", ".", "format", "(", "x_y_pair", "[", "0", "]", ",", "x_y_pair", "[", "1", "]", ")", ")", "\n", "\n", "# Find the best middle log-prob threshold, for pinning output probs to 0.5.", "\n", "", "lowest_error", "=", "100.", "\n", "best_thresh_md", "=", "-", "1", "\n", "num_pairs", "=", "len", "(", "x_y_pairs", ")", "\n", "for", "i_thresh", "in", "range", "(", "100", ")", ":", "\n", "            ", "thresh", "=", "0.", "-", "i_thresh", "*", "0.1", "\n", "mean_squared_error", "=", "0.", "\n", "for", "x_y_pair", "in", "x_y_pairs", ":", "\n", "                ", "x", "=", "x_y_pair", "[", "0", "]", "\n", "y", "=", "x_y_pair", "[", "1", "]", "\n", "if", "x", ">", "thresh", ":", "\n", "                    ", "y_est", "=", "1.", "\n", "", "else", ":", "\n", "                    ", "y_est", "=", "0.", "\n", "", "error", "=", "y_est", "-", "y", "\n", "squared_error", "=", "error", "*", "error", "\n", "mean_squared_error", "+=", "squared_error", "\n", "", "mean_squared_error", "/=", "num_pairs", "\n", "if", "mean_squared_error", "<", "lowest_error", ":", "\n", "                ", "lowest_error", "=", "mean_squared_error", "\n", "best_thresh_md", "=", "thresh", "\n", "\n", "# Find the best hi log-prob threshold, for clipping output probs to 1.", "\n", "", "", "lowest_error", "=", "100.", "\n", "best_thresh_hi", "=", "-", "1", "\n", "thresh_md", "=", "best_thresh_md", "\n", "for", "i", "in", "range", "(", "100", ")", ":", "\n", "            ", "thresh_hi", "=", "thresh_md", "+", "i", "*", "0.1", "\n", "mean_squared_error", "=", "0.", "\n", "count", "=", "0", "\n", "for", "x_y_pair", "in", "x_y_pairs", ":", "\n", "                ", "x", "=", "x_y_pair", "[", "0", "]", "\n", "y", "=", "x_y_pair", "[", "1", "]", "\n", "if", "x", ">", "thresh_md", ":", "\n", "                    ", "count", "+=", "1", "\n", "if", "x", ">=", "thresh_hi", ":", "\n", "                        ", "y_est", "=", "1.", "\n", "", "else", ":", "\n", "                        ", "y_est", "=", "0.5", "+", "0.5", "*", "(", "x", "-", "thresh_md", ")", "/", "(", "thresh_hi", "-", "thresh_md", ")", "\n", "", "error", "=", "y_est", "-", "y", "\n", "squared_error", "=", "error", "*", "error", "\n", "mean_squared_error", "+=", "squared_error", "\n", "", "", "mean_squared_error", "/=", "count", "\n", "if", "mean_squared_error", "<", "lowest_error", ":", "\n", "                ", "lowest_error", "=", "mean_squared_error", "\n", "best_thresh_hi", "=", "thresh_hi", "\n", "\n", "# Find the best lo log-prob threshold, for clipping output probs to 0.", "\n", "", "", "lowest_error", "=", "100.", "\n", "best_thresh_lo", "=", "-", "1", "\n", "for", "i", "in", "range", "(", "100", ")", ":", "\n", "            ", "thresh_lo", "=", "thresh_md", "-", "i", "*", "0.1", "\n", "mean_squared_error", "=", "0.", "\n", "count", "=", "0", "\n", "for", "x_y_pair", "in", "x_y_pairs", ":", "\n", "                ", "x", "=", "x_y_pair", "[", "0", "]", "\n", "y", "=", "x_y_pair", "[", "1", "]", "\n", "if", "x", "<", "thresh_md", ":", "\n", "                    ", "count", "+=", "1", "\n", "if", "x", ">=", "thresh_lo", ":", "\n", "                        ", "y_est", "=", "0.5", "*", "(", "x", "-", "thresh_lo", ")", "/", "(", "thresh_md", "-", "thresh_lo", ")", "\n", "", "else", ":", "\n", "                        ", "y_est", "=", "0.", "\n", "", "error", "=", "y_est", "-", "y", "\n", "squared_error", "=", "error", "*", "error", "\n", "mean_squared_error", "+=", "squared_error", "\n", "", "", "mean_squared_error", "/=", "count", "\n", "if", "mean_squared_error", "<", "lowest_error", ":", "\n", "                ", "lowest_error", "=", "mean_squared_error", "\n", "best_thresh_lo", "=", "thresh_lo", "\n", "\n", "", "", "self", ".", "unknown_action_calibration_thresholds", "=", "(", "best_thresh_lo", ",", "best_thresh_md", ",", "best_thresh_hi", ")", "\n", "thresholds_file", ".", "write", "(", "\"{:7.3f}\\t{:7.3f}\\t{:7.3f}\\tunknown actions\\n\"", ".", "format", "(", "best_thresh_lo", ",", "best_thresh_md", ",", "best_thresh_hi", ")", ")", "\n", "thresholds_file", ".", "close", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.extract_unknown_actions_with_log_probs": [[507, 534], ["lm_affordance_extractor.LmAffordanceExtractor.get_joint_log_prob", "sorted", "lm_affordance_extractor.LmAffordanceExtractor.cached_unknown_actions.keys", "lm_affordance_extractor.LmAffordanceExtractor.get_joint_log_prob", "scored_commands.append", "print", "forward_string.rjust"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.get_joint_log_prob", "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.get_joint_log_prob"], ["", "def", "extract_unknown_actions_with_log_probs", "(", "self", ",", "entity_text", ")", ":", "\n", "        ", "if", "entity_text", "in", "self", ".", "cached_unknown_actions", ".", "keys", "(", ")", ":", "\n", "            ", "return", "self", ".", "cached_unknown_actions", "[", "entity_text", "]", "\n", "\n", "", "noun_log_prob", "=", "self", ".", "get_joint_log_prob", "(", "self", ".", "forward_model", ",", "entity_text", ",", "5", ")", "\n", "verbose", "=", "False", "\n", "commands", "=", "{", "}", "\n", "num_commands", "=", "0", "\n", "tie_breaker", "=", "0.00000001", "\n", "\n", "for", "action_text", "in", "self", ".", "filtered_action_list", ":", "\n", "            ", "verb_noun_phrase", "=", "action_text", "+", "' '", "+", "entity_text", "\n", "joint_log_prob", "=", "self", ".", "get_joint_log_prob", "(", "self", ".", "forward_model", ",", "verb_noun_phrase", ",", "5", ")", "\n", "joint_log_prob", "-=", "noun_log_prob", "# Make the prob conditional on the noun.", "\n", "if", "not", "action_text", "in", "commands", ":", "\n", "                ", "commands", "[", "action_text", "]", "=", "joint_log_prob", "+", "num_commands", "*", "tie_breaker", "\n", "num_commands", "+=", "1", "\n", "if", "verbose", ":", "\n", "                    ", "print", "(", "\"{:8.3f}  Command  {}    {}    {}\"", ".", "format", "(", "joint_log_prob", ",", "forward_string", ".", "rjust", "(", "30", ")", ",", "tags", ",", "verb_noun_phrase", ")", ")", "\n", "\n", "", "", "", "sorted_commands", "=", "sorted", "(", "commands", ",", "key", "=", "commands", ".", "get", ",", "reverse", "=", "True", ")", "\n", "scored_commands", "=", "[", "]", "\n", "for", "command", "in", "sorted_commands", "[", ":", "self", ".", "num_commands_to_return", "]", ":", "\n", "            ", "scored_commands", ".", "append", "(", "(", "command", ",", "commands", "[", "command", "]", ")", ")", "\n", "\n", "", "self", ".", "cached_unknown_actions", "[", "entity_text", "]", "=", "scored_commands", "\n", "return", "scored_commands", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.you_have_to.YouHaveTo.__init__": [[15, 23], ["decision_module.DecisionModule.__init__", "valid_detectors.learned_valid_detector.LearnedValidDetector", "re.compile", "re.compile", "re.compile"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "active", "=", "False", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "_active", "=", "active", "\n", "self", ".", "_valid_detector", "=", "LearnedValidDetector", "(", ")", "\n", "self", ".", "regexps", "=", "[", "\n", "re", ".", "compile", "(", "\".*(Perhaps you should|You should|You'll have to|You'd better|You\\'re not going anywhere until you) (.*) first.*\"", ")", ",", "\n", "re", ".", "compile", "(", "\".*(You\\'re not going anywhere until you) (.*)\\..*\"", ")", ",", "\n", "re", ".", "compile", "(", "\".*(You need to) (.*) before.*\"", ")", "\n", "]", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.you_have_to.YouHaveTo.match": [[26, 33], ["regexp.match", "regexp.match.group"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.you_have_to.YouHaveTo.match"], ["", "def", "match", "(", "self", ",", "text", ")", ":", "\n", "        ", "\"\"\" Returns the matching text if a regexp matches or empty string. \"\"\"", "\n", "for", "regexp", "in", "self", ".", "regexps", ":", "\n", "            ", "match", "=", "regexp", ".", "match", "(", "text", ")", "\n", "if", "match", ":", "\n", "                ", "return", "match", ".", "group", "(", "2", ")", "\n", "", "", "return", "''", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.you_have_to.YouHaveTo.process_event": [[35, 45], ["type", "you_have_to.YouHaveTo.match", "action.StandaloneAction", "you_have_to.YouHaveTo.act_to_do.recognized"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.you_have_to.YouHaveTo.match", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.Action.recognized"], ["", "def", "process_event", "(", "self", ",", "event", ")", ":", "\n", "        ", "\"\"\" Process an event from the event stream. \"\"\"", "\n", "if", "not", "self", ".", "_active", ":", "\n", "            ", "return", "\n", "", "if", "type", "(", "event", ")", "is", "NewTransitionEvent", ":", "\n", "            ", "match", "=", "self", ".", "match", "(", "event", ".", "new_obs", ")", "\n", "if", "match", ":", "\n", "                ", "self", ".", "act_to_do", "=", "StandaloneAction", "(", "match", ")", "\n", "if", "self", ".", "act_to_do", ".", "recognized", "(", ")", ":", "\n", "                    ", "self", ".", "_eagerness", "=", "1.", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.you_have_to.YouHaveTo.take_control": [[47, 56], ["gv.dbg", "you_have_to.YouHaveTo._valid_detector.action_valid", "you_have_to.YouHaveTo.record", "util.first_sentence"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.action_valid", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.decision_module.DecisionModule.record", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.first_sentence"], ["", "", "", "", "def", "take_control", "(", "self", ")", ":", "\n", "        ", "\"\"\" Performs the previously extracted action \"\"\"", "\n", "obs", "=", "yield", "\n", "response", "=", "yield", "self", ".", "act_to_do", "\n", "dbg", "(", "\"[YouHaveTo] {} --> {}\"", ".", "format", "(", "self", ".", "act_to_do", ",", "response", ")", ")", "\n", "p_valid", "=", "self", ".", "_valid_detector", ".", "action_valid", "(", "self", ".", "act_to_do", ",", "first_sentence", "(", "response", ")", ")", "\n", "success", "=", "(", "p_valid", ">", "0.5", ")", "\n", "self", ".", "record", "(", "success", ")", "\n", "self", ".", "_eagerness", "=", "0.", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.darkness.Darkness.__init__": [[15, 20], ["decision_module.DecisionModule.__init__", "valid_detectors.learned_valid_detector.LearnedValidDetector"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "active", "=", "False", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "_active", "=", "active", "\n", "self", ".", "_valid_detector", "=", "LearnedValidDetector", "(", ")", "\n", "self", ".", "queries", "=", "[", "'pitch black'", ",", "'too dark to see'", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.darkness.Darkness.process_event": [[21, 28], ["type", "any"], "methods", ["None"], ["", "def", "process_event", "(", "self", ",", "event", ")", ":", "\n", "        ", "\"\"\" Process an event from the event stream. \"\"\"", "\n", "if", "not", "self", ".", "_active", ":", "\n", "            ", "return", "\n", "", "if", "type", "(", "event", ")", "is", "NewTransitionEvent", ":", "\n", "            ", "if", "any", "(", "query", "in", "event", ".", "new_obs", "for", "query", "in", "self", ".", "queries", ")", ":", "\n", "                ", "self", ".", "_eagerness", "=", "1.", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.darkness.Darkness.take_control": [[30, 39], ["action.StandaloneAction.StandaloneAction", "darkness.Darkness._valid_detector.action_valid", "darkness.Darkness.record", "util.first_sentence"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.action_valid", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.decision_module.DecisionModule.record", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.first_sentence"], ["", "", "", "def", "take_control", "(", "self", ")", ":", "\n", "        ", "\"\"\" Performs the previously extracted action \"\"\"", "\n", "obs", "=", "yield", "\n", "action", "=", "StandaloneAction", "(", "'turn on'", ")", "\n", "response", "=", "yield", "action", "\n", "p_valid", "=", "self", ".", "_valid_detector", ".", "action_valid", "(", "action", ",", "first_sentence", "(", "response", ")", ")", "\n", "success", "=", "(", "p_valid", ">", "0.5", ")", "\n", "self", ".", "record", "(", "success", ")", "\n", "self", ".", "_eagerness", "=", "0.", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.restart.Restart.__init__": [[13, 16], ["decision_module.DecisionModule.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "active", "=", "False", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "_active", "=", "active", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.restart.Restart.process_event": [[18, 29], ["type"], "methods", ["None"], ["", "def", "process_event", "(", "self", ",", "event", ")", ":", "\n", "        ", "\"\"\" Process an event from the event stream. \"\"\"", "\n", "if", "not", "self", ".", "_active", ":", "\n", "            ", "return", "\n", "", "if", "type", "(", "event", ")", "is", "NewTransitionEvent", ":", "\n", "            ", "if", "'RESTART'", "in", "event", ".", "new_obs", "and", "'RESTORE'", "in", "event", ".", "new_obs", "and", "'QUIT'", "in", "event", ".", "new_obs", ":", "\n", "                ", "self", ".", "_eagerness", "=", "1.", "\n", "", "if", "'You have died'", "in", "event", ".", "new_obs", ":", "\n", "                ", "self", ".", "_eagerness", "=", "1.", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.restart.Restart.take_control": [[31, 39], ["gv.dbg", "action.StandaloneAction.StandaloneAction", "gv.kg.reset"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.reset"], ["", "", "", "def", "take_control", "(", "self", ")", ":", "\n", "        ", "\"\"\" Performs the previously extracted action \"\"\"", "\n", "obs", "=", "yield", "\n", "dbg", "(", "\"[RESTART] Restarting Game\"", ")", "\n", "action", "=", "StandaloneAction", "(", "\"IEEECIG-ADVENT-RESTART-COMMAND\"", ")", "\n", "response", "=", "yield", "action", "\n", "kg", ".", "reset", "(", ")", "\n", "self", ".", "_eagerness", "=", "0.", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.interactor.Interactor.__init__": [[18, 26], ["decision_module.DecisionModule.__init__", "valid_detectors.learned_valid_detector.LearnedValidDetector", "affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "active", "=", "False", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "_active", "=", "active", "\n", "self", ".", "_valid_detector", "=", "LearnedValidDetector", "(", ")", "\n", "self", ".", "_affordance_extractor", "=", "LmAffordanceExtractor", "(", ")", "\n", "self", ".", "best_action", "=", "None", "\n", "self", ".", "_eagerness", "=", "0.", "\n", "self", ".", "actions_that_caused_death", "=", "{", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.interactor.Interactor.process_event": [[27, 29], ["None"], "methods", ["None"], ["", "def", "process_event", "(", "self", ",", "event", ")", ":", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.interactor.Interactor.get_eagerness": [[30, 68], ["interactor.Interactor._affordance_extractor.extract_single_object_actions", "entity.has_action_record", "interactor.Interactor._affordance_extractor.extract_double_object_actions", "action.recognized", "entity1.has_action_record", "action.recognized"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.extract_single_object_actions", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.has_action_record", "home.repos.pwc.inspect_result.Microsoft_nail_agent.affordance_extractors.lm_affordance_extractor.LmAffordanceExtractor.extract_double_object_actions", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.Action.recognized", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.has_action_record", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.Action.recognized"], ["", "def", "get_eagerness", "(", "self", ")", ":", "\n", "        ", "if", "not", "self", ".", "_active", ":", "\n", "            ", "return", "0.", "\n", "", "self", ".", "best_action", "=", "None", "\n", "self", ".", "_eagerness", "=", "0.", "\n", "max_eagerness", "=", "0.", "\n", "\n", "# Consider single-object actions.", "\n", "for", "entity", "in", "kg", ".", "player_location", ".", "entities", "+", "kg", ".", "inventory", ".", "entities", ":", "\n", "            ", "for", "action", ",", "prob", "in", "self", ".", "_affordance_extractor", ".", "extract_single_object_actions", "(", "entity", ")", ":", "\n", "                ", "if", "prob", "<=", "max_eagerness", ":", "\n", "                    ", "break", "\n", "", "if", "entity", ".", "has_action_record", "(", "action", ")", "or", "(", "not", "action", ".", "recognized", "(", ")", ")", "or", "(", "action", "in", "self", ".", "actions_that_caused_death", ")", "or", "(", "(", "action", ".", "verb", "==", "'take'", ")", "and", "(", "entity", "in", "kg", ".", "inventory", ".", "entities", ")", ")", ":", "# Need to promote to Take.", "\n", "                    ", "continue", "\n", "", "max_eagerness", "=", "prob", "\n", "self", ".", "best_action", "=", "action", "\n", "break", "\n", "\n", "# Consider double-object actions.", "\n", "", "", "for", "entity1", "in", "kg", ".", "player_location", ".", "entities", "+", "kg", ".", "inventory", ".", "entities", ":", "\n", "            ", "for", "entity2", "in", "kg", ".", "player_location", ".", "entities", "+", "kg", ".", "inventory", ".", "entities", ":", "\n", "                ", "if", "entity1", "!=", "entity2", ":", "\n", "                    ", "for", "action", ",", "prob", "in", "self", ".", "_affordance_extractor", ".", "extract_double_object_actions", "(", "entity1", ",", "entity2", ")", ":", "\n", "                        ", "if", "prob", "<=", "max_eagerness", ":", "\n", "                            ", "break", "\n", "", "if", "entity1", ".", "has_action_record", "(", "action", ")", "or", "(", "not", "action", ".", "recognized", "(", ")", ")", "or", "(", "action", "in", "self", ".", "actions_that_caused_death", ")", ":", "\n", "                            ", "continue", "\n", "", "max_eagerness", "=", "prob", "\n", "self", ".", "best_action", "=", "action", "\n", "break", "\n", "\n", "", "", "", "", "self", ".", "_eagerness", "=", "max_eagerness", "\n", "return", "self", ".", "_eagerness", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.interactor.Interactor.take_control": [[69, 100], ["action.validate", "isinstance", "interactor.Interactor.record", "gv.dbg", "interactor.Interactor.get_eagerness", "interactor.Interactor._valid_detector.action_valid", "action.entity.add_action_record", "isinstance", "action.apply", "util.first_sentence", "action.entity1.add_action_record"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.DropAction.validate", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.decision_module.DecisionModule.record", "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.get_eagerness", "home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.action_valid", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_action_record", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.MoveItemAction.apply", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.first_sentence", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_action_record"], ["", "def", "take_control", "(", "self", ")", ":", "\n", "        ", "obs", "=", "yield", "\n", "\n", "# Failsafe checks", "\n", "if", "self", ".", "_eagerness", "==", "0.", ":", "# Should never happen anyway.", "\n", "            ", "self", ".", "get_eagerness", "(", ")", "# But if it does, try finding a best action.", "\n", "if", "self", ".", "_eagerness", "==", "0.", ":", "\n", "                ", "return", "# If no good action can be found, simply return without yielding.", "\n", "\n", "", "", "action", "=", "self", ".", "best_action", "\n", "self", ".", "best_action", "=", "None", "\n", "self", ".", "_eagerness", "=", "0.", "\n", "\n", "response", "=", "yield", "action", "\n", "p_valid", "=", "action", ".", "validate", "(", "response", ")", "\n", "if", "p_valid", "is", "None", ":", "\n", "            ", "p_valid", "=", "self", ".", "_valid_detector", ".", "action_valid", "(", "action", ",", "first_sentence", "(", "response", ")", ")", "\n", "", "if", "isinstance", "(", "action", ",", "SingleAction", ")", ":", "\n", "            ", "action", ".", "entity", ".", "add_action_record", "(", "action", ",", "p_valid", ",", "response", ")", "\n", "", "elif", "isinstance", "(", "action", ",", "DoubleAction", ")", ":", "\n", "            ", "action", ".", "entity1", ".", "add_action_record", "(", "action", ",", "p_valid", ",", "response", ")", "\n", "", "success", "=", "(", "p_valid", ">", "0.5", ")", "\n", "self", ".", "record", "(", "success", ")", "\n", "if", "success", ":", "\n", "            ", "action", ".", "apply", "(", ")", "\n", "", "dbg", "(", "\"[INT]({}) p={:.2f} {} --> {}\"", ".", "format", "(", "\n", "\"val\"", "if", "success", "else", "\"inv\"", ",", "p_valid", ",", "action", ",", "response", ")", ")", "\n", "\n", "if", "(", "'RESTART'", "in", "response", "and", "'RESTORE'", "in", "response", "and", "'QUIT'", "in", "response", ")", "or", "(", "'You have died'", "in", "response", ")", ":", "\n", "            ", "if", "action", "not", "in", "self", ".", "actions_that_caused_death", ":", "\n", "                ", "self", ".", "actions_that_caused_death", "[", "action", "]", "=", "True", "# Remember actions that cause death.", "\n", "", "", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.yes_no.YesNo.__init__": [[14, 21], ["decision_module.DecisionModule.__init__", "valid_detectors.learned_valid_detector.LearnedValidDetector"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "active", "=", "False", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "_active", "=", "active", "\n", "self", ".", "_valid_detector", "=", "LearnedValidDetector", "(", ")", "\n", "self", ".", "query1", "=", "\"yes or n\"", "\n", "self", ".", "query2", "=", "\"y/n\"", "\n", "self", ".", "query3", "=", "\"(y or n)\"", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.yes_no.YesNo.process_event": [[22, 32], ["type", "event.new_obs.lower"], "methods", ["None"], ["", "def", "process_event", "(", "self", ",", "event", ")", ":", "\n", "        ", "\"\"\" Process an event from the event stream. \"\"\"", "\n", "if", "not", "self", ".", "_active", ":", "\n", "            ", "return", "\n", "", "if", "type", "(", "event", ")", "is", "NewTransitionEvent", ":", "\n", "            ", "obs", "=", "event", ".", "new_obs", ".", "lower", "(", ")", "\n", "if", "(", "self", ".", "query1", "in", "obs", ")", "or", "(", "self", ".", "query2", "in", "obs", ")", "or", "(", "self", ".", "query3", "in", "obs", ")", ":", "\n", "                ", "self", ".", "_eagerness", "=", "1.", "\n", "", "else", ":", "\n", "                ", "self", ".", "_eagerness", "=", "0.", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.yes_no.YesNo.take_control": [[34, 43], ["gv.rng.choice", "yes_no.YesNo._valid_detector.action_valid", "yes_no.YesNo.record", "util.first_sentence"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.action_valid", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.decision_module.DecisionModule.record", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.first_sentence"], ["", "", "", "def", "take_control", "(", "self", ")", ":", "\n", "        ", "\"\"\" Always answers yes \"\"\"", "\n", "obs", "=", "yield", "\n", "action", "=", "rng", ".", "choice", "(", "[", "Yes", ",", "No", "]", ")", "\n", "response", "=", "yield", "action", "\n", "p_valid", "=", "self", ".", "_valid_detector", ".", "action_valid", "(", "action", ",", "first_sentence", "(", "response", ")", ")", "\n", "success", "=", "(", "p_valid", ">", "0.5", ")", "\n", "self", ".", "record", "(", "success", ")", "\n", "self", ".", "_eagerness", "=", "0.", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.hoarder.Hoarder.__init__": [[12, 15], ["decision_module.DecisionModule.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "active", "=", "False", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "_active", "=", "active", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.hoarder.Hoarder.process_event": [[17, 22], ["gv.TakeAll.recognized", "type"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.Action.recognized"], ["", "def", "process_event", "(", "self", ",", "event", ")", ":", "\n", "        ", "if", "not", "self", ".", "_active", ":", "\n", "            ", "return", "\n", "", "if", "type", "(", "event", ")", "is", "NewLocationEvent", "and", "gv", ".", "TakeAll", ".", "recognized", "(", ")", ":", "\n", "            ", "self", ".", "_eagerness", "=", "1.", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.hoarder.Hoarder.parse_response": [[24, 51], ["response.splitlines", "hoarder.Hoarder.record", "line.strip.strip.strip", "here.has_entity_with_name", "gv.Take", "gv.Take.validate", "gv.dbg", "Entity.add_action_record", "w.strip", "entity_name.split", "here.get_entity_by_name", "gv.kg.inventory.has_entity_with_name", "gv.Take.apply", "line.strip.strip.split", "gv.kg.inventory.get_entity_by_name", "Entity", "Entity.add_name", "here.add_entity"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.decision_module.DecisionModule.record", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.has_entity_with_name", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.DropAction.validate", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_action_record", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.get_entity_by_name", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.has_entity_with_name", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.MoveItemAction.apply", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.get_entity_by_name", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_name", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_entity"], ["", "", "def", "parse_response", "(", "self", ",", "response", ")", ":", "\n", "        ", "here", "=", "gv", ".", "kg", ".", "player_location", "\n", "success", "=", "False", "\n", "for", "line", "in", "response", ".", "splitlines", "(", ")", ":", "\n", "            ", "line", "=", "line", ".", "strip", "(", ")", "\n", "if", "':'", "in", "line", ":", "\n", "                ", "success", "=", "True", "\n", "# Example - small mailbox: It's securly anchored.", "\n", "entity_name", ",", "resp", "=", "[", "w", ".", "strip", "(", ")", "for", "w", "in", "line", ".", "split", "(", "':'", ",", "1", ")", "]", "\n", "short_name", "=", "entity_name", ".", "split", "(", "' '", ")", "[", "-", "1", "]", "\n", "if", "here", ".", "has_entity_with_name", "(", "entity_name", ")", ":", "\n", "                    ", "entity", "=", "here", ".", "get_entity_by_name", "(", "entity_name", ")", "\n", "", "elif", "kg", ".", "inventory", ".", "has_entity_with_name", "(", "entity_name", ")", ":", "\n", "                    ", "entity", "=", "kg", ".", "inventory", ".", "get_entity_by_name", "(", "entity_name", ")", "\n", "", "else", ":", "\n", "# Create the entity at the current location", "\n", "                    ", "entity", "=", "Entity", "(", "entity_name", ",", "here", ")", "\n", "entity", ".", "add_name", "(", "short_name", ")", "\n", "here", ".", "add_entity", "(", "entity", ")", "\n", "\n", "", "take_action", "=", "gv", ".", "Take", "(", "entity", ")", "\n", "p_valid", "=", "take_action", ".", "validate", "(", "resp", ")", "\n", "dbg", "(", "\"[Take] p={:.2f} {} --> {}\"", ".", "format", "(", "p_valid", ",", "entity_name", ",", "resp", ")", ")", "\n", "entity", ".", "add_action_record", "(", "take_action", ",", "p_valid", ",", "resp", ")", "\n", "if", "p_valid", ">", "0.5", ":", "\n", "                    ", "take_action", ".", "apply", "(", ")", "\n", "", "", "", "self", ".", "record", "(", "success", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.hoarder.Hoarder.take_control": [[53, 58], ["hoarder.Hoarder.parse_response"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.hoarder.Hoarder.parse_response"], ["", "def", "take_control", "(", "self", ")", ":", "\n", "        ", "obs", "=", "yield", "\n", "response", "=", "yield", "gv", ".", "TakeAll", "\n", "self", ".", "parse_response", "(", "response", ")", "\n", "self", ".", "_eagerness", "=", "0", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.idler.Idler.__init__": [[69, 74], ["decision_module.DecisionModule.__init__", "valid_detectors.learned_valid_detector.LearnedValidDetector"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "active", "=", "False", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "_active", "=", "active", "\n", "self", ".", "_valid_detector", "=", "LearnedValidDetector", "(", ")", "\n", "self", ".", "_eagerness", "=", ".05", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.idler.Idler.process_event": [[76, 79], ["None"], "methods", ["None"], ["", "def", "process_event", "(", "self", ",", "event", ")", ":", "\n", "        ", "\"\"\" Process an event from the event stream. \"\"\"", "\n", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.idler.Idler.get_random_entity": [[81, 86], ["gv.rng.choice"], "methods", ["None"], ["", "def", "get_random_entity", "(", "self", ")", ":", "\n", "        ", "\"\"\" Returns a random entity from the location or inventory. \"\"\"", "\n", "if", "kg", ".", "player_location", ".", "entities", "or", "kg", ".", "inventory", ".", "entities", ":", "\n", "            ", "return", "rng", ".", "choice", "(", "kg", ".", "player_location", ".", "entities", "+", "kg", ".", "inventory", ".", "entities", ")", "\n", "", "return", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.idler.Idler.get_standalone_action": [[88, 90], ["action.StandaloneAction", "gv.rng.choice"], "methods", ["None"], ["", "def", "get_standalone_action", "(", "self", ")", ":", "\n", "        ", "return", "StandaloneAction", "(", "rng", ".", "choice", "(", "standalone_verbs", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.idler.Idler.get_single_object_action": [[92, 98], ["idler.Idler.get_random_entity", "gv.rng.choice", "action.SingleAction"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.idler.Idler.get_random_entity"], ["", "def", "get_single_object_action", "(", "self", ")", ":", "\n", "        ", "entity", "=", "self", ".", "get_random_entity", "(", ")", "\n", "if", "not", "entity", ":", "\n", "            ", "return", "None", "\n", "", "verb", "=", "rng", ".", "choice", "(", "single_object_verbs", ")", "\n", "return", "SingleAction", "(", "verb", ",", "entity", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.idler.Idler.get_double_action": [[100, 115], ["gv.rng.choice", "action.DoubleAction", "id", "id", "idler.Idler.get_random_entity", "idler.Idler.get_random_entity", "len", "len"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.idler.Idler.get_random_entity", "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.idler.Idler.get_random_entity"], ["", "def", "get_double_action", "(", "self", ")", ":", "\n", "        ", "if", "len", "(", "kg", ".", "player_location", ".", "entities", ")", "+", "len", "(", "kg", ".", "inventory", ".", "entities", ")", "<=", "1", ":", "\n", "            ", "return", "None", "\n", "", "entity1", "=", "None", "\n", "entity2", "=", "None", "\n", "count", "=", "0", "\n", "while", "id", "(", "entity1", ")", "==", "id", "(", "entity2", ")", ":", "\n", "            ", "if", "count", "==", "100", ":", "\n", "                ", "return", "None", "# Failsafe", "\n", "", "else", ":", "\n", "                ", "count", "+=", "1", "\n", "", "entity1", "=", "self", ".", "get_random_entity", "(", ")", "\n", "entity2", "=", "self", ".", "get_random_entity", "(", ")", "\n", "", "verb", ",", "prep", "=", "rng", ".", "choice", "(", "complex_verbs", ")", "\n", "return", "DoubleAction", "(", "verb", ",", "entity1", ",", "prep", ",", "entity2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.idler.Idler.get_action": [[117, 127], ["gv.rng.random", "action.StandaloneAction", "idler.Idler.get_standalone_action", "idler.Idler.get_single_object_action", "idler.Idler.get_double_action"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.idler.Idler.get_standalone_action", "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.idler.Idler.get_single_object_action", "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.idler.Idler.get_double_action"], ["", "def", "get_action", "(", "self", ")", ":", "\n", "        ", "if", "not", "self", ".", "_active", ":", "\n", "            ", "return", "StandaloneAction", "(", "'look'", ")", "\n", "", "n", "=", "rng", ".", "random", "(", ")", "\n", "if", "n", "<", ".1", ":", "\n", "            ", "return", "self", ".", "get_standalone_action", "(", ")", "\n", "", "elif", "n", "<", ".8", ":", "\n", "            ", "return", "self", ".", "get_single_object_action", "(", ")", "\n", "", "else", ":", "\n", "            ", "return", "self", ".", "get_double_action", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.idler.Idler.take_control": [[129, 146], ["idler.Idler.get_action", "idler.Idler._valid_detector.action_valid", "isinstance", "idler.Idler.record", "gv.dbg", "idler.Idler.get_action", "util.first_sentence", "gv.kg.player_location.add_action_record", "isinstance", "idler.Idler.recognized", "idler.Idler.entity.add_action_record", "isinstance", "idler.Idler.entity1.add_action_record"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.get_action", "home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.action_valid", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.decision_module.DecisionModule.record", "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.get_action", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.first_sentence", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_action_record", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.Action.recognized", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_action_record", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_action_record"], ["", "", "def", "take_control", "(", "self", ")", ":", "\n", "        ", "obs", "=", "yield", "\n", "action", "=", "self", ".", "get_action", "(", ")", "\n", "while", "action", "is", "None", "or", "not", "action", ".", "recognized", "(", ")", ":", "\n", "            ", "action", "=", "self", ".", "get_action", "(", ")", "\n", "", "response", "=", "yield", "action", "\n", "p_valid", "=", "self", ".", "_valid_detector", ".", "action_valid", "(", "action", ",", "first_sentence", "(", "response", ")", ")", "\n", "if", "isinstance", "(", "action", ",", "StandaloneAction", ")", ":", "\n", "            ", "kg", ".", "player_location", ".", "add_action_record", "(", "action", ",", "p_valid", ",", "response", ")", "\n", "", "elif", "isinstance", "(", "action", ",", "SingleAction", ")", ":", "\n", "            ", "action", ".", "entity", ".", "add_action_record", "(", "action", ",", "p_valid", ",", "response", ")", "\n", "", "elif", "isinstance", "(", "action", ",", "DoubleAction", ")", ":", "\n", "            ", "action", ".", "entity1", ".", "add_action_record", "(", "action", ",", "p_valid", ",", "response", ")", "\n", "", "success", "=", "(", "p_valid", ">", "0.5", ")", "\n", "self", ".", "record", "(", "success", ")", "\n", "dbg", "(", "\"[IDLER]({}) p={:.2f} {} --> {}\"", ".", "format", "(", "\n", "\"val\"", "if", "success", "else", "\"inv\"", ",", "p_valid", ",", "action", ",", "response", ")", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.examiner.Examiner.__init__": [[18, 27], ["decision_module.DecisionModule.__init__", "valid_detectors.learned_valid_detector.LearnedValidDetector", "entity_detectors.spacy_entity_detector.SpacyEntityDetector"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "active", "=", "False", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "_active", "=", "active", "\n", "self", ".", "_valid_detector", "=", "LearnedValidDetector", "(", ")", "\n", "self", ".", "_entity_detector", "=", "SpacyEntityDetector", "(", ")", "\n", "self", ".", "_to_examine", "=", "{", "}", "# Location : ['entity1', 'entity2']", "\n", "self", ".", "_validation_threshold", "=", "0.5", "# Best threshold over 16 seeds, but not very sensitive.", "\n", "self", ".", "_high_eagerness", "=", "0.9", "\n", "self", ".", "_low_eagerness", "=", "0.11", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.examiner.Examiner.detect_entities": [[29, 32], ["examiner.Examiner._entity_detector.detect"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.entity_detectors.spacy_entity_detector.SpacyEntityDetector.detect"], ["", "def", "detect_entities", "(", "self", ",", "message", ")", ":", "\n", "        ", "\"\"\" Returns a list of detected candidate entities as strings. \"\"\"", "\n", "return", "self", ".", "_entity_detector", ".", "detect", "(", "message", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.examiner.Examiner.get_event_info": [[34, 48], ["type", "type", "type", "type"], "methods", ["None"], ["", "def", "get_event_info", "(", "self", ",", "event", ")", ":", "\n", "        ", "\"\"\" Returns the location and information contained by a new event. \"\"\"", "\n", "message", "=", "''", "\n", "location", "=", "kg", ".", "player_location", "\n", "if", "type", "(", "event", ")", "is", "NewLocationEvent", ":", "\n", "            ", "location", "=", "event", ".", "new_location", "\n", "message", "=", "event", ".", "new_location", ".", "description", "\n", "", "elif", "type", "(", "event", ")", "is", "NewEntityEvent", ":", "\n", "            ", "message", "=", "event", ".", "new_entity", ".", "description", "\n", "", "elif", "type", "(", "event", ")", "is", "NewActionRecordEvent", ":", "\n", "            ", "message", "=", "event", ".", "result_text", "\n", "", "elif", "type", "(", "event", ")", "is", "LocationChangedEvent", ":", "\n", "            ", "location", "=", "event", ".", "new_location", "\n", "", "return", "location", ",", "message", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.examiner.Examiner.process_event": [[50, 60], ["examiner.Examiner.get_event_info", "examiner.Examiner.detect_entities", "gv.dbg", "examiner.Examiner.filter", "util.clean"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.examiner.Examiner.get_event_info", "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.examiner.Examiner.detect_entities", "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.examiner.Examiner.filter", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.clean"], ["", "def", "process_event", "(", "self", ",", "event", ")", ":", "\n", "        ", "\"\"\" Process an event from the event stream. \"\"\"", "\n", "location", ",", "message", "=", "self", ".", "get_event_info", "(", "event", ")", "\n", "if", "location", "not", "in", "self", ".", "_to_examine", ":", "\n", "            ", "self", ".", "_to_examine", "[", "location", "]", "=", "[", "]", "\n", "", "if", "not", "message", ":", "\n", "            ", "return", "\n", "", "candidate_entities", "=", "self", ".", "detect_entities", "(", "message", ")", "\n", "dbg", "(", "\"[EXM](detect) {} --> {}\"", ".", "format", "(", "clean", "(", "message", ")", ",", "candidate_entities", ")", ")", "\n", "self", ".", "filter", "(", "candidate_entities", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.examiner.Examiner.get_eagerness": [[62, 72], ["examiner.Examiner.get_descriptionless_entities"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.examiner.Examiner.get_descriptionless_entities"], ["", "def", "get_eagerness", "(", "self", ")", ":", "\n", "        ", "\"\"\" If we are located at an unexamined location, this module is very eager.\"\"\"", "\n", "if", "not", "self", ".", "_active", ":", "\n", "            ", "return", "0.", "\n", "", "if", "self", ".", "get_descriptionless_entities", "(", ")", ":", "\n", "            ", "return", "self", ".", "_high_eagerness", "\n", "", "elif", "self", ".", "_to_examine", "[", "kg", ".", "player_location", "]", ":", "\n", "            ", "return", "self", ".", "_low_eagerness", "\n", "", "else", ":", "\n", "            ", "return", "0.", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.examiner.Examiner.get_descriptionless_entities": [[74, 78], ["l.extend"], "methods", ["None"], ["", "", "def", "get_descriptionless_entities", "(", "self", ")", ":", "\n", "        ", "l", "=", "[", "e", "for", "e", "in", "kg", ".", "player_location", ".", "entities", "if", "not", "e", ".", "description", "]", "\n", "l", ".", "extend", "(", "[", "e", "for", "e", "in", "kg", ".", "inventory", "if", "not", "e", ".", "description", "]", ")", "\n", "return", "l", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.examiner.Examiner.filter": [[80, 91], ["gv.Examine", "examiner.Examiner._to_examine[].append", "curr_loc.has_entity_with_name", "gv.Examine.recognized"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.has_entity_with_name", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.Action.recognized"], ["", "def", "filter", "(", "self", ",", "candidate_entities", ")", ":", "\n", "        ", "\"\"\" Filters candidate entities. \"\"\"", "\n", "curr_loc", "=", "kg", ".", "player_location", "\n", "for", "entity_name", "in", "candidate_entities", ":", "\n", "            ", "action", "=", "gv", ".", "Examine", "(", "entity_name", ")", "\n", "if", "curr_loc", ".", "has_entity_with_name", "(", "entity_name", ")", "or", "action", "in", "curr_loc", ".", "action_records", "or", "not", "action", ".", "recognized", "(", ")", "or", "entity_name", "in", "self", ".", "_to_examine", "[", "curr_loc", "]", ":", "\n", "                ", "continue", "\n", "", "self", ".", "_to_examine", "[", "curr_loc", "]", ".", "append", "(", "entity_name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.examiner.Examiner.take_control": [[93, 146], ["examiner.Examiner.get_descriptionless_entities", "gv.Examine", "examiner.Examiner._valid_detector.action_valid", "gv.dbg", "curr_loc.add_action_record", "examiner.Examiner._to_examine[].pop", "gv.Examine", "examiner.Examiner._valid_detector.action_valid", "examiner.Examiner.record", "gv.dbg", "curr_loc.add_action_record", "util.first_sentence", "curr_loc.get_entity_by_description", "curr_loc.get_entity_by_description", "gv.kg.inventory.get_entity_by_description", "util.clean", "util.clean", "Entity", "curr_loc.add_entity", "gv.dbg", "Entity.add_name", "Entity", "curr_loc.add_entity", "gv.dbg", "Entity.add_name", "gv.dbg", "gv.kg.inventory.get_entity_by_description.add_name"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.examiner.Examiner.get_descriptionless_entities", "home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.action_valid", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_action_record", "home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.action_valid", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.decision_module.DecisionModule.record", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_action_record", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.first_sentence", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.get_entity_by_description", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.get_entity_by_description", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.get_entity_by_description", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.clean", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.clean", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_entity", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_name", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_entity", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_name", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.entity.Entity.add_name"], ["", "", "def", "take_control", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        1) Detect candidate Entities from current location.\n        2) Examine entities to get detailed descriptions\n        3) Extract nested entities from detailed descriptions\n        \"\"\"", "\n", "obs", "=", "yield", "\n", "curr_loc", "=", "kg", ".", "player_location", "\n", "undescribed_entities", "=", "self", ".", "get_descriptionless_entities", "(", ")", "\n", "if", "undescribed_entities", ":", "\n", "            ", "entity", "=", "undescribed_entities", "[", "0", "]", "\n", "action", "=", "gv", ".", "Examine", "(", "entity", ".", "name", ")", "\n", "response", "=", "yield", "action", "\n", "entity", ".", "description", "=", "response", "\n", "p_valid", "=", "self", ".", "_valid_detector", ".", "action_valid", "(", "action", ",", "response", ")", "\n", "dbg", "(", "\"[EXM] p={:.2f} {} --> {}\"", ".", "format", "(", "p_valid", ",", "action", ",", "clean", "(", "response", ")", ")", ")", "\n", "curr_loc", ".", "add_action_record", "(", "action", ",", "1.", ",", "response", ")", "\n", "", "else", ":", "\n", "            ", "entity_name", "=", "self", ".", "_to_examine", "[", "curr_loc", "]", ".", "pop", "(", ")", "\n", "action", "=", "gv", ".", "Examine", "(", "entity_name", ")", "\n", "response", "=", "yield", "action", "\n", "p_valid", "=", "self", ".", "_valid_detector", ".", "action_valid", "(", "action", ",", "first_sentence", "(", "response", ")", ")", "\n", "success", "=", "(", "p_valid", ">", "self", ".", "_validation_threshold", ")", "\n", "self", ".", "record", "(", "success", ")", "\n", "dbg", "(", "\"[EXM]({}) p={:.2f} {} --> {}\"", ".", "format", "(", "\n", "\"val\"", "if", "success", "else", "\"inv\"", ",", "p_valid", ",", "action", ",", "clean", "(", "response", ")", ")", ")", "\n", "curr_loc", ".", "add_action_record", "(", "action", ",", "p_valid", ",", "response", ")", "\n", "if", "success", ":", "\n", "                ", "entity", "=", "curr_loc", ".", "get_entity_by_description", "(", "response", ")", "\n", "if", "entity", "is", "None", ":", "\n", "                    ", "entity", "=", "Entity", "(", "entity_name", ",", "curr_loc", ",", "description", "=", "response", ")", "\n", "# TODO: incorrect for entities discovered inside other entities", "\n", "curr_loc", ".", "add_entity", "(", "entity", ")", "\n", "", "else", ":", "\n", "                    ", "dbg", "(", "\"[EXM](val) Discovered alternate name \"", "\"\\'{}\\' for \\'{}\\'\"", ".", "format", "(", "entity_name", ",", "entity", ".", "name", ")", ")", "\n", "entity", ".", "add_name", "(", "entity_name", ")", "\n", "", "", "if", "success", ":", "\n", "                ", "entity", "=", "curr_loc", ".", "get_entity_by_description", "(", "response", ")", "\n", "inv_entity", "=", "kg", ".", "inventory", ".", "get_entity_by_description", "(", "response", ")", "\n", "if", "entity", "is", "None", "and", "inv_entity", "is", "None", ":", "\n", "                    ", "entity", "=", "Entity", "(", "entity_name", ",", "curr_loc", ",", "description", "=", "response", ")", "\n", "# TODO: incorrect for entities discovered inside other entities", "\n", "curr_loc", ".", "add_entity", "(", "entity", ")", "\n", "", "else", ":", "\n", "                    ", "if", "entity", ":", "\n", "                        ", "dbg", "(", "\"[EXM](val) Discovered alternate name \"", "\"\\'{}\\' for \\'{}\\'\"", ".", "format", "(", "entity_name", ",", "entity", ".", "name", ")", ")", "\n", "entity", ".", "add_name", "(", "entity_name", ")", "\n", "", "if", "inv_entity", ":", "\n", "                        ", "dbg", "(", "\"[EXM](val) Discovered alternate name \"", "\"\\'{}\\' for inventory item \\'{}\\'\"", ".", "format", "(", "entity_name", ",", "inv_entity", ".", "name", ")", ")", "\n", "inv_entity", ".", "add_name", "(", "entity_name", ")", "\n", "", "", "", "", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.__init__": [[21, 32], ["decision_module.DecisionModule.__init__", "valid_detectors.learned_valid_detector.LearnedValidDetector"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ",", "active", "=", "False", ",", "p_retry", "=", ".3", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "_active", "=", "active", "\n", "self", ".", "_nav_actions", "=", "[", "North", ",", "South", ",", "West", ",", "East", ",", "NorthWest", ",", "\n", "SouthWest", ",", "NorthEast", ",", "SouthEast", ",", "Up", ",", "\n", "Down", ",", "Enter", ",", "Exit", "]", "\n", "self", ".", "_p_retry", "=", "p_retry", "\n", "self", ".", "_valid_detector", "=", "LearnedValidDetector", "(", ")", "\n", "self", ".", "_suggested_directions", "=", "[", "]", "\n", "self", ".", "_default_eagerness", "=", "0.1", "\n", "self", ".", "_low_eagerness", "=", "0.01", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.get_mentioned_directions": [[34, 38], ["util.tokenize", "act.text"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.tokenize", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.ExamineAction.text"], ["", "def", "get_mentioned_directions", "(", "self", ",", "description", ")", ":", "\n", "        ", "\"\"\" Returns the nav actions mentioned in a description. \"\"\"", "\n", "tokens", "=", "tokenize", "(", "description", ")", "\n", "return", "[", "act", "for", "act", "in", "self", ".", "_nav_actions", "if", "act", ".", "text", "(", ")", "in", "tokens", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.process_event": [[40, 43], ["None"], "methods", ["None"], ["", "def", "process_event", "(", "self", ",", "event", ")", ":", "\n", "        ", "\"\"\" Process an event from the event stream. \"\"\"", "\n", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.get_eagerness": [[45, 51], ["navigator.Navigator.get_unexplored_actions", "rng.choice"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.get_unexplored_actions"], ["", "def", "get_eagerness", "(", "self", ")", ":", "\n", "        ", "if", "not", "self", ".", "_active", ":", "\n", "            ", "return", "0.", "\n", "", "if", "self", ".", "get_unexplored_actions", "(", "kg", ".", "player_location", ")", ":", "\n", "            ", "return", "self", ".", "_default_eagerness", "\n", "", "return", "rng", ".", "choice", "(", "[", "self", ".", "_low_eagerness", ",", "self", ".", "_default_eagerness", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.get_unexplored_actions": [[53, 57], ["act.recognized"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.Action.recognized"], ["", "def", "get_unexplored_actions", "(", "self", ",", "location", ")", ":", "\n", "        ", "\"\"\" Returns a list of nav actions not yet attempted from a given location. \"\"\"", "\n", "return", "[", "act", "for", "act", "in", "self", ".", "_nav_actions", "if", "act", "not", "in", "location", ".", "action_records", "and", "act", ".", "recognized", "(", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.get_successful_nav_actions": [[59, 62], ["kg.connections.outgoing", "c.action.recognized"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.ConnectionGraph.outgoing", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.Action.recognized"], ["", "def", "get_successful_nav_actions", "(", "self", ",", "location", ")", ":", "\n", "        ", "\"\"\" Returns a list of nav actions that have been successful from the location. \"\"\"", "\n", "return", "[", "c", ".", "action", "for", "c", "in", "kg", ".", "connections", ".", "outgoing", "(", "location", ")", "if", "c", ".", "action", ".", "recognized", "(", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.get_failed_nav_actions": [[64, 69], ["navigator.Navigator.get_successful_nav_actions", "act.recognized"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.get_successful_nav_actions", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.action.Action.recognized"], ["", "def", "get_failed_nav_actions", "(", "self", ",", "location", ")", ":", "\n", "        ", "\"\"\" Returns a list of nav actions that have failed from the location. \"\"\"", "\n", "successful_actions", "=", "self", ".", "get_successful_nav_actions", "(", "location", ")", "\n", "return", "[", "act", "for", "act", "in", "self", ".", "_nav_actions", "if", "act", "in", "location", ".", "action_records", "and", "act", "not", "in", "successful_actions", "and", "act", ".", "recognized", "(", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.get_action": [[71, 112], ["navigator.Navigator.get_mentioned_directions", "navigator.Navigator.get_unexplored_actions", "rng.choice", "dbg", "rng.choice", "dbg", "rng.choice", "dbg", "rng.random", "navigator.Navigator.get_successful_nav_actions", "loc.has_action_record", "dbg", "rng.choice", "dbg"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.get_mentioned_directions", "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.get_unexplored_actions", "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.get_successful_nav_actions", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.has_action_record"], ["", "def", "get_action", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        First try to take an unexplored nav action. If none exist, sample one\n        of the successful or failed nav actions.\n\n        \"\"\"", "\n", "loc", "=", "kg", ".", "player_location", "\n", "\n", "# If there was a previously suggested direction, try it", "\n", "if", "self", ".", "_suggested_directions", ":", "\n", "            ", "act", "=", "rng", ".", "choice", "(", "self", ".", "_suggested_directions", ")", "\n", "del", "self", ".", "_suggested_directions", "[", ":", "]", "\n", "dbg", "(", "\"[NAV] Trying suggested action: {}\"", ".", "format", "(", "act", ")", ")", "\n", "return", "act", "\n", "\n", "# First try to move in one of the directions mentioned in the description.", "\n", "", "likely_nav_actions", "=", "self", ".", "get_mentioned_directions", "(", "loc", ".", "description", ")", "\n", "for", "act", "in", "likely_nav_actions", ":", "\n", "            ", "if", "not", "loc", ".", "has_action_record", "(", "act", ")", ":", "\n", "                ", "dbg", "(", "\"[NAV] Trying mentioned action: {}\"", ".", "format", "(", "act", ")", ")", "\n", "return", "act", "\n", "\n", "# Then try something new", "\n", "", "", "unexplored", "=", "self", ".", "get_unexplored_actions", "(", "loc", ")", "\n", "if", "unexplored", ":", "\n", "            ", "act", "=", "rng", ".", "choice", "(", "unexplored", ")", "\n", "dbg", "(", "\"[NAV] Trying unexplored action: {}\"", ".", "format", "(", "act", ")", ")", "\n", "return", "act", "\n", "\n", "# Try a previously successful action", "\n", "", "if", "rng", ".", "random", "(", ")", ">", "self", ".", "_p_retry", ":", "\n", "            ", "successful_actions", "=", "self", ".", "get_successful_nav_actions", "(", "loc", ")", "\n", "if", "successful_actions", ":", "\n", "                ", "act", "=", "rng", ".", "choice", "(", "successful_actions", ")", "\n", "dbg", "(", "\"[NAV] Trying previously successful action: {}\"", ".", "format", "(", "act", ")", ")", "\n", "return", "act", "\n", "\n", "# Finally, just try something random", "\n", "", "", "act", "=", "rng", ".", "choice", "(", "self", ".", "_nav_actions", ")", "\n", "dbg", "(", "\"[NAV] Trying random action: {}\"", ".", "format", "(", "act", ")", ")", "\n", "return", "act", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.find_most_similar_loc": [[114, 125], ["fuzzywuzzy.fuzz.partial_ratio"], "methods", ["None"], ["", "def", "find_most_similar_loc", "(", "self", ",", "description", ",", "loc_list", ")", ":", "\n", "        ", "\"\"\"Returns the location from loc_list with that best matches the\n        provided description.\"\"\"", "\n", "most_similar", "=", "None", "\n", "best_similarity", "=", "0", "\n", "for", "loc", "in", "loc_list", ":", "\n", "            ", "similarity", "=", "fuzz", ".", "partial_ratio", "(", "loc", ".", "description", ",", "description", ")", "\n", "if", "similarity", ">", "best_similarity", ":", "\n", "                ", "best_similarity", "=", "similarity", "\n", "most_similar", "=", "loc", "\n", "", "", "return", "most_similar", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.relocalize": [[127, 136], ["kg.most_similar_location", "dbg", "dbg"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.most_similar_location"], ["", "def", "relocalize", "(", "self", ",", "description", ")", ":", "\n", "        ", "\"\"\"Resets the player's location to location best matching the\n        provided description, creating a new location if needed. \"\"\"", "\n", "loc", "=", "kg", ".", "most_similar_location", "(", "description", ")", "\n", "if", "loc", ":", "\n", "            ", "dbg", "(", "\"[NAV](relocalizing) \\\"{}\\\" to {}\"", ".", "format", "(", "description", ",", "loc", ")", ")", "\n", "kg", ".", "player_location", "=", "loc", "\n", "", "else", ":", "\n", "            ", "dbg", "(", "\"[NAV](relocalizing aborted) \\\"{}\\\" to {}\"", ".", "format", "(", "description", ",", "loc", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.take_control": [[138, 220], ["navigator.Navigator.get_action", "navigator.Navigator._valid_detector.action_valid", "curr_loc.has_action_record", "curr_loc.add_action_record", "navigator.Navigator.get_mentioned_directions", "Location.extract_name", "kg.locations_with_name", "result.startswith", "dbg", "navigator.Navigator._suggested_directions.remove", "dbg", "kg.add_connection", "kg.connections.navigate", "dbg", "navigator.Navigator.record", "len", "navigator.Navigator.find_most_similar_loc", "Connection", "navigator.Navigator.relocalize", "dbg", "dbg", "fuzzywuzzy.fuzz.ratio", "fuzzywuzzy.fuzz.ratio", "Location.extract_name", "kg.locations_with_name", "Location", "kg.add_location", "kg.add_connection", "dbg", "kg.add_connection", "Connection", "len", "navigator.Navigator.find_most_similar_loc", "Connection"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.get_action", "home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.action_valid", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.has_action_record", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.add_action_record", "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.get_mentioned_directions", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.extract_name", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.locations_with_name", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Inventory.remove", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.add_connection", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.ConnectionGraph.navigate", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.decision_module.DecisionModule.record", "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.find_most_similar_loc", "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.relocalize", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.location.Location.extract_name", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.locations_with_name", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.add_location", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.add_connection", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.knowledge_graph.KnowledgeGraph.add_connection", "home.repos.pwc.inspect_result.Microsoft_nail_agent.decision_modules.navigator.Navigator.find_most_similar_loc"], ["", "", "def", "take_control", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Takes a navigational action and records the resulting transition.\n\n        \"\"\"", "\n", "obs", "=", "yield", "\n", "curr_loc", "=", "kg", ".", "player_location", "\n", "action", "=", "self", ".", "get_action", "(", ")", "\n", "response", "=", "yield", "action", "\n", "p_valid", "=", "self", ".", "_valid_detector", ".", "action_valid", "(", "action", ",", "response", ")", "\n", "\n", "# Check if we've tried this action before", "\n", "tried_before", "=", "False", "\n", "if", "curr_loc", ".", "has_action_record", "(", "action", ")", ":", "\n", "            ", "prev_valid", ",", "result", "=", "curr_loc", ".", "action_records", "[", "action", "]", "\n", "if", "result", ".", "startswith", "(", "response", ")", ":", "\n", "                ", "tried_before", "=", "True", "\n", "\n", "", "", "curr_loc", ".", "add_action_record", "(", "action", ",", "p_valid", ",", "response", ")", "\n", "self", ".", "_suggested_directions", "=", "self", ".", "get_mentioned_directions", "(", "response", ")", "\n", "if", "self", ".", "_suggested_directions", ":", "\n", "            ", "dbg", "(", "\"[NAV] Suggested Directions: {}\"", ".", "format", "(", "self", ".", "_suggested_directions", ")", ")", "\n", "", "if", "action", "in", "self", ".", "_suggested_directions", ":", "# Don't try the same nav action again", "\n", "            ", "self", ".", "_suggested_directions", ".", "remove", "(", "action", ")", "\n", "\n", "# If an existing locations matches the response, then we're done", "\n", "", "possible_loc_name", "=", "Location", ".", "extract_name", "(", "response", ")", "\n", "existing_locs", "=", "kg", ".", "locations_with_name", "(", "possible_loc_name", ")", "\n", "if", "existing_locs", ":", "\n", "# If multiple locations match, we need the most similar", "\n", "            ", "if", "len", "(", "existing_locs", ")", ">", "1", ":", "\n", "                ", "look", "=", "yield", "Look", "\n", "existing_loc", "=", "self", ".", "find_most_similar_loc", "(", "look", ",", "existing_locs", ")", "\n", "", "else", ":", "\n", "                ", "existing_loc", "=", "existing_locs", "[", "0", "]", "\n", "", "dbg", "(", "\"[NAV](revisited-location) {}\"", ".", "format", "(", "existing_loc", ".", "name", ")", ")", "\n", "kg", ".", "add_connection", "(", "Connection", "(", "curr_loc", ",", "action", ",", "existing_loc", ")", ")", "\n", "kg", ".", "player_location", "=", "existing_loc", "\n", "return", "\n", "\n", "# This is either a new location or a failed action", "\n", "", "if", "tried_before", ":", "\n", "            ", "known_destination", "=", "kg", ".", "connections", ".", "navigate", "(", "curr_loc", ",", "action", ")", "\n", "if", "known_destination", ":", "\n", "# We didn't reach the expected destination. Likely mislocalized.", "\n", "                ", "look", "=", "yield", "Look", "\n", "self", ".", "relocalize", "(", "look", ")", "\n", "", "else", ":", "# This has failed previously", "\n", "                ", "dbg", "(", "\"[NAV-fail] p={:.2f} Response: {}\"", ".", "format", "(", "p_valid", ",", "response", ")", ")", "\n", "", "", "else", ":", "\n", "# This is a new response: do a look to see if we've moved.", "\n", "            ", "if", "p_valid", "<", ".1", ":", "\n", "                ", "dbg", "(", "\"[NAV](Suspected-Invalid) {}\"", ".", "format", "(", "response", ")", ")", "\n", "return", "\n", "\n", "", "look", "=", "yield", "Look", "\n", "\n", "p_stay", "=", "fuzz", ".", "ratio", "(", "look", ",", "curr_loc", ".", "description", ")", "/", "100.", "\n", "p_move", "=", "fuzz", ".", "ratio", "(", "look", ",", "response", ")", "/", "100.", "\n", "moved", "=", "p_move", ">", "p_stay", "\n", "dbg", "(", "\"[NAV]({}) p={} {} --> {}\"", ".", "format", "(", "\n", "'val'", "if", "moved", "else", "'inv'", ",", "p_move", ",", "action", ",", "response", ")", ")", "\n", "self", ".", "record", "(", "moved", ")", "\n", "if", "moved", ":", "\n", "# Check if we've moved to an existing location", "\n", "                ", "possible_loc_name", "=", "Location", ".", "extract_name", "(", "look", ")", "\n", "existing_locs", "=", "kg", ".", "locations_with_name", "(", "possible_loc_name", ")", "\n", "if", "existing_locs", ":", "\n", "                    ", "if", "len", "(", "existing_locs", ")", ">", "1", ":", "\n", "                        ", "existing_loc", "=", "self", ".", "find_most_similar_loc", "(", "look", ",", "existing_locs", ")", "\n", "", "else", ":", "\n", "                        ", "existing_loc", "=", "existing_locs", "[", "0", "]", "\n", "", "dbg", "(", "\"[NAV](revisited-location) {}\"", ".", "format", "(", "existing_loc", ".", "name", ")", ")", "\n", "kg", ".", "add_connection", "(", "Connection", "(", "curr_loc", ",", "action", ",", "existing_loc", ")", ")", "\n", "kg", ".", "player_location", "=", "existing_loc", "\n", "return", "\n", "\n", "# Finally, create a new location", "\n", "", "new_loc", "=", "Location", "(", "look", ")", "\n", "to_loc", "=", "kg", ".", "add_location", "(", "new_loc", ")", "\n", "kg", ".", "add_connection", "(", "Connection", "(", "curr_loc", ",", "action", ",", "new_loc", ")", ")", "\n", "kg", ".", "player_location", "=", "new_loc", "\n", "", "", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.entity_detectors.spacy_entity_detector.SpacyEntityDetector.__init__": [[11, 13], ["entity_detector.EntityDetector.__init__"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.entity_detectors.spacy_entity_detector.SpacyEntityDetector.detect": [[15, 25], ["gv.nlp", "chunk.root.text.lower", "nouns.append"], "methods", ["None"], ["", "def", "detect", "(", "self", ",", "observation_text", ")", ":", "\n", "        ", "doc", "=", "gv", ".", "nlp", "(", "observation_text", ")", "\n", "nouns", "=", "[", "]", "\n", "for", "chunk", "in", "doc", ".", "noun_chunks", ":", "\n", "            ", "noun", "=", "chunk", ".", "root", ".", "text", ".", "lower", "(", ")", "\n", "if", "noun", "in", "self", ".", "disallowed", ":", "\n", "                ", "continue", "\n", "", "if", "noun", "not", "in", "nouns", ":", "\n", "                ", "nouns", ".", "append", "(", "noun", ")", "\n", "", "", "return", "nouns", "\n", "", "", ""]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__": [[16, 19], ["valid_detector.ValidDetector.__init__", "fastText.load_model"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.__init__"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "model", "=", "fastText", ".", "load_model", "(", "model_path", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Microsoft_nail_agent.valid_detectors.learned_valid_detector.LearnedValidDetector.action_valid": [[20, 33], ["learned_valid_detector.LearnedValidDetector.model.predict", "util.action_recognized", "util.clean"], "methods", ["home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.action_recognized", "home.repos.pwc.inspect_result.Microsoft_nail_agent.agent.util.clean"], ["", "def", "action_valid", "(", "self", ",", "action", ",", "response_text", ")", ":", "\n", "        ", "if", "not", "util", ".", "action_recognized", "(", "action", ",", "response_text", ")", ":", "\n", "            ", "return", "0.", "\n", "", "label", ",", "proba", "=", "self", ".", "model", ".", "predict", "(", "util", ".", "clean", "(", "response_text", ")", ")", "\n", "p_valid", "=", "0", "\n", "if", "label", "[", "0", "]", "==", "'__label__invalid'", ":", "\n", "            ", "p_valid", "=", "1", "-", "proba", "[", "0", "]", "\n", "", "elif", "label", "[", "0", "]", "==", "'__label__valid'", ":", "\n", "            ", "p_valid", "=", "proba", "[", "0", "]", "\n", "", "else", ":", "\n", "            ", "assert", "False", ",", "\"Unrecognized Label {}\"", ".", "format", "(", "label", "[", "0", "]", ")", "\n", "# gv.dbg(\"[LVD]({}) {} p_Valid={:.2f}\".format(action, response_text, p_valid))", "\n", "", "return", "p_valid", "\n", "", "", ""]]}