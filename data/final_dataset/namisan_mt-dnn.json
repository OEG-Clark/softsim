{"home.repos.pwc.inspect_result.namisan_mt-dnn.None.calc_metrics.generate_golds_predictions_scores": [[16, 36], ["sample_id_2_label_dic.items", "set", "set", "golds.append", "predictions.append", "scores.extend", "sample_id_2_label_dic.keys", "sample_id_2_pred_score_seg_dic.keys"], "function", ["None"], ["def", "generate_golds_predictions_scores", "(", "sample_id_2_pred_score_seg_dic", ",", "sample_objs", ")", ":", "\n", "    ", "sample_id_2_label_dic", "=", "{", "}", "\n", "\n", "for", "sample_obj", "in", "sample_objs", ":", "\n", "        ", "sample_id", ",", "label", "=", "sample_obj", "[", "\"uid\"", "]", ",", "sample_obj", "[", "\"label\"", "]", "\n", "sample_id_2_label_dic", "[", "sample_id", "]", "=", "label", "\n", "\n", "", "assert", "set", "(", "sample_id_2_label_dic", ".", "keys", "(", ")", ")", "==", "set", "(", "\n", "sample_id_2_pred_score_seg_dic", ".", "keys", "(", ")", "\n", ")", "\n", "\n", "golds", "=", "[", "]", "\n", "predictions", "=", "[", "]", "\n", "scores", "=", "[", "]", "\n", "for", "sample_id", ",", "label", "in", "sample_id_2_label_dic", ".", "items", "(", ")", ":", "\n", "        ", "golds", ".", "append", "(", "label", ")", "\n", "pred", ",", "score_seg", "=", "sample_id_2_pred_score_seg_dic", "[", "sample_id", "]", "\n", "predictions", ".", "append", "(", "pred", ")", "\n", "scores", ".", "extend", "(", "score_seg", ")", "\n", "", "return", "golds", ",", "predictions", ",", "scores", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.int_test_prepro_std.assert_dir_equal": [[8, 15], ["glob.glob", "os.join", "os.join", "filecmp.cmp", "os.split"], "function", ["None"], ["def", "assert_dir_equal", "(", "dir0", ",", "dir1", ")", ":", "\n", "    ", "for", "file_path0", "in", "glob", ".", "glob", "(", "path", ".", "join", "(", "dir0", ",", "\"*\"", ")", ")", ":", "\n", "        ", "file_name", "=", "path", ".", "split", "(", "file_path0", ")", "[", "1", "]", "\n", "file_path1", "=", "path", ".", "join", "(", "dir1", ",", "file_name", ")", "\n", "assert", "filecmp", ".", "cmp", "(", "\n", "file_path0", ",", "file_path1", ",", "shallow", "=", "False", "\n", ")", ",", "'%s diff in two directories \"%s\" and \"%s\"'", "%", "(", "file_name", ",", "dir0", ",", "dir1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.int_test_prepro_std.test_prepro_std": [[17, 26], ["subprocess.call", "subprocess.call", "int_test_prepro_std.assert_dir_equal", "os.access", "os.access"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.None.int_test_prepro_std.assert_dir_equal"], ["", "", "def", "test_prepro_std", "(", "cmd", ",", "src_dir", ",", "task_def_path", ",", "target_dir", ",", "expected_dir", ")", ":", "\n", "    ", "subprocess", ".", "call", "(", "\"rm -rf %s\"", "%", "target_dir", ",", "shell", "=", "True", ")", "\n", "assert", "not", "os", ".", "access", "(", "\n", "target_dir", ",", "os", ".", "F_OK", "\n", ")", ",", "\"preprocessed target directory already exist\"", "\n", "subprocess", ".", "call", "(", "\n", "cmd", "%", "(", "src_dir", ",", "task_def_path", ")", ",", "shell", "=", "True", ",", "stdout", "=", "subprocess", ".", "DEVNULL", "\n", ")", "\n", "assert_dir_equal", "(", "target_dir", ",", "expected_dir", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.predict.dump": [[18, 21], ["open", "json.dump"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.dump"], ["def", "dump", "(", "path", ",", "data", ")", ":", "\n", "    ", "with", "open", "(", "path", ",", "\"w\"", ")", "as", "f", ":", "\n", "        ", "json", ".", "dump", "(", "data", ",", "f", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.model_config": [[33, 101], ["parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument"], "function", ["None"], ["def", "model_config", "(", "parser", ")", ":", "\n", "    ", "parser", ".", "add_argument", "(", "\"--update_bert_opt\"", ",", "default", "=", "0", ",", "type", "=", "int", ")", "\n", "parser", ".", "add_argument", "(", "\"--multi_gpu_on\"", ",", "action", "=", "\"store_true\"", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--mem_cum_type\"", ",", "type", "=", "str", ",", "default", "=", "\"simple\"", ",", "help", "=", "\"bilinear/simple/defualt\"", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--answer_num_turn\"", ",", "type", "=", "int", ",", "default", "=", "5", ")", "\n", "parser", ".", "add_argument", "(", "\"--answer_mem_drop_p\"", ",", "type", "=", "float", ",", "default", "=", "0.1", ")", "\n", "parser", ".", "add_argument", "(", "\"--answer_att_hidden_size\"", ",", "type", "=", "int", ",", "default", "=", "128", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--answer_att_type\"", ",", "\n", "type", "=", "str", ",", "\n", "default", "=", "\"bilinear\"", ",", "\n", "help", "=", "\"bilinear/simple/defualt\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--answer_rnn_type\"", ",", "type", "=", "str", ",", "default", "=", "\"gru\"", ",", "help", "=", "\"rnn/gru/lstm\"", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--answer_sum_att_type\"", ",", "\n", "type", "=", "str", ",", "\n", "default", "=", "\"bilinear\"", ",", "\n", "help", "=", "\"bilinear/simple/defualt\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--answer_merge_opt\"", ",", "type", "=", "int", ",", "default", "=", "1", ")", "\n", "parser", ".", "add_argument", "(", "\"--answer_mem_type\"", ",", "type", "=", "int", ",", "default", "=", "1", ")", "\n", "parser", ".", "add_argument", "(", "\"--max_answer_len\"", ",", "type", "=", "int", ",", "default", "=", "10", ")", "\n", "parser", ".", "add_argument", "(", "\"--answer_dropout_p\"", ",", "type", "=", "float", ",", "default", "=", "0.1", ")", "\n", "parser", ".", "add_argument", "(", "\"--answer_weight_norm_on\"", ",", "action", "=", "\"store_true\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--dump_state_on\"", ",", "action", "=", "\"store_true\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--answer_opt\"", ",", "type", "=", "int", ",", "default", "=", "1", ",", "help", "=", "\"0,1\"", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--pooler_actf\"", ",", "type", "=", "str", ",", "default", "=", "\"tanh\"", ",", "help", "=", "\"tanh/relu/gelu\"", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--mtl_opt\"", ",", "type", "=", "int", ",", "default", "=", "0", ")", "\n", "parser", ".", "add_argument", "(", "\"--ratio\"", ",", "type", "=", "float", ",", "default", "=", "0", ")", "\n", "parser", ".", "add_argument", "(", "\"--mix_opt\"", ",", "type", "=", "int", ",", "default", "=", "0", ")", "\n", "parser", ".", "add_argument", "(", "\"--max_seq_len\"", ",", "type", "=", "int", ",", "default", "=", "512", ")", "\n", "parser", ".", "add_argument", "(", "\"--init_ratio\"", ",", "type", "=", "float", ",", "default", "=", "1", ")", "\n", "parser", ".", "add_argument", "(", "\"--encoder_type\"", ",", "type", "=", "int", ",", "default", "=", "EncoderModelType", ".", "BERT", ")", "\n", "parser", ".", "add_argument", "(", "\"--num_hidden_layers\"", ",", "type", "=", "int", ",", "default", "=", "-", "1", ")", "\n", "\n", "# BERT pre-training", "\n", "parser", ".", "add_argument", "(", "\"--bert_model_type\"", ",", "type", "=", "str", ",", "default", "=", "\"bert-base-uncased\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--do_lower_case\"", ",", "action", "=", "\"store_true\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--masked_lm_prob\"", ",", "type", "=", "float", ",", "default", "=", "0.15", ")", "\n", "parser", ".", "add_argument", "(", "\"--short_seq_prob\"", ",", "type", "=", "float", ",", "default", "=", "0.2", ")", "\n", "parser", ".", "add_argument", "(", "\"--max_predictions_per_seq\"", ",", "type", "=", "int", ",", "default", "=", "128", ")", "\n", "\n", "# bin samples", "\n", "parser", ".", "add_argument", "(", "\"--bin_on\"", ",", "action", "=", "\"store_true\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--bin_size\"", ",", "type", "=", "int", ",", "default", "=", "64", ")", "\n", "parser", ".", "add_argument", "(", "\"--bin_grow_ratio\"", ",", "type", "=", "int", ",", "default", "=", "0.5", ")", "\n", "\n", "# dist training", "\n", "parser", ".", "add_argument", "(", "\n", "\"--local_rank\"", ",", "\n", "type", "=", "int", ",", "\n", "default", "=", "-", "1", ",", "\n", "help", "=", "\"For distributed training: local_rank\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--world_size\"", ",", "type", "=", "int", ",", "default", "=", "1", ",", "help", "=", "\"For distributed training: world size\"", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--master_addr\"", ",", "type", "=", "str", ",", "default", "=", "\"localhost\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--master_port\"", ",", "type", "=", "str", ",", "default", "=", "\"6600\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--backend\"", ",", "type", "=", "str", ",", "default", "=", "\"nccl\"", ")", "\n", "return", "parser", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.data_config": [[103, 131], ["parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument"], "function", ["None"], ["", "def", "data_config", "(", "parser", ")", ":", "\n", "    ", "parser", ".", "add_argument", "(", "\n", "\"--log_file\"", ",", "default", "=", "\"mt-dnn-train.log\"", ",", "help", "=", "\"path for log file.\"", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--tensorboard\"", ",", "action", "=", "\"store_true\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--tensorboard_logdir\"", ",", "default", "=", "\"tensorboard_logdir\"", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--init_checkpoint\"", ",", "\n", "default", "=", "\"mt_dnn_models/bert_model_base_uncased.pt\"", ",", "\n", "type", "=", "str", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--data_dir\"", ",", "default", "=", "\"data/canonical_data/bert_uncased_lower\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--data_sort_on\"", ",", "action", "=", "\"store_true\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--name\"", ",", "default", "=", "\"farmer\"", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--task_def\"", ",", "type", "=", "str", ",", "default", "=", "\"experiments/glue/glue_task_def.yml\"", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--train_datasets\"", ",", "default", "=", "\"mnli\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--test_datasets\"", ",", "default", "=", "\"mnli_matched,mnli_mismatched\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--glue_format_on\"", ",", "action", "=", "\"store_true\"", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--mkd-opt\"", ",", "\n", "type", "=", "int", ",", "\n", "default", "=", "0", ",", "\n", "help", "=", "\">0 to turn on knowledge distillation, requires 'softlabel' column in input data\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--do_padding\"", ",", "action", "=", "\"store_true\"", ")", "\n", "return", "parser", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.train_config": [[133, 215], ["parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "torch.cuda.is_available"], "function", ["None"], ["", "def", "train_config", "(", "parser", ")", ":", "\n", "    ", "parser", ".", "add_argument", "(", "\n", "\"--cuda\"", ",", "\n", "type", "=", "bool", ",", "\n", "default", "=", "torch", ".", "cuda", ".", "is_available", "(", ")", ",", "\n", "help", "=", "\"whether to use GPU acceleration.\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--log_per_updates\"", ",", "type", "=", "int", ",", "default", "=", "500", ")", "\n", "parser", ".", "add_argument", "(", "\"--save_per_updates\"", ",", "type", "=", "int", ",", "default", "=", "10000", ")", "\n", "parser", ".", "add_argument", "(", "\"--save_per_updates_on\"", ",", "action", "=", "\"store_true\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--epochs\"", ",", "type", "=", "int", ",", "default", "=", "5", ")", "\n", "parser", ".", "add_argument", "(", "\"--batch_size\"", ",", "type", "=", "int", ",", "default", "=", "8", ")", "\n", "parser", ".", "add_argument", "(", "\"--batch_size_eval\"", ",", "type", "=", "int", ",", "default", "=", "8", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--optimizer\"", ",", "\n", "default", "=", "\"adamax\"", ",", "\n", "help", "=", "\"supported optimizer: adamax, sgd, adadelta, adam\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--grad_clipping\"", ",", "type", "=", "float", ",", "default", "=", "0", ")", "\n", "parser", ".", "add_argument", "(", "\"--global_grad_clipping\"", ",", "type", "=", "float", ",", "default", "=", "1.0", ")", "\n", "parser", ".", "add_argument", "(", "\"--weight_decay\"", ",", "type", "=", "float", ",", "default", "=", "0", ")", "\n", "parser", ".", "add_argument", "(", "\"--learning_rate\"", ",", "type", "=", "float", ",", "default", "=", "5e-5", ")", "\n", "parser", ".", "add_argument", "(", "\"--momentum\"", ",", "type", "=", "float", ",", "default", "=", "0", ")", "\n", "parser", ".", "add_argument", "(", "\"--warmup\"", ",", "type", "=", "float", ",", "default", "=", "0.1", ")", "\n", "parser", ".", "add_argument", "(", "\"--warmup_schedule\"", ",", "type", "=", "str", ",", "default", "=", "\"warmup_linear\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--adam_eps\"", ",", "type", "=", "float", ",", "default", "=", "1e-6", ")", "\n", "\n", "parser", ".", "add_argument", "(", "\"--vb_dropout\"", ",", "action", "=", "\"store_false\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--dropout_p\"", ",", "type", "=", "float", ",", "default", "=", "0.1", ")", "\n", "parser", ".", "add_argument", "(", "\"--dropout_w\"", ",", "type", "=", "float", ",", "default", "=", "0.000", ")", "\n", "parser", ".", "add_argument", "(", "\"--bert_dropout_p\"", ",", "type", "=", "float", ",", "default", "=", "0.1", ")", "\n", "\n", "# loading", "\n", "parser", ".", "add_argument", "(", "\"--model_ckpt\"", ",", "default", "=", "\"checkpoints/model_0.pt\"", ",", "type", "=", "str", ")", "\n", "parser", ".", "add_argument", "(", "\"--resume\"", ",", "action", "=", "\"store_true\"", ")", "\n", "\n", "# scheduler", "\n", "# parser.add_argument('--feature_based_on', action='store_true')", "\n", "parser", ".", "add_argument", "(", "'--scheduler_type'", ",", "type", "=", "int", ",", "default", "=", "0", ",", "help", "=", "'0: linear, 1: cosine, 2 constant'", ")", "\n", "parser", ".", "add_argument", "(", "\"--output_dir\"", ",", "default", "=", "\"checkpoint\"", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--seed\"", ",", "\n", "type", "=", "int", ",", "\n", "default", "=", "2018", ",", "\n", "help", "=", "\"random seed for data shuffling, embedding init, etc.\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--grad_accumulation_step\"", ",", "type", "=", "int", ",", "default", "=", "1", ")", "\n", "\n", "# fp 16", "\n", "parser", ".", "add_argument", "(", "\n", "\"--fp16\"", ",", "\n", "action", "=", "\"store_true\"", ",", "\n", "help", "=", "\"Whether to use 16-bit (mixed) precision (through NVIDIA apex) instead of 32-bit\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--fp16_opt_level\"", ",", "\n", "type", "=", "str", ",", "\n", "default", "=", "\"O1\"", ",", "\n", "help", "=", "\"For fp16: Apex AMP optimization level selected in ['O0', 'O1', 'O2', and 'O3'].\"", "\n", "\"See details at https://nvidia.github.io/apex/amp.html\"", ",", "\n", ")", "\n", "\n", "# adv training", "\n", "parser", ".", "add_argument", "(", "\"--adv_train\"", ",", "action", "=", "\"store_true\"", ")", "\n", "# the current release only includes smart perturbation", "\n", "parser", ".", "add_argument", "(", "\"--adv_opt\"", ",", "default", "=", "0", ",", "type", "=", "int", ")", "\n", "parser", ".", "add_argument", "(", "\"--adv_norm_level\"", ",", "default", "=", "0", ",", "type", "=", "int", ")", "\n", "parser", ".", "add_argument", "(", "\"--adv_p_norm\"", ",", "default", "=", "\"inf\"", ",", "type", "=", "str", ")", "\n", "parser", ".", "add_argument", "(", "\"--adv_alpha\"", ",", "default", "=", "1", ",", "type", "=", "float", ")", "\n", "parser", ".", "add_argument", "(", "\"--adv_k\"", ",", "default", "=", "1", ",", "type", "=", "int", ")", "\n", "parser", ".", "add_argument", "(", "\"--adv_step_size\"", ",", "default", "=", "1e-5", ",", "type", "=", "float", ")", "\n", "parser", ".", "add_argument", "(", "\"--adv_noise_var\"", ",", "default", "=", "1e-5", ",", "type", "=", "float", ")", "\n", "parser", ".", "add_argument", "(", "\"--adv_epsilon\"", ",", "default", "=", "1e-6", ",", "type", "=", "float", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--encode_mode\"", ",", "action", "=", "\"store_true\"", ",", "help", "=", "\"only encode test data\"", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--debug\"", ",", "action", "=", "\"store_true\"", ",", "help", "=", "\"print debug info\"", ")", "\n", "\n", "# transformer cache", "\n", "parser", ".", "add_argument", "(", "\"--transformer_cache\"", ",", "default", "=", "\".cache\"", ",", "type", "=", "str", ")", "\n", "\n", "return", "parser", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.dump": [[240, 243], ["open", "json.dump"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.dump"], ["def", "dump", "(", "path", ",", "data", ")", ":", "\n", "    ", "with", "open", "(", "path", ",", "\"w\"", ")", "as", "f", ":", "\n", "        ", "json", ".", "dump", "(", "data", ",", "f", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.evaluation": [[245, 347], ["train.print_message", "enumerate", "task_defs.get_task_def", "dataset.split", "test_metrics.items", "torch.no_grad", "mt_dnn.inference.eval_model", "isinstance", "os.path.join", "train.dump", "tensorboard.add_scalar", "train.print_message", "isinstance", "os.path.join", "submit", "train.print_message", "str", "train.print_message", "test_prefix.lower", "test_prefix.lower"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.exp_def.TaskDefs.get_task_def", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.inference.eval_model", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.dump", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.submit", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message"], ["", "", "def", "evaluation", "(", "\n", "model", ",", "\n", "datasets", ",", "\n", "data_list", ",", "\n", "task_defs", ",", "\n", "output_dir", "=", "\"checkpoints\"", ",", "\n", "epoch", "=", "0", ",", "\n", "n_updates", "=", "-", "1", ",", "\n", "with_label", "=", "False", ",", "\n", "tensorboard", "=", "None", ",", "\n", "glue_format_on", "=", "False", ",", "\n", "test_on", "=", "False", ",", "\n", "device", "=", "None", ",", "\n", "logger", "=", "None", ",", "\n", ")", ":", "\n", "# eval on rank 1", "\n", "    ", "print_message", "(", "logger", ",", "\"Evaluation\"", ")", "\n", "test_prefix", "=", "\"Test\"", "if", "test_on", "else", "\"Dev\"", "\n", "if", "n_updates", ">", "0", ":", "\n", "        ", "updates_str", "=", "\"updates\"", "\n", "", "else", ":", "\n", "        ", "updates_str", "=", "\"epoch\"", "\n", "", "updates", "=", "model", ".", "updates", "if", "n_updates", ">", "0", "else", "epoch", "\n", "for", "idx", ",", "dataset", "in", "enumerate", "(", "datasets", ")", ":", "\n", "        ", "prefix", "=", "dataset", ".", "split", "(", "\"_\"", ")", "[", "0", "]", "\n", "task_def", "=", "task_defs", ".", "get_task_def", "(", "prefix", ")", "\n", "label_dict", "=", "task_def", ".", "label_vocab", "\n", "test_data", "=", "data_list", "[", "idx", "]", "\n", "if", "test_data", "is", "not", "None", ":", "\n", "            ", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "                ", "(", "\n", "test_metrics", ",", "\n", "test_predictions", ",", "\n", "test_scores", ",", "\n", "test_golds", ",", "\n", "test_ids", ",", "\n", ")", "=", "eval_model", "(", "\n", "model", ",", "\n", "test_data", ",", "\n", "metric_meta", "=", "task_def", ".", "metric_meta", ",", "\n", "device", "=", "device", ",", "\n", "with_label", "=", "with_label", ",", "\n", "label_mapper", "=", "label_dict", ",", "\n", "task_type", "=", "task_def", ".", "task_type", ",", "\n", ")", "\n", "", "for", "key", ",", "val", "in", "test_metrics", ".", "items", "(", ")", ":", "\n", "                ", "if", "tensorboard", ":", "\n", "                    ", "tensorboard", ".", "add_scalar", "(", "\n", "\"{}/{}/{}\"", ".", "format", "(", "test_prefix", ",", "dataset", ",", "key", ")", ",", "\n", "val", ",", "\n", "global_step", "=", "updates", ",", "\n", ")", "\n", "", "if", "isinstance", "(", "val", ",", "str", ")", ":", "\n", "                    ", "print_message", "(", "\n", "logger", ",", "\n", "\"Task {0} -- {1} {2} -- {3} {4}: {5}\"", ".", "format", "(", "\n", "dataset", ",", "updates_str", ",", "updates", ",", "test_prefix", ",", "key", ",", "val", "\n", ")", ",", "\n", "level", "=", "1", ",", "\n", ")", "\n", "", "elif", "isinstance", "(", "val", ",", "float", ")", ":", "\n", "                    ", "print_message", "(", "\n", "logger", ",", "\n", "\"Task {0} -- {1} {2} -- {3} {4}: {5:.3f}\"", ".", "format", "(", "\n", "dataset", ",", "updates_str", ",", "updates", ",", "test_prefix", ",", "key", ",", "val", "\n", ")", ",", "\n", "level", "=", "1", ",", "\n", ")", "\n", "", "else", ":", "\n", "                    ", "test_metrics", "[", "key", "]", "=", "str", "(", "val", ")", "\n", "print_message", "(", "\n", "logger", ",", "\n", "\"Task {0} -- {1} {2} -- {3} {4}: \\n{5}\"", ".", "format", "(", "\n", "dataset", ",", "updates_str", ",", "updates", ",", "test_prefix", ",", "key", ",", "val", "\n", ")", ",", "\n", "level", "=", "1", ",", "\n", ")", "\n", "\n", "", "", "if", "args", ".", "local_rank", "in", "[", "-", "1", ",", "0", "]", ":", "\n", "                ", "score_file", "=", "os", ".", "path", ".", "join", "(", "\n", "output_dir", ",", "\n", "\"{}_{}_scores_{}_{}.json\"", ".", "format", "(", "\n", "dataset", ",", "test_prefix", ".", "lower", "(", ")", ",", "updates_str", ",", "updates", "\n", ")", ",", "\n", ")", "\n", "results", "=", "{", "\n", "\"metrics\"", ":", "test_metrics", ",", "\n", "\"predictions\"", ":", "test_predictions", ",", "\n", "\"uids\"", ":", "test_ids", ",", "\n", "\"scores\"", ":", "test_scores", ",", "\n", "}", "\n", "dump", "(", "score_file", ",", "results", ")", "\n", "if", "glue_format_on", ":", "\n", "                    ", "from", "experiments", ".", "glue", ".", "glue_utils", "import", "submit", "\n", "\n", "official_score_file", "=", "os", ".", "path", ".", "join", "(", "\n", "output_dir", ",", "\n", "\"{}_{}_scores_{}.tsv\"", ".", "format", "(", "\n", "dataset", ",", "test_prefix", ".", "lower", "(", ")", ",", "updates_str", "\n", ")", ",", "\n", ")", "\n", "submit", "(", "official_score_file", ",", "results", ",", "label_dict", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.initialize_distributed": [[349, 373], ["int", "int", "int", "train.print_message", "torch.cuda.set_device", "torch.device", "os.getenv", "os.getenv", "torch.distributed.init_process_group", "os.getenv", "os.getenv", "torch.cuda.device_count"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message"], ["", "", "", "", "", "def", "initialize_distributed", "(", "logger", ",", "args", ")", ":", "\n", "    ", "\"\"\"Initialize torch.distributed.\"\"\"", "\n", "args", ".", "rank", "=", "int", "(", "os", ".", "getenv", "(", "\"RANK\"", ",", "\"0\"", ")", ")", "\n", "args", ".", "world_size", "=", "int", "(", "os", ".", "getenv", "(", "\"WORLD_SIZE\"", ",", "\"1\"", ")", ")", "\n", "batch_size_pre_gpu", "=", "int", "(", "args", ".", "batch_size", "/", "args", ".", "world_size", ")", "\n", "print_message", "(", "logger", ",", "\"Batch Size Per GPU: {}\"", ".", "format", "(", "batch_size_pre_gpu", ")", ")", "\n", "\n", "device", "=", "args", ".", "rank", "%", "torch", ".", "cuda", ".", "device_count", "(", ")", "\n", "if", "args", ".", "local_rank", "is", "not", "None", ":", "\n", "        ", "device", "=", "args", ".", "local_rank", "\n", "", "torch", ".", "cuda", ".", "set_device", "(", "device", ")", "\n", "device", "=", "torch", ".", "device", "(", "\"cuda\"", ",", "args", ".", "local_rank", ")", "\n", "# Call the init process", "\n", "init_method", "=", "\"tcp://\"", "\n", "master_ip", "=", "os", ".", "getenv", "(", "\"MASTER_ADDR\"", ",", "\"localhost\"", ")", "\n", "master_port", "=", "os", ".", "getenv", "(", "\"MASTER_PORT\"", ",", "\"6600\"", ")", "\n", "init_method", "+=", "master_ip", "+", "\":\"", "+", "master_port", "\n", "torch", ".", "distributed", ".", "init_process_group", "(", "\n", "backend", "=", "args", ".", "backend", ",", "\n", "world_size", "=", "args", ".", "world_size", ",", "\n", "rank", "=", "args", ".", "rank", ",", "\n", "init_method", "=", "init_method", ",", "\n", ")", "\n", "return", "device", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message": [[375, 388], ["torch.distributed.is_initialized", "torch.distributed.get_rank", "logger.warning", "logger.info"], "function", ["None"], ["", "def", "print_message", "(", "logger", ",", "message", ",", "level", "=", "0", ")", ":", "\n", "    ", "if", "torch", ".", "distributed", ".", "is_initialized", "(", ")", ":", "\n", "        ", "if", "torch", ".", "distributed", ".", "get_rank", "(", ")", "==", "0", ":", "\n", "            ", "do_logging", "=", "True", "\n", "", "else", ":", "\n", "            ", "do_logging", "=", "False", "\n", "", "", "else", ":", "\n", "        ", "do_logging", "=", "True", "\n", "", "if", "do_logging", ":", "\n", "        ", "if", "level", "==", "1", ":", "\n", "            ", "logger", ".", "warning", "(", "message", ")", "\n", "", "else", ":", "\n", "            ", "logger", ".", "info", "(", "message", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.main": [[390, 775], ["torch.device", "vars", "train.print_message", "mt_dnn.batcher.Collater", "mt_dnn.batcher.MultiTaskDataset", "torch.utils.data.DataLoader", "mt_dnn.batcher.Collater", "train.print_message", "train.print_message", "train.print_message", "train.print_message", "train.print_message", "train.print_message", "train.print_message", "train.print_message", "os.path.exists", "vars.update", "mt_dnn.model.MTDNNModel", "train.print_message", "os.path.join", "train.print_message", "range", "train.initialize_distributed", "torch.cuda.is_available", "len", "task_defs.get_task_def", "task_def_list.append", "os.path.join", "train.print_message", "mt_dnn.batcher.SingleTaskDataset", "train_datasets.append", "mt_dnn.batcher.DistMultiTaskBatchSampler", "mt_dnn.batcher.MultiTaskBatchSampler", "task_defs.get_task_def", "os.path.join", "os.path.exists", "dev_data_list.append", "os.path.join", "os.path.exists", "test_data_list.append", "data_utils.task_def.EncoderModelType().name.lower", "config_class.from_pretrained().to_dict", "train.print_message", "mt_dnn.model.MTDNNModel.load", "open", "writer.write", "writer.write", "os.path.join", "tensorboardX.SummaryWriter", "enumerate", "train.print_message", "datetime.datetime.now", "enumerate", "train.evaluation", "train.evaluation", "train.print_message", "tensorboardX.SummaryWriter.close", "torch.device", "torch.device", "dataset.split", "dataset.split", "mt_dnn.batcher.SingleTaskDataset", "mt_dnn.batcher.SingleTaskDataset", "len", "torch.load", "ValueError", "torch.save", "mt_dnn.batcher.Collater.patch_data", "mt_dnn.model.MTDNNModel.update", "os.path.join", "mt_dnn.model.MTDNNModel.save", "mt_dnn.batcher.DistTaskDataset", "mt_dnn.batcher.DistSingleTaskBatchSampler", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "mt_dnn.batcher.DistTaskDataset", "mt_dnn.batcher.DistSingleTaskBatchSampler", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "len", "torch.load", "arch.replace.replace", "update_roberta_keys", "patch_name_dict", "data_utils.task_def.EncoderModelType().name.lower", "config_class.from_pretrained().to_dict", "config_class.from_pretrained", "json.dumps", "dataset.split", "torch.no_grad", "mt_dnn.inference.extract_encoding", "os.path.join", "train.print_message", "os.path.join", "train.evaluation", "train.evaluation", "train.print_message", "mt_dnn.model.MTDNNModel.save", "data_utils.task_def.EncoderModelType", "str().split", "tensorboardX.SummaryWriter.add_scalar", "config_class.from_pretrained", "data_utils.task_def.EncoderModelType", "str", "datetime.datetime.now", "len"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.update", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.initialize_distributed", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.exp_def.TaskDefs.get_task_def", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.exp_def.TaskDefs.get_task_def", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.evaluation", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.evaluation", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater.patch_data", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.update", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.roberta_utils.update_roberta_keys", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.roberta_utils.patch_name_dict", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.inference.extract_encoding", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.evaluation", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.evaluation", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.print_message", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save"], ["", "", "", "def", "main", "(", ")", ":", "\n", "# set up dist", "\n", "    ", "device", "=", "torch", ".", "device", "(", "\"cuda\"", ")", "\n", "if", "args", ".", "local_rank", ">", "-", "1", ":", "\n", "        ", "device", "=", "initialize_distributed", "(", "logger", ",", "args", ")", "\n", "", "elif", "torch", ".", "cuda", ".", "is_available", "(", ")", ":", "\n", "        ", "device", "=", "torch", ".", "device", "(", "\"cuda\"", ")", "\n", "", "else", ":", "\n", "        ", "device", "=", "torch", ".", "device", "(", "\"cpu\"", ")", "\n", "\n", "", "opt", "=", "vars", "(", "args", ")", "\n", "# update data dir", "\n", "opt", "[", "\"data_dir\"", "]", "=", "data_dir", "\n", "batch_size", "=", "args", ".", "batch_size", "\n", "print_message", "(", "logger", ",", "\"Launching the MT-DNN training\"", ")", "\n", "# return", "\n", "tasks", "=", "{", "}", "\n", "task_def_list", "=", "[", "]", "\n", "dropout_list", "=", "[", "]", "\n", "printable", "=", "args", ".", "local_rank", "in", "[", "-", "1", ",", "0", "]", "\n", "\n", "train_datasets", "=", "[", "]", "\n", "for", "dataset", "in", "args", ".", "train_datasets", ":", "\n", "        ", "prefix", "=", "dataset", ".", "split", "(", "\"_\"", ")", "[", "0", "]", "\n", "if", "prefix", "in", "tasks", ":", "\n", "            ", "continue", "\n", "", "task_id", "=", "len", "(", "tasks", ")", "\n", "tasks", "[", "prefix", "]", "=", "task_id", "\n", "task_def", "=", "task_defs", ".", "get_task_def", "(", "prefix", ")", "\n", "task_def_list", ".", "append", "(", "task_def", ")", "\n", "train_path", "=", "os", ".", "path", ".", "join", "(", "data_dir", ",", "\"{}_train.json\"", ".", "format", "(", "dataset", ")", ")", "\n", "print_message", "(", "logger", ",", "\"Loading {} as task {}\"", ".", "format", "(", "train_path", ",", "task_id", ")", ")", "\n", "train_data_set", "=", "SingleTaskDataset", "(", "\n", "train_path", ",", "\n", "True", ",", "\n", "maxlen", "=", "args", ".", "max_seq_len", ",", "\n", "task_id", "=", "task_id", ",", "\n", "task_def", "=", "task_def", ",", "\n", "printable", "=", "printable", ",", "\n", ")", "\n", "train_datasets", ".", "append", "(", "train_data_set", ")", "\n", "", "train_collater", "=", "Collater", "(", "\n", "dropout_w", "=", "args", ".", "dropout_w", ",", "\n", "encoder_type", "=", "encoder_type", ",", "\n", "soft_label", "=", "args", ".", "mkd_opt", ">", "0", ",", "\n", "max_seq_len", "=", "args", ".", "max_seq_len", ",", "\n", "do_padding", "=", "args", ".", "do_padding", ",", "\n", ")", "\n", "multi_task_train_dataset", "=", "MultiTaskDataset", "(", "train_datasets", ")", "\n", "if", "args", ".", "local_rank", "!=", "-", "1", ":", "\n", "        ", "multi_task_batch_sampler", "=", "DistMultiTaskBatchSampler", "(", "\n", "train_datasets", ",", "\n", "args", ".", "batch_size", ",", "\n", "args", ".", "mix_opt", ",", "\n", "args", ".", "ratio", ",", "\n", "rank", "=", "args", ".", "local_rank", ",", "\n", "world_size", "=", "args", ".", "world_size", ",", "\n", ")", "\n", "", "else", ":", "\n", "        ", "multi_task_batch_sampler", "=", "MultiTaskBatchSampler", "(", "\n", "train_datasets", ",", "\n", "args", ".", "batch_size", ",", "\n", "args", ".", "mix_opt", ",", "\n", "args", ".", "ratio", ",", "\n", "bin_on", "=", "args", ".", "bin_on", ",", "\n", "bin_size", "=", "args", ".", "bin_size", ",", "\n", "bin_grow_ratio", "=", "args", ".", "bin_grow_ratio", ",", "\n", ")", "\n", "", "multi_task_train_data", "=", "DataLoader", "(", "\n", "multi_task_train_dataset", ",", "\n", "batch_sampler", "=", "multi_task_batch_sampler", ",", "\n", "collate_fn", "=", "train_collater", ".", "collate_fn", ",", "\n", "pin_memory", "=", "args", ".", "cuda", ",", "\n", ")", "\n", "\n", "opt", "[", "\"task_def_list\"", "]", "=", "task_def_list", "\n", "\n", "dev_data_list", "=", "[", "]", "\n", "test_data_list", "=", "[", "]", "\n", "test_collater", "=", "Collater", "(", "\n", "is_train", "=", "False", ",", "\n", "encoder_type", "=", "encoder_type", ",", "\n", "max_seq_len", "=", "args", ".", "max_seq_len", ",", "\n", "do_padding", "=", "args", ".", "do_padding", ",", "\n", ")", "\n", "for", "dataset", "in", "args", ".", "test_datasets", ":", "\n", "        ", "prefix", "=", "dataset", ".", "split", "(", "\"_\"", ")", "[", "0", "]", "\n", "task_def", "=", "task_defs", ".", "get_task_def", "(", "prefix", ")", "\n", "task_id", "=", "tasks", "[", "prefix", "]", "\n", "task_type", "=", "task_def", ".", "task_type", "\n", "data_type", "=", "task_def", ".", "data_type", "\n", "\n", "dev_path", "=", "os", ".", "path", ".", "join", "(", "data_dir", ",", "\"{}_dev.json\"", ".", "format", "(", "dataset", ")", ")", "\n", "dev_data", "=", "None", "\n", "if", "os", ".", "path", ".", "exists", "(", "dev_path", ")", ":", "\n", "            ", "dev_data_set", "=", "SingleTaskDataset", "(", "\n", "dev_path", ",", "\n", "False", ",", "\n", "maxlen", "=", "args", ".", "max_seq_len", ",", "\n", "task_id", "=", "task_id", ",", "\n", "task_def", "=", "task_def", ",", "\n", "printable", "=", "printable", ",", "\n", ")", "\n", "if", "args", ".", "local_rank", "!=", "-", "1", ":", "\n", "                ", "dev_data_set", "=", "DistTaskDataset", "(", "dev_data_set", ",", "task_id", ")", "\n", "single_task_batch_sampler", "=", "DistSingleTaskBatchSampler", "(", "\n", "dev_data_set", ",", "\n", "args", ".", "batch_size_eval", ",", "\n", "rank", "=", "args", ".", "local_rank", ",", "\n", "world_size", "=", "args", ".", "world_size", ",", "\n", ")", "\n", "dev_data", "=", "DataLoader", "(", "\n", "dev_data_set", ",", "\n", "batch_sampler", "=", "single_task_batch_sampler", ",", "\n", "collate_fn", "=", "test_collater", ".", "collate_fn", ",", "\n", "pin_memory", "=", "args", ".", "cuda", ",", "\n", ")", "\n", "", "else", ":", "\n", "                ", "dev_data", "=", "DataLoader", "(", "\n", "dev_data_set", ",", "\n", "batch_size", "=", "args", ".", "batch_size_eval", ",", "\n", "collate_fn", "=", "test_collater", ".", "collate_fn", ",", "\n", "pin_memory", "=", "args", ".", "cuda", ",", "\n", ")", "\n", "", "", "dev_data_list", ".", "append", "(", "dev_data", ")", "\n", "\n", "test_path", "=", "os", ".", "path", ".", "join", "(", "data_dir", ",", "\"{}_test.json\"", ".", "format", "(", "dataset", ")", ")", "\n", "test_data", "=", "None", "\n", "if", "os", ".", "path", ".", "exists", "(", "test_path", ")", ":", "\n", "            ", "test_data_set", "=", "SingleTaskDataset", "(", "\n", "test_path", ",", "\n", "False", ",", "\n", "maxlen", "=", "args", ".", "max_seq_len", ",", "\n", "task_id", "=", "task_id", ",", "\n", "task_def", "=", "task_def", ",", "\n", "printable", "=", "printable", ",", "\n", ")", "\n", "if", "args", ".", "local_rank", "!=", "-", "1", ":", "\n", "                ", "test_data_set", "=", "DistTaskDataset", "(", "test_data_set", ",", "task_id", ")", "\n", "single_task_batch_sampler", "=", "DistSingleTaskBatchSampler", "(", "\n", "test_data_set", ",", "\n", "args", ".", "batch_size_eval", ",", "\n", "rank", "=", "args", ".", "local_rank", ",", "\n", "world_size", "=", "args", ".", "world_size", ",", "\n", ")", "\n", "test_data", "=", "DataLoader", "(", "\n", "test_data_set", ",", "\n", "batch_sampler", "=", "single_task_batch_sampler", ",", "\n", "collate_fn", "=", "test_collater", ".", "collate_fn", ",", "\n", "pin_memory", "=", "args", ".", "cuda", ",", "\n", ")", "\n", "", "else", ":", "\n", "                ", "test_data", "=", "DataLoader", "(", "\n", "test_data_set", ",", "\n", "batch_size", "=", "args", ".", "batch_size_eval", ",", "\n", "collate_fn", "=", "test_collater", ".", "collate_fn", ",", "\n", "pin_memory", "=", "args", ".", "cuda", ",", "\n", ")", "\n", "", "", "test_data_list", ".", "append", "(", "test_data", ")", "\n", "\n", "", "print_message", "(", "logger", ",", "\"#\"", "*", "20", ")", "\n", "print_message", "(", "logger", ",", "opt", ")", "\n", "print_message", "(", "logger", ",", "\"#\"", "*", "20", ")", "\n", "\n", "# div number of grad accumulation.", "\n", "num_all_batches", "=", "(", "\n", "args", ".", "epochs", "*", "len", "(", "multi_task_train_data", ")", "//", "args", ".", "grad_accumulation_step", "\n", ")", "\n", "print_message", "(", "logger", ",", "\"############# Gradient Accumulation Info #############\"", ")", "\n", "print_message", "(", "\n", "logger", ",", "\"number of step: {}\"", ".", "format", "(", "args", ".", "epochs", "*", "len", "(", "multi_task_train_data", ")", ")", "\n", ")", "\n", "print_message", "(", "\n", "logger", ",", "\n", "\"number of grad grad_accumulation step: {}\"", ".", "format", "(", "args", ".", "grad_accumulation_step", ")", ",", "\n", ")", "\n", "print_message", "(", "logger", ",", "\"adjusted number of step: {}\"", ".", "format", "(", "num_all_batches", ")", ")", "\n", "print_message", "(", "logger", ",", "\"############# Gradient Accumulation Info #############\"", ")", "\n", "\n", "init_model", "=", "args", ".", "init_checkpoint", "\n", "state_dict", "=", "None", "\n", "\n", "if", "os", ".", "path", ".", "exists", "(", "init_model", ")", ":", "\n", "        ", "if", "(", "\n", "encoder_type", "==", "EncoderModelType", ".", "BERT", "\n", "or", "encoder_type", "==", "EncoderModelType", ".", "DEBERTA", "\n", "or", "encoder_type", "==", "EncoderModelType", ".", "ELECTRA", "\n", ")", ":", "\n", "            ", "state_dict", "=", "torch", ".", "load", "(", "init_model", ",", "map_location", "=", "device", ")", "\n", "config", "=", "state_dict", "[", "\"config\"", "]", "\n", "", "elif", "(", "\n", "encoder_type", "==", "EncoderModelType", ".", "ROBERTA", "\n", "or", "encoder_type", "==", "EncoderModelType", ".", "XLM", "\n", ")", ":", "\n", "            ", "model_path", "=", "\"{}/model.pt\"", ".", "format", "(", "init_model", ")", "\n", "state_dict", "=", "torch", ".", "load", "(", "model_path", ",", "map_location", "=", "device", ")", "\n", "arch", "=", "state_dict", "[", "\"args\"", "]", ".", "arch", "\n", "arch", "=", "arch", ".", "replace", "(", "\"_\"", ",", "\"-\"", ")", "\n", "if", "encoder_type", "==", "EncoderModelType", ".", "XLM", ":", "\n", "                ", "arch", "=", "\"xlm-{}\"", ".", "format", "(", "arch", ")", "\n", "# convert model arch", "\n", "", "from", "data_utils", ".", "roberta_utils", "import", "update_roberta_keys", "\n", "from", "data_utils", ".", "roberta_utils", "import", "patch_name_dict", "\n", "\n", "state", "=", "update_roberta_keys", "(", "\n", "state_dict", "[", "\"model\"", "]", ",", "nlayer", "=", "state_dict", "[", "\"args\"", "]", ".", "encoder_layers", "\n", ")", "\n", "state", "=", "patch_name_dict", "(", "state", ")", "\n", "literal_encoder_type", "=", "EncoderModelType", "(", "opt", "[", "\"encoder_type\"", "]", ")", ".", "name", ".", "lower", "(", ")", "\n", "config_class", ",", "model_class", ",", "tokenizer_class", "=", "MODEL_CLASSES", "[", "\n", "literal_encoder_type", "\n", "]", "\n", "config", "=", "config_class", ".", "from_pretrained", "(", "arch", ")", ".", "to_dict", "(", ")", "\n", "state_dict", "=", "{", "\"state\"", ":", "state", "}", "\n", "", "", "else", ":", "\n", "        ", "if", "opt", "[", "\"encoder_type\"", "]", "not", "in", "EncoderModelType", ".", "_value2member_map_", ":", "\n", "            ", "raise", "ValueError", "(", "\"encoder_type is out of pre-defined types\"", ")", "\n", "", "literal_encoder_type", "=", "EncoderModelType", "(", "opt", "[", "\"encoder_type\"", "]", ")", ".", "name", ".", "lower", "(", ")", "\n", "config_class", ",", "model_class", ",", "tokenizer_class", "=", "MODEL_CLASSES", "[", "literal_encoder_type", "]", "\n", "config", "=", "config_class", ".", "from_pretrained", "(", "\n", "init_model", ",", "cache_dir", "=", "args", ".", "transformer_cache", "\n", ")", ".", "to_dict", "(", ")", "\n", "\n", "", "config", "[", "\"attention_probs_dropout_prob\"", "]", "=", "args", ".", "bert_dropout_p", "\n", "config", "[", "\"hidden_dropout_prob\"", "]", "=", "args", ".", "bert_dropout_p", "\n", "config", "[", "\"multi_gpu_on\"", "]", "=", "opt", "[", "\"multi_gpu_on\"", "]", "\n", "if", "args", ".", "num_hidden_layers", ">", "0", ":", "\n", "        ", "config", "[", "\"num_hidden_layers\"", "]", "=", "args", ".", "num_hidden_layers", "\n", "\n", "", "opt", ".", "update", "(", "config", ")", "\n", "\n", "model", "=", "MTDNNModel", "(", "\n", "opt", ",", "device", "=", "device", ",", "state_dict", "=", "state_dict", ",", "num_train_step", "=", "num_all_batches", "\n", ")", "\n", "if", "args", ".", "resume", "and", "args", ".", "model_ckpt", ":", "\n", "        ", "print_message", "(", "logger", ",", "\"loading model from {}\"", ".", "format", "(", "args", ".", "model_ckpt", ")", ")", "\n", "model", ".", "load", "(", "args", ".", "model_ckpt", ")", "\n", "\n", "#### model meta str", "\n", "", "headline", "=", "\"############# Model Arch of MT-DNN #############\"", "\n", "### print network", "\n", "print_message", "(", "logger", ",", "\"\\n{}\\n{}\\n\"", ".", "format", "(", "headline", ",", "model", ".", "network", ")", ")", "\n", "\n", "# dump config", "\n", "config_file", "=", "os", ".", "path", ".", "join", "(", "output_dir", ",", "\"config.json\"", ")", "\n", "with", "open", "(", "config_file", ",", "\"w\"", ",", "encoding", "=", "\"utf-8\"", ")", "as", "writer", ":", "\n", "        ", "writer", ".", "write", "(", "\"{}\\n\"", ".", "format", "(", "json", ".", "dumps", "(", "opt", ")", ")", ")", "\n", "writer", ".", "write", "(", "\"\\n{}\\n{}\\n\"", ".", "format", "(", "headline", ",", "model", ".", "network", ")", ")", "\n", "\n", "", "print_message", "(", "logger", ",", "\"Total number of params: {}\"", ".", "format", "(", "model", ".", "total_param", ")", ")", "\n", "\n", "# tensorboard", "\n", "tensorboard", "=", "None", "\n", "if", "args", ".", "tensorboard", ":", "\n", "        ", "args", ".", "tensorboard_logdir", "=", "os", ".", "path", ".", "join", "(", "args", ".", "output_dir", ",", "args", ".", "tensorboard_logdir", ")", "\n", "tensorboard", "=", "SummaryWriter", "(", "log_dir", "=", "args", ".", "tensorboard_logdir", ")", "\n", "\n", "", "if", "args", ".", "encode_mode", ":", "\n", "        ", "for", "idx", ",", "dataset", "in", "enumerate", "(", "args", ".", "test_datasets", ")", ":", "\n", "            ", "prefix", "=", "dataset", ".", "split", "(", "\"_\"", ")", "[", "0", "]", "\n", "test_data", "=", "test_data_list", "[", "idx", "]", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "                ", "encoding", "=", "extract_encoding", "(", "model", ",", "test_data", ",", "use_cuda", "=", "args", ".", "cuda", ")", "\n", "", "torch", ".", "save", "(", "\n", "encoding", ",", "os", ".", "path", ".", "join", "(", "output_dir", ",", "\"{}_encoding.pt\"", ".", "format", "(", "dataset", ")", ")", "\n", ")", "\n", "", "return", "\n", "\n", "", "for", "epoch", "in", "range", "(", "0", ",", "args", ".", "epochs", ")", ":", "\n", "        ", "print_message", "(", "logger", ",", "\"At epoch {}\"", ".", "format", "(", "epoch", ")", ",", "level", "=", "1", ")", "\n", "start", "=", "datetime", ".", "now", "(", ")", "\n", "\n", "for", "i", ",", "(", "batch_meta", ",", "batch_data", ")", "in", "enumerate", "(", "multi_task_train_data", ")", ":", "\n", "            ", "batch_meta", ",", "batch_data", "=", "Collater", ".", "patch_data", "(", "device", ",", "batch_meta", ",", "batch_data", ")", "\n", "task_id", "=", "batch_meta", "[", "\"task_id\"", "]", "\n", "model", ".", "update", "(", "batch_meta", ",", "batch_data", ")", "\n", "\n", "if", "(", "model", ".", "updates", ")", "%", "(", "args", ".", "log_per_updates", ")", "==", "0", "or", "model", ".", "updates", "==", "1", ":", "\n", "                ", "ramaining_time", "=", "str", "(", "\n", "(", "datetime", ".", "now", "(", ")", "-", "start", ")", "\n", "/", "(", "i", "+", "1", ")", "\n", "*", "(", "len", "(", "multi_task_train_data", ")", "-", "i", "-", "1", ")", "\n", ")", ".", "split", "(", "\".\"", ")", "[", "0", "]", "\n", "if", "args", ".", "adv_train", "and", "args", ".", "debug", ":", "\n", "                    ", "debug_info", "=", "\" adv loss[%.5f] emb val[%.8f] eff_perturb[%.8f] \"", "%", "(", "\n", "model", ".", "adv_loss", ".", "avg", ",", "\n", "model", ".", "emb_val", ".", "avg", ",", "\n", "model", ".", "eff_perturb", ".", "avg", ",", "\n", ")", "\n", "", "else", ":", "\n", "                    ", "debug_info", "=", "\" \"", "\n", "", "print_message", "(", "\n", "logger", ",", "\n", "\"Task [{0:2}] updates[{1:6}] train loss[{2:.5f}]{3}remaining[{4}]\"", ".", "format", "(", "\n", "task_id", ",", "\n", "model", ".", "updates", ",", "\n", "model", ".", "train_loss", ".", "avg", ",", "\n", "debug_info", ",", "\n", "ramaining_time", ",", "\n", ")", ",", "\n", ")", "\n", "if", "args", ".", "tensorboard", ":", "\n", "                    ", "tensorboard", ".", "add_scalar", "(", "\n", "\"train/loss\"", ",", "model", ".", "train_loss", ".", "avg", ",", "global_step", "=", "model", ".", "updates", "\n", ")", "\n", "\n", "", "", "if", "(", "\n", "args", ".", "save_per_updates_on", "\n", "and", "(", "\n", "(", "model", ".", "local_updates", ")", "\n", "%", "(", "args", ".", "save_per_updates", "*", "args", ".", "grad_accumulation_step", ")", "\n", "==", "0", "\n", ")", "\n", "and", "args", ".", "local_rank", "in", "[", "-", "1", ",", "0", "]", "\n", ")", ":", "\n", "                ", "model_file", "=", "os", ".", "path", ".", "join", "(", "\n", "output_dir", ",", "\"model_{}_{}.pt\"", ".", "format", "(", "epoch", ",", "model", ".", "updates", ")", "\n", ")", "\n", "evaluation", "(", "\n", "model", ",", "\n", "args", ".", "test_datasets", ",", "\n", "dev_data_list", ",", "\n", "task_defs", ",", "\n", "output_dir", ",", "\n", "epoch", ",", "\n", "n_updates", "=", "args", ".", "save_per_updates", ",", "\n", "with_label", "=", "True", ",", "\n", "tensorboard", "=", "tensorboard", ",", "\n", "glue_format_on", "=", "args", ".", "glue_format_on", ",", "\n", "test_on", "=", "False", ",", "\n", "device", "=", "device", ",", "\n", "logger", "=", "logger", ",", "\n", ")", "\n", "evaluation", "(", "\n", "model", ",", "\n", "args", ".", "test_datasets", ",", "\n", "test_data_list", ",", "\n", "task_defs", ",", "\n", "output_dir", ",", "\n", "epoch", ",", "\n", "n_updates", "=", "args", ".", "save_per_updates", ",", "\n", "with_label", "=", "False", ",", "\n", "tensorboard", "=", "tensorboard", ",", "\n", "glue_format_on", "=", "args", ".", "glue_format_on", ",", "\n", "test_on", "=", "True", ",", "\n", "device", "=", "device", ",", "\n", "logger", "=", "logger", ",", "\n", ")", "\n", "print_message", "(", "logger", ",", "\"Saving mt-dnn model to {}\"", ".", "format", "(", "model_file", ")", ")", "\n", "model", ".", "save", "(", "model_file", ")", "\n", "\n", "", "", "evaluation", "(", "\n", "model", ",", "\n", "args", ".", "test_datasets", ",", "\n", "dev_data_list", ",", "\n", "task_defs", ",", "\n", "output_dir", ",", "\n", "epoch", ",", "\n", "with_label", "=", "True", ",", "\n", "tensorboard", "=", "tensorboard", ",", "\n", "glue_format_on", "=", "args", ".", "glue_format_on", ",", "\n", "test_on", "=", "False", ",", "\n", "device", "=", "device", ",", "\n", "logger", "=", "logger", ",", "\n", ")", "\n", "evaluation", "(", "\n", "model", ",", "\n", "args", ".", "test_datasets", ",", "\n", "test_data_list", ",", "\n", "task_defs", ",", "\n", "output_dir", ",", "\n", "epoch", ",", "\n", "with_label", "=", "False", ",", "\n", "tensorboard", "=", "tensorboard", ",", "\n", "glue_format_on", "=", "args", ".", "glue_format_on", ",", "\n", "test_on", "=", "True", ",", "\n", "device", "=", "device", ",", "\n", "logger", "=", "logger", ",", "\n", ")", "\n", "print_message", "(", "logger", ",", "\"[new test scores at {} saved.]\"", ".", "format", "(", "epoch", ")", ")", "\n", "if", "args", ".", "local_rank", "in", "[", "-", "1", ",", "0", "]", ":", "\n", "            ", "model_file", "=", "os", ".", "path", ".", "join", "(", "output_dir", ",", "\"model_{}.pt\"", ".", "format", "(", "epoch", ")", ")", "\n", "model", ".", "save", "(", "model_file", ")", "\n", "", "", "if", "args", ".", "tensorboard", ":", "\n", "        ", "tensorboard", ".", "close", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.int_test_encoder.test_encoder": [[18, 56], ["subprocess.call", "print", "print", "subprocess.call", "torch.load", "torch.load", "torch.LongTensor().fill_", "enumerate", "numpy.masked_array", "os.access", "os.access", "open", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "torch.LongTensor().fill_", "ma.masked_array.mean", "ma.masked_array.mean", "os.path.join", "os.path.join", "json.loads", "input_lengths.append", "torch.LongTensor", "len", "len", "max", "torch.LongTensor", "torch.load.size", "torch.load.size"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load"], ["def", "test_encoder", "(", "src_dir", ",", "checkpoint_path", ",", "encoder_type", ",", "target_dir", ",", "expected_dir", ")", ":", "\n", "    ", "subprocess", ".", "call", "(", "\"rm -rf %s\"", "%", "target_dir", ",", "shell", "=", "True", ")", "\n", "assert", "not", "os", ".", "access", "(", "\n", "target_dir", ",", "os", ".", "F_OK", "\n", ")", ",", "\"preprocessed target directory already exist\"", "\n", "cmd", "=", "ENCODE_CMD", "%", "(", "src_dir", ",", "checkpoint_path", ",", "encoder_type", ",", "target_dir", ")", "\n", "print", "(", "\"execute cmd:\"", ")", "\n", "print", "(", "cmd", ")", "\n", "subprocess", ".", "call", "(", "cmd", ",", "shell", "=", "True", ",", "stdout", "=", "subprocess", ".", "DEVNULL", ")", "\n", "\n", "# get masks from unit_test input file (cola_test.json)", "\n", "input_lengths", "=", "[", "]", "\n", "with", "open", "(", "os", ".", "path", ".", "join", "(", "src_dir", ",", "\"cola_test.json\"", ")", ",", "\"r\"", ",", "encoding", "=", "\"utf-8\"", ")", "as", "fin", ":", "\n", "        ", "for", "line", "in", "fin", ":", "\n", "            ", "json_line", "=", "json", ".", "loads", "(", "line", ")", "\n", "assert", "(", "\n", "\"token_id\"", "in", "json_line", "\n", ")", ",", "\"token_id is not in current test file, please check name of token ids in input json\"", "\n", "input_lengths", ".", "append", "(", "len", "(", "json_line", "[", "\"token_id\"", "]", ")", ")", "\n", "\n", "", "", "encoding_0", "=", "torch", ".", "load", "(", "os", ".", "path", ".", "join", "(", "target_dir", ",", "r\"cola_encoding.pt\"", ")", ")", "\n", "encoding_1", "=", "torch", ".", "load", "(", "os", ".", "path", ".", "join", "(", "expected_dir", ",", "r\"cola_encoding.pt\"", ")", ")", "\n", "\n", "abs_diff", "=", "(", "encoding_0", "-", "encoding_1", ")", ".", "abs", "(", ")", "\n", "abs_avg", "=", "(", "(", "encoding_0", "+", "encoding_1", ")", "/", "2", ")", ".", "abs", "(", ")", "\n", "\n", "tensor_mask", "=", "torch", ".", "LongTensor", "(", "\n", "len", "(", "input_lengths", ")", ",", "max", "(", "input_lengths", ")", ",", "encoding_0", ".", "size", "(", ")", "[", "-", "1", "]", "\n", ")", ".", "fill_", "(", "1", ")", "\n", "for", "index", ",", "input_length", "in", "enumerate", "(", "input_lengths", ")", ":", "\n", "        ", "tensor_mask", "[", "index", ",", ":", "input_length", ",", ":", "]", "=", "torch", ".", "LongTensor", "(", "\n", "input_length", ",", "encoding_0", ".", "size", "(", ")", "[", "-", "1", "]", "\n", ")", ".", "fill_", "(", "0", ")", "\n", "\n", "", "relative_diff", "=", "abs_diff", "/", "abs_avg", "\n", "masked_array", "=", "ma", ".", "masked_array", "(", "relative_diff", ",", "mask", "=", "tensor_mask", ")", "\n", "\n", "assert", "masked_array", ".", "mean", "(", ")", "<", "1e-4", ",", "\"relative diff: %s\"", "%", "masked_array", ".", "mean", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.prepro_std.feature_extractor": [[30, 58], ["tokenizer", "len", "len", "len", "len", "len", "len", "len"], "function", ["None"], ["def", "feature_extractor", "(", "tokenizer", ",", "text_a", ",", "text_b", "=", "None", ",", "max_length", "=", "512", ",", "do_padding", "=", "False", ")", ":", "\n", "    ", "inputs", "=", "tokenizer", "(", "\n", "text_a", ",", "\n", "text_b", ",", "\n", "add_special_tokens", "=", "True", ",", "\n", "max_length", "=", "max_length", ",", "\n", "truncation", "=", "True", ",", "\n", "padding", "=", "do_padding", ",", "\n", ")", "\n", "input_ids", "=", "inputs", "[", "\"input_ids\"", "]", "\n", "token_type_ids", "=", "(", "\n", "inputs", "[", "\"token_type_ids\"", "]", "if", "\"token_type_ids\"", "in", "inputs", "else", "[", "0", "]", "*", "len", "(", "input_ids", ")", "\n", ")", "\n", "\n", "# The mask has 1 for real tokens and 0 for padding tokens. Only real", "\n", "# tokens are attended to.", "\n", "attention_mask", "=", "inputs", "[", "\"attention_mask\"", "]", "\n", "if", "do_padding", ":", "\n", "        ", "assert", "len", "(", "input_ids", ")", "==", "max_length", ",", "\"Error with input length {} vs {}\"", ".", "format", "(", "\n", "len", "(", "input_ids", ")", ",", "max_length", "\n", ")", "\n", "assert", "(", "\n", "len", "(", "attention_mask", ")", "==", "max_length", "\n", ")", ",", "\"Error with input length {} vs {}\"", ".", "format", "(", "len", "(", "attention_mask", ")", ",", "max_length", ")", "\n", "assert", "(", "\n", "len", "(", "token_type_ids", ")", "==", "max_length", "\n", ")", ",", "\"Error with input length {} vs {}\"", ".", "format", "(", "len", "(", "token_type_ids", ")", ",", "max_length", ")", "\n", "", "return", "input_ids", ",", "attention_mask", ",", "token_type_ids", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.prepro_std.extract_feature_premise_only": [[60, 73], ["prepro_std.feature_extractor"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.None.prepro_std.feature_extractor"], ["", "def", "extract_feature_premise_only", "(", "sample", ",", "max_seq_len", "=", "MAX_SEQ_LEN", ",", "tokenizer", "=", "None", ")", ":", "\n", "    ", "\"\"\"extract feature of single sentence tasks\"\"\"", "\n", "input_ids", ",", "input_mask", ",", "type_ids", "=", "feature_extractor", "(", "\n", "tokenizer", ",", "sample", "[", "\"premise\"", "]", ",", "max_length", "=", "max_seq_len", "\n", ")", "\n", "feature", "=", "{", "\n", "\"uid\"", ":", "sample", "[", "\"uid\"", "]", ",", "\n", "\"label\"", ":", "sample", "[", "\"label\"", "]", ",", "\n", "\"token_id\"", ":", "input_ids", ",", "\n", "\"type_id\"", ":", "type_ids", ",", "\n", "\"attention_mask\"", ":", "input_mask", ",", "\n", "}", "\n", "return", "feature", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.prepro_std.extract_feature_premise_and_one_hypo": [[75, 92], ["prepro_std.feature_extractor"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.None.prepro_std.feature_extractor"], ["", "def", "extract_feature_premise_and_one_hypo", "(", "\n", "sample", ",", "max_seq_len", "=", "MAX_SEQ_LEN", ",", "tokenizer", "=", "None", "\n", ")", ":", "\n", "    ", "input_ids", ",", "input_mask", ",", "type_ids", "=", "feature_extractor", "(", "\n", "tokenizer", ",", "\n", "sample", "[", "\"premise\"", "]", ",", "\n", "text_b", "=", "sample", "[", "\"hypothesis\"", "]", ",", "\n", "max_length", "=", "max_seq_len", ",", "\n", ")", "\n", "feature", "=", "{", "\n", "\"uid\"", ":", "sample", "[", "\"uid\"", "]", ",", "\n", "\"label\"", ":", "sample", "[", "\"label\"", "]", ",", "\n", "\"token_id\"", ":", "input_ids", ",", "\n", "\"type_id\"", ":", "type_ids", ",", "\n", "\"attention_mask\"", ":", "input_mask", ",", "\n", "}", "\n", "return", "feature", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.prepro_std.extract_feature_premise_and_multi_hypo": [[94, 121], ["prepro_std.feature_extractor", "input_ids_list.append", "type_ids_list.append", "attention_mask_list.append"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.None.prepro_std.feature_extractor"], ["", "def", "extract_feature_premise_and_multi_hypo", "(", "\n", "sample", ",", "max_seq_len", "=", "MAX_SEQ_LEN", ",", "tokenizer", "=", "None", "\n", ")", ":", "\n", "    ", "ids", "=", "sample", "[", "\"uid\"", "]", "\n", "premise", "=", "sample", "[", "\"premise\"", "]", "\n", "hypothesis_list", "=", "sample", "[", "\"hypothesis\"", "]", "\n", "label", "=", "sample", "[", "\"label\"", "]", "\n", "input_ids_list", "=", "[", "]", "\n", "type_ids_list", "=", "[", "]", "\n", "attention_mask_list", "=", "[", "]", "\n", "for", "hypothesis", "in", "hypothesis_list", ":", "\n", "        ", "input_ids", ",", "input_mask", ",", "type_ids", "=", "feature_extractor", "(", "\n", "tokenizer", ",", "premise", ",", "hypothesis", ",", "max_length", "=", "max_seq_len", "\n", ")", "\n", "input_ids_list", ".", "append", "(", "input_ids", ")", "\n", "type_ids_list", ".", "append", "(", "type_ids", ")", "\n", "attention_mask_list", ".", "append", "(", "input_mask", ")", "\n", "", "feature", "=", "{", "\n", "\"uid\"", ":", "ids", ",", "\n", "\"label\"", ":", "label", ",", "\n", "\"token_id\"", ":", "input_ids_list", ",", "\n", "\"type_id\"", ":", "type_ids_list", ",", "\n", "\"ruid\"", ":", "sample", "[", "\"ruid\"", "]", ",", "\n", "\"olabel\"", ":", "sample", "[", "\"olabel\"", "]", ",", "\n", "\"attention_mask\"", ":", "attention_mask_list", ",", "\n", "}", "\n", "return", "feature", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.prepro_std.extract_feature_sequence": [[123, 150], ["enumerate", "tokenizer.convert_tokens_to_ids", "tokenizer.tokenize", "tokens.extend", "range", "len", "len", "len", "len", "len", "labels.append", "labels.append"], "function", ["None"], ["", "def", "extract_feature_sequence", "(", "\n", "sample", ",", "max_seq_len", "=", "MAX_SEQ_LEN", ",", "tokenizer", "=", "None", ",", "label_mapper", "=", "None", "\n", ")", ":", "\n", "    ", "ids", "=", "sample", "[", "\"uid\"", "]", "\n", "premise", "=", "sample", "[", "\"premise\"", "]", "\n", "tokens", "=", "[", "]", "\n", "labels", "=", "[", "]", "\n", "for", "i", ",", "word", "in", "enumerate", "(", "premise", ")", ":", "\n", "        ", "subwords", "=", "tokenizer", ".", "tokenize", "(", "word", ")", "\n", "tokens", ".", "extend", "(", "subwords", ")", "\n", "for", "j", "in", "range", "(", "len", "(", "subwords", ")", ")", ":", "\n", "            ", "if", "j", "==", "0", ":", "\n", "                ", "labels", ".", "append", "(", "sample", "[", "\"label\"", "]", "[", "i", "]", ")", "\n", "", "else", ":", "\n", "                ", "labels", ".", "append", "(", "label_mapper", "[", "\"X\"", "]", ")", "\n", "", "", "", "if", "len", "(", "premise", ")", ">", "max_seq_len", "-", "2", ":", "\n", "        ", "tokens", "=", "tokens", "[", ":", "max_seq_len", "-", "2", "]", "\n", "labels", "=", "labels", "[", ":", "max_seq_len", "-", "2", "]", "\n", "\n", "", "label", "=", "[", "label_mapper", "[", "\"CLS\"", "]", "]", "+", "labels", "+", "[", "label_mapper", "[", "\"SEP\"", "]", "]", "\n", "input_ids", "=", "tokenizer", ".", "convert_tokens_to_ids", "(", "\n", "[", "tokenizer", ".", "cls_token", "]", "+", "tokens", "+", "[", "tokenizer", ".", "sep_token", "]", "\n", ")", "\n", "assert", "len", "(", "label", ")", "==", "len", "(", "input_ids", ")", "\n", "type_ids", "=", "[", "0", "]", "*", "len", "(", "input_ids", ")", "\n", "feature", "=", "{", "\"uid\"", ":", "ids", ",", "\"label\"", ":", "label", ",", "\"token_id\"", ":", "input_ids", ",", "\"type_id\"", ":", "type_ids", "}", "\n", "return", "feature", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.prepro_std.extract_feature_cloze_choice": [[151, 179], ["prepro_std.feature_extractor", "input_ids_list.append", "type_ids_list.append", "attention_mask_list.append"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.None.prepro_std.feature_extractor"], ["", "def", "extract_feature_cloze_choice", "(", "\n", "sample", ",", "max_seq_len", "=", "MAX_SEQ_LEN", ",", "tokenizer", "=", "None", "\n", ")", ":", "\n", "    ", "ids", "=", "sample", "[", "\"uid\"", "]", "\n", "premise", "=", "sample", "[", "\"premise\"", "]", "\n", "hypothesis_list", "=", "sample", "[", "\"hypothesis\"", "]", "\n", "label", "=", "sample", "[", "\"label\"", "]", "\n", "input_ids_list", "=", "[", "]", "\n", "type_ids_list", "=", "[", "]", "\n", "attention_mask_list", "=", "[", "]", "\n", "for", "hypothesis", "in", "hypothesis_list", ":", "\n", "        ", "input_ids", ",", "input_mask", ",", "type_ids", "=", "feature_extractor", "(", "\n", "tokenizer", ",", "premise", ",", "hypothesis", ",", "max_length", "=", "max_seq_len", "\n", ")", "\n", "input_ids_list", ".", "append", "(", "input_ids", ")", "\n", "type_ids_list", ".", "append", "(", "type_ids", ")", "\n", "attention_mask_list", ".", "append", "(", "input_mask", ")", "\n", "", "feature", "=", "{", "\n", "\"uid\"", ":", "ids", ",", "\n", "\"label\"", ":", "label", ",", "\n", "\"token_id\"", ":", "input_ids_list", ",", "\n", "\"type_id\"", ":", "type_ids_list", ",", "\n", "\"olabel\"", ":", "sample", "[", "\"olabel\"", "]", ",", "\n", "\"attention_mask\"", ":", "attention_mask_list", ",", "\n", "\"choice\"", ":", "sample", "[", "\"choice\"", "]", ",", "\n", "\"answer\"", ":", "sample", "[", "\"answer\"", "]", "\n", "}", "\n", "return", "feature", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.prepro_std.build_data": [[180, 235], ["functools.partial", "logger.info", "functools.partial", "multiprocessing.Pool", "pool.map", "open", "tqdm.tqdm", "open", "tqdm.tqdm", "functools.partial", "writer.write", "functools.partial.", "writer.write", "functools.partial", "len", "len", "functools.partial", "ValueError", "json.dumps", "json.dumps"], "function", ["None"], ["", "def", "build_data", "(", "\n", "data", ",", "\n", "dump_path", ",", "\n", "tokenizer", ",", "\n", "data_format", "=", "DataFormat", ".", "PremiseOnly", ",", "\n", "max_seq_len", "=", "MAX_SEQ_LEN", ",", "\n", "lab_dict", "=", "None", ",", "\n", "do_padding", "=", "False", ",", "\n", "truncation", "=", "True", ",", "\n", "workers", "=", "1", ",", "\n", ")", ":", "\n", "    ", "if", "data_format", "==", "DataFormat", ".", "PremiseOnly", ":", "\n", "        ", "partial_feature", "=", "partial", "(", "\n", "extract_feature_premise_only", ",", "max_seq_len", "=", "max_seq_len", ",", "tokenizer", "=", "tokenizer", "\n", ")", "\n", "", "elif", "data_format", "==", "DataFormat", ".", "PremiseAndOneHypothesis", ":", "\n", "        ", "partial_feature", "=", "partial", "(", "\n", "extract_feature_premise_and_one_hypo", ",", "\n", "max_seq_len", "=", "max_seq_len", ",", "\n", "tokenizer", "=", "tokenizer", ",", "\n", ")", "\n", "", "elif", "data_format", "==", "DataFormat", ".", "PremiseAndMultiHypothesis", ":", "\n", "        ", "partial_feature", "=", "partial", "(", "\n", "extract_feature_premise_and_multi_hypo", ",", "\n", "max_seq_len", "=", "max_seq_len", ",", "\n", "tokenizer", "=", "tokenizer", ",", "\n", ")", "\n", "", "elif", "data_format", "==", "DataFormat", ".", "Seqence", ":", "\n", "        ", "partial_feature", "=", "partial", "(", "\n", "extract_feature_sequence", ",", "\n", "max_seq_len", "=", "max_seq_len", ",", "\n", "tokenizer", "=", "tokenizer", ",", "\n", "label_mapper", "=", "lab_dict", ",", "\n", ")", "\n", "", "elif", "data_format", "==", "DataFormat", ".", "ClozeChoice", ":", "\n", "        ", "partial_feature", "=", "partial", "(", "\n", "extract_feature_cloze_choice", ",", "\n", "max_seq_len", "=", "max_seq_len", ",", "\n", "tokenizer", "=", "tokenizer", ",", "\n", ")", "\n", "", "else", ":", "\n", "        ", "raise", "ValueError", "(", "data_format", ")", "\n", "\n", "", "if", "workers", ">", "1", ":", "\n", "        ", "with", "multiprocessing", ".", "Pool", "(", "processes", "=", "workers", ")", "as", "pool", ":", "\n", "            ", "features", "=", "pool", ".", "map", "(", "partial_feature", ",", "data", ")", "\n", "", "logger", ".", "info", "(", "\"begin to write features\"", ")", "\n", "with", "open", "(", "dump_path", ",", "\"w\"", ",", "encoding", "=", "\"utf-8\"", ")", "as", "writer", ":", "\n", "            ", "for", "feature", "in", "tqdm", "(", "features", ",", "total", "=", "len", "(", "features", ")", ")", ":", "\n", "                ", "writer", ".", "write", "(", "\"{}\\n\"", ".", "format", "(", "json", ".", "dumps", "(", "feature", ")", ")", ")", "\n", "", "", "", "else", ":", "\n", "        ", "with", "open", "(", "dump_path", ",", "\"w\"", ",", "encoding", "=", "\"utf-8\"", ")", "as", "writer", ":", "\n", "            ", "for", "sample", "in", "tqdm", "(", "data", ",", "total", "=", "len", "(", "data", ")", ")", ":", "\n", "                ", "feature", "=", "partial_feature", "(", "sample", ")", "\n", "writer", ".", "write", "(", "\"{}\\n\"", ".", "format", "(", "json", ".", "dumps", "(", "feature", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.prepro_std.parse_args": [[237, 256], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.ner.prepro.parse_args"], ["", "", "", "", "def", "parse_args", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", "\n", "description", "=", "\"Preprocessing GLUE/SNLI/SciTail dataset.\"", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--model\"", ",", "\n", "type", "=", "str", ",", "\n", "default", "=", "\"bert-base-uncased\"", ",", "\n", "help", "=", "\"support all BERT and ROBERTA family supported by HuggingFace Transformers\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--do_padding\"", ",", "action", "=", "\"store_true\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--root_dir\"", ",", "type", "=", "str", ",", "default", "=", "\"data/canonical_data\"", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--task_def\"", ",", "type", "=", "str", ",", "default", "=", "\"experiments/glue/glue_task_def.yml\"", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--transformer_cache\"", ",", "default", "=", "\".cache\"", ",", "type", "=", "str", ")", "\n", "parser", ".", "add_argument", "(", "\"--workers\"", ",", "type", "=", "int", ",", "default", "=", "1", ")", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "return", "args", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.None.prepro_std.main": [[258, 291], ["os.path.exists", "transformers.AutoTokenizer.from_pretrained", "os.path.join", "experiments.exp_def.TaskDefs", "experiments.exp_def.TaskDefs.get_task_names", "os.path.isdir", "os.makedirs", "experiments.exp_def.TaskDefs.get_task_def", "logger.info", "os.path.join", "data_utils.load_data", "os.path.join", "logger.info", "prepro_std.build_data", "os.path.exists", "logger.warning", "sys.exit"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.exp_def.TaskDefs.get_task_names", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.exp_def.TaskDefs.get_task_def", "home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.load_data", "home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.build_data"], ["", "def", "main", "(", "args", ")", ":", "\n", "# hyper param", "\n", "    ", "root", "=", "args", ".", "root_dir", "\n", "assert", "os", ".", "path", ".", "exists", "(", "root", ")", "\n", "\n", "tokenizer", "=", "AutoTokenizer", ".", "from_pretrained", "(", "\n", "args", ".", "model", ",", "cache_dir", "=", "args", ".", "transformer_cache", "\n", ")", "\n", "\n", "mt_dnn_root", "=", "os", ".", "path", ".", "join", "(", "root", ",", "args", ".", "model", ")", "\n", "if", "not", "os", ".", "path", ".", "isdir", "(", "mt_dnn_root", ")", ":", "\n", "        ", "os", ".", "makedirs", "(", "mt_dnn_root", ")", "\n", "\n", "", "task_defs", "=", "TaskDefs", "(", "args", ".", "task_def", ")", "\n", "\n", "for", "task", "in", "task_defs", ".", "get_task_names", "(", ")", ":", "\n", "        ", "task_def", "=", "task_defs", ".", "get_task_def", "(", "task", ")", "\n", "logger", ".", "info", "(", "\"Task %s\"", "%", "task", ")", "\n", "for", "split_name", "in", "task_def", ".", "split_names", ":", "\n", "            ", "file_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"%s_%s.tsv\"", "%", "(", "task", ",", "split_name", ")", ")", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "file_path", ")", ":", "\n", "                ", "logger", ".", "warning", "(", "\"File %s doesnot exit\"", ")", "\n", "sys", ".", "exit", "(", "1", ")", "\n", "", "rows", "=", "load_data", "(", "file_path", ",", "task_def", ")", "\n", "dump_path", "=", "os", ".", "path", ".", "join", "(", "mt_dnn_root", ",", "\"%s_%s.json\"", "%", "(", "task", ",", "split_name", ")", ")", "\n", "logger", ".", "info", "(", "dump_path", ")", "\n", "build_data", "(", "\n", "rows", ",", "\n", "dump_path", ",", "\n", "tokenizer", ",", "\n", "task_def", ".", "data_type", ",", "\n", "lab_dict", "=", "task_def", ".", "label_vocab", ",", "\n", "workers", "=", "args", ".", "workers", ",", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.san_model.SanLayer.__init__": [[12, 31], ["torch.Module.__init__", "isinstance", "rnn_type.upper.upper.upper", "getattr", "getattr.", "pytorch_pretrained_bert.modeling.BertLayerNorm", "int"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "num_hid", ",", "bidirect", ",", "dropout", ",", "rnn_type", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\n", "assert", "isinstance", "(", "rnn_type", ",", "str", ")", "\n", "rnn_type", "=", "rnn_type", ".", "upper", "(", ")", "\n", "assert", "rnn_type", "==", "\"LSTM\"", "or", "rnn_type", "==", "\"GRU\"", "\n", "rnn_cls", "=", "getattr", "(", "nn", ",", "rnn_type", ")", "\n", "self", ".", "_rnn", "=", "rnn_cls", "(", "\n", "num_hid", ",", "\n", "num_hid", ",", "\n", "1", ",", "\n", "bidirectional", "=", "bidirect", ",", "\n", "dropout", "=", "dropout", ",", "\n", "batch_first", "=", "True", ",", "\n", ")", "\n", "self", ".", "_layer_norm", "=", "BertLayerNorm", "(", "num_hid", ",", "eps", "=", "1e-12", ")", "\n", "self", ".", "rnn_type", "=", "rnn_type", "\n", "self", ".", "num_hid", "=", "num_hid", "\n", "self", ".", "ndirections", "=", "1", "+", "int", "(", "bidirect", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.san_model.SanLayer.init_hidden": [[32, 39], ["next", "weight.new().zero_", "san_model.SanLayer.parameters", "weight.new().zero_", "weight.new().zero_", "weight.new", "weight.new", "weight.new"], "methods", ["None"], ["", "def", "init_hidden", "(", "self", ",", "batch", ")", ":", "\n", "        ", "weight", "=", "next", "(", "self", ".", "parameters", "(", ")", ")", ".", "data", "\n", "hid_shape", "=", "(", "self", ".", "ndirections", ",", "batch", ",", "self", ".", "num_hid", ")", "\n", "if", "self", ".", "rnn_type", "==", "\"LSTM\"", ":", "\n", "            ", "return", "(", "weight", ".", "new", "(", "*", "hid_shape", ")", ".", "zero_", "(", ")", ",", "weight", ".", "new", "(", "*", "hid_shape", ")", ".", "zero_", "(", ")", ")", "\n", "", "else", ":", "\n", "            ", "return", "weight", ".", "new", "(", "*", "hid_shape", ")", ".", "zero_", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.san_model.SanLayer.forward": [[40, 53], ["san_model.SanLayer._rnn.flatten_parameters", "x.size", "san_model.SanLayer.init_hidden", "san_model.SanLayer._layer_norm", "san_model.SanLayer._rnn", "tmp_output.view().max", "tmp_output.view"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.module.san_model.SanLayer.init_hidden"], ["", "", "def", "forward", "(", "self", ",", "x", ",", "attention_mask", ")", ":", "\n", "# x: [batch, sequence, in_dim]", "\n", "        ", "self", ".", "_rnn", ".", "flatten_parameters", "(", ")", "\n", "\n", "batch", "=", "x", ".", "size", "(", "0", ")", "\n", "hidden0", "=", "self", ".", "init_hidden", "(", "batch", ")", "\n", "\n", "tmp_output", "=", "self", ".", "_rnn", "(", "x", ",", "hidden0", ")", "[", "0", "]", "\n", "if", "self", ".", "ndirections", ">", "1", ":", "\n", "            ", "size", "=", "tmp_output", ".", "shape", "\n", "tmp_output", "=", "tmp_output", ".", "view", "(", "size", "[", "0", "]", ",", "size", "[", "1", "]", ",", "self", ".", "num_hid", ",", "2", ")", ".", "max", "(", "-", "1", ")", "[", "0", "]", "\n", "", "output", "=", "self", ".", "_layer_norm", "(", "x", "+", "tmp_output", ")", "\n", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.san_model.SanEncoder.__init__": [[56, 60], ["torch.Module.__init__", "san_model.SanLayer", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "copy.deepcopy", "range"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "num_hid", ",", "nlayers", ",", "bidirect", ",", "dropout", ",", "rnn_type", "=", "\"LSTM\"", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "layer", "=", "SanLayer", "(", "num_hid", ",", "bidirect", ",", "dropout", ",", "rnn_type", ")", "\n", "self", ".", "layer", "=", "nn", ".", "ModuleList", "(", "[", "copy", ".", "deepcopy", "(", "layer", ")", "for", "_", "in", "range", "(", "nlayers", ")", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.san_model.SanEncoder.forward": [[61, 70], ["layer_module", "all_encoder_layers.append", "all_encoder_layers.append"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "hidden_states", ",", "attention_mask", ",", "output_all_encoded_layers", "=", "True", ")", ":", "\n", "        ", "all_encoder_layers", "=", "[", "]", "\n", "for", "layer_module", "in", "self", ".", "layer", ":", "\n", "            ", "hidden_states", "=", "layer_module", "(", "hidden_states", ",", "attention_mask", ")", "\n", "if", "output_all_encoded_layers", ":", "\n", "                ", "all_encoder_layers", ".", "append", "(", "hidden_states", ")", "\n", "", "", "if", "not", "output_all_encoded_layers", ":", "\n", "            ", "all_encoder_layers", ".", "append", "(", "hidden_states", ")", "\n", "", "return", "all_encoder_layers", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.san_model.SanPooler.__init__": [[73, 79], ["torch.Module.__init__", "module.dropout_wrapper.DropoutWrapper", "module.similarity.SelfAttnWrapper", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Tanh", "torch.Tanh", "torch.Tanh"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "hidden_size", ",", "dropout_p", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "my_dropout", "=", "DropoutWrapper", "(", "dropout_p", ",", "False", ")", "\n", "self", ".", "self_att", "=", "SelfAttnWrapper", "(", "hidden_size", ",", "dropout", "=", "my_dropout", ")", "\n", "self", ".", "dense", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "hidden_size", ")", "\n", "self", ".", "activation", "=", "nn", ".", "Tanh", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.san_model.SanPooler.forward": [[80, 91], ["san_model.SanPooler.self_att", "san_model.SanPooler.dense", "san_model.SanPooler.activation"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.activation"], ["", "def", "forward", "(", "self", ",", "hidden_states", ",", "attention_mask", ")", ":", "\n", "        ", "\"\"\"\n\n        Arguments:\n            hidden_states {FloatTensor} -- shape (batch, seq_len, hidden_size)\n            attention_mask {ByteTensor} -- 1 indicates padded token\n        \"\"\"", "\n", "first_token_tensor", "=", "self", ".", "self_att", "(", "hidden_states", ",", "attention_mask", ")", "\n", "pooled_output", "=", "self", ".", "dense", "(", "first_token_tensor", ")", "\n", "pooled_output", "=", "self", ".", "activation", "(", "pooled_output", ")", "\n", "return", "pooled_output", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.san_model.SanModel.__init__": [[94, 105], ["torch.Module.__init__", "pytorch_pretrained_bert.modeling.BertEmbeddings", "san_model.SanEncoder", "san_model.SanPooler"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "config", ":", "BertConfig", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "embeddings", "=", "BertEmbeddings", "(", "config", ")", "\n", "self", ".", "encoder", "=", "SanEncoder", "(", "\n", "config", ".", "hidden_size", ",", "\n", "config", ".", "num_hidden_layers", ",", "\n", "True", ",", "\n", "config", ".", "hidden_dropout_prob", ",", "\n", ")", "\n", "self", ".", "pooler", "=", "SanPooler", "(", "config", ".", "hidden_size", ",", "config", ".", "hidden_dropout_prob", ")", "\n", "self", ".", "config", "=", "config", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.san_model.SanModel.forward": [[106, 140], ["san_model.SanModel.embeddings", "san_model.SanModel.encoder", "san_model.SanModel.pooler", "torch.ones_like", "torch.ones_like", "torch.ones_like", "torch.ones_like", "torch.ones_like", "torch.ones_like", "torch.ones_like", "torch.ones_like", "torch.ones_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like"], "methods", ["None"], ["", "def", "forward", "(", "\n", "self", ",", "\n", "input_ids", ",", "\n", "token_type_ids", "=", "None", ",", "\n", "attention_mask", "=", "None", ",", "\n", "output_all_encoded_layers", "=", "True", ",", "\n", ")", ":", "\n", "        ", "\"\"\"[summary]\n\n        Arguments:\n            input_ids {LongTensor} -- shape [batch_size, seq_len]\n\n        Keyword Arguments:\n            token_type_ids {LongTensor} -- shape [batch_size, seq_len]\n            attention_mask {LongTensor} -- 0 indicates padding tokens\n\n        Returns: Tuple of (sequence_output, pooled_output)\n        \"\"\"", "\n", "if", "attention_mask", "is", "None", ":", "\n", "            ", "attention_mask", "=", "torch", ".", "ones_like", "(", "input_ids", ")", "\n", "", "if", "token_type_ids", "is", "None", ":", "\n", "            ", "token_type_ids", "=", "torch", ".", "zeros_like", "(", "input_ids", ")", "\n", "\n", "", "embedding_output", "=", "self", ".", "embeddings", "(", "input_ids", ",", "token_type_ids", ")", "\n", "encoded_layers", "=", "self", ".", "encoder", "(", "\n", "embedding_output", ",", "\n", "attention_mask", ",", "\n", "output_all_encoded_layers", "=", "output_all_encoded_layers", ",", "\n", ")", "\n", "sequence_output", "=", "encoded_layers", "[", "-", "1", "]", "\n", "pooled_output", "=", "self", ".", "pooler", "(", "sequence_output", ",", "attention_mask", "==", "0", ")", "\n", "if", "not", "output_all_encoded_layers", ":", "\n", "            ", "encoded_layers", "=", "encoded_layers", "[", "-", "1", "]", "\n", "", "return", "encoded_layers", ",", "pooled_output", "\n", "", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.DotProduct.__init__": [[14, 21], ["torch.Module.__init__", "opt.get", "numpy.power"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "x1_dim", ",", "x2_dim", ",", "prefix", "=", "\"sim\"", ",", "opt", "=", "{", "}", ",", "dropout", "=", "None", ")", ":", "\n", "        ", "super", "(", "DotProduct", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "x1_dim", "==", "x2_dim", "\n", "self", ".", "opt", "=", "opt", "\n", "self", ".", "prefix", "=", "prefix", "\n", "self", ".", "scale_on", "=", "opt", ".", "get", "(", "\"{}_scale\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "False", ")", "\n", "self", ".", "scalor", "=", "1.0", "/", "numpy", ".", "power", "(", "x2_dim", ",", "0.5", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.DotProduct.forward": [[22, 28], ["x1.bmm", "x1.size", "x2.size", "x2.transpose"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x1", ",", "x2", ")", ":", "\n", "        ", "assert", "x1", ".", "size", "(", "2", ")", "==", "x2", ".", "size", "(", "2", ")", "\n", "scores", "=", "x1", ".", "bmm", "(", "x2", ".", "transpose", "(", "1", ",", "2", ")", ")", "\n", "if", "self", ".", "scale_on", ":", "\n", "            ", "scores", "*=", "self", ".", "scalor", "\n", "", "return", "scores", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.DotProductProject.__init__": [[31, 62], ["torch.Module.__init__", "opt.get", "opt.get", "opt.get", "opt.get", "common.activation", "opt.get", "torch.Linear", "torch.Linear", "torch.Linear", "opt.get", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.Linear", "torch.Linear", "torch.Linear", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.activation", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm"], ["    ", "def", "__init__", "(", "self", ",", "x1_dim", ",", "x2_dim", ",", "prefix", "=", "\"sim\"", ",", "opt", "=", "{", "}", ",", "dropout", "=", "None", ")", ":", "\n", "        ", "super", "(", "DotProductProject", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "prefix", "=", "prefix", "\n", "self", ".", "opt", "=", "opt", "\n", "self", ".", "hidden_size", "=", "opt", ".", "get", "(", "\"{}_hidden_size\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "64", ")", "\n", "self", ".", "residual_on", "=", "opt", ".", "get", "(", "\"{}_residual_on\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "False", ")", "\n", "self", ".", "layer_norm_on", "=", "opt", ".", "get", "(", "\"{}_norm_on\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "False", ")", "\n", "self", ".", "share", "=", "opt", ".", "get", "(", "\"{}_share\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "False", ")", "\n", "self", ".", "f", "=", "activation", "(", "opt", ".", "get", "(", "\"{}_activation\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "\"relu\"", ")", ")", "\n", "self", ".", "scale_on", "=", "opt", ".", "get", "(", "\"{}_scale_on\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "False", ")", "\n", "self", ".", "dropout", "=", "dropout", "\n", "x1_in_dim", "=", "x1_dim", "\n", "x2_in_dim", "=", "x2_dim", "\n", "out_dim", "=", "self", ".", "hidden_size", "\n", "self", ".", "proj_1", "=", "nn", ".", "Linear", "(", "x1_in_dim", ",", "out_dim", ",", "bias", "=", "False", ")", "\n", "if", "self", ".", "layer_norm_on", ":", "\n", "            ", "self", ".", "proj_1", "=", "weight_norm", "(", "self", ".", "proj_1", ")", "\n", "", "if", "self", ".", "share", "and", "x1_in_dim", "==", "x2_in_dim", ":", "\n", "            ", "self", ".", "proj_2", "=", "self", ".", "proj_1", "\n", "", "else", ":", "\n", "            ", "self", ".", "proj_2", "=", "nn", ".", "Linear", "(", "x2_in_dim", ",", "out_dim", ")", "\n", "if", "self", ".", "layer_norm_on", ":", "\n", "                ", "self", ".", "proj_2", "=", "weight_norm", "(", "self", ".", "proj_2", ")", "\n", "\n", "", "", "if", "self", ".", "scale_on", ":", "\n", "            ", "self", ".", "scalar", "=", "Parameter", "(", "\n", "torch", ".", "ones", "(", "1", ",", "1", ",", "1", ")", "/", "(", "self", ".", "hidden_size", "**", "0.5", ")", ",", "requires_grad", "=", "False", "\n", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "sclalar", "=", "Parameter", "(", "\n", "torch", ".", "ones", "(", "1", ",", "1", ",", "self", ".", "hidden_size", ")", ",", "requires_grad", "=", "True", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.DotProductProject.forward": [[64, 79], ["similarity.DotProductProject.contiguous().view", "similarity.DotProductProject.contiguous().view", "similarity.DotProductProject.f().view", "similarity.DotProductProject.f().view", "similarity.DotProductProject.bmm", "similarity.DotProductProject.size", "similarity.DotProductProject.size", "similarity.DotProductProject.dropout", "similarity.DotProductProject.dropout", "similarity.DotProductProject.size", "similarity.DotProductProject.size", "similarity.DotProductProject.size", "similarity.DotProductProject.size", "similarity.DotProductProject.size", "similarity.DotProductProject.size", "similarity.DotProductProject.scalar.expand_as", "similarity.DotProductProject.transpose", "similarity.DotProductProject.contiguous", "similarity.DotProductProject.contiguous", "similarity.DotProductProject.f", "similarity.DotProductProject.f", "similarity.DotProductProject.proj_1", "similarity.DotProductProject.proj_2"], "methods", ["None"], ["", "", "def", "forward", "(", "self", ",", "x1", ",", "x2", ")", ":", "\n", "        ", "assert", "x1", ".", "size", "(", "2", ")", "==", "x2", ".", "size", "(", "2", ")", "\n", "if", "self", ".", "dropout", ":", "\n", "            ", "x1", "=", "self", ".", "dropout", "(", "x1", ")", "\n", "x2", "=", "self", ".", "dropout", "(", "x2", ")", "\n", "", "x1_flat", "=", "x1", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ",", "x1", ".", "size", "(", "2", ")", ")", "\n", "x2_flat", "=", "x2", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ",", "x2", ".", "size", "(", "2", ")", ")", "\n", "x1_o", "=", "self", ".", "f", "(", "self", ".", "proj_1", "(", "x1_flat", ")", ")", ".", "view", "(", "x1", ".", "size", "(", "0", ")", ",", "x1", ".", "size", "(", "1", ")", ",", "-", "1", ")", "\n", "# x2_o = self.f(self.proj_1(x2_flat)).view(x2.size(0), x2.size(1), -1)", "\n", "x2_o", "=", "self", ".", "f", "(", "self", ".", "proj_2", "(", "x2_flat", ")", ")", ".", "view", "(", "x2", ".", "size", "(", "0", ")", ",", "x2", ".", "size", "(", "1", ")", ",", "-", "1", ")", "\n", "if", "self", ".", "scale_on", ":", "\n", "            ", "scalar", "=", "self", ".", "scalar", ".", "expand_as", "(", "x2_o", ")", "\n", "x2_o", "=", "scalar", "*", "x2_o", "\n", "", "scores", "=", "x1_o", ".", "bmm", "(", "x2_o", ".", "transpose", "(", "1", ",", "2", ")", ")", "\n", "return", "scores", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.Bilinear.__init__": [[82, 94], ["torch.Module.__init__", "opt.get", "opt.get", "torch.Linear", "torch.Linear", "torch.Linear", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm"], ["    ", "def", "__init__", "(", "self", ",", "x1_dim", ",", "x2_dim", ",", "prefix", "=", "\"sim\"", ",", "opt", "=", "{", "}", ",", "dropout", "=", "None", ")", ":", "\n", "        ", "super", "(", "Bilinear", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "opt", "=", "opt", "\n", "self", ".", "layer_norm_on", "=", "opt", ".", "get", "(", "\"{}_norm_on\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "False", ")", "\n", "self", ".", "transform_on", "=", "opt", ".", "get", "(", "\"{}_proj_on\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "False", ")", "\n", "# self.init = init_wrapper(opt.get('{}_init'.format(self.prefix), ''))", "\n", "self", ".", "dropout", "=", "dropout", "\n", "if", "self", ".", "transform_on", ":", "\n", "            ", "self", ".", "proj", "=", "nn", ".", "Linear", "(", "x1_dim", ",", "x2_dim", ")", "\n", "# self.init(self.proj.weight)", "\n", "if", "self", ".", "layer_norm_on", ":", "\n", "                ", "self", ".", "proj", "=", "weight_norm", "(", "self", ".", "proj", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.Bilinear.forward": [[95, 110], ["similarity.Bilinear.bmm().squeeze", "similarity.Bilinear.dropout", "similarity.Bilinear.dropout", "similarity.Bilinear.proj", "similarity.Bilinear.dropout", "similarity.Bilinear.bmm", "similarity.Bilinear.unsqueeze"], "methods", ["None"], ["", "", "", "def", "forward", "(", "self", ",", "x", ",", "y", ")", ":", "\n", "        ", "\"\"\"\n        x = batch * len * h1\n        y = batch * h2\n        x_mask = batch * len\n        \"\"\"", "\n", "if", "self", ".", "dropout", ":", "\n", "            ", "x", "=", "self", ".", "dropout", "(", "x", ")", "\n", "y", "=", "self", ".", "dropout", "(", "y", ")", "\n", "\n", "", "proj", "=", "self", ".", "proj", "(", "y", ")", "if", "self", ".", "transform_on", "else", "y", "\n", "if", "self", ".", "dropout", ":", "\n", "            ", "proj", "=", "self", ".", "dropout", "(", "proj", ")", "\n", "", "scores", "=", "x", ".", "bmm", "(", "proj", ".", "unsqueeze", "(", "2", ")", ")", ".", "squeeze", "(", "2", ")", "\n", "return", "scores", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.BilinearSum.__init__": [[113, 126], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "opt.get", "common.init_wrapper", "similarity.BilinearSum.init", "similarity.BilinearSum.init", "opt.get", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.init_wrapper", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm"], ["    ", "def", "__init__", "(", "self", ",", "x1_dim", ",", "x2_dim", ",", "prefix", "=", "\"sim\"", ",", "opt", "=", "{", "}", ",", "dropout", "=", "None", ")", ":", "\n", "        ", "super", "(", "BilinearSum", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "x_linear", "=", "nn", ".", "Linear", "(", "x1_dim", ",", "1", ",", "bias", "=", "False", ")", "\n", "self", ".", "y_linear", "=", "nn", ".", "Linear", "(", "x2_dim", ",", "1", ",", "bias", "=", "False", ")", "\n", "self", ".", "layer_norm_on", "=", "opt", ".", "get", "(", "\"{}_norm_on\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "False", ")", "\n", "self", ".", "init", "=", "init_wrapper", "(", "opt", ".", "get", "(", "\"{}_init\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "False", ")", ")", "\n", "if", "self", ".", "layer_norm_on", ":", "\n", "            ", "self", ".", "x_linear", "=", "weight_norm", "(", "self", ".", "x_linear", ")", "\n", "self", ".", "y_linear", "=", "weight_norm", "(", "self", ".", "y_linear", ")", "\n", "\n", "", "self", ".", "init", "(", "self", ".", "x_linear", ".", "weight", ")", "\n", "self", ".", "init", "(", "self", ".", "y_linear", ".", "weight", ")", "\n", "self", ".", "dropout", "=", "dropout", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.BilinearSum.forward": [[127, 147], ["similarity.BilinearSum.x_linear().view", "similarity.BilinearSum.y_linear().view", "similarity.BilinearSum.dropout", "similarity.BilinearSum.dropout", "similarity.BilinearSum.size", "similarity.BilinearSum.size", "similarity.BilinearSum.size", "similarity.BilinearSum.size", "similarity.BilinearSum.size", "similarity.BilinearSum.expand_as", "similarity.BilinearSum.expand_as", "similarity.BilinearSum.x_linear", "similarity.BilinearSum.y_linear", "similarity.BilinearSum.contiguous().view", "similarity.BilinearSum.contiguous().view", "similarity.BilinearSum.size", "similarity.BilinearSum.size", "similarity.BilinearSum.contiguous", "similarity.BilinearSum.contiguous"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x1", ",", "x2", ")", ":", "\n", "        ", "\"\"\"\n        x1: batch * len1 * input_size\n        x2: batch * len2 * input_size\n        score: batch * len1 * len2\n        \"\"\"", "\n", "if", "self", ".", "dropout", ":", "\n", "            ", "x1", "=", "self", ".", "dropout", "(", "x1", ")", "\n", "x2", "=", "self", ".", "dropout", "(", "x2", ")", "\n", "\n", "", "x1_logits", "=", "self", ".", "x_linear", "(", "x1", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ",", "x1", ".", "size", "(", "-", "1", ")", ")", ")", ".", "view", "(", "\n", "x1", ".", "size", "(", "0", ")", ",", "-", "1", ",", "1", "\n", ")", "\n", "x2_logits", "=", "self", ".", "y_linear", "(", "x2", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ",", "x2", ".", "size", "(", "-", "1", ")", ")", ")", ".", "view", "(", "\n", "x2", ".", "size", "(", "0", ")", ",", "1", ",", "-", "1", "\n", ")", "\n", "\n", "shape", "=", "(", "x1", ".", "size", "(", "0", ")", ",", "x1", ".", "size", "(", "1", ")", ",", "x2", ".", "size", "(", ")", ")", "\n", "scores", "=", "x1_logits", ".", "expand_as", "(", "shape", ")", "+", "x2_logits", ".", "expand_as", "(", "shape", ")", "\n", "return", "scores", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.Trilinear.__init__": [[152, 171], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "opt.get", "common.init_wrapper", "similarity.Trilinear.init", "similarity.Trilinear.init", "similarity.Trilinear.init", "opt.get", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.init_wrapper", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm"], ["def", "__init__", "(", "self", ",", "x1_dim", ",", "x2_dim", ",", "prefix", "=", "\"sim\"", ",", "opt", "=", "{", "}", ",", "dropout", "=", "None", ")", ":", "\n", "        ", "super", "(", "Trilinear", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "prefix", "=", "prefix", "\n", "self", ".", "x_linear", "=", "nn", ".", "Linear", "(", "x1_dim", ",", "1", ",", "bias", "=", "False", ")", "\n", "self", ".", "x_dot_linear", "=", "nn", ".", "Linear", "(", "x1_dim", ",", "1", ",", "bias", "=", "False", ")", "\n", "self", ".", "y_linear", "=", "nn", ".", "Linear", "(", "x2_dim", ",", "1", ",", "bias", "=", "False", ")", "\n", "self", ".", "layer_norm_on", "=", "opt", ".", "get", "(", "\"{}_norm_on\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "False", ")", "\n", "self", ".", "init", "=", "init_wrapper", "(", "\n", "opt", ".", "get", "(", "\"{}_init\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "\"xavier_uniform\"", ")", "\n", ")", "\n", "if", "self", ".", "layer_norm_on", ":", "\n", "            ", "self", ".", "x_linear", "=", "weight_norm", "(", "self", ".", "x_linear", ")", "\n", "self", ".", "x_dot_linear", "=", "weight_norm", "(", "self", ".", "x_dot_linear", ")", "\n", "self", ".", "y_linear", "=", "weight_norm", "(", "self", ".", "y_linear", ")", "\n", "\n", "", "self", ".", "init", "(", "self", ".", "x_linear", ".", "weight", ")", "\n", "self", ".", "init", "(", "self", ".", "x_dot_linear", ".", "weight", ")", "\n", "self", ".", "init", "(", "self", ".", "y_linear", ".", "weight", ")", "\n", "self", ".", "dropout", "=", "dropout", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.Trilinear.forward": [[172, 198], ["similarity.Trilinear.x_linear().view", "similarity.Trilinear.y_linear().view", "similarity.Trilinear.x_dot_linear().view().expand_as", "similarity.Trilinear.bmm", "similarity.Trilinear.dropout", "similarity.Trilinear.dropout", "similarity.Trilinear.size", "similarity.Trilinear.size", "similarity.Trilinear.transpose", "similarity.Trilinear.expand_as", "similarity.Trilinear.expand_as", "similarity.Trilinear.x_linear", "similarity.Trilinear.y_linear", "similarity.Trilinear.x_dot_linear().view", "similarity.Trilinear.contiguous().view", "similarity.Trilinear.contiguous().view", "similarity.Trilinear.size", "similarity.Trilinear.size", "similarity.Trilinear.size", "similarity.Trilinear.x_dot_linear", "similarity.Trilinear.contiguous", "similarity.Trilinear.contiguous", "similarity.Trilinear.contiguous().view", "similarity.Trilinear.size", "similarity.Trilinear.contiguous"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x1", ",", "x2", ")", ":", "\n", "        ", "\"\"\"\n        x1: batch * len1 * input_size\n        x2: batch * len2 * input_size\n        score: batch * len1 * len2\n        \"\"\"", "\n", "if", "self", ".", "dropout", ":", "\n", "            ", "x1", "=", "self", ".", "dropout", "(", "x1", ")", "\n", "x2", "=", "self", ".", "dropout", "(", "x2", ")", "\n", "\n", "", "x1_logits", "=", "self", ".", "x_linear", "(", "x1", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ",", "x1", ".", "size", "(", "-", "1", ")", ")", ")", ".", "view", "(", "\n", "x1", ".", "size", "(", "0", ")", ",", "-", "1", ",", "1", "\n", ")", "\n", "x2_logits", "=", "self", ".", "y_linear", "(", "x2", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ",", "x2", ".", "size", "(", "-", "1", ")", ")", ")", ".", "view", "(", "\n", "x2", ".", "size", "(", "0", ")", ",", "1", ",", "-", "1", "\n", ")", "\n", "x1_dot", "=", "(", "\n", "self", ".", "x_dot_linear", "(", "x1", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ",", "x1", ".", "size", "(", "-", "1", ")", ")", ")", "\n", ".", "view", "(", "x1", ".", "size", "(", "0", ")", ",", "-", "1", ",", "1", ")", "\n", ".", "expand_as", "(", "x1", ")", "\n", ")", "\n", "x1_dot", "=", "x1", "*", "x1_dot", "\n", "\n", "scores", "=", "x1_dot", ".", "bmm", "(", "x2", ".", "transpose", "(", "1", ",", "2", ")", ")", "\n", "scores", "+=", "x1_logits", ".", "expand_as", "(", "scores", ")", "+", "x2_logits", ".", "expand_as", "(", "scores", ")", "\n", "return", "scores", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.SimilarityWrapper.__init__": [[201, 229], ["torch.Module.__init__", "opt.get().lower", "similarity.DotProduct", "opt.get", "similarity.DotProductProject", "similarity.Bilinear", "similarity.BilinearSum", "similarity.Trilinear"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "x1_dim", ",", "x2_dim", ",", "prefix", "=", "\"attention\"", ",", "opt", "=", "{", "}", ",", "dropout", "=", "None", ")", ":", "\n", "        ", "super", "(", "SimilarityWrapper", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "score_func_str", "=", "opt", ".", "get", "(", "\n", "\"{}_sim_func\"", ".", "format", "(", "prefix", ")", ",", "\"dotproductproject\"", "\n", ")", ".", "lower", "(", ")", "\n", "self", ".", "score_func", "=", "None", "\n", "if", "self", ".", "score_func_str", "==", "\"dotproduct\"", ":", "\n", "            ", "self", ".", "score_func", "=", "DotProduct", "(", "\n", "x1_dim", ",", "x2_dim", ",", "prefix", "=", "prefix", ",", "opt", "=", "opt", ",", "dropout", "=", "dropout", "\n", ")", "\n", "", "elif", "self", ".", "score_func_str", "==", "\"dotproductproject\"", ":", "\n", "            ", "self", ".", "score_func", "=", "DotProductProject", "(", "\n", "x1_dim", ",", "x2_dim", ",", "prefix", "=", "prefix", ",", "opt", "=", "opt", ",", "dropout", "=", "dropout", "\n", ")", "\n", "", "elif", "self", ".", "score_func_str", "==", "\"bilinear\"", ":", "\n", "            ", "self", ".", "score_func", "=", "Bilinear", "(", "\n", "x1_dim", ",", "x2_dim", ",", "prefix", "=", "prefix", ",", "opt", "=", "opt", ",", "dropout", "=", "dropout", "\n", ")", "\n", "", "elif", "self", ".", "score_func_str", "==", "\"bilinearsum\"", ":", "\n", "            ", "self", ".", "score_func", "=", "BilinearSum", "(", "\n", "x1_dim", ",", "x2_dim", ",", "prefix", "=", "prefix", ",", "opt", "=", "opt", ",", "dropout", "=", "dropout", "\n", ")", "\n", "", "elif", "self", ".", "score_func_str", "==", "\"trilinear\"", ":", "\n", "            ", "self", ".", "score_func", "=", "Trilinear", "(", "\n", "x1_dim", ",", "x2_dim", ",", "prefix", "=", "prefix", ",", "opt", "=", "opt", ",", "dropout", "=", "dropout", "\n", ")", "\n", "", "else", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.SimilarityWrapper.forward": [[230, 233], ["similarity.SimilarityWrapper.score_func"], "methods", ["None"], ["", "", "def", "forward", "(", "self", ",", "x1", ",", "x2", ")", ":", "\n", "        ", "scores", "=", "self", ".", "score_func", "(", "x1", ",", "x2", ")", "\n", "return", "scores", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.AttentionWrapper.__init__": [[236, 247], ["torch.Module.__init__", "opt.get", "similarity.SimilarityWrapper", "opt.get"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "\n", "self", ",", "x1_dim", ",", "x2_dim", ",", "x3_dim", "=", "None", ",", "prefix", "=", "\"attention\"", ",", "opt", "=", "{", "}", ",", "dropout", "=", "None", "\n", ")", ":", "\n", "        ", "super", "(", "AttentionWrapper", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "prefix", "=", "prefix", "\n", "self", ".", "att_dropout", "=", "opt", ".", "get", "(", "\"{}_att_dropout\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "0", ")", "\n", "self", ".", "score_func", "=", "SimilarityWrapper", "(", "\n", "x1_dim", ",", "x2_dim", ",", "prefix", "=", "prefix", ",", "opt", "=", "opt", ",", "dropout", "=", "dropout", "\n", ")", "\n", "self", ".", "drop_diagonal", "=", "opt", ".", "get", "(", "\"{}_drop_diagonal\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "False", ")", "\n", "self", ".", "output_size", "=", "x2_dim", "if", "x3_dim", "is", "None", "else", "x3_dim", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.AttentionWrapper.forward": [[248, 274], ["similarity.AttentionWrapper.score_func", "key_padding_mask.unsqueeze().expand_as", "similarity.AttentionWrapper.data.masked_fill_", "torch.softmax", "torch.softmax", "torch.softmax", "similarity.AttentionWrapper.view", "similarity.AttentionWrapper.bmm", "torch.diag().byte().unsqueeze().expand_as", "torch.diag().byte().unsqueeze().expand_as", "torch.diag().byte().unsqueeze().expand_as", "torch.diag().byte().unsqueeze().expand_as", "torch.diag().byte().unsqueeze().expand_as", "torch.diag().byte().unsqueeze().expand_as", "torch.diag().byte().unsqueeze().expand_as", "torch.diag().byte().unsqueeze().expand_as", "torch.diag().byte().unsqueeze().expand_as", "similarity.AttentionWrapper.data.masked_fill_", "similarity.AttentionWrapper.view", "query.size", "key.size", "similarity.AttentionWrapper.dropout", "key_padding_mask.unsqueeze", "float", "similarity.AttentionWrapper.size", "similarity.AttentionWrapper.size", "key.size", "torch.diag().byte().unsqueeze", "torch.diag().byte().unsqueeze", "torch.diag().byte().unsqueeze", "torch.diag().byte().unsqueeze", "torch.diag().byte().unsqueeze", "torch.diag().byte().unsqueeze", "torch.diag().byte().unsqueeze", "torch.diag().byte().unsqueeze", "torch.diag().byte().unsqueeze", "float", "torch.diag().byte", "torch.diag().byte", "torch.diag().byte", "torch.diag().byte", "torch.diag().byte", "torch.diag().byte", "torch.diag().byte", "torch.diag().byte", "torch.diag().byte", "torch.diag", "torch.diag", "torch.diag", "torch.diag", "torch.diag", "torch.diag", "torch.diag", "torch.diag", "torch.diag", "similarity.AttentionWrapper.data.new().zero_", "similarity.AttentionWrapper.data.new", "similarity.AttentionWrapper.size"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "query", ",", "key", ",", "value", ",", "key_padding_mask", "=", "None", ",", "return_scores", "=", "False", ")", ":", "\n", "        ", "logits", "=", "self", ".", "score_func", "(", "query", ",", "key", ")", "\n", "key_mask", "=", "key_padding_mask", ".", "unsqueeze", "(", "1", ")", ".", "expand_as", "(", "logits", ")", "\n", "logits", ".", "data", ".", "masked_fill_", "(", "key_mask", ".", "data", ",", "-", "float", "(", "\"inf\"", ")", ")", "\n", "if", "self", ".", "drop_diagonal", ":", "\n", "            ", "assert", "logits", ".", "size", "(", "1", ")", "==", "logits", ".", "size", "(", "2", ")", "\n", "diag_mask", "=", "(", "\n", "torch", ".", "diag", "(", "logits", ".", "data", ".", "new", "(", "logits", ".", "size", "(", "1", ")", ")", ".", "zero_", "(", ")", "+", "1", ")", "\n", ".", "byte", "(", ")", "\n", ".", "unsqueeze", "(", "0", ")", "\n", ".", "expand_as", "(", "logits", ")", "\n", ")", "\n", "logits", ".", "data", ".", "masked_fill_", "(", "diag_mask", ",", "-", "float", "(", "\"inf\"", ")", ")", "\n", "\n", "", "prob", "=", "F", ".", "softmax", "(", "logits", ".", "view", "(", "-", "1", ",", "key", ".", "size", "(", "1", ")", ")", ",", "1", ")", "\n", "prob", "=", "prob", ".", "view", "(", "-", "1", ",", "query", ".", "size", "(", "1", ")", ",", "key", ".", "size", "(", "1", ")", ")", "\n", "if", "self", ".", "att_dropout", ">", "0", ":", "\n", "            ", "prob", "=", "self", ".", "dropout", "(", "prob", ")", "\n", "\n", "", "if", "value", "is", "None", ":", "\n", "            ", "value", "=", "key", "\n", "", "attn", "=", "prob", ".", "bmm", "(", "value", ")", "\n", "if", "return_scores", ":", "\n", "            ", "return", "attn", ",", "prob", ",", "logits", "\n", "", "else", ":", "\n", "            ", "return", "attn", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.LinearSelfAttn.__init__": [[281, 285], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["def", "__init__", "(", "self", ",", "input_size", ",", "dropout", "=", "None", ")", ":", "\n", "        ", "super", "(", "LinearSelfAttn", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "linear", "=", "nn", ".", "Linear", "(", "input_size", ",", "1", ")", "\n", "self", ".", "dropout", "=", "dropout", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.LinearSelfAttn.forward": [[286, 293], ["similarity.LinearSelfAttn.dropout", "similarity.LinearSelfAttn.contiguous().view", "similarity.LinearSelfAttn.linear().view", "similarity.LinearSelfAttn.data.masked_fill_", "torch.softmax", "torch.softmax", "torch.softmax", "torch.softmax.unsqueeze().bmm().squeeze", "similarity.LinearSelfAttn.size", "similarity.LinearSelfAttn.size", "similarity.LinearSelfAttn.size", "similarity.LinearSelfAttn.contiguous", "similarity.LinearSelfAttn.linear", "float", "torch.softmax.unsqueeze().bmm", "torch.softmax.unsqueeze"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.linear"], ["", "def", "forward", "(", "self", ",", "x", ",", "x_mask", ")", ":", "\n", "        ", "x", "=", "self", ".", "dropout", "(", "x", ")", "\n", "x_flat", "=", "x", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ",", "x", ".", "size", "(", "-", "1", ")", ")", "\n", "scores", "=", "self", ".", "linear", "(", "x_flat", ")", ".", "view", "(", "x", ".", "size", "(", "0", ")", ",", "x", ".", "size", "(", "1", ")", ")", "\n", "scores", ".", "data", ".", "masked_fill_", "(", "x_mask", ".", "data", ",", "-", "float", "(", "\"inf\"", ")", ")", "\n", "alpha", "=", "F", ".", "softmax", "(", "scores", ",", "1", ")", "\n", "return", "alpha", ".", "unsqueeze", "(", "1", ")", ".", "bmm", "(", "x", ")", ".", "squeeze", "(", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.MLPSelfAttn.__init__": [[296, 311], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "opt.get", "common.activation", "opt.get", "dropout_wrapper.DropoutWrapper", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "opt.get"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.activation", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm"], ["    ", "def", "__init__", "(", "self", ",", "input_size", ",", "opt", "=", "{", "}", ",", "prefix", "=", "\"attn_sum\"", ",", "dropout", "=", "None", ")", ":", "\n", "        ", "super", "(", "MLPSelfAttn", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "prefix", "=", "prefix", "\n", "self", ".", "FC", "=", "nn", ".", "Linear", "(", "input_size", ",", "input_size", ")", "\n", "self", ".", "linear", "=", "nn", ".", "Linear", "(", "input_size", ",", "1", ")", "\n", "self", ".", "layer_norm_on", "=", "opt", ".", "get", "(", "\"{}_norm_on\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "False", ")", "\n", "self", ".", "f", "=", "activation", "(", "opt", ".", "get", "(", "\"{}_activation\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "\"relu\"", ")", ")", "\n", "if", "dropout", "is", "None", ":", "\n", "            ", "self", ".", "dropout", "=", "DropoutWrapper", "(", "\n", "opt", ".", "get", "(", "\"{}_dropout_p\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "0", ")", "\n", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "dropout", "=", "dropout", "\n", "", "if", "self", ".", "layer_norm_on", ":", "\n", "            ", "self", ".", "FC", "=", "weight_norm", "(", "self", ".", "FC", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.MLPSelfAttn.forward": [[312, 319], ["similarity.MLPSelfAttn.dropout", "similarity.MLPSelfAttn.contiguous().view", "similarity.MLPSelfAttn.linear().view", "similarity.MLPSelfAttn.data.masked_fill_", "torch.softmax", "torch.softmax", "torch.softmax", "torch.softmax.unsqueeze().bmm().squeeze", "similarity.MLPSelfAttn.size", "similarity.MLPSelfAttn.size", "similarity.MLPSelfAttn.size", "similarity.MLPSelfAttn.contiguous", "similarity.MLPSelfAttn.linear", "float", "torch.softmax.unsqueeze().bmm", "similarity.MLPSelfAttn.f", "similarity.MLPSelfAttn.FC", "torch.softmax.unsqueeze"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.linear"], ["", "", "def", "forward", "(", "self", ",", "x", ",", "x_mask", ")", ":", "\n", "        ", "x", "=", "self", ".", "dropout", "(", "x", ")", "\n", "x_flat", "=", "x", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ",", "x", ".", "size", "(", "-", "1", ")", ")", "\n", "scores", "=", "self", ".", "linear", "(", "self", ".", "f", "(", "self", ".", "FC", "(", "x_flat", ")", ")", ")", ".", "view", "(", "x", ".", "size", "(", "0", ")", ",", "x", ".", "size", "(", "1", ")", ")", "\n", "scores", ".", "data", ".", "masked_fill_", "(", "x_mask", ".", "data", ",", "-", "float", "(", "\"inf\"", ")", ")", "\n", "alpha", "=", "F", ".", "softmax", "(", "scores", ")", "\n", "return", "alpha", ".", "unsqueeze", "(", "1", ")", ".", "bmm", "(", "x", ")", ".", "squeeze", "(", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.SelfAttnWrapper.__init__": [[322, 332], ["torch.Module.__init__", "opt.get", "similarity.MLPSelfAttn", "similarity.LinearSelfAttn"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input_size", ",", "prefix", "=", "\"attn_sum\"", ",", "opt", "=", "{", "}", ",", "dropout", "=", "None", ")", ":", "\n", "        ", "super", "(", "SelfAttnWrapper", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\"\"\"\n        Self att wrapper, support linear and MLP\n        \"\"\"", "\n", "attn_type", "=", "opt", ".", "get", "(", "\"{}_type\"", ".", "format", "(", "prefix", ")", ",", "\"linear\"", ")", "\n", "if", "attn_type", "==", "\"mlp\"", ":", "\n", "            ", "self", ".", "att", "=", "MLPSelfAttn", "(", "input_size", ",", "prefix", ",", "opt", ",", "dropout", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "att", "=", "LinearSelfAttn", "(", "input_size", ",", "dropout", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.SelfAttnWrapper.forward": [[333, 335], ["similarity.SelfAttnWrapper.att"], "methods", ["None"], ["", "", "def", "forward", "(", "self", ",", "x", ",", "x_mask", ")", ":", "\n", "        ", "return", "self", ".", "att", "(", "x", ",", "x_mask", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.DeepAttentionWrapper.__init__": [[338, 378], ["torch.Module.__init__", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "range", "dropout_wrapper.DropoutWrapper", "similarity.DeepAttentionWrapper.attn_list.append", "opt.get", "similarity.MultiheadAttentionWrapper", "similarity.AttentionWrapper"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "\n", "self", ",", "\n", "x1_dim", ",", "\n", "x2_dim", ",", "\n", "x3_dims", ",", "\n", "att_cnt", ",", "\n", "prefix", "=", "\"deep_att\"", ",", "\n", "opt", "=", "None", ",", "\n", "dropout", "=", "None", ",", "\n", ")", ":", "\n", "        ", "super", "(", "DeepAttentionWrapper", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "opt", "=", "{", "}", "if", "opt", "is", "None", "else", "opt", "\n", "self", ".", "prefix", "=", "prefix", "\n", "self", ".", "x1_dim", "=", "x1_dim", "\n", "self", ".", "x2_dim", "=", "x2_dim", "\n", "self", ".", "x3_dims", "=", "x3_dims", "\n", "\n", "if", "dropout", "is", "None", ":", "\n", "            ", "self", ".", "dropout", "=", "DropoutWrapper", "(", "\n", "opt", ".", "get", "(", "\"{}_dropout_p\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "0", ")", "\n", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "dropout", "=", "dropout", "\n", "\n", "", "self", ".", "attn_list", "=", "nn", ".", "ModuleList", "(", ")", "\n", "for", "i", "in", "range", "(", "0", ",", "att_cnt", ")", ":", "\n", "            ", "if", "opt", "[", "\"multihead_on\"", "]", ":", "\n", "                ", "attention", "=", "MultiheadAttentionWrapper", "(", "\n", "self", ".", "x1_dim", ",", "\n", "self", ".", "x2_dim", ",", "\n", "self", ".", "x3_dims", "[", "i", "]", ",", "\n", "prefix", ",", "\n", "opt", ",", "\n", "dropout", "=", "dropout", ",", "\n", ")", "\n", "", "else", ":", "\n", "                ", "attention", "=", "AttentionWrapper", "(", "\n", "self", ".", "x1_dim", ",", "self", ".", "x2_dim", ",", "self", ".", "x3_dims", "[", "i", "]", ",", "prefix", ",", "opt", ",", "self", ".", "dropout", "\n", ")", "\n", "", "self", ".", "attn_list", ".", "append", "(", "attention", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.DeepAttentionWrapper.forward": [[379, 386], ["range", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "len", "rvl.append"], "methods", ["None"], ["", "", "def", "forward", "(", "self", ",", "x1", ",", "x2", ",", "x3", ",", "x2_mask", ")", ":", "\n", "        ", "rvl", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "0", ",", "len", "(", "x3", ")", ")", ":", "\n", "            ", "hiddens", "=", "self", ".", "attn_list", "[", "i", "]", "(", "x1", ",", "x2", ",", "x3", "[", "i", "]", ",", "x2_mask", ")", "\n", "rvl", ".", "append", "(", "hiddens", ")", "\n", "\n", "", "return", "torch", ".", "cat", "(", "rvl", ",", "2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.BilinearFlatSim.__init__": [[393, 406], ["torch.Module.__init__", "opt.get", "torch.Linear", "torch.Linear", "torch.Linear", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "dropout_wrapper.DropoutWrapper", "opt.get"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm"], ["def", "__init__", "(", "self", ",", "x_size", ",", "y_size", ",", "opt", "=", "{", "}", ",", "prefix", "=", "\"seqatt\"", ",", "dropout", "=", "None", ")", ":", "\n", "        ", "super", "(", "BilinearFlatSim", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "opt", "=", "opt", "\n", "self", ".", "weight_norm_on", "=", "opt", ".", "get", "(", "\"{}_weight_norm_on\"", ".", "format", "(", "prefix", ")", ",", "False", ")", "\n", "self", ".", "linear", "=", "nn", ".", "Linear", "(", "y_size", ",", "x_size", ")", "\n", "if", "self", ".", "weight_norm_on", ":", "\n", "            ", "self", ".", "linear", "=", "weight_norm", "(", "self", ".", "linear", ")", "\n", "", "if", "dropout", "is", "None", ":", "\n", "            ", "self", ".", "dropout", "=", "DropoutWrapper", "(", "\n", "opt", ".", "get", "(", "\"{}_dropout_p\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "0", ")", "\n", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "dropout", "=", "dropout", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.BilinearFlatSim.forward": [[407, 420], ["similarity.BilinearFlatSim.dropout", "similarity.BilinearFlatSim.dropout", "similarity.BilinearFlatSim.linear", "similarity.BilinearFlatSim.bmm().squeeze", "similarity.BilinearFlatSim.bmm().squeeze.data.masked_fill_", "similarity.BilinearFlatSim.bmm", "float", "similarity.BilinearFlatSim.unsqueeze"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.linear"], ["", "", "def", "forward", "(", "self", ",", "x", ",", "y", ",", "x_mask", ")", ":", "\n", "        ", "\"\"\"\n        x = batch * len * h1\n        y = batch * h2\n        x_mask = batch * len\n        \"\"\"", "\n", "x", "=", "self", ".", "dropout", "(", "x", ")", "\n", "y", "=", "self", ".", "dropout", "(", "y", ")", "\n", "\n", "Wy", "=", "self", ".", "linear", "(", "y", ")", "\n", "xWy", "=", "x", ".", "bmm", "(", "Wy", ".", "unsqueeze", "(", "2", ")", ")", ".", "squeeze", "(", "2", ")", "\n", "xWy", ".", "data", ".", "masked_fill_", "(", "x_mask", ".", "data", ",", "-", "float", "(", "\"inf\"", ")", ")", "\n", "return", "xWy", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.SimpleFlatSim.__init__": [[423, 436], ["torch.Module.__init__", "opt.get", "torch.Linear", "torch.Linear", "torch.Linear", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "dropout_wrapper.DropoutWrapper", "opt.get"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm"], ["    ", "def", "__init__", "(", "self", ",", "x_size", ",", "y_size", ",", "opt", "=", "{", "}", ",", "prefix", "=", "\"seqatt\"", ",", "dropout", "=", "None", ")", ":", "\n", "        ", "super", "(", "SimpleFlatSim", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "opt", "=", "opt", "\n", "self", ".", "weight_norm_on", "=", "opt", ".", "get", "(", "\"{}_norm_on\"", ".", "format", "(", "prefix", ")", ",", "False", ")", "\n", "self", ".", "linear", "=", "nn", ".", "Linear", "(", "y_size", "+", "x_size", ",", "1", ")", "\n", "if", "self", ".", "weight_norm_on", ":", "\n", "            ", "self", ".", "linear", "=", "weight_norm", "(", "self", ".", "linear", ")", "\n", "", "if", "dropout", "is", "None", ":", "\n", "            ", "self", ".", "dropout", "=", "DropoutWrapper", "(", "\n", "opt", ".", "get", "(", "\"{}_dropout_p\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "0", ")", "\n", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "dropout", "=", "dropout", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.SimpleFlatSim.forward": [[437, 451], ["similarity.SimpleFlatSim.dropout", "similarity.SimpleFlatSim.dropout", "y.unsqueeze().expand_as.unsqueeze().expand_as.unsqueeze().expand_as", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "similarity.SimpleFlatSim.linear", "similarity.SimpleFlatSim.contiguous().view", "similarity.SimpleFlatSim.contiguous().view.data.masked_fill_", "similarity.SimpleFlatSim.size", "y.unsqueeze().expand_as.unsqueeze().expand_as.unsqueeze", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "similarity.SimpleFlatSim.size", "similarity.SimpleFlatSim.size", "similarity.SimpleFlatSim.contiguous", "float", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.linear"], ["", "", "def", "forward", "(", "self", ",", "x", ",", "y", ",", "x_mask", ")", ":", "\n", "        ", "\"\"\"\n        x = batch * len * h1\n        y = batch * h2\n        x_mask = batch * len\n        \"\"\"", "\n", "x", "=", "self", ".", "dropout", "(", "x", ")", "\n", "y", "=", "self", ".", "dropout", "(", "y", ")", "\n", "y", "=", "y", ".", "unsqueeze", "(", "1", ")", ".", "expand_as", "(", "x", ")", "\n", "flat_x", "=", "torch", ".", "cat", "(", "[", "x", ",", "y", "]", ",", "2", ")", ".", "contiguous", "(", ")", ".", "view", "(", "x", ".", "size", "(", "0", ")", "*", "x", ".", "size", "(", "1", ")", ",", "-", "1", ")", "\n", "flat_scores", "=", "self", ".", "linear", "(", "flat_x", ")", "\n", "scores", "=", "flat_scores", ".", "contiguous", "(", ")", ".", "view", "(", "x", ".", "size", "(", "0", ")", ",", "-", "1", ")", "\n", "scores", ".", "data", ".", "masked_fill_", "(", "x_mask", ".", "data", ",", "-", "float", "(", "\"inf\"", ")", ")", "\n", "return", "scores", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.FlatSim.__init__": [[454, 468], ["torch.Module.__init__", "opt.get", "torch.Linear", "torch.Linear", "torch.Linear", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "dropout_wrapper.DropoutWrapper", "opt.get"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm"], ["    ", "def", "__init__", "(", "self", ",", "x_size", ",", "y_size", ",", "opt", "=", "{", "}", ",", "prefix", "=", "\"seqatt\"", ",", "dropout", "=", "None", ")", ":", "\n", "        ", "super", "(", "FlatSim", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "x_size", "==", "y_size", "\n", "self", ".", "opt", "=", "opt", "\n", "self", ".", "weight_norm_on", "=", "opt", ".", "get", "(", "\"{}_weight_norm_on\"", ".", "format", "(", "prefix", ")", ",", "False", ")", "\n", "self", ".", "linear", "=", "nn", ".", "Linear", "(", "x_size", "*", "3", ",", "1", ")", "\n", "if", "self", ".", "weight_norm_on", ":", "\n", "            ", "self", ".", "linear", "=", "weight_norm", "(", "self", ".", "linear", ")", "\n", "", "if", "dropout", "is", "None", ":", "\n", "            ", "self", ".", "dropout", "=", "DropoutWrapper", "(", "\n", "opt", ".", "get", "(", "\"{}_dropout_p\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "0", ")", "\n", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "dropout", "=", "dropout", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.FlatSim.forward": [[469, 487], ["similarity.FlatSim.dropout", "similarity.FlatSim.dropout", "y.unsqueeze().expand_as.unsqueeze().expand_as.unsqueeze().expand_as", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "similarity.FlatSim.linear", "similarity.FlatSim.contiguous().view", "similarity.FlatSim.contiguous().view.data.masked_fill_", "similarity.FlatSim.size", "y.unsqueeze().expand_as.unsqueeze().expand_as.unsqueeze", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "similarity.FlatSim.size", "similarity.FlatSim.size", "similarity.FlatSim.contiguous", "float", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.linear"], ["", "", "def", "forward", "(", "self", ",", "x", ",", "y", ",", "x_mask", ")", ":", "\n", "        ", "\"\"\"\n        x = batch * len * h1\n        y = batch * h2\n        x_mask = batch * len\n        \"\"\"", "\n", "x", "=", "self", ".", "dropout", "(", "x", ")", "\n", "y", "=", "self", ".", "dropout", "(", "y", ")", "\n", "y", "=", "y", ".", "unsqueeze", "(", "1", ")", ".", "expand_as", "(", "x", ")", "\n", "\n", "flat_x", "=", "(", "\n", "torch", ".", "cat", "(", "[", "x", ",", "y", ",", "x", "*", "y", "]", ",", "2", ")", ".", "contiguous", "(", ")", ".", "view", "(", "x", ".", "size", "(", "0", ")", "*", "x", ".", "size", "(", "1", ")", ",", "-", "1", ")", "\n", ")", "\n", "flat_scores", "=", "self", ".", "linear", "(", "flat_x", ")", "\n", "scores", "=", "flat_scores", ".", "contiguous", "(", ")", ".", "view", "(", "x", ".", "size", "(", "0", ")", ",", "-", "1", ")", "\n", "scores", ".", "data", ".", "masked_fill_", "(", "x_mask", ".", "data", ",", "-", "float", "(", "\"inf\"", ")", ")", "\n", "\n", "return", "scores", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.FlatSimV2.__init__": [[490, 504], ["torch.Module.__init__", "opt.get", "torch.Linear", "torch.Linear", "torch.Linear", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "dropout_wrapper.DropoutWrapper", "opt.get"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm"], ["    ", "def", "__init__", "(", "self", ",", "x_size", ",", "y_size", ",", "opt", "=", "{", "}", ",", "prefix", "=", "\"seqatt\"", ",", "dropout", "=", "None", ")", ":", "\n", "        ", "super", "(", "FlatSimV2", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "x_size", "==", "y_size", "\n", "self", ".", "opt", "=", "opt", "\n", "self", ".", "weight_norm_on", "=", "opt", ".", "get", "(", "\"{}_weight_norm_on\"", ".", "format", "(", "prefix", ")", ",", "False", ")", "\n", "self", ".", "linear", "=", "nn", ".", "Linear", "(", "x_size", "*", "4", ",", "1", ")", "\n", "if", "self", ".", "weight_norm_on", ":", "\n", "            ", "self", ".", "linear", "=", "weight_norm", "(", "self", ".", "linear", ")", "\n", "", "if", "dropout", "is", "None", ":", "\n", "            ", "self", ".", "dropout", "=", "DropoutWrapper", "(", "\n", "opt", ".", "get", "(", "\"{}_dropout_p\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "0", ")", "\n", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "dropout", "=", "dropout", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.FlatSimV2.forward": [[505, 525], ["similarity.FlatSimV2.dropout", "similarity.FlatSimV2.dropout", "y.unsqueeze().expand_as.unsqueeze().expand_as.unsqueeze().expand_as", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "torch.cat().contiguous().view", "similarity.FlatSimV2.linear", "similarity.FlatSimV2.contiguous().view", "similarity.FlatSimV2.contiguous().view.data.masked_fill_", "similarity.FlatSimV2.size", "y.unsqueeze().expand_as.unsqueeze().expand_as.unsqueeze", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "torch.cat().contiguous", "similarity.FlatSimV2.size", "similarity.FlatSimV2.size", "similarity.FlatSimV2.contiguous", "float", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.abs"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.linear"], ["", "", "def", "forward", "(", "self", ",", "x", ",", "y", ",", "x_mask", ")", ":", "\n", "        ", "\"\"\"\n        x = batch * len * h1\n        y = batch * h2\n        x_mask = batch * len\n        \"\"\"", "\n", "x", "=", "self", ".", "dropout", "(", "x", ")", "\n", "y", "=", "self", ".", "dropout", "(", "y", ")", "\n", "y", "=", "y", ".", "unsqueeze", "(", "1", ")", ".", "expand_as", "(", "x", ")", "\n", "\n", "flat_x", "=", "(", "\n", "torch", ".", "cat", "(", "[", "x", ",", "y", ",", "x", "*", "y", ",", "torch", ".", "abs", "(", "x", "-", "y", ")", "]", ",", "2", ")", "\n", ".", "contiguous", "(", ")", "\n", ".", "view", "(", "x", ".", "size", "(", "0", ")", "*", "x", ".", "size", "(", "1", ")", ",", "-", "1", ")", "\n", ")", "\n", "flat_scores", "=", "self", ".", "linear", "(", "flat_x", ")", "\n", "scores", "=", "flat_scores", ".", "contiguous", "(", ")", ".", "view", "(", "x", ".", "size", "(", "0", ")", ",", "-", "1", ")", "\n", "scores", ".", "data", ".", "masked_fill_", "(", "x_mask", ".", "data", ",", "-", "float", "(", "\"inf\"", ")", ")", "\n", "\n", "return", "scores", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.FlatSimilarityWrapper.__init__": [[528, 548], ["torch.Module.__init__", "opt.get().lower", "dropout_wrapper.DropoutWrapper", "opt.get", "similarity.BilinearFlatSim", "opt.get", "similarity.SimpleFlatSim", "similarity.FlatSim", "similarity.FlatSimV2"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "x1_dim", ",", "x2_dim", ",", "prefix", "=", "\"attention\"", ",", "opt", "=", "{", "}", ",", "dropout", "=", "None", ")", ":", "\n", "        ", "super", "(", "FlatSimilarityWrapper", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "score_func_str", "=", "opt", ".", "get", "(", "\"{}_att_type\"", ".", "format", "(", "prefix", ")", ",", "\"none\"", ")", ".", "lower", "(", ")", "\n", "self", ".", "att_dropout", "=", "DropoutWrapper", "(", "opt", ".", "get", "(", "\"{}_att_dropout\"", ".", "format", "(", "prefix", ")", ",", "0", ")", ")", "\n", "self", ".", "score_func", "=", "None", "\n", "if", "self", ".", "score_func_str", "==", "\"bilinear\"", ":", "\n", "            ", "self", ".", "score_func", "=", "BilinearFlatSim", "(", "\n", "x1_dim", ",", "x2_dim", ",", "prefix", "=", "prefix", ",", "opt", "=", "opt", ",", "dropout", "=", "dropout", "\n", ")", "\n", "", "elif", "self", ".", "score_func_str", "==", "\"simple\"", ":", "\n", "            ", "self", ".", "score_func", "=", "SimpleFlatSim", "(", "\n", "x1_dim", ",", "x2_dim", ",", "prefix", "=", "prefix", ",", "opt", "=", "opt", ",", "dropout", "=", "dropout", "\n", ")", "\n", "", "elif", "self", ".", "score_func_str", "==", "\"flatsim\"", ":", "\n", "            ", "self", ".", "score_func", "=", "FlatSim", "(", "\n", "x1_dim", ",", "x2_dim", ",", "prefix", "=", "prefix", ",", "opt", "=", "opt", ",", "dropout", "=", "dropout", "\n", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "score_func", "=", "FlatSimV2", "(", "\n", "x1_dim", ",", "x2_dim", ",", "prefix", "=", "prefix", ",", "opt", "=", "opt", ",", "dropout", "=", "dropout", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.FlatSimilarityWrapper.forward": [[550, 553], ["similarity.FlatSimilarityWrapper.score_func"], "methods", ["None"], ["", "", "def", "forward", "(", "self", ",", "x1", ",", "x2", ",", "mask", ")", ":", "\n", "        ", "scores", "=", "self", ".", "score_func", "(", "x1", ",", "x2", ",", "mask", ")", "\n", "return", "scores", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.MultiheadAttentionWrapper.__init__": [[560, 620], ["torch.Module.__init__", "opt.get", "opt.get", "opt.get", "opt.get", "opt.get", "opt.get", "opt.get", "dropout_wrapper.DropoutWrapper", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "common.activation", "opt.get", "opt.get", "torch.Linear", "torch.Linear", "torch.Linear", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.activation", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm"], ["def", "__init__", "(", "\n", "self", ",", "query_dim", ",", "key_dim", ",", "value_dim", ",", "prefix", "=", "\"attention\"", ",", "opt", "=", "{", "}", ",", "dropout", "=", "None", "\n", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "prefix", "=", "prefix", "\n", "\n", "self", ".", "num_heads", "=", "opt", ".", "get", "(", "\"{}_head\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "1", ")", "\n", "self", ".", "dropout", "=", "(", "\n", "DropoutWrapper", "(", "opt", ".", "get", "(", "\"{}_dropout\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "0", ")", ")", "\n", "if", "dropout", "is", "None", "\n", "else", "dropout", "\n", ")", "\n", "\n", "self", ".", "qkv_dim", "=", "[", "query_dim", ",", "key_dim", ",", "value_dim", "]", "\n", "assert", "query_dim", "==", "key_dim", ",", "\"query dim must equal with key dim\"", "\n", "\n", "self", ".", "hidden_size", "=", "opt", ".", "get", "(", "\"{}_hidden_size\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "64", ")", "\n", "\n", "self", ".", "proj_on", "=", "opt", ".", "get", "(", "\"{}_proj_on\"", ".", "format", "(", "prefix", ")", ",", "False", ")", "\n", "self", ".", "share", "=", "opt", ".", "get", "(", "\"{}_share\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "False", ")", "\n", "self", ".", "layer_norm_on", "=", "opt", ".", "get", "(", "\"{}_norm_on\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "False", ")", "\n", "self", ".", "scale_on", "=", "opt", ".", "get", "(", "\"{}_scale_on\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "False", ")", "\n", "\n", "if", "self", ".", "proj_on", ":", "\n", "            ", "self", ".", "proj_modules", "=", "nn", ".", "ModuleList", "(", "\n", "[", "nn", ".", "Linear", "(", "dim", ",", "self", ".", "hidden_size", ")", "for", "dim", "in", "self", ".", "qkv_dim", "[", "0", ":", "2", "]", "]", "\n", ")", "\n", "if", "self", ".", "layer_norm_on", ":", "\n", "                ", "for", "proj", "in", "self", ".", "proj_modules", ":", "\n", "                    ", "proj", "=", "weight_norm", "(", "proj", ")", "\n", "", "", "if", "self", ".", "share", "and", "self", ".", "qkv_dim", "[", "0", "]", "==", "self", ".", "qkv_dim", "[", "1", "]", ":", "\n", "                ", "self", ".", "proj_modules", "[", "1", "]", "=", "self", ".", "proj_modules", "[", "0", "]", "\n", "", "self", ".", "f", "=", "activation", "(", "opt", ".", "get", "(", "\"{}_activation\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "\"relu\"", ")", ")", "\n", "\n", "self", ".", "qkv_head_dim", "=", "[", "self", ".", "hidden_size", "//", "self", ".", "num_heads", "]", "*", "3", "\n", "self", ".", "qkv_head_dim", "[", "2", "]", "=", "value_dim", "//", "self", ".", "num_heads", "\n", "assert", "(", "\n", "self", ".", "qkv_head_dim", "[", "0", "]", "*", "self", ".", "num_heads", "==", "self", ".", "hidden_size", "\n", ")", ",", "\"hidden size must be divisible by num_heads\"", "\n", "assert", "(", "\n", "self", ".", "qkv_head_dim", "[", "2", "]", "*", "self", ".", "num_heads", "==", "value_dim", "\n", ")", ",", "\"value size must be divisible by num_heads\"", "\n", "\n", "", "else", ":", "\n", "            ", "self", ".", "qkv_head_dim", "=", "[", "emb", "//", "self", ".", "num_heads", "for", "emb", "in", "self", ".", "qkv_dim", "]", "\n", "# import pdb; pdb.set_trace()", "\n", "assert", "(", "\n", "self", ".", "qkv_head_dim", "[", "0", "]", "*", "self", ".", "num_heads", "==", "self", ".", "qkv_dim", "[", "0", "]", "\n", ")", ",", "\"query size must be divisible by num_heads\"", "\n", "assert", "(", "\n", "self", ".", "qkv_head_dim", "[", "1", "]", "*", "self", ".", "num_heads", "==", "self", ".", "qkv_dim", "[", "1", "]", "\n", ")", ",", "\"key size must be divisible by num_heads\"", "\n", "assert", "(", "\n", "self", ".", "qkv_head_dim", "[", "2", "]", "*", "self", ".", "num_heads", "==", "self", ".", "qkv_dim", "[", "2", "]", "\n", ")", ",", "\"value size must be divisible by num_heads\"", "\n", "\n", "", "if", "self", ".", "scale_on", ":", "\n", "            ", "self", ".", "scaling", "=", "self", ".", "qkv_head_dim", "[", "0", "]", "**", "-", "0.5", "\n", "", "self", ".", "drop_diagonal", "=", "opt", ".", "get", "(", "\"{}_drop_diagonal\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "False", ")", "\n", "self", ".", "output_size", "=", "self", ".", "qkv_dim", "[", "2", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.similarity.MultiheadAttentionWrapper.forward": [[621, 703], ["query.transpose.transpose.transpose", "key.transpose.transpose.transpose", "value.transpose.transpose.transpose", "query.transpose.transpose.size", "k.contiguous().view().transpose.contiguous().view().transpose.size", "q.contiguous().view().transpose.contiguous().view().transpose.contiguous().view().transpose", "k.contiguous().view().transpose.contiguous().view().transpose.contiguous().view().transpose", "v.contiguous().view().transpose.contiguous().view().transpose.contiguous().view().transpose", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.softmax().type_as", "torch.softmax().type_as", "torch.softmax().type_as", "similarity.MultiheadAttentionWrapper.dropout", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "attn.transpose.transpose.transpose().contiguous().view", "attn.transpose.transpose.transpose", "k.contiguous().view().transpose.contiguous().view().transpose.transpose", "list", "attn_weights.view.view.view", "attn_weights.view.view.float().masked_fill().type_as", "attn_weights.view.view.view", "torch.diag().byte().unsqueeze().expand_as", "torch.diag().byte().unsqueeze().expand_as", "torch.diag().byte().unsqueeze().expand_as", "torch.diag().byte().unsqueeze().expand_as", "torch.diag().byte().unsqueeze().expand_as", "torch.diag().byte().unsqueeze().expand_as", "torch.diag().byte().unsqueeze().expand_as", "torch.diag().byte().unsqueeze().expand_as", "torch.diag().byte().unsqueeze().expand_as", "attn_weights.view.view.data.masked_fill_", "list", "similarity.MultiheadAttentionWrapper.f", "key_padding_mask.size", "key_padding_mask.size", "q.contiguous().view().transpose.contiguous().view().transpose.contiguous().view", "k.contiguous().view().transpose.contiguous().view().transpose.contiguous().view", "v.contiguous().view().transpose.contiguous().view().transpose.contiguous().view", "attn_weights.view.view.size", "attn_weights.view.view.size", "attn_weights.view.view.size", "torch.softmax", "torch.softmax", "torch.softmax", "attn.transpose.transpose.size", "attn.transpose.transpose.transpose().contiguous", "similarity.MultiheadAttentionWrapper.dropout", "similarity.MultiheadAttentionWrapper.dropout", "proj", "zip", "attn_weights.view.view.float().masked_fill", "torch.diag().byte().unsqueeze", "torch.diag().byte().unsqueeze", "torch.diag().byte().unsqueeze", "torch.diag().byte().unsqueeze", "torch.diag().byte().unsqueeze", "torch.diag().byte().unsqueeze", "torch.diag().byte().unsqueeze", "torch.diag().byte().unsqueeze", "torch.diag().byte().unsqueeze", "float", "attn_weights.view.view.float", "q.contiguous().view().transpose.contiguous().view().transpose.contiguous", "k.contiguous().view().transpose.contiguous().view().transpose.contiguous", "v.contiguous().view().transpose.contiguous().view().transpose.contiguous", "key_padding_mask.unsqueeze().unsqueeze", "float", "attn.transpose.transpose.transpose", "attn_weights.view.view.float", "torch.diag().byte", "torch.diag().byte", "torch.diag().byte", "torch.diag().byte", "torch.diag().byte", "torch.diag().byte", "torch.diag().byte", "torch.diag().byte", "torch.diag().byte", "key_padding_mask.unsqueeze", "torch.diag", "torch.diag", "torch.diag", "torch.diag", "torch.diag", "torch.diag", "torch.diag", "torch.diag", "torch.diag", "attn_weights.view.view.data.new().zero_", "attn_weights.view.view.data.new", "attn_weights.view.view.size"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "query", ",", "key", ",", "value", ",", "key_padding_mask", "=", "None", ")", ":", "\n", "        ", "query", "=", "query", ".", "transpose", "(", "0", ",", "1", ")", "\n", "key", "=", "key", ".", "transpose", "(", "0", ",", "1", ")", "\n", "value", "=", "value", ".", "transpose", "(", "0", ",", "1", ")", "\n", "\n", "tgt_len", ",", "bsz", ",", "embed_dim", "=", "query", ".", "size", "(", ")", "\n", "assert", "embed_dim", "==", "self", ".", "qkv_dim", "[", "0", "]", "\n", "\n", "q", ",", "k", ",", "v", "=", "query", ",", "key", ",", "value", "\n", "if", "self", ".", "proj_on", ":", "\n", "            ", "if", "self", ".", "dropout", ":", "\n", "                ", "q", ",", "k", "=", "self", ".", "dropout", "(", "q", ")", ",", "self", ".", "dropout", "(", "k", ")", "\n", "", "q", ",", "k", "=", "[", "\n", "self", ".", "f", "(", "proj", "(", "input", ")", ")", "\n", "for", "input", ",", "proj", "in", "zip", "(", "[", "query", ",", "key", "]", ",", "self", ".", "proj_modules", ")", "\n", "]", "\n", "\n", "", "src_len", "=", "k", ".", "size", "(", "0", ")", "\n", "if", "key_padding_mask", "is", "not", "None", ":", "\n", "            ", "assert", "key_padding_mask", ".", "size", "(", "0", ")", "==", "bsz", "\n", "assert", "key_padding_mask", ".", "size", "(", "1", ")", "==", "src_len", "\n", "\n", "", "if", "self", ".", "scale_on", ":", "\n", "            ", "q", "*=", "self", ".", "scaling", "\n", "\n", "", "q", "=", "(", "\n", "q", ".", "contiguous", "(", ")", "\n", ".", "view", "(", "tgt_len", ",", "bsz", "*", "self", ".", "num_heads", ",", "self", ".", "qkv_head_dim", "[", "0", "]", ")", "\n", ".", "transpose", "(", "0", ",", "1", ")", "\n", ")", "\n", "k", "=", "(", "\n", "k", ".", "contiguous", "(", ")", "\n", ".", "view", "(", "src_len", ",", "bsz", "*", "self", ".", "num_heads", ",", "self", ".", "qkv_head_dim", "[", "1", "]", ")", "\n", ".", "transpose", "(", "0", ",", "1", ")", "\n", ")", "\n", "v", "=", "(", "\n", "v", ".", "contiguous", "(", ")", "\n", ".", "view", "(", "src_len", ",", "bsz", "*", "self", ".", "num_heads", ",", "self", ".", "qkv_head_dim", "[", "2", "]", ")", "\n", ".", "transpose", "(", "0", ",", "1", ")", "\n", ")", "\n", "\n", "attn_weights", "=", "torch", ".", "bmm", "(", "q", ",", "k", ".", "transpose", "(", "1", ",", "2", ")", ")", "\n", "assert", "list", "(", "attn_weights", ".", "size", "(", ")", ")", "==", "[", "bsz", "*", "self", ".", "num_heads", ",", "tgt_len", ",", "src_len", "]", "\n", "\n", "if", "key_padding_mask", "is", "not", "None", ":", "\n", "# don't attend to padding symbols", "\n", "            ", "attn_weights", "=", "attn_weights", ".", "view", "(", "bsz", ",", "self", ".", "num_heads", ",", "tgt_len", ",", "src_len", ")", "\n", "attn_weights", "=", "(", "\n", "attn_weights", ".", "float", "(", ")", "\n", ".", "masked_fill", "(", "\n", "key_padding_mask", ".", "unsqueeze", "(", "1", ")", ".", "unsqueeze", "(", "2", ")", ",", "\n", "float", "(", "\"-inf\"", ")", ",", "\n", ")", "\n", ".", "type_as", "(", "attn_weights", ")", "\n", ")", "# FP16 support: cast to float and back", "\n", "attn_weights", "=", "attn_weights", ".", "view", "(", "bsz", "*", "self", ".", "num_heads", ",", "tgt_len", ",", "src_len", ")", "\n", "\n", "", "if", "self", ".", "drop_diagonal", ":", "\n", "            ", "assert", "attn_weights", ".", "size", "(", "1", ")", "==", "attn_weights", ".", "size", "(", "2", ")", "\n", "diag_mask", "=", "(", "\n", "torch", ".", "diag", "(", "attn_weights", ".", "data", ".", "new", "(", "attn_weights", ".", "size", "(", "1", ")", ")", ".", "zero_", "(", ")", "+", "1", ")", "\n", ".", "byte", "(", ")", "\n", ".", "unsqueeze", "(", "0", ")", "\n", ".", "expand_as", "(", "attn_weights", ")", "\n", ")", "\n", "attn_weights", ".", "data", ".", "masked_fill_", "(", "diag_mask", ",", "-", "float", "(", "\"inf\"", ")", ")", "\n", "\n", "", "attn_weights", "=", "F", ".", "softmax", "(", "attn_weights", ".", "float", "(", ")", ",", "dim", "=", "-", "1", ")", ".", "type_as", "(", "attn_weights", ")", "\n", "attn_weights", "=", "self", ".", "dropout", "(", "attn_weights", ")", "\n", "\n", "attn", "=", "torch", ".", "bmm", "(", "attn_weights", ",", "v", ")", "\n", "assert", "list", "(", "attn", ".", "size", "(", ")", ")", "==", "[", "\n", "bsz", "*", "self", ".", "num_heads", ",", "\n", "tgt_len", ",", "\n", "self", ".", "qkv_head_dim", "[", "2", "]", ",", "\n", "]", "\n", "attn", "=", "attn", ".", "transpose", "(", "0", ",", "1", ")", ".", "contiguous", "(", ")", ".", "view", "(", "tgt_len", ",", "bsz", ",", "-", "1", ")", "\n", "\n", "# output_shape: Batch * Time * Channel", "\n", "attn", "=", "attn", ".", "transpose", "(", "0", ",", "1", ")", "\n", "\n", "return", "attn", "\n", "", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.san.Classifier.__init__": [[29, 46], ["torch.Module.__init__", "opt.get", "opt.get", "module.dropout_wrapper.DropoutWrapper", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "torch.nn.utils.weight_norm", "opt.get"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm"], ["    ", "def", "__init__", "(", "self", ",", "x_size", ",", "y_size", ",", "opt", ",", "prefix", "=", "\"decoder\"", ",", "dropout", "=", "None", ")", ":", "\n", "        ", "super", "(", "Classifier", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "opt", "=", "opt", "\n", "if", "dropout", "is", "None", ":", "\n", "            ", "self", ".", "dropout", "=", "DropoutWrapper", "(", "opt", ".", "get", "(", "\"{}_dropout_p\"", ".", "format", "(", "prefix", ")", ",", "0", ")", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "dropout", "=", "dropout", "\n", "", "self", ".", "merge_opt", "=", "opt", ".", "get", "(", "\"{}_merge_opt\"", ".", "format", "(", "prefix", ")", ",", "0", ")", "\n", "self", ".", "weight_norm_on", "=", "opt", ".", "get", "(", "\"{}_weight_norm_on\"", ".", "format", "(", "prefix", ")", ",", "False", ")", "\n", "\n", "if", "self", ".", "merge_opt", "==", "1", ":", "\n", "            ", "self", ".", "proj", "=", "nn", ".", "Linear", "(", "x_size", "*", "4", ",", "y_size", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "proj", "=", "nn", ".", "Linear", "(", "x_size", "*", "2", ",", "y_size", ")", "\n", "\n", "", "if", "self", ".", "weight_norm_on", ":", "\n", "            ", "self", ".", "proj", "=", "weight_norm", "(", "self", ".", "proj", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.san.Classifier.forward": [[47, 55], ["san.Classifier.dropout", "san.Classifier.proj", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat"], "methods", ["None"], ["", "", "def", "forward", "(", "self", ",", "x1", ",", "x2", ",", "mask", "=", "None", ")", ":", "\n", "        ", "if", "self", ".", "merge_opt", "==", "1", ":", "\n", "            ", "x", "=", "torch", ".", "cat", "(", "[", "x1", ",", "x2", ",", "(", "x1", "-", "x2", ")", ".", "abs", "(", ")", ",", "x1", "*", "x2", "]", ",", "1", ")", "\n", "", "else", ":", "\n", "            ", "x", "=", "torch", ".", "cat", "(", "[", "x1", ",", "x2", "]", ",", "1", ")", "\n", "", "x", "=", "self", ".", "dropout", "(", "x", ")", "\n", "scores", "=", "self", ".", "proj", "(", "x", ")", "\n", "return", "scores", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.san.SANClassifier.__init__": [[62, 94], ["torch.Module.__init__", "module.similarity.SelfAttnWrapper", "module.similarity.FlatSimilarityWrapper", "opt.get", "opt.get", "opt.get", "opt.get", "opt.get", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "san.Classifier", "module.dropout_wrapper.DropoutWrapper", "opt.get().upper", "getattr", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "module.my_optim.weight_norm", "opt.get", "opt.get"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm"], ["def", "__init__", "(", "\n", "self", ",", "x_size", ",", "h_size", ",", "label_size", ",", "opt", "=", "{", "}", ",", "prefix", "=", "\"decoder\"", ",", "dropout", "=", "None", "\n", ")", ":", "\n", "        ", "super", "(", "SANClassifier", ",", "self", ")", ".", "__init__", "(", ")", "\n", "if", "dropout", "is", "None", ":", "\n", "            ", "self", ".", "dropout", "=", "DropoutWrapper", "(", "\n", "opt", ".", "get", "(", "\"{}_dropout_p\"", ".", "format", "(", "self", ".", "prefix", ")", ",", "0", ")", "\n", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "dropout", "=", "dropout", "\n", "", "self", ".", "prefix", "=", "prefix", "\n", "self", ".", "query_wsum", "=", "SelfAttnWrapper", "(", "\n", "x_size", ",", "prefix", "=", "\"mem_cum\"", ",", "opt", "=", "opt", ",", "dropout", "=", "self", ".", "dropout", "\n", ")", "\n", "self", ".", "attn", "=", "FlatSimilarityWrapper", "(", "x_size", ",", "h_size", ",", "prefix", ",", "opt", ",", "self", ".", "dropout", ")", "\n", "self", ".", "rnn_type", "=", "\"{}{}\"", ".", "format", "(", "\n", "opt", ".", "get", "(", "\"{}_rnn_type\"", ".", "format", "(", "prefix", ")", ",", "\"gru\"", ")", ".", "upper", "(", ")", ",", "\"Cell\"", "\n", ")", "\n", "self", ".", "rnn", "=", "getattr", "(", "nn", ",", "self", ".", "rnn_type", ")", "(", "x_size", ",", "h_size", ")", "\n", "self", ".", "num_turn", "=", "opt", ".", "get", "(", "\"{}_num_turn\"", ".", "format", "(", "prefix", ")", ",", "5", ")", "\n", "self", ".", "opt", "=", "opt", "\n", "self", ".", "mem_random_drop", "=", "opt", ".", "get", "(", "\"{}_mem_drop_p\"", ".", "format", "(", "prefix", ")", ",", "0", ")", "\n", "self", ".", "mem_type", "=", "opt", ".", "get", "(", "\"{}_mem_type\"", ".", "format", "(", "prefix", ")", ",", "0", ")", "\n", "self", ".", "weight_norm_on", "=", "opt", ".", "get", "(", "\"{}_weight_norm_on\"", ".", "format", "(", "prefix", ")", ",", "False", ")", "\n", "self", ".", "label_size", "=", "label_size", "\n", "self", ".", "dump_state", "=", "opt", ".", "get", "(", "\"dump_state_on\"", ",", "False", ")", "\n", "self", ".", "alpha", "=", "Parameter", "(", "torch", ".", "zeros", "(", "1", ",", "1", ")", ",", "requires_grad", "=", "False", ")", "\n", "if", "self", ".", "weight_norm_on", ":", "\n", "            ", "self", ".", "rnn", "=", "WN", "(", "self", ".", "rnn", ")", "\n", "\n", "", "self", ".", "classifier", "=", "Classifier", "(", "\n", "x_size", ",", "self", ".", "label_size", ",", "opt", ",", "prefix", "=", "prefix", ",", "dropout", "=", "self", ".", "dropout", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.san.SANClassifier.forward": [[96, 133], ["san.SANClassifier.query_wsum", "range", "type", "san.SANClassifier.new().zero_", "san.SANClassifier.attn", "torch.bmm().squeeze", "torch.bmm().squeeze", "torch.bmm().squeeze", "torch.bmm().squeeze", "torch.bmm().squeeze", "torch.bmm().squeeze", "torch.bmm().squeeze", "torch.bmm().squeeze", "torch.bmm().squeeze", "san.SANClassifier.classifier", "scores_list.append", "san.generate_mask", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.log", "torch.log", "torch.log", "torch.log", "torch.log", "torch.log", "torch.log", "torch.log", "torch.log", "san.SANClassifier.dropout", "san.SANClassifier.alpha.data.new", "m.contiguous", "san.SANClassifier.new", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "type", "san.SANClassifier.rnn", "san.SANClassifier.rnn", "x.size", "torch.unbind", "torch.unbind", "torch.unbind", "torch.unbind", "torch.unbind", "torch.unbind", "torch.unbind", "torch.unbind", "torch.unbind", "mask[].view().expand_as", "torch.softmax", "torch.softmax", "torch.softmax", "enumerate", "san.SANClassifier.size", "torch.softmax().unsqueeze", "torch.softmax().unsqueeze", "torch.softmax().unsqueeze", "mask[].view", "torch.softmax", "torch.softmax", "torch.softmax", "x.size"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.module.san.generate_mask"], ["", "def", "forward", "(", "self", ",", "x", ",", "h0", ",", "x_mask", "=", "None", ",", "h_mask", "=", "None", ")", ":", "\n", "        ", "h0", "=", "self", ".", "query_wsum", "(", "h0", ",", "h_mask", ")", "\n", "if", "type", "(", "self", ".", "rnn", ")", "is", "nn", ".", "LSTMCell", ":", "\n", "            ", "c0", "=", "h0", ".", "new", "(", "h0", ".", "size", "(", ")", ")", ".", "zero_", "(", ")", "\n", "", "scores_list", "=", "[", "]", "\n", "for", "turn", "in", "range", "(", "self", ".", "num_turn", ")", ":", "\n", "            ", "att_scores", "=", "self", ".", "attn", "(", "x", ",", "h0", ",", "x_mask", ")", "\n", "x_sum", "=", "torch", ".", "bmm", "(", "F", ".", "softmax", "(", "att_scores", ",", "1", ")", ".", "unsqueeze", "(", "1", ")", ",", "x", ")", ".", "squeeze", "(", "1", ")", "\n", "scores", "=", "self", ".", "classifier", "(", "x_sum", ",", "h0", ")", "\n", "scores_list", ".", "append", "(", "scores", ")", "\n", "# next turn", "\n", "if", "self", ".", "rnn", "is", "not", "None", ":", "\n", "                ", "h0", "=", "self", ".", "dropout", "(", "h0", ")", "\n", "if", "type", "(", "self", ".", "rnn", ")", "is", "nn", ".", "LSTMCell", ":", "\n", "                    ", "h0", ",", "c0", "=", "self", ".", "rnn", "(", "x_sum", ",", "(", "h0", ",", "c0", ")", ")", "\n", "", "else", ":", "\n", "                    ", "h0", "=", "self", ".", "rnn", "(", "x_sum", ",", "h0", ")", "\n", "", "", "", "if", "self", ".", "mem_type", "==", "1", ":", "\n", "            ", "mask", "=", "generate_mask", "(", "\n", "self", ".", "alpha", ".", "data", ".", "new", "(", "x", ".", "size", "(", "0", ")", ",", "self", ".", "num_turn", ")", ",", "\n", "self", ".", "mem_random_drop", ",", "\n", "self", ".", "training", ",", "\n", ")", "\n", "mask", "=", "[", "m", ".", "contiguous", "(", ")", "for", "m", "in", "torch", ".", "unbind", "(", "mask", ",", "1", ")", "]", "\n", "tmp_scores_list", "=", "[", "\n", "mask", "[", "idx", "]", ".", "view", "(", "x", ".", "size", "(", "0", ")", ",", "1", ")", ".", "expand_as", "(", "inp", ")", "*", "F", ".", "softmax", "(", "inp", ",", "1", ")", "\n", "for", "idx", ",", "inp", "in", "enumerate", "(", "scores_list", ")", "\n", "]", "\n", "scores", "=", "torch", ".", "stack", "(", "tmp_scores_list", ",", "2", ")", "\n", "scores", "=", "torch", ".", "mean", "(", "scores", ",", "2", ")", "\n", "scores", "=", "torch", ".", "log", "(", "scores", ")", "\n", "", "else", ":", "\n", "            ", "scores", "=", "scores_list", "[", "-", "1", "]", "\n", "", "if", "self", ".", "dump_state", ":", "\n", "            ", "return", "scores", ",", "scores_list", "\n", "", "else", ":", "\n", "            ", "return", "scores", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.san.MaskLmHeader.__init__": [[138, 145], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "embedding_weights.size", "embedding_weights.size", "embedding_weights.size"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["def", "__init__", "(", "self", ",", "embedding_weights", "=", "None", ",", "bias", "=", "False", ")", ":", "\n", "        ", "super", "(", "MaskLmHeader", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "decoder", "=", "nn", ".", "Linear", "(", "\n", "embedding_weights", ".", "size", "(", "1", ")", ",", "embedding_weights", ".", "size", "(", "0", ")", ",", "bias", "=", "bias", "\n", ")", "\n", "self", ".", "decoder", ".", "weight", "=", "embedding_weights", "\n", "self", ".", "nsp", "=", "nn", ".", "Linear", "(", "embedding_weights", ".", "size", "(", "1", ")", ",", "2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.san.MaskLmHeader.forward": [[146, 150], ["san.MaskLmHeader.decoder", "san.MaskLmHeader.nsp"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "hidden_states", ")", ":", "\n", "        ", "mlm_out", "=", "self", ".", "decoder", "(", "hidden_states", ")", "\n", "nsp_out", "=", "self", ".", "nsp", "(", "hidden_states", "[", ":", ",", "0", ",", ":", "]", ")", "\n", "return", "mlm_out", ",", "nsp_out", "\n", "", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.san.generate_mask": [[16, 26], ["range", "new_data.size", "random.randint", "torch.bernoulli", "torch.bernoulli", "torch.bernoulli", "new_data.zero_", "new_data.size"], "function", ["None"], ["def", "generate_mask", "(", "new_data", ",", "dropout_p", "=", "0.0", ",", "is_training", "=", "False", ")", ":", "\n", "    ", "if", "not", "is_training", ":", "\n", "        ", "dropout_p", "=", "0.0", "\n", "", "new_data", "=", "(", "1", "-", "dropout_p", ")", "*", "(", "new_data", ".", "zero_", "(", ")", "+", "1", ")", "\n", "for", "i", "in", "range", "(", "new_data", ".", "size", "(", "0", ")", ")", ":", "\n", "        ", "one", "=", "random", ".", "randint", "(", "0", ",", "new_data", ".", "size", "(", "1", ")", "-", "1", ")", "\n", "new_data", "[", "i", "]", "[", "one", "]", "=", "1", "\n", "", "mask", "=", "1.0", "/", "(", "1", "-", "dropout_p", ")", "*", "torch", ".", "bernoulli", "(", "new_data", ")", "\n", "mask", ".", "requires_grad", "=", "False", "\n", "return", "mask", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.linear": [[17, 19], ["None"], "function", ["None"], ["def", "linear", "(", "x", ")", ":", "\n", "    ", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.swish": [[21, 23], ["sigmoid"], "function", ["None"], ["", "def", "swish", "(", "x", ")", ":", "\n", "    ", "return", "x", "*", "sigmoid", "(", "x", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.bertgelu": [[25, 27], ["torch.erf", "math.sqrt"], "function", ["None"], ["", "def", "bertgelu", "(", "x", ")", ":", "\n", "    ", "return", "x", "*", "0.5", "*", "(", "1.0", "+", "torch", ".", "erf", "(", "x", "/", "math", ".", "sqrt", "(", "2.0", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.gptgelu": [[29, 34], ["torch.tanh", "math.sqrt", "torch.pow"], "function", ["None"], ["", "def", "gptgelu", "(", "x", ")", ":", "\n", "    ", "return", "(", "\n", "0.5", "\n", "*", "x", "\n", "*", "(", "1", "+", "torch", ".", "tanh", "(", "math", ".", "sqrt", "(", "2", "/", "math", ".", "pi", ")", "*", "(", "x", "+", "0.044715", "*", "torch", ".", "pow", "(", "x", ",", "3", ")", ")", ")", ")", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.activation": [[41, 48], ["eval"], "function", ["None"], ["def", "activation", "(", "func_a", ")", ":", "\n", "    ", "\"\"\"Activation function wrapper\"\"\"", "\n", "try", ":", "\n", "        ", "f", "=", "eval", "(", "\"nn.{}\"", ".", "format", "(", "func_a", ")", ")", "\n", "", "except", ":", "\n", "        ", "f", "=", "linear", "\n", "", "return", "f", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.init_wrapper": [[50, 52], ["eval"], "function", ["None"], ["", "def", "init_wrapper", "(", "init", "=", "\"xavier_uniform\"", ")", ":", "\n", "    ", "return", "eval", "(", "init", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.sub_layers.LayerNorm.__init__": [[12, 17], ["torch.Module.__init__", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "torch.nn.parameter.Parameter", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "hidden_size", ",", "eps", "=", "1e-4", ")", ":", "\n", "        ", "super", "(", "LayerNorm", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "alpha", "=", "Parameter", "(", "torch", ".", "ones", "(", "1", ",", "1", ",", "hidden_size", ")", ")", "# gain g", "\n", "self", ".", "beta", "=", "Parameter", "(", "torch", ".", "zeros", "(", "1", ",", "1", ",", "hidden_size", ")", ")", "# bias b", "\n", "self", ".", "eps", "=", "eps", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.sub_layers.LayerNorm.forward": [[18, 31], ["torch.mean().expand_as", "torch.mean().expand_as", "torch.mean().expand_as", "torch.mean().expand_as", "torch.mean().expand_as", "torch.mean().expand_as", "torch.mean().expand_as", "torch.mean().expand_as", "torch.mean().expand_as", "torch.std().expand_as", "torch.std().expand_as", "torch.std().expand_as", "torch.std().expand_as", "torch.std().expand_as", "torch.std().expand_as", "torch.std().expand_as", "torch.std().expand_as", "torch.std().expand_as", "sub_layers.LayerNorm.beta.expand_as", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.std", "torch.std", "torch.std", "torch.std", "torch.std", "torch.std", "torch.std", "torch.std", "torch.std", "sub_layers.LayerNorm.alpha.expand_as"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "\"\"\"\n        Args:\n            :param x: batch * len * input_size\n\n        Returns:\n            normalized x\n        \"\"\"", "\n", "mu", "=", "torch", ".", "mean", "(", "x", ",", "2", ",", "keepdim", "=", "True", ")", ".", "expand_as", "(", "x", ")", "\n", "sigma", "=", "torch", ".", "std", "(", "x", ",", "2", ",", "keepdim", "=", "True", ")", ".", "expand_as", "(", "x", ")", "\n", "return", "(", "x", "-", "mu", ")", "/", "(", "sigma", "+", "self", ".", "eps", ")", "*", "self", ".", "alpha", ".", "expand_as", "(", "\n", "x", "\n", ")", "+", "self", ".", "beta", ".", "expand_as", "(", "x", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.dropout_wrapper.DropoutWrapper.__init__": [[13, 20], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["def", "__init__", "(", "self", ",", "dropout_p", "=", "0", ",", "enable_vbp", "=", "True", ")", ":", "\n", "        ", "super", "(", "DropoutWrapper", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\"\"\"variational dropout means fix dropout mask\n        ref: https://discuss.pytorch.org/t/dropout-for-rnns/633/11\n        \"\"\"", "\n", "self", ".", "enable_variational_dropout", "=", "enable_vbp", "\n", "self", ".", "dropout_p", "=", "dropout_p", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.dropout_wrapper.DropoutWrapper.forward": [[21, 41], ["len", "torch.dropout", "torch.dropout", "torch.dropout", "x.size", "torch.bernoulli", "torch.bernoulli", "torch.bernoulli", "torch.bernoulli", "torch.bernoulli", "torch.bernoulli", "torch.bernoulli", "torch.bernoulli", "torch.bernoulli", "mask.unsqueeze().expand_as", "mask.unsqueeze", "x.data.new().zero_", "x.data.new", "x.size", "x.size"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "\"\"\"\n        :param x: batch * len * input_size\n        \"\"\"", "\n", "if", "self", ".", "training", "==", "False", "or", "self", ".", "dropout_p", "==", "0", ":", "\n", "            ", "return", "x", "\n", "\n", "", "if", "len", "(", "x", ".", "size", "(", ")", ")", "==", "3", ":", "\n", "            ", "mask", "=", "(", "\n", "1.0", "\n", "/", "(", "1", "-", "self", ".", "dropout_p", ")", "\n", "*", "torch", ".", "bernoulli", "(", "\n", "(", "1", "-", "self", ".", "dropout_p", ")", "\n", "*", "(", "x", ".", "data", ".", "new", "(", "x", ".", "size", "(", "0", ")", ",", "x", ".", "size", "(", "2", ")", ")", ".", "zero_", "(", ")", "+", "1", ")", "\n", ")", "\n", ")", "\n", "mask", ".", "requires_grad", "=", "False", "\n", "return", "mask", ".", "unsqueeze", "(", "1", ")", ".", "expand_as", "(", "x", ")", "*", "x", "\n", "", "else", ":", "\n", "            ", "return", "F", ".", "dropout", "(", "x", ",", "p", "=", "self", ".", "dropout_p", ",", "training", "=", "self", ".", "training", ")", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.EMA.__init__": [[10, 16], ["super().__init__", "my_optim.EMA.setup"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.EMA.setup"], ["    ", "def", "__init__", "(", "self", ",", "gamma", ",", "model", ")", ":", "\n", "        ", "super", "(", "EMA", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "gamma", "=", "gamma", "\n", "self", ".", "shadow", "=", "{", "}", "\n", "self", ".", "model", "=", "model", "\n", "self", ".", "setup", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.EMA.setup": [[17, 21], ["my_optim.EMA.model.named_parameters", "para.clone"], "methods", ["None"], ["", "def", "setup", "(", "self", ")", ":", "\n", "        ", "for", "name", ",", "para", "in", "self", ".", "model", ".", "named_parameters", "(", ")", ":", "\n", "            ", "if", "para", ".", "requires_grad", ":", "\n", "                ", "self", ".", "shadow", "[", "name", "]", "=", "para", ".", "clone", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.EMA.cuda": [[22, 25], ["my_optim.EMA.shadow.items", "v.cuda"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.cuda"], ["", "", "", "def", "cuda", "(", "self", ")", ":", "\n", "        ", "for", "k", ",", "v", "in", "self", ".", "shadow", ".", "items", "(", ")", ":", "\n", "            ", "self", ".", "shadow", "[", "k", "]", "=", "v", ".", "cuda", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.EMA.update": [[26, 32], ["my_optim.EMA.model.named_parameters"], "methods", ["None"], ["", "", "def", "update", "(", "self", ")", ":", "\n", "        ", "for", "name", ",", "para", "in", "self", ".", "model", ".", "named_parameters", "(", ")", ":", "\n", "            ", "if", "para", ".", "requires_grad", ":", "\n", "                ", "self", ".", "shadow", "[", "name", "]", "=", "(", "\n", "1.0", "-", "self", ".", "gamma", "\n", ")", "*", "para", "+", "self", ".", "gamma", "*", "self", ".", "shadow", "[", "name", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.EMA.swap_parameters": [[33, 39], ["my_optim.EMA.model.named_parameters"], "methods", ["None"], ["", "", "", "def", "swap_parameters", "(", "self", ")", ":", "\n", "        ", "for", "name", ",", "para", "in", "self", ".", "model", ".", "named_parameters", "(", ")", ":", "\n", "            ", "if", "para", ".", "requires_grad", ":", "\n", "                ", "temp_data", "=", "para", ".", "data", "\n", "para", ".", "data", "=", "self", ".", "shadow", "[", "name", "]", ".", "data", "\n", "self", ".", "shadow", "[", "name", "]", ".", "data", "=", "temp_data", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.EMA.state_dict": [[40, 42], ["None"], "methods", ["None"], ["", "", "", "def", "state_dict", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "shadow", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.WeightNorm.__init__": [[67, 71], ["super().__init__"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "weights", ",", "dim", ")", ":", "\n", "        ", "super", "(", "WeightNorm", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "weights", "=", "weights", "\n", "self", ".", "dim", "=", "dim", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.WeightNorm.compute_weight": [[72, 76], ["getattr", "getattr", "my_optim._norm"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim._norm"], ["", "def", "compute_weight", "(", "self", ",", "module", ",", "name", ")", ":", "\n", "        ", "g", "=", "getattr", "(", "module", ",", "name", "+", "\"_g\"", ")", "\n", "v", "=", "getattr", "(", "module", ",", "name", "+", "\"_v\"", ")", "\n", "return", "v", "*", "(", "g", "/", "_norm", "(", "v", ",", "self", ".", "dim", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.WeightNorm.apply": [[77, 100], ["issubclass", "my_optim.WeightNorm", "module.register_forward_pre_hook", "type", "hasattr", "print", "getattr", "module.register_parameter", "module.register_parameter", "setattr", "module._parameters.keys", "torch.nn.Parameter", "torch.nn.Parameter", "my_optim.WeightNorm.compute_weight", "str", "my_optim._norm"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.WeightNorm.compute_weight", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim._norm"], ["", "@", "staticmethod", "\n", "def", "apply", "(", "module", ",", "weights", ",", "dim", ")", ":", "\n", "# Terrible temporary solution to an issue regarding compacting weights", "\n", "# re: CUDNN RNN", "\n", "        ", "if", "issubclass", "(", "type", "(", "module", ")", ",", "torch", ".", "nn", ".", "RNNBase", ")", ":", "\n", "            ", "module", ".", "flatten_parameters", "=", "_dummy", "\n", "", "if", "weights", "is", "None", ":", "# do for all weight params", "\n", "            ", "weights", "=", "[", "w", "for", "w", "in", "module", ".", "_parameters", ".", "keys", "(", ")", "if", "\"weight\"", "in", "w", "]", "\n", "", "fn", "=", "WeightNorm", "(", "weights", ",", "dim", ")", "\n", "for", "name", "in", "weights", ":", "\n", "            ", "if", "hasattr", "(", "module", ",", "name", ")", ":", "\n", "                ", "print", "(", "\"Applying weight norm to {} - {}\"", ".", "format", "(", "str", "(", "module", ")", ",", "name", ")", ")", "\n", "weight", "=", "getattr", "(", "module", ",", "name", ")", "\n", "del", "module", ".", "_parameters", "[", "name", "]", "\n", "module", ".", "register_parameter", "(", "\n", "name", "+", "\"_g\"", ",", "Parameter", "(", "_norm", "(", "weight", ",", "dim", ")", ".", "data", ")", "\n", ")", "\n", "module", ".", "register_parameter", "(", "name", "+", "\"_v\"", ",", "Parameter", "(", "weight", ".", "data", ")", ")", "\n", "setattr", "(", "module", ",", "name", ",", "fn", ".", "compute_weight", "(", "module", ",", "name", ")", ")", "\n", "\n", "", "", "module", ".", "register_forward_pre_hook", "(", "fn", ")", "\n", "\n", "return", "fn", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.WeightNorm.remove": [[101, 108], ["my_optim.WeightNorm.compute_weight", "delattr", "module.register_parameter", "torch.nn.Parameter"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.WeightNorm.compute_weight"], ["", "def", "remove", "(", "self", ",", "module", ")", ":", "\n", "        ", "for", "name", "in", "self", ".", "weights", ":", "\n", "            ", "weight", "=", "self", ".", "compute_weight", "(", "module", ")", "\n", "delattr", "(", "module", ",", "name", ")", "\n", "del", "module", ".", "_parameters", "[", "name", "+", "\"_g\"", "]", "\n", "del", "module", ".", "_parameters", "[", "name", "+", "\"_v\"", "]", "\n", "module", ".", "register_parameter", "(", "name", ",", "Parameter", "(", "weight", ".", "data", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.WeightNorm.__call__": [[109, 112], ["setattr", "my_optim.WeightNorm.compute_weight"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.WeightNorm.compute_weight"], ["", "", "def", "__call__", "(", "self", ",", "module", ",", "inputs", ")", ":", "\n", "        ", "for", "name", "in", "self", ".", "weights", ":", "\n", "            ", "setattr", "(", "module", ",", "name", ",", "self", ".", "compute_weight", "(", "module", ",", "name", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim._norm": [[47, 59], ["p.norm", "p.contiguous().view().norm().view", "p.contiguous().view().norm().view", "_norm().transpose", "p.size", "p.contiguous().view().norm", "p.dim", "p.dim", "p.size", "p.contiguous().view().norm", "my_optim._norm", "p.contiguous().view", "p.dim", "p.transpose", "p.size", "p.contiguous().view", "p.contiguous", "p.size", "p.contiguous"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim._norm"], ["", "", "def", "_norm", "(", "p", ",", "dim", ")", ":", "\n", "    ", "\"\"\"Computes the norm over all dimensions except dim\"\"\"", "\n", "if", "dim", "is", "None", ":", "\n", "        ", "return", "p", ".", "norm", "(", ")", "\n", "", "elif", "dim", "==", "0", ":", "\n", "        ", "output_size", "=", "(", "p", ".", "size", "(", "0", ")", ",", ")", "+", "(", "1", ",", ")", "*", "(", "p", ".", "dim", "(", ")", "-", "1", ")", "\n", "return", "p", ".", "contiguous", "(", ")", ".", "view", "(", "p", ".", "size", "(", "0", ")", ",", "-", "1", ")", ".", "norm", "(", "dim", "=", "1", ")", ".", "view", "(", "*", "output_size", ")", "\n", "", "elif", "dim", "==", "p", ".", "dim", "(", ")", "-", "1", ":", "\n", "        ", "output_size", "=", "(", "1", ",", ")", "*", "(", "p", ".", "dim", "(", ")", "-", "1", ")", "+", "(", "p", ".", "size", "(", "-", "1", ")", ",", ")", "\n", "return", "p", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ",", "p", ".", "size", "(", "-", "1", ")", ")", ".", "norm", "(", "dim", "=", "0", ")", ".", "view", "(", "*", "output_size", ")", "\n", "", "else", ":", "\n", "        ", "return", "_norm", "(", "p", ".", "transpose", "(", "0", ",", "dim", ")", ",", "0", ")", ".", "transpose", "(", "0", ",", "dim", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim._dummy": [[61, 64], ["None"], "function", ["None"], ["", "", "def", "_dummy", "(", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "# We need to replace flatten_parameters with a nothing function", "\n", "    ", "return", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.weight_norm": [[114, 117], ["my_optim.WeightNorm.apply"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.WeightNorm.apply"], ["", "", "", "def", "weight_norm", "(", "module", ",", "weights", "=", "None", ",", "dim", "=", "0", ")", ":", "\n", "    ", "WeightNorm", ".", "apply", "(", "module", ",", "weights", ",", "dim", ")", "\n", "return", "module", "\n", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.pooler.Pooler.__init__": [[7, 12], ["torch.Module.__init__", "torch.Linear", "module.common.activation", "module.dropout_wrapper.DropoutWrapper"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.activation"], ["    ", "def", "__init__", "(", "self", ",", "hidden_size", ",", "dropout_p", "=", "0.1", ",", "actf", "=", "\"tanh\"", ")", ":", "\n", "        ", "super", "(", "Pooler", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "dense", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "hidden_size", ")", "\n", "self", ".", "activation", "=", "activation", "(", "actf", ")", "\n", "self", ".", "dropout", "=", "DropoutWrapper", "(", "dropout_p", "=", "dropout_p", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.module.pooler.Pooler.forward": [[13, 19], ["pooler.Pooler.dropout", "pooler.Pooler.dense", "pooler.Pooler.activation"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.module.common.activation"], ["", "def", "forward", "(", "self", ",", "hidden_states", ")", ":", "\n", "        ", "first_token_tensor", "=", "hidden_states", "[", ":", ",", "0", "]", "\n", "first_token_tensor", "=", "self", ".", "dropout", "(", "first_token_tensor", ")", "\n", "pooled_output", "=", "self", ".", "dense", "(", "first_token_tensor", ")", "\n", "pooled_output", "=", "self", ".", "activation", "(", "pooled_output", ")", "\n", "return", "pooled_output", "\n", "", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.parse_args": [[20, 57], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args", "len", "argparse.ArgumentParser.print_help", "sys.exit"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.ner.prepro.parse_args"], ["def", "parse_args", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", "\n", "\"Official evaluation script for SQuAD version 2.0.\"", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"data_file\"", ",", "metavar", "=", "\"data.json\"", ",", "help", "=", "\"Input data JSON file.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"pred_file\"", ",", "metavar", "=", "\"pred.json\"", ",", "help", "=", "\"Model predictions.\"", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--out-file\"", ",", "\n", "\"-o\"", ",", "\n", "metavar", "=", "\"eval.json\"", ",", "\n", "help", "=", "\"Write accuracy metrics to file (default is stdout).\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--na-prob-file\"", ",", "\n", "\"-n\"", ",", "\n", "metavar", "=", "\"na_prob.json\"", ",", "\n", "help", "=", "\"Model estimates of probability of no answer.\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--na-prob-thresh\"", ",", "\n", "\"-t\"", ",", "\n", "type", "=", "float", ",", "\n", "default", "=", "1.0", ",", "\n", "help", "=", "'Predict \"\" if no-answer probability exceeds this (default = 1.0).'", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--out-image-dir\"", ",", "\n", "\"-p\"", ",", "\n", "metavar", "=", "\"out_images\"", ",", "\n", "default", "=", "None", ",", "\n", "help", "=", "\"Save precision-recall curves to directory.\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--verbose\"", ",", "\"-v\"", ",", "action", "=", "\"store_true\"", ")", "\n", "if", "len", "(", "sys", ".", "argv", ")", "==", "1", ":", "\n", "        ", "parser", ".", "print_help", "(", ")", "\n", "sys", ".", "exit", "(", "1", ")", "\n", "", "return", "parser", ".", "parse_args", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.make_qid_to_has_ans": [[59, 66], ["bool"], "function", ["None"], ["", "def", "make_qid_to_has_ans", "(", "dataset", ")", ":", "\n", "    ", "qid_to_has_ans", "=", "{", "}", "\n", "for", "article", "in", "dataset", ":", "\n", "        ", "for", "p", "in", "article", "[", "\"paragraphs\"", "]", ":", "\n", "            ", "for", "qa", "in", "p", "[", "\"qas\"", "]", ":", "\n", "                ", "qid_to_has_ans", "[", "qa", "[", "\"id\"", "]", "]", "=", "bool", "(", "qa", "[", "\"answers\"", "]", ")", "\n", "", "", "", "return", "qid_to_has_ans", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.normalize_answer": [[68, 86], ["mrc_eval.normalize_answer.white_space_fix"], "function", ["None"], ["", "def", "normalize_answer", "(", "s", ")", ":", "\n", "    ", "\"\"\"Lower text and remove punctuation, articles and extra whitespace.\"\"\"", "\n", "\n", "def", "remove_articles", "(", "text", ")", ":", "\n", "        ", "regex", "=", "re", ".", "compile", "(", "r\"\\b(a|an|the)\\b\"", ",", "re", ".", "UNICODE", ")", "\n", "return", "re", ".", "sub", "(", "regex", ",", "\" \"", ",", "text", ")", "\n", "\n", "", "def", "white_space_fix", "(", "text", ")", ":", "\n", "        ", "return", "\" \"", ".", "join", "(", "text", ".", "split", "(", ")", ")", "\n", "\n", "", "def", "remove_punc", "(", "text", ")", ":", "\n", "        ", "exclude", "=", "set", "(", "string", ".", "punctuation", ")", "\n", "return", "\"\"", ".", "join", "(", "ch", "for", "ch", "in", "text", "if", "ch", "not", "in", "exclude", ")", "\n", "\n", "", "def", "lower", "(", "text", ")", ":", "\n", "        ", "return", "text", ".", "lower", "(", ")", "\n", "\n", "", "return", "white_space_fix", "(", "remove_articles", "(", "remove_punc", "(", "lower", "(", "s", ")", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.get_tokens": [[88, 92], ["normalize_answer().split", "mrc_eval.normalize_answer"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.normalize_answer"], ["", "def", "get_tokens", "(", "s", ")", ":", "\n", "    ", "if", "not", "s", ":", "\n", "        ", "return", "[", "]", "\n", "", "return", "normalize_answer", "(", "s", ")", ".", "split", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.compute_exact": [[94, 96], ["int", "mrc_eval.normalize_answer", "mrc_eval.normalize_answer"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.normalize_answer", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.normalize_answer"], ["", "def", "compute_exact", "(", "a_gold", ",", "a_pred", ")", ":", "\n", "    ", "return", "int", "(", "normalize_answer", "(", "a_gold", ")", "==", "normalize_answer", "(", "a_pred", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.compute_f1": [[98, 112], ["mrc_eval.get_tokens", "mrc_eval.get_tokens", "sum", "collections.Counter", "collections.Counter", "common.values", "int", "len", "len", "len", "len"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.get_tokens", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.get_tokens"], ["", "def", "compute_f1", "(", "a_gold", ",", "a_pred", ")", ":", "\n", "    ", "gold_toks", "=", "get_tokens", "(", "a_gold", ")", "\n", "pred_toks", "=", "get_tokens", "(", "a_pred", ")", "\n", "common", "=", "collections", ".", "Counter", "(", "gold_toks", ")", "&", "collections", ".", "Counter", "(", "pred_toks", ")", "\n", "num_same", "=", "sum", "(", "common", ".", "values", "(", ")", ")", "\n", "if", "len", "(", "gold_toks", ")", "==", "0", "or", "len", "(", "pred_toks", ")", "==", "0", ":", "\n", "# If either is no-answer, then F1 is 1 if they agree, 0 otherwise", "\n", "        ", "return", "int", "(", "gold_toks", "==", "pred_toks", ")", "\n", "", "if", "num_same", "==", "0", ":", "\n", "        ", "return", "0", "\n", "", "precision", "=", "1.0", "*", "num_same", "/", "len", "(", "pred_toks", ")", "\n", "recall", "=", "1.0", "*", "num_same", "/", "len", "(", "gold_toks", ")", "\n", "f1", "=", "(", "2", "*", "precision", "*", "recall", ")", "/", "(", "precision", "+", "recall", ")", "\n", "return", "f1", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.get_raw_scores": [[114, 135], ["max", "max", "print", "mrc_eval.normalize_answer", "mrc_eval.compute_exact", "mrc_eval.compute_f1"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.normalize_answer", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.compute_exact", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.metrics.compute_f1"], ["", "def", "get_raw_scores", "(", "dataset", ",", "preds", ")", ":", "\n", "    ", "exact_scores", "=", "{", "}", "\n", "f1_scores", "=", "{", "}", "\n", "for", "article", "in", "dataset", ":", "\n", "        ", "for", "p", "in", "article", "[", "\"paragraphs\"", "]", ":", "\n", "            ", "for", "qa", "in", "p", "[", "\"qas\"", "]", ":", "\n", "                ", "qid", "=", "qa", "[", "\"id\"", "]", "\n", "gold_answers", "=", "[", "\n", "a", "[", "\"text\"", "]", "for", "a", "in", "qa", "[", "\"answers\"", "]", "if", "normalize_answer", "(", "a", "[", "\"text\"", "]", ")", "\n", "]", "\n", "if", "not", "gold_answers", ":", "\n", "# For unanswerable questions, only correct answer is empty string", "\n", "                    ", "gold_answers", "=", "[", "\"\"", "]", "\n", "", "if", "qid", "not", "in", "preds", ":", "\n", "                    ", "print", "(", "\"Missing prediction for %s\"", "%", "qid", ")", "\n", "continue", "\n", "", "a_pred", "=", "preds", "[", "qid", "]", "\n", "# Take max over all gold answers", "\n", "exact_scores", "[", "qid", "]", "=", "max", "(", "compute_exact", "(", "a", ",", "a_pred", ")", "for", "a", "in", "gold_answers", ")", "\n", "f1_scores", "[", "qid", "]", "=", "max", "(", "compute_f1", "(", "a", ",", "a_pred", ")", "for", "a", "in", "gold_answers", ")", "\n", "", "", "", "return", "exact_scores", ",", "f1_scores", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.squadv1_evaluate_func": [[137, 159], ["human.items", "str", "max", "max", "type", "print", "mrc_eval.normalize_answer", "mrc_eval.compute_exact", "mrc_eval.compute_f1"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.normalize_answer", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.compute_exact", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.metrics.compute_f1"], ["", "def", "squadv1_evaluate_func", "(", "human", ",", "predictions", ")", ":", "\n", "    ", "f1", "=", "exact_match", "=", "total", "=", "0", "\n", "for", "uid", ",", "answer", "in", "human", ".", "items", "(", ")", ":", "\n", "        ", "if", "type", "(", "answer", ")", "is", "dict", ":", "\n", "            ", "ground_truths", "=", "answer", "[", "\"text\"", "]", "if", "\"text\"", "in", "answer", "else", "answer", "\n", "", "else", ":", "\n", "            ", "ground_truths", "=", "[", "ans", "[", "\"text\"", "]", "if", "\"text\"", "in", "ans", "else", "ans", "for", "ans", "in", "answer", "]", "\n", "", "total", "+=", "1", "\n", "if", "uid", "not", "in", "predictions", ":", "\n", "            ", "message", "=", "\"Unanswered question \"", "+", "uid", "+", "\" will receive score 0.\"", "\n", "print", "(", "message", ",", "file", "=", "sys", ".", "stderr", ")", "\n", "continue", "\n", "", "prediction", "=", "predictions", "[", "uid", "]", "\n", "ground_truths", "=", "[", "normalize_answer", "(", "a", ")", "for", "a", "in", "ground_truths", "]", "\n", "if", "not", "ground_truths", ":", "\n", "# For unanswerable questions, only correct answer is empty string", "\n", "            ", "ground_truths", "=", "[", "\"\"", "]", "\n", "", "exact_match", "+=", "max", "(", "compute_exact", "(", "a", ",", "prediction", ")", "for", "a", "in", "ground_truths", ")", "\n", "f1", "+=", "max", "(", "compute_f1", "(", "a", ",", "prediction", ")", "for", "a", "in", "ground_truths", ")", "\n", "", "exact_match", "=", "100.0", "*", "exact_match", "/", "total", "\n", "f1", "=", "100.0", "*", "f1", "/", "total", "\n", "return", "str", "(", "{", "\"exact_match\"", ":", "exact_match", ",", "\"f1\"", ":", "f1", "}", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.squadv2_evaluate_func": [[161, 213], ["mrc_eval.squadv2_evaluate_func._make_qid_to_has_ans"], "function", ["None"], ["", "def", "squadv2_evaluate_func", "(", "human", ",", "predictions", ",", "na_probs", "=", "None", ",", "na_prob_thresh", "=", "1.0", ")", ":", "\n", "    ", "def", "_make_qid_to_has_ans", "(", "dataset", ")", ":", "\n", "        ", "qid_to_has_ans", "=", "{", "}", "\n", "for", "uid", ",", "answer", "in", "dataset", ".", "items", "(", ")", ":", "\n", "            ", "qid_to_has_ans", "[", "uid", "]", "=", "not", "answer", "[", "\"is_impossible\"", "]", "\n", "", "return", "qid_to_has_ans", "\n", "\n", "", "def", "_get_raw_scores", "(", "grounds", ",", "predictions", ")", ":", "\n", "        ", "exact_scores", "=", "{", "}", "\n", "f1_scores", "=", "{", "}", "\n", "for", "uid", ",", "answer", "in", "grounds", ".", "items", "(", ")", ":", "\n", "            ", "if", "type", "(", "answer", ")", "is", "dict", ":", "\n", "                ", "ground_truths", "=", "answer", "[", "\"text\"", "]", "\n", "", "else", ":", "\n", "                ", "ground_truths", "=", "[", "ans", "[", "\"text\"", "]", "for", "ans", "in", "answer", "]", "\n", "", "if", "uid", "not", "in", "predictions", ":", "\n", "                ", "message", "=", "\"Unanswered question \"", "+", "uid", "+", "\" will receive score 0.\"", "\n", "print", "(", "message", ",", "file", "=", "sys", ".", "stderr", ")", "\n", "continue", "\n", "", "ground_truths", "=", "[", "normalize_answer", "(", "a", ")", "for", "a", "in", "ground_truths", "]", "\n", "if", "not", "ground_truths", ":", "\n", "# For unanswerable questions, only correct answer is empty string", "\n", "                ", "ground_truths", "=", "[", "\"\"", "]", "\n", "", "prediction", "=", "predictions", "[", "uid", "]", "\n", "# Take max over all gold answers", "\n", "exact_scores", "[", "uid", "]", "=", "max", "(", "compute_exact", "(", "a", ",", "prediction", ")", "for", "a", "in", "ground_truths", ")", "\n", "f1_scores", "[", "uid", "]", "=", "max", "(", "compute_f1", "(", "a", ",", "prediction", ")", "for", "a", "in", "ground_truths", ")", "\n", "", "return", "exact_scores", ",", "f1_scores", "\n", "\n", "", "qid_to_has_ans", "=", "_make_qid_to_has_ans", "(", "human", ")", "# maps qid to True/False", "\n", "has_ans_qids", "=", "[", "k", "for", "k", ",", "v", "in", "qid_to_has_ans", ".", "items", "(", ")", "if", "v", "]", "\n", "no_ans_qids", "=", "[", "k", "for", "k", ",", "v", "in", "qid_to_has_ans", ".", "items", "(", ")", "if", "not", "v", "]", "\n", "exact_raw", ",", "f1_raw", "=", "_get_raw_scores", "(", "human", ",", "predictions", ")", "\n", "has_na_prob_score", "=", "False", "if", "na_probs", "is", "None", "else", "True", "\n", "if", "na_probs", "is", "None", ":", "\n", "        ", "na_probs", "=", "{", "k", ":", "0.0", "for", "k", "in", "predictions", "}", "\n", "", "exact_thresh", "=", "apply_no_ans_threshold", "(", "\n", "exact_raw", ",", "na_probs", ",", "qid_to_has_ans", ",", "na_prob_thresh", "\n", ")", "\n", "f1_thresh", "=", "apply_no_ans_threshold", "(", "f1_raw", ",", "na_probs", ",", "qid_to_has_ans", ",", "na_prob_thresh", ")", "\n", "out_eval", "=", "make_eval_dict", "(", "exact_thresh", ",", "f1_thresh", ")", "\n", "if", "has_ans_qids", ":", "\n", "        ", "has_ans_eval", "=", "make_eval_dict", "(", "exact_thresh", ",", "f1_thresh", ",", "qid_list", "=", "has_ans_qids", ")", "\n", "merge_eval", "(", "out_eval", ",", "has_ans_eval", ",", "\"HasAns\"", ")", "\n", "", "if", "no_ans_qids", ":", "\n", "        ", "no_ans_eval", "=", "make_eval_dict", "(", "exact_thresh", ",", "f1_thresh", ",", "qid_list", "=", "no_ans_qids", ")", "\n", "merge_eval", "(", "out_eval", ",", "no_ans_eval", ",", "\"NoAns\"", ")", "\n", "", "if", "has_na_prob_score", ":", "\n", "        ", "find_all_best_thresh", "(", "\n", "out_eval", ",", "predictions", ",", "exact_raw", ",", "f1_raw", ",", "na_probs", ",", "qid_to_has_ans", "\n", ")", "\n", "", "return", "out_eval", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.apply_no_ans_threshold": [[215, 224], ["scores.items", "float"], "function", ["None"], ["", "def", "apply_no_ans_threshold", "(", "scores", ",", "na_probs", ",", "qid_to_has_ans", ",", "na_prob_thresh", ")", ":", "\n", "    ", "new_scores", "=", "{", "}", "\n", "for", "qid", ",", "s", "in", "scores", ".", "items", "(", ")", ":", "\n", "        ", "pred_na", "=", "na_probs", "[", "qid", "]", ">", "na_prob_thresh", "\n", "if", "pred_na", ":", "\n", "            ", "new_scores", "[", "qid", "]", "=", "float", "(", "not", "qid_to_has_ans", "[", "qid", "]", ")", "\n", "", "else", ":", "\n", "            ", "new_scores", "[", "qid", "]", "=", "s", "\n", "", "", "return", "new_scores", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.make_eval_dict": [[226, 243], ["len", "collections.OrderedDict", "len", "collections.OrderedDict", "sum", "sum", "sum", "sum", "exact_scores.values", "f1_scores.values"], "function", ["None"], ["", "def", "make_eval_dict", "(", "exact_scores", ",", "f1_scores", ",", "qid_list", "=", "None", ")", ":", "\n", "    ", "if", "not", "qid_list", ":", "\n", "        ", "total", "=", "len", "(", "exact_scores", ")", "\n", "return", "collections", ".", "OrderedDict", "(", "\n", "[", "\n", "(", "\"exact\"", ",", "100.0", "*", "sum", "(", "exact_scores", ".", "values", "(", ")", ")", "/", "total", ")", ",", "\n", "(", "\"f1\"", ",", "100.0", "*", "sum", "(", "f1_scores", ".", "values", "(", ")", ")", "/", "total", ")", ",", "\n", "(", "\"total\"", ",", "total", ")", ",", "\n", "]", "\n", ")", "\n", "", "else", ":", "\n", "        ", "total", "=", "len", "(", "qid_list", ")", "\n", "return", "collections", ".", "OrderedDict", "(", "\n", "[", "\n", "(", "\"exact\"", ",", "100.0", "*", "sum", "(", "exact_scores", "[", "k", "]", "for", "k", "in", "qid_list", ")", "/", "total", ")", ",", "\n", "(", "\"f1\"", ",", "100.0", "*", "sum", "(", "f1_scores", "[", "k", "]", "for", "k", "in", "qid_list", ")", "/", "total", ")", ",", "\n", "(", "\"total\"", ",", "total", ")", ",", "\n", "]", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.merge_eval": [[247, 250], ["None"], "function", ["None"], ["", "", "def", "merge_eval", "(", "main_eval", ",", "new_eval", ",", "prefix", ")", ":", "\n", "    ", "for", "k", "in", "new_eval", ":", "\n", "        ", "main_eval", "[", "\"%s_%s\"", "%", "(", "prefix", ",", "k", ")", "]", "=", "new_eval", "[", "k", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.plot_pr_curve": [[252, 262], ["plt.step", "plt.fill_between", "plt.xlabel", "plt.ylabel", "plt.xlim", "plt.ylim", "plt.title", "plt.savefig", "plt.clf"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.step"], ["", "", "def", "plot_pr_curve", "(", "precisions", ",", "recalls", ",", "out_image", ",", "title", ")", ":", "\n", "    ", "plt", ".", "step", "(", "recalls", ",", "precisions", ",", "color", "=", "\"b\"", ",", "alpha", "=", "0.2", ",", "where", "=", "\"post\"", ")", "\n", "plt", ".", "fill_between", "(", "recalls", ",", "precisions", ",", "step", "=", "\"post\"", ",", "alpha", "=", "0.2", ",", "color", "=", "\"b\"", ")", "\n", "plt", ".", "xlabel", "(", "\"Recall\"", ")", "\n", "plt", ".", "ylabel", "(", "\"Precision\"", ")", "\n", "plt", ".", "xlim", "(", "[", "0.0", ",", "1.05", "]", ")", "\n", "plt", ".", "ylim", "(", "[", "0.0", ",", "1.05", "]", ")", "\n", "plt", ".", "title", "(", "title", ")", "\n", "plt", ".", "savefig", "(", "out_image", ")", "\n", "plt", ".", "clf", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.make_precision_recall_eval": [[264, 287], ["sorted", "enumerate", "mrc_eval.plot_pr_curve", "float", "float", "precisions.append", "recalls.append", "len"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.plot_pr_curve"], ["", "def", "make_precision_recall_eval", "(", "\n", "scores", ",", "na_probs", ",", "num_true_pos", ",", "qid_to_has_ans", ",", "out_image", "=", "None", ",", "title", "=", "None", "\n", ")", ":", "\n", "    ", "qid_list", "=", "sorted", "(", "na_probs", ",", "key", "=", "lambda", "k", ":", "na_probs", "[", "k", "]", ")", "\n", "true_pos", "=", "0.0", "\n", "cur_p", "=", "1.0", "\n", "cur_r", "=", "0.0", "\n", "precisions", "=", "[", "1.0", "]", "\n", "recalls", "=", "[", "0.0", "]", "\n", "avg_prec", "=", "0.0", "\n", "for", "i", ",", "qid", "in", "enumerate", "(", "qid_list", ")", ":", "\n", "        ", "if", "qid_to_has_ans", "[", "qid", "]", ":", "\n", "            ", "true_pos", "+=", "scores", "[", "qid", "]", "\n", "", "cur_p", "=", "true_pos", "/", "float", "(", "i", "+", "1", ")", "\n", "cur_r", "=", "true_pos", "/", "float", "(", "num_true_pos", ")", "\n", "if", "i", "==", "len", "(", "qid_list", ")", "-", "1", "or", "na_probs", "[", "qid", "]", "!=", "na_probs", "[", "qid_list", "[", "i", "+", "1", "]", "]", ":", "\n", "# i.e., if we can put a threshold after this point", "\n", "            ", "avg_prec", "+=", "cur_p", "*", "(", "cur_r", "-", "recalls", "[", "-", "1", "]", ")", "\n", "precisions", ".", "append", "(", "cur_p", ")", "\n", "recalls", ".", "append", "(", "cur_r", ")", "\n", "", "", "if", "out_image", ":", "\n", "        ", "plot_pr_curve", "(", "precisions", ",", "recalls", ",", "out_image", ",", "title", ")", "\n", "", "return", "{", "\"ap\"", ":", "100.0", "*", "avg_prec", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.run_precision_recall_analysis": [[289, 325], ["sum", "mrc_eval.make_precision_recall_eval", "mrc_eval.make_precision_recall_eval", "mrc_eval.make_precision_recall_eval", "mrc_eval.merge_eval", "mrc_eval.merge_eval", "mrc_eval.merge_eval", "os.makedirs", "float", "os.path.exists", "os.path.join", "os.path.join", "qid_to_has_ans.items", "os.path.join", "qid_to_has_ans.values"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.make_precision_recall_eval", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.make_precision_recall_eval", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.make_precision_recall_eval", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.merge_eval", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.merge_eval", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.merge_eval"], ["", "def", "run_precision_recall_analysis", "(", "\n", "main_eval", ",", "exact_raw", ",", "f1_raw", ",", "na_probs", ",", "qid_to_has_ans", ",", "out_image_dir", "\n", ")", ":", "\n", "    ", "if", "out_image_dir", "and", "not", "os", ".", "path", ".", "exists", "(", "out_image_dir", ")", ":", "\n", "        ", "os", ".", "makedirs", "(", "out_image_dir", ")", "\n", "", "num_true_pos", "=", "sum", "(", "1", "for", "v", "in", "qid_to_has_ans", ".", "values", "(", ")", "if", "v", ")", "\n", "if", "num_true_pos", "==", "0", ":", "\n", "        ", "return", "\n", "", "pr_exact", "=", "make_precision_recall_eval", "(", "\n", "exact_raw", ",", "\n", "na_probs", ",", "\n", "num_true_pos", ",", "\n", "qid_to_has_ans", ",", "\n", "out_image", "=", "os", ".", "path", ".", "join", "(", "out_image_dir", ",", "\"pr_exact.png\"", ")", ",", "\n", "title", "=", "\"Precision-Recall curve for Exact Match score\"", ",", "\n", ")", "\n", "pr_f1", "=", "make_precision_recall_eval", "(", "\n", "f1_raw", ",", "\n", "na_probs", ",", "\n", "num_true_pos", ",", "\n", "qid_to_has_ans", ",", "\n", "out_image", "=", "os", ".", "path", ".", "join", "(", "out_image_dir", ",", "\"pr_f1.png\"", ")", ",", "\n", "title", "=", "\"Precision-Recall curve for F1 score\"", ",", "\n", ")", "\n", "oracle_scores", "=", "{", "k", ":", "float", "(", "v", ")", "for", "k", ",", "v", "in", "qid_to_has_ans", ".", "items", "(", ")", "}", "\n", "pr_oracle", "=", "make_precision_recall_eval", "(", "\n", "oracle_scores", ",", "\n", "na_probs", ",", "\n", "num_true_pos", ",", "\n", "qid_to_has_ans", ",", "\n", "out_image", "=", "os", ".", "path", ".", "join", "(", "out_image_dir", ",", "\"pr_oracle.png\"", ")", ",", "\n", "title", "=", "\"Oracle Precision-Recall curve (binary task of HasAns vs. NoAns)\"", ",", "\n", ")", "\n", "merge_eval", "(", "main_eval", ",", "pr_exact", ",", "\"pr_exact\"", ")", "\n", "merge_eval", "(", "main_eval", ",", "pr_f1", ",", "\"pr_f1\"", ")", "\n", "merge_eval", "(", "main_eval", ",", "pr_oracle", ",", "\"pr_oracle\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.histogram_na_prob": [[327, 338], ["plt.hist", "plt.xlabel", "plt.ylabel", "plt.title", "plt.savefig", "plt.clf", "numpy.ones_like", "float", "os.path.join", "len"], "function", ["None"], ["", "def", "histogram_na_prob", "(", "na_probs", ",", "qid_list", ",", "image_dir", ",", "name", ")", ":", "\n", "    ", "if", "not", "qid_list", ":", "\n", "        ", "return", "\n", "", "x", "=", "[", "na_probs", "[", "k", "]", "for", "k", "in", "qid_list", "]", "\n", "weights", "=", "np", ".", "ones_like", "(", "x", ")", "/", "float", "(", "len", "(", "x", ")", ")", "\n", "plt", ".", "hist", "(", "x", ",", "weights", "=", "weights", ",", "bins", "=", "20", ",", "range", "=", "(", "0.0", ",", "1.0", ")", ")", "\n", "plt", ".", "xlabel", "(", "\"Model probability of no-answer\"", ")", "\n", "plt", ".", "ylabel", "(", "\"Proportion of dataset\"", ")", "\n", "plt", ".", "title", "(", "\"Histogram of no-answer probability: %s\"", "%", "name", ")", "\n", "plt", ".", "savefig", "(", "os", ".", "path", ".", "join", "(", "image_dir", ",", "\"na_prob_hist_%s.png\"", "%", "name", ")", ")", "\n", "plt", ".", "clf", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.find_best_thresh": [[340, 361], ["sum", "sorted", "enumerate", "len"], "function", ["None"], ["", "def", "find_best_thresh", "(", "preds", ",", "scores", ",", "na_probs", ",", "qid_to_has_ans", ")", ":", "\n", "    ", "num_no_ans", "=", "sum", "(", "1", "for", "k", "in", "qid_to_has_ans", "if", "not", "qid_to_has_ans", "[", "k", "]", ")", "\n", "cur_score", "=", "num_no_ans", "\n", "best_score", "=", "cur_score", "\n", "best_thresh", "=", "0.0", "\n", "qid_list", "=", "sorted", "(", "na_probs", ",", "key", "=", "lambda", "k", ":", "na_probs", "[", "k", "]", ")", "\n", "for", "i", ",", "qid", "in", "enumerate", "(", "qid_list", ")", ":", "\n", "        ", "if", "qid", "not", "in", "scores", ":", "\n", "            ", "continue", "\n", "", "if", "qid_to_has_ans", "[", "qid", "]", ":", "\n", "            ", "diff", "=", "scores", "[", "qid", "]", "\n", "", "else", ":", "\n", "            ", "if", "preds", "[", "qid", "]", ":", "\n", "                ", "diff", "=", "-", "1", "\n", "", "else", ":", "\n", "                ", "diff", "=", "0", "\n", "", "", "cur_score", "+=", "diff", "\n", "if", "cur_score", ">", "best_score", ":", "\n", "            ", "best_score", "=", "cur_score", "\n", "best_thresh", "=", "na_probs", "[", "qid", "]", "\n", "", "", "return", "100.0", "*", "best_score", "/", "len", "(", "scores", ")", ",", "best_thresh", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.find_all_best_thresh": [[363, 372], ["mrc_eval.find_best_thresh", "mrc_eval.find_best_thresh"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.find_best_thresh", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.find_best_thresh"], ["", "def", "find_all_best_thresh", "(", "main_eval", ",", "preds", ",", "exact_raw", ",", "f1_raw", ",", "na_probs", ",", "qid_to_has_ans", ")", ":", "\n", "    ", "best_exact", ",", "exact_thresh", "=", "find_best_thresh", "(", "\n", "preds", ",", "exact_raw", ",", "na_probs", ",", "qid_to_has_ans", "\n", ")", "\n", "best_f1", ",", "f1_thresh", "=", "find_best_thresh", "(", "preds", ",", "f1_raw", ",", "na_probs", ",", "qid_to_has_ans", ")", "\n", "main_eval", "[", "\"best_exact\"", "]", "=", "best_exact", "\n", "main_eval", "[", "\"best_exact_thresh\"", "]", "=", "exact_thresh", "\n", "main_eval", "[", "\"best_f1\"", "]", "=", "best_f1", "\n", "main_eval", "[", "\"best_f1_thresh\"", "]", "=", "f1_thresh", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.main": [[374, 417], ["mrc_eval.make_qid_to_has_ans", "mrc_eval.get_raw_scores", "mrc_eval.apply_no_ans_threshold", "mrc_eval.apply_no_ans_threshold", "mrc_eval.make_eval_dict", "open", "json.load", "open", "json.load", "mrc_eval.make_eval_dict", "mrc_eval.merge_eval", "mrc_eval.make_eval_dict", "mrc_eval.merge_eval", "mrc_eval.find_all_best_thresh", "mrc_eval.run_precision_recall_analysis", "mrc_eval.histogram_na_prob", "mrc_eval.histogram_na_prob", "print", "open", "json.load", "make_qid_to_has_ans.items", "make_qid_to_has_ans.items", "open", "json.dump", "json.dumps"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.make_qid_to_has_ans", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.get_raw_scores", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.apply_no_ans_threshold", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.apply_no_ans_threshold", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.make_eval_dict", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.make_eval_dict", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.merge_eval", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.make_eval_dict", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.merge_eval", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.find_all_best_thresh", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.run_precision_recall_analysis", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.histogram_na_prob", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.histogram_na_prob", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.None.train.dump"], ["", "def", "main", "(", ")", ":", "\n", "    ", "with", "open", "(", "OPTS", ".", "data_file", ")", "as", "f", ":", "\n", "        ", "dataset_json", "=", "json", ".", "load", "(", "f", ")", "\n", "dataset", "=", "dataset_json", "[", "\"data\"", "]", "\n", "", "with", "open", "(", "OPTS", ".", "pred_file", ")", "as", "f", ":", "\n", "        ", "preds", "=", "json", ".", "load", "(", "f", ")", "\n", "", "if", "OPTS", ".", "na_prob_file", ":", "\n", "        ", "with", "open", "(", "OPTS", ".", "na_prob_file", ")", "as", "f", ":", "\n", "            ", "na_probs", "=", "json", ".", "load", "(", "f", ")", "\n", "", "", "else", ":", "\n", "        ", "na_probs", "=", "{", "k", ":", "0.0", "for", "k", "in", "preds", "}", "\n", "", "qid_to_has_ans", "=", "make_qid_to_has_ans", "(", "dataset", ")", "# maps qid to True/False", "\n", "has_ans_qids", "=", "[", "k", "for", "k", ",", "v", "in", "qid_to_has_ans", ".", "items", "(", ")", "if", "v", "]", "\n", "no_ans_qids", "=", "[", "k", "for", "k", ",", "v", "in", "qid_to_has_ans", ".", "items", "(", ")", "if", "not", "v", "]", "\n", "exact_raw", ",", "f1_raw", "=", "get_raw_scores", "(", "dataset", ",", "preds", ")", "\n", "exact_thresh", "=", "apply_no_ans_threshold", "(", "\n", "exact_raw", ",", "na_probs", ",", "qid_to_has_ans", ",", "OPTS", ".", "na_prob_thresh", "\n", ")", "\n", "f1_thresh", "=", "apply_no_ans_threshold", "(", "\n", "f1_raw", ",", "na_probs", ",", "qid_to_has_ans", ",", "OPTS", ".", "na_prob_thresh", "\n", ")", "\n", "out_eval", "=", "make_eval_dict", "(", "exact_thresh", ",", "f1_thresh", ")", "\n", "if", "has_ans_qids", ":", "\n", "        ", "has_ans_eval", "=", "make_eval_dict", "(", "exact_thresh", ",", "f1_thresh", ",", "qid_list", "=", "has_ans_qids", ")", "\n", "merge_eval", "(", "out_eval", ",", "has_ans_eval", ",", "\"HasAns\"", ")", "\n", "", "if", "no_ans_qids", ":", "\n", "        ", "no_ans_eval", "=", "make_eval_dict", "(", "exact_thresh", ",", "f1_thresh", ",", "qid_list", "=", "no_ans_qids", ")", "\n", "merge_eval", "(", "out_eval", ",", "no_ans_eval", ",", "\"NoAns\"", ")", "\n", "", "if", "OPTS", ".", "na_prob_file", ":", "\n", "        ", "find_all_best_thresh", "(", "\n", "out_eval", ",", "preds", ",", "exact_raw", ",", "f1_raw", ",", "na_probs", ",", "qid_to_has_ans", "\n", ")", "\n", "", "if", "OPTS", ".", "na_prob_file", "and", "OPTS", ".", "out_image_dir", ":", "\n", "        ", "run_precision_recall_analysis", "(", "\n", "out_eval", ",", "exact_raw", ",", "f1_raw", ",", "na_probs", ",", "qid_to_has_ans", ",", "OPTS", ".", "out_image_dir", "\n", ")", "\n", "histogram_na_prob", "(", "na_probs", ",", "has_ans_qids", ",", "OPTS", ".", "out_image_dir", ",", "\"hasAns\"", ")", "\n", "histogram_na_prob", "(", "na_probs", ",", "no_ans_qids", ",", "OPTS", ".", "out_image_dir", ",", "\"noAns\"", ")", "\n", "", "if", "OPTS", ".", "out_file", ":", "\n", "        ", "with", "open", "(", "OPTS", ".", "out_file", ",", "\"w\"", ")", "as", "f", ":", "\n", "            ", "json", ".", "dump", "(", "out_eval", ",", "f", ")", "\n", "", "", "else", ":", "\n", "        ", "print", "(", "json", ".", "dumps", "(", "out_eval", ",", "indent", "=", "2", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.log_wrapper.create_logger": [[7, 32], ["logging.getLogger", "logging.getLogger.setLevel", "logging.Formatter", "logging.StreamHandler", "logging.StreamHandler.setLevel", "logging.StreamHandler.setFormatter", "logging.getLogger.addHandler", "logging.FileHandler", "logging.FileHandler.setLevel", "logging.FileHandler.setFormatter", "logging.getLogger.addHandler", "time.strftime", "time.gmtime"], "function", ["None"], ["def", "create_logger", "(", "name", ",", "silent", "=", "False", ",", "to_disk", "=", "False", ",", "log_file", "=", "None", ")", ":", "\n", "    ", "\"\"\"Logger wrapper\"\"\"", "\n", "# setup logger", "\n", "log", "=", "logging", ".", "getLogger", "(", "name", ")", "\n", "log", ".", "setLevel", "(", "logging", ".", "DEBUG", ")", "\n", "log", ".", "propagate", "=", "False", "\n", "formatter", "=", "logging", ".", "Formatter", "(", "\n", "fmt", "=", "\"%(asctime)s %(message)s\"", ",", "datefmt", "=", "\"%m/%d/%Y %I:%M:%S\"", "\n", ")", "\n", "if", "not", "silent", ":", "\n", "        ", "ch", "=", "logging", ".", "StreamHandler", "(", "sys", ".", "stdout", ")", "\n", "ch", ".", "setLevel", "(", "logging", ".", "INFO", ")", "\n", "ch", ".", "setFormatter", "(", "formatter", ")", "\n", "log", ".", "addHandler", "(", "ch", ")", "\n", "", "if", "to_disk", ":", "\n", "        ", "log_file", "=", "(", "\n", "log_file", "\n", "if", "log_file", "is", "not", "None", "\n", "else", "strftime", "(", "\"%Y-%m-%d-%H-%M-%S.log\"", ",", "gmtime", "(", ")", ")", "\n", ")", "\n", "fh", "=", "logging", ".", "FileHandler", "(", "log_file", ")", "\n", "fh", ".", "setLevel", "(", "logging", ".", "DEBUG", ")", "\n", "fh", ".", "setFormatter", "(", "formatter", ")", "\n", "log", ".", "addHandler", "(", "fh", ")", "\n", "", "return", "log", "\n", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.metrics.compute_acc": [[15, 17], ["sklearn.metrics.accuracy_score"], "function", ["None"], ["def", "compute_acc", "(", "predicts", ",", "labels", ")", ":", "\n", "    ", "return", "100.0", "*", "accuracy_score", "(", "labels", ",", "predicts", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.metrics.compute_f1": [[19, 21], ["sklearn.metrics.f1_score"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.f1_score"], ["", "def", "compute_f1", "(", "predicts", ",", "labels", ")", ":", "\n", "    ", "return", "100.0", "*", "f1_score", "(", "labels", ",", "predicts", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.metrics.compute_f1mac": [[23, 25], ["sklearn.metrics.f1_score"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.f1_score"], ["", "def", "compute_f1mac", "(", "predicts", ",", "labels", ")", ":", "\n", "    ", "return", "100.0", "*", "f1_score", "(", "labels", ",", "predicts", ",", "average", "=", "\"macro\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.metrics.compute_f1mic": [[27, 29], ["sklearn.metrics.f1_score"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.f1_score"], ["", "def", "compute_f1mic", "(", "predicts", ",", "labels", ")", ":", "\n", "    ", "return", "100.0", "*", "f1_score", "(", "labels", ",", "predicts", ",", "average", "=", "\"micro\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.metrics.compute_mcc": [[31, 33], ["sklearn.metrics.matthews_corrcoef"], "function", ["None"], ["", "def", "compute_mcc", "(", "predicts", ",", "labels", ")", ":", "\n", "    ", "return", "100.0", "*", "matthews_corrcoef", "(", "labels", ",", "predicts", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.metrics.compute_pearson": [[35, 38], ["scipy.stats.pearsonr"], "function", ["None"], ["", "def", "compute_pearson", "(", "predicts", ",", "labels", ")", ":", "\n", "    ", "pcof", "=", "pearsonr", "(", "labels", ",", "predicts", ")", "[", "0", "]", "\n", "return", "100.0", "*", "pcof", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.metrics.compute_spearman": [[40, 43], ["scipy.stats.spearmanr"], "function", ["None"], ["", "def", "compute_spearman", "(", "predicts", ",", "labels", ")", ":", "\n", "    ", "scof", "=", "spearmanr", "(", "labels", ",", "predicts", ")", "[", "0", "]", "\n", "return", "100.0", "*", "scof", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.metrics.compute_auc": [[45, 48], ["sklearn.metrics.roc_auc_score"], "function", ["None"], ["", "def", "compute_auc", "(", "predicts", ",", "labels", ")", ":", "\n", "    ", "auc", "=", "roc_auc_score", "(", "labels", ",", "predicts", ")", "\n", "return", "100.0", "*", "auc", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.metrics.compute_cmat": [[50, 53], ["sklearn.metrics.confusion_matrix"], "function", ["None"], ["", "def", "compute_cmat", "(", "predicts", ",", "labels", ")", ":", "\n", "# return str(confusion_matrix(labels, predicts))", "\n", "    ", "return", "confusion_matrix", "(", "labels", ",", "predicts", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.metrics.compute_seqacc": [[55, 76], ["zip", "seqeval.metrics.classification_report", "enumerate", "temp_1.pop", "temp_2.pop", "y_true.append", "y_pred.append", "metrics.compute_seqacc.trim"], "function", ["None"], ["", "def", "compute_seqacc", "(", "predicts", ",", "labels", ",", "label_mapper", ")", ":", "\n", "    ", "y_true", ",", "y_pred", "=", "[", "]", ",", "[", "]", "\n", "\n", "def", "trim", "(", "predict", ",", "label", ")", ":", "\n", "        ", "temp_1", "=", "[", "]", "\n", "temp_2", "=", "[", "]", "\n", "for", "j", ",", "m", "in", "enumerate", "(", "predict", ")", ":", "\n", "            ", "if", "j", "==", "0", ":", "\n", "                ", "continue", "\n", "", "if", "label_mapper", "[", "label", "[", "j", "]", "]", "!=", "\"X\"", ":", "\n", "                ", "temp_1", ".", "append", "(", "label_mapper", "[", "label", "[", "j", "]", "]", ")", "\n", "temp_2", ".", "append", "(", "label_mapper", "[", "m", "]", ")", "\n", "", "", "temp_1", ".", "pop", "(", ")", "\n", "temp_2", ".", "pop", "(", ")", "\n", "y_true", ".", "append", "(", "temp_1", ")", "\n", "y_pred", ".", "append", "(", "temp_2", ")", "\n", "\n", "", "for", "predict", ",", "label", "in", "zip", "(", "predicts", ",", "labels", ")", ":", "\n", "        ", "trim", "(", "predict", ",", "label", ")", "\n", "", "report", "=", "classification_report", "(", "y_true", ",", "y_pred", ",", "digits", "=", "4", ")", "\n", "return", "report", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.metrics.compute_list_f1": [[78, 102], ["zip", "enumerate", "temp_1.pop", "temp_2.pop", "len", "metrics.compute_seqacc.trim"], "function", ["None"], ["", "def", "compute_list_f1", "(", "predicts", ",", "labels", ",", "label_mapper", ")", ":", "\n", "    ", "def", "trim", "(", "predict", ",", "label", ")", ":", "\n", "        ", "temp_1", "=", "[", "]", "\n", "temp_2", "=", "[", "]", "\n", "for", "j", ",", "m", "in", "enumerate", "(", "predict", ")", ":", "\n", "            ", "if", "j", "==", "0", ":", "\n", "                ", "continue", "\n", "", "if", "label_mapper", "[", "label", "[", "j", "]", "]", "!=", "\"X\"", ":", "\n", "                ", "temp_1", ".", "append", "(", "label_mapper", "[", "label", "[", "j", "]", "]", ")", "\n", "temp_2", ".", "append", "(", "label_mapper", "[", "m", "]", ")", "\n", "", "", "temp_1", ".", "pop", "(", ")", "\n", "temp_2", ".", "pop", "(", ")", "\n", "return", "temp_1", ",", "temp_2", "\n", "\n", "", "f1", "=", "0", "\n", "for", "predict", ",", "label", "in", "zip", "(", "predicts", ",", "labels", ")", ":", "\n", "        ", "if", "label", "==", "[", "0", "]", "*", "len", "(", "label", ")", ":", "# all 'O' i.e. empty list", "\n", "            ", "if", "predict", "==", "[", "0", "]", "*", "len", "(", "predict", ")", ":", "\n", "                ", "f1", "+=", "1.0", "\n", "", "", "else", ":", "\n", "            ", "y_true", ",", "y_pred", "=", "trim", "(", "predict", ",", "label", ")", "\n", "f1", "+=", "seqeval", ".", "metrics", ".", "f1_score", "(", "[", "y_true", "]", ",", "[", "y_pred", "]", ")", "# , digits=4)", "\n", "", "", "f1", "=", "f1", "/", "len", "(", "predicts", ")", "\n", "return", "100.0", "*", "f1", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.metrics.compute_emf1": [[104, 106], ["data_utils.mrc_eval.squadv1_evaluate_func"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.squadv1_evaluate_func"], ["", "def", "compute_emf1", "(", "predicts", ",", "labels", ")", ":", "\n", "    ", "return", "squadv1_evaluate_func", "(", "labels", ",", "predicts", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.metrics.compute_emf12": [[108, 110], ["data_utils.mrc_eval.squadv2_evaluate_func"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.mrc_eval.squadv2_evaluate_func"], ["", "def", "compute_emf12", "(", "predicts", ",", "labels", ")", ":", "\n", "    ", "return", "squadv2_evaluate_func", "(", "labels", ",", "predicts", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.metrics.calc_metrics": [[145, 175], ["metric_func", "metric_func", "metric_func", "metric_func", "len", "len"], "function", ["None"], ["def", "calc_metrics", "(", "metric_meta", ",", "golds", ",", "predictions", ",", "scores", ",", "label_mapper", "=", "None", ")", ":", "\n", "    ", "\"\"\"Label Mapper is used for NER/POS etc.\n    TODO: a better refactor, by xiaodl\n    \"\"\"", "\n", "metrics", "=", "{", "}", "\n", "for", "mm", "in", "metric_meta", ":", "\n", "        ", "metric_name", "=", "mm", ".", "name", "\n", "metric_func", "=", "METRIC_FUNC", "[", "mm", "]", "\n", "if", "mm", "in", "(", "\n", "Metric", ".", "ACC", ",", "\n", "Metric", ".", "F1", ",", "\n", "Metric", ".", "MCC", ",", "\n", "Metric", ".", "F1MAC", ",", "\n", "Metric", ".", "F1MIC", ",", "\n", "Metric", ".", "CMAT", ",", "\n", ")", ":", "\n", "            ", "metric", "=", "metric_func", "(", "predictions", ",", "golds", ")", "\n", "", "elif", "mm", "in", "(", "Metric", ".", "SeqEval", ",", "Metric", ".", "SeqEvalList", ")", ":", "\n", "            ", "metric", "=", "metric_func", "(", "predictions", ",", "golds", ",", "label_mapper", ")", "\n", "", "elif", "mm", "==", "Metric", ".", "EmF1", "or", "mm", "==", "Metric", ".", "EmF12", ":", "\n", "            ", "metric", "=", "metric_func", "(", "predictions", ",", "golds", ")", "\n", "", "else", ":", "\n", "            ", "if", "mm", "==", "Metric", ".", "AUC", ":", "\n", "                ", "assert", "len", "(", "scores", ")", "==", "2", "*", "len", "(", "\n", "golds", "\n", ")", ",", "\"AUC is only valid for binary classification problem\"", "\n", "scores", "=", "scores", "[", "1", ":", ":", "2", "]", "\n", "", "metric", "=", "metric_func", "(", "scores", ",", "golds", ")", "\n", "", "metrics", "[", "metric_name", "]", "=", "metric", "\n", "", "return", "metrics", "\n", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.normalize_answer": [[13, 30], ["squad_eval.normalize_answer.white_space_fix"], "function", ["None"], ["def", "normalize_answer", "(", "s", ")", ":", "\n", "    ", "\"\"\"Lower text and remove punctuation, articles and extra whitespace.\"\"\"", "\n", "\n", "def", "remove_articles", "(", "text", ")", ":", "\n", "        ", "return", "re", ".", "sub", "(", "r\"\\b(a|an|the)\\b\"", ",", "\" \"", ",", "text", ")", "\n", "\n", "", "def", "white_space_fix", "(", "text", ")", ":", "\n", "        ", "return", "\" \"", ".", "join", "(", "text", ".", "split", "(", ")", ")", "\n", "\n", "", "def", "remove_punc", "(", "text", ")", ":", "\n", "        ", "exclude", "=", "set", "(", "string", ".", "punctuation", ")", "\n", "return", "\"\"", ".", "join", "(", "ch", "for", "ch", "in", "text", "if", "ch", "not", "in", "exclude", ")", "\n", "\n", "", "def", "lower", "(", "text", ")", ":", "\n", "        ", "return", "text", ".", "lower", "(", ")", "\n", "\n", "", "return", "white_space_fix", "(", "remove_articles", "(", "remove_punc", "(", "lower", "(", "s", ")", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.f1_score": [[32, 43], ["normalize_answer().split", "normalize_answer().split", "sum", "collections.Counter", "collections.Counter", "common.values", "len", "len", "squad_eval.normalize_answer", "squad_eval.normalize_answer"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.normalize_answer", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.normalize_answer"], ["", "def", "f1_score", "(", "prediction", ",", "ground_truth", ")", ":", "\n", "    ", "prediction_tokens", "=", "normalize_answer", "(", "prediction", ")", ".", "split", "(", ")", "\n", "ground_truth_tokens", "=", "normalize_answer", "(", "ground_truth", ")", ".", "split", "(", ")", "\n", "common", "=", "Counter", "(", "prediction_tokens", ")", "&", "Counter", "(", "ground_truth_tokens", ")", "\n", "num_same", "=", "sum", "(", "common", ".", "values", "(", ")", ")", "\n", "if", "num_same", "==", "0", ":", "\n", "        ", "return", "0", "\n", "", "precision", "=", "1.0", "*", "num_same", "/", "len", "(", "prediction_tokens", ")", "\n", "recall", "=", "1.0", "*", "num_same", "/", "len", "(", "ground_truth_tokens", ")", "\n", "f1", "=", "(", "2", "*", "precision", "*", "recall", ")", "/", "(", "precision", "+", "recall", ")", "\n", "return", "f1", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.exact_match_score": [[45, 47], ["squad_eval.normalize_answer", "squad_eval.normalize_answer"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.normalize_answer", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.normalize_answer"], ["", "def", "exact_match_score", "(", "prediction", ",", "ground_truth", ")", ":", "\n", "    ", "return", "normalize_answer", "(", "prediction", ")", "==", "normalize_answer", "(", "ground_truth", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.metric_max_over_ground_truths": [[49, 55], ["max", "scores_for_ground_truths.append", "squad_eval.exact_match_score", "squad_eval.f1_score", "squad_eval.exact_match_score", "squad_eval.f1_score"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.exact_match_score", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.f1_score", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.exact_match_score", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.f1_score"], ["", "def", "metric_max_over_ground_truths", "(", "metric_fn", ",", "prediction", ",", "ground_truths", ")", ":", "\n", "    ", "scores_for_ground_truths", "=", "[", "]", "\n", "for", "ground_truth", "in", "ground_truths", ":", "\n", "        ", "score", "=", "metric_fn", "(", "prediction", ",", "ground_truth", ")", "\n", "scores_for_ground_truths", ".", "append", "(", "score", ")", "\n", "", "return", "max", "(", "scores_for_ground_truths", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.evaluate": [[57, 79], ["list", "squad_eval.metric_max_over_ground_truths", "squad_eval.metric_max_over_ground_truths", "print", "map"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.metric_max_over_ground_truths", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.metric_max_over_ground_truths"], ["", "def", "evaluate", "(", "dataset", ",", "predictions", ")", ":", "\n", "    ", "f1", "=", "exact_match", "=", "total", "=", "0", "\n", "for", "article", "in", "dataset", ":", "\n", "        ", "for", "paragraph", "in", "article", "[", "\"paragraphs\"", "]", ":", "\n", "            ", "for", "qa", "in", "paragraph", "[", "\"qas\"", "]", ":", "\n", "                ", "total", "+=", "1", "\n", "if", "qa", "[", "\"id\"", "]", "not", "in", "predictions", ":", "\n", "                    ", "message", "=", "(", "\n", "\"Unanswered question \"", "+", "qa", "[", "\"id\"", "]", "+", "\" will receive score 0.\"", "\n", ")", "\n", "print", "(", "message", ",", "file", "=", "sys", ".", "stderr", ")", "\n", "continue", "\n", "", "ground_truths", "=", "list", "(", "map", "(", "lambda", "x", ":", "x", "[", "\"text\"", "]", ",", "qa", "[", "\"answers\"", "]", ")", ")", "\n", "prediction", "=", "predictions", "[", "qa", "[", "\"id\"", "]", "]", "\n", "exact_match", "+=", "metric_max_over_ground_truths", "(", "\n", "exact_match_score", ",", "prediction", ",", "ground_truths", "\n", ")", "\n", "f1", "+=", "metric_max_over_ground_truths", "(", "f1_score", ",", "prediction", ",", "ground_truths", ")", "\n", "\n", "", "", "", "exact_match", "=", "100.0", "*", "exact_match", "/", "total", "\n", "f1", "=", "100.0", "*", "f1", "/", "total", "\n", "return", "{", "\"exact_match\"", ":", "exact_match", ",", "\"f1\"", ":", "f1", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.evaluate_func": [[81, 98], ["human.items", "str", "squad_eval.metric_max_over_ground_truths", "squad_eval.metric_max_over_ground_truths", "print"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.metric_max_over_ground_truths", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.squad_eval.metric_max_over_ground_truths"], ["", "def", "evaluate_func", "(", "human", ",", "predictions", ")", ":", "\n", "    ", "f1", "=", "exact_match", "=", "total", "=", "0", "\n", "for", "uid", ",", "ground_truths", "in", "human", ".", "items", "(", ")", ":", "\n", "        ", "total", "+=", "1", "\n", "if", "uid", "not", "in", "predictions", ":", "\n", "            ", "message", "=", "\"Unanswered question \"", "+", "uid", "+", "\" will receive score 0.\"", "\n", "print", "(", "message", ",", "file", "=", "sys", ".", "stderr", ")", "\n", "continue", "\n", "", "prediction", "=", "predictions", "[", "uid", "]", "\n", "exact_match", "+=", "metric_max_over_ground_truths", "(", "\n", "exact_match_score", ",", "prediction", ",", "ground_truths", "\n", ")", "\n", "f1", "+=", "metric_max_over_ground_truths", "(", "f1_score", ",", "prediction", ",", "ground_truths", ")", "\n", "\n", "", "exact_match", "=", "100.0", "*", "exact_match", "/", "total", "\n", "f1", "=", "100.0", "*", "f1", "/", "total", "\n", "return", "str", "(", "{", "\"exact_match\"", ":", "exact_match", ",", "\"f1\"", ":", "f1", "}", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.utils_qa.load_json": [[31, 34], ["open", "json.load"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load"], ["def", "load_json", "(", "path", ")", ":", "\n", "    ", "with", "open", "(", "path", ",", "\"r\"", ",", "encoding", "=", "\"utf-8\"", ")", "as", "f", ":", "\n", "        ", "return", "json", ".", "load", "(", "f", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.utils_qa.reduce_features_to_examples": [[36, 44], ["set", "examples.append", "set.add"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.vocab.Vocabulary.add"], ["", "", "def", "reduce_features_to_examples", "(", "features", ")", ":", "\n", "    ", "examples", "=", "[", "]", "\n", "exits_dict", "=", "set", "(", ")", "\n", "for", "feature", "in", "features", ":", "\n", "        ", "if", "feature", "[", "\"uid\"", "]", "not", "in", "exits_dict", ":", "\n", "            ", "examples", ".", "append", "(", "{", "\"uid\"", ":", "feature", "[", "\"uid\"", "]", ",", "\"context\"", ":", "feature", "[", "\"context\"", "]", "}", ")", "\n", "exits_dict", ".", "add", "(", "feature", "[", "\"uid\"", "]", ")", "\n", "", "", "return", "examples", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.utils_qa.extract_answers_from_features": [[46, 58], ["set", "set.add"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.vocab.Vocabulary.add"], ["", "def", "extract_answers_from_features", "(", "features", ",", "is_v2", "=", "False", ",", "use_label", "=", "False", ")", ":", "\n", "    ", "answers", "=", "{", "}", "\n", "exits_dict", "=", "set", "(", ")", "\n", "for", "feature", "in", "features", ":", "\n", "        ", "if", "feature", "[", "\"uid\"", "]", "not", "in", "exits_dict", ":", "\n", "            ", "answers", "[", "feature", "[", "\"uid\"", "]", "]", "=", "feature", "[", "\"answer\"", "]", "\n", "if", "is_v2", "and", "\"label\"", "in", "feature", ":", "\n", "                ", "answers", "[", "feature", "[", "\"uid\"", "]", "]", "[", "\"is_impossible\"", "]", "=", "(", "\n", "True", "if", "feature", "[", "\"label\"", "]", "else", "False", "\n", ")", "\n", "", "exits_dict", ".", "add", "(", "feature", "[", "\"uid\"", "]", ")", "\n", "", "", "return", "answers", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.utils_qa.postprocess_qa_predictions": [[60, 289], ["utils_qa.reduce_features_to_examples", "collections.defaultdict", "enumerate", "collections.OrderedDict", "collections.OrderedDict", "logger.setLevel", "logger.info", "enumerate", "utils_qa.extract_answers_from_features", "len", "len", "len", "features_per_example[].append", "collections.OrderedDict", "tqdm.auto.tqdm", "numpy.array", "numpy.exp", "zip", "len", "len", "enumerate", "features[].get", "features[].get", "[].tolist", "[].tolist", "prelim_predictions.append", "sorted", "predictions.append", "pred.pop", "predictions.insert", "np.exp.sum", "len", "len", "any", "len", "pred.pop", "numpy.max", "float", "prelim_predictions.append", "len", "isinstance", "float", "pred.items", "numpy.argsort", "numpy.argsort", "len", "len", "features[].get.get", "str"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.utils_qa.reduce_features_to_examples", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.utils_qa.extract_answers_from_features"], ["", "def", "postprocess_qa_predictions", "(", "\n", "features", ",", "\n", "predictions", ":", "Tuple", "[", "np", ".", "ndarray", ",", "np", ".", "ndarray", "]", ",", "\n", "version_2_with_negative", ":", "bool", "=", "False", ",", "\n", "n_best_size", ":", "int", "=", "20", ",", "\n", "max_answer_length", ":", "int", "=", "30", ",", "\n", "null_score_diff_threshold", ":", "float", "=", "0.0", ",", "\n", "prefix", ":", "Optional", "[", "str", "]", "=", "None", ",", "\n", "is_world_process_zero", ":", "bool", "=", "True", ",", "\n", ")", ":", "\n", "    ", "\"\"\"\n    Post-processes the predictions of a question-answering model to convert them to answers that are substrings of the\n    original contexts. This is the base postprocessing functions for models that only return start and end logits.\n\n    Args:\n        features: The processed dataset (see the main script for more information).\n        predictions (:obj:`Tuple[np.ndarray, np.ndarray]`):\n            The predictions of the model: two arrays containing the start logits and the end logits respectively. Its\n            first dimension must match the number of elements of :obj:`features`.\n        version_2_with_negative (:obj:`bool`, `optional`, defaults to :obj:`False`):\n            Whether or not the underlying dataset contains examples with no answers.\n        n_best_size (:obj:`int`, `optional`, defaults to 20):\n            The total number of n-best predictions to generate when looking for an answer.\n        max_answer_length (:obj:`int`, `optional`, defaults to 30):\n            The maximum length of an answer that can be generated. This is needed because the start and end predictions\n            are not conditioned on one another.\n        null_score_diff_threshold (:obj:`float`, `optional`, defaults to 0):\n            The threshold used to select the null answer: if the best answer has a score that is less than the score of\n            the null answer minus this threshold, the null answer is selected for this example (note that the score of\n            the null answer for an example giving several features is the minimum of the scores for the null answer on\n            each feature: all features must be aligned on the fact they `want` to predict a null answer).\n\n            Only useful when :obj:`version_2_with_negative` is :obj:`True`.\n        prefix (:obj:`str`, `optional`):\n            If provided, the dictionaries mentioned above are saved with `prefix` added to their names.\n        is_world_process_zero (:obj:`bool`, `optional`, defaults to :obj:`True`):\n            Whether this process is the main process or not (used to determine if logging/saves should be done).\n    \"\"\"", "\n", "assert", "(", "\n", "len", "(", "predictions", ")", "==", "2", "\n", ")", ",", "\"`predictions` should be a tuple with two elements (start_logits, end_logits).\"", "\n", "all_start_logits", ",", "all_end_logits", "=", "predictions", "\n", "\n", "assert", "len", "(", "predictions", "[", "0", "]", ")", "==", "len", "(", "\n", "features", "\n", ")", ",", "f\"Got {len(predictions[0])} predictions and {len(features)} features.\"", "\n", "\n", "examples", "=", "reduce_features_to_examples", "(", "features", ")", "\n", "\n", "# Build a map example to its corresponding features.", "\n", "example_id_to_index", "=", "{", "example", "[", "\"uid\"", "]", ":", "i", "for", "i", ",", "example", "in", "enumerate", "(", "examples", ")", "}", "\n", "features_per_example", "=", "collections", ".", "defaultdict", "(", "list", ")", "\n", "for", "i", ",", "feature", "in", "enumerate", "(", "features", ")", ":", "\n", "        ", "features_per_example", "[", "example_id_to_index", "[", "feature", "[", "\"uid\"", "]", "]", "]", ".", "append", "(", "i", ")", "\n", "\n", "# The dictionaries we have to fill.", "\n", "", "all_predictions", "=", "collections", ".", "OrderedDict", "(", ")", "\n", "all_nbest_json", "=", "collections", ".", "OrderedDict", "(", ")", "\n", "if", "version_2_with_negative", ":", "\n", "        ", "scores_diff_json", "=", "collections", ".", "OrderedDict", "(", ")", "\n", "\n", "# Logging.", "\n", "", "logger", ".", "setLevel", "(", "logging", ".", "INFO", "if", "is_world_process_zero", "else", "logging", ".", "WARN", ")", "\n", "logger", ".", "info", "(", "\n", "f\"Post-processing {len(examples)} example predictions split into {len(features)} features.\"", "\n", ")", "\n", "\n", "# Let's loop over all the examples!", "\n", "for", "example_index", ",", "example", "in", "enumerate", "(", "tqdm", "(", "examples", ")", ")", ":", "\n", "# Those are the indices of the features associated to the current example.", "\n", "        ", "feature_indices", "=", "features_per_example", "[", "example_index", "]", "\n", "\n", "min_null_prediction", "=", "None", "\n", "prelim_predictions", "=", "[", "]", "\n", "\n", "# Looping through all the features associated to the current example.", "\n", "for", "feature_index", "in", "feature_indices", ":", "\n", "# We grab the predictions of the model for this feature.", "\n", "            ", "start_logits", "=", "all_start_logits", "[", "feature_index", "]", "\n", "end_logits", "=", "all_end_logits", "[", "feature_index", "]", "\n", "# This is what will allow us to map some the positions in our logits to span of texts in the original", "\n", "# context.", "\n", "offset_mapping", "=", "features", "[", "feature_index", "]", "[", "\"offset_mapping\"", "]", "\n", "# Optional `token_is_max_context`, if provided we will remove answers that do not have the maximum context", "\n", "# available in the current feature.", "\n", "token_is_max_context", "=", "features", "[", "feature_index", "]", ".", "get", "(", "\n", "\"token_is_max_context\"", ",", "None", "\n", ")", "\n", "\n", "# Update minimum null prediction.", "\n", "null_ans_index", "=", "features", "[", "feature_index", "]", ".", "get", "(", "\"null_ans_index\"", ",", "0", ")", "\n", "feature_null_score", "=", "(", "\n", "start_logits", "[", "null_ans_index", "]", "+", "end_logits", "[", "null_ans_index", "]", "\n", ")", "\n", "if", "(", "\n", "min_null_prediction", "is", "None", "\n", "or", "min_null_prediction", "[", "\"score\"", "]", ">", "feature_null_score", "\n", ")", ":", "\n", "                ", "min_null_prediction", "=", "{", "\n", "\"offsets\"", ":", "(", "0", ",", "0", ")", ",", "\n", "\"score\"", ":", "feature_null_score", ",", "\n", "\"start_logit\"", ":", "start_logits", "[", "null_ans_index", "]", ",", "\n", "\"end_logit\"", ":", "end_logits", "[", "null_ans_index", "]", ",", "\n", "}", "\n", "\n", "# Go through all possibilities for the `n_best_size` greater start and end logits.", "\n", "", "start_indexes", "=", "np", ".", "argsort", "(", "start_logits", ")", "[", "\n", "-", "1", ":", "-", "n_best_size", "-", "1", ":", "-", "1", "\n", "]", ".", "tolist", "(", ")", "\n", "end_indexes", "=", "np", ".", "argsort", "(", "end_logits", ")", "[", "-", "1", ":", "-", "n_best_size", "-", "1", ":", "-", "1", "]", ".", "tolist", "(", ")", "\n", "for", "start_index", "in", "start_indexes", ":", "\n", "                ", "for", "end_index", "in", "end_indexes", ":", "\n", "# Don't consider out-of-scope answers, either because the indices are out of bounds or correspond", "\n", "# to part of the input_ids that are not in the context.", "\n", "                    ", "if", "(", "\n", "start_index", ">=", "len", "(", "offset_mapping", ")", "\n", "or", "end_index", ">=", "len", "(", "offset_mapping", ")", "\n", "or", "offset_mapping", "[", "start_index", "]", "is", "None", "\n", "or", "offset_mapping", "[", "end_index", "]", "is", "None", "\n", ")", ":", "\n", "                        ", "continue", "\n", "# Don't consider answers with a length that is either < 0 or > max_answer_length.", "\n", "", "if", "(", "\n", "end_index", "<", "start_index", "\n", "or", "end_index", "-", "start_index", "+", "1", ">", "max_answer_length", "\n", ")", ":", "\n", "                        ", "continue", "\n", "# Don't consider answer that don't have the maximum context available (if such information is", "\n", "# provided).", "\n", "", "if", "(", "\n", "token_is_max_context", "is", "not", "None", "\n", "and", "not", "token_is_max_context", ".", "get", "(", "str", "(", "start_index", ")", ",", "False", ")", "\n", ")", ":", "\n", "                        ", "continue", "\n", "", "prelim_predictions", ".", "append", "(", "\n", "{", "\n", "\"offsets\"", ":", "(", "\n", "offset_mapping", "[", "start_index", "]", "[", "0", "]", ",", "\n", "offset_mapping", "[", "end_index", "]", "[", "1", "]", ",", "\n", ")", ",", "\n", "\"score\"", ":", "start_logits", "[", "start_index", "]", "+", "end_logits", "[", "end_index", "]", ",", "\n", "\"start_logit\"", ":", "start_logits", "[", "start_index", "]", ",", "\n", "\"end_logit\"", ":", "end_logits", "[", "end_index", "]", ",", "\n", "}", "\n", ")", "\n", "", "", "", "if", "version_2_with_negative", ":", "\n", "# Add the minimum null prediction", "\n", "            ", "prelim_predictions", ".", "append", "(", "min_null_prediction", ")", "\n", "null_score", "=", "min_null_prediction", "[", "\"score\"", "]", "\n", "\n", "# Only keep the best `n_best_size` predictions.", "\n", "", "predictions", "=", "sorted", "(", "\n", "prelim_predictions", ",", "key", "=", "lambda", "x", ":", "x", "[", "\"score\"", "]", ",", "reverse", "=", "True", "\n", ")", "[", ":", "n_best_size", "]", "\n", "\n", "# Add back the minimum null prediction if it was removed because of its low score.", "\n", "if", "version_2_with_negative", "and", "not", "any", "(", "\n", "p", "[", "\"offsets\"", "]", "==", "(", "0", ",", "0", ")", "for", "p", "in", "predictions", "\n", ")", ":", "\n", "            ", "predictions", ".", "append", "(", "min_null_prediction", ")", "\n", "\n", "# Use the offsets to gather the answer text in the original context.", "\n", "", "context", "=", "example", "[", "\"context\"", "]", "\n", "for", "pred", "in", "predictions", ":", "\n", "            ", "offsets", "=", "pred", ".", "pop", "(", "\"offsets\"", ")", "\n", "pred", "[", "\"text\"", "]", "=", "context", "[", "offsets", "[", "0", "]", ":", "offsets", "[", "1", "]", "]", "\n", "\n", "# In the very rare edge case we have not a single non-null prediction, we create a fake prediction to avoid", "\n", "# failure.", "\n", "", "if", "len", "(", "predictions", ")", "==", "0", "or", "(", "\n", "len", "(", "predictions", ")", "==", "1", "and", "predictions", "[", "0", "]", "[", "\"text\"", "]", "==", "\"\"", "\n", ")", ":", "\n", "            ", "predictions", ".", "insert", "(", "\n", "0", ",", "{", "\"text\"", ":", "\"\"", ",", "\"start_logit\"", ":", "0.0", ",", "\"end_logit\"", ":", "0.0", ",", "\"score\"", ":", "0.0", "}", "\n", ")", "\n", "\n", "# Compute the softmax of all scores (we do it with numpy to stay independent from torch/tf in this file, using", "\n", "# the LogSumExp trick).", "\n", "", "scores", "=", "np", ".", "array", "(", "[", "pred", ".", "pop", "(", "\"score\"", ")", "for", "pred", "in", "predictions", "]", ")", "\n", "exp_scores", "=", "np", ".", "exp", "(", "scores", "-", "np", ".", "max", "(", "scores", ")", ")", "\n", "probs", "=", "exp_scores", "/", "exp_scores", ".", "sum", "(", ")", "\n", "\n", "# Include the probabilities in our predictions.", "\n", "for", "prob", ",", "pred", "in", "zip", "(", "probs", ",", "predictions", ")", ":", "\n", "            ", "pred", "[", "\"probability\"", "]", "=", "prob", "\n", "\n", "# Pick the best prediction. If the null answer is not possible, this is easy.", "\n", "", "if", "not", "version_2_with_negative", ":", "\n", "            ", "all_predictions", "[", "example", "[", "\"uid\"", "]", "]", "=", "predictions", "[", "0", "]", "[", "\"text\"", "]", "\n", "", "else", ":", "\n", "# Otherwise we first need to find the best non-empty prediction.", "\n", "# import pdb; pdb.set_trace()", "\n", "            ", "if", "predictions", ":", "\n", "                ", "best_non_null_pred", "=", "predictions", "[", "0", "]", "\n", "for", "pred", "in", "predictions", ":", "\n", "                    ", "if", "pred", "[", "\"text\"", "]", "!=", "\"\"", ":", "\n", "                        ", "best_non_null_pred", "=", "pred", "\n", "break", "\n", "\n", "# Then we compare to the null prediction using the threshold.", "\n", "", "", "score_diff", "=", "(", "\n", "null_score", "\n", "-", "best_non_null_pred", "[", "\"start_logit\"", "]", "\n", "-", "best_non_null_pred", "[", "\"end_logit\"", "]", "\n", ")", "\n", "scores_diff_json", "[", "example", "[", "\"uid\"", "]", "]", "=", "float", "(", "\n", "score_diff", "\n", ")", "# To be JSON-serializable.", "\n", "if", "score_diff", ">", "null_score_diff_threshold", ":", "\n", "                    ", "all_predictions", "[", "example", "[", "\"uid\"", "]", "]", "=", "\"\"", "\n", "", "else", ":", "\n", "                    ", "all_predictions", "[", "example", "[", "\"uid\"", "]", "]", "=", "best_non_null_pred", "[", "\"text\"", "]", "\n", "", "", "else", ":", "\n", "                ", "all_predictions", "[", "example", "[", "\"uid\"", "]", "]", "=", "\"\"", "\n", "\n", "# Make `predictions` JSON-serializable by casting np.float back to float.", "\n", "", "", "all_nbest_json", "[", "example", "[", "\"uid\"", "]", "]", "=", "[", "\n", "{", "\n", "k", ":", "(", "\n", "float", "(", "v", ")", "\n", "if", "isinstance", "(", "v", ",", "(", "np", ".", "float16", ",", "np", ".", "float32", ",", "np", ".", "float64", ")", ")", "\n", "else", "v", "\n", ")", "\n", "for", "k", ",", "v", "in", "pred", ".", "items", "(", ")", "\n", "}", "\n", "for", "pred", "in", "predictions", "\n", "]", "\n", "", "answers", "=", "extract_answers_from_features", "(", "features", ",", "version_2_with_negative", ")", "\n", "return", "all_predictions", ",", "answers", "\n", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.roberta_utils.update_roberta_keys": [[4, 53], ["state.keys", "state.items", "range", "int", "numpy.concatenate", "numpy.array_equal", "numpy.concatenate", "numpy.array_equal", "weight.cpu().numpy", "bais.cpu().numpy", "weight.size", "new_dict[].cpu().numpy", "new_dict[].cpu().numpy", "new_dict[].cpu().numpy", "new_dict[].cpu().numpy", "new_dict[].cpu().numpy", "new_dict[].cpu().numpy", "weight.cpu", "bais.cpu", "new_dict[].cpu", "new_dict[].cpu", "new_dict[].cpu", "new_dict[].cpu", "new_dict[].cpu", "new_dict[].cpu"], "function", ["None"], ["def", "update_roberta_keys", "(", "state", ",", "nlayer", "=", "24", ")", ":", "\n", "    ", "for", "key", "in", "state", ".", "keys", "(", ")", ":", "\n", "        ", "if", "\"self_attn.q_proj\"", "in", "key", ":", "\n", "            ", "return", "state", "\n", "", "", "new_dict", "=", "{", "}", "\n", "for", "key", ",", "val", "in", "state", ".", "items", "(", ")", ":", "\n", "        ", "if", "not", "\"self_attn.in_proj_\"", "in", "key", ":", "\n", "            ", "new_dict", "[", "key", "]", "=", "val", "\n", "\n", "", "", "for", "i", "in", "range", "(", "nlayer", ")", ":", "\n", "        ", "mhaw", "=", "\"decoder.sentence_encoder.layers.{}.self_attn.in_proj_weight\"", ".", "format", "(", "i", ")", "\n", "mhab", "=", "\"decoder.sentence_encoder.layers.{}.self_attn.in_proj_bias\"", ".", "format", "(", "i", ")", "\n", "weight", "=", "state", "[", "mhaw", "]", "\n", "bais", "=", "state", "[", "mhab", "]", "\n", "size", "=", "int", "(", "weight", ".", "size", "(", "0", ")", "/", "3", ")", "\n", "# query, key, value", "\n", "qw", "=", "\"decoder.sentence_encoder.layers.{}.self_attn.q_proj.weight\"", ".", "format", "(", "i", ")", "\n", "kw", "=", "\"decoder.sentence_encoder.layers.{}.self_attn.k_proj.weight\"", ".", "format", "(", "i", ")", "\n", "vw", "=", "\"decoder.sentence_encoder.layers.{}.self_attn.v_proj.weight\"", ".", "format", "(", "i", ")", "\n", "new_dict", "[", "qw", "]", "=", "weight", "[", ":", "size", ",", ":", "]", "\n", "new_dict", "[", "kw", "]", "=", "weight", "[", "size", ":", "size", "*", "2", ",", ":", "]", "\n", "new_dict", "[", "vw", "]", "=", "weight", "[", "size", "*", "2", ":", ",", ":", "]", "\n", "\n", "# reconstruct weight", "\n", "rweight", "=", "np", ".", "concatenate", "(", "\n", "(", "\n", "new_dict", "[", "qw", "]", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ",", "\n", "new_dict", "[", "kw", "]", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ",", "\n", "new_dict", "[", "vw", "]", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ",", "\n", ")", ",", "\n", "axis", "=", "0", ",", "\n", ")", "\n", "assert", "np", ".", "array_equal", "(", "rweight", ",", "weight", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ")", "\n", "qb", "=", "\"decoder.sentence_encoder.layers.{}.self_attn.q_proj.bias\"", ".", "format", "(", "i", ")", "\n", "kb", "=", "\"decoder.sentence_encoder.layers.{}.self_attn.k_proj.bias\"", ".", "format", "(", "i", ")", "\n", "vb", "=", "\"decoder.sentence_encoder.layers.{}.self_attn.v_proj.bias\"", ".", "format", "(", "i", ")", "\n", "new_dict", "[", "qb", "]", "=", "bais", "[", ":", "size", "]", "\n", "new_dict", "[", "kb", "]", "=", "bais", "[", "size", ":", "size", "*", "2", "]", "\n", "new_dict", "[", "vb", "]", "=", "bais", "[", "size", "*", "2", ":", "]", "\n", "rbais", "=", "np", ".", "concatenate", "(", "\n", "(", "\n", "new_dict", "[", "qb", "]", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ",", "\n", "new_dict", "[", "kb", "]", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ",", "\n", "new_dict", "[", "vb", "]", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ",", "\n", ")", ",", "\n", "axis", "=", "0", ",", "\n", ")", "\n", "assert", "np", ".", "array_equal", "(", "rbais", ",", "bais", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ")", "\n", "", "return", "new_dict", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.roberta_utils.patch_name_dict": [[55, 67], ["state.items", "key.startswith", "key.startswith"], "function", ["None"], ["", "def", "patch_name_dict", "(", "state", ")", ":", "\n", "    ", "new_state", "=", "{", "}", "\n", "for", "key", ",", "val", "in", "state", ".", "items", "(", ")", ":", "\n", "        ", "if", "key", ".", "startswith", "(", "\"decoder.sentence_encoder\"", ")", ":", "\n", "            ", "key", "=", "\"bert.{}\"", ".", "format", "(", "key", ")", "\n", "new_state", "[", "key", "]", "=", "val", "\n", "", "elif", "key", ".", "startswith", "(", "\"classification_heads\"", ")", ":", "\n", "            ", "key", "=", "\"bert.{}\"", ".", "format", "(", "key", ")", "\n", "new_state", "[", "key", "]", "=", "val", "\n", "", "else", ":", "\n", "            ", "new_state", "[", "key", "]", "=", "val", "\n", "", "", "return", "new_state", "\n", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.__init__.load_data": [[8, 79], ["open", "line.strip().split", "tasks.get_task_obj", "rows.append", "tasks.get_task_obj.input_parse_label", "line.strip", "len", "row[].split", "int", "len", "numpy.argmax", "len", "fields[].split", "float", "eval", "eval", "ValueError", "type", "eval", "int", "numpy.argmax"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.get_task_obj", "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.ClassificationTask.input_parse_label"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.__init__.load_score_file": [[81, 97], ["json.loads", "zip", "open().read", "range", "open", "len", "len", "len", "len", "len"], "function", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.utils.AverageMeter.__init__": [[11, 13], ["utils.AverageMeter.reset"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.utils.AverageMeter.reset"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "reset", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.utils.AverageMeter.reset": [[14, 19], ["None"], "methods", ["None"], ["", "def", "reset", "(", "self", ")", ":", "\n", "        ", "self", ".", "val", "=", "0", "\n", "self", ".", "avg", "=", "0", "\n", "self", ".", "sum", "=", "0", "\n", "self", ".", "count", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.utils.AverageMeter.update": [[20, 25], ["None"], "methods", ["None"], ["", "def", "update", "(", "self", ",", "val", ",", "n", "=", "1", ")", ":", "\n", "        ", "self", ".", "val", "=", "val", "\n", "self", ".", "sum", "+=", "val", "*", "n", "\n", "self", ".", "count", "+=", "n", "\n", "self", ".", "avg", "=", "self", ".", "sum", "/", "self", ".", "count", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.utils.set_environment": [[27, 33], ["random.seed", "numpy.random.seed", "torch.manual_seed", "torch.cuda.is_available", "torch.cuda.manual_seed_all"], "function", ["None"], ["", "", "def", "set_environment", "(", "seed", ",", "set_cuda", "=", "False", ")", ":", "\n", "    ", "random", ".", "seed", "(", "seed", ")", "\n", "numpy", ".", "random", ".", "seed", "(", "seed", ")", "\n", "torch", ".", "manual_seed", "(", "seed", ")", "\n", "if", "torch", ".", "cuda", ".", "is_available", "(", ")", "and", "set_cuda", ":", "\n", "        ", "torch", ".", "cuda", ".", "manual_seed_all", "(", "seed", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.utils.patch_var": [[35, 39], ["v.cuda.cuda"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.cuda"], ["", "", "def", "patch_var", "(", "v", ",", "cuda", "=", "True", ")", ":", "\n", "    ", "if", "cuda", ":", "\n", "        ", "v", "=", "v", ".", "cuda", "(", "non_blocking", "=", "True", ")", "\n", "", "return", "v", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.utils.get_gpu_memory_map": [[41, 49], ["subprocess.check_output", "dict", "int", "zip", "subprocess.check_output.strip().split", "range", "len", "subprocess.check_output.strip"], "function", ["None"], ["", "def", "get_gpu_memory_map", "(", ")", ":", "\n", "    ", "result", "=", "subprocess", ".", "check_output", "(", "\n", "[", "\"nvidia-smi\"", ",", "\"--query-gpu=memory.used\"", ",", "\"--format=csv,nounits,noheader\"", "]", ",", "\n", "encoding", "=", "\"utf-8\"", ",", "\n", ")", "\n", "gpu_memory", "=", "[", "int", "(", "x", ")", "for", "x", "in", "result", ".", "strip", "(", ")", ".", "split", "(", "\"\\n\"", ")", "]", "\n", "gpu_memory_map", "=", "dict", "(", "zip", "(", "range", "(", "len", "(", "gpu_memory", ")", ")", ",", "gpu_memory", ")", ")", "\n", "return", "gpu_memory_map", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.utils.get_pip_env": [[51, 54], ["subprocess.call"], "function", ["None"], ["", "def", "get_pip_env", "(", ")", ":", "\n", "    ", "result", "=", "subprocess", ".", "call", "(", "[", "\"pip\"", ",", "\"freeze\"", "]", ")", "\n", "return", "result", "\n", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.vocab.Vocabulary.__init__": [[19, 27], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "neat", "=", "False", ")", ":", "\n", "        ", "self", ".", "neat", "=", "neat", "\n", "if", "not", "neat", ":", "\n", "            ", "self", ".", "tok2ind", "=", "{", "PAD", ":", "PAD_ID", ",", "UNK", ":", "UNK_ID", ",", "STA", ":", "STA_ID", ",", "END", ":", "END_ID", "}", "\n", "self", ".", "ind2tok", "=", "{", "PAD_ID", ":", "PAD", ",", "UNK_ID", ":", "UNK", ",", "STA_ID", ":", "STA", ",", "END_ID", ":", "END", "}", "\n", "", "else", ":", "\n", "            ", "self", ".", "tok2ind", "=", "{", "}", "\n", "self", ".", "ind2tok", "=", "{", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.vocab.Vocabulary.__len__": [[28, 30], ["len"], "methods", ["None"], ["", "", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "tok2ind", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.vocab.Vocabulary.__iter__": [[31, 33], ["iter"], "methods", ["None"], ["", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "return", "iter", "(", "self", ".", "tok2ind", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.vocab.Vocabulary.__contains__": [[34, 39], ["type", "type"], "methods", ["None"], ["", "def", "__contains__", "(", "self", ",", "key", ")", ":", "\n", "        ", "if", "type", "(", "key", ")", "==", "int", ":", "\n", "            ", "return", "key", "in", "self", ".", "ind2tok", "\n", "", "elif", "type", "(", "key", ")", "==", "str", ":", "\n", "            ", "return", "key", "in", "self", ".", "tok2ind", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.vocab.Vocabulary.__getitem__": [[40, 50], ["type", "type", "vocab.Vocabulary.ind2tok.get", "vocab.Vocabulary.ind2tok.get", "vocab.Vocabulary.tok2ind.get", "vocab.Vocabulary.tok2ind.get", "vocab.Vocabulary.tok2ind.get"], "methods", ["None"], ["", "", "def", "__getitem__", "(", "self", ",", "key", ")", ":", "\n", "        ", "if", "type", "(", "key", ")", "==", "int", ":", "\n", "            ", "return", "(", "\n", "self", ".", "ind2tok", ".", "get", "(", "key", ",", "-", "1", ")", "if", "self", ".", "neat", "else", "self", ".", "ind2tok", ".", "get", "(", "key", ",", "UNK", ")", "\n", ")", "\n", "", "if", "type", "(", "key", ")", "==", "str", ":", "\n", "            ", "return", "(", "\n", "self", ".", "tok2ind", ".", "get", "(", "key", ",", "None", ")", "\n", "if", "self", ".", "neat", "\n", "else", "self", ".", "tok2ind", ".", "get", "(", "key", ",", "self", ".", "tok2ind", ".", "get", "(", "UNK", ")", ")", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.vocab.Vocabulary.__setitem__": [[52, 59], ["type", "type", "RuntimeError", "type", "type"], "methods", ["None"], ["", "", "def", "__setitem__", "(", "self", ",", "key", ",", "item", ")", ":", "\n", "        ", "if", "type", "(", "key", ")", "==", "int", "and", "type", "(", "item", ")", "==", "str", ":", "\n", "            ", "self", ".", "ind2tok", "[", "key", "]", "=", "item", "\n", "", "elif", "type", "(", "key", ")", "==", "str", "and", "type", "(", "item", ")", "==", "int", ":", "\n", "            ", "self", ".", "tok2ind", "[", "key", "]", "=", "item", "\n", "", "else", ":", "\n", "            ", "raise", "RuntimeError", "(", "\"Invalid (key, item) types.\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.vocab.Vocabulary.add": [[60, 65], ["len"], "methods", ["None"], ["", "", "def", "add", "(", "self", ",", "token", ")", ":", "\n", "        ", "if", "token", "not", "in", "self", ".", "tok2ind", ":", "\n", "            ", "index", "=", "len", "(", "self", ".", "tok2ind", ")", "\n", "self", ".", "tok2ind", "[", "token", "]", "=", "index", "\n", "self", ".", "ind2tok", "[", "index", "]", "=", "token", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.vocab.Vocabulary.get_vocab_list": [[66, 72], ["range", "vocab.Vocabulary.tok2ind.keys", "len"], "methods", ["None"], ["", "", "def", "get_vocab_list", "(", "self", ",", "with_order", "=", "True", ")", ":", "\n", "        ", "if", "with_order", ":", "\n", "            ", "words", "=", "[", "self", "[", "k", "]", "for", "k", "in", "range", "(", "0", ",", "len", "(", "self", ")", ")", "]", "\n", "", "else", ":", "\n", "            ", "words", "=", "[", "k", "for", "k", "in", "self", ".", "tok2ind", ".", "keys", "(", ")", "if", "k", "not", "in", "{", "PAD", ",", "UNK", ",", "STA", ",", "END", "}", "]", "\n", "", "return", "words", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.vocab.Vocabulary.toidx": [[73, 75], ["None"], "methods", ["None"], ["", "def", "toidx", "(", "self", ",", "tokens", ")", ":", "\n", "        ", "return", "[", "self", "[", "tok", "]", "for", "tok", "in", "tokens", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.vocab.Vocabulary.copy": [[76, 82], ["vocab.Vocabulary", "vocab.Vocabulary.add"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.vocab.Vocabulary.add"], ["", "def", "copy", "(", "self", ")", ":", "\n", "        ", "\"\"\"Deep copy\"\"\"", "\n", "new_vocab", "=", "Vocabulary", "(", "self", ".", "neat", ")", "\n", "for", "w", "in", "self", ":", "\n", "            ", "new_vocab", ".", "add", "(", "w", ")", "\n", "", "return", "new_vocab", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.vocab.Vocabulary.build": [[83, 88], ["Vocabulary.Vocabulary", "Vocabulary.Vocabulary.add"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.vocab.Vocabulary.add"], ["", "def", "build", "(", "words", ",", "neat", "=", "False", ")", ":", "\n", "        ", "vocab", "=", "Vocabulary", "(", "neat", ")", "\n", "for", "w", "in", "words", ":", "\n", "            ", "vocab", ".", "add", "(", "w", ")", "\n", "", "return", "vocab", "\n", "", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows": [[6, 90], ["open", "out_f.write", "out_f.write", "str", "pdb.set_trace", "out_f.write", "str", "pdb.set_trace", "out_f.write", "str", "pdb.set_trace", "str", "pdb.set_trace", "out_f.write", "ValueError", "str", "pdb.set_trace", "str", "pdb.set_trace", "str", "pdb.set_trace"], "function", ["None"], ["def", "dump_rows", "(", "rows", ",", "out_path", ",", "data_format", ")", ":", "\n", "    ", "\"\"\"\n    output files should have following format\n    :param rows:\n    :param out_path:\n    :return:\n    \"\"\"", "\n", "with", "open", "(", "out_path", ",", "\"w\"", ",", "encoding", "=", "\"utf-8\"", ")", "as", "out_f", ":", "\n", "        ", "row0", "=", "rows", "[", "0", "]", "\n", "# data_format = detect_format(row0)", "\n", "for", "row", "in", "rows", ":", "\n", "# assert data_format == detect_format(row), row", "\n", "            ", "if", "data_format", "==", "DataFormat", ".", "PremiseOnly", ":", "\n", "                ", "for", "col", "in", "[", "\"uid\"", ",", "\"label\"", ",", "\"premise\"", "]", ":", "\n", "                    ", "if", "\"\\t\"", "in", "str", "(", "row", "[", "col", "]", ")", ":", "\n", "                        ", "import", "pdb", "\n", "\n", "pdb", ".", "set_trace", "(", ")", "\n", "", "", "out_f", ".", "write", "(", "\"%s\\t%s\\t%s\\n\"", "%", "(", "row", "[", "\"uid\"", "]", ",", "row", "[", "\"label\"", "]", ",", "row", "[", "\"premise\"", "]", ")", ")", "\n", "", "elif", "data_format", "==", "DataFormat", ".", "PremiseAndOneHypothesis", ":", "\n", "                ", "for", "col", "in", "[", "\"uid\"", ",", "\"label\"", ",", "\"premise\"", ",", "\"hypothesis\"", "]", ":", "\n", "                    ", "if", "\"\\t\"", "in", "str", "(", "row", "[", "col", "]", ")", ":", "\n", "                        ", "import", "pdb", "\n", "\n", "pdb", ".", "set_trace", "(", ")", "\n", "", "", "out_f", ".", "write", "(", "\n", "\"%s\\t%s\\t%s\\t%s\\n\"", "\n", "%", "(", "row", "[", "\"uid\"", "]", ",", "row", "[", "\"label\"", "]", ",", "row", "[", "\"premise\"", "]", ",", "row", "[", "\"hypothesis\"", "]", ")", "\n", ")", "\n", "", "elif", "data_format", "==", "DataFormat", ".", "PremiseAndMultiHypothesis", ":", "\n", "                ", "for", "col", "in", "[", "\"uid\"", ",", "\"label\"", ",", "\"premise\"", "]", ":", "\n", "                    ", "if", "\"\\t\"", "in", "str", "(", "row", "[", "col", "]", ")", ":", "\n", "                        ", "import", "pdb", "\n", "\n", "pdb", ".", "set_trace", "(", ")", "\n", "", "", "hypothesis", "=", "row", "[", "\"hypothesis\"", "]", "\n", "for", "one_hypo", "in", "hypothesis", ":", "\n", "                    ", "if", "\"\\t\"", "in", "str", "(", "one_hypo", ")", ":", "\n", "                        ", "import", "pdb", "\n", "\n", "pdb", ".", "set_trace", "(", ")", "\n", "", "", "hypothesis", "=", "\"\\t\"", ".", "join", "(", "hypothesis", ")", "\n", "out_f", ".", "write", "(", "\n", "\"%s\\t%s\\t%s\\t%s\\t%s\\n\"", "\n", "%", "(", "\n", "row", "[", "\"uid\"", "]", ",", "\n", "row", "[", "\"ruid\"", "]", ",", "\n", "row", "[", "\"label\"", "]", ",", "\n", "row", "[", "\"premise\"", "]", ",", "\n", "hypothesis", ",", "\n", ")", "\n", ")", "\n", "", "elif", "data_format", "==", "DataFormat", ".", "Seqence", ":", "\n", "                ", "for", "col", "in", "[", "\"uid\"", ",", "\"label\"", ",", "\"premise\"", "]", ":", "\n", "                    ", "if", "\"\\t\"", "in", "str", "(", "row", "[", "col", "]", ")", ":", "\n", "                        ", "import", "pdb", "\n", "\n", "pdb", ".", "set_trace", "(", ")", "\n", "", "", "out_f", ".", "write", "(", "\"%s\\t%s\\t%s\\n\"", "%", "(", "row", "[", "\"uid\"", "]", ",", "row", "[", "\"label\"", "]", ",", "row", "[", "\"premise\"", "]", ")", ")", "\n", "", "elif", "data_format", "==", "DataFormat", ".", "ClozeChoice", ":", "\n", "                ", "for", "col", "in", "[", "\"uid\"", ",", "\"label\"", ",", "\"premise\"", "]", ":", "\n", "                    ", "if", "\"\\t\"", "in", "str", "(", "row", "[", "col", "]", ")", ":", "\n", "                        ", "import", "pdb", "\n", "pdb", ".", "set_trace", "(", ")", "\n", "", "", "hypothesis", "=", "row", "[", "\"hypothesis\"", "]", "\n", "for", "one_hypo", "in", "hypothesis", ":", "\n", "                    ", "if", "\"\\t\"", "in", "str", "(", "one_hypo", ")", ":", "\n", "                        ", "import", "pdb", "\n", "\n", "pdb", ".", "set_trace", "(", ")", "\n", "", "", "hypothesis", "=", "\"\\t\"", ".", "join", "(", "hypothesis", ")", "\n", "out_f", ".", "write", "(", "\n", "\"%s\\t%s\\t%s\\t%s\\t%s\\t%s\\n\"", "\n", "%", "(", "\n", "row", "[", "\"uid\"", "]", ",", "\n", "row", "[", "\"choice\"", "]", ",", "\n", "row", "[", "\"answer\"", "]", ",", "\n", "row", "[", "\"label\"", "]", ",", "\n", "row", "[", "\"premise\"", "]", ",", "\n", "hypothesis", ",", "\n", ")", "\n", ")", "\n", "", "else", ":", "\n", "                ", "raise", "ValueError", "(", "data_format", ")", "\n", "", "", "", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.exp_def.TaskDef.__init__": [[11, 44], ["dict.__init__", "repr", "locals().items", "locals"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "\n", "self", ",", "\n", "label_vocab", ",", "\n", "n_class", ",", "\n", "data_type", ",", "\n", "task_type", ",", "\n", "metric_meta", ",", "\n", "split_names", ",", "\n", "enable_san", ",", "\n", "dropout_p", ",", "\n", "loss", ",", "\n", "kd_loss", ",", "\n", "adv_loss", ",", "\n", ")", ":", "\n", "        ", "\"\"\"\n        :param label_vocab: map string label to numbers.\n            only valid for Classification task or ranking task.\n            For ranking task, better label should have large number\n        \"\"\"", "\n", "super", "(", ")", ".", "__init__", "(", "\n", "**", "{", "k", ":", "repr", "(", "v", ")", "for", "k", ",", "v", "in", "locals", "(", ")", ".", "items", "(", ")", "}", "\n", ")", "# ensure the class is JSON serializable", "\n", "self", ".", "label_vocab", "=", "label_vocab", "\n", "self", ".", "n_class", "=", "n_class", "\n", "self", ".", "data_type", "=", "data_type", "\n", "self", ".", "task_type", "=", "task_type", "\n", "self", ".", "metric_meta", "=", "metric_meta", "\n", "self", ".", "split_names", "=", "split_names", "\n", "self", ".", "enable_san", "=", "enable_san", "\n", "self", ".", "dropout_p", "=", "dropout_p", "\n", "self", ".", "loss", "=", "loss", "\n", "self", ".", "kd_loss", "=", "kd_loss", "\n", "self", ".", "adv_loss", "=", "adv_loss", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.exp_def.TaskDef.from_dict": [[45, 48], ["cls"], "methods", ["None"], ["", "@", "classmethod", "\n", "def", "from_dict", "(", "cls", ",", "dict_rep", ")", ":", "\n", "        ", "return", "cls", "(", "**", "dict_rep", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.exp_def.TaskDefs.__init__": [[51, 123], ["yaml.safe_load", "exp_def.TaskDefs._task_def_dic.items", "open", "tuple", "task_def.get", "data_utils.vocab.Vocabulary", "data_utils.vocab.Vocabulary.add"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.vocab.Vocabulary.add"], ["    ", "def", "__init__", "(", "self", ",", "task_def_path", ")", ":", "\n", "        ", "self", ".", "_task_def_dic", "=", "yaml", ".", "safe_load", "(", "open", "(", "task_def_path", ")", ")", "\n", "global_map", "=", "{", "}", "\n", "n_class_map", "=", "{", "}", "\n", "data_type_map", "=", "{", "}", "\n", "task_type_map", "=", "{", "}", "\n", "metric_meta_map", "=", "{", "}", "\n", "split_names_map", "=", "{", "}", "\n", "enable_san_map", "=", "{", "}", "\n", "dropout_p_map", "=", "{", "}", "\n", "loss_map", "=", "{", "}", "\n", "kd_loss_map", "=", "{", "}", "\n", "adv_loss_map", "=", "{", "}", "\n", "\n", "for", "task", ",", "task_def", "in", "self", ".", "_task_def_dic", ".", "items", "(", ")", ":", "\n", "            ", "assert", "\"_\"", "not", "in", "task", ",", "(", "\n", "\"task name should not contain '_', current task name: %s\"", "%", "task", "\n", ")", "\n", "n_class_map", "[", "task", "]", "=", "task_def", "[", "\"n_class\"", "]", "\n", "data_format", "=", "DataFormat", "[", "task_def", "[", "\"data_format\"", "]", "]", "\n", "data_type_map", "[", "task", "]", "=", "data_format", "\n", "task_type_map", "[", "task", "]", "=", "TaskType", "[", "task_def", "[", "\"task_type\"", "]", "]", "\n", "metric_meta_map", "[", "task", "]", "=", "tuple", "(", "\n", "Metric", "[", "metric_name", "]", "for", "metric_name", "in", "task_def", "[", "\"metric_meta\"", "]", "\n", ")", "\n", "split_names_map", "[", "task", "]", "=", "task_def", ".", "get", "(", "\n", "\"split_names\"", ",", "[", "\"train\"", ",", "\"dev\"", ",", "\"test\"", "]", "\n", ")", "\n", "enable_san_map", "[", "task", "]", "=", "task_def", "[", "\"enable_san\"", "]", "\n", "if", "\"labels\"", "in", "task_def", ":", "\n", "                ", "labels", "=", "task_def", "[", "\"labels\"", "]", "\n", "label_mapper", "=", "Vocabulary", "(", "True", ")", "\n", "for", "label", "in", "labels", ":", "\n", "                    ", "label_mapper", ".", "add", "(", "label", ")", "\n", "", "global_map", "[", "task", "]", "=", "label_mapper", "\n", "", "if", "\"dropout_p\"", "in", "task_def", ":", "\n", "                ", "dropout_p_map", "[", "task", "]", "=", "task_def", "[", "\"dropout_p\"", "]", "\n", "# loss map", "\n", "", "if", "\"loss\"", "in", "task_def", ":", "\n", "                ", "t_loss", "=", "task_def", "[", "\"loss\"", "]", "\n", "loss_crt", "=", "LossCriterion", "[", "t_loss", "]", "\n", "loss_map", "[", "task", "]", "=", "loss_crt", "\n", "", "else", ":", "\n", "                ", "loss_map", "[", "task", "]", "=", "None", "\n", "\n", "", "if", "\"kd_loss\"", "in", "task_def", ":", "\n", "                ", "t_loss", "=", "task_def", "[", "\"kd_loss\"", "]", "\n", "loss_crt", "=", "LossCriterion", "[", "t_loss", "]", "\n", "kd_loss_map", "[", "task", "]", "=", "loss_crt", "\n", "", "else", ":", "\n", "                ", "kd_loss_map", "[", "task", "]", "=", "None", "\n", "\n", "", "if", "\"adv_loss\"", "in", "task_def", ":", "\n", "                ", "t_loss", "=", "task_def", "[", "\"adv_loss\"", "]", "\n", "loss_crt", "=", "LossCriterion", "[", "t_loss", "]", "\n", "adv_loss_map", "[", "task", "]", "=", "loss_crt", "\n", "", "else", ":", "\n", "                ", "adv_loss_map", "[", "task", "]", "=", "None", "\n", "\n", "", "", "self", ".", "_global_map", "=", "global_map", "\n", "self", ".", "_n_class_map", "=", "n_class_map", "\n", "self", ".", "_data_type_map", "=", "data_type_map", "\n", "self", ".", "_task_type_map", "=", "task_type_map", "\n", "self", ".", "_metric_meta_map", "=", "metric_meta_map", "\n", "self", ".", "_split_names_map", "=", "split_names_map", "\n", "self", ".", "_enable_san_map", "=", "enable_san_map", "\n", "self", ".", "_dropout_p_map", "=", "dropout_p_map", "\n", "self", ".", "_loss_map", "=", "loss_map", "\n", "self", ".", "_kd_loss_map", "=", "kd_loss_map", "\n", "self", ".", "_adv_loss_map", "=", "adv_loss_map", "\n", "\n", "self", ".", "_task_def_dic", "=", "{", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.exp_def.TaskDefs.get_task_names": [[124, 126], ["list", "exp_def.TaskDefs._task_type_map.keys"], "methods", ["None"], ["", "def", "get_task_names", "(", "self", ")", ":", "\n", "        ", "return", "list", "(", "self", ".", "_task_type_map", ".", "keys", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.exp_def.TaskDefs.get_task_def": [[127, 144], ["exp_def.TaskDef", "exp_def.TaskDefs._global_map.get", "exp_def.TaskDefs._dropout_p_map.get"], "methods", ["None"], ["", "def", "get_task_def", "(", "self", ",", "task_name", ")", ":", "\n", "        ", "if", "task_name", "not", "in", "self", ".", "_task_def_dic", ":", "\n", "            ", "assert", "task_name", "in", "self", ".", "_task_type_map", "\n", "self", ".", "_task_def_dic", "[", "task_name", "]", "=", "TaskDef", "(", "\n", "self", ".", "_global_map", ".", "get", "(", "task_name", ",", "None", ")", ",", "\n", "self", ".", "_n_class_map", "[", "task_name", "]", ",", "\n", "self", ".", "_data_type_map", "[", "task_name", "]", ",", "\n", "self", ".", "_task_type_map", "[", "task_name", "]", ",", "\n", "self", ".", "_metric_meta_map", "[", "task_name", "]", ",", "\n", "self", ".", "_split_names_map", "[", "task_name", "]", ",", "\n", "self", ".", "_enable_san_map", "[", "task_name", "]", ",", "\n", "self", ".", "_dropout_p_map", ".", "get", "(", "task_name", ",", "None", ")", ",", "\n", "self", ".", "_loss_map", "[", "task_name", "]", ",", "\n", "self", ".", "_kd_loss_map", "[", "task_name", "]", ",", "\n", "self", ".", "_adv_loss_map", "[", "task_name", "]", ",", "\n", ")", "\n", "", "return", "self", ".", "_task_def_dic", "[", "task_name", "]", "\n", "", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_prepro.parse_args": [[15, 28], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.ner.prepro.parse_args"], ["def", "parse_args", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", "\n", "description", "=", "\"Preprocessing GLUE/SNLI/SciTail dataset.\"", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--seed\"", ",", "type", "=", "int", ",", "default", "=", "13", ")", "\n", "parser", ".", "add_argument", "(", "\"--root_dir\"", ",", "type", "=", "str", ",", "default", "=", "\"data\"", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--old_glue\"", ",", "\n", "action", "=", "\"store_true\"", ",", "\n", "help", "=", "\"whether it is old GLUE, refer official GLUE webpage for details\"", ",", "\n", ")", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "return", "args", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_prepro.main": [[30, 291], ["os.path.exists", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "load_mnli", "load_mnli", "load_mnli", "load_mnli", "load_mnli", "logger.info", "logger.info", "logger.info", "logger.info", "logger.info", "load_mrpc", "load_mrpc", "load_mrpc", "logger.info", "logger.info", "logger.info", "load_qnli", "load_qnli", "load_qnli", "logger.info", "logger.info", "logger.info", "load_qqp", "load_qqp", "load_qqp", "logger.info", "logger.info", "logger.info", "load_rte", "load_rte", "load_rte", "logger.info", "logger.info", "logger.info", "load_wnli", "load_wnli", "load_wnli", "logger.info", "logger.info", "logger.info", "load_sst", "load_sst", "load_sst", "logger.info", "logger.info", "logger.info", "load_cola", "load_cola", "load_cola", "logger.info", "logger.info", "logger.info", "load_stsb", "load_stsb", "load_stsb", "logger.info", "logger.info", "logger.info", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "random.seed", "load_qnnli", "load_qnnli", "load_qnnli", "logger.info", "logger.info", "logger.info", "os.path.isdir", "os.mkdir", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_mnli", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_mnli", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_mnli", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_mnli", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_mnli", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_mrpc", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_mrpc", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_mrpc", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_qnli", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_qnli", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_qnli", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_qqp", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_qqp", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_qqp", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_rte", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_rte", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_rte", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_wnli", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_wnli", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_wnli", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_sst", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_sst", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_sst", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_cola", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_cola", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_cola", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_stsb", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_stsb", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_stsb", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_qnnli", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_qnnli", "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_qnnli", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows"], ["", "def", "main", "(", "args", ")", ":", "\n", "    ", "is_old_glue", "=", "args", ".", "old_glue", "\n", "root", "=", "args", ".", "root_dir", "\n", "assert", "os", ".", "path", ".", "exists", "(", "root", ")", "\n", "\n", "######################################", "\n", "# GLUE tasks", "\n", "######################################", "\n", "multi_train_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"MNLI/train.tsv\"", ")", "\n", "multi_dev_matched_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"MNLI/dev_matched.tsv\"", ")", "\n", "multi_dev_mismatched_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"MNLI/dev_mismatched.tsv\"", ")", "\n", "multi_test_matched_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"MNLI/test_matched.tsv\"", ")", "\n", "multi_test_mismatched_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"MNLI/test_mismatched.tsv\"", ")", "\n", "\n", "mrpc_train_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"MRPC/train.tsv\"", ")", "\n", "mrpc_dev_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"MRPC/dev.tsv\"", ")", "\n", "mrpc_test_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"MRPC/test.tsv\"", ")", "\n", "\n", "qnli_train_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"QNLI/train.tsv\"", ")", "\n", "qnli_dev_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"QNLI/dev.tsv\"", ")", "\n", "qnli_test_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"QNLI/test.tsv\"", ")", "\n", "\n", "qqp_train_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"QQP/train.tsv\"", ")", "\n", "qqp_dev_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"QQP/dev.tsv\"", ")", "\n", "qqp_test_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"QQP/test.tsv\"", ")", "\n", "\n", "rte_train_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"RTE/train.tsv\"", ")", "\n", "rte_dev_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"RTE/dev.tsv\"", ")", "\n", "rte_test_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"RTE/test.tsv\"", ")", "\n", "\n", "wnli_train_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"WNLI/train.tsv\"", ")", "\n", "wnli_dev_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"WNLI/dev.tsv\"", ")", "\n", "wnli_test_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"WNLI/test.tsv\"", ")", "\n", "\n", "stsb_train_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"STS-B/train.tsv\"", ")", "\n", "stsb_dev_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"STS-B/dev.tsv\"", ")", "\n", "stsb_test_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"STS-B/test.tsv\"", ")", "\n", "\n", "sst_train_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"SST-2/train.tsv\"", ")", "\n", "sst_dev_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"SST-2/dev.tsv\"", ")", "\n", "sst_test_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"SST-2/test.tsv\"", ")", "\n", "\n", "cola_train_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"CoLA/train.tsv\"", ")", "\n", "cola_dev_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"CoLA/dev.tsv\"", ")", "\n", "cola_test_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"CoLA/test.tsv\"", ")", "\n", "\n", "######################################", "\n", "# Loading DATA", "\n", "######################################", "\n", "\n", "multinli_train_data", "=", "load_mnli", "(", "multi_train_path", ")", "\n", "multinli_matched_dev_data", "=", "load_mnli", "(", "multi_dev_matched_path", ")", "\n", "multinli_mismatched_dev_data", "=", "load_mnli", "(", "multi_dev_mismatched_path", ")", "\n", "multinli_matched_test_data", "=", "load_mnli", "(", "multi_test_matched_path", ",", "is_train", "=", "False", ")", "\n", "multinli_mismatched_test_data", "=", "load_mnli", "(", "\n", "multi_test_mismatched_path", ",", "is_train", "=", "False", "\n", ")", "\n", "\n", "logger", ".", "info", "(", "\"Loaded {} MNLI train samples\"", ".", "format", "(", "len", "(", "multinli_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\n", "\"Loaded {} MNLI matched dev samples\"", ".", "format", "(", "len", "(", "multinli_matched_dev_data", ")", ")", "\n", ")", "\n", "logger", ".", "info", "(", "\n", "\"Loaded {} MNLI mismatched dev samples\"", ".", "format", "(", "\n", "len", "(", "multinli_mismatched_dev_data", ")", "\n", ")", "\n", ")", "\n", "logger", ".", "info", "(", "\n", "\"Loaded {} MNLI matched test samples\"", ".", "format", "(", "len", "(", "multinli_matched_test_data", ")", ")", "\n", ")", "\n", "logger", ".", "info", "(", "\n", "\"Loaded {} MNLI mismatched test samples\"", ".", "format", "(", "\n", "len", "(", "multinli_mismatched_test_data", ")", "\n", ")", "\n", ")", "\n", "\n", "mrpc_train_data", "=", "load_mrpc", "(", "mrpc_train_path", ")", "\n", "mrpc_dev_data", "=", "load_mrpc", "(", "mrpc_dev_path", ")", "\n", "mrpc_test_data", "=", "load_mrpc", "(", "mrpc_test_path", ",", "is_train", "=", "False", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} MRPC train samples\"", ".", "format", "(", "len", "(", "mrpc_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} MRPC dev samples\"", ".", "format", "(", "len", "(", "mrpc_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} MRPC test samples\"", ".", "format", "(", "len", "(", "mrpc_test_data", ")", ")", ")", "\n", "\n", "qnli_train_data", "=", "load_qnli", "(", "qnli_train_path", ")", "\n", "qnli_dev_data", "=", "load_qnli", "(", "qnli_dev_path", ")", "\n", "qnli_test_data", "=", "load_qnli", "(", "qnli_test_path", ",", "is_train", "=", "False", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} QNLI train samples\"", ".", "format", "(", "len", "(", "qnli_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} QNLI dev samples\"", ".", "format", "(", "len", "(", "qnli_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} QNLI test samples\"", ".", "format", "(", "len", "(", "qnli_test_data", ")", ")", ")", "\n", "\n", "if", "is_old_glue", ":", "\n", "        ", "random", ".", "seed", "(", "args", ".", "seed", ")", "\n", "qnnli_train_data", "=", "load_qnnli", "(", "qnli_train_path", ")", "\n", "qnnli_dev_data", "=", "load_qnnli", "(", "qnli_dev_path", ")", "\n", "qnnli_test_data", "=", "load_qnnli", "(", "qnli_test_path", ",", "is_train", "=", "False", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} QNLI train samples\"", ".", "format", "(", "len", "(", "qnnli_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} QNLI dev samples\"", ".", "format", "(", "len", "(", "qnnli_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} QNLI test samples\"", ".", "format", "(", "len", "(", "qnnli_test_data", ")", ")", ")", "\n", "\n", "", "qqp_train_data", "=", "load_qqp", "(", "qqp_train_path", ")", "\n", "qqp_dev_data", "=", "load_qqp", "(", "qqp_dev_path", ")", "\n", "qqp_test_data", "=", "load_qqp", "(", "qqp_test_path", ",", "is_train", "=", "False", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} QQP train samples\"", ".", "format", "(", "len", "(", "qqp_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} QQP dev samples\"", ".", "format", "(", "len", "(", "qqp_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} QQP test samples\"", ".", "format", "(", "len", "(", "qqp_test_data", ")", ")", ")", "\n", "\n", "rte_train_data", "=", "load_rte", "(", "rte_train_path", ")", "\n", "rte_dev_data", "=", "load_rte", "(", "rte_dev_path", ")", "\n", "rte_test_data", "=", "load_rte", "(", "rte_test_path", ",", "is_train", "=", "False", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} RTE train samples\"", ".", "format", "(", "len", "(", "rte_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} RTE dev samples\"", ".", "format", "(", "len", "(", "rte_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} RTE test samples\"", ".", "format", "(", "len", "(", "rte_test_data", ")", ")", ")", "\n", "\n", "wnli_train_data", "=", "load_wnli", "(", "wnli_train_path", ")", "\n", "wnli_dev_data", "=", "load_wnli", "(", "wnli_dev_path", ")", "\n", "wnli_test_data", "=", "load_wnli", "(", "wnli_test_path", ",", "is_train", "=", "False", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} WNLI train samples\"", ".", "format", "(", "len", "(", "wnli_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} WNLI dev samples\"", ".", "format", "(", "len", "(", "wnli_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} WNLI test samples\"", ".", "format", "(", "len", "(", "wnli_test_data", ")", ")", ")", "\n", "\n", "sst_train_data", "=", "load_sst", "(", "sst_train_path", ")", "\n", "sst_dev_data", "=", "load_sst", "(", "sst_dev_path", ")", "\n", "sst_test_data", "=", "load_sst", "(", "sst_test_path", ",", "is_train", "=", "False", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} SST train samples\"", ".", "format", "(", "len", "(", "sst_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} SST dev samples\"", ".", "format", "(", "len", "(", "sst_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} SST test samples\"", ".", "format", "(", "len", "(", "sst_test_data", ")", ")", ")", "\n", "\n", "cola_train_data", "=", "load_cola", "(", "cola_train_path", ",", "header", "=", "False", ")", "\n", "cola_dev_data", "=", "load_cola", "(", "cola_dev_path", ",", "header", "=", "False", ")", "\n", "cola_test_data", "=", "load_cola", "(", "cola_test_path", ",", "is_train", "=", "False", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} COLA train samples\"", ".", "format", "(", "len", "(", "cola_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} COLA dev samples\"", ".", "format", "(", "len", "(", "cola_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} COLA test samples\"", ".", "format", "(", "len", "(", "cola_test_data", ")", ")", ")", "\n", "\n", "stsb_train_data", "=", "load_stsb", "(", "stsb_train_path", ")", "\n", "stsb_dev_data", "=", "load_stsb", "(", "stsb_dev_path", ")", "\n", "stsb_test_data", "=", "load_stsb", "(", "stsb_test_path", ",", "is_train", "=", "False", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} STS-B train samples\"", ".", "format", "(", "len", "(", "stsb_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} STS-B dev samples\"", ".", "format", "(", "len", "(", "stsb_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} STS-B test samples\"", ".", "format", "(", "len", "(", "stsb_test_data", ")", ")", ")", "\n", "\n", "canonical_data_suffix", "=", "\"canonical_data\"", "\n", "canonical_data_root", "=", "os", ".", "path", ".", "join", "(", "root", ",", "canonical_data_suffix", ")", "\n", "if", "not", "os", ".", "path", ".", "isdir", "(", "canonical_data_root", ")", ":", "\n", "        ", "os", ".", "mkdir", "(", "canonical_data_root", ")", "\n", "\n", "# BUILD MNLI", "\n", "", "multinli_train_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"mnli_train.tsv\"", ")", "\n", "multinli_matched_dev_fout", "=", "os", ".", "path", ".", "join", "(", "\n", "canonical_data_root", ",", "\"mnli_matched_dev.tsv\"", "\n", ")", "\n", "multinli_mismatched_dev_fout", "=", "os", ".", "path", ".", "join", "(", "\n", "canonical_data_root", ",", "\"mnli_mismatched_dev.tsv\"", "\n", ")", "\n", "multinli_matched_test_fout", "=", "os", ".", "path", ".", "join", "(", "\n", "canonical_data_root", ",", "\"mnli_matched_test.tsv\"", "\n", ")", "\n", "multinli_mismatched_test_fout", "=", "os", ".", "path", ".", "join", "(", "\n", "canonical_data_root", ",", "\"mnli_mismatched_test.tsv\"", "\n", ")", "\n", "dump_rows", "(", "\n", "multinli_train_data", ",", "multinli_train_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", "\n", ")", "\n", "dump_rows", "(", "\n", "multinli_matched_dev_data", ",", "\n", "multinli_matched_dev_fout", ",", "\n", "DataFormat", ".", "PremiseAndOneHypothesis", ",", "\n", ")", "\n", "dump_rows", "(", "\n", "multinli_mismatched_dev_data", ",", "\n", "multinli_mismatched_dev_fout", ",", "\n", "DataFormat", ".", "PremiseAndOneHypothesis", ",", "\n", ")", "\n", "dump_rows", "(", "\n", "multinli_matched_test_data", ",", "\n", "multinli_matched_test_fout", ",", "\n", "DataFormat", ".", "PremiseAndOneHypothesis", ",", "\n", ")", "\n", "dump_rows", "(", "\n", "multinli_mismatched_test_data", ",", "\n", "multinli_mismatched_test_fout", ",", "\n", "DataFormat", ".", "PremiseAndOneHypothesis", ",", "\n", ")", "\n", "logger", ".", "info", "(", "\"done with mnli\"", ")", "\n", "\n", "mrpc_train_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"mrpc_train.tsv\"", ")", "\n", "mrpc_dev_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"mrpc_dev.tsv\"", ")", "\n", "mrpc_test_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"mrpc_test.tsv\"", ")", "\n", "dump_rows", "(", "mrpc_train_data", ",", "mrpc_train_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "mrpc_dev_data", ",", "mrpc_dev_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "mrpc_test_data", ",", "mrpc_test_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "logger", ".", "info", "(", "\"done with mrpc\"", ")", "\n", "\n", "qnli_train_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"qnli_train.tsv\"", ")", "\n", "qnli_dev_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"qnli_dev.tsv\"", ")", "\n", "qnli_test_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"qnli_test.tsv\"", ")", "\n", "dump_rows", "(", "qnli_train_data", ",", "qnli_train_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "qnli_dev_data", ",", "qnli_dev_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "qnli_test_data", ",", "qnli_test_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "logger", ".", "info", "(", "\"done with qnli\"", ")", "\n", "\n", "if", "is_old_glue", ":", "\n", "        ", "qnli_train_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"qnnli_train.tsv\"", ")", "\n", "qnli_dev_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"qnnli_dev.tsv\"", ")", "\n", "qnli_test_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"qnnli_test.tsv\"", ")", "\n", "dump_rows", "(", "\n", "qnnli_train_data", ",", "qnli_train_fout", ",", "DataFormat", ".", "PremiseAndMultiHypothesis", "\n", ")", "\n", "dump_rows", "(", "qnnli_dev_data", ",", "qnli_dev_fout", ",", "DataFormat", ".", "PremiseAndMultiHypothesis", ")", "\n", "dump_rows", "(", "\n", "qnnli_train_data", ",", "qnli_test_fout", ",", "DataFormat", ".", "PremiseAndMultiHypothesis", "\n", ")", "\n", "logger", ".", "info", "(", "\"done with qnli\"", ")", "\n", "\n", "", "qqp_train_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"qqp_train.tsv\"", ")", "\n", "qqp_dev_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"qqp_dev.tsv\"", ")", "\n", "qqp_test_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"qqp_test.tsv\"", ")", "\n", "dump_rows", "(", "qqp_train_data", ",", "qqp_train_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "qqp_dev_data", ",", "qqp_dev_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "qqp_test_data", ",", "qqp_test_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "logger", ".", "info", "(", "\"done with qqp\"", ")", "\n", "\n", "rte_train_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"rte_train.tsv\"", ")", "\n", "rte_dev_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"rte_dev.tsv\"", ")", "\n", "rte_test_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"rte_test.tsv\"", ")", "\n", "dump_rows", "(", "rte_train_data", ",", "rte_train_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "rte_dev_data", ",", "rte_dev_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "rte_test_data", ",", "rte_test_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "logger", ".", "info", "(", "\"done with rte\"", ")", "\n", "\n", "wnli_train_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"wnli_train.tsv\"", ")", "\n", "wnli_dev_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"wnli_dev.tsv\"", ")", "\n", "wnli_test_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"wnli_test.tsv\"", ")", "\n", "dump_rows", "(", "wnli_train_data", ",", "wnli_train_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "wnli_dev_data", ",", "wnli_dev_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "wnli_test_data", ",", "wnli_test_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "logger", ".", "info", "(", "\"done with wnli\"", ")", "\n", "\n", "sst_train_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"sst_train.tsv\"", ")", "\n", "sst_dev_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"sst_dev.tsv\"", ")", "\n", "sst_test_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"sst_test.tsv\"", ")", "\n", "dump_rows", "(", "sst_train_data", ",", "sst_train_fout", ",", "DataFormat", ".", "PremiseOnly", ")", "\n", "dump_rows", "(", "sst_dev_data", ",", "sst_dev_fout", ",", "DataFormat", ".", "PremiseOnly", ")", "\n", "dump_rows", "(", "sst_test_data", ",", "sst_test_fout", ",", "DataFormat", ".", "PremiseOnly", ")", "\n", "logger", ".", "info", "(", "\"done with sst\"", ")", "\n", "\n", "cola_train_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"cola_train.tsv\"", ")", "\n", "cola_dev_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"cola_dev.tsv\"", ")", "\n", "cola_test_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"cola_test.tsv\"", ")", "\n", "dump_rows", "(", "cola_train_data", ",", "cola_train_fout", ",", "DataFormat", ".", "PremiseOnly", ")", "\n", "dump_rows", "(", "cola_dev_data", ",", "cola_dev_fout", ",", "DataFormat", ".", "PremiseOnly", ")", "\n", "dump_rows", "(", "cola_test_data", ",", "cola_test_fout", ",", "DataFormat", ".", "PremiseOnly", ")", "\n", "logger", ".", "info", "(", "\"done with cola\"", ")", "\n", "\n", "stsb_train_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"stsb_train.tsv\"", ")", "\n", "stsb_dev_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"stsb_dev.tsv\"", ")", "\n", "stsb_test_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"stsb_test.tsv\"", ")", "\n", "dump_rows", "(", "stsb_train_data", ",", "stsb_train_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "stsb_dev_data", ",", "stsb_dev_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "stsb_test_data", ",", "stsb_test_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "logger", ".", "info", "(", "\"done with stsb\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_scitail": [[6, 25], ["open", "line.strip().split", "rows.append", "len", "str", "line.strip"], "function", ["None"], ["def", "load_scitail", "(", "file", ")", ":", "\n", "    ", "\"\"\"Loading data of scitail\"\"\"", "\n", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "blocks", "=", "line", ".", "strip", "(", ")", ".", "split", "(", "\"\\t\"", ")", "\n", "assert", "len", "(", "blocks", ")", ">", "2", "\n", "if", "blocks", "[", "0", "]", "==", "\"-\"", ":", "\n", "                ", "continue", "\n", "", "sample", "=", "{", "\n", "\"uid\"", ":", "str", "(", "cnt", ")", ",", "\n", "\"premise\"", ":", "blocks", "[", "0", "]", ",", "\n", "\"hypothesis\"", ":", "blocks", "[", "1", "]", ",", "\n", "\"label\"", ":", "blocks", "[", "2", "]", ",", "\n", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "cnt", "+=", "1", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_snli": [[27, 53], ["open", "line.strip().split", "rows.append", "len", "pdb.set_trace", "line.strip"], "function", ["None"], ["", "def", "load_snli", "(", "file", ",", "header", "=", "True", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "if", "header", ":", "\n", "                ", "header", "=", "False", "\n", "continue", "\n", "", "blocks", "=", "line", ".", "strip", "(", ")", ".", "split", "(", "\"\\t\"", ")", "\n", "assert", "len", "(", "blocks", ")", ">", "10", "\n", "if", "blocks", "[", "-", "1", "]", "==", "\"-\"", ":", "\n", "                ", "continue", "\n", "", "lab", "=", "blocks", "[", "-", "1", "]", "\n", "if", "lab", "is", "None", ":", "\n", "                ", "import", "pdb", "\n", "\n", "pdb", ".", "set_trace", "(", ")", "\n", "", "sample", "=", "{", "\n", "\"uid\"", ":", "blocks", "[", "0", "]", ",", "\n", "\"premise\"", ":", "blocks", "[", "7", "]", ",", "\n", "\"hypothesis\"", ":", "blocks", "[", "8", "]", ",", "\n", "\"label\"", ":", "lab", ",", "\n", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "cnt", "+=", "1", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_mnli": [[55, 83], ["open", "line.strip().split", "rows.append", "len", "pdb.set_trace", "line.strip"], "function", ["None"], ["", "def", "load_mnli", "(", "file", ",", "header", "=", "True", ",", "multi_snli", "=", "False", ",", "is_train", "=", "True", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "if", "header", ":", "\n", "                ", "header", "=", "False", "\n", "continue", "\n", "", "blocks", "=", "line", ".", "strip", "(", ")", ".", "split", "(", "\"\\t\"", ")", "\n", "assert", "len", "(", "blocks", ")", ">", "9", "\n", "if", "blocks", "[", "-", "1", "]", "==", "\"-\"", ":", "\n", "                ", "continue", "\n", "", "lab", "=", "\"contradiction\"", "\n", "if", "is_train", ":", "\n", "                ", "lab", "=", "blocks", "[", "-", "1", "]", "\n", "", "if", "lab", "is", "None", ":", "\n", "                ", "import", "pdb", "\n", "\n", "pdb", ".", "set_trace", "(", ")", "\n", "", "sample", "=", "{", "\n", "\"uid\"", ":", "blocks", "[", "0", "]", ",", "\n", "\"premise\"", ":", "blocks", "[", "8", "]", ",", "\n", "\"hypothesis\"", ":", "blocks", "[", "9", "]", ",", "\n", "\"label\"", ":", "lab", ",", "\n", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "cnt", "+=", "1", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_mrpc": [[85, 107], ["open", "line.strip().split", "rows.append", "len", "int", "line.strip"], "function", ["None"], ["", "def", "load_mrpc", "(", "file", ",", "header", "=", "True", ",", "is_train", "=", "True", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "if", "header", ":", "\n", "                ", "header", "=", "False", "\n", "continue", "\n", "", "blocks", "=", "line", ".", "strip", "(", ")", ".", "split", "(", "\"\\t\"", ")", "\n", "assert", "len", "(", "blocks", ")", ">", "4", "\n", "lab", "=", "0", "\n", "if", "is_train", ":", "\n", "                ", "lab", "=", "int", "(", "blocks", "[", "0", "]", ")", "\n", "", "sample", "=", "{", "\n", "\"uid\"", ":", "cnt", ",", "\n", "\"premise\"", ":", "blocks", "[", "-", "2", "]", ",", "\n", "\"hypothesis\"", ":", "blocks", "[", "-", "1", "]", ",", "\n", "\"label\"", ":", "lab", ",", "\n", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "cnt", "+=", "1", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_qnli": [[109, 136], ["open", "line.strip().split", "rows.append", "len", "pdb.set_trace", "line.strip"], "function", ["None"], ["", "def", "load_qnli", "(", "file", ",", "header", "=", "True", ",", "is_train", "=", "True", ")", ":", "\n", "    ", "\"\"\"QNLI for classification\"\"\"", "\n", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "if", "header", ":", "\n", "                ", "header", "=", "False", "\n", "continue", "\n", "", "blocks", "=", "line", ".", "strip", "(", ")", ".", "split", "(", "\"\\t\"", ")", "\n", "assert", "len", "(", "blocks", ")", ">", "2", "\n", "lab", "=", "\"not_entailment\"", "\n", "if", "is_train", ":", "\n", "                ", "lab", "=", "blocks", "[", "-", "1", "]", "\n", "", "if", "lab", "is", "None", ":", "\n", "                ", "import", "pdb", "\n", "\n", "pdb", ".", "set_trace", "(", ")", "\n", "", "sample", "=", "{", "\n", "\"uid\"", ":", "blocks", "[", "0", "]", ",", "\n", "\"premise\"", ":", "blocks", "[", "1", "]", ",", "\n", "\"hypothesis\"", ":", "blocks", "[", "2", "]", ",", "\n", "\"label\"", ":", "lab", ",", "\n", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "cnt", "+=", "1", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_qqp": [[138, 172], ["open", "line.strip().split", "rows.append", "int", "line.strip", "len", "len", "int"], "function", ["None"], ["", "def", "load_qqp", "(", "file", ",", "header", "=", "True", ",", "is_train", "=", "True", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "skipped", "=", "0", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "if", "header", ":", "\n", "                ", "header", "=", "False", "\n", "continue", "\n", "", "blocks", "=", "line", ".", "strip", "(", ")", ".", "split", "(", "\"\\t\"", ")", "\n", "if", "is_train", "and", "len", "(", "blocks", ")", "<", "6", ":", "\n", "                ", "skipped", "+=", "1", "\n", "continue", "\n", "", "if", "not", "is_train", ":", "\n", "                ", "assert", "len", "(", "blocks", ")", "==", "3", "\n", "", "lab", "=", "0", "\n", "if", "is_train", ":", "\n", "                ", "lab", "=", "int", "(", "blocks", "[", "-", "1", "]", ")", "\n", "sample", "=", "{", "\n", "\"uid\"", ":", "cnt", ",", "\n", "\"premise\"", ":", "blocks", "[", "-", "3", "]", ",", "\n", "\"hypothesis\"", ":", "blocks", "[", "-", "2", "]", ",", "\n", "\"label\"", ":", "lab", ",", "\n", "}", "\n", "", "else", ":", "\n", "                ", "sample", "=", "{", "\n", "\"uid\"", ":", "int", "(", "blocks", "[", "0", "]", ")", ",", "\n", "\"premise\"", ":", "blocks", "[", "-", "2", "]", ",", "\n", "\"hypothesis\"", ":", "blocks", "[", "-", "1", "]", ",", "\n", "\"label\"", ":", "lab", ",", "\n", "}", "\n", "", "rows", ".", "append", "(", "sample", ")", "\n", "cnt", "+=", "1", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_rte": [[174, 206], ["open", "line.strip().split", "rows.append", "line.strip", "len", "len", "int", "int"], "function", ["None"], ["", "def", "load_rte", "(", "file", ",", "header", "=", "True", ",", "is_train", "=", "True", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "if", "header", ":", "\n", "                ", "header", "=", "False", "\n", "continue", "\n", "", "blocks", "=", "line", ".", "strip", "(", ")", ".", "split", "(", "\"\\t\"", ")", "\n", "if", "is_train", "and", "len", "(", "blocks", ")", "<", "4", ":", "\n", "                ", "continue", "\n", "", "if", "not", "is_train", ":", "\n", "                ", "assert", "len", "(", "blocks", ")", "==", "3", "\n", "", "lab", "=", "\"not_entailment\"", "\n", "if", "is_train", ":", "\n", "                ", "lab", "=", "blocks", "[", "-", "1", "]", "\n", "sample", "=", "{", "\n", "\"uid\"", ":", "int", "(", "blocks", "[", "0", "]", ")", ",", "\n", "\"premise\"", ":", "blocks", "[", "-", "3", "]", ",", "\n", "\"hypothesis\"", ":", "blocks", "[", "-", "2", "]", ",", "\n", "\"label\"", ":", "lab", ",", "\n", "}", "\n", "", "else", ":", "\n", "                ", "sample", "=", "{", "\n", "\"uid\"", ":", "int", "(", "blocks", "[", "0", "]", ")", ",", "\n", "\"premise\"", ":", "blocks", "[", "-", "2", "]", ",", "\n", "\"hypothesis\"", ":", "blocks", "[", "-", "1", "]", ",", "\n", "\"label\"", ":", "lab", ",", "\n", "}", "\n", "", "rows", ".", "append", "(", "sample", ")", "\n", "cnt", "+=", "1", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_wnli": [[208, 240], ["open", "line.strip().split", "rows.append", "int", "line.strip", "len", "len"], "function", ["None"], ["", "def", "load_wnli", "(", "file", ",", "header", "=", "True", ",", "is_train", "=", "True", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "if", "header", ":", "\n", "                ", "header", "=", "False", "\n", "continue", "\n", "", "blocks", "=", "line", ".", "strip", "(", ")", ".", "split", "(", "\"\\t\"", ")", "\n", "if", "is_train", "and", "len", "(", "blocks", ")", "<", "4", ":", "\n", "                ", "continue", "\n", "", "if", "not", "is_train", ":", "\n", "                ", "assert", "len", "(", "blocks", ")", "==", "3", "\n", "", "lab", "=", "0", "\n", "if", "is_train", ":", "\n", "                ", "lab", "=", "int", "(", "blocks", "[", "-", "1", "]", ")", "\n", "sample", "=", "{", "\n", "\"uid\"", ":", "cnt", ",", "\n", "\"premise\"", ":", "blocks", "[", "-", "3", "]", ",", "\n", "\"hypothesis\"", ":", "blocks", "[", "-", "2", "]", ",", "\n", "\"label\"", ":", "lab", ",", "\n", "}", "\n", "", "else", ":", "\n", "                ", "sample", "=", "{", "\n", "\"uid\"", ":", "cnt", ",", "\n", "\"premise\"", ":", "blocks", "[", "-", "2", "]", ",", "\n", "\"hypothesis\"", ":", "blocks", "[", "-", "1", "]", ",", "\n", "\"label\"", ":", "lab", ",", "\n", "}", "\n", "", "rows", ".", "append", "(", "sample", ")", "\n", "cnt", "+=", "1", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_diag": [[242, 261], ["open", "line.strip().split", "rows.append", "len", "line.strip"], "function", ["None"], ["", "def", "load_diag", "(", "file", ",", "header", "=", "True", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "if", "header", ":", "\n", "                ", "header", "=", "False", "\n", "continue", "\n", "", "blocks", "=", "line", ".", "strip", "(", ")", ".", "split", "(", "\"\\t\"", ")", "\n", "assert", "len", "(", "blocks", ")", ">", "3", "\n", "sample", "=", "{", "\n", "\"uid\"", ":", "cnt", ",", "\n", "\"premise\"", ":", "blocks", "[", "-", "3", "]", ",", "\n", "\"hypothesis\"", ":", "blocks", "[", "-", "2", "]", ",", "\n", "\"label\"", ":", "blocks", "[", "-", "1", "]", ",", "\n", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "cnt", "+=", "1", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_sst": [[263, 284], ["open", "line.strip().split", "rows.append", "int", "line.strip", "len", "int"], "function", ["None"], ["", "def", "load_sst", "(", "file", ",", "header", "=", "True", ",", "is_train", "=", "True", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "if", "header", ":", "\n", "                ", "header", "=", "False", "\n", "continue", "\n", "", "blocks", "=", "line", ".", "strip", "(", ")", ".", "split", "(", "\"\\t\"", ")", "\n", "if", "is_train", "and", "len", "(", "blocks", ")", "<", "2", ":", "\n", "                ", "continue", "\n", "", "lab", "=", "0", "\n", "if", "is_train", ":", "\n", "                ", "lab", "=", "int", "(", "blocks", "[", "-", "1", "]", ")", "\n", "sample", "=", "{", "\"uid\"", ":", "cnt", ",", "\"premise\"", ":", "blocks", "[", "0", "]", ",", "\"label\"", ":", "lab", "}", "\n", "", "else", ":", "\n", "                ", "sample", "=", "{", "\"uid\"", ":", "int", "(", "blocks", "[", "0", "]", ")", ",", "\"premise\"", ":", "blocks", "[", "1", "]", ",", "\"label\"", ":", "lab", "}", "\n", "\n", "", "cnt", "+=", "1", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_cola": [[286, 306], ["open", "line.strip().split", "rows.append", "int", "line.strip", "len"], "function", ["None"], ["", "def", "load_cola", "(", "file", ",", "header", "=", "True", ",", "is_train", "=", "True", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "if", "header", ":", "\n", "                ", "header", "=", "False", "\n", "continue", "\n", "", "blocks", "=", "line", ".", "strip", "(", ")", ".", "split", "(", "\"\\t\"", ")", "\n", "if", "is_train", "and", "len", "(", "blocks", ")", "<", "2", ":", "\n", "                ", "continue", "\n", "", "lab", "=", "0", "\n", "if", "is_train", ":", "\n", "                ", "lab", "=", "int", "(", "blocks", "[", "1", "]", ")", "\n", "sample", "=", "{", "\"uid\"", ":", "cnt", ",", "\"premise\"", ":", "blocks", "[", "-", "1", "]", ",", "\"label\"", ":", "lab", "}", "\n", "", "else", ":", "\n", "                ", "sample", "=", "{", "\"uid\"", ":", "cnt", ",", "\"premise\"", ":", "blocks", "[", "-", "1", "]", ",", "\"label\"", ":", "lab", "}", "\n", "", "rows", ".", "append", "(", "sample", ")", "\n", "cnt", "+=", "1", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_stsb": [[308, 337], ["open", "line.strip().split", "rows.append", "len", "line.strip"], "function", ["None"], ["", "def", "load_stsb", "(", "file", ",", "header", "=", "True", ",", "is_train", "=", "True", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "if", "header", ":", "\n", "                ", "header", "=", "False", "\n", "continue", "\n", "", "blocks", "=", "line", ".", "strip", "(", ")", ".", "split", "(", "\"\\t\"", ")", "\n", "assert", "len", "(", "blocks", ")", ">", "8", "\n", "score", "=", "\"0.0\"", "\n", "if", "is_train", ":", "\n", "                ", "score", "=", "blocks", "[", "-", "1", "]", "\n", "sample", "=", "{", "\n", "\"uid\"", ":", "cnt", ",", "\n", "\"premise\"", ":", "blocks", "[", "-", "3", "]", ",", "\n", "\"hypothesis\"", ":", "blocks", "[", "-", "2", "]", ",", "\n", "\"label\"", ":", "score", ",", "\n", "}", "\n", "", "else", ":", "\n", "                ", "sample", "=", "{", "\n", "\"uid\"", ":", "cnt", ",", "\n", "\"premise\"", ":", "blocks", "[", "-", "2", "]", ",", "\n", "\"hypothesis\"", ":", "blocks", "[", "-", "1", "]", ",", "\n", "\"label\"", ":", "score", ",", "\n", "}", "\n", "", "rows", ".", "append", "(", "sample", ")", "\n", "cnt", "+=", "1", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.load_qnnli": [[339, 384], ["open", "f.readlines", "range", "len", "lines[].strip().split", "lines[].strip().split", "rows.append", "len", "random.shuffle", "lines[].strip", "lines[].strip", "len", "len"], "function", ["None"], ["", "def", "load_qnnli", "(", "file", ",", "header", "=", "True", ",", "is_train", "=", "True", ")", ":", "\n", "    ", "\"\"\"QNLI for ranking\"\"\"", "\n", "rows", "=", "[", "]", "\n", "mis_matched_cnt", "=", "0", "\n", "cnt", "=", "0", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "lines", "=", "f", ".", "readlines", "(", ")", "\n", "if", "header", ":", "\n", "            ", "lines", "=", "lines", "[", "1", ":", "]", "\n", "\n", "", "assert", "len", "(", "lines", ")", "%", "2", "==", "0", "\n", "for", "idx", "in", "range", "(", "0", ",", "len", "(", "lines", ")", ",", "2", ")", ":", "\n", "            ", "block1", "=", "lines", "[", "idx", "]", ".", "strip", "(", ")", ".", "split", "(", "\"\\t\"", ")", "\n", "block2", "=", "lines", "[", "idx", "+", "1", "]", ".", "strip", "(", ")", ".", "split", "(", "\"\\t\"", ")", "\n", "# train shuffle", "\n", "assert", "len", "(", "block1", ")", ">", "2", "and", "len", "(", "block2", ")", ">", "2", "\n", "if", "is_train", "and", "block1", "[", "1", "]", "!=", "block2", "[", "1", "]", ":", "\n", "                ", "mis_matched_cnt", "+=", "1", "\n", "continue", "\n", "", "assert", "block1", "[", "1", "]", "==", "block2", "[", "1", "]", "\n", "lab1", ",", "lab2", "=", "\"entailment\"", ",", "\"entailment\"", "\n", "if", "is_train", ":", "\n", "                ", "blocks", "=", "[", "block1", ",", "block2", "]", "\n", "shuffle", "(", "blocks", ")", "\n", "block1", "=", "blocks", "[", "0", "]", "\n", "block2", "=", "blocks", "[", "1", "]", "\n", "lab1", "=", "block1", "[", "-", "1", "]", "\n", "lab2", "=", "block2", "[", "-", "1", "]", "\n", "if", "lab1", "==", "lab2", ":", "\n", "                    ", "mis_matched_cnt", "+=", "1", "\n", "continue", "\n", "", "", "assert", "\",\"", "not", "in", "lab1", "\n", "assert", "\",\"", "not", "in", "lab2", "\n", "assert", "\",\"", "not", "in", "block1", "[", "0", "]", "\n", "assert", "\",\"", "not", "in", "block2", "[", "0", "]", "\n", "sample", "=", "{", "\n", "\"uid\"", ":", "cnt", ",", "\n", "\"ruid\"", ":", "\"%s,%s\"", "%", "(", "block1", "[", "0", "]", ",", "block2", "[", "0", "]", ")", ",", "\n", "\"premise\"", ":", "block1", "[", "1", "]", ",", "\n", "\"hypothesis\"", ":", "[", "block1", "[", "2", "]", ",", "block2", "[", "2", "]", "]", ",", "\n", "\"label\"", ":", "\"%s,%s\"", "%", "(", "lab1", ",", "lab2", ")", ",", "\n", "}", "\n", "cnt", "+=", "1", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.glue.glue_utils.submit": [[386, 401], ["open", "writer.write", "sorted", "len", "len", "int", "enumerate", "writer.write", "writer.write", "type"], "function", ["None"], ["", "def", "submit", "(", "path", ",", "data", ",", "label_dict", "=", "None", ")", ":", "\n", "    ", "header", "=", "\"index\\tprediction\"", "\n", "with", "open", "(", "path", ",", "\"w\"", ")", "as", "writer", ":", "\n", "        ", "predictions", ",", "uids", "=", "data", "[", "\"predictions\"", "]", ",", "data", "[", "\"uids\"", "]", "\n", "writer", ".", "write", "(", "\"{}\\n\"", ".", "format", "(", "header", ")", ")", "\n", "assert", "len", "(", "predictions", ")", "==", "len", "(", "uids", ")", "\n", "# sort label", "\n", "paired", "=", "[", "(", "int", "(", "uid", ")", ",", "predictions", "[", "idx", "]", ")", "for", "idx", ",", "uid", "in", "enumerate", "(", "uids", ")", "]", "\n", "paired", "=", "sorted", "(", "paired", ",", "key", "=", "lambda", "item", ":", "item", "[", "0", "]", ")", "\n", "for", "uid", ",", "pred", "in", "paired", ":", "\n", "            ", "if", "label_dict", "is", "None", ":", "\n", "                ", "writer", ".", "write", "(", "\"{}\\t{}\\n\"", ".", "format", "(", "uid", ",", "pred", ")", ")", "\n", "", "else", ":", "\n", "                ", "assert", "type", "(", "pred", ")", "is", "int", "\n", "writer", ".", "write", "(", "\"{}\\t{}\\n\"", ".", "format", "(", "uid", ",", "label_dict", "[", "pred", "]", ")", ")", "\n", "", "", "", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_fairseq.parse_args": [[9, 15], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.ner.prepro.parse_args"], ["def", "parse_args", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n", "parser", ".", "add_argument", "(", "'--data_dir'", ",", "type", "=", "str", ",", "default", "=", "'data directory'", ")", "\n", "parser", ".", "add_argument", "(", "'--task'", ",", "type", "=", "str", ",", "default", "=", "'CB'", ")", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "return", "args", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_fairseq.main": [[16, 52], ["args.task.lower", "laod_function", "os.path.splitext", "os.path.join", "os.path.join", "len", "experiments.superglue.superglue_utils.save", "experiments.superglue.superglue_utils.save", "experiments.superglue.superglue_utils.save", "os.path.join", "len", "str", "experiments.superglue.superglue_utils.save", "experiments.superglue.superglue_utils.save", "experiments.superglue.superglue_utils.save", "str"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save"], ["", "def", "main", "(", "args", ")", ":", "\n", "    ", "task", "=", "args", ".", "task", ".", "lower", "(", ")", "\n", "assert", "task", "in", "TASKS", ",", "\"don't support {}\"", ".", "format", "(", "task", ")", "\n", "files", "=", "TASKS", "[", "task", "]", "\n", "laod_function", "=", "LOAD_FUNCS", "[", "task", "]", "\n", "for", "file", "in", "files", ":", "\n", "        ", "data", "=", "laod_function", "(", "os", ".", "path", ".", "join", "(", "args", ".", "data_dir", ",", "file", ")", ")", "\n", "assert", "len", "(", "data", ")", ">", "0", "\n", "filename", ",", "extension", "=", "os", ".", "path", ".", "splitext", "(", "file", ")", "\n", "fin", "=", "os", ".", "path", ".", "join", "(", "args", ".", "data_dir", ",", "file", ")", "\n", "prefix", "=", "os", ".", "path", ".", "join", "(", "args", ".", "data_dir", ",", "\"{}\"", ".", "format", "(", "filename", ")", ")", "\n", "\n", "columns", "=", "len", "(", "data", "[", "0", "]", ")", "\n", "labels", "=", "[", "str", "(", "sample", "[", "\"label\"", "]", ")", "for", "sample", "in", "data", "]", "\n", "input0", "=", "[", "sample", "[", "\"premise\"", "]", "for", "sample", "in", "data", "]", "\n", "input1", "=", "[", "sample", "[", "\"hypothesis\"", "]", "for", "sample", "in", "data", "]", "if", "columns", ">", "3", "else", "None", "\n", "input2", "=", "[", "sample", "[", "\"hypothesis_extra\"", "]", "for", "sample", "in", "data", "]", "if", "\"hypothesis_extra\"", "in", "data", "[", "0", "]", "else", "None", "\n", "has_answer", "=", "\"answer\"", "in", "data", "[", "0", "]", "\n", "answers", "=", "[", "sample", "[", "\"answer\"", "]", "for", "sample", "in", "data", "]", "if", "has_answer", "else", "None", "\n", "\n", "flabel", "=", "\"{}.label\"", ".", "format", "(", "prefix", ")", "\n", "save", "(", "labels", ",", "flabel", ")", "\n", "finput0", "=", "\"{}.raw.input0\"", ".", "format", "(", "prefix", ")", "\n", "save", "(", "input0", ",", "finput0", ")", "\n", "if", "input1", ":", "\n", "            ", "finput1", "=", "\"{}.raw.input1\"", ".", "format", "(", "prefix", ")", "\n", "save", "(", "input1", ",", "finput1", ")", "\n", "", "if", "input2", ":", "\n", "            ", "finput2", "=", "\"{}.raw.input2\"", ".", "format", "(", "prefix", ")", "\n", "save", "(", "input2", ",", "finput2", ")", "\n", "", "if", "answers", ":", "\n", "            ", "fanswers", "=", "\"{}.answer\"", ".", "format", "(", "prefix", ")", "\n", "save", "(", "answers", ",", "fanswers", ")", "\n", "", "uids", "=", "[", "str", "(", "sample", "[", "\"uid\"", "]", ")", "for", "sample", "in", "data", "]", "\n", "fuid", "=", "\"{}.id\"", ".", "format", "(", "prefix", ")", "\n", "save", "(", "uids", ",", "fuid", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_prepro.parse_args": [[15, 23], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.ner.prepro.parse_args"], ["def", "parse_args", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", "\n", "description", "=", "\"Preprocessing SuperGLUE dataset.\"", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--seed\"", ",", "type", "=", "int", ",", "default", "=", "13", ")", "\n", "parser", ".", "add_argument", "(", "\"--root_dir\"", ",", "type", "=", "str", ",", "default", "=", "\"data\"", ")", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "return", "args", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_prepro.main": [[25, 155], ["os.path.exists", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "load_cb", "load_cb", "load_cb", "logger.info", "logger.info", "logger.info", "load_boolq", "load_boolq", "load_boolq", "logger.info", "logger.info", "logger.info", "load_copa_mtdnn", "load_copa_mtdnn", "load_copa_mtdnn", "logger.info", "logger.info", "logger.info", "load_record_mtdnn", "load_record_mtdnn", "load_record_mtdnn", "logger.info", "logger.info", "logger.info", "load_wic_mtdnn", "load_wic_mtdnn", "load_wic_mtdnn", "logger.info", "logger.info", "logger.info", "load_multirc_mtdnn", "load_multirc_mtdnn", "load_multirc_mtdnn", "logger.info", "logger.info", "logger.info", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.isdir", "os.mkdir", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_cb", "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_cb", "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_cb", "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_boolq", "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_boolq", "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_boolq", "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_copa_mtdnn", "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_copa_mtdnn", "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_copa_mtdnn", "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_record_mtdnn", "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_record_mtdnn", "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_record_mtdnn", "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_wic_mtdnn", "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_wic_mtdnn", "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_wic_mtdnn", "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_multirc_mtdnn", "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_multirc_mtdnn", "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_multirc_mtdnn", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows"], ["", "def", "main", "(", "args", ")", ":", "\n", "    ", "root", "=", "args", ".", "root_dir", "\n", "assert", "os", ".", "path", ".", "exists", "(", "root", ")", "\n", "\n", "######################################", "\n", "# SuperGLUE tasks", "\n", "######################################", "\n", "\n", "cb_train_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"CB/train.jsonl\"", ")", "\n", "cb_dev_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"CB/val.jsonl\"", ")", "\n", "cb_test_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"CB/test.jsonl\"", ")", "\n", "\n", "boolq_train_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"BoolQ/train.jsonl\"", ")", "\n", "boolq_dev_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"BoolQ/val.jsonl\"", ")", "\n", "boolq_test_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"BoolQ/test.jsonl\"", ")", "\n", "\n", "copa_train_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"COPA/train.jsonl\"", ")", "\n", "copa_dev_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"COPA/val.jsonl\"", ")", "\n", "copa_test_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"COPA/test.jsonl\"", ")", "\n", "\n", "record_train_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"ReCoRD/train.jsonl\"", ")", "\n", "record_dev_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"ReCoRD/val.jsonl\"", ")", "\n", "record_test_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"ReCoRD/test.jsonl\"", ")", "\n", "\n", "wic_train_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"WiC/train.jsonl\"", ")", "\n", "wic_dev_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"WiC/val.jsonl\"", ")", "\n", "wic_test_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"WiC/test.jsonl\"", ")", "\n", "\n", "multirc_train_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"MultiRC/train.jsonl\"", ")", "\n", "multirc_dev_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"MultiRC/val.jsonl\"", ")", "\n", "multirc_test_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"MultiRC/test.jsonl\"", ")", "\n", "\n", "######################################", "\n", "# Loading DATA", "\n", "######################################", "\n", "\n", "cb_train_data", "=", "load_cb", "(", "cb_train_path", ")", "\n", "cb_dev_data", "=", "load_cb", "(", "cb_dev_path", ")", "\n", "cb_test_data", "=", "load_cb", "(", "cb_test_path", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} CB train samples\"", ".", "format", "(", "len", "(", "cb_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} CB dev samples\"", ".", "format", "(", "len", "(", "cb_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} CB test samples\"", ".", "format", "(", "len", "(", "cb_test_data", ")", ")", ")", "\n", "\n", "boolq_train_data", "=", "load_boolq", "(", "boolq_train_path", ")", "\n", "boolq_dev_data", "=", "load_boolq", "(", "boolq_dev_path", ")", "\n", "boolq_test_data", "=", "load_boolq", "(", "boolq_test_path", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} BoolQ train samples\"", ".", "format", "(", "len", "(", "boolq_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} BoolQ dev samples\"", ".", "format", "(", "len", "(", "boolq_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} BoolQ test samples\"", ".", "format", "(", "len", "(", "boolq_test_data", ")", ")", ")", "\n", "\n", "copa_train_data", "=", "load_copa_mtdnn", "(", "copa_train_path", ")", "\n", "copa_dev_data", "=", "load_copa_mtdnn", "(", "copa_dev_path", ")", "\n", "copa_test_data", "=", "load_copa_mtdnn", "(", "copa_test_path", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} COPA train samples\"", ".", "format", "(", "len", "(", "copa_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} COPA dev samples\"", ".", "format", "(", "len", "(", "copa_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} COPA test samples\"", ".", "format", "(", "len", "(", "copa_test_data", ")", ")", ")", "\n", "\n", "record_train_data", "=", "load_record_mtdnn", "(", "record_train_path", ")", "\n", "record_dev_data", "=", "load_record_mtdnn", "(", "record_dev_path", ")", "\n", "record_test_data", "=", "load_record_mtdnn", "(", "record_test_path", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} Record train samples\"", ".", "format", "(", "len", "(", "record_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} Record dev samples\"", ".", "format", "(", "len", "(", "record_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} Record test samples\"", ".", "format", "(", "len", "(", "record_test_data", ")", ")", ")", "\n", "\n", "wic_train_data", "=", "load_wic_mtdnn", "(", "wic_train_path", ")", "\n", "wic_dev_data", "=", "load_wic_mtdnn", "(", "wic_dev_path", ")", "\n", "wic_test_data", "=", "load_wic_mtdnn", "(", "wic_test_path", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} WiC train samples\"", ".", "format", "(", "len", "(", "wic_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} WiC dev samples\"", ".", "format", "(", "len", "(", "wic_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} WiC test samples\"", ".", "format", "(", "len", "(", "wic_test_data", ")", ")", ")", "\n", "\n", "multirc_train_data", "=", "load_multirc_mtdnn", "(", "multirc_train_path", ")", "\n", "multirc_dev_data", "=", "load_multirc_mtdnn", "(", "multirc_dev_path", ")", "\n", "multirc_test_data", "=", "load_multirc_mtdnn", "(", "multirc_test_path", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} MultiRC train samples\"", ".", "format", "(", "len", "(", "multirc_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} MultiRC dev samples\"", ".", "format", "(", "len", "(", "multirc_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} MultiRC test samples\"", ".", "format", "(", "len", "(", "multirc_test_data", ")", ")", ")", "\n", "\n", "canonical_data_suffix", "=", "\"canonical_data\"", "\n", "canonical_data_root", "=", "os", ".", "path", ".", "join", "(", "root", ",", "canonical_data_suffix", ")", "\n", "if", "not", "os", ".", "path", ".", "isdir", "(", "canonical_data_root", ")", ":", "\n", "        ", "os", ".", "mkdir", "(", "canonical_data_root", ")", "\n", "\n", "", "cb_train_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"cb_train.tsv\"", ")", "\n", "cb_dev_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"cb_dev.tsv\"", ")", "\n", "cb_test_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"cb_test.tsv\"", ")", "\n", "dump_rows", "(", "cb_train_data", ",", "cb_train_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "cb_dev_data", ",", "cb_dev_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "cb_test_data", ",", "cb_test_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "logger", ".", "info", "(", "\"done with CB\"", ")", "\n", "\n", "boolq_train_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"boolq_train.tsv\"", ")", "\n", "boolq_dev_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"boolq_dev.tsv\"", ")", "\n", "boolq_test_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"boolq_test.tsv\"", ")", "\n", "dump_rows", "(", "boolq_train_data", ",", "boolq_train_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "boolq_dev_data", ",", "boolq_dev_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "boolq_test_data", ",", "boolq_test_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "logger", ".", "info", "(", "\"done with boolq\"", ")", "\n", "\n", "copa_train_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"copa_train.tsv\"", ")", "\n", "copa_dev_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"copa_dev.tsv\"", ")", "\n", "copa_test_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"copa_test.tsv\"", ")", "\n", "dump_rows", "(", "copa_train_data", ",", "copa_train_fout", ",", "DataFormat", ".", "PremiseAndMultiHypothesis", ")", "\n", "dump_rows", "(", "copa_dev_data", ",", "copa_dev_fout", ",", "DataFormat", ".", "PremiseAndMultiHypothesis", ")", "\n", "dump_rows", "(", "copa_test_data", ",", "copa_test_fout", ",", "DataFormat", ".", "PremiseAndMultiHypothesis", ")", "\n", "logger", ".", "info", "(", "\"done with record\"", ")", "\n", "\n", "record_train_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"record_train.tsv\"", ")", "\n", "record_dev_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"record_dev.tsv\"", ")", "\n", "record_test_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"record_test.tsv\"", ")", "\n", "dump_rows", "(", "record_train_data", ",", "record_train_fout", ",", "DataFormat", ".", "ClozeChoice", ")", "\n", "dump_rows", "(", "record_dev_data", ",", "record_dev_fout", ",", "DataFormat", ".", "ClozeChoice", ")", "\n", "dump_rows", "(", "record_test_data", ",", "record_test_fout", ",", "DataFormat", ".", "ClozeChoice", ")", "\n", "logger", ".", "info", "(", "\"done with record\"", ")", "\n", "\n", "wic_train_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"wic_train.tsv\"", ")", "\n", "wic_dev_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"wic_dev.tsv\"", ")", "\n", "wic_test_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"wic_test.tsv\"", ")", "\n", "dump_rows", "(", "wic_train_data", ",", "wic_train_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "wic_dev_data", ",", "wic_dev_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "wic_test_data", ",", "wic_test_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "logger", ".", "info", "(", "\"done with WiC\"", ")", "\n", "\n", "multirc_train_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"multirc_train.tsv\"", ")", "\n", "multirc_dev_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"multirc_dev.tsv\"", ")", "\n", "multirc_test_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"multirc_test.tsv\"", ")", "\n", "dump_rows", "(", "multirc_train_data", ",", "multirc_train_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "multirc_dev_data", ",", "multirc_dev_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "multirc_test_data", ",", "multirc_test_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "logger", ".", "info", "(", "\"done with MultiRC\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_boolq": [[15, 26], ["open", "json.loads", "rows.append"], "function", ["None"], ["def", "load_boolq", "(", "file", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "data", "=", "json", ".", "loads", "(", "line", ")", "\n", "label", "=", "data", "[", "'label'", "]", "if", "'label'", "in", "data", "else", "False", "\n", "label", "=", "1", "if", "label", "else", "0", "\n", "uid", "=", "data", "[", "'idx'", "]", "\n", "sample", "=", "{", "'uid'", ":", "uid", ",", "'premise'", ":", "data", "[", "'passage'", "]", ",", "'hypothesis'", ":", "data", "[", "'question'", "]", ",", "'label'", ":", "label", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_cb": [[27, 37], ["open", "json.loads", "rows.append"], "function", ["None"], ["", "def", "load_cb", "(", "file", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "data", "=", "json", ".", "loads", "(", "line", ")", "\n", "label", "=", "data", "[", "'label'", "]", "if", "'label'", "in", "data", "else", "0", "\n", "uid", "=", "data", "[", "'idx'", "]", "\n", "sample", "=", "{", "'uid'", ":", "uid", ",", "'premise'", ":", "data", "[", "'premise'", "]", ",", "'hypothesis'", ":", "data", "[", "'hypothesis'", "]", ",", "'label'", ":", "label", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_multirc": [[38, 59], ["open", "json.loads", "type", "rows.append"], "function", ["None"], ["", "def", "load_multirc", "(", "file", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "data", "=", "json", ".", "loads", "(", "line", ")", "\n", "pidx", "=", "data", "[", "'idx'", "]", "\n", "passage", "=", "data", "[", "'passage'", "]", "[", "'text'", "]", "\n", "questionts", "=", "data", "[", "'passage'", "]", "[", "'questions'", "]", "\n", "assert", "type", "(", "questionts", ")", "is", "list", "\n", "for", "question", "in", "questionts", ":", "\n", "                ", "q", "=", "question", "[", "'question'", "]", "\n", "qidx", "=", "question", "[", "'idx'", "]", "\n", "answers", "=", "question", "[", "'answers'", "]", "\n", "for", "answer", "in", "answers", ":", "\n", "                    ", "a", "=", "answer", "[", "'text'", "]", "\n", "aidx", "=", "answer", "[", "'idx'", "]", "\n", "label", "=", "answer", "[", "'label'", "]", "if", "'label'", "in", "answer", "else", "0", "\n", "uid", "=", "\"{}_{}_{}\"", ".", "format", "(", "pidx", ",", "qidx", ",", "aidx", ")", "\n", "sample", "=", "{", "'uid'", ":", "uid", ",", "'premise'", ":", "passage", ",", "'hypothesis'", ":", "q", ",", "'label'", ":", "label", ",", "'answer'", ":", "a", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_multirc_mtdnn": [[60, 81], ["open", "json.loads", "type", "rows.append"], "function", ["None"], ["", "", "def", "load_multirc_mtdnn", "(", "file", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "data", "=", "json", ".", "loads", "(", "line", ")", "\n", "pidx", "=", "data", "[", "'idx'", "]", "\n", "passage", "=", "data", "[", "'passage'", "]", "[", "'text'", "]", "\n", "questionts", "=", "data", "[", "'passage'", "]", "[", "'questions'", "]", "\n", "assert", "type", "(", "questionts", ")", "is", "list", "\n", "for", "question", "in", "questionts", ":", "\n", "                ", "q", "=", "question", "[", "'question'", "]", "\n", "qidx", "=", "question", "[", "'idx'", "]", "\n", "answers", "=", "question", "[", "'answers'", "]", "\n", "for", "answer", "in", "answers", ":", "\n", "                    ", "a", "=", "answer", "[", "'text'", "]", "\n", "aidx", "=", "answer", "[", "'idx'", "]", "\n", "label", "=", "answer", "[", "'label'", "]", "if", "'label'", "in", "answer", "else", "0", "\n", "uid", "=", "\"{}_{}_{}\"", ".", "format", "(", "pidx", ",", "qidx", ",", "aidx", ")", "\n", "sample", "=", "{", "'uid'", ":", "uid", ",", "'premise'", ":", "passage", ",", "'hypothesis'", ":", "\"{} {}\"", ".", "format", "(", "q", ",", "a", ")", ",", "'label'", ":", "label", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_wic": [[82, 96], ["open", "json.loads", "rows.append"], "function", ["None"], ["", "", "def", "load_wic", "(", "file", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "data", "=", "json", ".", "loads", "(", "line", ")", "\n", "label", "=", "data", "[", "'label'", "]", "if", "'label'", "in", "data", "else", "False", "\n", "label", "=", "1", "if", "label", "else", "0", "\n", "uid", "=", "data", "[", "'idx'", "]", "\n", "word", "=", "data", "[", "'word'", "]", "\n", "premise", "=", "data", "[", "'sentence1'", "]", "\n", "hyp", "=", "data", "[", "'sentence2'", "]", "\n", "sample", "=", "{", "'uid'", ":", "uid", ",", "'premise'", ":", "word", ",", "'hypothesis'", ":", "premise", ",", "'hypothesis_extra'", ":", "hyp", ",", "'label'", ":", "label", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_wic_mtdnn": [[97, 112], ["open", "json.loads", "rows.append"], "function", ["None"], ["", "def", "load_wic_mtdnn", "(", "file", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "data", "=", "json", ".", "loads", "(", "line", ")", "\n", "label", "=", "data", "[", "'label'", "]", "if", "'label'", "in", "data", "else", "False", "\n", "label", "=", "1", "if", "label", "else", "0", "\n", "uid", "=", "data", "[", "'idx'", "]", "\n", "word", "=", "data", "[", "'word'", "]", "\n", "premise", "=", "data", "[", "'sentence1'", "]", "\n", "hyp", "=", "data", "[", "'sentence2'", "]", "\n", "# the given word is placed at the begining of seq. ", "\n", "sample", "=", "{", "'uid'", ":", "uid", ",", "'premise'", ":", "\"{} {}\"", ".", "format", "(", "word", ",", "premise", ")", ",", "'hypothesis'", ":", "hyp", ",", "'label'", ":", "label", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_record": [[113, 164], ["open", "json.loads", "passage.replace.replace", "set", "set", "set", "list", "query.replace", "random.sample().pop", "query.replace", "rows.append", "query.replace", "str", "rows.append", "random.shuffle", "str", "str", "len", "random.sample"], "function", ["None"], ["", "def", "load_record", "(", "file", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "is_training", "=", "True", "if", "(", "\"train\"", "in", "file", "or", "\"val\"", "in", "file", ")", "else", "False", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "cnt", "=", "0", "\n", "for", "line", "in", "f", ":", "\n", "            ", "data", "=", "json", ".", "loads", "(", "line", ")", "\n", "passage", "=", "data", "[", "'passage'", "]", "[", "'text'", "]", "\n", "passage", "=", "passage", ".", "replace", "(", "'\\n'", ",", "' '", ")", "\n", "passage_idx", "=", "data", "[", "'idx'", "]", "\n", "entities", "=", "data", "[", "'passage'", "]", "[", "'entities'", "]", "\n", "entities_set", "=", "set", "(", "[", "passage", "[", "entity", "[", "\"start\"", "]", ":", "entity", "[", "\"end\"", "]", "+", "1", "]", "for", "entity", "in", "entities", "]", ")", "\n", "qas", "=", "data", "[", "'qas'", "]", "\n", "for", "qa", "in", "qas", ":", "\n", "                ", "query", "=", "qa", "[", "'query'", "]", "\n", "answers_dict", "=", "{", "}", "\n", "answers_set", "=", "set", "(", ")", "\n", "if", "\"answers\"", "in", "qa", ":", "\n", "                    ", "answers_dict", "=", "{", "(", "answer", "[", "\"start\"", "]", ",", "answer", "[", "\"end\"", "]", ")", ":", "answer", "[", "\"text\"", "]", "for", "answer", "in", "qa", "[", "\"answers\"", "]", "}", "\n", "answers_set", "=", "set", "(", "answer", "[", "\"text\"", "]", "for", "answer", "in", "qa", "[", "\"answers\"", "]", ")", "\n", "", "query_idx", "=", "qa", "[", "'idx'", "]", "\n", "if", "is_training", ":", "\n", "                    ", "negative_set", "=", "entities_set", "-", "answers_set", "\n", "# enumerate all the nagative set", "\n", "positives", "=", "list", "(", "answers_set", ")", "\n", "for", "negative", "in", "negative_set", ":", "\n", "                        ", "orders", "=", "[", "0", ",", "1", "]", "\n", "# shuffle the order of pos/negative samples", "\n", "if", "\"train\"", "in", "file", ":", "shuffle", "(", "orders", ")", "\n", "query_n", "=", "query", ".", "replace", "(", "\"@placeholder\"", ",", "negative", ")", "\n", "positive", "=", "random", ".", "sample", "(", "positives", ",", "1", ")", ".", "pop", "(", ")", "\n", "query_p", "=", "query", ".", "replace", "(", "\"@placeholder\"", ",", "positive", ")", "\n", "queries", "=", "[", "query_n", ",", "query_p", "]", "\n", "queries", "=", "[", "queries", "[", "idx", "]", "for", "idx", "in", "orders", "]", "\n", "new_answers", "=", "[", "negative", ",", "positive", "]", "\n", "new_answers", "=", "[", "new_answers", "[", "idx", "]", "for", "idx", "in", "orders", "]", "\n", "label", "=", "1", "if", "orders", "[", "0", "]", "==", "0", "else", "0", "\n", "sample", "=", "{", "'uid'", ":", "str", "(", "query_idx", ")", ",", "'premise'", ":", "passage", ",", "'hypothesis'", ":", "queries", "[", "0", "]", ",", "'hypothesis_extra'", ":", "queries", "[", "1", "]", ",", "'label'", ":", "label", ",", "\"answer\"", ":", "str", "(", "new_answers", ")", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "", "", "else", ":", "\n", "                    ", "for", "entity", "in", "entities_set", ":", "\n", "                        ", "label", "=", "False", "\n", "if", "len", "(", "answers_dict", ")", ">", "0", ":", "\n", "                            ", "if", "entity", "in", "answers_set", ":", "\n", "                                ", "label", "=", "True", "\n", "", "", "updated_query", "=", "query", ".", "replace", "(", "\"@placeholder\"", ",", "entity", ")", "\n", "uid", "=", "str", "(", "query_idx", ")", "\n", "label", "=", "1", "if", "label", "else", "0", "\n", "sample", "=", "{", "'uid'", ":", "uid", ",", "'premise'", ":", "passage", ",", "'hypothesis'", ":", "updated_query", ",", "'hypothesis_extra'", ":", "updated_query", ",", "'label'", ":", "label", ",", "\"answer\"", ":", "entity", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "", "", "", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_record_mtdnn": [[165, 214], ["open", "json.loads", "passage.replace.replace", "set", "set", "set", "list", "list", "str", "rows.append", "query.replace", "random.sample().pop", "query.replace", "rows.append", "query.replace", "str", "str", "random.shuffle", "str", "str", "str", "list", "random.sample", "list"], "function", ["None"], ["", "def", "load_record_mtdnn", "(", "file", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "is_training", "=", "True", "if", "\"train\"", "in", "file", "else", "False", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "cnt", "=", "0", "\n", "for", "line", "in", "f", ":", "\n", "            ", "data", "=", "json", ".", "loads", "(", "line", ")", "\n", "passage", "=", "data", "[", "'passage'", "]", "[", "'text'", "]", "\n", "passage", "=", "passage", ".", "replace", "(", "'\\n'", ",", "' '", ")", "\n", "passage_idx", "=", "data", "[", "'idx'", "]", "\n", "entities", "=", "data", "[", "'passage'", "]", "[", "'entities'", "]", "\n", "entities_set", "=", "set", "(", "[", "passage", "[", "entity", "[", "\"start\"", "]", ":", "entity", "[", "\"end\"", "]", "+", "1", "]", "for", "entity", "in", "entities", "]", ")", "\n", "qas", "=", "data", "[", "'qas'", "]", "\n", "for", "qa", "in", "qas", ":", "\n", "                ", "query", "=", "qa", "[", "'query'", "]", "\n", "answers_dict", "=", "{", "}", "\n", "answers_set", "=", "set", "(", ")", "\n", "if", "\"answers\"", "in", "qa", ":", "\n", "                    ", "answers_dict", "=", "{", "(", "answer", "[", "\"start\"", "]", ",", "answer", "[", "\"end\"", "]", ")", ":", "answer", "[", "\"text\"", "]", "for", "answer", "in", "qa", "[", "\"answers\"", "]", "}", "\n", "answers_set", "=", "set", "(", "answer", "[", "\"text\"", "]", "for", "answer", "in", "qa", "[", "\"answers\"", "]", ")", "\n", "", "query_idx", "=", "qa", "[", "'idx'", "]", "\n", "if", "is_training", ":", "\n", "                    ", "negative_set", "=", "entities_set", "-", "answers_set", "\n", "# enumerate all the nagative set", "\n", "positives", "=", "list", "(", "answers_set", ")", "\n", "for", "negative", "in", "negative_set", ":", "\n", "                        ", "orders", "=", "[", "0", ",", "1", "]", "\n", "# shuffle the order of pos/negative samples", "\n", "if", "\"train\"", "in", "file", ":", "shuffle", "(", "orders", ")", "\n", "query_n", "=", "query", ".", "replace", "(", "\"@placeholder\"", ",", "negative", ")", "\n", "positive", "=", "random", ".", "sample", "(", "positives", ",", "1", ")", ".", "pop", "(", ")", "\n", "query_p", "=", "query", ".", "replace", "(", "\"@placeholder\"", ",", "positive", ")", "\n", "queries", "=", "[", "query_n", ",", "query_p", "]", "\n", "queries", "=", "[", "queries", "[", "idx", "]", "for", "idx", "in", "orders", "]", "\n", "new_answers", "=", "[", "negative", ",", "positive", "]", "\n", "new_answers", "=", "[", "new_answers", "[", "idx", "]", "for", "idx", "in", "orders", "]", "\n", "label", "=", "1", "if", "orders", "[", "0", "]", "==", "0", "else", "0", "\n", "labels", "=", "[", "0", ",", "0", "]", "\n", "labels", "[", "label", "]", "=", "1", "\n", "sample", "=", "{", "'uid'", ":", "str", "(", "query_idx", ")", ",", "'premise'", ":", "passage", ",", "'hypothesis'", ":", "[", "queries", "[", "0", "]", ",", "queries", "[", "1", "]", "]", ",", "'label'", ":", "labels", ",", "'choice'", ":", "str", "(", "new_answers", ")", ",", "\"answer\"", ":", "str", "(", "list", "(", "answers_set", ")", ")", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "", "", "else", ":", "\n", "                    ", "entities_set", "=", "list", "(", "entities_set", ")", "\n", "hypothesis", "=", "[", "query", ".", "replace", "(", "\"@placeholder\"", ",", "entity", ")", "for", "entity", "in", "entities_set", "]", "\n", "label", "=", "[", "1", "if", "entity", "in", "answers_set", "else", "0", "for", "entity", "in", "entities_set", "]", "\n", "uid", "=", "str", "(", "query_idx", ")", "\n", "sample", "=", "{", "'uid'", ":", "uid", ",", "'premise'", ":", "passage", ",", "'hypothesis'", ":", "hypothesis", ",", "'label'", ":", "label", ",", "\"choice\"", ":", "str", "(", "entities_set", ")", ",", "\"answer\"", ":", "str", "(", "list", "(", "answers_set", ")", ")", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "", "", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_record_eval": [[216, 247], ["open", "json.loads", "passage.replace.replace", "set", "set", "set", "query.replace", "str", "rows.append", "len"], "function", ["None"], ["", "def", "load_record_eval", "(", "file", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "cnt", "=", "0", "\n", "for", "line", "in", "f", ":", "\n", "            ", "data", "=", "json", ".", "loads", "(", "line", ")", "\n", "passage", "=", "data", "[", "'passage'", "]", "[", "'text'", "]", "\n", "passage", "=", "passage", ".", "replace", "(", "'\\n'", ",", "' '", ")", "\n", "passage_idx", "=", "data", "[", "'idx'", "]", "\n", "entities", "=", "data", "[", "'passage'", "]", "[", "'entities'", "]", "\n", "entities_set", "=", "set", "(", "[", "passage", "[", "entity", "[", "\"start\"", "]", ":", "entity", "[", "\"end\"", "]", "+", "1", "]", "for", "entity", "in", "entities", "]", ")", "\n", "qas", "=", "data", "[", "'qas'", "]", "\n", "for", "qa", "in", "qas", ":", "\n", "                ", "query", "=", "qa", "[", "'query'", "]", "\n", "answers_dict", "=", "{", "}", "\n", "answers_set", "=", "set", "(", ")", "\n", "if", "\"answers\"", "in", "qa", ":", "\n", "                    ", "answers_dict", "=", "{", "(", "answer", "[", "\"start\"", "]", ",", "answer", "[", "\"end\"", "]", ")", ":", "answer", "[", "\"text\"", "]", "for", "answer", "in", "qa", "[", "\"answers\"", "]", "}", "\n", "answers_set", "=", "set", "(", "answer", "[", "\"text\"", "]", "for", "answer", "in", "qa", "[", "\"answers\"", "]", ")", "\n", "", "query_idx", "=", "qa", "[", "'idx'", "]", "\n", "for", "entity", "in", "entities_set", ":", "\n", "                    ", "label", "=", "False", "\n", "if", "len", "(", "answers_dict", ")", ">", "0", ":", "\n", "                        ", "if", "entity", "in", "answers_set", ":", "\n", "                            ", "label", "=", "True", "\n", "", "", "updated_query", "=", "query", ".", "replace", "(", "\"@placeholder\"", ",", "entity", ")", "\n", "uid", "=", "str", "(", "query_idx", ")", "\n", "label", "=", "1", "if", "label", "else", "0", "\n", "sample", "=", "{", "'uid'", ":", "uid", ",", "'premise'", ":", "passage", ",", "'hypothesis'", ":", "updated_query", ",", "'label'", ":", "label", ",", "\"answer\"", ":", "entity", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "", "", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_copa": [[248, 264], ["open", "json.loads", "rows.append"], "function", ["None"], ["", "def", "load_copa", "(", "file", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "data", "=", "json", ".", "loads", "(", "line", ")", "\n", "label", "=", "data", "[", "'label'", "]", "if", "'label'", "in", "data", "else", "0", "\n", "uid", "=", "data", "[", "'idx'", "]", "\n", "# the token replacement idea is from RoBERTa", "\n", "# please cite RoBERTa paper if you use this", "\n", "# explanation by xiaodl@microsoft.com", "\n", "token", "=", "\"because\"", "if", "data", "[", "\"question\"", "]", "==", "\"cause\"", "else", "\"so\"", "\n", "hyp1", "=", "'{} {}'", ".", "format", "(", "token", ",", "data", "[", "'choice1'", "]", ")", "\n", "hyp2", "=", "'{} {}'", ".", "format", "(", "token", ",", "data", "[", "'choice2'", "]", ")", "\n", "sample", "=", "{", "'uid'", ":", "uid", ",", "'premise'", ":", "data", "[", "'premise'", "]", ",", "'hypothesis'", ":", "hyp1", ",", "'hypothesis_extra'", ":", "hyp2", ",", "'label'", ":", "label", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_copa_mtdnn": [[265, 281], ["open", "json.loads", "rows.append", "str"], "function", ["None"], ["", "def", "load_copa_mtdnn", "(", "file", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "data", "=", "json", ".", "loads", "(", "line", ")", "\n", "label", "=", "data", "[", "'label'", "]", "if", "'label'", "in", "data", "else", "0", "\n", "uid", "=", "data", "[", "'idx'", "]", "\n", "token", "=", "\"because\"", "if", "data", "[", "\"question\"", "]", "==", "\"cause\"", "else", "\"so\"", "\n", "hyp1", "=", "'{} {}'", ".", "format", "(", "token", ",", "data", "[", "'choice1'", "]", ")", "\n", "hyp2", "=", "'{} {}'", ".", "format", "(", "token", ",", "data", "[", "'choice2'", "]", ")", "\n", "hyp", "=", "[", "hyp1", ",", "hyp2", "]", "\n", "labels", "=", "[", "0", ",", "0", "]", "\n", "labels", "[", "label", "]", "=", "1", "\n", "sample", "=", "{", "'uid'", ":", "uid", ",", "'ruid'", ":", "\"{},{}\"", ".", "format", "(", "uid", ",", "uid", ")", ",", "'premise'", ":", "data", "[", "'premise'", "]", ",", "'hypothesis'", ":", "hyp", ",", "'label'", ":", "\",\"", ".", "join", "(", "[", "str", "(", "lab", ")", "for", "lab", "in", "labels", "]", ")", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.load_wsc": [[282, 297], ["open", "json.loads", "data[].split", "str().lower", "rows.append", "line.strip", "str", "json.loads.get"], "function", ["None"], ["", "def", "load_wsc", "(", "file", ",", "is_train", "=", "True", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "data", "=", "json", ".", "loads", "(", "line", ".", "strip", "(", ")", ")", "\n", "premise", "=", "data", "[", "'text'", "]", "\n", "tokens", "=", "data", "[", "'text'", "]", ".", "split", "(", ")", "\n", "target", "=", "data", "[", "'target'", "]", "\n", "tokens", "[", "target", "[", "'span2_index'", "]", "]", "=", "target", "[", "'span1_text'", "]", "\n", "hypothesis", "=", "' '", ".", "join", "(", "tokens", ")", "\n", "label", "=", "str", "(", "data", ".", "get", "(", "'label'", ",", "\"false\"", ")", ")", ".", "lower", "(", ")", "\n", "label", "=", "1", "if", "label", "==", "\"true\"", "else", "0", "\n", "sample", "=", "{", "'uid'", ":", "data", "[", "'idx'", "]", ",", "'premise'", ":", "premise", ",", "'hypothesis'", ":", "hypothesis", ",", "'label'", ":", "label", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.superglue.superglue_utils.save": [[320, 323], ["open", "writer.write"], "function", ["None"], ["def", "save", "(", "data", ",", "fout", ")", ":", "\n", "    ", "with", "open", "(", "fout", ",", "'w'", ",", "encoding", "=", "'utf-8'", ")", "as", "writer", ":", "\n", "        ", "writer", ".", "write", "(", "\"\\n\"", ".", "join", "(", "data", ")", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mlm.mlm_utils.TrainingInstance.__init__": [[29, 37], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "\n", "self", ",", "tokens", ",", "segment_ids", ",", "masked_lm_positions", ",", "masked_lm_labels", ",", "is_random_next", "\n", ")", ":", "\n", "        ", "self", ".", "tokens", "=", "tokens", "\n", "self", ".", "segment_ids", "=", "segment_ids", "\n", "self", ".", "is_random_next", "=", "is_random_next", "\n", "self", ".", "masked_lm_positions", "=", "masked_lm_positions", "\n", "self", ".", "masked_lm_labels", "=", "masked_lm_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mlm.mlm_utils.TrainingInstance.__repr__": [[38, 40], ["mlm_utils.TrainingInstance.__str__"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "__str__", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mlm.mlm_utils.truncate_seq_pair": [[10, 26], ["len", "len", "len", "rng.random", "trunc_tokens.pop", "len", "len"], "function", ["None"], ["def", "truncate_seq_pair", "(", "tokens_a", ",", "tokens_b", ",", "max_num_tokens", ",", "rng", ")", ":", "\n", "    ", "\"\"\"Truncates a pair of sequences to a maximum sequence length.\"\"\"", "\n", "while", "True", ":", "\n", "        ", "total_length", "=", "len", "(", "tokens_a", ")", "+", "len", "(", "tokens_b", ")", "\n", "if", "total_length", "<=", "max_num_tokens", ":", "\n", "            ", "break", "\n", "\n", "", "trunc_tokens", "=", "tokens_a", "if", "len", "(", "tokens_a", ")", ">", "len", "(", "tokens_b", ")", "else", "tokens_b", "\n", "assert", "len", "(", "trunc_tokens", ")", ">=", "1", "\n", "\n", "# We want to sometimes truncate from the front and sometimes from the", "\n", "# back to add more randomness and avoid biases.", "\n", "if", "rng", ".", "random", "(", ")", "<", "0.5", ":", "\n", "            ", "del", "trunc_tokens", "[", "0", "]", "\n", "", "else", ":", "\n", "            ", "trunc_tokens", ".", "pop", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mlm.mlm_utils.load_loose_json": [[42, 49], ["open", "json.loads", "rows.append"], "function", ["None"], ["", "", "def", "load_loose_json", "(", "load_path", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "with", "open", "(", "load_path", ",", "\"r\"", ",", "encoding", "=", "\"utf-8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "row", "=", "json", ".", "loads", "(", "line", ")", "\n", "rows", ".", "append", "(", "row", ")", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mlm.mlm_utils.create_masked_lm_predictions": [[51, 122], ["enumerate", "rng.shuffle", "list", "min", "set", "sorted", "max", "len", "masked_lm_positions.append", "masked_lm_labels.append", "token.startswith", "cand_indexes[].append", "cand_indexes.append", "int", "len", "set.add", "sorted.append", "len", "round", "len", "len", "rng.random", "MaskedLmInstance", "rng.random", "len", "rng.randint", "len"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.vocab.Vocabulary.add"], ["", "def", "create_masked_lm_predictions", "(", "\n", "tokens", ",", "\n", "masked_lm_prob", ",", "\n", "max_predictions_per_seq", ",", "\n", "vocab_words", ",", "\n", "rng", ",", "\n", "do_whole_word_mask", "=", "True", ",", "\n", ")", ":", "\n", "    ", "cand_indexes", "=", "[", "]", "\n", "for", "(", "i", ",", "token", ")", "in", "enumerate", "(", "tokens", ")", ":", "\n", "        ", "if", "token", "==", "\"[CLS]\"", "or", "token", "==", "\"[SEP]\"", ":", "\n", "            ", "continue", "\n", "# Whole Word Masking means that if we mask all of the wordpieces", "\n", "# corresponding to an original word. When a word has been split into", "\n", "# WordPieces, the first token does not have any marker and any subsequence", "\n", "# tokens are prefixed with ##. So whenever we see the ## token, we", "\n", "# append it to the previous set of word indexes.", "\n", "#", "\n", "# Note that Whole Word Masking does *not* change the training code", "\n", "# at all -- we still predict each WordPiece independently, softmaxed", "\n", "# over the entire vocabulary.", "\n", "", "if", "do_whole_word_mask", "and", "len", "(", "cand_indexes", ")", ">=", "1", "and", "token", ".", "startswith", "(", "\"##\"", ")", ":", "\n", "            ", "cand_indexes", "[", "-", "1", "]", ".", "append", "(", "i", ")", "\n", "", "else", ":", "\n", "            ", "cand_indexes", ".", "append", "(", "[", "i", "]", ")", "\n", "", "", "rng", ".", "shuffle", "(", "cand_indexes", ")", "\n", "output_tokens", "=", "list", "(", "tokens", ")", "\n", "num_to_predict", "=", "min", "(", "\n", "max_predictions_per_seq", ",", "max", "(", "1", ",", "int", "(", "round", "(", "len", "(", "tokens", ")", "*", "masked_lm_prob", ")", ")", ")", "\n", ")", "\n", "\n", "masked_lms", "=", "[", "]", "\n", "covered_indexes", "=", "set", "(", ")", "\n", "for", "index_set", "in", "cand_indexes", ":", "\n", "        ", "if", "len", "(", "masked_lms", ")", ">=", "num_to_predict", ":", "\n", "            ", "break", "\n", "# If adding a whole-word mask would exceed the maximum number of", "\n", "# predictions, then just skip this candidate.", "\n", "", "if", "len", "(", "masked_lms", ")", "+", "len", "(", "index_set", ")", ">", "num_to_predict", ":", "\n", "            ", "continue", "\n", "", "is_any_index_covered", "=", "False", "\n", "for", "index", "in", "index_set", ":", "\n", "            ", "if", "index", "in", "covered_indexes", ":", "\n", "                ", "is_any_index_covered", "=", "True", "\n", "break", "\n", "", "", "if", "is_any_index_covered", ":", "\n", "            ", "continue", "\n", "", "for", "index", "in", "index_set", ":", "\n", "            ", "covered_indexes", ".", "add", "(", "index", ")", "\n", "masked_token", "=", "None", "\n", "# 80% of the time, replace with [MASK]", "\n", "if", "rng", ".", "random", "(", ")", "<", "0.8", ":", "\n", "                ", "masked_token", "=", "\"[MASK]\"", "\n", "", "else", ":", "\n", "# 10% of the time, keep original", "\n", "                ", "if", "rng", ".", "random", "(", ")", "<", "0.5", ":", "\n", "                    ", "masked_token", "=", "tokens", "[", "index", "]", "\n", "# 10% of the time, replace with random word", "\n", "", "else", ":", "\n", "                    ", "masked_token", "=", "vocab_words", "[", "rng", ".", "randint", "(", "0", ",", "len", "(", "vocab_words", ")", "-", "1", ")", "]", "\n", "\n", "", "", "output_tokens", "[", "index", "]", "=", "masked_token", "\n", "masked_lms", ".", "append", "(", "MaskedLmInstance", "(", "index", "=", "index", ",", "label", "=", "tokens", "[", "index", "]", ")", ")", "\n", "", "", "assert", "len", "(", "masked_lms", ")", "<=", "num_to_predict", "\n", "masked_lms", "=", "sorted", "(", "masked_lms", ",", "key", "=", "lambda", "x", ":", "x", ".", "index", ")", "\n", "masked_lm_positions", "=", "[", "]", "\n", "masked_lm_labels", "=", "[", "]", "\n", "for", "p", "in", "masked_lms", ":", "\n", "        ", "masked_lm_positions", ".", "append", "(", "p", ".", "index", ")", "\n", "masked_lm_labels", ".", "append", "(", "p", ".", "label", ")", "\n", "", "return", "(", "output_tokens", ",", "masked_lm_positions", ",", "masked_lm_labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mlm.mlm_utils.create_instances_from_document": [[124, 225], ["rng.random", "rng.randint", "len", "current_chunk.append", "len", "range", "mlm_utils.truncate_seq_pair", "tokens.append", "segment_ids.append", "tokens.append", "segment_ids.append", "tokens.append", "segment_ids.append", "mlm_utils.create_masked_lm_predictions", "mlm_utils.TrainingInstance", "instances.append", "len", "len", "rng.randint", "tokens_a.extend", "range", "rng.randint", "range", "range", "len", "len", "tokens.append", "segment_ids.append", "tokens.append", "segment_ids.append", "len", "rng.random", "len", "rng.randint", "len", "tokens_b.extend", "len", "len", "tokens_b.extend", "len", "len", "len", "len"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mlm.mlm_utils.truncate_seq_pair", "home.repos.pwc.inspect_result.namisan_mt-dnn.mlm.mlm_utils.create_masked_lm_predictions"], ["", "def", "create_instances_from_document", "(", "\n", "all_documents", ",", "\n", "document_index", ",", "\n", "max_seq_length", ",", "\n", "short_seq_prob", ",", "\n", "masked_lm_prob", ",", "\n", "max_predictions_per_seq", ",", "\n", "vocab_words", ",", "\n", "rng", ",", "\n", ")", ":", "\n", "    ", "document", "=", "all_documents", "[", "document_index", "]", "\n", "\n", "# Account for [CLS], [SEP], [SEP]", "\n", "max_num_tokens", "=", "max_seq_length", "-", "3", "\n", "target_seq_length", "=", "max_num_tokens", "\n", "if", "rng", ".", "random", "(", ")", "<", "short_seq_prob", ":", "\n", "        ", "target_seq_length", "=", "rng", ".", "randint", "(", "2", ",", "max_num_tokens", ")", "\n", "", "instances", "=", "[", "]", "\n", "current_chunk", "=", "[", "]", "\n", "current_length", "=", "0", "\n", "i", "=", "0", "\n", "while", "i", "<", "len", "(", "document", ")", ":", "\n", "        ", "segment", "=", "document", "[", "i", "]", "\n", "current_chunk", ".", "append", "(", "segment", ")", "\n", "current_length", "+=", "len", "(", "segment", ")", "\n", "if", "i", "==", "len", "(", "document", ")", "-", "1", "or", "current_length", ">=", "target_seq_length", ":", "\n", "            ", "if", "current_chunk", ":", "\n", "# `a_end` is how many segments from `current_chunk` go into the `A`", "\n", "# (first) sentence.", "\n", "                ", "a_end", "=", "1", "\n", "if", "len", "(", "current_chunk", ")", ">=", "2", ":", "\n", "                    ", "a_end", "=", "rng", ".", "randint", "(", "1", ",", "len", "(", "current_chunk", ")", "-", "1", ")", "\n", "\n", "", "tokens_a", "=", "[", "]", "\n", "for", "j", "in", "range", "(", "a_end", ")", ":", "\n", "                    ", "tokens_a", ".", "extend", "(", "current_chunk", "[", "j", "]", ")", "\n", "\n", "", "tokens_b", "=", "[", "]", "\n", "# Random next", "\n", "is_random_next", "=", "False", "\n", "\n", "if", "len", "(", "current_chunk", ")", "==", "1", "or", "rng", ".", "random", "(", ")", "<", "0.5", ":", "\n", "                    ", "is_random_next", "=", "True", "\n", "target_b_length", "=", "target_seq_length", "-", "len", "(", "tokens_a", ")", "\n", "for", "_", "in", "range", "(", "10", ")", ":", "\n", "                        ", "random_document_index", "=", "rng", ".", "randint", "(", "0", ",", "len", "(", "all_documents", ")", "-", "1", ")", "\n", "if", "random_document_index", "!=", "document_index", ":", "\n", "                            ", "break", "\n", "", "", "random_document", "=", "all_documents", "[", "random_document_index", "]", "\n", "random_start", "=", "rng", ".", "randint", "(", "0", ",", "len", "(", "random_document", ")", "-", "1", ")", "\n", "for", "j", "in", "range", "(", "random_start", ",", "len", "(", "random_document", ")", ")", ":", "\n", "                        ", "tokens_b", ".", "extend", "(", "random_document", "[", "j", "]", ")", "\n", "if", "len", "(", "tokens_b", ")", ">=", "target_b_length", ":", "\n", "                            ", "break", "\n", "", "", "num_unused_segments", "=", "len", "(", "current_chunk", ")", "-", "a_end", "\n", "i", "-=", "num_unused_segments", "\n", "", "else", ":", "\n", "                    ", "is_random_next", "=", "False", "\n", "for", "j", "in", "range", "(", "a_end", ",", "len", "(", "current_chunk", ")", ")", ":", "\n", "                        ", "tokens_b", ".", "extend", "(", "current_chunk", "[", "j", "]", ")", "\n", "", "", "truncate_seq_pair", "(", "tokens_a", ",", "tokens_b", ",", "max_num_tokens", ",", "rng", ")", "\n", "\n", "assert", "len", "(", "tokens_a", ")", ">=", "1", "\n", "assert", "len", "(", "tokens_b", ")", ">=", "1", "\n", "\n", "tokens", "=", "[", "]", "\n", "segment_ids", "=", "[", "]", "\n", "tokens", ".", "append", "(", "\"[CLS]\"", ")", "\n", "segment_ids", ".", "append", "(", "0", ")", "\n", "for", "token", "in", "tokens_a", ":", "\n", "                    ", "tokens", ".", "append", "(", "token", ")", "\n", "segment_ids", ".", "append", "(", "0", ")", "\n", "\n", "", "tokens", ".", "append", "(", "\"[SEP]\"", ")", "\n", "segment_ids", ".", "append", "(", "0", ")", "\n", "\n", "for", "token", "in", "tokens_b", ":", "\n", "                    ", "tokens", ".", "append", "(", "token", ")", "\n", "segment_ids", ".", "append", "(", "1", ")", "\n", "", "tokens", ".", "append", "(", "\"[SEP]\"", ")", "\n", "segment_ids", ".", "append", "(", "1", ")", "\n", "(", "\n", "tokens", ",", "\n", "masked_lm_positions", ",", "\n", "masked_lm_labels", ",", "\n", ")", "=", "create_masked_lm_predictions", "(", "\n", "tokens", ",", "masked_lm_prob", ",", "max_predictions_per_seq", ",", "vocab_words", ",", "rng", "\n", ")", "\n", "instance", "=", "TrainingInstance", "(", "\n", "tokens", "=", "tokens", ",", "\n", "segment_ids", "=", "segment_ids", ",", "\n", "is_random_next", "=", "is_random_next", ",", "\n", "masked_lm_positions", "=", "masked_lm_positions", ",", "\n", "masked_lm_labels", "=", "masked_lm_labels", ",", "\n", ")", "\n", "instances", ".", "append", "(", "instance", ")", "\n", "", "current_chunk", "=", "[", "]", "\n", "current_length", "=", "0", "\n", "", "i", "+=", "1", "\n", "\n", "", "return", "instances", "\n", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.squad.squad_prepro.load_json": [[26, 29], ["open", "json.load"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load"], ["def", "load_json", "(", "path", ")", ":", "\n", "    ", "with", "open", "(", "path", ",", "\"r\"", ",", "encoding", "=", "\"utf-8\"", ")", "as", "f", ":", "\n", "        ", "return", "json", ".", "load", "(", "f", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.squad.squad_prepro.load_squad": [[31, 55], ["squad_prepro.load_json", "print", "tqdm.auto.tqdm", "qa.get", "examples.append"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.squad.squad_prepro.load_json"], ["", "", "def", "load_squad", "(", "path", ")", ":", "\n", "    ", "input_data", "=", "load_json", "(", "path", ")", "\n", "print", "(", "\"version: {}\"", ".", "format", "(", "input_data", "[", "\"version\"", "]", ")", ")", "\n", "version", "=", "input_data", "[", "\"version\"", "]", "\n", "input_data", "=", "input_data", "[", "\"data\"", "]", "\n", "examples", "=", "[", "]", "\n", "for", "entry", "in", "tqdm", "(", "input_data", ")", ":", "\n", "        ", "title", "=", "entry", "[", "\"title\"", "]", "\n", "for", "paragraph", "in", "entry", "[", "\"paragraphs\"", "]", ":", "\n", "            ", "context", "=", "paragraph", "[", "\"context\"", "]", "\n", "for", "qa", "in", "paragraph", "[", "\"qas\"", "]", ":", "\n", "                ", "qas_id", "=", "qa", "[", "\"id\"", "]", "\n", "question", "=", "qa", "[", "\"question\"", "]", "\n", "answer", "=", "qa", "[", "\"answers\"", "]", "\n", "is_impossible", "=", "qa", ".", "get", "(", "\"is_impossible\"", ",", "False", ")", "\n", "example", "=", "{", "\n", "\"id\"", ":", "qas_id", ",", "\n", "\"context\"", ":", "context", ",", "\n", "\"question\"", ":", "question", ",", "\n", "\"answer\"", ":", "answer", ",", "\n", "\"is_impossible\"", ":", "is_impossible", ",", "\n", "}", "\n", "examples", ".", "append", "(", "example", ")", "\n", "", "", "", "return", "examples", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.squad.squad_prepro.flat_squad": [[57, 115], ["squad_prepro.load_squad", "tqdm.auto.tqdm", "len", "context.strip", "question.strip", "entry.get", "entry.get", "squad_prepro.flat_squad.qa_sample"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.squad.squad_prepro.load_squad"], ["", "def", "flat_squad", "(", "path", ",", "is_training", "=", "True", ")", ":", "\n", "    ", "def", "qa_sample", "(", "uid", ",", "context", ",", "question", ",", "answers", ",", "is_impossible", ",", "answer_start", "=", "None", ")", ":", "\n", "        ", "if", "len", "(", "answers", ")", ">", "0", ":", "\n", "            ", "answer_text", "=", "[", "answer", "[", "\"text\"", "]", ".", "strip", "(", ")", "for", "answer", "in", "answers", "]", "\n", "answer_start", "=", "[", "answer", "[", "\"answer_start\"", "]", "for", "answer", "in", "answers", "]", "\n", "", "else", ":", "\n", "            ", "answer_text", "=", "[", "]", "\n", "answer_start", "=", "[", "]", "\n", "", "answers", "=", "{", "\"text\"", ":", "answer_text", ",", "\"answer_start\"", ":", "answer_start", "}", "\n", "\n", "example", "=", "{", "\n", "\"id\"", ":", "uid", ",", "\n", "\"context\"", ":", "context", ".", "strip", "(", ")", ",", "# fix whitespace issues", "\n", "\"question\"", ":", "question", ".", "strip", "(", ")", ",", "# fix whitespace issues", "\n", "\"answer\"", ":", "answers", ",", "\n", "\"is_impossible\"", ":", "is_impossible", ",", "\n", "}", "\n", "return", "example", "\n", "\n", "", "input_data", "=", "load_squad", "(", "path", ")", "\n", "examples", "=", "[", "]", "\n", "for", "entry", "in", "tqdm", "(", "input_data", ")", ":", "\n", "        ", "context", "=", "entry", "[", "\"context\"", "]", "\n", "if", "\"qas\"", "in", "entry", ":", "\n", "            ", "for", "qa_entry", "in", "entry", "[", "\"qas\"", "]", ":", "\n", "                ", "question", "=", "qa_entry", "[", "\"question\"", "]", "\n", "if", "isinstance", "(", "question", ",", "list", ")", ":", "\n", "                    ", "assert", "len", "(", "question", ")", "==", "1", "\n", "question", "=", "question", "[", "0", "]", "\n", "", "uid", "=", "qa_entry", "[", "\"id\"", "]", "\n", "# remove dumplicated answers", "\n", "answers", "=", "list", "(", "set", "(", "qa_entry", ".", "get", "(", "\"answer\"", ",", "[", "]", ")", ")", ")", "\n", "if", "type", "(", "context", ")", "is", "dict", ":", "\n", "                    ", "entities", "=", "context", "[", "\"entities\"", "]", "\n", "context_text", "=", "context", "[", "\"text\"", "]", "\n", "assert", "type", "(", "answers", ")", "is", "list", "\n", "temp_answers", "=", "[", "]", "\n", "ent_strs", "=", "[", "]", "\n", "for", "ent", "in", "entities", ":", "\n", "                        ", "ent_strs", ".", "append", "(", "context_text", "[", "ent", "[", "\"start\"", "]", ":", "ent", "[", "\"end\"", "]", "+", "1", "]", ")", "\n", "", "for", "answer", "in", "answers", ":", "\n", "                        ", "positions", "=", "[", "]", "\n", "for", "ent", "in", "entities", ":", "\n", "                            ", "if", "context_text", "[", "ent", "[", "\"start\"", "]", ":", "ent", "[", "\"end\"", "]", "+", "1", "]", "==", "answer", ":", "\n", "                                ", "positions", ".", "append", "(", "ent", "[", "\"start\"", "]", ")", "\n", "", "", "temp_answers", ".", "append", "(", "{", "\"text\"", ":", "answer", ",", "\"answer_start\"", ":", "positions", "}", ")", "\n", "", "answers", "=", "temp_answers", "\n", "", "is_impossible", "=", "qa_entry", ".", "get", "(", "\"is_impossible\"", ",", "None", ")", "\n", "example", "=", "qa_sample", "(", "uid", ",", "context_text", ",", "question", ",", "answers", ",", "is_impossible", ")", "\n", "examples", ".", "append", "(", "example", ")", "\n", "", "", "else", ":", "\n", "            ", "question", "=", "entry", "[", "\"question\"", "]", "\n", "uid", "=", "entry", "[", "\"id\"", "]", "\n", "answers", "=", "entry", ".", "get", "(", "\"answer\"", ",", "[", "]", ")", "\n", "is_impossible", "=", "entry", ".", "get", "(", "\"is_impossible\"", ",", "None", ")", "\n", "example", "=", "qa_sample", "(", "uid", ",", "context", ",", "question", ",", "answers", ",", "is_impossible", ")", "\n", "examples", ".", "append", "(", "example", ")", "\n", "", "", "return", "examples", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.squad.squad_prepro.search_index": [[117, 156], ["len", "len"], "function", ["None"], ["", "def", "search_index", "(", "\n", "input_ids", ",", "\n", "sequence_ids", ",", "\n", "offsets", ",", "\n", "cls_index", ",", "\n", "start_char", ",", "\n", "end_char", ",", "\n", "pad_on_right", "=", "False", ",", "\n", ")", ":", "\n", "    ", "start_position", ",", "end_position", "=", "cls_index", ",", "cls_index", "\n", "# Start token index of the current span in the text.", "\n", "token_start_index", "=", "0", "\n", "while", "sequence_ids", "[", "token_start_index", "]", "!=", "(", "1", "if", "pad_on_right", "else", "0", ")", ":", "\n", "        ", "token_start_index", "+=", "1", "\n", "# End token index of the current span in the text.", "\n", "", "token_end_index", "=", "len", "(", "input_ids", ")", "-", "1", "\n", "while", "sequence_ids", "[", "token_end_index", "]", "!=", "(", "1", "if", "pad_on_right", "else", "0", ")", ":", "\n", "        ", "token_end_index", "-=", "1", "\n", "\n", "# Detect if the answer is out of the span (in which case this feature is labeled with the CLS index).", "\n", "", "if", "not", "(", "\n", "offsets", "[", "token_start_index", "]", "[", "0", "]", "<=", "start_char", "\n", "and", "offsets", "[", "token_end_index", "]", "[", "1", "]", ">=", "end_char", "\n", ")", ":", "\n", "        ", "start_position", "=", "cls_index", "\n", "end_position", "=", "cls_index", "\n", "", "else", ":", "\n", "# Otherwise move the token_start_index and token_end_index to the two ends of the answer.", "\n", "# Note: we could go after the last offset if the answer is the last word (edge case).", "\n", "        ", "while", "(", "\n", "token_start_index", "<", "len", "(", "offsets", ")", "\n", "and", "offsets", "[", "token_start_index", "]", "[", "0", "]", "<=", "start_char", "\n", ")", ":", "\n", "            ", "token_start_index", "+=", "1", "\n", "", "start_position", "=", "token_start_index", "-", "1", "\n", "while", "offsets", "[", "token_end_index", "]", "[", "1", "]", ">=", "end_char", ":", "\n", "            ", "token_end_index", "-=", "1", "\n", "", "end_position", "=", "token_end_index", "+", "1", "\n", "", "return", "start_position", ",", "end_position", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.squad.squad_prepro.prepare_train_feature": [[158, 286], ["open", "tokenizer", "tokenizer.pop", "tokenizer.pop", "enumerate", "range", "tokenizer.sequence_ids", "input_ids.index", "tokenized_examples[].append", "tokenized_examples[].append", "len", "writer.write", "tokenized_examples[].append", "tokenized_examples[].append", "tokenized_examples[].append", "len", "len", "type", "tokenized_examples[].append", "tokenized_examples[].append", "squad_prepro.search_index", "tokenized_examples[].append", "tokenized_examples[].append", "json.dumps", "squad_prepro.search_index", "start_position.append", "end_position.append", "len", "len", "len"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.squad.squad_prepro.search_index", "home.repos.pwc.inspect_result.namisan_mt-dnn.squad.squad_prepro.search_index"], ["", "def", "prepare_train_feature", "(", "\n", "tokenizer", ",", "\n", "samples", ",", "\n", "output_path", ",", "\n", "data_type", "=", "DataFormat", ".", "CLUE_CLASSIFICATION", ",", "\n", "max_seq_length", "=", "384", ",", "\n", "doc_stride", "=", "128", ",", "\n", "pad_on_right", "=", "True", ",", "\n", "pad_to_max_length", "=", "True", ",", "\n", "label_mapper", "=", "None", ",", "\n", ")", ":", "\n", "    ", "if", "not", "tokenizer", ".", "cls_token", ":", "\n", "# cls_tok_id = tokenizer.eos_token_id", "\n", "        ", "cls_tok_id", "=", "tokenizer", ".", "pad_token_id", "\n", "prefix_pad", "=", "True", "\n", "", "else", ":", "\n", "        ", "cls_tok_id", "=", "tokenizer", ".", "cls_token_id", "\n", "prefix_pad", "=", "False", "\n", "\n", "", "if", "not", "tokenizer", ".", "sep_token", ":", "\n", "        ", "sep_tok_id", "=", "tokenizer", ".", "eos_token_id", "\n", "", "else", ":", "\n", "        ", "sep_tok_id", "=", "tokenizer", ".", "sep_token_id", "\n", "\n", "", "with", "open", "(", "output_path", ",", "\"w\"", ",", "encoding", "=", "\"utf-8\"", ")", "as", "writer", ":", "\n", "        ", "for", "sample", "in", "samples", ":", "\n", "            ", "context", "=", "sample", "[", "\"context\"", "]", "\n", "question", "=", "sample", "[", "\"question\"", "]", "\n", "\n", "if", "pad_on_right", "and", "prefix_pad", ":", "\n", "                ", "question", "=", "tokenizer", ".", "pad_token", "+", "question", "\n", "\n", "# Tokenize our examples with truncation and maybe padding, but keep the overflows using a stride. This results", "\n", "# in one example possible giving several features when a context is long, each of those features having a", "\n", "# context that overlaps a bit the context of the previous feature.", "\n", "", "tokenized_examples", "=", "tokenizer", "(", "\n", "question", "if", "pad_on_right", "else", "context", ",", "\n", "context", "if", "pad_on_right", "else", "question", ",", "\n", "truncation", "=", "\"only_second\"", "if", "pad_on_right", "else", "\"only_first\"", ",", "\n", "max_length", "=", "max_seq_length", ",", "\n", "stride", "=", "doc_stride", ",", "\n", "return_overflowing_tokens", "=", "True", ",", "\n", "return_offsets_mapping", "=", "True", ",", "\n", "padding", "=", "\"max_length\"", "if", "pad_to_max_length", "else", "False", ",", "\n", "verbose", "=", "False", ",", "\n", ")", "\n", "\n", "# Since one example might give us several features if it has a long context, we need a map from a feature to", "\n", "# its corresponding example. This key gives us just that.", "\n", "sample_mapping", "=", "tokenized_examples", ".", "pop", "(", "\"overflow_to_sample_mapping\"", ")", "\n", "# The offset mappings will give us a map from token to character position in the original context. This will", "\n", "# help us compute the start_positions and end_positions.", "\n", "offset_mapping", "=", "tokenized_examples", ".", "pop", "(", "\"offset_mapping\"", ")", "\n", "\n", "# Let's label those examples!", "\n", "tokenized_examples", "[", "\"start_positions\"", "]", "=", "[", "]", "\n", "tokenized_examples", "[", "\"end_positions\"", "]", "=", "[", "]", "\n", "tokenized_examples", "[", "\"id\"", "]", "=", "[", "]", "\n", "tokenized_examples", "[", "\"label\"", "]", "=", "[", "]", "\n", "for", "i", ",", "offsets", "in", "enumerate", "(", "offset_mapping", ")", ":", "\n", "# We will label impossible answers with the index of the CLS token.", "\n", "                ", "input_ids", "=", "tokenized_examples", "[", "\"input_ids\"", "]", "[", "i", "]", "\n", "\n", "# Grab the sequence corresponding to that example (to know what is the context and what is the question).", "\n", "sequence_ids", "=", "tokenized_examples", ".", "sequence_ids", "(", "i", ")", "\n", "\n", "cls_index", "=", "input_ids", ".", "index", "(", "cls_tok_id", ")", "\n", "\n", "# One example can give several spans, this is the index of the example containing this span of text.", "\n", "# sample_index = sample_mapping[i]", "\n", "answers", "=", "sample", "[", "\"answer\"", "]", "\n", "tokenized_examples", "[", "\"id\"", "]", ".", "append", "(", "sample", "[", "\"id\"", "]", ")", "\n", "label", "=", "None", "\n", "if", "sample", "[", "\"is_impossible\"", "]", "is", "not", "None", ":", "\n", "                    ", "label", "=", "1", "if", "sample", "[", "\"is_impossible\"", "]", "else", "0", "\n", "", "tokenized_examples", "[", "\"label\"", "]", ".", "append", "(", "label", ")", "\n", "# If no answers are given, set the cls_index as answer.", "\n", "if", "len", "(", "answers", ")", "==", "0", "or", "len", "(", "answers", "[", "\"answer_start\"", "]", ")", "==", "0", ":", "\n", "                    ", "tokenized_examples", "[", "\"start_positions\"", "]", ".", "append", "(", "cls_index", ")", "\n", "tokenized_examples", "[", "\"end_positions\"", "]", ".", "append", "(", "cls_index", ")", "\n", "", "else", ":", "\n", "# Start/end character index of the answer in the text.", "\n", "                    ", "start_char", "=", "answers", "[", "\"answer_start\"", "]", "[", "0", "]", "\n", "if", "type", "(", "start_char", ")", "is", "list", ":", "\n", "                        ", "start_position", ",", "end_position", "=", "[", "]", ",", "[", "]", "\n", "for", "sc", "in", "start_char", ":", "\n", "                            ", "end_char", "=", "sc", "+", "len", "(", "answers", "[", "\"text\"", "]", "[", "0", "]", ")", "\n", "sp", ",", "ep", "=", "search_index", "(", "\n", "input_ids", ",", "\n", "sequence_ids", ",", "\n", "offsets", ",", "\n", "cls_index", ",", "\n", "sc", ",", "\n", "end_char", ",", "\n", "pad_on_right", "=", "pad_on_right", ",", "\n", ")", "\n", "start_position", ".", "append", "(", "sp", ")", "\n", "end_position", ".", "append", "(", "ep", ")", "\n", "", "tokenized_examples", "[", "\"start_positions\"", "]", ".", "append", "(", "start_position", ")", "\n", "tokenized_examples", "[", "\"end_positions\"", "]", ".", "append", "(", "end_position", ")", "\n", "", "else", ":", "\n", "                        ", "end_char", "=", "start_char", "+", "len", "(", "answers", "[", "\"text\"", "]", "[", "0", "]", ")", "\n", "start_position", ",", "end_position", "=", "search_index", "(", "\n", "input_ids", ",", "\n", "sequence_ids", ",", "\n", "offsets", ",", "\n", "cls_index", ",", "\n", "start_char", ",", "\n", "end_char", ",", "\n", "pad_on_right", "=", "pad_on_right", ",", "\n", ")", "\n", "tokenized_examples", "[", "\"start_positions\"", "]", ".", "append", "(", "start_position", ")", "\n", "tokenized_examples", "[", "\"end_positions\"", "]", ".", "append", "(", "end_position", ")", "\n", "", "tokenized_examples", "[", "\"label\"", "]", ".", "append", "(", "0", ")", "\n", "\n", "", "", "for", "i", "in", "range", "(", "0", ",", "len", "(", "tokenized_examples", "[", "\"input_ids\"", "]", ")", ")", ":", "\n", "                ", "sample", "=", "{", "\n", "\"uid\"", ":", "tokenized_examples", "[", "\"id\"", "]", "[", "i", "]", ",", "\n", "\"token_id\"", ":", "tokenized_examples", "[", "\"input_ids\"", "]", "[", "i", "]", ",", "\n", "\"mask\"", ":", "tokenized_examples", "[", "\"attention_mask\"", "]", "[", "i", "]", ",", "\n", "\"type_id\"", ":", "tokenized_examples", "[", "\"token_type_ids\"", "]", "[", "i", "]", "\n", "if", "\"token_type_ids\"", "in", "tokenized_examples", "\n", "else", "len", "(", "tokenized_examples", "[", "\"input_ids\"", "]", "[", "i", "]", ")", "*", "[", "0", "]", ",", "\n", "\"start_position\"", ":", "tokenized_examples", "[", "\"start_positions\"", "]", "[", "i", "]", ",", "\n", "\"end_position\"", ":", "tokenized_examples", "[", "\"end_positions\"", "]", "[", "i", "]", ",", "\n", "\"label\"", ":", "tokenized_examples", "[", "\"label\"", "]", "[", "i", "]", ",", "\n", "}", "\n", "writer", ".", "write", "(", "\"{}\\n\"", ".", "format", "(", "json", ".", "dumps", "(", "sample", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.squad.squad_prepro.prepare_validation_features": [[289, 391], ["open", "sample.get", "tokenizer", "tokenizer.pop", "tokenizer.pop", "range", "range", "len", "tokenizer.sequence_ids", "input_ids.index", "input_ids.index", "tokenizer.sequence_ids", "tokenized_examples[].append", "tokenized_examples[].append", "tokenized_examples[].append", "tokenized_examples[].append", "len", "writer.write", "json.dumps", "len"], "function", ["None"], ["", "", "", "", "def", "prepare_validation_features", "(", "\n", "tokenizer", ",", "\n", "samples", ",", "\n", "output_path", ",", "\n", "max_seq_length", "=", "384", ",", "\n", "doc_stride", "=", "128", ",", "\n", "pad_on_right", "=", "True", ",", "\n", "pad_to_max_length", "=", "True", ",", "\n", "label_mapper", "=", "None", ",", "\n", ")", ":", "\n", "# Tokenize our examples with truncation and maybe padding, but keep the overflows using a stride. This results", "\n", "# in one example possible giving several features when a context is long, each of those features having a", "\n", "# context that overlaps a bit the context of the previous feature.", "\n", "    ", "if", "not", "tokenizer", ".", "cls_token", ":", "\n", "# cls_tok_id = tokenizer.eos_token_id", "\n", "        ", "cls_tok_id", "=", "tokenizer", ".", "pad_token_id", "\n", "prefix_pad", "=", "True", "\n", "", "else", ":", "\n", "        ", "cls_tok_id", "=", "tokenizer", ".", "cls_token_id", "\n", "prefix_pad", "=", "False", "\n", "\n", "", "if", "not", "tokenizer", ".", "sep_token", ":", "\n", "        ", "sep_tok_id", "=", "tokenizer", ".", "eos_token_id", "\n", "", "else", ":", "\n", "        ", "sep_tok_id", "=", "tokenizer", ".", "sep_token_id", "\n", "\n", "", "with", "open", "(", "output_path", ",", "\"w\"", ",", "encoding", "=", "\"utf-8\"", ")", "as", "writer", ":", "\n", "        ", "for", "sample", "in", "samples", ":", "\n", "            ", "context", "=", "sample", "[", "\"context\"", "]", "\n", "question", "=", "sample", "[", "\"question\"", "]", "\n", "answer", "=", "sample", ".", "get", "(", "\"answer\"", ")", "\n", "\n", "if", "pad_on_right", "and", "prefix_pad", ":", "\n", "                ", "question", "=", "tokenizer", ".", "pad_token", "+", "question", "\n", "\n", "# Tokenize our examples with truncation and maybe padding, but keep the overflows using a stride. This results", "\n", "# in one example possible giving several features when a context is long, each of those features having a", "\n", "# context that overlaps a bit the context of the previous feature.", "\n", "", "tokenized_examples", "=", "tokenizer", "(", "\n", "question", "if", "pad_on_right", "else", "context", ",", "\n", "context", "if", "pad_on_right", "else", "question", ",", "\n", "truncation", "=", "\"only_second\"", "if", "pad_on_right", "else", "\"only_first\"", ",", "\n", "max_length", "=", "max_seq_length", ",", "\n", "stride", "=", "doc_stride", ",", "\n", "return_overflowing_tokens", "=", "True", ",", "\n", "return_offsets_mapping", "=", "True", ",", "\n", "padding", "=", "\"max_length\"", "if", "pad_to_max_length", "else", "False", ",", "\n", "verbose", "=", "False", ",", "\n", ")", "\n", "\n", "# Since one example might give us several features if it has a long context, we need a map from a feature to", "\n", "# its corresponding example. This key gives us just that.", "\n", "sample_mapping", "=", "tokenized_examples", ".", "pop", "(", "\"overflow_to_sample_mapping\"", ")", "\n", "\n", "# For evaluation, we will need to convert our predictions to substrings of the context, so we keep the", "\n", "# corresponding example_id and we will store the offset mappings.", "\n", "tokenized_examples", "[", "\"start_positions\"", "]", "=", "[", "]", "\n", "tokenized_examples", "[", "\"end_positions\"", "]", "=", "[", "]", "\n", "tokenized_examples", "[", "\"id\"", "]", "=", "[", "]", "\n", "tokenized_examples", "[", "\"label\"", "]", "=", "[", "]", "\n", "tokenized_examples", "[", "\"null_ans_index\"", "]", "=", "[", "]", "\n", "label", "=", "None", "\n", "offset_mapping", "=", "tokenized_examples", ".", "pop", "(", "\"offset_mapping\"", ")", "\n", "\n", "for", "i", "in", "range", "(", "len", "(", "tokenized_examples", "[", "\"input_ids\"", "]", ")", ")", ":", "\n", "# Grab the sequence corresponding to that example (to know what is the context and what is the question).", "\n", "                ", "sequence_ids", "=", "tokenized_examples", ".", "sequence_ids", "(", "i", ")", "\n", "context_index", "=", "1", "if", "pad_on_right", "else", "0", "\n", "\n", "input_ids", "=", "tokenized_examples", "[", "\"input_ids\"", "]", "[", "i", "]", "\n", "cls_index", "=", "input_ids", ".", "index", "(", "cls_tok_id", ")", "\n", "sep_index", "=", "input_ids", ".", "index", "(", "sep_tok_id", ")", "\n", "\n", "# Grab the sequence corresponding to that example (to know what is the context and what is the question).", "\n", "sequence_ids", "=", "tokenized_examples", ".", "sequence_ids", "(", "i", ")", "\n", "tokenized_examples", "[", "\"id\"", "]", ".", "append", "(", "sample", "[", "\"id\"", "]", ")", "\n", "# Set to None the offset_mapping that are not part of the context so it's easy to determine if a token", "\n", "# position is part of the context or not.", "\n", "\n", "tokenized_examples", "[", "\"id\"", "]", ".", "append", "(", "sample", "[", "\"id\"", "]", ")", "\n", "if", "sample", "[", "\"is_impossible\"", "]", "is", "not", "None", ":", "\n", "                    ", "label", "=", "1", "if", "sample", "[", "\"is_impossible\"", "]", "else", "0", "\n", "answer", "[", "\"is_impossible\"", "]", "=", "sample", "[", "\"is_impossible\"", "]", "\n", "", "tokenized_examples", "[", "\"label\"", "]", ".", "append", "(", "label", ")", "\n", "tokenized_examples", "[", "\"null_ans_index\"", "]", ".", "append", "(", "cls_index", ")", "\n", "\n", "# tokenized_examples[\"offset_mapping\"] = offset_mapping", "\n", "", "for", "i", "in", "range", "(", "0", ",", "len", "(", "tokenized_examples", "[", "\"input_ids\"", "]", ")", ")", ":", "\n", "                ", "sample", "=", "{", "\n", "\"uid\"", ":", "tokenized_examples", "[", "\"id\"", "]", "[", "i", "]", ",", "\n", "\"token_id\"", ":", "tokenized_examples", "[", "\"input_ids\"", "]", "[", "i", "]", ",", "\n", "\"mask\"", ":", "tokenized_examples", "[", "\"attention_mask\"", "]", "[", "i", "]", ",", "\n", "\"type_id\"", ":", "tokenized_examples", "[", "\"token_type_ids\"", "]", "[", "i", "]", "\n", "if", "\"token_type_ids\"", "in", "tokenized_examples", "\n", "else", "len", "(", "tokenized_examples", "[", "\"input_ids\"", "]", "[", "i", "]", ")", "*", "[", "0", "]", ",", "\n", "\"offset_mapping\"", ":", "offset_mapping", "[", "i", "]", ",", "\n", "\"null_ans_index\"", ":", "tokenized_examples", "[", "\"null_ans_index\"", "]", "[", "i", "]", ",", "\n", "\"context\"", ":", "context", ",", "\n", "\"answer\"", ":", "answer", ",", "\n", "\"label\"", ":", "tokenized_examples", "[", "\"label\"", "]", "[", "i", "]", ",", "\n", "}", "\n", "writer", ".", "write", "(", "\"{}\\n\"", ".", "format", "(", "json", ".", "dumps", "(", "sample", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.squad.squad_prepro.parse_args": [[393, 411], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.ner.prepro.parse_args"], ["", "", "", "", "def", "parse_args", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", "description", "=", "\"Preprocessing MRC dataset.\"", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--model\"", ",", "\n", "type", "=", "str", ",", "\n", "default", "=", "\"bert-base-uncased\"", ",", "\n", "help", "=", "\"support all BERT, XLNET and ROBERTA family supported by HuggingFace Transformers\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--root_dir\"", ",", "type", "=", "str", ",", "default", "=", "\"data/canonical_data\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--cache_dir\"", ",", "type", "=", "str", ",", "default", "=", "\".cache\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--model_revision\"", ",", "type", "=", "str", ",", "default", "=", "None", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--task_def\"", ",", "type", "=", "str", ",", "default", "=", "\"experiments/squad/squad_task_def.yml\"", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--max_seq_length\"", ",", "type", "=", "int", ",", "default", "=", "MAX_SEQ_LEN", ")", "\n", "parser", ".", "add_argument", "(", "\"--doc_stride\"", ",", "type", "=", "int", ",", "default", "=", "DOC_STRIDE", ")", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "return", "args", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.squad.squad_prepro.main": [[413, 488], ["os.path.exists", "[].upper", "literal_model_type.lower.lower", "transformers.AutoTokenizer.from_pretrained", "os.path.join", "experiments.exp_def.TaskDefs", "experiments.exp_def.TaskDefs.get_task_names", "args.model.split", "os.path.isdir", "os.mkdir", "experiments.exp_def.TaskDefs.get_task_def", "logger.info", "print", "os.path.join", "print", "logger.warning", "squad_prepro.flat_squad", "os.path.join", "logger.info", "suffix.split", "os.path.exists", "logger.warning", "sys.exit", "squad_prepro.prepare_train_feature", "squad_prepro.prepare_validation_features"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.exp_def.TaskDefs.get_task_names", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.exp_def.TaskDefs.get_task_def", "home.repos.pwc.inspect_result.namisan_mt-dnn.squad.squad_prepro.flat_squad", "home.repos.pwc.inspect_result.namisan_mt-dnn.squad.squad_prepro.prepare_train_feature", "home.repos.pwc.inspect_result.namisan_mt-dnn.squad.squad_prepro.prepare_validation_features"], ["", "def", "main", "(", "args", ")", ":", "\n", "# hyper param", "\n", "    ", "root", "=", "args", ".", "root_dir", "\n", "assert", "os", ".", "path", ".", "exists", "(", "root", ")", "\n", "suffix", "=", "args", ".", "model", ".", "split", "(", "\"/\"", ")", "[", "-", "1", "]", "\n", "literal_model_type", "=", "suffix", ".", "split", "(", "\"-\"", ")", "[", "0", "]", ".", "upper", "(", ")", "\n", "\n", "encoder_model", "=", "EncoderModelType", "[", "literal_model_type", "]", "\n", "literal_model_type", "=", "literal_model_type", ".", "lower", "(", ")", "\n", "mt_dnn_suffix", "=", "literal_model_type", "\n", "if", "\"base\"", "in", "args", ".", "model", ":", "\n", "        ", "mt_dnn_suffix", "+=", "\"_base\"", "\n", "", "elif", "\"large\"", "in", "args", ".", "model", ":", "\n", "        ", "mt_dnn_suffix", "+=", "\"_large\"", "\n", "\n", "# tokenizer", "\n", "", "tokenizer", "=", "AutoTokenizer", ".", "from_pretrained", "(", "\n", "args", ".", "model", ",", "\n", "cache_dir", "=", "args", ".", "cache_dir", ",", "\n", "use_fast", "=", "True", ",", "\n", "from_slow", "=", "True", ",", "\n", "revision", "=", "args", ".", "model_revision", ",", "\n", ")", "\n", "# Padding side determines if we do (question|context) or (context|question).", "\n", "pad_on_right", "=", "tokenizer", ".", "padding_side", "==", "\"right\"", "\n", "\n", "if", "\"uncased\"", "in", "args", ".", "model", ":", "\n", "        ", "mt_dnn_suffix", "=", "\"{}_uncased\"", ".", "format", "(", "mt_dnn_suffix", ")", "\n", "", "else", ":", "\n", "        ", "mt_dnn_suffix", "=", "\"{}_cased\"", ".", "format", "(", "mt_dnn_suffix", ")", "\n", "\n", "", "mt_dnn_root", "=", "os", ".", "path", ".", "join", "(", "root", ",", "mt_dnn_suffix", ")", "\n", "if", "not", "os", ".", "path", ".", "isdir", "(", "mt_dnn_root", ")", ":", "\n", "        ", "os", ".", "mkdir", "(", "mt_dnn_root", ")", "\n", "\n", "", "task_defs", "=", "TaskDefs", "(", "args", ".", "task_def", ")", "\n", "\n", "for", "task", "in", "task_defs", ".", "get_task_names", "(", ")", ":", "\n", "        ", "task_def", "=", "task_defs", ".", "get_task_def", "(", "task", ")", "\n", "logger", ".", "info", "(", "\"Task %s\"", "%", "task", ")", "\n", "for", "split_name", "in", "task_def", ".", "split_names", ":", "\n", "            ", "print", "(", "root", ")", "\n", "file_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"%s_%s.json\"", "%", "(", "task", ",", "split_name", ")", ")", "\n", "print", "(", "file_path", ")", "\n", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "file_path", ")", ":", "\n", "                ", "logger", ".", "warning", "(", "\"File %s doesnot exit\"", ")", "\n", "sys", ".", "exit", "(", "1", ")", "\n", "", "logger", ".", "warning", "(", "\"processing %s\"", "%", "file_path", ")", "\n", "is_training", "=", "True", "\n", "if", "not", "\"train\"", "in", "split_name", ":", "\n", "                ", "is_training", "=", "False", "\n", "\n", "", "rows", "=", "flat_squad", "(", "file_path", ",", "is_training", ")", "\n", "dump_path", "=", "os", ".", "path", ".", "join", "(", "mt_dnn_root", ",", "\"%s_%s.json\"", "%", "(", "task", ",", "split_name", ")", ")", "\n", "logger", ".", "info", "(", "dump_path", ")", "\n", "if", "is_training", ":", "\n", "                ", "prepare_train_feature", "(", "\n", "tokenizer", ",", "\n", "rows", ",", "\n", "dump_path", ",", "\n", "pad_on_right", "=", "pad_on_right", ",", "\n", "label_mapper", "=", "task_def", ".", "label_vocab", ",", "\n", "max_seq_length", "=", "args", ".", "max_seq_length", ",", "\n", "doc_stride", "=", "args", ".", "doc_stride", ",", "\n", ")", "\n", "", "else", ":", "\n", "                ", "prepare_validation_features", "(", "\n", "tokenizer", ",", "\n", "rows", ",", "\n", "dump_path", ",", "\n", "pad_on_right", "=", "pad_on_right", ",", "\n", "label_mapper", "=", "task_def", ".", "label_vocab", ",", "\n", "max_seq_length", "=", "args", ".", "max_seq_length", ",", "\n", "doc_stride", "=", "args", ".", "doc_stride", ",", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.xnli.xnli_eval.compute_acc": [[6, 8], ["sklearn.metrics.accuracy_score"], "function", ["None"], ["def", "compute_acc", "(", "predicts", ",", "labels", ")", ":", "\n", "    ", "return", "100.0", "*", "accuracy_score", "(", "labels", ",", "predicts", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.xnli.xnli_eval.load": [[10, 13], ["open", "json.load"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load"], ["", "def", "load", "(", "path", ")", ":", "\n", "    ", "with", "open", "(", "path", ",", "\"r\"", ")", "as", "f", ":", "\n", "        ", "return", "json", ".", "load", "(", "f", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.xnli.xnli_eval.compute": [[15, 36], ["enumerate", "print", "lang_map.items", "print", "str", "grounds.append", "machines.append", "xnli_eval.compute_acc", "xnli_eval.compute_acc", "print", "len", "len"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.xnli.xnli_eval.compute_acc", "home.repos.pwc.inspect_result.namisan_mt-dnn.xnli.xnli_eval.compute_acc"], ["", "", "def", "compute", "(", "scores", ",", "labels", ")", ":", "\n", "    ", "lang_map", "=", "labels", "[", "\"lang_map\"", "]", "\n", "label_map", "=", "labels", "[", "\"label_map\"", "]", "\n", "uids", "=", "scores", "[", "\"uids\"", "]", "\n", "predictions", "=", "scores", "[", "\"predictions\"", "]", "\n", "grounds", "=", "[", "]", "\n", "machines", "=", "[", "]", "\n", "predictions_map", "=", "{", "}", "\n", "for", "uid", ",", "pred", "in", "enumerate", "(", "predictions", ")", ":", "\n", "        ", "uid", "=", "str", "(", "uid", ")", "\n", "grounds", ".", "append", "(", "pred", ")", "\n", "machines", ".", "append", "(", "label_map", "[", "uid", "]", ")", "\n", "predictions_map", "[", "uid", "]", "=", "pred", "\n", "", "metrics", "=", "{", "\"all\"", ":", "compute_acc", "(", "machines", ",", "grounds", ")", "}", "\n", "print", "(", "\"total size: {}\"", ".", "format", "(", "len", "(", "machines", ")", ")", ")", "\n", "for", "lan", ",", "subuids", "in", "lang_map", ".", "items", "(", ")", ":", "\n", "        ", "sub_machine", "=", "[", "predictions_map", "[", "i", "]", "for", "i", "in", "subuids", "]", "\n", "sub_ground", "=", "[", "label_map", "[", "i", "]", "for", "i", "in", "subuids", "]", "\n", "metrics", "[", "lan", "]", "=", "compute_acc", "(", "sub_machine", ",", "sub_ground", ")", "\n", "print", "(", "\"size of {}: {}\"", ".", "format", "(", "lan", ",", "len", "(", "sub_machine", ")", ")", ")", "\n", "", "print", "(", "metrics", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.xnli.xnli_prepro.load_xnli": [[15, 41], ["open", "line.strip().split", "rows.append", "pdb.set_trace", "line.strip"], "function", ["None"], ["def", "load_xnli", "(", "file", ",", "header", "=", "True", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "if", "header", ":", "\n", "                ", "header", "=", "False", "\n", "continue", "\n", "", "blocks", "=", "line", ".", "strip", "(", ")", ".", "split", "(", "\"\\t\"", ")", "\n", "if", "blocks", "[", "1", "]", "==", "\"-\"", ":", "\n", "                ", "continue", "\n", "", "lab", "=", "blocks", "[", "1", "]", "\n", "if", "lab", "is", "None", ":", "\n", "                ", "import", "pdb", "\n", "\n", "pdb", ".", "set_trace", "(", ")", "\n", "", "sample", "=", "{", "\n", "\"uid\"", ":", "blocks", "[", "9", "]", ",", "\n", "\"premise\"", ":", "blocks", "[", "6", "]", ",", "\n", "\"hypothesis\"", ":", "blocks", "[", "7", "]", ",", "\n", "\"label\"", ":", "lab", ",", "\n", "\"lang\"", ":", "blocks", "[", "0", "]", ",", "\n", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "cnt", "+=", "1", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.xnli.xnli_prepro.parse_args": [[43, 49], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.ner.prepro.parse_args"], ["", "def", "parse_args", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", "description", "=", "\"Preprocessing XNLI dataset.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--seed\"", ",", "type", "=", "int", ",", "default", "=", "13", ")", "\n", "parser", ".", "add_argument", "(", "\"--root_dir\"", ",", "type", "=", "str", ",", "default", "=", "\"data\"", ")", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "return", "args", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.xnli.xnli_prepro.main": [[51, 82], ["os.path.exists", "os.path.join", "os.path.join", "xnli_prepro.load_xnli", "xnli_prepro.load_xnli", "logger.info", "logger.info", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.isdir", "os.mkdir", "len", "len"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.xnli.extract_cat.load_xnli", "home.repos.pwc.inspect_result.namisan_mt-dnn.xnli.extract_cat.load_xnli", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows"], ["", "def", "main", "(", "args", ")", ":", "\n", "    ", "root", "=", "args", ".", "root_dir", "\n", "assert", "os", ".", "path", ".", "exists", "(", "root", ")", "\n", "\n", "######################################", "\n", "# XNLI/SciTail Tasks", "\n", "######################################", "\n", "\n", "xnli_dev_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"XNLI/xnli.dev.tsv\"", ")", "\n", "xnli_test_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"XNLI/xnli.test.tsv\"", ")", "\n", "\n", "######################################", "\n", "# Loading DATA", "\n", "######################################", "\n", "\n", "xnli_dev_data", "=", "load_xnli", "(", "xnli_dev_path", ")", "\n", "xnli_test_data", "=", "load_xnli", "(", "xnli_test_path", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} XNLI train samples\"", ".", "format", "(", "len", "(", "xnli_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} XNLI test samples\"", ".", "format", "(", "len", "(", "xnli_test_data", ")", ")", ")", "\n", "\n", "canonical_data_suffix", "=", "\"canonical_data\"", "\n", "canonical_data_root", "=", "os", ".", "path", ".", "join", "(", "root", ",", "canonical_data_suffix", ")", "\n", "if", "not", "os", ".", "path", ".", "isdir", "(", "canonical_data_root", ")", ":", "\n", "        ", "os", ".", "mkdir", "(", "canonical_data_root", ")", "\n", "\n", "# BUILD XNLI", "\n", "", "xnli_dev_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"xnli_dev.tsv\"", ")", "\n", "xnli_test_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"xnli_test.tsv\"", ")", "\n", "dump_rows", "(", "xnli_dev_data", ",", "xnli_dev_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "xnli_test_data", ",", "xnli_test_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "logger", ".", "info", "(", "\"done with XNLI\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.xnli.extract_cat.load_xnli": [[5, 28], ["collections.defaultdict", "open", "print", "line.strip().split", "str", "lang_dict[].append", "pdb.set_trace", "line.strip"], "function", ["None"], ["def", "load_xnli", "(", "file", ",", "header", "=", "True", ")", ":", "\n", "    ", "lang_dict", "=", "collections", ".", "defaultdict", "(", "list", ")", "\n", "label_dict", "=", "{", "}", "\n", "cnt", "=", "0", "\n", "label_map", "=", "{", "\"contradiction\"", ":", "0", ",", "\"neutral\"", ":", "1", ",", "\"entailment\"", ":", "2", "}", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "if", "header", ":", "\n", "                ", "header", "=", "False", "\n", "continue", "\n", "", "blocks", "=", "line", ".", "strip", "(", ")", ".", "split", "(", "\"\\t\"", ")", "\n", "# if blocks[1] == '-': continue", "\n", "lab", "=", "label_map", "[", "blocks", "[", "1", "]", "]", "\n", "if", "lab", "is", "None", ":", "\n", "                ", "import", "pdb", "\n", "\n", "pdb", ".", "set_trace", "(", ")", "\n", "", "uid", "=", "str", "(", "cnt", ")", "\n", "label_dict", "[", "uid", "]", "=", "lab", "\n", "lang_dict", "[", "blocks", "[", "0", "]", "]", ".", "append", "(", "uid", ")", "\n", "cnt", "+=", "1", "\n", "", "print", "(", "cnt", ")", "\n", "", "return", "lang_dict", ",", "label_dict", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.load_data": [[20, 40], ["open", "line.strip().split", "rows.append", "len", "line.strip", "str", "str"], "function", ["None"], ["def", "load_data", "(", "file", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "is_single_sentence", "=", "False", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "blocks", "=", "line", ".", "strip", "(", ")", ".", "split", "(", "\"|||\"", ")", "\n", "if", "len", "(", "blocks", ")", "==", "2", ":", "\n", "                ", "sample", "=", "{", "\n", "\"uid\"", ":", "str", "(", "cnt", ")", ",", "\n", "\"premise\"", ":", "blocks", "[", "0", "]", ",", "\n", "\"hypothesis\"", ":", "blocks", "[", "1", "]", ",", "\n", "\"label\"", ":", "0", ",", "\n", "}", "\n", "", "else", ":", "\n", "                ", "is_single_sentence", "=", "True", "\n", "sample", "=", "{", "\"uid\"", ":", "str", "(", "cnt", ")", ",", "\"premise\"", ":", "blocks", "[", "0", "]", ",", "\"label\"", ":", "0", "}", "\n", "", "rows", ".", "append", "(", "sample", ")", "\n", "cnt", "+=", "1", "\n", "", "", "return", "rows", ",", "is_single_sentence", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.build_data": [[42, 73], ["enumerate", "tokenizer", "rows.append", "len"], "function", ["None"], ["", "def", "build_data", "(", "data", ",", "max_seq_len", ",", "is_train", "=", "True", ",", "tokenizer", "=", "None", ")", ":", "\n", "    ", "\"\"\"Build data of sentence pair tasks\"\"\"", "\n", "rows", "=", "[", "]", "\n", "for", "idx", ",", "sample", "in", "enumerate", "(", "data", ")", ":", "\n", "        ", "ids", "=", "sample", "[", "\"uid\"", "]", "\n", "label", "=", "sample", "[", "\"label\"", "]", "\n", "inputs", "=", "tokenizer", "(", "\n", "sample", "[", "\"premise\"", "]", ",", "\n", "sample", "[", "\"hypothesis\"", "]", ",", "\n", "add_special_tokens", "=", "True", ",", "\n", "max_length", "=", "max_seq_len", ",", "\n", "truncation", "=", "True", ",", "\n", "padding", "=", "False", ",", "\n", ")", "\n", "input_ids", "=", "inputs", "[", "\"input_ids\"", "]", "\n", "token_type_ids", "=", "(", "\n", "inputs", "[", "\"token_type_ids\"", "]", "if", "\"token_type_ids\"", "in", "inputs", "else", "[", "0", "]", "*", "len", "(", "input_ids", ")", "\n", ")", "\n", "\n", "# The mask has 1 for real tokens and 0 for padding tokens. Only real", "\n", "# tokens are attended to.", "\n", "attention_mask", "=", "inputs", "[", "\"attention_mask\"", "]", "\n", "feature", "=", "{", "\n", "\"uid\"", ":", "ids", ",", "\n", "\"label\"", ":", "label", ",", "\n", "\"token_id\"", ":", "input_ids", ",", "\n", "\"type_id\"", ":", "token_type_ids", ",", "\n", "#\"tokens\": [\"[CLS]\"] + sample[\"premise\"] + [\"[SEP]\"] + sample[\"hypothesis\"] + [\"[SEP]\"],", "\n", "}", "\n", "rows", ".", "append", "(", "feature", ")", "\n", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.build_data_single": [[75, 106], ["enumerate", "tokenizer", "rows.append", "len"], "function", ["None"], ["", "def", "build_data_single", "(", "data", ",", "max_seq_len", ",", "tokenizer", "=", "None", ")", ":", "\n", "    ", "\"\"\"Build data of single sentence tasks\"\"\"", "\n", "rows", "=", "[", "]", "\n", "for", "idx", ",", "sample", "in", "enumerate", "(", "data", ")", ":", "\n", "        ", "ids", "=", "sample", "[", "\"uid\"", "]", "\n", "label", "=", "sample", "[", "\"label\"", "]", "\n", "inputs", "=", "tokenizer", "(", "\n", "sample", "[", "\"premise\"", "]", ",", "\n", "None", ",", "\n", "add_special_tokens", "=", "True", ",", "\n", "max_length", "=", "max_seq_len", ",", "\n", "truncation", "=", "True", ",", "\n", "padding", "=", "False", ",", "\n", ")", "\n", "input_ids", "=", "inputs", "[", "\"input_ids\"", "]", "\n", "token_type_ids", "=", "(", "\n", "inputs", "[", "\"token_type_ids\"", "]", "if", "\"token_type_ids\"", "in", "inputs", "else", "[", "0", "]", "*", "len", "(", "input_ids", ")", "\n", ")", "\n", "\n", "# The mask has 1 for real tokens and 0 for padding tokens. Only real", "\n", "# tokens are attended to.", "\n", "attention_mask", "=", "inputs", "[", "\"attention_mask\"", "]", "\n", "\n", "features", "=", "{", "\n", "\"uid\"", ":", "ids", ",", "\n", "\"label\"", ":", "label", ",", "\n", "\"token_id\"", ":", "input_ids", ",", "\n", "\"type_id\"", ":", "token_type_ids", ",", "\n", "}", "\n", "rows", ".", "append", "(", "features", ")", "\n", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.model_config": [[108, 144], ["parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument"], "function", ["None"], ["", "def", "model_config", "(", "parser", ")", ":", "\n", "    ", "parser", ".", "add_argument", "(", "\"--update_bert_opt\"", ",", "default", "=", "0", ",", "type", "=", "int", ")", "\n", "parser", ".", "add_argument", "(", "\"--multi_gpu_on\"", ",", "action", "=", "\"store_true\"", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--mem_cum_type\"", ",", "type", "=", "str", ",", "default", "=", "\"simple\"", ",", "help", "=", "\"bilinear/simple/defualt\"", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--answer_num_turn\"", ",", "type", "=", "int", ",", "default", "=", "5", ")", "\n", "parser", ".", "add_argument", "(", "\"--answer_mem_drop_p\"", ",", "type", "=", "float", ",", "default", "=", "0.1", ")", "\n", "parser", ".", "add_argument", "(", "\"--answer_att_hidden_size\"", ",", "type", "=", "int", ",", "default", "=", "128", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--answer_att_type\"", ",", "\n", "type", "=", "str", ",", "\n", "default", "=", "\"bilinear\"", ",", "\n", "help", "=", "\"bilinear/simple/defualt\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--answer_rnn_type\"", ",", "type", "=", "str", ",", "default", "=", "\"gru\"", ",", "help", "=", "\"rnn/gru/lstm\"", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--answer_sum_att_type\"", ",", "\n", "type", "=", "str", ",", "\n", "default", "=", "\"bilinear\"", ",", "\n", "help", "=", "\"bilinear/simple/defualt\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--answer_merge_opt\"", ",", "type", "=", "int", ",", "default", "=", "1", ")", "\n", "parser", ".", "add_argument", "(", "\"--answer_mem_type\"", ",", "type", "=", "int", ",", "default", "=", "1", ")", "\n", "parser", ".", "add_argument", "(", "\"--answer_dropout_p\"", ",", "type", "=", "float", ",", "default", "=", "0.1", ")", "\n", "parser", ".", "add_argument", "(", "\"--answer_weight_norm_on\"", ",", "action", "=", "\"store_true\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--dump_state_on\"", ",", "action", "=", "\"store_true\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--answer_opt\"", ",", "type", "=", "int", ",", "default", "=", "0", ",", "help", "=", "\"0,1\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--label_size\"", ",", "type", "=", "str", ",", "default", "=", "\"3\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--mtl_opt\"", ",", "type", "=", "int", ",", "default", "=", "0", ")", "\n", "parser", ".", "add_argument", "(", "\"--ratio\"", ",", "type", "=", "float", ",", "default", "=", "0", ")", "\n", "parser", ".", "add_argument", "(", "\"--mix_opt\"", ",", "type", "=", "int", ",", "default", "=", "0", ")", "\n", "parser", ".", "add_argument", "(", "\"--init_ratio\"", ",", "type", "=", "float", ",", "default", "=", "1", ")", "\n", "return", "parser", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.train_config": [[146, 203], ["parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "torch.cuda.is_available"], "function", ["None"], ["", "def", "train_config", "(", "parser", ")", ":", "\n", "    ", "parser", ".", "add_argument", "(", "\n", "\"--cuda\"", ",", "\n", "type", "=", "bool", ",", "\n", "default", "=", "torch", ".", "cuda", ".", "is_available", "(", ")", ",", "\n", "help", "=", "\"whether to use GPU acceleration.\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--optimizer\"", ",", "\n", "default", "=", "\"adamax\"", ",", "\n", "help", "=", "\"supported optimizer: adamax, sgd, adadelta, adam\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--grad_clipping\"", ",", "type", "=", "float", ",", "default", "=", "0", ")", "\n", "parser", ".", "add_argument", "(", "\"--global_grad_clipping\"", ",", "type", "=", "float", ",", "default", "=", "1.0", ")", "\n", "parser", ".", "add_argument", "(", "\"--weight_decay\"", ",", "type", "=", "float", ",", "default", "=", "0", ")", "\n", "parser", ".", "add_argument", "(", "\"--learning_rate\"", ",", "type", "=", "float", ",", "default", "=", "5e-5", ")", "\n", "parser", ".", "add_argument", "(", "\"--momentum\"", ",", "type", "=", "float", ",", "default", "=", "0", ")", "\n", "parser", ".", "add_argument", "(", "\"--warmup\"", ",", "type", "=", "float", ",", "default", "=", "0.1", ")", "\n", "parser", ".", "add_argument", "(", "\"--warmup_schedule\"", ",", "type", "=", "str", ",", "default", "=", "\"warmup_linear\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--vb_dropout\"", ",", "action", "=", "\"store_false\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--dropout_p\"", ",", "type", "=", "float", ",", "default", "=", "0.1", ")", "\n", "parser", ".", "add_argument", "(", "\"--dropout_w\"", ",", "type", "=", "float", ",", "default", "=", "0.000", ")", "\n", "parser", ".", "add_argument", "(", "\"--bert_dropout_p\"", ",", "type", "=", "float", ",", "default", "=", "0.1", ")", "\n", "parser", ".", "add_argument", "(", "\"--ema_opt\"", ",", "type", "=", "int", ",", "default", "=", "0", ")", "\n", "parser", ".", "add_argument", "(", "\"--ema_gamma\"", ",", "type", "=", "float", ",", "default", "=", "0.995", ")", "\n", "# scheduler", "\n", "parser", ".", "add_argument", "(", "\n", "\"--have_lr_scheduler\"", ",", "dest", "=", "\"have_lr_scheduler\"", ",", "action", "=", "\"store_false\"", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--multi_step_lr\"", ",", "type", "=", "str", ",", "default", "=", "\"10,20,30\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--freeze_layers\"", ",", "type", "=", "int", ",", "default", "=", "-", "1", ")", "\n", "parser", ".", "add_argument", "(", "\"--embedding_opt\"", ",", "type", "=", "int", ",", "default", "=", "0", ")", "\n", "parser", ".", "add_argument", "(", "\"--lr_gamma\"", ",", "type", "=", "float", ",", "default", "=", "0.5", ")", "\n", "parser", ".", "add_argument", "(", "\"--bert_l2norm\"", ",", "type", "=", "float", ",", "default", "=", "0.0", ")", "\n", "parser", ".", "add_argument", "(", "\"--scheduler_type\"", ",", "type", "=", "str", ",", "default", "=", "\"ms\"", ",", "help", "=", "\"ms/rop/exp\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--output_dir\"", ",", "default", "=", "\"checkpoint\"", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--seed\"", ",", "\n", "type", "=", "int", ",", "\n", "default", "=", "2018", ",", "\n", "help", "=", "\"random seed for data shuffling, embedding init, etc.\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--encoder_type\"", ",", "type", "=", "int", ",", "default", "=", "EncoderModelType", ".", "BERT", ")", "\n", "# fp 16", "\n", "parser", ".", "add_argument", "(", "\n", "\"--fp16\"", ",", "\n", "action", "=", "\"store_true\"", ",", "\n", "help", "=", "\"Whether to use 16-bit (mixed) precision (through NVIDIA apex) instead of 32-bit\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--fp16_opt_level\"", ",", "\n", "type", "=", "str", ",", "\n", "default", "=", "\"O1\"", ",", "\n", "help", "=", "\"For fp16: Apex AMP optimization level selected in ['O0', 'O1', 'O2', and 'O3'].\"", "\n", "\"See details at https://nvidia.github.io/apex/amp.html\"", ",", "\n", ")", "\n", "return", "parser", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.set_config": [[205, 227], ["parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument", "parser.add_argument"], "function", ["None"], ["", "def", "set_config", "(", "parser", ")", ":", "\n", "    ", "parser", ".", "add_argument", "(", "\"--finput\"", ",", "default", "=", "None", ",", "type", "=", "str", ",", "required", "=", "True", ")", "\n", "parser", ".", "add_argument", "(", "\"--foutput\"", ",", "default", "=", "None", ",", "type", "=", "str", ",", "required", "=", "True", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--bert_model\"", ",", "\n", "default", "=", "None", ",", "\n", "type", "=", "str", ",", "\n", "required", "=", "True", ",", "\n", "help", "=", "\"Bert model: bert-base-uncased\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--checkpoint\"", ",", "default", "=", "None", ",", "type", "=", "str", ",", "required", "=", "True", ",", "help", "=", "\"model parameters\"", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--do_lower_case\"", ",", "\n", "action", "=", "\"store_true\"", ",", "\n", "help", "=", "\"Set this flag if you are using an uncased model.\"", ",", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--layers\"", ",", "default", "=", "\"10,11\"", ",", "type", "=", "str", ")", "\n", "parser", ".", "add_argument", "(", "\"--max_seq_length\"", ",", "default", "=", "512", ",", "type", "=", "int", ",", "help", "=", "\"\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--batch_size\"", ",", "default", "=", "4", ",", "type", "=", "int", ")", "\n", "parser", ".", "add_argument", "(", "\"--transformer_cache\"", ",", "default", "=", "\".cache\"", ",", "type", "=", "str", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.process_data": [[229, 246], ["transformers.AutoTokenizer.from_pretrained", "extractor.load_data", "extractor.build_data_single", "extractor.build_data"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.load_data", "home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.build_data_single", "home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.build_data"], ["", "def", "process_data", "(", "args", ")", ":", "\n", "\n", "    ", "tokenizer", "=", "AutoTokenizer", ".", "from_pretrained", "(", "\n", "args", ".", "bert_model", ",", "cache_dir", "=", "args", ".", "transformer_cache", "\n", ")", "\n", "\n", "path", "=", "args", ".", "finput", "\n", "data", ",", "is_single_sentence", "=", "load_data", "(", "path", ")", "\n", "if", "is_single_sentence", ":", "\n", "        ", "tokened_data", "=", "build_data_single", "(", "\n", "data", ",", "max_seq_len", "=", "args", ".", "max_seq_length", ",", "tokenizer", "=", "tokenizer", "\n", ")", "\n", "", "else", ":", "\n", "        ", "tokened_data", "=", "build_data", "(", "\n", "data", ",", "max_seq_len", "=", "args", ".", "max_seq_length", ",", "tokenizer", "=", "tokenizer", "\n", ")", "\n", "", "return", "tokened_data", ",", "is_single_sentence", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.dump_data": [[248, 252], ["open", "writer.write", "json.dumps"], "function", ["None"], ["", "def", "dump_data", "(", "data", ",", "path", ")", ":", "\n", "    ", "with", "open", "(", "path", ",", "\"w\"", ",", "encoding", "=", "\"utf-8\"", ")", "as", "writer", ":", "\n", "        ", "for", "sample", "in", "data", ":", "\n", "            ", "writer", ".", "write", "(", "\"{}\\n\"", ".", "format", "(", "json", ".", "dumps", "(", "sample", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.main": [[254, 325], ["argparse.ArgumentParser", "extractor.model_config", "extractor.set_config", "extractor.train_config", "argparse.ArgumentParser.parse_args", "data_utils.utils.set_environment", "extractor.process_data", "extractor.dump_data", "mt_dnn.batcher.Collater", "mt_dnn.batcher.SingleTaskDataset", "torch.utils.data.DataLoader", "vars", "os.path.exists", "len", "mt_dnn.model.MTDNNModel", "int", "torch.load", "vars.update", "logger.error", "logger.error", "logger.error", "mt_dnn.model.MTDNNModel.cuda", "mt_dnn.batcher.Collater.patch_data", "mt_dnn.model.MTDNNModel.extract", "batch_data[].detach().cpu().numpy().tolist", "enumerate", "open", "parser.parse_args.layers.split", "all_encoder_layers[].detach().cpu().numpy", "sum", "enumerate", "writer.write", "batch_data[].detach().cpu().numpy", "str", "all_encoder_layers[].detach().cpu", "[].tolist", "json.dumps", "batch_data[].detach().cpu", "all_encoder_layers[].detach", "batch_data[].detach"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.model_config", "home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.set_config", "home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.train_config", "home.repos.pwc.inspect_result.namisan_mt-dnn.ner.prepro.parse_args", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.utils.set_environment", "home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.process_data", "home.repos.pwc.inspect_result.namisan_mt-dnn.dump_embedding.extractor.dump_data", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.update", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.cuda", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater.patch_data", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.extract"], ["", "", "", "def", "main", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n", "model_config", "(", "parser", ")", "\n", "set_config", "(", "parser", ")", "\n", "train_config", "(", "parser", ")", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "encoder_type", "=", "args", ".", "encoder_type", "\n", "layer_indexes", "=", "[", "int", "(", "x", ")", "for", "x", "in", "args", ".", "layers", ".", "split", "(", "\",\"", ")", "]", "\n", "set_environment", "(", "args", ".", "seed", ")", "\n", "# process data", "\n", "data", ",", "is_single_sentence", "=", "process_data", "(", "args", ")", "\n", "data_type", "=", "(", "\n", "DataFormat", ".", "PremiseOnly", "\n", "if", "is_single_sentence", "\n", "else", "DataFormat", ".", "PremiseAndOneHypothesis", "\n", ")", "\n", "fout_temp", "=", "\"{}.tmp\"", ".", "format", "(", "args", ".", "finput", ")", "\n", "dump_data", "(", "data", ",", "fout_temp", ")", "\n", "collater", "=", "Collater", "(", "is_train", "=", "False", ",", "encoder_type", "=", "encoder_type", ")", "\n", "dataset", "=", "SingleTaskDataset", "(", "\n", "fout_temp", ",", "False", ",", "maxlen", "=", "args", ".", "max_seq_length", ",", "\n", ")", "\n", "batcher", "=", "DataLoader", "(", "\n", "dataset", ",", "\n", "batch_size", "=", "args", ".", "batch_size", ",", "\n", "collate_fn", "=", "collater", ".", "collate_fn", ",", "\n", "pin_memory", "=", "args", ".", "cuda", ",", "\n", ")", "\n", "opt", "=", "vars", "(", "args", ")", "\n", "# load model", "\n", "if", "os", ".", "path", ".", "exists", "(", "args", ".", "checkpoint", ")", ":", "\n", "        ", "state_dict", "=", "torch", ".", "load", "(", "args", ".", "checkpoint", ")", "\n", "config", "=", "state_dict", "[", "\"config\"", "]", "\n", "config", "[", "\"dump_feature\"", "]", "=", "True", "\n", "opt", ".", "update", "(", "config", ")", "\n", "", "else", ":", "\n", "        ", "logger", ".", "error", "(", "\"#\"", "*", "20", ")", "\n", "logger", ".", "error", "(", "\n", "\"Could not find the init model!\\n The parameters will be initialized randomly!\"", "\n", ")", "\n", "logger", ".", "error", "(", "\"#\"", "*", "20", ")", "\n", "return", "\n", "", "num_all_batches", "=", "len", "(", "batcher", ")", "\n", "model", "=", "MTDNNModel", "(", "opt", ",", "state_dict", "=", "state_dict", ",", "num_train_step", "=", "num_all_batches", ")", "\n", "if", "args", ".", "cuda", ":", "\n", "        ", "model", ".", "cuda", "(", ")", "\n", "\n", "", "features_dict", "=", "{", "}", "\n", "for", "batch_meta", ",", "batch_data", "in", "batcher", ":", "\n", "        ", "batch_meta", ",", "batch_data", "=", "Collater", ".", "patch_data", "(", "args", ".", "cuda", ",", "batch_meta", ",", "batch_data", ")", "\n", "all_encoder_layers", ",", "_", "=", "model", ".", "extract", "(", "batch_meta", ",", "batch_data", ")", "\n", "embeddings", "=", "[", "\n", "all_encoder_layers", "[", "idx", "]", ".", "detach", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "for", "idx", "in", "layer_indexes", "\n", "]", "\n", "\n", "uids", "=", "batch_meta", "[", "\"uids\"", "]", "\n", "masks", "=", "batch_data", "[", "batch_meta", "[", "\"mask\"", "]", "]", ".", "detach", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ".", "tolist", "(", ")", "\n", "for", "idx", ",", "uid", "in", "enumerate", "(", "uids", ")", ":", "\n", "            ", "slen", "=", "sum", "(", "masks", "[", "idx", "]", ")", "\n", "features", "=", "{", "}", "\n", "for", "yidx", ",", "layer", "in", "enumerate", "(", "layer_indexes", ")", ":", "\n", "                ", "features", "[", "layer", "]", "=", "str", "(", "embeddings", "[", "yidx", "]", "[", "idx", "]", "[", ":", "slen", "]", ".", "tolist", "(", ")", ")", "\n", "", "features_dict", "[", "uid", "]", "=", "features", "\n", "\n", "# save features", "\n", "", "", "with", "open", "(", "args", ".", "foutput", ",", "\"w\"", ",", "encoding", "=", "\"utf-8\"", ")", "as", "writer", ":", "\n", "        ", "for", "sample", "in", "data", ":", "\n", "            ", "uid", "=", "sample", "[", "\"uid\"", "]", "\n", "feature", "=", "features_dict", "[", "uid", "]", "\n", "feature", "[", "\"uid\"", "]", "=", "uid", "\n", "writer", ".", "write", "(", "\"{}\\n\"", ".", "format", "(", "json", ".", "dumps", "(", "feature", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.domain_adaptation.domain_prepro.load_scitail": [[13, 32], ["open", "line.strip().split", "rows.append", "len", "str", "line.strip"], "function", ["None"], ["def", "load_scitail", "(", "file", ")", ":", "\n", "    ", "\"\"\"Loading data of scitail\"\"\"", "\n", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "blocks", "=", "line", ".", "strip", "(", ")", ".", "split", "(", "\"\\t\"", ")", "\n", "assert", "len", "(", "blocks", ")", ">", "2", "\n", "if", "blocks", "[", "0", "]", "==", "\"-\"", ":", "\n", "                ", "continue", "\n", "", "sample", "=", "{", "\n", "\"uid\"", ":", "str", "(", "cnt", ")", ",", "\n", "\"premise\"", ":", "blocks", "[", "0", "]", ",", "\n", "\"hypothesis\"", ":", "blocks", "[", "1", "]", ",", "\n", "\"label\"", ":", "blocks", "[", "2", "]", ",", "\n", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "cnt", "+=", "1", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.domain_adaptation.domain_prepro.load_snli": [[34, 60], ["open", "line.strip().split", "rows.append", "len", "pdb.set_trace", "line.strip"], "function", ["None"], ["", "def", "load_snli", "(", "file", ",", "header", "=", "True", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "if", "header", ":", "\n", "                ", "header", "=", "False", "\n", "continue", "\n", "", "blocks", "=", "line", ".", "strip", "(", ")", ".", "split", "(", "\"\\t\"", ")", "\n", "assert", "len", "(", "blocks", ")", ">", "10", "\n", "if", "blocks", "[", "-", "1", "]", "==", "\"-\"", ":", "\n", "                ", "continue", "\n", "", "lab", "=", "blocks", "[", "-", "1", "]", "\n", "if", "lab", "is", "None", ":", "\n", "                ", "import", "pdb", "\n", "\n", "pdb", ".", "set_trace", "(", ")", "\n", "", "sample", "=", "{", "\n", "\"uid\"", ":", "blocks", "[", "0", "]", ",", "\n", "\"premise\"", ":", "blocks", "[", "7", "]", ",", "\n", "\"hypothesis\"", ":", "blocks", "[", "8", "]", ",", "\n", "\"label\"", ":", "lab", ",", "\n", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "cnt", "+=", "1", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.domain_adaptation.domain_prepro.parse_args": [[62, 75], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.ner.prepro.parse_args"], ["", "def", "parse_args", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", "\n", "description", "=", "\"Preprocessing GLUE/SNLI/SciTail dataset.\"", "\n", ")", "\n", "parser", ".", "add_argument", "(", "\"--seed\"", ",", "type", "=", "int", ",", "default", "=", "13", ")", "\n", "parser", ".", "add_argument", "(", "\"--root_dir\"", ",", "type", "=", "str", ",", "default", "=", "\"data\"", ")", "\n", "parser", ".", "add_argument", "(", "\n", "\"--old_glue\"", ",", "\n", "action", "=", "\"store_true\"", ",", "\n", "help", "=", "\"whether it is old GLUE, refer official GLUE webpage for details\"", ",", "\n", ")", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "return", "args", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.domain_adaptation.domain_prepro.main": [[77, 134], ["os.path.exists", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "domain_prepro.load_scitail", "domain_prepro.load_scitail", "domain_prepro.load_scitail", "logger.info", "logger.info", "logger.info", "domain_prepro.load_snli", "domain_prepro.load_snli", "domain_prepro.load_snli", "logger.info", "logger.info", "logger.info", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.isdir", "os.mkdir", "len", "len", "len", "len", "len", "len"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.domain_adaptation.domain_prepro.load_scitail", "home.repos.pwc.inspect_result.namisan_mt-dnn.domain_adaptation.domain_prepro.load_scitail", "home.repos.pwc.inspect_result.namisan_mt-dnn.domain_adaptation.domain_prepro.load_scitail", "home.repos.pwc.inspect_result.namisan_mt-dnn.domain_adaptation.domain_prepro.load_snli", "home.repos.pwc.inspect_result.namisan_mt-dnn.domain_adaptation.domain_prepro.load_snli", "home.repos.pwc.inspect_result.namisan_mt-dnn.domain_adaptation.domain_prepro.load_snli", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows"], ["", "def", "main", "(", "args", ")", ":", "\n", "    ", "is_old_glue", "=", "args", ".", "old_glue", "\n", "root", "=", "args", ".", "root_dir", "\n", "assert", "os", ".", "path", ".", "exists", "(", "root", ")", "\n", "\n", "######################################", "\n", "# SNLI/SciTail Tasks", "\n", "######################################", "\n", "scitail_train_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"SciTail/tsv_format/scitail_1.0_train.tsv\"", ")", "\n", "scitail_dev_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"SciTail/tsv_format/scitail_1.0_dev.tsv\"", ")", "\n", "scitail_test_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"SciTail/tsv_format/scitail_1.0_test.tsv\"", ")", "\n", "\n", "snli_train_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"SNLI/train.tsv\"", ")", "\n", "snli_dev_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"SNLI/dev.tsv\"", ")", "\n", "snli_test_path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"SNLI/test.tsv\"", ")", "\n", "\n", "######################################", "\n", "# Loading DATA", "\n", "######################################", "\n", "scitail_train_data", "=", "load_scitail", "(", "scitail_train_path", ")", "\n", "scitail_dev_data", "=", "load_scitail", "(", "scitail_dev_path", ")", "\n", "scitail_test_data", "=", "load_scitail", "(", "scitail_test_path", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} SciTail train samples\"", ".", "format", "(", "len", "(", "scitail_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} SciTail dev samples\"", ".", "format", "(", "len", "(", "scitail_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} SciTail test samples\"", ".", "format", "(", "len", "(", "scitail_test_data", ")", ")", ")", "\n", "\n", "snli_train_data", "=", "load_snli", "(", "snli_train_path", ")", "\n", "snli_dev_data", "=", "load_snli", "(", "snli_dev_path", ")", "\n", "snli_test_data", "=", "load_snli", "(", "snli_test_path", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} SNLI train samples\"", ".", "format", "(", "len", "(", "snli_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} SNLI dev samples\"", ".", "format", "(", "len", "(", "snli_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} SNLI test samples\"", ".", "format", "(", "len", "(", "snli_test_data", ")", ")", ")", "\n", "\n", "canonical_data_suffix", "=", "\"canonical_data\"", "\n", "canonical_data_root", "=", "os", ".", "path", ".", "join", "(", "root", ",", "canonical_data_suffix", ")", "\n", "if", "not", "os", ".", "path", ".", "isdir", "(", "canonical_data_root", ")", ":", "\n", "        ", "os", ".", "mkdir", "(", "canonical_data_root", ")", "\n", "\n", "# BUILD SciTail", "\n", "", "scitail_train_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"scitail_train.tsv\"", ")", "\n", "scitail_dev_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"scitail_dev.tsv\"", ")", "\n", "scitail_test_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"scitail_test.tsv\"", ")", "\n", "dump_rows", "(", "\n", "scitail_train_data", ",", "scitail_train_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", "\n", ")", "\n", "dump_rows", "(", "scitail_dev_data", ",", "scitail_dev_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "scitail_test_data", ",", "scitail_test_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "logger", ".", "info", "(", "\"done with scitail\"", ")", "\n", "\n", "# BUILD SNLI", "\n", "snli_train_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"snli_train.tsv\"", ")", "\n", "snli_dev_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"snli_dev.tsv\"", ")", "\n", "snli_test_fout", "=", "os", ".", "path", ".", "join", "(", "canonical_data_root", ",", "\"snli_test.tsv\"", ")", "\n", "dump_rows", "(", "snli_train_data", ",", "snli_train_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "snli_dev_data", ",", "snli_dev_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "dump_rows", "(", "snli_test_data", ",", "snli_test_fout", ",", "DataFormat", ".", "PremiseAndOneHypothesis", ")", "\n", "logger", ".", "info", "(", "\"done with snli\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.ner.prepro.parse_args": [[16, 23], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.ner.prepro.parse_args"], ["def", "parse_args", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", "description", "=", "\"Preprocessing English NER dataset.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--data_dir\"", ",", "type", "=", "str", ",", "required", "=", "True", ")", "\n", "parser", ".", "add_argument", "(", "\"--seed\"", ",", "type", "=", "int", ",", "default", "=", "13", ")", "\n", "parser", ".", "add_argument", "(", "\"--output_dir\"", ",", "type", "=", "str", ",", "required", "=", "True", ")", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "return", "args", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.ner.prepro.main": [[25, 83], ["os.path.abspath", "os.path.join", "os.path.join", "os.path.join", "experiments.ner.ner_utils.load_conll_ner", "experiments.ner.ner_utils.load_conll_ner", "experiments.ner.ner_utils.load_conll_ner", "logger.info", "logger.info", "logger.info", "experiments.ner.ner_utils.load_conll_pos", "experiments.ner.ner_utils.load_conll_pos", "experiments.ner.ner_utils.load_conll_pos", "logger.info", "logger.info", "logger.info", "experiments.ner.ner_utils.load_conll_chunk", "experiments.ner.ner_utils.load_conll_chunk", "experiments.ner.ner_utils.load_conll_chunk", "logger.info", "logger.info", "logger.info", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.join", "os.path.join", "os.path.join", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "experiments.common_utils.dump_rows", "logger.info", "os.path.isdir", "os.mkdir", "os.path.isdir", "os.mkdir", "len", "len", "len", "len", "len", "len", "len", "len", "len"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.ner.ner_utils.load_conll_ner", "home.repos.pwc.inspect_result.namisan_mt-dnn.ner.ner_utils.load_conll_ner", "home.repos.pwc.inspect_result.namisan_mt-dnn.ner.ner_utils.load_conll_ner", "home.repos.pwc.inspect_result.namisan_mt-dnn.ner.ner_utils.load_conll_pos", "home.repos.pwc.inspect_result.namisan_mt-dnn.ner.ner_utils.load_conll_pos", "home.repos.pwc.inspect_result.namisan_mt-dnn.ner.ner_utils.load_conll_pos", "home.repos.pwc.inspect_result.namisan_mt-dnn.ner.ner_utils.load_conll_chunk", "home.repos.pwc.inspect_result.namisan_mt-dnn.ner.ner_utils.load_conll_chunk", "home.repos.pwc.inspect_result.namisan_mt-dnn.ner.ner_utils.load_conll_chunk", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.common_utils.dump_rows"], ["", "def", "main", "(", "args", ")", ":", "\n", "    ", "data_dir", "=", "args", ".", "data_dir", "\n", "data_dir", "=", "os", ".", "path", ".", "abspath", "(", "data_dir", ")", "\n", "if", "not", "os", ".", "path", ".", "isdir", "(", "data_dir", ")", ":", "\n", "        ", "os", ".", "mkdir", "(", "data_dir", ")", "\n", "\n", "", "train_path", "=", "os", ".", "path", ".", "join", "(", "data_dir", ",", "\"train.txt\"", ")", "\n", "dev_path", "=", "os", ".", "path", ".", "join", "(", "data_dir", ",", "\"valid.txt\"", ")", "\n", "test_path", "=", "os", ".", "path", ".", "join", "(", "data_dir", ",", "\"test.txt\"", ")", "\n", "\n", "train_data", "=", "load_conll_ner", "(", "train_path", ")", "\n", "dev_data", "=", "load_conll_ner", "(", "dev_path", ")", "\n", "test_data", "=", "load_conll_ner", "(", "test_path", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} NER train samples\"", ".", "format", "(", "len", "(", "train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} NER dev samples\"", ".", "format", "(", "len", "(", "dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} NER test samples\"", ".", "format", "(", "len", "(", "test_data", ")", ")", ")", "\n", "\n", "pos_train_data", "=", "load_conll_pos", "(", "train_path", ")", "\n", "pos_dev_data", "=", "load_conll_pos", "(", "dev_path", ")", "\n", "pos_test_data", "=", "load_conll_pos", "(", "test_path", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} POS train samples\"", ".", "format", "(", "len", "(", "pos_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} POS dev samples\"", ".", "format", "(", "len", "(", "pos_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} POS test samples\"", ".", "format", "(", "len", "(", "pos_train_data", ")", ")", ")", "\n", "\n", "chunk_train_data", "=", "load_conll_chunk", "(", "train_path", ")", "\n", "chunk_dev_data", "=", "load_conll_chunk", "(", "dev_path", ")", "\n", "chunk_test_data", "=", "load_conll_chunk", "(", "test_path", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} POS train samples\"", ".", "format", "(", "len", "(", "chunk_train_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} POS dev samples\"", ".", "format", "(", "len", "(", "chunk_dev_data", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"Loaded {} POS test samples\"", ".", "format", "(", "len", "(", "chunk_test_data", ")", ")", ")", "\n", "\n", "bert_root", "=", "args", ".", "output_dir", "\n", "if", "not", "os", ".", "path", ".", "isdir", "(", "bert_root", ")", ":", "\n", "        ", "os", ".", "mkdir", "(", "bert_root", ")", "\n", "", "train_fout", "=", "os", ".", "path", ".", "join", "(", "bert_root", ",", "\"ner_train.tsv\"", ")", "\n", "dev_fout", "=", "os", ".", "path", ".", "join", "(", "bert_root", ",", "\"ner_dev.tsv\"", ")", "\n", "test_fout", "=", "os", ".", "path", ".", "join", "(", "bert_root", ",", "\"ner_test.tsv\"", ")", "\n", "\n", "dump_rows", "(", "train_data", ",", "train_fout", ",", "DataFormat", ".", "Seqence", ")", "\n", "dump_rows", "(", "dev_data", ",", "dev_fout", ",", "DataFormat", ".", "Seqence", ")", "\n", "dump_rows", "(", "test_data", ",", "test_fout", ",", "DataFormat", ".", "Seqence", ")", "\n", "logger", ".", "info", "(", "\"done with NER\"", ")", "\n", "\n", "train_fout", "=", "os", ".", "path", ".", "join", "(", "bert_root", ",", "\"pos_train.tsv\"", ")", "\n", "dev_fout", "=", "os", ".", "path", ".", "join", "(", "bert_root", ",", "\"pos_dev.tsv\"", ")", "\n", "test_fout", "=", "os", ".", "path", ".", "join", "(", "bert_root", ",", "\"pos_test.tsv\"", ")", "\n", "dump_rows", "(", "pos_train_data", ",", "train_fout", ",", "DataFormat", ".", "Seqence", ")", "\n", "dump_rows", "(", "pos_dev_data", ",", "dev_fout", ",", "DataFormat", ".", "Seqence", ")", "\n", "dump_rows", "(", "pos_test_data", ",", "test_fout", ",", "DataFormat", ".", "Seqence", ")", "\n", "logger", ".", "info", "(", "\"done with POS\"", ")", "\n", "\n", "train_fout", "=", "os", ".", "path", ".", "join", "(", "bert_root", ",", "\"chunk_train.tsv\"", ")", "\n", "dev_fout", "=", "os", ".", "path", ".", "join", "(", "bert_root", ",", "\"chunk_dev.tsv\"", ")", "\n", "test_fout", "=", "os", ".", "path", ".", "join", "(", "bert_root", ",", "\"chunk_test.tsv\"", ")", "\n", "dump_rows", "(", "chunk_train_data", ",", "train_fout", ",", "DataFormat", ".", "Seqence", ")", "\n", "dump_rows", "(", "chunk_dev_data", ",", "dev_fout", ",", "DataFormat", ".", "Seqence", ")", "\n", "dump_rows", "(", "chunk_test_data", ",", "test_fout", ",", "DataFormat", ".", "Seqence", ")", "\n", "logger", ".", "info", "(", "\"done with chunk\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.ner.ner_utils.load_conll_ner": [[8, 30], ["open", "line.strip.strip", "line.strip.split", "sentence.append", "label.append", "len", "line.strip.startswith", "len", "len", "rows.append"], "function", ["None"], ["def", "load_conll_ner", "(", "file", ",", "is_train", "=", "True", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "sentence", "=", "[", "]", "\n", "label", "=", "[", "]", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "line", "=", "line", ".", "strip", "(", ")", "\n", "if", "len", "(", "line", ")", "==", "0", "or", "line", ".", "startswith", "(", "\"-DOCSTART\"", ")", "or", "line", "[", "0", "]", "==", "\"\\n\"", ":", "\n", "                ", "if", "len", "(", "sentence", ")", ">", "0", ":", "\n", "                    ", "sample", "=", "{", "\"uid\"", ":", "cnt", ",", "\"premise\"", ":", "sentence", ",", "\"label\"", ":", "label", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "sentence", "=", "[", "]", "\n", "label", "=", "[", "]", "\n", "cnt", "+=", "1", "\n", "", "continue", "\n", "", "splits", "=", "line", ".", "split", "(", "\" \"", ")", "\n", "sentence", ".", "append", "(", "splits", "[", "0", "]", ")", "\n", "label", ".", "append", "(", "splits", "[", "-", "1", "]", ")", "\n", "", "if", "len", "(", "sentence", ")", ">", "0", ":", "\n", "            ", "sample", "=", "{", "\"uid\"", ":", "cnt", ",", "\"premise\"", ":", "sentence", ",", "\"label\"", ":", "label", "}", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.ner.ner_utils.load_conll_pos": [[32, 54], ["open", "line.strip.strip", "line.strip.split", "sentence.append", "label.append", "len", "line.strip.startswith", "len", "len", "rows.append"], "function", ["None"], ["", "def", "load_conll_pos", "(", "file", ",", "is_train", "=", "True", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "sentence", "=", "[", "]", "\n", "label", "=", "[", "]", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "line", "=", "line", ".", "strip", "(", ")", "\n", "if", "len", "(", "line", ")", "==", "0", "or", "line", ".", "startswith", "(", "\"-DOCSTART\"", ")", "or", "line", "[", "0", "]", "==", "\"\\n\"", ":", "\n", "                ", "if", "len", "(", "sentence", ")", ">", "0", ":", "\n", "                    ", "sample", "=", "{", "\"uid\"", ":", "cnt", ",", "\"premise\"", ":", "sentence", ",", "\"label\"", ":", "label", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "sentence", "=", "[", "]", "\n", "label", "=", "[", "]", "\n", "cnt", "+=", "1", "\n", "", "continue", "\n", "", "splits", "=", "line", ".", "split", "(", "\" \"", ")", "\n", "sentence", ".", "append", "(", "splits", "[", "0", "]", ")", "\n", "label", ".", "append", "(", "splits", "[", "1", "]", ")", "\n", "", "if", "len", "(", "sentence", ")", ">", "0", ":", "\n", "            ", "sample", "=", "{", "\"uid\"", ":", "cnt", ",", "\"premise\"", ":", "sentence", ",", "\"label\"", ":", "label", "}", "\n", "", "", "return", "rows", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.ner.ner_utils.load_conll_chunk": [[56, 78], ["open", "line.strip.strip", "line.strip.split", "sentence.append", "label.append", "len", "line.strip.startswith", "len", "len", "rows.append"], "function", ["None"], ["", "def", "load_conll_chunk", "(", "file", ",", "is_train", "=", "True", ")", ":", "\n", "    ", "rows", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "sentence", "=", "[", "]", "\n", "label", "=", "[", "]", "\n", "with", "open", "(", "file", ",", "encoding", "=", "\"utf8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "line", "=", "line", ".", "strip", "(", ")", "\n", "if", "len", "(", "line", ")", "==", "0", "or", "line", ".", "startswith", "(", "\"-DOCSTART\"", ")", "or", "line", "[", "0", "]", "==", "\"\\n\"", ":", "\n", "                ", "if", "len", "(", "sentence", ")", ">", "0", ":", "\n", "                    ", "sample", "=", "{", "\"uid\"", ":", "cnt", ",", "\"premise\"", ":", "sentence", ",", "\"label\"", ":", "label", "}", "\n", "rows", ".", "append", "(", "sample", ")", "\n", "sentence", "=", "[", "]", "\n", "label", "=", "[", "]", "\n", "cnt", "+=", "1", "\n", "", "continue", "\n", "", "splits", "=", "line", ".", "split", "(", "\" \"", ")", "\n", "sentence", ".", "append", "(", "splits", "[", "0", "]", ")", "\n", "label", ".", "append", "(", "splits", "[", "2", "]", ")", "\n", "", "if", "len", "(", "sentence", ")", ">", "0", ":", "\n", "            ", "sample", "=", "{", "\"uid\"", ":", "cnt", ",", "\"premise\"", ":", "sentence", ",", "\"label\"", ":", "label", "}", "\n", "", "", "return", "rows", "\n", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.MTDNNTask.__init__": [[12, 14], ["None"], "methods", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.MTDNNTask.input_parse_label": [[15, 17], ["NotImplementedError"], "methods", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.MTDNNTask.input_is_valid_sample": [[18, 21], ["len"], "methods", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.MTDNNTask.train_prepare_label": [[23, 26], ["NotImplementedError"], "methods", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.MTDNNTask.train_prepare_soft_label": [[28, 31], ["NotImplementedError"], "methods", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.MTDNNTask.train_build_task_layer": [[32, 39], ["module.san.SANClassifier", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.MTDNNTask.train_forward": [[41, 54], ["hyp_mask.size", "task_layer", "dropout_layer", "task_layer"], "methods", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.MTDNNTask.test_prepare_label": [[55, 58], ["None"], "methods", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.MTDNNTask.test_predict": [[59, 62], ["NotImplementedError"], "methods", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.RegressionTask.__init__": [[102, 104], ["__init__.MTDNNTask.__init__"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.RegressionTask.input_parse_label": [[105, 107], ["float"], "methods", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.RegressionTask.train_prepare_label": [[108, 111], ["torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor"], "methods", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.RegressionTask.train_prepare_soft_label": [[112, 115], ["torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor"], "methods", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.RegressionTask.test_predict": [[116, 123], ["score.reshape().tolist.reshape().tolist.data.cpu", "score.reshape().tolist.reshape().tolist.numpy", "numpy.argmax().tolist", "score.reshape().tolist.reshape().tolist.reshape().tolist", "numpy.argmax", "score.reshape().tolist.reshape().tolist.reshape"], "methods", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.ClassificationTask.__init__": [[126, 128], ["__init__.MTDNNTask.__init__"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.ClassificationTask.input_parse_label": [[129, 135], ["int"], "methods", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.ClassificationTask.train_prepare_label": [[136, 139], ["torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor"], "methods", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.ClassificationTask.train_prepare_soft_label": [[140, 143], ["torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor"], "methods", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.ClassificationTask.test_predict": [[144, 152], ["torch.softmax", "torch.softmax", "torch.softmax", "score.reshape().tolist.reshape().tolist.data.cpu", "score.reshape().tolist.reshape().tolist.numpy", "numpy.argmax().tolist", "score.reshape().tolist.reshape().tolist.reshape().tolist", "numpy.argmax", "score.reshape().tolist.reshape().tolist.reshape"], "methods", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.register_task": [[64, 91], ["TASK_CLASS_NAMES.add", "ValueError", "issubclass", "ValueError", "ValueError"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.vocab.Vocabulary.add"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.get_task_obj": [[92, 99], ["TASK_REGISTRY.get", "TASK_REGISTRY.get."], "function", ["None"], []], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.matcher.SANBertNetwork.__init__": [[25, 125], ["torch.Module.__init__", "torch.ModuleList", "torch.ModuleList", "data_utils.task_def.EncoderModelType().name.lower", "opt.get", "enumerate", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "range", "ValueError", "model_class.from_pretrained", "config_class.from_dict", "model_class", "matcher.SANBertNetwork.bert.parameters", "matcher.SANBertNetwork.decoder_opt.append", "matcher.SANBertNetwork.task_types.append", "len", "module.dropout_wrapper.DropoutWrapper", "matcher.SANBertNetwork.dropout_list.append", "tasks.get_task_obj", "matcher.SANBertNetwork.scoring_list.append", "matcher.generate_decoder_opt", "module.pooler.Pooler", "tasks.get_task_obj.train_build_task_layer", "data_utils.task_def.EncoderModelType", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "module.pooler.Pooler", "torch.Linear", "torch.Linear", "module.san.SANClassifier", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__", "home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.exp_def.TaskDef.from_dict", "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.get_task_obj", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.matcher.generate_decoder_opt", "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.MTDNNTask.train_build_task_layer"], ["    ", "def", "__init__", "(", "self", ",", "opt", ",", "bert_config", "=", "None", ",", "initial_from_local", "=", "False", ")", ":", "\n", "        ", "super", "(", "SANBertNetwork", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "dropout_list", "=", "nn", ".", "ModuleList", "(", ")", "\n", "\n", "if", "opt", "[", "\"encoder_type\"", "]", "not", "in", "EncoderModelType", ".", "_value2member_map_", ":", "\n", "            ", "raise", "ValueError", "(", "\"encoder_type is out of pre-defined types\"", ")", "\n", "", "self", ".", "encoder_type", "=", "opt", "[", "\"encoder_type\"", "]", "\n", "self", ".", "preloaded_config", "=", "None", "\n", "\n", "literal_encoder_type", "=", "EncoderModelType", "(", "self", ".", "encoder_type", ")", ".", "name", ".", "lower", "(", ")", "\n", "config_class", ",", "model_class", ",", "_", "=", "MODEL_CLASSES", "[", "literal_encoder_type", "]", "\n", "if", "not", "initial_from_local", ":", "\n", "# self.bert = model_class.from_pretrained(opt['init_checkpoint'], config=self.preloaded_config)", "\n", "            ", "self", ".", "bert", "=", "model_class", ".", "from_pretrained", "(", "\n", "opt", "[", "\"init_checkpoint\"", "]", ",", "cache_dir", "=", "opt", "[", "\"transformer_cache\"", "]", "\n", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "preloaded_config", "=", "config_class", ".", "from_dict", "(", "opt", ")", "# load config from opt", "\n", "self", ".", "preloaded_config", ".", "output_hidden_states", "=", "(", "\n", "True", "# return all hidden states", "\n", ")", "\n", "self", ".", "bert", "=", "model_class", "(", "self", ".", "preloaded_config", ")", "\n", "\n", "", "hidden_size", "=", "self", ".", "bert", ".", "config", ".", "hidden_size", "\n", "\n", "if", "opt", ".", "get", "(", "\"dump_feature\"", ",", "False", ")", ":", "\n", "            ", "self", ".", "config", "=", "opt", "\n", "return", "\n", "", "if", "opt", "[", "\"update_bert_opt\"", "]", ">", "0", ":", "\n", "            ", "for", "p", "in", "self", ".", "bert", ".", "parameters", "(", ")", ":", "\n", "                ", "p", ".", "requires_grad", "=", "False", "\n", "\n", "", "", "task_def_list", "=", "opt", "[", "\"task_def_list\"", "]", "\n", "self", ".", "task_def_list", "=", "task_def_list", "\n", "self", ".", "decoder_opt", "=", "[", "]", "\n", "self", ".", "task_types", "=", "[", "]", "\n", "for", "task_id", ",", "task_def", "in", "enumerate", "(", "task_def_list", ")", ":", "\n", "            ", "self", ".", "decoder_opt", ".", "append", "(", "\n", "generate_decoder_opt", "(", "task_def", ".", "enable_san", ",", "opt", "[", "\"answer_opt\"", "]", ")", "\n", ")", "\n", "self", ".", "task_types", ".", "append", "(", "task_def", ".", "task_type", ")", "\n", "\n", "# create output header", "\n", "", "self", ".", "scoring_list", "=", "nn", ".", "ModuleList", "(", ")", "\n", "self", ".", "dropout_list", "=", "nn", ".", "ModuleList", "(", ")", "\n", "for", "task_id", "in", "range", "(", "len", "(", "task_def_list", ")", ")", ":", "\n", "            ", "task_def", ":", "TaskDef", "=", "task_def_list", "[", "task_id", "]", "\n", "lab", "=", "task_def", ".", "n_class", "\n", "decoder_opt", "=", "self", ".", "decoder_opt", "[", "task_id", "]", "\n", "task_type", "=", "self", ".", "task_types", "[", "task_id", "]", "\n", "task_dropout_p", "=", "(", "\n", "opt", "[", "\"dropout_p\"", "]", "if", "task_def", ".", "dropout_p", "is", "None", "else", "task_def", ".", "dropout_p", "\n", ")", "\n", "dropout", "=", "DropoutWrapper", "(", "task_dropout_p", ",", "opt", "[", "\"vb_dropout\"", "]", ")", "\n", "self", ".", "dropout_list", ".", "append", "(", "dropout", ")", "\n", "task_obj", "=", "tasks", ".", "get_task_obj", "(", "task_def", ")", "\n", "if", "task_obj", "is", "not", "None", ":", "\n", "# Move this to task_obj", "\n", "                ", "self", ".", "pooler", "=", "Pooler", "(", "\n", "hidden_size", ",", "dropout_p", "=", "opt", "[", "\"dropout_p\"", "]", ",", "actf", "=", "opt", "[", "\"pooler_actf\"", "]", "\n", ")", "\n", "out_proj", "=", "task_obj", ".", "train_build_task_layer", "(", "\n", "decoder_opt", ",", "hidden_size", ",", "lab", ",", "opt", ",", "prefix", "=", "\"answer\"", ",", "dropout", "=", "dropout", "\n", ")", "\n", "", "elif", "task_type", "==", "TaskType", ".", "Span", ":", "\n", "                ", "assert", "decoder_opt", "!=", "1", "\n", "out_proj", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "2", ")", "\n", "", "elif", "task_type", "==", "TaskType", ".", "SpanYN", ":", "\n", "                ", "assert", "decoder_opt", "!=", "1", "\n", "out_proj", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "2", ")", "\n", "", "elif", "task_type", "==", "TaskType", ".", "SeqenceLabeling", ":", "\n", "                ", "out_proj", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "lab", ")", "\n", "# elif task_type == TaskType.MaskLM:", "\n", "#     if opt[\"encoder_type\"] == EncoderModelType.ROBERTA:", "\n", "#         # TODO: xiaodl", "\n", "#         out_proj = MaskLmHeader(self.bert.embeddings.word_embeddings.weight)", "\n", "#     else:", "\n", "#         out_proj = MaskLmHeader(self.bert.embeddings.word_embeddings.weight)", "\n", "", "elif", "task_type", "==", "TaskType", ".", "SeqenceGeneration", ":", "\n", "# use orginal header", "\n", "                ", "out_proj", "=", "None", "\n", "", "elif", "task_type", "==", "TaskType", ".", "ClozeChoice", ":", "\n", "                ", "self", ".", "pooler", "=", "Pooler", "(", "\n", "hidden_size", ",", "dropout_p", "=", "opt", "[", "\"dropout_p\"", "]", ",", "actf", "=", "opt", "[", "\"pooler_actf\"", "]", "\n", ")", "\n", "out_proj", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "lab", ")", "\n", "", "else", ":", "\n", "                ", "if", "decoder_opt", "==", "1", ":", "\n", "                    ", "out_proj", "=", "SANClassifier", "(", "\n", "hidden_size", ",", "\n", "hidden_size", ",", "\n", "lab", ",", "\n", "opt", ",", "\n", "prefix", "=", "\"answer\"", ",", "\n", "dropout", "=", "dropout", ",", "\n", ")", "\n", "", "else", ":", "\n", "                    ", "out_proj", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "lab", ")", "\n", "", "", "self", ".", "scoring_list", ".", "append", "(", "out_proj", ")", "\n", "", "self", ".", "config", "=", "opt", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.matcher.SANBertNetwork.embed_encode": [[126, 131], ["matcher.SANBertNetwork.bert.embeddings", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like"], "methods", ["None"], ["", "def", "embed_encode", "(", "self", ",", "input_ids", ",", "token_type_ids", "=", "None", ",", "attention_mask", "=", "None", ")", ":", "\n", "        ", "if", "token_type_ids", "is", "None", ":", "\n", "            ", "token_type_ids", "=", "torch", ".", "zeros_like", "(", "input_ids", ")", "\n", "", "embedding_output", "=", "self", ".", "bert", ".", "embeddings", "(", "input_ids", ",", "token_type_ids", ")", "\n", "return", "embedding_output", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.matcher.SANBertNetwork.encode": [[132, 169], ["matcher.SANBertNetwork.bert", "matcher.SANBertNetwork.bert", "matcher.SANBertNetwork.bert"], "methods", ["None"], ["", "def", "encode", "(", "\n", "self", ",", "\n", "input_ids", ",", "\n", "token_type_ids", ",", "\n", "attention_mask", ",", "\n", "inputs_embeds", "=", "None", ",", "\n", "y_input_ids", "=", "None", ",", "\n", ")", ":", "\n", "        ", "if", "self", ".", "encoder_type", "==", "EncoderModelType", ".", "T5", ":", "\n", "            ", "outputs", "=", "self", ".", "bert", "(", "\n", "input_ids", "=", "input_ids", ",", "\n", "attention_mask", "=", "attention_mask", ",", "\n", "inputs_embeds", "=", "inputs_embeds", ",", "\n", ")", "\n", "last_hidden_state", "=", "outputs", ".", "last_hidden_state", "\n", "all_hidden_states", "=", "outputs", ".", "hidden_states", "# num_layers + 1 (embeddings)", "\n", "", "elif", "self", ".", "encoder_type", "==", "EncoderModelType", ".", "T5G", ":", "\n", "            ", "outputs", "=", "self", ".", "bert", "(", "\n", "input_ids", "=", "input_ids", ",", "\n", "attention_mask", "=", "attention_mask", ",", "\n", "decoder_input_ids", "=", "y_input_ids", ",", "\n", ")", "\n", "# return logits from LM header", "\n", "last_hidden_state", "=", "outputs", ".", "logits", "\n", "all_hidden_states", "=", "(", "\n", "outputs", ".", "encoder_last_hidden_state", "\n", ")", "# num_layers + 1 (embeddings)", "\n", "", "else", ":", "\n", "            ", "outputs", "=", "self", ".", "bert", "(", "\n", "input_ids", "=", "input_ids", ",", "\n", "token_type_ids", "=", "token_type_ids", ",", "\n", "attention_mask", "=", "attention_mask", ",", "\n", "inputs_embeds", "=", "inputs_embeds", ",", "\n", ")", "\n", "last_hidden_state", "=", "outputs", ".", "last_hidden_state", "\n", "all_hidden_states", "=", "outputs", ".", "hidden_states", "# num_layers + 1 (embeddings)", "\n", "", "return", "last_hidden_state", ",", "all_hidden_states", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.matcher.SANBertNetwork.forward": [[170, 267], ["tasks.get_task_obj", "matcher.SANBertNetwork.bert.generate", "matcher.SANBertNetwork.pooler", "tasks.get_task_obj.train_forward", "matcher.SANBertNetwork.encode", "last_hidden_state.view.split", "start_scores.squeeze.squeeze.squeeze", "end_scores.squeeze.squeeze.squeeze", "matcher.SANBertNetwork.embed_encode", "matcher.SANBertNetwork.encode", "last_hidden_state.view.split", "start_scores.squeeze.squeeze.squeeze", "end_scores.squeeze.squeeze.squeeze", "matcher.SANBertNetwork.contiguous().view", "matcher.SANBertNetwork.size", "matcher.SANBertNetwork.contiguous", "last_hidden_state.view", "last_hidden_state.size", "matcher.SANBertNetwork.pooler", "hyp_mask.size"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.get_task_obj", "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.MTDNNTask.train_forward", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.encode", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.matcher.SANBertNetwork.embed_encode", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.encode"], ["", "def", "forward", "(", "\n", "self", ",", "\n", "input_ids", ",", "\n", "token_type_ids", ",", "\n", "attention_mask", ",", "\n", "premise_mask", "=", "None", ",", "\n", "hyp_mask", "=", "None", ",", "\n", "task_id", "=", "0", ",", "\n", "y_input_ids", "=", "None", ",", "\n", "fwd_type", "=", "0", ",", "\n", "embed", "=", "None", ",", "\n", ")", ":", "\n", "        ", "if", "fwd_type", "==", "3", ":", "\n", "            ", "generated", "=", "self", ".", "bert", ".", "generate", "(", "\n", "input_ids", "=", "input_ids", ",", "\n", "attention_mask", "=", "attention_mask", ",", "\n", "max_length", "=", "self", ".", "config", "[", "\"max_answer_len\"", "]", ",", "\n", "num_beams", "=", "self", ".", "config", "[", "\"num_beams\"", "]", ",", "\n", "repetition_penalty", "=", "self", ".", "config", "[", "\"repetition_penalty\"", "]", ",", "\n", "length_penalty", "=", "self", ".", "config", "[", "\"length_penalty\"", "]", ",", "\n", "early_stopping", "=", "True", ",", "\n", ")", "\n", "return", "generated", "\n", "", "elif", "fwd_type", "==", "2", ":", "\n", "            ", "assert", "embed", "is", "not", "None", "\n", "last_hidden_state", ",", "all_hidden_states", "=", "self", ".", "encode", "(", "\n", "None", ",", "token_type_ids", ",", "attention_mask", ",", "embed", ",", "y_input_ids", "\n", ")", "\n", "", "elif", "fwd_type", "==", "1", ":", "\n", "            ", "return", "self", ".", "embed_encode", "(", "input_ids", ",", "token_type_ids", ",", "attention_mask", ")", "\n", "", "else", ":", "\n", "            ", "last_hidden_state", ",", "all_hidden_states", "=", "self", ".", "encode", "(", "\n", "input_ids", ",", "token_type_ids", ",", "attention_mask", ",", "y_input_ids", "=", "y_input_ids", "\n", ")", "\n", "", "decoder_opt", "=", "self", ".", "decoder_opt", "[", "task_id", "]", "\n", "task_type", "=", "self", ".", "task_types", "[", "task_id", "]", "\n", "task_obj", "=", "tasks", ".", "get_task_obj", "(", "self", ".", "task_def_list", "[", "task_id", "]", ")", "\n", "if", "task_obj", "is", "not", "None", ":", "\n", "            ", "pooled_output", "=", "self", ".", "pooler", "(", "last_hidden_state", ")", "\n", "logits", "=", "task_obj", ".", "train_forward", "(", "\n", "last_hidden_state", ",", "\n", "pooled_output", ",", "\n", "premise_mask", ",", "\n", "hyp_mask", ",", "\n", "decoder_opt", ",", "\n", "self", ".", "dropout_list", "[", "task_id", "]", ",", "\n", "self", ".", "scoring_list", "[", "task_id", "]", ",", "\n", ")", "\n", "return", "logits", "\n", "", "elif", "task_type", "==", "TaskType", ".", "Span", ":", "\n", "            ", "assert", "decoder_opt", "!=", "1", "\n", "last_hidden_state", "=", "self", ".", "dropout_list", "[", "task_id", "]", "(", "last_hidden_state", ")", "\n", "logits", "=", "self", ".", "scoring_list", "[", "task_id", "]", "(", "last_hidden_state", ")", "\n", "start_scores", ",", "end_scores", "=", "logits", ".", "split", "(", "1", ",", "dim", "=", "-", "1", ")", "\n", "start_scores", "=", "start_scores", ".", "squeeze", "(", "-", "1", ")", "\n", "end_scores", "=", "end_scores", ".", "squeeze", "(", "-", "1", ")", "\n", "return", "start_scores", ",", "end_scores", "\n", "", "elif", "task_type", "==", "TaskType", ".", "SpanYN", ":", "\n", "            ", "assert", "decoder_opt", "!=", "1", "\n", "last_hidden_state", "=", "self", ".", "dropout_list", "[", "task_id", "]", "(", "last_hidden_state", ")", "\n", "logits", "=", "self", ".", "scoring_list", "[", "task_id", "]", "(", "last_hidden_state", ")", "\n", "start_scores", ",", "end_scores", "=", "logits", ".", "split", "(", "1", ",", "dim", "=", "-", "1", ")", "\n", "start_scores", "=", "start_scores", ".", "squeeze", "(", "-", "1", ")", "\n", "end_scores", "=", "end_scores", ".", "squeeze", "(", "-", "1", ")", "\n", "return", "start_scores", ",", "end_scores", "\n", "", "elif", "task_type", "==", "TaskType", ".", "SeqenceLabeling", ":", "\n", "            ", "pooled_output", "=", "last_hidden_state", "\n", "pooled_output", "=", "self", ".", "dropout_list", "[", "task_id", "]", "(", "pooled_output", ")", "\n", "pooled_output", "=", "pooled_output", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ",", "pooled_output", ".", "size", "(", "2", ")", ")", "\n", "logits", "=", "self", ".", "scoring_list", "[", "task_id", "]", "(", "pooled_output", ")", "\n", "return", "logits", "\n", "", "elif", "task_type", "==", "TaskType", ".", "MaskLM", ":", "\n", "            ", "last_hidden_state", "=", "self", ".", "dropout_list", "[", "task_id", "]", "(", "last_hidden_state", ")", "\n", "logits", "=", "self", ".", "scoring_list", "[", "task_id", "]", "(", "last_hidden_state", ")", "\n", "return", "logits", "\n", "", "elif", "task_type", "==", "TaskType", ".", "SeqenceGeneration", ":", "\n", "            ", "logits", "=", "last_hidden_state", ".", "view", "(", "-", "1", ",", "last_hidden_state", ".", "size", "(", "-", "1", ")", ")", "\n", "return", "logits", "\n", "", "elif", "task_type", "==", "TaskType", ".", "ClozeChoice", ":", "\n", "            ", "pooled_output", "=", "self", ".", "pooler", "(", "last_hidden_state", ")", "\n", "pooled_output", "=", "self", ".", "dropout_list", "[", "task_id", "]", "(", "pooled_output", ")", "\n", "logits", "=", "self", ".", "scoring_list", "[", "task_id", "]", "(", "pooled_output", ")", "\n", "return", "logits", "\n", "", "else", ":", "\n", "            ", "if", "decoder_opt", "==", "1", ":", "\n", "                ", "max_query", "=", "hyp_mask", ".", "size", "(", "1", ")", "\n", "assert", "max_query", ">", "0", "\n", "assert", "premise_mask", "is", "not", "None", "\n", "assert", "hyp_mask", "is", "not", "None", "\n", "hyp_mem", "=", "last_hidden_state", "[", ":", ",", ":", "max_query", ",", ":", "]", "\n", "logits", "=", "self", ".", "scoring_list", "[", "task_id", "]", "(", "\n", "last_hidden_state", ",", "hyp_mem", ",", "premise_mask", ",", "hyp_mask", "\n", ")", "\n", "", "else", ":", "\n", "                ", "pooled_output", "=", "self", ".", "dropout_list", "[", "task_id", "]", "(", "pooled_output", ")", "\n", "logits", "=", "self", ".", "scoring_list", "[", "task_id", "]", "(", "pooled_output", ")", "\n", "", "return", "logits", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.matcher.generate_decoder_opt": [[17, 22], ["None"], "function", ["None"], ["def", "generate_decoder_opt", "(", "enable_san", ",", "max_opt", ")", ":", "\n", "    ", "opt_v", "=", "0", "\n", "if", "enable_san", "and", "max_opt", "<", "2", ":", "\n", "        ", "opt_v", "=", "max_opt", "\n", "", "return", "opt_v", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.inference.extract_encoding": [[16, 36], ["enumerate", "torch.cat", "model.cuda", "mt_dnn.batcher.Collater.patch_data", "model.encode", "sequence_outputs.append", "max", "torch.zeros", "new_sequence_outputs.append"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.cuda", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater.patch_data", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.encode"], ["def", "extract_encoding", "(", "model", ",", "data", ",", "use_cuda", "=", "True", ")", ":", "\n", "    ", "if", "use_cuda", ":", "\n", "        ", "model", ".", "cuda", "(", ")", "\n", "", "sequence_outputs", "=", "[", "]", "\n", "max_seq_len", "=", "0", "\n", "for", "idx", ",", "(", "batch_info", ",", "batch_data", ")", "in", "enumerate", "(", "data", ")", ":", "\n", "        ", "batch_info", ",", "batch_data", "=", "Collater", ".", "patch_data", "(", "use_cuda", ",", "batch_info", ",", "batch_data", ")", "\n", "sequence_output", "=", "model", ".", "encode", "(", "batch_info", ",", "batch_data", ")", "\n", "sequence_outputs", ".", "append", "(", "sequence_output", ")", "\n", "max_seq_len", "=", "max", "(", "max_seq_len", ",", "sequence_output", ".", "shape", "[", "1", "]", ")", "\n", "\n", "", "new_sequence_outputs", "=", "[", "]", "\n", "for", "sequence_output", "in", "sequence_outputs", ":", "\n", "        ", "new_sequence_output", "=", "torch", ".", "zeros", "(", "\n", "sequence_output", ".", "shape", "[", "0", "]", ",", "max_seq_len", ",", "sequence_output", ".", "shape", "[", "2", "]", "\n", ")", "\n", "new_sequence_output", "[", ":", ",", ":", "sequence_output", ".", "shape", "[", "1", "]", ",", ":", "]", "=", "sequence_output", "\n", "new_sequence_outputs", ".", "append", "(", "new_sequence_output", ")", "\n", "\n", "", "return", "torch", ".", "cat", "(", "new_sequence_outputs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.inference.reduce_multirc": [[38, 52], ["defaultdict", "defaultdict", "enumerate", "len", "len", "len", "len", "uid.split", "predict_map[].append", "gold_map[].append", "len"], "function", ["None"], ["", "def", "reduce_multirc", "(", "uids", ",", "predictions", ",", "golds", ")", ":", "\n", "    ", "assert", "len", "(", "uids", ")", "==", "len", "(", "predictions", ")", "\n", "assert", "len", "(", "uids", ")", "==", "len", "(", "golds", ")", "\n", "from", "collections", "import", "defaultdict", "\n", "\n", "predict_map", "=", "defaultdict", "(", "list", ")", "\n", "gold_map", "=", "defaultdict", "(", "list", ")", "\n", "for", "idx", ",", "uid", "in", "enumerate", "(", "uids", ")", ":", "\n", "        ", "blocks", "=", "uid", ".", "split", "(", "\"_\"", ")", "\n", "assert", "len", "(", "blocks", ")", "==", "3", "\n", "nuid", "=", "\"_\"", ".", "join", "(", "blocks", "[", ":", "-", "1", "]", ")", "\n", "predict_map", "[", "uid", "]", ".", "append", "(", "predictions", "[", "idx", "]", ")", "\n", "gold_map", "[", "uid", "]", ".", "append", "(", "golds", "[", "idx", "]", ")", "\n", "", "return", "predict_map", ",", "gold_map", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.inference.merge": [[54, 79], ["isinstance", "copy.deepcopy", "inference.merge._mg"], "function", ["None"], ["", "def", "merge", "(", "src", ",", "tgt", ")", ":", "\n", "    ", "def", "_mg", "(", "src", ",", "tgt", ")", ":", "\n", "        ", "if", "isinstance", "(", "src", ",", "dict", ")", ":", "\n", "            ", "for", "k", ",", "v", "in", "src", ".", "items", "(", ")", ":", "\n", "                ", "if", "k", "in", "tgt", ":", "\n", "                    ", "tgt", "[", "k", "]", "=", "_mg", "(", "v", ",", "tgt", "[", "k", "]", ")", "\n", "", "else", ":", "\n", "                    ", "tgt", "[", "k", "]", "=", "v", "\n", "", "", "", "elif", "isinstance", "(", "src", ",", "list", ")", ":", "\n", "            ", "tgt", ".", "extend", "(", "src", ")", "\n", "", "elif", "isinstance", "(", "src", ",", "tuple", ")", ":", "\n", "            ", "if", "isinstance", "(", "src", "[", "0", "]", ",", "list", ")", ":", "\n", "                ", "for", "i", ",", "k", "in", "enumerate", "(", "src", ")", ":", "\n", "                    ", "tgt", "[", "i", "]", ".", "extend", "(", "src", "[", "i", "]", ")", "\n", "", "", "else", ":", "\n", "                ", "tgt", ".", "extend", "(", "src", ")", "\n", "", "", "else", ":", "\n", "            ", "tgt", "=", "src", "\n", "", "return", "tgt", "\n", "\n", "", "if", "tgt", "is", "None", "or", "len", "(", "tgt", ")", "==", "0", ":", "\n", "        ", "tgt", "=", "deepcopy", "(", "src", ")", "\n", "return", "tgt", "\n", "", "else", ":", "\n", "        ", "return", "_mg", "(", "src", ",", "tgt", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.inference.eval_model": [[81, 115], ["tqdm.tqdm", "mt_dnn.batcher.Collater.patch_data", "model.predict", "inference.merge", "inference.merge", "inference.merge", "inference.merge", "data_utils.utils_qa.postprocess_qa_predictions", "data_utils.metrics.calc_metrics", "len", "data_utils.utils_qa.postprocess_qa_predictions"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater.patch_data", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.predict", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.inference.merge", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.inference.merge", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.inference.merge", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.inference.merge", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.utils_qa.postprocess_qa_predictions", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.metrics.calc_metrics", "home.repos.pwc.inspect_result.namisan_mt-dnn.data_utils.utils_qa.postprocess_qa_predictions"], ["", "", "def", "eval_model", "(", "\n", "model", ",", "\n", "data", ",", "\n", "metric_meta", ",", "\n", "device", ",", "\n", "with_label", "=", "True", ",", "\n", "label_mapper", "=", "None", ",", "\n", "task_type", "=", "TaskType", ".", "Classification", ",", "\n", ")", ":", "\n", "    ", "predictions", "=", "[", "]", "\n", "golds", "=", "[", "]", "\n", "scores", "=", "[", "]", "\n", "ids", "=", "[", "]", "\n", "metrics", "=", "{", "}", "\n", "for", "(", "batch_info", ",", "batch_data", ")", "in", "tqdm", "(", "data", ",", "total", "=", "len", "(", "data", ")", ")", ":", "\n", "        ", "batch_info", ",", "batch_data", "=", "Collater", ".", "patch_data", "(", "device", ",", "batch_info", ",", "batch_data", ")", "\n", "score", ",", "pred", ",", "gold", "=", "model", ".", "predict", "(", "batch_info", ",", "batch_data", ")", "\n", "scores", "=", "merge", "(", "score", ",", "scores", ")", "\n", "golds", "=", "merge", "(", "gold", ",", "golds", ")", "\n", "predictions", "=", "merge", "(", "pred", ",", "predictions", ")", "\n", "ids", "=", "merge", "(", "batch_info", "[", "\"uids\"", "]", ",", "ids", ")", "\n", "\n", "", "if", "task_type", "==", "TaskType", ".", "Span", ":", "\n", "        ", "predictions", ",", "golds", "=", "postprocess_qa_predictions", "(", "\n", "golds", ",", "scores", ",", "version_2_with_negative", "=", "False", "\n", ")", "\n", "", "elif", "task_type", "==", "TaskType", ".", "SpanYN", ":", "\n", "        ", "predictions", ",", "golds", "=", "postprocess_qa_predictions", "(", "\n", "golds", ",", "scores", ",", "version_2_with_negative", "=", "True", "\n", ")", "\n", "\n", "", "if", "with_label", ":", "\n", "        ", "metrics", "=", "calc_metrics", "(", "metric_meta", ",", "golds", ",", "predictions", ",", "scores", ",", "label_mapper", ")", "\n", "", "return", "metrics", ",", "predictions", ",", "scores", ",", "golds", ",", "ids", "\n", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.DistMultiTaskBatchSampler.__init__": [[39, 61], ["train_data_list.append", "batcher.DistMultiTaskBatchSampler._get_shuffled_index_batches", "len"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.MultiTaskBatchSampler._get_shuffled_index_batches"], ["    ", "def", "__init__", "(", "\n", "self", ",", "\n", "datasets", ",", "\n", "batch_size", ",", "\n", "mix_opt", ",", "\n", "extra_task_ratio", ",", "\n", "rank", "=", "0", ",", "\n", "world_size", "=", "1", ",", "\n", "drop_last", "=", "False", ",", "\n", ")", ":", "\n", "        ", "self", ".", "rank", "=", "rank", "\n", "self", ".", "world_size", "=", "world_size", "\n", "self", ".", "_datasets", "=", "datasets", "\n", "self", ".", "_mix_opt", "=", "mix_opt", "\n", "self", ".", "_extra_task_ratio", "=", "extra_task_ratio", "\n", "self", ".", "drop_last", "=", "drop_last", "\n", "train_data_list", "=", "[", "]", "\n", "for", "dataset", "in", "datasets", ":", "\n", "            ", "train_data_list", ".", "append", "(", "\n", "self", ".", "_get_shuffled_index_batches", "(", "len", "(", "dataset", ")", ",", "batch_size", ")", "\n", ")", "\n", "", "self", ".", "_train_data_list", "=", "train_data_list", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.DistMultiTaskBatchSampler._get_shuffled_index_batches": [[62, 70], ["random.shuffle", "list", "range", "range", "min"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "_get_shuffled_index_batches", "(", "dataset_len", ",", "batch_size", ")", ":", "\n", "        ", "index_batches", "=", "[", "\n", "list", "(", "range", "(", "i", ",", "min", "(", "i", "+", "batch_size", ",", "dataset_len", ")", ")", ")", "\n", "for", "i", "in", "range", "(", "0", ",", "dataset_len", ",", "batch_size", ")", "\n", "]", "\n", "random", ".", "shuffle", "(", "index_batches", ")", "\n", "return", "index_batches", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.DistMultiTaskBatchSampler.__len__": [[71, 73], ["sum", "len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "sum", "(", "len", "(", "train_data", ")", "for", "train_data", "in", "self", ".", "_train_data_list", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.DistMultiTaskBatchSampler.__iter__": [[74, 97], ["batcher.DistMultiTaskBatchSampler._gen_task_indices", "iter", "batcher.DistMultiTaskBatchSampler._datasets[].get_task_id", "next", "len", "len", "next.extend", "range", "len"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.MultiTaskBatchSampler._gen_task_indices", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.SingleTaskDataset.get_task_id"], ["", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "all_iters", "=", "[", "iter", "(", "item", ")", "for", "item", "in", "self", ".", "_train_data_list", "]", "\n", "all_indices", "=", "self", ".", "_gen_task_indices", "(", "\n", "self", ".", "_train_data_list", ",", "self", ".", "_mix_opt", ",", "self", ".", "_extra_task_ratio", "\n", ")", "\n", "for", "local_task_idx", "in", "all_indices", ":", "\n", "            ", "task_id", "=", "self", ".", "_datasets", "[", "local_task_idx", "]", ".", "get_task_id", "(", ")", "\n", "batch", "=", "next", "(", "all_iters", "[", "local_task_idx", "]", ")", "\n", "batch", "=", "[", "(", "task_id", ",", "sample_id", ")", "for", "sample_id", "in", "batch", "]", "\n", "if", "len", "(", "batch", ")", "%", "self", ".", "world_size", "!=", "0", ":", "\n", "                ", "if", "self", ".", "drop_last", ":", "\n", "                    ", "break", "\n", "", "else", ":", "\n", "                    ", "batch", ".", "extend", "(", "\n", "[", "\n", "batch", "[", "0", "]", "\n", "for", "_", "in", "range", "(", "\n", "self", ".", "world_size", "-", "len", "(", "batch", ")", "%", "self", ".", "world_size", "\n", ")", "\n", "]", "\n", ")", "\n", "", "", "chunk_size", "=", "len", "(", "batch", ")", "//", "self", ".", "world_size", "\n", "yield", "batch", "[", "self", ".", "rank", "*", "chunk_size", ":", "(", "self", ".", "rank", "+", "1", ")", "*", "chunk_size", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.DistMultiTaskBatchSampler._gen_task_indices": [[98, 126], ["range", "int", "numpy.random.choice", "range", "random.shuffle", "len", "len", "len", "min", "extra_indices.tolist.tolist.tolist", "random.shuffle", "len", "random.shuffle", "len", "len", "len", "extra_indices.tolist.tolist.tolist", "len", "len"], "methods", ["None"], ["", "", "@", "staticmethod", "\n", "def", "_gen_task_indices", "(", "train_data_list", ",", "mix_opt", ",", "extra_task_ratio", ")", ":", "\n", "        ", "all_indices", "=", "[", "]", "\n", "if", "len", "(", "train_data_list", ")", ">", "1", "and", "extra_task_ratio", ">", "0", ":", "\n", "            ", "main_indices", "=", "[", "0", "]", "*", "len", "(", "train_data_list", "[", "0", "]", ")", "\n", "extra_indices", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "1", ",", "len", "(", "train_data_list", ")", ")", ":", "\n", "                ", "extra_indices", "+=", "[", "i", "]", "*", "len", "(", "train_data_list", "[", "i", "]", ")", "\n", "", "random_picks", "=", "int", "(", "\n", "min", "(", "len", "(", "train_data_list", "[", "0", "]", ")", "*", "extra_task_ratio", ",", "len", "(", "extra_indices", ")", ")", "\n", ")", "\n", "extra_indices", "=", "np", ".", "random", ".", "choice", "(", "extra_indices", ",", "random_picks", ",", "replace", "=", "False", ")", "\n", "if", "mix_opt", ">", "0", ":", "\n", "                ", "extra_indices", "=", "extra_indices", ".", "tolist", "(", ")", "\n", "random", ".", "shuffle", "(", "extra_indices", ")", "\n", "all_indices", "=", "extra_indices", "+", "main_indices", "\n", "", "else", ":", "\n", "                ", "all_indices", "=", "main_indices", "+", "extra_indices", ".", "tolist", "(", ")", "\n", "\n", "", "", "else", ":", "\n", "            ", "for", "i", "in", "range", "(", "1", ",", "len", "(", "train_data_list", ")", ")", ":", "\n", "                ", "all_indices", "+=", "[", "i", "]", "*", "len", "(", "train_data_list", "[", "i", "]", ")", "\n", "", "if", "mix_opt", ">", "0", ":", "\n", "                ", "random", ".", "shuffle", "(", "all_indices", ")", "\n", "", "all_indices", "+=", "[", "0", "]", "*", "len", "(", "train_data_list", "[", "0", "]", ")", "\n", "", "if", "mix_opt", "<", "1", ":", "\n", "            ", "random", ".", "shuffle", "(", "all_indices", ")", "\n", "", "return", "all_indices", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.DistSingleTaskBatchSampler.__init__": [[129, 135], ["batcher.DistSingleTaskBatchSampler._get_index_batches", "len"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.DistSingleTaskBatchSampler._get_index_batches"], ["    ", "def", "__init__", "(", "self", ",", "dataset", ",", "batch_size", ",", "rank", "=", "0", ",", "world_size", "=", "1", ",", "drop_last", "=", "False", ")", ":", "\n", "        ", "self", ".", "rank", "=", "rank", "\n", "self", ".", "world_size", "=", "world_size", "\n", "self", ".", "_dataset", "=", "dataset", "\n", "self", ".", "drop_last", "=", "drop_last", "\n", "self", ".", "_data", "=", "self", ".", "_get_index_batches", "(", "len", "(", "dataset", ")", ",", "batch_size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.DistSingleTaskBatchSampler._get_index_batches": [[136, 143], ["list", "range", "range", "min"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "_get_index_batches", "(", "dataset_len", ",", "batch_size", ")", ":", "\n", "        ", "index_batches", "=", "[", "\n", "list", "(", "range", "(", "i", ",", "min", "(", "i", "+", "batch_size", ",", "dataset_len", ")", ")", ")", "\n", "for", "i", "in", "range", "(", "0", ",", "dataset_len", ",", "batch_size", ")", "\n", "]", "\n", "return", "index_batches", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.DistSingleTaskBatchSampler.__len__": [[144, 146], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "_data", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.DistSingleTaskBatchSampler.__iter__": [[147, 153], ["iter", "batcher.DistSingleTaskBatchSampler._dataset.get_task_id"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.SingleTaskDataset.get_task_id"], ["", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "indices", "=", "iter", "(", "self", ".", "_data", ")", "\n", "for", "batch", "in", "indices", ":", "\n", "            ", "task_id", "=", "self", ".", "_dataset", ".", "get_task_id", "(", ")", "\n", "batch", "=", "[", "(", "task_id", ",", "sample_id", ")", "for", "sample_id", "in", "batch", "]", "\n", "yield", "batch", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.MultiTaskBatchSampler.__init__": [[156, 189], ["train_data_list.append", "train_data_list.append", "batcher.MultiTaskBatchSampler._get_shuffled_index_batches_bin", "batcher.MultiTaskBatchSampler._get_shuffled_index_batches", "len"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.MultiTaskBatchSampler._get_shuffled_index_batches_bin", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.MultiTaskBatchSampler._get_shuffled_index_batches"], ["    ", "def", "__init__", "(", "\n", "self", ",", "\n", "datasets", ",", "\n", "batch_size", ",", "\n", "mix_opt", ",", "\n", "extra_task_ratio", ",", "\n", "bin_size", "=", "64", ",", "\n", "bin_on", "=", "False", ",", "\n", "bin_grow_ratio", "=", "0.5", ",", "\n", ")", ":", "\n", "        ", "self", ".", "_datasets", "=", "datasets", "\n", "self", ".", "_batch_size", "=", "batch_size", "\n", "self", ".", "_mix_opt", "=", "mix_opt", "\n", "self", ".", "_extra_task_ratio", "=", "extra_task_ratio", "\n", "self", ".", "bin_size", "=", "bin_size", "\n", "self", ".", "bin_on", "=", "bin_on", "\n", "self", ".", "bin_grow_ratio", "=", "bin_grow_ratio", "\n", "train_data_list", "=", "[", "]", "\n", "for", "dataset", "in", "datasets", ":", "\n", "            ", "if", "bin_on", ":", "\n", "                ", "train_data_list", ".", "append", "(", "\n", "self", ".", "_get_shuffled_index_batches_bin", "(", "\n", "dataset", ",", "\n", "batch_size", ",", "\n", "bin_size", "=", "bin_size", ",", "\n", "bin_grow_ratio", "=", "bin_grow_ratio", ",", "\n", ")", "\n", ")", "\n", "", "else", ":", "\n", "                ", "train_data_list", ".", "append", "(", "\n", "self", ".", "_get_shuffled_index_batches", "(", "len", "(", "dataset", ")", ",", "batch_size", ")", "\n", ")", "\n", "", "", "self", ".", "_train_data_list", "=", "train_data_list", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.MultiTaskBatchSampler._get_shuffled_index_batches": [[190, 198], ["random.shuffle", "list", "range", "range", "min"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "_get_shuffled_index_batches", "(", "dataset_len", ",", "batch_size", ")", ":", "\n", "        ", "index_batches", "=", "[", "\n", "list", "(", "range", "(", "i", ",", "min", "(", "i", "+", "batch_size", ",", "dataset_len", ")", ")", ")", "\n", "for", "i", "in", "range", "(", "0", ",", "dataset_len", ",", "batch_size", ")", "\n", "]", "\n", "random", ".", "shuffle", "(", "index_batches", ")", "\n", "return", "index_batches", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.MultiTaskBatchSampler._get_shuffled_index_batches_bin": [[199, 223], ["batcher.create_bins", "enumerate", "enumerate", "random.shuffle", "batcher.search_bin", "data[].append", "len", "index_batches.extend", "int", "range", "len", "len", "list", "len", "range", "range", "min"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.create_bins", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.search_bin"], ["", "@", "staticmethod", "\n", "def", "_get_shuffled_index_batches_bin", "(", "dataset", ",", "batch_size", ",", "bin_size", ",", "bin_grow_ratio", ")", ":", "\n", "        ", "maxlen", "=", "dataset", ".", "maxlen", "\n", "bins", "=", "create_bins", "(", "bin_size", ",", "maxlen", ")", "\n", "data", "=", "[", "[", "]", "for", "i", "in", "range", "(", "0", ",", "len", "(", "bins", ")", ")", "]", "\n", "\n", "for", "idx", ",", "sample", "in", "enumerate", "(", "dataset", ")", ":", "\n", "            ", "bin_idx", "=", "search_bin", "(", "bins", ",", "len", "(", "sample", "[", "\"sample\"", "]", "[", "\"token_id\"", "]", ")", ")", "\n", "data", "[", "bin_idx", "]", ".", "append", "(", "idx", ")", "\n", "", "index_batches", "=", "[", "]", "\n", "\n", "for", "idx", ",", "sub_data", "in", "enumerate", "(", "data", ")", ":", "\n", "            ", "if", "len", "(", "sub_data", ")", "<", "1", ":", "\n", "                ", "continue", "\n", "", "batch_size", "=", "1", "if", "batch_size", "<", "1", "else", "batch_size", "\n", "sub_dataset_len", "=", "len", "(", "sub_data", ")", "\n", "sub_batches", "=", "[", "\n", "list", "(", "range", "(", "i", ",", "min", "(", "i", "+", "batch_size", ",", "sub_dataset_len", ")", ")", ")", "\n", "for", "i", "in", "range", "(", "0", ",", "sub_dataset_len", ",", "batch_size", ")", "\n", "]", "\n", "index_batches", ".", "extend", "(", "sub_batches", ")", "\n", "batch_size", "=", "int", "(", "batch_size", "*", "bin_grow_ratio", ")", "\n", "", "random", ".", "shuffle", "(", "index_batches", ")", "\n", "return", "index_batches", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.MultiTaskBatchSampler.__len__": [[224, 226], ["sum", "len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "sum", "(", "len", "(", "train_data", ")", "for", "train_data", "in", "self", ".", "_train_data_list", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.MultiTaskBatchSampler.__iter__": [[227, 236], ["batcher.MultiTaskBatchSampler._gen_task_indices", "iter", "batcher.MultiTaskBatchSampler._datasets[].get_task_id", "next"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.MultiTaskBatchSampler._gen_task_indices", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.SingleTaskDataset.get_task_id"], ["", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "all_iters", "=", "[", "iter", "(", "item", ")", "for", "item", "in", "self", ".", "_train_data_list", "]", "\n", "all_indices", "=", "self", ".", "_gen_task_indices", "(", "\n", "self", ".", "_train_data_list", ",", "self", ".", "_mix_opt", ",", "self", ".", "_extra_task_ratio", "\n", ")", "\n", "for", "local_task_idx", "in", "all_indices", ":", "\n", "            ", "task_id", "=", "self", ".", "_datasets", "[", "local_task_idx", "]", ".", "get_task_id", "(", ")", "\n", "batch", "=", "next", "(", "all_iters", "[", "local_task_idx", "]", ")", "\n", "yield", "[", "(", "task_id", ",", "sample_id", ")", "for", "sample_id", "in", "batch", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.MultiTaskBatchSampler._gen_task_indices": [[237, 265], ["range", "int", "numpy.random.choice", "range", "random.shuffle", "len", "len", "len", "min", "extra_indices.tolist.tolist.tolist", "random.shuffle", "len", "random.shuffle", "len", "len", "len", "extra_indices.tolist.tolist.tolist", "len", "len"], "methods", ["None"], ["", "", "@", "staticmethod", "\n", "def", "_gen_task_indices", "(", "train_data_list", ",", "mix_opt", ",", "extra_task_ratio", ")", ":", "\n", "        ", "all_indices", "=", "[", "]", "\n", "if", "len", "(", "train_data_list", ")", ">", "1", "and", "extra_task_ratio", ">", "0", ":", "\n", "            ", "main_indices", "=", "[", "0", "]", "*", "len", "(", "train_data_list", "[", "0", "]", ")", "\n", "extra_indices", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "1", ",", "len", "(", "train_data_list", ")", ")", ":", "\n", "                ", "extra_indices", "+=", "[", "i", "]", "*", "len", "(", "train_data_list", "[", "i", "]", ")", "\n", "", "random_picks", "=", "int", "(", "\n", "min", "(", "len", "(", "train_data_list", "[", "0", "]", ")", "*", "extra_task_ratio", ",", "len", "(", "extra_indices", ")", ")", "\n", ")", "\n", "extra_indices", "=", "np", ".", "random", ".", "choice", "(", "extra_indices", ",", "random_picks", ",", "replace", "=", "False", ")", "\n", "if", "mix_opt", ">", "0", ":", "\n", "                ", "extra_indices", "=", "extra_indices", ".", "tolist", "(", ")", "\n", "random", ".", "shuffle", "(", "extra_indices", ")", "\n", "all_indices", "=", "extra_indices", "+", "main_indices", "\n", "", "else", ":", "\n", "                ", "all_indices", "=", "main_indices", "+", "extra_indices", ".", "tolist", "(", ")", "\n", "\n", "", "", "else", ":", "\n", "            ", "for", "i", "in", "range", "(", "1", ",", "len", "(", "train_data_list", ")", ")", ":", "\n", "                ", "all_indices", "+=", "[", "i", "]", "*", "len", "(", "train_data_list", "[", "i", "]", ")", "\n", "", "if", "mix_opt", ">", "0", ":", "\n", "                ", "random", ".", "shuffle", "(", "all_indices", ")", "\n", "", "all_indices", "+=", "[", "0", "]", "*", "len", "(", "train_data_list", "[", "0", "]", ")", "\n", "", "if", "mix_opt", "<", "1", ":", "\n", "            ", "random", ".", "shuffle", "(", "all_indices", ")", "\n", "", "return", "all_indices", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.MultiTaskDataset.__init__": [[268, 279], ["dataset.get_task_id"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.SingleTaskDataset.get_task_id"], ["    ", "def", "__init__", "(", "self", ",", "datasets", ")", ":", "\n", "        ", "self", ".", "_datasets", "=", "datasets", "\n", "task_id_2_data_set_dic", "=", "{", "}", "\n", "for", "dataset", "in", "datasets", ":", "\n", "            ", "task_id", "=", "dataset", ".", "get_task_id", "(", ")", "\n", "assert", "task_id", "not", "in", "task_id_2_data_set_dic", ",", "(", "\n", "\"Duplicate task_id %s\"", "%", "task_id", "\n", ")", "\n", "task_id_2_data_set_dic", "[", "task_id", "]", "=", "dataset", "\n", "\n", "", "self", ".", "_task_id_2_data_set_dic", "=", "task_id_2_data_set_dic", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.MultiTaskDataset.__len__": [[280, 282], ["sum", "len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "sum", "(", "len", "(", "dataset", ")", "for", "dataset", "in", "self", ".", "_datasets", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.MultiTaskDataset.__getitem__": [[283, 286], ["None"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "idx", ")", ":", "\n", "        ", "task_id", ",", "sample_id", "=", "idx", "\n", "return", "self", ".", "_task_id_2_data_set_dic", "[", "task_id", "]", "[", "sample_id", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.DistTaskDataset.__init__": [[289, 291], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "dataset", ",", "task_id", ")", ":", "\n", "        ", "self", ".", "_dataset", "=", "dataset", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.DistTaskDataset.__len__": [[292, 294], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "_dataset", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.DistTaskDataset.__getitem__": [[295, 298], ["None"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "idx", ")", ":", "\n", "        ", "_", ",", "sample_id", "=", "idx", "\n", "return", "self", ".", "_dataset", "[", "sample_id", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.DistTaskDataset.get_task_id": [[299, 301], ["batcher.DistTaskDataset._dataset.get_task_id"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.SingleTaskDataset.get_task_id"], ["", "def", "get_task_id", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_dataset", ".", "get_task_id", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.SingleTaskDataset.__init__": [[304, 349], ["batcher.SingleTaskDataset.load", "random.Random", "list", "batcher.SingleTaskDataset._tokenizer.vocab.keys"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load"], ["    ", "def", "__init__", "(", "\n", "self", ",", "\n", "path", ",", "\n", "is_train", "=", "True", ",", "\n", "maxlen", "=", "512", ",", "\n", "factor", "=", "1.0", ",", "\n", "task_id", "=", "0", ",", "\n", "task_def", ":", "TaskDef", "=", "None", ",", "\n", "bert_model", "=", "\"bert-base-uncased\"", ",", "\n", "do_lower_case", "=", "True", ",", "\n", "masked_lm_prob", "=", "0.15", ",", "\n", "seed", "=", "13", ",", "\n", "short_seq_prob", "=", "0.1", ",", "\n", "max_seq_length", "=", "512", ",", "\n", "max_predictions_per_seq", "=", "80", ",", "\n", "printable", "=", "True", ",", "\n", ")", ":", "\n", "        ", "data", ",", "tokenizer", "=", "self", ".", "load", "(", "\n", "path", ",", "\n", "is_train", ",", "\n", "maxlen", ",", "\n", "factor", ",", "\n", "task_def", ",", "\n", "bert_model", ",", "\n", "do_lower_case", ",", "\n", "printable", "=", "printable", ",", "\n", ")", "\n", "self", ".", "_data", "=", "data", "\n", "self", ".", "_tokenizer", "=", "tokenizer", "\n", "self", ".", "_task_id", "=", "task_id", "\n", "self", ".", "_task_def", "=", "task_def", "\n", "# below is for MLM", "\n", "if", "self", ".", "_task_def", ".", "task_type", "is", "TaskType", ".", "MaskLM", ":", "\n", "            ", "assert", "tokenizer", "is", "not", "None", "\n", "# init vocab words", "\n", "", "self", ".", "_vocab_words", "=", "(", "\n", "None", "if", "tokenizer", "is", "None", "else", "list", "(", "self", ".", "_tokenizer", ".", "vocab", ".", "keys", "(", ")", ")", "\n", ")", "\n", "self", ".", "_masked_lm_prob", "=", "masked_lm_prob", "\n", "self", ".", "_seed", "=", "seed", "\n", "self", ".", "_short_seq_prob", "=", "short_seq_prob", "\n", "self", ".", "_max_seq_length", "=", "max_seq_length", "\n", "self", ".", "_max_predictions_per_seq", "=", "max_predictions_per_seq", "\n", "self", ".", "_rng", "=", "random", ".", "Random", "(", "seed", ")", "\n", "self", ".", "maxlen", "=", "maxlen", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.SingleTaskDataset.get_task_id": [[350, 352], ["None"], "methods", ["None"], ["", "def", "get_task_id", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_task_id", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.SingleTaskDataset.load": [[353, 410], ["batcher.SingleTaskDataset.load.load_mlm_data"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "load", "(", "\n", "path", ",", "\n", "is_train", "=", "True", ",", "\n", "maxlen", "=", "512", ",", "\n", "factor", "=", "1.0", ",", "\n", "task_def", "=", "None", ",", "\n", "bert_model", "=", "\"bert-base-uncased\"", ",", "\n", "do_lower_case", "=", "True", ",", "\n", "printable", "=", "True", ",", "\n", ")", ":", "\n", "        ", "task_type", "=", "task_def", ".", "task_type", "\n", "assert", "task_type", "is", "not", "None", "\n", "\n", "if", "task_type", "==", "TaskType", ".", "MaskLM", ":", "\n", "\n", "            ", "def", "load_mlm_data", "(", "path", ")", ":", "\n", "                ", "from", "transformers", "import", "AutoTokenizer", "\n", "tokenizer", "=", "AutoTokenizer", ".", "from_pretrained", "(", "bert_model", ",", "cache_dir", "=", "\".cache\"", ")", "\n", "vocab_words", "=", "list", "(", "tokenizer", ".", "vocab", ".", "keys", "(", ")", ")", "\n", "data", "=", "load_loose_json", "(", "path", ")", "\n", "docs", "=", "[", "]", "\n", "for", "doc", "in", "data", ":", "\n", "                    ", "paras", "=", "doc", "[", "\"text\"", "]", ".", "split", "(", "\"\\n\\n\"", ")", "\n", "paras", "=", "[", "para", ".", "strip", "(", ")", "for", "para", "in", "paras", "if", "len", "(", "para", ".", "strip", "(", ")", ")", ">", "0", "]", "\n", "tokens", "=", "[", "tokenizer", ".", "tokenize", "(", "para", ")", "for", "para", "in", "paras", "]", "\n", "docs", ".", "append", "(", "tokens", ")", "\n", "", "return", "docs", ",", "tokenizer", "\n", "\n", "", "return", "load_mlm_data", "(", "path", ")", "\n", "\n", "", "with", "open", "(", "path", ",", "\"r\"", ",", "encoding", "=", "\"utf-8\"", ")", "as", "reader", ":", "\n", "            ", "data", "=", "[", "]", "\n", "cnt", "=", "0", "\n", "for", "line", "in", "reader", ":", "\n", "                ", "sample", "=", "json", ".", "loads", "(", "line", ")", "\n", "sample", "[", "\"factor\"", "]", "=", "factor", "\n", "cnt", "+=", "1", "\n", "if", "is_train", ":", "\n", "                    ", "task_obj", "=", "tasks", ".", "get_task_obj", "(", "task_def", ")", "\n", "if", "task_obj", "is", "not", "None", "and", "not", "task_obj", ".", "input_is_valid_sample", "(", "\n", "sample", ",", "maxlen", "\n", ")", ":", "\n", "                        ", "continue", "\n", "", "if", "(", "task_type", "==", "TaskType", ".", "Ranking", ")", "and", "(", "\n", "len", "(", "sample", "[", "\"token_id\"", "]", "[", "0", "]", ")", ">", "maxlen", "\n", "or", "len", "(", "sample", "[", "\"token_id\"", "]", "[", "1", "]", ")", ">", "maxlen", "\n", ")", ":", "\n", "                        ", "continue", "\n", "", "if", "(", "task_type", "!=", "TaskType", ".", "Ranking", ")", "and", "(", "\n", "len", "(", "sample", "[", "\"token_id\"", "]", ")", ">", "maxlen", "\n", ")", ":", "\n", "                        ", "continue", "\n", "", "", "data", ".", "append", "(", "sample", ")", "\n", "", "if", "printable", ":", "\n", "                ", "print", "(", "\"Loaded {} samples out of {}\"", ".", "format", "(", "len", "(", "data", ")", ",", "cnt", ")", ")", "\n", "", "", "return", "data", ",", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.SingleTaskDataset.__len__": [[411, 413], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "_data", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.SingleTaskDataset.__getitem__": [[414, 449], ["experiments.mlm.mlm_utils.create_instances_from_document", "list", "batcher.SingleTaskDataset._tokenizer.convert_tokens_to_ids", "range", "numpy.random.choice", "batcher.SingleTaskDataset._tokenizer.convert_tokens_to_ids", "len", "enumerate"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mlm.mlm_utils.create_instances_from_document"], ["", "def", "__getitem__", "(", "self", ",", "idx", ")", ":", "\n", "        ", "if", "self", ".", "_task_def", ".", "task_type", "==", "TaskType", ".", "MaskLM", ":", "\n", "# create a MLM instance", "\n", "            ", "instances", "=", "create_instances_from_document", "(", "\n", "self", ".", "_data", ",", "\n", "idx", ",", "\n", "self", ".", "_max_seq_length", ",", "\n", "self", ".", "_short_seq_prob", ",", "\n", "self", ".", "_masked_lm_prob", ",", "\n", "self", ".", "_max_predictions_per_seq", ",", "\n", "self", ".", "_vocab_words", ",", "\n", "self", ".", "_rng", ",", "\n", ")", "\n", "instance_ids", "=", "list", "(", "range", "(", "0", ",", "len", "(", "instances", ")", ")", ")", "\n", "choice", "=", "np", ".", "random", ".", "choice", "(", "instance_ids", ",", "1", ")", "[", "0", "]", "\n", "instance", "=", "instances", "[", "choice", "]", "\n", "labels", "=", "self", ".", "_tokenizer", ".", "convert_tokens_to_ids", "(", "instance", ".", "masked_lm_labels", ")", "\n", "position", "=", "instance", ".", "masked_lm_positions", "\n", "labels", "=", "[", "lab", "if", "idx", "in", "position", "else", "-", "1", "for", "idx", ",", "lab", "in", "enumerate", "(", "labels", ")", "]", "\n", "sample", "=", "{", "\n", "\"token_id\"", ":", "self", ".", "_tokenizer", ".", "convert_tokens_to_ids", "(", "instance", ".", "tokens", ")", ",", "\n", "\"type_id\"", ":", "instance", ".", "segment_ids", ",", "\n", "\"nsp_lab\"", ":", "1", "if", "instance", ".", "is_random_next", "else", "0", ",", "\n", "\"position\"", ":", "instance", ".", "masked_lm_positions", ",", "\n", "\"label\"", ":", "labels", ",", "\n", "\"uid\"", ":", "idx", ",", "\n", "}", "\n", "return", "{", "\n", "\"task\"", ":", "{", "\"task_id\"", ":", "self", ".", "_task_id", ",", "\"task_def\"", ":", "self", ".", "_task_def", "}", ",", "\n", "\"sample\"", ":", "sample", ",", "\n", "}", "\n", "", "else", ":", "\n", "            ", "return", "{", "\n", "\"task\"", ":", "{", "\"task_id\"", ":", "self", ".", "_task_id", ",", "\"task_def\"", ":", "self", ".", "_task_def", "}", ",", "\n", "\"sample\"", ":", "self", ".", "_data", "[", "idx", "]", ",", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater.__init__": [[453, 469], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "\n", "self", ",", "\n", "is_train", "=", "True", ",", "\n", "dropout_w", "=", "0.005", ",", "\n", "soft_label", "=", "False", ",", "\n", "encoder_type", "=", "EncoderModelType", ".", "BERT", ",", "\n", "max_seq_len", "=", "512", ",", "\n", "do_padding", "=", "False", ",", "\n", ")", ":", "\n", "        ", "self", ".", "is_train", "=", "is_train", "\n", "self", ".", "dropout_w", "=", "dropout_w", "\n", "self", ".", "soft_label_on", "=", "soft_label", "\n", "self", ".", "encoder_type", "=", "encoder_type", "\n", "self", ".", "pairwise_size", "=", "1", "\n", "self", ".", "max_seq_len", "=", "max_seq_len", "\n", "self", ".", "do_padding", "=", "do_padding", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater.__random_select__": [[470, 475], ["random.uniform"], "methods", ["None"], ["", "def", "__random_select__", "(", "self", ",", "arr", ")", ":", "\n", "        ", "if", "self", ".", "dropout_w", ">", "0", ":", "\n", "            ", "return", "[", "UNK_ID", "if", "random", ".", "uniform", "(", "0", ",", "1", ")", "<", "self", ".", "dropout_w", "else", "e", "for", "e", "in", "arr", "]", "\n", "", "else", ":", "\n", "            ", "return", "arr", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater.patch_data": [[476, 500], ["str", "enumerate", "isinstance", "part.pin_memory().to", "isinstance", "batch_info[].pin_memory().to", "tuple", "isinstance", "part.pin_memory", "TypeError", "batch_info[].pin_memory", "sub_part.pin_memory().to", "sub_part.pin_memory().to", "sub_part.pin_memory", "sub_part.pin_memory"], "methods", ["None"], ["", "", "@", "staticmethod", "\n", "def", "patch_data", "(", "device", ",", "batch_info", ",", "batch_data", ")", ":", "\n", "        ", "if", "str", "(", "device", ")", "!=", "\"cpu\"", ":", "\n", "            ", "for", "i", ",", "part", "in", "enumerate", "(", "batch_data", ")", ":", "\n", "                ", "if", "part", "is", "None", ":", "\n", "                    ", "continue", "\n", "", "if", "isinstance", "(", "part", ",", "torch", ".", "Tensor", ")", ":", "\n", "                    ", "batch_data", "[", "i", "]", "=", "part", ".", "pin_memory", "(", ")", ".", "to", "(", "device", ")", "\n", "", "elif", "isinstance", "(", "part", ",", "tuple", ")", ":", "\n", "                    ", "batch_data", "[", "i", "]", "=", "tuple", "(", "\n", "sub_part", ".", "pin_memory", "(", ")", ".", "to", "(", "device", ")", "for", "sub_part", "in", "part", "\n", ")", "\n", "", "elif", "isinstance", "(", "part", ",", "list", ")", ":", "\n", "                    ", "batch_data", "[", "i", "]", "=", "[", "\n", "sub_part", ".", "pin_memory", "(", ")", ".", "to", "(", "device", ")", "for", "sub_part", "in", "part", "\n", "]", "\n", "", "else", ":", "\n", "                    ", "raise", "TypeError", "(", "\"unknown batch data type at %s: %s\"", "%", "(", "i", ",", "part", ")", ")", "\n", "\n", "", "if", "\"soft_label\"", "in", "batch_info", ":", "\n", "                    ", "batch_info", "[", "\"soft_label\"", "]", "=", "(", "\n", "batch_info", "[", "\"soft_label\"", "]", ".", "pin_memory", "(", ")", ".", "to", "(", "device", ")", "\n", ")", "\n", "", "", "", "return", "batch_info", ",", "batch_data", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater.rebatch": [[501, 523], ["len", "sizes.append", "range", "len", "copy.deepcopy", "newbatch.append"], "methods", ["None"], ["", "def", "rebatch", "(", "self", ",", "batch", ")", ":", "\n", "        ", "newbatch", "=", "[", "]", "\n", "sizes", "=", "[", "]", "\n", "for", "sample", "in", "batch", ":", "\n", "            ", "size", "=", "len", "(", "sample", "[", "\"token_id\"", "]", ")", "\n", "sizes", ".", "append", "(", "size", ")", "\n", "self", ".", "pairwise_size", "=", "size", "\n", "assert", "size", "==", "len", "(", "sample", "[", "\"type_id\"", "]", ")", "\n", "for", "idx", "in", "range", "(", "0", ",", "size", ")", ":", "\n", "                ", "token_id", "=", "sample", "[", "\"token_id\"", "]", "[", "idx", "]", "\n", "type_id", "=", "sample", "[", "\"type_id\"", "]", "[", "idx", "]", "\n", "attention_mask", "=", "sample", "[", "\"attention_mask\"", "]", "[", "idx", "]", "\n", "uid", "=", "sample", "[", "\"ruid\"", "]", "[", "idx", "]", "if", "\"ruid\"", "in", "sample", "else", "sample", "[", "\"uid\"", "]", "\n", "olab", "=", "sample", "[", "\"olabel\"", "]", "[", "idx", "]", "\n", "new_sample", "=", "deepcopy", "(", "sample", ")", "\n", "new_sample", "[", "\"uid\"", "]", "=", "uid", "\n", "new_sample", "[", "\"token_id\"", "]", "=", "token_id", "\n", "new_sample", "[", "\"type_id\"", "]", "=", "type_id", "\n", "new_sample", "[", "\"attention_mask\"", "]", "=", "attention_mask", "\n", "new_sample", "[", "\"true_label\"", "]", "=", "olab", "\n", "newbatch", ".", "append", "(", "new_sample", ")", "\n", "", "", "return", "newbatch", ",", "sizes", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater.__if_pair__": [[524, 528], ["None"], "methods", ["None"], ["", "def", "__if_pair__", "(", "self", ",", "data_type", ")", ":", "\n", "        ", "return", "data_type", "in", "[", "\n", "DataFormat", ".", "PremiseAndOneHypothesis", ",", "\n", "DataFormat", ".", "PremiseAndMultiHypothesis", ",", "\n", "]", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater.collate_fn": [[530, 676], ["batcher.Collater._prepare_model_input", "len", "tasks.get_task_obj", "new_batch.append", "batcher.Collater.rebatch", "batch_data.append", "tasks.get_task_obj.train_prepare_soft_labels", "tasks.get_task_obj.test_prepare_label", "tasks.get_task_obj.train_prepare_label", "len", "batch_data.append", "torch.LongTensor", "len", "batch_data.append", "sample.get", "len", "batch_data.append", "type", "random.choice", "start.append", "end.append", "start.append", "end.append", "torch.LongTensor", "torch.LongTensor", "len", "batcher.Collater._get_batch_size", "batcher.Collater._get_max_len", "torch.LongTensor().fill_", "enumerate", "batch_data.append", "type", "range", "type", "random.choice", "start.append", "end.append", "start.append", "end.append", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "len", "torch.LongTensor", "len", "batcher.Collater._get_batch_size", "batcher.Collater._get_max_len", "torch.LongTensor().fill_", "enumerate", "torch.LongTensor", "batch_data.append", "len", "type", "range", "torch.LongTensor", "len", "torch.LongTensor", "len", "batcher.Collater._get_batch_size", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor.masked_fill_", "batch_data.append", "batch_data.append", "len", "torch.LongTensor", "len", "len"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater._prepare_model_input", "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.get_task_obj", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater.rebatch", "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.MTDNNTask.test_prepare_label", "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.ClassificationTask.train_prepare_label", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater._get_batch_size", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater._get_max_len", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater._get_batch_size", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater._get_max_len", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater._get_batch_size"], ["", "def", "collate_fn", "(", "self", ",", "batch", ")", ":", "\n", "        ", "task_id", "=", "batch", "[", "0", "]", "[", "\"task\"", "]", "[", "\"task_id\"", "]", "\n", "task_def", "=", "batch", "[", "0", "]", "[", "\"task\"", "]", "[", "\"task_def\"", "]", "\n", "new_batch", "=", "[", "]", "\n", "for", "sample", "in", "batch", ":", "\n", "            ", "assert", "sample", "[", "\"task\"", "]", "[", "\"task_id\"", "]", "==", "task_id", "\n", "assert", "sample", "[", "\"task\"", "]", "[", "\"task_def\"", "]", "==", "task_def", "\n", "new_batch", ".", "append", "(", "sample", "[", "\"sample\"", "]", ")", "\n", "", "task_type", "=", "task_def", ".", "task_type", "\n", "data_type", "=", "task_def", ".", "data_type", "\n", "batch", "=", "new_batch", "\n", "\n", "if", "task_type", "==", "TaskType", ".", "Ranking", "or", "task_type", "==", "TaskType", ".", "ClozeChoice", ":", "\n", "            ", "batch", ",", "chunk_sizes", "=", "self", ".", "rebatch", "(", "batch", ")", "\n", "\n", "# prepare model input", "\n", "", "batch_info", ",", "batch_data", "=", "self", ".", "_prepare_model_input", "(", "batch", ",", "data_type", ")", "\n", "batch_info", "[", "\"task_id\"", "]", "=", "task_id", "# used for select correct decoding head", "\n", "batch_info", "[", "\"input_len\"", "]", "=", "len", "(", "batch_data", ")", "# used to select model inputs", "\n", "# select different loss function and other difference in training and testing", "\n", "# DataLoader will convert any unknown type objects to dict,", "\n", "# the conversion logic also convert Enum to repr(Enum), which is a string and undesirable", "\n", "# If we convert object to dict in advance, DataLoader will do nothing", "\n", "batch_info", "[", "\"task_def\"", "]", "=", "task_def", ".", "__dict__", "\n", "batch_info", "[", "\"pairwise_size\"", "]", "=", "self", ".", "pairwise_size", "# need for ranking task", "\n", "# add label", "\n", "labels", "=", "[", "sample", "[", "\"label\"", "]", "if", "\"label\"", "in", "sample", "else", "None", "for", "sample", "in", "batch", "]", "\n", "task_obj", "=", "tasks", ".", "get_task_obj", "(", "task_def", ")", "\n", "if", "self", ".", "is_train", ":", "\n", "# in training model, label is used by Pytorch, so would be tensor", "\n", "            ", "if", "task_obj", "is", "not", "None", ":", "\n", "                ", "batch_data", ".", "append", "(", "task_obj", ".", "train_prepare_label", "(", "labels", ")", ")", "\n", "batch_info", "[", "\"label\"", "]", "=", "len", "(", "batch_data", ")", "-", "1", "\n", "", "elif", "task_type", "==", "TaskType", ".", "Ranking", "or", "task_type", "==", "TaskType", ".", "ClozeChoice", ":", "\n", "                ", "batch_data", ".", "append", "(", "torch", ".", "LongTensor", "(", "labels", ")", ")", "\n", "batch_info", "[", "\"label\"", "]", "=", "len", "(", "batch_data", ")", "-", "1", "\n", "", "elif", "task_type", "==", "TaskType", ".", "Span", ":", "\n", "# support multi positions", "\n", "                ", "start", ",", "end", "=", "[", "]", ",", "[", "]", "\n", "for", "sample", "in", "batch", ":", "\n", "                    ", "if", "type", "(", "sample", "[", "\"start_position\"", "]", ")", "is", "list", "and", "type", "(", "\n", "sample", "[", "\"end_position\"", "]", "\n", ")", ":", "\n", "                        ", "idx", "=", "random", ".", "choice", "(", "range", "(", "0", ",", "len", "(", "sample", "[", "\"start_position\"", "]", ")", ")", ")", "\n", "start", ".", "append", "(", "sample", "[", "\"start_position\"", "]", "[", "idx", "]", ")", "\n", "end", ".", "append", "(", "sample", "[", "\"end_position\"", "]", "[", "idx", "]", ")", "\n", "", "else", ":", "\n", "                        ", "start", ".", "append", "(", "sample", "[", "\"start_position\"", "]", ")", "\n", "end", ".", "append", "(", "sample", "[", "\"end_position\"", "]", ")", "\n", "", "", "batch_data", ".", "append", "(", "(", "torch", ".", "LongTensor", "(", "start", ")", ",", "torch", ".", "LongTensor", "(", "end", ")", ")", ")", "\n", "# unify to one type of label", "\n", "batch_info", "[", "\"label\"", "]", "=", "len", "(", "batch_data", ")", "-", "1", "\n", "", "elif", "task_type", "==", "TaskType", ".", "SpanYN", ":", "\n", "# start = [sample['start_position'] for sample in batch]", "\n", "# end = [sample['end_position'] for sample in batch]", "\n", "                ", "start", ",", "end", "=", "[", "]", ",", "[", "]", "\n", "for", "sample", "in", "batch", ":", "\n", "                    ", "if", "type", "(", "sample", "[", "\"start_position\"", "]", ")", "is", "list", "and", "type", "(", "\n", "sample", "[", "\"end_position\"", "]", "\n", ")", ":", "\n", "                        ", "idx", "=", "random", ".", "choice", "(", "range", "(", "0", ",", "len", "(", "sample", "[", "\"start_position\"", "]", ")", ")", ")", "\n", "start", ".", "append", "(", "sample", "[", "\"start_position\"", "]", "[", "idx", "]", ")", "\n", "end", ".", "append", "(", "sample", "[", "\"end_position\"", "]", "[", "idx", "]", ")", "\n", "", "else", ":", "\n", "                        ", "start", ".", "append", "(", "sample", "[", "\"start_position\"", "]", ")", "\n", "end", ".", "append", "(", "sample", "[", "\"end_position\"", "]", ")", "\n", "# start, end, yes/no", "\n", "", "", "batch_data", ".", "append", "(", "\n", "(", "\n", "torch", ".", "LongTensor", "(", "start", ")", ",", "\n", "torch", ".", "LongTensor", "(", "end", ")", ",", "\n", "torch", ".", "LongTensor", "(", "labels", ")", ",", "\n", ")", "\n", ")", "\n", "# unify to one type of label", "\n", "batch_info", "[", "\"label\"", "]", "=", "len", "(", "batch_data", ")", "-", "1", "\n", "", "elif", "task_type", "==", "TaskType", ".", "SeqenceLabeling", ":", "\n", "                ", "batch_size", "=", "self", ".", "_get_batch_size", "(", "batch", ")", "\n", "tok_len", "=", "self", ".", "_get_max_len", "(", "batch", ",", "key", "=", "\"token_id\"", ")", "\n", "tlab", "=", "torch", ".", "LongTensor", "(", "batch_size", ",", "tok_len", ")", ".", "fill_", "(", "-", "1", ")", "\n", "for", "i", ",", "label", "in", "enumerate", "(", "labels", ")", ":", "\n", "                    ", "ll", "=", "len", "(", "label", ")", "\n", "tlab", "[", "i", ",", ":", "ll", "]", "=", "torch", ".", "LongTensor", "(", "label", ")", "\n", "", "batch_data", ".", "append", "(", "tlab", ")", "\n", "batch_info", "[", "\"label\"", "]", "=", "len", "(", "batch_data", ")", "-", "1", "\n", "", "elif", "task_type", "==", "TaskType", ".", "MaskLM", ":", "\n", "                ", "batch_size", "=", "self", ".", "_get_batch_size", "(", "batch", ")", "\n", "tok_len", "=", "self", ".", "_get_max_len", "(", "batch", ",", "key", "=", "\"token_id\"", ")", "\n", "tlab", "=", "torch", ".", "LongTensor", "(", "batch_size", ",", "tok_len", ")", ".", "fill_", "(", "-", "1", ")", "\n", "for", "i", ",", "label", "in", "enumerate", "(", "labels", ")", ":", "\n", "                    ", "ll", "=", "len", "(", "label", ")", "\n", "tlab", "[", "i", ",", ":", "ll", "]", "=", "torch", ".", "LongTensor", "(", "label", ")", "\n", "", "labels", "=", "torch", ".", "LongTensor", "(", "[", "sample", "[", "\"nsp_lab\"", "]", "for", "sample", "in", "batch", "]", ")", "\n", "batch_data", ".", "append", "(", "(", "tlab", ",", "labels", ")", ")", "\n", "batch_info", "[", "\"label\"", "]", "=", "len", "(", "batch_data", ")", "-", "1", "\n", "", "elif", "task_type", "==", "TaskType", ".", "SeqenceGeneration", ":", "\n", "                ", "batch_size", "=", "self", ".", "_get_batch_size", "(", "batch", ")", "\n", "y_idxs", "=", "torch", ".", "LongTensor", "(", "[", "sample", "[", "\"label\"", "]", "[", ":", "-", "1", "]", "for", "sample", "in", "batch", "]", ")", "\n", "label", "=", "torch", ".", "LongTensor", "(", "[", "sample", "[", "\"label\"", "]", "[", "1", ":", "]", "for", "sample", "in", "batch", "]", ")", "\n", "label", ".", "masked_fill_", "(", "label", "==", "0", ",", "-", "1", ")", "\n", "batch_data", ".", "append", "(", "y_idxs", ")", "\n", "batch_info", "[", "\"y_token_id\"", "]", "=", "len", "(", "batch_data", ")", "-", "1", "\n", "batch_data", ".", "append", "(", "label", ")", "\n", "batch_info", "[", "\"label\"", "]", "=", "len", "(", "batch_data", ")", "-", "1", "\n", "\n", "# soft label generated by ensemble models for knowledge distillation", "\n", "", "if", "self", ".", "soft_label_on", "and", "\"softlabel\"", "in", "batch", "[", "0", "]", ":", "\n", "                ", "sortlabels", "=", "[", "sample", "[", "\"softlabel\"", "]", "for", "sample", "in", "batch", "]", "\n", "sortlabels", "=", "task_obj", ".", "train_prepare_soft_labels", "(", "sortlabels", ")", "\n", "batch_info", "[", "\"soft_label\"", "]", "=", "sortlabels", "\n", "", "", "else", ":", "\n", "# in test model, label would be used for evaluation", "\n", "            ", "if", "task_obj", "is", "not", "None", ":", "\n", "                ", "task_obj", ".", "test_prepare_label", "(", "batch_info", ",", "labels", ")", "\n", "", "else", ":", "\n", "                ", "batch_info", "[", "\"label\"", "]", "=", "labels", "\n", "if", "task_type", "==", "TaskType", ".", "Ranking", ":", "\n", "                    ", "batch_info", "[", "\"true_label\"", "]", "=", "[", "\n", "sample", "[", "\"true_label\"", "]", "for", "sample", "in", "batch", "\n", "]", "\n", "", "if", "task_type", "==", "TaskType", ".", "ClozeChoice", ":", "\n", "                    ", "batch_info", "[", "\"answer\"", "]", "=", "[", "\n", "sample", "[", "\"answer\"", "]", "for", "sample", "in", "batch", "\n", "]", "\n", "batch_info", "[", "\"choice\"", "]", "=", "[", "\n", "sample", "[", "\"choice\"", "]", "for", "sample", "in", "batch", "\n", "]", "\n", "batch_info", "[", "\"pairwise_size\"", "]", "=", "chunk_sizes", "\n", "", "if", "task_type", "==", "TaskType", ".", "Span", "or", "task_type", "==", "TaskType", ".", "SpanYN", ":", "\n", "                    ", "batch_info", "[", "\"offset_mapping\"", "]", "=", "[", "\n", "sample", "[", "\"offset_mapping\"", "]", "for", "sample", "in", "batch", "\n", "]", "\n", "batch_info", "[", "\"token_is_max_context\"", "]", "=", "[", "\n", "sample", ".", "get", "(", "\"token_is_max_context\"", ",", "None", ")", "for", "sample", "in", "batch", "\n", "]", "\n", "batch_info", "[", "\"context\"", "]", "=", "[", "sample", "[", "\"context\"", "]", "for", "sample", "in", "batch", "]", "\n", "batch_info", "[", "\"answer\"", "]", "=", "[", "sample", "[", "\"answer\"", "]", "for", "sample", "in", "batch", "]", "\n", "batch_info", "[", "\"label\"", "]", "=", "[", "\n", "sample", "[", "\"label\"", "]", "if", "\"label\"", "in", "sample", "else", "None", "\n", "for", "sample", "in", "batch", "\n", "]", "\n", "", "if", "task_type", "==", "TaskType", ".", "SeqenceGeneration", ":", "\n", "                    ", "batch_info", "[", "\"answer\"", "]", "=", "[", "sample", "[", "\"answer\"", "]", "for", "sample", "in", "batch", "]", "\n", "\n", "", "", "", "batch_info", "[", "\"uids\"", "]", "=", "[", "sample", "[", "\"uid\"", "]", "for", "sample", "in", "batch", "]", "# used in scoring", "\n", "return", "batch_info", ",", "batch_data", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater._get_max_len": [[677, 681], ["max", "len"], "methods", ["None"], ["", "def", "_get_max_len", "(", "self", ",", "batch", ",", "key", "=", "\"token_id\"", ")", ":", "\n", "        ", "tok_len", "=", "max", "(", "len", "(", "x", "[", "key", "]", ")", "for", "x", "in", "batch", ")", "\n", "tok_len", "=", "self", ".", "max_seq_len", "if", "self", ".", "do_padding", "else", "tok_len", "\n", "return", "tok_len", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater._get_batch_size": [[682, 684], ["len"], "methods", ["None"], ["", "def", "_get_batch_size", "(", "self", ",", "batch", ")", ":", "\n", "        ", "return", "len", "(", "batch", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater._prepare_model_input": [[685, 725], ["batcher.Collater._get_batch_size", "batcher.Collater._get_max_len", "batcher.Collater.__if_pair__", "enumerate", "batcher.Collater.__if_pair__", "torch.LongTensor().fill_", "torch.LongTensor().fill_", "torch.LongTensor().fill_", "torch.LongTensor().fill_", "torch.LongTensor().fill_", "torch.LongTensor().fill_", "torch.BoolTensor().fill_", "torch.BoolTensor().fill_", "min", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "batcher.Collater.__if_pair__", "len", "batcher.Collater.__random_select__", "torch.LongTensor", "range", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "torch.LongTensor", "torch.BoolTensor", "torch.BoolTensor", "len", "sum"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater._get_batch_size", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater._get_max_len", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater.__if_pair__", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater.__if_pair__", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater.__if_pair__", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.Collater.__random_select__"], ["", "def", "_prepare_model_input", "(", "self", ",", "batch", ",", "data_type", ")", ":", "\n", "        ", "batch_size", "=", "self", ".", "_get_batch_size", "(", "batch", ")", "\n", "tok_len", "=", "self", ".", "_get_max_len", "(", "batch", ",", "key", "=", "\"token_id\"", ")", "\n", "if", "self", ".", "encoder_type", "==", "EncoderModelType", ".", "ROBERTA", ":", "\n", "            ", "token_ids", "=", "torch", ".", "LongTensor", "(", "batch_size", ",", "tok_len", ")", ".", "fill_", "(", "1", ")", "\n", "type_ids", "=", "torch", ".", "LongTensor", "(", "batch_size", ",", "tok_len", ")", ".", "fill_", "(", "0", ")", "\n", "masks", "=", "torch", ".", "LongTensor", "(", "batch_size", ",", "tok_len", ")", ".", "fill_", "(", "0", ")", "\n", "", "else", ":", "\n", "            ", "token_ids", "=", "torch", ".", "LongTensor", "(", "batch_size", ",", "tok_len", ")", ".", "fill_", "(", "0", ")", "\n", "type_ids", "=", "torch", ".", "LongTensor", "(", "batch_size", ",", "tok_len", ")", ".", "fill_", "(", "0", ")", "\n", "masks", "=", "torch", ".", "LongTensor", "(", "batch_size", ",", "tok_len", ")", ".", "fill_", "(", "0", ")", "\n", "", "if", "self", ".", "__if_pair__", "(", "data_type", ")", ":", "\n", "            ", "hypothesis_masks", "=", "torch", ".", "BoolTensor", "(", "batch_size", ",", "tok_len", ")", ".", "fill_", "(", "1", ")", "\n", "premise_masks", "=", "torch", ".", "BoolTensor", "(", "batch_size", ",", "tok_len", ")", ".", "fill_", "(", "1", ")", "\n", "", "for", "i", ",", "sample", "in", "enumerate", "(", "batch", ")", ":", "\n", "            ", "select_len", "=", "min", "(", "len", "(", "sample", "[", "\"token_id\"", "]", ")", ",", "tok_len", ")", "\n", "tok", "=", "sample", "[", "\"token_id\"", "]", "\n", "if", "self", ".", "is_train", ":", "\n", "                ", "tok", "=", "self", ".", "__random_select__", "(", "tok", ")", "\n", "", "token_ids", "[", "i", ",", ":", "select_len", "]", "=", "torch", ".", "LongTensor", "(", "tok", "[", ":", "select_len", "]", ")", "\n", "type_ids", "[", "i", ",", ":", "select_len", "]", "=", "torch", ".", "LongTensor", "(", "sample", "[", "\"type_id\"", "]", "[", ":", "select_len", "]", ")", "\n", "masks", "[", "i", ",", ":", "select_len", "]", "=", "torch", ".", "LongTensor", "(", "[", "1", "]", "*", "select_len", ")", "\n", "if", "self", ".", "__if_pair__", "(", "data_type", ")", ":", "\n", "                ", "plen", "=", "len", "(", "sample", "[", "\"type_id\"", "]", ")", "-", "sum", "(", "sample", "[", "\"type_id\"", "]", ")", "\n", "premise_masks", "[", "i", ",", ":", "plen", "]", "=", "torch", ".", "LongTensor", "(", "[", "0", "]", "*", "plen", ")", "\n", "for", "j", "in", "range", "(", "plen", ",", "select_len", ")", ":", "\n", "                    ", "hypothesis_masks", "[", "i", ",", "j", "]", "=", "0", "\n", "", "", "", "if", "self", ".", "__if_pair__", "(", "data_type", ")", ":", "\n", "            ", "batch_info", "=", "{", "\n", "\"token_id\"", ":", "0", ",", "\n", "\"segment_id\"", ":", "1", ",", "\n", "\"mask\"", ":", "2", ",", "\n", "\"premise_mask\"", ":", "3", ",", "\n", "\"hypothesis_mask\"", ":", "4", ",", "\n", "}", "\n", "batch_data", "=", "[", "token_ids", ",", "type_ids", ",", "masks", ",", "premise_masks", ",", "hypothesis_masks", "]", "\n", "", "else", ":", "\n", "            ", "batch_info", "=", "{", "\"token_id\"", ":", "0", ",", "\"segment_id\"", ":", "1", ",", "\"mask\"", ":", "2", "}", "\n", "batch_data", "=", "[", "token_ids", ",", "type_ids", ",", "masks", "]", "\n", "", "return", "batch_info", ",", "batch_data", "\n", "", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.search_bin": [[25, 32], ["enumerate", "len"], "function", ["None"], ["def", "search_bin", "(", "bins", ",", "size", ")", ":", "\n", "    ", "idx", "=", "len", "(", "bins", ")", "-", "1", "\n", "for", "i", ",", "bin", "in", "enumerate", "(", "bins", ")", ":", "\n", "        ", "if", "size", "<=", "bin", ":", "\n", "            ", "idx", "=", "i", "\n", "break", "\n", "", "", "return", "idx", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.batcher.create_bins": [[34, 36], ["min", "range"], "function", ["None"], ["", "def", "create_bins", "(", "bin_size", ",", "maxlen", ")", ":", "\n", "    ", "return", "[", "min", "(", "i", "+", "bin_size", ",", "maxlen", ")", "for", "i", "in", "range", "(", "0", ",", "maxlen", ",", "bin_size", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.Criterion.__init__": [[26, 32], ["torch.nn.modules.loss._Loss.__init__"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "alpha", "=", "1.0", ",", "name", "=", "\"criterion\"", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\"\"\"Alpha is used to weight each loss term\n        \"\"\"", "\n", "self", ".", "alpha", "=", "alpha", "\n", "self", ".", "name", "=", "name", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.Criterion.forward": [[33, 36], ["None"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "input", ",", "target", ",", "weight", "=", "None", ",", "ignore_index", "=", "-", "1", ")", ":", "\n", "        ", "\"\"\"weight: sample weight\"\"\"", "\n", "return", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.CeCriterion.__init__": [[39, 43], ["loss.Criterion.__init__"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "alpha", "=", "1.0", ",", "name", "=", "\"Cross Entropy Criterion\"", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "alpha", "=", "alpha", "\n", "self", ".", "name", "=", "name", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.CeCriterion.forward": [[44, 61], ["torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "input", ",", "target", ",", "weight", "=", "None", ",", "ignore_index", "=", "-", "1", ")", ":", "\n", "        ", "\"\"\"weight: sample weight\"\"\"", "\n", "if", "weight", "is", "not", "None", ":", "\n", "            ", "loss", "=", "torch", ".", "sum", "(", "\n", "F", ".", "cross_entropy", "(", "\n", "input", ",", "\n", "target", ",", "\n", "reduce", "=", "False", ",", "\n", "reduction", "=", "\"none\"", ",", "\n", "ignore_index", "=", "ignore_index", ",", "\n", ")", "\n", "*", "weight", "\n", ")", "\n", "", "else", ":", "\n", "            ", "loss", "=", "F", ".", "cross_entropy", "(", "input", ",", "target", ",", "ignore_index", "=", "ignore_index", ")", "\n", "", "loss", "=", "loss", "*", "self", ".", "alpha", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.SeqCeCriterion.__init__": [[64, 66], ["loss.CeCriterion.__init__"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "alpha", "=", "1.0", ",", "name", "=", "\"Seq Cross Entropy Criterion\"", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "alpha", ",", "name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.SeqCeCriterion.forward": [[67, 78], ["target.view.view.view", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "input", ",", "target", ",", "weight", "=", "None", ",", "ignore_index", "=", "-", "1", ")", ":", "\n", "        ", "target", "=", "target", ".", "view", "(", "-", "1", ")", "\n", "if", "weight", ":", "\n", "            ", "loss", "=", "torch", ".", "mean", "(", "\n", "F", ".", "cross_entropy", "(", "input", ",", "target", ",", "reduce", "=", "False", ",", "ignore_index", "=", "ignore_index", ")", "\n", "*", "weight", "\n", ")", "\n", "", "else", ":", "\n", "            ", "loss", "=", "F", ".", "cross_entropy", "(", "input", ",", "target", ",", "ignore_index", "=", "ignore_index", ")", "\n", "", "loss", "=", "loss", "*", "self", ".", "alpha", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.MseCriterion.__init__": [[81, 85], ["loss.Criterion.__init__"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "alpha", "=", "1.0", ",", "name", "=", "\"MSE Regression Criterion\"", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "alpha", "=", "alpha", "\n", "self", ".", "name", "=", "name", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.MseCriterion.forward": [[86, 97], ["torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mse_loss", "torch.mse_loss", "torch.mse_loss", "input.squeeze", "torch.mse_loss", "torch.mse_loss", "torch.mse_loss", "weight.reshape", "input.squeeze"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "input", ",", "target", ",", "weight", "=", "None", ",", "ignore_index", "=", "-", "1", ")", ":", "\n", "        ", "\"\"\"weight: sample weight\"\"\"", "\n", "if", "weight", ":", "\n", "            ", "loss", "=", "torch", ".", "mean", "(", "\n", "F", ".", "mse_loss", "(", "input", ".", "squeeze", "(", ")", ",", "target", ",", "reduce", "=", "False", ")", "\n", "*", "weight", ".", "reshape", "(", "(", "target", ".", "shape", "[", "0", "]", ",", "1", ")", ")", "\n", ")", "\n", "", "else", ":", "\n", "            ", "loss", "=", "F", ".", "mse_loss", "(", "input", ".", "squeeze", "(", ")", ",", "target", ")", "\n", "", "loss", "=", "loss", "*", "self", ".", "alpha", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.KlCriterion.__init__": [[100, 104], ["loss.Criterion.__init__"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "alpha", "=", "1.0", ",", "name", "=", "\"KL Div Criterion\"", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "alpha", "=", "alpha", "\n", "self", ".", "name", "=", "name", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.KlCriterion.forward": [[105, 116], ["input.float.float.float", "target.float.float.float", "torch.kl_div", "torch.kl_div", "torch.kl_div", "torch.log_softmax", "torch.log_softmax", "torch.log_softmax", "torch.softmax", "torch.softmax", "torch.softmax"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "input", ",", "target", ",", "weight", "=", "None", ",", "ignore_index", "=", "-", "1", ")", ":", "\n", "        ", "\"\"\"input/target: logits\"\"\"", "\n", "input", "=", "input", ".", "float", "(", ")", "\n", "target", "=", "target", ".", "float", "(", ")", "\n", "loss", "=", "F", ".", "kl_div", "(", "\n", "F", ".", "log_softmax", "(", "input", ",", "dim", "=", "-", "1", ",", "dtype", "=", "torch", ".", "float32", ")", ",", "\n", "F", ".", "softmax", "(", "target", ",", "dim", "=", "-", "1", ",", "dtype", "=", "torch", ".", "float32", ")", ",", "\n", "reduction", "=", "\"batchmean\"", ",", "\n", ")", "\n", "loss", "=", "loss", "*", "self", ".", "alpha", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.NsKlCriterion.__init__": [[119, 123], ["loss.Criterion.__init__"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "alpha", "=", "1.0", ",", "name", "=", "\"KL Div Criterion\"", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "alpha", "=", "alpha", "\n", "self", ".", "name", "=", "name", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.NsKlCriterion.forward": [[124, 131], ["input.float.float.float", "target.float.float.float", "loss.stable_kl", "target.float.float.detach"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.stable_kl"], ["", "def", "forward", "(", "self", ",", "input", ",", "target", ",", "weight", "=", "None", ",", "ignore_index", "=", "-", "1", ")", ":", "\n", "        ", "\"\"\"input/target: logits\"\"\"", "\n", "input", "=", "input", ".", "float", "(", ")", "\n", "target", "=", "target", ".", "float", "(", ")", "\n", "loss", "=", "stable_kl", "(", "input", ",", "target", ".", "detach", "(", ")", ")", "\n", "loss", "=", "loss", "*", "self", ".", "alpha", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.SymKlCriterion.__init__": [[134, 138], ["loss.Criterion.__init__"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "alpha", "=", "1.0", ",", "name", "=", "\"KL Div Criterion\"", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "alpha", "=", "alpha", "\n", "self", ".", "name", "=", "name", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.SymKlCriterion.forward": [[139, 156], ["input.float.float.float", "target.float.float.float", "torch.kl_div", "torch.kl_div", "torch.kl_div", "torch.kl_div", "torch.kl_div", "torch.kl_div", "torch.log_softmax", "torch.log_softmax", "torch.log_softmax", "torch.softmax", "torch.softmax", "torch.softmax", "torch.log_softmax", "torch.log_softmax", "torch.log_softmax", "torch.softmax", "torch.softmax", "torch.softmax", "target.float.float.detach", "input.float.float.detach"], "methods", ["None"], ["", "def", "forward", "(", "\n", "self", ",", "input", ",", "target", ",", "weight", "=", "None", ",", "ignore_index", "=", "-", "1", ",", "reduction", "=", "\"batchmean\"", "\n", ")", ":", "\n", "        ", "\"\"\"input/target: logits\"\"\"", "\n", "input", "=", "input", ".", "float", "(", ")", "\n", "target", "=", "target", ".", "float", "(", ")", "\n", "loss", "=", "F", ".", "kl_div", "(", "\n", "F", ".", "log_softmax", "(", "input", ",", "dim", "=", "-", "1", ",", "dtype", "=", "torch", ".", "float32", ")", ",", "\n", "F", ".", "softmax", "(", "target", ".", "detach", "(", ")", ",", "dim", "=", "-", "1", ",", "dtype", "=", "torch", ".", "float32", ")", ",", "\n", "reduction", "=", "reduction", ",", "\n", ")", "+", "F", ".", "kl_div", "(", "\n", "F", ".", "log_softmax", "(", "target", ",", "dim", "=", "-", "1", ",", "dtype", "=", "torch", ".", "float32", ")", ",", "\n", "F", ".", "softmax", "(", "input", ".", "detach", "(", ")", ",", "dim", "=", "-", "1", ",", "dtype", "=", "torch", ".", "float32", ")", ",", "\n", "reduction", "=", "reduction", ",", "\n", ")", "\n", "loss", "=", "loss", "*", "self", ".", "alpha", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.NsSymKlCriterion.__init__": [[159, 163], ["loss.Criterion.__init__"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "alpha", "=", "1.0", ",", "name", "=", "\"KL Div Criterion\"", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "alpha", "=", "alpha", "\n", "self", ".", "name", "=", "name", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.NsSymKlCriterion.forward": [[164, 171], ["input.float.float.float", "target.float.float.float", "loss.stable_kl", "loss.stable_kl", "target.float.float.detach", "input.float.float.detach"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.stable_kl", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.stable_kl"], ["", "def", "forward", "(", "self", ",", "input", ",", "target", ",", "weight", "=", "None", ",", "ignore_index", "=", "-", "1", ")", ":", "\n", "        ", "\"\"\"input/target: logits\"\"\"", "\n", "input", "=", "input", ".", "float", "(", ")", "\n", "target", "=", "target", ".", "float", "(", ")", "\n", "loss", "=", "stable_kl", "(", "input", ",", "target", ".", "detach", "(", ")", ")", "+", "stable_kl", "(", "target", ",", "input", ".", "detach", "(", ")", ")", "\n", "loss", "=", "loss", "*", "self", ".", "alpha", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.JSCriterion.__init__": [[174, 178], ["loss.Criterion.__init__"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "alpha", "=", "1.0", ",", "name", "=", "\"JS Div Criterion\"", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "alpha", "=", "alpha", "\n", "self", ".", "name", "=", "name", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.JSCriterion.forward": [[179, 196], ["input.float.float.float", "target.float.float.float", "torch.softmax", "torch.softmax", "torch.softmax", "torch.softmax", "torch.softmax", "torch.softmax", "torch.kl_div", "torch.kl_div", "torch.kl_div", "torch.kl_div", "torch.kl_div", "torch.kl_div", "target.float.float.detach", "input.float.float.detach", "torch.log_softmax", "torch.log_softmax", "torch.log_softmax", "torch.log_softmax", "torch.log_softmax", "torch.log_softmax"], "methods", ["None"], ["", "def", "forward", "(", "\n", "self", ",", "input", ",", "target", ",", "weight", "=", "None", ",", "ignore_index", "=", "-", "1", ",", "reduction", "=", "\"batchmean\"", "\n", ")", ":", "\n", "        ", "\"\"\"input/target: logits\"\"\"", "\n", "input", "=", "input", ".", "float", "(", ")", "\n", "target", "=", "target", ".", "float", "(", ")", "\n", "m", "=", "F", ".", "softmax", "(", "target", ".", "detach", "(", ")", ",", "dim", "=", "-", "1", ",", "dtype", "=", "torch", ".", "float32", ")", "+", "F", ".", "softmax", "(", "\n", "input", ".", "detach", "(", ")", ",", "dim", "=", "-", "1", ",", "dtype", "=", "torch", ".", "float32", "\n", ")", "\n", "m", "=", "0.5", "*", "m", "\n", "loss", "=", "F", ".", "kl_div", "(", "\n", "F", ".", "log_softmax", "(", "input", ",", "dim", "=", "-", "1", ",", "dtype", "=", "torch", ".", "float32", ")", ",", "m", ",", "reduction", "=", "reduction", "\n", ")", "+", "F", ".", "kl_div", "(", "\n", "F", ".", "log_softmax", "(", "target", ",", "dim", "=", "-", "1", ",", "dtype", "=", "torch", ".", "float32", ")", ",", "m", ",", "reduction", "=", "reduction", "\n", ")", "\n", "loss", "=", "loss", "*", "self", ".", "alpha", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.HLCriterion.__init__": [[199, 203], ["loss.Criterion.__init__"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "alpha", "=", "1.0", ",", "name", "=", "\"Hellinger Criterion\"", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "alpha", "=", "alpha", "\n", "self", ".", "name", "=", "name", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.HLCriterion.forward": [[204, 215], ["input.float.float.float", "target.float.float.float", "torch.softmax().sqrt_", "torch.softmax().sqrt_", "torch.softmax().sqrt_", "torch.softmax().sqrt_", "torch.softmax().sqrt_", "torch.softmax().sqrt_", "torch.mse_loss", "torch.mse_loss", "torch.mse_loss", "torch.softmax", "torch.softmax", "torch.softmax", "torch.softmax", "torch.softmax", "torch.softmax", "target.float.float.detach", "input.float.float.detach"], "methods", ["None"], ["", "def", "forward", "(", "\n", "self", ",", "input", ",", "target", ",", "weight", "=", "None", ",", "ignore_index", "=", "-", "1", ",", "reduction", "=", "\"batchmean\"", "\n", ")", ":", "\n", "        ", "\"\"\"input/target: logits\"\"\"", "\n", "input", "=", "input", ".", "float", "(", ")", "\n", "target", "=", "target", ".", "float", "(", ")", "\n", "si", "=", "F", ".", "softmax", "(", "target", ".", "detach", "(", ")", ",", "dim", "=", "-", "1", ",", "dtype", "=", "torch", ".", "float32", ")", ".", "sqrt_", "(", ")", "\n", "st", "=", "F", ".", "softmax", "(", "input", ".", "detach", "(", ")", ",", "dim", "=", "-", "1", ",", "dtype", "=", "torch", ".", "float32", ")", ".", "sqrt_", "(", ")", "\n", "loss", "=", "F", ".", "mse_loss", "(", "si", ",", "st", ")", "\n", "loss", "=", "loss", "*", "self", ".", "alpha", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.RankCeCriterion.__init__": [[218, 222], ["loss.Criterion.__init__"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "alpha", "=", "1.0", ",", "name", "=", "\"Cross Entropy Criterion\"", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "alpha", "=", "alpha", "\n", "self", ".", "name", "=", "name", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.RankCeCriterion.forward": [[223, 235], ["input.view.view.view", "target.contiguous().view", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "target.contiguous", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "input", ",", "target", ",", "weight", "=", "None", ",", "ignore_index", "=", "-", "1", ",", "pairwise_size", "=", "1", ")", ":", "\n", "        ", "input", "=", "input", ".", "view", "(", "-", "1", ",", "pairwise_size", ")", "\n", "target", "=", "target", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ",", "pairwise_size", ")", "[", ":", ",", "0", "]", "\n", "if", "weight", ":", "\n", "            ", "loss", "=", "torch", ".", "mean", "(", "\n", "F", ".", "cross_entropy", "(", "input", ",", "target", ",", "reduce", "=", "False", ",", "ignore_index", "=", "ignore_index", ")", "\n", "*", "weight", "\n", ")", "\n", "", "else", ":", "\n", "            ", "loss", "=", "F", ".", "cross_entropy", "(", "input", ",", "target", ",", "ignore_index", "=", "ignore_index", ")", "\n", "", "loss", "=", "loss", "*", "self", ".", "alpha", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.SpanCeCriterion.__init__": [[238, 244], ["loss.Criterion.__init__"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "alpha", "=", "1.0", ",", "name", "=", "\"Span Cross Entropy Criterion\"", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\"\"\"This is for extractive MRC, e.g., SQuAD, ReCoRD ... etc\n        \"\"\"", "\n", "self", ".", "alpha", "=", "alpha", "\n", "self", ".", "name", "=", "name", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.SpanCeCriterion.forward": [[245, 272], ["len", "len", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "len", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "input", ",", "target", ",", "weight", "=", "None", ",", "ignore_index", "=", "-", "1", ")", ":", "\n", "        ", "\"\"\"weight: sample weight\"\"\"", "\n", "assert", "len", "(", "input", ")", "==", "2", "\n", "start_input", ",", "end_input", "=", "input", "\n", "if", "len", "(", "target", ")", "==", "3", ":", "\n", "            ", "start_target", ",", "end_target", ",", "_", "=", "target", "\n", "", "else", ":", "\n", "            ", "assert", "len", "(", "target", ")", "==", "2", "\n", "start_target", ",", "end_target", "=", "target", "\n", "", "if", "weight", ":", "\n", "            ", "b", "=", "torch", ".", "mean", "(", "\n", "F", ".", "cross_entropy", "(", "\n", "start_input", ",", "start_target", ",", "reduce", "=", "False", ",", "ignore_index", "=", "ignore_index", "\n", ")", "\n", "*", "weight", "\n", ")", "\n", "e", "=", "torch", ".", "mean", "(", "\n", "F", ".", "cross_entropy", "(", "\n", "end_input", ",", "end_target", ",", "reduce", "=", "False", ",", "ignore_index", "=", "ignore_index", "\n", ")", "\n", "*", "weight", "\n", ")", "\n", "", "else", ":", "\n", "            ", "b", "=", "F", ".", "cross_entropy", "(", "start_input", ",", "start_target", ",", "ignore_index", "=", "ignore_index", ")", "\n", "e", "=", "F", ".", "cross_entropy", "(", "end_input", ",", "end_target", ",", "ignore_index", "=", "ignore_index", ")", "\n", "", "loss", "=", "0.5", "*", "(", "b", "+", "e", ")", "*", "self", ".", "alpha", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.SpanYNCeCriterion.__init__": [[275, 281], ["loss.Criterion.__init__"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "alpha", "=", "1.0", ",", "name", "=", "\"Span Cross Entropy Criterion\"", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\"\"\"This is for extractive MRC, e.g., SQuAD, ReCoRD ... etc\n        \"\"\"", "\n", "self", ".", "alpha", "=", "alpha", "\n", "self", ".", "name", "=", "name", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.SpanYNCeCriterion.forward": [[282, 314], ["len", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "input", ",", "target", ",", "weight", "=", "None", ",", "ignore_index", "=", "-", "1", ")", ":", "\n", "        ", "\"\"\"weight: sample weight\"\"\"", "\n", "assert", "len", "(", "input", ")", "==", "3", "\n", "start_input", ",", "end_input", ",", "labels_input", "=", "input", "\n", "# start/end/yesno", "\n", "start_target", ",", "end_target", ",", "labels_target", "=", "target", "\n", "if", "weight", ":", "\n", "            ", "b", "=", "torch", ".", "mean", "(", "\n", "F", ".", "cross_entropy", "(", "\n", "start_input", ",", "start_target", ",", "reduce", "=", "False", ",", "ignore_index", "=", "ignore_index", "\n", ")", "\n", "*", "weight", "\n", ")", "\n", "e", "=", "torch", ".", "mean", "(", "\n", "F", ".", "cross_entropy", "(", "\n", "end_input", ",", "end_target", ",", "reduce", "=", "False", ",", "ignore_index", "=", "ignore_index", "\n", ")", "\n", "*", "weight", "\n", ")", "\n", "# yes/no", "\n", "e", "=", "torch", ".", "mean", "(", "\n", "F", ".", "cross_entropy", "(", "\n", "labels_input", ",", "labels_target", ",", "reduce", "=", "False", ",", "ignore_index", "=", "ignore_index", "\n", ")", "\n", "*", "weight", "\n", ")", "\n", "", "else", ":", "\n", "            ", "b", "=", "F", ".", "cross_entropy", "(", "start_input", ",", "start_target", ",", "ignore_index", "=", "ignore_index", ")", "\n", "e", "=", "F", ".", "cross_entropy", "(", "end_input", ",", "end_target", ",", "ignore_index", "=", "ignore_index", ")", "\n", "c", "=", "F", ".", "cross_entropy", "(", "labels_input", ",", "labels_target", ",", "ignore_index", "=", "ignore_index", ")", "\n", "", "loss", "=", "0.5", "*", "(", "b", "+", "e", ")", "*", "self", ".", "alpha", "+", "c", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.MlmCriterion.__init__": [[317, 321], ["loss.Criterion.__init__"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "self", ",", "alpha", "=", "1.0", ",", "name", "=", "\"BERT pre-train Criterion\"", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "alpha", "=", "alpha", "\n", "self", ".", "name", "=", "name", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.MlmCriterion.forward": [[322, 333], ["mlm_p.view.view.view", "mlm_y.view.view.view", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "mlm_p.view.view.size"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "input", ",", "target", ",", "weight", "=", "None", ",", "ignore_index", "=", "-", "1", ")", ":", "\n", "        ", "\"\"\"TODO: support sample weight, xiaodl\"\"\"", "\n", "mlm_y", ",", "y", "=", "target", "\n", "mlm_p", ",", "nsp_p", "=", "input", "\n", "mlm_p", "=", "mlm_p", ".", "view", "(", "-", "1", ",", "mlm_p", ".", "size", "(", "-", "1", ")", ")", "\n", "mlm_y", "=", "mlm_y", ".", "view", "(", "-", "1", ")", "\n", "mlm_loss", "=", "F", ".", "cross_entropy", "(", "mlm_p", ",", "mlm_y", ",", "ignore_index", "=", "ignore_index", ")", "\n", "nsp_loss", "=", "F", ".", "cross_entropy", "(", "nsp_p", ",", "y", ")", "\n", "loss", "=", "mlm_loss", "+", "nsp_loss", "\n", "loss", "=", "loss", "*", "self", ".", "alpha", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.stable_kl": [[11, 23], ["logit.view().float.view().float", "target.view().float.view().float", "logit.view().float.size", "torch.log_softmax().exp", "torch.log_softmax().exp", "logit.view().float.view", "target.view().float.view", "torch.log_softmax", "torch.log_softmax", "logit.view().float.size", "target.view().float.size"], "function", ["None"], ["def", "stable_kl", "(", "logit", ",", "target", ",", "epsilon", "=", "1e-6", ",", "reduce", "=", "True", ")", ":", "\n", "    ", "logit", "=", "logit", ".", "view", "(", "-", "1", ",", "logit", ".", "size", "(", "-", "1", ")", ")", ".", "float", "(", ")", "\n", "target", "=", "target", ".", "view", "(", "-", "1", ",", "target", ".", "size", "(", "-", "1", ")", ")", ".", "float", "(", ")", "\n", "bs", "=", "logit", ".", "size", "(", "0", ")", "\n", "p", "=", "F", ".", "log_softmax", "(", "logit", ",", "1", ")", ".", "exp", "(", ")", "\n", "y", "=", "F", ".", "log_softmax", "(", "target", ",", "1", ")", ".", "exp", "(", ")", "\n", "rp", "=", "-", "(", "1.0", "/", "(", "p", "+", "epsilon", ")", "-", "1", "+", "epsilon", ")", ".", "detach", "(", ")", ".", "log", "(", ")", "\n", "ry", "=", "-", "(", "1.0", "/", "(", "y", "+", "epsilon", ")", "-", "1", "+", "epsilon", ")", ".", "detach", "(", ")", ".", "log", "(", ")", "\n", "if", "reduce", ":", "\n", "        ", "return", "(", "p", "*", "(", "rp", "-", "ry", ")", "*", "2", ")", ".", "sum", "(", ")", "/", "bs", "\n", "", "else", ":", "\n", "        ", "return", "(", "p", "*", "(", "rp", "-", "ry", ")", "*", "2", ")", ".", "sum", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.perturbation.SmartPerturbation.__init__": [[24, 51], ["super().__init__", "len"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["    ", "def", "__init__", "(", "\n", "self", ",", "\n", "epsilon", "=", "1e-6", ",", "\n", "multi_gpu_on", "=", "False", ",", "\n", "step_size", "=", "1e-3", ",", "\n", "noise_var", "=", "1e-5", ",", "\n", "norm_p", "=", "\"inf\"", ",", "\n", "k", "=", "1", ",", "\n", "fp16", "=", "False", ",", "\n", "encoder_type", "=", "EncoderModelType", ".", "BERT", ",", "\n", "loss_map", "=", "[", "]", ",", "\n", "norm_level", "=", "0", ",", "\n", ")", ":", "\n", "        ", "super", "(", "SmartPerturbation", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "epsilon", "=", "epsilon", "\n", "# eta", "\n", "self", ".", "step_size", "=", "step_size", "\n", "self", ".", "multi_gpu_on", "=", "multi_gpu_on", "\n", "self", ".", "fp16", "=", "fp16", "\n", "self", ".", "K", "=", "k", "\n", "# sigma", "\n", "self", ".", "noise_var", "=", "noise_var", "\n", "self", ".", "norm_p", "=", "norm_p", "\n", "self", ".", "encoder_type", "=", "encoder_type", "\n", "self", ".", "loss_map", "=", "loss_map", "\n", "self", ".", "norm_level", "=", "norm_level", ">", "0", "\n", "assert", "len", "(", "loss_map", ")", ">", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.perturbation.SmartPerturbation._norm_grad": [[52, 75], ["grad.sign", "torch.norm", "torch.norm", "torch.norm", "torch.norm", "torch.norm", "torch.norm", "torch.norm", "torch.norm", "grad.abs().max", "grad.abs().max", "grad.abs().max", "grad.abs", "grad.abs", "grad.abs"], "methods", ["None"], ["", "def", "_norm_grad", "(", "self", ",", "grad", ",", "eff_grad", "=", "None", ",", "sentence_level", "=", "False", ")", ":", "\n", "        ", "if", "self", ".", "norm_p", "==", "\"l2\"", ":", "\n", "            ", "if", "sentence_level", ":", "\n", "                ", "direction", "=", "grad", "/", "(", "\n", "torch", ".", "norm", "(", "grad", ",", "dim", "=", "(", "-", "2", ",", "-", "1", ")", ",", "keepdim", "=", "True", ")", "+", "self", ".", "epsilon", "\n", ")", "\n", "", "else", ":", "\n", "                ", "direction", "=", "grad", "/", "(", "\n", "torch", ".", "norm", "(", "grad", ",", "dim", "=", "-", "1", ",", "keepdim", "=", "True", ")", "+", "self", ".", "epsilon", "\n", ")", "\n", "", "", "elif", "self", ".", "norm_p", "==", "\"l1\"", ":", "\n", "            ", "direction", "=", "grad", ".", "sign", "(", ")", "\n", "", "else", ":", "\n", "            ", "if", "sentence_level", ":", "\n", "                ", "direction", "=", "grad", "/", "(", "\n", "grad", ".", "abs", "(", ")", ".", "max", "(", "(", "-", "2", ",", "-", "1", ")", ",", "keepdim", "=", "True", ")", "[", "0", "]", "+", "self", ".", "epsilon", "\n", ")", "\n", "", "else", ":", "\n", "                ", "direction", "=", "grad", "/", "(", "grad", ".", "abs", "(", ")", ".", "max", "(", "-", "1", ",", "keepdim", "=", "True", ")", "[", "0", "]", "+", "self", ".", "epsilon", ")", "\n", "eff_direction", "=", "eff_grad", "/", "(", "\n", "grad", ".", "abs", "(", ")", ".", "max", "(", "-", "1", ",", "keepdim", "=", "True", ")", "[", "0", "]", "+", "self", ".", "epsilon", "\n", ")", "\n", "", "", "return", "direction", ",", "eff_direction", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.perturbation.SmartPerturbation.forward": [[76, 153], ["model", "perturbation.generate_noise", "range", "model", "adv_lc", "set", "model", "torch.autograd.grad", "torch.autograd.grad", "torch.autograd.grad", "torch.autograd.grad", "delta_grad.norm", "perturbation.SmartPerturbation._norm_grad", "noise.detach.detach.detach", "noise.detach.detach.requires_grad_", "adv_logits.view.view.view", "model.detach().abs().mean", "eff_noise.detach().abs().mean", "torch.mse_loss", "torch.mse_loss", "loss.stable_kl", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isinf", "torch.isinf", "torch.isinf", "torch.isinf", "logits.detach", "adv_logits.view.view.view", "logits.detach", "model.detach().abs", "eff_noise.detach().abs", "model.detach", "eff_noise.detach"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.perturbation.generate_noise", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.perturbation.SmartPerturbation._norm_grad", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.loss.stable_kl"], ["", "def", "forward", "(", "\n", "self", ",", "\n", "model", ",", "\n", "logits", ",", "\n", "input_ids", ",", "\n", "token_type_ids", ",", "\n", "attention_mask", ",", "\n", "premise_mask", "=", "None", ",", "\n", "hyp_mask", "=", "None", ",", "\n", "task_id", "=", "0", ",", "\n", "task_type", "=", "TaskType", ".", "Classification", ",", "\n", "pairwise", "=", "1", ",", "\n", ")", ":", "\n", "# adv training", "\n", "        ", "assert", "task_type", "in", "set", "(", "\n", "[", "TaskType", ".", "Classification", ",", "TaskType", ".", "Ranking", ",", "TaskType", ".", "Regression", "]", "\n", ")", ",", "\"Donot support {} yet\"", ".", "format", "(", "task_type", ")", "\n", "vat_args", "=", "[", "\n", "input_ids", ",", "\n", "token_type_ids", ",", "\n", "attention_mask", ",", "\n", "premise_mask", ",", "\n", "hyp_mask", ",", "\n", "task_id", ",", "\n", "1", ",", "\n", "]", "\n", "\n", "# init delta", "\n", "embed", "=", "model", "(", "*", "vat_args", ")", "\n", "noise", "=", "generate_noise", "(", "embed", ",", "attention_mask", ",", "epsilon", "=", "self", ".", "noise_var", ")", "\n", "for", "step", "in", "range", "(", "0", ",", "self", ".", "K", ")", ":", "\n", "            ", "vat_args", "=", "[", "\n", "input_ids", ",", "\n", "token_type_ids", ",", "\n", "attention_mask", ",", "\n", "premise_mask", ",", "\n", "hyp_mask", ",", "\n", "task_id", ",", "\n", "2", ",", "\n", "embed", "+", "noise", ",", "\n", "]", "\n", "adv_logits", "=", "model", "(", "*", "vat_args", ")", "\n", "if", "task_type", "==", "TaskType", ".", "Regression", ":", "\n", "                ", "adv_loss", "=", "F", ".", "mse_loss", "(", "adv_logits", ",", "logits", ".", "detach", "(", ")", ",", "reduction", "=", "\"sum\"", ")", "\n", "", "else", ":", "\n", "                ", "if", "task_type", "==", "TaskType", ".", "Ranking", ":", "\n", "                    ", "adv_logits", "=", "adv_logits", ".", "view", "(", "-", "1", ",", "pairwise", ")", "\n", "", "adv_loss", "=", "stable_kl", "(", "adv_logits", ",", "logits", ".", "detach", "(", ")", ",", "reduce", "=", "False", ")", "\n", "", "(", "delta_grad", ",", ")", "=", "torch", ".", "autograd", ".", "grad", "(", "\n", "adv_loss", ",", "noise", ",", "only_inputs", "=", "True", ",", "retain_graph", "=", "False", "\n", ")", "\n", "norm", "=", "delta_grad", ".", "norm", "(", ")", "\n", "if", "torch", ".", "isnan", "(", "norm", ")", "or", "torch", ".", "isinf", "(", "norm", ")", ":", "\n", "                ", "return", "0", "\n", "", "eff_delta_grad", "=", "delta_grad", "*", "self", ".", "step_size", "\n", "delta_grad", "=", "noise", "+", "delta_grad", "*", "self", ".", "step_size", "\n", "noise", ",", "eff_noise", "=", "self", ".", "_norm_grad", "(", "\n", "delta_grad", ",", "eff_grad", "=", "eff_delta_grad", ",", "sentence_level", "=", "self", ".", "norm_level", "\n", ")", "\n", "noise", "=", "noise", ".", "detach", "(", ")", "\n", "noise", ".", "requires_grad_", "(", ")", "\n", "", "vat_args", "=", "[", "\n", "input_ids", ",", "\n", "token_type_ids", ",", "\n", "attention_mask", ",", "\n", "premise_mask", ",", "\n", "hyp_mask", ",", "\n", "task_id", ",", "\n", "2", ",", "\n", "embed", "+", "noise", ",", "\n", "]", "\n", "adv_logits", "=", "model", "(", "*", "vat_args", ")", "\n", "if", "task_type", "==", "TaskType", ".", "Ranking", ":", "\n", "            ", "adv_logits", "=", "adv_logits", ".", "view", "(", "-", "1", ",", "pairwise", ")", "\n", "", "adv_lc", "=", "self", ".", "loss_map", "[", "task_id", "]", "\n", "adv_loss", "=", "adv_lc", "(", "logits", ",", "adv_logits", ",", "ignore_index", "=", "-", "1", ")", "\n", "return", "adv_loss", ",", "embed", ".", "detach", "(", ")", ".", "abs", "(", ")", ".", "mean", "(", ")", ",", "eff_noise", ".", "detach", "(", ")", ".", "abs", "(", ")", ".", "mean", "(", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.perturbation.generate_noise": [[16, 21], ["noise.detach", "noise.requires_grad_", "embed.data.new().normal_", "embed.data.new", "embed.size"], "function", ["None"], ["def", "generate_noise", "(", "embed", ",", "mask", ",", "epsilon", "=", "1e-5", ")", ":", "\n", "    ", "noise", "=", "embed", ".", "data", ".", "new", "(", "embed", ".", "size", "(", ")", ")", ".", "normal_", "(", "0", ",", "1", ")", "*", "epsilon", "\n", "noise", ".", "detach", "(", ")", "\n", "noise", ".", "requires_grad_", "(", ")", "\n", "return", "noise", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.__init__": [[29, 79], ["data_utils.utils.AverageMeter", "data_utils.utils.AverageMeter", "data_utils.utils.AverageMeter", "data_utils.utils.AverageMeter", "mt_dnn.matcher.SANBertNetwork", "sum", "model.to.MTDNNModel._get_param_groups", "model.to.MTDNNModel._setup_optim", "model.to.MTDNNModel.optimizer.zero_grad", "model.to.MTDNNModel._setup_lossmap", "model.to.MTDNNModel._setup_kd_lossmap", "model.to.MTDNNModel._setup_adv_lossmap", "model.to.MTDNNModel._setup_adv_training", "model.to.MTDNNModel._setup_tokenizer", "model.to.MTDNNModel.network.load_state_dict", "torch.nn.parallel.DistributedDataParallel", "torch.nn.parallel.DistributedDataParallel", "torch.nn.parallel.DistributedDataParallel", "torch.nn.parallel.DistributedDataParallel", "torch.nn.parallel.DistributedDataParallel", "torch.nn.parallel.DistributedDataParallel", "torch.nn.parallel.DistributedDataParallel", "torch.nn.parallel.DistributedDataParallel", "torch.nn.parallel.DistributedDataParallel", "torch.nn.parallel.DistributedDataParallel", "torch.nn.parallel.DistributedDataParallel", "torch.nn.parallel.DistributedDataParallel", "torch.nn.parallel.DistributedDataParallel", "torch.nn.parallel.DistributedDataParallel", "torch.nn.parallel.DistributedDataParallel", "torch.nn.parallel.DistributedDataParallel", "p.nelement", "model.to.to.to", "model.to.to.to", "torch.DataParallel", "torch.DataParallel", "torch.DataParallel", "torch.DataParallel", "model.to.to.parameters"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel._get_param_groups", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel._setup_optim", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel._setup_lossmap", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel._setup_kd_lossmap", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel._setup_adv_lossmap", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel._setup_adv_training", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel._setup_tokenizer"], ["    ", "def", "__init__", "(", "self", ",", "opt", ",", "device", "=", "None", ",", "state_dict", "=", "None", ",", "num_train_step", "=", "-", "1", ")", ":", "\n", "        ", "self", ".", "config", "=", "opt", "\n", "self", ".", "updates", "=", "(", "\n", "state_dict", "[", "\"updates\"", "]", "if", "state_dict", "and", "\"updates\"", "in", "state_dict", "else", "0", "\n", ")", "\n", "self", ".", "local_updates", "=", "0", "\n", "self", ".", "device", "=", "device", "\n", "self", ".", "train_loss", "=", "AverageMeter", "(", ")", "\n", "self", ".", "adv_loss", "=", "AverageMeter", "(", ")", "\n", "self", ".", "emb_val", "=", "AverageMeter", "(", ")", "\n", "self", ".", "eff_perturb", "=", "AverageMeter", "(", ")", "\n", "self", ".", "initial_from_local", "=", "True", "if", "state_dict", "else", "False", "\n", "model", "=", "SANBertNetwork", "(", "opt", ",", "initial_from_local", "=", "self", ".", "initial_from_local", ")", "\n", "self", ".", "total_param", "=", "sum", "(", "\n", "[", "p", ".", "nelement", "(", ")", "for", "p", "in", "model", ".", "parameters", "(", ")", "if", "p", ".", "requires_grad", "]", "\n", ")", "\n", "if", "opt", "[", "\"cuda\"", "]", ":", "\n", "            ", "if", "self", ".", "config", "[", "\"local_rank\"", "]", "!=", "-", "1", ":", "\n", "                ", "model", "=", "model", ".", "to", "(", "self", ".", "device", ")", "\n", "", "else", ":", "\n", "                ", "model", "=", "model", ".", "to", "(", "self", ".", "device", ")", "\n", "", "", "self", ".", "network", "=", "model", "\n", "if", "state_dict", ":", "\n", "            ", "missing_keys", ",", "unexpected_keys", "=", "self", ".", "network", ".", "load_state_dict", "(", "\n", "state_dict", "[", "\"state\"", "]", ",", "strict", "=", "False", "\n", ")", "\n", "\n", "", "optimizer_parameters", "=", "self", ".", "_get_param_groups", "(", ")", "\n", "self", ".", "_setup_optim", "(", "optimizer_parameters", ",", "state_dict", ",", "num_train_step", ")", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "\n", "# if self.config[\"local_rank\"] not in [-1, 0]:", "\n", "#    torch.distributed.barrier()", "\n", "\n", "if", "self", ".", "config", "[", "\"local_rank\"", "]", "!=", "-", "1", ":", "\n", "            ", "self", ".", "mnetwork", "=", "torch", ".", "nn", ".", "parallel", ".", "DistributedDataParallel", "(", "\n", "self", ".", "network", ",", "\n", "device_ids", "=", "[", "self", ".", "config", "[", "\"local_rank\"", "]", "]", ",", "\n", "output_device", "=", "self", ".", "config", "[", "\"local_rank\"", "]", ",", "\n", "find_unused_parameters", "=", "True", ",", "\n", ")", "\n", "", "elif", "self", ".", "config", "[", "\"multi_gpu_on\"", "]", ":", "\n", "            ", "self", ".", "mnetwork", "=", "nn", ".", "DataParallel", "(", "self", ".", "network", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "mnetwork", "=", "self", ".", "network", "\n", "", "self", ".", "_setup_lossmap", "(", "self", ".", "config", ")", "\n", "self", ".", "_setup_kd_lossmap", "(", "self", ".", "config", ")", "\n", "self", ".", "_setup_adv_lossmap", "(", "self", ".", "config", ")", "\n", "self", ".", "_setup_adv_training", "(", "self", ".", "config", ")", "\n", "self", ".", "_setup_tokenizer", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel._setup_adv_training": [[80, 94], ["config.get", "mt_dnn.perturbation.SmartPerturbation"], "methods", ["None"], ["", "def", "_setup_adv_training", "(", "self", ",", "config", ")", ":", "\n", "        ", "self", ".", "adv_teacher", "=", "None", "\n", "if", "config", ".", "get", "(", "\"adv_train\"", ",", "False", ")", ":", "\n", "            ", "self", ".", "adv_teacher", "=", "SmartPerturbation", "(", "\n", "config", "[", "\"adv_epsilon\"", "]", ",", "\n", "config", "[", "\"multi_gpu_on\"", "]", ",", "\n", "config", "[", "\"adv_step_size\"", "]", ",", "\n", "config", "[", "\"adv_noise_var\"", "]", ",", "\n", "config", "[", "\"adv_p_norm\"", "]", ",", "\n", "config", "[", "\"adv_k\"", "]", ",", "\n", "config", "[", "\"fp16\"", "]", ",", "\n", "config", "[", "\"encoder_type\"", "]", ",", "\n", "loss_map", "=", "self", ".", "adv_task_loss_criterion", ",", "\n", "norm_level", "=", "config", "[", "\"adv_norm_level\"", "]", ",", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel._get_param_groups": [[96, 117], ["model.MTDNNModel.network.named_parameters", "model.MTDNNModel.network.named_parameters", "any", "any"], "methods", ["None"], ["", "", "def", "_get_param_groups", "(", "self", ")", ":", "\n", "        ", "no_decay", "=", "[", "\"bias\"", ",", "\"gamma\"", ",", "\"beta\"", ",", "\"LayerNorm.bias\"", ",", "\"LayerNorm.weight\"", "]", "\n", "optimizer_parameters", "=", "[", "\n", "{", "\n", "\"params\"", ":", "[", "\n", "p", "\n", "for", "n", ",", "p", "in", "self", ".", "network", ".", "named_parameters", "(", ")", "\n", "if", "not", "any", "(", "nd", "in", "n", "for", "nd", "in", "no_decay", ")", "\n", "]", ",", "\n", "\"weight_decay\"", ":", "0.01", ",", "\n", "}", ",", "\n", "{", "\n", "\"params\"", ":", "[", "\n", "p", "\n", "for", "n", ",", "p", "in", "self", ".", "network", ".", "named_parameters", "(", ")", "\n", "if", "any", "(", "nd", "in", "n", "for", "nd", "in", "no_decay", ")", "\n", "]", ",", "\n", "\"weight_decay\"", ":", "0.0", ",", "\n", "}", ",", "\n", "]", "\n", "return", "optimizer_parameters", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel._setup_optim": [[118, 184], ["torch.SGD", "torch.SGD", "torch.SGD", "torch.SGD", "model.MTDNNModel.optimizer.load_state_dict", "model.MTDNNModel.optimizer.load_state_dict", "amp.initialize", "get_polynomial_decay_schedule_with_warmup", "get_constant_schedule_with_warmup", "mt_dnn.optim.AdamaxW", "get_cosine_schedule_with_warmup", "get_linear_schedule_with_warmup", "torch.AdamW", "torch.AdamW", "torch.AdamW", "torch.AdamW", "RuntimeError", "ImportError"], "methods", ["None"], ["", "def", "_setup_optim", "(", "self", ",", "optimizer_parameters", ",", "state_dict", "=", "None", ",", "num_train_step", "=", "-", "1", ")", ":", "\n", "        ", "if", "self", ".", "config", "[", "'optimizer'", "]", "==", "'sgd'", ":", "\n", "            ", "self", ".", "optimizer", "=", "optim", ".", "SGD", "(", "optimizer_parameters", ",", "self", ".", "config", "[", "'learning_rate'", "]", ",", "\n", "weight_decay", "=", "self", ".", "config", "[", "'weight_decay'", "]", ")", "\n", "", "elif", "self", ".", "config", "[", "'optimizer'", "]", "==", "'adamax'", ":", "\n", "            ", "self", ".", "optimizer", "=", "AdamaxW", "(", "optimizer_parameters", ",", "\n", "lr", "=", "self", ".", "config", "[", "'learning_rate'", "]", ",", "\n", "weight_decay", "=", "self", ".", "config", "[", "'weight_decay'", "]", ")", "\n", "", "elif", "self", ".", "config", "[", "'optimizer'", "]", "==", "'adam'", ":", "\n", "            ", "self", ".", "optimizer", "=", "optim", ".", "AdamW", "(", "optimizer_parameters", ",", "\n", "lr", "=", "self", ".", "config", "[", "'learning_rate'", "]", ",", "\n", "weight_decay", "=", "self", ".", "config", "[", "'weight_decay'", "]", ")", "\n", "", "else", ":", "\n", "            ", "raise", "RuntimeError", "(", "'Unsupported optimizer: %s'", "%", "opt", "[", "'optimizer'", "]", ")", "\n", "\n", "", "if", "state_dict", "and", "'optimizer'", "in", "state_dict", ":", "\n", "            ", "self", ".", "optimizer", ".", "load_state_dict", "(", "state_dict", "[", "'optimizer'", "]", ")", "\n", "\n", "\n", "", "if", "state_dict", "and", "\"optimizer\"", "in", "state_dict", ":", "\n", "            ", "self", ".", "optimizer", ".", "load_state_dict", "(", "state_dict", "[", "\"optimizer\"", "]", ")", "\n", "\n", "", "if", "self", ".", "config", "[", "\"fp16\"", "]", ":", "\n", "            ", "try", ":", "\n", "                ", "from", "apex", "import", "amp", "\n", "global", "amp", "\n", "", "except", "ImportError", ":", "\n", "                ", "raise", "ImportError", "(", "\n", "\"Please install apex from https://www.github.com/nvidia/apex to use fp16 training.\"", "\n", ")", "\n", "", "model", ",", "optimizer", "=", "amp", ".", "initialize", "(", "\n", "self", ".", "network", ",", "self", ".", "optimizer", ",", "opt_level", "=", "self", ".", "config", "[", "\"fp16_opt_level\"", "]", "\n", ")", "\n", "self", ".", "network", "=", "model", "\n", "self", ".", "optimizer", "=", "optimizer", "\n", "\n", "# # set up scheduler", "\n", "", "self", ".", "scheduler", "=", "None", "\n", "scheduler_type", "=", "self", ".", "config", "[", "'scheduler_type'", "]", "\n", "warmup_steps", "=", "self", ".", "config", "[", "'warmup'", "]", "*", "num_train_step", "\n", "if", "scheduler_type", "==", "3", ":", "\n", "            ", "from", "transformers", "import", "get_polynomial_decay_schedule_with_warmup", "\n", "self", ".", "scheduler", "=", "get_polynomial_decay_schedule_with_warmup", "(", "\n", "self", ".", "optimizer", ",", "\n", "num_warmup_steps", "=", "warmup_steps", ",", "\n", "num_training_steps", "=", "num_train_step", "\n", ")", "\n", "", "if", "scheduler_type", "==", "2", ":", "\n", "            ", "from", "transformers", "import", "get_constant_schedule_with_warmup", "\n", "self", ".", "scheduler", "=", "get_constant_schedule_with_warmup", "(", "\n", "self", ".", "optimizer", ",", "\n", "num_warmup_steps", "=", "warmup_steps", "\n", ")", "\n", "", "elif", "scheduler_type", "==", "1", ":", "\n", "            ", "from", "transformers", "import", "get_cosine_schedule_with_warmup", "\n", "self", ".", "scheduler", "=", "get_cosine_schedule_with_warmup", "(", "\n", "self", ".", "optimizer", ",", "\n", "num_warmup_steps", "=", "warmup_steps", ",", "\n", "num_training_steps", "=", "num_train_step", "\n", ")", "\n", "", "else", ":", "\n", "            ", "from", "transformers", "import", "get_linear_schedule_with_warmup", "\n", "self", ".", "scheduler", "=", "get_linear_schedule_with_warmup", "(", "\n", "self", ".", "optimizer", ",", "\n", "num_warmup_steps", "=", "warmup_steps", ",", "\n", "num_training_steps", "=", "num_train_step", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel._setup_lossmap": [[187, 194], ["enumerate", "model.MTDNNModel.task_loss_criterion.append"], "methods", ["None"], ["", "", "def", "_setup_lossmap", "(", "self", ",", "config", ")", ":", "\n", "        ", "task_def_list", ":", "List", "[", "TaskDef", "]", "=", "config", "[", "\"task_def_list\"", "]", "\n", "self", ".", "task_loss_criterion", "=", "[", "]", "\n", "for", "idx", ",", "task_def", "in", "enumerate", "(", "task_def_list", ")", ":", "\n", "            ", "cs", "=", "task_def", ".", "loss", "\n", "lc", "=", "LOSS_REGISTRY", "[", "cs", "]", "(", "name", "=", "\"Loss func of task {}: {}\"", ".", "format", "(", "idx", ",", "cs", ")", ")", "\n", "self", ".", "task_loss_criterion", ".", "append", "(", "lc", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel._setup_kd_lossmap": [[195, 206], ["config.get", "enumerate", "model.MTDNNModel.kd_task_loss_criterion.append"], "methods", ["None"], ["", "", "def", "_setup_kd_lossmap", "(", "self", ",", "config", ")", ":", "\n", "        ", "task_def_list", ":", "List", "[", "TaskDef", "]", "=", "config", "[", "\"task_def_list\"", "]", "\n", "self", ".", "kd_task_loss_criterion", "=", "[", "]", "\n", "if", "config", ".", "get", "(", "\"mkd_opt\"", ",", "0", ")", ">", "0", ":", "\n", "            ", "for", "idx", ",", "task_def", "in", "enumerate", "(", "task_def_list", ")", ":", "\n", "                ", "cs", "=", "task_def", ".", "kd_loss", "\n", "assert", "cs", "is", "not", "None", "\n", "lc", "=", "LOSS_REGISTRY", "[", "cs", "]", "(", "\n", "name", "=", "\"KD Loss func of task {}: {}\"", ".", "format", "(", "idx", ",", "cs", ")", "\n", ")", "\n", "self", ".", "kd_task_loss_criterion", ".", "append", "(", "lc", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel._setup_adv_lossmap": [[207, 218], ["config.get", "enumerate", "model.MTDNNModel.adv_task_loss_criterion.append"], "methods", ["None"], ["", "", "", "def", "_setup_adv_lossmap", "(", "self", ",", "config", ")", ":", "\n", "        ", "task_def_list", ":", "List", "[", "TaskDef", "]", "=", "config", "[", "\"task_def_list\"", "]", "\n", "self", ".", "adv_task_loss_criterion", "=", "[", "]", "\n", "if", "config", ".", "get", "(", "\"adv_train\"", ",", "False", ")", ":", "\n", "            ", "for", "idx", ",", "task_def", "in", "enumerate", "(", "task_def_list", ")", ":", "\n", "                ", "cs", "=", "task_def", ".", "adv_loss", "\n", "assert", "cs", "is", "not", "None", "\n", "lc", "=", "LOSS_REGISTRY", "[", "cs", "]", "(", "\n", "name", "=", "\"Adv Loss func of task {}: {}\"", ".", "format", "(", "idx", ",", "cs", ")", "\n", ")", "\n", "self", ".", "adv_task_loss_criterion", ".", "append", "(", "lc", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel._setup_tokenizer": [[219, 229], ["AutoTokenizer.from_pretrained"], "methods", ["None"], ["", "", "", "def", "_setup_tokenizer", "(", "self", ")", ":", "\n", "        ", "try", ":", "\n", "            ", "from", "transformers", "import", "AutoTokenizer", "\n", "\n", "self", ".", "tokenizer", "=", "AutoTokenizer", ".", "from_pretrained", "(", "\n", "self", ".", "config", "[", "\"init_checkpoint\"", "]", ",", "\n", "cache_dir", "=", "self", ".", "config", "[", "\"transformer_cache\"", "]", ",", "\n", ")", "\n", "", "except", ":", "\n", "            ", "self", ".", "tokenizer", "=", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel._to_cuda": [[230, 244], ["isinstance", "isinstance", "tensor.to", "e.to"], "methods", ["None"], ["", "", "def", "_to_cuda", "(", "self", ",", "tensor", ")", ":", "\n", "        ", "if", "tensor", "is", "None", ":", "\n", "            ", "return", "tensor", "\n", "\n", "", "if", "isinstance", "(", "tensor", ",", "list", ")", "or", "isinstance", "(", "tensor", ",", "tuple", ")", ":", "\n", "# y = [e.cuda(non_blocking=True) for e in tensor]", "\n", "            ", "y", "=", "[", "e", ".", "to", "(", "self", ".", "device", ")", "for", "e", "in", "tensor", "]", "\n", "for", "e", "in", "y", ":", "\n", "                ", "e", ".", "requires_grad", "=", "False", "\n", "", "", "else", ":", "\n", "# y = tensor.cuda(non_blocking=True)", "\n", "            ", "y", "=", "tensor", ".", "to", "(", "self", ".", "device", ")", "\n", "y", ".", "requires_grad", "=", "False", "\n", "", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.update": [[245, 389], ["model.MTDNNModel.network.train", "inputs.append", "model.MTDNNModel.config.get", "model.MTDNNModel.mnetwork", "batch_data[].size", "model.MTDNNModel._to_cuda", "y.view.view.size", "y.view.view.view", "len", "inputs.append", "inputs.append", "inputs.append", "model.MTDNNModel.config.get", "model.MTDNNModel.adv_teacher.forward", "copy.deepcopy", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "model.MTDNNModel.train_loss.update", "model.MTDNNModel.train_loss.update", "model.MTDNNModel.config.get", "model.MTDNNModel.config.get", "loss.backward", "model.MTDNNModel.optimizer.step", "model.MTDNNModel.optimizer.zero_grad", "batch_data[].cuda", "isinstance", "model.MTDNNModel.config.get", "model.MTDNNModel._to_cuda", "kd_lc", "copy.deepcopy.item", "loss.item", "copy.deepcopy", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "model.MTDNNModel.adv_loss.update", "copy.deepcopy", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "model.MTDNNModel.emb_val.update", "copy.deepcopy", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "torch.distributed.all_reduce", "model.MTDNNModel.eff_perturb.update", "model.MTDNNModel.adv_loss.update", "model.MTDNNModel.emb_val.update", "model.MTDNNModel.eff_perturb.update", "amp.scale_loss", "scaled_loss.backward", "model.MTDNNModel.config.get", "model.MTDNNModel.scheduler.step", "batch_meta.get", "copy.deepcopy.item", "copy.deepcopy.item", "copy.deepcopy.item", "adv_loss.item", "emb_val.item", "eff_perturb.item", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "amp.master_params", "model.MTDNNModel.network.parameters", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel._to_cuda", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.perturbation.SmartPerturbation.forward", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.update", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.update", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.step", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.cuda", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel._to_cuda", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.update", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.update", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.update", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.update", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.update", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.update", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.step"], ["", "def", "update", "(", "self", ",", "batch_meta", ",", "batch_data", ")", ":", "\n", "        ", "self", ".", "network", ".", "train", "(", ")", "\n", "y", "=", "batch_data", "[", "batch_meta", "[", "\"label\"", "]", "]", "\n", "y", "=", "self", ".", "_to_cuda", "(", "y", ")", "if", "self", ".", "config", "[", "\"cuda\"", "]", "else", "y", "\n", "if", "batch_meta", "[", "\"task_def\"", "]", "[", "\"task_type\"", "]", "==", "TaskType", ".", "SeqenceGeneration", ":", "\n", "            ", "seq_length", "=", "y", ".", "size", "(", "1", ")", "\n", "y", "=", "y", ".", "view", "(", "-", "1", ")", "\n", "\n", "", "task_id", "=", "batch_meta", "[", "\"task_id\"", "]", "\n", "inputs", "=", "batch_data", "[", ":", "batch_meta", "[", "\"input_len\"", "]", "]", "\n", "if", "len", "(", "inputs", ")", "==", "3", ":", "\n", "            ", "inputs", ".", "append", "(", "None", ")", "\n", "inputs", ".", "append", "(", "None", ")", "\n", "", "inputs", ".", "append", "(", "task_id", ")", "\n", "if", "\"y_token_id\"", "in", "batch_meta", ":", "\n", "            ", "inputs", ".", "append", "(", "batch_data", "[", "batch_meta", "[", "\"y_token_id\"", "]", "]", ")", "\n", "", "weight", "=", "None", "\n", "if", "self", ".", "config", ".", "get", "(", "\"weighted_on\"", ",", "False", ")", ":", "\n", "            ", "if", "self", ".", "config", "[", "\"cuda\"", "]", ":", "\n", "                ", "weight", "=", "batch_data", "[", "batch_meta", "[", "\"factor\"", "]", "]", ".", "cuda", "(", "non_blocking", "=", "True", ")", "\n", "", "else", ":", "\n", "                ", "weight", "=", "batch_data", "[", "batch_meta", "[", "\"factor\"", "]", "]", "\n", "\n", "# fw to get logits", "\n", "", "", "logits", "=", "self", ".", "mnetwork", "(", "*", "inputs", ")", "\n", "\n", "# compute loss", "\n", "loss", "=", "0", "\n", "if", "self", ".", "task_loss_criterion", "[", "task_id", "]", "and", "(", "y", "is", "not", "None", ")", ":", "\n", "            ", "loss_criterion", "=", "self", ".", "task_loss_criterion", "[", "task_id", "]", "\n", "if", "(", "\n", "isinstance", "(", "loss_criterion", ",", "RankCeCriterion", ")", "\n", "and", "batch_meta", "[", "\"pairwise_size\"", "]", ">", "1", "\n", ")", ":", "\n", "# reshape the logits for ranking.", "\n", "                ", "loss", "=", "self", ".", "task_loss_criterion", "[", "task_id", "]", "(", "\n", "logits", ",", "\n", "y", ",", "\n", "weight", ",", "\n", "ignore_index", "=", "-", "1", ",", "\n", "pairwise_size", "=", "batch_meta", "[", "\"pairwise_size\"", "]", ",", "\n", ")", "\n", "", "elif", "batch_meta", "[", "\"task_def\"", "]", "[", "\"task_type\"", "]", "==", "TaskType", ".", "SeqenceGeneration", ":", "\n", "                ", "weight", "=", "(", "\n", "(", "\n", "1.0", "\n", "/", "torch", ".", "sum", "(", "\n", "(", "y", ">", "-", "1", ")", ".", "float", "(", ")", ".", "view", "(", "-", "1", ",", "seq_length", ")", ",", "1", ",", "keepdim", "=", "True", "\n", ")", "\n", ")", "\n", ".", "repeat", "(", "1", ",", "seq_length", ")", "\n", ".", "view", "(", "-", "1", ")", "\n", ")", "\n", "loss", "=", "self", ".", "task_loss_criterion", "[", "task_id", "]", "(", "\n", "logits", ",", "y", ",", "weight", ",", "ignore_index", "=", "-", "1", "\n", ")", "\n", "", "else", ":", "\n", "                ", "loss", "=", "self", ".", "task_loss_criterion", "[", "task_id", "]", "(", "\n", "logits", ",", "y", ",", "weight", ",", "ignore_index", "=", "-", "1", "\n", ")", "\n", "\n", "# compute kd loss", "\n", "", "", "if", "self", ".", "config", ".", "get", "(", "\"mkd_opt\"", ",", "0", ")", ">", "0", "and", "(", "\"soft_label\"", "in", "batch_meta", ")", ":", "\n", "            ", "soft_labels", "=", "batch_meta", "[", "\"soft_label\"", "]", "\n", "soft_labels", "=", "(", "\n", "self", ".", "_to_cuda", "(", "soft_labels", ")", "if", "self", ".", "config", "[", "\"cuda\"", "]", "else", "soft_labels", "\n", ")", "\n", "kd_lc", "=", "self", ".", "kd_task_loss_criterion", "[", "task_id", "]", "\n", "kd_loss", "=", "(", "\n", "kd_lc", "(", "logits", ",", "soft_labels", ",", "weight", ",", "ignore_index", "=", "-", "1", ")", "if", "kd_lc", "else", "0", "\n", ")", "\n", "loss", "=", "loss", "+", "kd_loss", "\n", "\n", "# adv training", "\n", "", "if", "self", ".", "config", ".", "get", "(", "\"adv_train\"", ",", "False", ")", "and", "self", ".", "adv_teacher", ":", "\n", "# task info", "\n", "            ", "task_type", "=", "batch_meta", "[", "\"task_def\"", "]", "[", "\"task_type\"", "]", "\n", "adv_inputs", "=", "(", "\n", "[", "self", ".", "mnetwork", ",", "logits", "]", "\n", "+", "inputs", "\n", "+", "[", "task_type", ",", "batch_meta", ".", "get", "(", "\"pairwise_size\"", ",", "1", ")", "]", "\n", ")", "\n", "adv_loss", ",", "emb_val", ",", "eff_perturb", "=", "self", ".", "adv_teacher", ".", "forward", "(", "*", "adv_inputs", ")", "\n", "loss", "=", "loss", "+", "self", ".", "config", "[", "\"adv_alpha\"", "]", "*", "adv_loss", "\n", "\n", "", "batch_size", "=", "batch_data", "[", "batch_meta", "[", "\"token_id\"", "]", "]", ".", "size", "(", "0", ")", "\n", "# rescale loss as dynamic batching", "\n", "if", "self", ".", "config", "[", "\"bin_on\"", "]", ":", "\n", "            ", "loss", "=", "loss", "*", "(", "1.0", "*", "batch_size", "/", "self", ".", "config", "[", "\"batch_size\"", "]", ")", "\n", "", "if", "self", ".", "config", "[", "\"local_rank\"", "]", "!=", "-", "1", ":", "\n", "# print('Rank ', self.config['local_rank'], ' loss ', loss)", "\n", "            ", "copied_loss", "=", "copy", ".", "deepcopy", "(", "loss", ".", "data", ")", "\n", "torch", ".", "distributed", ".", "all_reduce", "(", "copied_loss", ")", "\n", "copied_loss", "=", "copied_loss", "/", "self", ".", "config", "[", "\"world_size\"", "]", "\n", "self", ".", "train_loss", ".", "update", "(", "copied_loss", ".", "item", "(", ")", ",", "batch_size", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "train_loss", ".", "update", "(", "loss", ".", "item", "(", ")", ",", "batch_size", ")", "\n", "\n", "", "if", "self", ".", "config", ".", "get", "(", "\"adv_train\"", ",", "False", ")", "and", "self", ".", "adv_teacher", ":", "\n", "            ", "if", "self", ".", "config", "[", "\"local_rank\"", "]", "!=", "-", "1", ":", "\n", "                ", "copied_adv_loss", "=", "copy", ".", "deepcopy", "(", "adv_loss", ".", "data", ")", "\n", "torch", ".", "distributed", ".", "all_reduce", "(", "copied_adv_loss", ")", "\n", "copied_adv_loss", "=", "copied_adv_loss", "/", "self", ".", "config", "[", "\"world_size\"", "]", "\n", "self", ".", "adv_loss", ".", "update", "(", "copied_adv_loss", ".", "item", "(", ")", ",", "batch_size", ")", "\n", "\n", "copied_emb_val", "=", "copy", ".", "deepcopy", "(", "emb_val", ".", "data", ")", "\n", "torch", ".", "distributed", ".", "all_reduce", "(", "copied_emb_val", ")", "\n", "copied_emb_val", "=", "copied_emb_val", "/", "self", ".", "config", "[", "\"world_size\"", "]", "\n", "self", ".", "emb_val", ".", "update", "(", "copied_emb_val", ".", "item", "(", ")", ",", "batch_size", ")", "\n", "\n", "copied_eff_perturb", "=", "copy", ".", "deepcopy", "(", "eff_perturb", ".", "data", ")", "\n", "torch", ".", "distributed", ".", "all_reduce", "(", "copied_eff_perturb", ")", "\n", "copied_eff_perturb", "=", "copied_eff_perturb", "/", "self", ".", "config", "[", "\"world_size\"", "]", "\n", "self", ".", "eff_perturb", ".", "update", "(", "copied_eff_perturb", ".", "item", "(", ")", ",", "batch_size", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "adv_loss", ".", "update", "(", "adv_loss", ".", "item", "(", ")", ",", "batch_size", ")", "\n", "self", ".", "emb_val", ".", "update", "(", "emb_val", ".", "item", "(", ")", ",", "batch_size", ")", "\n", "self", ".", "eff_perturb", ".", "update", "(", "eff_perturb", ".", "item", "(", ")", ",", "batch_size", ")", "\n", "\n", "# scale loss", "\n", "", "", "loss", "=", "loss", "/", "self", ".", "config", ".", "get", "(", "\"grad_accumulation_step\"", ",", "1", ")", "\n", "if", "self", ".", "config", "[", "\"fp16\"", "]", ":", "\n", "            ", "with", "amp", ".", "scale_loss", "(", "loss", ",", "self", ".", "optimizer", ")", "as", "scaled_loss", ":", "\n", "                ", "scaled_loss", ".", "backward", "(", ")", "\n", "", "", "else", ":", "\n", "            ", "loss", ".", "backward", "(", ")", "\n", "", "self", ".", "local_updates", "+=", "1", "\n", "if", "self", ".", "local_updates", "%", "self", ".", "config", ".", "get", "(", "\"grad_accumulation_step\"", ",", "1", ")", "==", "0", ":", "\n", "            ", "if", "self", ".", "config", "[", "\"global_grad_clipping\"", "]", ">", "0", ":", "\n", "                ", "if", "self", ".", "config", "[", "\"fp16\"", "]", ":", "\n", "                    ", "torch", ".", "nn", ".", "utils", ".", "clip_grad_norm_", "(", "\n", "amp", ".", "master_params", "(", "self", ".", "optimizer", ")", ",", "\n", "self", ".", "config", "[", "\"global_grad_clipping\"", "]", ",", "\n", ")", "\n", "", "else", ":", "\n", "                    ", "torch", ".", "nn", ".", "utils", ".", "clip_grad_norm_", "(", "\n", "self", ".", "network", ".", "parameters", "(", ")", ",", "self", ".", "config", "[", "\"global_grad_clipping\"", "]", "\n", ")", "\n", "", "", "self", ".", "updates", "+=", "1", "\n", "# reset number of the grad accumulation", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "if", "self", ".", "scheduler", ":", "\n", "                ", "self", ".", "scheduler", ".", "step", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.encode": [[390, 395], ["model.MTDNNModel.network.eval", "model.MTDNNModel.network.encode"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.encode"], ["", "", "", "def", "encode", "(", "self", ",", "batch_meta", ",", "batch_data", ")", ":", "\n", "        ", "self", ".", "network", ".", "eval", "(", ")", "\n", "inputs", "=", "batch_data", "[", ":", "3", "]", "\n", "sequence_output", "=", "self", ".", "network", ".", "encode", "(", "*", "inputs", ")", "[", "0", "]", "\n", "return", "sequence_output", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.extract": [[398, 404], ["model.MTDNNModel.network.eval", "model.MTDNNModel.mnetwork.bert"], "methods", ["None"], ["", "def", "extract", "(", "self", ",", "batch_meta", ",", "batch_data", ")", ":", "\n", "        ", "self", ".", "network", ".", "eval", "(", ")", "\n", "# 'token_id': 0; 'segment_id': 1; 'mask': 2", "\n", "inputs", "=", "batch_data", "[", ":", "3", "]", "\n", "all_encoder_layers", ",", "pooled_output", "=", "self", ".", "mnetwork", ".", "bert", "(", "*", "inputs", ")", "\n", "return", "all_encoder_layers", ",", "pooled_output", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.predict": [[405, 530], ["model.MTDNNModel.network.eval", "experiments.exp_def.TaskDef.from_dict", "tasks.get_task_obj", "inputs.append", "model.MTDNNModel.mnetwork", "len", "inputs.append", "inputs.append", "inputs.append", "inputs.append", "tasks.get_task_obj.test_predict", "score.numpy.numpy.contiguous().view", "torch.softmax", "torch.softmax", "torch.softmax", "torch.softmax", "score.numpy.numpy.data.cpu", "score.numpy.numpy.numpy", "numpy.zeros", "numpy.argmax", "enumerate", "predict.strip.strip.reshape().tolist", "score.numpy.numpy.reshape().tolist", "score.numpy.numpy.contiguous", "score.numpy.numpy.data.cpu", "score.numpy.numpy.numpy", "numpy.argmax().reshape().tolist", "mask.sum().tolist", "enumerate", "score.numpy.numpy.reshape().tolist", "score.numpy.numpy.contiguous", "predict.strip.strip.reshape", "score.numpy.numpy.reshape", "final_predict.append", "enumerate", "start.numpy().tolist.numpy().tolist.contiguous", "start.numpy().tolist.numpy().tolist.data.cpu", "start.numpy().tolist.numpy().tolist.numpy().tolist", "end.numpy().tolist.numpy().tolist.contiguous", "end.numpy().tolist.numpy().tolist.data.cpu", "end.numpy().tolist.numpy().tolist.numpy().tolist", "numpy.argmax().reshape", "mask.sum", "score.numpy.numpy.reshape", "features.append", "model.MTDNNModel.tokenizer.batch_decode", "enumerate", "score.numpy.numpy.contiguous", "score.numpy.numpy.data.cpu", "score.numpy.numpy.numpy().tolist", "mask.size", "batch_meta.get", "start.numpy().tolist.numpy().tolist.numpy", "end.numpy().tolist.numpy().tolist.numpy", "predict.strip.strip.strip", "score.numpy.numpy.contiguous().view", "score.numpy.numpy.data.cpu", "score.numpy.numpy.numpy", "score.numpy.numpy.tolist", "ValueError", "numpy.argmax", "score.numpy.numpy.numpy", "eval", "eval", "numpy.argmax", "score.numpy.numpy.contiguous"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.experiments.exp_def.TaskDef.from_dict", "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.get_task_obj", "home.repos.pwc.inspect_result.namisan_mt-dnn.tasks.__init__.ClassificationTask.test_predict"], ["", "def", "predict", "(", "self", ",", "batch_meta", ",", "batch_data", ")", ":", "\n", "        ", "self", ".", "network", ".", "eval", "(", ")", "\n", "task_id", "=", "batch_meta", "[", "\"task_id\"", "]", "\n", "task_def", "=", "TaskDef", ".", "from_dict", "(", "batch_meta", "[", "\"task_def\"", "]", ")", "\n", "task_type", "=", "task_def", ".", "task_type", "\n", "task_obj", "=", "tasks", ".", "get_task_obj", "(", "task_def", ")", "\n", "inputs", "=", "batch_data", "[", ":", "batch_meta", "[", "\"input_len\"", "]", "]", "\n", "if", "len", "(", "inputs", ")", "==", "3", ":", "\n", "            ", "inputs", ".", "append", "(", "None", ")", "\n", "inputs", ".", "append", "(", "None", ")", "\n", "", "inputs", ".", "append", "(", "task_id", ")", "\n", "if", "task_type", "==", "TaskType", ".", "SeqenceGeneration", ":", "\n", "# y_idx, #3 -> gen", "\n", "            ", "inputs", ".", "append", "(", "None", ")", "\n", "inputs", ".", "append", "(", "3", ")", "\n", "\n", "", "score", "=", "self", ".", "mnetwork", "(", "*", "inputs", ")", "\n", "if", "task_obj", "is", "not", "None", ":", "\n", "            ", "score", ",", "predict", "=", "task_obj", ".", "test_predict", "(", "score", ")", "\n", "", "elif", "task_type", "==", "TaskType", ".", "Ranking", ":", "\n", "            ", "score", "=", "score", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ",", "batch_meta", "[", "\"pairwise_size\"", "]", ")", "\n", "assert", "task_type", "==", "TaskType", ".", "Ranking", "\n", "score", "=", "F", ".", "softmax", "(", "score", ",", "dim", "=", "1", ")", "\n", "score", "=", "score", ".", "data", ".", "cpu", "(", ")", "\n", "score", "=", "score", ".", "numpy", "(", ")", "\n", "predict", "=", "np", ".", "zeros", "(", "score", ".", "shape", ",", "dtype", "=", "int", ")", "\n", "positive", "=", "np", ".", "argmax", "(", "score", ",", "axis", "=", "1", ")", "\n", "for", "idx", ",", "pos", "in", "enumerate", "(", "positive", ")", ":", "\n", "                ", "predict", "[", "idx", ",", "pos", "]", "=", "1", "\n", "", "predict", "=", "predict", ".", "reshape", "(", "-", "1", ")", ".", "tolist", "(", ")", "\n", "score", "=", "score", ".", "reshape", "(", "-", "1", ")", ".", "tolist", "(", ")", "\n", "return", "score", ",", "predict", ",", "batch_meta", "[", "\"true_label\"", "]", "\n", "", "elif", "task_type", "==", "TaskType", ".", "SeqenceLabeling", ":", "\n", "            ", "mask", "=", "batch_data", "[", "batch_meta", "[", "\"mask\"", "]", "]", "\n", "score", "=", "score", ".", "contiguous", "(", ")", "\n", "score", "=", "score", ".", "data", ".", "cpu", "(", ")", "\n", "score", "=", "score", ".", "numpy", "(", ")", "\n", "predict", "=", "np", ".", "argmax", "(", "score", ",", "axis", "=", "1", ")", ".", "reshape", "(", "mask", ".", "size", "(", ")", ")", ".", "tolist", "(", ")", "\n", "valied_lenght", "=", "mask", ".", "sum", "(", "1", ")", ".", "tolist", "(", ")", "\n", "final_predict", "=", "[", "]", "\n", "for", "idx", ",", "p", "in", "enumerate", "(", "predict", ")", ":", "\n", "                ", "final_predict", ".", "append", "(", "p", "[", ":", "valied_lenght", "[", "idx", "]", "]", ")", "\n", "", "score", "=", "score", ".", "reshape", "(", "-", "1", ")", ".", "tolist", "(", ")", "\n", "return", "score", ",", "final_predict", ",", "batch_meta", "[", "\"label\"", "]", "\n", "", "elif", "task_type", "==", "TaskType", ".", "Span", "or", "task_type", "==", "TaskType", ".", "SpanYN", ":", "\n", "            ", "predictions", "=", "[", "]", "\n", "features", "=", "[", "]", "\n", "for", "idx", ",", "offset", "in", "enumerate", "(", "batch_meta", "[", "\"offset_mapping\"", "]", ")", ":", "\n", "                ", "token_is_max_context", "=", "(", "\n", "batch_meta", "[", "\"token_is_max_context\"", "]", "[", "idx", "]", "\n", "if", "batch_meta", ".", "get", "(", "\"token_is_max_context\"", ",", "None", ")", "\n", "else", "None", "\n", ")", "\n", "sample_id", "=", "batch_meta", "[", "\"uids\"", "]", "[", "idx", "]", "\n", "if", "\"label\"", "in", "batch_meta", ":", "\n", "                    ", "feature", "=", "{", "\n", "\"offset_mapping\"", ":", "offset", ",", "\n", "\"token_is_max_context\"", ":", "token_is_max_context", ",", "\n", "\"uid\"", ":", "sample_id", ",", "\n", "\"context\"", ":", "batch_meta", "[", "\"context\"", "]", "[", "idx", "]", ",", "\n", "\"answer\"", ":", "batch_meta", "[", "\"answer\"", "]", "[", "idx", "]", ",", "\n", "\"label\"", ":", "batch_meta", "[", "\"label\"", "]", "[", "idx", "]", ",", "\n", "}", "\n", "", "else", ":", "\n", "                    ", "feature", "=", "{", "\n", "\"offset_mapping\"", ":", "offset", ",", "\n", "\"token_is_max_context\"", ":", "token_is_max_context", ",", "\n", "\"uid\"", ":", "sample_id", ",", "\n", "\"context\"", ":", "batch_meta", "[", "\"context\"", "]", "[", "idx", "]", ",", "\n", "\"answer\"", ":", "batch_meta", "[", "\"answer\"", "]", "[", "idx", "]", ",", "\n", "}", "\n", "", "if", "\"null_ans_index\"", "in", "batch_meta", ":", "\n", "                    ", "feature", "[", "\"null_ans_index\"", "]", "=", "batch_meta", "[", "\"null_ans_index\"", "]", "\n", "", "features", ".", "append", "(", "feature", ")", "\n", "", "start", ",", "end", "=", "score", "\n", "start", "=", "start", ".", "contiguous", "(", ")", "\n", "start", "=", "start", ".", "data", ".", "cpu", "(", ")", "\n", "start", "=", "start", ".", "numpy", "(", ")", ".", "tolist", "(", ")", "\n", "end", "=", "end", ".", "contiguous", "(", ")", "\n", "end", "=", "end", ".", "data", ".", "cpu", "(", ")", "\n", "end", "=", "end", ".", "numpy", "(", ")", ".", "tolist", "(", ")", "\n", "return", "(", "start", ",", "end", ")", ",", "predictions", ",", "features", "\n", "", "elif", "task_type", "==", "TaskType", ".", "SeqenceGeneration", ":", "\n", "            ", "predicts", "=", "self", ".", "tokenizer", ".", "batch_decode", "(", "score", ",", "skip_special_tokens", "=", "True", ")", "\n", "predictions", "=", "{", "}", "\n", "golds", "=", "{", "}", "\n", "for", "idx", ",", "predict", "in", "enumerate", "(", "predicts", ")", ":", "\n", "                ", "sample_id", "=", "batch_meta", "[", "\"uids\"", "]", "[", "idx", "]", "\n", "answer", "=", "batch_meta", "[", "\"answer\"", "]", "[", "idx", "]", "\n", "predict", "=", "predict", ".", "strip", "(", ")", "\n", "if", "predict", "==", "DUMPY_STRING_FOR_EMPTY_ANS", ":", "\n", "                    ", "predict", "=", "\"\"", "\n", "", "predictions", "[", "sample_id", "]", "=", "predict", "\n", "golds", "[", "sample_id", "]", "=", "answer", "\n", "", "score", "=", "score", ".", "contiguous", "(", ")", "\n", "score", "=", "score", ".", "data", ".", "cpu", "(", ")", "\n", "score", "=", "score", ".", "numpy", "(", ")", ".", "tolist", "(", ")", "\n", "return", "score", ",", "predictions", ",", "golds", "\n", "", "elif", "task_type", "==", "TaskType", ".", "ClozeChoice", ":", "\n", "            ", "score", "=", "score", ".", "contiguous", "(", ")", ".", "view", "(", "-", "1", ")", "\n", "score", "=", "score", ".", "data", ".", "cpu", "(", ")", "\n", "score", "=", "score", ".", "numpy", "(", ")", "\n", "copy_score", "=", "score", ".", "tolist", "(", ")", "\n", "answers", "=", "batch_meta", "[", "\"answer\"", "]", "\n", "choices", "=", "batch_meta", "[", "\"choice\"", "]", "\n", "chunks", "=", "batch_meta", "[", "\"pairwise_size\"", "]", "\n", "uids", "=", "batch_meta", "[", "\"uids\"", "]", "\n", "predictions", "=", "{", "}", "\n", "golds", "=", "{", "}", "\n", "for", "chunk", "in", "chunks", ":", "\n", "                ", "uid", "=", "uids", "[", "0", "]", "\n", "answer", "=", "eval", "(", "answers", "[", "0", "]", ")", "\n", "choice", "=", "eval", "(", "choices", "[", "0", "]", ")", "\n", "answers", "=", "answers", "[", "chunk", ":", "]", "\n", "choices", "=", "choices", "[", "chunk", ":", "]", "\n", "current_p", "=", "score", "[", ":", "chunk", "]", "\n", "score", "=", "score", "[", "chunk", ":", "]", "\n", "positive", "=", "np", ".", "argmax", "(", "current_p", ")", "\n", "predict", "=", "choice", "[", "positive", "]", "\n", "predictions", "[", "uid", "]", "=", "predict", "\n", "golds", "[", "uid", "]", "=", "answer", "\n", "", "return", "copy_score", ",", "predictions", ",", "golds", "\n", "", "else", ":", "\n", "            ", "raise", "ValueError", "(", "\"Unknown task_type: %s\"", "%", "task_type", ")", "\n", "", "return", "score", ",", "predict", ",", "batch_meta", "[", "\"label\"", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save": [[531, 545], ["isinstance", "dict", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "logger.info", "model.MTDNNModel.optimizer.state_dict", "v.cpu", "model.state_dict().items", "model.state_dict"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.save", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.EMA.state_dict", "home.repos.pwc.inspect_result.namisan_mt-dnn.module.my_optim.EMA.state_dict"], ["", "def", "save", "(", "self", ",", "filename", ")", ":", "\n", "        ", "if", "isinstance", "(", "self", ".", "mnetwork", ",", "torch", ".", "nn", ".", "parallel", ".", "DistributedDataParallel", ")", ":", "\n", "            ", "model", "=", "self", ".", "mnetwork", ".", "module", "\n", "", "else", ":", "\n", "            ", "model", "=", "self", ".", "network", "\n", "# network_state = dict([(k, v.cpu()) for k, v in self.network.state_dict().items()])", "\n", "", "network_state", "=", "dict", "(", "[", "(", "k", ",", "v", ".", "cpu", "(", ")", ")", "for", "k", ",", "v", "in", "model", ".", "state_dict", "(", ")", ".", "items", "(", ")", "]", ")", "\n", "params", "=", "{", "\n", "\"state\"", ":", "network_state", ",", "\n", "\"optimizer\"", ":", "self", ".", "optimizer", ".", "state_dict", "(", ")", ",", "\n", "\"config\"", ":", "self", ".", "config", ",", "\n", "}", "\n", "torch", ".", "save", "(", "params", ",", "filename", ")", "\n", "logger", ".", "info", "(", "\"model saved to {}\"", ".", "format", "(", "filename", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load": [[546, 554], ["torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "model.MTDNNModel.network.load_state_dict", "model.MTDNNModel.optimizer.load_state_dict", "model.MTDNNModel.config.update"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.load", "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.update"], ["", "def", "load", "(", "self", ",", "checkpoint", ")", ":", "\n", "        ", "model_state_dict", "=", "torch", ".", "load", "(", "checkpoint", ")", "\n", "if", "\"state\"", "in", "model_state_dict", ":", "\n", "            ", "self", ".", "network", ".", "load_state_dict", "(", "model_state_dict", "[", "\"state\"", "]", ",", "strict", "=", "False", ")", "\n", "", "if", "\"optimizer\"", "in", "model_state_dict", ":", "\n", "            ", "self", ".", "optimizer", ".", "load_state_dict", "(", "model_state_dict", "[", "\"optimizer\"", "]", ")", "\n", "", "if", "\"config\"", "in", "model_state_dict", ":", "\n", "            ", "self", ".", "config", ".", "update", "(", "model_state_dict", "[", "\"config\"", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.cuda": [[555, 557], ["model.MTDNNModel.network.cuda"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.model.MTDNNModel.cuda"], ["", "", "def", "cuda", "(", "self", ")", ":", "\n", "        ", "self", ".", "network", ".", "cuda", "(", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__": [[32, 45], ["dict", "torch.optim.Optimizer.__init__", "ValueError", "ValueError", "ValueError", "ValueError"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__init__"], ["def", "__init__", "(", "self", ",", "params", ",", "lr", "=", "1e-3", ",", "betas", "=", "(", "0.9", ",", "0.999", ")", ",", "eps", "=", "1e-8", ",", "\n", "weight_decay", "=", "1e-2", ",", "amsgrad", "=", "False", ")", ":", "\n", "        ", "if", "not", "0.0", "<=", "lr", ":", "\n", "            ", "raise", "ValueError", "(", "\"Invalid learning rate: {}\"", ".", "format", "(", "lr", ")", ")", "\n", "", "if", "not", "0.0", "<=", "eps", ":", "\n", "            ", "raise", "ValueError", "(", "\"Invalid epsilon value: {}\"", ".", "format", "(", "eps", ")", ")", "\n", "", "if", "not", "0.0", "<=", "betas", "[", "0", "]", "<", "1.0", ":", "\n", "            ", "raise", "ValueError", "(", "\"Invalid beta parameter at index 0: {}\"", ".", "format", "(", "betas", "[", "0", "]", ")", ")", "\n", "", "if", "not", "0.0", "<=", "betas", "[", "1", "]", "<", "1.0", ":", "\n", "            ", "raise", "ValueError", "(", "\"Invalid beta parameter at index 1: {}\"", ".", "format", "(", "betas", "[", "1", "]", ")", ")", "\n", "", "defaults", "=", "dict", "(", "lr", "=", "lr", ",", "betas", "=", "betas", ",", "eps", "=", "eps", ",", "\n", "weight_decay", "=", "weight_decay", ",", "amsgrad", "=", "amsgrad", ")", "\n", "super", "(", "AdamaxW", ",", "self", ")", ".", "__init__", "(", "params", ",", "defaults", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__setstate__": [[46, 50], ["super().__setstate__", "group.setdefault"], "methods", ["home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.__setstate__"], ["", "def", "__setstate__", "(", "self", ",", "state", ")", ":", "\n", "        ", "super", "(", "AdamaxW", ",", "self", ")", ".", "__setstate__", "(", "state", ")", "\n", "for", "group", "in", "self", ".", "param_groups", ":", "\n", "            ", "group", ".", "setdefault", "(", "'amsgrad'", ",", "False", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.mt_dnn.optim.AdamaxW.step": [[51, 103], ["closure", "p.data.mul_", "exp_avg.mul_().add_", "torch.cat", "torch.max", "p.data.addcdiv_", "RuntimeError", "len", "torch.zeros_like", "torch.zeros_like", "exp_avg.mul_", "exp_inf.mul_().unsqueeze", "grad.abs().add_().unsqueeze_", "exp_inf.new().long", "exp_inf.mul_", "grad.abs().add_", "exp_inf.new", "grad.abs"], "methods", ["None"], ["", "", "def", "step", "(", "self", ",", "closure", "=", "None", ")", ":", "\n", "        ", "\"\"\"Performs a single optimization step.\n        Arguments:\n            closure (callable, optional): A closure that reevaluates the model\n                and returns the loss.\n        \"\"\"", "\n", "loss", "=", "None", "\n", "if", "closure", "is", "not", "None", ":", "\n", "            ", "loss", "=", "closure", "(", ")", "\n", "\n", "", "for", "group", "in", "self", ".", "param_groups", ":", "\n", "            ", "for", "p", "in", "group", "[", "'params'", "]", ":", "\n", "                ", "if", "p", ".", "grad", "is", "None", ":", "\n", "                    ", "continue", "\n", "\n", "# Perform stepweight decay", "\n", "", "p", ".", "data", ".", "mul_", "(", "1", "-", "group", "[", "'lr'", "]", "*", "group", "[", "'weight_decay'", "]", ")", "\n", "\n", "# Perform optimization step", "\n", "grad", "=", "p", ".", "grad", ".", "data", "\n", "if", "grad", ".", "is_sparse", ":", "\n", "                    ", "raise", "RuntimeError", "(", "'Adam does not support sparse gradients, please consider SparseAdam instead'", ")", "\n", "", "amsgrad", "=", "group", "[", "'amsgrad'", "]", "\n", "\n", "state", "=", "self", ".", "state", "[", "p", "]", "\n", "eps", "=", "group", "[", "'eps'", "]", "\n", "\n", "# State initialization", "\n", "if", "len", "(", "state", ")", "==", "0", ":", "\n", "                    ", "state", "[", "'step'", "]", "=", "0", "\n", "# Exponential moving average of gradient values", "\n", "state", "[", "'exp_avg'", "]", "=", "torch", ".", "zeros_like", "(", "p", ".", "data", ")", "\n", "# Exponential moving average of inf gradient values", "\n", "state", "[", "'exp_inf'", "]", "=", "torch", ".", "zeros_like", "(", "p", ".", "data", ")", "\n", "\n", "", "exp_avg", ",", "exp_inf", "=", "state", "[", "'exp_avg'", "]", ",", "state", "[", "'exp_inf'", "]", "\n", "beta1", ",", "beta2", "=", "group", "[", "'betas'", "]", "\n", "state", "[", "'step'", "]", "+=", "1", "\n", "# Decay the first and inf moment running average coefficient", "\n", "exp_avg", ".", "mul_", "(", "beta1", ")", ".", "add_", "(", "grad", ",", "alpha", "=", "1", "-", "beta1", ")", "\n", "\n", "norm_buf", "=", "torch", ".", "cat", "(", "[", "\n", "exp_inf", ".", "mul_", "(", "beta2", ")", ".", "unsqueeze", "(", "0", ")", ",", "\n", "grad", ".", "abs", "(", ")", ".", "add_", "(", "eps", ")", ".", "unsqueeze_", "(", "0", ")", "\n", "]", ",", "0", ")", "\n", "torch", ".", "max", "(", "norm_buf", ",", "0", ",", "keepdim", "=", "False", ",", "out", "=", "(", "exp_inf", ",", "exp_inf", ".", "new", "(", ")", ".", "long", "(", ")", ")", ")", "\n", "\n", "bias_correction", "=", "1", "-", "beta1", "**", "state", "[", "'step'", "]", "\n", "clr", "=", "group", "[", "'lr'", "]", "/", "bias_correction", "\n", "p", ".", "data", ".", "addcdiv_", "(", "exp_avg", ",", "exp_inf", ",", "value", "=", "-", "clr", ")", "\n", "\n", "", "", "return", "loss", "", "", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.tests._test_train.assert_file_equal": [[12, 16], ["open().read", "open().read", "open", "open"], "function", ["None"], ["def", "assert_file_equal", "(", "output_file", ",", "expected_file", ")", ":", "\n", "    ", "output", "=", "open", "(", "output_file", ")", ".", "read", "(", ")", "\n", "expected", "=", "open", "(", "expected_file", ")", ".", "read", "(", ")", "\n", "assert", "output", "==", "expected", ",", "\"file diff: %s != %s\"", "%", "(", "output_file", ",", "expected_file", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.tests._test_train.compare_output": [[17, 31], ["open().read", "open().read", "TRAIN_LOSS_RE.findall", "TRAIN_LOSS_RE.findall", "open().read", "open().read", "_test_train.assert_file_equal", "open", "open", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "open", "open", "os.path.join", "os.path.join"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.tests._test_train.assert_file_equal"], ["", "def", "compare_output", "(", "output_dir", ",", "expected_dir", ")", ":", "\n", "    ", "config", "=", "open", "(", "os", ".", "path", ".", "join", "(", "output_dir", ",", "\"config.json\"", ")", ")", ".", "read", "(", ")", "\n", "expected_config", "=", "open", "(", "os", ".", "path", ".", "join", "(", "expected_dir", ",", "\"config.json\"", ")", ")", ".", "read", "(", ")", "\n", "assert", "config", "==", "expected_config", ",", "\"Config diff\"", "\n", "\n", "train_loss", "=", "TRAIN_LOSS_RE", ".", "findall", "(", "open", "(", "os", ".", "path", ".", "join", "(", "output_dir", ",", "\"log.txt\"", ")", ")", ".", "read", "(", ")", ")", "\n", "expected_train_loss", "=", "TRAIN_LOSS_RE", ".", "findall", "(", "open", "(", "os", ".", "path", ".", "join", "(", "expected_dir", ",", "\"log.txt\"", ")", ")", ".", "read", "(", ")", ")", "\n", "assert", "train_loss", "==", "expected_train_loss", ",", "\"Train loss diff:\\n\\ttrain_loss is %s\\n\\texpected_train_loss is %s\\n\"", "%", "(", "\n", "train_loss", ",", "expected_train_loss", "\n", ")", "\n", "\n", "for", "file_name", "in", "(", "\"mnli_matched_dev_scores_0.json\"", ",", "\"mnli_matched_test_scores_0.json\"", ",", "\n", "\"mnli_mismatched_dev_scores_0.json\"", ",", "\"mnli_mismatched_test_scores_0.json\"", ")", ":", "\n", "        ", "assert_file_equal", "(", "os", ".", "path", ".", "join", "(", "output_dir", ",", "file_name", ")", ",", "os", ".", "path", ".", "join", "(", "expected_dir", ",", "file_name", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.tests._test_train.test_train": [[32, 45], ["os.access", "os.mkdir", "shutil.copytree", "os.mkdir", "subprocess.check_output", "_test_train.compare_output", "shutil.rmtree"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.tests._test_train.compare_output"], ["", "", "def", "test_train", "(", ")", ":", "\n", "    ", "OUTPUT_DIR", "=", "r\"run_test/checkpoint\"", "\n", "EXPECTED_DIR", "=", "r\"tests/sample_data/checkpoint\"", "\n", "\n", "if", "os", ".", "access", "(", "\"./run_test\"", ",", "os", ".", "F_OK", ")", ":", "\n", "        ", "shutil", ".", "rmtree", "(", "\"./run_test\"", ")", "\n", "", "os", ".", "mkdir", "(", "\"./run_test\"", ")", "\n", "shutil", ".", "copytree", "(", "\"./sample_data\"", ",", "\"./run_test/sample_data\"", ")", "\n", "os", ".", "mkdir", "(", "\"./run_test/checkpoint\"", ")", "\n", "subprocess", ".", "check_output", "(", "\"python train.py --epoch 1 --log_per_updates 1 --data_dir run_test/sample_data/output --output_dir %(OUTPUT_DIR)s 2>&1 > %(OUTPUT_DIR)s/log.txt\"", "\n", "%", "{", "\"OUTPUT_DIR\"", ":", "OUTPUT_DIR", "}", ",", "stderr", "=", "subprocess", ".", "STDOUT", ",", "shell", "=", "True", ")", "\n", "\n", "compare_output", "(", "OUTPUT_DIR", ",", "EXPECTED_DIR", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.namisan_mt-dnn.tests.test_prepro.compare_files": [[10, 24], ["os.path.join", "os.path.join", "os.path.join", "os.path.join", "open().read", "open().read", "same_files.append", "diff_files.append", "open", "open"], "function", ["None"], ["def", "compare_files", "(", "dir1", ",", "dir2", ",", "common_files", ",", "text_mode", "=", "False", ")", ":", "\n", "    ", "same_files", "=", "[", "]", "\n", "diff_files", "=", "[", "]", "\n", "for", "common_file", "in", "common_files", ":", "\n", "        ", "path0", "=", "os", ".", "path", ".", "join", "(", "dir1", ",", "common_file", ")", "\n", "path1", "=", "os", ".", "path", ".", "join", "(", "dir2", ",", "common_file", ")", "\n", "open_mode", "=", "\"r\"", "if", "text_mode", "else", "\"rb\"", "\n", "s0", "=", "open", "(", "path0", ",", "open_mode", ")", ".", "read", "(", ")", "\n", "s1", "=", "open", "(", "path1", ",", "open_mode", ")", ".", "read", "(", ")", "\n", "if", "s0", "==", "s1", ":", "\n", "            ", "same_files", ".", "append", "(", "common_file", ")", "\n", "", "else", ":", "\n", "            ", "diff_files", ".", "append", "(", "common_file", ")", "\n", "", "", "return", "same_files", ",", "diff_files", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.tests.test_prepro.are_dir_trees_equal": [[26, 53], ["filecmp.dircmp", "test_prepro.compare_files", "len", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "len", "len", "len", "test_prepro.are_dir_trees_equal"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.tests.test_prepro.compare_files", "home.repos.pwc.inspect_result.namisan_mt-dnn.tests.test_prepro.are_dir_trees_equal"], ["", "def", "are_dir_trees_equal", "(", "dir1", ",", "dir2", ")", ":", "\n", "    ", "\"\"\"\n    Compare two directories recursively. Files in each directory are\n    assumed to be equal if their names and contents are equal.\n\n    @param dir1: First directory path\n    @param dir2: Second directory path\n\n    @return: True if the directory trees are the same and\n        there were no errors while accessing the directories or files,\n        False otherwise.\n   \"\"\"", "\n", "\n", "dirs_cmp", "=", "filecmp", ".", "dircmp", "(", "dir1", ",", "dir2", ")", "\n", "\n", "if", "len", "(", "dirs_cmp", ".", "left_only", ")", ">", "0", "or", "len", "(", "dirs_cmp", ".", "right_only", ")", ">", "0", "or", "len", "(", "dirs_cmp", ".", "funny_files", ")", ">", "0", ":", "\n", "        ", "return", "False", "\n", "", "_", ",", "diff_files", "=", "compare_files", "(", "dir1", ",", "dir2", ",", "dirs_cmp", ".", "common_files", ",", "text_mode", "=", "True", ")", "\n", "if", "len", "(", "diff_files", ")", ">", "0", ":", "\n", "        ", "return", "False", "\n", "", "for", "common_dir", "in", "dirs_cmp", ".", "common_dirs", ":", "\n", "        ", "new_dir1", "=", "os", ".", "path", ".", "join", "(", "dir1", ",", "common_dir", ")", "\n", "new_dir2", "=", "os", ".", "path", ".", "join", "(", "dir2", ",", "common_dir", ")", "\n", "if", "not", "are_dir_trees_equal", "(", "new_dir1", ",", "new_dir2", ")", ":", "\n", "            ", "return", "False", "\n", "", "", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.namisan_mt-dnn.tests.test_prepro.test_prepro": [[54, 63], ["os.access", "os.access", "os.mkdir", "os.mkdir", "shutil.copytree", "subprocess.check_output", "subprocess.check_output", "test_prepro.are_dir_trees_equal", "shutil.rmtree"], "function", ["home.repos.pwc.inspect_result.namisan_mt-dnn.tests.test_prepro.are_dir_trees_equal"], ["", "def", "test_prepro", "(", ")", ":", "\n", "    ", "if", "os", ".", "access", "(", "\"./run_test\"", ",", "os", ".", "F_OK", ")", ":", "\n", "        ", "shutil", ".", "rmtree", "(", "\"./run_test\"", ")", "\n", "", "os", ".", "mkdir", "(", "\"./run_test\"", ")", "\n", "shutil", ".", "copytree", "(", "\"./tests/sample_data/input\"", ",", "\"./run_test/sample_data\"", ")", "\n", "\n", "result", "=", "subprocess", ".", "check_output", "(", "\"python experiments/glue/glue_prepro.py --root_dir run_test/sample_data\"", ",", "stderr", "=", "subprocess", ".", "STDOUT", ",", "shell", "=", "True", ")", "\n", "result", "=", "subprocess", ".", "check_output", "(", "\"python prepro_std.py --model bert-base-uncased --root_dir run_test/sample_data/canonical_data --task_def experiments/glue/glue_task_def.yml\"", ",", "stderr", "=", "subprocess", ".", "STDOUT", ",", "shell", "=", "True", ")", "\n", "assert", "are_dir_trees_equal", "(", "\"./run_test/sample_data/canonical_data/bert-base-uncased\"", ",", "\"./tests/sample_data/output\"", ")", "\n", "\n"]]}