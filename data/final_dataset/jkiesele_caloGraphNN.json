{"home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.tensorflow_models.get_GravNet_model_for_clustering": [[6, 27], ["range", "tf.concat", "caloGraphNN.high_dim_dense", "caloGraphNN.high_dim_dense", "caloGraphNN.layer_global_exchange", "caloGraphNN.high_dim_dense", "caloGraphNN.high_dim_dense", "caloGraphNN.high_dim_dense", "caloGraphNN.layer_GravNet", "tf.layers.batch_normalization", "feats.append"], "function", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.high_dim_dense", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.high_dim_dense", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.layer_global_exchange", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.high_dim_dense", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.high_dim_dense", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.high_dim_dense", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.layer_GravNet"], ["def", "get_GravNet_model_for_clustering", "(", "input", ",", "training", ",", "momentum", ")", ":", "\n", "    ", "feats", "=", "[", "]", "\n", "x", "=", "input", "\n", "for", "i", "in", "range", "(", "4", ")", ":", "\n", "        ", "x", "=", "layer_global_exchange", "(", "x", ")", "\n", "x", "=", "high_dim_dense", "(", "x", ",", "64", ",", "activation", "=", "tf", ".", "nn", ".", "tanh", ")", "\n", "x", "=", "high_dim_dense", "(", "x", ",", "64", ",", "activation", "=", "tf", ".", "nn", ".", "tanh", ")", "\n", "x", "=", "high_dim_dense", "(", "x", ",", "64", ",", "activation", "=", "tf", ".", "nn", ".", "tanh", ")", "\n", "\n", "x", "=", "layer_GravNet", "(", "x", ",", "\n", "n_neighbours", "=", "40", ",", "\n", "n_dimensions", "=", "4", ",", "\n", "n_filters", "=", "42", ",", "\n", "n_propagate", "=", "18", ")", "\n", "x", "=", "tf", ".", "layers", ".", "batch_normalization", "(", "x", ",", "momentum", "=", "momentum", ",", "training", "=", "training", ")", "\n", "feats", ".", "append", "(", "x", ")", "\n", "\n", "", "x", "=", "tf", ".", "concat", "(", "feats", ",", "axis", "=", "-", "1", ")", "\n", "x", "=", "high_dim_dense", "(", "x", ",", "128", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ")", "\n", "x", "=", "high_dim_dense", "(", "x", ",", "3", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ")", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.tensorflow_models.get_GarNet_model_for_clustering": [[28, 52], ["caloGraphNN.layer_global_exchange", "tf.layers.batch_normalization", "caloGraphNN.high_dim_dense", "range", "tf.concat", "tf.layers.dense", "tf.layers.dense", "len", "caloGraphNN.layer_GarNet", "tf.layers.batch_normalization", "feat_list.append"], "function", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.layer_global_exchange", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.high_dim_dense", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.layer_GarNet"], ["", "def", "get_GarNet_model_for_clustering", "(", "input", ",", "training", ",", "momentum", ")", ":", "\n", "    ", "aggregators", "=", "11", "*", "[", "4", "]", "\n", "filters", "=", "11", "*", "[", "32", "]", "\n", "propagate", "=", "11", "*", "[", "20", "]", "\n", "\n", "feat", "=", "layer_global_exchange", "(", "input", ")", "\n", "feat", "=", "tf", ".", "layers", ".", "batch_normalization", "(", "feat", ",", "training", "=", "training", ",", "momentum", "=", "momentum", ")", "\n", "feat", "=", "high_dim_dense", "(", "feat", ",", "32", ",", "activation", "=", "tf", ".", "nn", ".", "tanh", ")", "\n", "feat_list", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "filters", ")", ")", ":", "\n", "        ", "feat", "=", "layer_GarNet", "(", "feat", ",", "\n", "aggregators", "[", "i", "]", ",", "\n", "n_filters", "=", "filters", "[", "i", "]", ",", "\n", "n_propagate", "=", "propagate", "[", "i", "]", "\n", ")", "\n", "feat", "=", "tf", ".", "layers", ".", "batch_normalization", "(", "feat", ",", "training", "=", "training", ",", "momentum", "=", "momentum", ")", "\n", "feat_list", ".", "append", "(", "feat", ")", "\n", "# feat = tf.layers.dropout(feat, rate=0.0005, training=self.is_train)", "\n", "\n", "", "feat", "=", "tf", ".", "concat", "(", "feat_list", ",", "axis", "=", "-", "1", ")", "\n", "feat", "=", "tf", ".", "layers", ".", "dense", "(", "feat", ",", "48", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ")", "\n", "feat", "=", "tf", ".", "layers", ".", "dense", "(", "feat", ",", "3", ",", "activation", "=", "tf", ".", "nn", ".", "relu", ")", "\n", "\n", "return", "feat", "\n", "", ""]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.gauss": [[6, 8], ["tensorflow.exp"], "function", ["None"], ["def", "gauss", "(", "x", ")", ":", "\n", "    ", "return", "tf", ".", "exp", "(", "-", "1", "*", "x", "*", "x", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.gauss_of_lin": [[9, 11], ["tensorflow.exp", "tensorflow.abs"], "function", ["None"], ["", "def", "gauss_of_lin", "(", "x", ")", ":", "\n", "    ", "return", "tf", ".", "exp", "(", "-", "1", "*", "(", "tf", ".", "abs", "(", "x", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.euclidean_squared": [[12, 36], ["A.get_shape().as_list", "B.get_shape().as_list", "tensorflow.expand_dims", "tensorflow.expand_dims", "tensorflow.abs", "tensorflow.matmul", "tensorflow.reduce_sum", "tensorflow.reduce_sum", "A.get_shape", "B.get_shape", "len", "len", "tensorflow.transpose"], "function", ["None"], ["", "def", "euclidean_squared", "(", "A", ",", "B", ")", ":", "\n", "    ", "\"\"\"\n    Returns euclidean distance between two batches of shape [B,N,F] and [B,M,F] where B is batch size, N is number of\n    examples in the batch of first set, M is number of examples in the batch of second set, F is number of spatial\n    features.\n\n    Returns:\n    A matrix of size [B, N, M] where each element [i,j] denotes euclidean distance between ith entry in first set and\n    jth in second set.\n\n    \"\"\"", "\n", "\n", "shape_A", "=", "A", ".", "get_shape", "(", ")", ".", "as_list", "(", ")", "\n", "shape_B", "=", "B", ".", "get_shape", "(", ")", ".", "as_list", "(", ")", "\n", "\n", "assert", "(", "A", ".", "dtype", "==", "tf", ".", "float32", "or", "A", ".", "dtype", "==", "tf", ".", "float64", ")", "and", "(", "B", ".", "dtype", "==", "tf", ".", "float32", "or", "B", ".", "dtype", "==", "tf", ".", "float64", ")", "\n", "assert", "len", "(", "shape_A", ")", "==", "3", "and", "len", "(", "shape_B", ")", "==", "3", "\n", "assert", "shape_A", "[", "0", "]", "==", "shape_B", "[", "0", "]", "# and shape_A[1] == shape_B[1]", "\n", "\n", "# Finds euclidean distance using property (a-b)^2 = a^2 + b^2 - 2ab", "\n", "sub_factor", "=", "-", "2", "*", "tf", ".", "matmul", "(", "A", ",", "tf", ".", "transpose", "(", "B", ",", "perm", "=", "[", "0", ",", "2", ",", "1", "]", ")", ")", "# -2ab term", "\n", "dotA", "=", "tf", ".", "expand_dims", "(", "tf", ".", "reduce_sum", "(", "A", "*", "A", ",", "axis", "=", "2", ")", ",", "axis", "=", "2", ")", "# a^2 term", "\n", "dotB", "=", "tf", ".", "expand_dims", "(", "tf", ".", "reduce_sum", "(", "B", "*", "B", ",", "axis", "=", "2", ")", ",", "axis", "=", "1", ")", "# b^2 term", "\n", "return", "tf", ".", "abs", "(", "sub_factor", "+", "dotA", "+", "dotB", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.nearest_neighbor_matrix": [[38, 56], ["spatial_features.get_shape().as_list", "caloGraphNN.euclidean_squared", "tensorflow.nn.top_k", "len", "spatial_features.get_shape"], "function", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.euclidean_squared"], ["", "def", "nearest_neighbor_matrix", "(", "spatial_features", ",", "k", "=", "10", ")", ":", "\n", "    ", "\"\"\"\n    Nearest neighbors matrix given spatial features.\n\n    :param spatial_features: Spatial features of shape [B, N, S] where B = batch size, N = max examples in batch,\n                             S = spatial features\n    :param k: Max neighbors\n    :return:\n    \"\"\"", "\n", "\n", "shape", "=", "spatial_features", ".", "get_shape", "(", ")", ".", "as_list", "(", ")", "\n", "\n", "assert", "spatial_features", ".", "dtype", "==", "tf", ".", "float32", "or", "spatial_features", ".", "dtype", "==", "tf", ".", "float64", "\n", "assert", "len", "(", "shape", ")", "==", "3", "\n", "\n", "D", "=", "euclidean_squared", "(", "spatial_features", ",", "spatial_features", ")", "\n", "D", ",", "N", "=", "tf", ".", "nn", ".", "top_k", "(", "-", "D", ",", "k", ")", "\n", "return", "N", ",", "-", "D", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.indexing_tensor": [[60, 82], ["spatial_features.get_shape().as_list", "caloGraphNN.nearest_neighbor_matrix", "tensorflow.expand_dims", "tensorflow.tile", "tensorflow.expand_dims", "tensorflow.concat", "len", "tensorflow.expand_dims", "tensorflow.cast", "spatial_features.get_shape", "tensorflow.expand_dims", "tensorflow.range"], "function", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.nearest_neighbor_matrix"], ["", "def", "indexing_tensor", "(", "spatial_features", ",", "k", "=", "10", ",", "n_batch", "=", "-", "1", ")", ":", "\n", "\n", "    ", "shape_spatial_features", "=", "spatial_features", ".", "get_shape", "(", ")", ".", "as_list", "(", ")", "\n", "n_batch", "=", "shape_spatial_features", "[", "0", "]", "\n", "n_max_entries", "=", "shape_spatial_features", "[", "1", "]", "\n", "\n", "# All of these tensors should be 3-dimensional", "\n", "assert", "len", "(", "shape_spatial_features", ")", "==", "3", "\n", "\n", "# Neighbor matrix should be int as it should be used for indexing", "\n", "assert", "spatial_features", ".", "dtype", "==", "tf", ".", "float64", "or", "spatial_features", ".", "dtype", "==", "tf", ".", "float32", "\n", "\n", "neighbor_matrix", ",", "distance_matrix", "=", "nearest_neighbor_matrix", "(", "spatial_features", ",", "k", ")", "\n", "\n", "batch_range", "=", "tf", ".", "expand_dims", "(", "tf", ".", "expand_dims", "(", "tf", ".", "expand_dims", "(", "tf", ".", "range", "(", "0", ",", "n_batch", ")", ",", "axis", "=", "1", ")", ",", "axis", "=", "1", ")", ",", "axis", "=", "1", ")", "\n", "batch_range", "=", "tf", ".", "tile", "(", "batch_range", ",", "[", "1", ",", "n_max_entries", ",", "k", ",", "1", "]", ")", "\n", "expanded_neighbor_matrix", "=", "tf", ".", "expand_dims", "(", "neighbor_matrix", ",", "axis", "=", "3", ")", "\n", "\n", "\n", "indexing_tensor", "=", "tf", ".", "concat", "(", "[", "batch_range", ",", "expanded_neighbor_matrix", "]", ",", "axis", "=", "3", ")", "\n", "\n", "return", "tf", ".", "cast", "(", "indexing_tensor", ",", "tf", ".", "int64", ")", ",", "distance_matrix", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.high_dim_dense": [[87, 99], ["len", "tensorflow.layers.conv1d", "len", "tensorflow.layers.conv2d", "len", "tensorflow.layers.conv3d"], "function", ["None"], ["", "def", "high_dim_dense", "(", "inputs", ",", "nodes", ",", "**", "kwargs", ")", ":", "\n", "    ", "if", "len", "(", "inputs", ".", "shape", ")", "==", "3", ":", "\n", "        ", "return", "tf", ".", "layers", ".", "conv1d", "(", "inputs", ",", "nodes", ",", "kernel_size", "=", "(", "1", ")", ",", "strides", "=", "(", "1", ")", ",", "padding", "=", "'valid'", ",", "\n", "**", "kwargs", ")", "\n", "\n", "", "if", "len", "(", "inputs", ".", "shape", ")", "==", "4", ":", "\n", "        ", "return", "tf", ".", "layers", ".", "conv2d", "(", "inputs", ",", "nodes", ",", "kernel_size", "=", "(", "1", ",", "1", ")", ",", "strides", "=", "(", "1", ",", "1", ")", ",", "padding", "=", "'valid'", ",", "\n", "**", "kwargs", ")", "\n", "\n", "", "if", "len", "(", "inputs", ".", "shape", ")", "==", "5", ":", "\n", "        ", "return", "tf", ".", "layers", ".", "conv3d", "(", "inputs", ",", "nodes", ",", "kernel_size", "=", "(", "1", ",", "1", ",", "1", ")", ",", "strides", "=", "(", "1", ",", "1", ",", "1", ")", ",", "padding", "=", "'valid'", ",", "\n", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.apply_edges": [[103, 122], ["tensorflow.expand_dims", "tensorflow.expand_dims", "tensorflow.expand_dims", "aggregation_function", "tensorflow.reshape"], "function", ["None"], ["", "", "def", "apply_edges", "(", "vertices", ",", "edges", ",", "reduce_sum", "=", "True", ",", "flatten", "=", "True", ",", "expand_first_vertex_dim", "=", "True", ",", "aggregation_function", "=", "tf", ".", "reduce_max", ")", ":", "\n", "    ", "'''\n    edges are naturally BxVxV'xF\n    vertices are BxVxF'  or BxV'xF'\n    This function returns BxVxF'' if flattened and summed\n    '''", "\n", "edges", "=", "tf", ".", "expand_dims", "(", "edges", ",", "axis", "=", "3", ")", "\n", "if", "expand_first_vertex_dim", ":", "\n", "        ", "vertices", "=", "tf", ".", "expand_dims", "(", "vertices", ",", "axis", "=", "1", ")", "\n", "", "vertices", "=", "tf", ".", "expand_dims", "(", "vertices", ",", "axis", "=", "4", ")", "\n", "\n", "out", "=", "edges", "*", "vertices", "# [BxVxV'x1xF] x [Bx1xV'xF'x1] = [BxVxV'xFxF']", "\n", "\n", "if", "reduce_sum", ":", "\n", "        ", "out", "=", "aggregation_function", "(", "out", ",", "axis", "=", "2", ")", "\n", "", "if", "flatten", ":", "\n", "        ", "out", "=", "tf", ".", "reshape", "(", "out", ",", "shape", "=", "[", "out", ".", "shape", "[", "0", "]", ",", "out", ".", "shape", "[", "1", "]", ",", "-", "1", "]", ")", "\n", "\n", "", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.layer_GarNet": [[139, 171], ["tensorflow.layers.dense", "tensorflow.layers.dense", "caloGraphNN.gauss", "tensorflow.concat", "tensorflow.expand_dims", "tensorflow.transpose", "caloGraphNN.apply_edges", "caloGraphNN.apply_edges", "tensorflow.concat", "tensorflow.transpose", "caloGraphNN.apply_edges", "tensorflow.concat", "caloGraphNN.high_dim_dense"], "function", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.gauss", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.apply_edges", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.apply_edges", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.apply_edges", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.high_dim_dense"], ["", "def", "layer_GarNet", "(", "vertices_in", ",", "\n", "n_aggregators", ",", "\n", "n_filters", ",", "\n", "n_propagate", ",", "\n", "plus_mean", "=", "True", "\n", ")", ":", "\n", "\n", "    ", "vertices_in_orig", "=", "vertices_in", "\n", "vertices_in", "=", "tf", ".", "layers", ".", "dense", "(", "vertices_in", ",", "n_propagate", ",", "activation", "=", "None", ")", "\n", "\n", "agg_nodes", "=", "tf", ".", "layers", ".", "dense", "(", "vertices_in_orig", ",", "n_aggregators", ",", "activation", "=", "None", ")", "#BxVxNA, vertices_in: BxVxF", "\n", "agg_nodes", "=", "gauss", "(", "agg_nodes", ")", "\n", "vertices_in", "=", "tf", ".", "concat", "(", "[", "vertices_in", ",", "agg_nodes", "]", ",", "axis", "=", "-", "1", ")", "\n", "\n", "edges", "=", "tf", ".", "expand_dims", "(", "agg_nodes", ",", "axis", "=", "3", ")", "# BxVxNAx1", "\n", "edges", "=", "tf", ".", "transpose", "(", "edges", ",", "perm", "=", "[", "0", ",", "2", ",", "1", ",", "3", "]", ")", "# [BxVxV'xF]", "\n", "\n", "\n", "vertices_in_collapsed", "=", "apply_edges", "(", "vertices_in", ",", "edges", ",", "reduce_sum", "=", "True", ",", "flatten", "=", "True", ")", "#,aggregation_function=tf.reduce_mean)# [BxNAxF]", "\n", "vertices_in_mean_collapsed", "=", "apply_edges", "(", "vertices_in", ",", "edges", ",", "reduce_sum", "=", "True", ",", "flatten", "=", "True", ",", "aggregation_function", "=", "tf", ".", "reduce_mean", ")", "# [BxNAxF]", "\n", "\n", "vertices_in_collapsed", "=", "tf", ".", "concat", "(", "[", "vertices_in_collapsed", ",", "vertices_in_mean_collapsed", "]", ",", "axis", "=", "-", "1", ")", "\n", "\n", "edges", "=", "tf", ".", "transpose", "(", "edges", ",", "perm", "=", "[", "0", ",", "2", ",", "1", ",", "3", "]", ")", "# [BxVxV'xF]", "\n", "\n", "expanded_collapsed", "=", "apply_edges", "(", "vertices_in_collapsed", ",", "edges", ",", "reduce_sum", "=", "False", ",", "flatten", "=", "True", ")", "# [BxVxF]", "\n", "\n", "expanded_collapsed", "=", "tf", ".", "concat", "(", "[", "vertices_in_orig", ",", "expanded_collapsed", ",", "agg_nodes", "]", ",", "axis", "=", "-", "1", ")", "\n", "\n", "merged_out", "=", "high_dim_dense", "(", "expanded_collapsed", ",", "n_filters", ",", "activation", "=", "tf", ".", "nn", ".", "tanh", ")", "\n", "\n", "return", "merged_out", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.layer_GravNet": [[173, 201], ["caloGraphNN.high_dim_dense", "caloGraphNN.high_dim_dense", "caloGraphNN.indexing_tensor", "caloGraphNN.layer_GravNet.collapse_to_vertex"], "function", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.high_dim_dense", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.high_dim_dense", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.indexing_tensor"], ["", "def", "layer_GravNet", "(", "vertices_in", ",", "\n", "n_neighbours", ",", "\n", "n_dimensions", ",", "\n", "n_filters", ",", "\n", "n_propagate", ")", ":", "\n", "\n", "\n", "\n", "    ", "vertices_prop", "=", "high_dim_dense", "(", "vertices_in", ",", "n_propagate", ",", "activation", "=", "None", ")", "\n", "neighb_dimensions", "=", "high_dim_dense", "(", "vertices_in", ",", "n_dimensions", ",", "activation", "=", "None", ")", "#BxVxND, ", "\n", "\n", "def", "collapse_to_vertex", "(", "indexing", ",", "distance", ",", "vertices", ")", ":", "\n", "        ", "neighbours", "=", "tf", ".", "gather_nd", "(", "vertices", ",", "indexing", ")", "#BxVxNxF", "\n", "distance", "=", "tf", ".", "expand_dims", "(", "distance", ",", "axis", "=", "3", ")", "\n", "distance", "=", "distance", "*", "10.", "# input is tanh activated or batch normed, allow for some more spread", "\n", "edges", "=", "gauss_of_lin", "(", "distance", ")", "[", ":", ",", ":", ",", "1", ":", ",", ":", "]", "\n", "neighbours", "=", "neighbours", "[", ":", ",", ":", ",", "1", ":", ",", ":", "]", "\n", "scaled_feat", "=", "edges", "*", "neighbours", "\n", "collapsed", "=", "tf", ".", "reduce_max", "(", "scaled_feat", ",", "axis", "=", "2", ")", "\n", "collapsed_mean", "=", "tf", ".", "reduce_mean", "(", "scaled_feat", ",", "axis", "=", "2", ")", "\n", "collapsed", "=", "tf", ".", "concat", "(", "[", "collapsed", ",", "collapsed_mean", "]", ",", "axis", "=", "-", "1", ")", "\n", "return", "collapsed", "\n", "\n", "", "indexing", ",", "distance", "=", "indexing_tensor", "(", "neighb_dimensions", ",", "n_neighbours", ")", "\n", "collapsed", "=", "collapse_to_vertex", "(", "indexing", ",", "distance", ",", "vertices_prop", ")", "\n", "updated_vertices", "=", "tf", ".", "concat", "(", "[", "vertices_in", ",", "collapsed", "]", ",", "axis", "=", "-", "1", ")", "\n", "\n", "return", "high_dim_dense", "(", "updated_vertices", ",", "n_filters", ",", "activation", "=", "tf", ".", "nn", ".", "tanh", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.layer_global_exchange": [[203, 212], ["tensorflow.reduce_mean", "tensorflow.tile", "tensorflow.concat"], "function", ["None"], ["", "def", "layer_global_exchange", "(", "vertices_in", ")", ":", "\n", "    ", "trans_vertices_in", "=", "vertices_in", "\n", "\n", "global_summed", "=", "tf", ".", "reduce_mean", "(", "trans_vertices_in", ",", "axis", "=", "1", ",", "keepdims", "=", "True", ")", "\n", "\n", "global_summed", "=", "tf", ".", "tile", "(", "global_summed", ",", "[", "1", ",", "vertices_in", ".", "shape", "[", "1", "]", ",", "1", "]", ")", "\n", "vertices_out", "=", "tf", ".", "concat", "(", "[", "vertices_in", ",", "global_summed", "]", ",", "axis", "=", "-", "1", ")", "\n", "\n", "return", "vertices_out", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.NamedDense.add_weight": [[23, 25], ["super().add_weight"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.NamedDense.add_weight"], ["    ", "def", "add_weight", "(", "self", ",", "name", "=", "None", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "super", "(", "NamedDense", ",", "self", ")", ".", "add_weight", "(", "name", "=", "'%s_%s'", "%", "(", "self", ".", "name", ",", "name", ")", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.CreateZeroMask.__init__": [[31, 35], ["super().__init__"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.__init__"], ["def", "__init__", "(", "self", ",", "idx", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "CreateZeroMask", ",", "self", ")", ".", "__init__", "(", "**", "kwargs", ")", "\n", "\n", "self", ".", "idx", "=", "idx", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.CreateZeroMask.compute_output_shape": [[36, 38], ["None"], "methods", ["None"], ["", "def", "compute_output_shape", "(", "self", ",", "input_shape", ")", ":", "\n", "        ", "return", "(", "input_shape", "[", "0", "]", ",", "input_shape", "[", "1", "]", ",", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.CreateZeroMask.call": [[39, 42], ["K.cast", "K.not_equal"], "methods", ["None"], ["", "def", "call", "(", "self", ",", "inputs", ")", ":", "\n", "        ", "mask", "=", "K", ".", "cast", "(", "K", ".", "not_equal", "(", "inputs", "[", "...", ",", "self", ".", "idx", ":", "self", ".", "idx", "+", "1", "]", ",", "0.", ")", ",", "'float32'", ")", "\n", "return", "mask", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GlobalExchange.__init__": [[45, 49], ["super().__init__"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.__init__"], ["    ", "def", "__init__", "(", "self", ",", "vertex_mask", "=", "None", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "GlobalExchange", ",", "self", ")", ".", "__init__", "(", "**", "kwargs", ")", "\n", "\n", "self", ".", "vertex_mask", "=", "vertex_mask", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GlobalExchange.build": [[50, 54], ["super().build"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.build"], ["", "def", "build", "(", "self", ",", "input_shape", ")", ":", "\n", "# tf.ragged FIXME?", "\n", "        ", "self", ".", "num_vertices", "=", "input_shape", "[", "1", "]", "\n", "super", "(", "GlobalExchange", ",", "self", ")", ".", "build", "(", "input_shape", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GlobalExchange.call": [[55, 64], ["K.mean", "K.tile", "K.concatenate"], "methods", ["None"], ["", "def", "call", "(", "self", ",", "x", ")", ":", "\n", "        ", "mean", "=", "K", ".", "mean", "(", "x", ",", "axis", "=", "1", ",", "keepdims", "=", "True", ")", "\n", "# tf.ragged FIXME?", "\n", "# maybe just use tf.shape(x)[1] instead?", "\n", "mean", "=", "K", ".", "tile", "(", "mean", ",", "[", "1", ",", "self", ".", "num_vertices", ",", "1", "]", ")", "\n", "if", "self", ".", "vertex_mask", "is", "not", "None", ":", "\n", "            ", "mean", "=", "self", ".", "vertex_mask", "*", "mean", "\n", "\n", "", "return", "K", ".", "concatenate", "(", "[", "x", ",", "mean", "]", ",", "axis", "=", "-", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GlobalExchange.compute_output_shape": [[65, 67], ["None"], "methods", ["None"], ["", "def", "compute_output_shape", "(", "self", ",", "input_shape", ")", ":", "\n", "        ", "return", "input_shape", "[", ":", "2", "]", "+", "(", "input_shape", "[", "2", "]", "*", "2", ",", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GravNet.__init__": [[70, 97], ["keras.initializers.Orthogonal", "super().__init__", "caloGraphNN_keras.NamedDense", "caloGraphNN_keras.NamedDense", "caloGraphNN_keras.NamedDense"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.__init__"], ["    ", "def", "__init__", "(", "self", ",", "n_neighbours", ",", "n_dimensions", ",", "n_filters", ",", "n_propagate", ",", "name", ",", "\n", "also_coordinates", "=", "False", ",", "feature_dropout", "=", "-", "1", ",", "\n", "coordinate_kernel_initializer", "=", "keras", ".", "initializers", ".", "Orthogonal", "(", ")", ",", "\n", "other_kernel_initializer", "=", "'glorot_uniform'", ",", "\n", "fix_coordinate_space", "=", "False", ",", "\n", "coordinate_activation", "=", "None", ",", "\n", "masked_coordinate_offset", "=", "None", ",", "\n", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "GravNet", ",", "self", ")", ".", "__init__", "(", "**", "kwargs", ")", "\n", "\n", "self", ".", "n_neighbours", "=", "n_neighbours", "\n", "self", ".", "n_dimensions", "=", "n_dimensions", "\n", "self", ".", "n_filters", "=", "n_filters", "\n", "self", ".", "n_propagate", "=", "n_propagate", "\n", "self", ".", "name", "=", "name", "\n", "self", ".", "also_coordinates", "=", "also_coordinates", "\n", "self", ".", "feature_dropout", "=", "feature_dropout", "\n", "self", ".", "masked_coordinate_offset", "=", "masked_coordinate_offset", "\n", "\n", "self", ".", "input_feature_transform", "=", "NamedDense", "(", "n_propagate", ",", "name", "=", "name", "+", "'_FLR'", ",", "kernel_initializer", "=", "other_kernel_initializer", ")", "\n", "self", ".", "input_spatial_transform", "=", "NamedDense", "(", "n_dimensions", ",", "name", "=", "name", "+", "'_S'", ",", "kernel_initializer", "=", "coordinate_kernel_initializer", ",", "activation", "=", "coordinate_activation", ")", "\n", "self", ".", "output_feature_transform", "=", "NamedDense", "(", "n_filters", ",", "activation", "=", "'tanh'", ",", "name", "=", "name", "+", "'_Fout'", ",", "kernel_initializer", "=", "other_kernel_initializer", ")", "\n", "\n", "self", ".", "_sublayers", "=", "[", "self", ".", "input_feature_transform", ",", "self", ".", "input_spatial_transform", ",", "self", ".", "output_feature_transform", "]", "\n", "if", "fix_coordinate_space", ":", "\n", "            ", "self", ".", "input_spatial_transform", "=", "None", "\n", "self", ".", "_sublayers", "=", "[", "self", ".", "input_feature_transform", ",", "self", ".", "output_feature_transform", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GravNet.build": [[98, 114], ["caloGraphNN_keras.GravNet.input_feature_transform.build", "caloGraphNN_keras.GravNet.output_feature_transform.build", "super().build", "caloGraphNN_keras.GravNet.input_spatial_transform.build", "caloGraphNN_keras.GravNet._trainable_weights.extend", "caloGraphNN_keras.GravNet._non_trainable_weights.extend"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.build", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.build", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.build", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.build"], ["", "", "def", "build", "(", "self", ",", "input_shape", ")", ":", "\n", "        ", "if", "self", ".", "masked_coordinate_offset", "is", "not", "None", ":", "\n", "            ", "input_shape", "=", "input_shape", "[", "0", "]", "\n", "\n", "", "self", ".", "input_feature_transform", ".", "build", "(", "input_shape", ")", "\n", "if", "self", ".", "input_spatial_transform", "is", "not", "None", ":", "\n", "            ", "self", ".", "input_spatial_transform", ".", "build", "(", "input_shape", ")", "\n", "\n", "# tf.ragged FIXME?", "\n", "", "self", ".", "output_feature_transform", ".", "build", "(", "(", "input_shape", "[", "0", "]", ",", "input_shape", "[", "1", "]", ",", "input_shape", "[", "2", "]", "+", "self", ".", "input_feature_transform", ".", "units", "*", "2", ")", ")", "\n", "\n", "for", "layer", "in", "self", ".", "_sublayers", ":", "\n", "            ", "self", ".", "_trainable_weights", ".", "extend", "(", "layer", ".", "trainable_weights", ")", "\n", "self", ".", "_non_trainable_weights", ".", "extend", "(", "layer", ".", "non_trainable_weights", ")", "\n", "\n", "", "super", "(", "GravNet", ",", "self", ")", ".", "build", "(", "input_shape", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GravNet.call": [[115, 148], ["caloGraphNN_keras.GravNet.input_feature_transform", "caloGraphNN_keras.GravNet.collect_neighbours", "K.concatenate", "caloGraphNN_keras.GravNet.output_feature_transform", "caloGraphNN_keras.GravNet.input_spatial_transform", "K.tile", "K.switch", "isinstance", "Exception", "keras.layers.Dropout", "K.greater", "K.zeros_like", "K.shape"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GravNet.collect_neighbours"], ["", "def", "call", "(", "self", ",", "x", ")", ":", "\n", "\n", "        ", "if", "self", ".", "masked_coordinate_offset", "is", "not", "None", ":", "\n", "            ", "if", "not", "isinstance", "(", "x", ",", "list", ")", ":", "\n", "                ", "raise", "Exception", "(", "'GravNet: in mask mode, input must be list of input,mask'", ")", "\n", "", "mask", "=", "x", "[", "1", "]", "\n", "x", "=", "x", "[", "0", "]", "\n", "\n", "", "features", "=", "self", ".", "input_feature_transform", "(", "x", ")", "\n", "\n", "if", "self", ".", "feature_dropout", ">", "0", "and", "self", ".", "feature_dropout", "<", "1", ":", "\n", "            ", "features", "=", "keras", ".", "layers", ".", "Dropout", "(", "self", ".", "feature_dropout", ")", "(", "features", ")", "\n", "\n", "", "if", "self", ".", "input_spatial_transform", "is", "not", "None", ":", "\n", "            ", "coordinates", "=", "self", ".", "input_spatial_transform", "(", "x", ")", "\n", "", "else", ":", "\n", "            ", "coordinates", "=", "x", "[", ":", ",", ":", ",", "0", ":", "self", ".", "n_dimensions", "]", "\n", "\n", "", "if", "self", ".", "masked_coordinate_offset", "is", "not", "None", ":", "\n", "            ", "sel_mask", "=", "K", ".", "tile", "(", "mask", ",", "[", "1", ",", "1", ",", "K", ".", "shape", "(", "coordinates", ")", "[", "2", "]", "]", ")", "\n", "coordinates", "=", "K", ".", "switch", "(", "K", ".", "greater", "(", "sel_mask", ",", "0.", ")", ",", "coordinates", ",", "K", ".", "zeros_like", "(", "coordinates", ")", "-", "self", ".", "masked_coordinate_offset", ")", "\n", "\n", "", "collected_neighbours", "=", "self", ".", "collect_neighbours", "(", "coordinates", ",", "features", ")", "\n", "\n", "updated_features", "=", "K", ".", "concatenate", "(", "[", "x", ",", "collected_neighbours", "]", ",", "axis", "=", "-", "1", ")", "\n", "output", "=", "self", ".", "output_feature_transform", "(", "updated_features", ")", "\n", "\n", "if", "self", ".", "masked_coordinate_offset", "is", "not", "None", ":", "\n", "            ", "output", "*=", "mask", "\n", "\n", "", "if", "self", ".", "also_coordinates", ":", "\n", "            ", "return", "[", "output", ",", "coordinates", "]", "\n", "", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GravNet.compute_output_shape": [[149, 158], ["None"], "methods", ["None"], ["", "def", "compute_output_shape", "(", "self", ",", "input_shape", ")", ":", "\n", "        ", "if", "self", ".", "masked_coordinate_offset", "is", "not", "None", ":", "\n", "            ", "input_shape", "=", "input_shape", "[", "0", "]", "\n", "", "if", "self", ".", "also_coordinates", ":", "\n", "            ", "return", "[", "(", "input_shape", "[", "0", "]", ",", "input_shape", "[", "1", "]", ",", "self", ".", "output_feature_transform", ".", "units", ")", ",", "\n", "(", "input_shape", "[", "0", "]", ",", "input_shape", "[", "1", "]", ",", "self", ".", "n_dimensions", ")", "]", "\n", "\n", "# tf.ragged FIXME? tf.shape() might do the trick already", "\n", "", "return", "(", "input_shape", "[", "0", "]", ",", "input_shape", "[", "1", "]", ",", "self", ".", "output_feature_transform", ".", "units", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GravNet.collect_neighbours": [[159, 201], ["euclidean_squared", "tf.nn.top_k", "K.arange", "K.expand_dims", "K.expand_dims", "K.expand_dims", "K.tile", "K.expand_dims", "K.concatenate", "tf.gather_nd", "gauss_of_lin", "K.expand_dims", "K.max", "K.mean", "K.concatenate", "tf.shape", "K.shape", "K.shape"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.euclidean_squared", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN.gauss_of_lin"], ["", "def", "collect_neighbours", "(", "self", ",", "coordinates", ",", "features", ")", ":", "\n", "        ", "import", "tensorflow", "as", "tf", "\n", "from", "caloGraphNN", "import", "euclidean_squared", ",", "gauss_of_lin", "\n", "\n", "# tf.ragged FIXME?", "\n", "# for euclidean_squared see caloGraphNN.py", "\n", "distance_matrix", "=", "euclidean_squared", "(", "coordinates", ",", "coordinates", ")", "\n", "\n", "ranked_distances", ",", "ranked_indices", "=", "tf", ".", "nn", ".", "top_k", "(", "-", "distance_matrix", ",", "self", ".", "n_neighbours", ")", "\n", "\n", "neighbour_indices", "=", "ranked_indices", "[", ":", ",", ":", ",", "1", ":", "]", "\n", "\n", "n_batches", "=", "tf", ".", "shape", "(", "features", ")", "[", "0", "]", "\n", "\n", "# tf.ragged FIXME? or could that work?", "\n", "n_vertices", "=", "K", ".", "shape", "(", "features", ")", "[", "1", "]", "\n", "n_features", "=", "K", ".", "shape", "(", "features", ")", "[", "2", "]", "\n", "\n", "batch_range", "=", "K", ".", "arange", "(", "n_batches", ")", "\n", "batch_range", "=", "K", ".", "expand_dims", "(", "batch_range", ",", "axis", "=", "1", ")", "\n", "batch_range", "=", "K", ".", "expand_dims", "(", "batch_range", ",", "axis", "=", "1", ")", "\n", "batch_range", "=", "K", ".", "expand_dims", "(", "batch_range", ",", "axis", "=", "1", ")", "# (B, 1, 1, 1)", "\n", "\n", "# tf.ragged FIXME? n_vertices", "\n", "batch_indices", "=", "K", ".", "tile", "(", "batch_range", ",", "[", "1", ",", "n_vertices", ",", "self", ".", "n_neighbours", "-", "1", ",", "1", "]", ")", "# (B, V, N-1, 1)", "\n", "vertex_indices", "=", "K", ".", "expand_dims", "(", "neighbour_indices", ",", "axis", "=", "3", ")", "# (B, V, N-1, 1)", "\n", "indices", "=", "K", ".", "concatenate", "(", "[", "batch_indices", ",", "vertex_indices", "]", ",", "axis", "=", "-", "1", ")", "\n", "\n", "neighbour_features", "=", "tf", ".", "gather_nd", "(", "features", ",", "indices", ")", "# (B, V, N-1, F)", "\n", "\n", "distance", "=", "-", "ranked_distances", "[", ":", ",", ":", ",", "1", ":", "]", "\n", "\n", "weights", "=", "gauss_of_lin", "(", "distance", "*", "10.", ")", "\n", "weights", "=", "K", ".", "expand_dims", "(", "weights", ",", "axis", "=", "-", "1", ")", "\n", "\n", "# weight the neighbour_features", "\n", "neighbour_features", "*=", "weights", "\n", "\n", "neighbours_max", "=", "K", ".", "max", "(", "neighbour_features", ",", "axis", "=", "2", ")", "\n", "neighbours_mean", "=", "K", ".", "mean", "(", "neighbour_features", ",", "axis", "=", "2", ")", "\n", "\n", "return", "K", ".", "concatenate", "(", "[", "neighbours_max", ",", "neighbours_mean", "]", ",", "axis", "=", "-", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GravNet.get_config": [[202, 213], ["super().get_config", "dict", "list", "list", "super().get_config.items", "config.items"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.weighted_sum_layer.get_config"], ["", "def", "get_config", "(", "self", ")", ":", "\n", "        ", "config", "=", "{", "'n_neighbours'", ":", "self", ".", "n_neighbours", ",", "\n", "'n_dimensions'", ":", "self", ".", "n_dimensions", ",", "\n", "'n_filters'", ":", "self", ".", "n_filters", ",", "\n", "'n_propagate'", ":", "self", ".", "n_propagate", ",", "\n", "'name'", ":", "self", ".", "name", ",", "\n", "'also_coordinates'", ":", "self", ".", "also_coordinates", ",", "\n", "'feature_dropout'", ":", "self", ".", "feature_dropout", ",", "\n", "'masked_coordinate_offset'", ":", "self", ".", "masked_coordinate_offset", "}", "\n", "base_config", "=", "super", "(", "GravNet", ",", "self", ")", ".", "get_config", "(", ")", "\n", "return", "dict", "(", "list", "(", "base_config", ".", "items", "(", ")", ")", "+", "list", "(", "config", ".", "items", "(", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.__init__": [[216, 232], ["super().__init__", "caloGraphNN_keras.GarNet._setup_aux_params", "caloGraphNN_keras.GarNet._setup_transforms"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.__init__", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._setup_aux_params", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNetStack._setup_transforms"], ["    ", "def", "__init__", "(", "self", ",", "n_aggregators", ",", "n_filters", ",", "n_propagate", ",", "\n", "simplified", "=", "False", ",", "\n", "collapse", "=", "None", ",", "\n", "input_format", "=", "'xn'", ",", "\n", "output_activation", "=", "'tanh'", ",", "\n", "mean_by_nvert", "=", "False", ",", "\n", "quantize_transforms", "=", "False", ",", "\n", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "GarNet", ",", "self", ")", ".", "__init__", "(", "**", "kwargs", ")", "\n", "\n", "self", ".", "_simplified", "=", "simplified", "\n", "self", ".", "_output_activation", "=", "output_activation", "\n", "self", ".", "_quantize_transforms", "=", "quantize_transforms", "\n", "\n", "self", ".", "_setup_aux_params", "(", "collapse", ",", "input_format", ",", "mean_by_nvert", ")", "\n", "self", ".", "_setup_transforms", "(", "n_aggregators", ",", "n_filters", ",", "n_propagate", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._setup_aux_params": [[233, 243], ["NotImplementedError"], "methods", ["None"], ["", "def", "_setup_aux_params", "(", "self", ",", "collapse", ",", "input_format", ",", "mean_by_nvert", ")", ":", "\n", "        ", "if", "collapse", "is", "None", ":", "\n", "            ", "self", ".", "_collapse", "=", "None", "\n", "", "elif", "collapse", "in", "[", "'mean'", ",", "'sum'", ",", "'max'", "]", ":", "\n", "            ", "self", ".", "_collapse", "=", "collapse", "\n", "", "else", ":", "\n", "            ", "raise", "NotImplementedError", "(", "'Unsupported collapse operation'", ")", "\n", "\n", "", "self", ".", "_input_format", "=", "input_format", "\n", "self", ".", "_mean_by_nvert", "=", "mean_by_nvert", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._setup_transforms": [[244, 255], ["caloGraphNN_keras.NamedDense", "NamedQDense", "NamedQDense", "caloGraphNN_keras.NamedDense", "caloGraphNN_keras.NamedDense", "ternary_1_05", "ternary_1_05", "ternary_1_05"], "methods", ["None"], ["", "def", "_setup_transforms", "(", "self", ",", "n_aggregators", ",", "n_filters", ",", "n_propagate", ")", ":", "\n", "        ", "if", "self", ".", "_quantize_transforms", ":", "\n", "            ", "self", ".", "_input_feature_transform", "=", "NamedQDense", "(", "n_propagate", ",", "kernel_quantizer", "=", "ternary_1_05", "(", ")", ",", "bias_quantizer", "=", "ternary_1_05", "(", ")", ",", "name", "=", "'FLR'", ")", "\n", "self", ".", "_output_feature_transform", "=", "NamedQDense", "(", "n_filters", ",", "activation", "=", "self", ".", "_output_activation", ",", "kernel_quantizer", "=", "ternary_1_05", "(", ")", ",", "name", "=", "'Fout'", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "_input_feature_transform", "=", "NamedDense", "(", "n_propagate", ",", "name", "=", "'FLR'", ")", "\n", "self", ".", "_output_feature_transform", "=", "NamedDense", "(", "n_filters", ",", "activation", "=", "self", ".", "_output_activation", ",", "name", "=", "'Fout'", ")", "\n", "\n", "", "self", ".", "_aggregator_distance", "=", "NamedDense", "(", "n_aggregators", ",", "name", "=", "'S'", ")", "\n", "\n", "self", ".", "_sublayers", "=", "[", "self", ".", "_input_feature_transform", ",", "self", ".", "_aggregator_distance", ",", "self", ".", "_output_feature_transform", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.build": [[256, 272], ["super().build", "caloGraphNN_keras.GarNet._build_transforms", "caloGraphNN_keras.GarNet._trainable_weights.extend", "caloGraphNN_keras.GarNet._non_trainable_weights.extend"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.build", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNetStack._build_transforms"], ["", "def", "build", "(", "self", ",", "input_shape", ")", ":", "\n", "        ", "super", "(", "GarNet", ",", "self", ")", ".", "build", "(", "input_shape", ")", "\n", "\n", "if", "self", ".", "_input_format", "==", "'x'", ":", "\n", "            ", "data_shape", "=", "input_shape", "\n", "", "elif", "self", ".", "_input_format", "==", "'xn'", ":", "\n", "            ", "data_shape", ",", "_", "=", "input_shape", "\n", "", "elif", "self", ".", "_input_format", "==", "'xen'", ":", "\n", "            ", "data_shape", ",", "_", ",", "_", "=", "input_shape", "\n", "data_shape", "=", "data_shape", "[", ":", "2", "]", "+", "(", "data_shape", "[", "2", "]", "+", "1", ",", ")", "\n", "\n", "", "self", ".", "_build_transforms", "(", "data_shape", ")", "\n", "\n", "for", "layer", "in", "self", ".", "_sublayers", ":", "\n", "            ", "self", ".", "_trainable_weights", ".", "extend", "(", "layer", ".", "trainable_weights", ")", "\n", "self", ".", "_non_trainable_weights", ".", "extend", "(", "layer", ".", "non_trainable_weights", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._build_transforms": [[273, 280], ["caloGraphNN_keras.GarNet._input_feature_transform.build", "caloGraphNN_keras.GarNet._aggregator_distance.build", "caloGraphNN_keras.GarNet._output_feature_transform.build", "caloGraphNN_keras.GarNet._output_feature_transform.build"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.build", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.build", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.build", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.build"], ["", "", "def", "_build_transforms", "(", "self", ",", "data_shape", ")", ":", "\n", "        ", "self", ".", "_input_feature_transform", ".", "build", "(", "data_shape", ")", "\n", "self", ".", "_aggregator_distance", ".", "build", "(", "data_shape", ")", "\n", "if", "self", ".", "_simplified", ":", "\n", "            ", "self", ".", "_output_feature_transform", ".", "build", "(", "data_shape", "[", ":", "2", "]", "+", "(", "self", ".", "_aggregator_distance", ".", "units", "*", "self", ".", "_input_feature_transform", ".", "units", ",", ")", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "_output_feature_transform", ".", "build", "(", "data_shape", "[", ":", "2", "]", "+", "(", "data_shape", "[", "2", "]", "+", "self", ".", "_aggregator_distance", ".", "units", "*", "self", ".", "_input_feature_transform", ".", "units", "+", "self", ".", "_aggregator_distance", ".", "units", ",", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.call": [[281, 292], ["caloGraphNN_keras.GarNet._unpack_input", "caloGraphNN_keras.GarNet._garnet", "caloGraphNN_keras.GarNet._collapse_output"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._unpack_input", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._garnet", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._collapse_output"], ["", "", "def", "call", "(", "self", ",", "x", ")", ":", "\n", "        ", "data", ",", "num_vertex", ",", "vertex_mask", "=", "self", ".", "_unpack_input", "(", "x", ")", "\n", "\n", "output", "=", "self", ".", "_garnet", "(", "data", ",", "num_vertex", ",", "vertex_mask", ",", "\n", "self", ".", "_input_feature_transform", ",", "\n", "self", ".", "_aggregator_distance", ",", "\n", "self", ".", "_output_feature_transform", ")", "\n", "\n", "output", "=", "self", ".", "_collapse_output", "(", "output", ")", "\n", "\n", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._unpack_input": [[293, 315], ["K.cast", "K.sum", "K.not_equal", "K.shape", "K.tile", "K.expand_dims", "K.cast", "K.concatenate", "K.expand_dims", "K.cast", "K.arange", "K.less", "K.reshape", "K.cast"], "methods", ["None"], ["", "def", "_unpack_input", "(", "self", ",", "x", ")", ":", "\n", "        ", "if", "self", ".", "_input_format", "==", "'x'", ":", "\n", "            ", "data", "=", "x", "\n", "\n", "vertex_mask", "=", "K", ".", "cast", "(", "K", ".", "not_equal", "(", "data", "[", "...", ",", "3", ":", "4", "]", ",", "0.", ")", ",", "'float32'", ")", "\n", "num_vertex", "=", "K", ".", "sum", "(", "vertex_mask", ")", "\n", "\n", "", "elif", "self", ".", "_input_format", "in", "[", "'xn'", ",", "'xen'", "]", ":", "\n", "            ", "if", "self", ".", "_input_format", "==", "'xn'", ":", "\n", "                ", "data", ",", "num_vertex", "=", "x", "\n", "", "else", ":", "\n", "                ", "data_x", ",", "data_e", ",", "num_vertex", "=", "x", "\n", "data", "=", "K", ".", "concatenate", "(", "(", "data_x", ",", "K", ".", "reshape", "(", "data_e", ",", "(", "-", "1", ",", "data_e", ".", "shape", "[", "1", "]", ",", "1", ")", ")", ")", ",", "axis", "=", "-", "1", ")", "\n", "\n", "", "data_shape", "=", "K", ".", "shape", "(", "data", ")", "\n", "B", "=", "data_shape", "[", "0", "]", "\n", "V", "=", "data_shape", "[", "1", "]", "\n", "vertex_indices", "=", "K", ".", "tile", "(", "K", ".", "expand_dims", "(", "K", ".", "arange", "(", "0", ",", "V", ")", ",", "axis", "=", "0", ")", ",", "(", "B", ",", "1", ")", ")", "# (B, [0..V-1])", "\n", "vertex_mask", "=", "K", ".", "expand_dims", "(", "K", ".", "cast", "(", "K", ".", "less", "(", "vertex_indices", ",", "K", ".", "cast", "(", "num_vertex", ",", "'int32'", ")", ")", ",", "'float32'", ")", ",", "axis", "=", "-", "1", ")", "# (B, V, 1)", "\n", "num_vertex", "=", "K", ".", "cast", "(", "num_vertex", ",", "'float32'", ")", "\n", "\n", "", "return", "data", ",", "num_vertex", ",", "vertex_mask", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._garnet": [[316, 353], ["in_transform", "d_compute", "K.permute_dimensions", "caloGraphNN_keras.GarNet._apply_edge_weights", "caloGraphNN_keras.GarNet._apply_edge_weights", "K.exp", "K.concatenate", "caloGraphNN_keras.GarNet._apply_edge_weights", "K.concatenate", "K.concatenate", "out_transform", "K.sum", "K.reshape", "K.square", "K.reshape"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._apply_edge_weights", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._apply_edge_weights", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._apply_edge_weights"], ["", "def", "_garnet", "(", "self", ",", "data", ",", "num_vertex", ",", "vertex_mask", ",", "in_transform", ",", "d_compute", ",", "out_transform", ")", ":", "\n", "        ", "features", "=", "in_transform", "(", "data", ")", "# (B, V, F)", "\n", "distance", "=", "d_compute", "(", "data", ")", "# (B, V, S)", "\n", "\n", "edge_weights", "=", "vertex_mask", "*", "K", ".", "exp", "(", "-", "K", ".", "square", "(", "distance", ")", ")", "# (B, V, S)", "\n", "\n", "if", "not", "self", ".", "_simplified", ":", "\n", "            ", "features", "=", "K", ".", "concatenate", "(", "[", "vertex_mask", "*", "features", ",", "edge_weights", "]", ",", "axis", "=", "-", "1", ")", "\n", "\n", "", "if", "self", ".", "_mean_by_nvert", ":", "\n", "            ", "def", "graph_mean", "(", "out", ",", "axis", ")", ":", "\n", "                ", "s", "=", "K", ".", "sum", "(", "out", ",", "axis", "=", "axis", ")", "\n", "# reshape just to enable broadcasting", "\n", "s", "=", "K", ".", "reshape", "(", "s", ",", "(", "-", "1", ",", "d_compute", ".", "units", "*", "in_transform", ".", "units", ")", ")", "/", "num_vertex", "\n", "s", "=", "K", ".", "reshape", "(", "s", ",", "(", "-", "1", ",", "d_compute", ".", "units", ",", "in_transform", ".", "units", ")", ")", "\n", "return", "s", "\n", "", "", "else", ":", "\n", "            ", "graph_mean", "=", "K", ".", "mean", "\n", "\n", "# vertices -> aggregators", "\n", "", "edge_weights_trans", "=", "K", ".", "permute_dimensions", "(", "edge_weights", ",", "(", "0", ",", "2", ",", "1", ")", ")", "# (B, S, V)", "\n", "\n", "aggregated_mean", "=", "self", ".", "_apply_edge_weights", "(", "features", ",", "edge_weights_trans", ",", "aggregation", "=", "graph_mean", ")", "# (B, S, F)", "\n", "\n", "if", "self", ".", "_simplified", ":", "\n", "            ", "aggregated", "=", "aggregated_mean", "\n", "", "else", ":", "\n", "            ", "aggregated_max", "=", "self", ".", "_apply_edge_weights", "(", "features", ",", "edge_weights_trans", ",", "aggregation", "=", "K", ".", "max", ")", "\n", "aggregated", "=", "K", ".", "concatenate", "(", "[", "aggregated_max", ",", "aggregated_mean", "]", ",", "axis", "=", "-", "1", ")", "\n", "\n", "# aggregators -> vertices", "\n", "", "updated_features", "=", "self", ".", "_apply_edge_weights", "(", "aggregated", ",", "edge_weights", ")", "# (B, V, S*F)", "\n", "\n", "if", "not", "self", ".", "_simplified", ":", "\n", "            ", "updated_features", "=", "K", ".", "concatenate", "(", "[", "data", ",", "updated_features", ",", "edge_weights", "]", ",", "axis", "=", "-", "1", ")", "\n", "\n", "", "return", "vertex_mask", "*", "out_transform", "(", "updated_features", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._collapse_output": [[354, 366], ["K.mean", "K.sum", "K.sum", "K.max"], "methods", ["None"], ["", "def", "_collapse_output", "(", "self", ",", "output", ")", ":", "\n", "        ", "if", "self", ".", "_collapse", "==", "'mean'", ":", "\n", "            ", "if", "self", ".", "_mean_by_nvert", ":", "\n", "                ", "output", "=", "K", ".", "sum", "(", "output", ",", "axis", "=", "1", ")", "/", "num_vertex", "\n", "", "else", ":", "\n", "                ", "output", "=", "K", ".", "mean", "(", "output", ",", "axis", "=", "1", ")", "\n", "", "", "elif", "self", ".", "_collapse", "==", "'sum'", ":", "\n", "           ", "output", "=", "K", ".", "sum", "(", "output", ",", "axis", "=", "1", ")", "\n", "", "elif", "self", ".", "_collapse", "==", "'max'", ":", "\n", "            ", "output", "=", "K", ".", "max", "(", "output", ",", "axis", "=", "1", ")", "\n", "\n", "", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.compute_output_shape": [[367, 369], ["caloGraphNN_keras.GarNet._get_output_shape"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._get_output_shape"], ["", "def", "compute_output_shape", "(", "self", ",", "input_shape", ")", ":", "\n", "        ", "return", "self", ".", "_get_output_shape", "(", "input_shape", ",", "self", ".", "_output_feature_transform", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._get_output_shape": [[370, 382], ["None"], "methods", ["None"], ["", "def", "_get_output_shape", "(", "self", ",", "input_shape", ",", "out_transform", ")", ":", "\n", "        ", "if", "self", ".", "_input_format", "==", "'x'", ":", "\n", "            ", "data_shape", "=", "input_shape", "\n", "", "elif", "self", ".", "_input_format", "==", "'xn'", ":", "\n", "            ", "data_shape", ",", "_", "=", "input_shape", "\n", "", "elif", "self", ".", "_input_format", "==", "'xen'", ":", "\n", "            ", "data_shape", ",", "_", ",", "_", "=", "input_shape", "\n", "\n", "", "if", "self", ".", "_collapse", "is", "None", ":", "\n", "            ", "return", "data_shape", "[", ":", "2", "]", "+", "(", "out_transform", ".", "units", ",", ")", "\n", "", "else", ":", "\n", "            ", "return", "(", "data_shape", "[", "0", "]", ",", "out_transform", ".", "units", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.get_config": [[383, 398], ["super().get_config", "super().get_config.update", "caloGraphNN_keras.GarNet._add_transform_config"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.weighted_sum_layer.get_config", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNetStack._add_transform_config"], ["", "", "def", "get_config", "(", "self", ")", ":", "\n", "        ", "config", "=", "super", "(", "GarNet", ",", "self", ")", ".", "get_config", "(", ")", "\n", "\n", "config", ".", "update", "(", "{", "\n", "'simplified'", ":", "self", ".", "_simplified", ",", "\n", "'collapse'", ":", "self", ".", "_collapse", ",", "\n", "'input_format'", ":", "self", ".", "_input_format", ",", "\n", "'output_activation'", ":", "self", ".", "_output_activation", ",", "\n", "'quantize_transforms'", ":", "self", ".", "_quantize_transforms", ",", "\n", "'mean_by_nvert'", ":", "self", ".", "_mean_by_nvert", "\n", "}", ")", "\n", "\n", "self", ".", "_add_transform_config", "(", "config", ")", "\n", "\n", "return", "config", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._add_transform_config": [[399, 404], ["config.update"], "methods", ["None"], ["", "def", "_add_transform_config", "(", "self", ",", "config", ")", ":", "\n", "        ", "config", ".", "update", "(", "{", "\n", "'n_aggregators'", ":", "self", ".", "_aggregator_distance", ".", "units", ",", "\n", "'n_filters'", ":", "self", ".", "_output_feature_transform", ".", "units", ",", "\n", "'n_propagate'", ":", "self", ".", "_input_feature_transform", ".", "units", "\n", "}", ")", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._apply_edge_weights": [[406, 422], ["K.expand_dims", "K.expand_dims", "aggregation", "K.reshape", "K.reshape"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "_apply_edge_weights", "(", "features", ",", "edge_weights", ",", "aggregation", "=", "None", ")", ":", "\n", "        ", "features", "=", "K", ".", "expand_dims", "(", "features", ",", "axis", "=", "1", ")", "# (B, 1, v, f)", "\n", "edge_weights", "=", "K", ".", "expand_dims", "(", "edge_weights", ",", "axis", "=", "3", ")", "# (B, u, v, 1)", "\n", "\n", "out", "=", "edge_weights", "*", "features", "# (B, u, v, f)", "\n", "\n", "if", "aggregation", ":", "\n", "            ", "out", "=", "aggregation", "(", "out", ",", "axis", "=", "2", ")", "# (B, u, f)", "\n", "", "else", ":", "\n", "            ", "try", ":", "\n", "                ", "out", "=", "K", ".", "reshape", "(", "out", ",", "(", "-", "1", ",", "edge_weights", ".", "shape", "[", "1", "]", ".", "value", ",", "features", ".", "shape", "[", "-", "1", "]", ".", "value", "*", "features", ".", "shape", "[", "-", "2", "]", ".", "value", ")", ")", "\n", "", "except", "AttributeError", ":", "# TF 2", "\n", "                ", "out", "=", "K", ".", "reshape", "(", "out", ",", "(", "-", "1", ",", "edge_weights", ".", "shape", "[", "1", "]", ",", "features", ".", "shape", "[", "-", "1", "]", "*", "features", ".", "shape", "[", "-", "2", "]", ")", ")", "\n", "\n", "", "", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNetStack._setup_transforms": [[431, 447], ["enumerate", "sum", "zip", "caloGraphNN_keras.NamedDense", "caloGraphNN_keras.GarNetStack._transform_layers.append", "NamedQDense", "NamedQDense", "caloGraphNN_keras.NamedDense", "caloGraphNN_keras.NamedDense", "list", "ternary_1_05", "ternary_1_05", "ternary_1_05"], "methods", ["None"], ["def", "_setup_transforms", "(", "self", ",", "n_aggregators", ",", "n_filters", ",", "n_propagate", ")", ":", "\n", "        ", "self", ".", "_transform_layers", "=", "[", "]", "\n", "# inputs are lists", "\n", "for", "it", ",", "(", "p", ",", "a", ",", "f", ")", "in", "enumerate", "(", "zip", "(", "n_propagate", ",", "n_aggregators", ",", "n_filters", ")", ")", ":", "\n", "            ", "if", "self", ".", "_quantize_transforms", ":", "\n", "                ", "input_feature_transform", "=", "NamedQDense", "(", "p", ",", "kernel_quantizer", "=", "ternary_1_05", "(", ")", ",", "bias_quantizer", "=", "ternary_1_05", "(", ")", ",", "name", "=", "(", "'FLR%d'", "%", "it", ")", ")", "\n", "output_feature_transform", "=", "NamedQDense", "(", "f", ",", "activation", "=", "self", ".", "_output_activation", ",", "kernel_quantizer", "=", "ternary_1_05", "(", ")", ",", "name", "=", "(", "'Fout%d'", "%", "it", ")", ")", "\n", "", "else", ":", "\n", "                ", "input_feature_transform", "=", "NamedDense", "(", "p", ",", "name", "=", "(", "'FLR%d'", "%", "it", ")", ")", "\n", "output_feature_transform", "=", "NamedDense", "(", "f", ",", "activation", "=", "self", ".", "_output_activation", ",", "name", "=", "(", "'Fout%d'", "%", "it", ")", ")", "\n", "\n", "", "aggregator_distance", "=", "NamedDense", "(", "a", ",", "name", "=", "(", "'S%d'", "%", "it", ")", ")", "\n", "\n", "self", ".", "_transform_layers", ".", "append", "(", "(", "input_feature_transform", ",", "aggregator_distance", ",", "output_feature_transform", ")", ")", "\n", "\n", "", "self", ".", "_sublayers", "=", "sum", "(", "(", "list", "(", "layers", ")", "for", "layers", "in", "self", ".", "_transform_layers", ")", ",", "[", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNetStack._build_transforms": [[448, 458], ["in_transform.build", "d_compute.build", "out_transform.build", "out_transform.build"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.build", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.build", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.build", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet.build"], ["", "def", "_build_transforms", "(", "self", ",", "data_shape", ")", ":", "\n", "        ", "for", "in_transform", ",", "d_compute", ",", "out_transform", "in", "self", ".", "_transform_layers", ":", "\n", "            ", "in_transform", ".", "build", "(", "data_shape", ")", "\n", "d_compute", ".", "build", "(", "data_shape", ")", "\n", "if", "self", ".", "_simplified", ":", "\n", "                ", "out_transform", ".", "build", "(", "data_shape", "[", ":", "2", "]", "+", "(", "d_compute", ".", "units", "*", "in_transform", ".", "units", ",", ")", ")", "\n", "", "else", ":", "\n", "                ", "out_transform", ".", "build", "(", "data_shape", "[", ":", "2", "]", "+", "(", "data_shape", "[", "2", "]", "+", "d_compute", ".", "units", "*", "in_transform", ".", "units", "+", "d_compute", ".", "units", ",", ")", ")", "\n", "\n", "", "data_shape", "=", "data_shape", "[", ":", "2", "]", "+", "(", "out_transform", ".", "units", ",", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNetStack.call": [[459, 468], ["caloGraphNN_keras.GarNetStack._unpack_input", "caloGraphNN_keras.GarNetStack._collapse_output", "caloGraphNN_keras.GarNetStack._garnet"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._unpack_input", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._collapse_output", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._garnet"], ["", "", "def", "call", "(", "self", ",", "x", ")", ":", "\n", "        ", "data", ",", "num_vertex", ",", "vertex_mask", "=", "self", ".", "_unpack_input", "(", "x", ")", "\n", "\n", "for", "in_transform", ",", "d_compute", ",", "out_transform", "in", "self", ".", "_transform_layers", ":", "\n", "            ", "data", "=", "self", ".", "_garnet", "(", "data", ",", "num_vertex", ",", "vertex_mask", ",", "in_transform", ",", "d_compute", ",", "out_transform", ")", "\n", "\n", "", "output", "=", "self", ".", "_collapse_output", "(", "data", ")", "\n", "\n", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNetStack.compute_output_shape": [[469, 471], ["caloGraphNN_keras.GarNetStack._get_output_shape"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNet._get_output_shape"], ["", "def", "compute_output_shape", "(", "self", ",", "input_shape", ")", ":", "\n", "        ", "return", "self", ".", "_get_output_shape", "(", "input_shape", ",", "self", ".", "_transform_layers", "[", "-", "1", "]", "[", "2", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.GarNetStack._add_transform_config": [[472, 478], ["config.update", "list", "list", "list", "len"], "methods", ["None"], ["", "def", "_add_transform_config", "(", "self", ",", "config", ")", ":", "\n", "        ", "config", ".", "update", "(", "{", "\n", "'n_propagate'", ":", "list", "(", "ll", "[", "0", "]", ".", "units", "for", "ll", "in", "self", ".", "_transform_layers", ")", ",", "\n", "'n_aggregators'", ":", "list", "(", "ll", "[", "1", "]", ".", "units", "for", "ll", "in", "self", ".", "_transform_layers", ")", ",", "\n", "'n_filters'", ":", "list", "(", "ll", "[", "2", "]", ".", "units", "for", "ll", "in", "self", ".", "_transform_layers", ")", ",", "\n", "'n_sublayers'", ":", "len", "(", "self", ".", "_transform_layers", ")", "\n", "}", ")", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.weighted_sum_layer.__init__": [[483, 485], ["super().__init__"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.__init__"], ["    ", "def", "__init__", "(", "self", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "weighted_sum_layer", ",", "self", ")", ".", "__init__", "(", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.weighted_sum_layer.get_config": [[486, 489], ["super().get_config", "dict", "list", "super().get_config.items"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.weighted_sum_layer.get_config"], ["", "def", "get_config", "(", "self", ")", ":", "\n", "        ", "base_config", "=", "super", "(", "weighted_sum_layer", ",", "self", ")", ".", "get_config", "(", ")", "\n", "return", "dict", "(", "list", "(", "base_config", ".", "items", "(", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.weighted_sum_layer.compute_output_shape": [[490, 494], ["list", "tuple"], "methods", ["None"], ["", "def", "compute_output_shape", "(", "self", ",", "input_shape", ")", ":", "\n", "        ", "assert", "input_shape", "[", "2", "]", ">", "1", "\n", "inshape", "=", "list", "(", "input_shape", ")", "\n", "return", "tuple", "(", "(", "inshape", "[", "0", "]", ",", "input_shape", "[", "2", "]", "-", "1", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.caloGraphNN_keras.weighted_sum_layer.call": [[495, 501], ["K.sum"], "methods", ["None"], ["", "def", "call", "(", "self", ",", "inputs", ")", ":", "\n", "# input #B x E x F", "\n", "        ", "weights", "=", "inputs", "[", ":", ",", ":", ",", "0", ":", "1", "]", "#B x E x 1", "\n", "tosum", "=", "inputs", "[", ":", ",", ":", ",", "1", ":", "]", "\n", "weighted", "=", "weights", "*", "tosum", "#broadcast to B x E x F-1", "\n", "return", "K", ".", "sum", "(", "weighted", ",", "axis", "=", "1", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GravNetClusteringModel.__init__": [[11, 33], ["keras.Model.__init__", "kwargs.get", "range", "keras_models.GravNetClusteringModel.add_layer", "keras_models.GravNetClusteringModel.add_layer", "keras_models.GravNetClusteringModel.add_layer", "keras_models.GravNetClusteringModel.add_layer", "keras_models.GravNetClusteringModel.add_layer", "keras_models.GravNetClusteringModel.add_layer", "keras_models.GravNetClusteringModel.add_layer", "keras_models.GravNetClusteringModel.add_layer", "keras_models.GravNetClusteringModel.blocks.append"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.__init__", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.add_layer", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.add_layer", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.add_layer", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.add_layer", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.add_layer", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.add_layer", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.add_layer", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.add_layer"], ["    ", "def", "__init__", "(", "self", ",", "n_neighbours", "=", "40", ",", "n_dimensions", "=", "4", ",", "n_filters", "=", "42", ",", "n_propagate", "=", "18", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "GravNetClusteringModel", ",", "self", ")", ".", "__init__", "(", "**", "kwargs", ")", "\n", "\n", "self", ".", "blocks", "=", "[", "]", "\n", "\n", "momentum", "=", "kwargs", ".", "get", "(", "'momentum'", ",", "0.99", ")", "\n", "\n", "for", "i", "in", "range", "(", "4", ")", ":", "\n", "            ", "gex", "=", "self", ".", "add_layer", "(", "GlobalExchange", ",", "name", "=", "'gex_%d'", "%", "i", ")", "\n", "\n", "dense0", "=", "self", ".", "add_layer", "(", "keras", ".", "layers", ".", "Dense", ",", "64", ",", "activation", "=", "'tanh'", ",", "name", "=", "'dense_%d-0'", "%", "i", ")", "\n", "dense1", "=", "self", ".", "add_layer", "(", "keras", ".", "layers", ".", "Dense", ",", "64", ",", "activation", "=", "'tanh'", ",", "name", "=", "'dense_%d-1'", "%", "i", ")", "\n", "dense2", "=", "self", ".", "add_layer", "(", "keras", ".", "layers", ".", "Dense", ",", "64", ",", "activation", "=", "'tanh'", ",", "name", "=", "'dense_%d-2'", "%", "i", ")", "\n", "\n", "gravnet", "=", "self", ".", "add_layer", "(", "GravNet", ",", "n_neighbours", ",", "n_dimensions", ",", "n_filters", ",", "n_propagate", ",", "name", "=", "'gravnet_%d'", "%", "i", ")", "\n", "\n", "batchnorm", "=", "self", ".", "add_layer", "(", "keras", ".", "layers", ".", "BatchNormalization", ",", "momentum", "=", "momentum", ",", "name", "=", "'batchnorm_%d'", "%", "i", ")", "\n", "\n", "self", ".", "blocks", ".", "append", "(", "(", "gex", ",", "dense0", ",", "dense1", ",", "dense2", ",", "gravnet", ",", "batchnorm", ")", ")", "\n", "\n", "", "self", ".", "output_dense_0", "=", "self", ".", "add_layer", "(", "keras", ".", "layers", ".", "Dense", ",", "128", ",", "activation", "=", "'relu'", ",", "name", "=", "'output_0'", ")", "\n", "self", ".", "output_dense_1", "=", "self", ".", "add_layer", "(", "keras", ".", "layers", ".", "Dense", ",", "3", ",", "activation", "=", "'relu'", ",", "name", "=", "'output_1'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GravNetClusteringModel.call": [[34, 51], ["tf.concat", "keras_models.GravNetClusteringModel.output_dense_0", "keras_models.GravNetClusteringModel.output_dense_1", "feats.append", "layer"], "methods", ["None"], ["", "def", "call", "(", "self", ",", "inputs", ")", ":", "\n", "        ", "feats", "=", "[", "]", "\n", "\n", "x", "=", "inputs", "\n", "\n", "for", "block", "in", "self", ".", "blocks", ":", "\n", "            ", "for", "layer", "in", "block", ":", "\n", "                ", "x", "=", "layer", "(", "x", ")", "\n", "\n", "", "feats", ".", "append", "(", "x", ")", "\n", "\n", "", "x", "=", "tf", ".", "concat", "(", "feats", ",", "axis", "=", "-", "1", ")", "\n", "\n", "x", "=", "self", ".", "output_dense_0", "(", "x", ")", "\n", "x", "=", "self", ".", "output_dense_1", "(", "x", ")", "\n", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GravNetClusteringModel.add_layer": [[52, 56], ["cls", "keras_models.GravNetClusteringModel._layers.append"], "methods", ["None"], ["", "def", "add_layer", "(", "self", ",", "cls", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "layer", "=", "cls", "(", "*", "args", ",", "**", "kwargs", ")", "\n", "self", ".", "_layers", ".", "append", "(", "layer", ")", "\n", "return", "layer", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.__init__": [[59, 80], ["keras.Model.__init__", "zip", "kwargs.get", "keras_models.GarNetClusteringModel.add_layer", "keras_models.GarNetClusteringModel.add_layer", "keras_models.GarNetClusteringModel.add_layer", "enumerate", "keras_models.GarNetClusteringModel.add_layer", "keras_models.GarNetClusteringModel.add_layer", "keras_models.GarNetClusteringModel.add_layer", "keras_models.GarNetClusteringModel.add_layer", "keras_models.GarNetClusteringModel.blocks.append"], "methods", ["home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.__init__", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.add_layer", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.add_layer", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.add_layer", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.add_layer", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.add_layer", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.add_layer", "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.add_layer"], ["    ", "def", "__init__", "(", "self", ",", "aggregators", "=", "(", "[", "4", "]", "*", "11", ")", ",", "filters", "=", "(", "[", "32", "]", "*", "11", ")", ",", "propagate", "=", "(", "[", "20", "]", "*", "11", ")", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "GarNetClusteringModel", ",", "self", ")", ".", "__init__", "(", "**", "kwargs", ")", "\n", "\n", "self", ".", "blocks", "=", "[", "]", "\n", "\n", "block_params", "=", "zip", "(", "aggregators", ",", "filters", ",", "propagate", ")", "\n", "\n", "momentum", "=", "kwargs", ".", "get", "(", "'momentum'", ",", "0.99", ")", "\n", "\n", "self", ".", "input_gex", "=", "self", ".", "add_layer", "(", "GlobalExchange", ",", "name", "=", "'input_gex'", ")", "\n", "self", ".", "input_batchnorm", "=", "self", ".", "add_layer", "(", "keras", ".", "layers", ".", "BatchNormalization", ",", "momentum", "=", "momentum", ",", "name", "=", "'input_batchnorm'", ")", "\n", "self", ".", "input_dense", "=", "self", ".", "add_layer", "(", "keras", ".", "layers", ".", "Dense", ",", "32", ",", "activation", "=", "'tanh'", ",", "name", "=", "'input_dense'", ")", "\n", "\n", "for", "i", ",", "(", "n_aggregators", ",", "n_filters", ",", "n_propagate", ")", "in", "enumerate", "(", "block_params", ")", ":", "\n", "            ", "garnet", "=", "self", ".", "add_layer", "(", "GarNet", ",", "n_aggregators", ",", "n_filters", ",", "n_propagate", ",", "name", "=", "'garnet_%d'", "%", "i", ")", "\n", "batchnorm", "=", "self", ".", "add_layer", "(", "keras", ".", "layers", ".", "BatchNormalization", ",", "momentum", "=", "momentum", ",", "name", "=", "'batchnorm_%d'", "%", "i", ")", "\n", "\n", "self", ".", "blocks", ".", "append", "(", "(", "garnet", ",", "batchnorm", ")", ")", "\n", "\n", "", "self", ".", "output_dense_0", "=", "self", ".", "add_layer", "(", "keras", ".", "layers", ".", "Dense", ",", "48", ",", "activation", "=", "'relu'", ",", "name", "=", "'output_0'", ")", "\n", "self", ".", "output_dense_1", "=", "self", ".", "add_layer", "(", "keras", ".", "layers", ".", "Dense", ",", "3", ",", "activation", "=", "'relu'", ",", "name", "=", "'output_1'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.call": [[81, 102], ["keras_models.GarNetClusteringModel.input_gex", "keras_models.GarNetClusteringModel.input_batchnorm", "keras_models.GarNetClusteringModel.input_dense", "tf.concat", "keras_models.GarNetClusteringModel.output_dense_0", "keras_models.GarNetClusteringModel.output_dense_1", "feats.append", "layer"], "methods", ["None"], ["", "def", "call", "(", "self", ",", "inputs", ")", ":", "\n", "        ", "feats", "=", "[", "]", "\n", "\n", "x", "=", "inputs", "\n", "\n", "x", "=", "self", ".", "input_gex", "(", "x", ")", "\n", "x", "=", "self", ".", "input_batchnorm", "(", "x", ")", "\n", "x", "=", "self", ".", "input_dense", "(", "x", ")", "\n", "\n", "for", "block", "in", "self", ".", "blocks", ":", "\n", "            ", "for", "layer", "in", "block", ":", "\n", "                ", "x", "=", "layer", "(", "x", ")", "\n", "\n", "", "feats", ".", "append", "(", "x", ")", "\n", "\n", "", "x", "=", "tf", ".", "concat", "(", "feats", ",", "axis", "=", "-", "1", ")", "\n", "\n", "x", "=", "self", ".", "output_dense_0", "(", "x", ")", "\n", "x", "=", "self", ".", "output_dense_1", "(", "x", ")", "\n", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.jkiesele_caloGraphNN.None.keras_models.GarNetClusteringModel.add_layer": [[103, 107], ["cls", "keras_models.GarNetClusteringModel._layers.append"], "methods", ["None"], ["", "def", "add_layer", "(", "self", ",", "cls", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "layer", "=", "cls", "(", "*", "args", ",", "**", "kwargs", ")", "\n", "self", ".", "_layers", ".", "append", "(", "layer", ")", "\n", "return", "layer", "\n", "", "", ""]]}