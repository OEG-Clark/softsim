{"home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.__init__": [[10, 46], ["torch.any", "torch.any", "torch.any", "torch.any", "torch.all", "torch.all", "torch.all", "torch.all", "torch.zeros().to", "torch.zeros().to", "torch.zeros().to", "torch.zeros().to", "catdist.CatDist.softmax_transform", "catdist.CatDist.probs.detach", "catdist.CatDist.probs[].unsqueeze().repeat", "catdist.CatDist.scatter", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.ones_like().to().long", "torch.ones_like().to().long", "torch.ones_like().to().long", "torch.ones_like().to().long", "torch.abs", "torch.abs", "torch.abs", "torch.abs", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "catdist.CatDist.probs[].unsqueeze", "torch.ones_like().to", "torch.ones_like().to", "torch.ones_like().to", "torch.ones_like().to", "catdist.CatDist.probs.sum", "torch.ones_like", "torch.ones_like", "torch.ones_like", "torch.ones_like"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.softmax_transform", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.isnan", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.isnan", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.isnan", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.isnan"], ["    ", "def", "__init__", "(", "self", ",", "logits", ",", "args", ",", "probs", "=", "None", ",", "k", "=", "None", ")", ":", "\n", "        ", "self", ".", "args", "=", "args", "\n", "self", ".", "K", "=", "self", ".", "args", ".", "K", "\n", "\n", "if", "probs", "is", "not", "None", ":", "\n", "            ", "self", ".", "probs", "=", "probs", "\n", "", "else", ":", "\n", "\n", "            ", "bsz", "=", "logits", ".", "shape", "[", "0", "]", "\n", "zeros", "=", "torch", ".", "zeros", "(", "bsz", ",", "1", ")", ".", "to", "(", "logits", ".", "device", ")", "\n", "\n", "if", "args", ".", "kminusone", "==", "1", ":", "\n", "                ", "new_logits", "=", "torch", ".", "cat", "(", "[", "logits", ",", "zeros", "]", ",", "dim", "=", "-", "1", ")", "\n", "", "elif", "args", ".", "kminusone", "==", "0", ":", "\n", "                ", "new_logits", "=", "logits", "\n", "", "else", ":", "\n", "                ", "assert", "False", "\n", "\n", "", "assert", "new_logits", ".", "shape", "==", "(", "bsz", ",", "self", ".", "args", ".", "K", ")", "\n", "\n", "self", ".", "probs", "=", "self", ".", "softmax_transform", "(", "new_logits", ")", "\n", "\n", "\n", "", "if", "k", "is", "not", "None", ":", "\n", "# works marginally", "\n", "            ", "bsz", "=", "self", ".", "probs", ".", "shape", "[", "0", "]", "\n", "probs_const", "=", "self", ".", "probs", ".", "detach", "(", ")", "\n", "probs_k_with_grad", "=", "self", ".", "probs", "[", ":", ",", "k", "]", ".", "unsqueeze", "(", "1", ")", ".", "repeat", "(", "1", ",", "self", ".", "K", ")", "\n", "assert", "probs_k_with_grad", ".", "shape", "==", "(", "bsz", ",", "self", ".", "K", ")", "\n", "idx", "=", "torch", ".", "ones_like", "(", "probs_k_with_grad", ")", ".", "to", "(", "probs_k_with_grad", ".", "device", ")", ".", "long", "(", ")", "*", "k", "\n", "self", ".", "probs", "=", "probs_const", ".", "scatter", "(", "1", ",", "idx", ",", "probs_k_with_grad", ")", "\n", "\n", "\n", "", "if", "torch", ".", "any", "(", "torch", ".", "isnan", "(", "self", ".", "probs", ")", ")", ":", "\n", "            ", "assert", "False", ",", "\"catdist probs are bad\"", "\n", "", "assert", "torch", ".", "all", "(", "torch", ".", "abs", "(", "self", ".", "probs", ".", "sum", "(", "-", "1", ")", "-", "1.0", ")", "<", "1e-4", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.sample": [[47, 50], ["torch.distributions.Categorical", "torch.distributions.Categorical", "torch.distributions.Categorical", "torch.distributions.Categorical", "torch.distributions.Categorical.sample", "torch.distributions.Categorical.sample"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.sample", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.sample"], ["", "def", "sample", "(", "self", ",", "sample_shape", ")", ":", "\n", "        ", "torchdist", "=", "torch", ".", "distributions", ".", "Categorical", "(", "probs", "=", "self", ".", "probs", ")", "\n", "return", "torchdist", ".", "sample", "(", "sample_shape", "=", "sample_shape", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.predict_time": [[51, 55], ["torch.arange().to", "torch.arange().to", "torch.arange().to", "torch.arange().to", "ar.unsqueeze().repeat.unsqueeze().repeat.unsqueeze().repeat", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "ar.unsqueeze().repeat.unsqueeze().repeat.unsqueeze"], "methods", ["None"], ["", "def", "predict_time", "(", "self", ")", ":", "\n", "        ", "ar", "=", "torch", ".", "arange", "(", "self", ".", "K", ")", ".", "to", "(", "self", ".", "args", ".", "device", ")", "\n", "ar", "=", "ar", ".", "unsqueeze", "(", "0", ")", ".", "repeat", "(", "self", ".", "probs", ".", "shape", "[", "0", "]", ",", "1", ")", "\n", "return", "(", "ar", "*", "self", ".", "probs", ")", ".", "sum", "(", "-", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.log_pmf": [[56, 63], ["util.safe_log", "torch.arange", "torch.arange", "torch.arange", "torch.arange"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.safe_log"], ["", "def", "log_pmf", "(", "self", ",", "k", ")", ":", "\n", "        ", "bin_times", "=", "k", "# data already discrete", "\n", "BSZ", "=", "bin_times", ".", "shape", "[", "0", "]", "\n", "pk", "=", "self", ".", "probs", "[", "torch", ".", "arange", "(", "BSZ", ")", ",", "bin_times", "]", "\n", "logpk", "=", "util", ".", "safe_log", "(", "pk", ",", "self", ".", "args", ".", "logeps", ")", "\n", "assert", "bin_times", ".", "shape", "==", "logpk", ".", "shape", "\n", "return", "logpk", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.pmf": [[64, 70], ["torch.arange", "torch.arange", "torch.arange", "torch.arange"], "methods", ["None"], ["", "def", "pmf", "(", "self", ",", "k", ")", ":", "\n", "        ", "bin_times", "=", "k", "# data already discrete", "\n", "BSZ", "=", "bin_times", ".", "shape", "[", "0", "]", "\n", "pk", "=", "self", ".", "probs", "[", "torch", ".", "arange", "(", "BSZ", ")", ",", "bin_times", "]", "\n", "assert", "bin_times", ".", "shape", "==", "pk", ".", "shape", "\n", "return", "pk", "\n", "#return self.log_pmf(k).exp()", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.cdf": [[72, 99], ["bin_times.unsqueeze", "torch.arange().view().to", "torch.arange().view().to", "torch.arange().view().to", "torch.arange().view().to", "torch.where", "torch.where", "torch.where", "torch.where", "torch.arange().view", "torch.arange().view", "torch.arange().view", "torch.arange().view", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "bin_times.unsqueeze.long().squeeze", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "bin_times.unsqueeze.long"], "methods", ["None"], ["", "def", "cdf", "(", "self", ",", "k", ",", "_1m", "=", "False", ")", ":", "\n", "#bin_times, _ = self.cat_bin_target(k)", "\n", "        ", "bin_times", "=", "k", "# data already discrete", "\n", "# IMPORTANT", "\n", "if", "_1m", ":", "\n", "            ", "bin_times", "=", "bin_times", "-", "1.0", "\n", "\n", "", "BSZ", "=", "bin_times", ".", "shape", "[", "0", "]", "\n", "bin_times_wide", "=", "bin_times", ".", "unsqueeze", "(", "-", "1", ")", "\n", "probs_batch", "=", "self", ".", "probs", "\n", "\n", "indices", "=", "torch", ".", "arange", "(", "self", ".", "K", ")", ".", "view", "(", "1", ",", "-", "1", ")", ".", "to", "(", "self", ".", "args", ".", "device", ")", "\n", "# compute some masks", "\n", "# 1's up to but not including correct bin, then zeros", "\n", "mask1", "=", "(", "bin_times_wide", ">", "indices", ")", ".", "float", "(", ")", "\n", "# 1 up to and including correct bin, then zeros", "\n", "mask2", "=", "(", "bin_times_wide", ">=", "indices", ")", ".", "float", "(", ")", "\n", "cdf_km1", "=", "(", "probs_batch", "*", "mask1", ")", ".", "sum", "(", "dim", "=", "-", "1", ")", "\n", "prob_k", "=", "probs_batch", "[", "torch", ".", "arange", "(", "BSZ", ")", ",", "bin_times_wide", ".", "long", "(", ")", ".", "squeeze", "(", ")", "]", "\n", "cdf_k", "=", "(", "probs_batch", "*", "mask2", ")", ".", "sum", "(", "dim", "=", "-", "1", ")", "\n", "\n", "# IMPORTANT", "\n", "if", "_1m", ":", "\n", "            ", "cdf_k", "=", "torch", ".", "where", "(", "bin_times", ">=", "0.0", ",", "\n", "cdf_k", ",", "\n", "torch", ".", "zeros_like", "(", "cdf_k", ")", ")", "\n", "", "return", "cdf_k", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.eq": [[100, 102], ["catdist.CatDist.pmf"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.pmf"], ["", "def", "eq", "(", "self", ",", "k", ")", ":", "\n", "        ", "return", "self", ".", "pmf", "(", "k", ")", "\n", "", "def", "leq", "(", "self", ",", "k", ")", ":", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.leq": [[102, 104], ["catdist.CatDist.cdf"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.cdf"], ["", "def", "leq", "(", "self", ",", "k", ")", ":", "\n", "        ", "return", "self", ".", "cdf", "(", "k", ")", "\n", "", "def", "lt", "(", "self", ",", "k", ")", ":", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.lt": [[104, 106], ["catdist.CatDist.cdf", "catdist.CatDist.pmf"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.cdf", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.pmf"], ["", "def", "lt", "(", "self", ",", "k", ")", ":", "\n", "        ", "return", "self", ".", "cdf", "(", "k", ")", "-", "self", ".", "pmf", "(", "k", ")", "\n", "", "def", "geq", "(", "self", ",", "k", ")", ":", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.geq": [[106, 108], ["catdist.CatDist.lt"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.lt"], ["", "def", "geq", "(", "self", ",", "k", ")", ":", "\n", "        ", "return", "1.", "-", "self", ".", "lt", "(", "k", ")", "\n", "", "def", "gt", "(", "self", ",", "k", ")", ":", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.gt": [[108, 110], ["catdist.CatDist.leq"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.leq"], ["", "def", "gt", "(", "self", ",", "k", ")", ":", "\n", "        ", "return", "1.", "-", "self", ".", "leq", "(", "k", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.softmax_transform": [[111, 114], ["torch.Softmax", "torch.Softmax"], "methods", ["None"], ["", "def", "softmax_transform", "(", "self", ",", "logits", ")", ":", "\n", "        ", "probs", "=", "nn", ".", "Softmax", "(", "dim", "=", "-", "1", ")", "(", "logits", ")", "\n", "return", "probs", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.SmallNet.__init__": [[23, 27], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.Meter.__init__"], ["    ", "def", "__init__", "(", "self", ",", "D_in", ",", "D_out", ")", ":", "\n", "        ", "super", "(", "SmallNet", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "fc1", "=", "nn", ".", "Linear", "(", "D_in", ",", "128", ")", "\n", "self", ".", "fc2", "=", "nn", ".", "Linear", "(", "128", ",", "D_out", ")", "\n", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.SmallNet.forward": [[27, 30], ["models.RELU", "models.SmallNet.fc2", "models.SmallNet.fc1"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.RELU"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "h", "=", "RELU", "(", "self", ".", "fc1", "(", "x", ")", ")", "\n", "return", "self", ".", "fc2", "(", "h", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.BigNet.__init__": [[32, 41], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.Meter.__init__"], ["    ", "def", "__init__", "(", "self", ",", "D_in", ",", "D_out", ")", ":", "\n", "        ", "super", "(", "BigNet", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "fc1", "=", "nn", ".", "Linear", "(", "D_in", ",", "256", ")", "\n", "self", ".", "fc2", "=", "nn", ".", "Linear", "(", "256", ",", "256", ")", "\n", "self", ".", "fc3", "=", "nn", ".", "Linear", "(", "256", ",", "256", ")", "\n", "self", ".", "fc4", "=", "nn", ".", "Linear", "(", "256", ",", "256", ")", "\n", "self", ".", "fc5", "=", "nn", ".", "Linear", "(", "256", ",", "128", ")", "\n", "self", ".", "fc6", "=", "nn", ".", "Linear", "(", "128", ",", "D_out", ")", "\n", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.BigNet.forward": [[41, 49], ["models.RELU", "models.RELU", "models.RELU", "models.RELU", "models.RELU", "models.BigNet.fc6", "models.BigNet.fc1", "models.BigNet.fc2", "models.BigNet.fc3", "models.BigNet.fc4", "models.BigNet.fc5"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.RELU", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.RELU", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.RELU", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.RELU", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.RELU"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "h", "=", "RELU", "(", "self", ".", "fc1", "(", "x", ")", ")", "\n", "h", "=", "RELU", "(", "self", ".", "fc2", "(", "h", ")", ")", "\n", "h", "=", "RELU", "(", "self", ".", "fc3", "(", "h", ")", ")", "\n", "h", "=", "RELU", "(", "self", ".", "fc4", "(", "h", ")", ")", "\n", "h", "=", "RELU", "(", "self", ".", "fc5", "(", "h", ")", ")", "\n", "h", "=", "self", ".", "fc6", "(", "h", ")", "\n", "return", "h", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.DeepNet.__init__": [[51, 70], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "models.DeepNet._init_weights", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.Meter.__init__", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.DeepNet._init_weights"], ["    ", "def", "__init__", "(", "self", ",", "D_in", ",", "D_out", ",", "HS", ",", "dropout_rate", ",", "bn", "=", "False", ")", ":", "\n", "        ", "super", "(", "DeepNet", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "bn", "=", "bn", "\n", "\n", "if", "self", ".", "bn", ":", "\n", "            ", "self", ".", "bn1", "=", "nn", ".", "BatchNorm1d", "(", "D_in", ")", "\n", "self", ".", "bn2", "=", "nn", ".", "BatchNorm1d", "(", "HS", "[", "0", "]", ")", "\n", "self", ".", "bn3", "=", "nn", ".", "BatchNorm1d", "(", "HS", "[", "1", "]", ")", "\n", "self", ".", "bn4", "=", "nn", ".", "BatchNorm1d", "(", "HS", "[", "2", "]", ")", "\n", "\n", "", "self", ".", "fc1", "=", "nn", ".", "Linear", "(", "D_in", ",", "HS", "[", "0", "]", ")", "\n", "self", ".", "fc2", "=", "nn", ".", "Linear", "(", "HS", "[", "0", "]", ",", "HS", "[", "1", "]", ")", "\n", "self", ".", "fc3", "=", "nn", ".", "Linear", "(", "HS", "[", "1", "]", ",", "HS", "[", "2", "]", ")", "\n", "self", ".", "fc4", "=", "nn", ".", "Linear", "(", "HS", "[", "2", "]", ",", "D_out", ")", "\n", "self", ".", "_init_weights", "(", ")", "\n", "\n", "self", ".", "drop1", "=", "nn", ".", "Dropout", "(", "dropout_rate", ")", "\n", "self", ".", "drop2", "=", "nn", ".", "Dropout", "(", "dropout_rate", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.DeepNet._init_weights": [[71, 74], ["models.DeepNet.named_parameters", "torch.init.uniform_", "torch.init.uniform_", "torch.init.uniform_"], "methods", ["None"], ["", "def", "_init_weights", "(", "self", ")", ":", "\n", "        ", "for", "name", ",", "param", "in", "self", ".", "named_parameters", "(", ")", ":", "\n", "            ", "nn", ".", "init", ".", "uniform_", "(", "param", ",", "a", "=", "-", "0.01", ",", "b", "=", "0.01", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.DeepNet.forward": [[75, 89], ["models.DeepNet.drop1", "models.DeepNet.drop2", "models.RELU", "models.DeepNet.fc4", "models.DeepNet.bn1", "models.RELU", "models.DeepNet.bn2", "models.RELU", "models.DeepNet.bn3", "models.DeepNet.fc3", "models.DeepNet.bn4", "models.DeepNet.fc1", "models.DeepNet.fc2"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.RELU", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.RELU", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.RELU"], ["", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "if", "self", ".", "bn", ":", "\n", "            ", "x", "=", "self", ".", "bn1", "(", "x", ")", "\n", "", "x", "=", "self", ".", "drop1", "(", "RELU", "(", "self", ".", "fc1", "(", "x", ")", ")", ")", "\n", "if", "self", ".", "bn", ":", "\n", "            ", "x", "=", "self", ".", "bn2", "(", "x", ")", "\n", "", "x", "=", "self", ".", "drop2", "(", "RELU", "(", "self", ".", "fc2", "(", "x", ")", ")", ")", "\n", "if", "self", ".", "bn", ":", "\n", "            ", "x", "=", "self", ".", "bn3", "(", "x", ")", "\n", "", "x", "=", "RELU", "(", "self", ".", "fc3", "(", "x", ")", ")", "\n", "if", "self", ".", "bn", ":", "\n", "            ", "x", "=", "self", ".", "bn4", "(", "x", ")", "\n", "", "pred", "=", "self", ".", "fc4", "(", "x", ")", "\n", "return", "pred", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.CatNN.__init__": [[92, 108], ["torch.Module.__init__", "models.DeepNet", "models.DeepNet"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.Meter.__init__"], ["    ", "def", "__init__", "(", "self", ",", "args", ")", ":", "\n", "        ", "super", "(", "CatNN", ",", "self", ")", ".", "__init__", "(", ")", "\n", "if", "args", ".", "dataset", "in", "[", "'gamma'", "]", ":", "\n", "            ", "hidden_sizes", "=", "[", "128", ",", "64", ",", "64", "]", "\n", "#hidden_sizes=[128,256,64]", "\n", "", "elif", "args", ".", "dataset", "in", "args", ".", "realsets", ":", "\n", "            ", "hidden_sizes", "=", "[", "128", ",", "256", ",", "64", "]", "\n", "\n", "", "self", ".", "args", "=", "args", "\n", "\n", "if", "args", ".", "kminusone", "==", "1", ":", "\n", "            ", "self", ".", "model", "=", "DeepNet", "(", "args", ".", "D_in", ",", "args", ".", "K", "-", "1", ",", "hidden_sizes", ",", "args", ".", "dropout_rate", ")", "\n", "", "elif", "args", ".", "kminusone", "==", "0", ":", "\n", "            ", "self", ".", "model", "=", "DeepNet", "(", "args", ".", "D_in", ",", "args", ".", "K", ",", "hidden_sizes", ",", "args", ".", "dropout_rate", ")", "\n", "", "else", ":", "\n", "            ", "assert", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.CatNN.forward": [[109, 111], ["models.CatNN.model"], "methods", ["None"], ["", "", "def", "forward", "(", "self", ",", "src", ")", ":", "\n", "        ", "return", "self", ".", "model", "(", "src", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.ConvHelper.__init__": [[115, 126], ["torch.Module.__init__", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.MaxPool2d", "torch.MaxPool2d", "torch.MaxPool2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.AvgPool2d", "torch.AvgPool2d", "torch.AvgPool2d", "torch.AvgPool2d", "torch.AvgPool2d", "torch.AvgPool2d", "torch.AdaptiveAvgPool2d", "torch.AdaptiveAvgPool2d", "torch.AdaptiveAvgPool2d", "torch.Dropout2d", "torch.Dropout2d", "torch.Dropout2d", "torch.Dropout2d", "torch.Dropout2d", "torch.Dropout2d"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.Meter.__init__"], ["    ", "def", "__init__", "(", "self", ",", "args", ")", ":", "\n", "        ", "super", "(", "ConvHelper", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "conv1", "=", "nn", ".", "Conv2d", "(", "1", ",", "16", ",", "5", ",", "1", ")", "\n", "self", ".", "max_pool", "=", "nn", ".", "MaxPool2d", "(", "2", ")", "\n", "self", ".", "conv2", "=", "nn", ".", "Conv2d", "(", "16", ",", "16", ",", "5", ",", "1", ")", "\n", "self", ".", "conv3", "=", "nn", ".", "Conv2d", "(", "16", ",", "32", ",", "4", ",", "1", ")", "\n", "self", ".", "pool1", "=", "nn", ".", "AvgPool2d", "(", "kernel_size", "=", "2", ")", "\n", "self", ".", "pool2", "=", "nn", ".", "AvgPool2d", "(", "kernel_size", "=", "2", ")", "\n", "self", ".", "glob_avg_pool", "=", "nn", ".", "AdaptiveAvgPool2d", "(", "(", "1", ",", "1", ")", ")", "\n", "self", ".", "drop1", "=", "nn", ".", "Dropout2d", "(", "args", ".", "dropout_rate", ")", "\n", "self", ".", "drop2", "=", "nn", ".", "Dropout2d", "(", "args", ".", "dropout_rate", ")", "\n", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.ConvHelper.forward": [[126, 136], ["torch.relu", "torch.relu", "torch.relu", "models.ConvHelper.drop1", "models.ConvHelper.pool1", "torch.relu", "torch.relu", "torch.relu", "models.ConvHelper.drop2", "models.ConvHelper.pool2", "torch.relu", "torch.relu", "torch.relu", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten", "models.ConvHelper.conv1", "models.ConvHelper.conv2", "models.ConvHelper.conv3"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "x", "=", "F", ".", "relu", "(", "self", ".", "conv1", "(", "x", ")", ")", "\n", "x", "=", "self", ".", "drop1", "(", "x", ")", "\n", "x", "=", "self", ".", "pool1", "(", "x", ")", "\n", "x", "=", "F", ".", "relu", "(", "self", ".", "conv2", "(", "x", ")", ")", "\n", "x", "=", "self", ".", "drop2", "(", "x", ")", "\n", "x", "=", "self", ".", "pool2", "(", "x", ")", "\n", "x", "=", "F", ".", "relu", "(", "self", ".", "conv3", "(", "x", ")", ")", "\n", "x", "=", "torch", ".", "flatten", "(", "x", ",", "1", ")", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.CatNNConv.__init__": [[139, 151], ["torch.Module.__init__", "models.ConvHelper", "models.DeepNet", "models.DeepNet"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.Meter.__init__"], ["    ", "def", "__init__", "(", "self", ",", "args", ")", ":", "\n", "        ", "super", "(", "CatNNConv", ",", "self", ")", ".", "__init__", "(", ")", "\n", "hidden_sizes", "=", "[", "512", ",", "256", ",", "64", "]", "\n", "self", ".", "conv", "=", "ConvHelper", "(", "args", ")", "\n", "self", ".", "args", "=", "args", "\n", "\n", "if", "args", ".", "kminusone", "==", "1", ":", "\n", "            ", "self", ".", "ff", "=", "DeepNet", "(", "32", ",", "args", ".", "K", "-", "1", ",", "hidden_sizes", ",", "args", ".", "dropout_rate", ",", "bn", "=", "True", ")", "\n", "", "elif", "args", ".", "kminusone", "==", "0", ":", "\n", "            ", "self", ".", "ff", "=", "DeepNet", "(", "32", ",", "args", ".", "K", ",", "hidden_sizes", ",", "args", ".", "dropout_rate", ",", "bn", "=", "True", ")", "\n", "", "else", ":", "\n", "            ", "assert", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.CatNNConv.forward": [[152, 156], ["models.CatNNConv.conv", "models.CatNNConv.ff"], "methods", ["None"], ["", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "h", "=", "self", ".", "conv", "(", "x", ")", "\n", "params_t", "=", "self", ".", "ff", "(", "h", ")", "\n", "return", "params_t", "\n", "", "", ""]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.RELU": [[5, 7], ["x.relu"], "function", ["None"], ["def", "RELU", "(", "x", ")", ":", "\n", "    ", "return", "x", ".", "relu", "(", ")", "\n", "", "def", "POOL", "(", "x", ")", ":", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.POOL": [[7, 9], ["torch.max_pool2d"], "function", ["None"], ["", "def", "POOL", "(", "x", ")", ":", "\n", "    ", "return", "F", ".", "max_pool2d", "(", "x", ",", "2", ")", "\n", "", "def", "POOL1d", "(", "x", ")", ":", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.POOL1d": [[9, 11], ["torch.max_pool1d"], "function", ["None"], ["", "def", "POOL1d", "(", "x", ")", ":", "\n", "    ", "return", "F", ".", "max_pool1d", "(", "x", ",", "2", ")", "\n", "", "def", "root", "(", "x", ")", ":", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.root": [[11, 13], ["x.sqrt"], "function", ["None"], ["", "def", "root", "(", "x", ")", ":", "\n", "    ", "return", "x", ".", "sqrt", "(", ")", "\n", "", "def", "log", "(", "x", ")", ":", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.log": [[13, 15], ["x.log"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.log"], ["", "def", "log", "(", "x", ")", ":", "\n", "    ", "return", "x", ".", "log", "(", ")", "\n", "", "def", "exp", "(", "x", ")", ":", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.exp": [[15, 17], ["x.exp"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.exp"], ["", "def", "exp", "(", "x", ")", ":", "\n", "    ", "return", "x", ".", "exp", "(", ")", "\n", "", "def", "oneplus", "(", "x", ")", ":", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.oneplus": [[17, 19], ["None"], "function", ["None"], ["", "def", "oneplus", "(", "x", ")", ":", "\n", "    ", "return", "1", "+", "x", "\n", "", "def", "div", "(", "x", ",", "y", ")", ":", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.models.div": [[19, 21], ["None"], "function", ["None"], ["", "def", "div", "(", "x", ",", "y", ")", ":", "\n", "    ", "return", "x", "/", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.main.round3": [[49, 51], ["round"], "function", ["None"], ["def", "round3", "(", "x", ")", ":", "\n", "    ", "return", "round", "(", "x", ",", "3", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._concordance.concordance": [[19, 49], ["enumerate", "torch.cat().detach().cpu().numpy", "torch.cat().detach().cpu().numpy", "torch.cat().long().detach().cpu().numpy", "torch.cat().long().detach().cpu().numpy", "torch.cat().detach().cpu().numpy", "torch.cat().detach().cpu().numpy", "lifelines.utils.concordance_index", "U.to.to", "Delta.to.to", "X.to.to", "torch.cat().detach().cpu().numpy.append", "Delta.to.to", "torch.cat().long().detach().cpu().numpy.append", "model", "catdist.CatDist", "catdist.CatDist.predict_time", "torch.any", "torch.any", "torch.cat().detach().cpu().numpy.append", "torch.isnan", "torch.isnan", "torch.cat().detach().cpu", "torch.cat().detach().cpu", "torch.cat().long().detach().cpu", "torch.cat().long().detach().cpu", "torch.cat().detach().cpu", "torch.cat().detach().cpu", "torch.cat().detach", "torch.cat().detach", "torch.cat().long().detach", "torch.cat().long().detach", "torch.cat().detach", "torch.cat().detach", "torch.cat", "torch.cat", "torch.cat().long", "torch.cat().long", "torch.cat", "torch.cat", "torch.cat", "torch.cat"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.predict_time", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.isnan", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.isnan"], ["def", "concordance", "(", "loader", ",", "model", ",", "args", ",", "is_g", "=", "False", ")", ":", "\n", "    ", "all_U", "=", "[", "]", "\n", "all_Delta", "=", "[", "]", "\n", "all_pred_time", "=", "[", "]", "\n", "for", "idx", ",", "(", "U", ",", "Delta", ",", "X", ")", "in", "enumerate", "(", "loader", ")", ":", "\n", "        ", "U", "=", "U", ".", "to", "(", "args", ".", "device", ")", "\n", "Delta", "=", "Delta", ".", "to", "(", "args", ".", "device", ")", "\n", "X", "=", "X", ".", "to", "(", "args", ".", "device", ")", "\n", "all_U", ".", "append", "(", "U", ")", "\n", "Delta", "=", "Delta", ".", "to", "(", "args", ".", "device", ")", "\n", "all_Delta", ".", "append", "(", "Delta", ")", "\n", "pred_params", "=", "model", "(", "X", ")", "\n", "dist", "=", "catdist", ".", "CatDist", "(", "logits", "=", "pred_params", ",", "args", "=", "args", ",", "probs", "=", "None", ",", "k", "=", "None", ")", "\n", "pred_time", "=", "dist", ".", "predict_time", "(", ")", "\n", "if", "torch", ".", "any", "(", "torch", ".", "isnan", "(", "pred_time", ")", ")", ":", "\n", "            ", "assert", "False", ",", "\"bad pred time in conc\"", "\n", "\n", "", "all_pred_time", ".", "append", "(", "pred_time", ")", "\n", "", "all_U", "=", "torch", ".", "cat", "(", "all_U", ")", ".", "detach", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "all_Delta", "=", "torch", ".", "cat", "(", "all_Delta", ")", ".", "long", "(", ")", ".", "detach", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "all_pred_time", "=", "torch", ".", "cat", "(", "all_pred_time", ")", ".", "detach", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "\n", "\n", "if", "is_g", ":", "\n", "        ", "all_is_observed", "=", "~", "all_Delta", "\n", "", "else", ":", "\n", "        ", "all_is_observed", "=", "all_Delta", "\n", "\n", "", "concordance", "=", "concordance_index", "(", "all_U", ",", "all_pred_time", ",", "all_is_observed", ")", "\n", "return", "concordance", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._concordance.test_concordance_FG": [[50, 54], ["_concordance.concordance", "_concordance.concordance"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._concordance.concordance", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._concordance.concordance"], ["", "def", "test_concordance_FG", "(", "Floader", ",", "Gloader", ",", "Fmodel", ",", "Gmodel", ",", "args", ")", ":", "\n", "    ", "F_conc_te", "=", "concordance", "(", "loader", "=", "Floader", ",", "model", "=", "Fmodel", ",", "args", "=", "args", ",", "is_g", "=", "False", ")", "\n", "G_conc_te", "=", "concordance", "(", "loader", "=", "Gloader", ",", "model", "=", "Gmodel", ",", "args", "=", "args", ",", "is_g", "=", "True", ")", "\n", "return", "F_conc_te", ",", "G_conc_te", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.data_utils.SyntheticDataset.__init__": [[227, 231], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "U", ",", "Delta", ",", "X", ")", ":", "\n", "        ", "self", ".", "X", "=", "X", "\n", "self", ".", "U", "=", "U", "\n", "self", ".", "Delta", "=", "Delta", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.data_utils.SyntheticDataset.__getitem__": [[232, 237], ["None"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "index", ")", ":", "\n", "        ", "u", "=", "self", ".", "U", "[", "index", "]", "\n", "delta", "=", "self", ".", "Delta", "[", "index", "]", "\n", "x", "=", "self", ".", "X", "[", "index", "]", "\n", "return", "u", ",", "delta", ",", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.data_utils.SyntheticDataset.__len__": [[238, 240], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "U", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.data_utils.mean_var_to_alpha_beta": [[17, 21], ["mean.pow"], "function", ["None"], ["def", "mean_var_to_alpha_beta", "(", "mean", ",", "var", ")", ":", "\n", "    ", "alpha", "=", "mean", ".", "pow", "(", "2", ")", "/", "var", "\n", "beta", "=", "mean", "/", "var", "\n", "return", "alpha", ",", "beta", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.data_utils.synthetic_samples_to_loaders": [[22, 107], ["print", "print", "print", "print", "data_utils.synthetic_samples_to_loaders.get_bin_boundaries"], "function", ["None"], ["", "def", "synthetic_samples_to_loaders", "(", "args", ",", "X", ",", "T", ",", "C", ",", "train_N", ",", "valid_N", ")", ":", "\n", "\n", "    ", "print", "(", "\"min T\"", ",", "T", ".", "min", "(", ")", ")", "\n", "print", "(", "\"max T\"", ",", "T", ".", "max", "(", ")", ")", "\n", "print", "(", "\"min C\"", ",", "C", ".", "min", "(", ")", ")", "\n", "print", "(", "\"max C\"", ",", "C", ".", "max", "(", ")", ")", "\n", "\n", "#############################################", "\n", "############### Discrete  ###################", "\n", "#############################################", "\n", "\n", "def", "get_bin_boundaries", "(", "times", ",", "K", ")", ":", "\n", "        ", "percents", "=", "np", ".", "arange", "(", "K", "+", "1", ")", "*", "100.", "/", "K", "\n", "bin_boundaries", "=", "np", ".", "percentile", "(", "times", ",", "percents", ")", "\n", "return", "torch", ".", "tensor", "(", "bin_boundaries", ")", "\n", "\n", "", "boundaries", "=", "get_bin_boundaries", "(", "T", ",", "args", ".", "K", ")", "\n", "\n", "def", "get_bin", "(", "time", ",", "boundaries", ")", ":", "\n", "        ", "original_shape", "=", "time", ".", "shape", "\n", "time", "=", "time", ".", "unsqueeze", "(", "-", "1", ")", "\n", "boundaries_to_consider", "=", "boundaries", "[", "1", ":", "-", "1", "]", "\n", "time_cat", "=", "(", "time", ">", "boundaries_to_consider", ")", "\n", "time_cat", "=", "time_cat", ".", "sum", "(", "-", "1", ")", "\n", "assert", "time_cat", ".", "shape", "==", "original_shape", "\n", "return", "time_cat", "\n", "\n", "# use T boundaries for both", "\n", "", "T_bin", "=", "get_bin", "(", "T", ",", "boundaries", ")", "\n", "C_bin", "=", "get_bin", "(", "C", ",", "boundaries", ")", "\n", "Delta", "=", "T_bin", "<=", "C_bin", "\n", "print", "(", "\" {}  / {} observed \"", ".", "format", "(", "Delta", ".", "sum", "(", ")", ",", "Delta", ".", "shape", "[", "0", "]", ")", ")", "\n", "U_bin", "=", "torch", ".", "where", "(", "Delta", ",", "T_bin", ",", "C_bin", ")", "\n", "\n", "\n", "print", "(", "\"X SHAPE\"", ",", "X", ".", "shape", ")", "\n", "print", "(", "\"T SHAPE\"", ",", "T", ".", "shape", ")", "\n", "print", "(", "\"C SHAPE\"", ",", "C", ".", "shape", ")", "\n", "print", "(", "\"T BIN SHAPE\"", ",", "T_bin", ".", "shape", ")", "\n", "print", "(", "\"C BIN SHAPE\"", ",", "C_bin", ".", "shape", ")", "\n", "print", "(", "\"U BIN SHAPE\"", ",", "U_bin", ".", "shape", ")", "\n", "print", "(", "\"DELTA SHAPE\"", ",", "Delta", ".", "shape", ")", "\n", "\n", "\n", "# TRAIN VALID TEST SPLIT", "\n", "\n", "VAL_SPLIT", "=", "train_N", "\n", "TEST_SPLIT", "=", "train_N", "+", "valid_N", "\n", "\n", "X_tr", "=", "X", "[", ":", "VAL_SPLIT", "]", "\n", "X_va", "=", "X", "[", "VAL_SPLIT", ":", "TEST_SPLIT", "]", "\n", "X_te", "=", "X", "[", "TEST_SPLIT", ":", "]", "\n", "\n", "T_tr", "=", "T_bin", "[", ":", "VAL_SPLIT", "]", "\n", "T_va", "=", "T_bin", "[", "VAL_SPLIT", ":", "TEST_SPLIT", "]", "\n", "T_te", "=", "T_bin", "[", "TEST_SPLIT", ":", "]", "\n", "\n", "C_tr", "=", "C_bin", "[", ":", "VAL_SPLIT", "]", "\n", "C_va", "=", "C_bin", "[", "VAL_SPLIT", ":", "TEST_SPLIT", "]", "\n", "C_te", "=", "C_bin", "[", "TEST_SPLIT", ":", "]", "\n", "\n", "U_tr", "=", "U_bin", "[", ":", "VAL_SPLIT", "]", "\n", "U_va", "=", "U_bin", "[", "VAL_SPLIT", ":", "TEST_SPLIT", "]", "\n", "U_te", "=", "U_bin", "[", "TEST_SPLIT", ":", "]", "\n", "\n", "Delta_tr", "=", "Delta", "[", ":", "VAL_SPLIT", "]", "\n", "Delta_va", "=", "Delta", "[", "VAL_SPLIT", ":", "TEST_SPLIT", "]", "\n", "Delta_te", "=", "Delta", "[", "TEST_SPLIT", ":", "]", "\n", "\n", "trainset", "=", "SyntheticDataset", "(", "U", "=", "U_tr", "[", ":", "args", ".", "N_train", "]", ",", "Delta", "=", "Delta_tr", "[", ":", "args", ".", "N_train", "]", ",", "X", "=", "X_tr", "[", ":", "args", ".", "N_train", "]", ")", "\n", "valset", "=", "SyntheticDataset", "(", "U", "=", "U_va", "[", ":", "args", ".", "N_val", "]", ",", "Delta", "=", "Delta_va", "[", ":", "args", ".", "N_val", "]", ",", "X", "=", "X_va", "[", ":", "args", ".", "N_val", "]", ")", "\n", "testset", "=", "SyntheticDataset", "(", "U", "=", "U_te", "[", ":", "args", ".", "N_test", "]", ",", "Delta", "=", "Delta_te", "[", ":", "args", ".", "N_test", "]", ",", "X", "=", "X_te", "[", ":", "args", ".", "N_test", "]", ")", "\n", "Ftestset", "=", "SyntheticDataset", "(", "U", "=", "T_te", "[", ":", "args", ".", "N_test", "]", ",", "Delta", "=", "torch", ".", "ones_like", "(", "Delta_te", ")", "[", ":", "args", ".", "N_test", "]", ",", "X", "=", "X_te", "[", ":", "args", ".", "N_test", "]", ")", "\n", "Gtestset", "=", "SyntheticDataset", "(", "U", "=", "C_te", "[", ":", "args", ".", "N_test", "]", ",", "Delta", "=", "torch", ".", "zeros_like", "(", "Delta_te", ")", "[", ":", "args", ".", "N_test", "]", ",", "X", "=", "X_te", "[", ":", "args", ".", "N_test", "]", ")", "\n", "\n", "trainloader", "=", "torch", ".", "utils", ".", "data", ".", "DataLoader", "(", "trainset", ",", "batch_size", "=", "args", ".", "train_batch_sz", ",", "num_workers", "=", "args", ".", "num_workers", ",", "shuffle", "=", "True", ")", "\n", "valloader", "=", "torch", ".", "utils", ".", "data", ".", "DataLoader", "(", "valset", ",", "batch_size", "=", "args", ".", "test_batch_sz", ",", "num_workers", "=", "args", ".", "num_workers", ",", "shuffle", "=", "False", ")", "\n", "testloader", "=", "torch", ".", "utils", ".", "data", ".", "DataLoader", "(", "testset", ",", "batch_size", "=", "args", ".", "test_batch_sz", ",", "num_workers", "=", "args", ".", "num_workers", ",", "shuffle", "=", "False", ")", "\n", "Ftestloader", "=", "torch", ".", "utils", ".", "data", ".", "DataLoader", "(", "Ftestset", ",", "batch_size", "=", "args", ".", "test_batch_sz", ",", "num_workers", "=", "args", ".", "num_workers", ",", "shuffle", "=", "False", ")", "\n", "Gtestloader", "=", "torch", ".", "utils", ".", "data", ".", "DataLoader", "(", "Gtestset", ",", "batch_size", "=", "args", ".", "test_batch_sz", ",", "num_workers", "=", "args", ".", "num_workers", ",", "shuffle", "=", "False", ")", "\n", "\n", "assert", "torch", ".", "all", "(", "torch", ".", "eq", "(", "Ftestloader", ".", "dataset", ".", "Delta", ",", "1", ")", ")", "\n", "assert", "torch", ".", "all", "(", "torch", ".", "eq", "(", "Gtestloader", ".", "dataset", ".", "Delta", ",", "0", ")", ")", "\n", "\n", "return", "trainloader", ",", "valloader", ",", "testloader", ",", "Ftestloader", ",", "Gtestloader", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.data_utils.make_mnist_loaders": [[112, 162], ["torchvision.transforms.Compose", "torchvision.datasets.MNIST", "torchvision.datasets.MNIST", "data_utils.make_mnist_loaders.dset_to_xy"], "function", ["None"], ["", "def", "make_mnist_loaders", "(", "args", ")", ":", "\n", "\n", "\n", "    ", "transform", "=", "transforms", ".", "Compose", "(", "[", "transforms", ".", "ToTensor", "(", ")", ",", "transforms", ".", "Normalize", "(", "(", "0.1307", ",", ")", ",", "(", "0.3081", ",", ")", ")", "]", ")", "\n", "mnist_train", "=", "datasets", ".", "MNIST", "(", "'./data'", ",", "train", "=", "True", ",", "download", "=", "True", ",", "transform", "=", "transform", ")", "\n", "mnist_test", "=", "datasets", ".", "MNIST", "(", "'./data'", ",", "train", "=", "False", ",", "transform", "=", "transform", ")", "\n", "\n", "def", "dset_to_xy", "(", "mnist", ")", ":", "\n", "        ", "xlist", "=", "[", "]", "\n", "ylist", "=", "[", "]", "\n", "for", "x", ",", "y", "in", "mnist", ":", "\n", "            ", "xlist", ".", "append", "(", "x", ".", "clone", "(", ")", ".", "numpy", "(", ")", ")", "\n", "ylist", ".", "append", "(", "np", ".", "array", "(", "y", ")", ")", "\n", "", "return", "np", ".", "array", "(", "xlist", ")", ",", "np", ".", "array", "(", "ylist", ")", "\n", "\n", "", "X_tr", ",", "Y_tr", "=", "dset_to_xy", "(", "mnist_train", ")", "\n", "X_te", ",", "Y_te", "=", "dset_to_xy", "(", "mnist_test", ")", "\n", "\n", "train_N", "=", "Y_tr", ".", "shape", "[", "0", "]", "\n", "valtest_N", "=", "Y_te", ".", "shape", "[", "0", "]", "\n", "val_N", "=", "int", "(", "0.5", "*", "valtest_N", ")", "\n", "test_N", "=", "valtest_N", "-", "val_N", "\n", "\n", "X", "=", "np", ".", "concatenate", "(", "(", "X_tr", ",", "X_te", ")", ",", "axis", "=", "0", ")", "\n", "Y", "=", "np", ".", "concatenate", "(", "(", "Y_tr", ",", "Y_te", ")", ",", "axis", "=", "0", ")", "\n", "\n", "\n", "X", "=", "torch", ".", "tensor", "(", "X", ")", "\n", "Y", "=", "torch", ".", "tensor", "(", "Y", ")", "\n", "\n", "def", "sim_times", "(", "y", ")", ":", "\n", "\n", "        ", "coef_T", "=", "10.0", "\n", "coef_C", "=", "9.9", "\n", "mean_T", "=", "(", "coef_T", "*", "(", "y", "+", "1", ")", ")", "\n", "mean_C", "=", "(", "coef_C", "*", "(", "y", "+", "1", ")", ")", "\n", "args", ".", "conditional_var", "=", "0.05", "\n", "a_T", ",", "b_T", "=", "mean_var_to_alpha_beta", "(", "mean_T", ",", "args", ".", "conditional_var", ")", "\n", "a_C", ",", "b_C", "=", "mean_var_to_alpha_beta", "(", "mean_C", ",", "args", ".", "conditional_var", ")", "\n", "T", "=", "p_T", "=", "torch", ".", "distributions", ".", "Gamma", "(", "a_T", ",", "b_T", ")", ".", "sample", "(", ")", "\n", "C", "=", "p_C", "=", "torch", ".", "distributions", ".", "Gamma", "(", "a_C", ",", "b_C", ")", ".", "sample", "(", ")", "\n", "return", "T", ",", "C", "\n", "\n", "", "T", ",", "C", "=", "sim_times", "(", "Y", ")", "\n", "print", "(", "\"min T\"", ",", "T", ".", "min", "(", ")", ")", "\n", "print", "(", "\"max T\"", ",", "T", ".", "max", "(", ")", ")", "\n", "print", "(", "\"min C\"", ",", "C", ".", "min", "(", ")", ")", "\n", "print", "(", "\"max C\"", ",", "C", ".", "max", "(", ")", ")", "\n", "#X = torch.tensor(X)", "\n", "return", "synthetic_samples_to_loaders", "(", "args", ",", "X", ",", "T", ",", "C", ",", "train_N", ",", "val_N", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.data_utils.make_gamma_loaders": [[164, 218], ["torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "MVN", "MVN.sample", "data_utils.make_gamma_loaders.x_to_gamma_dist"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.sample"], ["", "def", "make_gamma_loaders", "(", "args", ")", ":", "\n", "\n", "    ", "args", ".", "D", "=", "32", "\n", "args", ".", "N", "=", "10000", "\n", "args", ".", "conditional_var", "=", "0.05", "\n", "args", ".", "x_var", "=", "10.0", "\n", "\n", "MVN", "=", "torch", ".", "distributions", ".", "MultivariateNormal", "\n", "\n", "def", "bad", "(", "a", ")", ":", "\n", "        ", "return", "torch", ".", "any", "(", "torch", ".", "isnan", "(", "a", ")", ")", "\n", "\n", "\n", "", "def", "x_to_gamma_dist", "(", "x", ")", ":", "\n", "        ", "weight_scale", "=", "0.1", "\n", "w_T", "=", "torch", ".", "rand", "(", "args", ".", "D", ")", "*", "weight_scale", "\n", "w0_T", "=", "torch", ".", "rand", "(", "1", ")", "*", "weight_scale", "\n", "w_C", "=", "torch", ".", "rand", "(", "args", ".", "D", ")", "*", "weight_scale", "\n", "w0_C", "=", "torch", ".", "rand", "(", "1", ")", "*", "weight_scale", "\n", "print", "(", "\"X shape\"", ",", "x", ".", "shape", ")", "\n", "print", "(", "\"w_T shape\"", ",", "w_T", ".", "shape", ")", "\n", "mean_T", "=", "(", "(", "x", "*", "w_T", ")", ".", "sum", "(", "-", "1", ")", "+", "w0_T", ")", ".", "exp", "(", ")", "\n", "#mean_C = ((x*w_C).sum(-1) + w0_C).exp() * 0.05", "\n", "mean_C", "=", "mean_T", "*", "0.9", "\n", "print", "(", "\"mean T shape\"", ",", "mean_T", ".", "shape", ")", "\n", "a_T", ",", "b_T", "=", "mean_var_to_alpha_beta", "(", "mean_T", ",", "args", ".", "conditional_var", ")", "\n", "a_C", ",", "b_C", "=", "mean_var_to_alpha_beta", "(", "mean_C", ",", "args", ".", "conditional_var", ")", "\n", "p_T", "=", "torch", ".", "distributions", ".", "Gamma", "(", "a_T", ",", "b_T", ")", "\n", "p_C", "=", "torch", ".", "distributions", ".", "Gamma", "(", "a_C", ",", "b_C", ")", "\n", "return", "p_T", ",", "p_C", "\n", "\n", "############################################", "\n", "############### SET SIZES  #################", "\n", "#############################################", "\n", "\n", "", "train_N", "=", "args", ".", "N", "//", "2", "\n", "valid_N", "=", "train_N", "//", "2", "\n", "test_N", "=", "valid_N", "\n", "N", "=", "train_N", "+", "valid_N", "+", "test_N", "\n", "\n", "############################################", "\n", "############### MAKE X  #####################", "\n", "#############################################", "\n", "x_scale", "=", "5.0", "\n", "x_scale", "=", "torch", ".", "sqrt", "(", "torch", ".", "tensor", "(", "[", "args", ".", "x_var", "]", ")", ")", "\n", "x_dist", "=", "MVN", "(", "loc", "=", "torch", ".", "zeros", "(", "args", ".", "D", ")", ",", "covariance_matrix", "=", "x_scale", "*", "torch", ".", "eye", "(", "args", ".", "D", ")", ")", "\n", "X", "=", "x_dist", ".", "sample", "(", "sample_shape", "=", "(", "N", ",", ")", ")", "\n", "#############################################", "\n", "############### MAKE P(T,C)  ################", "\n", "#############################################", "\n", "p_T", ",", "p_C", "=", "x_to_gamma_dist", "(", "X", ")", "\n", "T", "=", "p_T", ".", "sample", "(", ")", "\n", "C", "=", "p_C", ".", "sample", "(", ")", "\n", "return", "synthetic_samples_to_loaders", "(", "args", ",", "X", ",", "T", ",", "C", ",", "train_N", ",", "valid_N", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.data_utils.make_real_loaders": [[242, 250], ["data_utils.file_to_dataset", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.data_utils.file_to_dataset"], ["", "", "def", "make_real_loaders", "(", "args", ",", "mode", "=", "'normal'", ")", ":", "\n", "    ", "assert", "args", ".", "dataset", "in", "args", ".", "realsets", "\n", "fname", "=", "'data/'", "+", "args", ".", "dataset", "+", "'.csv'", "\n", "trainset", ",", "valset", ",", "testset", "=", "file_to_dataset", "(", "fname", ",", "args", ")", "\n", "trainloader", "=", "torch", ".", "utils", ".", "data", ".", "DataLoader", "(", "trainset", ",", "batch_size", "=", "args", ".", "train_batch_sz", ",", "num_workers", "=", "args", ".", "num_workers", ",", "shuffle", "=", "True", ")", "\n", "valloader", "=", "torch", ".", "utils", ".", "data", ".", "DataLoader", "(", "valset", ",", "batch_size", "=", "args", ".", "test_batch_sz", ",", "num_workers", "=", "args", ".", "num_workers", ",", "shuffle", "=", "False", ")", "\n", "testloader", "=", "torch", ".", "utils", ".", "data", ".", "DataLoader", "(", "testset", ",", "batch_size", "=", "args", ".", "test_batch_sz", ",", "num_workers", "=", "args", ".", "num_workers", ",", "shuffle", "=", "False", ")", "\n", "return", "trainloader", ",", "valloader", ",", "testloader", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.data_utils.tensors_to_dataset": [[252, 263], ["X.float.float", "U.long.long", "Delta.bool.bool", "data_utils.SyntheticDataset"], "function", ["None"], ["", "def", "tensors_to_dataset", "(", "X", ",", "U", ",", "Delta", ",", "phase", ",", "args", ")", ":", "\n", "    ", "N_full", "=", "X", ".", "shape", "[", "0", "]", "\n", "if", "phase", "==", "'train'", ":", "\n", "        ", "N", "=", "args", ".", "N_train", "\n", "", "elif", "phase", "in", "[", "'val'", ",", "'test'", "]", ":", "\n", "        ", "N", "=", "N_full", "\n", "", "X", "=", "X", ".", "float", "(", ")", "\n", "U", "=", "U", ".", "long", "(", ")", "\n", "Delta", "=", "Delta", ".", "bool", "(", ")", "\n", "dataset", "=", "SyntheticDataset", "(", "U", "=", "U", "[", ":", "N", "]", ",", "Delta", "=", "Delta", "[", ":", "N", "]", ",", "X", "=", "X", "[", ":", "N", "]", ")", "\n", "return", "dataset", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.data_utils.file_to_dataset": [[264, 350], ["print", "pandas.read_csv", "df.drop.drop", "df.drop.drop", "print", "print", "print", "print", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor().bool", "torch.tensor().bool", "torch.tensor().bool", "torch.tensor().bool", "torch.tensor().float", "torch.tensor().float", "torch.tensor().float", "torch.tensor().float", "print", "print", "print", "print", "print", "print", "data_utils.synthetic_samples_to_loaders.get_bin_boundaries"], "function", ["None"], ["", "def", "file_to_dataset", "(", "fname", ",", "args", ")", ":", "\n", "    ", "K", "=", "args", ".", "K", "\n", "print", "(", "\"fname\"", ",", "fname", ")", "\n", "df", "=", "pd", ".", "read_csv", "(", "fname", ")", "\n", "\n", "cols_to_drop", "=", "[", "c", "for", "c", "in", "df", ".", "columns", "if", "'Unnamed'", "in", "c", "]", "\n", "df", "=", "df", ".", "drop", "(", "columns", "=", "cols_to_drop", ")", "\n", "\n", "df_u", "=", "df", "[", "'duration'", "]", "\n", "df_delta", "=", "df", "[", "'event'", "]", "\n", "df_x", "=", "df", ".", "drop", "(", "columns", "=", "[", "'duration'", ",", "'event'", "]", ")", "\n", "print", "(", "\"x columns\"", ",", "df_x", ".", "columns", ")", "\n", "print", "(", "df_u", ".", "shape", ")", "\n", "print", "(", "df_delta", ".", "shape", ")", "\n", "print", "(", "df_x", ".", "shape", ")", "\n", "u", "=", "torch", ".", "tensor", "(", "df_u", ".", "to_numpy", "(", ")", ")", "\n", "delta", "=", "torch", ".", "tensor", "(", "df_delta", ".", "to_numpy", "(", ")", ")", ".", "bool", "(", ")", "\n", "x", "=", "torch", ".", "tensor", "(", "df_x", ".", "to_numpy", "(", ")", ")", ".", "float", "(", ")", "\n", "assert", "not", "torch", ".", "any", "(", "torch", ".", "isnan", "(", "u", ")", ")", "\n", "assert", "not", "torch", ".", "any", "(", "torch", ".", "isnan", "(", "delta", ")", ")", "\n", "assert", "not", "torch", ".", "any", "(", "torch", ".", "isnan", "(", "x", ")", ")", "\n", "\n", "def", "get_bin_boundaries", "(", "times", ",", "K", ")", ":", "\n", "        ", "percents", "=", "np", ".", "arange", "(", "K", "+", "1", ")", "*", "100.", "/", "K", "\n", "bin_boundaries", "=", "np", ".", "percentile", "(", "times", ",", "percents", ")", "\n", "return", "torch", ".", "tensor", "(", "bin_boundaries", ")", "\n", "\n", "", "t", "=", "u", "[", "delta", "]", "\n", "c", "=", "u", "[", "~", "delta", "]", "\n", "print", "(", "get_bin_boundaries", "(", "t", ",", "K", ")", ")", "\n", "print", "(", "get_bin_boundaries", "(", "c", ",", "K", ")", ")", "\n", "print", "(", "\"t min\"", ",", "t", ".", "min", "(", ")", ")", "\n", "print", "(", "\"t max\"", ",", "t", ".", "max", "(", ")", ")", "\n", "print", "(", "\"c min\"", ",", "c", ".", "min", "(", ")", ")", "\n", "print", "(", "\"c max\"", ",", "c", ".", "max", "(", ")", ")", "\n", "boundaries", "=", "get_bin_boundaries", "(", "t", ",", "K", ")", "\n", "\n", "def", "get_bin", "(", "time", ",", "boundaries", ")", ":", "\n", "        ", "original_shape", "=", "time", ".", "shape", "\n", "time", "=", "time", ".", "unsqueeze", "(", "-", "1", ")", "\n", "boundaries_to_consider", "=", "boundaries", "[", "1", ":", "-", "1", "]", "\n", "time_cat", "=", "(", "time", ">", "boundaries_to_consider", ")", "\n", "time_cat", "=", "time_cat", ".", "sum", "(", "-", "1", ")", "\n", "assert", "time_cat", ".", "shape", "==", "original_shape", "\n", "return", "time_cat", "\n", "\n", "", "u", "=", "get_bin", "(", "u", ",", "boundaries", ")", "\n", "print", "(", "\"delta=1: {}/{}\"", ".", "format", "(", "delta", ".", "sum", "(", ")", ",", "delta", ".", "shape", "[", "0", "]", ")", ")", "\n", "\n", "N", "=", "u", ".", "shape", "[", "0", "]", "\n", "p", "=", "np", ".", "random", ".", "permutation", "(", "N", ")", "\n", "u", "=", "u", "[", "p", "]", "\n", "delta", "=", "delta", "[", "p", "]", "\n", "x", "=", "x", "[", "p", "]", "\n", "\n", "N_train", "=", "int", "(", "0.6", "*", "N", ")", "\n", "N_val", "=", "int", "(", "0.2", "*", "N", ")", "\n", "\n", "TRAIN_SPLIT", "=", "N_train", "\n", "VAL_SPLIT", "=", "N_train", "+", "N_val", "\n", "\n", "utr", "=", "u", "[", ":", "TRAIN_SPLIT", "]", "\n", "uva", "=", "u", "[", "TRAIN_SPLIT", ":", "VAL_SPLIT", "]", "\n", "ute", "=", "u", "[", "VAL_SPLIT", ":", "]", "\n", "\n", "deltatr", "=", "delta", "[", ":", "TRAIN_SPLIT", "]", "\n", "deltava", "=", "delta", "[", "TRAIN_SPLIT", ":", "VAL_SPLIT", "]", "\n", "deltate", "=", "delta", "[", "VAL_SPLIT", ":", "]", "\n", "\n", "xtr", "=", "x", "[", ":", "TRAIN_SPLIT", "]", "\n", "xva", "=", "x", "[", "TRAIN_SPLIT", ":", "VAL_SPLIT", "]", "\n", "xte", "=", "x", "[", "VAL_SPLIT", ":", "]", "\n", "\n", "def", "standardize", "(", "x", ",", "mu_train", ",", "std_train", ",", "eps", "=", "1e-4", ")", ":", "\n", "        ", "return", "(", "x", "-", "mu_train", ")", "/", "(", "std_train", "+", "eps", ")", "\n", "\n", "", "mu_tr", "=", "xtr", ".", "mean", "(", "dim", "=", "0", ",", "keepdim", "=", "True", ")", "\n", "std_tr", "=", "xtr", ".", "std", "(", "dim", "=", "0", ",", "keepdim", "=", "True", ")", "\n", "\n", "xtr", "=", "standardize", "(", "xtr", ",", "mu_tr", ",", "std_tr", ")", "\n", "xva", "=", "standardize", "(", "xva", ",", "mu_tr", ",", "std_tr", ")", "\n", "xte", "=", "standardize", "(", "xte", ",", "mu_tr", ",", "std_tr", ")", "\n", "trainset", "=", "tensors_to_dataset", "(", "xtr", ",", "utr", ",", "deltatr", ",", "'train'", ",", "args", ")", "\n", "valset", "=", "tensors_to_dataset", "(", "xva", ",", "uva", ",", "deltava", ",", "'val'", ",", "args", ")", "\n", "testset", "=", "tensors_to_dataset", "(", "xte", ",", "ute", ",", "deltate", ",", "'test'", ",", "args", ")", "\n", "return", "trainset", ",", "valset", ",", "testset", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._nll.nll_batch": [[19, 38], ["torch.eq", "torch.eq", "util.isnan", "torch.where.mean", "dist.log_pmf", "torch.where", "torch.where", "torch.where", "torch.where", "util.safe_log", "util.safe_log", "dist.cdf", "dist.cdf"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.eq", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.eq", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.isnan", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.log_pmf", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.safe_log", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.safe_log", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.cdf", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.cdf"], ["def", "nll_batch", "(", "tgt", ",", "dist", ",", "args", ",", "is_g", ")", ":", "\n", "    ", "U", ",", "Delta", "=", "tgt", "\n", "U_bin", "=", "U", "# data already discrete", "\n", "MAX_BIN_IDX", "=", "args", ".", "K", "-", "1", "\n", "U_max", "=", "torch", ".", "eq", "(", "U_bin", ",", "MAX_BIN_IDX", ")", "\n", "pmf_term", "=", "-", "1.0", "*", "dist", ".", "log_pmf", "(", "U", ")", "\n", "\n", "if", "not", "is_g", ":", "\n", "        ", "survivor_term", "=", "-", "1.0", "*", "util", ".", "safe_log", "(", "1.", "-", "dist", ".", "cdf", "(", "U", ",", "_1m", "=", "False", ")", ",", "args", ".", "logeps", ")", "\n", "nll", "=", "torch", ".", "where", "(", "Delta", "|", "U_max", ",", "pmf_term", ",", "survivor_term", ")", "\n", "", "else", ":", "\n", "        ", "survivor_term", "=", "-", "1.0", "*", "util", ".", "safe_log", "(", "1.", "-", "dist", ".", "cdf", "(", "U", ",", "_1m", "=", "True", ")", ",", "args", ".", "logeps", ")", "\n", "nll", "=", "torch", ".", "where", "(", "~", "Delta", ",", "pmf_term", ",", "survivor_term", ")", "\n", "\n", "", "if", "util", ".", "isnan", "(", "nll", ")", ":", "\n", "        ", "assert", "False", ",", "\"nll nan\"", "\n", "\n", "", "nll", "=", "nll", ".", "mean", "(", "0", ")", "\n", "return", "nll", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._nll.nll": [[42, 59], ["util.Meter", "enumerate", "util.Meter.avg", "U.to.to", "Delta.to.to", "X.to.to", "util.X_to_dist", "_nll.nll_batch", "util.Meter.update", "U.to.size", "optimizer.zero_grad", "nll_batch.backward", "optimizer.step", "nll_batch.item"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.Meter.avg", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.X_to_dist", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._nll.nll_batch", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.Meter.update"], ["", "def", "nll", "(", "phase", ",", "loader", ",", "model", ",", "optimizer", "=", "None", ",", "args", "=", "None", ",", "is_g", "=", "False", ")", ":", "\n", "    ", "loss_meter", "=", "util", ".", "Meter", "(", ")", "\n", "for", "batch_idx", ",", "batch", "in", "enumerate", "(", "loader", ")", ":", "\n", "        ", "(", "U", ",", "Delta", ",", "X", ")", "=", "batch", "\n", "U", "=", "U", ".", "to", "(", "args", ".", "device", ")", "\n", "Delta", "=", "Delta", ".", "to", "(", "args", ".", "device", ")", "\n", "X", "=", "X", ".", "to", "(", "args", ".", "device", ")", "\n", "tgt", "=", "(", "U", ",", "Delta", ")", "\n", "bsz", "=", "U", ".", "size", "(", ")", "[", "0", "]", "\n", "dist", "=", "util", ".", "X_to_dist", "(", "X", ",", "model", ",", "args", ")", "\n", "loss", "=", "nll_batch", "(", "tgt", ",", "dist", ",", "args", ",", "is_g", "=", "is_g", ")", "\n", "if", "phase", "==", "'train'", ":", "\n", "            ", "optimizer", ".", "zero_grad", "(", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "optimizer", ".", "step", "(", ")", "\n", "", "loss_meter", ".", "update", "(", "val", "=", "loss", ".", "item", "(", ")", "*", "bsz", ",", "N", "=", "bsz", ")", "\n", "", "return", "loss_meter", ".", "avg", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._nll.nll_FG": [[61, 65], ["_nll.nll", "_nll.nll"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._nll.nll", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._nll.nll"], ["", "def", "nll_FG", "(", "phase", ",", "loader", ",", "Fmodel", ",", "Gmodel", ",", "args", ",", "Foptimizer", "=", "None", ",", "Goptimizer", "=", "None", ")", ":", "\n", "    ", "fnll", "=", "nll", "(", "phase", ",", "loader", ",", "Fmodel", ",", "Foptimizer", ",", "args", ",", "is_g", "=", "False", ")", "\n", "gnll", "=", "nll", "(", "phase", ",", "loader", ",", "Gmodel", ",", "Goptimizer", ",", "args", ",", "is_g", "=", "True", ")", "\n", "return", "fnll", ",", "gnll", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._saver.ModelSaver.__init__": [[13, 42], ["object.__init__", "os.path.join", "Path().mkdir", "os.path.join", "os.path.join", "print", "print", "print", "print", "os.path.exists", "os.makedirs", "Path"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.Meter.__init__"], ["    ", "def", "__init__", "(", "self", ",", "args", ",", "is_g", "=", "False", ")", ":", "\n", "        ", "super", "(", "ModelSaver", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "save_dir", "=", "args", ".", "save_dir", "\n", "self", ".", "ckpt_basename", "=", "args", ".", "ckpt_basename", "\n", "self", ".", "is_g", "=", "is_g", "\n", "self", ".", "best_metric_val", "=", "None", "\n", "self", ".", "minimize", "=", "True", "\n", "self", ".", "best_epoch", "=", "0", "\n", "self", ".", "args", "=", "args", "\n", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "self", ".", "save_dir", ")", ":", "\n", "            ", "os", ".", "makedirs", "(", "self", ".", "save_dir", ")", "\n", "", "dirr", "=", "os", ".", "path", ".", "join", "(", "self", ".", "save_dir", ",", "self", ".", "ckpt_basename", ")", "\n", "from", "pathlib", "import", "Path", "\n", "Path", "(", "dirr", ")", ".", "mkdir", "(", "parents", "=", "True", ",", "exist_ok", "=", "True", ")", "\n", "\n", "\n", "suffix", "=", "'_G'", "if", "is_g", "else", "'_F'", "\n", "\n", "self", ".", "best_path", "=", "os", ".", "path", ".", "join", "(", "dirr", ",", "\n", "self", ".", "ckpt_basename", "+", "suffix", "+", "'_best.pth.tar'", ")", "\n", "\n", "self", ".", "epoch_path", "=", "os", ".", "path", ".", "join", "(", "dirr", ",", "\n", "self", ".", "ckpt_basename", "+", "suffix", "+", "'_epoch{}.pth.tar'", ")", "\n", "\n", "print", "(", "\"Saver\"", ")", "\n", "print", "(", "\"Is g {}\"", ".", "format", "(", "is_g", ")", ")", "\n", "print", "(", "\"Best path\"", ",", "self", ".", "best_path", ")", "\n", "print", "(", "\"Epoch path\"", ",", "self", ".", "epoch_path", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._saver.ModelSaver._is_best": [[44, 48], ["None"], "methods", ["None"], ["", "def", "_is_best", "(", "self", ",", "metric_val", ")", ":", "\n", "        ", "if", "metric_val", "is", "None", ":", "\n", "            ", "return", "False", "\n", "", "return", "self", ".", "best_metric_val", "is", "None", "or", "metric_val", "<", "self", ".", "best_metric_val", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._saver.ModelSaver.always_save": [[50, 57], ["_saver.ModelSaver.epoch_path.format", "copy.deepcopy", "torch.save", "torch.save", "torch.save", "torch.save", "copy.deepcopy.to().state_dict", "copy.deepcopy.to"], "methods", ["None"], ["", "def", "always_save", "(", "self", ",", "epoch", ",", "model", ")", ":", "\n", "        ", "pth", "=", "self", ".", "epoch_path", ".", "format", "(", "epoch", ")", "\n", "#print(\"Saving {}\".format(pth))", "\n", "model_copy", "=", "copy", ".", "deepcopy", "(", "model", ")", "\n", "ckpt_dict", "=", "{", "'model_state'", ":", "model_copy", ".", "to", "(", "'cpu'", ")", ".", "state_dict", "(", ")", "}", "\n", "torch", ".", "save", "(", "ckpt_dict", ",", "pth", ")", "\n", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._saver.ModelSaver.maybe_save": [[59, 70], ["_saver.ModelSaver._is_best", "copy.deepcopy", "torch.save", "torch.save", "torch.save", "torch.save", "copy.deepcopy.to().state_dict", "copy.deepcopy.to"], "methods", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._saver.ModelSaver._is_best"], ["", "def", "maybe_save", "(", "self", ",", "epoch", ",", "model", ",", "metric_val", ")", ":", "\n", "        ", "if", "self", ".", "_is_best", "(", "metric_val", ")", ":", "\n", "#print(\"Saving {}\".format(self.best_path))", "\n", "            ", "self", ".", "best_metric_val", "=", "metric_val", "\n", "self", ".", "best_epoch", "=", "epoch", "\n", "model_copy", "=", "copy", ".", "deepcopy", "(", "model", ")", "\n", "ckpt_dict", "=", "{", "'model_state'", ":", "model_copy", ".", "to", "(", "'cpu'", ")", ".", "state_dict", "(", ")", "}", "\n", "torch", ".", "save", "(", "ckpt_dict", ",", "self", ".", "best_path", ")", "\n", "return", "True", "\n", "", "else", ":", "\n", "            ", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._saver.ModelSaver.load_best": [[72, 78], ["print", "torch.load", "torch.load", "torch.load", "torch.load", "_saver.ModelSaver.args.model_fn", "_saver.ModelSaver.load_state_dict"], "methods", ["None"], ["", "", "def", "load_best", "(", "self", ")", ":", "\n", "        ", "print", "(", "\"Loading Model From Epoch {} From File {}\"", ".", "format", "(", "self", ".", "best_epoch", ",", "self", ".", "best_path", ")", ")", "\n", "ckpt_dict", "=", "torch", ".", "load", "(", "self", ".", "best_path", ",", "map_location", "=", "self", ".", "args", ".", "device", ")", "\n", "model", "=", "self", ".", "args", ".", "model_fn", "(", "self", ".", "args", ")", "\n", "model", ".", "load_state_dict", "(", "ckpt_dict", "[", "'model_state'", "]", ")", "\n", "return", "model", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._km.Meter.__init__": [[44, 47], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "N", "=", "0", "\n", "self", ".", "total", "=", "0", "\n", "", "def", "update", "(", "self", ",", "val", ",", "N", ")", ":", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._km.Meter.update": [[47, 50], ["None"], "methods", ["None"], ["", "def", "update", "(", "self", ",", "val", ",", "N", ")", ":", "\n", "        ", "self", ".", "total", "+=", "val", "\n", "self", ".", "N", "+=", "N", "\n", "", "def", "avg", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._km.Meter.avg": [[50, 52], ["round"], "methods", ["None"], ["", "def", "avg", "(", "self", ")", ":", "\n", "        ", "return", "round", "(", "self", ".", "total", "/", "self", ".", "N", ",", "4", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._km.str_to_bool": [[17, 30], ["arg.lower", "arg.lower", "argparse.ArgumentTypeError"], "function", ["None"], ["def", "str_to_bool", "(", "arg", ")", ":", "\n", "    ", "\"\"\"Convert an argument string into its boolean value.\n    Args:\n        arg: String representing a bool.\n    Returns:\n        Boolean value for the string.\n    \"\"\"", "\n", "if", "arg", ".", "lower", "(", ")", "in", "(", "'yes'", ",", "'true'", ",", "'t'", ",", "'y'", ",", "'1'", ")", ":", "\n", "        ", "return", "True", "\n", "", "elif", "arg", ".", "lower", "(", ")", "in", "(", "'no'", ",", "'false'", ",", "'f'", ",", "'n'", ",", "'0'", ")", ":", "\n", "        ", "return", "False", "\n", "", "else", ":", "\n", "        ", "raise", "argparse", ".", "ArgumentTypeError", "(", "'Boolean value expected.'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._km.isnan": [[31, 33], ["torch.any", "torch.any", "torch.isnan", "torch.isnan"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.isnan", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.isnan"], ["", "", "def", "isnan", "(", "x", ")", ":", "\n", "    ", "return", "torch", ".", "any", "(", "torch", ".", "isnan", "(", "x", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._km.safe_log": [[34, 36], ["None"], "function", ["None"], ["", "def", "safe_log", "(", "x", ",", "eps", ")", ":", "\n", "    ", "return", "(", "x", "+", "eps", ")", ".", "log", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._km.clip": [[37, 39], ["prob.clamp"], "function", ["None"], ["", "def", "clip", "(", "prob", ",", "clip_min", ")", ":", "\n", "    ", "return", "prob", ".", "clamp", "(", "min", "=", "clip_min", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._km.round3": [[40, 42], ["round"], "function", ["None"], ["", "def", "round3", "(", "x", ")", ":", "\n", "    ", "return", "round", "(", "x", ",", "3", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._km.cdfvals_to_probs": [[61, 69], ["torch.zeros_like().to", "torch.zeros_like().to", "range", "Gprobs[].sum", "torch.zeros_like", "torch.zeros_like"], "function", ["None"], ["", "", "def", "cdfvals_to_probs", "(", "cdfvals", ",", "args", ")", ":", "\n", "    ", "K", "=", "cdfvals", ".", "shape", "[", "1", "]", "\n", "Gprobs", "=", "torch", ".", "zeros_like", "(", "cdfvals", ")", ".", "to", "(", "args", ".", "device", ")", "\n", "Gprobs", "[", ":", ",", "0", "]", "=", "cdfvals", "[", ":", ",", "0", "]", "\n", "for", "k", "in", "range", "(", "1", ",", "K", "-", "1", ")", ":", "\n", "        ", "Gprobs", "[", ":", ",", "k", "]", "=", "cdfvals", "[", ":", ",", "k", "]", "-", "cdfvals", "[", ":", ",", "k", "-", "1", "]", "\n", "", "Gprobs", "[", ":", ",", "K", "-", "1", "]", "=", "1", "-", "(", "Gprobs", "[", ":", ",", ":", "K", "-", "1", "]", ")", ".", "sum", "(", "-", "1", ")", "\n", "return", "Gprobs", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._km.cdfvals_to_dist": [[70, 76], ["cdfvals.unsqueeze().repeat.unsqueeze().repeat", "_km.cdfvals_to_probs", "torch.all", "torch.all", "catdist.CatDist", "cdfvals.unsqueeze().repeat.unsqueeze", "cdfvals_to_probs.sum"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._km.cdfvals_to_probs"], ["", "def", "cdfvals_to_dist", "(", "cdfvals", ",", "bsz", ",", "args", ")", ":", "\n", "    ", "cdfvals", "=", "cdfvals", ".", "unsqueeze", "(", "0", ")", ".", "repeat", "(", "bsz", ",", "1", ")", "\n", "Gprobs", "=", "cdfvals_to_probs", "(", "cdfvals", ",", "args", ")", "\n", "assert", "torch", ".", "all", "(", "(", "Gprobs", ".", "sum", "(", "-", "1", ")", "-", "1.0", ")", ".", "abs", "(", ")", "<", "1e-4", ")", "\n", "Gdist", "=", "catdist", ".", "CatDist", "(", "logits", "=", "None", ",", "args", "=", "args", ",", "probs", "=", "Gprobs", ",", "k", "=", "None", ")", "\n", "return", "Gdist", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._km.get_KM_cdfvals": [[77, 94], ["u.cpu().numpy", "km().to_numpy", "numpy.sort", "torch.zeros().to", "torch.zeros().to", "enumerate", "enumerate", "delta.cpu().numpy", "numpy.unique", "u.cpu", "km", "torch.zeros", "torch.zeros", "delta.cpu"], "function", ["None"], ["", "def", "get_KM_cdfvals", "(", "loader", ",", "args", ")", ":", "\n", "    ", "u", "=", "loader", ".", "dataset", ".", "U", "\n", "delta", "=", "loader", ".", "dataset", ".", "Delta", "\n", "durations", "=", "u", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "is_censored", "=", "~", "delta", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "km", "=", "pycox", ".", "utils", ".", "kaplan_meier", "\n", "surv_func", "=", "km", "(", "durations", ",", "is_censored", ")", ".", "to_numpy", "(", ")", "\n", "cdf_func", "=", "1.", "-", "surv_func", "\n", "km_support", "=", "np", ".", "sort", "(", "np", ".", "unique", "(", "durations", ")", ")", "\n", "cdfvals", "=", "torch", ".", "zeros", "(", "args", ".", "K", ")", ".", "to", "(", "args", ".", "device", ")", "\n", "for", "i", ",", "val", "in", "enumerate", "(", "km_support", ")", ":", "\n", "        ", "cdfvals", "[", "val", "]", "=", "cdf_func", "[", "i", "]", "\n", "", "for", "i", ",", "val", "in", "enumerate", "(", "cdfvals", ")", ":", "\n", "        ", "if", "i", ">", "0", ":", "\n", "            ", "if", "val", "==", "0.0", ":", "\n", "                ", "cdfvals", "[", "i", "]", "=", "cdfvals", "[", "i", "-", "1", "]", "\n", "", "", "", "return", "cdfvals", "\n", "", ""]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.Meter.__init__": [[43, 46], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "N", "=", "0", "\n", "self", ".", "total", "=", "0", "\n", "", "def", "update", "(", "self", ",", "val", ",", "N", ")", ":", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.Meter.update": [[46, 49], ["None"], "methods", ["None"], ["", "def", "update", "(", "self", ",", "val", ",", "N", ")", ":", "\n", "        ", "self", ".", "total", "+=", "val", "\n", "self", ".", "N", "+=", "N", "\n", "", "def", "avg", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.Meter.avg": [[49, 51], ["round"], "methods", ["None"], ["", "def", "avg", "(", "self", ")", ":", "\n", "        ", "return", "round", "(", "self", ".", "total", "/", "self", ".", "N", ",", "4", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.str_to_bool": [[16, 29], ["arg.lower", "arg.lower", "argparse.ArgumentTypeError"], "function", ["None"], ["def", "str_to_bool", "(", "arg", ")", ":", "\n", "    ", "\"\"\"Convert an argument string into its boolean value.\n    Args:\n        arg: String representing a bool.\n    Returns:\n        Boolean value for the string.\n    \"\"\"", "\n", "if", "arg", ".", "lower", "(", ")", "in", "(", "'yes'", ",", "'true'", ",", "'t'", ",", "'y'", ",", "'1'", ")", ":", "\n", "        ", "return", "True", "\n", "", "elif", "arg", ".", "lower", "(", ")", "in", "(", "'no'", ",", "'false'", ",", "'f'", ",", "'n'", ",", "'0'", ")", ":", "\n", "        ", "return", "False", "\n", "", "else", ":", "\n", "        ", "raise", "argparse", ".", "ArgumentTypeError", "(", "'Boolean value expected.'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.isnan": [[30, 32], ["torch.any", "torch.any", "torch.isnan", "torch.isnan"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.isnan", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.isnan"], ["", "", "def", "isnan", "(", "x", ")", ":", "\n", "    ", "return", "torch", ".", "any", "(", "torch", ".", "isnan", "(", "x", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.safe_log": [[33, 35], ["None"], "function", ["None"], ["", "def", "safe_log", "(", "x", ",", "eps", ")", ":", "\n", "    ", "return", "(", "x", "+", "eps", ")", ".", "log", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.clip": [[36, 38], ["prob.clamp"], "function", ["None"], ["", "def", "clip", "(", "prob", ",", "clip_min", ")", ":", "\n", "    ", "return", "prob", ".", "clamp", "(", "min", "=", "clip_min", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.round3": [[39, 41], ["round"], "function", ["None"], ["", "def", "round3", "(", "x", ")", ":", "\n", "    ", "return", "round", "(", "x", ",", "3", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.X_to_dist": [[52, 55], ["model", "catdist.CatDist"], "function", ["None"], ["", "", "def", "X_to_dist", "(", "X", ",", "model", ",", "args", ",", "k", "=", "None", ")", ":", "\n", "    ", "pred_params", "=", "model", "(", "X", ")", "\n", "return", "catdist", ".", "CatDist", "(", "logits", "=", "pred_params", ",", "args", "=", "args", ",", "probs", "=", "None", ",", "k", "=", "k", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.X_to_FG_dists": [[56, 60], ["util.X_to_dist", "util.X_to_dist"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.X_to_dist", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.X_to_dist"], ["", "def", "X_to_FG_dists", "(", "X", ",", "Fmodel", ",", "Gmodel", ",", "args", ",", "k", "=", "None", ")", ":", "\n", "    ", "Fdist", "=", "X_to_dist", "(", "X", ",", "Fmodel", ",", "args", ",", "k", "=", "k", ")", "\n", "Gdist", "=", "X_to_dist", "(", "X", ",", "Gmodel", ",", "args", ",", "k", "=", "k", ")", "\n", "return", "Fdist", ",", "Gdist", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.IPCW_batch": [[67, 110], ["numer_dist.leq", "util.clip", "util.clip", "torch.ones_like", "torch.ones_like", "denom_dist.gt", "denom_dist.geq", "denom_dist.gt", "left_denom.detach.detach", "right_denom.detach.detach", "util.safe_log", "util.safe_log", "numer_dist.leq.pow"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.leq", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.clip", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.clip", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.gt", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.geq", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.gt", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.safe_log", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.safe_log"], ["", "def", "IPCW_batch", "(", "fn", ",", "k", ",", "tgt", ",", "Fdist", ",", "Gdist", ",", "args", ",", "is_g", "=", "False", ",", "detach", "=", "True", ")", ":", "\n", "\n", "    ", "if", "is_g", ":", "\n", "        ", "numer_dist", "=", "Gdist", "\n", "denom_dist", "=", "Fdist", "\n", "", "else", ":", "\n", "        ", "numer_dist", "=", "Fdist", "\n", "denom_dist", "=", "Gdist", "\n", "\n", "", "U", ",", "Delta", "=", "tgt", "\n", "kbatch", "=", "torch", ".", "ones_like", "(", "U", ")", "*", "k", "\n", "\n", "ncdf_k", "=", "numer_dist", ".", "leq", "(", "kbatch", ")", "\n", "observed", "=", "~", "Delta", "if", "is_g", "else", "Delta", "\n", "\n", "if", "fn", "==", "'bll_game'", ":", "\n", "        ", "left_loss", "=", "-", "1.0", "*", "safe_log", "(", "ncdf_k", ",", "args", ".", "logeps", ")", "\n", "right_loss", "=", "-", "1.0", "*", "safe_log", "(", "1.", "-", "ncdf_k", ",", "args", ".", "logeps", ")", "\n", "", "elif", "fn", "==", "'bs_game'", ":", "\n", "        ", "left_loss", "=", "(", "1.", "-", "ncdf_k", ")", ".", "pow", "(", "2", ")", "\n", "right_loss", "=", "ncdf_k", ".", "pow", "(", "2", ")", "\n", "", "else", ":", "\n", "        ", "assert", "False", "\n", "\n", "", "left_numer", "=", "left_loss", "*", "observed", "*", "(", "U", "<=", "kbatch", ")", "\n", "\n", "if", "is_g", ":", "\n", "        ", "left_denom", "=", "denom_dist", ".", "gt", "(", "U", ")", "\n", "", "else", ":", "\n", "        ", "left_denom", "=", "denom_dist", ".", "geq", "(", "U", ")", "\n", "", "left_denom", "=", "clip", "(", "left_denom", ",", "args", ".", "clip_min", ")", "\n", "\n", "right_numer", "=", "right_loss", "*", "(", "U", ">", "kbatch", ")", "\n", "right_denom", "=", "clip", "(", "denom_dist", ".", "gt", "(", "kbatch", ")", ",", "args", ".", "clip_min", ")", "\n", "\n", "if", "detach", ":", "\n", "        ", "left_denom", "=", "left_denom", ".", "detach", "(", ")", "\n", "right_denom", "=", "right_denom", ".", "detach", "(", ")", "\n", "\n", "", "left", "=", "left_numer", "/", "left_denom", "\n", "right", "=", "right_numer", "/", "right_denom", "\n", "ipcw_loss", "=", "(", "left", "+", "right", ")", ".", "mean", "(", "0", ")", "\n", "return", "ipcw_loss", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.uncensored_BS_or_BLL_batch": [[113, 126], ["Fdist.cdf", "torch.where.mean", "torch.ones_like", "torch.ones_like", "torch.where", "torch.where", "Fdist.cdf.pow", "torch.where", "torch.where", "util.safe_log", "util.safe_log"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.cdf", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.safe_log", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.safe_log"], ["", "def", "uncensored_BS_or_BLL_batch", "(", "fn", ",", "k", ",", "U", ",", "Fdist", ",", "args", ")", ":", "\n", "    ", "kbatch", "=", "torch", ".", "ones_like", "(", "U", ")", "*", "k", "\n", "Fk", "=", "Fdist", ".", "cdf", "(", "kbatch", ")", "\n", "if", "fn", "==", "'bs_game'", ":", "\n", "# BS(k) = E_T  [  1[T <= k] * (1-F(k))^2 + F(k)^2 1[T>k]  ]", "\n", "        ", "loss_k", "=", "torch", ".", "where", "(", "U", "<=", "kbatch", ",", "(", "1", "-", "Fk", ")", ".", "pow", "(", "2", ")", ",", "Fk", ".", "pow", "(", "2", ")", ")", "\n", "", "else", ":", "\n", "# BS(k) = E_T  [  1[T <= k] * (1-F(k))^2 + F(k)^2 1[T>k]  ]", "\n", "        ", "loss_k", "=", "-", "1.0", "*", "torch", ".", "where", "(", "U", "<=", "kbatch", ",", "safe_log", "(", "Fk", ",", "args", ".", "logeps", ")", ",", "safe_log", "(", "1", "-", "Fk", ",", "args", ".", "logeps", ")", ")", "\n", "\n", "", "assert", "loss_k", ".", "shape", "[", "0", "]", "==", "U", ".", "shape", "[", "0", "]", "\n", "loss_k", "=", "loss_k", ".", "mean", "(", "0", ")", "\n", "return", "loss_k", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.game": [[127, 129], ["util.cond_bs_game"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.cond_bs_game"], ["", "def", "game", "(", "fn", ",", "phase", ",", "loader", ",", "Fmodel", ",", "Gmodel", ",", "args", ",", "Foptimizer", "=", "None", ",", "Goptimizer", "=", "None", ",", "mode", "=", "'normal'", ")", ":", "\n", "    ", "return", "cond_bs_game", "(", "fn", ",", "phase", ",", "loader", ",", "Fmodel", ",", "Gmodel", ",", "args", ",", "Foptimizer", "=", "Foptimizer", ",", "Goptimizer", "=", "Goptimizer", ",", "mode", "=", "mode", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.cond_bs_game": [[131, 177], ["range", "util.Meter", "util.Meter", "enumerate", "util.Meter.avg", "util.Meter.avg", "U.to.to", "Delta.to.to", "X.to.to", "util.Meter.update", "util.Meter.update", "Foptimizer.zero_grad", "Goptimizer.zero_grad", "util.X_to_FG_dists", "util.X_to_FG_dists", "util.IPCW_batch", "util.IPCW_batch", "IPCW_batch.backward", "Foptimizer.step", "torch.tensor().to.backward", "Goptimizer.step", "util.X_to_dist", "util.uncensored_BS_or_BLL_batch", "torch.tensor", "torch.tensor", "util.X_to_dist", "_km.get_KM_cdfvals", "_km.cdfvals_to_dist", "util.IPCW_batch", "torch.tensor().to", "torch.tensor().to", "IPCW_batch.item", "torch.tensor().to.item", "torch.tensor", "torch.tensor"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.Meter.avg", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.Meter.avg", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.Meter.update", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.Meter.update", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.X_to_FG_dists", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.X_to_FG_dists", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.IPCW_batch", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.IPCW_batch", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.X_to_dist", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.uncensored_BS_or_BLL_batch", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.X_to_dist", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._km.get_KM_cdfvals", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._km.cdfvals_to_dist", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.IPCW_batch"], ["", "def", "cond_bs_game", "(", "fn", ",", "phase", ",", "loader", ",", "Fmodel", ",", "Gmodel", ",", "args", ",", "Foptimizer", "=", "None", ",", "Goptimizer", "=", "None", ",", "mode", "=", "'normal'", ")", ":", "\n", "    ", "Fsumm", "=", "0.0", "\n", "Gsumm", "=", "0.0", "\n", "for", "k", "in", "range", "(", "args", ".", "K", "-", "1", ")", ":", "\n", "        ", "floss_meter_k", "=", "Meter", "(", ")", "\n", "gloss_meter_k", "=", "Meter", "(", ")", "\n", "for", "batch_idx", ",", "batch", "in", "enumerate", "(", "loader", ")", ":", "\n", "            ", "(", "U", ",", "Delta", ",", "X", ")", "=", "batch", "\n", "U", "=", "U", ".", "to", "(", "args", ".", "device", ")", "\n", "Delta", "=", "Delta", ".", "to", "(", "args", ".", "device", ")", "\n", "X", "=", "X", ".", "to", "(", "args", ".", "device", ")", "\n", "bsz", "=", "U", ".", "shape", "[", "0", "]", "\n", "if", "phase", "==", "'train'", ":", "\n", "                ", "Foptimizer", ".", "zero_grad", "(", ")", "\n", "Goptimizer", ".", "zero_grad", "(", ")", "\n", "Fdist", ",", "Gdist", "=", "X_to_FG_dists", "(", "X", ",", "Fmodel", ",", "Gmodel", ",", "args", ",", "k", "=", "None", ")", "\n", "", "else", ":", "\n", "                ", "Fdist", ",", "Gdist", "=", "X_to_FG_dists", "(", "X", ",", "Fmodel", ",", "Gmodel", ",", "args", ",", "k", "=", "None", ")", "\n", "", "if", "mode", "==", "'normal'", ":", "\n", "                ", "floss_k", "=", "IPCW_batch", "(", "fn", ",", "k", ",", "(", "U", ",", "Delta", ")", ",", "Fdist", ",", "Gdist", ",", "args", ",", "is_g", "=", "False", ",", "detach", "=", "True", ")", "\n", "gloss_k", "=", "IPCW_batch", "(", "fn", ",", "k", ",", "(", "U", ",", "Delta", ")", ",", "Fdist", ",", "Gdist", ",", "args", ",", "is_g", "=", "True", ",", "detach", "=", "True", ")", "\n", "", "elif", "mode", "==", "'uncensored'", ":", "\n", "                ", "Fdist", "=", "X_to_dist", "(", "X", ",", "Fmodel", ",", "args", ",", "k", "=", "None", ")", "\n", "floss_k", "=", "uncensored_BS_or_BLL_batch", "(", "fn", ",", "k", ",", "U", ",", "Fdist", ",", "args", ")", "\n", "gloss_k", "=", "torch", ".", "tensor", "(", "[", "-", "1.0", "]", ")", "\n", "", "elif", "mode", "==", "'kmG'", ":", "\n", "                ", "assert", "phase", "==", "'test'", "\n", "Fdist", "=", "X_to_dist", "(", "X", ",", "Fmodel", ",", "args", ",", "k", "=", "None", ")", "\n", "G_cdfvals", "=", "_km", ".", "get_KM_cdfvals", "(", "loader", ",", "args", ")", "\n", "Gdist", "=", "_km", ".", "cdfvals_to_dist", "(", "G_cdfvals", ",", "bsz", ",", "args", ")", "\n", "floss_k", "=", "IPCW_batch", "(", "fn", ",", "k", ",", "(", "U", ",", "Delta", ")", ",", "Fdist", ",", "Gdist", ",", "args", "=", "args", ",", "is_g", "=", "False", ",", "detach", "=", "True", ")", "\n", "gloss_k", "=", "torch", ".", "tensor", "(", "[", "-", "1.0", "]", ")", ".", "to", "(", "args", ".", "device", ")", "\n", "", "else", ":", "\n", "                ", "assert", "False", "\n", "", "if", "phase", "==", "'train'", ":", "\n", "                ", "floss_k", ".", "backward", "(", ")", "\n", "Foptimizer", ".", "step", "(", ")", "\n", "gloss_k", ".", "backward", "(", ")", "\n", "Goptimizer", ".", "step", "(", ")", "\n", "", "floss_meter_k", ".", "update", "(", "val", "=", "floss_k", ".", "item", "(", ")", "*", "bsz", ",", "N", "=", "bsz", ")", "\n", "gloss_meter_k", ".", "update", "(", "val", "=", "gloss_k", ".", "item", "(", ")", "*", "bsz", ",", "N", "=", "bsz", ")", "\n", "", "Fsumm", "+=", "floss_meter_k", ".", "avg", "(", ")", "\n", "Gsumm", "+=", "gloss_meter_k", ".", "avg", "(", ")", "\n", "", "Fsumm", "=", "Fsumm", "/", "(", "args", ".", "K", "-", "1", ")", "\n", "Gsumm", "=", "Gsumm", "/", "(", "args", ".", "K", "-", "1", ")", "\n", "return", "Fsumm", ",", "Gsumm", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.train_or_val": [[178, 192], ["_nll.nll_FG", "util.game"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._nll.nll_FG", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.game"], ["", "def", "train_or_val", "(", "phase", ",", "loader", ",", "Fmodel", ",", "Gmodel", ",", "args", ",", "Foptimizer", "=", "None", ",", "Goptimizer", "=", "None", ")", ":", "\n", "\n", "    ", "if", "phase", "==", "'train'", ":", "\n", "        ", "assert", "Foptimizer", "is", "not", "None", "\n", "assert", "Goptimizer", "is", "not", "None", "\n", "\n", "", "if", "args", ".", "loss_fn", "==", "'nll'", ":", "\n", "        ", "floss", ",", "gloss", "=", "_nll", ".", "nll_FG", "(", "phase", ",", "loader", ",", "Fmodel", ",", "Gmodel", ",", "args", ",", "Foptimizer", ",", "Goptimizer", ")", "\n", "", "elif", "args", ".", "loss_fn", "in", "[", "'bs_game'", ",", "'bll_game'", "]", ":", "\n", "        ", "floss", ",", "gloss", "=", "game", "(", "args", ".", "loss_fn", ",", "phase", ",", "loader", ",", "Fmodel", ",", "Gmodel", ",", "args", ",", "Foptimizer", ",", "Goptimizer", ")", "\n", "", "else", ":", "\n", "        ", "assert", "False", "\n", "\n", "", "return", "floss", ",", "gloss", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.get_model_from_file": [[195, 202], ["torch.load", "torch.load", "args.model_fn", "args.model_fn.load_state_dict", "args.model_fn.to", "args.model_fn.eval"], "function", ["None"], ["", "def", "get_model_from_file", "(", "fname", ",", "args", ")", ":", "\n", "    ", "ckpt", "=", "torch", ".", "load", "(", "fname", ",", "map_location", "=", "args", ".", "device", ")", "\n", "model", "=", "args", ".", "model_fn", "(", "args", ")", "\n", "model", ".", "load_state_dict", "(", "ckpt", "[", "'model_state'", "]", ")", "\n", "model", ".", "to", "(", "args", ".", "device", ")", "\n", "model", ".", "eval", "(", ")", "\n", "return", "model", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.eval_next_dist": [[203, 249], ["os.path.join", "util.get_model_from_file", "util.get_model_from_file", "os.path.join", "os.path.join", "print", "print", "range", "range", "print", "util.get_model_from_file", "util.game", "print", "util.get_model_from_file", "util.game"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.get_model_from_file", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.get_model_from_file", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.get_model_from_file", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.game", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.get_model_from_file", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.game"], ["", "def", "eval_next_dist", "(", "cur_F_file", ",", "cur_G_file", ",", "args", ",", "get_F", ",", "loader", ",", "fn", ")", ":", "\n", "\n", "# all models", "\n", "    ", "dirr", "=", "os", ".", "path", ".", "join", "(", "args", ".", "save_dir", ",", "args", ".", "ckpt_basename", ")", "\n", "F_filenames", "=", "[", "os", ".", "path", ".", "join", "(", "dirr", ",", "args", ".", "ckpt_basename", "+", "'_F_epoch{}.pth.tar'", ".", "format", "(", "epoch", ")", ")", "for", "epoch", "in", "range", "(", "0", ",", "args", ".", "epochs", ")", "]", "\n", "G_filenames", "=", "[", "os", ".", "path", ".", "join", "(", "dirr", ",", "args", ".", "ckpt_basename", "+", "'_G_epoch{}.pth.tar'", ".", "format", "(", "epoch", ")", ")", "for", "epoch", "in", "range", "(", "0", ",", "args", ".", "epochs", ")", "]", "\n", "\n", "# cur models", "\n", "cur_F", "=", "get_model_from_file", "(", "cur_F_file", ",", "args", ")", "\n", "cur_G", "=", "get_model_from_file", "(", "cur_G_file", ",", "args", ")", "\n", "\n", "best_metric", "=", "1000000.0", "\n", "best_filename", "=", "None", "\n", "\n", "# given cur G, find an F", "\n", "if", "get_F", ":", "\n", "        ", "print", "(", "\"Searching for a new F\"", ")", "\n", "for", "candidate_model_filename", "in", "F_filenames", ":", "\n", "            ", "print", "(", "\"--- Trying: {}\"", ".", "format", "(", "candidate_model_filename", ")", ")", "\n", "candidate_model", "=", "get_model_from_file", "(", "candidate_model_filename", ",", "args", ")", "\n", "floss", ",", "_", "=", "game", "(", "fn", ",", "'valid'", ",", "loader", ",", "candidate_model", ",", "cur_G", ",", "args", ")", "\n", "if", "floss", "<", "best_metric", ":", "\n", "                ", "best_metric", "=", "floss", "\n", "best_filename", "=", "candidate_model_filename", "\n", "", "", "if", "best_filename", "==", "cur_F_file", ":", "\n", "            ", "changed", "=", "False", "\n", "", "else", ":", "\n", "            ", "changed", "=", "True", "\n", "\n", "\n", "# given cur F, find a G", "\n", "", "", "else", ":", "\n", "        ", "print", "(", "\"Searching for a new G\"", ")", "\n", "for", "candidate_model_filename", "in", "G_filenames", ":", "\n", "            ", "print", "(", "\"--- Trying: {}\"", ".", "format", "(", "candidate_model_filename", ")", ")", "\n", "candidate_model", "=", "get_model_from_file", "(", "candidate_model_filename", ",", "args", ")", "\n", "_", ",", "gloss", "=", "game", "(", "fn", ",", "'valid'", ",", "loader", ",", "cur_F", ",", "candidate_model", ",", "args", ")", "\n", "if", "gloss", "<", "best_metric", ":", "\n", "                ", "best_metric", "=", "gloss", "\n", "best_filename", "=", "candidate_model_filename", "\n", "", "", "if", "best_filename", "==", "cur_G_file", ":", "\n", "            ", "changed", "=", "False", "\n", "", "else", ":", "\n", "            ", "changed", "=", "True", "\n", "\n", "", "", "return", "best_filename", ",", "changed", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.f_metrics": [[255, 293], ["util.game", "util.game", "util.game", "util.game", "_nll.nll_FG", "_concordance.test_concordance_FG", "util.round3", "util.round3", "util.round3", "util.round3", "util.round3", "util.round3", "util.round3", "util.round3", "torch.all", "torch.all", "util.game", "print", "util.game", "torch.eq", "torch.eq"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.game", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.game", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.game", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.game", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._nll.nll_FG", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None._concordance.test_concordance_FG", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.round3", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.round3", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.round3", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.round3", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.round3", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.round3", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.round3", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.round3", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.game", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.game", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.eq", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.catdist.CatDist.eq"], ["", "def", "f_metrics", "(", "loaders", ",", "Fmodel", ",", "Gmodel", ",", "args", ")", ":", "\n", "\n", "    ", "if", "args", ".", "dataset", "in", "[", "'gamma'", ",", "'mnist'", "]", ":", "\n", "        ", "trainloader", ",", "valloader", ",", "testloader", ",", "Ftestloader", ",", "Gtestloader", "=", "loaders", "\n", "\n", "", "if", "args", ".", "dataset", "in", "[", "'gamma'", ",", "'mnist'", "]", ":", "\n", "        ", "trainloader", ",", "valloader", ",", "testloader", ",", "Ftestloader", ",", "Gtestloader", "=", "loaders", "\n", "", "elif", "args", ".", "dataset", "in", "args", ".", "realsets", ":", "\n", "        ", "trainloader", ",", "valloader", ",", "testloader", "=", "loaders", "\n", "", "else", ":", "\n", "        ", "assert", "False", "\n", "\n", "", "fbs_km", ",", "_", "=", "game", "(", "'bs_game'", ",", "'test'", ",", "testloader", ",", "Fmodel", ",", "Gmodel", ",", "args", ",", "mode", "=", "'kmG'", ")", "\n", "fbs_ipcw", ",", "_", "=", "game", "(", "'bs_game'", ",", "'test'", ",", "testloader", ",", "Fmodel", ",", "Gmodel", ",", "args", ")", "\n", "fbll_km", ",", "_", "=", "game", "(", "'bll_game'", ",", "'test'", ",", "testloader", ",", "Fmodel", ",", "Gmodel", ",", "args", ",", "mode", "=", "'kmG'", ")", "\n", "fbll_ipcw", ",", "_", "=", "game", "(", "'bll_game'", ",", "'test'", ",", "testloader", ",", "Fmodel", ",", "Gmodel", ",", "args", ")", "\n", "fnll", ",", "_", "=", "_nll", ".", "nll_FG", "(", "'test'", ",", "testloader", ",", "Fmodel", ",", "Gmodel", ",", "args", ")", "\n", "fconc", ",", "_", "=", "_concordance", ".", "test_concordance_FG", "(", "testloader", ",", "testloader", ",", "Fmodel", ",", "Gmodel", ",", "args", ")", "\n", "\n", "if", "args", ".", "dataset", "in", "[", "'gamma'", ",", "'mnist'", "]", ":", "\n", "        ", "assert", "torch", ".", "all", "(", "torch", ".", "eq", "(", "Ftestloader", ".", "dataset", ".", "Delta", ",", "1", ")", ")", "\n", "fbs_uncensored", ",", "_", "=", "game", "(", "'bs_game'", ",", "'test'", ",", "Ftestloader", ",", "Fmodel", ",", "Gmodel", ",", "args", ",", "mode", "=", "'uncensored'", ")", "\n", "print", "(", "\"test fbs uncensored\"", ",", "fbs_uncensored", ")", "\n", "fbll_uncensored", ",", "_", "=", "game", "(", "'bll_game'", ",", "'test'", ",", "Ftestloader", ",", "Fmodel", ",", "Gmodel", ",", "args", ",", "mode", "=", "'uncensored'", ")", "\n", "", "else", ":", "\n", "        ", "fbs_uncensored", "=", "-", "1.0", "\n", "fbll_uncensored", "=", "-", "1.0", "\n", "\n", "", "metrics", "=", "{", "}", "\n", "metrics", "[", "'fnll'", "]", "=", "round3", "(", "fnll", ")", "\n", "metrics", "[", "'fconc'", "]", "=", "round3", "(", "fconc", ")", "\n", "metrics", "[", "'fbs_km'", "]", "=", "round3", "(", "fbs_km", ")", "\n", "metrics", "[", "'fbll_km'", "]", "=", "round3", "(", "fbll_km", ")", "\n", "metrics", "[", "'fbs_ipcw'", "]", "=", "round3", "(", "fbs_ipcw", ")", "\n", "metrics", "[", "'fbll_ipcw'", "]", "=", "round3", "(", "fbll_ipcw", ")", "\n", "metrics", "[", "'fbs_uncensored'", "]", "=", "round3", "(", "fbs_uncensored", ")", "\n", "metrics", "[", "'fbll_uncensored'", "]", "=", "round3", "(", "fbll_uncensored", ")", "\n", "return", "metrics", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.eval_nll": [[295, 297], ["util.f_metrics"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.f_metrics"], ["", "def", "eval_nll", "(", "loaders", ",", "Fmodel", ",", "Gmodel", ",", "args", ")", ":", "\n", "    ", "return", "f_metrics", "(", "loaders", ",", "Fmodel", ",", "Gmodel", ",", "args", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.eval_game": [[298, 320], ["os.path.join", "os.path.join", "os.path.join", "util.get_model_from_file", "util.get_model_from_file", "print", "util.eval_next_dist", "util.eval_next_dist", "util.f_metrics"], "function", ["home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.get_model_from_file", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.get_model_from_file", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.eval_next_dist", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.eval_next_dist", "home.repos.pwc.inspect_result.rajesh-lab_inverse-weighted-survival-games.None.util.f_metrics"], ["", "def", "eval_game", "(", "loaders", ",", "args", ")", ":", "\n", "\n", "    ", "if", "args", ".", "dataset", "in", "[", "'gamma'", ",", "'mnist'", "]", ":", "\n", "        ", "trainloader", ",", "valloader", ",", "testloader", ",", "Ftestloader", ",", "Gtestloader", "=", "loaders", "\n", "", "elif", "args", ".", "dataset", "in", "args", ".", "realsets", ":", "\n", "        ", "trainloader", ",", "valloader", ",", "testloader", "=", "loaders", "\n", "", "else", ":", "\n", "        ", "assert", "False", "\n", "\n", "", "dirr", "=", "os", ".", "path", ".", "join", "(", "args", ".", "save_dir", ",", "args", ".", "ckpt_basename", ")", "\n", "cur_F_file", "=", "os", ".", "path", ".", "join", "(", "dirr", ",", "args", ".", "ckpt_basename", "+", "'_F_epoch0.pth.tar'", ")", "\n", "cur_G_file", "=", "os", ".", "path", ".", "join", "(", "dirr", ",", "args", ".", "ckpt_basename", "+", "'_G_epoch0.pth.tar'", ")", "\n", "while", "True", ":", "\n", "        ", "print", "(", "\"Trying\"", ")", "\n", "cur_F_file", ",", "F_changed", "=", "eval_next_dist", "(", "cur_F_file", ",", "cur_G_file", ",", "args", ",", "get_F", "=", "True", ",", "loader", "=", "valloader", ",", "fn", "=", "'bs_game'", ")", "\n", "cur_G_file", ",", "G_changed", "=", "eval_next_dist", "(", "cur_F_file", ",", "cur_G_file", ",", "args", ",", "get_F", "=", "False", ",", "loader", "=", "valloader", ",", "fn", "=", "'bs_game'", ")", "\n", "if", "not", "F_changed", "and", "not", "G_changed", ":", "\n", "            ", "break", "\n", "\n", "", "", "best_F", "=", "get_model_from_file", "(", "cur_F_file", ",", "args", ")", "\n", "best_G", "=", "get_model_from_file", "(", "cur_G_file", ",", "args", ")", "\n", "return", "f_metrics", "(", "loaders", ",", "best_F", ",", "best_G", ",", "args", ")", ",", "cur_F_file", ",", "cur_G_file", "\n", "\n"]]}