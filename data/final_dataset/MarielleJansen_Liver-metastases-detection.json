{"home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.read_image": [[23, 29], ["nibabel.load", "nib.load.get_data", "numpy.asarray"], "function", ["None"], ["def", "read_image", "(", "filename", ")", ":", "\n", "    ", "nii", "=", "nib", ".", "load", "(", "filename", ")", "# Use nibabel to load nifti image", "\n", "data", "=", "nii", ".", "get_data", "(", ")", "\n", "data", "=", "np", ".", "asarray", "(", "data", ")", "\n", "#data = np.swapaxes(data, 0,1)", "\n", "return", "data", "\n", "\n"]], "home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.load_data_train": [[33, 64], ["LiverMetastaseDetection_Pnet_DCEDWI.read_image", "numpy.mean", "numpy.mean", "numpy.mean", "numpy.mean", "numpy.concatenate", "numpy.swapaxes", "LiverMetastaseDetection_Pnet_DCEDWI.read_image", "numpy.swapaxes", "LiverMetastaseDetection_Pnet_DCEDWI.read_image", "numpy.swapaxes", "os.path.join", "os.path.join", "os.path.join", "str", "str", "str"], "function", ["home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.read_image", "home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.read_image", "home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.read_image"], ["", "def", "load_data_train", "(", "basedir", ",", "number", ")", ":", "\n", "    ", "basedir", "=", "basedir", "\n", "# Load train data; find body mask and normalize", "\n", "t", "=", "number", "\n", "nameImage", "=", "'trainDCEMRI'", "+", "str", "(", "t", ")", "+", "'.nii'", "\n", "image", "=", "read_image", "(", "path", ".", "join", "(", "basedir", ",", "nameImage", ")", ")", "\n", "\n", "Im1", "=", "image", "[", ":", ",", ":", ",", ":", ",", "0", "]", "\n", "Im1", "=", "Im1", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "Im2", "=", "np", ".", "mean", "(", "image", "[", ":", ",", ":", ",", ":", ",", "1", ":", "6", "]", ",", "axis", "=", "3", ")", "\n", "Im2", "=", "Im2", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "Im3", "=", "np", ".", "mean", "(", "image", "[", ":", ",", ":", ",", ":", ",", "6", ":", "10", "]", ",", "axis", "=", "3", ")", "\n", "Im3", "=", "Im3", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "Im4", "=", "np", ".", "mean", "(", "image", "[", ":", ",", ":", ",", ":", ",", "10", ":", "12", "]", ",", "axis", "=", "3", ")", "\n", "Im4", "=", "Im4", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "Im5", "=", "np", ".", "mean", "(", "image", "[", ":", ",", ":", ",", ":", ",", "12", ":", "15", "]", ",", "axis", "=", "3", ")", "\n", "Im5", "=", "Im5", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "Im6", "=", "image", "[", ":", ",", ":", ",", ":", ",", "15", "]", "\n", "Im6", "=", "Im6", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "\n", "Im", "=", "np", ".", "concatenate", "(", "(", "Im1", ",", "Im2", ",", "Im3", ",", "Im4", ",", "Im5", ",", "Im6", ")", ",", "axis", "=", "3", ")", "\n", "Im", "=", "np", ".", "swapaxes", "(", "Im", ",", "0", ",", "2", ")", "\n", "\n", "nameImage", "=", "'trainDWI'", "+", "str", "(", "t", ")", "+", "'.nii'", "\n", "image", "=", "read_image", "(", "path", ".", "join", "(", "basedir", ",", "nameImage", ")", ")", "\n", "ImDWI", "=", "np", ".", "swapaxes", "(", "image", ",", "0", ",", "2", ")", "\n", "\n", "mask", "=", "read_image", "(", "path", ".", "join", "(", "basedir", ",", "'trainLesion'", "+", "str", "(", "t", ")", "+", "'.nii'", ")", ")", "\n", "mask", "=", "np", ".", "swapaxes", "(", "mask", ",", "0", ",", "2", ")", "\n", "\n", "return", "Im", ",", "ImDWI", ",", "mask", "\n", "\n"]], "home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.load_data_val": [[68, 99], ["LiverMetastaseDetection_Pnet_DCEDWI.read_image", "numpy.mean", "numpy.mean", "numpy.mean", "numpy.mean", "numpy.concatenate", "numpy.swapaxes", "LiverMetastaseDetection_Pnet_DCEDWI.read_image", "numpy.swapaxes", "LiverMetastaseDetection_Pnet_DCEDWI.read_image", "numpy.swapaxes", "os.path.join", "os.path.join", "os.path.join", "str", "str", "str"], "function", ["home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.read_image", "home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.read_image", "home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.read_image"], ["", "def", "load_data_val", "(", "basedir", ",", "number", ")", ":", "\n", "    ", "basedir", "=", "basedir", "\n", "t", "=", "number", "\n", "# Load train data", "\n", "nameImage", "=", "'valDCEMRI'", "+", "str", "(", "t", ")", "+", "'.nii'", "\n", "image", "=", "read_image", "(", "path", ".", "join", "(", "basedir", ",", "nameImage", ")", ")", "\n", "\n", "Im1", "=", "image", "[", ":", ",", ":", ",", ":", ",", "0", "]", "\n", "Im1", "=", "Im1", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "Im2", "=", "np", ".", "mean", "(", "image", "[", ":", ",", ":", ",", ":", ",", "1", ":", "6", "]", ",", "axis", "=", "3", ")", "\n", "Im2", "=", "Im2", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "Im3", "=", "np", ".", "mean", "(", "image", "[", ":", ",", ":", ",", ":", ",", "6", ":", "10", "]", ",", "axis", "=", "3", ")", "\n", "Im3", "=", "Im3", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "Im4", "=", "np", ".", "mean", "(", "image", "[", ":", ",", ":", ",", ":", ",", "10", ":", "12", "]", ",", "axis", "=", "3", ")", "\n", "Im4", "=", "Im4", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "Im5", "=", "np", ".", "mean", "(", "image", "[", ":", ",", ":", ",", ":", ",", "12", ":", "15", "]", ",", "axis", "=", "3", ")", "\n", "Im5", "=", "Im5", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "Im6", "=", "image", "[", ":", ",", ":", ",", ":", ",", "15", "]", "\n", "Im6", "=", "Im6", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "\n", "Im", "=", "np", ".", "concatenate", "(", "(", "Im1", ",", "Im2", ",", "Im3", ",", "Im4", ",", "Im5", ",", "Im6", ")", ",", "axis", "=", "3", ")", "\n", "Im", "=", "np", ".", "swapaxes", "(", "Im", ",", "0", ",", "2", ")", "\n", "\n", "nameImage", "=", "'valDWI'", "+", "str", "(", "t", ")", "+", "'.nii'", "\n", "image", "=", "read_image", "(", "path", ".", "join", "(", "basedir", ",", "nameImage", ")", ")", "\n", "ImDWI", "=", "np", ".", "swapaxes", "(", "image", ",", "0", ",", "2", ")", "\n", "\n", "mask", "=", "read_image", "(", "path", ".", "join", "(", "basedir", ",", "'valLesion'", "+", "str", "(", "t", ")", "+", "'.nii'", ")", ")", "\n", "mask", "=", "np", ".", "swapaxes", "(", "mask", ",", "0", ",", "2", ")", "\n", "\n", "return", "Im", ",", "ImDWI", ",", "mask", "\n", "\n"]], "home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.standardization": [[100, 125], ["numpy.ndarray.flatten", "numpy.sort", "numpy.zeros", "np.ndarray.flatten.astype", "numpy.mean", "numpy.std", "numpy.reshape", "np.reshape.astype", "numpy.round().astype", "numpy.where", "numpy.round", "len"], "function", ["None"], ["", "def", "standardization", "(", "image", ")", ":", "\n", "    ", "s1", "=", "0", "# minimum value mapping", "\n", "s2", "=", "1", "# maximum value mapping", "\n", "pc2", "=", "0.998", "# maximum landmark 99.8th percentile", "\n", "\n", "X", "=", "np", ".", "ndarray", ".", "flatten", "(", "image", ")", "\n", "X_sorted", "=", "np", ".", "sort", "(", "X", ")", "\n", "\n", "p1", "=", "0", "\n", "p2", "=", "X_sorted", "[", "np", ".", "round", "(", "len", "(", "X", ")", "*", "pc2", "+", "1", ")", ".", "astype", "(", "int", ")", "]", "\n", "st", "=", "(", "s2", "-", "s1", ")", "/", "(", "p2", "-", "p1", ")", "\n", "\n", "image_mapped", "=", "np", ".", "zeros", "(", "X", ".", "shape", ",", "dtype", "=", "'float32'", ")", "\n", "X", ".", "astype", "(", "'float32'", ")", "\n", "image_mapped", "=", "s1", "+", "X", "*", "st", "\n", "\n", "image_mapped", "[", "np", ".", "where", "(", "image_mapped", "<", "0", ")", "]", "=", "0", "\n", "meanIm", "=", "np", ".", "mean", "(", "image_mapped", ")", "\n", "stdIm", "=", "np", ".", "std", "(", "image_mapped", ")", "\n", "\n", "Im", "=", "(", "image_mapped", "-", "meanIm", ")", "/", "stdIm", "# zero mean unit variance for Neural network", "\n", "\n", "Im", "=", "np", ".", "reshape", "(", "Im", ",", "image", ".", "shape", ")", "\n", "Im", ".", "astype", "(", "'float32'", ")", "\n", "return", "Im", "\n", "\n"]], "home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.load_data": [[127, 162], ["LiverMetastaseDetection_Pnet_DCEDWI.read_image", "numpy.swapaxes", "LiverMetastaseDetection_Pnet_DCEDWI.read_image", "numpy.swapaxes", "LiverMetastaseDetection_Pnet_DCEDWI.read_image", "LiverMetastaseDetection_Pnet_DCEDWI.standardization", "numpy.mean", "numpy.mean", "numpy.mean", "numpy.mean", "numpy.concatenate", "numpy.swapaxes", "LiverMetastaseDetection_Pnet_DCEDWI.read_image", "LiverMetastaseDetection_Pnet_DCEDWI.standardization", "numpy.swapaxes", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "str", "str", "str", "str"], "function", ["home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.read_image", "home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.read_image", "home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.read_image", "home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.standardization", "home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.read_image", "home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.standardization"], ["", "def", "load_data", "(", "basedir", ",", "nameImage", ",", "number", ")", ":", "\n", "    ", "basedir", "=", "basedir", "\n", "# Load train data; find body mask and normalize", "\n", "mask", "=", "read_image", "(", "path", ".", "join", "(", "basedir", ",", "str", "(", "number", ")", ",", "'3DLesionAnnotations.nii'", ")", ")", "\n", "mask", "=", "np", ".", "swapaxes", "(", "mask", ",", "0", ",", "2", ")", "\n", "liverMask", "=", "read_image", "(", "path", ".", "join", "(", "basedir", ",", "str", "(", "number", ")", ",", "'LiverMask_dilated.nii'", ")", ")", "\n", "liverMask", "=", "np", ".", "swapaxes", "(", "liverMask", ",", "0", ",", "2", ")", "\n", "liverMask", "=", "liverMask", "+", "mask", "\n", "idx", "=", "liverMask", ">", "0", "\n", "liverMask", "[", "idx", "]", "=", "1", "\n", "\n", "image", "=", "read_image", "(", "path", ".", "join", "(", "basedir", ",", "str", "(", "number", ")", ",", "nameImage", ")", ")", "\n", "normImage", "=", "standardization", "(", "image", ")", "\n", "\n", "Im1", "=", "normImage", "[", ":", ",", ":", ",", ":", ",", "0", "]", "\n", "Im1", "=", "Im1", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "Im2", "=", "np", ".", "mean", "(", "normImage", "[", ":", ",", ":", ",", ":", ",", "1", ":", "6", "]", ",", "axis", "=", "3", ")", "\n", "Im2", "=", "Im2", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "Im3", "=", "np", ".", "mean", "(", "normImage", "[", ":", ",", ":", ",", ":", ",", "6", ":", "10", "]", ",", "axis", "=", "3", ")", "\n", "Im3", "=", "Im3", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "Im4", "=", "np", ".", "mean", "(", "normImage", "[", ":", ",", ":", ",", ":", ",", "10", ":", "12", "]", ",", "axis", "=", "3", ")", "\n", "Im4", "=", "Im4", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "Im5", "=", "np", ".", "mean", "(", "normImage", "[", ":", ",", ":", ",", ":", ",", "12", ":", "15", "]", ",", "axis", "=", "3", ")", "\n", "Im5", "=", "Im5", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "Im6", "=", "normImage", "[", ":", ",", ":", ",", ":", ",", "15", "]", "\n", "Im6", "=", "Im6", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "\n", "Im", "=", "np", ".", "concatenate", "(", "(", "Im1", ",", "Im2", ",", "Im3", ",", "Im4", ",", "Im5", ",", "Im6", ")", ",", "axis", "=", "3", ")", "\n", "Im", "=", "np", ".", "swapaxes", "(", "Im", ",", "0", ",", "2", ")", "\n", "\n", "image", "=", "read_image", "(", "path", ".", "join", "(", "basedir", ",", "str", "(", "number", ")", ",", "'DWI_reg.nii'", ")", ")", "\n", "normImage", "=", "standardization", "(", "image", ")", "\n", "ImDWI", "=", "np", ".", "swapaxes", "(", "normImage", ",", "0", ",", "2", ")", "\n", "\n", "return", "Im", ",", "ImDWI", ",", "mask", ",", "liverMask", "\n", "\n"]], "home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.build_network": [[164, 328], ["tensorflow.python.keras.layers.Input", "tensorflow.python.keras.layers.Input", "tensorflow.python.keras.layers.concatenate", "tensorflow.python.keras.models.Model", "models.Model.compile", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Dropout", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.layers.BatchNormalization", "tensorflow.python.keras.layers.Activation", "tensorflow.python.keras.layers.Dropout", "tensorflow.python.keras.layers.Conv2D", "tensorflow.python.keras.optimizers.Adam"], "function", ["None"], ["", "def", "build_network", "(", "Inputshape1", ",", "Inputshape2", ",", "num_class", ")", ":", "\n", "    ", "concat_axis", "=", "3", "\n", "inputsDCE", "=", "layers", ".", "Input", "(", "shape", "=", "Inputshape1", ")", "\n", "inputsDWI", "=", "layers", ".", "Input", "(", "shape", "=", "Inputshape2", ")", "\n", "# DCE MRI", "\n", "#block 1", "\n", "conv1", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "1", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv1'", ")", "(", "inputsDCE", ")", "\n", "conv1", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN1'", ")", "(", "conv1", ")", "\n", "conv1", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_1'", ")", "(", "conv1", ")", "\n", "\n", "conv1_2", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "1", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv1_2'", ")", "(", "conv1", ")", "\n", "conv1_2", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN1_2'", ")", "(", "conv1_2", ")", "\n", "conv1_2", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_1_2'", ")", "(", "conv1_2", ")", "\n", "#block 2", "\n", "conv2", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "2", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv2'", ")", "(", "conv1_2", ")", "\n", "conv2", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN2'", ")", "(", "conv2", ")", "\n", "conv2", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_2'", ")", "(", "conv2", ")", "\n", "\n", "conv2_2", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "2", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv2_2'", ")", "(", "conv2", ")", "\n", "conv2_2", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN2_2'", ")", "(", "conv2_2", ")", "\n", "conv2_2", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_2_2'", ")", "(", "conv2_2", ")", "\n", "#block 3", "\n", "conv3", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "4", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv3'", ")", "(", "conv2_2", ")", "\n", "conv3", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN3'", ")", "(", "conv3", ")", "\n", "conv3", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_3'", ")", "(", "conv3", ")", "\n", "\n", "conv3_2", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "4", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv3_2'", ")", "(", "conv3", ")", "\n", "conv3_2", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN3_2'", ")", "(", "conv3_2", ")", "\n", "conv3_2", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_3_2'", ")", "(", "conv3_2", ")", "\n", "\n", "conv3_3", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "4", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv3_3'", ")", "(", "conv3_2", ")", "\n", "conv3_3", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN3_3'", ")", "(", "conv3_3", ")", "\n", "conv3_3", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_3_3'", ")", "(", "conv3_3", ")", "\n", "#block 4", "\n", "conv4", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "6", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv4'", ")", "(", "conv3_3", ")", "\n", "conv4", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN4'", ")", "(", "conv4", ")", "\n", "conv4", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_4'", ")", "(", "conv4", ")", "\n", "\n", "conv4_2", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "6", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv4_2'", ")", "(", "conv4", ")", "\n", "conv4_2", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN4_2'", ")", "(", "conv4_2", ")", "\n", "conv4_2", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_4_2'", ")", "(", "conv4_2", ")", "\n", "\n", "conv4_3", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "6", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv4_3'", ")", "(", "conv4_2", ")", "\n", "conv4_3", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN4_3'", ")", "(", "conv4_3", ")", "\n", "conv4_3", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_4_3'", ")", "(", "conv4_3", ")", "\n", "\n", "#block 5", "\n", "conv5", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "8", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv5'", ")", "(", "conv4_3", ")", "\n", "conv5", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN5'", ")", "(", "conv5", ")", "\n", "conv5", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_5'", ")", "(", "conv5", ")", "\n", "\n", "conv5_2", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "8", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv5_2'", ")", "(", "conv5", ")", "\n", "conv5_2", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN5_2'", ")", "(", "conv5_2", ")", "\n", "conv5_2", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_5_2'", ")", "(", "conv5_2", ")", "\n", "\n", "conv5_3", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "8", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv5_3'", ")", "(", "conv5_2", ")", "\n", "conv5_3", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN5_3'", ")", "(", "conv5_3", ")", "\n", "conv5_3", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_5_3'", ")", "(", "conv5_3", ")", "\n", "\n", "# DWI", "\n", "#block 1", "\n", "conv1D", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "1", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv1D'", ")", "(", "inputsDWI", ")", "\n", "conv1D", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN1D'", ")", "(", "conv1D", ")", "\n", "conv1D", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_1D'", ")", "(", "conv1D", ")", "\n", "\n", "conv1_2D", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "1", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv1_2D'", ")", "(", "conv1D", ")", "\n", "conv1_2D", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN1_2D'", ")", "(", "conv1_2D", ")", "\n", "conv1_2D", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_1_2D'", ")", "(", "conv1_2D", ")", "\n", "#block 2", "\n", "conv2D", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "2", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv2D'", ")", "(", "conv1_2D", ")", "\n", "conv2D", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN2D'", ")", "(", "conv2D", ")", "\n", "conv2D", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_2D'", ")", "(", "conv2D", ")", "\n", "\n", "conv2_2D", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "2", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv2_2D'", ")", "(", "conv2D", ")", "\n", "conv2_2D", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN2_2D'", ")", "(", "conv2_2D", ")", "\n", "conv2_2D", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_2_2D'", ")", "(", "conv2_2D", ")", "\n", "#block 3", "\n", "conv3D", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "4", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv3D'", ")", "(", "conv2_2D", ")", "\n", "conv3D", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN3D'", ")", "(", "conv3D", ")", "\n", "conv3D", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_3D'", ")", "(", "conv3D", ")", "\n", "\n", "conv3_2D", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "4", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv3_2D'", ")", "(", "conv3D", ")", "\n", "conv3_2D", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN3_2D'", ")", "(", "conv3_2D", ")", "\n", "conv3_2D", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_3_2D'", ")", "(", "conv3_2D", ")", "\n", "\n", "conv3_3D", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "4", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv3_3D'", ")", "(", "conv3_2D", ")", "\n", "conv3_3D", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN3_3D'", ")", "(", "conv3_3D", ")", "\n", "conv3_3D", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_3_3D'", ")", "(", "conv3_3D", ")", "\n", "#block 4", "\n", "conv4D", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "6", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv4D'", ")", "(", "conv3_3D", ")", "\n", "conv4D", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN4D'", ")", "(", "conv4D", ")", "\n", "conv4D", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_4D'", ")", "(", "conv4D", ")", "\n", "\n", "conv4_2D", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "6", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv4_2D'", ")", "(", "conv4D", ")", "\n", "conv4_2D", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN4_2D'", ")", "(", "conv4_2D", ")", "\n", "conv4_2D", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_4_2D'", ")", "(", "conv4_2D", ")", "\n", "\n", "conv4_3D", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "6", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv4_3D'", ")", "(", "conv4_2D", ")", "\n", "conv4_3D", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN4_3D'", ")", "(", "conv4_3D", ")", "\n", "conv4_3D", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_4_3D'", ")", "(", "conv4_3D", ")", "\n", "\n", "#block 5", "\n", "conv5D", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "8", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv5D'", ")", "(", "conv4_3D", ")", "\n", "conv5D", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN5D'", ")", "(", "conv5D", ")", "\n", "conv5D", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_5D'", ")", "(", "conv5D", ")", "\n", "\n", "conv5_2D", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "8", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv5_2D'", ")", "(", "conv5D", ")", "\n", "conv5_2D", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN5_2D'", ")", "(", "conv5_2D", ")", "\n", "conv5_2D", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_5_2D'", ")", "(", "conv5_2D", ")", "\n", "\n", "conv5_3D", "=", "Conv2D", "(", "64", ",", "(", "3", ",", "3", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "8", ",", "padding", "=", "'same'", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv5_3D'", ")", "(", "conv5_2D", ")", "\n", "conv5_3D", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN5_3D'", ")", "(", "conv5_3D", ")", "\n", "conv5_3D", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_5_3D'", ")", "(", "conv5_3D", ")", "\n", "\n", "\n", "concat", "=", "layers", ".", "concatenate", "(", "[", "conv1_2", ",", "conv1_2D", ",", "conv2_2", ",", "conv2_2D", ",", "conv3_2", ",", "\n", "conv3_2D", ",", "conv4_2", ",", "conv4_2D", ",", "conv5_2", ",", "conv5_2D", "]", ",", "axis", "=", "concat_axis", ")", "\n", "\n", "#block 6", "\n", "dropout1", "=", "Dropout", "(", "0.2", ")", "(", "concat", ")", "\n", "\n", "conv6", "=", "Conv2D", "(", "128", ",", "(", "1", ",", "1", ")", ",", "activation", "=", "None", ",", "dilation_rate", "=", "1", ",", "\n", "kernel_initializer", "=", "'he_uniform'", ",", "name", "=", "'conv6'", ")", "(", "dropout1", ")", "\n", "conv6", "=", "BatchNormalization", "(", "axis", "=", "-", "1", ",", "name", "=", "'BN6'", ")", "(", "conv6", ")", "\n", "conv6", "=", "Activation", "(", "activation", "=", "'relu'", ",", "name", "=", "'act_6'", ")", "(", "conv6", ")", "\n", "\n", "dropout2", "=", "Dropout", "(", "0.2", ")", "(", "conv6", ")", "\n", "\n", "\n", "conv6_2", "=", "layers", ".", "Conv2D", "(", "2", ",", "(", "1", ",", "1", ")", ",", "activation", "=", "'softmax'", ")", "(", "dropout2", ")", "\n", "\n", "model", "=", "models", ".", "Model", "(", "inputs", "=", "[", "inputsDCE", ",", "inputsDWI", "]", ",", "outputs", "=", "conv6_2", ")", "\n", "model", ".", "compile", "(", "optimizer", "=", "optimizers", ".", "Adam", "(", "lr", "=", "0.0001", ",", "decay", "=", "0.0", ")", ",", "\n", "loss", "=", "'categorical_crossentropy'", ",", "\n", "metrics", "=", "[", "'accuracy'", "]", ",", "\n", "sample_weight_mode", "=", "'temporal'", ")", "# lr was 0.001", "\n", "\n", "return", "model", "\n", "\n"]], "home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.iterate_in_mb_train": [[330, 374], ["numpy.random.choice", "numpy.random.choice", "range", "numpy.zeros", "numpy.ones", "int", "range", "int", "int", "scipy.rotate", "scipy.rotate", "scipy.rotate", "numpy.concatenate", "numpy.concatenate", "numpy.concatenate"], "function", ["None"], ["", "def", "iterate_in_mb_train", "(", "train_dce", ",", "train_dwi", ",", "train_y", ")", ":", "\n", "    ", "global", "batch_size", "\n", "\n", "while", "True", ":", "\n", "        ", "i_liver", "=", "np", ".", "random", ".", "choice", "(", "train_dce", ".", "shape", "[", "0", "]", ",", "int", "(", "batch_size", ")", ",", "replace", "=", "False", ")", "\n", "\n", "slices_input_dce", "=", "train_dce", "[", "i_liver", "[", "0", "]", ",", ":", ",", ":", ",", ":", "]", "\n", "slices_input_dce", "=", "slices_input_dce", "[", "np", ".", "newaxis", ",", ":", ",", ":", ",", ":", "]", "\n", "\n", "slices_input_dwi", "=", "train_dwi", "[", "i_liver", "[", "0", "]", ",", ":", ",", ":", ",", ":", "]", "\n", "slices_input_dwi", "=", "slices_input_dwi", "[", "np", ".", "newaxis", ",", ":", ",", ":", ",", ":", "]", "\n", "\n", "slices_target", "=", "train_y", "[", "i_liver", "[", "0", "]", ",", ":", ",", ":", "]", "\n", "slices_target", "=", "slices_target", "[", "np", ".", "newaxis", ",", ":", ",", ":", "]", "\n", "\n", "lim_deg", "=", "45", "# limit of degrees of rotation", "\n", "deg", "=", "np", ".", "random", ".", "choice", "(", "(", "range", "(", "-", "lim_deg", ",", "lim_deg", ")", ")", ",", "int", "(", "batch_size", ")", ")", "\n", "\n", "for", "p", "in", "range", "(", "1", ",", "int", "(", "batch_size", ")", ")", ":", "\n", "            ", "p_input_dce", "=", "train_dce", "[", "i_liver", "[", "p", "]", ",", ":", ",", ":", ",", ":", "]", "\n", "p_input_dwi", "=", "train_dwi", "[", "i_liver", "[", "p", "]", ",", ":", ",", ":", ",", ":", "]", "\n", "p_target", "=", "train_y", "[", "i_liver", "[", "p", "]", ",", ":", ",", ":", "]", "\n", "\n", "p_input_dce", "=", "sp", ".", "rotate", "(", "p_input_dce", ",", "deg", "[", "p", "]", ",", "reshape", "=", "False", ",", "order", "=", "3", ")", "\n", "p_input_dwi", "=", "sp", ".", "rotate", "(", "p_input_dwi", ",", "deg", "[", "p", "]", ",", "reshape", "=", "False", ",", "order", "=", "3", ")", "\n", "p_target", "=", "sp", ".", "rotate", "(", "p_target", ",", "deg", "[", "p", "]", ",", "reshape", "=", "False", ",", "order", "=", "1", ")", "\n", "\n", "p_input_dce", "=", "p_input_dce", "[", "np", ".", "newaxis", ",", ":", ",", ":", ",", ":", "]", "\n", "p_input_dwi", "=", "p_input_dwi", "[", "np", ".", "newaxis", ",", ":", ",", ":", ",", ":", "]", "\n", "p_target", "=", "p_target", "[", "np", ".", "newaxis", ",", ":", ",", ":", "]", "\n", "\n", "slices_input_dce", "=", "np", ".", "concatenate", "(", "(", "slices_input_dce", ",", "p_input_dce", ")", ",", "axis", "=", "0", ")", "\n", "slices_input_dwi", "=", "np", ".", "concatenate", "(", "(", "slices_input_dwi", ",", "p_input_dwi", ")", ",", "axis", "=", "0", ")", "\n", "slices_target", "=", "np", ".", "concatenate", "(", "(", "slices_target", ",", "p_target", ")", ",", "axis", "=", "0", ")", "\n", "\n", "\n", "\n", "", "mb_labels", "=", "np", ".", "zeros", "(", "[", "slices_target", ".", "shape", "[", "0", "]", ",", "slices_target", ".", "shape", "[", "1", "]", ",", "slices_target", ".", "shape", "[", "2", "]", ",", "2", "]", ")", "\n", "neg_target", "=", "np", ".", "ones", "(", "[", "slices_target", ".", "shape", "[", "0", "]", ",", "slices_target", ".", "shape", "[", "1", "]", ",", "slices_target", ".", "shape", "[", "2", "]", ",", "1", "]", ")", "\n", "neg_target", "=", "neg_target", "-", "slices_target", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "mb_labels", "[", ":", ",", ":", ",", ":", ",", "0", ":", "1", "]", "=", "neg_target", "\n", "mb_labels", "[", ":", ",", ":", ",", ":", ",", "1", ":", "2", "]", "=", "slices_target", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "# *5 times the weight, in this case 5.  ", "\n", "\n", "yield", "[", "slices_input_dce", ",", "slices_input_dwi", "]", ",", "mb_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.iterate_in_mb_test": [[376, 420], ["numpy.random.choice", "numpy.random.choice", "range", "numpy.zeros", "numpy.ones", "int", "range", "int", "int", "scipy.rotate", "scipy.rotate", "scipy.rotate", "numpy.concatenate", "numpy.concatenate", "numpy.concatenate"], "function", ["None"], ["", "", "def", "iterate_in_mb_test", "(", "test_dce", ",", "test_dwi", ",", "test_y", ")", ":", "\n", "    ", "global", "batch_size", "\n", "\n", "while", "True", ":", "\n", "        ", "i_liver", "=", "np", ".", "random", ".", "choice", "(", "test_dce", ".", "shape", "[", "0", "]", ",", "int", "(", "batch_size", ")", ",", "replace", "=", "False", ")", "\n", "\n", "slices_input_dce", "=", "test_dce", "[", "i_liver", "[", "0", "]", ",", ":", ",", ":", ",", ":", "]", "\n", "slices_input_dce", "=", "slices_input_dce", "[", "np", ".", "newaxis", ",", ":", ",", ":", ",", ":", "]", "\n", "\n", "slices_input_dwi", "=", "test_dwi", "[", "i_liver", "[", "0", "]", ",", ":", ",", ":", ",", ":", "]", "\n", "slices_input_dwi", "=", "slices_input_dwi", "[", "np", ".", "newaxis", ",", ":", ",", ":", ",", ":", "]", "\n", "\n", "slices_target", "=", "test_y", "[", "i_liver", "[", "0", "]", ",", ":", ",", ":", "]", "\n", "slices_target", "=", "slices_target", "[", "np", ".", "newaxis", ",", ":", ",", ":", "]", "\n", "\n", "lim_deg", "=", "45", "# limit of degrees of rotation", "\n", "deg", "=", "np", ".", "random", ".", "choice", "(", "(", "range", "(", "-", "lim_deg", ",", "lim_deg", ")", ")", ",", "int", "(", "batch_size", ")", ")", "\n", "\n", "for", "p", "in", "range", "(", "1", ",", "int", "(", "batch_size", ")", ")", ":", "\n", "            ", "p_input_dce", "=", "test_dce", "[", "i_liver", "[", "p", "]", ",", ":", ",", ":", ",", ":", "]", "\n", "p_input_dwi", "=", "test_dwi", "[", "i_liver", "[", "p", "]", ",", ":", ",", ":", ",", ":", "]", "\n", "p_target", "=", "test_y", "[", "i_liver", "[", "p", "]", ",", ":", ",", ":", "]", "\n", "\n", "p_input_dce", "=", "sp", ".", "rotate", "(", "p_input_dce", ",", "deg", "[", "p", "]", ",", "reshape", "=", "False", ",", "order", "=", "3", ")", "\n", "p_input_dwi", "=", "sp", ".", "rotate", "(", "p_input_dwi", ",", "deg", "[", "p", "]", ",", "reshape", "=", "False", ",", "order", "=", "3", ")", "\n", "p_target", "=", "sp", ".", "rotate", "(", "p_target", ",", "deg", "[", "p", "]", ",", "reshape", "=", "False", ",", "order", "=", "1", ")", "\n", "\n", "\n", "p_input_dce", "=", "p_input_dce", "[", "np", ".", "newaxis", ",", ":", ",", ":", ",", ":", "]", "\n", "p_input_dwi", "=", "p_input_dwi", "[", "np", ".", "newaxis", ",", ":", ",", ":", ",", ":", "]", "\n", "p_target", "=", "p_target", "[", "np", ".", "newaxis", ",", ":", ",", ":", "]", "\n", "\n", "slices_input_dce", "=", "np", ".", "concatenate", "(", "(", "slices_input_dce", ",", "p_input_dce", ")", ",", "axis", "=", "0", ")", "\n", "slices_input_dwi", "=", "np", ".", "concatenate", "(", "(", "slices_input_dwi", ",", "p_input_dwi", ")", ",", "axis", "=", "0", ")", "\n", "slices_target", "=", "np", ".", "concatenate", "(", "(", "slices_target", ",", "p_target", ")", ",", "axis", "=", "0", ")", "\n", "\n", "\n", "", "mb_labels", "=", "np", ".", "zeros", "(", "[", "slices_target", ".", "shape", "[", "0", "]", ",", "slices_target", ".", "shape", "[", "1", "]", ",", "slices_target", ".", "shape", "[", "2", "]", ",", "2", "]", ")", "\n", "neg_target", "=", "np", ".", "ones", "(", "[", "slices_target", ".", "shape", "[", "0", "]", ",", "slices_target", ".", "shape", "[", "1", "]", ",", "slices_target", ".", "shape", "[", "2", "]", ",", "1", "]", ")", "\n", "neg_target", "=", "neg_target", "-", "slices_target", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "mb_labels", "[", ":", ",", ":", ",", ":", ",", "0", ":", "1", "]", "=", "neg_target", "\n", "mb_labels", "[", ":", ",", ":", ",", ":", ",", "1", ":", "2", "]", "=", "slices_target", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "#*5  weighting of class 1 ", "\n", "\n", "yield", "[", "slices_input_dce", ",", "slices_input_dwi", "]", ",", "mb_labels", "\n", "\n"]], "home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.bbox": [[423, 431], ["numpy.sum", "numpy.any", "numpy.any", "numpy.where", "numpy.where"], "function", ["None"], ["", "", "def", "bbox", "(", "img", ")", ":", "\n", "    ", "img", "=", "np", ".", "sum", "(", "img", ",", "axis", "=", "0", ")", "\n", "rows", "=", "np", ".", "any", "(", "img", ",", "axis", "=", "1", ")", "\n", "cols", "=", "np", ".", "any", "(", "img", ",", "axis", "=", "0", ")", "\n", "rmin", ",", "rmax", "=", "np", ".", "where", "(", "rows", ")", "[", "0", "]", "[", "[", "0", ",", "-", "1", "]", "]", "\n", "cmin", ",", "cmax", "=", "np", ".", "where", "(", "cols", ")", "[", "0", "]", "[", "[", "0", ",", "-", "1", "]", "]", "\n", "\n", "return", "rmin", ",", "rmax", ",", "cmin", ",", "cmax", "\n", "\n"]], "home.repos.pwc.inspect_result.MarielleJansen_Liver-metastases-detection.None.LiverMetastaseDetection_Pnet_DCEDWI.imsave": [[432, 435], ["SimpleITK.GetImageFromArray", "SimpleITK.WriteImage"], "function", ["None"], ["", "def", "imsave", "(", "fname", ",", "arr", ")", ":", "\n", "    ", "sitk_img", "=", "sitk", ".", "GetImageFromArray", "(", "arr", ")", "\n", "sitk", ".", "WriteImage", "(", "sitk_img", ",", "fname", ")", "\n", "\n"]]}