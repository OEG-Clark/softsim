{"home.repos.pwc.inspect_result.bupt-ai-cz_BALNMP.None.model.AttentionAggregator.__init__": [[10, 39], ["torch.nn.Module.__init__", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Linear", "torch.nn.Dropout", "torch.nn.ReLU", "torch.nn.Linear", "torch.nn.Dropout", "torch.nn.Tanh", "torch.nn.Linear", "torch.nn.Dropout", "torch.nn.Linear", "torch.nn.ReLU", "torch.nn.Linear", "torch.nn.Tanh", "torch.nn.Linear"], "methods", ["home.repos.pwc.inspect_result.bupt-ai-cz_BALNMP.None.model.MILMainNetWithClinicalData.__init__"], ["    ", "def", "__init__", "(", "self", ",", "in_features_size", ",", "inner_feature_size", "=", "128", ",", "out_feature_size", "=", "256", ",", "is_dropout", "=", "True", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "in_features_size", "=", "in_features_size", "\n", "self", ".", "L", "=", "out_feature_size", "\n", "self", ".", "D", "=", "inner_feature_size", "\n", "\n", "if", "is_dropout", ":", "\n", "            ", "self", ".", "fc1", "=", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Linear", "(", "self", ".", "in_features_size", ",", "self", ".", "L", ")", ",", "\n", "nn", ".", "Dropout", "(", ")", ",", "\n", "nn", ".", "ReLU", "(", ")", "\n", ")", "\n", "self", ".", "attention", "=", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Linear", "(", "self", ".", "L", ",", "self", ".", "D", ")", ",", "\n", "nn", ".", "Dropout", "(", ")", ",", "\n", "nn", ".", "Tanh", "(", ")", ",", "\n", "nn", ".", "Linear", "(", "self", ".", "D", ",", "1", ")", ",", "\n", "nn", ".", "Dropout", "(", ")", "\n", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "fc1", "=", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Linear", "(", "self", ".", "in_features_size", ",", "self", ".", "L", ")", ",", "\n", "nn", ".", "ReLU", "(", ")", "\n", ")", "\n", "self", ".", "attention", "=", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Linear", "(", "self", ".", "L", ",", "self", ".", "D", ")", ",", "\n", "nn", ".", "Tanh", "(", ")", ",", "\n", "nn", ".", "Linear", "(", "self", ".", "D", ",", "1", ")", ",", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.bupt-ai-cz_BALNMP.None.model.AttentionAggregator.forward": [[41, 52], ["model.AttentionAggregator.view", "model.AttentionAggregator.fc1", "model.AttentionAggregator.attention", "torch.transpose", "torch.nn.functional.softmax", "torch.mm"], "methods", ["None"], ["", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "x", "=", "x", ".", "view", "(", "-", "1", ",", "self", ".", "in_features_size", ")", "# [bag_size, channel * height * width]", "\n", "x", "=", "self", ".", "fc1", "(", "x", ")", "# [bag_size, L]", "\n", "\n", "a", "=", "self", ".", "attention", "(", "x", ")", "# [bag_size, 1]", "\n", "a", "=", "torch", ".", "transpose", "(", "a", ",", "1", ",", "0", ")", "# [1, bag_size]", "\n", "a", "=", "F", ".", "softmax", "(", "a", ",", "dim", "=", "1", ")", "\n", "\n", "m", "=", "torch", ".", "mm", "(", "a", ",", "x", ")", "# [1, bag_size] * [bag_size, L] = [1, L]", "\n", "\n", "return", "m", ",", "a", "\n", "\n"]], "home.repos.pwc.inspect_result.bupt-ai-cz_BALNMP.None.model.MILMainNetWithClinicalData.__init__": [[56, 68], ["torch.nn.Module.__init__", "model.MILMainNetWithClinicalData.build_image_feature_extractor", "model.AttentionAggregator", "torch.nn.Sequential", "torch.nn.Linear", "torch.nn.ReLU", "torch.nn.Linear"], "methods", ["home.repos.pwc.inspect_result.bupt-ai-cz_BALNMP.None.model.MILMainNetWithClinicalData.__init__", "home.repos.pwc.inspect_result.bupt-ai-cz_BALNMP.None.model.MILMainNetWithClinicalData.build_image_feature_extractor"], ["    ", "def", "__init__", "(", "self", ",", "num_classes", "=", "2", ",", "clinical_data_size", "=", "5", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "build_image_feature_extractor", "(", ")", "\n", "\n", "self", ".", "attention_aggregator", "=", "AttentionAggregator", "(", "self", ".", "image_feature_extractor", ".", "output_features_size", ",", "1", ")", "\n", "\n", "self", ".", "clinical_data_size", "=", "clinical_data_size", "\n", "self", ".", "scale_rate", "=", "10", "\n", "self", ".", "classifier", "=", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Linear", "(", "self", ".", "attention_aggregator", ".", "L", "+", "self", ".", "clinical_data_size", "*", "self", ".", "scale_rate", ",", "64", ")", ",", "\n", "nn", ".", "ReLU", "(", ")", ",", "\n", "nn", ".", "Linear", "(", "64", ",", "num_classes", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.bupt-ai-cz_BALNMP.None.model.MILMainNetWithClinicalData.build_image_feature_extractor": [[69, 72], ["torch.nn.Sequential", "list", "torchvision.models.vgg16_bn().children", "torchvision.models.vgg16_bn"], "methods", ["None"], ["", "def", "build_image_feature_extractor", "(", "self", ")", ":", "\n", "        ", "self", ".", "image_feature_extractor", "=", "nn", ".", "Sequential", "(", "*", "(", "list", "(", "torchvision", ".", "models", ".", "vgg16_bn", "(", "pretrained", "=", "True", ")", ".", "children", "(", ")", ")", "[", ":", "-", "1", "]", ")", ")", "\n", "self", ".", "image_feature_extractor", ".", "output_features_size", "=", "512", "*", "7", "*", "7", "\n", "\n"]], "home.repos.pwc.inspect_result.bupt-ai-cz_BALNMP.None.model.MILMainNetWithClinicalData.forward": [[73, 81], ["bag_data.squeeze.squeeze.squeeze", "model.MILMainNetWithClinicalData.image_feature_extractor", "model.MILMainNetWithClinicalData.attention_aggregator", "torch.cat", "model.MILMainNetWithClinicalData.classifier", "clinical_data.repeat().float", "clinical_data.repeat"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "bag_data", ",", "clinical_data", ")", ":", "\n", "        ", "bag_data", "=", "bag_data", ".", "squeeze", "(", "0", ")", "\n", "patch_features", "=", "self", ".", "image_feature_extractor", "(", "bag_data", ")", "\n", "aggregated_feature", ",", "attention", "=", "self", ".", "attention_aggregator", "(", "patch_features", ")", "\n", "fused_data", "=", "torch", ".", "cat", "(", "[", "aggregated_feature", ",", "clinical_data", ".", "repeat", "(", "1", ",", "self", ".", "scale_rate", ")", ".", "float", "(", ")", "]", ",", "dim", "=", "-", "1", ")", "\n", "result", "=", "self", ".", "classifier", "(", "fused_data", ")", "\n", "\n", "return", "result", ",", "attention", "\n", "", "", ""]], "home.repos.pwc.inspect_result.bupt-ai-cz_BALNMP.code_preprocessing.cut_tumor_regions.get_annotation_points_and_bboxes": [[12, 26], ["open", "json.load", "annotation_points.append", "bboxes.append", "cut_tumor_regions.get_bbox"], "function", ["home.repos.pwc.inspect_result.bupt-ai-cz_BALNMP.code_preprocessing.cut_tumor_regions.get_bbox"], ["def", "get_annotation_points_and_bboxes", "(", "json_path", ")", ":", "\n", "    ", "\"\"\"get coordinate of each point in each annotated region, and get bounding box ([start_x, start_y, width, height]) of each annotated region\"\"\"", "\n", "with", "open", "(", "json_path", ")", "as", "f", ":", "\n", "        ", "asap_json", "=", "json", ".", "load", "(", "f", ")", "\n", "\n", "", "annotation_points", "=", "[", "]", "\n", "bboxes", "=", "[", "]", "\n", "\n", "# data only exist in 'positive'", "\n", "for", "i", "in", "asap_json", "[", "'positive'", "]", ":", "\n", "        ", "annotation_points", ".", "append", "(", "i", "[", "'vertices'", "]", ")", "\n", "bboxes", ".", "append", "(", "get_bbox", "(", "i", "[", "'vertices'", "]", ")", ")", "\n", "\n", "", "return", "annotation_points", ",", "bboxes", "\n", "\n"]], "home.repos.pwc.inspect_result.bupt-ai-cz_BALNMP.code_preprocessing.cut_tumor_regions.get_bbox": [[28, 38], ["numpy.asarray", "numpy.max", "numpy.min", "np.min.tolist", "width_height.tolist"], "function", ["None"], ["", "def", "get_bbox", "(", "points", ")", ":", "\n", "    ", "\"\"\"get bounding box of an annotated region\"\"\"", "\n", "points", "=", "np", ".", "asarray", "(", "points", ")", "\n", "max_x_y", "=", "np", ".", "max", "(", "points", ",", "axis", "=", "0", ")", "\n", "min_x_y", "=", "np", ".", "min", "(", "points", ",", "axis", "=", "0", ")", "\n", "\n", "width_height", "=", "max_x_y", "-", "min_x_y", "\n", "bbox", "=", "min_x_y", ".", "tolist", "(", ")", "+", "width_height", ".", "tolist", "(", ")", "\n", "\n", "return", "bbox", "# [start_x, start_y, width, height]", "\n", "\n"]], "home.repos.pwc.inspect_result.bupt-ai-cz_BALNMP.code_preprocessing.cut_patches.padding": [[8, 19], ["int", "int", "cv2.copyMakeBorder", "numpy.ceil", "numpy.ceil"], "function", ["None"], ["def", "padding", "(", "image_array", ",", "patch_size", ")", ":", "\n", "    ", "\"\"\"padding an image on the right and bottom with [255, 255, 255]\"\"\"", "\n", "height", ",", "width", "=", "image_array", ".", "shape", "[", ":", "2", "]", "\n", "\n", "right", "=", "int", "(", "np", ".", "ceil", "(", "width", "/", "patch_size", ")", "*", "patch_size", "-", "width", ")", "\n", "bottom", "=", "int", "(", "np", ".", "ceil", "(", "height", "/", "patch_size", ")", "*", "patch_size", "-", "height", ")", "\n", "\n", "# padding", "\n", "image_array", "=", "cv2", ".", "copyMakeBorder", "(", "image_array", ",", "0", ",", "bottom", ",", "0", ",", "right", ",", "cv2", ".", "BORDER_CONSTANT", ",", "value", "=", "(", "255", ",", "255", ",", "255", ")", ")", "\n", "\n", "return", "image_array", "\n", "\n"]], "home.repos.pwc.inspect_result.bupt-ai-cz_BALNMP.code_preprocessing.cut_patches.is_deprecated": [[21, 29], ["numpy.sum"], "function", ["None"], ["", "def", "is_deprecated", "(", "image_array", ",", "blank_rate", ")", ":", "\n", "    ", "\"\"\"whether to deprecate the patches with blank ratio greater than max_blank_ratio\"\"\"", "\n", "blank_num", "=", "np", ".", "sum", "(", "image_array", "==", "(", "255", ",", "255", ",", "255", ")", ")", "/", "3", "\n", "height", ",", "width", "=", "image_array", ".", "shape", "[", ":", "2", "]", "\n", "if", "blank_num", "/", "(", "height", "*", "width", ")", ">=", "blank_rate", ":", "\n", "        ", "return", "True", "\n", "", "else", ":", "\n", "        ", "return", "False", "\n", "\n"]]}