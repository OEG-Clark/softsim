{"home.repos.pwc.inspect_result.kang205_MoHR.None.sampler.WarpSampler.__init__": [[86, 105], ["multiprocessing.Queue", "range", "sampler.WarpSampler.processors.append", "sampler.WarpSampler.processors[].start", "multiprocessing.Process", "numpy.random.randint"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "User", ",", "user_train_set", ",", "Item", ",", "usernum", ",", "itemnum", ",", "Relationships", ",", "batch_size", "=", "10000", ",", "n_workers", "=", "2", ",", "\n", "is_test", "=", "False", ",", "User_test", "=", "[", "]", ")", ":", "\n", "        ", "self", ".", "result_queue", "=", "Queue", "(", "maxsize", "=", "n_workers", "*", "10", ")", "\n", "self", ".", "processors", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "n_workers", ")", ":", "\n", "            ", "self", ".", "processors", ".", "append", "(", "\n", "Process", "(", "target", "=", "sample_function", ",", "args", "=", "(", "User", ",", "\n", "user_train_set", ",", "\n", "Item", ",", "\n", "usernum", ",", "\n", "itemnum", ",", "\n", "Relationships", ",", "\n", "batch_size", ",", "\n", "self", ".", "result_queue", ",", "\n", "np", ".", "random", ".", "randint", "(", "2e9", ")", ",", "\n", "is_test", ",", "\n", "User_test", ")", ")", ")", "\n", "self", ".", "processors", "[", "-", "1", "]", ".", "daemon", "=", "True", "\n", "self", ".", "processors", "[", "-", "1", "]", ".", "start", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.kang205_MoHR.None.sampler.WarpSampler.next_batch": [[106, 108], ["sampler.WarpSampler.result_queue.get"], "methods", ["None"], ["", "", "def", "next_batch", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "result_queue", ".", "get", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.kang205_MoHR.None.sampler.WarpSampler.close": [[109, 113], ["p.terminate", "p.join"], "methods", ["None"], ["", "def", "close", "(", "self", ")", ":", "\n", "        ", "for", "p", "in", "self", ".", "processors", ":", "\n", "            ", "p", ".", "terminate", "(", ")", "\n", "p", ".", "join", "(", ")", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.kang205_MoHR.None.sampler.sample_function": [[6, 82], ["len", "dict", "range", "numpy.random.seed", "len", "len", "[].keys", "numpy.random.randint", "numpy.random.randint", "range", "result_queue.put", "numpy.random.randint", "numpy.random.randint", "numpy.random.randint", "pr.append", "random.sample", "numpy.random.randint", "numpy.random.randint", "numpy.random.randint", "len", "random.sample", "numpy.random.randint", "sampler.sample_function.sample_ui"], "function", ["None"], ["def", "sample_function", "(", "User", ",", "user_train_set", ",", "Item", ",", "usernum", ",", "itemnum", ",", "Relationships", ",", "batch_size", ",", "result_queue", ",", "SEED", ",", "\n", "is_test", "=", "False", ",", "User_test", "=", "[", "]", ")", ":", "\n", "    ", "num_rel", "=", "len", "(", "Relationships", ")", "\n", "invRelationships", "=", "dict", "(", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "Relationships", ")", ")", ":", "\n", "        ", "invRelationships", "[", "Relationships", "[", "i", "]", "]", "=", "i", "\n", "\n", "", "def", "sample_ui", "(", ")", ":", "\n", "        ", "if", "not", "is_test", ":", "\n", "            ", "user", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "usernum", ")", "\n", "while", "len", "(", "User", "[", "user", "]", ")", "<=", "1", ":", "user", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "usernum", ")", "\n", "", "else", ":", "\n", "            ", "user", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "usernum", ")", "\n", "while", "len", "(", "User_test", "[", "user", "]", ")", "<=", "1", ":", "user", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "usernum", ")", "\n", "", "num_item", "=", "len", "(", "User", "[", "user", "]", ")", "\n", "# find postive item pair", "\n", "\n", "if", "not", "is_test", ":", "\n", "            ", "item_i", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "num_item", "-", "1", ")", "\n", "item_j", "=", "item_i", "+", "1", "\n", "\n", "item_i", "=", "User", "[", "user", "]", "[", "item_i", "]", "\n", "item_j", "=", "User", "[", "user", "]", "[", "item_j", "]", "\n", "", "else", ":", "\n", "            ", "item_i", "=", "User_test", "[", "user", "]", "[", "0", "]", "\n", "item_j", "=", "User_test", "[", "user", "]", "[", "1", "]", "\n", "\n", "", "item_i_mask", "=", "Item", "[", "item_i", "]", "[", "'mask'", "]", "\n", "item_i_mask_list", "=", "Item", "[", "item_i", "]", "[", "'mask_list'", "]", "\n", "\n", "pr", "=", "[", "]", "\n", "flag", "=", "True", "\n", "for", "r", "in", "Item", "[", "item_i", "]", "[", "'related'", "]", ".", "keys", "(", ")", ":", "\n", "            ", "if", "item_j", "in", "Item", "[", "item_i", "]", "[", "'related'", "]", "[", "r", "]", ":", "\n", "                ", "pr", ".", "append", "(", "invRelationships", "[", "r", "]", "+", "1", ")", "\n", "flag", "=", "False", "\n", "", "", "if", "flag", ":", "\n", "            ", "pr", ".", "append", "(", "0", ")", "\n", "", "item_ui_r", "=", "random", ".", "sample", "(", "pr", ",", "1", ")", "[", "0", "]", "\n", "\n", "while", "True", ":", "\n", "            ", "item_ui_rp", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "num_rel", "+", "1", ")", "# np.random.choice(item_i_mask_list,1)[0]", "\n", "if", "not", "item_ui_rp", "in", "pr", ":", "break", "\n", "\n", "", "s", "=", "user_train_set", "[", "user", "]", "\n", "item_jp", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "itemnum", ")", "\n", "while", "item_jp", "in", "s", "or", "item_jp", "==", "item_i", "or", "item_jp", "==", "item_j", ":", "item_jp", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "itemnum", ")", "\n", "return", "user", ",", "item_i", ",", "item_i_mask", ",", "item_ui_r", ",", "item_ui_rp", ",", "item_j", ",", "item_jp", "\n", "\n", "", "def", "sample_ii", "(", ")", ":", "\n", "\n", "        ", "while", "True", ":", "\n", "            ", "i", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "itemnum", ")", "\n", "while", "len", "(", "Item", "[", "i", "]", "[", "'related'", "]", ")", "==", "0", ":", "\n", "                ", "i", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "itemnum", ")", "\n", "", "r", "=", "invRelationships", "[", "np", ".", "random", ".", "choice", "(", "Item", "[", "i", "]", "[", "'related'", "]", ".", "keys", "(", ")", ",", "1", ")", "[", "0", "]", "]", "\n", "\n", "num_item", "=", "len", "(", "Item", "[", "i", "]", "[", "'related'", "]", "[", "Relationships", "[", "r", "]", "]", ")", "\n", "if", "num_item", "!=", "0", ":", "\n", "                ", "break", "\n", "\n", "", "", "j", "=", "random", ".", "sample", "(", "Item", "[", "i", "]", "[", "'related'", "]", "[", "Relationships", "[", "r", "]", "]", ",", "1", ")", "[", "0", "]", "\n", "\n", "jp", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "itemnum", ")", "\n", "while", "jp", "in", "Item", "[", "i", "]", "[", "'related'", "]", "[", "Relationships", "[", "r", "]", "]", "or", "jp", "==", "i", ":", "jp", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "itemnum", ")", "\n", "return", "r", ",", "i", ",", "j", ",", "jp", "\n", "\n", "", "np", ".", "random", ".", "seed", "(", "SEED", ")", "\n", "while", "True", ":", "\n", "        ", "one_batch", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "batch_size", ")", ":", "\n", "            ", "batch1", "=", "sample_ui", "(", ")", "\n", "batch2", "=", "sample_ii", "(", ")", "\n", "\n", "one_batch", ".", "append", "(", "batch1", "+", "batch2", ")", "\n", "", "result_queue", ".", "put", "(", "zip", "(", "*", "one_batch", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.kang205_MoHR.None.model.MoHR.save": [[5, 7], ["model.MoHR.saver.save"], "methods", ["home.repos.pwc.inspect_result.kang205_MoHR.None.model.MoHR.save"], ["    ", "def", "save", "(", "self", ",", "sess", ")", ":", "\n", "        ", "self", ".", "saver", ".", "save", "(", "sess", ",", "self", ".", "model_name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.kang205_MoHR.None.model.MoHR.predict": [[8, 17], ["tensorflow.expand_dims", "tensorflow.expand_dims", "tensorflow.concat", "tensorflow.reduce_sum", "tensorflow.ones", "tensorflow.reduce_sum", "tensorflow.square", "tensorflow.shape"], "methods", ["None"], ["", "def", "predict", "(", "self", ",", "item_i", ",", "item_j", ",", "relation", ",", "relation_emb", ")", ":", "\n", "        ", "item_i", "=", "tf", ".", "expand_dims", "(", "item_i", ",", "1", ")", "\n", "item_j", "=", "tf", ".", "expand_dims", "(", "item_j", ",", "1", ")", "\n", "\n", "relation", "=", "tf", ".", "concat", "(", "\n", "[", "relation", "*", "self", ".", "gamma", ",", "(", "1", "-", "self", ".", "gamma", ")", "*", "tf", ".", "ones", "(", "[", "tf", ".", "shape", "(", "relation", ")", "[", "0", "]", ",", "1", "]", ")", "]", ",", "1", "\n", ")", "\n", "\n", "return", "tf", ".", "reduce_sum", "(", "relation", "*", "(", "-", "tf", ".", "reduce_sum", "(", "tf", ".", "square", "(", "item_i", "+", "relation_emb", "-", "item_j", ")", ",", "2", ")", ")", ",", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.kang205_MoHR.None.model.MoHR.decision": [[18, 32], ["tensorflow.expand_dims", "tensorflow.expand_dims", "tensorflow.concat", "tensorflow.tile", "tensorflow.nn.softmax", "tensorflow.shape", "tensorflow.nn.embedding_lookup", "tensorflow.nn.embedding_lookup", "tensorflow.reduce_sum", "tensorflow.tile", "tensorflow.tile", "tensorflow.square", "tensorflow.expand_dims", "tensorflow.expand_dims"], "methods", ["None"], ["", "def", "decision", "(", "self", ",", "inp", ")", ":", "\n", "        ", "[", "i", ",", "u", "]", "=", "inp", "\n", "real_bsize", "=", "tf", ".", "shape", "(", "u", ")", "[", "0", "]", "\n", "batch_u_emb", "=", "tf", ".", "expand_dims", "(", "tf", ".", "nn", ".", "embedding_lookup", "(", "self", ".", "u_embeddings", ",", "u", ")", ",", "1", ")", "\n", "batch_i_emb", "=", "tf", ".", "expand_dims", "(", "tf", ".", "nn", ".", "embedding_lookup", "(", "self", ".", "i_embeddings", ",", "i", ")", ",", "1", ")", "\n", "batch_r_emb", "=", "tf", ".", "concat", "(", "\n", "[", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "self", ".", "r0_embeddings", ",", "0", ")", ",", "[", "real_bsize", ",", "1", ",", "1", "]", ")", ",", "\n", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "self", ".", "r_embeddings", ",", "0", ")", ",", "[", "real_bsize", ",", "1", ",", "1", "]", ")", "]", ",", "1", "\n", ")", "\n", "batch_r_bias", "=", "tf", ".", "tile", "(", "self", ".", "r_biases", ",", "[", "real_bsize", ",", "1", "]", ")", "\n", "pred", "=", "batch_r_bias", "-", "tf", ".", "reduce_sum", "(", "tf", ".", "square", "(", "batch_u_emb", "+", "batch_i_emb", "-", "batch_r_emb", ")", ",", "2", ")", "\n", "pred", "=", "tf", ".", "nn", ".", "softmax", "(", "pred", ")", "\n", "\n", "return", "pred", "\n", "\n"]], "home.repos.pwc.inspect_result.kang205_MoHR.None.model.MoHR.__init__": [[33, 138], ["len", "tensorflow.Variable", "tensorflow.Variable", "tensorflow.Variable", "tensorflow.Variable", "tensorflow.Variable", "tensorflow.Variable", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.nn.embedding_lookup", "tensorflow.nn.embedding_lookup", "tensorflow.nn.embedding_lookup", "tensorflow.nn.embedding_lookup", "tensorflow.nn.embedding_lookup", "tensorflow.nn.embedding_lookup", "tensorflow.nn.embedding_lookup", "tensorflow.nn.embedding_lookup", "tensorflow.nn.embedding_lookup", "tensorflow.nn.embedding_lookup", "tensorflow.nn.embedding_lookup", "tensorflow.nn.embedding_lookup", "tensorflow.tile", "model.MoHR.decision", "tensorflow.reduce_sum", "tensorflow.reduce_sum", "tensorflow.reduce_mean", "tensorflow.reduce_mean", "tensorflow.reduce_mean", "model.MoHR.gds.append", "tensorflow.train.Saver", "tensorflow.nn.l2_normalize", "tensorflow.nn.l2_normalize", "tensorflow.nn.l2_normalize", "tensorflow.nn.l2_normalize", "tensorflow.zeros", "tensorflow.zeros", "tensorflow.shape", "tensorflow.expand_dims", "model.MoHR.predict", "model.MoHR.predict", "tensorflow.reduce_sum", "tensorflow.reduce_sum", "tensorflow.reduce_mean", "tensorflow.reduce_mean", "sum", "tensorflow.train.AdamOptimizer().minimize", "tensorflow.control_dependencies", "model.MoHR.gds.append", "model.MoHR.gds.append", "model.MoHR.gds.append", "model.MoHR.gds.append", "tensorflow.random_normal", "tensorflow.random_normal", "tensorflow.random_normal", "tensorflow.random_normal", "tensorflow.concat", "tensorflow.concat", "tensorflow.square", "tensorflow.square", "tensorflow.log_sigmoid", "tensorflow.one_hot", "tensorflow.one_hot", "tensorflow.log_sigmoid", "map", "tensorflow.assign", "tensorflow.assign", "tensorflow.assign", "tensorflow.assign", "tensorflow.reduce_mean", "tensorflow.sign", "tensorflow.sign", "tensorflow.sign", "tensorflow.train.AdamOptimizer", "tensorflow.clip_by_norm", "tensorflow.clip_by_norm", "tensorflow.clip_by_norm", "tensorflow.clip_by_norm", "tensorflow.tile", "tensorflow.expand_dims", "tensorflow.tile", "tensorflow.expand_dims", "tensorflow.log_sigmoid", "tensorflow.expand_dims", "tensorflow.expand_dims"], "methods", ["home.repos.pwc.inspect_result.kang205_MoHR.None.model.MoHR.decision", "home.repos.pwc.inspect_result.kang205_MoHR.None.model.MoHR.predict", "home.repos.pwc.inspect_result.kang205_MoHR.None.model.MoHR.predict"], ["", "def", "__init__", "(", "self", ",", "usernum", ",", "itemnum", ",", "Relationships", ",", "args", ")", ":", "\n", "        ", "self", ".", "Relationships", "=", "Relationships", "\n", "self", ".", "usernum", "=", "usernum", "\n", "self", ".", "itemnum", "=", "itemnum", "\n", "self", ".", "d_emb", "=", "args", ".", "latent_dimension", "\n", "self", ".", "relnum", "=", "len", "(", "Relationships", ")", "\n", "self", ".", "gamma", "=", "args", ".", "gamma", "\n", "\n", "d_emb", "=", "args", ".", "latent_dimension", "\n", "learning_rate", "=", "args", ".", "learning_rate", "\n", "self", ".", "model_name", "=", "'MoHR_%s_%d_%g_%g_%g_%g_%g_%g.ckpt'", "%", "(", "\n", "args", ".", "dataset", ",", "d_emb", ",", "learning_rate", ",", "args", ".", "alpha", ",", "args", ".", "beta", ",", "args", ".", "norm", ",", "args", ".", "lambda_bias", ",", "args", ".", "gamma", ")", "\n", "\n", "# Learnable Variables", "\n", "self", ".", "u_embeddings", "=", "tf", ".", "Variable", "(", "tf", ".", "nn", ".", "l2_normalize", "(", "tf", ".", "random_normal", "(", "[", "usernum", ",", "d_emb", "]", ",", "\n", "stddev", "=", "1", "/", "(", "d_emb", "**", "0.5", ")", ",", "\n", "dtype", "=", "tf", ".", "float32", ")", ",", "1", ")", ")", "\n", "self", ".", "i_embeddings", "=", "tf", ".", "Variable", "(", "tf", ".", "nn", ".", "l2_normalize", "(", "tf", ".", "random_normal", "(", "[", "itemnum", ",", "d_emb", "]", ",", "\n", "stddev", "=", "1", "/", "(", "d_emb", "**", "0.5", ")", ",", "\n", "dtype", "=", "tf", ".", "float32", ")", ",", "1", ")", ")", "\n", "self", ".", "r_embeddings", "=", "tf", ".", "Variable", "(", "tf", ".", "nn", ".", "l2_normalize", "(", "tf", ".", "random_normal", "(", "[", "self", ".", "relnum", ",", "d_emb", "]", ",", "\n", "stddev", "=", "1", "/", "(", "d_emb", "**", "0.5", ")", ",", "\n", "dtype", "=", "tf", ".", "float32", ")", ",", "1", ")", ")", "\n", "self", ".", "r0_embeddings", "=", "tf", ".", "Variable", "(", "tf", ".", "nn", ".", "l2_normalize", "(", "tf", ".", "random_normal", "(", "[", "1", ",", "d_emb", "]", ",", "\n", "stddev", "=", "1", "/", "(", "d_emb", "**", "0.5", ")", ",", "\n", "dtype", "=", "tf", ".", "float32", ")", ",", "1", ")", ")", "\n", "self", ".", "r_biases", "=", "tf", ".", "Variable", "(", "tf", ".", "zeros", "(", "[", "1", ",", "self", ".", "relnum", "+", "1", "]", ",", "dtype", "=", "tf", ".", "float32", ")", ")", "\n", "\n", "self", ".", "i_biases", "=", "tf", ".", "Variable", "(", "tf", ".", "zeros", "(", "[", "itemnum", "]", ",", "dtype", "=", "tf", ".", "float32", ")", ")", "\n", "\n", "# Sample Batch", "\n", "self", ".", "batch_u", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "[", "None", "]", ")", "\n", "real_bsize", "=", "tf", ".", "shape", "(", "self", ".", "batch_u", ")", "[", "0", "]", "\n", "\n", "self", ".", "batch_i", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "[", "None", "]", ")", "\n", "self", ".", "batch_ui_r", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "[", "None", "]", ")", "\n", "self", ".", "batch_ui_rp", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "[", "None", "]", ")", "\n", "self", ".", "batch_j", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "[", "None", "]", ")", "\n", "self", ".", "batch_jp", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "[", "None", "]", ")", "\n", "\n", "self", ".", "batch_lp_i", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "[", "None", "]", ")", "\n", "self", ".", "batch_lp_j", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "[", "None", "]", ")", "\n", "self", ".", "batch_lp_r", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "[", "None", "]", ")", "\n", "self", ".", "batch_lp_jp", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "[", "None", "]", ")", "\n", "\n", "self", ".", "batch_lp_i_emb", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "self", ".", "i_embeddings", ",", "self", ".", "batch_lp_i", ")", "\n", "self", ".", "batch_lp_j_emb", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "self", ".", "i_embeddings", ",", "self", ".", "batch_lp_j", ")", "\n", "self", ".", "batch_lp_r_emb", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "self", ".", "r_embeddings", ",", "self", ".", "batch_lp_r", ")", "\n", "self", ".", "batch_lp_jp_emb", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "self", ".", "i_embeddings", ",", "self", ".", "batch_lp_jp", ")", "\n", "\n", "self", ".", "batch_u_emb", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "self", ".", "u_embeddings", ",", "self", ".", "batch_u", ")", "\n", "self", ".", "batch_i_emb", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "self", ".", "i_embeddings", ",", "self", ".", "batch_i", ")", "\n", "self", ".", "batch_j_emb", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "self", ".", "i_embeddings", ",", "self", ".", "batch_j", ")", "\n", "self", ".", "batch_jp_emb", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "self", ".", "i_embeddings", ",", "self", ".", "batch_jp", ")", "\n", "self", ".", "batch_j_bias", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "self", ".", "i_biases", ",", "self", ".", "batch_j", ")", "\n", "self", ".", "batch_jp_bias", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "self", ".", "i_biases", ",", "self", ".", "batch_jp", ")", "\n", "self", ".", "batch_lp_j_bias", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "self", ".", "i_biases", ",", "self", ".", "batch_lp_j", ")", "\n", "self", ".", "batch_lp_jp_bias", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "self", ".", "i_biases", ",", "self", ".", "batch_lp_jp", ")", "\n", "self", ".", "batch_r0", "=", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "self", ".", "r0_embeddings", ",", "0", ")", ",", "[", "real_bsize", ",", "1", ",", "1", "]", ")", "\n", "\n", "relation_weight", "=", "self", ".", "decision", "(", "[", "self", ".", "batch_i", ",", "self", ".", "batch_u", "]", ")", "\n", "\n", "pos_distances", "=", "self", ".", "batch_j_bias", "+", "self", ".", "predict", "(", "self", ".", "batch_i_emb", ",", "self", ".", "batch_j_emb", ",", "relation_weight", ",", "\n", "tf", ".", "concat", "(", "[", "self", ".", "batch_r0", ",", "\n", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "self", ".", "r_embeddings", ",", "0", ")", ",", "\n", "[", "real_bsize", ",", "1", ",", "1", "]", ")", ",", "\n", "tf", ".", "expand_dims", "(", "self", ".", "batch_u_emb", ",", "1", ")", "]", ",", "1", ")", ")", "\n", "neg_distances", "=", "self", ".", "batch_jp_bias", "+", "self", ".", "predict", "(", "self", ".", "batch_i_emb", ",", "self", ".", "batch_jp_emb", ",", "relation_weight", ",", "\n", "tf", ".", "concat", "(", "[", "self", ".", "batch_r0", ",", "\n", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "self", ".", "r_embeddings", ",", "0", ")", ",", "\n", "[", "real_bsize", ",", "1", ",", "1", "]", ")", ",", "\n", "tf", ".", "expand_dims", "(", "self", ".", "batch_u_emb", ",", "1", ")", "]", ",", "1", ")", ")", "\n", "\n", "lp_pos_distances", "=", "self", ".", "batch_lp_j_bias", "-", "tf", ".", "reduce_sum", "(", "\n", "tf", ".", "square", "(", "self", ".", "batch_lp_i_emb", "+", "self", ".", "batch_lp_r_emb", "-", "self", ".", "batch_lp_j_emb", ")", ",", "1", ")", "\n", "\n", "lp_neg_distances", "=", "self", ".", "batch_lp_jp_bias", "-", "tf", ".", "reduce_sum", "(", "\n", "tf", ".", "square", "(", "self", ".", "batch_lp_i_emb", "+", "self", ".", "batch_lp_r_emb", "-", "self", ".", "batch_lp_jp_emb", ")", ",", "1", ")", "\n", "\n", "self", ".", "lp_loss", "=", "-", "tf", ".", "reduce_mean", "(", "tf", ".", "log_sigmoid", "(", "lp_pos_distances", "-", "lp_neg_distances", ")", ")", "\n", "\n", "o_uir", "=", "tf", ".", "reduce_sum", "(", "tf", ".", "one_hot", "(", "self", ".", "batch_ui_r", ",", "self", ".", "relnum", "+", "1", ")", "*", "relation_weight", ",", "1", ")", "\n", "o_uirp", "=", "tf", ".", "reduce_sum", "(", "tf", ".", "one_hot", "(", "self", ".", "batch_ui_rp", ",", "self", ".", "relnum", "+", "1", ")", "*", "relation_weight", ",", "1", ")", "\n", "self", ".", "rp_loss", "=", "-", "tf", ".", "reduce_mean", "(", "tf", ".", "log_sigmoid", "(", "o_uir", "-", "o_uirp", ")", ")", "\n", "\n", "self", ".", "loss", "=", "-", "tf", ".", "reduce_mean", "(", "\n", "tf", ".", "log_sigmoid", "(", "pos_distances", "-", "neg_distances", ")", ")", "+", "args", ".", "alpha", "*", "self", ".", "lp_loss", "+", "args", ".", "beta", "*", "self", ".", "rp_loss", "\n", "\n", "self", ".", "loss", "+=", "args", ".", "lambda_bias", "*", "sum", "(", "map", "(", "tf", ".", "nn", ".", "l2_loss", ",", "\n", "[", "self", ".", "batch_j_bias", ",", "self", ".", "batch_jp_bias", ",", "self", ".", "batch_lp_j_bias", ",", "\n", "self", ".", "batch_lp_jp_bias", ",", "self", ".", "r_biases", "]", ")", ")", "\n", "\n", "self", ".", "auc", "=", "tf", ".", "reduce_mean", "(", "(", "tf", ".", "sign", "(", "-", "neg_distances", "+", "pos_distances", ")", "+", "1", ")", "/", "2", ")", "\n", "self", ".", "link_auc", "=", "tf", ".", "reduce_mean", "(", "(", "tf", ".", "sign", "(", "-", "lp_neg_distances", "+", "lp_pos_distances", ")", "+", "1", ")", "/", "2", ")", "\n", "self", ".", "rp_auc", "=", "tf", ".", "reduce_mean", "(", "(", "tf", ".", "sign", "(", "o_uir", "-", "o_uirp", ")", "+", "1", ")", "/", "2", ")", "\n", "\n", "self", ".", "gds", "=", "[", "]", "\n", "self", ".", "gds", ".", "append", "(", "tf", ".", "train", ".", "AdamOptimizer", "(", "learning_rate", ")", ".", "minimize", "(", "self", ".", "loss", ")", ")", "\n", "with", "tf", ".", "control_dependencies", "(", "self", ".", "gds", ")", ":", "\n", "            ", "self", ".", "gds", ".", "append", "(", "tf", ".", "assign", "(", "self", ".", "u_embeddings", ",", "tf", ".", "clip_by_norm", "(", "self", ".", "u_embeddings", ",", "args", ".", "norm", ",", "axes", "=", "[", "1", "]", ")", ")", ")", "\n", "self", ".", "gds", ".", "append", "(", "tf", ".", "assign", "(", "self", ".", "i_embeddings", ",", "tf", ".", "clip_by_norm", "(", "self", ".", "i_embeddings", ",", "args", ".", "norm", ",", "axes", "=", "[", "1", "]", ")", ")", ")", "\n", "self", ".", "gds", ".", "append", "(", "tf", ".", "assign", "(", "self", ".", "r_embeddings", ",", "tf", ".", "clip_by_norm", "(", "self", ".", "r_embeddings", ",", "args", ".", "norm", ",", "axes", "=", "[", "1", "]", ")", ")", ")", "\n", "self", ".", "gds", ".", "append", "(", "tf", ".", "assign", "(", "self", ".", "r0_embeddings", ",", "tf", ".", "clip_by_norm", "(", "self", ".", "r0_embeddings", ",", "args", ".", "norm", ",", "axes", "=", "[", "1", "]", ")", ")", ")", "\n", "\n", "", "self", ".", "saver", "=", "tf", ".", "train", ".", "Saver", "(", ")", "\n", "", "", ""]]}