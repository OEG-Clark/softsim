{"home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciil.load_mode_data": [[32, 64], ["pandas.read_pickle", "open", "df[].apply", "df[].apply", "df[].fillna().apply().apply", "df[].apply().apply", "df[].apply", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].fillna().apply", "df[].apply", "numpy.log", "numpy.log", "numpy.log", "numpy.log", "df[].drop", "df[].drop", "df[].fillna", "min", "min", "max"], "function", ["None"], ["def", "load_mode_data", "(", "mode", ",", "subject_id", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "filename", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "mode", ",", "subject_id", ")", "\n", "df", "=", "pd", ".", "read_pickle", "(", "open", "(", "filename", ",", "\"rb\"", ")", ")", "\n", "df", "[", "'timestamp'", "]", "=", "df", "[", "'timestamp'", "]", ".", "dt", ".", "date", "\n", "if", "mode", "==", "'alphanum'", ":", "\n", "        ", "df", "[", "'x'", "]", "=", "df", "[", "'x'", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "2276", ")", "\n", "df", "[", "'y'", "]", "=", "df", "[", "'y'", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "959", ")", "\n", "df", "[", "'dt'", "]", "=", "df", "[", "'dt'", "]", ".", "fillna", "(", "0", ")", ".", "apply", "(", "lambda", "x", ":", "min", "(", "x", ",", "5", ")", ")", ".", "apply", "(", "lambda", "x", ":", "np", ".", "log", "(", "x", "+", "1", ")", "/", "np", ".", "log", "(", "6", ")", ")", "\n", "df", "[", "'dr'", "]", "=", "df", "[", "'dr'", "]", ".", "apply", "(", "lambda", "x", ":", "min", "(", "max", "(", "50", ",", "x", ")", ",", "1000", ")", ")", ".", "apply", "(", "lambda", "x", ":", "np", ".", "log", "(", "x", "-", "49", ")", "/", "np", ".", "log", "(", "951", ")", ")", "\n", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'dt'", ",", "'dr'", "]", "]", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'dt'", ",", "'dr'", "]", "]", ".", "values", "\n", "", "", "", "if", "mode", "==", "'special'", ":", "\n", "        ", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", ".", "drop", "(", "[", "'timestamp'", ",", "'session_number'", "]", ",", "1", ")", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", ".", "drop", "(", "[", "'timestamp'", ",", "'session_number'", "]", ",", "1", ")", ".", "values", "\n", "", "", "", "if", "mode", "==", "'accel'", ":", "\n", "        ", "df", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", "=", "df", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "39.2266", ")", "\n", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "values", "\n", "", "", "", "return", "data", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciil.load_subject_data": [[66, 98], ["os.path.isfile", "pandas.read_pickle", "pandas.read_pickle", "mdata[].keys", "pickle.dump", "pandas.read_pickle", "Fed_mood_ciil.load_mode_data", "open", "open", "all", "open", "open", "label.append", "timestamp.append", "numpy.ndarray.tolist", "keras.preprocessing.sequence.pad_sequences", "numpy.transpose", "sdata[].append", "df_date[].iloc[].timestamp.date", "numpy.transpose", "mdata[].keys", "len", "df_date[].iloc[].timestamp.date.strftime"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_mode_data"], ["", "def", "load_subject_data", "(", "modes", ",", "subject_id", ",", "params", ")", ":", "\n", "    ", "level_name", "=", "[", "'session'", ",", "'day'", "]", "\n", "filename", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "level_name", "[", "params", "[", "'level'", "]", "]", ",", "subject_id", ")", "\n", "if", "os", ".", "path", ".", "isfile", "(", "filename", ")", ":", "\n", "        ", "return", "pd", ".", "read_pickle", "(", "open", "(", "filename", ",", "\"rb\"", ")", ")", "\n", "", "mdata", "=", "{", "}", "\n", "sdata", "=", "{", "}", "\n", "for", "mode", "in", "modes", ":", "\n", "        ", "mdata", "[", "mode", "]", "=", "load_mode_data", "(", "mode", ",", "subject_id", ",", "params", ")", "\n", "sdata", "[", "mode", "]", "=", "[", "]", "\n", "", "label", "=", "[", "]", "\n", "timestamp", "=", "[", "]", "\n", "ratingfile", "=", "\"mood\\weekly_ratings_%d.pickle\"", "%", "subject_id", "\n", "df_rating", "=", "pd", ".", "read_pickle", "(", "open", "(", "ratingfile", ",", "\"rb\"", ")", ")", "\n", "datefile", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "modes", "[", "0", "]", ",", "subject_id", ")", "\n", "df_date", "=", "pd", ".", "read_pickle", "(", "open", "(", "datefile", ",", "\"rb\"", ")", ")", "\n", "for", "i", "in", "mdata", "[", "modes", "[", "0", "]", "]", ".", "keys", "(", ")", ":", "\n", "        ", "if", "all", "(", "i", "in", "mdata", "[", "mode", "]", ".", "keys", "(", ")", "and", "len", "(", "mdata", "[", "mode", "]", "[", "i", "]", ")", ">=", "params", "[", "'seq_min_len'", "]", "for", "mode", "in", "modes", ")", ":", "\n", "            ", "for", "mode", "in", "modes", ":", "\n", "                ", "lists", "=", "np", ".", "ndarray", ".", "tolist", "(", "np", ".", "transpose", "(", "mdata", "[", "mode", "]", "[", "i", "]", ")", ")", "\n", "pad_matrix", "=", "pad_sequences", "(", "lists", ",", "maxlen", "=", "params", "[", "'seq_max_len'", "]", ",", "dtype", "=", "'float32'", ")", "\n", "pad_matrix", "=", "np", ".", "transpose", "(", "pad_matrix", ")", "\n", "sdata", "[", "mode", "]", ".", "append", "(", "pad_matrix", ")", "\n", "", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "                ", "rating_date", "=", "df_date", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", ".", "iloc", "[", "0", "]", ".", "timestamp", ".", "date", "(", ")", "\n", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "                ", "rating_date", "=", "i", "\n", "", "ratings", "=", "df_rating", "[", "lambda", "x", ":", "x", ".", "date", "==", "rating_date", ".", "strftime", "(", "'%Y-%m-%d'", ")", "]", ".", "iloc", "[", "0", "]", "\n", "label", ".", "append", "(", "[", "ratings", ".", "sighd_17item", ",", "ratings", ".", "ymrs_total", "]", ")", "\n", "timestamp", ".", "append", "(", "rating_date", ")", "\n", "", "", "pk", ".", "dump", "(", "(", "sdata", ",", "label", ",", "timestamp", ")", ",", "open", "(", "filename", ",", "'wb'", ")", ",", "protocol", "=", "pk", ".", "HIGHEST_PROTOCOL", ")", "\n", "return", "sdata", ",", "label", ",", "timestamp", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciil.convert_label": [[100, 113], ["range", "range", "numpy.array", "len", "len"], "function", ["None"], ["", "def", "convert_label", "(", "labels", ",", "params", ")", ":", "\n", "    ", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "0", "]", "\n", "if", "labels", "[", "i", "]", ">=", "8", ":", "\n", "                ", "labels", "[", "i", "]", "=", "1", "\n", "", "else", ":", "\n", "                ", "labels", "[", "i", "]", "=", "0", "\n", "", "", "return", "labels", "\n", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "1", "]", "\n", "", "return", "np", ".", "array", "(", "labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciil.save_obj": [[115, 118], ["open", "pickle.dump"], "function", ["None"], ["", "", "def", "save_obj", "(", "obj", ",", "name", ")", ":", "\n", "    ", "with", "open", "(", "name", "+", "'.pkl'", ",", "'wb'", ")", "as", "f", ":", "\n", "        ", "pk", ".", "dump", "(", "obj", ",", "f", ",", "pk", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciil.load_obj": [[120, 123], ["open", "pickle.load"], "function", ["None"], ["", "", "def", "load_obj", "(", "name", ")", ":", "\n", "    ", "with", "open", "(", "name", "+", "'.pkl'", ",", "'rb'", ")", "as", "f", ":", "\n", "        ", "return", "pk", ".", "load", "(", "f", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciil.load_data": [[125, 173], ["range", "random.seed", "random.sample", "Fed_mood_ciil.save_obj", "Fed_mood_ciil.load_obj", "numpy.concatenate", "Fed_mood_ciil.convert_label", "numpy.concatenate", "numpy.concatenate", "Fed_mood_ciil.load_subject_data", "len", "len", "numpy.concatenate", "numpy.asarray", "numpy.asarray", "range", "len", "range", "range", "len", "len", "int", "int", "numpy.asarray", "a[].append", "len"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.save_obj", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_obj", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.convert_label", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_subject_data"], ["", "", "def", "load_data", "(", "subject_ids", ",", "ratio", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "label", "=", "{", "}", "\n", "timestamp", "=", "{", "}", "\n", "n", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "data", "[", "i", "]", ",", "label", "[", "i", "]", ",", "timestamp", "[", "i", "]", "=", "load_subject_data", "(", "modes", ",", "i", ",", "params", ")", "\n", "m", "=", "len", "(", "label", "[", "i", "]", ")", "\n", "if", "ratio", ">", "0", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "ratio", ")", ")", "\n", "", "else", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "(", "ratio", "+", "1", ")", ")", ",", "m", ")", "\n", "", "for", "mode", "in", "modes", ":", "\n", "            ", "data", "[", "i", "]", "[", "mode", "]", "=", "[", "data", "[", "i", "]", "[", "mode", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "", "label", "[", "i", "]", "=", "[", "label", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "timestamp", "[", "i", "]", "=", "[", "timestamp", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "n", "+=", "len", "(", "idx", ")", "\n", "", "idx", "=", "range", "(", "n", ")", "\n", "random", ".", "seed", "(", "0", ")", "\n", "idx", "=", "random", ".", "sample", "(", "idx", ",", "k", "=", "len", "(", "idx", ")", ")", "\n", "datas", "=", "{", "}", "\n", "for", "mode", "in", "modes", ":", "\n", "        ", "datas", "[", "mode", "]", "=", "np", ".", "concatenate", "(", "[", "np", ".", "asarray", "(", "data", "[", "i", "]", "[", "mode", "]", ")", "for", "i", "in", "subject_ids", "]", ")", "\n", "datas", "[", "mode", "]", "=", "np", ".", "asarray", "(", "[", "datas", "[", "mode", "]", "[", "i", "]", "for", "i", "in", "idx", "]", ")", "\n", "np", ".", "asarray", "(", "data", "[", "i", "]", "[", "mode", "]", ")", "\n", "", "a", "=", "{", "}", "\n", "save_obj", "(", "label", ",", "'tt'", ")", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "a", "[", "i", "]", "=", "label", "[", "i", "]", "[", "0", "]", "\n", "", "for", "i", "in", "subject_ids", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "label", "[", "i", "]", ")", ")", ":", "\n", "            ", "if", "j", "==", "0", ":", "\n", "                ", "continue", "\n", "", "else", ":", "\n", "                ", "a", "[", "i", "]", ".", "append", "(", "label", "[", "i", "]", "[", "j", "]", ")", "\n", "", "", "", "newlabel", "=", "load_obj", "(", "'tt'", ")", "\n", "labels", "=", "np", ".", "concatenate", "(", "[", "label", "[", "i", "]", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "ll", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "labels", "[", "ll", "]", "=", "newlabel", "[", "i", "]", "[", "0", "]", "\n", "ll", "+=", "len", "(", "newlabel", "[", "i", "]", ")", "\n", "", "labels", "=", "[", "labels", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "labels", "=", "convert_label", "(", "labels", ",", "params", ")", "\n", "timestamps", "=", "np", ".", "concatenate", "(", "[", "timestamp", "[", "i", "]", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "timestamps", "=", "[", "timestamps", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "whose", "=", "np", ".", "concatenate", "(", "[", "[", "i", "]", "*", "len", "(", "label", "[", "i", "]", ")", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "whose", "=", "[", "whose", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "return", "datas", ",", "labels", ",", "timestamps", ",", "whose", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciil.split_data": [[175, 185], ["Fed_mood_ciil.load_data", "Fed_mood_ciil.load_data", "list", "list.remove", "Fed_mood_ciil.load_data", "Fed_mood_ciil.load_data"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data"], ["", "def", "split_data", "(", "subject_ids", ",", "params", ")", ":", "\n", "    ", "if", "params", "[", "'test_subject'", "]", "==", "-", "1", ":", "\n", "        ", "train_data", ",", "train_label", ",", "_", ",", "_", "=", "load_data", "(", "subject_ids", ",", "0.8", ",", "params", ")", "\n", "test_data", ",", "test_label", ",", "_", ",", "_", "=", "load_data", "(", "subject_ids", ",", "-", "0.2", ",", "params", ")", "\n", "", "else", ":", "\n", "        ", "train_subjects", "=", "list", "(", "subject_ids", ")", "\n", "train_subjects", ".", "remove", "(", "params", "[", "'test_subject'", "]", ")", "\n", "train_data", ",", "train_label", ",", "_", ",", "_", "=", "load_data", "(", "train_subjects", ",", "1", ",", "params", ")", "\n", "test_data", ",", "test_label", ",", "_", ",", "_", "=", "load_data", "(", "[", "params", "[", "'test_subject'", "]", "]", ",", "1", ",", "params", ")", "\n", "", "return", "train_data", ",", "train_label", ",", "test_data", ",", "test_label", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciil.evaluate": [[187, 201], ["print", "numpy.sqrt", "numpy.mean", "float", "len", "float", "float", "numpy.mean", "numpy.abs", "sum", "sum", "sum", "numpy.square", "numpy.square", "numpy.square", "numpy.sum", "numpy.sum", "sum", "sum", "numpy.std", "numpy.std", "numpy.square", "numpy.square", "numpy.mean"], "function", ["None"], ["", "def", "evaluate", "(", "y_test", ",", "y_pred", ",", "params", ")", ":", "\n", "    ", "res", "=", "{", "}", "\n", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "res", "[", "'accuracy'", "]", "=", "float", "(", "sum", "(", "y_test", "==", "y_pred", ")", ")", "/", "len", "(", "y_test", ")", "\n", "res", "[", "'precision'", "]", "=", "float", "(", "sum", "(", "y_test", "&", "y_pred", ")", "+", "1", ")", "/", "(", "sum", "(", "y_pred", ")", "+", "1", ")", "\n", "res", "[", "'recall'", "]", "=", "float", "(", "sum", "(", "y_test", "&", "y_pred", ")", "+", "1", ")", "/", "(", "sum", "(", "y_test", ")", "+", "1", ")", "\n", "res", "[", "'f_score'", "]", "=", "2.0", "*", "res", "[", "'precision'", "]", "*", "res", "[", "'recall'", "]", "/", "(", "res", "[", "'precision'", "]", "+", "res", "[", "'recall'", "]", ")", "\n", "", "else", ":", "\n", "        ", "res", "[", "'rmse'", "]", "=", "np", ".", "sqrt", "(", "np", ".", "mean", "(", "np", ".", "square", "(", "y_test", "-", "y_pred", ")", ")", ")", "\n", "res", "[", "'mae'", "]", "=", "np", ".", "mean", "(", "np", ".", "abs", "(", "y_test", "-", "y_pred", ")", ")", "\n", "res", "[", "'explained_variance_score'", "]", "=", "1", "-", "np", ".", "square", "(", "np", ".", "std", "(", "y_test", "-", "y_pred", ")", ")", "/", "np", ".", "square", "(", "np", ".", "std", "(", "y_test", ")", ")", "\n", "res", "[", "'r2_score'", "]", "=", "1", "-", "np", ".", "sum", "(", "np", ".", "square", "(", "y_test", "-", "y_pred", ")", ")", "/", "np", ".", "sum", "(", "np", ".", "square", "(", "y_test", "-", "np", ".", "mean", "(", "y_test", ")", ")", ")", "\n", "", "print", "(", "' '", ".", "join", "(", "[", "\"%s: %.4f\"", "%", "(", "i", ",", "res", "[", "i", "]", ")", "for", "i", "in", "res", "]", ")", ")", "\n", "return", "res", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciil.mvm_decision_function": [[203, 211], ["len", "keras.backend.concatenate", "keras.backend.sum", "keras.backend.prod", "range", "keras.backend.stack", "range"], "function", ["None"], ["", "def", "mvm_decision_function", "(", "arg", ")", ":", "\n", "    ", "n_modes", "=", "len", "(", "arg", ")", "\n", "latentx", "=", "arg", "\n", "y", "=", "K", ".", "concatenate", "(", "[", "K", ".", "sum", "(", "\n", "K", ".", "prod", "(", "K", ".", "stack", "(", "[", "latentx", "[", "j", "]", "[", ":", ",", "i", "*", "params", "[", "'n_latent'", "]", ":", "(", "i", "+", "1", ")", "*", "params", "[", "'n_latent'", "]", "]", "for", "j", "in", "range", "(", "n_modes", ")", "]", ")", ",", "\n", "axis", "=", "0", ")", ",", "axis", "=", "-", "1", ",", "keepdims", "=", "True", ")", "for", "i", "in", "range", "(", "params", "[", "'n_classes'", "]", ")", "]", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciil.fm_decision_function": [[213, 219], ["keras.backend.concatenate", "keras.backend.sum", "keras.backend.tf.stack", "keras.backend.sum", "keras.backend.square", "range"], "function", ["None"], ["", "def", "fm_decision_function", "(", "arg", ")", ":", "\n", "    ", "latentx", ",", "bias", "=", "arg", "[", "0", "]", ",", "arg", "[", "1", "]", "\n", "pairwise", "=", "K", ".", "concatenate", "(", "[", "K", ".", "sum", "(", "K", ".", "square", "(", "latentx", "[", ":", ",", "i", "*", "params", "[", "'n_latent'", "]", ":", "(", "i", "+", "1", ")", "*", "params", "[", "'n_latent'", "]", "]", ")", ",", "axis", "=", "-", "1", ",", "keepdims", "=", "True", ")", "for", "i", "in", "range", "(", "params", "[", "'n_classes'", "]", ")", "]", ")", "\n", "y", "=", "K", ".", "sum", "(", "K", ".", "tf", ".", "stack", "(", "[", "pairwise", ",", "bias", "]", ")", ",", "axis", "=", "0", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciil.acc": [[221, 223], ["keras.backend.mean", "keras.backend.equal"], "function", ["None"], ["", "def", "acc", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "return", "K", ".", "mean", "(", "K", ".", "equal", "(", "y_true", ">", "0.5", ",", "y_pred", ">", "0.5", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciil.rmse": [[225, 227], ["keras.backend.sqrt", "keras.backend.mean", "keras.backend.square"], "function", ["None"], ["", "def", "rmse", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "return", "K", ".", "sqrt", "(", "K", ".", "mean", "(", "K", ".", "square", "(", "y_true", "-", "y_pred", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciil.create_model": [[229, 297], ["Model", "Model.compile", "Model.summary", "train_data.keys", "train_data.keys", "merge", "train_data.keys", "merge", "merge", "Dense", "Dense", "merge", "Dense", "Dense", "RMSprop", "Input", "input_list.append", "train_list.append", "test_list.append", "output_list.append", "len", "Activation", "Activation", "Input", "input_list.append", "train_list.append", "test_list.append", "output_list.append", "len", "Activation", "Activation", "Input", "input_list.append", "train_list.append", "test_list.append", "output_list.append", "Activation", "Activation", "Masking", "Bidirectional", "Dropout", "Masking", "Bidirectional", "Dropout", "Masking", "Bidirectional", "Dropout", "Dense", "GRU", "GRU", "GRU"], "function", ["None"], ["", "def", "create_model", "(", "train_data", ",", "test_data", ",", "params", ")", ":", "\n", "    ", "input_list", "=", "[", "]", "\n", "output_list", "=", "[", "]", "\n", "train_list", "=", "[", "]", "\n", "test_list", "=", "[", "]", "\n", "if", "params", "[", "'idx'", "]", "==", "1", ":", "\n", "        ", "for", "mode", "in", "train_data", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "train_list", ".", "append", "(", "train_data", "[", "mode", "]", ")", "\n", "test_list", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "output_list", ".", "append", "(", "drop_output", ")", "\n", "", "", "x", "=", "merge", "(", "output_list", ",", "mode", "=", "'concat'", ")", "if", "len", "(", "output_list", ")", ">", "1", "else", "output_list", "[", "0", "]", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_classes'", "]", "*", "params", "[", "'n_latent'", "]", ",", "activation", "=", "'relu'", ",", "\n", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "x", ")", "\n", "y", "=", "Dense", "(", "params", "[", "'n_classes'", "]", ",", "bias", "=", "False", ")", "(", "latentx", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "2", ":", "\n", "        ", "for", "mode", "in", "train_data", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "train_list", ".", "append", "(", "train_data", "[", "mode", "]", ")", "\n", "test_list", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "output_list", ".", "append", "(", "drop_output", ")", "\n", "", "", "x", "=", "merge", "(", "output_list", ",", "mode", "=", "'concat'", ")", "if", "len", "(", "output_list", ")", ">", "1", "else", "output_list", "[", "0", "]", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_latent'", "]", "*", "params", "[", "'n_classes'", "]", ",", "bias", "=", "False", ")", "(", "x", ")", "\n", "bias", "=", "Dense", "(", "params", "[", "'n_classes'", "]", ",", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "x", ")", "\n", "y", "=", "merge", "(", "[", "latentx", ",", "bias", "]", ",", "mode", "=", "fm_decision_function", ",", "output_shape", "=", "(", "params", "[", "'n_classes'", "]", ",", ")", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "3", ":", "\n", "        ", "for", "mode", "in", "train_data", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "train_list", ".", "append", "(", "train_data", "[", "mode", "]", ")", "\n", "test_list", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_latent'", "]", "*", "params", "[", "'n_classes'", "]", ",", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "\n", "drop_output", ")", "\n", "output_list", ".", "append", "(", "latentx", ")", "\n", "", "", "y", "=", "merge", "(", "output_list", ",", "mode", "=", "mvm_decision_function", ",", "output_shape", "=", "(", "params", "[", "'n_classes'", "]", ",", ")", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "model", "=", "Model", "(", "input", "=", "input_list", ",", "output", "=", "y_act", ")", "\n", "model", ".", "compile", "(", "loss", "=", "objective", ",", "optimizer", "=", "RMSprop", "(", "lr", "=", "params", "[", "'lr'", "]", ")", ",", "metrics", "=", "metric", ")", "\n", "model", ".", "summary", "(", ")", "\n", "return", "model", ",", "train_list", ",", "test_list", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciil.iid": [[299, 317], ["numpy.random.seed", "range", "range", "int", "range", "range", "set", "list", "set", "list", "numpy.random.choice", "list", "numpy.random.choice", "list", "range", "range", "len", "set", "len", "set"], "function", ["None"], ["", "def", "iid", "(", "train_label", ",", "test_label", ",", "params", ")", ":", "\n", "    ", "dict_users", ",", "all_idxs", "=", "{", "}", ",", "[", "i", "for", "i", "in", "range", "(", "len", "(", "train_label", ")", ")", "]", "\n", "np", ".", "random", ".", "seed", "(", "0", ")", "\n", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users", "[", "i", "]", "=", "set", "(", "np", ".", "random", ".", "choice", "(", "all_idxs", ",", "params", "[", "'data'", "]", ",", "replace", "=", "False", ")", ")", "\n", "if", "params", "[", "'data'", "]", "<=", "(", "11968", "/", "params", "[", "'num_users'", "]", ")", ":", "\n", "            ", "all_idxs", "=", "list", "(", "set", "(", "all_idxs", ")", "-", "dict_users", "[", "i", "]", ")", "\n", "", "", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users", "[", "i", "]", "=", "list", "(", "dict_users", "[", "i", "]", ")", "\n", "", "num_items_test", "=", "int", "(", "3003", "*", "params", "[", "'data'", "]", "/", "(", "11968", "/", "params", "[", "'num_users'", "]", ")", "/", "params", "[", "'num_users'", "]", ")", "\n", "dict_users_test", ",", "all_idxs_test", "=", "{", "}", ",", "[", "i", "for", "i", "in", "range", "(", "len", "(", "test_label", ")", ")", "]", "\n", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users_test", "[", "i", "]", "=", "set", "(", "np", ".", "random", ".", "choice", "(", "all_idxs_test", ",", "num_items_test", ",", "replace", "=", "False", ")", ")", "\n", "if", "params", "[", "'data'", "]", "<=", "(", "11968", "/", "params", "[", "'num_users'", "]", ")", ":", "\n", "            ", "all_idxs_test", "=", "list", "(", "set", "(", "all_idxs_test", ")", "-", "dict_users_test", "[", "i", "]", ")", "\n", "", "", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users_test", "[", "i", "]", "=", "list", "(", "dict_users_test", "[", "i", "]", ")", "\n", "", "return", "dict_users", ",", "dict_users_test", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciil.FedAvg": [[318, 348], ["copy.deepcopy", "range", "len", "range", "range", "range", "range", "range", "range", "range", "len", "numpy.zeros", "range", "range", "w_avg.append", "range", "range", "w_avg.append", "len", "range", "len", "len", "range", "len", "numpy.shape", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len"], "function", ["None"], ["", "def", "FedAvg", "(", "w", ",", "params", ")", ":", "\n", "    ", "w_avg", "=", "[", "]", "\n", "c", "=", "{", "}", "\n", "load", "=", "copy", ".", "deepcopy", "(", "w", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "load", ")", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "load", "[", "i", "]", ")", ")", ":", "\n", "            ", "load", "[", "i", "]", "[", "j", "]", "=", "np", ".", "zeros", "(", "shape", "=", "np", ".", "shape", "(", "load", "[", "i", "]", "[", "j", "]", ")", ")", "\n", "", "", "if", "params", "[", "'idx'", "]", "==", "3", ":", "\n", "        ", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "            ", "c", "[", "i", "]", "=", "load", "[", "i", "]", "\n", "", "for", "k", "in", "range", "(", "6", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", ")", ")", ":", "\n", "                ", "for", "j", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", "[", "0", "]", ")", ")", ":", "\n", "                    ", "c", "[", "k", "]", "[", "j", "]", "+=", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", "[", "i", "]", "[", "j", "]", "\n", "", "", "for", "l", "in", "range", "(", "len", "(", "c", "[", "k", "]", ")", ")", ":", "\n", "                ", "c", "[", "k", "]", "[", "l", "]", "=", "c", "[", "k", "]", "[", "l", "]", "*", "6", "/", "len", "(", "w", ")", "\n", "", "", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "            ", "w_avg", ".", "append", "(", "c", "[", "i", "]", ")", "\n", "", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "5", ")", ":", "\n", "            ", "c", "[", "i", "]", "=", "load", "[", "i", "]", "\n", "", "for", "k", "in", "range", "(", "5", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", ")", ")", ":", "\n", "                ", "for", "j", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", "[", "0", "]", ")", ")", ":", "\n", "                    ", "c", "[", "k", "]", "[", "j", "]", "+=", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", "[", "i", "]", "[", "j", "]", "\n", "", "", "for", "l", "in", "range", "(", "len", "(", "c", "[", "k", "]", ")", ")", ":", "\n", "                ", "c", "[", "k", "]", "[", "l", "]", "=", "c", "[", "k", "]", "[", "l", "]", "*", "5", "/", "len", "(", "w", ")", "\n", "", "", "for", "i", "in", "range", "(", "5", ")", ":", "\n", "            ", "w_avg", ".", "append", "(", "c", "[", "i", "]", ")", "\n", "", "", "return", "w_avg", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciil.run_model": [[349, 385], ["Fed_mood_ciil.create_model", "Fed_mood_ciil.iid", "range", "numpy.random.choice", "print", "model.predict", "Fed_mood_ciil.evaluate", "range", "random.randint", "w_temps.append", "print", "range", "model.fit", "numpy.ravel", "copy.deepcopy", "X_train_fed.append", "y_train_fed.append", "model.layers[].get_weights", "a.reshape.reshape", "numpy.concatenate", "a.reshape.reshape", "a.reshape.reshape", "numpy.ravel"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.create_model", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.iid", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.evaluate"], ["", "def", "run_model", "(", "train_data", ",", "test_data", ",", "y_train", ",", "y_test", ",", "params", ")", ":", "\n", "    ", "num", "=", "[", "6", ",", "7", ",", "8", ",", "13", ",", "14", "]", "\n", "model", ",", "X_train", ",", "X_test", "=", "create_model", "(", "train_data", ",", "test_data", ",", "params", ")", "\n", "dict_users", ",", "dict_users_test", "=", "iid", "(", "y_train", ",", "y_test", ",", "params", ")", "\n", "w_glob", ",", "res", "=", "[", "]", ",", "[", "]", "\n", "for", "iter", "in", "range", "(", "params", "[", "'n_epochs'", "]", ")", ":", "\n", "        ", "w_locals", ",", "w_temps", "=", "[", "]", ",", "[", "]", "\n", "idxs_users", "=", "np", ".", "random", ".", "choice", "(", "range", "(", "params", "[", "'num_users'", "]", ")", ",", "random", ".", "randint", "(", "1", ",", "params", "[", "'num_users'", "]", ")", ",", "replace", "=", "False", ")", "\n", "print", "(", "'\u7b2c:'", ",", "iter", ",", "'\u8f6e,\u5171'", ",", "idxs_users", ",", "'\u4e2a\u7528\u6237'", ")", "\n", "for", "i", "in", "num", ":", "\n", "            ", "w_temps", ".", "append", "(", "copy", ".", "deepcopy", "(", "model", ".", "layers", "[", "i", "]", ".", "get_weights", "(", ")", ")", ")", "\n", "", "for", "idx", "in", "idxs_users", ":", "\n", "            ", "print", "(", "'\u7b2c:'", ",", "iter", ",", "'\u8f6e,\u7528\u6237'", ",", "idx", ")", "\n", "X_train_fed", ",", "y_train_fed", "=", "[", "]", ",", "[", "]", "\n", "for", "k", "in", "range", "(", "3", ")", ":", "\n", "                ", "a", "=", "X_train", "[", "k", "]", "[", "dict_users", "[", "idx", "]", "[", "0", "]", "]", "\n", "for", "i", "in", "dict_users", "[", "idx", "]", ":", "\n", "                    ", "if", "i", "==", "dict_users", "[", "idx", "]", "[", "0", "]", ":", "\n", "                        ", "continue", "\n", "", "else", ":", "\n", "                        ", "a", "=", "np", ".", "concatenate", "(", "(", "a", ",", "X_train", "[", "k", "]", "[", "i", "]", ")", ")", "\n", "", "", "if", "k", "==", "0", ":", "\n", "                    ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "4", ")", "\n", "", "elif", "k", "==", "1", ":", "\n", "                    ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "6", ")", "\n", "", "else", ":", "\n", "                    ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "3", ")", "\n", "", "X_train_fed", ".", "append", "(", "a", ")", "\n", "", "for", "i", "in", "dict_users", "[", "idx", "]", ":", "\n", "                ", "y_train_fed", ".", "append", "(", "y_train", "[", "i", "]", ")", "\n", "", "hist", "=", "model", ".", "fit", "(", "x", "=", "X_train_fed", ",", "y", "=", "y_train_fed", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "2", ",", "epochs", "=", "15", ",", "validation_split", "=", "0.2", ")", "\n", "", "y_score", "=", "model", ".", "predict", "(", "X_test", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "0", ")", "\n", "y_pred", "=", "(", "np", ".", "ravel", "(", "y_score", ")", ">", "0.5", ")", ".", "astype", "(", "'int32'", ")", "if", "params", "[", "'is_clf'", "]", "else", "np", ".", "ravel", "(", "y_score", ")", "\n", "evaluate", "(", "y_test", ",", "y_pred", ",", "params", ")", "\n", "", "return", "y_pred", ",", "hist", ".", "history", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iil.load_mode_data": [[32, 64], ["pandas.read_pickle", "open", "df[].apply", "df[].apply", "df[].fillna().apply().apply", "df[].apply().apply", "df[].apply", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].fillna().apply", "df[].apply", "numpy.log", "numpy.log", "numpy.log", "numpy.log", "df[].drop", "df[].drop", "df[].fillna", "min", "min", "max"], "function", ["None"], ["def", "load_mode_data", "(", "mode", ",", "subject_id", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "filename", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "mode", ",", "subject_id", ")", "\n", "df", "=", "pd", ".", "read_pickle", "(", "open", "(", "filename", ",", "\"rb\"", ")", ")", "\n", "df", "[", "'timestamp'", "]", "=", "df", "[", "'timestamp'", "]", ".", "dt", ".", "date", "\n", "if", "mode", "==", "'alphanum'", ":", "\n", "        ", "df", "[", "'x'", "]", "=", "df", "[", "'x'", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "2276", ")", "\n", "df", "[", "'y'", "]", "=", "df", "[", "'y'", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "959", ")", "\n", "df", "[", "'dt'", "]", "=", "df", "[", "'dt'", "]", ".", "fillna", "(", "0", ")", ".", "apply", "(", "lambda", "x", ":", "min", "(", "x", ",", "5", ")", ")", ".", "apply", "(", "lambda", "x", ":", "np", ".", "log", "(", "x", "+", "1", ")", "/", "np", ".", "log", "(", "6", ")", ")", "\n", "df", "[", "'dr'", "]", "=", "df", "[", "'dr'", "]", ".", "apply", "(", "lambda", "x", ":", "min", "(", "max", "(", "50", ",", "x", ")", ",", "1000", ")", ")", ".", "apply", "(", "lambda", "x", ":", "np", ".", "log", "(", "x", "-", "49", ")", "/", "np", ".", "log", "(", "951", ")", ")", "\n", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'dt'", ",", "'dr'", "]", "]", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'dt'", ",", "'dr'", "]", "]", ".", "values", "\n", "", "", "", "if", "mode", "==", "'special'", ":", "\n", "        ", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", ".", "drop", "(", "[", "'timestamp'", ",", "'session_number'", "]", ",", "1", ")", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", ".", "drop", "(", "[", "'timestamp'", ",", "'session_number'", "]", ",", "1", ")", ".", "values", "\n", "", "", "", "if", "mode", "==", "'accel'", ":", "\n", "        ", "df", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", "=", "df", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "39.2266", ")", "\n", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "values", "\n", "", "", "", "return", "data", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iil.load_subject_data": [[66, 98], ["os.path.isfile", "pandas.read_pickle", "pandas.read_pickle", "mdata[].keys", "pickle.dump", "pandas.read_pickle", "Fed_mood_iil.load_mode_data", "open", "open", "all", "open", "open", "label.append", "timestamp.append", "numpy.ndarray.tolist", "keras.preprocessing.sequence.pad_sequences", "numpy.transpose", "sdata[].append", "df_date[].iloc[].timestamp.date", "numpy.transpose", "mdata[].keys", "len", "df_date[].iloc[].timestamp.date.strftime"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_mode_data"], ["", "def", "load_subject_data", "(", "modes", ",", "subject_id", ",", "params", ")", ":", "\n", "    ", "level_name", "=", "[", "'session'", ",", "'day'", "]", "\n", "filename", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "level_name", "[", "params", "[", "'level'", "]", "]", ",", "subject_id", ")", "\n", "if", "os", ".", "path", ".", "isfile", "(", "filename", ")", ":", "\n", "        ", "return", "pd", ".", "read_pickle", "(", "open", "(", "filename", ",", "\"rb\"", ")", ")", "\n", "", "mdata", "=", "{", "}", "\n", "sdata", "=", "{", "}", "\n", "for", "mode", "in", "modes", ":", "\n", "        ", "mdata", "[", "mode", "]", "=", "load_mode_data", "(", "mode", ",", "subject_id", ",", "params", ")", "\n", "sdata", "[", "mode", "]", "=", "[", "]", "\n", "", "label", "=", "[", "]", "\n", "timestamp", "=", "[", "]", "\n", "ratingfile", "=", "\"mood\\weekly_ratings_%d.pickle\"", "%", "subject_id", "\n", "df_rating", "=", "pd", ".", "read_pickle", "(", "open", "(", "ratingfile", ",", "\"rb\"", ")", ")", "\n", "datefile", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "modes", "[", "0", "]", ",", "subject_id", ")", "\n", "df_date", "=", "pd", ".", "read_pickle", "(", "open", "(", "datefile", ",", "\"rb\"", ")", ")", "\n", "for", "i", "in", "mdata", "[", "modes", "[", "0", "]", "]", ".", "keys", "(", ")", ":", "\n", "        ", "if", "all", "(", "i", "in", "mdata", "[", "mode", "]", ".", "keys", "(", ")", "and", "len", "(", "mdata", "[", "mode", "]", "[", "i", "]", ")", ">=", "params", "[", "'seq_min_len'", "]", "for", "mode", "in", "modes", ")", ":", "\n", "            ", "for", "mode", "in", "modes", ":", "\n", "                ", "lists", "=", "np", ".", "ndarray", ".", "tolist", "(", "np", ".", "transpose", "(", "mdata", "[", "mode", "]", "[", "i", "]", ")", ")", "\n", "pad_matrix", "=", "pad_sequences", "(", "lists", ",", "maxlen", "=", "params", "[", "'seq_max_len'", "]", ",", "dtype", "=", "'float32'", ")", "\n", "pad_matrix", "=", "np", ".", "transpose", "(", "pad_matrix", ")", "\n", "sdata", "[", "mode", "]", ".", "append", "(", "pad_matrix", ")", "\n", "", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "                ", "rating_date", "=", "df_date", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", ".", "iloc", "[", "0", "]", ".", "timestamp", ".", "date", "(", ")", "\n", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "                ", "rating_date", "=", "i", "\n", "", "ratings", "=", "df_rating", "[", "lambda", "x", ":", "x", ".", "date", "==", "rating_date", ".", "strftime", "(", "'%Y-%m-%d'", ")", "]", ".", "iloc", "[", "0", "]", "\n", "label", ".", "append", "(", "[", "ratings", ".", "sighd_17item", ",", "ratings", ".", "ymrs_total", "]", ")", "\n", "timestamp", ".", "append", "(", "rating_date", ")", "\n", "", "", "pk", ".", "dump", "(", "(", "sdata", ",", "label", ",", "timestamp", ")", ",", "open", "(", "filename", ",", "'wb'", ")", ",", "protocol", "=", "pk", ".", "HIGHEST_PROTOCOL", ")", "\n", "return", "sdata", ",", "label", ",", "timestamp", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iil.convert_label": [[100, 113], ["range", "range", "numpy.array", "len", "len"], "function", ["None"], ["", "def", "convert_label", "(", "labels", ",", "params", ")", ":", "\n", "    ", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "0", "]", "\n", "if", "labels", "[", "i", "]", ">=", "8", ":", "\n", "                ", "labels", "[", "i", "]", "=", "1", "\n", "", "else", ":", "\n", "                ", "labels", "[", "i", "]", "=", "0", "\n", "", "", "return", "labels", "\n", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "1", "]", "\n", "", "return", "np", ".", "array", "(", "labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iil.save_obj": [[115, 118], ["open", "pickle.dump"], "function", ["None"], ["", "", "def", "save_obj", "(", "obj", ",", "name", ")", ":", "\n", "    ", "with", "open", "(", "name", "+", "'.pkl'", ",", "'wb'", ")", "as", "f", ":", "\n", "        ", "pk", ".", "dump", "(", "obj", ",", "f", ",", "pk", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iil.load_obj": [[120, 123], ["open", "pickle.load"], "function", ["None"], ["", "", "def", "load_obj", "(", "name", ")", ":", "\n", "    ", "with", "open", "(", "name", "+", "'.pkl'", ",", "'rb'", ")", "as", "f", ":", "\n", "        ", "return", "pk", ".", "load", "(", "f", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iil.load_data": [[125, 173], ["range", "random.seed", "random.sample", "Fed_mood_iil.save_obj", "Fed_mood_iil.load_obj", "numpy.concatenate", "Fed_mood_iil.convert_label", "numpy.concatenate", "numpy.concatenate", "Fed_mood_iil.load_subject_data", "len", "len", "numpy.concatenate", "numpy.asarray", "numpy.asarray", "range", "len", "range", "range", "len", "len", "int", "int", "numpy.asarray", "a[].append", "len"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.save_obj", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_obj", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.convert_label", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_subject_data"], ["", "", "def", "load_data", "(", "subject_ids", ",", "ratio", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "label", "=", "{", "}", "\n", "timestamp", "=", "{", "}", "\n", "n", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "data", "[", "i", "]", ",", "label", "[", "i", "]", ",", "timestamp", "[", "i", "]", "=", "load_subject_data", "(", "modes", ",", "i", ",", "params", ")", "\n", "m", "=", "len", "(", "label", "[", "i", "]", ")", "\n", "if", "ratio", ">", "0", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "ratio", ")", ")", "\n", "", "else", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "(", "ratio", "+", "1", ")", ")", ",", "m", ")", "\n", "", "for", "mode", "in", "modes", ":", "\n", "            ", "data", "[", "i", "]", "[", "mode", "]", "=", "[", "data", "[", "i", "]", "[", "mode", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "", "label", "[", "i", "]", "=", "[", "label", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "timestamp", "[", "i", "]", "=", "[", "timestamp", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "n", "+=", "len", "(", "idx", ")", "\n", "", "idx", "=", "range", "(", "n", ")", "\n", "random", ".", "seed", "(", "0", ")", "\n", "idx", "=", "random", ".", "sample", "(", "idx", ",", "k", "=", "len", "(", "idx", ")", ")", "\n", "datas", "=", "{", "}", "\n", "for", "mode", "in", "modes", ":", "\n", "        ", "datas", "[", "mode", "]", "=", "np", ".", "concatenate", "(", "[", "np", ".", "asarray", "(", "data", "[", "i", "]", "[", "mode", "]", ")", "for", "i", "in", "subject_ids", "]", ")", "\n", "datas", "[", "mode", "]", "=", "np", ".", "asarray", "(", "[", "datas", "[", "mode", "]", "[", "i", "]", "for", "i", "in", "idx", "]", ")", "\n", "np", ".", "asarray", "(", "data", "[", "i", "]", "[", "mode", "]", ")", "\n", "", "a", "=", "{", "}", "\n", "save_obj", "(", "label", ",", "'tt'", ")", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "a", "[", "i", "]", "=", "label", "[", "i", "]", "[", "0", "]", "\n", "", "for", "i", "in", "subject_ids", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "label", "[", "i", "]", ")", ")", ":", "\n", "            ", "if", "j", "==", "0", ":", "\n", "                ", "continue", "\n", "", "else", ":", "\n", "                ", "a", "[", "i", "]", ".", "append", "(", "label", "[", "i", "]", "[", "j", "]", ")", "\n", "", "", "", "newlabel", "=", "load_obj", "(", "'tt'", ")", "\n", "labels", "=", "np", ".", "concatenate", "(", "[", "label", "[", "i", "]", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "ll", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "labels", "[", "ll", "]", "=", "newlabel", "[", "i", "]", "[", "0", "]", "\n", "ll", "+=", "len", "(", "newlabel", "[", "i", "]", ")", "\n", "", "labels", "=", "[", "labels", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "labels", "=", "convert_label", "(", "labels", ",", "params", ")", "\n", "timestamps", "=", "np", ".", "concatenate", "(", "[", "timestamp", "[", "i", "]", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "timestamps", "=", "[", "timestamps", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "whose", "=", "np", ".", "concatenate", "(", "[", "[", "i", "]", "*", "len", "(", "label", "[", "i", "]", ")", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "whose", "=", "[", "whose", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "return", "datas", ",", "labels", ",", "timestamps", ",", "whose", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iil.split_data": [[175, 185], ["Fed_mood_iil.load_data", "Fed_mood_iil.load_data", "list", "list.remove", "Fed_mood_iil.load_data", "Fed_mood_iil.load_data"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data"], ["", "def", "split_data", "(", "subject_ids", ",", "params", ")", ":", "\n", "    ", "if", "params", "[", "'test_subject'", "]", "==", "-", "1", ":", "\n", "        ", "train_data", ",", "train_label", ",", "_", ",", "_", "=", "load_data", "(", "subject_ids", ",", "0.8", ",", "params", ")", "\n", "test_data", ",", "test_label", ",", "_", ",", "_", "=", "load_data", "(", "subject_ids", ",", "-", "0.2", ",", "params", ")", "\n", "", "else", ":", "\n", "        ", "train_subjects", "=", "list", "(", "subject_ids", ")", "\n", "train_subjects", ".", "remove", "(", "params", "[", "'test_subject'", "]", ")", "\n", "train_data", ",", "train_label", ",", "_", ",", "_", "=", "load_data", "(", "train_subjects", ",", "1", ",", "params", ")", "\n", "test_data", ",", "test_label", ",", "_", ",", "_", "=", "load_data", "(", "[", "params", "[", "'test_subject'", "]", "]", ",", "1", ",", "params", ")", "\n", "", "return", "train_data", ",", "train_label", ",", "test_data", ",", "test_label", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iil.evaluate": [[187, 201], ["print", "numpy.sqrt", "numpy.mean", "float", "len", "float", "float", "numpy.mean", "numpy.abs", "sum", "sum", "sum", "numpy.square", "numpy.square", "numpy.square", "numpy.sum", "numpy.sum", "sum", "sum", "numpy.std", "numpy.std", "numpy.square", "numpy.square", "numpy.mean"], "function", ["None"], ["", "def", "evaluate", "(", "y_test", ",", "y_pred", ",", "params", ")", ":", "\n", "    ", "res", "=", "{", "}", "\n", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "res", "[", "'accuracy'", "]", "=", "float", "(", "sum", "(", "y_test", "==", "y_pred", ")", ")", "/", "len", "(", "y_test", ")", "\n", "res", "[", "'precision'", "]", "=", "float", "(", "sum", "(", "y_test", "&", "y_pred", ")", "+", "1", ")", "/", "(", "sum", "(", "y_pred", ")", "+", "1", ")", "\n", "res", "[", "'recall'", "]", "=", "float", "(", "sum", "(", "y_test", "&", "y_pred", ")", "+", "1", ")", "/", "(", "sum", "(", "y_test", ")", "+", "1", ")", "\n", "res", "[", "'f_score'", "]", "=", "2.0", "*", "res", "[", "'precision'", "]", "*", "res", "[", "'recall'", "]", "/", "(", "res", "[", "'precision'", "]", "+", "res", "[", "'recall'", "]", ")", "\n", "", "else", ":", "\n", "        ", "res", "[", "'rmse'", "]", "=", "np", ".", "sqrt", "(", "np", ".", "mean", "(", "np", ".", "square", "(", "y_test", "-", "y_pred", ")", ")", ")", "\n", "res", "[", "'mae'", "]", "=", "np", ".", "mean", "(", "np", ".", "abs", "(", "y_test", "-", "y_pred", ")", ")", "\n", "res", "[", "'explained_variance_score'", "]", "=", "1", "-", "np", ".", "square", "(", "np", ".", "std", "(", "y_test", "-", "y_pred", ")", ")", "/", "np", ".", "square", "(", "np", ".", "std", "(", "y_test", ")", ")", "\n", "res", "[", "'r2_score'", "]", "=", "1", "-", "np", ".", "sum", "(", "np", ".", "square", "(", "y_test", "-", "y_pred", ")", ")", "/", "np", ".", "sum", "(", "np", ".", "square", "(", "y_test", "-", "np", ".", "mean", "(", "y_test", ")", ")", ")", "\n", "", "print", "(", "' '", ".", "join", "(", "[", "\"%s: %.4f\"", "%", "(", "i", ",", "res", "[", "i", "]", ")", "for", "i", "in", "res", "]", ")", ")", "\n", "return", "res", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iil.mvm_decision_function": [[203, 211], ["len", "keras.backend.concatenate", "keras.backend.sum", "keras.backend.prod", "range", "keras.backend.stack", "range"], "function", ["None"], ["", "def", "mvm_decision_function", "(", "arg", ")", ":", "\n", "    ", "n_modes", "=", "len", "(", "arg", ")", "\n", "latentx", "=", "arg", "\n", "y", "=", "K", ".", "concatenate", "(", "[", "K", ".", "sum", "(", "\n", "K", ".", "prod", "(", "K", ".", "stack", "(", "[", "latentx", "[", "j", "]", "[", ":", ",", "i", "*", "params", "[", "'n_latent'", "]", ":", "(", "i", "+", "1", ")", "*", "params", "[", "'n_latent'", "]", "]", "for", "j", "in", "range", "(", "n_modes", ")", "]", ")", ",", "\n", "axis", "=", "0", ")", ",", "axis", "=", "-", "1", ",", "keepdims", "=", "True", ")", "for", "i", "in", "range", "(", "params", "[", "'n_classes'", "]", ")", "]", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iil.fm_decision_function": [[213, 219], ["keras.backend.concatenate", "keras.backend.sum", "keras.backend.tf.stack", "keras.backend.sum", "keras.backend.square", "range"], "function", ["None"], ["", "def", "fm_decision_function", "(", "arg", ")", ":", "\n", "    ", "latentx", ",", "bias", "=", "arg", "[", "0", "]", ",", "arg", "[", "1", "]", "\n", "pairwise", "=", "K", ".", "concatenate", "(", "[", "K", ".", "sum", "(", "K", ".", "square", "(", "latentx", "[", ":", ",", "i", "*", "params", "[", "'n_latent'", "]", ":", "(", "i", "+", "1", ")", "*", "params", "[", "'n_latent'", "]", "]", ")", ",", "axis", "=", "-", "1", ",", "keepdims", "=", "True", ")", "for", "i", "in", "range", "(", "params", "[", "'n_classes'", "]", ")", "]", ")", "\n", "y", "=", "K", ".", "sum", "(", "K", ".", "tf", ".", "stack", "(", "[", "pairwise", ",", "bias", "]", ")", ",", "axis", "=", "0", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iil.acc": [[221, 223], ["keras.backend.mean", "keras.backend.equal"], "function", ["None"], ["", "def", "acc", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "return", "K", ".", "mean", "(", "K", ".", "equal", "(", "y_true", ">", "0.5", ",", "y_pred", ">", "0.5", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iil.rmse": [[225, 227], ["keras.backend.sqrt", "keras.backend.mean", "keras.backend.square"], "function", ["None"], ["", "def", "rmse", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "return", "K", ".", "sqrt", "(", "K", ".", "mean", "(", "K", ".", "square", "(", "y_true", "-", "y_pred", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iil.create_model": [[229, 297], ["Model", "Model.compile", "Model.summary", "train_data.keys", "train_data.keys", "merge", "train_data.keys", "merge", "merge", "Dense", "Dense", "merge", "Dense", "Dense", "RMSprop", "Input", "input_list.append", "train_list.append", "test_list.append", "output_list.append", "len", "Activation", "Activation", "Input", "input_list.append", "train_list.append", "test_list.append", "output_list.append", "len", "Activation", "Activation", "Input", "input_list.append", "train_list.append", "test_list.append", "output_list.append", "Activation", "Activation", "Masking", "Bidirectional", "Dropout", "Masking", "Bidirectional", "Dropout", "Masking", "Bidirectional", "Dropout", "Dense", "GRU", "GRU", "GRU"], "function", ["None"], ["", "def", "create_model", "(", "train_data", ",", "test_data", ",", "params", ")", ":", "\n", "    ", "input_list", "=", "[", "]", "\n", "output_list", "=", "[", "]", "\n", "train_list", "=", "[", "]", "\n", "test_list", "=", "[", "]", "\n", "if", "params", "[", "'idx'", "]", "==", "1", ":", "\n", "        ", "for", "mode", "in", "train_data", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "train_list", ".", "append", "(", "train_data", "[", "mode", "]", ")", "\n", "test_list", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "output_list", ".", "append", "(", "drop_output", ")", "\n", "", "", "x", "=", "merge", "(", "output_list", ",", "mode", "=", "'concat'", ")", "if", "len", "(", "output_list", ")", ">", "1", "else", "output_list", "[", "0", "]", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_classes'", "]", "*", "params", "[", "'n_latent'", "]", ",", "activation", "=", "'relu'", ",", "\n", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "x", ")", "\n", "y", "=", "Dense", "(", "params", "[", "'n_classes'", "]", ",", "bias", "=", "False", ")", "(", "latentx", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "2", ":", "\n", "        ", "for", "mode", "in", "train_data", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "train_list", ".", "append", "(", "train_data", "[", "mode", "]", ")", "\n", "test_list", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "output_list", ".", "append", "(", "drop_output", ")", "\n", "", "", "x", "=", "merge", "(", "output_list", ",", "mode", "=", "'concat'", ")", "if", "len", "(", "output_list", ")", ">", "1", "else", "output_list", "[", "0", "]", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_latent'", "]", "*", "params", "[", "'n_classes'", "]", ",", "bias", "=", "False", ")", "(", "x", ")", "\n", "bias", "=", "Dense", "(", "params", "[", "'n_classes'", "]", ",", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "x", ")", "\n", "y", "=", "merge", "(", "[", "latentx", ",", "bias", "]", ",", "mode", "=", "fm_decision_function", ",", "output_shape", "=", "(", "params", "[", "'n_classes'", "]", ",", ")", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "3", ":", "\n", "        ", "for", "mode", "in", "train_data", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "train_list", ".", "append", "(", "train_data", "[", "mode", "]", ")", "\n", "test_list", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_latent'", "]", "*", "params", "[", "'n_classes'", "]", ",", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "\n", "drop_output", ")", "\n", "output_list", ".", "append", "(", "latentx", ")", "\n", "", "", "y", "=", "merge", "(", "output_list", ",", "mode", "=", "mvm_decision_function", ",", "output_shape", "=", "(", "params", "[", "'n_classes'", "]", ",", ")", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "model", "=", "Model", "(", "input", "=", "input_list", ",", "output", "=", "y_act", ")", "\n", "model", ".", "compile", "(", "loss", "=", "objective", ",", "optimizer", "=", "RMSprop", "(", "lr", "=", "params", "[", "'lr'", "]", ")", ",", "metrics", "=", "metric", ")", "\n", "model", ".", "summary", "(", ")", "\n", "return", "model", ",", "train_list", ",", "test_list", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iil.iid": [[298, 316], ["numpy.random.seed", "range", "range", "int", "range", "range", "set", "list", "set", "list", "numpy.random.choice", "list", "numpy.random.choice", "list", "range", "range", "len", "set", "len", "set"], "function", ["None"], ["", "def", "iid", "(", "train_label", ",", "test_label", ",", "params", ")", ":", "\n", "    ", "dict_users", ",", "all_idxs", "=", "{", "}", ",", "[", "i", "for", "i", "in", "range", "(", "len", "(", "train_label", ")", ")", "]", "\n", "np", ".", "random", ".", "seed", "(", "0", ")", "\n", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users", "[", "i", "]", "=", "set", "(", "np", ".", "random", ".", "choice", "(", "all_idxs", ",", "params", "[", "'data'", "]", ",", "replace", "=", "False", ")", ")", "\n", "if", "params", "[", "'data'", "]", "<=", "(", "11968", "/", "params", "[", "'num_users'", "]", ")", ":", "\n", "            ", "all_idxs", "=", "list", "(", "set", "(", "all_idxs", ")", "-", "dict_users", "[", "i", "]", ")", "\n", "", "", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users", "[", "i", "]", "=", "list", "(", "dict_users", "[", "i", "]", ")", "\n", "", "num_items_test", "=", "int", "(", "3003", "*", "params", "[", "'data'", "]", "/", "(", "11968", "/", "params", "[", "'num_users'", "]", ")", "/", "params", "[", "'num_users'", "]", ")", "\n", "dict_users_test", ",", "all_idxs_test", "=", "{", "}", ",", "[", "i", "for", "i", "in", "range", "(", "len", "(", "test_label", ")", ")", "]", "\n", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users_test", "[", "i", "]", "=", "set", "(", "np", ".", "random", ".", "choice", "(", "all_idxs_test", ",", "num_items_test", ",", "replace", "=", "False", ")", ")", "\n", "if", "params", "[", "'data'", "]", "<=", "(", "11968", "/", "params", "[", "'num_users'", "]", ")", ":", "\n", "            ", "all_idxs_test", "=", "list", "(", "set", "(", "all_idxs_test", ")", "-", "dict_users_test", "[", "i", "]", ")", "\n", "", "", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users_test", "[", "i", "]", "=", "list", "(", "dict_users_test", "[", "i", "]", ")", "\n", "", "return", "dict_users", ",", "dict_users_test", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iil.FedAvg": [[317, 347], ["copy.deepcopy", "range", "len", "range", "range", "range", "range", "range", "range", "range", "len", "numpy.zeros", "range", "range", "w_avg.append", "range", "range", "w_avg.append", "len", "range", "len", "len", "range", "len", "numpy.shape", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len"], "function", ["None"], ["", "def", "FedAvg", "(", "w", ",", "params", ")", ":", "\n", "    ", "w_avg", "=", "[", "]", "\n", "c", "=", "{", "}", "\n", "load", "=", "copy", ".", "deepcopy", "(", "w", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "load", ")", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "load", "[", "i", "]", ")", ")", ":", "\n", "            ", "load", "[", "i", "]", "[", "j", "]", "=", "np", ".", "zeros", "(", "shape", "=", "np", ".", "shape", "(", "load", "[", "i", "]", "[", "j", "]", ")", ")", "\n", "", "", "if", "params", "[", "'idx'", "]", "==", "3", ":", "\n", "        ", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "            ", "c", "[", "i", "]", "=", "load", "[", "i", "]", "\n", "", "for", "k", "in", "range", "(", "6", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", ")", ")", ":", "\n", "                ", "for", "j", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", "[", "0", "]", ")", ")", ":", "\n", "                    ", "c", "[", "k", "]", "[", "j", "]", "+=", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", "[", "i", "]", "[", "j", "]", "\n", "", "", "for", "l", "in", "range", "(", "len", "(", "c", "[", "k", "]", ")", ")", ":", "\n", "                ", "c", "[", "k", "]", "[", "l", "]", "=", "c", "[", "k", "]", "[", "l", "]", "*", "6", "/", "len", "(", "w", ")", "\n", "", "", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "            ", "w_avg", ".", "append", "(", "c", "[", "i", "]", ")", "\n", "", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "5", ")", ":", "\n", "            ", "c", "[", "i", "]", "=", "load", "[", "i", "]", "\n", "", "for", "k", "in", "range", "(", "5", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", ")", ")", ":", "\n", "                ", "for", "j", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", "[", "0", "]", ")", ")", ":", "\n", "                    ", "c", "[", "k", "]", "[", "j", "]", "+=", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", "[", "i", "]", "[", "j", "]", "\n", "", "", "for", "l", "in", "range", "(", "len", "(", "c", "[", "k", "]", ")", ")", ":", "\n", "                ", "c", "[", "k", "]", "[", "l", "]", "=", "c", "[", "k", "]", "[", "l", "]", "*", "5", "/", "len", "(", "w", ")", "\n", "", "", "for", "i", "in", "range", "(", "5", ")", ":", "\n", "            ", "w_avg", ".", "append", "(", "c", "[", "i", "]", ")", "\n", "", "", "return", "w_avg", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iil.run_model": [[348, 379], ["Fed_mood_iil.create_model", "Fed_mood_iil.iid", "range", "model.predict", "range", "model.fit", "model.predict", "Fed_mood_iil.evaluate", "numpy.ravel", "X_train_fed.append", "y_train_fed.append", "numpy.ravel", "a.reshape.reshape", "numpy.concatenate", "a.reshape.reshape", "a.reshape.reshape", "numpy.ravel", "numpy.ravel"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.create_model", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.iid", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.evaluate"], ["", "def", "run_model", "(", "train_data", ",", "test_data", ",", "y_train", ",", "y_test", ",", "params", ")", ":", "\n", "    ", "num", "=", "[", "6", ",", "7", ",", "8", ",", "13", ",", "14", "]", "\n", "model", ",", "X_train", ",", "X_test", "=", "create_model", "(", "train_data", ",", "test_data", ",", "params", ")", "\n", "dict_users", ",", "dict_users_test", "=", "iid", "(", "y_train", ",", "y_test", ",", "params", ")", "\n", "w_glob", ",", "res", "=", "[", "]", ",", "[", "]", "\n", "for", "m", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "X_train_fed", ",", "y_train_fed", "=", "[", "]", ",", "[", "]", "\n", "for", "k", "in", "range", "(", "3", ")", ":", "\n", "            ", "a", "=", "X_train", "[", "k", "]", "[", "dict_users", "[", "m", "]", "[", "0", "]", "]", "\n", "for", "i", "in", "dict_users", "[", "m", "]", ":", "\n", "                ", "if", "i", "==", "dict_users", "[", "m", "]", "[", "0", "]", ":", "\n", "                    ", "continue", "\n", "", "else", ":", "\n", "                    ", "a", "=", "np", ".", "concatenate", "(", "(", "a", ",", "X_train", "[", "k", "]", "[", "i", "]", ")", ")", "\n", "", "", "if", "k", "==", "0", ":", "\n", "                ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "4", ")", "\n", "", "elif", "k", "==", "1", ":", "\n", "                ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "6", ")", "\n", "", "else", ":", "\n", "                ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "3", ")", "\n", "", "X_train_fed", ".", "append", "(", "a", ")", "\n", "", "for", "i", "in", "dict_users", "[", "m", "]", ":", "\n", "            ", "y_train_fed", ".", "append", "(", "y_train", "[", "i", "]", ")", "\n", "", "hist", "=", "model", ".", "fit", "(", "x", "=", "X_train_fed", ",", "y", "=", "y_train_fed", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "2", ",", "epochs", "=", "params", "[", "'n_epochs'", "]", ",", "validation_split", "=", "0.2", ")", "\n", "y_score", "=", "model", ".", "predict", "(", "X_test", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "0", ")", "\n", "y_pred", "=", "(", "np", ".", "ravel", "(", "y_score", ")", ">", "0.5", ")", ".", "astype", "(", "'int32'", ")", "if", "params", "[", "'is_clf'", "]", "else", "np", ".", "ravel", "(", "y_score", ")", "\n", "evaluate", "(", "y_test", ",", "y_pred", ",", "params", ")", "\n", "", "y_score", "=", "model", ".", "predict", "(", "X_test", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "0", ")", "\n", "y_pred", "=", "(", "np", ".", "ravel", "(", "y_score", ")", ">", "0.5", ")", ".", "astype", "(", "'int32'", ")", "if", "params", "[", "'is_clf'", "]", "else", "np", ".", "ravel", "(", "y_score", ")", "\n", "return", "y_pred", ",", "hist", ".", "history", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iilnoniid.load_mode_data": [[33, 65], ["pandas.read_pickle", "open", "df[].apply", "df[].apply", "df[].fillna().apply().apply", "df[].apply().apply", "df[].apply", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].fillna().apply", "df[].apply", "numpy.log", "numpy.log", "numpy.log", "numpy.log", "df[].drop", "df[].drop", "df[].fillna", "min", "min", "max"], "function", ["None"], ["def", "load_mode_data", "(", "mode", ",", "subject_id", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "filename", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "mode", ",", "subject_id", ")", "\n", "df", "=", "pd", ".", "read_pickle", "(", "open", "(", "filename", ",", "\"rb\"", ")", ")", "\n", "df", "[", "'timestamp'", "]", "=", "df", "[", "'timestamp'", "]", ".", "dt", ".", "date", "\n", "if", "mode", "==", "'alphanum'", ":", "\n", "        ", "df", "[", "'x'", "]", "=", "df", "[", "'x'", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "2276", ")", "\n", "df", "[", "'y'", "]", "=", "df", "[", "'y'", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "959", ")", "\n", "df", "[", "'dt'", "]", "=", "df", "[", "'dt'", "]", ".", "fillna", "(", "0", ")", ".", "apply", "(", "lambda", "x", ":", "min", "(", "x", ",", "5", ")", ")", ".", "apply", "(", "lambda", "x", ":", "np", ".", "log", "(", "x", "+", "1", ")", "/", "np", ".", "log", "(", "6", ")", ")", "\n", "df", "[", "'dr'", "]", "=", "df", "[", "'dr'", "]", ".", "apply", "(", "lambda", "x", ":", "min", "(", "max", "(", "50", ",", "x", ")", ",", "1000", ")", ")", ".", "apply", "(", "lambda", "x", ":", "np", ".", "log", "(", "x", "-", "49", ")", "/", "np", ".", "log", "(", "951", ")", ")", "\n", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'dt'", ",", "'dr'", "]", "]", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'dt'", ",", "'dr'", "]", "]", ".", "values", "\n", "", "", "", "if", "mode", "==", "'special'", ":", "\n", "        ", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", ".", "drop", "(", "[", "'timestamp'", ",", "'session_number'", "]", ",", "1", ")", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", ".", "drop", "(", "[", "'timestamp'", ",", "'session_number'", "]", ",", "1", ")", ".", "values", "\n", "", "", "", "if", "mode", "==", "'accel'", ":", "\n", "        ", "df", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", "=", "df", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "39.2266", ")", "\n", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "values", "\n", "", "", "", "return", "data", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iilnoniid.load_subject_data": [[67, 99], ["os.path.isfile", "pandas.read_pickle", "pandas.read_pickle", "mdata[].keys", "pickle.dump", "pandas.read_pickle", "Fed_mood_iilnoniid.load_mode_data", "open", "open", "all", "open", "open", "label.append", "timestamp.append", "numpy.ndarray.tolist", "keras.preprocessing.sequence.pad_sequences", "numpy.transpose", "sdata[].append", "df_date[].iloc[].timestamp.date", "numpy.transpose", "mdata[].keys", "len", "df_date[].iloc[].timestamp.date.strftime"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_mode_data"], ["", "def", "load_subject_data", "(", "modes", ",", "subject_id", ",", "params", ")", ":", "\n", "    ", "level_name", "=", "[", "'session'", ",", "'day'", "]", "\n", "filename", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "level_name", "[", "params", "[", "'level'", "]", "]", ",", "subject_id", ")", "\n", "if", "os", ".", "path", ".", "isfile", "(", "filename", ")", ":", "\n", "        ", "return", "pd", ".", "read_pickle", "(", "open", "(", "filename", ",", "\"rb\"", ")", ")", "\n", "", "mdata", "=", "{", "}", "\n", "sdata", "=", "{", "}", "\n", "for", "mode", "in", "modes", ":", "\n", "        ", "mdata", "[", "mode", "]", "=", "load_mode_data", "(", "mode", ",", "subject_id", ",", "params", ")", "\n", "sdata", "[", "mode", "]", "=", "[", "]", "\n", "", "label", "=", "[", "]", "\n", "timestamp", "=", "[", "]", "\n", "ratingfile", "=", "\"mood\\weekly_ratings_%d.pickle\"", "%", "subject_id", "\n", "df_rating", "=", "pd", ".", "read_pickle", "(", "open", "(", "ratingfile", ",", "\"rb\"", ")", ")", "\n", "datefile", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "modes", "[", "0", "]", ",", "subject_id", ")", "\n", "df_date", "=", "pd", ".", "read_pickle", "(", "open", "(", "datefile", ",", "\"rb\"", ")", ")", "\n", "for", "i", "in", "mdata", "[", "modes", "[", "0", "]", "]", ".", "keys", "(", ")", ":", "\n", "        ", "if", "all", "(", "i", "in", "mdata", "[", "mode", "]", ".", "keys", "(", ")", "and", "len", "(", "mdata", "[", "mode", "]", "[", "i", "]", ")", ">=", "params", "[", "'seq_min_len'", "]", "for", "mode", "in", "modes", ")", ":", "\n", "            ", "for", "mode", "in", "modes", ":", "\n", "                ", "lists", "=", "np", ".", "ndarray", ".", "tolist", "(", "np", ".", "transpose", "(", "mdata", "[", "mode", "]", "[", "i", "]", ")", ")", "\n", "pad_matrix", "=", "pad_sequences", "(", "lists", ",", "maxlen", "=", "params", "[", "'seq_max_len'", "]", ",", "dtype", "=", "'float32'", ")", "\n", "pad_matrix", "=", "np", ".", "transpose", "(", "pad_matrix", ")", "\n", "sdata", "[", "mode", "]", ".", "append", "(", "pad_matrix", ")", "\n", "", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "                ", "rating_date", "=", "df_date", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", ".", "iloc", "[", "0", "]", ".", "timestamp", ".", "date", "(", ")", "\n", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "                ", "rating_date", "=", "i", "\n", "", "ratings", "=", "df_rating", "[", "lambda", "x", ":", "x", ".", "date", "==", "rating_date", ".", "strftime", "(", "'%Y-%m-%d'", ")", "]", ".", "iloc", "[", "0", "]", "\n", "label", ".", "append", "(", "[", "ratings", ".", "sighd_17item", ",", "ratings", ".", "ymrs_total", "]", ")", "\n", "timestamp", ".", "append", "(", "rating_date", ")", "\n", "", "", "pk", ".", "dump", "(", "(", "sdata", ",", "label", ",", "timestamp", ")", ",", "open", "(", "filename", ",", "'wb'", ")", ",", "protocol", "=", "pk", ".", "HIGHEST_PROTOCOL", ")", "\n", "return", "sdata", ",", "label", ",", "timestamp", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iilnoniid.convert_label": [[101, 114], ["range", "range", "numpy.array", "len", "len"], "function", ["None"], ["", "def", "convert_label", "(", "labels", ",", "params", ")", ":", "\n", "    ", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "0", "]", "\n", "if", "labels", "[", "i", "]", ">=", "8", ":", "\n", "                ", "labels", "[", "i", "]", "=", "1", "\n", "", "else", ":", "\n", "                ", "labels", "[", "i", "]", "=", "0", "\n", "", "", "return", "labels", "\n", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "1", "]", "\n", "", "return", "np", ".", "array", "(", "labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iilnoniid.converts_label": [[115, 129], ["range", "numpy.array", "range", "len", "len"], "function", ["None"], ["", "", "def", "converts_label", "(", "labels", ",", "params", ",", "subject_ids", ")", ":", "\n", "    ", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "for", "i", "in", "subject_ids", ":", "\n", "            ", "for", "j", "in", "range", "(", "len", "(", "labels", "[", "i", "]", ")", ")", ":", "\n", "                ", "labels", "[", "i", "]", "[", "j", "]", "=", "labels", "[", "i", "]", "[", "j", "]", "[", "0", "]", "\n", "if", "labels", "[", "i", "]", "[", "j", "]", ">=", "8", ":", "\n", "                    ", "labels", "[", "i", "]", "[", "j", "]", "=", "1", "\n", "", "else", ":", "\n", "                    ", "labels", "[", "i", "]", "[", "j", "]", "=", "0", "\n", "", "", "", "return", "labels", "\n", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "1", "]", "\n", "", "return", "np", ".", "array", "(", "labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iilnoniid.save_obj": [[130, 133], ["open", "pickle.dump"], "function", ["None"], ["", "", "def", "save_obj", "(", "obj", ",", "name", ")", ":", "\n", "    ", "with", "open", "(", "name", "+", "'.pkl'", ",", "'wb'", ")", "as", "f", ":", "\n", "        ", "pk", ".", "dump", "(", "obj", ",", "f", ",", "pk", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iilnoniid.load_obj": [[135, 138], ["open", "pickle.load"], "function", ["None"], ["", "", "def", "load_obj", "(", "name", ")", ":", "\n", "    ", "with", "open", "(", "name", "+", "'.pkl'", ",", "'rb'", ")", "as", "f", ":", "\n", "        ", "return", "pk", ".", "load", "(", "f", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iilnoniid.loads_data": [[140, 188], ["range", "random.seed", "random.sample", "Fed_mood_iilnoniid.save_obj", "Fed_mood_iilnoniid.load_obj", "numpy.concatenate", "Fed_mood_iilnoniid.convert_label", "numpy.concatenate", "numpy.concatenate", "Fed_mood_iilnoniid.load_subject_data", "len", "len", "numpy.concatenate", "numpy.asarray", "numpy.asarray", "range", "len", "range", "range", "len", "len", "int", "int", "numpy.asarray", "a[].append", "len"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.save_obj", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_obj", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.convert_label", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_subject_data"], ["", "", "def", "loads_data", "(", "subject_ids", ",", "ratio", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "label", "=", "{", "}", "\n", "timestamp", "=", "{", "}", "\n", "n", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "data", "[", "i", "]", ",", "label", "[", "i", "]", ",", "timestamp", "[", "i", "]", "=", "load_subject_data", "(", "modes", ",", "i", ",", "params", ")", "\n", "m", "=", "len", "(", "label", "[", "i", "]", ")", "\n", "if", "ratio", ">", "0", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "ratio", ")", ")", "\n", "", "else", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "(", "ratio", "+", "1", ")", ")", ",", "m", ")", "\n", "", "for", "mode", "in", "modes", ":", "\n", "            ", "data", "[", "i", "]", "[", "mode", "]", "=", "[", "data", "[", "i", "]", "[", "mode", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "", "label", "[", "i", "]", "=", "[", "label", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "timestamp", "[", "i", "]", "=", "[", "timestamp", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "n", "+=", "len", "(", "idx", ")", "\n", "", "idx", "=", "range", "(", "n", ")", "\n", "random", ".", "seed", "(", "0", ")", "\n", "idx", "=", "random", ".", "sample", "(", "idx", ",", "k", "=", "len", "(", "idx", ")", ")", "\n", "datas", "=", "{", "}", "\n", "for", "mode", "in", "modes", ":", "\n", "        ", "datas", "[", "mode", "]", "=", "np", ".", "concatenate", "(", "[", "np", ".", "asarray", "(", "data", "[", "i", "]", "[", "mode", "]", ")", "for", "i", "in", "subject_ids", "]", ")", "\n", "datas", "[", "mode", "]", "=", "np", ".", "asarray", "(", "[", "datas", "[", "mode", "]", "[", "i", "]", "for", "i", "in", "idx", "]", ")", "\n", "np", ".", "asarray", "(", "data", "[", "i", "]", "[", "mode", "]", ")", "\n", "", "a", "=", "{", "}", "\n", "save_obj", "(", "label", ",", "'tt'", ")", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "a", "[", "i", "]", "=", "label", "[", "i", "]", "[", "0", "]", "\n", "", "for", "i", "in", "subject_ids", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "label", "[", "i", "]", ")", ")", ":", "\n", "            ", "if", "j", "==", "0", ":", "\n", "                ", "continue", "\n", "", "else", ":", "\n", "                ", "a", "[", "i", "]", ".", "append", "(", "label", "[", "i", "]", "[", "j", "]", ")", "\n", "", "", "", "newlabel", "=", "load_obj", "(", "'tt'", ")", "\n", "labels", "=", "np", ".", "concatenate", "(", "[", "label", "[", "i", "]", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "ll", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "labels", "[", "ll", "]", "=", "newlabel", "[", "i", "]", "[", "0", "]", "\n", "ll", "+=", "len", "(", "newlabel", "[", "i", "]", ")", "\n", "", "labels", "=", "[", "labels", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "labels", "=", "convert_label", "(", "labels", ",", "params", ")", "\n", "timestamps", "=", "np", ".", "concatenate", "(", "[", "timestamp", "[", "i", "]", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "timestamps", "=", "[", "timestamps", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "whose", "=", "np", ".", "concatenate", "(", "[", "[", "i", "]", "*", "len", "(", "label", "[", "i", "]", ")", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "whose", "=", "[", "whose", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "return", "datas", ",", "labels", ",", "timestamps", ",", "whose", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iilnoniid.load_data": [[189, 225], ["random.seed", "copy.deepcopy", "copy.deepcopy", "Fed_mood_iilnoniid.converts_label", "Fed_mood_iilnoniid.load_subject_data", "len", "len", "random.sample", "random.sample", "range", "range", "range", "len", "numpy.concatenate", "range", "len", "int", "int", "len", "numpy.asarray", "len", "numpy.asarray"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.converts_label", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_subject_data"], ["", "def", "load_data", "(", "subject_ids", ",", "ratio", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "label", "=", "{", "}", "\n", "timestamp", "=", "{", "}", "\n", "n", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "data", "[", "i", "]", ",", "label", "[", "i", "]", ",", "timestamp", "[", "i", "]", "=", "load_subject_data", "(", "modes", ",", "i", ",", "params", ")", "\n", "m", "=", "len", "(", "label", "[", "i", "]", ")", "\n", "if", "ratio", ">", "0", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "ratio", ")", ")", "\n", "", "else", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "(", "ratio", "+", "1", ")", ")", ",", "m", ")", "\n", "", "for", "mode", "in", "modes", ":", "\n", "            ", "data", "[", "i", "]", "[", "mode", "]", "=", "[", "data", "[", "i", "]", "[", "mode", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "", "label", "[", "i", "]", "=", "[", "label", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "timestamp", "[", "i", "]", "=", "[", "timestamp", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "n", "+=", "len", "(", "idx", ")", "\n", "", "random", ".", "seed", "(", "0", ")", "\n", "datas", "=", "copy", ".", "deepcopy", "(", "data", ")", "\n", "for", "j", "in", "subject_ids", ":", "\n", "        ", "idx", "=", "random", ".", "sample", "(", "range", "(", "len", "(", "data", "[", "j", "]", "[", "'accel'", "]", ")", ")", ",", "len", "(", "data", "[", "j", "]", "[", "'accel'", "]", ")", ")", "\n", "for", "mode", "in", "modes", ":", "\n", "            ", "k", "=", "0", "\n", "for", "i", "in", "idx", ":", "\n", "                ", "datas", "[", "j", "]", "[", "mode", "]", "[", "k", "]", "=", "np", ".", "asarray", "(", "data", "[", "j", "]", "[", "mode", "]", "[", "i", "]", ")", "\n", "k", "=", "k", "+", "1", "\n", "", "datas", "[", "j", "]", "[", "mode", "]", "=", "np", ".", "concatenate", "(", "[", "np", ".", "asarray", "(", "datas", "[", "j", "]", "[", "mode", "]", ")", "]", ")", "\n", "", "", "labels", "=", "copy", ".", "deepcopy", "(", "label", ")", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "idx", "=", "random", ".", "sample", "(", "range", "(", "len", "(", "label", "[", "i", "]", ")", ")", ",", "len", "(", "label", "[", "i", "]", ")", ")", "\n", "k", "=", "0", "\n", "for", "j", "in", "idx", ":", "\n", "            ", "labels", "[", "i", "]", "[", "k", "]", "=", "label", "[", "i", "]", "[", "j", "]", "\n", "k", "=", "k", "+", "1", "\n", "", "", "labels", "=", "converts_label", "(", "labels", ",", "params", ",", "subject_ids", ")", "\n", "return", "datas", ",", "labels", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iilnoniid.split_data": [[227, 237], ["Fed_mood_iilnoniid.load_data", "Fed_mood_iilnoniid.loads_data", "list", "list.remove", "Fed_mood_iilnoniid.load_data", "Fed_mood_iilnoniid.load_data"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.loads_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data"], ["", "def", "split_data", "(", "subject_ids", ",", "params", ")", ":", "\n", "    ", "if", "params", "[", "'test_subject'", "]", "==", "-", "1", ":", "\n", "        ", "train_data", ",", "train_label", "=", "load_data", "(", "subject_ids", ",", "0.8", ",", "params", ")", "\n", "test_data", ",", "test_label", ",", "_", ",", "_", "=", "loads_data", "(", "subject_ids", ",", "-", "0.2", ",", "params", ")", "\n", "", "else", ":", "\n", "        ", "train_subjects", "=", "list", "(", "subject_ids", ")", "\n", "train_subjects", ".", "remove", "(", "params", "[", "'test_subject'", "]", ")", "\n", "train_data", ",", "train_label", ",", "_", ",", "_", "=", "load_data", "(", "train_subjects", ",", "1", ",", "params", ")", "\n", "test_data", ",", "test_label", ",", "_", ",", "_", "=", "load_data", "(", "[", "params", "[", "'test_subject'", "]", "]", ",", "1", ",", "params", ")", "\n", "", "return", "train_data", ",", "train_label", ",", "test_data", ",", "test_label", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iilnoniid.evaluate": [[239, 253], ["print", "numpy.sqrt", "numpy.mean", "float", "len", "float", "float", "numpy.mean", "numpy.abs", "sum", "sum", "sum", "numpy.square", "numpy.square", "numpy.square", "numpy.sum", "numpy.sum", "sum", "sum", "numpy.std", "numpy.std", "numpy.square", "numpy.square", "numpy.mean"], "function", ["None"], ["", "def", "evaluate", "(", "y_test", ",", "y_pred", ",", "params", ")", ":", "\n", "    ", "res", "=", "{", "}", "\n", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "res", "[", "'accuracy'", "]", "=", "float", "(", "sum", "(", "y_test", "==", "y_pred", ")", ")", "/", "len", "(", "y_test", ")", "\n", "res", "[", "'precision'", "]", "=", "float", "(", "sum", "(", "y_test", "&", "y_pred", ")", "+", "1", ")", "/", "(", "sum", "(", "y_pred", ")", "+", "1", ")", "\n", "res", "[", "'recall'", "]", "=", "float", "(", "sum", "(", "y_test", "&", "y_pred", ")", "+", "1", ")", "/", "(", "sum", "(", "y_test", ")", "+", "1", ")", "\n", "res", "[", "'f_score'", "]", "=", "2.0", "*", "res", "[", "'precision'", "]", "*", "res", "[", "'recall'", "]", "/", "(", "res", "[", "'precision'", "]", "+", "res", "[", "'recall'", "]", ")", "\n", "", "else", ":", "\n", "        ", "res", "[", "'rmse'", "]", "=", "np", ".", "sqrt", "(", "np", ".", "mean", "(", "np", ".", "square", "(", "y_test", "-", "y_pred", ")", ")", ")", "\n", "res", "[", "'mae'", "]", "=", "np", ".", "mean", "(", "np", ".", "abs", "(", "y_test", "-", "y_pred", ")", ")", "\n", "res", "[", "'explained_variance_score'", "]", "=", "1", "-", "np", ".", "square", "(", "np", ".", "std", "(", "y_test", "-", "y_pred", ")", ")", "/", "np", ".", "square", "(", "np", ".", "std", "(", "y_test", ")", ")", "\n", "res", "[", "'r2_score'", "]", "=", "1", "-", "np", ".", "sum", "(", "np", ".", "square", "(", "y_test", "-", "y_pred", ")", ")", "/", "np", ".", "sum", "(", "np", ".", "square", "(", "y_test", "-", "np", ".", "mean", "(", "y_test", ")", ")", ")", "\n", "", "print", "(", "' '", ".", "join", "(", "[", "\"%s: %.4f\"", "%", "(", "i", ",", "res", "[", "i", "]", ")", "for", "i", "in", "res", "]", ")", ")", "\n", "return", "res", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iilnoniid.mvm_decision_function": [[255, 263], ["len", "keras.backend.concatenate", "keras.backend.sum", "keras.backend.prod", "range", "keras.backend.stack", "range"], "function", ["None"], ["", "def", "mvm_decision_function", "(", "arg", ")", ":", "\n", "    ", "n_modes", "=", "len", "(", "arg", ")", "\n", "latentx", "=", "arg", "\n", "y", "=", "K", ".", "concatenate", "(", "[", "K", ".", "sum", "(", "\n", "K", ".", "prod", "(", "K", ".", "stack", "(", "[", "latentx", "[", "j", "]", "[", ":", ",", "i", "*", "params", "[", "'n_latent'", "]", ":", "(", "i", "+", "1", ")", "*", "params", "[", "'n_latent'", "]", "]", "for", "j", "in", "range", "(", "n_modes", ")", "]", ")", ",", "\n", "axis", "=", "0", ")", ",", "axis", "=", "-", "1", ",", "keepdims", "=", "True", ")", "for", "i", "in", "range", "(", "params", "[", "'n_classes'", "]", ")", "]", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iilnoniid.fm_decision_function": [[265, 271], ["keras.backend.concatenate", "keras.backend.sum", "keras.backend.tf.stack", "keras.backend.sum", "keras.backend.square", "range"], "function", ["None"], ["", "def", "fm_decision_function", "(", "arg", ")", ":", "\n", "    ", "latentx", ",", "bias", "=", "arg", "[", "0", "]", ",", "arg", "[", "1", "]", "\n", "pairwise", "=", "K", ".", "concatenate", "(", "[", "K", ".", "sum", "(", "K", ".", "square", "(", "latentx", "[", ":", ",", "i", "*", "params", "[", "'n_latent'", "]", ":", "(", "i", "+", "1", ")", "*", "params", "[", "'n_latent'", "]", "]", ")", ",", "axis", "=", "-", "1", ",", "keepdims", "=", "True", ")", "for", "i", "in", "range", "(", "params", "[", "'n_classes'", "]", ")", "]", ")", "\n", "y", "=", "K", ".", "sum", "(", "K", ".", "tf", ".", "stack", "(", "[", "pairwise", ",", "bias", "]", ")", ",", "axis", "=", "0", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iilnoniid.acc": [[273, 275], ["keras.backend.mean", "keras.backend.equal"], "function", ["None"], ["", "def", "acc", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "return", "K", ".", "mean", "(", "K", ".", "equal", "(", "y_true", ">", "0.5", ",", "y_pred", ">", "0.5", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iilnoniid.rmse": [[277, 279], ["keras.backend.sqrt", "keras.backend.mean", "keras.backend.square"], "function", ["None"], ["", "def", "rmse", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "return", "K", ".", "sqrt", "(", "K", ".", "mean", "(", "K", ".", "square", "(", "y_true", "-", "y_pred", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iilnoniid.create_model": [[281, 343], ["Model", "Model.compile", "Model.summary", "train_data[].keys", "train_data[].keys", "merge", "train_data[].keys", "merge", "merge", "Dense", "Dense", "merge", "Dense", "Dense", "RMSprop", "Input", "input_list.append", "output_list.append", "len", "Activation", "Activation", "Input", "input_list.append", "output_list.append", "len", "Activation", "Activation", "Input", "input_list.append", "output_list.append", "Activation", "Activation", "Masking", "Bidirectional", "Dropout", "Masking", "Bidirectional", "Dropout", "Masking", "Bidirectional", "Dropout", "Dense", "GRU", "GRU", "GRU"], "function", ["None"], ["", "def", "create_model", "(", "train_data", ",", "test_data", ",", "params", ")", ":", "\n", "    ", "input_list", "=", "[", "]", "\n", "output_list", "=", "[", "]", "\n", "train_list", "=", "[", "]", "\n", "test_list", "=", "[", "]", "\n", "if", "params", "[", "'idx'", "]", "==", "1", ":", "\n", "        ", "for", "mode", "in", "train_data", "[", "7", "]", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "output_list", ".", "append", "(", "drop_output", ")", "\n", "", "", "x", "=", "merge", "(", "output_list", ",", "mode", "=", "'concat'", ")", "if", "len", "(", "output_list", ")", ">", "1", "else", "output_list", "[", "0", "]", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_classes'", "]", "*", "params", "[", "'n_latent'", "]", ",", "activation", "=", "'relu'", ",", "\n", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "x", ")", "\n", "y", "=", "Dense", "(", "params", "[", "'n_classes'", "]", ",", "bias", "=", "False", ")", "(", "latentx", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "2", ":", "\n", "        ", "for", "mode", "in", "train_data", "[", "7", "]", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "output_list", ".", "append", "(", "drop_output", ")", "\n", "", "", "x", "=", "merge", "(", "output_list", ",", "mode", "=", "'concat'", ")", "if", "len", "(", "output_list", ")", ">", "1", "else", "output_list", "[", "0", "]", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_latent'", "]", "*", "params", "[", "'n_classes'", "]", ",", "bias", "=", "False", ")", "(", "x", ")", "\n", "bias", "=", "Dense", "(", "params", "[", "'n_classes'", "]", ",", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "x", ")", "\n", "y", "=", "merge", "(", "[", "latentx", ",", "bias", "]", ",", "mode", "=", "fm_decision_function", ",", "output_shape", "=", "(", "params", "[", "'n_classes'", "]", ",", ")", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "3", ":", "\n", "        ", "for", "mode", "in", "train_data", "[", "7", "]", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_latent'", "]", "*", "params", "[", "'n_classes'", "]", ",", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "\n", "drop_output", ")", "\n", "output_list", ".", "append", "(", "latentx", ")", "\n", "", "", "y", "=", "merge", "(", "output_list", ",", "mode", "=", "mvm_decision_function", ",", "output_shape", "=", "(", "params", "[", "'n_classes'", "]", ",", ")", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "model", "=", "Model", "(", "input", "=", "input_list", ",", "output", "=", "y_act", ")", "\n", "model", ".", "compile", "(", "loss", "=", "objective", ",", "optimizer", "=", "RMSprop", "(", "lr", "=", "params", "[", "'lr'", "]", ")", ",", "metrics", "=", "metric", ")", "\n", "model", ".", "summary", "(", ")", "\n", "return", "model", ",", "train_list", ",", "test_list", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iilnoniid.noniid": [[345, 364], ["numpy.arange", "numpy.asarray", "numpy.vstack", "range", "numpy.array", "set", "list", "range", "range", "numpy.random.choice", "numpy.concatenate", "idxs_labels[].argsort", "set"], "function", ["None"], ["", "def", "noniid", "(", "train_label", ",", "num_users", ")", ":", "\n", "    ", "num_shards", ",", "num_imgs", "=", "8", ",", "1496", "\n", "idx_shard", "=", "[", "i", "for", "i", "in", "range", "(", "num_shards", ")", "]", "\n", "dict_users", "=", "{", "i", ":", "np", ".", "array", "(", "[", "]", ",", "dtype", "=", "'int64'", ")", "for", "i", "in", "range", "(", "num_users", ")", "}", "\n", "idxs", "=", "np", ".", "arange", "(", "num_shards", "*", "num_imgs", ")", "\n", "labels", "=", "np", ".", "asarray", "(", "train_label", ")", "\n", "\n", "# sort labels", "\n", "idxs_labels", "=", "np", ".", "vstack", "(", "(", "idxs", ",", "labels", ")", ")", "\n", "idxs_labels", "=", "idxs_labels", "[", ":", ",", "idxs_labels", "[", "1", ",", ":", "]", ".", "argsort", "(", ")", "]", "\n", "idxs", "=", "idxs_labels", "[", "0", ",", ":", "]", "\n", "\n", "# divide and assign", "\n", "for", "i", "in", "range", "(", "num_users", ")", ":", "\n", "        ", "rand_set", "=", "set", "(", "np", ".", "random", ".", "choice", "(", "idx_shard", ",", "2", ",", "replace", "=", "False", ")", ")", "\n", "idx_shard", "=", "list", "(", "set", "(", "idx_shard", ")", "-", "rand_set", ")", "\n", "for", "rand", "in", "rand_set", ":", "\n", "            ", "dict_users", "[", "i", "]", "=", "np", ".", "concatenate", "(", "(", "dict_users", "[", "i", "]", ",", "idxs", "[", "rand", "*", "num_imgs", ":", "(", "rand", "+", "1", ")", "*", "num_imgs", "]", ")", ",", "axis", "=", "0", ")", "\n", "", "", "return", "dict_users", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iilnoniid.FedAvg": [[366, 395], ["copy.deepcopy", "range", "range", "len", "range", "len", "range", "range", "range", "range", "range", "range", "len", "numpy.zeros", "range", "w_avg.append", "range", "w_avg.append", "len", "range", "len", "range", "numpy.shape", "len", "len", "len", "len", "len", "len", "len", "len"], "function", ["None"], ["", "def", "FedAvg", "(", "w", ",", "lengthdict", ",", "params", ")", ":", "\n", "    ", "w_avg", "=", "[", "]", "\n", "c", "=", "{", "}", "\n", "load", "=", "copy", ".", "deepcopy", "(", "w", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "load", ")", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "load", "[", "i", "]", ")", ")", ":", "\n", "            ", "load", "[", "i", "]", "[", "j", "]", "=", "np", ".", "zeros", "(", "shape", "=", "np", ".", "shape", "(", "load", "[", "i", "]", "[", "j", "]", ")", ")", "\n", "", "", "sum", "=", "0", "\n", "for", "i", "in", "range", "(", "len", "(", "lengthdict", ")", ")", ":", "\n", "        ", "sum", "+=", "lengthdict", "[", "i", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "3", ":", "\n", "        ", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "            ", "c", "[", "i", "]", "=", "load", "[", "i", "]", "\n", "", "for", "k", "in", "range", "(", "6", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", ")", ")", ":", "\n", "                ", "for", "j", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", "[", "0", "]", ")", ")", ":", "\n", "                    ", "c", "[", "k", "]", "[", "j", "]", "+=", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", "[", "i", "]", "[", "j", "]", "*", "lengthdict", "[", "i", "]", "/", "sum", "\n", "", "", "", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "            ", "w_avg", ".", "append", "(", "c", "[", "i", "]", ")", "\n", "", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "5", ")", ":", "\n", "            ", "c", "[", "i", "]", "=", "load", "[", "i", "]", "\n", "", "for", "k", "in", "range", "(", "5", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", ")", ")", ":", "\n", "                ", "for", "j", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", "[", "0", "]", ")", ")", ":", "\n", "                    ", "c", "[", "k", "]", "[", "j", "]", "+=", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", "[", "i", "]", "[", "j", "]", "*", "lengthdict", "[", "i", "]", "/", "sum", "\n", "", "", "", "for", "i", "in", "range", "(", "5", ")", ":", "\n", "            ", "w_avg", ".", "append", "(", "c", "[", "i", "]", ")", "\n", "", "", "return", "w_avg", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_iilnoniid.run_model": [[397, 439], ["Fed_mood_iilnoniid.create_model", "numpy.random.seed", "range", "range", "range", "X_test.append", "range", "model.fit", "model.predict", "Fed_mood_iilnoniid.evaluate", "numpy.random.choice", "numpy.random.choice", "numpy.concatenate", "X_train_fed[].append", "numpy.ravel", "user.append", "user.append", "user.append", "numpy.asarray", "numpy.ravel"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.create_model", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.evaluate"], ["", "def", "run_model", "(", "train_data", ",", "test_data", ",", "y_train", ",", "y_test", ",", "params", ")", ":", "\n", "    ", "num", "=", "[", "6", ",", "7", ",", "8", ",", "12", ",", "13", ",", "14", "]", "\n", "X_train", ",", "X_test", "=", "{", "}", ",", "[", "]", "\n", "X_train_fed", ",", "y_train_fed", "=", "{", "}", ",", "{", "}", "\n", "model", ",", "_", ",", "_", "=", "create_model", "(", "train_data", ",", "test_data", ",", "params", ")", "\n", "users", "=", "{", "}", "\n", "users", "[", "0", "]", "=", "[", "24", ",", "25", ",", "39", ",", "40", "]", "\n", "users", "[", "1", "]", "=", "[", "7", ",", "15", ",", "19", ",", "20", ",", "21", ",", "27", "]", "\n", "users", "[", "2", "]", "=", "[", "13", ",", "16", ",", "17", ",", "31", ",", "32", ",", "33", ",", "36", ",", "37", ",", "38", "]", "\n", "np", ".", "random", ".", "seed", "(", "params", "[", "'seed'", "]", ")", "\n", "for", "i", "in", "range", "(", "3", ")", ":", "\n", "        ", "if", "i", "==", "2", ":", "\n", "            ", "users", "[", "i", "]", "=", "np", ".", "random", ".", "choice", "(", "users", "[", "i", "]", ",", "8", ",", "replace", "=", "False", ")", "\n", "", "else", ":", "\n", "            ", "users", "[", "i", "]", "=", "np", ".", "random", ".", "choice", "(", "users", "[", "i", "]", ",", "4", ",", "replace", "=", "False", ")", "\n", "", "", "for", "mode", "in", "modes", ":", "\n", "        ", "X_test", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "X_train", "[", "i", "]", ",", "X_train_fed", "[", "i", "]", "=", "{", "}", ",", "[", "]", "\n", "y_train_fed", "[", "i", "]", "=", "[", "]", "\n", "user", "=", "[", "]", "\n", "for", "k", "in", "range", "(", "3", ")", ":", "\n", "            ", "if", "k", "==", "2", ":", "\n", "                ", "b", "=", "i", "*", "2", "\n", "y_train_fed", "[", "i", "]", "+=", "y_train", "[", "users", "[", "k", "]", "[", "b", "]", "]", "\n", "user", ".", "append", "(", "users", "[", "k", "]", "[", "b", "]", ")", "\n", "b", "=", "b", "+", "1", "\n", "y_train_fed", "[", "i", "]", "+=", "y_train", "[", "users", "[", "k", "]", "[", "b", "]", "]", "\n", "user", ".", "append", "(", "users", "[", "k", "]", "[", "b", "]", ")", "\n", "", "else", ":", "\n", "                ", "y_train_fed", "[", "i", "]", "+=", "y_train", "[", "users", "[", "k", "]", "[", "i", "]", "]", "\n", "user", ".", "append", "(", "users", "[", "k", "]", "[", "i", "]", ")", "\n", "", "", "for", "mode", "in", "modes", ":", "\n", "            ", "X_train", "[", "i", "]", "[", "mode", "]", "=", "np", ".", "concatenate", "(", "[", "np", ".", "asarray", "(", "train_data", "[", "j", "]", "[", "mode", "]", ")", "for", "j", "in", "user", "]", ")", "\n", "X_train_fed", "[", "i", "]", ".", "append", "(", "X_train", "[", "i", "]", "[", "mode", "]", ")", "\n", "", "", "for", "j", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "hist", "=", "model", ".", "fit", "(", "x", "=", "X_train_fed", "[", "j", "]", ",", "y", "=", "y_train_fed", "[", "j", "]", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "2", ",", "epochs", "=", "params", "[", "'n_epochs'", "]", ",", "validation_split", "=", "0.2", ")", "\n", "y_score", "=", "model", ".", "predict", "(", "X_test", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "0", ")", "\n", "y_pred", "=", "(", "np", ".", "ravel", "(", "y_score", ")", ">", "0.5", ")", ".", "astype", "(", "'int32'", ")", "if", "params", "[", "'is_clf'", "]", "else", "np", ".", "ravel", "(", "y_score", ")", "\n", "evaluate", "(", "y_test", ",", "y_pred", ",", "params", ")", "\n", "", "return", "y_pred", ",", "hist", ".", "history", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_local.load_mode_data": [[32, 64], ["pandas.read_pickle", "open", "df[].apply", "df[].apply", "df[].fillna().apply().apply", "df[].apply().apply", "df[].apply", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].fillna().apply", "df[].apply", "numpy.log", "numpy.log", "numpy.log", "numpy.log", "df[].drop", "df[].drop", "df[].fillna", "min", "min", "max"], "function", ["None"], ["def", "load_mode_data", "(", "mode", ",", "subject_id", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "filename", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "mode", ",", "subject_id", ")", "\n", "df", "=", "pd", ".", "read_pickle", "(", "open", "(", "filename", ",", "\"rb\"", ")", ")", "\n", "df", "[", "'timestamp'", "]", "=", "df", "[", "'timestamp'", "]", ".", "dt", ".", "date", "\n", "if", "mode", "==", "'alphanum'", ":", "\n", "        ", "df", "[", "'x'", "]", "=", "df", "[", "'x'", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "2276", ")", "\n", "df", "[", "'y'", "]", "=", "df", "[", "'y'", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "959", ")", "\n", "df", "[", "'dt'", "]", "=", "df", "[", "'dt'", "]", ".", "fillna", "(", "0", ")", ".", "apply", "(", "lambda", "x", ":", "min", "(", "x", ",", "5", ")", ")", ".", "apply", "(", "lambda", "x", ":", "np", ".", "log", "(", "x", "+", "1", ")", "/", "np", ".", "log", "(", "6", ")", ")", "\n", "df", "[", "'dr'", "]", "=", "df", "[", "'dr'", "]", ".", "apply", "(", "lambda", "x", ":", "min", "(", "max", "(", "50", ",", "x", ")", ",", "1000", ")", ")", ".", "apply", "(", "lambda", "x", ":", "np", ".", "log", "(", "x", "-", "49", ")", "/", "np", ".", "log", "(", "951", ")", ")", "\n", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'dt'", ",", "'dr'", "]", "]", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'dt'", ",", "'dr'", "]", "]", ".", "values", "\n", "", "", "", "if", "mode", "==", "'special'", ":", "\n", "        ", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", ".", "drop", "(", "[", "'timestamp'", ",", "'session_number'", "]", ",", "1", ")", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", ".", "drop", "(", "[", "'timestamp'", ",", "'session_number'", "]", ",", "1", ")", ".", "values", "\n", "", "", "", "if", "mode", "==", "'accel'", ":", "\n", "        ", "df", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", "=", "df", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "39.2266", ")", "\n", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "values", "\n", "", "", "", "return", "data", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_local.load_subject_data": [[66, 98], ["os.path.isfile", "pandas.read_pickle", "pandas.read_pickle", "mdata[].keys", "pickle.dump", "pandas.read_pickle", "Fed_mood_local.load_mode_data", "open", "open", "all", "open", "open", "label.append", "timestamp.append", "numpy.ndarray.tolist", "keras.preprocessing.sequence.pad_sequences", "numpy.transpose", "sdata[].append", "df_date[].iloc[].timestamp.date", "numpy.transpose", "mdata[].keys", "len", "df_date[].iloc[].timestamp.date.strftime"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_mode_data"], ["", "def", "load_subject_data", "(", "modes", ",", "subject_id", ",", "params", ")", ":", "\n", "    ", "level_name", "=", "[", "'session'", ",", "'day'", "]", "\n", "filename", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "level_name", "[", "params", "[", "'level'", "]", "]", ",", "subject_id", ")", "\n", "if", "os", ".", "path", ".", "isfile", "(", "filename", ")", ":", "\n", "        ", "return", "pd", ".", "read_pickle", "(", "open", "(", "filename", ",", "\"rb\"", ")", ")", "\n", "", "mdata", "=", "{", "}", "\n", "sdata", "=", "{", "}", "\n", "for", "mode", "in", "modes", ":", "\n", "        ", "mdata", "[", "mode", "]", "=", "load_mode_data", "(", "mode", ",", "subject_id", ",", "params", ")", "\n", "sdata", "[", "mode", "]", "=", "[", "]", "\n", "", "label", "=", "[", "]", "\n", "timestamp", "=", "[", "]", "\n", "ratingfile", "=", "\"mood\\weekly_ratings_%d.pickle\"", "%", "subject_id", "\n", "df_rating", "=", "pd", ".", "read_pickle", "(", "open", "(", "ratingfile", ",", "\"rb\"", ")", ")", "\n", "datefile", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "modes", "[", "0", "]", ",", "subject_id", ")", "\n", "df_date", "=", "pd", ".", "read_pickle", "(", "open", "(", "datefile", ",", "\"rb\"", ")", ")", "\n", "for", "i", "in", "mdata", "[", "modes", "[", "0", "]", "]", ".", "keys", "(", ")", ":", "\n", "        ", "if", "all", "(", "i", "in", "mdata", "[", "mode", "]", ".", "keys", "(", ")", "and", "len", "(", "mdata", "[", "mode", "]", "[", "i", "]", ")", ">=", "params", "[", "'seq_min_len'", "]", "for", "mode", "in", "modes", ")", ":", "\n", "            ", "for", "mode", "in", "modes", ":", "\n", "                ", "lists", "=", "np", ".", "ndarray", ".", "tolist", "(", "np", ".", "transpose", "(", "mdata", "[", "mode", "]", "[", "i", "]", ")", ")", "\n", "pad_matrix", "=", "pad_sequences", "(", "lists", ",", "maxlen", "=", "params", "[", "'seq_max_len'", "]", ",", "dtype", "=", "'float32'", ")", "\n", "pad_matrix", "=", "np", ".", "transpose", "(", "pad_matrix", ")", "\n", "sdata", "[", "mode", "]", ".", "append", "(", "pad_matrix", ")", "\n", "", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "                ", "rating_date", "=", "df_date", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", ".", "iloc", "[", "0", "]", ".", "timestamp", ".", "date", "(", ")", "\n", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "                ", "rating_date", "=", "i", "\n", "", "ratings", "=", "df_rating", "[", "lambda", "x", ":", "x", ".", "date", "==", "rating_date", ".", "strftime", "(", "'%Y-%m-%d'", ")", "]", ".", "iloc", "[", "0", "]", "\n", "label", ".", "append", "(", "[", "ratings", ".", "sighd_17item", ",", "ratings", ".", "ymrs_total", "]", ")", "\n", "timestamp", ".", "append", "(", "rating_date", ")", "\n", "", "", "pk", ".", "dump", "(", "(", "sdata", ",", "label", ",", "timestamp", ")", ",", "open", "(", "filename", ",", "'wb'", ")", ",", "protocol", "=", "pk", ".", "HIGHEST_PROTOCOL", ")", "\n", "return", "sdata", ",", "label", ",", "timestamp", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_local.convert_label": [[100, 113], ["range", "range", "numpy.array", "len", "len"], "function", ["None"], ["", "def", "convert_label", "(", "labels", ",", "params", ")", ":", "\n", "    ", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "0", "]", "\n", "if", "labels", "[", "i", "]", ">=", "8", ":", "\n", "                ", "labels", "[", "i", "]", "=", "1", "\n", "", "else", ":", "\n", "                ", "labels", "[", "i", "]", "=", "0", "\n", "", "", "return", "labels", "\n", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "1", "]", "\n", "", "return", "np", ".", "array", "(", "labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_local.save_obj": [[115, 118], ["open", "pickle.dump"], "function", ["None"], ["", "", "def", "save_obj", "(", "obj", ",", "name", ")", ":", "\n", "    ", "with", "open", "(", "name", "+", "'.pkl'", ",", "'wb'", ")", "as", "f", ":", "\n", "        ", "pk", ".", "dump", "(", "obj", ",", "f", ",", "pk", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_local.load_obj": [[120, 123], ["open", "pickle.load"], "function", ["None"], ["", "", "def", "load_obj", "(", "name", ")", ":", "\n", "    ", "with", "open", "(", "name", "+", "'.pkl'", ",", "'rb'", ")", "as", "f", ":", "\n", "        ", "return", "pk", ".", "load", "(", "f", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_local.load_data": [[125, 173], ["range", "random.seed", "random.sample", "Fed_mood_local.save_obj", "Fed_mood_local.load_obj", "numpy.concatenate", "Fed_mood_local.convert_label", "numpy.concatenate", "numpy.concatenate", "Fed_mood_local.load_subject_data", "len", "len", "numpy.concatenate", "numpy.asarray", "numpy.asarray", "range", "len", "range", "range", "len", "len", "int", "int", "numpy.asarray", "a[].append", "len"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.save_obj", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_obj", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.convert_label", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_subject_data"], ["", "", "def", "load_data", "(", "subject_ids", ",", "ratio", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "label", "=", "{", "}", "\n", "timestamp", "=", "{", "}", "\n", "n", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "data", "[", "i", "]", ",", "label", "[", "i", "]", ",", "timestamp", "[", "i", "]", "=", "load_subject_data", "(", "modes", ",", "i", ",", "params", ")", "\n", "m", "=", "len", "(", "label", "[", "i", "]", ")", "\n", "if", "ratio", ">", "0", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "ratio", ")", ")", "\n", "", "else", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "(", "ratio", "+", "1", ")", ")", ",", "m", ")", "\n", "", "for", "mode", "in", "modes", ":", "\n", "            ", "data", "[", "i", "]", "[", "mode", "]", "=", "[", "data", "[", "i", "]", "[", "mode", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "", "label", "[", "i", "]", "=", "[", "label", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "timestamp", "[", "i", "]", "=", "[", "timestamp", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "n", "+=", "len", "(", "idx", ")", "\n", "", "idx", "=", "range", "(", "n", ")", "\n", "random", ".", "seed", "(", "0", ")", "\n", "idx", "=", "random", ".", "sample", "(", "idx", ",", "k", "=", "len", "(", "idx", ")", ")", "\n", "datas", "=", "{", "}", "\n", "for", "mode", "in", "modes", ":", "\n", "        ", "datas", "[", "mode", "]", "=", "np", ".", "concatenate", "(", "[", "np", ".", "asarray", "(", "data", "[", "i", "]", "[", "mode", "]", ")", "for", "i", "in", "subject_ids", "]", ")", "\n", "datas", "[", "mode", "]", "=", "np", ".", "asarray", "(", "[", "datas", "[", "mode", "]", "[", "i", "]", "for", "i", "in", "idx", "]", ")", "\n", "np", ".", "asarray", "(", "data", "[", "i", "]", "[", "mode", "]", ")", "\n", "", "a", "=", "{", "}", "\n", "save_obj", "(", "label", ",", "'tt'", ")", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "a", "[", "i", "]", "=", "label", "[", "i", "]", "[", "0", "]", "\n", "", "for", "i", "in", "subject_ids", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "label", "[", "i", "]", ")", ")", ":", "\n", "            ", "if", "j", "==", "0", ":", "\n", "                ", "continue", "\n", "", "else", ":", "\n", "                ", "a", "[", "i", "]", ".", "append", "(", "label", "[", "i", "]", "[", "j", "]", ")", "\n", "", "", "", "newlabel", "=", "load_obj", "(", "'tt'", ")", "\n", "labels", "=", "np", ".", "concatenate", "(", "[", "label", "[", "i", "]", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "ll", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "labels", "[", "ll", "]", "=", "newlabel", "[", "i", "]", "[", "0", "]", "\n", "ll", "+=", "len", "(", "newlabel", "[", "i", "]", ")", "\n", "", "labels", "=", "[", "labels", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "labels", "=", "convert_label", "(", "labels", ",", "params", ")", "\n", "timestamps", "=", "np", ".", "concatenate", "(", "[", "timestamp", "[", "i", "]", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "timestamps", "=", "[", "timestamps", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "whose", "=", "np", ".", "concatenate", "(", "[", "[", "i", "]", "*", "len", "(", "label", "[", "i", "]", ")", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "whose", "=", "[", "whose", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "return", "datas", ",", "labels", ",", "timestamps", ",", "whose", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_local.split_data": [[175, 185], ["Fed_mood_local.load_data", "Fed_mood_local.load_data", "list", "list.remove", "Fed_mood_local.load_data", "Fed_mood_local.load_data"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data"], ["", "def", "split_data", "(", "subject_ids", ",", "params", ")", ":", "\n", "    ", "if", "params", "[", "'test_subject'", "]", "==", "-", "1", ":", "\n", "        ", "train_data", ",", "train_label", ",", "_", ",", "_", "=", "load_data", "(", "subject_ids", ",", "0.8", ",", "params", ")", "\n", "test_data", ",", "test_label", ",", "_", ",", "_", "=", "load_data", "(", "subject_ids", ",", "-", "0.2", ",", "params", ")", "\n", "", "else", ":", "\n", "        ", "train_subjects", "=", "list", "(", "subject_ids", ")", "\n", "train_subjects", ".", "remove", "(", "params", "[", "'test_subject'", "]", ")", "\n", "train_data", ",", "train_label", ",", "_", ",", "_", "=", "load_data", "(", "train_subjects", ",", "1", ",", "params", ")", "\n", "test_data", ",", "test_label", ",", "_", ",", "_", "=", "load_data", "(", "[", "params", "[", "'test_subject'", "]", "]", ",", "1", ",", "params", ")", "\n", "", "return", "train_data", ",", "train_label", ",", "test_data", ",", "test_label", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_local.evaluate": [[187, 201], ["print", "numpy.sqrt", "numpy.mean", "float", "len", "float", "float", "numpy.mean", "numpy.abs", "sum", "sum", "sum", "numpy.square", "numpy.square", "numpy.square", "numpy.sum", "numpy.sum", "sum", "sum", "numpy.std", "numpy.std", "numpy.square", "numpy.square", "numpy.mean"], "function", ["None"], ["", "def", "evaluate", "(", "y_test", ",", "y_pred", ",", "params", ")", ":", "\n", "    ", "res", "=", "{", "}", "\n", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "res", "[", "'accuracy'", "]", "=", "float", "(", "sum", "(", "y_test", "==", "y_pred", ")", ")", "/", "len", "(", "y_test", ")", "\n", "res", "[", "'precision'", "]", "=", "float", "(", "sum", "(", "y_test", "&", "y_pred", ")", "+", "1", ")", "/", "(", "sum", "(", "y_pred", ")", "+", "1", ")", "\n", "res", "[", "'recall'", "]", "=", "float", "(", "sum", "(", "y_test", "&", "y_pred", ")", "+", "1", ")", "/", "(", "sum", "(", "y_test", ")", "+", "1", ")", "\n", "res", "[", "'f_score'", "]", "=", "2.0", "*", "res", "[", "'precision'", "]", "*", "res", "[", "'recall'", "]", "/", "(", "res", "[", "'precision'", "]", "+", "res", "[", "'recall'", "]", ")", "\n", "", "else", ":", "\n", "        ", "res", "[", "'rmse'", "]", "=", "np", ".", "sqrt", "(", "np", ".", "mean", "(", "np", ".", "square", "(", "y_test", "-", "y_pred", ")", ")", ")", "\n", "res", "[", "'mae'", "]", "=", "np", ".", "mean", "(", "np", ".", "abs", "(", "y_test", "-", "y_pred", ")", ")", "\n", "res", "[", "'explained_variance_score'", "]", "=", "1", "-", "np", ".", "square", "(", "np", ".", "std", "(", "y_test", "-", "y_pred", ")", ")", "/", "np", ".", "square", "(", "np", ".", "std", "(", "y_test", ")", ")", "\n", "res", "[", "'r2_score'", "]", "=", "1", "-", "np", ".", "sum", "(", "np", ".", "square", "(", "y_test", "-", "y_pred", ")", ")", "/", "np", ".", "sum", "(", "np", ".", "square", "(", "y_test", "-", "np", ".", "mean", "(", "y_test", ")", ")", ")", "\n", "", "print", "(", "' '", ".", "join", "(", "[", "\"%s: %.4f\"", "%", "(", "i", ",", "res", "[", "i", "]", ")", "for", "i", "in", "res", "]", ")", ")", "\n", "return", "res", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_local.mvm_decision_function": [[203, 211], ["len", "keras.backend.concatenate", "keras.backend.sum", "keras.backend.prod", "range", "keras.backend.stack", "range"], "function", ["None"], ["", "def", "mvm_decision_function", "(", "arg", ")", ":", "\n", "    ", "n_modes", "=", "len", "(", "arg", ")", "\n", "latentx", "=", "arg", "\n", "y", "=", "K", ".", "concatenate", "(", "[", "K", ".", "sum", "(", "\n", "K", ".", "prod", "(", "K", ".", "stack", "(", "[", "latentx", "[", "j", "]", "[", ":", ",", "i", "*", "params", "[", "'n_latent'", "]", ":", "(", "i", "+", "1", ")", "*", "params", "[", "'n_latent'", "]", "]", "for", "j", "in", "range", "(", "n_modes", ")", "]", ")", ",", "\n", "axis", "=", "0", ")", ",", "axis", "=", "-", "1", ",", "keepdims", "=", "True", ")", "for", "i", "in", "range", "(", "params", "[", "'n_classes'", "]", ")", "]", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_local.fm_decision_function": [[213, 219], ["keras.backend.concatenate", "keras.backend.sum", "keras.backend.tf.stack", "keras.backend.sum", "keras.backend.square", "range"], "function", ["None"], ["", "def", "fm_decision_function", "(", "arg", ")", ":", "\n", "    ", "latentx", ",", "bias", "=", "arg", "[", "0", "]", ",", "arg", "[", "1", "]", "\n", "pairwise", "=", "K", ".", "concatenate", "(", "[", "K", ".", "sum", "(", "K", ".", "square", "(", "latentx", "[", ":", ",", "i", "*", "params", "[", "'n_latent'", "]", ":", "(", "i", "+", "1", ")", "*", "params", "[", "'n_latent'", "]", "]", ")", ",", "axis", "=", "-", "1", ",", "keepdims", "=", "True", ")", "for", "i", "in", "range", "(", "params", "[", "'n_classes'", "]", ")", "]", ")", "\n", "y", "=", "K", ".", "sum", "(", "K", ".", "tf", ".", "stack", "(", "[", "pairwise", ",", "bias", "]", ")", ",", "axis", "=", "0", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_local.acc": [[221, 223], ["keras.backend.mean", "keras.backend.equal"], "function", ["None"], ["", "def", "acc", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "return", "K", ".", "mean", "(", "K", ".", "equal", "(", "y_true", ">", "0.5", ",", "y_pred", ">", "0.5", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_local.rmse": [[225, 227], ["keras.backend.sqrt", "keras.backend.mean", "keras.backend.square"], "function", ["None"], ["", "def", "rmse", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "return", "K", ".", "sqrt", "(", "K", ".", "mean", "(", "K", ".", "square", "(", "y_true", "-", "y_pred", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_local.create_model": [[229, 297], ["Model", "Model.compile", "Model.summary", "train_data.keys", "train_data.keys", "merge", "train_data.keys", "merge", "merge", "Dense", "Dense", "merge", "Dense", "Dense", "RMSprop", "Input", "input_list.append", "train_list.append", "test_list.append", "output_list.append", "len", "Activation", "Activation", "Input", "input_list.append", "train_list.append", "test_list.append", "output_list.append", "len", "Activation", "Activation", "Input", "input_list.append", "train_list.append", "test_list.append", "output_list.append", "Activation", "Activation", "Masking", "Bidirectional", "Dropout", "Masking", "Bidirectional", "Dropout", "Masking", "Bidirectional", "Dropout", "Dense", "GRU", "GRU", "GRU"], "function", ["None"], ["", "def", "create_model", "(", "train_data", ",", "test_data", ",", "params", ")", ":", "\n", "    ", "input_list", "=", "[", "]", "\n", "output_list", "=", "[", "]", "\n", "train_list", "=", "[", "]", "\n", "test_list", "=", "[", "]", "\n", "if", "params", "[", "'idx'", "]", "==", "1", ":", "\n", "        ", "for", "mode", "in", "train_data", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "train_list", ".", "append", "(", "train_data", "[", "mode", "]", ")", "\n", "test_list", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "output_list", ".", "append", "(", "drop_output", ")", "\n", "", "", "x", "=", "merge", "(", "output_list", ",", "mode", "=", "'concat'", ")", "if", "len", "(", "output_list", ")", ">", "1", "else", "output_list", "[", "0", "]", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_classes'", "]", "*", "params", "[", "'n_latent'", "]", ",", "activation", "=", "'relu'", ",", "\n", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "x", ")", "\n", "y", "=", "Dense", "(", "params", "[", "'n_classes'", "]", ",", "bias", "=", "False", ")", "(", "latentx", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "2", ":", "\n", "        ", "for", "mode", "in", "train_data", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "train_list", ".", "append", "(", "train_data", "[", "mode", "]", ")", "\n", "test_list", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "output_list", ".", "append", "(", "drop_output", ")", "\n", "", "", "x", "=", "merge", "(", "output_list", ",", "mode", "=", "'concat'", ")", "if", "len", "(", "output_list", ")", ">", "1", "else", "output_list", "[", "0", "]", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_latent'", "]", "*", "params", "[", "'n_classes'", "]", ",", "bias", "=", "False", ")", "(", "x", ")", "\n", "bias", "=", "Dense", "(", "params", "[", "'n_classes'", "]", ",", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "x", ")", "\n", "y", "=", "merge", "(", "[", "latentx", ",", "bias", "]", ",", "mode", "=", "fm_decision_function", ",", "output_shape", "=", "(", "params", "[", "'n_classes'", "]", ",", ")", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "3", ":", "\n", "        ", "for", "mode", "in", "train_data", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "train_list", ".", "append", "(", "train_data", "[", "mode", "]", ")", "\n", "test_list", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_latent'", "]", "*", "params", "[", "'n_classes'", "]", ",", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "\n", "drop_output", ")", "\n", "output_list", ".", "append", "(", "latentx", ")", "\n", "", "", "y", "=", "merge", "(", "output_list", ",", "mode", "=", "mvm_decision_function", ",", "output_shape", "=", "(", "params", "[", "'n_classes'", "]", ",", ")", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "model", "=", "Model", "(", "input", "=", "input_list", ",", "output", "=", "y_act", ")", "\n", "model", ".", "compile", "(", "loss", "=", "objective", ",", "optimizer", "=", "RMSprop", "(", "lr", "=", "params", "[", "'lr'", "]", ")", ",", "metrics", "=", "metric", ")", "\n", "model", ".", "summary", "(", ")", "\n", "return", "model", ",", "train_list", ",", "test_list", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_local.iid": [[298, 316], ["numpy.random.seed", "range", "range", "int", "range", "range", "set", "list", "set", "list", "numpy.random.choice", "list", "numpy.random.choice", "list", "range", "range", "len", "set", "len", "set"], "function", ["None"], ["", "def", "iid", "(", "train_label", ",", "test_label", ",", "params", ")", ":", "\n", "    ", "dict_users", ",", "all_idxs", "=", "{", "}", ",", "[", "i", "for", "i", "in", "range", "(", "len", "(", "train_label", ")", ")", "]", "\n", "np", ".", "random", ".", "seed", "(", "0", ")", "\n", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users", "[", "i", "]", "=", "set", "(", "np", ".", "random", ".", "choice", "(", "all_idxs", ",", "params", "[", "'data'", "]", ",", "replace", "=", "False", ")", ")", "\n", "if", "params", "[", "'data'", "]", "<=", "(", "11968", "/", "params", "[", "'num_users'", "]", ")", ":", "\n", "            ", "all_idxs", "=", "list", "(", "set", "(", "all_idxs", ")", "-", "dict_users", "[", "i", "]", ")", "\n", "", "", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users", "[", "i", "]", "=", "list", "(", "dict_users", "[", "i", "]", ")", "\n", "", "num_items_test", "=", "int", "(", "3003", "*", "params", "[", "'data'", "]", "/", "(", "11968", "/", "params", "[", "'num_users'", "]", ")", "/", "params", "[", "'num_users'", "]", ")", "\n", "dict_users_test", ",", "all_idxs_test", "=", "{", "}", ",", "[", "i", "for", "i", "in", "range", "(", "len", "(", "test_label", ")", ")", "]", "\n", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users_test", "[", "i", "]", "=", "set", "(", "np", ".", "random", ".", "choice", "(", "all_idxs_test", ",", "num_items_test", ",", "replace", "=", "False", ")", ")", "\n", "if", "params", "[", "'data'", "]", "<=", "(", "11968", "/", "params", "[", "'num_users'", "]", ")", ":", "\n", "            ", "all_idxs_test", "=", "list", "(", "set", "(", "all_idxs_test", ")", "-", "dict_users_test", "[", "i", "]", ")", "\n", "", "", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users_test", "[", "i", "]", "=", "list", "(", "dict_users_test", "[", "i", "]", ")", "\n", "", "return", "dict_users", ",", "dict_users_test", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_local.FedAvg": [[317, 347], ["copy.deepcopy", "range", "len", "range", "range", "range", "range", "range", "range", "range", "len", "numpy.zeros", "range", "range", "w_avg.append", "range", "range", "w_avg.append", "len", "range", "len", "len", "range", "len", "numpy.shape", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len"], "function", ["None"], ["", "def", "FedAvg", "(", "w", ",", "params", ")", ":", "\n", "    ", "w_avg", "=", "[", "]", "\n", "c", "=", "{", "}", "\n", "load", "=", "copy", ".", "deepcopy", "(", "w", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "load", ")", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "load", "[", "i", "]", ")", ")", ":", "\n", "            ", "load", "[", "i", "]", "[", "j", "]", "=", "np", ".", "zeros", "(", "shape", "=", "np", ".", "shape", "(", "load", "[", "i", "]", "[", "j", "]", ")", ")", "\n", "", "", "if", "params", "[", "'idx'", "]", "==", "3", ":", "\n", "        ", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "            ", "c", "[", "i", "]", "=", "load", "[", "i", "]", "\n", "", "for", "k", "in", "range", "(", "6", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", ")", ")", ":", "\n", "                ", "for", "j", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", "[", "0", "]", ")", ")", ":", "\n", "                    ", "c", "[", "k", "]", "[", "j", "]", "+=", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", "[", "i", "]", "[", "j", "]", "\n", "", "", "for", "l", "in", "range", "(", "len", "(", "c", "[", "k", "]", ")", ")", ":", "\n", "                ", "c", "[", "k", "]", "[", "l", "]", "=", "c", "[", "k", "]", "[", "l", "]", "*", "6", "/", "len", "(", "w", ")", "\n", "", "", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "            ", "w_avg", ".", "append", "(", "c", "[", "i", "]", ")", "\n", "", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "5", ")", ":", "\n", "            ", "c", "[", "i", "]", "=", "load", "[", "i", "]", "\n", "", "for", "k", "in", "range", "(", "5", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", ")", ")", ":", "\n", "                ", "for", "j", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", "[", "0", "]", ")", ")", ":", "\n", "                    ", "c", "[", "k", "]", "[", "j", "]", "+=", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", "[", "i", "]", "[", "j", "]", "\n", "", "", "for", "l", "in", "range", "(", "len", "(", "c", "[", "k", "]", ")", ")", ":", "\n", "                ", "c", "[", "k", "]", "[", "l", "]", "=", "c", "[", "k", "]", "[", "l", "]", "*", "5", "/", "len", "(", "w", ")", "\n", "", "", "for", "i", "in", "range", "(", "5", ")", ":", "\n", "            ", "w_avg", ".", "append", "(", "c", "[", "i", "]", ")", "\n", "", "", "return", "w_avg", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_local.run_model": [[348, 476], ["Fed_mood_local.create_model", "Fed_mood_local.iid", "range", "range", "numpy.random.choice", "print", "test_label.append", "range", "random.randint", "range", "w_temps.append", "print", "range", "model.predict", "print", "range", "model.predict", "range", "numpy.array", "res.append", "print", "copy.deepcopy", "model.layers[].set_weights", "X_train_fed.append", "X_test_fed.append", "y_train_fed.append", "model.fit", "model.fit", "numpy.ravel", "weight_users[].append", "len", "X_train_fed.append", "X_test_fed.append", "y_train_fed.append", "model.fit", "model.fit", "numpy.ravel", "weight_users[].append", "len", "range", "float", "len", "model.layers[].get_weights", "a.reshape.reshape", "b.reshape.reshape", "copy.deepcopy", "model.layers[].set_weights", "model.layers[].set_weights", "a.reshape.reshape", "b.reshape.reshape", "copy.deepcopy", "len", "np.array.append", "sum", "numpy.concatenate", "numpy.concatenate", "len", "a.reshape.reshape", "b.reshape.reshape", "a.reshape.reshape", "b.reshape.reshape", "model.layers[].get_weights", "numpy.concatenate", "numpy.concatenate", "len", "a.reshape.reshape", "b.reshape.reshape", "a.reshape.reshape", "b.reshape.reshape", "model.layers[].get_weights", "len", "len", "numpy.ravel", "len", "len", "numpy.ravel"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.create_model", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.iid"], ["", "def", "run_model", "(", "train_data", ",", "test_data", ",", "y_train", ",", "y_test", ",", "params", ")", ":", "\n", "    ", "num", "=", "[", "6", ",", "7", ",", "8", ",", "13", ",", "14", "]", "\n", "model", ",", "X_train", ",", "X_test", "=", "create_model", "(", "train_data", ",", "test_data", ",", "params", ")", "\n", "dict_users", ",", "dict_users_test", "=", "iid", "(", "y_train", ",", "y_test", ",", "params", ")", "\n", "w_temps", ",", "res", "=", "[", "]", ",", "[", "]", "\n", "weight_users", ",", "test_label", ",", "predict_label", "=", "{", "}", ",", "[", "]", ",", "{", "}", "\n", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "weight_users", "[", "i", "]", "=", "[", "]", "\n", "predict_label", "[", "i", "]", "=", "[", "]", "\n", "for", "j", "in", "dict_users_test", "[", "i", "]", ":", "\n", "            ", "test_label", ".", "append", "(", "y_test", "[", "j", "]", ")", "\n", "", "", "for", "iter", "in", "range", "(", "params", "[", "'n_epochs'", "]", ")", ":", "\n", "        ", "idxs_users", "=", "np", ".", "random", ".", "choice", "(", "range", "(", "params", "[", "'num_users'", "]", ")", ",", "random", ".", "randint", "(", "1", ",", "params", "[", "'num_users'", "]", ")", ",", "replace", "=", "False", ")", "\n", "print", "(", "'\u7b2c:'", ",", "iter", ",", "'\u8f6e,\u5171'", ",", "idxs_users", ",", "'\u4e2a\u7528\u6237'", ")", "\n", "\n", "if", "iter", "==", "0", ":", "\n", "            ", "for", "i", "in", "num", ":", "\n", "                ", "w_temps", ".", "append", "(", "copy", ".", "deepcopy", "(", "model", ".", "layers", "[", "i", "]", ".", "get_weights", "(", ")", ")", ")", "\n", "", "for", "idx", "in", "idxs_users", ":", "\n", "                ", "print", "(", "'\u7b2c:'", ",", "iter", ",", "'\u8f6e,\u7528\u6237'", ",", "idx", ")", "\n", "j", "=", "0", "\n", "for", "i", "in", "num", ":", "\n", "                    ", "model", ".", "layers", "[", "i", "]", ".", "set_weights", "(", "w_temps", "[", "j", "]", ")", "\n", "j", "+=", "1", "\n", "\n", "", "X_train_fed", ",", "y_train_fed", ",", "X_test_fed", "=", "[", "]", ",", "[", "]", ",", "[", "]", "\n", "for", "k", "in", "range", "(", "3", ")", ":", "\n", "                    ", "a", "=", "X_train", "[", "k", "]", "[", "dict_users", "[", "idx", "]", "[", "0", "]", "]", "\n", "b", "=", "X_test", "[", "k", "]", "[", "dict_users_test", "[", "idx", "]", "[", "0", "]", "]", "\n", "for", "i", "in", "dict_users", "[", "idx", "]", ":", "\n", "                        ", "if", "i", "==", "dict_users", "[", "idx", "]", "[", "0", "]", ":", "\n", "                            ", "continue", "\n", "", "else", ":", "\n", "                            ", "a", "=", "np", ".", "concatenate", "(", "(", "a", ",", "X_train", "[", "k", "]", "[", "i", "]", ")", ")", "\n", "", "", "for", "i", "in", "dict_users_test", "[", "idx", "]", ":", "\n", "                        ", "if", "i", "==", "dict_users_test", "[", "idx", "]", "[", "0", "]", ":", "\n", "                            ", "continue", "\n", "", "else", ":", "\n", "                            ", "b", "=", "np", ".", "concatenate", "(", "(", "b", ",", "X_test", "[", "k", "]", "[", "i", "]", ")", ")", "\n", "", "", "if", "k", "==", "0", ":", "\n", "                        ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "4", ")", "\n", "b", "=", "b", ".", "reshape", "(", "len", "(", "dict_users_test", "[", "0", "]", ")", ",", "100", ",", "4", ")", "\n", "", "elif", "k", "==", "1", ":", "\n", "                        ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "6", ")", "\n", "b", "=", "b", ".", "reshape", "(", "len", "(", "dict_users_test", "[", "0", "]", ")", ",", "100", ",", "6", ")", "\n", "", "else", ":", "\n", "                        ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "3", ")", "\n", "b", "=", "b", ".", "reshape", "(", "len", "(", "dict_users_test", "[", "0", "]", ")", ",", "100", ",", "3", ")", "\n", "", "X_train_fed", ".", "append", "(", "a", ")", "\n", "X_test_fed", ".", "append", "(", "b", ")", "\n", "", "for", "i", "in", "dict_users", "[", "idx", "]", ":", "\n", "                    ", "y_train_fed", ".", "append", "(", "y_train", "[", "i", "]", ")", "\n", "", "if", "params", "[", "'flag'", "]", "==", "0", ":", "\n", "                    ", "hist", "=", "model", ".", "fit", "(", "x", "=", "X_train_fed", ",", "y", "=", "y_train_fed", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "2", ",", "epochs", "=", "1", ",", "validation_split", "=", "0.2", ")", "\n", "", "else", ":", "\n", "                    ", "hist", "=", "model", ".", "fit", "(", "x", "=", "X_train_fed", ",", "y", "=", "y_train_fed", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "2", ",", "epochs", "=", "15", ",", "validation_split", "=", "0.2", ")", "\n", "", "y_score", "=", "model", ".", "predict", "(", "X_test_fed", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "0", ")", "\n", "predict_label", "[", "idx", "]", "=", "(", "np", ".", "ravel", "(", "y_score", ")", ">", "0.5", ")", ".", "astype", "(", "'int32'", ")", "if", "params", "[", "'is_clf'", "]", "else", "np", ".", "ravel", "(", "y_score", ")", "\n", "for", "i", "in", "num", ":", "\n", "                    ", "weight_users", "[", "idx", "]", ".", "append", "(", "copy", ".", "deepcopy", "(", "model", ".", "layers", "[", "i", "]", ".", "get_weights", "(", ")", ")", ")", "\n", "", "", "", "else", ":", "\n", "            ", "for", "idx", "in", "idxs_users", ":", "\n", "                ", "j", "=", "0", "\n", "if", "len", "(", "weight_users", "[", "idx", "]", ")", "==", "0", ":", "\n", "                    ", "for", "i", "in", "num", ":", "\n", "                        ", "model", ".", "layers", "[", "i", "]", ".", "set_weights", "(", "w_temps", "[", "j", "]", ")", "\n", "j", "+=", "1", "\n", "", "", "else", ":", "\n", "                    ", "for", "i", "in", "num", ":", "\n", "                        ", "model", ".", "layers", "[", "i", "]", ".", "set_weights", "(", "weight_users", "[", "idx", "]", "[", "j", "]", ")", "\n", "j", "+=", "1", "\n", "", "", "print", "(", "'\u7b2c:'", ",", "iter", ",", "'\u8f6e,\u7528\u6237'", ",", "idx", ")", "\n", "\n", "X_train_fed", ",", "y_train_fed", ",", "X_test_fed", "=", "[", "]", ",", "[", "]", ",", "[", "]", "\n", "for", "k", "in", "range", "(", "3", ")", ":", "\n", "                    ", "a", "=", "X_train", "[", "k", "]", "[", "dict_users", "[", "idx", "]", "[", "0", "]", "]", "\n", "b", "=", "X_test", "[", "k", "]", "[", "dict_users_test", "[", "idx", "]", "[", "0", "]", "]", "\n", "for", "i", "in", "dict_users", "[", "idx", "]", ":", "\n", "                        ", "if", "i", "==", "dict_users", "[", "idx", "]", "[", "0", "]", ":", "\n", "                            ", "continue", "\n", "", "else", ":", "\n", "                            ", "a", "=", "np", ".", "concatenate", "(", "(", "a", ",", "X_train", "[", "k", "]", "[", "i", "]", ")", ")", "\n", "", "", "for", "i", "in", "dict_users_test", "[", "idx", "]", ":", "\n", "                        ", "if", "i", "==", "dict_users_test", "[", "idx", "]", "[", "0", "]", ":", "\n", "                            ", "continue", "\n", "", "else", ":", "\n", "                            ", "b", "=", "np", ".", "concatenate", "(", "(", "b", ",", "X_test", "[", "k", "]", "[", "i", "]", ")", ")", "\n", "", "", "if", "k", "==", "0", ":", "\n", "                        ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "4", ")", "\n", "b", "=", "b", ".", "reshape", "(", "len", "(", "dict_users_test", "[", "0", "]", ")", ",", "100", ",", "4", ")", "\n", "", "elif", "k", "==", "1", ":", "\n", "                        ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "6", ")", "\n", "b", "=", "b", ".", "reshape", "(", "len", "(", "dict_users_test", "[", "0", "]", ")", ",", "100", ",", "6", ")", "\n", "", "else", ":", "\n", "                        ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "3", ")", "\n", "b", "=", "b", ".", "reshape", "(", "len", "(", "dict_users_test", "[", "0", "]", ")", ",", "100", ",", "3", ")", "\n", "", "X_train_fed", ".", "append", "(", "a", ")", "\n", "X_test_fed", ".", "append", "(", "b", ")", "\n", "", "for", "i", "in", "dict_users", "[", "idx", "]", ":", "\n", "                    ", "y_train_fed", ".", "append", "(", "y_train", "[", "i", "]", ")", "\n", "", "if", "params", "[", "'flag'", "]", "==", "0", ":", "\n", "                    ", "hist", "=", "model", ".", "fit", "(", "x", "=", "X_train_fed", ",", "y", "=", "y_train_fed", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "2", ",", "epochs", "=", "1", ",", "validation_split", "=", "0.2", ")", "\n", "", "else", ":", "\n", "                    ", "hist", "=", "model", ".", "fit", "(", "x", "=", "X_train_fed", ",", "y", "=", "y_train_fed", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "2", ",", "epochs", "=", "15", ",", "validation_split", "=", "0.2", ")", "\n", "", "y_score", "=", "model", ".", "predict", "(", "X_test_fed", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "0", ")", "\n", "predict_label", "[", "idx", "]", "=", "(", "np", ".", "ravel", "(", "y_score", ")", ">", "0.5", ")", ".", "astype", "(", "'int32'", ")", "if", "params", "[", "'is_clf'", "]", "else", "np", ".", "ravel", "(", "y_score", ")", "\n", "weight_users", "[", "idx", "]", "=", "[", "]", "\n", "for", "i", "in", "num", ":", "\n", "                    ", "weight_users", "[", "idx", "]", ".", "append", "(", "copy", ".", "deepcopy", "(", "model", ".", "layers", "[", "i", "]", ".", "get_weights", "(", ")", ")", ")", "\n", "", "", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "                ", "if", "(", "len", "(", "predict_label", "[", "i", "]", ")", ")", "==", "0", ":", "\n", "                    ", "break", "\n", "", "else", ":", "\n", "                    ", "continue", "\n", "", "", "predict_list", "=", "[", "]", "\n", "if", "i", "+", "1", "==", "params", "[", "'num_users'", "]", ":", "\n", "                ", "for", "j", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "                    ", "for", "k", "in", "range", "(", "len", "(", "predict_label", "[", "j", "]", ")", ")", ":", "\n", "                        ", "predict_list", ".", "append", "(", "predict_label", "[", "j", "]", "[", "k", "]", ")", "\n", "", "", "predict_list", "=", "np", ".", "array", "(", "predict_list", ")", "\n", "outcome", "=", "float", "(", "sum", "(", "test_label", "==", "predict_list", ")", ")", "/", "len", "(", "test_label", ")", "\n", "res", ".", "append", "(", "outcome", ")", "\n", "print", "(", "'\u7b2c:'", ",", "iter", ",", "'\u8f6e,test acc:{:.4f}'", ".", "format", "(", "outcome", ")", ")", "\n", "", "", "", "return", "hist", ".", "history", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fed.load_mode_data": [[32, 64], ["pandas.read_pickle", "open", "df[].apply", "df[].apply", "df[].fillna().apply().apply", "df[].apply().apply", "df[].apply", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].fillna().apply", "df[].apply", "numpy.log", "numpy.log", "numpy.log", "numpy.log", "df[].drop", "df[].drop", "df[].fillna", "min", "min", "max"], "function", ["None"], ["def", "load_mode_data", "(", "mode", ",", "subject_id", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "filename", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "mode", ",", "subject_id", ")", "\n", "df", "=", "pd", ".", "read_pickle", "(", "open", "(", "filename", ",", "\"rb\"", ")", ")", "\n", "df", "[", "'timestamp'", "]", "=", "df", "[", "'timestamp'", "]", ".", "dt", ".", "date", "\n", "if", "mode", "==", "'alphanum'", ":", "\n", "        ", "df", "[", "'x'", "]", "=", "df", "[", "'x'", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "2276", ")", "\n", "df", "[", "'y'", "]", "=", "df", "[", "'y'", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "959", ")", "\n", "df", "[", "'dt'", "]", "=", "df", "[", "'dt'", "]", ".", "fillna", "(", "0", ")", ".", "apply", "(", "lambda", "x", ":", "min", "(", "x", ",", "5", ")", ")", ".", "apply", "(", "lambda", "x", ":", "np", ".", "log", "(", "x", "+", "1", ")", "/", "np", ".", "log", "(", "6", ")", ")", "\n", "df", "[", "'dr'", "]", "=", "df", "[", "'dr'", "]", ".", "apply", "(", "lambda", "x", ":", "min", "(", "max", "(", "50", ",", "x", ")", ",", "1000", ")", ")", ".", "apply", "(", "lambda", "x", ":", "np", ".", "log", "(", "x", "-", "49", ")", "/", "np", ".", "log", "(", "951", ")", ")", "\n", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'dt'", ",", "'dr'", "]", "]", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'dt'", ",", "'dr'", "]", "]", ".", "values", "\n", "", "", "", "if", "mode", "==", "'special'", ":", "\n", "        ", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", ".", "drop", "(", "[", "'timestamp'", ",", "'session_number'", "]", ",", "1", ")", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", ".", "drop", "(", "[", "'timestamp'", ",", "'session_number'", "]", ",", "1", ")", ".", "values", "\n", "", "", "", "if", "mode", "==", "'accel'", ":", "\n", "        ", "df", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", "=", "df", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "39.2266", ")", "\n", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "values", "\n", "", "", "", "return", "data", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fed.load_subject_data": [[66, 98], ["os.path.isfile", "pandas.read_pickle", "pandas.read_pickle", "mdata[].keys", "pickle.dump", "pandas.read_pickle", "Fed_mood_fed.load_mode_data", "open", "open", "all", "open", "open", "label.append", "timestamp.append", "numpy.ndarray.tolist", "keras.preprocessing.sequence.pad_sequences", "numpy.transpose", "sdata[].append", "df_date[].iloc[].timestamp.date", "numpy.transpose", "mdata[].keys", "len", "df_date[].iloc[].timestamp.date.strftime"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_mode_data"], ["", "def", "load_subject_data", "(", "modes", ",", "subject_id", ",", "params", ")", ":", "\n", "    ", "level_name", "=", "[", "'session'", ",", "'day'", "]", "\n", "filename", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "level_name", "[", "params", "[", "'level'", "]", "]", ",", "subject_id", ")", "\n", "if", "os", ".", "path", ".", "isfile", "(", "filename", ")", ":", "\n", "        ", "return", "pd", ".", "read_pickle", "(", "open", "(", "filename", ",", "\"rb\"", ")", ")", "\n", "", "mdata", "=", "{", "}", "\n", "sdata", "=", "{", "}", "\n", "for", "mode", "in", "modes", ":", "\n", "        ", "mdata", "[", "mode", "]", "=", "load_mode_data", "(", "mode", ",", "subject_id", ",", "params", ")", "\n", "sdata", "[", "mode", "]", "=", "[", "]", "\n", "", "label", "=", "[", "]", "\n", "timestamp", "=", "[", "]", "\n", "ratingfile", "=", "\"mood\\weekly_ratings_%d.pickle\"", "%", "subject_id", "\n", "df_rating", "=", "pd", ".", "read_pickle", "(", "open", "(", "ratingfile", ",", "\"rb\"", ")", ")", "\n", "datefile", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "modes", "[", "0", "]", ",", "subject_id", ")", "\n", "df_date", "=", "pd", ".", "read_pickle", "(", "open", "(", "datefile", ",", "\"rb\"", ")", ")", "\n", "for", "i", "in", "mdata", "[", "modes", "[", "0", "]", "]", ".", "keys", "(", ")", ":", "\n", "        ", "if", "all", "(", "i", "in", "mdata", "[", "mode", "]", ".", "keys", "(", ")", "and", "len", "(", "mdata", "[", "mode", "]", "[", "i", "]", ")", ">=", "params", "[", "'seq_min_len'", "]", "for", "mode", "in", "modes", ")", ":", "\n", "            ", "for", "mode", "in", "modes", ":", "\n", "                ", "lists", "=", "np", ".", "ndarray", ".", "tolist", "(", "np", ".", "transpose", "(", "mdata", "[", "mode", "]", "[", "i", "]", ")", ")", "\n", "pad_matrix", "=", "pad_sequences", "(", "lists", ",", "maxlen", "=", "params", "[", "'seq_max_len'", "]", ",", "dtype", "=", "'float32'", ")", "\n", "pad_matrix", "=", "np", ".", "transpose", "(", "pad_matrix", ")", "\n", "sdata", "[", "mode", "]", ".", "append", "(", "pad_matrix", ")", "\n", "", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "                ", "rating_date", "=", "df_date", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", ".", "iloc", "[", "0", "]", ".", "timestamp", ".", "date", "(", ")", "\n", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "                ", "rating_date", "=", "i", "\n", "", "ratings", "=", "df_rating", "[", "lambda", "x", ":", "x", ".", "date", "==", "rating_date", ".", "strftime", "(", "'%Y-%m-%d'", ")", "]", ".", "iloc", "[", "0", "]", "\n", "label", ".", "append", "(", "[", "ratings", ".", "sighd_17item", ",", "ratings", ".", "ymrs_total", "]", ")", "\n", "timestamp", ".", "append", "(", "rating_date", ")", "\n", "", "", "pk", ".", "dump", "(", "(", "sdata", ",", "label", ",", "timestamp", ")", ",", "open", "(", "filename", ",", "'wb'", ")", ",", "protocol", "=", "pk", ".", "HIGHEST_PROTOCOL", ")", "\n", "return", "sdata", ",", "label", ",", "timestamp", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fed.convert_label": [[100, 113], ["range", "range", "numpy.array", "len", "len"], "function", ["None"], ["", "def", "convert_label", "(", "labels", ",", "params", ")", ":", "\n", "    ", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "0", "]", "\n", "if", "labels", "[", "i", "]", ">=", "8", ":", "\n", "                ", "labels", "[", "i", "]", "=", "1", "\n", "", "else", ":", "\n", "                ", "labels", "[", "i", "]", "=", "0", "\n", "", "", "return", "labels", "\n", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "1", "]", "\n", "", "return", "np", ".", "array", "(", "labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fed.save_obj": [[115, 118], ["open", "pickle.dump"], "function", ["None"], ["", "", "def", "save_obj", "(", "obj", ",", "name", ")", ":", "\n", "    ", "with", "open", "(", "name", "+", "'.pkl'", ",", "'wb'", ")", "as", "f", ":", "\n", "        ", "pk", ".", "dump", "(", "obj", ",", "f", ",", "pk", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fed.load_obj": [[120, 123], ["open", "pickle.load"], "function", ["None"], ["", "", "def", "load_obj", "(", "name", ")", ":", "\n", "    ", "with", "open", "(", "name", "+", "'.pkl'", ",", "'rb'", ")", "as", "f", ":", "\n", "        ", "return", "pk", ".", "load", "(", "f", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fed.load_data": [[125, 173], ["range", "random.seed", "random.sample", "Fed_mood_fed.save_obj", "Fed_mood_fed.load_obj", "numpy.concatenate", "Fed_mood_fed.convert_label", "numpy.concatenate", "numpy.concatenate", "Fed_mood_fed.load_subject_data", "len", "len", "numpy.concatenate", "numpy.asarray", "numpy.asarray", "range", "len", "range", "range", "len", "len", "int", "int", "numpy.asarray", "a[].append", "len"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.save_obj", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_obj", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.convert_label", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_subject_data"], ["", "", "def", "load_data", "(", "subject_ids", ",", "ratio", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "label", "=", "{", "}", "\n", "timestamp", "=", "{", "}", "\n", "n", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "data", "[", "i", "]", ",", "label", "[", "i", "]", ",", "timestamp", "[", "i", "]", "=", "load_subject_data", "(", "modes", ",", "i", ",", "params", ")", "\n", "m", "=", "len", "(", "label", "[", "i", "]", ")", "\n", "if", "ratio", ">", "0", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "ratio", ")", ")", "\n", "", "else", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "(", "ratio", "+", "1", ")", ")", ",", "m", ")", "\n", "", "for", "mode", "in", "modes", ":", "\n", "            ", "data", "[", "i", "]", "[", "mode", "]", "=", "[", "data", "[", "i", "]", "[", "mode", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "", "label", "[", "i", "]", "=", "[", "label", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "timestamp", "[", "i", "]", "=", "[", "timestamp", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "n", "+=", "len", "(", "idx", ")", "\n", "", "idx", "=", "range", "(", "n", ")", "\n", "random", ".", "seed", "(", "0", ")", "\n", "idx", "=", "random", ".", "sample", "(", "idx", ",", "k", "=", "len", "(", "idx", ")", ")", "\n", "datas", "=", "{", "}", "\n", "for", "mode", "in", "modes", ":", "\n", "        ", "datas", "[", "mode", "]", "=", "np", ".", "concatenate", "(", "[", "np", ".", "asarray", "(", "data", "[", "i", "]", "[", "mode", "]", ")", "for", "i", "in", "subject_ids", "]", ")", "\n", "datas", "[", "mode", "]", "=", "np", ".", "asarray", "(", "[", "datas", "[", "mode", "]", "[", "i", "]", "for", "i", "in", "idx", "]", ")", "\n", "np", ".", "asarray", "(", "data", "[", "i", "]", "[", "mode", "]", ")", "\n", "", "a", "=", "{", "}", "\n", "save_obj", "(", "label", ",", "'tt'", ")", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "a", "[", "i", "]", "=", "label", "[", "i", "]", "[", "0", "]", "\n", "", "for", "i", "in", "subject_ids", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "label", "[", "i", "]", ")", ")", ":", "\n", "            ", "if", "j", "==", "0", ":", "\n", "                ", "continue", "\n", "", "else", ":", "\n", "                ", "a", "[", "i", "]", ".", "append", "(", "label", "[", "i", "]", "[", "j", "]", ")", "\n", "", "", "", "newlabel", "=", "load_obj", "(", "'tt'", ")", "\n", "labels", "=", "np", ".", "concatenate", "(", "[", "label", "[", "i", "]", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "ll", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "labels", "[", "ll", "]", "=", "newlabel", "[", "i", "]", "[", "0", "]", "\n", "ll", "+=", "len", "(", "newlabel", "[", "i", "]", ")", "\n", "", "labels", "=", "[", "labels", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "labels", "=", "convert_label", "(", "labels", ",", "params", ")", "\n", "timestamps", "=", "np", ".", "concatenate", "(", "[", "timestamp", "[", "i", "]", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "timestamps", "=", "[", "timestamps", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "whose", "=", "np", ".", "concatenate", "(", "[", "[", "i", "]", "*", "len", "(", "label", "[", "i", "]", ")", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "whose", "=", "[", "whose", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "return", "datas", ",", "labels", ",", "timestamps", ",", "whose", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fed.split_data": [[175, 185], ["Fed_mood_fed.load_data", "Fed_mood_fed.load_data", "list", "list.remove", "Fed_mood_fed.load_data", "Fed_mood_fed.load_data"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data"], ["", "def", "split_data", "(", "subject_ids", ",", "params", ")", ":", "\n", "    ", "if", "params", "[", "'test_subject'", "]", "==", "-", "1", ":", "\n", "        ", "train_data", ",", "train_label", ",", "_", ",", "_", "=", "load_data", "(", "subject_ids", ",", "0.8", ",", "params", ")", "\n", "test_data", ",", "test_label", ",", "_", ",", "_", "=", "load_data", "(", "subject_ids", ",", "-", "0.2", ",", "params", ")", "\n", "", "else", ":", "\n", "        ", "train_subjects", "=", "list", "(", "subject_ids", ")", "\n", "train_subjects", ".", "remove", "(", "params", "[", "'test_subject'", "]", ")", "\n", "train_data", ",", "train_label", ",", "_", ",", "_", "=", "load_data", "(", "train_subjects", ",", "1", ",", "params", ")", "\n", "test_data", ",", "test_label", ",", "_", ",", "_", "=", "load_data", "(", "[", "params", "[", "'test_subject'", "]", "]", ",", "1", ",", "params", ")", "\n", "", "return", "train_data", ",", "train_label", ",", "test_data", ",", "test_label", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fed.evaluate": [[187, 201], ["print", "numpy.sqrt", "numpy.mean", "float", "len", "float", "float", "numpy.mean", "numpy.abs", "sum", "sum", "sum", "numpy.square", "numpy.square", "numpy.square", "numpy.sum", "numpy.sum", "sum", "sum", "numpy.std", "numpy.std", "numpy.square", "numpy.square", "numpy.mean"], "function", ["None"], ["", "def", "evaluate", "(", "y_test", ",", "y_pred", ",", "params", ")", ":", "\n", "    ", "res", "=", "{", "}", "\n", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "res", "[", "'accuracy'", "]", "=", "float", "(", "sum", "(", "y_test", "==", "y_pred", ")", ")", "/", "len", "(", "y_test", ")", "\n", "res", "[", "'precision'", "]", "=", "float", "(", "sum", "(", "y_test", "&", "y_pred", ")", "+", "1", ")", "/", "(", "sum", "(", "y_pred", ")", "+", "1", ")", "\n", "res", "[", "'recall'", "]", "=", "float", "(", "sum", "(", "y_test", "&", "y_pred", ")", "+", "1", ")", "/", "(", "sum", "(", "y_test", ")", "+", "1", ")", "\n", "res", "[", "'f_score'", "]", "=", "2.0", "*", "res", "[", "'precision'", "]", "*", "res", "[", "'recall'", "]", "/", "(", "res", "[", "'precision'", "]", "+", "res", "[", "'recall'", "]", ")", "\n", "", "else", ":", "\n", "        ", "res", "[", "'rmse'", "]", "=", "np", ".", "sqrt", "(", "np", ".", "mean", "(", "np", ".", "square", "(", "y_test", "-", "y_pred", ")", ")", ")", "\n", "res", "[", "'mae'", "]", "=", "np", ".", "mean", "(", "np", ".", "abs", "(", "y_test", "-", "y_pred", ")", ")", "\n", "res", "[", "'explained_variance_score'", "]", "=", "1", "-", "np", ".", "square", "(", "np", ".", "std", "(", "y_test", "-", "y_pred", ")", ")", "/", "np", ".", "square", "(", "np", ".", "std", "(", "y_test", ")", ")", "\n", "res", "[", "'r2_score'", "]", "=", "1", "-", "np", ".", "sum", "(", "np", ".", "square", "(", "y_test", "-", "y_pred", ")", ")", "/", "np", ".", "sum", "(", "np", ".", "square", "(", "y_test", "-", "np", ".", "mean", "(", "y_test", ")", ")", ")", "\n", "", "print", "(", "' '", ".", "join", "(", "[", "\"%s: %.4f\"", "%", "(", "i", ",", "res", "[", "i", "]", ")", "for", "i", "in", "res", "]", ")", ")", "\n", "return", "res", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fed.mvm_decision_function": [[203, 211], ["len", "keras.backend.concatenate", "keras.backend.sum", "keras.backend.prod", "range", "keras.backend.stack", "range"], "function", ["None"], ["", "def", "mvm_decision_function", "(", "arg", ")", ":", "\n", "    ", "n_modes", "=", "len", "(", "arg", ")", "\n", "latentx", "=", "arg", "\n", "y", "=", "K", ".", "concatenate", "(", "[", "K", ".", "sum", "(", "\n", "K", ".", "prod", "(", "K", ".", "stack", "(", "[", "latentx", "[", "j", "]", "[", ":", ",", "i", "*", "params", "[", "'n_latent'", "]", ":", "(", "i", "+", "1", ")", "*", "params", "[", "'n_latent'", "]", "]", "for", "j", "in", "range", "(", "n_modes", ")", "]", ")", ",", "\n", "axis", "=", "0", ")", ",", "axis", "=", "-", "1", ",", "keepdims", "=", "True", ")", "for", "i", "in", "range", "(", "params", "[", "'n_classes'", "]", ")", "]", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fed.fm_decision_function": [[213, 219], ["keras.backend.concatenate", "keras.backend.sum", "keras.backend.tf.stack", "keras.backend.sum", "keras.backend.square", "range"], "function", ["None"], ["", "def", "fm_decision_function", "(", "arg", ")", ":", "\n", "    ", "latentx", ",", "bias", "=", "arg", "[", "0", "]", ",", "arg", "[", "1", "]", "\n", "pairwise", "=", "K", ".", "concatenate", "(", "[", "K", ".", "sum", "(", "K", ".", "square", "(", "latentx", "[", ":", ",", "i", "*", "params", "[", "'n_latent'", "]", ":", "(", "i", "+", "1", ")", "*", "params", "[", "'n_latent'", "]", "]", ")", ",", "axis", "=", "-", "1", ",", "keepdims", "=", "True", ")", "for", "i", "in", "range", "(", "params", "[", "'n_classes'", "]", ")", "]", ")", "\n", "y", "=", "K", ".", "sum", "(", "K", ".", "tf", ".", "stack", "(", "[", "pairwise", ",", "bias", "]", ")", ",", "axis", "=", "0", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fed.acc": [[221, 223], ["keras.backend.mean", "keras.backend.equal"], "function", ["None"], ["", "def", "acc", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "return", "K", ".", "mean", "(", "K", ".", "equal", "(", "y_true", ">", "0.5", ",", "y_pred", ">", "0.5", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fed.rmse": [[225, 227], ["keras.backend.sqrt", "keras.backend.mean", "keras.backend.square"], "function", ["None"], ["", "def", "rmse", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "return", "K", ".", "sqrt", "(", "K", ".", "mean", "(", "K", ".", "square", "(", "y_true", "-", "y_pred", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fed.create_model": [[229, 297], ["Model", "Model.compile", "Model.summary", "train_data.keys", "train_data.keys", "merge", "train_data.keys", "merge", "merge", "Dense", "Dense", "merge", "Dense", "Dense", "RMSprop", "Input", "input_list.append", "train_list.append", "test_list.append", "output_list.append", "len", "Activation", "Activation", "Input", "input_list.append", "train_list.append", "test_list.append", "output_list.append", "len", "Activation", "Activation", "Input", "input_list.append", "train_list.append", "test_list.append", "output_list.append", "Activation", "Activation", "Masking", "Bidirectional", "Dropout", "Masking", "Bidirectional", "Dropout", "Masking", "Bidirectional", "Dropout", "Dense", "GRU", "GRU", "GRU"], "function", ["None"], ["", "def", "create_model", "(", "train_data", ",", "test_data", ",", "params", ")", ":", "\n", "    ", "input_list", "=", "[", "]", "\n", "output_list", "=", "[", "]", "\n", "train_list", "=", "[", "]", "\n", "test_list", "=", "[", "]", "\n", "if", "params", "[", "'idx'", "]", "==", "1", ":", "\n", "        ", "for", "mode", "in", "train_data", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "train_list", ".", "append", "(", "train_data", "[", "mode", "]", ")", "\n", "test_list", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "output_list", ".", "append", "(", "drop_output", ")", "\n", "", "", "x", "=", "merge", "(", "output_list", ",", "mode", "=", "'concat'", ")", "if", "len", "(", "output_list", ")", ">", "1", "else", "output_list", "[", "0", "]", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_classes'", "]", "*", "params", "[", "'n_latent'", "]", ",", "activation", "=", "'relu'", ",", "\n", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "x", ")", "\n", "y", "=", "Dense", "(", "params", "[", "'n_classes'", "]", ",", "bias", "=", "False", ")", "(", "latentx", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "2", ":", "\n", "        ", "for", "mode", "in", "train_data", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "train_list", ".", "append", "(", "train_data", "[", "mode", "]", ")", "\n", "test_list", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "output_list", ".", "append", "(", "drop_output", ")", "\n", "", "", "x", "=", "merge", "(", "output_list", ",", "mode", "=", "'concat'", ")", "if", "len", "(", "output_list", ")", ">", "1", "else", "output_list", "[", "0", "]", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_latent'", "]", "*", "params", "[", "'n_classes'", "]", ",", "bias", "=", "False", ")", "(", "x", ")", "\n", "bias", "=", "Dense", "(", "params", "[", "'n_classes'", "]", ",", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "x", ")", "\n", "y", "=", "merge", "(", "[", "latentx", ",", "bias", "]", ",", "mode", "=", "fm_decision_function", ",", "output_shape", "=", "(", "params", "[", "'n_classes'", "]", ",", ")", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "3", ":", "\n", "        ", "for", "mode", "in", "train_data", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "train_list", ".", "append", "(", "train_data", "[", "mode", "]", ")", "\n", "test_list", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_latent'", "]", "*", "params", "[", "'n_classes'", "]", ",", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "\n", "drop_output", ")", "\n", "output_list", ".", "append", "(", "latentx", ")", "\n", "", "", "y", "=", "merge", "(", "output_list", ",", "mode", "=", "mvm_decision_function", ",", "output_shape", "=", "(", "params", "[", "'n_classes'", "]", ",", ")", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "model", "=", "Model", "(", "input", "=", "input_list", ",", "output", "=", "y_act", ")", "\n", "model", ".", "compile", "(", "loss", "=", "objective", ",", "optimizer", "=", "RMSprop", "(", "lr", "=", "params", "[", "'lr'", "]", ")", ",", "metrics", "=", "metric", ")", "\n", "model", ".", "summary", "(", ")", "\n", "return", "model", ",", "train_list", ",", "test_list", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fed.iid": [[298, 316], ["numpy.random.seed", "range", "range", "int", "range", "range", "set", "list", "set", "list", "numpy.random.choice", "list", "numpy.random.choice", "list", "range", "range", "len", "set", "len", "set"], "function", ["None"], ["", "def", "iid", "(", "train_label", ",", "test_label", ",", "params", ")", ":", "\n", "    ", "dict_users", ",", "all_idxs", "=", "{", "}", ",", "[", "i", "for", "i", "in", "range", "(", "len", "(", "train_label", ")", ")", "]", "\n", "np", ".", "random", ".", "seed", "(", "0", ")", "\n", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users", "[", "i", "]", "=", "set", "(", "np", ".", "random", ".", "choice", "(", "all_idxs", ",", "params", "[", "'data'", "]", ",", "replace", "=", "False", ")", ")", "\n", "if", "params", "[", "'data'", "]", "<=", "(", "11968", "/", "params", "[", "'num_users'", "]", ")", ":", "\n", "            ", "all_idxs", "=", "list", "(", "set", "(", "all_idxs", ")", "-", "dict_users", "[", "i", "]", ")", "\n", "", "", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users", "[", "i", "]", "=", "list", "(", "dict_users", "[", "i", "]", ")", "\n", "", "num_items_test", "=", "int", "(", "3003", "*", "params", "[", "'data'", "]", "/", "(", "11968", "/", "params", "[", "'num_users'", "]", ")", "/", "params", "[", "'num_users'", "]", ")", "\n", "dict_users_test", ",", "all_idxs_test", "=", "{", "}", ",", "[", "i", "for", "i", "in", "range", "(", "len", "(", "test_label", ")", ")", "]", "\n", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users_test", "[", "i", "]", "=", "set", "(", "np", ".", "random", ".", "choice", "(", "all_idxs_test", ",", "num_items_test", ",", "replace", "=", "False", ")", ")", "\n", "if", "params", "[", "'data'", "]", "<=", "(", "11968", "/", "params", "[", "'num_users'", "]", ")", ":", "\n", "            ", "all_idxs_test", "=", "list", "(", "set", "(", "all_idxs_test", ")", "-", "dict_users_test", "[", "i", "]", ")", "\n", "", "", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users_test", "[", "i", "]", "=", "list", "(", "dict_users_test", "[", "i", "]", ")", "\n", "", "return", "dict_users", ",", "dict_users_test", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fed.FedAvg": [[317, 347], ["copy.deepcopy", "range", "len", "range", "range", "range", "range", "range", "range", "range", "len", "numpy.zeros", "range", "range", "w_avg.append", "range", "range", "w_avg.append", "len", "range", "len", "len", "range", "len", "numpy.shape", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len"], "function", ["None"], ["", "def", "FedAvg", "(", "w", ",", "params", ")", ":", "\n", "    ", "w_avg", "=", "[", "]", "\n", "c", "=", "{", "}", "\n", "load", "=", "copy", ".", "deepcopy", "(", "w", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "load", ")", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "load", "[", "i", "]", ")", ")", ":", "\n", "            ", "load", "[", "i", "]", "[", "j", "]", "=", "np", ".", "zeros", "(", "shape", "=", "np", ".", "shape", "(", "load", "[", "i", "]", "[", "j", "]", ")", ")", "\n", "", "", "if", "params", "[", "'idx'", "]", "==", "3", ":", "\n", "        ", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "            ", "c", "[", "i", "]", "=", "load", "[", "i", "]", "\n", "", "for", "k", "in", "range", "(", "6", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", ")", ")", ":", "\n", "                ", "for", "j", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", "[", "0", "]", ")", ")", ":", "\n", "                    ", "c", "[", "k", "]", "[", "j", "]", "+=", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", "[", "i", "]", "[", "j", "]", "\n", "", "", "for", "l", "in", "range", "(", "len", "(", "c", "[", "k", "]", ")", ")", ":", "\n", "                ", "c", "[", "k", "]", "[", "l", "]", "=", "c", "[", "k", "]", "[", "l", "]", "*", "6", "/", "len", "(", "w", ")", "\n", "", "", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "            ", "w_avg", ".", "append", "(", "c", "[", "i", "]", ")", "\n", "", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "5", ")", ":", "\n", "            ", "c", "[", "i", "]", "=", "load", "[", "i", "]", "\n", "", "for", "k", "in", "range", "(", "5", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", ")", ")", ":", "\n", "                ", "for", "j", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", "[", "0", "]", ")", ")", ":", "\n", "                    ", "c", "[", "k", "]", "[", "j", "]", "+=", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", "[", "i", "]", "[", "j", "]", "\n", "", "", "for", "l", "in", "range", "(", "len", "(", "c", "[", "k", "]", ")", ")", ":", "\n", "                ", "c", "[", "k", "]", "[", "l", "]", "=", "c", "[", "k", "]", "[", "l", "]", "*", "5", "/", "len", "(", "w", ")", "\n", "", "", "for", "i", "in", "range", "(", "5", ")", ":", "\n", "            ", "w_avg", ".", "append", "(", "c", "[", "i", "]", ")", "\n", "", "", "return", "w_avg", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fed.run_model": [[348, 447], ["Fed_mood_fed.create_model", "Fed_mood_fed.iid", "range", "model.evaluate", "res.append", "model.save_weights", "print", "model.predict", "numpy.random.choice", "print", "model.layers[].set_weights", "numpy.ravel", "range", "random.randint", "Fed_mood_fed.FedAvg", "model.evaluate", "res.append", "print", "Fed_mood_fed.FedAvg", "w_temps.append", "print", "range", "model.layers[].set_weights", "w_temps.append", "print", "range", "copy.deepcopy", "model.layers[].set_weights", "X_train_fed.append", "y_train_fed.append", "model.fit", "model.fit", "w_locals.append", "copy.deepcopy", "model.layers[].set_weights", "X_train_fed.append", "y_train_fed.append", "model.fit", "model.fit", "w_locals.append", "numpy.ravel", "model.layers[].get_weights", "a.reshape.reshape", "copy.deepcopy", "model.layers[].get_weights", "a.reshape.reshape", "copy.deepcopy", "numpy.concatenate", "a.reshape.reshape", "a.reshape.reshape", "model.layers[].get_weights", "numpy.concatenate", "a.reshape.reshape", "a.reshape.reshape", "model.layers[].get_weights"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.create_model", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.iid", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.evaluate", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.FedAvg", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.evaluate", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.FedAvg"], ["", "def", "run_model", "(", "train_data", ",", "test_data", ",", "y_train", ",", "y_test", ",", "params", ")", ":", "\n", "    ", "num", "=", "[", "6", ",", "7", ",", "8", ",", "13", ",", "14", "]", "\n", "model", ",", "X_train", ",", "X_test", "=", "create_model", "(", "train_data", ",", "test_data", ",", "params", ")", "\n", "dict_users", ",", "dict_users_test", "=", "iid", "(", "y_train", ",", "y_test", ",", "params", ")", "\n", "w_glob", ",", "res", "=", "[", "]", ",", "[", "]", "\n", "for", "iter", "in", "range", "(", "params", "[", "'n_epochs'", "]", ")", ":", "\n", "        ", "w_locals", ",", "w_temps", "=", "[", "]", ",", "[", "]", "\n", "idxs_users", "=", "np", ".", "random", ".", "choice", "(", "range", "(", "params", "[", "'num_users'", "]", ")", ",", "random", ".", "randint", "(", "1", ",", "params", "[", "'num_users'", "]", ")", ",", "replace", "=", "False", ")", "\n", "print", "(", "'\u7b2c:'", ",", "iter", ",", "'\u8f6e,\u5171'", ",", "idxs_users", ",", "'\u4e2a\u7528\u6237'", ")", "\n", "\n", "if", "iter", "==", "0", ":", "\n", "            ", "for", "i", "in", "num", ":", "\n", "                  ", "w_temps", ".", "append", "(", "copy", ".", "deepcopy", "(", "model", ".", "layers", "[", "i", "]", ".", "get_weights", "(", ")", ")", ")", "\n", "", "for", "idx", "in", "idxs_users", ":", "\n", "                ", "print", "(", "'\u7b2c:'", ",", "iter", ",", "'\u8f6e,\u7528\u6237'", ",", "idx", ")", "\n", "j", "=", "0", "\n", "for", "i", "in", "num", ":", "\n", "                    ", "model", ".", "layers", "[", "i", "]", ".", "set_weights", "(", "w_temps", "[", "j", "]", ")", "\n", "j", "+=", "1", "\n", "\n", "", "X_train_fed", ",", "y_train_fed", "=", "[", "]", ",", "[", "]", "\n", "for", "k", "in", "range", "(", "3", ")", ":", "\n", "                    ", "a", "=", "X_train", "[", "k", "]", "[", "dict_users", "[", "idx", "]", "[", "0", "]", "]", "\n", "for", "i", "in", "dict_users", "[", "idx", "]", ":", "\n", "                        ", "if", "i", "==", "dict_users", "[", "idx", "]", "[", "0", "]", ":", "\n", "                            ", "continue", "\n", "", "else", ":", "\n", "                            ", "a", "=", "np", ".", "concatenate", "(", "(", "a", ",", "X_train", "[", "k", "]", "[", "i", "]", ")", ")", "\n", "", "", "if", "k", "==", "0", ":", "\n", "                        ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "4", ")", "\n", "", "elif", "k", "==", "1", ":", "\n", "                        ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "6", ")", "\n", "", "else", ":", "\n", "                        ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "3", ")", "\n", "", "X_train_fed", ".", "append", "(", "a", ")", "\n", "", "for", "i", "in", "dict_users", "[", "idx", "]", ":", "\n", "                    ", "y_train_fed", ".", "append", "(", "y_train", "[", "i", "]", ")", "\n", "", "if", "params", "[", "'flag'", "]", "==", "0", ":", "\n", "                    ", "hist", "=", "model", ".", "fit", "(", "x", "=", "X_train_fed", ",", "y", "=", "y_train_fed", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "2", ",", "epochs", "=", "20", ",", "validation_split", "=", "0.2", ")", "\n", "", "else", ":", "\n", "                    ", "hist", "=", "model", ".", "fit", "(", "x", "=", "X_train_fed", ",", "y", "=", "y_train_fed", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "2", ",", "epochs", "=", "15", ",", "validation_split", "=", "0.2", ")", "\n", "", "for", "i", "in", "num", ":", "\n", "                    ", "w_locals", ".", "append", "(", "copy", ".", "deepcopy", "(", "model", ".", "layers", "[", "i", "]", ".", "get_weights", "(", ")", ")", ")", "\n", "", "", "w_glob", "=", "FedAvg", "(", "w_locals", ",", "params", ")", "# update global weights", "\n", "", "else", ":", "\n", "            ", "j", "=", "0", "\n", "for", "i", "in", "num", ":", "\n", "                ", "model", ".", "layers", "[", "i", "]", ".", "set_weights", "(", "w_glob", "[", "j", "]", ")", "\n", "j", "+=", "1", "\n", "", "outcome", "=", "model", ".", "evaluate", "(", "X_test", ",", "y_test", ",", "verbose", "=", "0", ")", "\n", "res", ".", "append", "(", "outcome", "[", "1", "]", ")", "\n", "print", "(", "'\u7b2c:'", ",", "iter", ",", "'\u8f6e,test acc:'", ",", "outcome", ")", "\n", "for", "i", "in", "num", ":", "\n", "                ", "w_temps", ".", "append", "(", "copy", ".", "deepcopy", "(", "model", ".", "layers", "[", "i", "]", ".", "get_weights", "(", ")", ")", ")", "\n", "", "for", "idx", "in", "idxs_users", ":", "\n", "                ", "print", "(", "'\u7b2c:'", ",", "iter", ",", "'\u8f6e,\u7528\u6237'", ",", "idx", ")", "\n", "j", "=", "0", "\n", "for", "i", "in", "num", ":", "\n", "                    ", "model", ".", "layers", "[", "i", "]", ".", "set_weights", "(", "w_temps", "[", "j", "]", ")", "\n", "j", "+=", "1", "\n", "", "X_train_fed", ",", "y_train_fed", "=", "[", "]", ",", "[", "]", "\n", "for", "k", "in", "range", "(", "3", ")", ":", "\n", "                    ", "a", "=", "X_train", "[", "k", "]", "[", "dict_users", "[", "idx", "]", "[", "0", "]", "]", "\n", "for", "i", "in", "dict_users", "[", "idx", "]", ":", "\n", "                        ", "if", "i", "==", "dict_users", "[", "idx", "]", "[", "0", "]", ":", "\n", "                            ", "continue", "\n", "", "else", ":", "\n", "                            ", "a", "=", "np", ".", "concatenate", "(", "(", "a", ",", "X_train", "[", "k", "]", "[", "i", "]", ")", ")", "\n", "", "", "if", "k", "==", "0", ":", "\n", "                        ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "4", ")", "\n", "", "elif", "k", "==", "1", ":", "\n", "                        ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "6", ")", "\n", "", "else", ":", "\n", "                        ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "3", ")", "\n", "", "X_train_fed", ".", "append", "(", "a", ")", "\n", "", "for", "i", "in", "dict_users", "[", "idx", "]", ":", "\n", "                    ", "y_train_fed", ".", "append", "(", "y_train", "[", "i", "]", ")", "\n", "", "if", "params", "[", "'flag'", "]", "==", "0", ":", "\n", "                    ", "hist", "=", "model", ".", "fit", "(", "x", "=", "X_train_fed", ",", "y", "=", "y_train_fed", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "2", ",", "epochs", "=", "20", ",", "validation_split", "=", "0.2", ")", "\n", "", "else", ":", "\n", "                    ", "hist", "=", "model", ".", "fit", "(", "x", "=", "X_train_fed", ",", "y", "=", "y_train_fed", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "2", ",", "epochs", "=", "15", ",", "validation_split", "=", "0.2", ")", "\n", "", "for", "i", "in", "num", ":", "\n", "                    ", "w_locals", ".", "append", "(", "copy", ".", "deepcopy", "(", "model", ".", "layers", "[", "i", "]", ".", "get_weights", "(", ")", ")", ")", "\n", "", "", "w_glob", "=", "FedAvg", "(", "w_locals", ",", "params", ")", "# update global weights", "\n", "", "", "j", "=", "0", "\n", "for", "i", "in", "num", ":", "\n", "        ", "model", ".", "layers", "[", "i", "]", ".", "set_weights", "(", "w_glob", "[", "j", "]", ")", "\n", "j", "+=", "1", "\n", "", "outcome", "=", "model", ".", "evaluate", "(", "X_test", ",", "y_test", ",", "verbose", "=", "0", ")", "\n", "res", ".", "append", "(", "outcome", "[", "1", "]", ")", "\n", "model", ".", "save_weights", "(", "'DNN_iid_weights_user%d_data%d_round%d.h5'", "%", "(", "params", "[", "'num_users'", "]", ",", "params", "[", "'data'", "]", ",", "params", "[", "'round'", "]", ")", ")", "\n", "print", "(", "'test acc:'", ",", "outcome", ")", "\n", "y_score", "=", "model", ".", "predict", "(", "X_test", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "0", ")", "\n", "y_pred", "=", "(", "np", ".", "ravel", "(", "y_score", ")", ">", "0.5", ")", ".", "astype", "(", "'int32'", ")", "if", "params", "[", "'is_clf'", "]", "else", "np", ".", "ravel", "(", "y_score", ")", "\n", "return", "y_pred", ",", "hist", ".", "history", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciilnoniid.load_mode_data": [[33, 65], ["pandas.read_pickle", "open", "df[].apply", "df[].apply", "df[].fillna().apply().apply", "df[].apply().apply", "df[].apply", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].fillna().apply", "df[].apply", "numpy.log", "numpy.log", "numpy.log", "numpy.log", "df[].drop", "df[].drop", "df[].fillna", "min", "min", "max"], "function", ["None"], ["def", "load_mode_data", "(", "mode", ",", "subject_id", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "filename", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "mode", ",", "subject_id", ")", "\n", "df", "=", "pd", ".", "read_pickle", "(", "open", "(", "filename", ",", "\"rb\"", ")", ")", "\n", "df", "[", "'timestamp'", "]", "=", "df", "[", "'timestamp'", "]", ".", "dt", ".", "date", "\n", "if", "mode", "==", "'alphanum'", ":", "\n", "        ", "df", "[", "'x'", "]", "=", "df", "[", "'x'", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "2276", ")", "\n", "df", "[", "'y'", "]", "=", "df", "[", "'y'", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "959", ")", "\n", "df", "[", "'dt'", "]", "=", "df", "[", "'dt'", "]", ".", "fillna", "(", "0", ")", ".", "apply", "(", "lambda", "x", ":", "min", "(", "x", ",", "5", ")", ")", ".", "apply", "(", "lambda", "x", ":", "np", ".", "log", "(", "x", "+", "1", ")", "/", "np", ".", "log", "(", "6", ")", ")", "\n", "df", "[", "'dr'", "]", "=", "df", "[", "'dr'", "]", ".", "apply", "(", "lambda", "x", ":", "min", "(", "max", "(", "50", ",", "x", ")", ",", "1000", ")", ")", ".", "apply", "(", "lambda", "x", ":", "np", ".", "log", "(", "x", "-", "49", ")", "/", "np", ".", "log", "(", "951", ")", ")", "\n", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'dt'", ",", "'dr'", "]", "]", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'dt'", ",", "'dr'", "]", "]", ".", "values", "\n", "", "", "", "if", "mode", "==", "'special'", ":", "\n", "        ", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", ".", "drop", "(", "[", "'timestamp'", ",", "'session_number'", "]", ",", "1", ")", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", ".", "drop", "(", "[", "'timestamp'", ",", "'session_number'", "]", ",", "1", ")", ".", "values", "\n", "", "", "", "if", "mode", "==", "'accel'", ":", "\n", "        ", "df", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", "=", "df", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "39.2266", ")", "\n", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "values", "\n", "", "", "", "return", "data", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciilnoniid.load_subject_data": [[67, 99], ["os.path.isfile", "pandas.read_pickle", "pandas.read_pickle", "mdata[].keys", "pickle.dump", "pandas.read_pickle", "Fed_mood_ciilnoniid.load_mode_data", "open", "open", "all", "open", "open", "label.append", "timestamp.append", "numpy.ndarray.tolist", "keras.preprocessing.sequence.pad_sequences", "numpy.transpose", "sdata[].append", "df_date[].iloc[].timestamp.date", "numpy.transpose", "mdata[].keys", "len", "df_date[].iloc[].timestamp.date.strftime"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_mode_data"], ["", "def", "load_subject_data", "(", "modes", ",", "subject_id", ",", "params", ")", ":", "\n", "    ", "level_name", "=", "[", "'session'", ",", "'day'", "]", "\n", "filename", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "level_name", "[", "params", "[", "'level'", "]", "]", ",", "subject_id", ")", "\n", "if", "os", ".", "path", ".", "isfile", "(", "filename", ")", ":", "\n", "        ", "return", "pd", ".", "read_pickle", "(", "open", "(", "filename", ",", "\"rb\"", ")", ")", "\n", "", "mdata", "=", "{", "}", "\n", "sdata", "=", "{", "}", "\n", "for", "mode", "in", "modes", ":", "\n", "        ", "mdata", "[", "mode", "]", "=", "load_mode_data", "(", "mode", ",", "subject_id", ",", "params", ")", "\n", "sdata", "[", "mode", "]", "=", "[", "]", "\n", "", "label", "=", "[", "]", "\n", "timestamp", "=", "[", "]", "\n", "ratingfile", "=", "\"mood\\weekly_ratings_%d.pickle\"", "%", "subject_id", "\n", "df_rating", "=", "pd", ".", "read_pickle", "(", "open", "(", "ratingfile", ",", "\"rb\"", ")", ")", "\n", "datefile", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "modes", "[", "0", "]", ",", "subject_id", ")", "\n", "df_date", "=", "pd", ".", "read_pickle", "(", "open", "(", "datefile", ",", "\"rb\"", ")", ")", "\n", "for", "i", "in", "mdata", "[", "modes", "[", "0", "]", "]", ".", "keys", "(", ")", ":", "\n", "        ", "if", "all", "(", "i", "in", "mdata", "[", "mode", "]", ".", "keys", "(", ")", "and", "len", "(", "mdata", "[", "mode", "]", "[", "i", "]", ")", ">=", "params", "[", "'seq_min_len'", "]", "for", "mode", "in", "modes", ")", ":", "\n", "            ", "for", "mode", "in", "modes", ":", "\n", "                ", "lists", "=", "np", ".", "ndarray", ".", "tolist", "(", "np", ".", "transpose", "(", "mdata", "[", "mode", "]", "[", "i", "]", ")", ")", "\n", "pad_matrix", "=", "pad_sequences", "(", "lists", ",", "maxlen", "=", "params", "[", "'seq_max_len'", "]", ",", "dtype", "=", "'float32'", ")", "\n", "pad_matrix", "=", "np", ".", "transpose", "(", "pad_matrix", ")", "\n", "sdata", "[", "mode", "]", ".", "append", "(", "pad_matrix", ")", "\n", "", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "                ", "rating_date", "=", "df_date", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", ".", "iloc", "[", "0", "]", ".", "timestamp", ".", "date", "(", ")", "\n", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "                ", "rating_date", "=", "i", "\n", "", "ratings", "=", "df_rating", "[", "lambda", "x", ":", "x", ".", "date", "==", "rating_date", ".", "strftime", "(", "'%Y-%m-%d'", ")", "]", ".", "iloc", "[", "0", "]", "\n", "label", ".", "append", "(", "[", "ratings", ".", "sighd_17item", ",", "ratings", ".", "ymrs_total", "]", ")", "\n", "timestamp", ".", "append", "(", "rating_date", ")", "\n", "", "", "pk", ".", "dump", "(", "(", "sdata", ",", "label", ",", "timestamp", ")", ",", "open", "(", "filename", ",", "'wb'", ")", ",", "protocol", "=", "pk", ".", "HIGHEST_PROTOCOL", ")", "\n", "return", "sdata", ",", "label", ",", "timestamp", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciilnoniid.convert_label": [[101, 114], ["range", "range", "numpy.array", "len", "len"], "function", ["None"], ["", "def", "convert_label", "(", "labels", ",", "params", ")", ":", "\n", "    ", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "0", "]", "\n", "if", "labels", "[", "i", "]", ">=", "8", ":", "\n", "                ", "labels", "[", "i", "]", "=", "1", "\n", "", "else", ":", "\n", "                ", "labels", "[", "i", "]", "=", "0", "\n", "", "", "return", "labels", "\n", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "1", "]", "\n", "", "return", "np", ".", "array", "(", "labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciilnoniid.converts_label": [[115, 129], ["range", "numpy.array", "range", "len", "len"], "function", ["None"], ["", "", "def", "converts_label", "(", "labels", ",", "params", ",", "subject_ids", ")", ":", "\n", "    ", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "for", "i", "in", "subject_ids", ":", "\n", "            ", "for", "j", "in", "range", "(", "len", "(", "labels", "[", "i", "]", ")", ")", ":", "\n", "                ", "labels", "[", "i", "]", "[", "j", "]", "=", "labels", "[", "i", "]", "[", "j", "]", "[", "0", "]", "\n", "if", "labels", "[", "i", "]", "[", "j", "]", ">=", "8", ":", "\n", "                    ", "labels", "[", "i", "]", "[", "j", "]", "=", "1", "\n", "", "else", ":", "\n", "                    ", "labels", "[", "i", "]", "[", "j", "]", "=", "0", "\n", "", "", "", "return", "labels", "\n", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "1", "]", "\n", "", "return", "np", ".", "array", "(", "labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciilnoniid.save_obj": [[130, 133], ["open", "pickle.dump"], "function", ["None"], ["", "", "def", "save_obj", "(", "obj", ",", "name", ")", ":", "\n", "    ", "with", "open", "(", "name", "+", "'.pkl'", ",", "'wb'", ")", "as", "f", ":", "\n", "        ", "pk", ".", "dump", "(", "obj", ",", "f", ",", "pk", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciilnoniid.load_obj": [[135, 138], ["open", "pickle.load"], "function", ["None"], ["", "", "def", "load_obj", "(", "name", ")", ":", "\n", "    ", "with", "open", "(", "name", "+", "'.pkl'", ",", "'rb'", ")", "as", "f", ":", "\n", "        ", "return", "pk", ".", "load", "(", "f", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciilnoniid.loads_data": [[140, 188], ["range", "random.seed", "random.sample", "Fed_mood_ciilnoniid.save_obj", "Fed_mood_ciilnoniid.load_obj", "numpy.concatenate", "Fed_mood_ciilnoniid.convert_label", "numpy.concatenate", "numpy.concatenate", "Fed_mood_ciilnoniid.load_subject_data", "len", "len", "numpy.concatenate", "numpy.asarray", "numpy.asarray", "range", "len", "range", "range", "len", "len", "int", "int", "numpy.asarray", "a[].append", "len"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.save_obj", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_obj", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.convert_label", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_subject_data"], ["", "", "def", "loads_data", "(", "subject_ids", ",", "ratio", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "label", "=", "{", "}", "\n", "timestamp", "=", "{", "}", "\n", "n", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "data", "[", "i", "]", ",", "label", "[", "i", "]", ",", "timestamp", "[", "i", "]", "=", "load_subject_data", "(", "modes", ",", "i", ",", "params", ")", "\n", "m", "=", "len", "(", "label", "[", "i", "]", ")", "\n", "if", "ratio", ">", "0", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "ratio", ")", ")", "\n", "", "else", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "(", "ratio", "+", "1", ")", ")", ",", "m", ")", "\n", "", "for", "mode", "in", "modes", ":", "\n", "            ", "data", "[", "i", "]", "[", "mode", "]", "=", "[", "data", "[", "i", "]", "[", "mode", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "", "label", "[", "i", "]", "=", "[", "label", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "timestamp", "[", "i", "]", "=", "[", "timestamp", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "n", "+=", "len", "(", "idx", ")", "\n", "", "idx", "=", "range", "(", "n", ")", "\n", "random", ".", "seed", "(", "0", ")", "\n", "idx", "=", "random", ".", "sample", "(", "idx", ",", "k", "=", "len", "(", "idx", ")", ")", "\n", "datas", "=", "{", "}", "\n", "for", "mode", "in", "modes", ":", "\n", "        ", "datas", "[", "mode", "]", "=", "np", ".", "concatenate", "(", "[", "np", ".", "asarray", "(", "data", "[", "i", "]", "[", "mode", "]", ")", "for", "i", "in", "subject_ids", "]", ")", "\n", "datas", "[", "mode", "]", "=", "np", ".", "asarray", "(", "[", "datas", "[", "mode", "]", "[", "i", "]", "for", "i", "in", "idx", "]", ")", "\n", "np", ".", "asarray", "(", "data", "[", "i", "]", "[", "mode", "]", ")", "\n", "", "a", "=", "{", "}", "\n", "save_obj", "(", "label", ",", "'tt'", ")", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "a", "[", "i", "]", "=", "label", "[", "i", "]", "[", "0", "]", "\n", "", "for", "i", "in", "subject_ids", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "label", "[", "i", "]", ")", ")", ":", "\n", "            ", "if", "j", "==", "0", ":", "\n", "                ", "continue", "\n", "", "else", ":", "\n", "                ", "a", "[", "i", "]", ".", "append", "(", "label", "[", "i", "]", "[", "j", "]", ")", "\n", "", "", "", "newlabel", "=", "load_obj", "(", "'tt'", ")", "\n", "labels", "=", "np", ".", "concatenate", "(", "[", "label", "[", "i", "]", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "ll", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "labels", "[", "ll", "]", "=", "newlabel", "[", "i", "]", "[", "0", "]", "\n", "ll", "+=", "len", "(", "newlabel", "[", "i", "]", ")", "\n", "", "labels", "=", "[", "labels", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "labels", "=", "convert_label", "(", "labels", ",", "params", ")", "\n", "timestamps", "=", "np", ".", "concatenate", "(", "[", "timestamp", "[", "i", "]", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "timestamps", "=", "[", "timestamps", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "whose", "=", "np", ".", "concatenate", "(", "[", "[", "i", "]", "*", "len", "(", "label", "[", "i", "]", ")", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "whose", "=", "[", "whose", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "return", "datas", ",", "labels", ",", "timestamps", ",", "whose", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciilnoniid.load_data": [[189, 225], ["random.seed", "copy.deepcopy", "copy.deepcopy", "Fed_mood_ciilnoniid.converts_label", "Fed_mood_ciilnoniid.load_subject_data", "len", "len", "random.sample", "random.sample", "range", "range", "range", "len", "numpy.concatenate", "range", "len", "int", "int", "len", "numpy.asarray", "len", "numpy.asarray"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.converts_label", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_subject_data"], ["", "def", "load_data", "(", "subject_ids", ",", "ratio", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "label", "=", "{", "}", "\n", "timestamp", "=", "{", "}", "\n", "n", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "data", "[", "i", "]", ",", "label", "[", "i", "]", ",", "timestamp", "[", "i", "]", "=", "load_subject_data", "(", "modes", ",", "i", ",", "params", ")", "\n", "m", "=", "len", "(", "label", "[", "i", "]", ")", "\n", "if", "ratio", ">", "0", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "ratio", ")", ")", "\n", "", "else", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "(", "ratio", "+", "1", ")", ")", ",", "m", ")", "\n", "", "for", "mode", "in", "modes", ":", "\n", "            ", "data", "[", "i", "]", "[", "mode", "]", "=", "[", "data", "[", "i", "]", "[", "mode", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "", "label", "[", "i", "]", "=", "[", "label", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "timestamp", "[", "i", "]", "=", "[", "timestamp", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "n", "+=", "len", "(", "idx", ")", "\n", "", "random", ".", "seed", "(", "0", ")", "\n", "datas", "=", "copy", ".", "deepcopy", "(", "data", ")", "\n", "for", "j", "in", "subject_ids", ":", "\n", "        ", "idx", "=", "random", ".", "sample", "(", "range", "(", "len", "(", "data", "[", "j", "]", "[", "'accel'", "]", ")", ")", ",", "len", "(", "data", "[", "j", "]", "[", "'accel'", "]", ")", ")", "\n", "for", "mode", "in", "modes", ":", "\n", "            ", "k", "=", "0", "\n", "for", "i", "in", "idx", ":", "\n", "                ", "datas", "[", "j", "]", "[", "mode", "]", "[", "k", "]", "=", "np", ".", "asarray", "(", "data", "[", "j", "]", "[", "mode", "]", "[", "i", "]", ")", "\n", "k", "=", "k", "+", "1", "\n", "", "datas", "[", "j", "]", "[", "mode", "]", "=", "np", ".", "concatenate", "(", "[", "np", ".", "asarray", "(", "datas", "[", "j", "]", "[", "mode", "]", ")", "]", ")", "\n", "", "", "labels", "=", "copy", ".", "deepcopy", "(", "label", ")", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "idx", "=", "random", ".", "sample", "(", "range", "(", "len", "(", "label", "[", "i", "]", ")", ")", ",", "len", "(", "label", "[", "i", "]", ")", ")", "\n", "k", "=", "0", "\n", "for", "j", "in", "idx", ":", "\n", "            ", "labels", "[", "i", "]", "[", "k", "]", "=", "label", "[", "i", "]", "[", "j", "]", "\n", "k", "=", "k", "+", "1", "\n", "", "", "labels", "=", "converts_label", "(", "labels", ",", "params", ",", "subject_ids", ")", "\n", "return", "datas", ",", "labels", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciilnoniid.split_data": [[227, 237], ["Fed_mood_ciilnoniid.load_data", "Fed_mood_ciilnoniid.loads_data", "list", "list.remove", "Fed_mood_ciilnoniid.load_data", "Fed_mood_ciilnoniid.load_data"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.loads_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data"], ["", "def", "split_data", "(", "subject_ids", ",", "params", ")", ":", "\n", "    ", "if", "params", "[", "'test_subject'", "]", "==", "-", "1", ":", "\n", "        ", "train_data", ",", "train_label", "=", "load_data", "(", "subject_ids", ",", "0.8", ",", "params", ")", "\n", "test_data", ",", "test_label", ",", "_", ",", "_", "=", "loads_data", "(", "subject_ids", ",", "-", "0.2", ",", "params", ")", "\n", "", "else", ":", "\n", "        ", "train_subjects", "=", "list", "(", "subject_ids", ")", "\n", "train_subjects", ".", "remove", "(", "params", "[", "'test_subject'", "]", ")", "\n", "train_data", ",", "train_label", ",", "_", ",", "_", "=", "load_data", "(", "train_subjects", ",", "1", ",", "params", ")", "\n", "test_data", ",", "test_label", ",", "_", ",", "_", "=", "load_data", "(", "[", "params", "[", "'test_subject'", "]", "]", ",", "1", ",", "params", ")", "\n", "", "return", "train_data", ",", "train_label", ",", "test_data", ",", "test_label", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciilnoniid.evaluate": [[239, 253], ["print", "numpy.sqrt", "numpy.mean", "float", "len", "float", "float", "numpy.mean", "numpy.abs", "sum", "sum", "sum", "numpy.square", "numpy.square", "numpy.square", "numpy.sum", "numpy.sum", "sum", "sum", "numpy.std", "numpy.std", "numpy.square", "numpy.square", "numpy.mean"], "function", ["None"], ["", "def", "evaluate", "(", "y_test", ",", "y_pred", ",", "params", ")", ":", "\n", "    ", "res", "=", "{", "}", "\n", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "res", "[", "'accuracy'", "]", "=", "float", "(", "sum", "(", "y_test", "==", "y_pred", ")", ")", "/", "len", "(", "y_test", ")", "\n", "res", "[", "'precision'", "]", "=", "float", "(", "sum", "(", "y_test", "&", "y_pred", ")", "+", "1", ")", "/", "(", "sum", "(", "y_pred", ")", "+", "1", ")", "\n", "res", "[", "'recall'", "]", "=", "float", "(", "sum", "(", "y_test", "&", "y_pred", ")", "+", "1", ")", "/", "(", "sum", "(", "y_test", ")", "+", "1", ")", "\n", "res", "[", "'f_score'", "]", "=", "2.0", "*", "res", "[", "'precision'", "]", "*", "res", "[", "'recall'", "]", "/", "(", "res", "[", "'precision'", "]", "+", "res", "[", "'recall'", "]", ")", "\n", "", "else", ":", "\n", "        ", "res", "[", "'rmse'", "]", "=", "np", ".", "sqrt", "(", "np", ".", "mean", "(", "np", ".", "square", "(", "y_test", "-", "y_pred", ")", ")", ")", "\n", "res", "[", "'mae'", "]", "=", "np", ".", "mean", "(", "np", ".", "abs", "(", "y_test", "-", "y_pred", ")", ")", "\n", "res", "[", "'explained_variance_score'", "]", "=", "1", "-", "np", ".", "square", "(", "np", ".", "std", "(", "y_test", "-", "y_pred", ")", ")", "/", "np", ".", "square", "(", "np", ".", "std", "(", "y_test", ")", ")", "\n", "res", "[", "'r2_score'", "]", "=", "1", "-", "np", ".", "sum", "(", "np", ".", "square", "(", "y_test", "-", "y_pred", ")", ")", "/", "np", ".", "sum", "(", "np", ".", "square", "(", "y_test", "-", "np", ".", "mean", "(", "y_test", ")", ")", ")", "\n", "", "print", "(", "' '", ".", "join", "(", "[", "\"%s: %.4f\"", "%", "(", "i", ",", "res", "[", "i", "]", ")", "for", "i", "in", "res", "]", ")", ")", "\n", "return", "res", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciilnoniid.mvm_decision_function": [[255, 263], ["len", "keras.backend.concatenate", "keras.backend.sum", "keras.backend.prod", "range", "keras.backend.stack", "range"], "function", ["None"], ["", "def", "mvm_decision_function", "(", "arg", ")", ":", "\n", "    ", "n_modes", "=", "len", "(", "arg", ")", "\n", "latentx", "=", "arg", "\n", "y", "=", "K", ".", "concatenate", "(", "[", "K", ".", "sum", "(", "\n", "K", ".", "prod", "(", "K", ".", "stack", "(", "[", "latentx", "[", "j", "]", "[", ":", ",", "i", "*", "params", "[", "'n_latent'", "]", ":", "(", "i", "+", "1", ")", "*", "params", "[", "'n_latent'", "]", "]", "for", "j", "in", "range", "(", "n_modes", ")", "]", ")", ",", "\n", "axis", "=", "0", ")", ",", "axis", "=", "-", "1", ",", "keepdims", "=", "True", ")", "for", "i", "in", "range", "(", "params", "[", "'n_classes'", "]", ")", "]", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciilnoniid.fm_decision_function": [[265, 271], ["keras.backend.concatenate", "keras.backend.sum", "keras.backend.tf.stack", "keras.backend.sum", "keras.backend.square", "range"], "function", ["None"], ["", "def", "fm_decision_function", "(", "arg", ")", ":", "\n", "    ", "latentx", ",", "bias", "=", "arg", "[", "0", "]", ",", "arg", "[", "1", "]", "\n", "pairwise", "=", "K", ".", "concatenate", "(", "[", "K", ".", "sum", "(", "K", ".", "square", "(", "latentx", "[", ":", ",", "i", "*", "params", "[", "'n_latent'", "]", ":", "(", "i", "+", "1", ")", "*", "params", "[", "'n_latent'", "]", "]", ")", ",", "axis", "=", "-", "1", ",", "keepdims", "=", "True", ")", "for", "i", "in", "range", "(", "params", "[", "'n_classes'", "]", ")", "]", ")", "\n", "y", "=", "K", ".", "sum", "(", "K", ".", "tf", ".", "stack", "(", "[", "pairwise", ",", "bias", "]", ")", ",", "axis", "=", "0", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciilnoniid.acc": [[273, 275], ["keras.backend.mean", "keras.backend.equal"], "function", ["None"], ["", "def", "acc", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "return", "K", ".", "mean", "(", "K", ".", "equal", "(", "y_true", ">", "0.5", ",", "y_pred", ">", "0.5", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciilnoniid.rmse": [[277, 279], ["keras.backend.sqrt", "keras.backend.mean", "keras.backend.square"], "function", ["None"], ["", "def", "rmse", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "return", "K", ".", "sqrt", "(", "K", ".", "mean", "(", "K", ".", "square", "(", "y_true", "-", "y_pred", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciilnoniid.create_model": [[281, 343], ["Model", "Model.compile", "Model.summary", "train_data[].keys", "train_data[].keys", "merge", "train_data[].keys", "merge", "merge", "Dense", "Dense", "merge", "Dense", "Dense", "RMSprop", "Input", "input_list.append", "output_list.append", "len", "Activation", "Activation", "Input", "input_list.append", "output_list.append", "len", "Activation", "Activation", "Input", "input_list.append", "output_list.append", "Activation", "Activation", "Masking", "Bidirectional", "Dropout", "Masking", "Bidirectional", "Dropout", "Masking", "Bidirectional", "Dropout", "Dense", "GRU", "GRU", "GRU"], "function", ["None"], ["", "def", "create_model", "(", "train_data", ",", "test_data", ",", "params", ")", ":", "\n", "    ", "input_list", "=", "[", "]", "\n", "output_list", "=", "[", "]", "\n", "train_list", "=", "[", "]", "\n", "test_list", "=", "[", "]", "\n", "if", "params", "[", "'idx'", "]", "==", "1", ":", "\n", "        ", "for", "mode", "in", "train_data", "[", "7", "]", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "output_list", ".", "append", "(", "drop_output", ")", "\n", "", "", "x", "=", "merge", "(", "output_list", ",", "mode", "=", "'concat'", ")", "if", "len", "(", "output_list", ")", ">", "1", "else", "output_list", "[", "0", "]", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_classes'", "]", "*", "params", "[", "'n_latent'", "]", ",", "activation", "=", "'relu'", ",", "\n", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "x", ")", "\n", "y", "=", "Dense", "(", "params", "[", "'n_classes'", "]", ",", "bias", "=", "False", ")", "(", "latentx", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "2", ":", "\n", "        ", "for", "mode", "in", "train_data", "[", "7", "]", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "output_list", ".", "append", "(", "drop_output", ")", "\n", "", "", "x", "=", "merge", "(", "output_list", ",", "mode", "=", "'concat'", ")", "if", "len", "(", "output_list", ")", ">", "1", "else", "output_list", "[", "0", "]", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_latent'", "]", "*", "params", "[", "'n_classes'", "]", ",", "bias", "=", "False", ")", "(", "x", ")", "\n", "bias", "=", "Dense", "(", "params", "[", "'n_classes'", "]", ",", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "x", ")", "\n", "y", "=", "merge", "(", "[", "latentx", ",", "bias", "]", ",", "mode", "=", "fm_decision_function", ",", "output_shape", "=", "(", "params", "[", "'n_classes'", "]", ",", ")", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "3", ":", "\n", "        ", "for", "mode", "in", "train_data", "[", "7", "]", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_latent'", "]", "*", "params", "[", "'n_classes'", "]", ",", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "\n", "drop_output", ")", "\n", "output_list", ".", "append", "(", "latentx", ")", "\n", "", "", "y", "=", "merge", "(", "output_list", ",", "mode", "=", "mvm_decision_function", ",", "output_shape", "=", "(", "params", "[", "'n_classes'", "]", ",", ")", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "model", "=", "Model", "(", "input", "=", "input_list", ",", "output", "=", "y_act", ")", "\n", "model", ".", "compile", "(", "loss", "=", "objective", ",", "optimizer", "=", "RMSprop", "(", "lr", "=", "params", "[", "'lr'", "]", ")", ",", "metrics", "=", "metric", ")", "\n", "model", ".", "summary", "(", ")", "\n", "return", "model", ",", "train_list", ",", "test_list", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciilnoniid.noniid": [[345, 362], ["numpy.arange", "numpy.asarray", "numpy.vstack", "range", "numpy.array", "set", "list", "range", "range", "numpy.random.choice", "numpy.concatenate", "idxs_labels[].argsort", "set"], "function", ["None"], ["", "def", "noniid", "(", "train_label", ",", "num_users", ")", ":", "\n", "    ", "num_shards", ",", "num_imgs", "=", "8", ",", "1496", "\n", "idx_shard", "=", "[", "i", "for", "i", "in", "range", "(", "num_shards", ")", "]", "\n", "dict_users", "=", "{", "i", ":", "np", ".", "array", "(", "[", "]", ",", "dtype", "=", "'int64'", ")", "for", "i", "in", "range", "(", "num_users", ")", "}", "\n", "idxs", "=", "np", ".", "arange", "(", "num_shards", "*", "num_imgs", ")", "\n", "labels", "=", "np", ".", "asarray", "(", "train_label", ")", "\n", "\n", "idxs_labels", "=", "np", ".", "vstack", "(", "(", "idxs", ",", "labels", ")", ")", "\n", "idxs_labels", "=", "idxs_labels", "[", ":", ",", "idxs_labels", "[", "1", ",", ":", "]", ".", "argsort", "(", ")", "]", "\n", "idxs", "=", "idxs_labels", "[", "0", ",", ":", "]", "\n", "\n", "for", "i", "in", "range", "(", "num_users", ")", ":", "\n", "        ", "rand_set", "=", "set", "(", "np", ".", "random", ".", "choice", "(", "idx_shard", ",", "2", ",", "replace", "=", "False", ")", ")", "\n", "idx_shard", "=", "list", "(", "set", "(", "idx_shard", ")", "-", "rand_set", ")", "\n", "for", "rand", "in", "rand_set", ":", "\n", "            ", "dict_users", "[", "i", "]", "=", "np", ".", "concatenate", "(", "(", "dict_users", "[", "i", "]", ",", "idxs", "[", "rand", "*", "num_imgs", ":", "(", "rand", "+", "1", ")", "*", "num_imgs", "]", ")", ",", "axis", "=", "0", ")", "\n", "", "", "return", "dict_users", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciilnoniid.FedAvg": [[363, 392], ["copy.deepcopy", "range", "range", "len", "range", "len", "range", "range", "range", "range", "range", "range", "len", "numpy.zeros", "range", "w_avg.append", "range", "w_avg.append", "len", "range", "len", "range", "numpy.shape", "len", "len", "len", "len", "len", "len", "len", "len"], "function", ["None"], ["", "def", "FedAvg", "(", "w", ",", "lengthdict", ",", "params", ")", ":", "\n", "    ", "w_avg", "=", "[", "]", "\n", "c", "=", "{", "}", "\n", "load", "=", "copy", ".", "deepcopy", "(", "w", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "load", ")", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "load", "[", "i", "]", ")", ")", ":", "\n", "            ", "load", "[", "i", "]", "[", "j", "]", "=", "np", ".", "zeros", "(", "shape", "=", "np", ".", "shape", "(", "load", "[", "i", "]", "[", "j", "]", ")", ")", "\n", "", "", "sum", "=", "0", "\n", "for", "i", "in", "range", "(", "len", "(", "lengthdict", ")", ")", ":", "\n", "        ", "sum", "+=", "lengthdict", "[", "i", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "3", ":", "\n", "        ", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "            ", "c", "[", "i", "]", "=", "load", "[", "i", "]", "\n", "", "for", "k", "in", "range", "(", "6", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", ")", ")", ":", "\n", "                ", "for", "j", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", "[", "0", "]", ")", ")", ":", "\n", "                    ", "c", "[", "k", "]", "[", "j", "]", "+=", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", "[", "i", "]", "[", "j", "]", "*", "lengthdict", "[", "i", "]", "/", "sum", "\n", "", "", "", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "            ", "w_avg", ".", "append", "(", "c", "[", "i", "]", ")", "\n", "", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "5", ")", ":", "\n", "            ", "c", "[", "i", "]", "=", "load", "[", "i", "]", "\n", "", "for", "k", "in", "range", "(", "5", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", ")", ")", ":", "\n", "                ", "for", "j", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", "[", "0", "]", ")", ")", ":", "\n", "                    ", "c", "[", "k", "]", "[", "j", "]", "+=", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", "[", "i", "]", "[", "j", "]", "*", "lengthdict", "[", "i", "]", "/", "sum", "\n", "", "", "", "for", "i", "in", "range", "(", "5", ")", ":", "\n", "            ", "w_avg", ".", "append", "(", "c", "[", "i", "]", ")", "\n", "", "", "return", "w_avg", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_ciilnoniid.run_model": [[394, 437], ["Fed_mood_ciilnoniid.create_model", "numpy.random.seed", "range", "range", "range", "X_test.append", "range", "range", "model.predict", "Fed_mood_ciilnoniid.evaluate", "numpy.random.choice", "numpy.random.choice", "numpy.concatenate", "X_train_fed[].append", "model.fit", "numpy.ravel", "user.append", "user.append", "user.append", "numpy.asarray", "numpy.ravel"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.create_model", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.evaluate"], ["", "def", "run_model", "(", "train_data", ",", "test_data", ",", "y_train", ",", "y_test", ",", "params", ")", ":", "\n", "    ", "num", "=", "[", "6", ",", "7", ",", "8", ",", "12", ",", "13", ",", "14", "]", "\n", "X_train", ",", "X_test", "=", "{", "}", ",", "[", "]", "\n", "X_train_fed", ",", "y_train_fed", "=", "{", "}", ",", "{", "}", "\n", "model", ",", "_", ",", "_", "=", "create_model", "(", "train_data", ",", "test_data", ",", "params", ")", "\n", "users", "=", "{", "}", "\n", "users", "[", "0", "]", "=", "[", "24", ",", "25", ",", "39", ",", "40", "]", "\n", "users", "[", "1", "]", "=", "[", "7", ",", "15", ",", "19", ",", "20", ",", "21", ",", "27", "]", "\n", "users", "[", "2", "]", "=", "[", "13", ",", "16", ",", "17", ",", "31", ",", "32", ",", "33", ",", "36", ",", "37", ",", "38", "]", "\n", "np", ".", "random", ".", "seed", "(", "params", "[", "'seed'", "]", ")", "\n", "for", "i", "in", "range", "(", "3", ")", ":", "\n", "        ", "if", "i", "==", "2", ":", "\n", "            ", "users", "[", "i", "]", "=", "np", ".", "random", ".", "choice", "(", "users", "[", "i", "]", ",", "8", ",", "replace", "=", "False", ")", "\n", "", "else", ":", "\n", "            ", "users", "[", "i", "]", "=", "np", ".", "random", ".", "choice", "(", "users", "[", "i", "]", ",", "4", ",", "replace", "=", "False", ")", "\n", "", "", "for", "mode", "in", "modes", ":", "\n", "        ", "X_test", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "X_train", "[", "i", "]", ",", "X_train_fed", "[", "i", "]", "=", "{", "}", ",", "[", "]", "\n", "y_train_fed", "[", "i", "]", "=", "[", "]", "\n", "user", "=", "[", "]", "\n", "for", "k", "in", "range", "(", "3", ")", ":", "\n", "            ", "if", "k", "==", "2", ":", "\n", "                ", "b", "=", "i", "*", "2", "\n", "y_train_fed", "[", "i", "]", "+=", "y_train", "[", "users", "[", "k", "]", "[", "b", "]", "]", "\n", "user", ".", "append", "(", "users", "[", "k", "]", "[", "b", "]", ")", "\n", "b", "=", "b", "+", "1", "\n", "y_train_fed", "[", "i", "]", "+=", "y_train", "[", "users", "[", "k", "]", "[", "b", "]", "]", "\n", "user", ".", "append", "(", "users", "[", "k", "]", "[", "b", "]", ")", "\n", "", "else", ":", "\n", "                ", "y_train_fed", "[", "i", "]", "+=", "y_train", "[", "users", "[", "k", "]", "[", "i", "]", "]", "\n", "user", ".", "append", "(", "users", "[", "k", "]", "[", "i", "]", ")", "\n", "", "", "for", "mode", "in", "modes", ":", "\n", "            ", "X_train", "[", "i", "]", "[", "mode", "]", "=", "np", ".", "concatenate", "(", "[", "np", ".", "asarray", "(", "train_data", "[", "j", "]", "[", "mode", "]", ")", "for", "j", "in", "user", "]", ")", "\n", "X_train_fed", "[", "i", "]", ".", "append", "(", "X_train", "[", "i", "]", "[", "mode", "]", ")", "\n", "", "", "for", "k", "in", "range", "(", "params", "[", "'n_epochs'", "]", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "            ", "hist", "=", "model", ".", "fit", "(", "x", "=", "X_train_fed", "[", "j", "]", ",", "y", "=", "y_train_fed", "[", "j", "]", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "2", ",", "epochs", "=", "15", ",", "validation_split", "=", "0.2", ")", "\n", "", "y_score", "=", "model", ".", "predict", "(", "X_test", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "0", ")", "\n", "y_pred", "=", "(", "np", ".", "ravel", "(", "y_score", ")", ">", "0.5", ")", ".", "astype", "(", "'int32'", ")", "if", "params", "[", "'is_clf'", "]", "else", "np", ".", "ravel", "(", "y_score", ")", "\n", "evaluate", "(", "y_test", ",", "y_pred", ",", "params", ")", "\n", "", "return", "y_pred", ",", "hist", ".", "history", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cdsnoniid.load_mode_data": [[33, 65], ["pandas.read_pickle", "open", "df[].apply", "df[].apply", "df[].fillna().apply().apply", "df[].apply().apply", "df[].apply", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].fillna().apply", "df[].apply", "numpy.log", "numpy.log", "numpy.log", "numpy.log", "df[].drop", "df[].drop", "df[].fillna", "min", "min", "max"], "function", ["None"], ["def", "load_mode_data", "(", "mode", ",", "subject_id", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "filename", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "mode", ",", "subject_id", ")", "\n", "df", "=", "pd", ".", "read_pickle", "(", "open", "(", "filename", ",", "\"rb\"", ")", ")", "\n", "df", "[", "'timestamp'", "]", "=", "df", "[", "'timestamp'", "]", ".", "dt", ".", "date", "\n", "if", "mode", "==", "'alphanum'", ":", "\n", "        ", "df", "[", "'x'", "]", "=", "df", "[", "'x'", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "2276", ")", "\n", "df", "[", "'y'", "]", "=", "df", "[", "'y'", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "959", ")", "\n", "df", "[", "'dt'", "]", "=", "df", "[", "'dt'", "]", ".", "fillna", "(", "0", ")", ".", "apply", "(", "lambda", "x", ":", "min", "(", "x", ",", "5", ")", ")", ".", "apply", "(", "lambda", "x", ":", "np", ".", "log", "(", "x", "+", "1", ")", "/", "np", ".", "log", "(", "6", ")", ")", "\n", "df", "[", "'dr'", "]", "=", "df", "[", "'dr'", "]", ".", "apply", "(", "lambda", "x", ":", "min", "(", "max", "(", "50", ",", "x", ")", ",", "1000", ")", ")", ".", "apply", "(", "lambda", "x", ":", "np", ".", "log", "(", "x", "-", "49", ")", "/", "np", ".", "log", "(", "951", ")", ")", "\n", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'dt'", ",", "'dr'", "]", "]", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'dt'", ",", "'dr'", "]", "]", ".", "values", "\n", "", "", "", "if", "mode", "==", "'special'", ":", "\n", "        ", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", ".", "drop", "(", "[", "'timestamp'", ",", "'session_number'", "]", ",", "1", ")", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", ".", "drop", "(", "[", "'timestamp'", ",", "'session_number'", "]", ",", "1", ")", ".", "values", "\n", "", "", "", "if", "mode", "==", "'accel'", ":", "\n", "        ", "df", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", "=", "df", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "39.2266", ")", "\n", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "values", "\n", "", "", "", "return", "data", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cdsnoniid.load_subject_data": [[67, 99], ["os.path.isfile", "pandas.read_pickle", "pandas.read_pickle", "mdata[].keys", "pickle.dump", "pandas.read_pickle", "Fed_mood_cdsnoniid.load_mode_data", "open", "open", "all", "open", "open", "label.append", "timestamp.append", "numpy.ndarray.tolist", "keras.preprocessing.sequence.pad_sequences", "numpy.transpose", "sdata[].append", "df_date[].iloc[].timestamp.date", "numpy.transpose", "mdata[].keys", "len", "df_date[].iloc[].timestamp.date.strftime"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_mode_data"], ["", "def", "load_subject_data", "(", "modes", ",", "subject_id", ",", "params", ")", ":", "\n", "    ", "level_name", "=", "[", "'session'", ",", "'day'", "]", "\n", "filename", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "level_name", "[", "params", "[", "'level'", "]", "]", ",", "subject_id", ")", "\n", "if", "os", ".", "path", ".", "isfile", "(", "filename", ")", ":", "\n", "        ", "return", "pd", ".", "read_pickle", "(", "open", "(", "filename", ",", "\"rb\"", ")", ")", "\n", "", "mdata", "=", "{", "}", "\n", "sdata", "=", "{", "}", "\n", "for", "mode", "in", "modes", ":", "\n", "        ", "mdata", "[", "mode", "]", "=", "load_mode_data", "(", "mode", ",", "subject_id", ",", "params", ")", "\n", "sdata", "[", "mode", "]", "=", "[", "]", "\n", "", "label", "=", "[", "]", "\n", "timestamp", "=", "[", "]", "\n", "ratingfile", "=", "\"mood\\weekly_ratings_%d.pickle\"", "%", "subject_id", "\n", "df_rating", "=", "pd", ".", "read_pickle", "(", "open", "(", "ratingfile", ",", "\"rb\"", ")", ")", "\n", "datefile", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "modes", "[", "0", "]", ",", "subject_id", ")", "\n", "df_date", "=", "pd", ".", "read_pickle", "(", "open", "(", "datefile", ",", "\"rb\"", ")", ")", "\n", "for", "i", "in", "mdata", "[", "modes", "[", "0", "]", "]", ".", "keys", "(", ")", ":", "\n", "        ", "if", "all", "(", "i", "in", "mdata", "[", "mode", "]", ".", "keys", "(", ")", "and", "len", "(", "mdata", "[", "mode", "]", "[", "i", "]", ")", ">=", "params", "[", "'seq_min_len'", "]", "for", "mode", "in", "modes", ")", ":", "\n", "            ", "for", "mode", "in", "modes", ":", "\n", "                ", "lists", "=", "np", ".", "ndarray", ".", "tolist", "(", "np", ".", "transpose", "(", "mdata", "[", "mode", "]", "[", "i", "]", ")", ")", "\n", "pad_matrix", "=", "pad_sequences", "(", "lists", ",", "maxlen", "=", "params", "[", "'seq_max_len'", "]", ",", "dtype", "=", "'float32'", ")", "\n", "pad_matrix", "=", "np", ".", "transpose", "(", "pad_matrix", ")", "\n", "sdata", "[", "mode", "]", ".", "append", "(", "pad_matrix", ")", "\n", "", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "                ", "rating_date", "=", "df_date", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", ".", "iloc", "[", "0", "]", ".", "timestamp", ".", "date", "(", ")", "\n", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "                ", "rating_date", "=", "i", "\n", "", "ratings", "=", "df_rating", "[", "lambda", "x", ":", "x", ".", "date", "==", "rating_date", ".", "strftime", "(", "'%Y-%m-%d'", ")", "]", ".", "iloc", "[", "0", "]", "\n", "label", ".", "append", "(", "[", "ratings", ".", "sighd_17item", ",", "ratings", ".", "ymrs_total", "]", ")", "\n", "timestamp", ".", "append", "(", "rating_date", ")", "\n", "", "", "pk", ".", "dump", "(", "(", "sdata", ",", "label", ",", "timestamp", ")", ",", "open", "(", "filename", ",", "'wb'", ")", ",", "protocol", "=", "pk", ".", "HIGHEST_PROTOCOL", ")", "\n", "return", "sdata", ",", "label", ",", "timestamp", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cdsnoniid.convert_label": [[101, 114], ["range", "range", "numpy.array", "len", "len"], "function", ["None"], ["", "def", "convert_label", "(", "labels", ",", "params", ")", ":", "\n", "    ", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "0", "]", "\n", "if", "labels", "[", "i", "]", ">=", "8", ":", "\n", "                ", "labels", "[", "i", "]", "=", "1", "\n", "", "else", ":", "\n", "                ", "labels", "[", "i", "]", "=", "0", "\n", "", "", "return", "labels", "\n", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "1", "]", "\n", "", "return", "np", ".", "array", "(", "labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cdsnoniid.converts_label": [[115, 129], ["range", "numpy.array", "range", "len", "len"], "function", ["None"], ["", "", "def", "converts_label", "(", "labels", ",", "params", ",", "subject_ids", ")", ":", "\n", "    ", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "for", "i", "in", "subject_ids", ":", "\n", "            ", "for", "j", "in", "range", "(", "len", "(", "labels", "[", "i", "]", ")", ")", ":", "\n", "                ", "labels", "[", "i", "]", "[", "j", "]", "=", "labels", "[", "i", "]", "[", "j", "]", "[", "0", "]", "\n", "if", "labels", "[", "i", "]", "[", "j", "]", ">=", "8", ":", "\n", "                    ", "labels", "[", "i", "]", "[", "j", "]", "=", "1", "\n", "", "else", ":", "\n", "                    ", "labels", "[", "i", "]", "[", "j", "]", "=", "0", "\n", "", "", "", "return", "labels", "\n", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "1", "]", "\n", "", "return", "np", ".", "array", "(", "labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cdsnoniid.save_obj": [[130, 133], ["open", "pickle.dump"], "function", ["None"], ["", "", "def", "save_obj", "(", "obj", ",", "name", ")", ":", "\n", "    ", "with", "open", "(", "name", "+", "'.pkl'", ",", "'wb'", ")", "as", "f", ":", "\n", "        ", "pk", ".", "dump", "(", "obj", ",", "f", ",", "pk", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cdsnoniid.load_obj": [[135, 138], ["open", "pickle.load"], "function", ["None"], ["", "", "def", "load_obj", "(", "name", ")", ":", "\n", "    ", "with", "open", "(", "name", "+", "'.pkl'", ",", "'rb'", ")", "as", "f", ":", "\n", "        ", "return", "pk", ".", "load", "(", "f", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cdsnoniid.loads_data": [[140, 188], ["range", "random.seed", "random.sample", "Fed_mood_cdsnoniid.save_obj", "Fed_mood_cdsnoniid.load_obj", "numpy.concatenate", "Fed_mood_cdsnoniid.convert_label", "numpy.concatenate", "numpy.concatenate", "Fed_mood_cdsnoniid.load_subject_data", "len", "len", "numpy.concatenate", "numpy.asarray", "numpy.asarray", "range", "len", "range", "range", "len", "len", "int", "int", "numpy.asarray", "a[].append", "len"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.save_obj", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_obj", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.convert_label", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_subject_data"], ["", "", "def", "loads_data", "(", "subject_ids", ",", "ratio", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "label", "=", "{", "}", "\n", "timestamp", "=", "{", "}", "\n", "n", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "data", "[", "i", "]", ",", "label", "[", "i", "]", ",", "timestamp", "[", "i", "]", "=", "load_subject_data", "(", "modes", ",", "i", ",", "params", ")", "\n", "m", "=", "len", "(", "label", "[", "i", "]", ")", "\n", "if", "ratio", ">", "0", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "ratio", ")", ")", "\n", "", "else", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "(", "ratio", "+", "1", ")", ")", ",", "m", ")", "\n", "", "for", "mode", "in", "modes", ":", "\n", "            ", "data", "[", "i", "]", "[", "mode", "]", "=", "[", "data", "[", "i", "]", "[", "mode", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "", "label", "[", "i", "]", "=", "[", "label", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "timestamp", "[", "i", "]", "=", "[", "timestamp", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "n", "+=", "len", "(", "idx", ")", "\n", "", "idx", "=", "range", "(", "n", ")", "\n", "random", ".", "seed", "(", "0", ")", "\n", "idx", "=", "random", ".", "sample", "(", "idx", ",", "k", "=", "len", "(", "idx", ")", ")", "\n", "datas", "=", "{", "}", "\n", "for", "mode", "in", "modes", ":", "\n", "        ", "datas", "[", "mode", "]", "=", "np", ".", "concatenate", "(", "[", "np", ".", "asarray", "(", "data", "[", "i", "]", "[", "mode", "]", ")", "for", "i", "in", "subject_ids", "]", ")", "\n", "datas", "[", "mode", "]", "=", "np", ".", "asarray", "(", "[", "datas", "[", "mode", "]", "[", "i", "]", "for", "i", "in", "idx", "]", ")", "\n", "np", ".", "asarray", "(", "data", "[", "i", "]", "[", "mode", "]", ")", "\n", "", "a", "=", "{", "}", "\n", "save_obj", "(", "label", ",", "'tt'", ")", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "a", "[", "i", "]", "=", "label", "[", "i", "]", "[", "0", "]", "\n", "", "for", "i", "in", "subject_ids", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "label", "[", "i", "]", ")", ")", ":", "\n", "            ", "if", "j", "==", "0", ":", "\n", "                ", "continue", "\n", "", "else", ":", "\n", "                ", "a", "[", "i", "]", ".", "append", "(", "label", "[", "i", "]", "[", "j", "]", ")", "\n", "", "", "", "newlabel", "=", "load_obj", "(", "'tt'", ")", "\n", "labels", "=", "np", ".", "concatenate", "(", "[", "label", "[", "i", "]", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "ll", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "labels", "[", "ll", "]", "=", "newlabel", "[", "i", "]", "[", "0", "]", "\n", "ll", "+=", "len", "(", "newlabel", "[", "i", "]", ")", "\n", "", "labels", "=", "[", "labels", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "labels", "=", "convert_label", "(", "labels", ",", "params", ")", "\n", "timestamps", "=", "np", ".", "concatenate", "(", "[", "timestamp", "[", "i", "]", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "timestamps", "=", "[", "timestamps", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "whose", "=", "np", ".", "concatenate", "(", "[", "[", "i", "]", "*", "len", "(", "label", "[", "i", "]", ")", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "whose", "=", "[", "whose", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "return", "datas", ",", "labels", ",", "timestamps", ",", "whose", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cdsnoniid.load_data": [[189, 225], ["random.seed", "copy.deepcopy", "copy.deepcopy", "Fed_mood_cdsnoniid.converts_label", "Fed_mood_cdsnoniid.load_subject_data", "len", "len", "random.sample", "random.sample", "range", "range", "range", "len", "numpy.concatenate", "range", "len", "int", "int", "len", "numpy.asarray", "len", "numpy.asarray"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.converts_label", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_subject_data"], ["", "def", "load_data", "(", "subject_ids", ",", "ratio", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "label", "=", "{", "}", "\n", "timestamp", "=", "{", "}", "\n", "n", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "data", "[", "i", "]", ",", "label", "[", "i", "]", ",", "timestamp", "[", "i", "]", "=", "load_subject_data", "(", "modes", ",", "i", ",", "params", ")", "\n", "m", "=", "len", "(", "label", "[", "i", "]", ")", "\n", "if", "ratio", ">", "0", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "ratio", ")", ")", "\n", "", "else", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "(", "ratio", "+", "1", ")", ")", ",", "m", ")", "\n", "", "for", "mode", "in", "modes", ":", "\n", "            ", "data", "[", "i", "]", "[", "mode", "]", "=", "[", "data", "[", "i", "]", "[", "mode", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "", "label", "[", "i", "]", "=", "[", "label", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "timestamp", "[", "i", "]", "=", "[", "timestamp", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "n", "+=", "len", "(", "idx", ")", "\n", "", "random", ".", "seed", "(", "0", ")", "\n", "datas", "=", "copy", ".", "deepcopy", "(", "data", ")", "\n", "for", "j", "in", "subject_ids", ":", "\n", "        ", "idx", "=", "random", ".", "sample", "(", "range", "(", "len", "(", "data", "[", "j", "]", "[", "'accel'", "]", ")", ")", ",", "len", "(", "data", "[", "j", "]", "[", "'accel'", "]", ")", ")", "\n", "for", "mode", "in", "modes", ":", "\n", "            ", "k", "=", "0", "\n", "for", "i", "in", "idx", ":", "\n", "                ", "datas", "[", "j", "]", "[", "mode", "]", "[", "k", "]", "=", "np", ".", "asarray", "(", "data", "[", "j", "]", "[", "mode", "]", "[", "i", "]", ")", "\n", "k", "=", "k", "+", "1", "\n", "", "datas", "[", "j", "]", "[", "mode", "]", "=", "np", ".", "concatenate", "(", "[", "np", ".", "asarray", "(", "datas", "[", "j", "]", "[", "mode", "]", ")", "]", ")", "\n", "", "", "labels", "=", "copy", ".", "deepcopy", "(", "label", ")", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "idx", "=", "random", ".", "sample", "(", "range", "(", "len", "(", "label", "[", "i", "]", ")", ")", ",", "len", "(", "label", "[", "i", "]", ")", ")", "\n", "k", "=", "0", "\n", "for", "j", "in", "idx", ":", "\n", "            ", "labels", "[", "i", "]", "[", "k", "]", "=", "label", "[", "i", "]", "[", "j", "]", "\n", "k", "=", "k", "+", "1", "\n", "", "", "labels", "=", "converts_label", "(", "labels", ",", "params", ",", "subject_ids", ")", "\n", "return", "datas", ",", "labels", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cdsnoniid.split_data": [[227, 237], ["Fed_mood_cdsnoniid.load_data", "Fed_mood_cdsnoniid.loads_data", "list", "list.remove", "Fed_mood_cdsnoniid.load_data", "Fed_mood_cdsnoniid.load_data"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.loads_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data"], ["", "def", "split_data", "(", "subject_ids", ",", "params", ")", ":", "\n", "    ", "if", "params", "[", "'test_subject'", "]", "==", "-", "1", ":", "\n", "        ", "train_data", ",", "train_label", "=", "load_data", "(", "subject_ids", ",", "0.8", ",", "params", ")", "\n", "test_data", ",", "test_label", ",", "_", ",", "_", "=", "loads_data", "(", "subject_ids", ",", "-", "0.2", ",", "params", ")", "\n", "", "else", ":", "\n", "        ", "train_subjects", "=", "list", "(", "subject_ids", ")", "\n", "train_subjects", ".", "remove", "(", "params", "[", "'test_subject'", "]", ")", "\n", "train_data", ",", "train_label", ",", "_", ",", "_", "=", "load_data", "(", "train_subjects", ",", "1", ",", "params", ")", "\n", "test_data", ",", "test_label", ",", "_", ",", "_", "=", "load_data", "(", "[", "params", "[", "'test_subject'", "]", "]", ",", "1", ",", "params", ")", "\n", "", "return", "train_data", ",", "train_label", ",", "test_data", ",", "test_label", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cdsnoniid.evaluate": [[239, 253], ["print", "numpy.sqrt", "numpy.mean", "float", "len", "float", "float", "numpy.mean", "numpy.abs", "sum", "sum", "sum", "numpy.square", "numpy.square", "numpy.square", "numpy.sum", "numpy.sum", "sum", "sum", "numpy.std", "numpy.std", "numpy.square", "numpy.square", "numpy.mean"], "function", ["None"], ["", "def", "evaluate", "(", "y_test", ",", "y_pred", ",", "params", ")", ":", "\n", "    ", "res", "=", "{", "}", "\n", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "res", "[", "'accuracy'", "]", "=", "float", "(", "sum", "(", "y_test", "==", "y_pred", ")", ")", "/", "len", "(", "y_test", ")", "\n", "res", "[", "'precision'", "]", "=", "float", "(", "sum", "(", "y_test", "&", "y_pred", ")", "+", "1", ")", "/", "(", "sum", "(", "y_pred", ")", "+", "1", ")", "\n", "res", "[", "'recall'", "]", "=", "float", "(", "sum", "(", "y_test", "&", "y_pred", ")", "+", "1", ")", "/", "(", "sum", "(", "y_test", ")", "+", "1", ")", "\n", "res", "[", "'f_score'", "]", "=", "2.0", "*", "res", "[", "'precision'", "]", "*", "res", "[", "'recall'", "]", "/", "(", "res", "[", "'precision'", "]", "+", "res", "[", "'recall'", "]", ")", "\n", "", "else", ":", "\n", "        ", "res", "[", "'rmse'", "]", "=", "np", ".", "sqrt", "(", "np", ".", "mean", "(", "np", ".", "square", "(", "y_test", "-", "y_pred", ")", ")", ")", "\n", "res", "[", "'mae'", "]", "=", "np", ".", "mean", "(", "np", ".", "abs", "(", "y_test", "-", "y_pred", ")", ")", "\n", "res", "[", "'explained_variance_score'", "]", "=", "1", "-", "np", ".", "square", "(", "np", ".", "std", "(", "y_test", "-", "y_pred", ")", ")", "/", "np", ".", "square", "(", "np", ".", "std", "(", "y_test", ")", ")", "\n", "res", "[", "'r2_score'", "]", "=", "1", "-", "np", ".", "sum", "(", "np", ".", "square", "(", "y_test", "-", "y_pred", ")", ")", "/", "np", ".", "sum", "(", "np", ".", "square", "(", "y_test", "-", "np", ".", "mean", "(", "y_test", ")", ")", ")", "\n", "", "print", "(", "' '", ".", "join", "(", "[", "\"%s: %.4f\"", "%", "(", "i", ",", "res", "[", "i", "]", ")", "for", "i", "in", "res", "]", ")", ")", "\n", "return", "res", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cdsnoniid.mvm_decision_function": [[255, 263], ["len", "keras.backend.concatenate", "keras.backend.sum", "keras.backend.prod", "range", "keras.backend.stack", "range"], "function", ["None"], ["", "def", "mvm_decision_function", "(", "arg", ")", ":", "\n", "    ", "n_modes", "=", "len", "(", "arg", ")", "\n", "latentx", "=", "arg", "\n", "y", "=", "K", ".", "concatenate", "(", "[", "K", ".", "sum", "(", "\n", "K", ".", "prod", "(", "K", ".", "stack", "(", "[", "latentx", "[", "j", "]", "[", ":", ",", "i", "*", "params", "[", "'n_latent'", "]", ":", "(", "i", "+", "1", ")", "*", "params", "[", "'n_latent'", "]", "]", "for", "j", "in", "range", "(", "n_modes", ")", "]", ")", ",", "\n", "axis", "=", "0", ")", ",", "axis", "=", "-", "1", ",", "keepdims", "=", "True", ")", "for", "i", "in", "range", "(", "params", "[", "'n_classes'", "]", ")", "]", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cdsnoniid.fm_decision_function": [[265, 271], ["keras.backend.concatenate", "keras.backend.sum", "keras.backend.tf.stack", "keras.backend.sum", "keras.backend.square", "range"], "function", ["None"], ["", "def", "fm_decision_function", "(", "arg", ")", ":", "\n", "    ", "latentx", ",", "bias", "=", "arg", "[", "0", "]", ",", "arg", "[", "1", "]", "\n", "pairwise", "=", "K", ".", "concatenate", "(", "[", "K", ".", "sum", "(", "K", ".", "square", "(", "latentx", "[", ":", ",", "i", "*", "params", "[", "'n_latent'", "]", ":", "(", "i", "+", "1", ")", "*", "params", "[", "'n_latent'", "]", "]", ")", ",", "axis", "=", "-", "1", ",", "keepdims", "=", "True", ")", "for", "i", "in", "range", "(", "params", "[", "'n_classes'", "]", ")", "]", ")", "\n", "y", "=", "K", ".", "sum", "(", "K", ".", "tf", ".", "stack", "(", "[", "pairwise", ",", "bias", "]", ")", ",", "axis", "=", "0", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cdsnoniid.acc": [[273, 275], ["keras.backend.mean", "keras.backend.equal"], "function", ["None"], ["", "def", "acc", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "return", "K", ".", "mean", "(", "K", ".", "equal", "(", "y_true", ">", "0.5", ",", "y_pred", ">", "0.5", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cdsnoniid.rmse": [[277, 279], ["keras.backend.sqrt", "keras.backend.mean", "keras.backend.square"], "function", ["None"], ["", "def", "rmse", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "return", "K", ".", "sqrt", "(", "K", ".", "mean", "(", "K", ".", "square", "(", "y_true", "-", "y_pred", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cdsnoniid.create_model": [[281, 343], ["Model", "Model.compile", "Model.summary", "train_data[].keys", "train_data[].keys", "merge", "train_data[].keys", "merge", "merge", "Dense", "Dense", "merge", "Dense", "Dense", "RMSprop", "Input", "input_list.append", "output_list.append", "len", "Activation", "Activation", "Input", "input_list.append", "output_list.append", "len", "Activation", "Activation", "Input", "input_list.append", "output_list.append", "Activation", "Activation", "Masking", "Bidirectional", "Dropout", "Masking", "Bidirectional", "Dropout", "Masking", "Bidirectional", "Dropout", "Dense", "GRU", "GRU", "GRU"], "function", ["None"], ["", "def", "create_model", "(", "train_data", ",", "test_data", ",", "params", ")", ":", "\n", "    ", "input_list", "=", "[", "]", "\n", "output_list", "=", "[", "]", "\n", "train_list", "=", "[", "]", "\n", "test_list", "=", "[", "]", "\n", "if", "params", "[", "'idx'", "]", "==", "1", ":", "\n", "        ", "for", "mode", "in", "train_data", "[", "7", "]", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "output_list", ".", "append", "(", "drop_output", ")", "\n", "", "", "x", "=", "merge", "(", "output_list", ",", "mode", "=", "'concat'", ")", "if", "len", "(", "output_list", ")", ">", "1", "else", "output_list", "[", "0", "]", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_classes'", "]", "*", "params", "[", "'n_latent'", "]", ",", "activation", "=", "'relu'", ",", "\n", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "x", ")", "\n", "y", "=", "Dense", "(", "params", "[", "'n_classes'", "]", ",", "bias", "=", "False", ")", "(", "latentx", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "2", ":", "\n", "        ", "for", "mode", "in", "train_data", "[", "7", "]", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "output_list", ".", "append", "(", "drop_output", ")", "\n", "", "", "x", "=", "merge", "(", "output_list", ",", "mode", "=", "'concat'", ")", "if", "len", "(", "output_list", ")", ">", "1", "else", "output_list", "[", "0", "]", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_latent'", "]", "*", "params", "[", "'n_classes'", "]", ",", "bias", "=", "False", ")", "(", "x", ")", "\n", "bias", "=", "Dense", "(", "params", "[", "'n_classes'", "]", ",", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "x", ")", "\n", "y", "=", "merge", "(", "[", "latentx", ",", "bias", "]", ",", "mode", "=", "fm_decision_function", ",", "output_shape", "=", "(", "params", "[", "'n_classes'", "]", ",", ")", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "3", ":", "\n", "        ", "for", "mode", "in", "train_data", "[", "7", "]", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_latent'", "]", "*", "params", "[", "'n_classes'", "]", ",", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "\n", "drop_output", ")", "\n", "output_list", ".", "append", "(", "latentx", ")", "\n", "", "", "y", "=", "merge", "(", "output_list", ",", "mode", "=", "mvm_decision_function", ",", "output_shape", "=", "(", "params", "[", "'n_classes'", "]", ",", ")", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "model", "=", "Model", "(", "input", "=", "input_list", ",", "output", "=", "y_act", ")", "\n", "model", ".", "compile", "(", "loss", "=", "objective", ",", "optimizer", "=", "RMSprop", "(", "lr", "=", "params", "[", "'lr'", "]", ")", ",", "metrics", "=", "metric", ")", "\n", "model", ".", "summary", "(", ")", "\n", "return", "model", ",", "train_list", ",", "test_list", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cdsnoniid.noniid": [[345, 364], ["numpy.arange", "numpy.asarray", "numpy.vstack", "range", "numpy.array", "set", "list", "range", "range", "numpy.random.choice", "numpy.concatenate", "idxs_labels[].argsort", "set"], "function", ["None"], ["", "def", "noniid", "(", "train_label", ",", "num_users", ")", ":", "\n", "    ", "num_shards", ",", "num_imgs", "=", "8", ",", "1496", "\n", "idx_shard", "=", "[", "i", "for", "i", "in", "range", "(", "num_shards", ")", "]", "\n", "dict_users", "=", "{", "i", ":", "np", ".", "array", "(", "[", "]", ",", "dtype", "=", "'int64'", ")", "for", "i", "in", "range", "(", "num_users", ")", "}", "\n", "idxs", "=", "np", ".", "arange", "(", "num_shards", "*", "num_imgs", ")", "\n", "labels", "=", "np", ".", "asarray", "(", "train_label", ")", "\n", "\n", "# sort labels", "\n", "idxs_labels", "=", "np", ".", "vstack", "(", "(", "idxs", ",", "labels", ")", ")", "\n", "idxs_labels", "=", "idxs_labels", "[", ":", ",", "idxs_labels", "[", "1", ",", ":", "]", ".", "argsort", "(", ")", "]", "\n", "idxs", "=", "idxs_labels", "[", "0", ",", ":", "]", "\n", "\n", "# divide and assign", "\n", "for", "i", "in", "range", "(", "num_users", ")", ":", "\n", "        ", "rand_set", "=", "set", "(", "np", ".", "random", ".", "choice", "(", "idx_shard", ",", "2", ",", "replace", "=", "False", ")", ")", "\n", "idx_shard", "=", "list", "(", "set", "(", "idx_shard", ")", "-", "rand_set", ")", "\n", "for", "rand", "in", "rand_set", ":", "\n", "            ", "dict_users", "[", "i", "]", "=", "np", ".", "concatenate", "(", "(", "dict_users", "[", "i", "]", ",", "idxs", "[", "rand", "*", "num_imgs", ":", "(", "rand", "+", "1", ")", "*", "num_imgs", "]", ")", ",", "axis", "=", "0", ")", "\n", "", "", "return", "dict_users", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cdsnoniid.FedAvg": [[365, 394], ["copy.deepcopy", "range", "range", "len", "range", "len", "range", "range", "range", "range", "range", "range", "len", "numpy.zeros", "range", "w_avg.append", "range", "w_avg.append", "len", "range", "len", "range", "numpy.shape", "len", "len", "len", "len", "len", "len", "len", "len"], "function", ["None"], ["", "def", "FedAvg", "(", "w", ",", "lengthdict", ",", "params", ")", ":", "\n", "    ", "w_avg", "=", "[", "]", "\n", "c", "=", "{", "}", "\n", "load", "=", "copy", ".", "deepcopy", "(", "w", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "load", ")", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "load", "[", "i", "]", ")", ")", ":", "\n", "            ", "load", "[", "i", "]", "[", "j", "]", "=", "np", ".", "zeros", "(", "shape", "=", "np", ".", "shape", "(", "load", "[", "i", "]", "[", "j", "]", ")", ")", "\n", "", "", "sum", "=", "0", "\n", "for", "i", "in", "range", "(", "len", "(", "lengthdict", ")", ")", ":", "\n", "        ", "sum", "+=", "lengthdict", "[", "i", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "3", ":", "\n", "        ", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "            ", "c", "[", "i", "]", "=", "load", "[", "i", "]", "\n", "", "for", "k", "in", "range", "(", "6", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", ")", ")", ":", "\n", "                ", "for", "j", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", "[", "0", "]", ")", ")", ":", "\n", "                    ", "c", "[", "k", "]", "[", "j", "]", "+=", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", "[", "i", "]", "[", "j", "]", "*", "lengthdict", "[", "i", "]", "/", "sum", "\n", "", "", "", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "            ", "w_avg", ".", "append", "(", "c", "[", "i", "]", ")", "\n", "", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "5", ")", ":", "\n", "            ", "c", "[", "i", "]", "=", "load", "[", "i", "]", "\n", "", "for", "k", "in", "range", "(", "5", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", ")", ")", ":", "\n", "                ", "for", "j", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", "[", "0", "]", ")", ")", ":", "\n", "                    ", "c", "[", "k", "]", "[", "j", "]", "+=", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", "[", "i", "]", "[", "j", "]", "*", "lengthdict", "[", "i", "]", "/", "sum", "\n", "", "", "", "for", "i", "in", "range", "(", "5", ")", ":", "\n", "            ", "w_avg", ".", "append", "(", "c", "[", "i", "]", ")", "\n", "", "", "return", "w_avg", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cdsnoniid.run_model": [[396, 451], ["Fed_mood_cdsnoniid.create_model", "numpy.random.seed", "range", "range", "numpy.random.seed", "range", "model.fit", "model.predict", "Fed_mood_cdsnoniid.evaluate", "X_test.append", "range", "numpy.ravel", "numpy.random.choice", "numpy.random.choice", "numpy.concatenate", "X_train_fed[].append", "range", "user.append", "user.append", "user.append", "numpy.concatenate", "numpy.asarray", "numpy.ravel"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.create_model", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.evaluate"], ["", "def", "run_model", "(", "train_data", ",", "test_data", ",", "y_train", ",", "y_test", ",", "params", ")", ":", "\n", "    ", "num", "=", "[", "6", ",", "7", ",", "8", ",", "12", ",", "13", ",", "14", "]", "\n", "X_train", ",", "X_test", "=", "{", "}", ",", "[", "]", "\n", "X_train_fed", ",", "y_train_fed", "=", "{", "}", ",", "{", "}", "\n", "model", ",", "_", ",", "_", "=", "create_model", "(", "train_data", ",", "test_data", ",", "params", ")", "\n", "users", "=", "{", "}", "\n", "users", "[", "0", "]", "=", "[", "24", ",", "25", ",", "39", ",", "40", "]", "\n", "users", "[", "1", "]", "=", "[", "7", ",", "15", ",", "19", ",", "20", ",", "21", ",", "27", "]", "\n", "users", "[", "2", "]", "=", "[", "13", ",", "16", ",", "17", ",", "31", ",", "32", ",", "33", ",", "36", ",", "37", ",", "38", "]", "\n", "np", ".", "random", ".", "seed", "(", "params", "[", "'seed'", "]", ")", "\n", "for", "i", "in", "range", "(", "3", ")", ":", "\n", "        ", "if", "i", "==", "2", ":", "\n", "            ", "users", "[", "i", "]", "=", "np", ".", "random", ".", "choice", "(", "users", "[", "i", "]", ",", "8", ",", "replace", "=", "False", ")", "\n", "", "else", ":", "\n", "            ", "users", "[", "i", "]", "=", "np", ".", "random", ".", "choice", "(", "users", "[", "i", "]", ",", "4", ",", "replace", "=", "False", ")", "\n", "", "", "for", "mode", "in", "modes", ":", "\n", "        ", "X_test", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "X_train", "[", "i", "]", ",", "X_train_fed", "[", "i", "]", "=", "{", "}", ",", "[", "]", "\n", "y_train_fed", "[", "i", "]", "=", "[", "]", "\n", "user", "=", "[", "]", "\n", "for", "k", "in", "range", "(", "3", ")", ":", "\n", "            ", "if", "k", "==", "2", ":", "\n", "                ", "b", "=", "i", "*", "2", "\n", "y_train_fed", "[", "i", "]", "+=", "y_train", "[", "users", "[", "k", "]", "[", "b", "]", "]", "\n", "user", ".", "append", "(", "users", "[", "k", "]", "[", "b", "]", ")", "\n", "b", "=", "b", "+", "1", "\n", "y_train_fed", "[", "i", "]", "+=", "y_train", "[", "users", "[", "k", "]", "[", "b", "]", "]", "\n", "user", ".", "append", "(", "users", "[", "k", "]", "[", "b", "]", ")", "\n", "", "else", ":", "\n", "                ", "y_train_fed", "[", "i", "]", "+=", "y_train", "[", "users", "[", "k", "]", "[", "i", "]", "]", "\n", "user", ".", "append", "(", "users", "[", "k", "]", "[", "i", "]", ")", "\n", "", "", "for", "mode", "in", "modes", ":", "\n", "            ", "X_train", "[", "i", "]", "[", "mode", "]", "=", "np", ".", "concatenate", "(", "[", "np", ".", "asarray", "(", "train_data", "[", "j", "]", "[", "mode", "]", ")", "for", "j", "in", "user", "]", ")", "\n", "X_train_fed", "[", "i", "]", ".", "append", "(", "X_train", "[", "i", "]", "[", "mode", "]", ")", "\n", "", "", "np", ".", "random", ".", "seed", "(", "0", ")", "\n", "w_glob", ",", "res", "=", "[", "]", ",", "[", "]", "\n", "X_train_merge", "=", "[", "]", "\n", "y_train_merge", "=", "[", "]", "\n", "\n", "for", "k", "in", "range", "(", "4", ")", ":", "\n", "        ", "if", "k", "==", "0", ":", "\n", "            ", "a", "=", "X_train_fed", "[", "k", "]", "\n", "b", "=", "y_train_fed", "[", "k", "]", "\n", "", "else", ":", "\n", "            ", "b", "+=", "y_train_fed", "[", "k", "]", "\n", "for", "i", "in", "range", "(", "3", ")", ":", "\n", "                ", "a", "[", "i", "]", "=", "np", ".", "concatenate", "(", "(", "a", "[", "i", "]", ",", "X_train_fed", "[", "k", "]", "[", "i", "]", ")", ")", "\n", "", "", "", "hist", "=", "model", ".", "fit", "(", "a", ",", "b", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "2", ",", "nb_epoch", "=", "params", "[", "'n_epochs'", "]", ",", "\n", "validation_data", "=", "(", "X_test", ",", "y_test", ")", ")", "\n", "y_score", "=", "model", ".", "predict", "(", "X_test", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "0", ")", "\n", "y_pred", "=", "(", "np", ".", "ravel", "(", "y_score", ")", ">", "0.5", ")", ".", "astype", "(", "'int32'", ")", "if", "params", "[", "'is_clf'", "]", "else", "np", ".", "ravel", "(", "y_score", ")", "\n", "evaluate", "(", "y_test", ",", "y_pred", ",", "params", ")", "\n", "return", "y_pred", ",", "hist", ".", "history", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.load_mode_data": [[32, 64], ["pandas.read_pickle", "open", "df[].apply", "df[].apply", "df[].fillna().apply().apply", "df[].apply().apply", "df[].apply", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].fillna().apply", "df[].apply", "numpy.log", "numpy.log", "numpy.log", "numpy.log", "df[].drop", "df[].drop", "df[].fillna", "min", "min", "max"], "function", ["None"], ["def", "load_mode_data", "(", "mode", ",", "subject_id", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "filename", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "mode", ",", "subject_id", ")", "\n", "df", "=", "pd", ".", "read_pickle", "(", "open", "(", "filename", ",", "\"rb\"", ")", ")", "\n", "df", "[", "'timestamp'", "]", "=", "df", "[", "'timestamp'", "]", ".", "dt", ".", "date", "\n", "if", "mode", "==", "'alphanum'", ":", "\n", "        ", "df", "[", "'x'", "]", "=", "df", "[", "'x'", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "2276", ")", "\n", "df", "[", "'y'", "]", "=", "df", "[", "'y'", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "959", ")", "\n", "df", "[", "'dt'", "]", "=", "df", "[", "'dt'", "]", ".", "fillna", "(", "0", ")", ".", "apply", "(", "lambda", "x", ":", "min", "(", "x", ",", "5", ")", ")", ".", "apply", "(", "lambda", "x", ":", "np", ".", "log", "(", "x", "+", "1", ")", "/", "np", ".", "log", "(", "6", ")", ")", "\n", "df", "[", "'dr'", "]", "=", "df", "[", "'dr'", "]", ".", "apply", "(", "lambda", "x", ":", "min", "(", "max", "(", "50", ",", "x", ")", ",", "1000", ")", ")", ".", "apply", "(", "lambda", "x", ":", "np", ".", "log", "(", "x", "-", "49", ")", "/", "np", ".", "log", "(", "951", ")", ")", "\n", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'dt'", ",", "'dr'", "]", "]", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'dt'", ",", "'dr'", "]", "]", ".", "values", "\n", "", "", "", "if", "mode", "==", "'special'", ":", "\n", "        ", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", ".", "drop", "(", "[", "'timestamp'", ",", "'session_number'", "]", ",", "1", ")", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", ".", "drop", "(", "[", "'timestamp'", ",", "'session_number'", "]", ",", "1", ")", ".", "values", "\n", "", "", "", "if", "mode", "==", "'accel'", ":", "\n", "        ", "df", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", "=", "df", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "39.2266", ")", "\n", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "values", "\n", "", "", "", "return", "data", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.load_subject_data": [[66, 98], ["os.path.isfile", "pandas.read_pickle", "pandas.read_pickle", "mdata[].keys", "pickle.dump", "pandas.read_pickle", "Fed_mood_cds.load_mode_data", "open", "open", "all", "open", "open", "label.append", "timestamp.append", "numpy.ndarray.tolist", "keras.preprocessing.sequence.pad_sequences", "numpy.transpose", "sdata[].append", "df_date[].iloc[].timestamp.date", "numpy.transpose", "mdata[].keys", "len", "df_date[].iloc[].timestamp.date.strftime"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_mode_data"], ["", "def", "load_subject_data", "(", "modes", ",", "subject_id", ",", "params", ")", ":", "\n", "    ", "level_name", "=", "[", "'session'", ",", "'day'", "]", "\n", "filename", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "level_name", "[", "params", "[", "'level'", "]", "]", ",", "subject_id", ")", "\n", "if", "os", ".", "path", ".", "isfile", "(", "filename", ")", ":", "\n", "        ", "return", "pd", ".", "read_pickle", "(", "open", "(", "filename", ",", "\"rb\"", ")", ")", "\n", "", "mdata", "=", "{", "}", "\n", "sdata", "=", "{", "}", "\n", "for", "mode", "in", "modes", ":", "\n", "        ", "mdata", "[", "mode", "]", "=", "load_mode_data", "(", "mode", ",", "subject_id", ",", "params", ")", "\n", "sdata", "[", "mode", "]", "=", "[", "]", "\n", "", "label", "=", "[", "]", "\n", "timestamp", "=", "[", "]", "\n", "ratingfile", "=", "\"mood\\weekly_ratings_%d.pickle\"", "%", "subject_id", "\n", "df_rating", "=", "pd", ".", "read_pickle", "(", "open", "(", "ratingfile", ",", "\"rb\"", ")", ")", "\n", "datefile", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "modes", "[", "0", "]", ",", "subject_id", ")", "\n", "df_date", "=", "pd", ".", "read_pickle", "(", "open", "(", "datefile", ",", "\"rb\"", ")", ")", "\n", "for", "i", "in", "mdata", "[", "modes", "[", "0", "]", "]", ".", "keys", "(", ")", ":", "\n", "        ", "if", "all", "(", "i", "in", "mdata", "[", "mode", "]", ".", "keys", "(", ")", "and", "len", "(", "mdata", "[", "mode", "]", "[", "i", "]", ")", ">=", "params", "[", "'seq_min_len'", "]", "for", "mode", "in", "modes", ")", ":", "\n", "            ", "for", "mode", "in", "modes", ":", "\n", "                ", "lists", "=", "np", ".", "ndarray", ".", "tolist", "(", "np", ".", "transpose", "(", "mdata", "[", "mode", "]", "[", "i", "]", ")", ")", "\n", "pad_matrix", "=", "pad_sequences", "(", "lists", ",", "maxlen", "=", "params", "[", "'seq_max_len'", "]", ",", "dtype", "=", "'float32'", ")", "\n", "pad_matrix", "=", "np", ".", "transpose", "(", "pad_matrix", ")", "\n", "sdata", "[", "mode", "]", ".", "append", "(", "pad_matrix", ")", "\n", "", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "                ", "rating_date", "=", "df_date", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", ".", "iloc", "[", "0", "]", ".", "timestamp", ".", "date", "(", ")", "\n", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "                ", "rating_date", "=", "i", "\n", "", "ratings", "=", "df_rating", "[", "lambda", "x", ":", "x", ".", "date", "==", "rating_date", ".", "strftime", "(", "'%Y-%m-%d'", ")", "]", ".", "iloc", "[", "0", "]", "\n", "label", ".", "append", "(", "[", "ratings", ".", "sighd_17item", ",", "ratings", ".", "ymrs_total", "]", ")", "\n", "timestamp", ".", "append", "(", "rating_date", ")", "\n", "", "", "pk", ".", "dump", "(", "(", "sdata", ",", "label", ",", "timestamp", ")", ",", "open", "(", "filename", ",", "'wb'", ")", ",", "protocol", "=", "pk", ".", "HIGHEST_PROTOCOL", ")", "\n", "return", "sdata", ",", "label", ",", "timestamp", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.convert_label": [[100, 113], ["range", "range", "numpy.array", "len", "len"], "function", ["None"], ["", "def", "convert_label", "(", "labels", ",", "params", ")", ":", "\n", "    ", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "0", "]", "\n", "if", "labels", "[", "i", "]", ">=", "8", ":", "\n", "                ", "labels", "[", "i", "]", "=", "1", "\n", "", "else", ":", "\n", "                ", "labels", "[", "i", "]", "=", "0", "\n", "", "", "return", "labels", "\n", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "1", "]", "\n", "", "return", "np", ".", "array", "(", "labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.save_obj": [[115, 118], ["open", "pickle.dump"], "function", ["None"], ["", "", "def", "save_obj", "(", "obj", ",", "name", ")", ":", "\n", "    ", "with", "open", "(", "name", "+", "'.pkl'", ",", "'wb'", ")", "as", "f", ":", "\n", "        ", "pk", ".", "dump", "(", "obj", ",", "f", ",", "pk", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.load_obj": [[120, 123], ["open", "pickle.load"], "function", ["None"], ["", "", "def", "load_obj", "(", "name", ")", ":", "\n", "    ", "with", "open", "(", "name", "+", "'.pkl'", ",", "'rb'", ")", "as", "f", ":", "\n", "        ", "return", "pk", ".", "load", "(", "f", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.load_data": [[125, 173], ["range", "random.seed", "random.sample", "Fed_mood_cds.save_obj", "Fed_mood_cds.load_obj", "numpy.concatenate", "Fed_mood_cds.convert_label", "numpy.concatenate", "numpy.concatenate", "Fed_mood_cds.load_subject_data", "len", "len", "numpy.concatenate", "numpy.asarray", "numpy.asarray", "range", "len", "range", "range", "len", "len", "int", "int", "numpy.asarray", "a[].append", "len"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.save_obj", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_obj", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.convert_label", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_subject_data"], ["", "", "def", "load_data", "(", "subject_ids", ",", "ratio", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "label", "=", "{", "}", "\n", "timestamp", "=", "{", "}", "\n", "n", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "data", "[", "i", "]", ",", "label", "[", "i", "]", ",", "timestamp", "[", "i", "]", "=", "load_subject_data", "(", "modes", ",", "i", ",", "params", ")", "\n", "m", "=", "len", "(", "label", "[", "i", "]", ")", "\n", "if", "ratio", ">", "0", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "ratio", ")", ")", "\n", "", "else", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "(", "ratio", "+", "1", ")", ")", ",", "m", ")", "\n", "", "for", "mode", "in", "modes", ":", "\n", "            ", "data", "[", "i", "]", "[", "mode", "]", "=", "[", "data", "[", "i", "]", "[", "mode", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "", "label", "[", "i", "]", "=", "[", "label", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "timestamp", "[", "i", "]", "=", "[", "timestamp", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "n", "+=", "len", "(", "idx", ")", "\n", "", "idx", "=", "range", "(", "n", ")", "\n", "random", ".", "seed", "(", "0", ")", "\n", "idx", "=", "random", ".", "sample", "(", "idx", ",", "k", "=", "len", "(", "idx", ")", ")", "\n", "datas", "=", "{", "}", "\n", "for", "mode", "in", "modes", ":", "\n", "        ", "datas", "[", "mode", "]", "=", "np", ".", "concatenate", "(", "[", "np", ".", "asarray", "(", "data", "[", "i", "]", "[", "mode", "]", ")", "for", "i", "in", "subject_ids", "]", ")", "\n", "datas", "[", "mode", "]", "=", "np", ".", "asarray", "(", "[", "datas", "[", "mode", "]", "[", "i", "]", "for", "i", "in", "idx", "]", ")", "\n", "np", ".", "asarray", "(", "data", "[", "i", "]", "[", "mode", "]", ")", "\n", "", "a", "=", "{", "}", "\n", "save_obj", "(", "label", ",", "'tt'", ")", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "a", "[", "i", "]", "=", "label", "[", "i", "]", "[", "0", "]", "\n", "", "for", "i", "in", "subject_ids", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "label", "[", "i", "]", ")", ")", ":", "\n", "            ", "if", "j", "==", "0", ":", "\n", "                ", "continue", "\n", "", "else", ":", "\n", "                ", "a", "[", "i", "]", ".", "append", "(", "label", "[", "i", "]", "[", "j", "]", ")", "\n", "", "", "", "newlabel", "=", "load_obj", "(", "'tt'", ")", "\n", "labels", "=", "np", ".", "concatenate", "(", "[", "label", "[", "i", "]", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "ll", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "labels", "[", "ll", "]", "=", "newlabel", "[", "i", "]", "[", "0", "]", "\n", "ll", "+=", "len", "(", "newlabel", "[", "i", "]", ")", "\n", "", "labels", "=", "[", "labels", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "labels", "=", "convert_label", "(", "labels", ",", "params", ")", "\n", "timestamps", "=", "np", ".", "concatenate", "(", "[", "timestamp", "[", "i", "]", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "timestamps", "=", "[", "timestamps", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "whose", "=", "np", ".", "concatenate", "(", "[", "[", "i", "]", "*", "len", "(", "label", "[", "i", "]", ")", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "whose", "=", "[", "whose", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "return", "datas", ",", "labels", ",", "timestamps", ",", "whose", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.split_data": [[175, 185], ["Fed_mood_cds.load_data", "Fed_mood_cds.load_data", "list", "list.remove", "Fed_mood_cds.load_data", "Fed_mood_cds.load_data"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data"], ["", "def", "split_data", "(", "subject_ids", ",", "params", ")", ":", "\n", "    ", "if", "params", "[", "'test_subject'", "]", "==", "-", "1", ":", "\n", "        ", "train_data", ",", "train_label", ",", "_", ",", "_", "=", "load_data", "(", "subject_ids", ",", "0.8", ",", "params", ")", "\n", "test_data", ",", "test_label", ",", "_", ",", "_", "=", "load_data", "(", "subject_ids", ",", "-", "0.2", ",", "params", ")", "\n", "", "else", ":", "\n", "        ", "train_subjects", "=", "list", "(", "subject_ids", ")", "\n", "train_subjects", ".", "remove", "(", "params", "[", "'test_subject'", "]", ")", "\n", "train_data", ",", "train_label", ",", "_", ",", "_", "=", "load_data", "(", "train_subjects", ",", "1", ",", "params", ")", "\n", "test_data", ",", "test_label", ",", "_", ",", "_", "=", "load_data", "(", "[", "params", "[", "'test_subject'", "]", "]", ",", "1", ",", "params", ")", "\n", "", "return", "train_data", ",", "train_label", ",", "test_data", ",", "test_label", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.evaluate": [[187, 201], ["print", "numpy.sqrt", "numpy.mean", "float", "len", "float", "float", "numpy.mean", "numpy.abs", "sum", "sum", "sum", "numpy.square", "numpy.square", "numpy.square", "numpy.sum", "numpy.sum", "sum", "sum", "numpy.std", "numpy.std", "numpy.square", "numpy.square", "numpy.mean"], "function", ["None"], ["", "def", "evaluate", "(", "y_test", ",", "y_pred", ",", "params", ")", ":", "\n", "    ", "res", "=", "{", "}", "\n", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "res", "[", "'accuracy'", "]", "=", "float", "(", "sum", "(", "y_test", "==", "y_pred", ")", ")", "/", "len", "(", "y_test", ")", "\n", "res", "[", "'precision'", "]", "=", "float", "(", "sum", "(", "y_test", "&", "y_pred", ")", "+", "1", ")", "/", "(", "sum", "(", "y_pred", ")", "+", "1", ")", "\n", "res", "[", "'recall'", "]", "=", "float", "(", "sum", "(", "y_test", "&", "y_pred", ")", "+", "1", ")", "/", "(", "sum", "(", "y_test", ")", "+", "1", ")", "\n", "res", "[", "'f_score'", "]", "=", "2.0", "*", "res", "[", "'precision'", "]", "*", "res", "[", "'recall'", "]", "/", "(", "res", "[", "'precision'", "]", "+", "res", "[", "'recall'", "]", ")", "\n", "", "else", ":", "\n", "        ", "res", "[", "'rmse'", "]", "=", "np", ".", "sqrt", "(", "np", ".", "mean", "(", "np", ".", "square", "(", "y_test", "-", "y_pred", ")", ")", ")", "\n", "res", "[", "'mae'", "]", "=", "np", ".", "mean", "(", "np", ".", "abs", "(", "y_test", "-", "y_pred", ")", ")", "\n", "res", "[", "'explained_variance_score'", "]", "=", "1", "-", "np", ".", "square", "(", "np", ".", "std", "(", "y_test", "-", "y_pred", ")", ")", "/", "np", ".", "square", "(", "np", ".", "std", "(", "y_test", ")", ")", "\n", "res", "[", "'r2_score'", "]", "=", "1", "-", "np", ".", "sum", "(", "np", ".", "square", "(", "y_test", "-", "y_pred", ")", ")", "/", "np", ".", "sum", "(", "np", ".", "square", "(", "y_test", "-", "np", ".", "mean", "(", "y_test", ")", ")", ")", "\n", "", "print", "(", "' '", ".", "join", "(", "[", "\"%s: %.4f\"", "%", "(", "i", ",", "res", "[", "i", "]", ")", "for", "i", "in", "res", "]", ")", ")", "\n", "return", "res", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.mvm_decision_function": [[203, 211], ["len", "keras.backend.concatenate", "keras.backend.sum", "keras.backend.prod", "range", "keras.backend.stack", "range"], "function", ["None"], ["", "def", "mvm_decision_function", "(", "arg", ")", ":", "\n", "    ", "n_modes", "=", "len", "(", "arg", ")", "\n", "latentx", "=", "arg", "\n", "y", "=", "K", ".", "concatenate", "(", "[", "K", ".", "sum", "(", "\n", "K", ".", "prod", "(", "K", ".", "stack", "(", "[", "latentx", "[", "j", "]", "[", ":", ",", "i", "*", "params", "[", "'n_latent'", "]", ":", "(", "i", "+", "1", ")", "*", "params", "[", "'n_latent'", "]", "]", "for", "j", "in", "range", "(", "n_modes", ")", "]", ")", ",", "\n", "axis", "=", "0", ")", ",", "axis", "=", "-", "1", ",", "keepdims", "=", "True", ")", "for", "i", "in", "range", "(", "params", "[", "'n_classes'", "]", ")", "]", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.fm_decision_function": [[213, 219], ["keras.backend.concatenate", "keras.backend.sum", "keras.backend.tf.stack", "keras.backend.sum", "keras.backend.square", "range"], "function", ["None"], ["", "def", "fm_decision_function", "(", "arg", ")", ":", "\n", "    ", "latentx", ",", "bias", "=", "arg", "[", "0", "]", ",", "arg", "[", "1", "]", "\n", "pairwise", "=", "K", ".", "concatenate", "(", "[", "K", ".", "sum", "(", "K", ".", "square", "(", "latentx", "[", ":", ",", "i", "*", "params", "[", "'n_latent'", "]", ":", "(", "i", "+", "1", ")", "*", "params", "[", "'n_latent'", "]", "]", ")", ",", "axis", "=", "-", "1", ",", "keepdims", "=", "True", ")", "for", "i", "in", "range", "(", "params", "[", "'n_classes'", "]", ")", "]", ")", "\n", "y", "=", "K", ".", "sum", "(", "K", ".", "tf", ".", "stack", "(", "[", "pairwise", ",", "bias", "]", ")", ",", "axis", "=", "0", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.acc": [[221, 223], ["keras.backend.mean", "keras.backend.equal"], "function", ["None"], ["", "def", "acc", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "return", "K", ".", "mean", "(", "K", ".", "equal", "(", "y_true", ">", "0.5", ",", "y_pred", ">", "0.5", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.rmse": [[225, 227], ["keras.backend.sqrt", "keras.backend.mean", "keras.backend.square"], "function", ["None"], ["", "def", "rmse", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "return", "K", ".", "sqrt", "(", "K", ".", "mean", "(", "K", ".", "square", "(", "y_true", "-", "y_pred", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.create_model": [[229, 297], ["Model", "Model.compile", "Model.summary", "train_data.keys", "train_data.keys", "merge", "train_data.keys", "merge", "merge", "Dense", "Dense", "merge", "Dense", "Dense", "RMSprop", "Input", "input_list.append", "train_list.append", "test_list.append", "output_list.append", "len", "Activation", "Activation", "Input", "input_list.append", "train_list.append", "test_list.append", "output_list.append", "len", "Activation", "Activation", "Input", "input_list.append", "train_list.append", "test_list.append", "output_list.append", "Activation", "Activation", "Masking", "Bidirectional", "Dropout", "Masking", "Bidirectional", "Dropout", "Masking", "Bidirectional", "Dropout", "Dense", "GRU", "GRU", "GRU"], "function", ["None"], ["", "def", "create_model", "(", "train_data", ",", "test_data", ",", "params", ")", ":", "\n", "    ", "input_list", "=", "[", "]", "\n", "output_list", "=", "[", "]", "\n", "train_list", "=", "[", "]", "\n", "test_list", "=", "[", "]", "\n", "if", "params", "[", "'idx'", "]", "==", "1", ":", "\n", "        ", "for", "mode", "in", "train_data", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "train_list", ".", "append", "(", "train_data", "[", "mode", "]", ")", "\n", "test_list", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "output_list", ".", "append", "(", "drop_output", ")", "\n", "", "", "x", "=", "merge", "(", "output_list", ",", "mode", "=", "'concat'", ")", "if", "len", "(", "output_list", ")", ">", "1", "else", "output_list", "[", "0", "]", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_classes'", "]", "*", "params", "[", "'n_latent'", "]", ",", "activation", "=", "'relu'", ",", "\n", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "x", ")", "\n", "y", "=", "Dense", "(", "params", "[", "'n_classes'", "]", ",", "bias", "=", "False", ")", "(", "latentx", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "2", ":", "\n", "        ", "for", "mode", "in", "train_data", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "train_list", ".", "append", "(", "train_data", "[", "mode", "]", ")", "\n", "test_list", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "output_list", ".", "append", "(", "drop_output", ")", "\n", "", "", "x", "=", "merge", "(", "output_list", ",", "mode", "=", "'concat'", ")", "if", "len", "(", "output_list", ")", ">", "1", "else", "output_list", "[", "0", "]", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_latent'", "]", "*", "params", "[", "'n_classes'", "]", ",", "bias", "=", "False", ")", "(", "x", ")", "\n", "bias", "=", "Dense", "(", "params", "[", "'n_classes'", "]", ",", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "x", ")", "\n", "y", "=", "merge", "(", "[", "latentx", ",", "bias", "]", ",", "mode", "=", "fm_decision_function", ",", "output_shape", "=", "(", "params", "[", "'n_classes'", "]", ",", ")", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "3", ":", "\n", "        ", "for", "mode", "in", "train_data", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "train_list", ".", "append", "(", "train_data", "[", "mode", "]", ")", "\n", "test_list", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_latent'", "]", "*", "params", "[", "'n_classes'", "]", ",", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "\n", "drop_output", ")", "\n", "output_list", ".", "append", "(", "latentx", ")", "\n", "", "", "y", "=", "merge", "(", "output_list", ",", "mode", "=", "mvm_decision_function", ",", "output_shape", "=", "(", "params", "[", "'n_classes'", "]", ",", ")", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "model", "=", "Model", "(", "input", "=", "input_list", ",", "output", "=", "y_act", ")", "\n", "model", ".", "compile", "(", "loss", "=", "objective", ",", "optimizer", "=", "RMSprop", "(", "lr", "=", "params", "[", "'lr'", "]", ")", ",", "metrics", "=", "metric", ")", "\n", "model", ".", "summary", "(", ")", "\n", "return", "model", ",", "train_list", ",", "test_list", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.iid": [[299, 317], ["numpy.random.seed", "range", "range", "int", "range", "range", "set", "list", "set", "list", "numpy.random.choice", "list", "numpy.random.choice", "list", "range", "range", "len", "set", "len", "set"], "function", ["None"], ["", "def", "iid", "(", "train_label", ",", "test_label", ",", "params", ")", ":", "\n", "    ", "dict_users", ",", "all_idxs", "=", "{", "}", ",", "[", "i", "for", "i", "in", "range", "(", "len", "(", "train_label", ")", ")", "]", "\n", "np", ".", "random", ".", "seed", "(", "0", ")", "\n", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users", "[", "i", "]", "=", "set", "(", "np", ".", "random", ".", "choice", "(", "all_idxs", ",", "params", "[", "'data'", "]", ",", "replace", "=", "False", ")", ")", "\n", "if", "params", "[", "'data'", "]", "<=", "(", "11968", "/", "params", "[", "'num_users'", "]", ")", ":", "\n", "            ", "all_idxs", "=", "list", "(", "set", "(", "all_idxs", ")", "-", "dict_users", "[", "i", "]", ")", "\n", "", "", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users", "[", "i", "]", "=", "list", "(", "dict_users", "[", "i", "]", ")", "\n", "", "num_items_test", "=", "int", "(", "3003", "*", "params", "[", "'data'", "]", "/", "(", "11968", "/", "params", "[", "'num_users'", "]", ")", "/", "params", "[", "'num_users'", "]", ")", "\n", "dict_users_test", ",", "all_idxs_test", "=", "{", "}", ",", "[", "i", "for", "i", "in", "range", "(", "len", "(", "test_label", ")", ")", "]", "\n", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users_test", "[", "i", "]", "=", "set", "(", "np", ".", "random", ".", "choice", "(", "all_idxs_test", ",", "num_items_test", ",", "replace", "=", "False", ")", ")", "\n", "if", "params", "[", "'data'", "]", "<=", "(", "11968", "/", "params", "[", "'num_users'", "]", ")", ":", "\n", "            ", "all_idxs_test", "=", "list", "(", "set", "(", "all_idxs_test", ")", "-", "dict_users_test", "[", "i", "]", ")", "\n", "", "", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "dict_users_test", "[", "i", "]", "=", "list", "(", "dict_users_test", "[", "i", "]", ")", "\n", "", "return", "dict_users", ",", "dict_users_test", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.FedAvg": [[318, 348], ["copy.deepcopy", "range", "len", "range", "range", "range", "range", "range", "range", "range", "len", "numpy.zeros", "range", "range", "w_avg.append", "range", "range", "w_avg.append", "len", "range", "len", "len", "range", "len", "numpy.shape", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len"], "function", ["None"], ["", "def", "FedAvg", "(", "w", ",", "params", ")", ":", "\n", "    ", "w_avg", "=", "[", "]", "\n", "c", "=", "{", "}", "\n", "load", "=", "copy", ".", "deepcopy", "(", "w", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "load", ")", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "load", "[", "i", "]", ")", ")", ":", "\n", "            ", "load", "[", "i", "]", "[", "j", "]", "=", "np", ".", "zeros", "(", "shape", "=", "np", ".", "shape", "(", "load", "[", "i", "]", "[", "j", "]", ")", ")", "\n", "", "", "if", "params", "[", "'idx'", "]", "==", "3", ":", "\n", "        ", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "            ", "c", "[", "i", "]", "=", "load", "[", "i", "]", "\n", "", "for", "k", "in", "range", "(", "6", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", ")", ")", ":", "\n", "                ", "for", "j", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", "[", "0", "]", ")", ")", ":", "\n", "                    ", "c", "[", "k", "]", "[", "j", "]", "+=", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", "[", "i", "]", "[", "j", "]", "\n", "", "", "for", "l", "in", "range", "(", "len", "(", "c", "[", "k", "]", ")", ")", ":", "\n", "                ", "c", "[", "k", "]", "[", "l", "]", "=", "c", "[", "k", "]", "[", "l", "]", "*", "6", "/", "len", "(", "w", ")", "\n", "", "", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "            ", "w_avg", ".", "append", "(", "c", "[", "i", "]", ")", "\n", "", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "5", ")", ":", "\n", "            ", "c", "[", "i", "]", "=", "load", "[", "i", "]", "\n", "", "for", "k", "in", "range", "(", "5", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", ")", ")", ":", "\n", "                ", "for", "j", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", "[", "0", "]", ")", ")", ":", "\n", "                    ", "c", "[", "k", "]", "[", "j", "]", "+=", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", "[", "i", "]", "[", "j", "]", "\n", "", "", "for", "l", "in", "range", "(", "len", "(", "c", "[", "k", "]", ")", ")", ":", "\n", "                ", "c", "[", "k", "]", "[", "l", "]", "=", "c", "[", "k", "]", "[", "l", "]", "*", "5", "/", "len", "(", "w", ")", "\n", "", "", "for", "i", "in", "range", "(", "5", ")", ":", "\n", "            ", "w_avg", ".", "append", "(", "c", "[", "i", "]", ")", "\n", "", "", "return", "w_avg", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.run_model": [[349, 391], ["Fed_mood_cds.create_model", "Fed_mood_cds.iid", "range", "range", "model.fit", "model.predict", "range", "y_train_merge.extend", "X_train_last.append", "numpy.ravel", "X_train_fed.append", "y_train_fed.append", "X_train_merge.append", "numpy.concatenate", "numpy.concatenate", "numpy.concatenate", "a.reshape.reshape", "numpy.concatenate", "a.reshape.reshape", "a.reshape.reshape", "numpy.ravel"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.create_model", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_cds.iid"], ["", "def", "run_model", "(", "train_data", ",", "test_data", ",", "y_train", ",", "y_test", ",", "params", ")", ":", "\n", "    ", "num", "=", "[", "6", ",", "7", ",", "8", ",", "13", ",", "14", "]", "\n", "model", ",", "X_train", ",", "X_test", "=", "create_model", "(", "train_data", ",", "test_data", ",", "params", ")", "\n", "dict_users", ",", "dict_users_test", "=", "iid", "(", "y_train", ",", "y_test", ",", "params", ")", "\n", "X_train_merge", "=", "[", "]", "\n", "y_train_merge", "=", "[", "]", "\n", "for", "j", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "X_train_fed", ",", "y_train_fed", "=", "[", "]", ",", "[", "]", "\n", "for", "k", "in", "range", "(", "3", ")", ":", "\n", "            ", "a", "=", "X_train", "[", "k", "]", "[", "dict_users", "[", "j", "]", "[", "0", "]", "]", "\n", "for", "i", "in", "dict_users", "[", "j", "]", ":", "\n", "                ", "if", "i", "==", "dict_users", "[", "j", "]", "[", "0", "]", ":", "\n", "                    ", "continue", "\n", "", "else", ":", "\n", "                    ", "a", "=", "np", ".", "concatenate", "(", "(", "a", ",", "X_train", "[", "k", "]", "[", "i", "]", ")", ")", "\n", "", "", "if", "k", "==", "0", ":", "\n", "                ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "4", ")", "\n", "", "elif", "k", "==", "1", ":", "\n", "                ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "6", ")", "\n", "", "else", ":", "\n", "                ", "a", "=", "a", ".", "reshape", "(", "params", "[", "'data'", "]", ",", "100", ",", "3", ")", "\n", "", "X_train_fed", ".", "append", "(", "a", ")", "\n", "", "for", "i", "in", "dict_users", "[", "j", "]", ":", "\n", "            ", "y_train_fed", ".", "append", "(", "y_train", "[", "i", "]", ")", "\n", "", "y_train_merge", ".", "extend", "(", "y_train_fed", ")", "\n", "if", "j", "==", "0", ":", "\n", "            ", "X_train_merge", ".", "append", "(", "X_train_fed", ")", "\n", "", "else", ":", "\n", "            ", "X_train_merge", "[", "0", "]", "[", "0", "]", "=", "np", ".", "concatenate", "(", "(", "X_train_merge", "[", "0", "]", "[", "0", "]", ",", "X_train_fed", "[", "0", "]", ")", ",", "axis", "=", "0", ")", "\n", "X_train_merge", "[", "0", "]", "[", "1", "]", "=", "np", ".", "concatenate", "(", "(", "X_train_merge", "[", "0", "]", "[", "1", "]", ",", "X_train_fed", "[", "1", "]", ")", ",", "axis", "=", "0", ")", "\n", "X_train_merge", "[", "0", "]", "[", "2", "]", "=", "np", ".", "concatenate", "(", "(", "X_train_merge", "[", "0", "]", "[", "2", "]", ",", "X_train_fed", "[", "2", "]", ")", ",", "axis", "=", "0", ")", "\n", "", "", "X_train_last", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "3", ")", ":", "\n", "        ", "X_train_last", ".", "append", "(", "X_train_merge", "[", "0", "]", "[", "i", "]", ")", "\n", "", "hist", "=", "model", ".", "fit", "(", "X_train_last", ",", "y_train_merge", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "2", ",", "nb_epoch", "=", "params", "[", "'n_epochs'", "]", ",", "\n", "validation_split", "=", "0.2", ")", "\n", "y_score", "=", "model", ".", "predict", "(", "X_test", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "0", ")", "\n", "y_pred", "=", "(", "np", ".", "ravel", "(", "y_score", ")", ">", "0.5", ")", ".", "astype", "(", "'int32'", ")", "if", "params", "[", "'is_clf'", "]", "else", "np", ".", "ravel", "(", "y_score", ")", "\n", "return", "y_pred", ",", "hist", ".", "history", "\n", "\n", "return", "y_pred", ",", "hist", ".", "history", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_mode_data": [[33, 65], ["pandas.read_pickle", "open", "df[].apply", "df[].apply", "df[].fillna().apply().apply", "df[].apply().apply", "df[].apply", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].unique", "df[].fillna().apply", "df[].apply", "numpy.log", "numpy.log", "numpy.log", "numpy.log", "df[].drop", "df[].drop", "df[].fillna", "min", "min", "max"], "function", ["None"], ["def", "load_mode_data", "(", "mode", ",", "subject_id", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "filename", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "mode", ",", "subject_id", ")", "\n", "df", "=", "pd", ".", "read_pickle", "(", "open", "(", "filename", ",", "\"rb\"", ")", ")", "\n", "df", "[", "'timestamp'", "]", "=", "df", "[", "'timestamp'", "]", ".", "dt", ".", "date", "\n", "if", "mode", "==", "'alphanum'", ":", "\n", "        ", "df", "[", "'x'", "]", "=", "df", "[", "'x'", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "2276", ")", "\n", "df", "[", "'y'", "]", "=", "df", "[", "'y'", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "959", ")", "\n", "df", "[", "'dt'", "]", "=", "df", "[", "'dt'", "]", ".", "fillna", "(", "0", ")", ".", "apply", "(", "lambda", "x", ":", "min", "(", "x", ",", "5", ")", ")", ".", "apply", "(", "lambda", "x", ":", "np", ".", "log", "(", "x", "+", "1", ")", "/", "np", ".", "log", "(", "6", ")", ")", "\n", "df", "[", "'dr'", "]", "=", "df", "[", "'dr'", "]", ".", "apply", "(", "lambda", "x", ":", "min", "(", "max", "(", "50", ",", "x", ")", ",", "1000", ")", ")", ".", "apply", "(", "lambda", "x", ":", "np", ".", "log", "(", "x", "-", "49", ")", "/", "np", ".", "log", "(", "951", ")", ")", "\n", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'dt'", ",", "'dr'", "]", "]", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'dt'", ",", "'dr'", "]", "]", ".", "values", "\n", "", "", "", "if", "mode", "==", "'special'", ":", "\n", "        ", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", ".", "drop", "(", "[", "'timestamp'", ",", "'session_number'", "]", ",", "1", ")", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", ".", "drop", "(", "[", "'timestamp'", ",", "'session_number'", "]", ",", "1", ")", ".", "values", "\n", "", "", "", "if", "mode", "==", "'accel'", ":", "\n", "        ", "df", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", "=", "df", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "apply", "(", "lambda", "x", ":", "x", "/", "39.2266", ")", "\n", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "            ", "for", "i", "in", "df", "[", "'session_number'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "values", "\n", "", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "            ", "for", "i", "in", "df", "[", "'timestamp'", "]", ".", "unique", "(", ")", ":", "\n", "                ", "data", "[", "i", "]", "=", "df", "[", "lambda", "x", ":", "x", ".", "timestamp", "==", "i", "]", "[", "[", "'x'", ",", "'y'", ",", "'z'", "]", "]", ".", "values", "\n", "", "", "", "return", "data", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_subject_data": [[67, 99], ["os.path.isfile", "pandas.read_pickle", "pandas.read_pickle", "mdata[].keys", "pickle.dump", "pandas.read_pickle", "Fed_mood_fednoniid.load_mode_data", "open", "open", "all", "open", "open", "label.append", "timestamp.append", "numpy.ndarray.tolist", "keras.preprocessing.sequence.pad_sequences", "numpy.transpose", "sdata[].append", "df_date[].iloc[].timestamp.date", "numpy.transpose", "mdata[].keys", "len", "df_date[].iloc[].timestamp.date.strftime"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_mode_data"], ["", "def", "load_subject_data", "(", "modes", ",", "subject_id", ",", "params", ")", ":", "\n", "    ", "level_name", "=", "[", "'session'", ",", "'day'", "]", "\n", "filename", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "level_name", "[", "params", "[", "'level'", "]", "]", ",", "subject_id", ")", "\n", "if", "os", ".", "path", ".", "isfile", "(", "filename", ")", ":", "\n", "        ", "return", "pd", ".", "read_pickle", "(", "open", "(", "filename", ",", "\"rb\"", ")", ")", "\n", "", "mdata", "=", "{", "}", "\n", "sdata", "=", "{", "}", "\n", "for", "mode", "in", "modes", ":", "\n", "        ", "mdata", "[", "mode", "]", "=", "load_mode_data", "(", "mode", ",", "subject_id", ",", "params", ")", "\n", "sdata", "[", "mode", "]", "=", "[", "]", "\n", "", "label", "=", "[", "]", "\n", "timestamp", "=", "[", "]", "\n", "ratingfile", "=", "\"mood\\weekly_ratings_%d.pickle\"", "%", "subject_id", "\n", "df_rating", "=", "pd", ".", "read_pickle", "(", "open", "(", "ratingfile", ",", "\"rb\"", ")", ")", "\n", "datefile", "=", "\"mood\\%s_%d.pickle\"", "%", "(", "modes", "[", "0", "]", ",", "subject_id", ")", "\n", "df_date", "=", "pd", ".", "read_pickle", "(", "open", "(", "datefile", ",", "\"rb\"", ")", ")", "\n", "for", "i", "in", "mdata", "[", "modes", "[", "0", "]", "]", ".", "keys", "(", ")", ":", "\n", "        ", "if", "all", "(", "i", "in", "mdata", "[", "mode", "]", ".", "keys", "(", ")", "and", "len", "(", "mdata", "[", "mode", "]", "[", "i", "]", ")", ">=", "params", "[", "'seq_min_len'", "]", "for", "mode", "in", "modes", ")", ":", "\n", "            ", "for", "mode", "in", "modes", ":", "\n", "                ", "lists", "=", "np", ".", "ndarray", ".", "tolist", "(", "np", ".", "transpose", "(", "mdata", "[", "mode", "]", "[", "i", "]", ")", ")", "\n", "pad_matrix", "=", "pad_sequences", "(", "lists", ",", "maxlen", "=", "params", "[", "'seq_max_len'", "]", ",", "dtype", "=", "'float32'", ")", "\n", "pad_matrix", "=", "np", ".", "transpose", "(", "pad_matrix", ")", "\n", "sdata", "[", "mode", "]", ".", "append", "(", "pad_matrix", ")", "\n", "", "if", "params", "[", "'level'", "]", "==", "0", ":", "\n", "                ", "rating_date", "=", "df_date", "[", "lambda", "x", ":", "x", ".", "session_number", "==", "i", "]", ".", "iloc", "[", "0", "]", ".", "timestamp", ".", "date", "(", ")", "\n", "", "if", "params", "[", "'level'", "]", "==", "1", ":", "\n", "                ", "rating_date", "=", "i", "\n", "", "ratings", "=", "df_rating", "[", "lambda", "x", ":", "x", ".", "date", "==", "rating_date", ".", "strftime", "(", "'%Y-%m-%d'", ")", "]", ".", "iloc", "[", "0", "]", "\n", "label", ".", "append", "(", "[", "ratings", ".", "sighd_17item", ",", "ratings", ".", "ymrs_total", "]", ")", "\n", "timestamp", ".", "append", "(", "rating_date", ")", "\n", "", "", "pk", ".", "dump", "(", "(", "sdata", ",", "label", ",", "timestamp", ")", ",", "open", "(", "filename", ",", "'wb'", ")", ",", "protocol", "=", "pk", ".", "HIGHEST_PROTOCOL", ")", "\n", "return", "sdata", ",", "label", ",", "timestamp", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.convert_label": [[101, 114], ["range", "range", "numpy.array", "len", "len"], "function", ["None"], ["", "def", "convert_label", "(", "labels", ",", "params", ")", ":", "\n", "    ", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "0", "]", "\n", "if", "labels", "[", "i", "]", ">=", "8", ":", "\n", "                ", "labels", "[", "i", "]", "=", "1", "\n", "", "else", ":", "\n", "                ", "labels", "[", "i", "]", "=", "0", "\n", "", "", "return", "labels", "\n", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "1", "]", "\n", "", "return", "np", ".", "array", "(", "labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.converts_label": [[115, 129], ["range", "numpy.array", "range", "len", "len"], "function", ["None"], ["", "", "def", "converts_label", "(", "labels", ",", "params", ",", "subject_ids", ")", ":", "\n", "    ", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "for", "i", "in", "subject_ids", ":", "\n", "            ", "for", "j", "in", "range", "(", "len", "(", "labels", "[", "i", "]", ")", ")", ":", "\n", "                ", "labels", "[", "i", "]", "[", "j", "]", "=", "labels", "[", "i", "]", "[", "j", "]", "[", "0", "]", "\n", "if", "labels", "[", "i", "]", "[", "j", "]", ">=", "8", ":", "\n", "                    ", "labels", "[", "i", "]", "[", "j", "]", "=", "1", "\n", "", "else", ":", "\n", "                    ", "labels", "[", "i", "]", "[", "j", "]", "=", "0", "\n", "", "", "", "return", "labels", "\n", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "len", "(", "labels", ")", ")", ":", "\n", "            ", "labels", "[", "i", "]", "=", "labels", "[", "i", "]", "[", "1", "]", "\n", "", "return", "np", ".", "array", "(", "labels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.save_obj": [[130, 133], ["open", "pickle.dump"], "function", ["None"], ["", "", "def", "save_obj", "(", "obj", ",", "name", ")", ":", "\n", "    ", "with", "open", "(", "name", "+", "'.pkl'", ",", "'wb'", ")", "as", "f", ":", "\n", "        ", "pk", ".", "dump", "(", "obj", ",", "f", ",", "pk", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_obj": [[135, 138], ["open", "pickle.load"], "function", ["None"], ["", "", "def", "load_obj", "(", "name", ")", ":", "\n", "    ", "with", "open", "(", "name", "+", "'.pkl'", ",", "'rb'", ")", "as", "f", ":", "\n", "        ", "return", "pk", ".", "load", "(", "f", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.loads_data": [[140, 188], ["range", "random.seed", "random.sample", "Fed_mood_fednoniid.save_obj", "Fed_mood_fednoniid.load_obj", "numpy.concatenate", "Fed_mood_fednoniid.convert_label", "numpy.concatenate", "numpy.concatenate", "Fed_mood_fednoniid.load_subject_data", "len", "len", "numpy.concatenate", "numpy.asarray", "numpy.asarray", "range", "len", "range", "range", "len", "len", "int", "int", "numpy.asarray", "a[].append", "len"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.save_obj", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_obj", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.convert_label", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_subject_data"], ["", "", "def", "loads_data", "(", "subject_ids", ",", "ratio", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "label", "=", "{", "}", "\n", "timestamp", "=", "{", "}", "\n", "n", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "data", "[", "i", "]", ",", "label", "[", "i", "]", ",", "timestamp", "[", "i", "]", "=", "load_subject_data", "(", "modes", ",", "i", ",", "params", ")", "\n", "m", "=", "len", "(", "label", "[", "i", "]", ")", "\n", "if", "ratio", ">", "0", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "ratio", ")", ")", "\n", "", "else", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "(", "ratio", "+", "1", ")", ")", ",", "m", ")", "\n", "", "for", "mode", "in", "modes", ":", "\n", "            ", "data", "[", "i", "]", "[", "mode", "]", "=", "[", "data", "[", "i", "]", "[", "mode", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "", "label", "[", "i", "]", "=", "[", "label", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "timestamp", "[", "i", "]", "=", "[", "timestamp", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "n", "+=", "len", "(", "idx", ")", "\n", "", "idx", "=", "range", "(", "n", ")", "\n", "random", ".", "seed", "(", "0", ")", "\n", "idx", "=", "random", ".", "sample", "(", "idx", ",", "k", "=", "len", "(", "idx", ")", ")", "\n", "datas", "=", "{", "}", "\n", "for", "mode", "in", "modes", ":", "\n", "        ", "datas", "[", "mode", "]", "=", "np", ".", "concatenate", "(", "[", "np", ".", "asarray", "(", "data", "[", "i", "]", "[", "mode", "]", ")", "for", "i", "in", "subject_ids", "]", ")", "\n", "datas", "[", "mode", "]", "=", "np", ".", "asarray", "(", "[", "datas", "[", "mode", "]", "[", "i", "]", "for", "i", "in", "idx", "]", ")", "\n", "np", ".", "asarray", "(", "data", "[", "i", "]", "[", "mode", "]", ")", "\n", "", "a", "=", "{", "}", "\n", "save_obj", "(", "label", ",", "'tt'", ")", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "a", "[", "i", "]", "=", "label", "[", "i", "]", "[", "0", "]", "\n", "", "for", "i", "in", "subject_ids", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "label", "[", "i", "]", ")", ")", ":", "\n", "            ", "if", "j", "==", "0", ":", "\n", "                ", "continue", "\n", "", "else", ":", "\n", "                ", "a", "[", "i", "]", ".", "append", "(", "label", "[", "i", "]", "[", "j", "]", ")", "\n", "", "", "", "newlabel", "=", "load_obj", "(", "'tt'", ")", "\n", "labels", "=", "np", ".", "concatenate", "(", "[", "label", "[", "i", "]", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "ll", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "labels", "[", "ll", "]", "=", "newlabel", "[", "i", "]", "[", "0", "]", "\n", "ll", "+=", "len", "(", "newlabel", "[", "i", "]", ")", "\n", "", "labels", "=", "[", "labels", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "labels", "=", "convert_label", "(", "labels", ",", "params", ")", "\n", "timestamps", "=", "np", ".", "concatenate", "(", "[", "timestamp", "[", "i", "]", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "timestamps", "=", "[", "timestamps", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "whose", "=", "np", ".", "concatenate", "(", "[", "[", "i", "]", "*", "len", "(", "label", "[", "i", "]", ")", "for", "i", "in", "subject_ids", "]", ",", "axis", "=", "0", ")", "\n", "whose", "=", "[", "whose", "[", "i", "]", "for", "i", "in", "idx", "]", "\n", "return", "datas", ",", "labels", ",", "timestamps", ",", "whose", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data": [[189, 225], ["random.seed", "copy.deepcopy", "copy.deepcopy", "Fed_mood_fednoniid.converts_label", "Fed_mood_fednoniid.load_subject_data", "len", "len", "random.sample", "random.sample", "range", "range", "range", "len", "numpy.concatenate", "range", "len", "int", "int", "len", "numpy.asarray", "len", "numpy.asarray"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.converts_label", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_subject_data"], ["", "def", "load_data", "(", "subject_ids", ",", "ratio", ",", "params", ")", ":", "\n", "    ", "data", "=", "{", "}", "\n", "label", "=", "{", "}", "\n", "timestamp", "=", "{", "}", "\n", "n", "=", "0", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "data", "[", "i", "]", ",", "label", "[", "i", "]", ",", "timestamp", "[", "i", "]", "=", "load_subject_data", "(", "modes", ",", "i", ",", "params", ")", "\n", "m", "=", "len", "(", "label", "[", "i", "]", ")", "\n", "if", "ratio", ">", "0", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "ratio", ")", ")", "\n", "", "else", ":", "\n", "            ", "idx", "=", "range", "(", "int", "(", "m", "*", "(", "ratio", "+", "1", ")", ")", ",", "m", ")", "\n", "", "for", "mode", "in", "modes", ":", "\n", "            ", "data", "[", "i", "]", "[", "mode", "]", "=", "[", "data", "[", "i", "]", "[", "mode", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "", "label", "[", "i", "]", "=", "[", "label", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "timestamp", "[", "i", "]", "=", "[", "timestamp", "[", "i", "]", "[", "j", "]", "for", "j", "in", "idx", "]", "\n", "n", "+=", "len", "(", "idx", ")", "\n", "", "random", ".", "seed", "(", "0", ")", "\n", "datas", "=", "copy", ".", "deepcopy", "(", "data", ")", "\n", "for", "j", "in", "subject_ids", ":", "\n", "        ", "idx", "=", "random", ".", "sample", "(", "range", "(", "len", "(", "data", "[", "j", "]", "[", "'accel'", "]", ")", ")", ",", "len", "(", "data", "[", "j", "]", "[", "'accel'", "]", ")", ")", "\n", "for", "mode", "in", "modes", ":", "\n", "            ", "k", "=", "0", "\n", "for", "i", "in", "idx", ":", "\n", "                ", "datas", "[", "j", "]", "[", "mode", "]", "[", "k", "]", "=", "np", ".", "asarray", "(", "data", "[", "j", "]", "[", "mode", "]", "[", "i", "]", ")", "\n", "k", "=", "k", "+", "1", "\n", "", "datas", "[", "j", "]", "[", "mode", "]", "=", "np", ".", "concatenate", "(", "[", "np", ".", "asarray", "(", "datas", "[", "j", "]", "[", "mode", "]", ")", "]", ")", "\n", "", "", "labels", "=", "copy", ".", "deepcopy", "(", "label", ")", "\n", "for", "i", "in", "subject_ids", ":", "\n", "        ", "idx", "=", "random", ".", "sample", "(", "range", "(", "len", "(", "label", "[", "i", "]", ")", ")", ",", "len", "(", "label", "[", "i", "]", ")", ")", "\n", "k", "=", "0", "\n", "for", "j", "in", "idx", ":", "\n", "            ", "labels", "[", "i", "]", "[", "k", "]", "=", "label", "[", "i", "]", "[", "j", "]", "\n", "k", "=", "k", "+", "1", "\n", "", "", "labels", "=", "converts_label", "(", "labels", ",", "params", ",", "subject_ids", ")", "\n", "return", "datas", ",", "labels", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.split_data": [[227, 237], ["Fed_mood_fednoniid.load_data", "Fed_mood_fednoniid.loads_data", "list", "list.remove", "Fed_mood_fednoniid.load_data", "Fed_mood_fednoniid.load_data"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.loads_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.load_data"], ["", "def", "split_data", "(", "subject_ids", ",", "params", ")", ":", "\n", "    ", "if", "params", "[", "'test_subject'", "]", "==", "-", "1", ":", "\n", "        ", "train_data", ",", "train_label", "=", "load_data", "(", "subject_ids", ",", "0.8", ",", "params", ")", "\n", "test_data", ",", "test_label", ",", "_", ",", "_", "=", "loads_data", "(", "subject_ids", ",", "-", "0.2", ",", "params", ")", "\n", "", "else", ":", "\n", "        ", "train_subjects", "=", "list", "(", "subject_ids", ")", "\n", "train_subjects", ".", "remove", "(", "params", "[", "'test_subject'", "]", ")", "\n", "train_data", ",", "train_label", ",", "_", ",", "_", "=", "load_data", "(", "train_subjects", ",", "1", ",", "params", ")", "\n", "test_data", ",", "test_label", ",", "_", ",", "_", "=", "load_data", "(", "[", "params", "[", "'test_subject'", "]", "]", ",", "1", ",", "params", ")", "\n", "", "return", "train_data", ",", "train_label", ",", "test_data", ",", "test_label", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.evaluate": [[239, 253], ["print", "numpy.sqrt", "numpy.mean", "float", "len", "float", "float", "numpy.mean", "numpy.abs", "sum", "sum", "sum", "numpy.square", "numpy.square", "numpy.square", "numpy.sum", "numpy.sum", "sum", "sum", "numpy.std", "numpy.std", "numpy.square", "numpy.square", "numpy.mean"], "function", ["None"], ["", "def", "evaluate", "(", "y_test", ",", "y_pred", ",", "params", ")", ":", "\n", "    ", "res", "=", "{", "}", "\n", "if", "params", "[", "'is_clf'", "]", ":", "\n", "        ", "res", "[", "'accuracy'", "]", "=", "float", "(", "sum", "(", "y_test", "==", "y_pred", ")", ")", "/", "len", "(", "y_test", ")", "\n", "res", "[", "'precision'", "]", "=", "float", "(", "sum", "(", "y_test", "&", "y_pred", ")", "+", "1", ")", "/", "(", "sum", "(", "y_pred", ")", "+", "1", ")", "\n", "res", "[", "'recall'", "]", "=", "float", "(", "sum", "(", "y_test", "&", "y_pred", ")", "+", "1", ")", "/", "(", "sum", "(", "y_test", ")", "+", "1", ")", "\n", "res", "[", "'f_score'", "]", "=", "2.0", "*", "res", "[", "'precision'", "]", "*", "res", "[", "'recall'", "]", "/", "(", "res", "[", "'precision'", "]", "+", "res", "[", "'recall'", "]", ")", "\n", "", "else", ":", "\n", "        ", "res", "[", "'rmse'", "]", "=", "np", ".", "sqrt", "(", "np", ".", "mean", "(", "np", ".", "square", "(", "y_test", "-", "y_pred", ")", ")", ")", "\n", "res", "[", "'mae'", "]", "=", "np", ".", "mean", "(", "np", ".", "abs", "(", "y_test", "-", "y_pred", ")", ")", "\n", "res", "[", "'explained_variance_score'", "]", "=", "1", "-", "np", ".", "square", "(", "np", ".", "std", "(", "y_test", "-", "y_pred", ")", ")", "/", "np", ".", "square", "(", "np", ".", "std", "(", "y_test", ")", ")", "\n", "res", "[", "'r2_score'", "]", "=", "1", "-", "np", ".", "sum", "(", "np", ".", "square", "(", "y_test", "-", "y_pred", ")", ")", "/", "np", ".", "sum", "(", "np", ".", "square", "(", "y_test", "-", "np", ".", "mean", "(", "y_test", ")", ")", ")", "\n", "", "print", "(", "' '", ".", "join", "(", "[", "\"%s: %.4f\"", "%", "(", "i", ",", "res", "[", "i", "]", ")", "for", "i", "in", "res", "]", ")", ")", "\n", "return", "res", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.mvm_decision_function": [[255, 263], ["len", "keras.backend.concatenate", "keras.backend.sum", "keras.backend.prod", "range", "keras.backend.stack", "range"], "function", ["None"], ["", "def", "mvm_decision_function", "(", "arg", ")", ":", "\n", "    ", "n_modes", "=", "len", "(", "arg", ")", "\n", "latentx", "=", "arg", "\n", "y", "=", "K", ".", "concatenate", "(", "[", "K", ".", "sum", "(", "\n", "K", ".", "prod", "(", "K", ".", "stack", "(", "[", "latentx", "[", "j", "]", "[", ":", ",", "i", "*", "params", "[", "'n_latent'", "]", ":", "(", "i", "+", "1", ")", "*", "params", "[", "'n_latent'", "]", "]", "for", "j", "in", "range", "(", "n_modes", ")", "]", ")", ",", "\n", "axis", "=", "0", ")", ",", "axis", "=", "-", "1", ",", "keepdims", "=", "True", ")", "for", "i", "in", "range", "(", "params", "[", "'n_classes'", "]", ")", "]", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.fm_decision_function": [[265, 271], ["keras.backend.concatenate", "keras.backend.sum", "keras.backend.tf.stack", "keras.backend.sum", "keras.backend.square", "range"], "function", ["None"], ["", "def", "fm_decision_function", "(", "arg", ")", ":", "\n", "    ", "latentx", ",", "bias", "=", "arg", "[", "0", "]", ",", "arg", "[", "1", "]", "\n", "pairwise", "=", "K", ".", "concatenate", "(", "[", "K", ".", "sum", "(", "K", ".", "square", "(", "latentx", "[", ":", ",", "i", "*", "params", "[", "'n_latent'", "]", ":", "(", "i", "+", "1", ")", "*", "params", "[", "'n_latent'", "]", "]", ")", ",", "axis", "=", "-", "1", ",", "keepdims", "=", "True", ")", "for", "i", "in", "range", "(", "params", "[", "'n_classes'", "]", ")", "]", ")", "\n", "y", "=", "K", ".", "sum", "(", "K", ".", "tf", ".", "stack", "(", "[", "pairwise", ",", "bias", "]", ")", ",", "axis", "=", "0", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.acc": [[273, 275], ["keras.backend.mean", "keras.backend.equal"], "function", ["None"], ["", "def", "acc", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "return", "K", ".", "mean", "(", "K", ".", "equal", "(", "y_true", ">", "0.5", ",", "y_pred", ">", "0.5", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.rmse": [[277, 279], ["keras.backend.sqrt", "keras.backend.mean", "keras.backend.square"], "function", ["None"], ["", "def", "rmse", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "return", "K", ".", "sqrt", "(", "K", ".", "mean", "(", "K", ".", "square", "(", "y_true", "-", "y_pred", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.create_model": [[281, 343], ["Model", "Model.compile", "Model.summary", "train_data[].keys", "train_data[].keys", "merge", "train_data[].keys", "merge", "merge", "Dense", "Dense", "merge", "Dense", "Dense", "RMSprop", "Input", "input_list.append", "output_list.append", "len", "Activation", "Activation", "Input", "input_list.append", "output_list.append", "len", "Activation", "Activation", "Input", "input_list.append", "output_list.append", "Activation", "Activation", "Masking", "Bidirectional", "Dropout", "Masking", "Bidirectional", "Dropout", "Masking", "Bidirectional", "Dropout", "Dense", "GRU", "GRU", "GRU"], "function", ["None"], ["", "def", "create_model", "(", "train_data", ",", "test_data", ",", "params", ")", ":", "\n", "    ", "input_list", "=", "[", "]", "\n", "output_list", "=", "[", "]", "\n", "train_list", "=", "[", "]", "\n", "test_list", "=", "[", "]", "\n", "if", "params", "[", "'idx'", "]", "==", "1", ":", "\n", "        ", "for", "mode", "in", "train_data", "[", "7", "]", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "output_list", ".", "append", "(", "drop_output", ")", "\n", "", "", "x", "=", "merge", "(", "output_list", ",", "mode", "=", "'concat'", ")", "if", "len", "(", "output_list", ")", ">", "1", "else", "output_list", "[", "0", "]", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_classes'", "]", "*", "params", "[", "'n_latent'", "]", ",", "activation", "=", "'relu'", ",", "\n", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "x", ")", "\n", "y", "=", "Dense", "(", "params", "[", "'n_classes'", "]", ",", "bias", "=", "False", ")", "(", "latentx", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "2", ":", "\n", "        ", "for", "mode", "in", "train_data", "[", "7", "]", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "output_list", ".", "append", "(", "drop_output", ")", "\n", "", "", "x", "=", "merge", "(", "output_list", ",", "mode", "=", "'concat'", ")", "if", "len", "(", "output_list", ")", ">", "1", "else", "output_list", "[", "0", "]", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_latent'", "]", "*", "params", "[", "'n_classes'", "]", ",", "bias", "=", "False", ")", "(", "x", ")", "\n", "bias", "=", "Dense", "(", "params", "[", "'n_classes'", "]", ",", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "x", ")", "\n", "y", "=", "merge", "(", "[", "latentx", ",", "bias", "]", ",", "mode", "=", "fm_decision_function", ",", "output_shape", "=", "(", "params", "[", "'n_classes'", "]", ",", ")", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "3", ":", "\n", "        ", "for", "mode", "in", "train_data", "[", "7", "]", ".", "keys", "(", ")", ":", "\n", "            ", "if", "params", "[", "'includes_%s'", "%", "mode", "]", ":", "\n", "                ", "sub_input", "=", "Input", "(", "shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "\n", "input_list", ".", "append", "(", "sub_input", ")", "\n", "mask_input", "=", "Masking", "(", "mask_value", "=", "0", ",", "input_shape", "=", "(", "params", "[", "'seq_max_len'", "]", ",", "train_data", "[", "7", "]", "[", "mode", "]", "[", "0", "]", ".", "shape", "[", "1", "]", ")", ")", "(", "\n", "sub_input", ")", "\n", "sub_output", "=", "Bidirectional", "(", "\n", "GRU", "(", "output_dim", "=", "params", "[", "'n_hidden'", "]", ",", "return_sequences", "=", "False", ",", "consume_less", "=", "'mem'", ")", ")", "(", "mask_input", ")", "\n", "drop_output", "=", "Dropout", "(", "params", "[", "'dropout'", "]", ")", "(", "sub_output", ")", "\n", "latentx", "=", "Dense", "(", "params", "[", "'n_latent'", "]", "*", "params", "[", "'n_classes'", "]", ",", "bias", "=", "True", "if", "params", "[", "'bias'", "]", "else", "False", ")", "(", "\n", "drop_output", ")", "\n", "output_list", ".", "append", "(", "latentx", ")", "\n", "", "", "y", "=", "merge", "(", "output_list", ",", "mode", "=", "mvm_decision_function", ",", "output_shape", "=", "(", "params", "[", "'n_classes'", "]", ",", ")", ")", "\n", "y_act", "=", "Activation", "(", "'sigmoid'", ")", "(", "y", ")", "if", "params", "[", "'is_clf'", "]", "else", "Activation", "(", "'linear'", ")", "(", "y", ")", "\n", "objective", "=", "'binary_crossentropy'", "if", "params", "[", "'is_clf'", "]", "else", "'mean_squared_error'", "\n", "metric", "=", "[", "acc", "]", "if", "params", "[", "'is_clf'", "]", "else", "[", "rmse", "]", "\n", "", "model", "=", "Model", "(", "input", "=", "input_list", ",", "output", "=", "y_act", ")", "\n", "model", ".", "compile", "(", "loss", "=", "objective", ",", "optimizer", "=", "RMSprop", "(", "lr", "=", "params", "[", "'lr'", "]", ")", ",", "metrics", "=", "metric", ")", "\n", "model", ".", "summary", "(", ")", "\n", "return", "model", ",", "train_list", ",", "test_list", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.noniid": [[345, 364], ["numpy.arange", "numpy.asarray", "numpy.vstack", "range", "numpy.array", "set", "list", "range", "range", "numpy.random.choice", "numpy.concatenate", "idxs_labels[].argsort", "set"], "function", ["None"], ["", "def", "noniid", "(", "train_label", ",", "num_users", ")", ":", "\n", "    ", "num_shards", ",", "num_imgs", "=", "8", ",", "1496", "\n", "idx_shard", "=", "[", "i", "for", "i", "in", "range", "(", "num_shards", ")", "]", "\n", "dict_users", "=", "{", "i", ":", "np", ".", "array", "(", "[", "]", ",", "dtype", "=", "'int64'", ")", "for", "i", "in", "range", "(", "num_users", ")", "}", "\n", "idxs", "=", "np", ".", "arange", "(", "num_shards", "*", "num_imgs", ")", "\n", "labels", "=", "np", ".", "asarray", "(", "train_label", ")", "\n", "\n", "# sort labels", "\n", "idxs_labels", "=", "np", ".", "vstack", "(", "(", "idxs", ",", "labels", ")", ")", "\n", "idxs_labels", "=", "idxs_labels", "[", ":", ",", "idxs_labels", "[", "1", ",", ":", "]", ".", "argsort", "(", ")", "]", "\n", "idxs", "=", "idxs_labels", "[", "0", ",", ":", "]", "\n", "\n", "# divide and assign", "\n", "for", "i", "in", "range", "(", "num_users", ")", ":", "\n", "        ", "rand_set", "=", "set", "(", "np", ".", "random", ".", "choice", "(", "idx_shard", ",", "2", ",", "replace", "=", "False", ")", ")", "\n", "idx_shard", "=", "list", "(", "set", "(", "idx_shard", ")", "-", "rand_set", ")", "\n", "for", "rand", "in", "rand_set", ":", "\n", "            ", "dict_users", "[", "i", "]", "=", "np", ".", "concatenate", "(", "(", "dict_users", "[", "i", "]", ",", "idxs", "[", "rand", "*", "num_imgs", ":", "(", "rand", "+", "1", ")", "*", "num_imgs", "]", ")", ",", "axis", "=", "0", ")", "\n", "", "", "return", "dict_users", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.FedAvg": [[365, 394], ["copy.deepcopy", "range", "range", "len", "range", "len", "range", "range", "range", "range", "range", "range", "len", "numpy.zeros", "range", "w_avg.append", "range", "w_avg.append", "len", "range", "len", "range", "numpy.shape", "len", "len", "len", "len", "len", "len", "len", "len"], "function", ["None"], ["", "def", "FedAvg", "(", "w", ",", "lengthdict", ",", "params", ")", ":", "\n", "    ", "w_avg", "=", "[", "]", "\n", "c", "=", "{", "}", "\n", "load", "=", "copy", ".", "deepcopy", "(", "w", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "load", ")", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "len", "(", "load", "[", "i", "]", ")", ")", ":", "\n", "            ", "load", "[", "i", "]", "[", "j", "]", "=", "np", ".", "zeros", "(", "shape", "=", "np", ".", "shape", "(", "load", "[", "i", "]", "[", "j", "]", ")", ")", "\n", "", "", "sum", "=", "0", "\n", "for", "i", "in", "range", "(", "len", "(", "lengthdict", ")", ")", ":", "\n", "        ", "sum", "+=", "lengthdict", "[", "i", "]", "\n", "", "if", "params", "[", "'idx'", "]", "==", "3", ":", "\n", "        ", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "            ", "c", "[", "i", "]", "=", "load", "[", "i", "]", "\n", "", "for", "k", "in", "range", "(", "6", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", ")", ")", ":", "\n", "                ", "for", "j", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", "[", "0", "]", ")", ")", ":", "\n", "                    ", "c", "[", "k", "]", "[", "j", "]", "+=", "w", "[", "k", ":", "len", "(", "w", ")", ":", "6", "]", "[", "i", "]", "[", "j", "]", "*", "lengthdict", "[", "i", "]", "/", "sum", "\n", "", "", "", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "            ", "w_avg", ".", "append", "(", "c", "[", "i", "]", ")", "\n", "", "", "else", ":", "\n", "        ", "for", "i", "in", "range", "(", "5", ")", ":", "\n", "            ", "c", "[", "i", "]", "=", "load", "[", "i", "]", "\n", "", "for", "k", "in", "range", "(", "5", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", ")", ")", ":", "\n", "                ", "for", "j", "in", "range", "(", "len", "(", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", "[", "0", "]", ")", ")", ":", "\n", "                    ", "c", "[", "k", "]", "[", "j", "]", "+=", "w", "[", "k", ":", "len", "(", "w", ")", ":", "5", "]", "[", "i", "]", "[", "j", "]", "*", "lengthdict", "[", "i", "]", "/", "sum", "\n", "", "", "", "for", "i", "in", "range", "(", "5", ")", ":", "\n", "            ", "w_avg", ".", "append", "(", "c", "[", "i", "]", ")", "\n", "", "", "return", "w_avg", "\n", "\n"]], "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.run_model": [[396, 493], ["Fed_mood_fednoniid.create_model", "numpy.random.seed", "range", "range", "numpy.random.seed", "range", "model.evaluate", "res.append", "print", "model.predict", "X_test.append", "range", "numpy.random.choice", "print", "model.layers[].set_weights", "numpy.ravel", "numpy.random.choice", "numpy.random.choice", "numpy.concatenate", "X_train_fed[].append", "range", "random.randint", "Fed_mood_fednoniid.FedAvg", "model.evaluate", "res.append", "print", "Fed_mood_fednoniid.FedAvg", "user.append", "user.append", "user.append", "w_temps.append", "print", "lengthdict.append", "model.layers[].set_weights", "w_temps.append", "print", "lengthdict.append", "numpy.asarray", "copy.deepcopy", "model.layers[].set_weights", "model.fit", "model.fit", "w_locals.append", "len", "copy.deepcopy", "model.layers[].set_weights", "model.fit", "model.fit", "w_locals.append", "len", "numpy.ravel", "model.layers[].get_weights", "copy.deepcopy", "model.layers[].get_weights", "copy.deepcopy", "model.layers[].get_weights", "model.layers[].get_weights"], "function", ["home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.create_model", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.evaluate", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.FedAvg", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.evaluate", "home.repos.pwc.inspect_result.RingBDStack_Fed_mood.None.Fed_mood_fednoniid.FedAvg"], ["", "def", "run_model", "(", "train_data", ",", "test_data", ",", "y_train", ",", "y_test", ",", "params", ")", ":", "\n", "    ", "num", "=", "[", "6", ",", "7", ",", "8", ",", "13", ",", "14", "]", "\n", "X_train", ",", "X_test", "=", "{", "}", ",", "[", "]", "\n", "X_train_fed", ",", "y_train_fed", "=", "{", "}", ",", "{", "}", "\n", "model", ",", "_", ",", "_", "=", "create_model", "(", "train_data", ",", "test_data", ",", "params", ")", "\n", "users", "=", "{", "}", "\n", "users", "[", "0", "]", "=", "[", "24", ",", "25", ",", "39", ",", "40", "]", "\n", "users", "[", "1", "]", "=", "[", "7", ",", "15", ",", "19", ",", "20", ",", "21", ",", "27", "]", "\n", "users", "[", "2", "]", "=", "[", "13", ",", "16", ",", "17", ",", "31", ",", "32", ",", "33", ",", "36", ",", "37", ",", "38", "]", "\n", "np", ".", "random", ".", "seed", "(", "params", "[", "'seed'", "]", ")", "\n", "for", "i", "in", "range", "(", "3", ")", ":", "\n", "        ", "if", "i", "==", "2", ":", "\n", "            ", "users", "[", "i", "]", "=", "np", ".", "random", ".", "choice", "(", "users", "[", "i", "]", ",", "8", ",", "replace", "=", "False", ")", "\n", "", "else", ":", "\n", "            ", "users", "[", "i", "]", "=", "np", ".", "random", ".", "choice", "(", "users", "[", "i", "]", ",", "4", ",", "replace", "=", "False", ")", "\n", "", "", "for", "mode", "in", "modes", ":", "\n", "        ", "X_test", ".", "append", "(", "test_data", "[", "mode", "]", ")", "\n", "", "for", "i", "in", "range", "(", "params", "[", "'num_users'", "]", ")", ":", "\n", "        ", "X_train", "[", "i", "]", ",", "X_train_fed", "[", "i", "]", "=", "{", "}", ",", "[", "]", "\n", "y_train_fed", "[", "i", "]", "=", "[", "]", "\n", "user", "=", "[", "]", "\n", "for", "k", "in", "range", "(", "3", ")", ":", "\n", "            ", "if", "k", "==", "2", ":", "\n", "                ", "b", "=", "i", "*", "2", "\n", "y_train_fed", "[", "i", "]", "+=", "y_train", "[", "users", "[", "k", "]", "[", "b", "]", "]", "\n", "user", ".", "append", "(", "users", "[", "k", "]", "[", "b", "]", ")", "\n", "b", "=", "b", "+", "1", "\n", "y_train_fed", "[", "i", "]", "+=", "y_train", "[", "users", "[", "k", "]", "[", "b", "]", "]", "\n", "user", ".", "append", "(", "users", "[", "k", "]", "[", "b", "]", ")", "\n", "", "else", ":", "\n", "                ", "y_train_fed", "[", "i", "]", "+=", "y_train", "[", "users", "[", "k", "]", "[", "i", "]", "]", "\n", "user", ".", "append", "(", "users", "[", "k", "]", "[", "i", "]", ")", "\n", "", "", "for", "mode", "in", "modes", ":", "\n", "            ", "X_train", "[", "i", "]", "[", "mode", "]", "=", "np", ".", "concatenate", "(", "[", "np", ".", "asarray", "(", "train_data", "[", "j", "]", "[", "mode", "]", ")", "for", "j", "in", "user", "]", ")", "\n", "X_train_fed", "[", "i", "]", ".", "append", "(", "X_train", "[", "i", "]", "[", "mode", "]", ")", "\n", "", "", "np", ".", "random", ".", "seed", "(", "0", ")", "\n", "w_glob", ",", "res", "=", "[", "]", ",", "[", "]", "\n", "for", "iter", "in", "range", "(", "params", "[", "'n_epochs'", "]", ")", ":", "\n", "        ", "w_locals", ",", "w_temps", "=", "[", "]", ",", "[", "]", "\n", "lengthdict", "=", "[", "]", "\n", "idxs_users", "=", "np", ".", "random", ".", "choice", "(", "range", "(", "params", "[", "'num_users'", "]", ")", ",", "random", ".", "randint", "(", "1", ",", "params", "[", "'num_users'", "]", ")", ",", "replace", "=", "False", ")", "\n", "print", "(", "'\u7b2c:'", ",", "iter", ",", "'\u8f6e,\u5171'", ",", "idxs_users", ",", "'\u4e2a\u7528\u6237'", ")", "\n", "if", "iter", "==", "0", ":", "\n", "            ", "for", "i", "in", "num", ":", "\n", "                ", "w_temps", ".", "append", "(", "copy", ".", "deepcopy", "(", "model", ".", "layers", "[", "i", "]", ".", "get_weights", "(", ")", ")", ")", "\n", "", "for", "idx", "in", "idxs_users", ":", "\n", "                ", "print", "(", "'\u7b2c:'", ",", "iter", ",", "'\u8f6e,\u7528\u6237'", ",", "idx", ")", "\n", "j", "=", "0", "\n", "for", "i", "in", "num", ":", "\n", "                    ", "model", ".", "layers", "[", "i", "]", ".", "set_weights", "(", "w_temps", "[", "j", "]", ")", "\n", "j", "+=", "1", "\n", "", "if", "params", "[", "'flag'", "]", "==", "0", ":", "\n", "                    ", "hist", "=", "model", ".", "fit", "(", "x", "=", "X_train_fed", "[", "idx", "]", ",", "y", "=", "y_train_fed", "[", "idx", "]", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "2", ",", "epochs", "=", "params", "[", "'epochs'", "]", ",", "validation_split", "=", "0.2", ")", "\n", "", "else", ":", "\n", "                    ", "hist", "=", "model", ".", "fit", "(", "x", "=", "X_train_fed", "[", "idx", "]", ",", "y", "=", "y_train_fed", "[", "idx", "]", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "2", ",", "epochs", "=", "params", "[", "'epochs'", "]", ",", "validation_split", "=", "0.2", ")", "\n", "", "for", "i", "in", "num", ":", "\n", "                    ", "w_locals", ".", "append", "(", "copy", ".", "deepcopy", "(", "model", ".", "layers", "[", "i", "]", ".", "get_weights", "(", ")", ")", ")", "\n", "", "lengthdict", ".", "append", "(", "len", "(", "X_train_fed", "[", "idx", "]", "[", "0", "]", ")", ")", "\n", "", "w_glob", "=", "FedAvg", "(", "w_locals", ",", "lengthdict", ",", "params", ")", "# update global weights", "\n", "", "else", ":", "\n", "            ", "j", "=", "0", "\n", "for", "i", "in", "num", ":", "\n", "                ", "model", ".", "layers", "[", "i", "]", ".", "set_weights", "(", "w_glob", "[", "j", "]", ")", "\n", "j", "+=", "1", "\n", "", "outcome", "=", "model", ".", "evaluate", "(", "X_test", ",", "y_test", ",", "verbose", "=", "0", ")", "\n", "res", ".", "append", "(", "outcome", "[", "1", "]", ")", "\n", "print", "(", "'\u7b2c:'", ",", "iter", ",", "'\u8f6e,test acc:'", ",", "outcome", ")", "\n", "for", "i", "in", "num", ":", "\n", "                ", "w_temps", ".", "append", "(", "copy", ".", "deepcopy", "(", "model", ".", "layers", "[", "i", "]", ".", "get_weights", "(", ")", ")", ")", "\n", "", "for", "idx", "in", "idxs_users", ":", "\n", "                ", "print", "(", "'\u7b2c:'", ",", "iter", ",", "'\u8f6e,\u7528\u6237'", ",", "idx", ")", "\n", "j", "=", "0", "\n", "for", "i", "in", "num", ":", "\n", "                    ", "model", ".", "layers", "[", "i", "]", ".", "set_weights", "(", "w_temps", "[", "j", "]", ")", "\n", "j", "+=", "1", "\n", "", "if", "params", "[", "'flag'", "]", "==", "0", ":", "\n", "                    ", "hist", "=", "model", ".", "fit", "(", "x", "=", "X_train_fed", "[", "idx", "]", ",", "y", "=", "y_train_fed", "[", "idx", "]", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "2", ",", "epochs", "=", "params", "[", "'epochs'", "]", ",", "validation_split", "=", "0.2", ")", "\n", "", "else", ":", "\n", "                    ", "hist", "=", "model", ".", "fit", "(", "x", "=", "X_train_fed", "[", "idx", "]", ",", "y", "=", "y_train_fed", "[", "idx", "]", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "2", ",", "epochs", "=", "params", "[", "'epochs'", "]", ",", "validation_split", "=", "0.2", ")", "\n", "", "for", "i", "in", "num", ":", "\n", "                    ", "w_locals", ".", "append", "(", "copy", ".", "deepcopy", "(", "model", ".", "layers", "[", "i", "]", ".", "get_weights", "(", ")", ")", ")", "\n", "", "lengthdict", ".", "append", "(", "len", "(", "X_train_fed", "[", "idx", "]", "[", "0", "]", ")", ")", "\n", "", "w_glob", "=", "FedAvg", "(", "w_locals", ",", "lengthdict", ",", "params", ")", "\n", "", "", "j", "=", "0", "\n", "for", "i", "in", "num", ":", "\n", "        ", "model", ".", "layers", "[", "i", "]", ".", "set_weights", "(", "w_glob", "[", "j", "]", ")", "\n", "j", "+=", "1", "\n", "", "outcome", "=", "model", ".", "evaluate", "(", "X_test", ",", "y_test", ",", "verbose", "=", "0", ")", "\n", "res", ".", "append", "(", "outcome", "[", "1", "]", ")", "\n", "print", "(", "'test acc:'", ",", "outcome", ")", "\n", "y_score", "=", "model", ".", "predict", "(", "X_test", ",", "batch_size", "=", "params", "[", "'batch_size'", "]", ",", "verbose", "=", "0", ")", "\n", "y_pred", "=", "(", "np", ".", "ravel", "(", "y_score", ")", ">", "0.5", ")", ".", "astype", "(", "'int32'", ")", "if", "params", "[", "'is_clf'", "]", "else", "np", ".", "ravel", "(", "y_score", ")", "\n", "return", "y_pred", ",", "hist", ".", "history", "\n", "\n"]]}