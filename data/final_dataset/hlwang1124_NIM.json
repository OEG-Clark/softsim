{"home.repos.pwc.inspect_result.hlwang1124_NIM.None.demo.CalibInfo.__init__": [[12, 14], ["demo.CalibInfo._load_calib"], "methods", ["home.repos.pwc.inspect_result.hlwang1124_NIM.None.demo.CalibInfo._load_calib"], ["def", "__init__", "(", "self", ",", "filepath", ")", ":", "\n", "        ", "self", ".", "data", "=", "self", ".", "_load_calib", "(", "filepath", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.hlwang1124_NIM.None.demo.CalibInfo.get_cam_param": [[15, 17], ["None"], "methods", ["None"], ["", "def", "get_cam_param", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "data", "[", "'P2'", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.hlwang1124_NIM.None.demo.CalibInfo.get_baseline": [[18, 22], ["numpy.sqrt", "numpy.array", "numpy.sum"], "methods", ["None"], ["", "def", "get_baseline", "(", "self", ")", ":", "\n", "        ", "T", "=", "(", "self", ".", "data", "[", "'P2'", "]", "-", "self", ".", "data", "[", "'P3'", "]", "\n", ")", ".", "dot", "(", "np", ".", "array", "(", "[", "[", "0", "]", ",", "[", "0", "]", ",", "[", "0", "]", ",", "[", "1", "]", "]", ",", "dtype", "=", "np", ".", "float32", ")", ")", "\n", "return", "np", ".", "sqrt", "(", "np", ".", "sum", "(", "(", "T", "*", "T", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.hlwang1124_NIM.None.demo.CalibInfo._load_calib": [[23, 41], ["demo.CalibInfo._read_calib_file", "numpy.reshape", "numpy.reshape", "numpy.reshape", "numpy.reshape", "numpy.reshape", "numpy.reshape"], "methods", ["home.repos.pwc.inspect_result.hlwang1124_NIM.None.demo.CalibInfo._read_calib_file"], ["", "def", "_load_calib", "(", "self", ",", "filepath", ")", ":", "\n", "        ", "rawdata", "=", "self", ".", "_read_calib_file", "(", "filepath", ")", "\n", "data", "=", "{", "}", "\n", "P0", "=", "np", ".", "reshape", "(", "rawdata", "[", "'P0'", "]", ",", "(", "3", ",", "4", ")", ")", "\n", "P1", "=", "np", ".", "reshape", "(", "rawdata", "[", "'P1'", "]", ",", "(", "3", ",", "4", ")", ")", "\n", "P2", "=", "np", ".", "reshape", "(", "rawdata", "[", "'P2'", "]", ",", "(", "3", ",", "4", ")", ")", "\n", "P3", "=", "np", ".", "reshape", "(", "rawdata", "[", "'P3'", "]", ",", "(", "3", ",", "4", ")", ")", "\n", "R0_rect", "=", "np", ".", "reshape", "(", "rawdata", "[", "'R0_rect'", "]", ",", "(", "3", ",", "3", ")", ")", "\n", "Tr_velo_to_cam", "=", "np", ".", "reshape", "(", "rawdata", "[", "'Tr_velo_to_cam'", "]", ",", "(", "3", ",", "4", ")", ")", "\n", "\n", "data", "[", "'P0'", "]", "=", "P0", "\n", "data", "[", "'P1'", "]", "=", "P1", "\n", "data", "[", "'P2'", "]", "=", "P2", "\n", "data", "[", "'P3'", "]", "=", "P3", "\n", "data", "[", "'R0_rect'", "]", "=", "R0_rect", "\n", "data", "[", "'Tr_velo_to_cam'", "]", "=", "Tr_velo_to_cam", "\n", "\n", "return", "data", "\n", "\n"]], "home.repos.pwc.inspect_result.hlwang1124_NIM.None.demo.CalibInfo._read_calib_file": [[42, 56], ["open", "f.readlines", "line.split", "numpy.array", "float", "value.split"], "methods", ["None"], ["", "def", "_read_calib_file", "(", "self", ",", "filepath", ")", ":", "\n", "        ", "\"\"\"Read in a calibration file and parse into a dictionary\"\"\"", "\n", "data", "=", "{", "}", "\n", "\n", "with", "open", "(", "filepath", ",", "'r'", ")", "as", "f", ":", "\n", "            ", "for", "line", "in", "f", ".", "readlines", "(", ")", ":", "\n", "                ", "key", ",", "value", "=", "line", ".", "split", "(", "':'", ",", "1", ")", "\n", "# The only non-float values in these files are dates, which", "\n", "# we don't care about anyway", "\n", "try", ":", "\n", "                    ", "data", "[", "key", "]", "=", "np", ".", "array", "(", "[", "float", "(", "x", ")", "for", "x", "in", "value", ".", "split", "(", ")", "]", ")", "\n", "", "except", "ValueError", ":", "\n", "                    ", "pass", "\n", "", "", "", "return", "data", "\n", "\n"]], "home.repos.pwc.inspect_result.hlwang1124_NIM.None.demo.NIM.__init__": [[61, 63], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.hlwang1124_NIM.None.demo.NIM.__init__"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", "NIM", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.hlwang1124_NIM.None.demo.NIM.forward": [[64, 162], ["torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "depth.size", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "torch.meshgrid", "v_map.type.type.type", "u_map.type.type.type", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.conv2d", "torch.conv2d", "torch.conv2d", "torch.conv2d", "torch.conv2d", "torch.conv2d", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "range", "torch.atan", "torch.atan", "torch.atan", "torch.atan", "torch.atan", "torch.atan", "torch.atan", "torch.atan", "torch.atan", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "calib.get_cam_param", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "D.view", "torch.tensor.view", "torch.tensor.view", "torch.tensor.view", "D.view", "torch.tensor.view", "torch.tensor.view", "torch.tensor.view", "torch.atan", "torch.atan", "torch.atan", "torch.atan", "torch.atan", "torch.atan", "torch.atan", "torch.atan", "torch.atan", "diffKernelArray[].view", "torch.conv2d", "torch.conv2d", "torch.conv2d", "torch.conv2d", "torch.conv2d", "torch.conv2d", "torch.conv2d", "torch.conv2d", "torch.conv2d", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "X.view", "Y.view", "Z.view", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.isnan", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum"], "methods", ["home.repos.pwc.inspect_result.hlwang1124_NIM.None.demo.CalibInfo.get_cam_param"], ["", "def", "forward", "(", "self", ",", "depth", ",", "calib", ",", "sign_filter", ")", ":", "\n", "        ", "\"\"\"Generate surface normal estimation from depth images\n\n        Args:\n            depth (torch.Tensor): depth image\n            calib (CalibInfo): calibration parameters\n            sign_filter (bool): if True, our NIM will additionally utilize a sign filter\n\n        Returns:\n            torch.Tensor: surface normal estimation\n        \"\"\"", "\n", "camParam", "=", "torch", ".", "tensor", "(", "calib", ".", "get_cam_param", "(", ")", ",", "dtype", "=", "torch", ".", "float32", ")", "\n", "\n", "h", ",", "w", "=", "depth", ".", "size", "(", ")", "\n", "v_map", ",", "u_map", "=", "torch", ".", "meshgrid", "(", "torch", ".", "arange", "(", "h", ")", ",", "torch", ".", "arange", "(", "w", ")", ")", "\n", "v_map", "=", "v_map", ".", "type", "(", "torch", ".", "float32", ")", "\n", "u_map", "=", "u_map", ".", "type", "(", "torch", ".", "float32", ")", "\n", "\n", "Z", "=", "depth", "# h, w", "\n", "Y", "=", "Z", "*", "(", "v_map", "-", "camParam", "[", "1", ",", "2", "]", ")", "/", "camParam", "[", "0", ",", "0", "]", "# h, w", "\n", "X", "=", "Z", "*", "(", "u_map", "-", "camParam", "[", "0", ",", "2", "]", ")", "/", "camParam", "[", "0", ",", "0", "]", "# h, w", "\n", "Z", "[", "Y", "<=", "0", "]", "=", "0", "\n", "Y", "[", "Y", "<=", "0", "]", "=", "0", "\n", "Z", "[", "torch", ".", "isnan", "(", "Z", ")", "]", "=", "0", "\n", "D", "=", "torch", ".", "ones", "(", "h", ",", "w", ")", "/", "Z", "# h, w", "\n", "\n", "Gx", "=", "torch", ".", "tensor", "(", "[", "[", "0", ",", "0", ",", "0", "]", ",", "[", "-", "1", ",", "0", ",", "1", "]", ",", "[", "0", ",", "0", ",", "0", "]", "]", ",", "\n", "dtype", "=", "torch", ".", "float32", ")", "\n", "Gy", "=", "torch", ".", "tensor", "(", "[", "[", "0", ",", "-", "1", ",", "0", "]", ",", "[", "0", ",", "0", ",", "0", "]", ",", "[", "0", ",", "1", ",", "0", "]", "]", ",", "\n", "dtype", "=", "torch", ".", "float32", ")", "\n", "\n", "Gu", "=", "F", ".", "conv2d", "(", "D", ".", "view", "(", "1", ",", "1", ",", "h", ",", "w", ")", ",", "Gx", ".", "view", "(", "1", ",", "1", ",", "3", ",", "3", ")", ",", "padding", "=", "1", ")", "\n", "Gv", "=", "F", ".", "conv2d", "(", "D", ".", "view", "(", "1", ",", "1", ",", "h", ",", "w", ")", ",", "Gy", ".", "view", "(", "1", ",", "1", ",", "3", ",", "3", ")", ",", "padding", "=", "1", ")", "\n", "\n", "nx_t", "=", "Gu", "*", "camParam", "[", "0", ",", "0", "]", "# 1, 1, h, w", "\n", "ny_t", "=", "Gv", "*", "camParam", "[", "1", ",", "1", "]", "# 1, 1, h, w", "\n", "\n", "phi", "=", "torch", ".", "atan", "(", "ny_t", "/", "nx_t", ")", "+", "torch", ".", "ones", "(", "[", "1", ",", "1", ",", "h", ",", "w", "]", ")", "*", "3.141592657", "\n", "a", "=", "torch", ".", "cos", "(", "phi", ")", "\n", "b", "=", "torch", ".", "sin", "(", "phi", ")", "\n", "\n", "diffKernelArray", "=", "torch", ".", "tensor", "(", "[", "[", "0", ",", "-", "1", ",", "0", ",", "0", ",", "1", ",", "0", ",", "0", ",", "0", ",", "0", "]", ",", "\n", "[", "0", ",", "0", ",", "0", ",", "-", "1", ",", "1", ",", "0", ",", "0", ",", "0", ",", "0", "]", ",", "\n", "[", "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "-", "1", ",", "0", ",", "0", ",", "0", "]", ",", "\n", "[", "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0", ",", "0", ",", "-", "1", ",", "0", "]", "]", ",", "dtype", "=", "torch", ".", "float32", ")", "\n", "\n", "nx_volume", "=", "torch", ".", "zeros", "(", "(", "1", ",", "4", ",", "h", ",", "w", ")", ",", "dtype", "=", "torch", ".", "float32", ")", "\n", "ny_volume", "=", "torch", ".", "zeros", "(", "(", "1", ",", "4", ",", "h", ",", "w", ")", ",", "dtype", "=", "torch", ".", "float32", ")", "\n", "nz_volume", "=", "torch", ".", "zeros", "(", "(", "1", ",", "4", ",", "h", ",", "w", ")", ",", "dtype", "=", "torch", ".", "float32", ")", "\n", "\n", "for", "i", "in", "range", "(", "4", ")", ":", "\n", "            ", "diffKernel", "=", "diffKernelArray", "[", "i", "]", ".", "view", "(", "1", ",", "1", ",", "3", ",", "3", ")", "\n", "X_d", "=", "F", ".", "conv2d", "(", "X", ".", "view", "(", "1", ",", "1", ",", "h", ",", "w", ")", ",", "diffKernel", ",", "padding", "=", "1", ")", "\n", "Y_d", "=", "F", ".", "conv2d", "(", "Y", ".", "view", "(", "1", ",", "1", ",", "h", ",", "w", ")", ",", "diffKernel", ",", "padding", "=", "1", ")", "\n", "Z_d", "=", "F", ".", "conv2d", "(", "Z", ".", "view", "(", "1", ",", "1", ",", "h", ",", "w", ")", ",", "diffKernel", ",", "padding", "=", "1", ")", "\n", "\n", "nz_i", "=", "-", "(", "nx_t", "*", "X_d", "+", "ny_t", "*", "Y_d", ")", "/", "Z_d", "\n", "norm", "=", "torch", ".", "sqrt", "(", "nx_t", "*", "nx_t", "+", "ny_t", "*", "ny_t", "+", "nz_i", "*", "nz_i", ")", "\n", "nx_t_i", "=", "nx_t", "/", "norm", "\n", "ny_t_i", "=", "ny_t", "/", "norm", "\n", "nz_t_i", "=", "nz_i", "/", "norm", "\n", "\n", "nx_t_i", "[", "torch", ".", "isnan", "(", "nx_t_i", ")", "]", "=", "0", "\n", "ny_t_i", "[", "torch", ".", "isnan", "(", "ny_t_i", ")", "]", "=", "0", "\n", "nz_t_i", "[", "torch", ".", "isnan", "(", "nz_t_i", ")", "]", "=", "0", "\n", "\n", "nx_volume", "[", "0", ",", "i", ",", ":", ",", ":", "]", "=", "nx_t_i", "\n", "ny_volume", "[", "0", ",", "i", ",", ":", ",", ":", "]", "=", "ny_t_i", "\n", "nz_volume", "[", "0", ",", "i", ",", ":", ",", ":", "]", "=", "nz_t_i", "\n", "\n", "", "if", "sign_filter", ":", "\n", "            ", "nz_volume_pos", "=", "torch", ".", "sum", "(", "nz_volume", ">", "0", ",", "dim", "=", "1", ",", "keepdim", "=", "True", ")", "\n", "nz_volume_neg", "=", "torch", ".", "sum", "(", "nz_volume", "<", "0", ",", "dim", "=", "1", ",", "keepdim", "=", "True", ")", "\n", "pos_mask", "=", "(", "nz_volume_pos", ">=", "nz_volume_neg", ")", "*", "(", "nz_volume", ">", "0", ")", "\n", "neg_mask", "=", "(", "nz_volume_pos", "<", "nz_volume_neg", ")", "*", "(", "nz_volume", "<", "0", ")", "\n", "final_mask", "=", "pos_mask", "|", "neg_mask", "\n", "nx_volume", "*=", "final_mask", "\n", "ny_volume", "*=", "final_mask", "\n", "nz_volume", "*=", "final_mask", "\n", "\n", "", "theta", "=", "torch", ".", "atan", "(", "(", "torch", ".", "sum", "(", "nx_volume", ",", "1", ")", "*", "a", "+", "\n", "torch", ".", "sum", "(", "ny_volume", ",", "1", ")", "*", "b", ")", "/", "torch", ".", "sum", "(", "nz_volume", ",", "1", ")", ")", "\n", "nx", "=", "torch", ".", "sin", "(", "theta", ")", "*", "torch", ".", "cos", "(", "phi", ")", "\n", "ny", "=", "torch", ".", "sin", "(", "theta", ")", "*", "torch", ".", "sin", "(", "phi", ")", "\n", "nz", "=", "torch", ".", "cos", "(", "theta", ")", "\n", "\n", "nx", "[", "torch", ".", "isnan", "(", "nz", ")", "]", "=", "0", "\n", "ny", "[", "torch", ".", "isnan", "(", "nz", ")", "]", "=", "0", "\n", "nz", "[", "torch", ".", "isnan", "(", "nz", ")", "]", "=", "-", "1", "\n", "\n", "sign_map", "=", "torch", ".", "ones", "(", "(", "1", ",", "1", ",", "h", ",", "w", ")", ",", "dtype", "=", "torch", ".", "float32", ")", "\n", "sign_map", "[", "ny", ">", "0", "]", "=", "-", "1", "\n", "\n", "nx", "=", "(", "nx", "*", "sign_map", ")", ".", "squeeze", "(", "dim", "=", "0", ")", "\n", "ny", "=", "(", "ny", "*", "sign_map", ")", ".", "squeeze", "(", "dim", "=", "0", ")", "\n", "nz", "=", "(", "nz", "*", "sign_map", ")", ".", "squeeze", "(", "dim", "=", "0", ")", "\n", "\n", "return", "torch", ".", "cat", "(", "[", "nx", ",", "ny", ",", "nz", "]", ",", "dim", "=", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.hlwang1124_NIM.None.demo.normal_visualization": [[164, 167], ["None"], "function", ["None"], ["", "", "def", "normal_visualization", "(", "normal", ")", ":", "\n", "    ", "normal_vis", "=", "(", "1", "+", "normal", ")", "/", "2", "\n", "return", "normal_vis", "\n", "\n"]]}