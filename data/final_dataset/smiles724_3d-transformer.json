{"home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_all.FullTransformer3D.__init__": [[24, 29], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["    ", "def", "__init__", "(", "self", ",", "encoder", ",", "src_embed", ",", "generator", ")", ":", "\n", "        ", "super", "(", "FullTransformer3D", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "encoder", "=", "encoder", "\n", "self", ".", "src_embed", "=", "src_embed", "\n", "self", ".", "generator", "=", "generator", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_all.FullTransformer3D.forward": [[30, 33], ["tr_all.FullTransformer3D.encoder", "tr_all.FullTransformer3D.generator", "tr_all.FullTransformer3D.src_embed"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "src", ",", "src_mask", ",", "dist", ")", ":", "\n", "        ", "out", "=", "self", ".", "encoder", "(", "self", ".", "src_embed", "(", "src", ")", ",", "dist", ",", "src_mask", ")", "\n", "return", "self", ".", "generator", "(", "out", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_all.build_model": [[9, 21], ["model.tr_msa.MultiScaleMultiHeadedAttention", "model.tr_spe.FeedForward", "tr_all.FullTransformer3D", "FullTransformer3D.parameters", "model.tr_afps.MultiRelationEncoder", "model.tr_spe.Embeddings", "model.tr_spe.Generator3D", "model.tr_afps.EncoderLayer", "p.dim", "torch.init.xavier_uniform_", "c", "c"], "function", ["None"], ["def", "build_model", "(", "vocab", ",", "tgt", ",", "dist_bar", ",", "k", ",", "N", "=", "6", ",", "embed_dim", "=", "512", ",", "ffn_dim", "=", "2048", ",", "head", "=", "8", ",", "dropout", "=", "0.1", ")", ":", "\n", "    ", "assert", "k", ">", "1", "\n", "c", "=", "copy", ".", "deepcopy", "\n", "attn", "=", "MultiScaleMultiHeadedAttention", "(", "head", ",", "embed_dim", ",", "dist_bar", ")", "\n", "ff", "=", "FeedForward", "(", "embed_dim", ",", "ffn_dim", ",", "dropout", ")", "\n", "\n", "model", "=", "FullTransformer3D", "(", "MultiRelationEncoder", "(", "EncoderLayer", "(", "embed_dim", ",", "c", "(", "attn", ")", ",", "c", "(", "ff", ")", ",", "dropout", ")", ",", "N", ",", "k", ")", ",", "\n", "Embeddings", "(", "embed_dim", ",", "vocab", ")", ",", "Generator3D", "(", "embed_dim", ",", "tgt", ",", "dropout", ")", ")", "\n", "for", "p", "in", "model", ".", "parameters", "(", ")", ":", "\n", "        ", "if", "p", ".", "dim", "(", ")", ">", "1", ":", "\n", "            ", "nn", ".", "init", ".", "xavier_uniform_", "(", "p", ")", "\n", "", "", "return", "model", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_afps.MultiRelationTransformer3D.__init__": [[28, 33], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["    ", "def", "__init__", "(", "self", ",", "encoder", ",", "src_embed", ",", "generator", ")", ":", "\n", "        ", "super", "(", "MultiRelationTransformer3D", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "encoder", "=", "encoder", "\n", "self", ".", "src_embed", "=", "src_embed", "\n", "self", ".", "generator", "=", "generator", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_afps.MultiRelationTransformer3D.forward": [[34, 36], ["tr_afps.MultiRelationTransformer3D.generator", "tr_afps.MultiRelationTransformer3D.encoder", "tr_afps.MultiRelationTransformer3D.src_embed"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "src", ",", "src_mask", ",", "dist", ")", ":", "\n", "        ", "return", "self", ".", "generator", "(", "self", ".", "encoder", "(", "self", ".", "src_embed", "(", "src", ")", ",", "dist", ",", "src_mask", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_afps.MultiRelationEncoder.__init__": [[39, 44], ["torch.Module.__init__", "model.tr_spe.clones", "model.tr_spe.LayerNorm"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__", "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.clones"], ["    ", "def", "__init__", "(", "self", ",", "layer", ",", "N", ",", "k", ")", ":", "\n", "        ", "super", "(", "MultiRelationEncoder", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "layers", "=", "clones", "(", "layer", ",", "N", ")", "\n", "self", ".", "norm", "=", "LayerNorm", "(", "layer", ".", "size", ")", "\n", "self", ".", "k", "=", "k", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_afps.MultiRelationEncoder.forward": [[45, 64], ["range", "tr_afps.MultiRelationEncoder.norm", "layer", "len", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "x_batch.append", "x_batch.append", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "tr_afps.AFPS", "torch.mean", "torch.mean", "torch.mean", "torch.mean"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_afps.AFPS"], ["", "def", "forward", "(", "self", ",", "x", ",", "dist", ",", "mask", ")", ":", "\n", "        ", "for", "layer", "in", "self", ".", "layers", ":", "\n", "            ", "x", ",", "scores", "=", "layer", "(", "x", ",", "dist", ",", "mask", ")", "\n", "\n", "# go through every sample in the batch", "\n", "", "x_batch", ",", "dist_batch", ",", "mask_batch", "=", "[", "]", ",", "[", "]", ",", "[", "]", "\n", "for", "i", "in", "range", "(", "len", "(", "dist", ")", ")", ":", "\n", "\n", "# if the molecules have less number of atoms than k, keep them all", "\n", "            ", "if", "torch", ".", "sum", "(", "mask", "[", "i", "]", ")", "<=", "self", ".", "k", ":", "\n", "                ", "x_batch", ".", "append", "(", "torch", ".", "mean", "(", "x", "[", "i", "]", "[", "mask", "[", "i", ",", "0", "]", "]", ",", "dim", "=", "0", ")", ")", "\n", "\n", "", "else", ":", "\n", "                ", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "                    ", "idx", "=", "AFPS", "(", "scores", "[", "i", "]", ",", "dist", "[", "i", "]", ",", "self", ".", "k", ",", "mask", "[", "i", ",", "0", "]", ")", "\n", "\n", "# dim=1\u5219\u4e3aglobal average pooling\uff08generator\u5bf9\u5e94\u8f93\u5165\u7ef4\u5ea6\u4e3ak\uff09\uff0cdim=0\u5c31\u662f\u7b80\u5355\u7684pooling\uff08generator\u5bf9\u5e94\u8f93\u5165\u7ef4\u5ea6\u4e3aembed_dim\uff09", "\n", "", "x_batch", ".", "append", "(", "torch", ".", "mean", "(", "x", "[", "i", ",", "idx", "]", ",", "dim", "=", "0", ")", ")", "\n", "", "", "return", "self", ".", "norm", "(", "torch", ".", "stack", "(", "x_batch", ",", "dim", "=", "0", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_afps.EncoderLayer.__init__": [[67, 75], ["torch.Module.__init__", "model.tr_spe.LayerNorm", "torch.Dropout", "torch.Dropout", "model.tr_spe.SublayerConnection"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["    ", "def", "__init__", "(", "self", ",", "size", ",", "self_attn", ",", "feed_forward", ",", "dropout", ")", ":", "\n", "        ", "super", "(", "EncoderLayer", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "self_attn", "=", "self_attn", "\n", "self", ".", "feed_forward", "=", "feed_forward", "\n", "self", ".", "norm", "=", "LayerNorm", "(", "size", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "dropout", ")", "\n", "self", ".", "sublayer", "=", "SublayerConnection", "(", "size", ",", "dropout", ")", "\n", "self", ".", "size", "=", "size", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_afps.EncoderLayer.forward": [[76, 81], ["tr_afps.EncoderLayer.self_attn", "tr_afps.EncoderLayer.norm", "tr_afps.EncoderLayer.norm", "tr_afps.EncoderLayer.norm", "tr_afps.EncoderLayer.dropout", "tr_afps.EncoderLayer.sublayer"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "dist", ",", "mask", ")", ":", "\n", "        ", "att_out", "=", "self", ".", "self_attn", "(", "self", ".", "norm", "(", "x", ")", ",", "self", ".", "norm", "(", "x", ")", ",", "self", ".", "norm", "(", "x", ")", ",", "dist", ",", "mask", ")", "\n", "scores", "=", "self", ".", "self_attn", ".", "attn", "\n", "x", "=", "x", "+", "self", ".", "dropout", "(", "att_out", ")", "\n", "return", "self", ".", "sublayer", "(", "x", ",", "self", ".", "feed_forward", ")", ",", "scores", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_afps.build_model": [[12, 25], ["model.tr_cpe.MultiHeadedAttention", "model.tr_spe.FeedForward", "tr_afps.MultiRelationTransformer3D", "MultiRelationTransformer3D.parameters", "tr_afps.MultiRelationEncoder", "model.tr_spe.Embeddings", "model.tr_spe.Generator3D", "tr_afps.EncoderLayer", "p.dim", "torch.init.xavier_uniform_", "c", "c"], "function", ["None"], ["def", "build_model", "(", "vocab", ",", "tgt", ",", "k", ",", "N", "=", "6", ",", "embed_dim", "=", "512", ",", "ffn_dim", "=", "2048", ",", "head", "=", "8", ",", "dropout", "=", "0.1", ")", ":", "\n", "# make sure AFPS exists", "\n", "    ", "assert", "k", ">", "1", "\n", "\n", "c", "=", "copy", ".", "deepcopy", "\n", "attn", "=", "MultiHeadedAttention", "(", "head", ",", "embed_dim", ")", "\n", "ff", "=", "FeedForward", "(", "embed_dim", ",", "ffn_dim", ",", "dropout", ")", "\n", "model", "=", "MultiRelationTransformer3D", "(", "MultiRelationEncoder", "(", "EncoderLayer", "(", "embed_dim", ",", "c", "(", "attn", ")", ",", "c", "(", "ff", ")", ",", "dropout", ")", ",", "N", ",", "k", ")", ",", "\n", "Embeddings", "(", "embed_dim", ",", "vocab", ")", ",", "Generator3D", "(", "embed_dim", ",", "tgt", ",", "dropout", ")", ")", "\n", "for", "p", "in", "model", ".", "parameters", "(", ")", ":", "\n", "        ", "if", "p", ".", "dim", "(", ")", ">", "1", ":", "\n", "            ", "nn", ".", "init", ".", "xavier_uniform_", "(", "p", ")", "\n", "", "", "return", "model", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_afps.AFPS": [[87, 115], ["torch.mean", "torch.mean", "torch.sum", "torch.sum", "remaining_points.pop", "len", "torch.argmax().item", "torch.argmax().item", "solution_set.append", "range", "torch.max", "torch.max", "torch.min", "torch.min", "remaining_points.pop", "len", "torch.sum.unsqueeze", "torch.max", "torch.max", "torch.argmax", "torch.argmax"], "function", ["None"], ["", "", "def", "AFPS", "(", "scores", ",", "dist", ",", "k", ",", "mask", "=", "None", ")", ":", "\n", "# \u5408\u5e76\u6240\u6709\u7684head\uff0c\u904d\u5386head\u65f6\u95f4\u6d88\u8017\u5927", "\n", "    ", "scores", "=", "torch", ".", "mean", "(", "scores", ",", "dim", "=", "0", ")", "\n", "\n", "if", "mask", "is", "not", "None", ":", "\n", "        ", "scores", "=", "scores", "[", "mask", "]", "[", ":", ",", "mask", "]", "\n", "dist", "=", "dist", "[", "mask", "]", "[", ":", ",", "mask", "]", "\n", "\n", "# initialize the first point", "\n", "", "scores", "=", "torch", ".", "sum", "(", "scores", ",", "dim", "=", "-", "2", ")", "\n", "\n", "# \u521d\u59cb\u5316\u5019\u9009\u70b9\u548c\u5269\u4f59\u70b9\uff0c\u4ece\u4e2d\u5fc3\u70b9\u5f00\u59cb", "\n", "remaining_points", "=", "[", "i", "for", "i", "in", "range", "(", "len", "(", "dist", ")", ")", "]", "\n", "solution_set", "=", "[", "remaining_points", ".", "pop", "(", "0", ")", "]", "\n", "\n", "# incorporate the distance information", "\n", "dist", "=", "dist", "/", "torch", ".", "max", "(", "dist", ")", "+", "scores", ".", "unsqueeze", "(", "-", "1", ")", "/", "torch", ".", "max", "(", "scores", ")", "*", "0.1", "\n", "\n", "while", "len", "(", "solution_set", ")", "<", "k", ":", "\n", "# \u5f97\u5230\u5019\u9009\u70b9\u548c\u5269\u4f59\u70b9\u7684\u8ddd\u79bb\u77e9\u9635", "\n", "        ", "distances", "=", "dist", "[", "remaining_points", "]", "[", ":", ",", "solution_set", "]", "\n", "\n", "# \u66f4\u65b0\u5269\u4f59\u70b9\u7684\u8ddd\u79bb\uff0c\u9009\u6700\u5927\u7684", "\n", "distances", "=", "torch", ".", "min", "(", "distances", ",", "dim", "=", "-", "1", ")", "[", "0", "]", "\n", "new_point", "=", "torch", ".", "argmax", "(", "distances", ")", ".", "item", "(", ")", "\n", "solution_set", ".", "append", "(", "remaining_points", ".", "pop", "(", "new_point", ")", ")", "\n", "\n", "", "return", "solution_set", "\n", "", ""]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.Transformer3D.__init__": [[36, 42], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["    ", "def", "__init__", "(", "self", ",", "encoder", ",", "src_embed", ",", "src_pe", ",", "generator", ")", ":", "\n", "        ", "super", "(", "Transformer3D", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "encoder", "=", "encoder", "\n", "self", ".", "src_embed", "=", "src_embed", "\n", "self", ".", "src_pe", "=", "src_pe", "\n", "self", ".", "generator", "=", "generator", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.Transformer3D.forward": [[43, 45], ["tr_spe.Transformer3D.generator", "tr_spe.Transformer3D.encoder", "tr_spe.Transformer3D.src_pe", "tr_spe.Transformer3D.src_embed"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "src", ",", "src_mask", ",", "pos", ")", ":", "\n", "        ", "return", "self", ".", "generator", "(", "self", ".", "encoder", "(", "self", ".", "src_pe", "(", "self", ".", "src_embed", "(", "src", ")", ",", "pos", ")", ",", "src_mask", ")", "[", ":", ",", "0", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.Encoder.__init__": [[59, 63], ["torch.Module.__init__", "tr_spe.clones", "tr_spe.LayerNorm"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__", "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.clones"], ["def", "__init__", "(", "self", ",", "layer", ",", "N", ")", ":", "\n", "        ", "super", "(", "Encoder", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "layers", "=", "clones", "(", "layer", ",", "N", ")", "\n", "self", ".", "norm", "=", "LayerNorm", "(", "layer", ".", "size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.Encoder.forward": [[64, 68], ["tr_spe.Encoder.norm", "layer"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "mask", ")", ":", "\n", "        ", "for", "layer", "in", "self", ".", "layers", ":", "\n", "            ", "x", "=", "layer", "(", "x", ",", "mask", ")", "\n", "", "return", "self", ".", "norm", "(", "x", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.EncoderLayer.__init__": [[73, 79], ["torch.Module.__init__", "tr_spe.clones", "tr_spe.SublayerConnection"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__", "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.clones"], ["def", "__init__", "(", "self", ",", "size", ",", "self_attn", ",", "feed_forward", ",", "dropout", ")", ":", "\n", "        ", "super", "(", "EncoderLayer", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "self_attn", "=", "self_attn", "\n", "self", ".", "feed_forward", "=", "feed_forward", "\n", "self", ".", "sublayer", "=", "clones", "(", "SublayerConnection", "(", "size", ",", "dropout", ")", ",", "2", ")", "\n", "self", ".", "size", "=", "size", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.EncoderLayer.forward": [[80, 83], ["tr_spe.EncoderLayer.self_attn"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "mask", ")", ":", "\n", "        ", "x", "=", "self", ".", "sublayer", "[", "0", "]", "(", "x", ",", "lambda", "x", ":", "self", ".", "self_attn", "(", "x", ",", "x", ",", "x", ",", "mask", ")", ")", "\n", "return", "self", ".", "sublayer", "[", "1", "]", "(", "x", ",", "self", ".", "feed_forward", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.LayerNorm.__init__": [[88, 93], ["torch.Module.__init__", "torch.Parameter", "torch.Parameter", "torch.Parameter", "torch.Parameter", "torch.Parameter", "torch.Parameter", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["def", "__init__", "(", "self", ",", "features", ",", "eps", "=", "1e-6", ")", ":", "\n", "        ", "super", "(", "LayerNorm", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "a_2", "=", "nn", ".", "Parameter", "(", "torch", ".", "ones", "(", "features", ")", ")", "\n", "self", ".", "b_2", "=", "nn", ".", "Parameter", "(", "torch", ".", "zeros", "(", "features", ")", ")", "\n", "self", ".", "eps", "=", "eps", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.LayerNorm.forward": [[94, 98], ["x.mean", "x.std"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "mean", "=", "x", ".", "mean", "(", "-", "1", ",", "keepdim", "=", "True", ")", "\n", "std", "=", "x", ".", "std", "(", "-", "1", ",", "keepdim", "=", "True", ")", "+", "self", ".", "eps", "\n", "return", "self", ".", "a_2", "*", "(", "x", "-", "mean", ")", "/", "std", "+", "self", ".", "b_2", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.SublayerConnection.__init__": [[103, 107], ["torch.Module.__init__", "tr_spe.LayerNorm", "torch.Dropout", "torch.Dropout", "torch.Dropout"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["def", "__init__", "(", "self", ",", "size", ",", "dropout", ")", ":", "\n", "        ", "super", "(", "SublayerConnection", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "norm", "=", "LayerNorm", "(", "size", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "dropout", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.SublayerConnection.forward": [[108, 111], ["tr_spe.SublayerConnection.dropout", "sublayer", "tr_spe.SublayerConnection.norm"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "sublayer", ")", ":", "\n", "        ", "\"\"\"Apply residual connection to any sublayer with the same size.\"\"\"", "\n", "return", "x", "+", "self", ".", "dropout", "(", "sublayer", "(", "self", ".", "norm", "(", "x", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.MultiHeadedAttention.__init__": [[130, 141], ["torch.Module.__init__", "tr_spe.clones", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__", "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.clones"], ["    ", "def", "__init__", "(", "self", ",", "h", ",", "embed_dim", ",", "dropout", "=", "0.1", ")", ":", "\n", "        ", "\"\"\"Take in model size and number of heads.\"\"\"", "\n", "super", "(", "MultiHeadedAttention", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "embed_dim", "%", "h", "==", "0", "\n", "self", ".", "h", "=", "h", "\n", "self", ".", "linears", "=", "clones", "(", "nn", ".", "Linear", "(", "embed_dim", ",", "embed_dim", ")", ",", "4", ")", "\n", "self", ".", "attn", "=", "None", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "p", "=", "dropout", ")", "\n", "\n", "# \u9ed8\u8ba4V\u548cK\u7684\u7ef4\u5ea6\u76f8\u540c\uff0c\u7ef4\u5ea6\u4e3aembedding\u7ef4\u5ea6\u9664\u4ee5head\u6570", "\n", "self", ".", "d_k", "=", "embed_dim", "//", "h", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.MultiHeadedAttention.forward": [[142, 156], ["query.size", "tr_spe.attention", "x.transpose().contiguous().view.transpose().contiguous().view.transpose().contiguous().view", "mask.unsqueeze.unsqueeze.unsqueeze", "l().view().transpose", "zip", "x.transpose().contiguous().view.transpose().contiguous().view.transpose().contiguous", "l().view", "x.transpose().contiguous().view.transpose().contiguous().view.transpose", "l"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_msa.attention"], ["", "def", "forward", "(", "self", ",", "query", ",", "key", ",", "value", ",", "mask", "=", "None", ")", ":", "\n", "# expand to H heads", "\n", "        ", "if", "mask", "is", "not", "None", ":", "mask", "=", "mask", ".", "unsqueeze", "(", "1", ")", "\n", "nbatches", "=", "query", ".", "size", "(", "0", ")", "\n", "\n", "# 1) Do all the linear projections in batch from embed_dim => h x d_k", "\n", "query", ",", "key", ",", "value", "=", "[", "l", "(", "x", ")", ".", "view", "(", "nbatches", ",", "-", "1", ",", "self", ".", "h", ",", "self", ".", "d_k", ")", ".", "transpose", "(", "1", ",", "2", ")", "for", "l", ",", "x", "in", "\n", "zip", "(", "self", ".", "linears", ",", "(", "query", ",", "key", ",", "value", ")", ")", "]", "\n", "# 2) Apply attention on all the projected vectors in batch.", "\n", "x", ",", "self", ".", "attn", "=", "attention", "(", "query", ",", "key", ",", "value", ",", "mask", "=", "mask", ",", "dropout", "=", "self", ".", "dropout", ")", "\n", "\n", "# 3) \"Concat\" using a view and apply a final linear.", "\n", "x", "=", "x", ".", "transpose", "(", "1", ",", "2", ")", ".", "contiguous", "(", ")", ".", "view", "(", "nbatches", ",", "-", "1", ",", "self", ".", "h", "*", "self", ".", "d_k", ")", "\n", "return", "self", ".", "linears", "[", "-", "1", "]", "(", "x", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.FeedForward.__init__": [[165, 170], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Dropout", "torch.Dropout", "torch.Dropout"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["def", "__init__", "(", "self", ",", "embed_dim", ",", "ffn_dim", ",", "dropout", "=", "0.1", ")", ":", "\n", "        ", "super", "(", "FeedForward", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "w_1", "=", "nn", ".", "Linear", "(", "embed_dim", ",", "ffn_dim", ")", "\n", "self", ".", "w_2", "=", "nn", ".", "Linear", "(", "ffn_dim", ",", "embed_dim", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "dropout", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.FeedForward.forward": [[171, 173], ["tr_spe.FeedForward.w_2", "tr_spe.FeedForward.dropout", "torch.relu", "torch.relu", "torch.relu", "tr_spe.FeedForward.w_1"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "self", ".", "w_2", "(", "self", ".", "dropout", "(", "F", ".", "relu", "(", "self", ".", "w_1", "(", "x", ")", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.Embeddings.__init__": [[180, 184], ["torch.Module.__init__", "torch.Embedding", "torch.Embedding", "torch.Embedding"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["    ", "def", "__init__", "(", "self", ",", "embed_dim", ",", "vocab", ")", ":", "\n", "        ", "super", "(", "Embeddings", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "embed", "=", "nn", ".", "Embedding", "(", "vocab", ",", "embed_dim", ")", "\n", "self", ".", "embed_dim", "=", "embed_dim", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.Embeddings.forward": [[185, 188], ["tr_spe.Embeddings.embed", "math.sqrt"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "# scale the values of token embedding", "\n", "        ", "return", "self", ".", "embed", "(", "x", ")", "*", "math", ".", "sqrt", "(", "self", ".", "embed_dim", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.Feat_Embedding.__init__": [[191, 199], ["torch.Module.__init__", "tr_spe.Feat_Embedding.creat_embed", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Linear", "torch.Linear", "torch.Linear", "torch.ReLU", "torch.ReLU", "torch.ReLU", "torch.Linear", "torch.Linear", "torch.Linear", "len"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__", "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.Feat_Embedding.creat_embed"], ["    ", "def", "__init__", "(", "self", ",", "src_vocab", ",", "embed_dim", ")", ":", "\n", "        ", "super", "(", "Feat_Embedding", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "feat", "=", "[", "'atomic_radius'", ",", "'atomic_radius_rahm'", ",", "'atomic_volume'", ",", "'atomic_weight'", ",", "'boiling_point'", ",", "'c6'", ",", "\n", "'covalent_radius_cordero'", ",", "'covalent_radius_pyykko'", ",", "'density'", ",", "'dipole_polarizability'", ",", "\n", "'dipole_polarizability_unc'", ",", "'electron_affinity'", "]", "\n", "self", ".", "feat_embed", "=", "self", ".", "creat_embed", "(", "src_vocab", ")", "\n", "self", ".", "feat_linear", "=", "nn", ".", "Sequential", "(", "nn", ".", "Linear", "(", "len", "(", "self", ".", "feat", ")", ",", "embed_dim", ")", ",", "nn", ".", "ReLU", "(", ")", ",", "\n", "nn", ".", "Linear", "(", "embed_dim", ",", "embed_dim", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.Feat_Embedding.creat_embed": [[200, 209], ["range", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.Embedding.from_pretrained", "torch.Embedding.from_pretrained", "torch.Embedding.from_pretrained", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "len", "float", "mendeleev.element"], "methods", ["None"], ["", "def", "creat_embed", "(", "self", ",", "src_vocab", ")", ":", "\n", "        ", "embedding", "=", "[", "]", "\n", "for", "atom", "in", "range", "(", "100", ")", ":", "\n", "            ", "if", "atom", "in", "src_vocab", ":", "\n", "                ", "embedding", ".", "append", "(", "torch", ".", "tensor", "(", "[", "float", "(", "element", "(", "atom", ")", ".", "__dict__", "[", "x", "]", ")", "for", "x", "in", "self", ".", "feat", "]", ")", ".", "unsqueeze", "(", "0", ")", ")", "\n", "", "else", ":", "\n", "                ", "embedding", ".", "append", "(", "torch", ".", "zeros", "(", "len", "(", "self", ".", "feat", ")", ")", ".", "unsqueeze", "(", "0", ")", ")", "\n", "", "", "embedding", "=", "torch", ".", "cat", "(", "embedding", ")", "\n", "return", "nn", ".", "Embedding", ".", "from_pretrained", "(", "embedding", ",", "freeze", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.Feat_Embedding.forward": [[210, 212], ["tr_spe.Feat_Embedding.feat_linear", "tr_spe.Feat_Embedding.feat_embed"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "self", ".", "feat_linear", "(", "self", ".", "feat_embed", "(", "x", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.PositionalEncoding.__init__": [[219, 233], ["torch.Module.__init__", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.arange().unsqueeze", "torch.arange().unsqueeze", "torch.arange().unsqueeze", "torch.arange().unsqueeze", "torch.arange().unsqueeze", "torch.arange().unsqueeze", "torch.arange().unsqueeze", "torch.arange().unsqueeze", "torch.arange().unsqueeze", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "pe.unsqueeze.unsqueeze.unsqueeze", "tr_spe.PositionalEncoding.register_buffer", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "math.log"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["    ", "def", "__init__", "(", "self", ",", "embed_dim", ",", "dropout", ",", "max_len", "=", "1000", ")", ":", "\n", "        ", "super", "(", "PositionalEncoding", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "p", "=", "dropout", ")", "\n", "\n", "# Compute the positional encodings once in log space.", "\n", "pe", "=", "torch", ".", "zeros", "(", "max_len", ",", "embed_dim", ")", "\n", "position", "=", "torch", ".", "arange", "(", "0.", ",", "max_len", ")", ".", "unsqueeze", "(", "1", ")", "\n", "div_term", "=", "torch", ".", "exp", "(", "torch", ".", "arange", "(", "0", ",", "embed_dim", ",", "2", ")", "*", "-", "(", "math", ".", "log", "(", "10000.0", ")", "/", "embed_dim", ")", ")", "\n", "pe", "[", ":", ",", "0", ":", ":", "2", "]", "=", "torch", ".", "sin", "(", "position", "*", "div_term", ")", "\n", "pe", "[", ":", ",", "1", ":", ":", "2", "]", "=", "torch", ".", "cos", "(", "position", "*", "div_term", ")", "\n", "\n", "# \u8c03\u6574PE\u7684\u7ef4\u5ea6\uff0c\u5e76\u5c06\u5176\u5b58\u653e\u5728\u4e0d\u89c6\u4e3a\u6a21\u578b\u53c2\u6570\u7684\u7f13\u51b2\u533a\u5185`", "\n", "pe", "=", "pe", ".", "unsqueeze", "(", "0", ")", "\n", "self", ".", "register_buffer", "(", "'pe'", ",", "pe", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.PositionalEncoding.forward": [[234, 238], ["tr_spe.PositionalEncoding.dropout", "torch.autograd.Variable", "torch.autograd.Variable", "torch.autograd.Variable", "x.size"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "# \u8ba9token embedding\u4e0ePE\u76f4\u63a5\u76f8\u52a0", "\n", "        ", "x", "=", "x", "+", "Variable", "(", "self", ".", "pe", "[", ":", ",", ":", "x", ".", "size", "(", "1", ")", "]", ",", "requires_grad", "=", "False", ")", "\n", "return", "self", ".", "dropout", "(", "x", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.SinusoidalPositionEncoding3D.__init__": [[241, 245], ["torch.Module.__init__", "torch.Dropout", "torch.Dropout", "torch.Dropout"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["    ", "def", "__init__", "(", "self", ",", "embed_dim", ",", "dropout", ")", ":", "\n", "        ", "super", "(", "SinusoidalPositionEncoding3D", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "p", "=", "dropout", ")", "\n", "self", ".", "embed_dim", "=", "embed_dim", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.SinusoidalPositionEncoding3D.forward": [[246, 258], ["torch.exp().double().cuda", "torch.exp().double().cuda", "torch.exp().double().cuda", "torch.exp().double().cuda", "torch.exp().double().cuda", "torch.exp().double().cuda", "torch.exp().double().cuda", "torch.exp().double().cuda", "torch.exp().double().cuda", "range", "tr_spe.SinusoidalPositionEncoding3D.dropout", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.autograd.Variable", "torch.autograd.Variable", "torch.autograd.Variable", "torch.exp().double", "torch.exp().double", "torch.exp().double", "torch.exp().double", "torch.exp().double", "torch.exp().double", "torch.exp().double", "torch.exp().double", "torch.exp().double", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "pos[].unsqueeze", "pos[].unsqueeze", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "math.log"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "pos", ")", ":", "\n", "# \u6269\u5927\u5750\u6807\u7684\u91cf\u7ea7", "\n", "        ", "pos", "=", "pos", "*", "10", "\n", "\n", "# sum PE with token embeddings", "\n", "div", "=", "torch", ".", "exp", "(", "torch", ".", "arange", "(", "0.", ",", "self", ".", "embed_dim", ",", "2", ")", "*", "-", "(", "math", ".", "log", "(", "10000.0", ")", "/", "self", ".", "embed_dim", ")", ")", ".", "double", "(", ")", ".", "cuda", "(", ")", "\n", "for", "i", "in", "range", "(", "3", ")", ":", "\n", "            ", "pe", "=", "torch", ".", "zeros", "(", "x", ".", "shape", ")", ".", "cuda", "(", ")", "\n", "pe", "[", "...", ",", "0", ":", ":", "2", "]", "=", "torch", ".", "sin", "(", "pos", "[", "...", ",", "i", "]", ".", "unsqueeze", "(", "2", ")", "*", "div", ")", "\n", "pe", "[", "...", ",", "1", ":", ":", "2", "]", "=", "torch", ".", "cos", "(", "pos", "[", "...", ",", "i", "]", ".", "unsqueeze", "(", "2", ")", "*", "div", ")", "\n", "x", "+=", "Variable", "(", "pe", ",", "requires_grad", "=", "False", ")", "\n", "", "return", "self", ".", "dropout", "(", "x", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.Generator3D.__init__": [[265, 269], ["torch.Module.__init__", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Linear", "torch.Linear", "torch.Linear", "torch.ReLU", "torch.ReLU", "torch.ReLU", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["    ", "def", "__init__", "(", "self", ",", "embed_dim", ",", "tgt", ",", "dropout", ")", ":", "\n", "        ", "super", "(", "Generator3D", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "proj", "=", "nn", ".", "Sequential", "(", "nn", ".", "Linear", "(", "embed_dim", ",", "embed_dim", ")", ",", "nn", ".", "ReLU", "(", ")", ",", "nn", ".", "Dropout", "(", "p", "=", "dropout", ")", ",", "\n", "nn", ".", "Linear", "(", "embed_dim", ",", "tgt", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.Generator3D.forward": [[270, 272], ["tr_spe.Generator3D.proj"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "self", ".", "proj", "(", "x", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.build_model": [[19, 33], ["tr_spe.MultiHeadedAttention", "tr_spe.FeedForward", "tr_spe.SinusoidalPositionEncoding3D", "tr_spe.Transformer3D", "Transformer3D.parameters", "tr_spe.Encoder", "tr_spe.Embeddings", "c", "tr_spe.Generator3D", "tr_spe.EncoderLayer", "p.dim", "torch.init.xavier_uniform_", "c", "c"], "function", ["None"], ["def", "build_model", "(", "vocab", ",", "tgt", ",", "N", "=", "6", ",", "embed_dim", "=", "512", ",", "ffn_dim", "=", "2048", ",", "head", "=", "8", ",", "dropout", "=", "0.1", ")", ":", "\n", "    ", "c", "=", "copy", ".", "deepcopy", "\n", "attn", "=", "MultiHeadedAttention", "(", "head", ",", "embed_dim", ")", "\n", "ff", "=", "FeedForward", "(", "embed_dim", ",", "ffn_dim", ",", "dropout", ")", "\n", "position", "=", "SinusoidalPositionEncoding3D", "(", "embed_dim", ",", "dropout", ")", "\n", "\n", "# initialize model", "\n", "model", "=", "Transformer3D", "(", "Encoder", "(", "EncoderLayer", "(", "embed_dim", ",", "c", "(", "attn", ")", ",", "c", "(", "ff", ")", ",", "dropout", ")", ",", "N", ")", ",", "Embeddings", "(", "embed_dim", ",", "vocab", ")", ",", "\n", "c", "(", "position", ")", ",", "Generator3D", "(", "embed_dim", ",", "tgt", ",", "dropout", ")", ")", "\n", "for", "p", "in", "model", ".", "parameters", "(", ")", ":", "\n", "        ", "if", "p", ".", "dim", "(", ")", ">", "1", ":", "\n", "            ", "nn", ".", "init", ".", "xavier_uniform_", "(", "p", ")", "\n", "\n", "", "", "return", "model", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.clones": [[47, 50], ["torch.ModuleList", "copy.deepcopy", "range"], "function", ["None"], ["", "", "def", "clones", "(", "module", ",", "N", ")", ":", "\n", "    ", "\"\"\"Produce N identical layers.\"\"\"", "\n", "return", "nn", ".", "ModuleList", "(", "[", "copy", ".", "deepcopy", "(", "module", ")", "for", "_", "in", "range", "(", "N", ")", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_spe.attention": [[117, 127], ["query.size", "torch.softmax", "torch.matmul", "torch.matmul", "torch.matmul", "math.sqrt", "scores.masked_fill.masked_fill", "dropout", "torch.matmul", "torch.matmul", "torch.matmul", "key.transpose"], "function", ["None"], ["", "", "def", "attention", "(", "query", ",", "key", ",", "value", ",", "mask", "=", "None", ",", "dropout", "=", "None", ")", ":", "\n", "    ", "\"\"\"Compute 'Scaled Dot Product Attention'\"\"\"", "\n", "d_k", "=", "query", ".", "size", "(", "-", "1", ")", "\n", "scores", "=", "torch", ".", "matmul", "(", "query", ",", "key", ".", "transpose", "(", "-", "2", ",", "-", "1", ")", ")", "/", "math", ".", "sqrt", "(", "d_k", ")", "\n", "if", "mask", "is", "not", "None", ":", "\n", "        ", "scores", "=", "scores", ".", "masked_fill", "(", "mask", "==", "0", ",", "-", "1e9", ")", "\n", "", "p_attn", "=", "F", ".", "softmax", "(", "scores", ",", "dim", "=", "-", "1", ")", "\n", "if", "dropout", "is", "not", "None", ":", "\n", "        ", "p_attn", "=", "dropout", "(", "p_attn", ")", "\n", "", "return", "torch", ".", "matmul", "(", "p_attn", ",", "value", ")", ",", "p_attn", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_cpe.MultiRepresentationTransformer3D.__init__": [[28, 33], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["    ", "def", "__init__", "(", "self", ",", "encoder", ",", "src_embed", ",", "generator", ")", ":", "\n", "        ", "super", "(", "MultiRepresentationTransformer3D", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "encoder", "=", "encoder", "\n", "self", ".", "src_embed", "=", "src_embed", "\n", "self", ".", "generator", "=", "generator", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_cpe.MultiRepresentationTransformer3D.forward": [[34, 36], ["tr_cpe.MultiRepresentationTransformer3D.generator", "tr_cpe.MultiRepresentationTransformer3D.encoder", "tr_cpe.MultiRepresentationTransformer3D.src_embed"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "src", ",", "src_mask", ",", "dist", ")", ":", "\n", "        ", "return", "self", ".", "generator", "(", "self", ".", "encoder", "(", "self", ".", "src_embed", "(", "src", ")", ",", "dist", ",", "src_mask", ")", "[", ":", ",", "0", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_cpe.Encoder.__init__": [[41, 45], ["torch.Module.__init__", "model.tr_spe.clones", "model.tr_spe.LayerNorm"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__", "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.clones"], ["def", "__init__", "(", "self", ",", "layer", ",", "N", ")", ":", "\n", "        ", "super", "(", "Encoder", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "layers", "=", "clones", "(", "layer", ",", "N", ")", "\n", "self", ".", "norm", "=", "LayerNorm", "(", "layer", ".", "size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_cpe.Encoder.forward": [[46, 50], ["tr_cpe.Encoder.norm", "layer"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "dist", ",", "mask", ")", ":", "\n", "        ", "for", "layer", "in", "self", ".", "layers", ":", "\n", "            ", "x", "=", "layer", "(", "x", ",", "dist", ",", "mask", ")", "\n", "", "return", "self", ".", "norm", "(", "x", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_cpe.EncoderLayer.__init__": [[55, 61], ["torch.Module.__init__", "model.tr_spe.clones", "model.tr_spe.SublayerConnection"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__", "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.clones"], ["def", "__init__", "(", "self", ",", "size", ",", "self_attn", ",", "feed_forward", ",", "dropout", ")", ":", "\n", "        ", "super", "(", "EncoderLayer", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "self_attn", "=", "self_attn", "\n", "self", ".", "feed_forward", "=", "feed_forward", "\n", "self", ".", "sublayer", "=", "clones", "(", "SublayerConnection", "(", "size", ",", "dropout", ")", ",", "2", ")", "\n", "self", ".", "size", "=", "size", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_cpe.EncoderLayer.forward": [[62, 65], ["tr_cpe.EncoderLayer.self_attn"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "dist", ",", "mask", ")", ":", "\n", "        ", "x", "=", "self", ".", "sublayer", "[", "0", "]", "(", "x", ",", "lambda", "x", ":", "self", ".", "self_attn", "(", "x", ",", "x", ",", "x", ",", "dist", ",", "mask", ")", ")", "\n", "return", "self", ".", "sublayer", "[", "1", "]", "(", "x", ",", "self", ".", "feed_forward", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_cpe.MultiHeadedAttention.__init__": [[85, 98], ["torch.Module.__init__", "model.tr_spe.clones", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.ReLU", "torch.ReLU", "torch.ReLU", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__", "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.clones"], ["    ", "def", "__init__", "(", "self", ",", "h", ",", "embed_dim", ",", "dropout", "=", "0.1", ")", ":", "\n", "        ", "super", "(", "MultiHeadedAttention", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "embed_dim", "%", "h", "==", "0", "\n", "# four linear layers", "\n", "self", ".", "linears", "=", "clones", "(", "nn", ".", "Linear", "(", "embed_dim", ",", "embed_dim", ")", ",", "4", ")", "\n", "\n", "# 1 * 1 convolution operator", "\n", "self", ".", "cnn", "=", "nn", ".", "Sequential", "(", "nn", ".", "Conv2d", "(", "1", ",", "h", ",", "kernel_size", "=", "1", ")", ",", "nn", ".", "ReLU", "(", ")", ",", "nn", ".", "Conv2d", "(", "h", ",", "h", ",", "kernel_size", "=", "1", ")", ")", "\n", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "p", "=", "dropout", ")", "\n", "self", ".", "d_k", "=", "embed_dim", "//", "h", "\n", "self", ".", "h", "=", "h", "\n", "self", ".", "attn", "=", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_cpe.MultiHeadedAttention.forward": [[99, 117], ["query.size", "tr_cpe.MultiHeadedAttention.cnn", "tr_cpe.attention", "x.transpose().contiguous().view.transpose().contiguous().view.transpose().contiguous().view", "mask.unsqueeze.unsqueeze.unsqueeze", "l().view().transpose", "tr_cpe.MultiHeadedAttention.unsqueeze", "zip", "x.transpose().contiguous().view.transpose().contiguous().view.transpose().contiguous", "l().view", "x.transpose().contiguous().view.transpose().contiguous().view.transpose", "l"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_msa.attention"], ["", "def", "forward", "(", "self", ",", "query", ",", "key", ",", "value", ",", "dist_conv", ",", "mask", "=", "None", ")", ":", "\n", "        ", "if", "mask", "is", "not", "None", ":", "\n", "            ", "mask", "=", "mask", ".", "unsqueeze", "(", "1", ")", "\n", "", "nbatches", "=", "query", ".", "size", "(", "0", ")", "\n", "\n", "# 1) Do all the linear projections in batch from (B, embed_dim) => (B, head, N, d_k)", "\n", "query", ",", "key", ",", "value", "=", "[", "l", "(", "x", ")", ".", "view", "(", "nbatches", ",", "-", "1", ",", "self", ".", "h", ",", "self", ".", "d_k", ")", ".", "transpose", "(", "1", ",", "2", ")", "for", "l", ",", "x", "in", "\n", "zip", "(", "self", ".", "linears", ",", "(", "query", ",", "key", ",", "value", ")", ")", "]", "\n", "\n", "# dist\u7ef4\u5ea6\u4ece(B, N, N)\u6269\u5c55\u4e3a(B,1,N,N)\u540e\u8f93\u5165CNN\u4e2d", "\n", "dist_conv", "=", "self", ".", "cnn", "(", "dist_conv", ".", "unsqueeze", "(", "1", ")", ")", "\n", "\n", "# 2) Apply attention on all the projected vectors in batch.", "\n", "x", ",", "self", ".", "attn", "=", "attention", "(", "query", ",", "key", ",", "value", ",", "dist_conv", ",", "mask", "=", "mask", ",", "dropout", "=", "self", ".", "dropout", ")", "\n", "\n", "# 3) \"Concat\" using a view and apply a final linear.", "\n", "x", "=", "x", ".", "transpose", "(", "1", ",", "2", ")", ".", "contiguous", "(", ")", ".", "view", "(", "nbatches", ",", "-", "1", ",", "self", ".", "h", "*", "self", ".", "d_k", ")", "\n", "return", "self", ".", "linears", "[", "-", "1", "]", "(", "x", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_cpe.build_model": [[15, 25], ["tr_cpe.MultiHeadedAttention", "model.tr_spe.FeedForward", "tr_cpe.MultiRepresentationTransformer3D", "MultiRepresentationTransformer3D.parameters", "tr_cpe.Encoder", "model.tr_spe.Embeddings", "model.tr_spe.Generator3D", "tr_cpe.EncoderLayer", "p.dim", "torch.init.xavier_uniform_", "c", "c"], "function", ["None"], ["def", "build_model", "(", "vocab", ",", "tgt", ",", "N", "=", "6", ",", "embed_dim", "=", "512", ",", "ffn_dim", "=", "2048", ",", "head", "=", "8", ",", "dropout", "=", "0.1", ")", ":", "\n", "    ", "c", "=", "copy", ".", "deepcopy", "\n", "attn", "=", "MultiHeadedAttention", "(", "head", ",", "embed_dim", ")", "\n", "ff", "=", "FeedForward", "(", "embed_dim", ",", "ffn_dim", ",", "dropout", ")", "\n", "model", "=", "MultiRepresentationTransformer3D", "(", "Encoder", "(", "EncoderLayer", "(", "embed_dim", ",", "c", "(", "attn", ")", ",", "c", "(", "ff", ")", ",", "dropout", ")", ",", "N", ")", ",", "\n", "Embeddings", "(", "embed_dim", ",", "vocab", ")", ",", "Generator3D", "(", "embed_dim", ",", "tgt", ",", "dropout", ")", ")", "\n", "for", "p", "in", "model", ".", "parameters", "(", ")", ":", "\n", "        ", "if", "p", ".", "dim", "(", ")", ">", "1", ":", "\n", "            ", "nn", ".", "init", ".", "xavier_uniform_", "(", "p", ")", "\n", "", "", "return", "model", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_cpe.attention": [[71, 82], ["query.size", "torch.softmax", "torch.matmul", "torch.matmul", "torch.matmul", "math.sqrt", "scores.masked_fill.masked_fill", "dropout", "torch.matmul", "torch.matmul", "torch.matmul", "key.transpose"], "function", ["None"], ["", "", "def", "attention", "(", "query", ",", "key", ",", "value", ",", "dist_conv", ",", "mask", "=", "None", ",", "dropout", "=", "None", ")", ":", "\n", "    ", "d_k", "=", "query", ".", "size", "(", "-", "1", ")", "\n", "scores", "=", "torch", ".", "matmul", "(", "query", ",", "key", ".", "transpose", "(", "-", "2", ",", "-", "1", ")", ")", "/", "math", ".", "sqrt", "(", "d_k", ")", "\n", "scores", "*=", "dist_conv", "\n", "\n", "if", "mask", "is", "not", "None", ":", "\n", "        ", "scores", "=", "scores", ".", "masked_fill", "(", "mask", "==", "0", ",", "-", "1e9", ")", "\n", "", "p_attn", "=", "F", ".", "softmax", "(", "scores", ",", "dim", "=", "-", "1", ")", "\n", "if", "dropout", "is", "not", "None", ":", "\n", "        ", "p_attn", "=", "dropout", "(", "p_attn", ")", "\n", "", "return", "torch", ".", "matmul", "(", "p_attn", ",", "value", ")", ",", "p_attn", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_msa.MultiScaleTransformer3D.__init__": [[28, 34], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["    ", "def", "__init__", "(", "self", ",", "encoder", ",", "src_embed", ",", "generator", ",", "feat_embed", ")", ":", "\n", "        ", "super", "(", "MultiScaleTransformer3D", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "encoder", "=", "encoder", "\n", "self", ".", "src_embed", "=", "src_embed", "\n", "self", ".", "feat_embed", "=", "feat_embed", "\n", "self", ".", "generator", "=", "generator", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_msa.MultiScaleTransformer3D.forward": [[35, 39], ["tr_msa.MultiScaleTransformer3D.src_embed", "tr_msa.MultiScaleTransformer3D.generator", "tr_msa.MultiScaleTransformer3D.feat_embed", "tr_msa.MultiScaleTransformer3D.encoder"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "src", ",", "src_mask", ",", "dist", ")", ":", "\n", "        ", "x", "=", "self", ".", "src_embed", "(", "src", ")", "\n", "if", "self", ".", "feat_embed", ":", "x", "+=", "self", ".", "feat_embed", "(", "src", ")", "\n", "return", "self", ".", "generator", "(", "self", ".", "encoder", "(", "x", ",", "dist", ",", "src_mask", ")", "[", ":", ",", "0", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_msa.MultiScaleMultiHeadedAttention.__init__": [[72, 89], ["torch.Module.__init__", "model.tr_spe.clones", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.ReLU", "torch.ReLU", "torch.ReLU", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Linear", "torch.Linear", "torch.Linear", "torch.ReLU", "torch.ReLU", "torch.ReLU", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.Linear", "torch.Linear", "torch.Linear", "len"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__", "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.clones"], ["    ", "def", "__init__", "(", "self", ",", "h", ",", "embed_dim", ",", "dist_bar", ",", "dropout", "=", "0.1", ")", ":", "\n", "        ", "super", "(", "MultiScaleMultiHeadedAttention", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "embed_dim", "%", "h", "==", "0", "\n", "# 4\u4e2a\u7ebf\u6027\u5c42", "\n", "self", ".", "linears", "=", "clones", "(", "nn", ".", "Linear", "(", "embed_dim", ",", "embed_dim", ")", ",", "4", ")", "\n", "\n", "# \u5904\u7406\u8ddd\u79bb\u77e9\u9635\u76841 * 1\u5377\u79ef", "\n", "self", ".", "cnn", "=", "nn", ".", "Sequential", "(", "nn", ".", "Conv2d", "(", "1", ",", "h", ",", "kernel_size", "=", "1", ")", ",", "nn", ".", "ReLU", "(", ")", ",", "nn", ".", "Conv2d", "(", "h", ",", "h", ",", "kernel_size", "=", "1", ")", ")", "\n", "\n", "# \u8f6c\u6362\u4e0d\u540c\u5c3a\u5ea6cat\u540e\u7684\u5411\u91cf\u7ef4\u5ea6", "\n", "self", ".", "scale_linear", "=", "nn", ".", "Sequential", "(", "nn", ".", "Linear", "(", "(", "len", "(", "dist_bar", ")", "+", "1", ")", "*", "embed_dim", ",", "embed_dim", ")", ",", "nn", ".", "ReLU", "(", ")", ",", "\n", "nn", ".", "Dropout", "(", "p", "=", "dropout", ")", ",", "nn", ".", "Linear", "(", "embed_dim", ",", "embed_dim", ")", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "p", "=", "dropout", ")", "\n", "self", ".", "dist_bar", "=", "dist_bar", "+", "[", "1e10", "]", "\n", "self", ".", "d_k", "=", "embed_dim", "//", "h", "\n", "self", ".", "h", "=", "h", "\n", "self", ".", "attn", "=", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_msa.MultiScaleMultiHeadedAttention.forward": [[90, 113], ["query.size", "dist.unsqueeze.unsqueeze.unsqueeze", "tr_msa.MultiScaleMultiHeadedAttention.cnn", "tr_msa.attention", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "tr_msa.MultiScaleMultiHeadedAttention.scale_linear", "mask.unsqueeze.unsqueeze.unsqueeze", "l().view().transpose", "torch.cat.transpose().contiguous().view", "torch.cat.transpose().contiguous().view", "torch.cat.transpose().contiguous().view", "zip", "l().view", "torch.cat.transpose().contiguous", "torch.cat.transpose().contiguous", "torch.cat.transpose().contiguous", "l", "torch.cat.transpose", "torch.cat.transpose", "torch.cat.transpose"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_msa.attention"], ["", "def", "forward", "(", "self", ",", "query", ",", "key", ",", "value", ",", "dist", ",", "mask", "=", "None", ")", ":", "\n", "        ", "if", "mask", "is", "not", "None", ":", "\n", "            ", "mask", "=", "mask", ".", "unsqueeze", "(", "1", ")", "\n", "", "nbatches", "=", "query", ".", "size", "(", "0", ")", "\n", "\n", "# 1) Do all the linear projections in batch from (B, embed_dim) => (B, head, N, d_k)", "\n", "query", ",", "key", ",", "value", "=", "[", "l", "(", "x", ")", ".", "view", "(", "nbatches", ",", "-", "1", ",", "self", ".", "h", ",", "self", ".", "d_k", ")", ".", "transpose", "(", "1", ",", "2", ")", "for", "l", ",", "x", "in", "\n", "zip", "(", "self", ".", "linears", ",", "(", "query", ",", "key", ",", "value", ")", ")", "]", "\n", "\n", "# dist\u7ef4\u5ea6\u4ece(B,N,N)\u6269\u5c55\u4e3a(B,1,N,N)\u540e\u8f93\u5165CNN\u4e2d\uff0c\u5f97\u5230dist_conv", "\n", "dist", "=", "dist", ".", "unsqueeze", "(", "1", ")", "\n", "dist_conv", "=", "self", ".", "cnn", "(", "dist", ")", "\n", "\n", "# 2) Apply attention on all the projected vectors in batch.", "\n", "x_list", ",", "self", ".", "attn", "=", "attention", "(", "query", ",", "key", ",", "value", ",", "dist_conv", ",", "dist", ",", "\n", "self", ".", "dist_bar", ",", "mask", "=", "mask", ",", "dropout", "=", "self", ".", "dropout", ")", "\n", "\n", "# 3) \"Concat\" using a view and apply a final linear.", "\n", "x_list", "=", "[", "x", ".", "transpose", "(", "1", ",", "2", ")", ".", "contiguous", "(", ")", ".", "view", "(", "nbatches", ",", "-", "1", ",", "self", ".", "h", "*", "self", ".", "d_k", ")", "for", "x", "in", "x_list", "]", "\n", "\n", "# 4) concat\u4e0d\u540c\u5c3a\u5ea6\u7684attention\u5411\u91cf\uff0c\u7ef4\u5ea6\u4e3a(B, N, (len(dist_bar) + 1) * d_k)", "\n", "x", "=", "torch", ".", "cat", "(", "[", "self", ".", "linears", "[", "-", "1", "]", "(", "x", ")", "for", "x", "in", "x_list", "]", ",", "dim", "=", "-", "1", ")", "\n", "return", "self", ".", "scale_linear", "(", "x", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_msa.build_model": [[12, 25], ["tr_msa.MultiScaleMultiHeadedAttention", "model.tr_spe.FeedForward", "tr_msa.MultiScaleTransformer3D", "MultiScaleTransformer3D.parameters", "model.tr_spe.Feat_Embedding", "model.tr_cpe.Encoder", "model.tr_spe.Embeddings", "model.tr_spe.Generator3D", "model.tr_cpe.EncoderLayer", "p.dim", "torch.init.xavier_uniform_", "c", "c"], "function", ["None"], ["def", "build_model", "(", "vocab", ",", "tgt", ",", "dist_bar", ",", "N", "=", "6", ",", "embed_dim", "=", "512", ",", "ffn_dim", "=", "2048", ",", "head", "=", "8", ",", "dropout", "=", "0.1", ",", "extra_feat", "=", "None", ")", ":", "\n", "    ", "c", "=", "copy", ".", "deepcopy", "\n", "attn", "=", "MultiScaleMultiHeadedAttention", "(", "head", ",", "embed_dim", ",", "dist_bar", ")", "\n", "ff", "=", "FeedForward", "(", "embed_dim", ",", "ffn_dim", ",", "dropout", ")", "\n", "if", "extra_feat", ":", "extra_feat", "=", "Feat_Embedding", "(", "extra_feat", ",", "embed_dim", ")", "\n", "\n", "model", "=", "MultiScaleTransformer3D", "(", "Encoder", "(", "EncoderLayer", "(", "embed_dim", ",", "c", "(", "attn", ")", ",", "c", "(", "ff", ")", ",", "dropout", ")", ",", "N", ")", ",", "\n", "Embeddings", "(", "embed_dim", ",", "vocab", ")", ",", "Generator3D", "(", "embed_dim", ",", "tgt", ",", "dropout", ")", ",", "\n", "extra_feat", ")", "\n", "for", "p", "in", "model", ".", "parameters", "(", ")", ":", "\n", "        ", "if", "p", ".", "dim", "(", ")", ">", "1", ":", "\n", "            ", "nn", ".", "init", ".", "xavier_uniform_", "(", "p", ")", "\n", "", "", "return", "model", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_msa.attention": [[45, 69], ["torch.matmul", "torch.matmul", "torch.matmul", "math.sqrt", "scores.masked_fill.masked_fill", "scores.masked_fill.masked_fill", "torch.softmax", "out.append", "key.transpose", "query.size", "dropout", "torch.matmul", "torch.matmul", "torch.matmul"], "function", ["None"], ["", "", "def", "attention", "(", "query", ",", "key", ",", "value", ",", "dist_conv", ",", "dist", ",", "dist_bar", ",", "mask", "=", "None", ",", "dropout", "=", "None", ")", ":", "\n", "    ", "scores", "=", "torch", ".", "matmul", "(", "query", ",", "key", ".", "transpose", "(", "-", "2", ",", "-", "1", ")", ")", "/", "math", ".", "sqrt", "(", "query", ".", "size", "(", "-", "1", ")", ")", "\n", "scores", "*=", "dist_conv", "\n", "\n", "if", "mask", "is", "not", "None", ":", "\n", "        ", "scores", "=", "scores", ".", "masked_fill", "(", "mask", "==", "0", ",", "-", "1e10", ")", "\n", "\n", "# \u591a\u5c3a\u5ea6\u6ce8\u610f\u529bmask", "\n", "", "out", "=", "[", "]", "\n", "for", "i", "in", "dist_bar", ":", "\n", "\n", "# \u6240\u6709\u70b9\u4e0e\u4e2d\u5fc3\u70b9\u59cb\u7ec8\u5141\u8bb8\u4ea4\u4e92", "\n", "        ", "dist_mask", "=", "dist", "<", "i", "\n", "dist_mask", "[", ":", ",", ":", ",", "0", ",", ":", "]", "=", "1", "\n", "dist_mask", "[", ":", ",", ":", ",", ":", ",", "0", "]", "=", "1", "\n", "\n", "# \u6839\u636e\u8ddd\u79bbmask\u6389\u90e8\u5206attention score", "\n", "scores_dist", "=", "scores", ".", "masked_fill", "(", "dist_mask", "==", "0", ",", "-", "1e10", ")", "\n", "\n", "p_attn", "=", "F", ".", "softmax", "(", "scores_dist", ",", "dim", "=", "-", "1", ")", "\n", "if", "dropout", "is", "not", "None", ":", "\n", "            ", "p_attn", "=", "dropout", "(", "p_attn", ")", "\n", "", "out", ".", "append", "(", "torch", ".", "matmul", "(", "p_attn", ",", "value", ")", ")", "\n", "", "return", "out", ",", "p_attn", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Encoder3D.__init__": [[27, 36], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["    ", "def", "__init__", "(", "self", ",", "encoder", ",", "src_embed", ",", "src_pe", ",", "generator", ",", "dist_bar", ",", "out_both", ")", ":", "\n", "        ", "super", "(", "Encoder3D", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "encoder", "=", "encoder", "\n", "self", ".", "src_embed", "=", "src_embed", "\n", "self", ".", "src_pe", "=", "src_pe", "\n", "self", ".", "generator", "=", "generator", "\n", "self", ".", "dist_bar", "=", "dist_bar", "\n", "self", ".", "dist", "=", "None", "\n", "self", ".", "out_both", "=", "out_both", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Encoder3D.forward_once": [[37, 47], ["torch.cdist", "torch.cdist", "torch.cdist", "torch.cdist", "torch.cdist", "torch.cdist", "torch.cdist", "torch.cdist", "torch.cdist", "tr_lsa.Encoder3D.encoder", "tr_lsa.Encoder3D.src_pe", "dist.unsqueeze", "tr_lsa.Encoder3D.src_embed"], "methods", ["None"], ["", "def", "forward_once", "(", "self", ",", "src", ",", "src_mask", ",", "pos", ")", ":", "\n", "        ", "dist", "=", "torch", ".", "cdist", "(", "pos", ",", "pos", ")", "<", "self", ".", "dist_bar", "\n", "dist", "[", ":", ",", "0", ",", ":", "]", "=", "1", "\n", "dist", "[", ":", ",", ":", ",", "0", "]", "=", "1", "\n", "\n", "# \u4fdd\u5b58dist\uff0c\u65b9\u4fbf\u540e\u7eed\u7edf\u8ba1", "\n", "self", ".", "dist", "=", "dist", "\n", "\n", "# \u53d6\u5360\u4f4d\u4e2d\u5fc3\u7684\u8f93\u51fa\u4f5c\u4e3aFFN\u7684\u8f93\u5165", "\n", "return", "self", ".", "encoder", "(", "self", ".", "src_pe", "(", "self", ".", "src_embed", "(", "src", ")", ",", "pos", ")", ",", "dist", ".", "unsqueeze", "(", "1", ")", ",", "src_mask", ")", "[", ":", ",", "0", ",", ":", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Encoder3D.forward": [[48, 54], ["tr_lsa.Encoder3D.generator", "tr_lsa.Encoder3D.forward_once", "tr_lsa.Encoder3D.forward_once", "tr_lsa.Encoder3D.generator"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Encoder3D.forward_once", "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Encoder3D.forward_once"], ["", "def", "forward", "(", "self", ",", "src", ",", "src_mask", ",", "pos", ")", ":", "\n", "        ", "if", "self", ".", "out_both", ":", "\n", "            ", "h", "=", "self", ".", "forward_once", "(", "src", ",", "src_mask", ",", "pos", ")", "\n", "return", "self", ".", "generator", "(", "h", ")", ",", "h", "\n", "\n", "", "return", "self", ".", "generator", "(", "self", ".", "forward_once", "(", "src", ",", "src_mask", ",", "pos", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Encoder.__init__": [[63, 67], ["torch.Module.__init__", "tr_lsa.clones", "tr_lsa.LayerNorm"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__", "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.clones"], ["def", "__init__", "(", "self", ",", "layer", ",", "N", ")", ":", "\n", "        ", "super", "(", "Encoder", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "layers", "=", "clones", "(", "layer", ",", "N", ")", "\n", "self", ".", "norm", "=", "LayerNorm", "(", "layer", ".", "size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Encoder.forward": [[68, 72], ["tr_lsa.Encoder.norm", "layer"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "dist", ",", "mask", ")", ":", "\n", "        ", "for", "layer", "in", "self", ".", "layers", ":", "\n", "            ", "x", "=", "layer", "(", "x", ",", "dist", ",", "mask", ")", "\n", "", "return", "self", ".", "norm", "(", "x", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.EncoderLayer.__init__": [[77, 83], ["torch.Module.__init__", "tr_lsa.clones", "tr_lsa.SublayerConnection"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__", "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.clones"], ["def", "__init__", "(", "self", ",", "size", ",", "self_attn", ",", "feed_forward", ",", "dropout", ")", ":", "\n", "        ", "super", "(", "EncoderLayer", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "self_attn", "=", "self_attn", "\n", "self", ".", "feed_forward", "=", "feed_forward", "\n", "self", ".", "sublayer", "=", "clones", "(", "SublayerConnection", "(", "size", ",", "dropout", ")", ",", "2", ")", "\n", "self", ".", "size", "=", "size", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.EncoderLayer.forward": [[84, 87], ["tr_lsa.EncoderLayer.self_attn"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "dist", ",", "mask", ")", ":", "\n", "        ", "x", "=", "self", ".", "sublayer", "[", "0", "]", "(", "x", ",", "lambda", "x", ":", "self", ".", "self_attn", "(", "x", ",", "x", ",", "x", ",", "dist", ",", "mask", ")", ")", "\n", "return", "self", ".", "sublayer", "[", "1", "]", "(", "x", ",", "self", ".", "feed_forward", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Generator3D.__init__": [[92, 98], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Dropout", "torch.Dropout", "torch.Dropout"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["def", "__init__", "(", "self", ",", "embed_dim", ",", "tgt", ",", "dropout", ")", ":", "\n", "        ", "super", "(", "Generator3D", ",", "self", ")", ".", "__init__", "(", ")", "\n", "# \u5355\u5c42\u5373\u53ef\uff0c\u591a\u5c42MLP\u6548\u679c\u63d0\u5347\u4e0d\u663e\u8457\u751a\u81f3\u66f4\u5dee", "\n", "self", ".", "tgt", "=", "tgt", "\n", "self", ".", "proj", "=", "nn", ".", "Linear", "(", "embed_dim", ",", "tgt", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "p", "=", "dropout", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Generator3D.forward": [[99, 101], ["tr_lsa.Generator3D.dropout", "tr_lsa.Generator3D.proj"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "self", ".", "dropout", "(", "self", ".", "proj", "(", "x", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.MultiHeadedAttention.__init__": [[130, 141], ["torch.Module.__init__", "tr_lsa.clones", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__", "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.clones"], ["    ", "def", "__init__", "(", "self", ",", "h", ",", "embed_dim", ",", "dropout", "=", "0.1", ")", ":", "\n", "        ", "\"\"\"Take in model size and number of heads.\"\"\"", "\n", "super", "(", "MultiHeadedAttention", ",", "self", ")", ".", "__init__", "(", ")", "\n", "assert", "embed_dim", "%", "h", "==", "0", "\n", "self", ".", "h", "=", "h", "\n", "self", ".", "linears", "=", "clones", "(", "nn", ".", "Linear", "(", "embed_dim", ",", "embed_dim", ")", ",", "4", ")", "\n", "self", ".", "attn", "=", "None", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "p", "=", "dropout", ")", "\n", "\n", "# \u9ed8\u8ba4V\u548cK\u7684\u7ef4\u5ea6\u76f8\u540c\uff0c\u7ef4\u5ea6\u4e3aembedding\u7ef4\u5ea6\u9664\u4ee5head\u6570", "\n", "self", ".", "d_k", "=", "embed_dim", "//", "h", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.MultiHeadedAttention.forward": [[142, 157], ["query.size", "tr_lsa.constrained_attention", "x.transpose().contiguous().view.transpose().contiguous().view.transpose().contiguous().view", "mask.unsqueeze.unsqueeze.unsqueeze", "l().view().transpose", "zip", "x.transpose().contiguous().view.transpose().contiguous().view.transpose().contiguous", "l().view", "x.transpose().contiguous().view.transpose().contiguous().view.transpose", "l"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.constrained_attention"], ["", "def", "forward", "(", "self", ",", "query", ",", "key", ",", "value", ",", "dist", ",", "mask", "=", "None", ")", ":", "\n", "        ", "if", "mask", "is", "not", "None", ":", "\n", "# Same mask applied to all h heads.", "\n", "            ", "mask", "=", "mask", ".", "unsqueeze", "(", "1", ")", "\n", "", "nbatches", "=", "query", ".", "size", "(", "0", ")", "\n", "\n", "# 1) Do all the linear projections in batch from embed_dim => h x d_k", "\n", "query", ",", "key", ",", "value", "=", "[", "l", "(", "x", ")", ".", "view", "(", "nbatches", ",", "-", "1", ",", "self", ".", "h", ",", "self", ".", "d_k", ")", ".", "transpose", "(", "1", ",", "2", ")", "\n", "for", "l", ",", "x", "in", "zip", "(", "self", ".", "linears", ",", "(", "query", ",", "key", ",", "value", ")", ")", "]", "\n", "# 2) Apply attention on all the projected vectors in batch.", "\n", "x", ",", "self", ".", "attn", "=", "constrained_attention", "(", "query", ",", "key", ",", "value", ",", "dist", ",", "mask", "=", "mask", ",", "dropout", "=", "self", ".", "dropout", ")", "\n", "\n", "# 3) \"Concat\" using a view and apply a final linear.", "\n", "x", "=", "x", ".", "transpose", "(", "1", ",", "2", ")", ".", "contiguous", "(", ")", ".", "view", "(", "nbatches", ",", "-", "1", ",", "self", ".", "h", "*", "self", ".", "d_k", ")", "\n", "return", "self", ".", "linears", "[", "-", "1", "]", "(", "x", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.LayerNorm.__init__": [[167, 172], ["torch.Module.__init__", "torch.Parameter", "torch.Parameter", "torch.Parameter", "torch.Parameter", "torch.Parameter", "torch.Parameter", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["def", "__init__", "(", "self", ",", "features", ",", "eps", "=", "1e-6", ")", ":", "\n", "        ", "super", "(", "LayerNorm", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "a_2", "=", "nn", ".", "Parameter", "(", "torch", ".", "ones", "(", "features", ")", ")", "\n", "self", ".", "b_2", "=", "nn", ".", "Parameter", "(", "torch", ".", "zeros", "(", "features", ")", ")", "\n", "self", ".", "eps", "=", "eps", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.LayerNorm.forward": [[173, 177], ["x.mean", "x.std"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "mean", "=", "x", ".", "mean", "(", "-", "1", ",", "keepdim", "=", "True", ")", "\n", "std", "=", "x", ".", "std", "(", "-", "1", ",", "keepdim", "=", "True", ")", "+", "self", ".", "eps", "\n", "return", "self", ".", "a_2", "*", "(", "x", "-", "mean", ")", "/", "std", "+", "self", ".", "b_2", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.SublayerConnection.__init__": [[182, 186], ["torch.Module.__init__", "tr_lsa.LayerNorm", "torch.Dropout", "torch.Dropout", "torch.Dropout"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["def", "__init__", "(", "self", ",", "size", ",", "dropout", ")", ":", "\n", "        ", "super", "(", "SublayerConnection", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "norm", "=", "LayerNorm", "(", "size", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "dropout", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.SublayerConnection.forward": [[187, 190], ["tr_lsa.SublayerConnection.dropout", "sublayer", "tr_lsa.SublayerConnection.norm"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "sublayer", ")", ":", "\n", "        ", "\"\"\"Apply residual connection to any sublayer with the same size.\"\"\"", "\n", "return", "x", "+", "self", ".", "dropout", "(", "sublayer", "(", "self", ".", "norm", "(", "x", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.FeedForward.__init__": [[199, 204], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Dropout", "torch.Dropout", "torch.Dropout"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["def", "__init__", "(", "self", ",", "embed_dim", ",", "ffn_dim", ",", "dropout", "=", "0.1", ")", ":", "\n", "        ", "super", "(", "FeedForward", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "w_1", "=", "nn", ".", "Linear", "(", "embed_dim", ",", "ffn_dim", ")", "\n", "self", ".", "w_2", "=", "nn", ".", "Linear", "(", "ffn_dim", ",", "embed_dim", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "dropout", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.FeedForward.forward": [[205, 207], ["tr_lsa.FeedForward.w_2", "tr_lsa.FeedForward.dropout", "torch.relu", "torch.relu", "torch.relu", "tr_lsa.FeedForward.w_1"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "self", ".", "w_2", "(", "self", ".", "dropout", "(", "F", ".", "relu", "(", "self", ".", "w_1", "(", "x", ")", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.PositionalEncoding3D.__init__": [[214, 218], ["torch.Module.__init__", "torch.Dropout", "torch.Dropout", "torch.Dropout"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["    ", "def", "__init__", "(", "self", ",", "embed_dim", ",", "dropout", ")", ":", "\n", "        ", "super", "(", "PositionalEncoding3D", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "p", "=", "dropout", ")", "\n", "self", ".", "embed_dim", "=", "embed_dim", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.PositionalEncoding3D.forward": [[219, 231], ["torch.exp().double().cuda", "torch.exp().double().cuda", "torch.exp().double().cuda", "torch.exp().double().cuda", "torch.exp().double().cuda", "torch.exp().double().cuda", "torch.exp().double().cuda", "torch.exp().double().cuda", "torch.exp().double().cuda", "range", "tr_lsa.PositionalEncoding3D.dropout", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.zeros().cuda", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.sin", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.cos", "torch.autograd.Variable", "torch.autograd.Variable", "torch.autograd.Variable", "torch.exp().double", "torch.exp().double", "torch.exp().double", "torch.exp().double", "torch.exp().double", "torch.exp().double", "torch.exp().double", "torch.exp().double", "torch.exp().double", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "pos[].unsqueeze", "pos[].unsqueeze", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "math.log"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "pos", ")", ":", "\n", "# \u6269\u5927\u5750\u6807\u7684\u91cf\u7ea7", "\n", "        ", "pos", "=", "pos", "*", "10", "\n", "\n", "# \u8ba1\u7b97\u4e09\u4e2a\u4f4d\u7f6e\u7684PE\uff0c\u5e76\u4e0etoken embedding\u76f4\u63a5\u76f8\u52a0", "\n", "div", "=", "torch", ".", "exp", "(", "torch", ".", "arange", "(", "0.", ",", "self", ".", "embed_dim", ",", "2", ")", "*", "-", "(", "math", ".", "log", "(", "10000.0", ")", "/", "self", ".", "embed_dim", ")", ")", ".", "double", "(", ")", ".", "cuda", "(", ")", "\n", "for", "i", "in", "range", "(", "3", ")", ":", "\n", "            ", "pe", "=", "torch", ".", "zeros", "(", "x", ".", "shape", ")", ".", "cuda", "(", ")", "\n", "pe", "[", "...", ",", "0", ":", ":", "2", "]", "=", "torch", ".", "sin", "(", "pos", "[", "...", ",", "i", "]", ".", "unsqueeze", "(", "2", ")", "*", "div", ")", "\n", "pe", "[", "...", ",", "1", ":", ":", "2", "]", "=", "torch", ".", "cos", "(", "pos", "[", "...", ",", "i", "]", ".", "unsqueeze", "(", "2", ")", "*", "div", ")", "\n", "x", "+=", "Variable", "(", "pe", ",", "requires_grad", "=", "False", ")", "\n", "", "return", "self", ".", "dropout", "(", "x", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__": [[234, 238], ["torch.Module.__init__", "torch.Embedding", "torch.Embedding", "torch.Embedding"], "methods", ["home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.__init__"], ["    ", "def", "__init__", "(", "self", ",", "embed_dim", ",", "vocab", ")", ":", "\n", "        ", "super", "(", "Embeddings", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "embed", "=", "nn", ".", "Embedding", "(", "vocab", ",", "embed_dim", ")", "\n", "self", ".", "embed_dim", "=", "embed_dim", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.Embeddings.forward": [[239, 242], ["tr_lsa.Embeddings.embed", "math.sqrt"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "# \u6210\u500d\u653e\u5927token embedding\u7684\u503c", "\n", "        ", "return", "self", ".", "embed", "(", "x", ")", "*", "math", ".", "sqrt", "(", "self", ".", "embed_dim", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.build_model": [[10, 24], ["tr_lsa.MultiHeadedAttention", "tr_lsa.FeedForward", "tr_lsa.PositionalEncoding3D", "tr_lsa.Encoder3D", "Encoder3D.parameters", "tr_lsa.Encoder", "tr_lsa.Embeddings", "c", "tr_lsa.Generator3D", "tr_lsa.EncoderLayer", "p.dim", "torch.init.xavier_uniform_", "c", "c"], "function", ["None"], ["def", "build_model", "(", "vocab", ",", "tgt", ",", "dist_bar", ",", "N", "=", "6", ",", "embed_dim", "=", "512", ",", "ffn_dim", "=", "2048", ",", "head", "=", "8", ",", "dropout", "=", "0.1", ",", "out_both", "=", "False", ")", ":", "\n", "    ", "c", "=", "copy", ".", "deepcopy", "\n", "attn", "=", "MultiHeadedAttention", "(", "head", ",", "embed_dim", ")", "\n", "ff", "=", "FeedForward", "(", "embed_dim", ",", "ffn_dim", ",", "dropout", ")", "\n", "position", "=", "PositionalEncoding3D", "(", "embed_dim", ",", "dropout", ")", "\n", "\n", "# \u642d\u5efa\u6a21\u578b\uff0c\u5e76\u5bf9\u6a21\u578b\u53c2\u6570\u521d\u59cb\u5316", "\n", "model", "=", "Encoder3D", "(", "Encoder", "(", "EncoderLayer", "(", "embed_dim", ",", "c", "(", "attn", ")", ",", "c", "(", "ff", ")", ",", "dropout", ")", ",", "N", ")", ",", "Embeddings", "(", "embed_dim", ",", "vocab", ")", ",", "\n", "c", "(", "position", ")", ",", "Generator3D", "(", "embed_dim", ",", "tgt", ",", "dropout", ")", ",", "dist_bar", ",", "out_both", ")", "\n", "for", "p", "in", "model", ".", "parameters", "(", ")", ":", "\n", "        ", "if", "p", ".", "dim", "(", ")", ">", "1", ":", "\n", "            ", "nn", ".", "init", ".", "xavier_uniform_", "(", "p", ")", "\n", "\n", "", "", "return", "model", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.clones": [[103, 106], ["torch.ModuleList", "copy.deepcopy", "range"], "function", ["None"], ["", "", "def", "clones", "(", "module", ",", "N", ")", ":", "\n", "    ", "\"\"\"Produce N identical layers.\"\"\"", "\n", "return", "nn", ".", "ModuleList", "(", "[", "copy", ".", "deepcopy", "(", "module", ")", "for", "_", "in", "range", "(", "N", ")", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.smiles724_3d-transformer.model.tr_lsa.constrained_attention": [[112, 127], ["query.size", "torch.softmax", "torch.matmul", "torch.matmul", "torch.matmul", "math.sqrt", "scores.masked_fill.masked_fill", "scores.masked_fill.masked_fill", "dropout", "torch.matmul", "torch.matmul", "torch.matmul", "key.transpose"], "function", ["None"], ["", "def", "constrained_attention", "(", "query", ",", "key", ",", "value", ",", "dist", ",", "mask", "=", "None", ",", "dropout", "=", "None", ")", ":", "\n", "    ", "\"\"\"Compute Scaled Dot Product Attention\"\"\"", "\n", "d_k", "=", "query", ".", "size", "(", "-", "1", ")", "\n", "\n", "scores", "=", "torch", ".", "matmul", "(", "query", ",", "key", ".", "transpose", "(", "-", "2", ",", "-", "1", ")", ")", "/", "math", ".", "sqrt", "(", "d_k", ")", "\n", "if", "mask", "is", "not", "None", ":", "\n", "        ", "scores", "=", "scores", ".", "masked_fill", "(", "mask", "==", "0", ",", "-", "1e9", ")", "\n", "\n", "# \u6839\u636e\u8ddd\u79bbmask\u6389\u90e8\u5206attention score", "\n", "scores", "=", "scores", ".", "masked_fill", "(", "dist", "==", "0", ",", "-", "1e9", ")", "\n", "\n", "", "p_attn", "=", "F", ".", "softmax", "(", "scores", ",", "dim", "=", "-", "1", ")", "\n", "if", "dropout", "is", "not", "None", ":", "\n", "        ", "p_attn", "=", "dropout", "(", "p_attn", ")", "\n", "", "return", "torch", ".", "matmul", "(", "p_attn", ",", "value", ")", ",", "p_attn", "\n", "\n"]]}