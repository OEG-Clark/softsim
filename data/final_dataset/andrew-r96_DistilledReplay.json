{"home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.mlp2.Model.__init__": [[6, 13], ["torch.Module.__init__", "torch.Dropout", "torch.Dropout", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.ModelInitDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "config", ")", ":", "\n", "        ", "super", "(", "Model", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "drop", "=", "nn", ".", "Dropout", "(", "config", "[", "'dropout'", "]", ")", "\n", "\n", "self", ".", "fc1", "=", "nn", ".", "Linear", "(", "784", ",", "500", ")", "\n", "self", ".", "fc2", "=", "nn", ".", "Linear", "(", "500", ",", "500", ")", "\n", "self", ".", "fc5", "=", "nn", ".", "Linear", "(", "500", ",", "10", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.mlp2.Model.forward": [[14, 22], ["torch.relu", "torch.relu", "torch.relu", "torch.relu", "mlp2.Model.fc5", "mlp2.Model.drop", "mlp2.Model.drop", "mlp2.Model.fc1", "mlp2.Model.fc2"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "# 784 -> 2000", "\n", "        ", "x", "=", "F", ".", "relu", "(", "self", ".", "drop", "(", "self", ".", "fc1", "(", "x", ")", ")", ")", "\n", "# 2000 -> 2000", "\n", "x", "=", "F", ".", "relu", "(", "self", ".", "drop", "(", "self", ".", "fc2", "(", "x", ")", ")", ")", "\n", "# 2000 -> 100", "\n", "x", "=", "self", ".", "fc5", "(", "x", ")", "\n", "return", "x", "", "", "", ""]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.mlp1.Model.__init__": [[6, 15], ["torch.Module.__init__", "torch.Dropout", "torch.Dropout", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.ModelInitDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "config", ")", ":", "\n", "        ", "super", "(", "Model", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "drop", "=", "nn", ".", "Dropout", "(", "config", "[", "'dropout'", "]", ")", "\n", "\n", "self", ".", "fc1", "=", "nn", ".", "Linear", "(", "784", ",", "2000", ")", "\n", "self", ".", "fc2", "=", "nn", ".", "Linear", "(", "2000", ",", "2000", ")", "\n", "self", ".", "fc3", "=", "nn", ".", "Linear", "(", "2000", ",", "2000", ")", "\n", "self", ".", "fc4", "=", "nn", ".", "Linear", "(", "2000", ",", "2000", ")", "\n", "self", ".", "fc5", "=", "nn", ".", "Linear", "(", "2000", ",", "10", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.mlp1.Model.forward": [[16, 28], ["torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "mlp1.Model.fc5", "mlp1.Model.drop", "mlp1.Model.drop", "mlp1.Model.drop", "mlp1.Model.drop", "mlp1.Model.fc1", "mlp1.Model.fc2", "mlp1.Model.fc3", "mlp1.Model.fc4"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "# 784 -> 2000", "\n", "        ", "x", "=", "F", ".", "relu", "(", "self", ".", "drop", "(", "self", ".", "fc1", "(", "x", ")", ")", ")", "\n", "# 2000 -> 2000", "\n", "x", "=", "F", ".", "relu", "(", "self", ".", "drop", "(", "self", ".", "fc2", "(", "x", ")", ")", ")", "\n", "# 2000 -> 2000", "\n", "x", "=", "F", ".", "relu", "(", "self", ".", "drop", "(", "self", ".", "fc3", "(", "x", ")", ")", ")", "\n", "# 2000 -> 2000", "\n", "x", "=", "F", ".", "relu", "(", "self", ".", "drop", "(", "self", ".", "fc4", "(", "x", ")", ")", ")", "\n", "# 2000 -> 100", "\n", "x", "=", "self", ".", "fc5", "(", "x", ")", "\n", "return", "x", "", "", "", ""]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.cnn2.Model.__init__": [[6, 26], ["torch.Module.__init__", "torch.Conv2d", "torch.Conv2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.Conv2d", "torch.Conv2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.Conv2d", "torch.Conv2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.Conv2d", "torch.Conv2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.Conv2d", "torch.Conv2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.ModelInitDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "config", ")", ":", "\n", "        ", "super", "(", "Model", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "conv1", "=", "nn", ".", "Conv2d", "(", "3", ",", "16", ",", "(", "3", ",", "3", ")", ",", "padding", "=", "1", ")", "\n", "self", ".", "conv1_bn", "=", "nn", ".", "BatchNorm2d", "(", "16", ")", "\n", "\n", "self", ".", "conv2", "=", "nn", ".", "Conv2d", "(", "16", ",", "32", ",", "(", "3", ",", "3", ")", ",", "padding", "=", "1", ",", "stride", "=", "2", ")", "\n", "self", ".", "conv2_bn", "=", "nn", ".", "BatchNorm2d", "(", "32", ")", "\n", "\n", "self", ".", "conv3", "=", "nn", ".", "Conv2d", "(", "32", ",", "64", ",", "(", "3", ",", "3", ")", ",", "padding", "=", "1", ",", "stride", "=", "2", ")", "\n", "self", ".", "conv3_bn", "=", "nn", ".", "BatchNorm2d", "(", "64", ")", "\n", "\n", "self", ".", "conv4", "=", "nn", ".", "Conv2d", "(", "64", ",", "128", ",", "(", "3", ",", "3", ")", ",", "padding", "=", "1", ",", "stride", "=", "2", ")", "\n", "self", ".", "conv4_bn", "=", "nn", ".", "BatchNorm2d", "(", "128", ")", "\n", "\n", "self", ".", "conv5", "=", "nn", ".", "Conv2d", "(", "128", ",", "256", ",", "(", "3", ",", "3", ")", ",", "padding", "=", "1", ",", "stride", "=", "2", ")", "\n", "self", ".", "conv5_bn", "=", "nn", ".", "BatchNorm2d", "(", "256", ")", "\n", "\n", "self", ".", "fc1", "=", "nn", ".", "Linear", "(", "256", "*", "2", "*", "2", ",", "2000", ")", "\n", "self", ".", "fc2", "=", "nn", ".", "Linear", "(", "2000", ",", "2000", ")", "\n", "self", ".", "fc3", "=", "nn", ".", "Linear", "(", "2000", ",", "config", "[", "'n_classes'", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.cnn2.Model.forward": [[27, 47], ["torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "cnn2.Model.view", "torch.relu", "torch.relu", "cnn2.Model.fc3", "cnn2.Model.conv1_bn", "cnn2.Model.conv2_bn", "cnn2.Model.conv3_bn", "cnn2.Model.conv4_bn", "cnn2.Model.conv5_bn", "torch.dropout", "torch.dropout", "cnn2.Model.conv1", "cnn2.Model.conv2", "cnn2.Model.conv3", "cnn2.Model.conv4", "cnn2.Model.conv5", "cnn2.Model.fc1"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "# [3, 32, 32] -> [16, 32, 32]", "\n", "        ", "x", "=", "F", ".", "relu", "(", "self", ".", "conv1_bn", "(", "self", ".", "conv1", "(", "x", ")", ")", ")", "\n", "# [16, 32, 32] -> [32, 16, 16]", "\n", "x", "=", "F", ".", "relu", "(", "self", ".", "conv2_bn", "(", "self", ".", "conv2", "(", "x", ")", ")", ")", "\n", "# [32, 16, 16] -> [64, 8, 8]", "\n", "x", "=", "F", ".", "relu", "(", "self", ".", "conv3_bn", "(", "self", ".", "conv3", "(", "x", ")", ")", ")", "\n", "# [64, 8, 8] -> [128, 4, 4]", "\n", "x", "=", "F", ".", "relu", "(", "self", ".", "conv4_bn", "(", "self", ".", "conv4", "(", "x", ")", ")", ")", "\n", "# [128, 4, 4] -> [256, 2, 2]", "\n", "x", "=", "F", ".", "relu", "(", "self", ".", "conv5_bn", "(", "self", ".", "conv5", "(", "x", ")", ")", ")", "\n", "# [128, 2, 2] -> [512]", "\n", "x", "=", "x", ".", "view", "(", "-", "1", ",", "256", "*", "2", "*", "2", ")", "\n", "# 1024 -> 2000", "\n", "x", "=", "F", ".", "relu", "(", "F", ".", "dropout", "(", "(", "self", ".", "fc1", "(", "x", ")", ")", ",", "0.0", ")", ")", "\n", "# 2000 -> 2000", "\n", "# x = F.relu(F.dropout((self.fc2(x)), 0.5))", "\n", "# 2000 -> 100", "\n", "x", "=", "self", ".", "fc3", "(", "x", ")", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.cnn2.Model.freeze_conv": [[48, 68], ["None"], "methods", ["None"], ["", "def", "freeze_conv", "(", "self", ")", ":", "\n", "        ", "self", ".", "conv1", ".", "weight", ".", "requires_grad", "=", "False", "\n", "self", ".", "conv1_bn", ".", "weight", ".", "requires_grad", "=", "False", "\n", "self", ".", "conv1_bn", ".", "bias", ".", "requires_grad", "=", "False", "\n", "\n", "self", ".", "conv2", ".", "weight", ".", "requires_grad", "=", "False", "\n", "self", ".", "conv2_bn", ".", "weight", ".", "requires_grad", "=", "False", "\n", "self", ".", "conv2_bn", ".", "bias", ".", "requires_grad", "=", "False", "\n", "\n", "self", ".", "conv3", ".", "weight", ".", "requires_grad", "=", "False", "\n", "self", ".", "conv3_bn", ".", "weight", ".", "requires_grad", "=", "False", "\n", "self", ".", "conv3_bn", ".", "bias", ".", "requires_grad", "=", "False", "\n", "\n", "self", ".", "conv4", ".", "weight", ".", "requires_grad", "=", "False", "\n", "self", ".", "conv4_bn", ".", "weight", ".", "requires_grad", "=", "False", "\n", "self", ".", "conv4_bn", ".", "bias", ".", "requires_grad", "=", "False", "\n", "\n", "self", ".", "conv5", ".", "weight", ".", "requires_grad", "=", "False", "\n", "self", ".", "conv5_bn", ".", "weight", ".", "requires_grad", "=", "False", "\n", "self", ".", "conv5_bn", ".", "bias", ".", "requires_grad", "=", "False", "", "", "", ""]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.wide_resnet.BasicBlock.__init__": [[17, 53], ["torch.Module.__init__", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Sequential", "torch.Sequential", "torch.Sequential", "wide_resnet.BasicBlock.shortcut.add_module", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d"], "methods", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.ModelInitDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "in_channels", ",", "out_channels", ",", "stride", ",", "drop_rate", ")", ":", "\n", "        ", "super", "(", "BasicBlock", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "drop_rate", "=", "drop_rate", "\n", "\n", "self", ".", "_preactivate_both", "=", "(", "in_channels", "!=", "out_channels", ")", "\n", "\n", "self", ".", "bn1", "=", "nn", ".", "BatchNorm2d", "(", "in_channels", ")", "\n", "self", ".", "conv1", "=", "nn", ".", "Conv2d", "(", "\n", "in_channels", ",", "\n", "out_channels", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "stride", ",", "# downsample with first conv", "\n", "padding", "=", "1", ",", "\n", "bias", "=", "False", ")", "\n", "\n", "self", ".", "bn2", "=", "nn", ".", "BatchNorm2d", "(", "out_channels", ")", "\n", "self", ".", "conv2", "=", "nn", ".", "Conv2d", "(", "\n", "out_channels", ",", "\n", "out_channels", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ",", "\n", "bias", "=", "False", ")", "\n", "\n", "self", ".", "shortcut", "=", "nn", ".", "Sequential", "(", ")", "\n", "if", "in_channels", "!=", "out_channels", ":", "\n", "            ", "self", ".", "shortcut", ".", "add_module", "(", "\n", "'conv'", ",", "\n", "nn", ".", "Conv2d", "(", "\n", "in_channels", ",", "\n", "out_channels", ",", "\n", "kernel_size", "=", "1", ",", "\n", "stride", "=", "stride", ",", "# downsample", "\n", "padding", "=", "0", ",", "\n", "bias", "=", "False", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.wide_resnet.BasicBlock.forward": [[54, 72], ["torch.relu", "torch.relu", "torch.relu", "wide_resnet.BasicBlock.conv2", "wide_resnet.BasicBlock.shortcut", "torch.relu", "torch.relu", "torch.relu", "wide_resnet.BasicBlock.conv1", "torch.relu", "torch.relu", "torch.relu", "wide_resnet.BasicBlock.conv1", "torch.dropout", "torch.dropout", "torch.dropout", "wide_resnet.BasicBlock.bn2", "wide_resnet.BasicBlock.bn1", "wide_resnet.BasicBlock.bn1"], "methods", ["None"], ["", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "if", "self", ".", "_preactivate_both", ":", "\n", "            ", "x", "=", "F", ".", "relu", "(", "\n", "self", ".", "bn1", "(", "x", ")", ",", "inplace", "=", "True", ")", "# shortcut after preactivation", "\n", "y", "=", "self", ".", "conv1", "(", "x", ")", "\n", "", "else", ":", "\n", "            ", "y", "=", "F", ".", "relu", "(", "\n", "self", ".", "bn1", "(", "x", ")", ",", "\n", "inplace", "=", "True", ")", "# preactivation only for residual path", "\n", "y", "=", "self", ".", "conv1", "(", "y", ")", "\n", "", "if", "self", ".", "drop_rate", ">", "0", ":", "\n", "            ", "y", "=", "F", ".", "dropout", "(", "\n", "y", ",", "p", "=", "self", ".", "drop_rate", ",", "training", "=", "self", ".", "training", ",", "inplace", "=", "False", ")", "\n", "\n", "", "y", "=", "F", ".", "relu", "(", "self", ".", "bn2", "(", "y", ")", ",", "inplace", "=", "True", ")", "\n", "y", "=", "self", ".", "conv2", "(", "y", ")", "\n", "y", "+=", "self", ".", "shortcut", "(", "x", ")", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.wide_resnet.Model.__init__": [[75, 134], ["torch.Module.__init__", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "wide_resnet.Model._make_stage", "wide_resnet.Model._make_stage", "wide_resnet.Model._make_stage", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.Linear", "torch.Linear", "torch.Linear", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "wide_resnet.Model._forward_conv().view", "wide_resnet.Model._forward_conv", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros"], "methods", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.ModelInitDataset.__init__", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.wide_resnet.Model._make_stage", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.wide_resnet.Model._make_stage", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.wide_resnet.Model._make_stage", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.wide_resnet.Model._forward_conv"], ["    ", "def", "__init__", "(", "self", ",", "config", ")", ":", "\n", "        ", "super", "(", "Model", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "conv_freezed", "=", "False", "\n", "\n", "input_shape", "=", "config", "[", "'input_shape'", "]", "\n", "n_classes", "=", "config", "[", "'n_classes'", "]", "\n", "\n", "base_channels", "=", "config", "[", "'base_channels'", "]", "\n", "widening_factor", "=", "config", "[", "'widening_factor'", "]", "\n", "drop_rate", "=", "config", "[", "'drop_rate'", "]", "\n", "depth", "=", "config", "[", "'depth'", "]", "\n", "\n", "block", "=", "BasicBlock", "\n", "n_blocks_per_stage", "=", "(", "depth", "-", "4", ")", "//", "6", "\n", "assert", "n_blocks_per_stage", "*", "6", "+", "4", "==", "depth", "\n", "\n", "n_channels", "=", "[", "\n", "base_channels", ",", "base_channels", "*", "widening_factor", ",", "\n", "base_channels", "*", "2", "*", "widening_factor", ",", "\n", "base_channels", "*", "4", "*", "widening_factor", "\n", "]", "\n", "\n", "self", ".", "conv", "=", "nn", ".", "Conv2d", "(", "\n", "input_shape", "[", "1", "]", ",", "\n", "n_channels", "[", "0", "]", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ",", "\n", "bias", "=", "False", ")", "\n", "\n", "self", ".", "stage1", "=", "self", ".", "_make_stage", "(", "\n", "n_channels", "[", "0", "]", ",", "\n", "n_channels", "[", "1", "]", ",", "\n", "n_blocks_per_stage", ",", "\n", "block", ",", "\n", "stride", "=", "1", ",", "\n", "drop_rate", "=", "drop_rate", ")", "\n", "self", ".", "stage2", "=", "self", ".", "_make_stage", "(", "\n", "n_channels", "[", "1", "]", ",", "\n", "n_channels", "[", "2", "]", ",", "\n", "n_blocks_per_stage", ",", "\n", "block", ",", "\n", "stride", "=", "2", ",", "\n", "drop_rate", "=", "drop_rate", ")", "\n", "self", ".", "stage3", "=", "self", ".", "_make_stage", "(", "\n", "n_channels", "[", "2", "]", ",", "\n", "n_channels", "[", "3", "]", ",", "\n", "n_blocks_per_stage", ",", "\n", "block", ",", "\n", "stride", "=", "2", ",", "\n", "drop_rate", "=", "drop_rate", ")", "\n", "self", ".", "bn", "=", "nn", ".", "BatchNorm2d", "(", "n_channels", "[", "3", "]", ")", "\n", "\n", "# compute conv feature size", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "self", ".", "feature_size", "=", "self", ".", "_forward_conv", "(", "\n", "torch", ".", "zeros", "(", "*", "input_shape", ")", ")", ".", "view", "(", "-", "1", ")", ".", "shape", "[", "0", "]", "\n", "\n", "", "self", ".", "fc", "=", "nn", ".", "Linear", "(", "self", ".", "feature_size", ",", "n_classes", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.wide_resnet.Model._make_stage": [[136, 158], ["torch.Sequential", "torch.Sequential", "torch.Sequential", "range", "torch.Sequential.add_module", "torch.Sequential.add_module", "block", "block"], "methods", ["None"], ["", "def", "_make_stage", "(", "self", ",", "in_channels", ",", "out_channels", ",", "n_blocks", ",", "block", ",", "stride", ",", "\n", "drop_rate", ")", ":", "\n", "        ", "stage", "=", "nn", ".", "Sequential", "(", ")", "\n", "for", "index", "in", "range", "(", "n_blocks", ")", ":", "\n", "            ", "block_name", "=", "'block{}'", ".", "format", "(", "index", "+", "1", ")", "\n", "if", "index", "==", "0", ":", "\n", "                ", "stage", ".", "add_module", "(", "\n", "block_name", ",", "\n", "block", "(", "\n", "in_channels", ",", "\n", "out_channels", ",", "\n", "stride", "=", "stride", ",", "\n", "drop_rate", "=", "drop_rate", ")", ")", "\n", "", "else", ":", "\n", "                ", "stage", ".", "add_module", "(", "\n", "block_name", ",", "\n", "block", "(", "\n", "out_channels", ",", "\n", "out_channels", ",", "\n", "stride", "=", "1", ",", "\n", "drop_rate", "=", "drop_rate", ")", ")", "\n", "", "", "return", "stage", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.wide_resnet.Model._forward_conv": [[159, 175], ["wide_resnet.Model.stage3", "torch.relu", "torch.relu", "torch.relu", "torch.adaptive_avg_pool2d", "torch.adaptive_avg_pool2d", "torch.adaptive_avg_pool2d", "wide_resnet.Model.conv", "wide_resnet.Model.stage1", "wide_resnet.Model.stage2", "wide_resnet.Model.bn", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "wide_resnet.Model.conv", "wide_resnet.Model.stage1", "wide_resnet.Model.stage2"], "methods", ["None"], ["", "def", "_forward_conv", "(", "self", ",", "x", ")", ":", "\n", "        ", "if", "self", ".", "conv_freezed", ":", "\n", "            ", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "                ", "x", "=", "self", ".", "conv", "(", "x", ")", "\n", "x", "=", "self", ".", "stage1", "(", "x", ")", "\n", "x", "=", "self", ".", "stage2", "(", "x", ")", "\n", "", "", "else", ":", "\n", "            ", "x", "=", "self", ".", "conv", "(", "x", ")", "\n", "x", "=", "self", ".", "stage1", "(", "x", ")", "\n", "x", "=", "self", ".", "stage2", "(", "x", ")", "\n", "\n", "", "x", "=", "self", ".", "stage3", "(", "x", ")", "\n", "x", "=", "F", ".", "relu", "(", "self", ".", "bn", "(", "x", ")", ",", "inplace", "=", "True", ")", "\n", "x", "=", "F", ".", "adaptive_avg_pool2d", "(", "x", ",", "output_size", "=", "1", ")", "\n", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.wide_resnet.Model.forward": [[176, 183], ["wide_resnet.Model._forward_conv", "wide_resnet.Model.view", "wide_resnet.Model.fc", "wide_resnet.Model.size"], "methods", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.wide_resnet.Model._forward_conv"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "x", "=", "self", ".", "_forward_conv", "(", "x", ")", "\n", "\n", "x", "=", "x", ".", "view", "(", "x", ".", "size", "(", "0", ")", ",", "-", "1", ")", "\n", "x", "=", "self", ".", "fc", "(", "x", ")", "\n", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.wide_resnet.Model.freeze": [[184, 186], ["None"], "methods", ["None"], ["", "def", "freeze", "(", "self", ")", ":", "\n", "        ", "self", ".", "conv_freezed", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.wide_resnet.Model.unfreeze": [[187, 189], ["None"], "methods", ["None"], ["", "def", "unfreeze", "(", "self", ")", ":", "\n", "        ", "self", ".", "conv_freezed", "=", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.wide_resnet.initialize_weights": [[6, 14], ["isinstance", "torch.init.kaiming_normal_", "isinstance", "module.weight.data.uniform_", "module.bias.data.zero_", "isinstance", "module.bias.data.zero_"], "function", ["None"], ["def", "initialize_weights", "(", "module", ")", ":", "\n", "    ", "if", "isinstance", "(", "module", ",", "nn", ".", "Conv2d", ")", ":", "\n", "        ", "nn", ".", "init", ".", "kaiming_normal_", "(", "module", ".", "weight", ".", "data", ",", "mode", "=", "'fan_in'", ")", "\n", "", "elif", "isinstance", "(", "module", ",", "nn", ".", "BatchNorm2d", ")", ":", "\n", "        ", "module", ".", "weight", ".", "data", ".", "uniform_", "(", ")", "\n", "module", ".", "bias", ".", "data", ".", "zero_", "(", ")", "\n", "", "elif", "isinstance", "(", "module", ",", "nn", ".", "Linear", ")", ":", "\n", "        ", "module", ".", "bias", ".", "data", ".", "zero_", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.cnn1.Model.__init__": [[15, 37], ["torch.Module.__init__", "torch.Conv2d", "torch.Conv2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.Conv2d", "torch.Conv2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.Conv2d", "torch.Conv2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.Conv2d", "torch.Conv2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.Conv2d", "torch.Conv2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "cnn1.Model.apply"], "methods", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.ModelInitDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "config", ")", ":", "\n", "        ", "super", "(", "Model", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "conv1", "=", "nn", ".", "Conv2d", "(", "1", ",", "16", ",", "(", "3", ",", "3", ")", ",", "padding", "=", "1", ")", "\n", "self", ".", "conv1_bn", "=", "nn", ".", "BatchNorm2d", "(", "16", ")", "\n", "\n", "self", ".", "conv2", "=", "nn", ".", "Conv2d", "(", "16", ",", "32", ",", "(", "3", ",", "3", ")", ",", "padding", "=", "1", ",", "stride", "=", "2", ")", "\n", "self", ".", "conv2_bn", "=", "nn", ".", "BatchNorm2d", "(", "32", ")", "\n", "\n", "self", ".", "conv3", "=", "nn", ".", "Conv2d", "(", "32", ",", "64", ",", "(", "3", ",", "3", ")", ",", "padding", "=", "1", ",", "stride", "=", "2", ")", "\n", "self", ".", "conv3_bn", "=", "nn", ".", "BatchNorm2d", "(", "64", ")", "\n", "\n", "self", ".", "conv4", "=", "nn", ".", "Conv2d", "(", "64", ",", "128", ",", "(", "3", ",", "3", ")", ",", "padding", "=", "1", ",", "stride", "=", "2", ")", "\n", "self", ".", "conv4_bn", "=", "nn", ".", "BatchNorm2d", "(", "128", ")", "\n", "\n", "self", ".", "conv5", "=", "nn", ".", "Conv2d", "(", "128", ",", "256", ",", "(", "3", ",", "3", ")", ",", "padding", "=", "1", ",", "stride", "=", "2", ")", "\n", "self", ".", "conv5_bn", "=", "nn", ".", "BatchNorm2d", "(", "256", ")", "\n", "\n", "self", ".", "fc1", "=", "nn", ".", "Linear", "(", "256", "*", "2", "*", "2", ",", "2000", ")", "\n", "self", ".", "fc2", "=", "nn", ".", "Linear", "(", "2000", ",", "2000", ")", "\n", "self", ".", "fc3", "=", "nn", ".", "Linear", "(", "2000", ",", "config", "[", "'n_classes'", "]", ")", "\n", "\n", "self", ".", "apply", "(", "initialize_weights", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.cnn1.Model.forward": [[38, 58], ["torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "cnn1.Model.view", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "cnn1.Model.fc3", "cnn1.Model.conv1_bn", "cnn1.Model.conv2_bn", "cnn1.Model.conv3_bn", "cnn1.Model.conv4_bn", "cnn1.Model.conv5_bn", "torch.dropout", "torch.dropout", "torch.dropout", "torch.dropout", "cnn1.Model.conv1", "cnn1.Model.conv2", "cnn1.Model.conv3", "cnn1.Model.conv4", "cnn1.Model.conv5", "cnn1.Model.fc1", "cnn1.Model.fc2"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "# [3, 32, 32] -> [16, 32, 32]", "\n", "        ", "x", "=", "F", ".", "relu", "(", "self", ".", "conv1_bn", "(", "self", ".", "conv1", "(", "x", ")", ")", ")", "\n", "# [16, 32, 32] -> [32, 16, 16]", "\n", "x", "=", "F", ".", "relu", "(", "self", ".", "conv2_bn", "(", "self", ".", "conv2", "(", "x", ")", ")", ")", "\n", "# [32, 16, 16] -> [64, 8, 8]", "\n", "x", "=", "F", ".", "relu", "(", "self", ".", "conv3_bn", "(", "self", ".", "conv3", "(", "x", ")", ")", ")", "\n", "# [64, 8, 8] -> [128, 4, 4]", "\n", "x", "=", "F", ".", "relu", "(", "self", ".", "conv4_bn", "(", "self", ".", "conv4", "(", "x", ")", ")", ")", "\n", "# [128, 4, 4] -> [256, 2, 2]", "\n", "x", "=", "F", ".", "relu", "(", "self", ".", "conv5_bn", "(", "self", ".", "conv5", "(", "x", ")", ")", ")", "\n", "# [128, 2, 2] -> [512]", "\n", "x", "=", "x", ".", "view", "(", "-", "1", ",", "256", "*", "2", "*", "2", ")", "\n", "# 1024 -> 2000", "\n", "x", "=", "F", ".", "relu", "(", "F", ".", "dropout", "(", "self", ".", "fc1", "(", "x", ")", ",", "0.5", ")", ")", "\n", "# 2000 -> 2000", "\n", "x", "=", "F", ".", "relu", "(", "F", ".", "dropout", "(", "self", ".", "fc2", "(", "x", ")", ",", "0.5", ")", ")", "\n", "# 2000 -> 100", "\n", "x", "=", "self", ".", "fc3", "(", "x", ")", "\n", "return", "x", "", "", "", ""]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.cnn1.initialize_weights": [[5, 13], ["isinstance", "torch.init.kaiming_normal_", "isinstance", "module.weight.data.uniform_", "module.bias.data.zero_", "isinstance", "module.bias.data.zero_"], "function", ["None"], ["def", "initialize_weights", "(", "module", ")", ":", "\n", "    ", "if", "isinstance", "(", "module", ",", "nn", ".", "Conv2d", ")", ":", "\n", "        ", "nn", ".", "init", ".", "kaiming_normal_", "(", "module", ".", "weight", ".", "data", ",", "mode", "=", "'fan_in'", ")", "\n", "", "elif", "isinstance", "(", "module", ",", "nn", ".", "BatchNorm2d", ")", ":", "\n", "        ", "module", ".", "weight", ".", "data", ".", "uniform_", "(", ")", "\n", "module", ".", "bias", ".", "data", ".", "zero_", "(", ")", "\n", "", "elif", "isinstance", "(", "module", ",", "nn", ".", "Linear", ")", ":", "\n", "        ", "module", ".", "bias", ".", "data", ".", "zero_", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.lenet5.Model.__init__": [[6, 24], ["torch.nn.Module.__init__", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Conv2d", "torch.nn.Tanh", "torch.nn.AvgPool2d", "torch.nn.Conv2d", "torch.nn.Tanh", "torch.nn.AvgPool2d", "torch.nn.Conv2d", "torch.nn.Tanh", "torch.nn.Linear", "torch.nn.Tanh", "torch.nn.Linear"], "methods", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.ModelInitDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "config", ")", ":", "\n", "        ", "super", "(", "Model", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "feature_extractor", "=", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Conv2d", "(", "in_channels", "=", "config", "[", "'input_shape'", "]", "[", "0", "]", ",", "out_channels", "=", "6", ",", "kernel_size", "=", "5", ",", "stride", "=", "1", ")", ",", "\n", "nn", ".", "Tanh", "(", ")", ",", "\n", "nn", ".", "AvgPool2d", "(", "kernel_size", "=", "2", ")", ",", "\n", "nn", ".", "Conv2d", "(", "in_channels", "=", "6", ",", "out_channels", "=", "16", ",", "kernel_size", "=", "5", ",", "stride", "=", "1", ")", ",", "\n", "nn", ".", "Tanh", "(", ")", ",", "\n", "nn", ".", "AvgPool2d", "(", "kernel_size", "=", "2", ")", ",", "\n", "nn", ".", "Conv2d", "(", "in_channels", "=", "16", ",", "out_channels", "=", "120", ",", "kernel_size", "=", "5", ",", "stride", "=", "1", ")", ",", "\n", "nn", ".", "Tanh", "(", ")", "\n", ")", "\n", "\n", "self", ".", "classifier", "=", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Linear", "(", "in_features", "=", "120", ",", "out_features", "=", "84", ")", ",", "\n", "nn", ".", "Tanh", "(", ")", ",", "\n", "nn", ".", "Linear", "(", "in_features", "=", "84", ",", "out_features", "=", "config", "[", "'n_classes'", "]", ")", ",", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.model.lenet5.Model.forward": [[26, 31], ["lenet5.Model.feature_extractor", "torch.flatten", "lenet5.Model.classifier"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "x", "=", "self", ".", "feature_extractor", "(", "x", ")", "\n", "x", "=", "torch", ".", "flatten", "(", "x", ",", "1", ")", "\n", "logits", "=", "self", ".", "classifier", "(", "x", ")", "\n", "return", "logits", "\n", "", "", ""]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.pmnist_exp.run.Train.__init__": [[47, 53], ["enumerate"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "optimizer", ",", "criterion", ",", "train_loader", ",", "config", ")", ":", "\n", "        ", "self", ".", "optimizer", "=", "optimizer", "\n", "self", ".", "criterion", "=", "criterion", "\n", "self", ".", "config", "=", "config", "\n", "self", ".", "train_loader", "=", "train_loader", "\n", "self", ".", "iter", "=", "enumerate", "(", "train_loader", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.pmnist_exp.run.Train.__call__": [[54, 89], ["model.train", "data.to.to.to", "targets.to.to.to", "run.Train.optimizer.zero_grad", "model", "run.Train.criterion", "run.Train.backward", "run.Train.optimizer.step", "torch.max", "preds.eq().sum().item", "data.to.to.size", "next", "run.Train.item", "data.to.to.size", "enumerate", "next", "preds.eq().sum", "preds.eq"], "methods", ["None"], ["", "def", "__call__", "(", "self", ",", "model", ")", ":", "\n", "        ", "model", ".", "train", "(", ")", "\n", "\n", "run_config", "=", "self", ".", "config", "[", "'run_config'", "]", "\n", "\n", "correct", "=", "0", "\n", "loss_sum", "=", "0", "\n", "tot", "=", "0", "\n", "\n", "try", ":", "\n", "            ", "step", ",", "(", "data", ",", "targets", ")", "=", "next", "(", "self", ".", "iter", ")", "\n", "", "except", "StopIteration", ":", "\n", "            ", "self", ".", "iter", "=", "enumerate", "(", "self", ".", "train_loader", ")", "\n", "step", ",", "(", "data", ",", "targets", ")", "=", "next", "(", "self", ".", "iter", ")", "\n", "\n", "", "data", "=", "data", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "targets", "=", "targets", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "\n", "outputs", "=", "model", "(", "data", ")", "\n", "loss", "=", "self", ".", "criterion", "(", "outputs", ",", "targets", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "_", ",", "preds", "=", "torch", ".", "max", "(", "outputs", ",", "dim", "=", "1", ")", "\n", "\n", "loss_sum", "+=", "loss", ".", "item", "(", ")", "*", "data", ".", "size", "(", "0", ")", "\n", "correct", "+=", "preds", ".", "eq", "(", "targets", ")", ".", "sum", "(", ")", ".", "item", "(", ")", "\n", "tot", "+=", "data", ".", "size", "(", "0", ")", "\n", "\n", "accuracy", "=", "correct", "/", "tot", "\n", "loss", "=", "loss_sum", "/", "tot", "\n", "\n", "return", "loss", ",", "accuracy", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.pmnist_exp.run.ModelInitDataset.__init__": [[345, 350], ["copy.deepcopy"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "target", ",", "len", ")", ":", "\n", "        ", "self", ".", "target", "=", "copy", ".", "deepcopy", "(", "target", ")", "\n", "self", ".", "len", "=", "len", "\n", "self", ".", "inits", "=", "[", "]", "\n", "self", ".", "i", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.pmnist_exp.run.ModelInitDataset.__iter__": [[351, 354], ["None"], "methods", ["None"], ["", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "self", ".", "i", "=", "0", "\n", "return", "self", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.pmnist_exp.run.ModelInitDataset.__next__": [[355, 368], ["copy.deepcopy", "len", "run.ModelInitDataset.target.apply().state_dict", "run.ModelInitDataset.inits.append", "run.ModelInitDataset.target.apply"], "methods", ["None"], ["", "def", "__next__", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "i", ">=", "self", ".", "len", "and", "self", ".", "len", ">=", "0", ":", "\n", "            ", "raise", "StopIteration", "\n", "\n", "", "if", "len", "(", "self", ".", "inits", ")", "-", "1", ">=", "self", ".", "i", ":", "\n", "            ", "res", "=", "self", ".", "inits", "[", "self", ".", "i", "]", "\n", "", "else", ":", "\n", "            ", "res", "=", "copy", ".", "deepcopy", "(", "self", ".", "target", ".", "apply", "(", "initialize_weights", ")", ".", "state_dict", "(", ")", ")", "\n", "if", "self", ".", "len", ">=", "0", ":", "\n", "                ", "self", ".", "inits", ".", "append", "(", "res", ")", "\n", "\n", "", "", "self", ".", "i", "+=", "1", "\n", "return", "res", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.pmnist_exp.run.ModelInitDataset.__len__": [[369, 371], ["None"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "len", "\n", "", "", ""]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.pmnist_exp.run.print_images": [[18, 39], ["zip", "trg.item", "img.astype.detach().clone().cpu().numpy", "range", "numpy.transpose", "numpy.squeeze", "img.astype.astype", "wandb.log", "len", "len", "img.astype.detach().clone().cpu", "range", "range", "wandb.Image", "img.astype.size", "img.astype.size", "img.astype.detach().clone", "img.astype.detach"], "function", ["None"], ["def", "print_images", "(", "data", ",", "trgs", ",", "mean", ",", "std", ")", ":", "\n", "    ", "global", "w", "\n", "\n", "for", "img", ",", "trg", "in", "zip", "(", "data", ",", "trgs", ")", ":", "\n", "        ", "label", "=", "trg", ".", "item", "(", ")", "\n", "\n", "std", "=", "[", "std", "[", "0", "]", "for", "_", "in", "range", "(", "img", ".", "size", "(", "0", ")", ")", "]", "if", "len", "(", "std", ")", "==", "1", "else", "std", "\n", "mean", "=", "[", "mean", "[", "0", "]", "for", "_", "in", "range", "(", "img", ".", "size", "(", "0", ")", ")", "]", "if", "len", "(", "mean", ")", "==", "1", "else", "mean", "\n", "\n", "img", "=", "img", ".", "detach", "(", ")", ".", "clone", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "for", "i", "in", "range", "(", "img", ".", "shape", "[", "0", "]", ")", ":", "\n", "            ", "img", "[", "i", "]", "=", "img", "[", "i", "]", "*", "std", "[", "i", "]", "+", "mean", "[", "i", "]", "\n", "\n", "", "img", "=", "img", "*", "255", "\n", "img", "=", "np", ".", "transpose", "(", "img", ",", "(", "1", ",", "2", ",", "0", ")", ")", "\n", "img", "=", "np", ".", "squeeze", "(", "img", ")", "\n", "img", "=", "img", ".", "astype", "(", "np", ".", "uint8", ")", "\n", "\n", "wandb", ".", "log", "(", "{", "f'img{w}_{label}'", ":", "[", "wandb", ".", "Image", "(", "img", ",", "caption", "=", "f\"{label}\"", ")", "]", "}", ")", "\n", "\n", "w", "+=", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.pmnist_exp.run.initialize_weights": [[40, 44], ["isinstance", "isinstance", "torch.nn.init.xavier_uniform_", "module.bias.data.fill_"], "function", ["None"], ["", "", "def", "initialize_weights", "(", "module", ")", ":", "\n", "    ", "if", "isinstance", "(", "module", ",", "nn", ".", "Conv2d", ")", "or", "isinstance", "(", "module", ",", "nn", ".", "Linear", ")", ":", "\n", "        ", "nn", ".", "init", ".", "xavier_uniform_", "(", "module", ".", "weight", ")", "\n", "module", ".", "bias", ".", "data", ".", "fill_", "(", "0.0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.pmnist_exp.run.test": [[90, 115], ["model.eval", "enumerate", "data.to.to", "targets.to.to", "torch.max", "preds.eq().sum().item", "data.to.size", "torch.no_grad", "criterion", "criterion.item", "data.to.size", "preds.eq().sum", "preds.eq"], "function", ["None"], ["", "", "def", "test", "(", "model", ",", "criterion", ",", "test_loader", ",", "config", ")", ":", "\n", "    ", "model", ".", "eval", "(", ")", "\n", "\n", "correct", "=", "0", "\n", "loss_sum", "=", "0", "\n", "tot", "=", "0", "\n", "\n", "for", "step", ",", "(", "data", ",", "targets", ")", "in", "enumerate", "(", "test_loader", ")", ":", "\n", "        ", "data", "=", "data", ".", "to", "(", "config", "[", "'device'", "]", ")", "\n", "targets", "=", "targets", ".", "to", "(", "config", "[", "'device'", "]", ")", "\n", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "outputs", "=", "model", "(", "data", ")", "\n", "loss", "=", "criterion", "(", "outputs", ",", "targets", ")", "\n", "\n", "", "_", ",", "preds", "=", "torch", ".", "max", "(", "outputs", ",", "dim", "=", "1", ")", "\n", "\n", "loss_sum", "+=", "loss", ".", "item", "(", ")", "*", "data", ".", "size", "(", "0", ")", "\n", "correct", "+=", "preds", ".", "eq", "(", "targets", ")", ".", "sum", "(", ")", ".", "item", "(", ")", "\n", "tot", "+=", "data", ".", "size", "(", "0", ")", "\n", "\n", "", "accuracy", "=", "correct", "/", "tot", "\n", "loss", "=", "loss_sum", "/", "tot", "\n", "\n", "return", "loss", ",", "accuracy", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.pmnist_exp.run.run": [[117, 221], ["torch.manual_seed", "numpy.random.seed", "random.seed", "torch.nn.CrossEntropyLoss", "getattr().Model", "getattr().Model.to", "getattr().Model.apply", "getattr", "enumerate", "wandb.init", "wandb.config.update", "getattr.", "validloaders.append", "getattr.", "contflame.data.utils.MultiLoader", "torch.optim.SGD", "run.Train", "copy.deepcopy", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "range", "getattr", "torch.utils.data.DataLoader", "getattr().Model.parameters", "Train.", "range", "len", "enumerate", "len", "range", "torch.nn.Dropout", "run.distill", "torch.nn.Dropout", "memories.append", "memories.append", "int", "run.test", "print", "wandb.log", "list", "getattr.", "int", "int", "len", "filter", "contflame.data.utils.Buffer", "getattr.", "contflame.data.utils.Buffer"], "function", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.distill", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.test"], ["", "def", "run", "(", "config", ")", ":", "\n", "\n", "    ", "run_config", "=", "config", "[", "'run_config'", "]", "\n", "model_config", "=", "config", "[", "'model_config'", "]", "\n", "param_config", "=", "config", "[", "'param_config'", "]", "\n", "data_config", "=", "config", "[", "'data_config'", "]", "\n", "log_config", "=", "config", "[", "'log_config'", "]", "\n", "\n", "if", "log_config", "[", "'wandb'", "]", ":", "\n", "        ", "wandb", ".", "init", "(", "project", "=", "\"pmnist\"", ",", "name", "=", "log_config", "[", "'wandb_name'", "]", ")", "\n", "wandb", ".", "config", ".", "update", "(", "config", ")", "\n", "\n", "# Reproducibility", "\n", "", "seed", "=", "run_config", "[", "'seed'", "]", "\n", "torch", ".", "manual_seed", "(", "seed", ")", "\n", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "random", ".", "seed", "(", "seed", ")", "\n", "\n", "# Loss", "\n", "criterion", "=", "nn", ".", "CrossEntropyLoss", "(", ")", "\n", "\n", "# Model", "\n", "net", "=", "getattr", "(", "model", ",", "model_config", "[", "'arch'", "]", ")", ".", "Model", "(", "model_config", ")", "\n", "net", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "net", ".", "apply", "(", "initialize_weights", ")", "\n", "\n", "# Data", "\n", "Dataset", "=", "getattr", "(", "datasets", ",", "data_config", "[", "'dataset'", "]", ")", "\n", "\n", "# Training", "\n", "memories", "=", "[", "]", "\n", "validloaders", "=", "[", "]", "\n", "s", "=", "0", "\n", "\n", "for", "task_id", ",", "task", "in", "enumerate", "(", "run_config", "[", "'tasks'", "]", ",", "0", ")", ":", "\n", "\n", "        ", "validset", "=", "Dataset", "(", "dset", "=", "'test'", ",", "valid", "=", "data_config", "[", "'valid'", "]", ",", "transform", "=", "data_config", "[", "'test_transform'", "]", ",", "task", "=", "task", ")", "\n", "validloaders", ".", "append", "(", "DataLoader", "(", "validset", ",", "batch_size", "=", "param_config", "[", "'batch_size'", "]", ",", "shuffle", "=", "False", ",", "pin_memory", "=", "True", ",", "num_workers", "=", "data_config", "[", "'num_workers'", "]", ")", ")", "\n", "trainset", "=", "Dataset", "(", "dset", "=", "'train'", ",", "valid", "=", "data_config", "[", "'valid'", "]", ",", "transform", "=", "data_config", "[", "'train_transform'", "]", ",", "task", "=", "task", ")", "\n", "\n", "\n", "bufferloader", "=", "MultiLoader", "(", "[", "trainset", "]", "+", "memories", ",", "batch_size", "=", "param_config", "[", "'batch_size'", "]", ")", "\n", "\n", "optimizer", "=", "torch", ".", "optim", ".", "SGD", "(", "net", ".", "parameters", "(", ")", ",", "lr", "=", "param_config", "[", "'model_lr'", "]", ",", ")", "\n", "train", "=", "Train", "(", "optimizer", ",", "criterion", ",", "bufferloader", ",", "config", ")", "\n", "\n", "\n", "d_net", "=", "copy", ".", "deepcopy", "(", "net", ")", "\n", "d_trainloader", "=", "DataLoader", "(", "trainset", ",", "batch_size", "=", "param_config", "[", "'distill_batch_size'", "]", ",", "shuffle", "=", "True", ",", "pin_memory", "=", "True", ",", "num_workers", "=", "data_config", "[", "'num_workers'", "]", ")", "\n", "d_validloader", "=", "DataLoader", "(", "validset", ",", "batch_size", "=", "param_config", "[", "'distill_batch_size'", "]", ",", "shuffle", "=", "False", ",", "pin_memory", "=", "True", ",", "num_workers", "=", "data_config", "[", "'num_workers'", "]", ")", "\n", "\n", "if", "param_config", "[", "'steps'", "]", "==", "'epoch'", ":", "\n", "            ", "steps", "=", "len", "(", "bufferloader", ")", "*", "param_config", "[", "'no_steps'", "]", "\n", "", "elif", "param_config", "[", "'steps'", "]", "==", "'minibatch'", ":", "\n", "            ", "steps", "=", "param_config", "[", "'no_steps'", "]", "\n", "", "else", ":", "raise", "ValueError", "\n", "\n", "for", "step", "in", "range", "(", "steps", ")", ":", "\n", "\n", "            ", "buffer_loss", ",", "buffer_accuracy", "=", "train", "(", "net", ")", "\n", "\n", "if", "int", "(", "steps", "*", "0.05", ")", "<=", "0", "or", "step", "%", "int", "(", "steps", "*", "0.05", ")", "==", "int", "(", "steps", "*", "0.05", ")", "-", "1", "or", "step", "==", "0", ":", "\n", "\n", "                ", "valid_m", "=", "{", "'Test accuracy avg'", ":", "0", "}", "\n", "for", "i", ",", "vl", "in", "enumerate", "(", "validloaders", ")", ":", "\n", "                    ", "test_loss", ",", "test_accuracy", "=", "test", "(", "net", ",", "criterion", ",", "vl", ",", "run_config", ")", "\n", "valid_m", "=", "{", "**", "valid_m", ",", "**", "{", "f'Test loss {i}'", ":", "test_loss", ",", "\n", "f'Test accuracy {i}'", ":", "test_accuracy", ",", "}", "}", "\n", "valid_m", "[", "'Test accuracy avg'", "]", "+=", "(", "test_accuracy", "/", "len", "(", "validloaders", ")", ")", "\n", "\n", "", "train_m", "=", "{", "f'Buffer loss'", ":", "buffer_loss", ",", "\n", "f'Buffer accuracy'", ":", "buffer_accuracy", ",", "\n", "f'Step'", ":", "s", "}", "\n", "s", "+=", "1", "\n", "if", "log_config", "[", "'print'", "]", ":", "\n", "                    ", "print", "(", "{", "**", "valid_m", ",", "**", "train_m", "}", ")", "\n", "", "if", "log_config", "[", "'wandb'", "]", ":", "\n", "                    ", "wandb", ".", "log", "(", "{", "**", "valid_m", ",", "**", "train_m", "}", ")", "\n", "\n", "\n", "", "", "", "if", "task_id", "==", "len", "(", "run_config", "[", "'tasks'", "]", ")", "-", "1", ":", "\n", "            ", "break", "\n", "\n", "", "if", "param_config", "[", "'buffer_size'", "]", "!=", "0", ":", "\n", "            ", "buffer", "=", "None", "\n", "for", "b", "in", "range", "(", "param_config", "[", "'buffer_size'", "]", ")", ":", "\n", "                ", "buff", "=", "None", "\n", "\n", "for", "c", "in", "range", "(", "model_config", "[", "'n_classes'", "]", ")", ":", "\n", "                    ", "ds", "=", "list", "(", "filter", "(", "lambda", "x", ":", "x", "[", "1", "]", "==", "c", ",", "Dataset", "(", "dset", "=", "'train'", ",", "valid", "=", "data_config", "[", "'valid'", "]", ",", "\n", "transform", "=", "data_config", "[", "'train_transform'", "]", ",", "task", "=", "task", ")", ")", ")", "\n", "buff", "=", "Buffer", "(", "ds", ",", "1", ")", "if", "buff", "is", "None", "else", "buff", "+", "Buffer", "(", "ds", ",", "1", ")", "\n", "\n", "\n", "", "net", ".", "drop", "=", "nn", ".", "Dropout", "(", "0.0", ")", "\n", "buff", ",", "_", "=", "distill", "(", "d_net", ",", "buff", ",", "config", ",", "criterion", ",", "d_trainloader", ",", "d_validloader", ",", "task_id", ")", "\n", "net", ".", "drop", "=", "nn", ".", "Dropout", "(", "model_config", "[", "'dropout'", "]", ")", "\n", "\n", "buffer", "=", "buff", "if", "buffer", "is", "None", "else", "buffer", "+", "buff", "\n", "\n", "", "if", "param_config", "[", "'buffer_size'", "]", "==", "-", "1", ":", "\n", "                ", "memories", ".", "append", "(", "Dataset", "(", "dset", "=", "'train'", ",", "valid", "=", "data_config", "[", "'valid'", "]", ",", "transform", "=", "data_config", "[", "'train_transform'", "]", ",", "task", "=", "task", ")", ")", "\n", "", "else", ":", "\n", "                ", "memories", ".", "append", "(", "buffer", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.pmnist_exp.run.distill": [[222, 316], ["copy.deepcopy", "copy.deepcopy.train", "copy.deepcopy", "next", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "iter", "torch.optim.SGD", "range", "range", "range", "iter", "buff_imgs.to", "buff_trgs.to", "run.ModelInitDataset", "run.ModelInitDataset", "numpy.log", "torch.tensor", "lr_list.append", "lr_opts.append", "enumerate", "buff_imgs.detach().cpu", "buff_trgs.detach().cpu", "buff_imgs.size", "aux.append", "numpy.log", "contflame.data.utils.Buffer", "torch.utils.data.DataLoader", "torch.optim.SGD", "ds_imgs.to.to", "ds_trgs.to.to", "enumerate", "range", "torch.optim.SGD.zero_grad", "acc_loss.backward", "torch.optim.SGD.step", "len", "numpy.exp", "next", "copy.deepcopy.load_state_dict", "torch.optim.SGD", "lr_opts[].zero_grad", "torch.autograd.grad", "lr_opts[].step", "buff_imgs.detach", "buff_trgs.detach", "numpy.exp", "len", "iter", "next", "range", "copy.deepcopy.parameters", "higher.innerloop_ctx", "range", "torch.tensor.item", "fmodel", "criterion", "diffopt.step", "fmodel", "criterion", "torch.log", "run.test_distill", "run.test_distill", "numpy.log", "wandb.log", "print", "torch.exp", "enumerate", "int", "int", "numpy.exp", "len", "round", "round", "len", "torch.tensor.item", "len", "len", "len"], "function", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.test_distill", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.test_distill"], ["", "", "", "", "def", "distill", "(", "model", ",", "buffer", ",", "config", ",", "criterion", ",", "train_loader", ",", "valid_loader", ",", "id", ")", ":", "\n", "    ", "model", "=", "copy", ".", "deepcopy", "(", "model", ")", "\n", "\n", "run_config", "=", "config", "[", "'run_config'", "]", "\n", "param_config", "=", "config", "[", "'param_config'", "]", "\n", "log_config", "=", "config", "[", "'log_config'", "]", "\n", "\n", "model", ".", "train", "(", ")", "\n", "eval_trainloader", "=", "copy", ".", "deepcopy", "(", "train_loader", ")", "\n", "\n", "buff_imgs", ",", "buff_trgs", "=", "next", "(", "iter", "(", "DataLoader", "(", "buffer", ",", "batch_size", "=", "len", "(", "buffer", ")", ")", ")", ")", "\n", "buff_imgs", ",", "buff_trgs", "=", "buff_imgs", ".", "to", "(", "run_config", "[", "'device'", "]", ")", ",", "buff_trgs", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "\n", "buff_imgs", ".", "requires_grad", "=", "True", "\n", "\n", "init_valid", "=", "DataLoader", "(", "ModelInitDataset", "(", "model", ",", "10", ")", ",", "batch_size", "=", "1", ",", "collate_fn", "=", "lambda", "x", ":", "x", ")", "\n", "init_loader", "=", "DataLoader", "(", "ModelInitDataset", "(", "model", ",", "-", "1", ")", ",", "batch_size", "=", "1", ",", "collate_fn", "=", "lambda", "x", ":", "x", ")", "\n", "init_iter", "=", "iter", "(", "init_loader", ")", "\n", "\n", "buff_opt", "=", "torch", ".", "optim", ".", "SGD", "(", "[", "buff_imgs", "]", ",", "lr", "=", "param_config", "[", "'meta_lr'", "]", ",", ")", "\n", "\n", "lr_list", "=", "[", "]", "\n", "lr_opts", "=", "[", "]", "\n", "for", "_", "in", "range", "(", "param_config", "[", "'inner_steps'", "]", ")", ":", "\n", "        ", "lr", "=", "np", ".", "log", "(", "np", ".", "exp", "(", "[", "param_config", "[", "'model_lr'", "]", "]", ")", "-", "1", ")", "\n", "lr", "=", "torch", ".", "tensor", "(", "lr", ",", "requires_grad", "=", "True", ",", "device", "=", "run_config", "[", "'device'", "]", ")", "\n", "lr_list", ".", "append", "(", "lr", ")", "\n", "lr_opts", ".", "append", "(", "torch", ".", "optim", ".", "SGD", "(", "[", "lr", "]", ",", "param_config", "[", "'lr_lr'", "]", ",", ")", ")", "\n", "\n", "", "for", "i", "in", "range", "(", "param_config", "[", "'outer_steps'", "]", ")", ":", "\n", "        ", "for", "step", ",", "(", "ds_imgs", ",", "ds_trgs", ")", "in", "enumerate", "(", "train_loader", ")", ":", "\n", "            ", "try", ":", "init_batch", "=", "next", "(", "init_iter", ")", "\n", "except", "StopIteration", ":", "init_iter", "=", "iter", "(", "init_loader", ")", ";", "init_batch", "=", "next", "(", "init_iter", ")", "\n", "\n", "ds_imgs", "=", "ds_imgs", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "ds_trgs", "=", "ds_trgs", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "\n", "acc_loss", "=", "None", "\n", "epoch_loss", "=", "[", "None", "for", "_", "in", "range", "(", "param_config", "[", "'inner_steps'", "]", ")", "]", "\n", "\n", "for", "r", ",", "sigma", "in", "enumerate", "(", "init_batch", ")", ":", "\n", "                ", "model", ".", "load_state_dict", "(", "sigma", ")", "\n", "model_opt", "=", "torch", ".", "optim", ".", "SGD", "(", "model", ".", "parameters", "(", ")", ",", "lr", "=", "1", ",", ")", "\n", "with", "higher", ".", "innerloop_ctx", "(", "model", ",", "model_opt", ")", "as", "(", "fmodel", ",", "diffopt", ")", ":", "\n", "                    ", "for", "j", "in", "range", "(", "param_config", "[", "'inner_steps'", "]", ")", ":", "\n", "\n", "                        ", "buff_out", "=", "fmodel", "(", "buff_imgs", ")", "\n", "buff_loss", "=", "criterion", "(", "buff_out", ",", "buff_trgs", ")", "\n", "buff_loss", "=", "buff_loss", "*", "torch", ".", "log", "(", "1", "+", "torch", ".", "exp", "(", "lr_list", "[", "j", "]", ")", ")", "\n", "diffopt", ".", "step", "(", "buff_loss", ")", "\n", "\n", "ds_out", "=", "fmodel", "(", "ds_imgs", ")", "\n", "ds_loss", "=", "criterion", "(", "ds_out", ",", "ds_trgs", ")", "\n", "\n", "epoch_loss", "[", "j", "]", "=", "epoch_loss", "[", "j", "]", "+", "ds_loss", "if", "epoch_loss", "[", "j", "]", "is", "not", "None", "else", "ds_loss", "\n", "acc_loss", "=", "acc_loss", "+", "ds_loss", "if", "acc_loss", "is", "not", "None", "else", "ds_loss", "\n", "\n", "\n", "if", "(", "(", "(", "step", "+", "i", "*", "len", "(", "train_loader", ")", ")", "%", "int", "(", "round", "(", "len", "(", "train_loader", ")", "*", "param_config", "[", "'outer_steps'", "]", "*", "0.05", ")", ")", "==", "int", "(", "round", "(", "len", "(", "train_loader", ")", "*", "param_config", "[", "'outer_steps'", "]", "*", "0.05", ")", ")", "-", "1", ")", "or", "(", "step", "+", "i", "*", "len", "(", "train_loader", ")", ")", "==", "0", ")", "and", "j", "==", "param_config", "[", "'inner_steps'", "]", "-", "1", "and", "r", "==", "0", ":", "\n", "\n", "                            ", "lrs", "=", "[", "np", ".", "log", "(", "np", ".", "exp", "(", "lr", ".", "item", "(", ")", ")", "+", "1", ")", "for", "lr", "in", "lr_list", "]", "\n", "lrs_log", "=", "{", "f'Learning rate {i} - {id}'", ":", "lr", "for", "(", "i", ",", "lr", ")", "in", "enumerate", "(", "lrs", ")", "}", "\n", "train_loss", ",", "train_accuracy", "=", "test_distill", "(", "init_valid", ",", "lrs", ",", "[", "buff_imgs", ",", "buff_trgs", "]", ",", "model", ",", "criterion", ",", "eval_trainloader", ",", "run_config", ")", "\n", "test_loss", ",", "test_accuracy", "=", "test_distill", "(", "init_valid", ",", "lrs", ",", "[", "buff_imgs", ",", "buff_trgs", "]", ",", "model", ",", "criterion", ",", "valid_loader", ",", "run_config", ")", "\n", "metrics", "=", "{", "f'Distill train loss {id}'", ":", "train_loss", ",", "f'Distill train accuracy {id}'", ":", "train_accuracy", ",", "\n", "f'Distill test loss {id}'", ":", "test_loss", ",", "f'Distill test accuracy {id}'", ":", "test_accuracy", ",", "\n", "f'Distill step {id}'", ":", "step", "+", "i", "*", "len", "(", "train_loader", ")", "}", "\n", "\n", "if", "log_config", "[", "'wandb'", "]", ":", "\n", "                                ", "wandb", ".", "log", "(", "{", "**", "metrics", ",", "**", "lrs_log", "}", ")", "\n", "\n", "", "if", "log_config", "[", "'print'", "]", ":", "\n", "                                ", "print", "(", "metrics", ")", "\n", "\n", "# Update the lrs", "\n", "", "", "", "", "", "for", "j", "in", "range", "(", "param_config", "[", "'inner_steps'", "]", ")", ":", "\n", "                ", "lr_opts", "[", "j", "]", ".", "zero_grad", "(", ")", "\n", "grad", ",", "=", "autograd", ".", "grad", "(", "epoch_loss", "[", "j", "]", ",", "lr_list", "[", "j", "]", ",", "retain_graph", "=", "True", ")", "\n", "lr_list", "[", "j", "]", ".", "grad", "=", "grad", "\n", "lr_opts", "[", "j", "]", ".", "step", "(", ")", "\n", "\n", "", "buff_opt", ".", "zero_grad", "(", ")", "\n", "acc_loss", ".", "backward", "(", ")", "\n", "buff_opt", ".", "step", "(", ")", "\n", "\n", "", "", "aux", "=", "[", "]", "\n", "buff_imgs", ",", "buff_trgs", "=", "buff_imgs", ".", "detach", "(", ")", ".", "cpu", "(", ")", ",", "buff_trgs", ".", "detach", "(", ")", ".", "cpu", "(", ")", "\n", "for", "i", "in", "range", "(", "buff_imgs", ".", "size", "(", "0", ")", ")", ":", "\n", "        ", "aux", ".", "append", "(", "[", "buff_imgs", "[", "i", "]", ",", "buff_trgs", "[", "i", "]", "]", ")", "\n", "", "lr_list", "=", "[", "np", ".", "log", "(", "1", "+", "np", ".", "exp", "(", "lr", ".", "item", "(", ")", ")", ")", "for", "lr", "in", "lr_list", "]", "\n", "\n", "return", "Buffer", "(", "aux", ",", "len", "(", "aux", ")", ",", ")", ",", "lr_list", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.pmnist_exp.run.test_distill": [[318, 341], ["model.load_state_dict", "run.test", "torch.optim.SGD", "criterion", "torch.optim.SGD.zero_grad", "criterion.backward", "torch.optim.SGD.step", "len", "len", "model.parameters"], "function", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.test"], ["", "def", "test_distill", "(", "init_valid", ",", "lrs", ",", "buffer", ",", "model", ",", "criterion", ",", "eval_trainloader", ",", "run_config", ")", ":", "\n", "    ", "buff_imgs", ",", "buff_trgs", "=", "buffer", "\n", "\n", "avg_loss", "=", "avg_accuracy", "=", "0", "\n", "\n", "for", "init_batch", "in", "init_valid", ":", "\n", "        ", "for", "init", "in", "init_batch", ":", "\n", "            ", "model", ".", "load_state_dict", "(", "init", ")", "\n", "\n", "for", "lr", "in", "lrs", ":", "\n", "                ", "opt", "=", "torch", ".", "optim", ".", "SGD", "(", "model", ".", "parameters", "(", ")", ",", "lr", "=", "lr", ",", ")", "\n", "pred", "=", "model", "(", "buff_imgs", ")", "\n", "loss", "=", "criterion", "(", "pred", ",", "buff_trgs", ")", "\n", "\n", "opt", ".", "zero_grad", "(", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "opt", ".", "step", "(", ")", "\n", "\n", "", "test_loss", ",", "test_accuracy", "=", "test", "(", "model", ",", "criterion", ",", "eval_trainloader", ",", "run_config", ")", "\n", "avg_loss", "+=", "(", "test_loss", "/", "len", "(", "init_valid", ")", ")", "\n", "avg_accuracy", "+=", "(", "test_accuracy", "/", "len", "(", "init_valid", ")", ")", "\n", "\n", "", "", "return", "avg_loss", ",", "avg_accuracy", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.smnist_exp.run.Train.__init__": [[48, 54], ["enumerate"], "methods", ["None"], ["        ", "self", ".", "optimizer", "=", "optimizer", "\n", "self", ".", "criterion", "=", "criterion", "\n", "self", ".", "config", "=", "config", "\n", "self", ".", "train_loader", "=", "train_loader", "\n", "self", ".", "iter", "=", "enumerate", "(", "train_loader", ")", "\n", "\n", "", "def", "__call__", "(", "self", ",", "model", ")", ":", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.smnist_exp.run.Train.__call__": [[55, 90], ["model.train", "data.to.to.to", "targets.to.to.to", "run.Train.optimizer.zero_grad", "model", "run.Train.criterion", "run.Train.backward", "run.Train.optimizer.step", "torch.max", "preds.eq().sum().item", "data.to.to.size", "next", "run.Train.item", "data.to.to.size", "enumerate", "next", "preds.eq().sum", "preds.eq"], "methods", ["None"], ["        ", "model", ".", "train", "(", ")", "\n", "\n", "run_config", "=", "self", ".", "config", "[", "'run_config'", "]", "\n", "\n", "correct", "=", "0", "\n", "loss_sum", "=", "0", "\n", "tot", "=", "0", "\n", "\n", "try", ":", "\n", "            ", "step", ",", "(", "data", ",", "targets", ")", "=", "next", "(", "self", ".", "iter", ")", "\n", "", "except", "StopIteration", ":", "\n", "            ", "self", ".", "iter", "=", "enumerate", "(", "self", ".", "train_loader", ")", "\n", "step", ",", "(", "data", ",", "targets", ")", "=", "next", "(", "self", ".", "iter", ")", "\n", "\n", "", "data", "=", "data", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "targets", "=", "targets", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "\n", "outputs", "=", "model", "(", "data", ")", "\n", "loss", "=", "self", ".", "criterion", "(", "outputs", ",", "targets", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "_", ",", "preds", "=", "torch", ".", "max", "(", "outputs", ",", "dim", "=", "1", ")", "\n", "\n", "loss_sum", "+=", "loss", ".", "item", "(", ")", "*", "data", ".", "size", "(", "0", ")", "\n", "correct", "+=", "preds", ".", "eq", "(", "targets", ")", ".", "sum", "(", ")", ".", "item", "(", ")", "\n", "tot", "+=", "data", ".", "size", "(", "0", ")", "\n", "\n", "accuracy", "=", "correct", "/", "tot", "\n", "loss", "=", "loss_sum", "/", "tot", "\n", "\n", "return", "loss", ",", "accuracy", "\n", "\n", "", "", "def", "test", "(", "model", ",", "criterion", ",", "test_loader", ",", "config", ")", ":", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.smnist_exp.run.ModelInitDataset.__init__": [[344, 349], ["copy.deepcopy"], "methods", ["None"], ["\n", "    ", "def", "__init__", "(", "self", ",", "target", ",", "len", ")", ":", "\n", "        ", "self", ".", "target", "=", "copy", ".", "deepcopy", "(", "target", ")", "\n", "self", ".", "len", "=", "len", "\n", "self", ".", "inits", "=", "[", "]", "\n", "self", ".", "i", "=", "0", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.smnist_exp.run.ModelInitDataset.__iter__": [[350, 353], ["None"], "methods", ["None"], ["\n", "", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "self", ".", "i", "=", "0", "\n", "return", "self", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.smnist_exp.run.ModelInitDataset.__next__": [[354, 367], ["copy.deepcopy", "len", "run.ModelInitDataset.target.apply().state_dict", "run.ModelInitDataset.inits.append", "run.ModelInitDataset.target.apply"], "methods", ["None"], ["\n", "", "def", "__next__", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "i", ">=", "self", ".", "len", "and", "self", ".", "len", ">=", "0", ":", "\n", "            ", "raise", "StopIteration", "\n", "\n", "", "if", "len", "(", "self", ".", "inits", ")", "-", "1", ">=", "self", ".", "i", ":", "\n", "            ", "res", "=", "self", ".", "inits", "[", "self", ".", "i", "]", "\n", "", "else", ":", "\n", "            ", "res", "=", "copy", ".", "deepcopy", "(", "self", ".", "target", ".", "apply", "(", "initialize_weights", ")", ".", "state_dict", "(", ")", ")", "\n", "if", "self", ".", "len", ">=", "0", ":", "\n", "                ", "self", ".", "inits", ".", "append", "(", "res", ")", "\n", "\n", "", "", "self", ".", "i", "+=", "1", "\n", "return", "res", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.smnist_exp.run.ModelInitDataset.__len__": [[368, 370], ["None"], "methods", ["None"], ["\n", "", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "len", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.smnist_exp.run.print_images": [[18, 40], ["zip", "trg.item", "img.astype.detach().clone().cpu().numpy", "range", "numpy.transpose", "numpy.squeeze", "img.astype.astype", "wandb.log", "len", "len", "img.astype.detach().clone().cpu", "range", "range", "wandb.Image", "img.astype.size", "img.astype.size", "img.astype.detach().clone", "img.astype.detach"], "function", ["None"], ["def", "print_images", "(", "data", ",", "trgs", ",", "mean", ",", "std", ")", ":", "\n", "    ", "global", "w", "\n", "\n", "for", "img", ",", "trg", "in", "zip", "(", "data", ",", "trgs", ")", ":", "\n", "        ", "label", "=", "trg", ".", "item", "(", ")", "\n", "\n", "std", "=", "[", "std", "[", "0", "]", "for", "_", "in", "range", "(", "img", ".", "size", "(", "0", ")", ")", "]", "if", "len", "(", "std", ")", "==", "1", "else", "std", "\n", "mean", "=", "[", "mean", "[", "0", "]", "for", "_", "in", "range", "(", "img", ".", "size", "(", "0", ")", ")", "]", "if", "len", "(", "mean", ")", "==", "1", "else", "mean", "\n", "\n", "img", "=", "img", ".", "detach", "(", ")", ".", "clone", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "for", "i", "in", "range", "(", "img", ".", "shape", "[", "0", "]", ")", ":", "\n", "            ", "img", "[", "i", "]", "=", "img", "[", "i", "]", "*", "std", "[", "i", "]", "+", "mean", "[", "i", "]", "\n", "\n", "", "img", "=", "img", "*", "255", "\n", "img", "=", "np", ".", "transpose", "(", "img", ",", "(", "1", ",", "2", ",", "0", ")", ")", "\n", "img", "=", "np", ".", "squeeze", "(", "img", ")", "\n", "img", "=", "img", ".", "astype", "(", "np", ".", "uint8", ")", "\n", "\n", "wandb", ".", "log", "(", "{", "f'img{w}_{label}'", ":", "[", "wandb", ".", "Image", "(", "img", ",", "caption", "=", "f\"{label}\"", ")", "]", "}", ")", "\n", "\n", "w", "+=", "1", "\n", "\n", "", "", "def", "initialize_weights", "(", "module", ")", ":", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.smnist_exp.run.initialize_weights": [[41, 45], ["isinstance", "isinstance", "torch.nn.init.xavier_uniform_", "module.bias.data.fill_"], "function", ["None"], ["    ", "if", "isinstance", "(", "module", ",", "nn", ".", "Conv2d", ")", "or", "isinstance", "(", "module", ",", "nn", ".", "Linear", ")", ":", "\n", "        ", "nn", ".", "init", ".", "xavier_uniform_", "(", "module", ".", "weight", ")", "\n", "module", ".", "bias", ".", "data", ".", "fill_", "(", "0.0", ")", "\n", "\n", "", "", "class", "Train", ":", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.smnist_exp.run.test": [[91, 116], ["model.eval", "enumerate", "data.to.to", "targets.to.to", "torch.max", "preds.eq().sum().item", "data.to.size", "torch.no_grad", "criterion", "criterion.item", "data.to.size", "preds.eq().sum", "preds.eq"], "function", ["None"], ["    ", "model", ".", "eval", "(", ")", "\n", "\n", "correct", "=", "0", "\n", "loss_sum", "=", "0", "\n", "tot", "=", "0", "\n", "\n", "for", "step", ",", "(", "data", ",", "targets", ")", "in", "enumerate", "(", "test_loader", ")", ":", "\n", "        ", "data", "=", "data", ".", "to", "(", "config", "[", "'device'", "]", ")", "\n", "targets", "=", "targets", ".", "to", "(", "config", "[", "'device'", "]", ")", "\n", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "outputs", "=", "model", "(", "data", ")", "\n", "loss", "=", "criterion", "(", "outputs", ",", "targets", ")", "\n", "\n", "", "_", ",", "preds", "=", "torch", ".", "max", "(", "outputs", ",", "dim", "=", "1", ")", "\n", "\n", "loss_sum", "+=", "loss", ".", "item", "(", ")", "*", "data", ".", "size", "(", "0", ")", "\n", "correct", "+=", "preds", ".", "eq", "(", "targets", ")", ".", "sum", "(", ")", ".", "item", "(", ")", "\n", "tot", "+=", "data", ".", "size", "(", "0", ")", "\n", "\n", "", "accuracy", "=", "correct", "/", "tot", "\n", "loss", "=", "loss_sum", "/", "tot", "\n", "\n", "return", "loss", ",", "accuracy", "\n", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.smnist_exp.run.run": [[118, 218], ["torch.manual_seed", "numpy.random.seed", "random.seed", "torch.nn.CrossEntropyLoss", "getattr().Model", "getattr().Model.to", "getattr().Model.apply", "getattr", "enumerate", "wandb.init", "wandb.config.update", "getattr.", "validloaders.append", "getattr.", "contflame.data.utils.MultiLoader", "torch.optim.SGD", "run.Train", "copy.deepcopy", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "range", "getattr", "torch.utils.data.DataLoader", "getattr().Model.parameters", "Train.", "run.distill", "memories.append", "len", "enumerate", "len", "getattr.", "next", "run.print_images", "run.print_images", "next", "run.print_images", "run.print_images", "int", "run.test", "print", "wandb.log", "contflame.data.utils.Buffer", "iter", "iter", "int", "int", "len", "contflame.data.utils.Buffer", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "len", "len"], "function", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.distill", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.print_images", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.print_images", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.print_images", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.print_images", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.test"], ["\n", "    ", "run_config", "=", "config", "[", "'run_config'", "]", "\n", "model_config", "=", "config", "[", "'model_config'", "]", "\n", "param_config", "=", "config", "[", "'param_config'", "]", "\n", "data_config", "=", "config", "[", "'data_config'", "]", "\n", "log_config", "=", "config", "[", "'log_config'", "]", "\n", "\n", "if", "log_config", "[", "'wandb'", "]", ":", "\n", "        ", "wandb", ".", "init", "(", "project", "=", "\"pmnist\"", ",", "name", "=", "log_config", "[", "'wandb_name'", "]", ")", "\n", "wandb", ".", "config", ".", "update", "(", "config", ")", "\n", "\n", "# Reproducibility", "\n", "", "seed", "=", "run_config", "[", "'seed'", "]", "\n", "torch", ".", "manual_seed", "(", "seed", ")", "\n", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "random", ".", "seed", "(", "seed", ")", "\n", "\n", "# Loss", "\n", "criterion", "=", "nn", ".", "CrossEntropyLoss", "(", ")", "\n", "\n", "# Model", "\n", "net", "=", "getattr", "(", "model", ",", "model_config", "[", "'arch'", "]", ")", ".", "Model", "(", "model_config", ")", "\n", "net", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "net", ".", "apply", "(", "initialize_weights", ")", "\n", "\n", "# Data", "\n", "Dataset", "=", "getattr", "(", "datasets", ",", "data_config", "[", "'dataset'", "]", ")", "\n", "\n", "# Training", "\n", "memories", "=", "[", "]", "\n", "validloaders", "=", "[", "]", "\n", "s", "=", "0", "\n", "\n", "for", "task_id", ",", "task", "in", "enumerate", "(", "run_config", "[", "'tasks'", "]", ",", "0", ")", ":", "\n", "\n", "        ", "validset", "=", "Dataset", "(", "dset", "=", "'test'", ",", "valid", "=", "data_config", "[", "'valid'", "]", ",", "transform", "=", "data_config", "[", "'test_transform'", "]", ",", "task", "=", "task", ")", "\n", "validloaders", ".", "append", "(", "DataLoader", "(", "validset", ",", "batch_size", "=", "param_config", "[", "'batch_size'", "]", ",", "shuffle", "=", "False", ",", "pin_memory", "=", "True", ",", "num_workers", "=", "data_config", "[", "'num_workers'", "]", ")", ")", "\n", "trainset", "=", "Dataset", "(", "dset", "=", "'train'", ",", "valid", "=", "data_config", "[", "'valid'", "]", ",", "transform", "=", "data_config", "[", "'train_transform'", "]", ",", "task", "=", "task", ")", "\n", "\n", "\n", "bufferloader", "=", "MultiLoader", "(", "[", "trainset", "]", "+", "memories", ",", "batch_size", "=", "param_config", "[", "'batch_size'", "]", ")", "\n", "\n", "optimizer", "=", "torch", ".", "optim", ".", "SGD", "(", "net", ".", "parameters", "(", ")", ",", "lr", "=", "param_config", "[", "'model_lr'", "]", ",", ")", "\n", "train", "=", "Train", "(", "optimizer", ",", "criterion", ",", "bufferloader", ",", "config", ")", "\n", "\n", "\n", "d_net", "=", "copy", ".", "deepcopy", "(", "net", ")", "\n", "d_trainloader", "=", "DataLoader", "(", "trainset", ",", "batch_size", "=", "param_config", "[", "'distill_batch_size'", "]", ",", "shuffle", "=", "True", ",", "pin_memory", "=", "True", ",", "num_workers", "=", "data_config", "[", "'num_workers'", "]", ")", "\n", "d_validloader", "=", "DataLoader", "(", "validset", ",", "batch_size", "=", "param_config", "[", "'distill_batch_size'", "]", ",", "shuffle", "=", "False", ",", "pin_memory", "=", "True", ",", "num_workers", "=", "data_config", "[", "'num_workers'", "]", ")", "\n", "\n", "if", "param_config", "[", "'steps'", "]", "==", "'epoch'", ":", "\n", "            ", "steps", "=", "len", "(", "bufferloader", ")", "*", "param_config", "[", "'no_steps'", "]", "\n", "", "elif", "param_config", "[", "'steps'", "]", "==", "'minibatch'", ":", "\n", "            ", "steps", "=", "param_config", "[", "'no_steps'", "]", "\n", "", "else", ":", "raise", "ValueError", "\n", "\n", "for", "step", "in", "range", "(", "steps", ")", ":", "\n", "\n", "            ", "buffer_loss", ",", "buffer_accuracy", "=", "train", "(", "net", ")", "\n", "\n", "if", "int", "(", "steps", "*", "0.05", ")", "<=", "0", "or", "step", "%", "int", "(", "steps", "*", "0.05", ")", "==", "int", "(", "steps", "*", "0.05", ")", "-", "1", "or", "step", "==", "0", ":", "\n", "\n", "                ", "valid_m", "=", "{", "'Test accuracy avg'", ":", "0", "}", "\n", "for", "i", ",", "vl", "in", "enumerate", "(", "validloaders", ")", ":", "\n", "                    ", "test_loss", ",", "test_accuracy", "=", "test", "(", "net", ",", "criterion", ",", "vl", ",", "run_config", ")", "\n", "valid_m", "=", "{", "**", "valid_m", ",", "**", "{", "f'Test loss {i}'", ":", "test_loss", ",", "\n", "f'Test accuracy {i}'", ":", "test_accuracy", ",", "}", "}", "\n", "valid_m", "[", "'Test accuracy avg'", "]", "+=", "(", "test_accuracy", "/", "len", "(", "validloaders", ")", ")", "\n", "\n", "", "train_m", "=", "{", "f'Buffer loss'", ":", "buffer_loss", ",", "\n", "f'Buffer accuracy'", ":", "buffer_accuracy", ",", "\n", "f'Step'", ":", "s", "}", "\n", "s", "+=", "1", "\n", "if", "log_config", "[", "'print'", "]", ":", "\n", "                    ", "print", "(", "{", "**", "valid_m", ",", "**", "train_m", "}", ")", "\n", "", "if", "log_config", "[", "'wandb'", "]", ":", "\n", "                    ", "wandb", ".", "log", "(", "{", "**", "valid_m", ",", "**", "train_m", "}", ")", "\n", "\n", "\n", "", "", "", "if", "task_id", "==", "len", "(", "run_config", "[", "'tasks'", "]", ")", "-", "1", ":", "\n", "            ", "break", "\n", "\n", "", "if", "param_config", "[", "'buffer_size'", "]", "!=", "0", ":", "\n", "            ", "buffer", "=", "None", "\n", "for", "b", "in", "range", "(", "param_config", "[", "'buffer_size'", "]", ")", ":", "\n", "                ", "buff", "=", "None", "\n", "\n", "for", "c", "in", "range", "(", "model_config", "[", "'n_classes'", "]", ")", ":", "\n", "                    ", "ds", "=", "list", "(", "filter", "(", "lambda", "x", ":", "x", "[", "1", "]", "==", "c", ",", "Dataset", "(", "dset", "=", "'train'", ",", "valid", "=", "data_config", "[", "'valid'", "]", ",", "\n", "transform", "=", "data_config", "[", "'train_transform'", "]", ",", "task", "=", "task", ")", ")", ")", "\n", "buff", "=", "Buffer", "(", "ds", ",", "1", ")", "if", "buff", "is", "None", "else", "buff", "+", "Buffer", "(", "ds", ",", "1", ")", "\n", "\n", "\n", "", "net", ".", "drop", "=", "nn", ".", "Dropout", "(", "0.0", ")", "\n", "buff", ",", "_", "=", "distill", "(", "d_net", ",", "buff", ",", "config", ",", "criterion", ",", "d_trainloader", ",", "d_validloader", ",", "task_id", ")", "\n", "net", ".", "drop", "=", "nn", ".", "Dropout", "(", "model_config", "[", "'dropout'", "]", ")", "\n", "\n", "buffer", "=", "buff", "if", "buffer", "is", "None", "else", "buffer", "+", "buff", "\n", "\n", "", "if", "param_config", "[", "'buffer_size'", "]", "==", "-", "1", ":", "\n", "                ", "memories", ".", "append", "(", "Dataset", "(", "dset", "=", "'train'", ",", "valid", "=", "data_config", "[", "'valid'", "]", ",", "transform", "=", "data_config", "[", "'train_transform'", "]", ",", "task", "=", "task", ")", ")", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.smnist_exp.run.distill": [[221, 315], ["copy.deepcopy", "copy.deepcopy.train", "copy.deepcopy", "next", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "iter", "torch.optim.SGD", "range", "range", "range", "iter", "buff_imgs.to", "buff_trgs.to", "run.ModelInitDataset", "run.ModelInitDataset", "numpy.log", "torch.tensor", "lr_list.append", "lr_opts.append", "enumerate", "buff_imgs.detach().cpu", "buff_trgs.detach().cpu", "buff_imgs.size", "aux.append", "numpy.log", "contflame.data.utils.Buffer", "torch.utils.data.DataLoader", "torch.optim.SGD", "ds_imgs.to.to", "ds_trgs.to.to", "enumerate", "range", "torch.optim.SGD.zero_grad", "acc_loss.backward", "torch.optim.SGD.step", "len", "numpy.exp", "next", "copy.deepcopy.load_state_dict", "torch.optim.SGD", "lr_opts[].zero_grad", "torch.autograd.grad", "lr_opts[].step", "buff_imgs.detach", "buff_trgs.detach", "numpy.exp", "len", "iter", "next", "range", "copy.deepcopy.parameters", "higher.innerloop_ctx", "range", "torch.tensor.item", "fmodel", "criterion", "diffopt.step", "fmodel", "criterion", "torch.log", "run.test_distill", "run.test_distill", "numpy.log", "wandb.log", "print", "torch.exp", "enumerate", "int", "int", "numpy.exp", "len", "round", "round", "len", "torch.tensor.item", "len", "len", "len"], "function", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.test_distill", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.test_distill"], ["\n", "", "", "", "", "def", "distill", "(", "model", ",", "buffer", ",", "config", ",", "criterion", ",", "train_loader", ",", "valid_loader", ",", "id", ")", ":", "\n", "    ", "model", "=", "copy", ".", "deepcopy", "(", "model", ")", "\n", "\n", "run_config", "=", "config", "[", "'run_config'", "]", "\n", "param_config", "=", "config", "[", "'param_config'", "]", "\n", "log_config", "=", "config", "[", "'log_config'", "]", "\n", "\n", "model", ".", "train", "(", ")", "\n", "eval_trainloader", "=", "copy", ".", "deepcopy", "(", "train_loader", ")", "\n", "\n", "buff_imgs", ",", "buff_trgs", "=", "next", "(", "iter", "(", "DataLoader", "(", "buffer", ",", "batch_size", "=", "len", "(", "buffer", ")", ")", ")", ")", "\n", "buff_imgs", ",", "buff_trgs", "=", "buff_imgs", ".", "to", "(", "run_config", "[", "'device'", "]", ")", ",", "buff_trgs", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "\n", "buff_imgs", ".", "requires_grad", "=", "True", "\n", "\n", "init_valid", "=", "DataLoader", "(", "ModelInitDataset", "(", "model", ",", "10", ")", ",", "batch_size", "=", "1", ",", "collate_fn", "=", "lambda", "x", ":", "x", ")", "\n", "init_loader", "=", "DataLoader", "(", "ModelInitDataset", "(", "model", ",", "-", "1", ")", ",", "batch_size", "=", "1", ",", "collate_fn", "=", "lambda", "x", ":", "x", ")", "\n", "init_iter", "=", "iter", "(", "init_loader", ")", "\n", "\n", "buff_opt", "=", "torch", ".", "optim", ".", "SGD", "(", "[", "buff_imgs", "]", ",", "lr", "=", "param_config", "[", "'meta_lr'", "]", ",", ")", "\n", "\n", "lr_list", "=", "[", "]", "\n", "lr_opts", "=", "[", "]", "\n", "for", "_", "in", "range", "(", "param_config", "[", "'inner_steps'", "]", ")", ":", "\n", "        ", "lr", "=", "np", ".", "log", "(", "np", ".", "exp", "(", "[", "param_config", "[", "'model_lr'", "]", "]", ")", "-", "1", ")", "\n", "lr", "=", "torch", ".", "tensor", "(", "lr", ",", "requires_grad", "=", "True", ",", "device", "=", "run_config", "[", "'device'", "]", ")", "\n", "lr_list", ".", "append", "(", "lr", ")", "\n", "lr_opts", ".", "append", "(", "torch", ".", "optim", ".", "SGD", "(", "[", "lr", "]", ",", "param_config", "[", "'lr_lr'", "]", ",", ")", ")", "\n", "\n", "", "for", "i", "in", "range", "(", "param_config", "[", "'outer_steps'", "]", ")", ":", "\n", "        ", "for", "step", ",", "(", "ds_imgs", ",", "ds_trgs", ")", "in", "enumerate", "(", "train_loader", ")", ":", "\n", "            ", "try", ":", "init_batch", "=", "next", "(", "init_iter", ")", "\n", "except", "StopIteration", ":", "init_iter", "=", "iter", "(", "init_loader", ")", ";", "init_batch", "=", "next", "(", "init_iter", ")", "\n", "\n", "ds_imgs", "=", "ds_imgs", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "ds_trgs", "=", "ds_trgs", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "\n", "acc_loss", "=", "None", "\n", "epoch_loss", "=", "[", "None", "for", "_", "in", "range", "(", "param_config", "[", "'inner_steps'", "]", ")", "]", "\n", "\n", "for", "r", ",", "sigma", "in", "enumerate", "(", "init_batch", ")", ":", "\n", "                ", "model", ".", "load_state_dict", "(", "sigma", ")", "\n", "model_opt", "=", "torch", ".", "optim", ".", "SGD", "(", "model", ".", "parameters", "(", ")", ",", "lr", "=", "1", ",", ")", "\n", "with", "higher", ".", "innerloop_ctx", "(", "model", ",", "model_opt", ")", "as", "(", "fmodel", ",", "diffopt", ")", ":", "\n", "                    ", "for", "j", "in", "range", "(", "param_config", "[", "'inner_steps'", "]", ")", ":", "\n", "\n", "                        ", "buff_out", "=", "fmodel", "(", "buff_imgs", ")", "\n", "buff_loss", "=", "criterion", "(", "buff_out", ",", "buff_trgs", ")", "\n", "buff_loss", "=", "buff_loss", "*", "torch", ".", "log", "(", "1", "+", "torch", ".", "exp", "(", "lr_list", "[", "j", "]", ")", ")", "\n", "diffopt", ".", "step", "(", "buff_loss", ")", "\n", "\n", "ds_out", "=", "fmodel", "(", "ds_imgs", ")", "\n", "ds_loss", "=", "criterion", "(", "ds_out", ",", "ds_trgs", ")", "\n", "\n", "epoch_loss", "[", "j", "]", "=", "epoch_loss", "[", "j", "]", "+", "ds_loss", "if", "epoch_loss", "[", "j", "]", "is", "not", "None", "else", "ds_loss", "\n", "acc_loss", "=", "acc_loss", "+", "ds_loss", "if", "acc_loss", "is", "not", "None", "else", "ds_loss", "\n", "\n", "\n", "if", "(", "(", "(", "step", "+", "i", "*", "len", "(", "train_loader", ")", ")", "%", "int", "(", "round", "(", "len", "(", "train_loader", ")", "*", "param_config", "[", "'outer_steps'", "]", "*", "0.05", ")", ")", "==", "int", "(", "round", "(", "len", "(", "train_loader", ")", "*", "param_config", "[", "'outer_steps'", "]", "*", "0.05", ")", ")", "-", "1", ")", "or", "(", "step", "+", "i", "*", "len", "(", "train_loader", ")", ")", "==", "0", ")", "and", "j", "==", "param_config", "[", "'inner_steps'", "]", "-", "1", "and", "r", "==", "0", ":", "\n", "\n", "                            ", "lrs", "=", "[", "np", ".", "log", "(", "np", ".", "exp", "(", "lr", ".", "item", "(", ")", ")", "+", "1", ")", "for", "lr", "in", "lr_list", "]", "\n", "lrs_log", "=", "{", "f'Learning rate {i} - {id}'", ":", "lr", "for", "(", "i", ",", "lr", ")", "in", "enumerate", "(", "lrs", ")", "}", "\n", "train_loss", ",", "train_accuracy", "=", "test_distill", "(", "init_valid", ",", "lrs", ",", "[", "buff_imgs", ",", "buff_trgs", "]", ",", "model", ",", "criterion", ",", "eval_trainloader", ",", "run_config", ")", "\n", "test_loss", ",", "test_accuracy", "=", "test_distill", "(", "init_valid", ",", "lrs", ",", "[", "buff_imgs", ",", "buff_trgs", "]", ",", "model", ",", "criterion", ",", "valid_loader", ",", "run_config", ")", "\n", "metrics", "=", "{", "f'Distill train loss {id}'", ":", "train_loss", ",", "f'Distill train accuracy {id}'", ":", "train_accuracy", ",", "\n", "f'Distill test loss {id}'", ":", "test_loss", ",", "f'Distill test accuracy {id}'", ":", "test_accuracy", ",", "\n", "f'Distill step {id}'", ":", "step", "+", "i", "*", "len", "(", "train_loader", ")", "}", "\n", "\n", "if", "log_config", "[", "'wandb'", "]", ":", "\n", "                                ", "wandb", ".", "log", "(", "{", "**", "metrics", ",", "**", "lrs_log", "}", ")", "\n", "\n", "", "if", "log_config", "[", "'print'", "]", ":", "\n", "                                ", "print", "(", "metrics", ")", "\n", "\n", "# Update the lrs", "\n", "", "", "", "", "", "for", "j", "in", "range", "(", "param_config", "[", "'inner_steps'", "]", ")", ":", "\n", "                ", "lr_opts", "[", "j", "]", ".", "zero_grad", "(", ")", "\n", "grad", ",", "=", "autograd", ".", "grad", "(", "epoch_loss", "[", "j", "]", ",", "lr_list", "[", "j", "]", ",", "retain_graph", "=", "True", ")", "\n", "lr_list", "[", "j", "]", ".", "grad", "=", "grad", "\n", "lr_opts", "[", "j", "]", ".", "step", "(", ")", "\n", "\n", "", "buff_opt", ".", "zero_grad", "(", ")", "\n", "acc_loss", ".", "backward", "(", ")", "\n", "buff_opt", ".", "step", "(", ")", "\n", "\n", "", "", "aux", "=", "[", "]", "\n", "buff_imgs", ",", "buff_trgs", "=", "buff_imgs", ".", "detach", "(", ")", ".", "cpu", "(", ")", ",", "buff_trgs", ".", "detach", "(", ")", ".", "cpu", "(", ")", "\n", "for", "i", "in", "range", "(", "buff_imgs", ".", "size", "(", "0", ")", ")", ":", "\n", "        ", "aux", ".", "append", "(", "[", "buff_imgs", "[", "i", "]", ",", "buff_trgs", "[", "i", "]", "]", ")", "\n", "", "lr_list", "=", "[", "np", ".", "log", "(", "1", "+", "np", ".", "exp", "(", "lr", ".", "item", "(", ")", ")", ")", "for", "lr", "in", "lr_list", "]", "\n", "\n", "return", "Buffer", "(", "aux", ",", "len", "(", "aux", ")", ",", ")", ",", "lr_list", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.smnist_exp.run.test_distill": [[317, 340], ["model.load_state_dict", "run.test", "torch.optim.SGD", "criterion", "torch.optim.SGD.zero_grad", "criterion.backward", "torch.optim.SGD.step", "len", "len", "model.parameters"], "function", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.test"], ["\n", "", "def", "test_distill", "(", "init_valid", ",", "lrs", ",", "buffer", ",", "model", ",", "criterion", ",", "eval_trainloader", ",", "run_config", ")", ":", "\n", "    ", "buff_imgs", ",", "buff_trgs", "=", "buffer", "\n", "\n", "avg_loss", "=", "avg_accuracy", "=", "0", "\n", "\n", "for", "init_batch", "in", "init_valid", ":", "\n", "        ", "for", "init", "in", "init_batch", ":", "\n", "            ", "model", ".", "load_state_dict", "(", "init", ")", "\n", "\n", "for", "lr", "in", "lrs", ":", "\n", "                ", "opt", "=", "torch", ".", "optim", ".", "SGD", "(", "model", ".", "parameters", "(", ")", ",", "lr", "=", "lr", ",", ")", "\n", "pred", "=", "model", "(", "buff_imgs", ")", "\n", "loss", "=", "criterion", "(", "pred", ",", "buff_trgs", ")", "\n", "\n", "opt", ".", "zero_grad", "(", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "opt", ".", "step", "(", ")", "\n", "\n", "", "test_loss", ",", "test_accuracy", "=", "test", "(", "model", ",", "criterion", ",", "eval_trainloader", ",", "run_config", ")", "\n", "avg_loss", "+=", "(", "test_loss", "/", "len", "(", "init_valid", ")", ")", "\n", "avg_accuracy", "+=", "(", "test_accuracy", "/", "len", "(", "init_valid", ")", ")", "\n", "\n", "", "", "return", "avg_loss", ",", "avg_accuracy", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.scifar10_exp.run.Train.__init__": [[53, 59], ["enumerate"], "methods", ["None"], ["\n", "", "def", "__call__", "(", "self", ",", "model", ")", ":", "\n", "        ", "model", ".", "train", "(", ")", "\n", "\n", "run_config", "=", "self", ".", "config", "[", "'run_config'", "]", "\n", "\n", "correct", "=", "0", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.scifar10_exp.run.Train.__call__": [[60, 95], ["model.train", "data.to.to.to", "targets.to.to.to", "run.Train.optimizer.zero_grad", "model", "run.Train.criterion", "run.Train.backward", "run.Train.optimizer.step", "torch.max", "preds.eq().sum().item", "data.to.to.size", "next", "run.Train.item", "data.to.to.size", "enumerate", "next", "preds.eq().sum", "preds.eq"], "methods", ["None"], ["loss_sum", "=", "0", "\n", "tot", "=", "0", "\n", "\n", "try", ":", "\n", "            ", "step", ",", "(", "data", ",", "targets", ")", "=", "next", "(", "self", ".", "iter", ")", "\n", "", "except", "StopIteration", ":", "\n", "            ", "self", ".", "iter", "=", "enumerate", "(", "self", ".", "train_loader", ")", "\n", "step", ",", "(", "data", ",", "targets", ")", "=", "next", "(", "self", ".", "iter", ")", "\n", "\n", "", "data", "=", "data", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "targets", "=", "targets", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "\n", "outputs", "=", "model", "(", "data", ")", "\n", "loss", "=", "self", ".", "criterion", "(", "outputs", ",", "targets", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "_", ",", "preds", "=", "torch", ".", "max", "(", "outputs", ",", "dim", "=", "1", ")", "\n", "\n", "loss_sum", "+=", "loss", ".", "item", "(", ")", "*", "data", ".", "size", "(", "0", ")", "\n", "correct", "+=", "preds", ".", "eq", "(", "targets", ")", ".", "sum", "(", ")", ".", "item", "(", ")", "\n", "tot", "+=", "data", ".", "size", "(", "0", ")", "\n", "\n", "accuracy", "=", "correct", "/", "tot", "\n", "loss", "=", "loss_sum", "/", "tot", "\n", "\n", "return", "loss", ",", "accuracy", "\n", "\n", "", "", "def", "test", "(", "model", ",", "criterion", ",", "test_loader", ",", "config", ")", ":", "\n", "    ", "model", ".", "eval", "(", ")", "\n", "\n", "correct", "=", "0", "\n", "loss_sum", "=", "0", "\n", "tot", "=", "0", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.scifar10_exp.run.ModelInitDataset.__init__": [[349, 354], ["copy.deepcopy"], "methods", ["None"], ["self", ".", "i", "=", "0", "\n", "\n", "", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "self", ".", "i", "=", "0", "\n", "return", "self", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.scifar10_exp.run.ModelInitDataset.__iter__": [[355, 358], ["None"], "methods", ["None"], ["", "def", "__next__", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "i", ">=", "self", ".", "len", "and", "self", ".", "len", ">=", "0", ":", "\n", "            ", "raise", "StopIteration", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.scifar10_exp.run.ModelInitDataset.__next__": [[359, 372], ["copy.deepcopy", "len", "run.ModelInitDataset.target.apply().state_dict", "run.ModelInitDataset.inits.append", "run.ModelInitDataset.target.apply"], "methods", ["None"], ["", "if", "len", "(", "self", ".", "inits", ")", "-", "1", ">=", "self", ".", "i", ":", "\n", "            ", "res", "=", "self", ".", "inits", "[", "self", ".", "i", "]", "\n", "", "else", ":", "\n", "            ", "res", "=", "copy", ".", "deepcopy", "(", "self", ".", "target", ".", "apply", "(", "initialize_weights", ")", ".", "state_dict", "(", ")", ")", "\n", "if", "self", ".", "len", ">=", "0", ":", "\n", "                ", "self", ".", "inits", ".", "append", "(", "res", ")", "\n", "\n", "", "", "self", ".", "i", "+=", "1", "\n", "return", "res", "\n", "\n", "", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "len", "\n", "", "", ""]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.scifar10_exp.run.ModelInitDataset.__len__": [[373, 375], ["None"], "methods", ["None"], []], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.scifar10_exp.run.print_images": [[19, 41], ["zip", "trg.item", "img.astype.detach().clone().cpu().numpy", "range", "numpy.transpose", "numpy.squeeze", "img.astype.astype", "wandb.log", "len", "len", "img.astype.detach().clone().cpu", "range", "range", "wandb.Image", "img.astype.size", "img.astype.size", "img.astype.detach().clone", "img.astype.detach"], "function", ["None"], ["    ", "global", "w", "\n", "\n", "for", "img", ",", "trg", "in", "zip", "(", "data", ",", "trgs", ")", ":", "\n", "        ", "label", "=", "trg", ".", "item", "(", ")", "\n", "\n", "std", "=", "[", "std", "[", "0", "]", "for", "_", "in", "range", "(", "img", ".", "size", "(", "0", ")", ")", "]", "if", "len", "(", "std", ")", "==", "1", "else", "std", "\n", "mean", "=", "[", "mean", "[", "0", "]", "for", "_", "in", "range", "(", "img", ".", "size", "(", "0", ")", ")", "]", "if", "len", "(", "mean", ")", "==", "1", "else", "mean", "\n", "\n", "img", "=", "img", ".", "detach", "(", ")", ".", "clone", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "for", "i", "in", "range", "(", "img", ".", "shape", "[", "0", "]", ")", ":", "\n", "            ", "img", "[", "i", "]", "=", "img", "[", "i", "]", "*", "std", "[", "i", "]", "+", "mean", "[", "i", "]", "\n", "\n", "", "img", "=", "img", "*", "255", "\n", "img", "=", "np", ".", "transpose", "(", "img", ",", "(", "1", ",", "2", ",", "0", ")", ")", "\n", "img", "=", "np", ".", "squeeze", "(", "img", ")", "\n", "img", "=", "img", ".", "astype", "(", "np", ".", "uint8", ")", "\n", "\n", "wandb", ".", "log", "(", "{", "f'img{w}_{label}'", ":", "[", "wandb", ".", "Image", "(", "img", ",", "caption", "=", "f\"{label}\"", ")", "]", "}", ")", "\n", "\n", "w", "+=", "1", "\n", "\n", "", "", "def", "initialize_weights", "(", "module", ")", ":", "\n", "    ", "if", "isinstance", "(", "module", ",", "nn", ".", "Conv2d", ")", "or", "isinstance", "(", "module", ",", "nn", ".", "Linear", ")", ":", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.scifar10_exp.run.initialize_weights": [[42, 50], ["isinstance", "isinstance", "torch.nn.init.xavier_uniform_", "isinstance", "module.bias.data.fill_", "module.weight.data.uniform_", "module.bias.data.zero_"], "function", ["None"], ["        ", "nn", ".", "init", ".", "xavier_uniform_", "(", "module", ".", "weight", ")", "\n", "module", ".", "bias", ".", "data", ".", "fill_", "(", "0.0", ")", "\n", "\n", "", "", "class", "Train", ":", "\n", "\n", "    ", "def", "__init__", "(", "self", ",", "optimizer", ",", "criterion", ",", "train_loader", ",", "config", ")", ":", "\n", "        ", "self", ".", "optimizer", "=", "optimizer", "\n", "self", ".", "criterion", "=", "criterion", "\n", "self", ".", "config", "=", "config", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.scifar10_exp.run.test": [[96, 121], ["model.eval", "enumerate", "data.to.to", "targets.to.to", "torch.max", "preds.eq().sum().item", "data.to.size", "torch.no_grad", "criterion", "criterion.item", "data.to.size", "preds.eq().sum", "preds.eq"], "function", ["None"], ["\n", "for", "step", ",", "(", "data", ",", "targets", ")", "in", "enumerate", "(", "test_loader", ")", ":", "\n", "        ", "data", "=", "data", ".", "to", "(", "config", "[", "'device'", "]", ")", "\n", "targets", "=", "targets", ".", "to", "(", "config", "[", "'device'", "]", ")", "\n", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "outputs", "=", "model", "(", "data", ")", "\n", "loss", "=", "criterion", "(", "outputs", ",", "targets", ")", "\n", "\n", "", "_", ",", "preds", "=", "torch", ".", "max", "(", "outputs", ",", "dim", "=", "1", ")", "\n", "\n", "loss_sum", "+=", "loss", ".", "item", "(", ")", "*", "data", ".", "size", "(", "0", ")", "\n", "correct", "+=", "preds", ".", "eq", "(", "targets", ")", ".", "sum", "(", ")", ".", "item", "(", ")", "\n", "tot", "+=", "data", ".", "size", "(", "0", ")", "\n", "\n", "", "accuracy", "=", "correct", "/", "tot", "\n", "loss", "=", "loss_sum", "/", "tot", "\n", "\n", "return", "loss", ",", "accuracy", "\n", "\n", "\n", "", "def", "run", "(", "config", ")", ":", "\n", "\n", "    ", "run_config", "=", "config", "[", "'run_config'", "]", "\n", "model_config", "=", "config", "[", "'model_config'", "]", "\n", "param_config", "=", "config", "[", "'param_config'", "]", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.scifar10_exp.run.run": [[123, 224], ["torch.manual_seed", "numpy.random.seed", "random.seed", "torch.nn.CrossEntropyLoss", "getattr().Model", "getattr().Model.to", "getattr().Model.apply", "getattr", "enumerate", "wandb.init", "wandb.config.update", "getattr.", "validloaders.append", "getattr.", "contflame.data.utils.MultiLoader", "torch.optim.SGD", "run.Train", "copy.deepcopy", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "range", "getattr", "torch.utils.data.DataLoader", "getattr().Model.parameters", "Train.", "run.distill", "memories.append", "len", "enumerate", "len", "getattr.", "next", "run.print_images", "run.print_images", "next", "run.print_images", "run.print_images", "int", "run.test", "print", "wandb.log", "contflame.data.utils.Buffer", "iter", "iter", "int", "int", "len", "contflame.data.utils.Buffer", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "len", "len"], "function", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.distill", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.print_images", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.print_images", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.print_images", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.print_images", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.test"], ["log_config", "=", "config", "[", "'log_config'", "]", "\n", "\n", "if", "log_config", "[", "'wandb'", "]", ":", "\n", "        ", "wandb", ".", "init", "(", "project", "=", "\"pmnist\"", ",", "name", "=", "log_config", "[", "'wandb_name'", "]", ")", "\n", "wandb", ".", "config", ".", "update", "(", "config", ")", "\n", "\n", "# Reproducibility", "\n", "", "seed", "=", "run_config", "[", "'seed'", "]", "\n", "torch", ".", "manual_seed", "(", "seed", ")", "\n", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "random", ".", "seed", "(", "seed", ")", "\n", "\n", "# Loss", "\n", "criterion", "=", "nn", ".", "CrossEntropyLoss", "(", ")", "\n", "\n", "# Model", "\n", "net", "=", "getattr", "(", "model", ",", "model_config", "[", "'arch'", "]", ")", ".", "Model", "(", "model_config", ")", "\n", "net", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "net", ".", "apply", "(", "initialize_weights", ")", "\n", "\n", "# Data", "\n", "Dataset", "=", "getattr", "(", "datasets", ",", "data_config", "[", "'dataset'", "]", ")", "\n", "\n", "# Training", "\n", "memories", "=", "[", "]", "\n", "validloaders", "=", "[", "]", "\n", "s", "=", "0", "\n", "\n", "for", "task_id", ",", "task", "in", "enumerate", "(", "run_config", "[", "'tasks'", "]", ",", "0", ")", ":", "\n", "\n", "        ", "validset", "=", "Dataset", "(", "dset", "=", "'test'", ",", "valid", "=", "data_config", "[", "'valid'", "]", ",", "transform", "=", "data_config", "[", "'test_transform'", "]", ",", "task", "=", "task", ")", "\n", "validloaders", ".", "append", "(", "DataLoader", "(", "validset", ",", "batch_size", "=", "param_config", "[", "'batch_size'", "]", ",", "shuffle", "=", "False", ",", "pin_memory", "=", "True", ",", "num_workers", "=", "data_config", "[", "'num_workers'", "]", ")", ")", "\n", "trainset", "=", "Dataset", "(", "dset", "=", "'train'", ",", "valid", "=", "data_config", "[", "'valid'", "]", ",", "transform", "=", "data_config", "[", "'train_transform'", "]", ",", "task", "=", "task", ")", "\n", "\n", "\n", "bufferloader", "=", "MultiLoader", "(", "[", "trainset", "]", "+", "memories", ",", "batch_size", "=", "param_config", "[", "'batch_size'", "]", ")", "\n", "\n", "optimizer", "=", "torch", ".", "optim", ".", "SGD", "(", "net", ".", "parameters", "(", ")", ",", "lr", "=", "param_config", "[", "'model_lr'", "]", ",", ")", "\n", "train", "=", "Train", "(", "optimizer", ",", "criterion", ",", "bufferloader", ",", "config", ")", "\n", "\n", "\n", "d_net", "=", "copy", ".", "deepcopy", "(", "net", ")", "\n", "d_trainloader", "=", "DataLoader", "(", "trainset", ",", "batch_size", "=", "param_config", "[", "'distill_batch_size'", "]", ",", "shuffle", "=", "True", ",", "pin_memory", "=", "True", ",", "num_workers", "=", "data_config", "[", "'num_workers'", "]", ")", "\n", "d_validloader", "=", "DataLoader", "(", "validset", ",", "batch_size", "=", "param_config", "[", "'distill_batch_size'", "]", ",", "shuffle", "=", "False", ",", "pin_memory", "=", "True", ",", "num_workers", "=", "data_config", "[", "'num_workers'", "]", ")", "\n", "\n", "if", "param_config", "[", "'steps'", "]", "==", "'epoch'", ":", "\n", "            ", "steps", "=", "len", "(", "bufferloader", ")", "*", "param_config", "[", "'no_steps'", "]", "\n", "", "elif", "param_config", "[", "'steps'", "]", "==", "'minibatch'", ":", "\n", "            ", "steps", "=", "param_config", "[", "'no_steps'", "]", "\n", "", "else", ":", "raise", "ValueError", "\n", "\n", "for", "step", "in", "range", "(", "steps", ")", ":", "\n", "\n", "            ", "buffer_loss", ",", "buffer_accuracy", "=", "train", "(", "net", ")", "\n", "\n", "if", "int", "(", "steps", "*", "0.05", ")", "<=", "0", "or", "step", "%", "int", "(", "steps", "*", "0.05", ")", "==", "int", "(", "steps", "*", "0.05", ")", "-", "1", "or", "step", "==", "0", ":", "\n", "\n", "                ", "valid_m", "=", "{", "'Test accuracy avg'", ":", "0", "}", "\n", "for", "i", ",", "vl", "in", "enumerate", "(", "validloaders", ")", ":", "\n", "                    ", "test_loss", ",", "test_accuracy", "=", "test", "(", "net", ",", "criterion", ",", "vl", ",", "run_config", ")", "\n", "valid_m", "=", "{", "**", "valid_m", ",", "**", "{", "f'Test loss {i}'", ":", "test_loss", ",", "\n", "f'Test accuracy {i}'", ":", "test_accuracy", ",", "}", "}", "\n", "valid_m", "[", "'Test accuracy avg'", "]", "+=", "(", "test_accuracy", "/", "len", "(", "validloaders", ")", ")", "\n", "\n", "", "train_m", "=", "{", "f'Buffer loss'", ":", "buffer_loss", ",", "\n", "f'Buffer accuracy'", ":", "buffer_accuracy", ",", "\n", "f'Step'", ":", "s", "}", "\n", "s", "+=", "1", "\n", "if", "log_config", "[", "'print'", "]", ":", "\n", "                    ", "print", "(", "{", "**", "valid_m", ",", "**", "train_m", "}", ")", "\n", "", "if", "log_config", "[", "'wandb'", "]", ":", "\n", "                    ", "wandb", ".", "log", "(", "{", "**", "valid_m", ",", "**", "train_m", "}", ")", "\n", "\n", "\n", "", "", "", "if", "task_id", "==", "len", "(", "run_config", "[", "'tasks'", "]", ")", "-", "1", ":", "\n", "            ", "break", "\n", "\n", "", "if", "param_config", "[", "'buffer_size'", "]", "!=", "0", ":", "\n", "            ", "buffer", "=", "None", "\n", "for", "b", "in", "range", "(", "param_config", "[", "'buffer_size'", "]", ")", ":", "\n", "                ", "buff", "=", "None", "\n", "\n", "for", "c", "in", "range", "(", "model_config", "[", "'n_classes'", "]", ")", ":", "\n", "                    ", "ds", "=", "list", "(", "filter", "(", "lambda", "x", ":", "x", "[", "1", "]", "==", "c", ",", "Dataset", "(", "dset", "=", "'train'", ",", "valid", "=", "data_config", "[", "'valid'", "]", ",", "\n", "transform", "=", "data_config", "[", "'train_transform'", "]", ",", "task", "=", "task", ")", ")", ")", "\n", "buff", "=", "Buffer", "(", "ds", ",", "1", ")", "if", "buff", "is", "None", "else", "buff", "+", "Buffer", "(", "ds", ",", "1", ")", "\n", "\n", "\n", "", "net", ".", "drop", "=", "nn", ".", "Dropout", "(", "0.0", ")", "\n", "buff", ",", "_", "=", "distill", "(", "d_net", ",", "buff", ",", "config", ",", "criterion", ",", "d_trainloader", ",", "d_validloader", ",", "task_id", ")", "\n", "net", ".", "drop", "=", "nn", ".", "Dropout", "(", "model_config", "[", "'dropout'", "]", ")", "\n", "\n", "buffer", "=", "buff", "if", "buffer", "is", "None", "else", "buffer", "+", "buff", "\n", "\n", "", "if", "param_config", "[", "'buffer_size'", "]", "==", "-", "1", ":", "\n", "                ", "memories", ".", "append", "(", "Dataset", "(", "dset", "=", "'train'", ",", "valid", "=", "data_config", "[", "'valid'", "]", ",", "transform", "=", "data_config", "[", "'train_transform'", "]", ",", "task", "=", "task", ")", ")", "\n", "", "else", ":", "\n", "                ", "memories", ".", "append", "(", "buffer", ")", "\n", "\n", "", "", "", "", "def", "distill", "(", "model", ",", "buffer", ",", "config", ",", "criterion", ",", "train_loader", ",", "valid_loader", ",", "id", ")", ":", "\n", "    ", "model", "=", "copy", ".", "deepcopy", "(", "model", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.scifar10_exp.run.distill": [[226, 320], ["copy.deepcopy", "copy.deepcopy.train", "copy.deepcopy", "next", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "iter", "torch.optim.SGD", "range", "range", "range", "iter", "buff_imgs.to", "buff_trgs.to", "run.ModelInitDataset", "run.ModelInitDataset", "numpy.log", "torch.tensor", "lr_list.append", "lr_opts.append", "enumerate", "buff_imgs.detach().cpu", "buff_trgs.detach().cpu", "buff_imgs.size", "aux.append", "numpy.log", "contflame.data.utils.Buffer", "torch.utils.data.DataLoader", "torch.optim.SGD", "ds_imgs.to.to", "ds_trgs.to.to", "enumerate", "range", "torch.optim.SGD.zero_grad", "acc_loss.backward", "torch.optim.SGD.step", "len", "numpy.exp", "next", "copy.deepcopy.load_state_dict", "torch.optim.SGD", "lr_opts[].zero_grad", "torch.autograd.grad", "lr_opts[].step", "buff_imgs.detach", "buff_trgs.detach", "numpy.exp", "len", "iter", "next", "range", "copy.deepcopy.parameters", "higher.innerloop_ctx", "range", "torch.tensor.item", "fmodel", "criterion", "diffopt.step", "fmodel", "criterion", "torch.log", "run.test_distill", "run.test_distill", "numpy.log", "wandb.log", "print", "torch.exp", "enumerate", "int", "int", "numpy.exp", "len", "round", "round", "len", "torch.tensor.item", "len", "len", "len"], "function", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.test_distill", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.test_distill"], ["param_config", "=", "config", "[", "'param_config'", "]", "\n", "log_config", "=", "config", "[", "'log_config'", "]", "\n", "\n", "model", ".", "train", "(", ")", "\n", "eval_trainloader", "=", "copy", ".", "deepcopy", "(", "train_loader", ")", "\n", "\n", "buff_imgs", ",", "buff_trgs", "=", "next", "(", "iter", "(", "DataLoader", "(", "buffer", ",", "batch_size", "=", "len", "(", "buffer", ")", ")", ")", ")", "\n", "buff_imgs", ",", "buff_trgs", "=", "buff_imgs", ".", "to", "(", "run_config", "[", "'device'", "]", ")", ",", "buff_trgs", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "\n", "buff_imgs", ".", "requires_grad", "=", "True", "\n", "\n", "init_valid", "=", "DataLoader", "(", "ModelInitDataset", "(", "model", ",", "10", ")", ",", "batch_size", "=", "1", ",", "collate_fn", "=", "lambda", "x", ":", "x", ")", "\n", "init_loader", "=", "DataLoader", "(", "ModelInitDataset", "(", "model", ",", "-", "1", ")", ",", "batch_size", "=", "1", ",", "collate_fn", "=", "lambda", "x", ":", "x", ")", "\n", "init_iter", "=", "iter", "(", "init_loader", ")", "\n", "\n", "buff_opt", "=", "torch", ".", "optim", ".", "SGD", "(", "[", "buff_imgs", "]", ",", "lr", "=", "param_config", "[", "'meta_lr'", "]", ",", ")", "\n", "\n", "lr_list", "=", "[", "]", "\n", "lr_opts", "=", "[", "]", "\n", "for", "_", "in", "range", "(", "param_config", "[", "'inner_steps'", "]", ")", ":", "\n", "        ", "lr", "=", "np", ".", "log", "(", "np", ".", "exp", "(", "[", "param_config", "[", "'model_lr'", "]", "]", ")", "-", "1", ")", "\n", "lr", "=", "torch", ".", "tensor", "(", "lr", ",", "requires_grad", "=", "True", ",", "device", "=", "run_config", "[", "'device'", "]", ")", "\n", "lr_list", ".", "append", "(", "lr", ")", "\n", "lr_opts", ".", "append", "(", "torch", ".", "optim", ".", "SGD", "(", "[", "lr", "]", ",", "param_config", "[", "'lr_lr'", "]", ",", ")", ")", "\n", "\n", "", "for", "i", "in", "range", "(", "param_config", "[", "'outer_steps'", "]", ")", ":", "\n", "        ", "for", "step", ",", "(", "ds_imgs", ",", "ds_trgs", ")", "in", "enumerate", "(", "train_loader", ")", ":", "\n", "            ", "try", ":", "init_batch", "=", "next", "(", "init_iter", ")", "\n", "except", "StopIteration", ":", "init_iter", "=", "iter", "(", "init_loader", ")", ";", "init_batch", "=", "next", "(", "init_iter", ")", "\n", "\n", "ds_imgs", "=", "ds_imgs", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "ds_trgs", "=", "ds_trgs", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "\n", "acc_loss", "=", "None", "\n", "epoch_loss", "=", "[", "None", "for", "_", "in", "range", "(", "param_config", "[", "'inner_steps'", "]", ")", "]", "\n", "\n", "for", "r", ",", "sigma", "in", "enumerate", "(", "init_batch", ")", ":", "\n", "                ", "model", ".", "load_state_dict", "(", "sigma", ")", "\n", "model_opt", "=", "torch", ".", "optim", ".", "SGD", "(", "model", ".", "parameters", "(", ")", ",", "lr", "=", "1", ",", ")", "\n", "with", "higher", ".", "innerloop_ctx", "(", "model", ",", "model_opt", ")", "as", "(", "fmodel", ",", "diffopt", ")", ":", "\n", "                    ", "for", "j", "in", "range", "(", "param_config", "[", "'inner_steps'", "]", ")", ":", "\n", "\n", "                        ", "buff_out", "=", "fmodel", "(", "buff_imgs", ")", "\n", "buff_loss", "=", "criterion", "(", "buff_out", ",", "buff_trgs", ")", "\n", "buff_loss", "=", "buff_loss", "*", "torch", ".", "log", "(", "1", "+", "torch", ".", "exp", "(", "lr_list", "[", "j", "]", ")", ")", "\n", "diffopt", ".", "step", "(", "buff_loss", ")", "\n", "\n", "ds_out", "=", "fmodel", "(", "ds_imgs", ")", "\n", "ds_loss", "=", "criterion", "(", "ds_out", ",", "ds_trgs", ")", "\n", "\n", "epoch_loss", "[", "j", "]", "=", "epoch_loss", "[", "j", "]", "+", "ds_loss", "if", "epoch_loss", "[", "j", "]", "is", "not", "None", "else", "ds_loss", "\n", "acc_loss", "=", "acc_loss", "+", "ds_loss", "if", "acc_loss", "is", "not", "None", "else", "ds_loss", "\n", "\n", "\n", "if", "(", "(", "(", "step", "+", "i", "*", "len", "(", "train_loader", ")", ")", "%", "int", "(", "round", "(", "len", "(", "train_loader", ")", "*", "param_config", "[", "'outer_steps'", "]", "*", "0.05", ")", ")", "==", "int", "(", "round", "(", "len", "(", "train_loader", ")", "*", "param_config", "[", "'outer_steps'", "]", "*", "0.05", ")", ")", "-", "1", ")", "or", "(", "step", "+", "i", "*", "len", "(", "train_loader", ")", ")", "==", "0", ")", "and", "j", "==", "param_config", "[", "'inner_steps'", "]", "-", "1", "and", "r", "==", "0", ":", "\n", "\n", "                            ", "lrs", "=", "[", "np", ".", "log", "(", "np", ".", "exp", "(", "lr", ".", "item", "(", ")", ")", "+", "1", ")", "for", "lr", "in", "lr_list", "]", "\n", "lrs_log", "=", "{", "f'Learning rate {i} - {id}'", ":", "lr", "for", "(", "i", ",", "lr", ")", "in", "enumerate", "(", "lrs", ")", "}", "\n", "train_loss", ",", "train_accuracy", "=", "test_distill", "(", "init_valid", ",", "lrs", ",", "[", "buff_imgs", ",", "buff_trgs", "]", ",", "model", ",", "criterion", ",", "eval_trainloader", ",", "run_config", ")", "\n", "test_loss", ",", "test_accuracy", "=", "test_distill", "(", "init_valid", ",", "lrs", ",", "[", "buff_imgs", ",", "buff_trgs", "]", ",", "model", ",", "criterion", ",", "valid_loader", ",", "run_config", ")", "\n", "metrics", "=", "{", "f'Distill train loss {id}'", ":", "train_loss", ",", "f'Distill train accuracy {id}'", ":", "train_accuracy", ",", "\n", "f'Distill test loss {id}'", ":", "test_loss", ",", "f'Distill test accuracy {id}'", ":", "test_accuracy", ",", "\n", "f'Distill step {id}'", ":", "step", "+", "i", "*", "len", "(", "train_loader", ")", "}", "\n", "\n", "if", "log_config", "[", "'wandb'", "]", ":", "\n", "                                ", "wandb", ".", "log", "(", "{", "**", "metrics", ",", "**", "lrs_log", "}", ")", "\n", "\n", "", "if", "log_config", "[", "'print'", "]", ":", "\n", "                                ", "print", "(", "metrics", ")", "\n", "\n", "# Update the lrs", "\n", "", "", "", "", "", "for", "j", "in", "range", "(", "param_config", "[", "'inner_steps'", "]", ")", ":", "\n", "                ", "lr_opts", "[", "j", "]", ".", "zero_grad", "(", ")", "\n", "grad", ",", "=", "autograd", ".", "grad", "(", "epoch_loss", "[", "j", "]", ",", "lr_list", "[", "j", "]", ",", "retain_graph", "=", "True", ")", "\n", "lr_list", "[", "j", "]", ".", "grad", "=", "grad", "\n", "lr_opts", "[", "j", "]", ".", "step", "(", ")", "\n", "\n", "", "buff_opt", ".", "zero_grad", "(", ")", "\n", "acc_loss", ".", "backward", "(", ")", "\n", "buff_opt", ".", "step", "(", ")", "\n", "\n", "", "", "aux", "=", "[", "]", "\n", "buff_imgs", ",", "buff_trgs", "=", "buff_imgs", ".", "detach", "(", ")", ".", "cpu", "(", ")", ",", "buff_trgs", ".", "detach", "(", ")", ".", "cpu", "(", ")", "\n", "for", "i", "in", "range", "(", "buff_imgs", ".", "size", "(", "0", ")", ")", ":", "\n", "        ", "aux", ".", "append", "(", "[", "buff_imgs", "[", "i", "]", ",", "buff_trgs", "[", "i", "]", "]", ")", "\n", "", "lr_list", "=", "[", "np", ".", "log", "(", "1", "+", "np", ".", "exp", "(", "lr", ".", "item", "(", ")", ")", ")", "for", "lr", "in", "lr_list", "]", "\n", "\n", "return", "Buffer", "(", "aux", ",", "len", "(", "aux", ")", ",", ")", ",", "lr_list", "\n", "\n", "\n", "", "def", "test_distill", "(", "init_valid", ",", "lrs", ",", "buffer", ",", "model", ",", "criterion", ",", "eval_trainloader", ",", "run_config", ")", ":", "\n", "    ", "buff_imgs", ",", "buff_trgs", "=", "buffer", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.scifar10_exp.run.test_distill": [[322, 345], ["model.load_state_dict", "run.test", "torch.optim.SGD", "criterion", "torch.optim.SGD.zero_grad", "criterion.backward", "torch.optim.SGD.step", "len", "len", "model.parameters"], "function", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.test"], ["\n", "for", "init_batch", "in", "init_valid", ":", "\n", "        ", "for", "init", "in", "init_batch", ":", "\n", "            ", "model", ".", "load_state_dict", "(", "init", ")", "\n", "\n", "for", "lr", "in", "lrs", ":", "\n", "                ", "opt", "=", "torch", ".", "optim", ".", "SGD", "(", "model", ".", "parameters", "(", ")", ",", "lr", "=", "lr", ",", ")", "\n", "pred", "=", "model", "(", "buff_imgs", ")", "\n", "loss", "=", "criterion", "(", "pred", ",", "buff_trgs", ")", "\n", "\n", "opt", ".", "zero_grad", "(", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "opt", ".", "step", "(", ")", "\n", "\n", "", "test_loss", ",", "test_accuracy", "=", "test", "(", "model", ",", "criterion", ",", "eval_trainloader", ",", "run_config", ")", "\n", "avg_loss", "+=", "(", "test_loss", "/", "len", "(", "init_valid", ")", ")", "\n", "avg_accuracy", "+=", "(", "test_accuracy", "/", "len", "(", "init_valid", ")", ")", "\n", "\n", "", "", "return", "avg_loss", ",", "avg_accuracy", "\n", "\n", "\n", "", "class", "ModelInitDataset", "(", "IterableDataset", ")", ":", "\n", "\n", "    ", "def", "__init__", "(", "self", ",", "target", ",", "len", ")", ":", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.Train.__init__": [[56, 62], ["enumerate"], "methods", ["None"], ["\n", "run_config", "=", "self", ".", "config", "[", "'run_config'", "]", "\n", "\n", "correct", "=", "0", "\n", "loss_sum", "=", "0", "\n", "tot", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.Train.__call__": [[63, 98], ["model.train", "data.to.to.to", "targets.to.to.to", "run.Train.optimizer.zero_grad", "model", "run.Train.criterion", "run.Train.backward", "run.Train.optimizer.step", "torch.max", "preds.eq().sum().item", "data.to.to.size", "next", "run.Train.item", "data.to.to.size", "enumerate", "next", "preds.eq().sum", "preds.eq"], "methods", ["None"], ["try", ":", "\n", "            ", "step", ",", "(", "data", ",", "targets", ")", "=", "next", "(", "self", ".", "iter", ")", "\n", "", "except", "StopIteration", ":", "\n", "            ", "self", ".", "iter", "=", "enumerate", "(", "self", ".", "train_loader", ")", "\n", "step", ",", "(", "data", ",", "targets", ")", "=", "next", "(", "self", ".", "iter", ")", "\n", "\n", "", "data", "=", "data", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "targets", "=", "targets", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "\n", "outputs", "=", "model", "(", "data", ")", "\n", "loss", "=", "self", ".", "criterion", "(", "outputs", ",", "targets", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "_", ",", "preds", "=", "torch", ".", "max", "(", "outputs", ",", "dim", "=", "1", ")", "\n", "\n", "loss_sum", "+=", "loss", ".", "item", "(", ")", "*", "data", ".", "size", "(", "0", ")", "\n", "correct", "+=", "preds", ".", "eq", "(", "targets", ")", ".", "sum", "(", ")", ".", "item", "(", ")", "\n", "tot", "+=", "data", ".", "size", "(", "0", ")", "\n", "\n", "accuracy", "=", "correct", "/", "tot", "\n", "loss", "=", "loss_sum", "/", "tot", "\n", "\n", "return", "loss", ",", "accuracy", "\n", "\n", "", "", "def", "test", "(", "model", ",", "criterion", ",", "test_loader", ",", "config", ")", ":", "\n", "    ", "model", ".", "eval", "(", ")", "\n", "\n", "correct", "=", "0", "\n", "loss_sum", "=", "0", "\n", "tot", "=", "0", "\n", "\n", "for", "step", ",", "(", "data", ",", "targets", ")", "in", "enumerate", "(", "test_loader", ")", ":", "\n", "        ", "data", "=", "data", ".", "to", "(", "config", "[", "'device'", "]", ")", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.ModelInitDataset.__init__": [[370, 375], ["copy.deepcopy"], "methods", ["None"], ["        ", "return", "self", ".", "len", "\n", "", "", ""]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.ModelInitDataset.__iter__": [[376, 379], ["None"], "methods", ["None"], []], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.ModelInitDataset.__next__": [[380, 393], ["copy.deepcopy", "len", "run.ModelInitDataset.target.apply().state_dict", "run.ModelInitDataset.inits.append", "run.ModelInitDataset.target.apply"], "methods", ["None"], []], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.ModelInitDataset.__len__": [[394, 396], ["None"], "methods", ["None"], []], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.print_images": [[20, 42], ["zip", "trg.item", "img.astype.detach().clone().cpu().numpy", "range", "numpy.transpose", "numpy.squeeze", "img.astype.astype", "wandb.log", "len", "len", "img.astype.detach().clone().cpu", "range", "range", "wandb.Image", "img.astype.size", "img.astype.size", "img.astype.detach().clone", "img.astype.detach"], "function", ["None"], ["\n", "for", "img", ",", "trg", "in", "zip", "(", "data", ",", "trgs", ")", ":", "\n", "        ", "label", "=", "trg", ".", "item", "(", ")", "\n", "\n", "std", "=", "[", "std", "[", "0", "]", "for", "_", "in", "range", "(", "img", ".", "size", "(", "0", ")", ")", "]", "if", "len", "(", "std", ")", "==", "1", "else", "std", "\n", "mean", "=", "[", "mean", "[", "0", "]", "for", "_", "in", "range", "(", "img", ".", "size", "(", "0", ")", ")", "]", "if", "len", "(", "mean", ")", "==", "1", "else", "mean", "\n", "\n", "img", "=", "img", ".", "detach", "(", ")", ".", "clone", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "for", "i", "in", "range", "(", "img", ".", "shape", "[", "0", "]", ")", ":", "\n", "            ", "img", "[", "i", "]", "=", "img", "[", "i", "]", "*", "std", "[", "i", "]", "+", "mean", "[", "i", "]", "\n", "\n", "", "img", "=", "img", "*", "255", "\n", "img", "=", "np", ".", "transpose", "(", "img", ",", "(", "1", ",", "2", ",", "0", ")", ")", "\n", "img", "=", "np", ".", "squeeze", "(", "img", ")", "\n", "img", "=", "img", ".", "astype", "(", "np", ".", "uint8", ")", "\n", "\n", "wandb", ".", "log", "(", "{", "f'img{w}_{label}'", ":", "[", "wandb", ".", "Image", "(", "img", ",", "caption", "=", "f\"{label}\"", ")", "]", "}", ")", "\n", "\n", "w", "+=", "1", "\n", "\n", "", "", "def", "initialize_weights", "(", "module", ")", ":", "\n", "    ", "if", "isinstance", "(", "module", ",", "nn", ".", "Conv2d", ")", "or", "isinstance", "(", "module", ",", "nn", ".", "Linear", ")", ":", "\n", "        ", "nn", ".", "init", ".", "xavier_uniform_", "(", "module", ".", "weight", ")", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.initialize_weights": [[44, 52], ["isinstance", "isinstance", "torch.nn.init.xavier_uniform_", "isinstance", "module.bias.data.fill_", "module.weight.data.uniform_", "module.bias.data.zero_"], "function", ["None"], ["\n", "", "", "class", "Train", ":", "\n", "\n", "    ", "def", "__init__", "(", "self", ",", "optimizer", ",", "criterion", ",", "train_loader", ",", "config", ")", ":", "\n", "        ", "self", ".", "optimizer", "=", "optimizer", "\n", "self", ".", "criterion", "=", "criterion", "\n", "self", ".", "config", "=", "config", "\n", "self", ".", "train_loader", "=", "train_loader", "\n", "self", ".", "iter", "=", "enumerate", "(", "train_loader", ")", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.test": [[100, 125], ["model.eval", "enumerate", "data.to.to", "targets.to.to", "torch.max", "preds.eq().sum().item", "data.to.size", "torch.no_grad", "criterion", "criterion.item", "data.to.size", "preds.eq().sum", "preds.eq"], "function", ["None"], ["\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "outputs", "=", "model", "(", "data", ")", "\n", "loss", "=", "criterion", "(", "outputs", ",", "targets", ")", "\n", "\n", "", "_", ",", "preds", "=", "torch", ".", "max", "(", "outputs", ",", "dim", "=", "1", ")", "\n", "\n", "loss_sum", "+=", "loss", ".", "item", "(", ")", "*", "data", ".", "size", "(", "0", ")", "\n", "correct", "+=", "preds", ".", "eq", "(", "targets", ")", ".", "sum", "(", ")", ".", "item", "(", ")", "\n", "tot", "+=", "data", ".", "size", "(", "0", ")", "\n", "\n", "", "accuracy", "=", "correct", "/", "tot", "\n", "loss", "=", "loss_sum", "/", "tot", "\n", "\n", "return", "loss", ",", "accuracy", "\n", "\n", "\n", "", "def", "run", "(", "config", ")", ":", "\n", "\n", "    ", "run_config", "=", "config", "[", "'run_config'", "]", "\n", "model_config", "=", "config", "[", "'model_config'", "]", "\n", "param_config", "=", "config", "[", "'param_config'", "]", "\n", "data_config", "=", "config", "[", "'data_config'", "]", "\n", "log_config", "=", "config", "[", "'log_config'", "]", "\n", "\n", "if", "log_config", "[", "'wandb'", "]", ":", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.run": [[127, 236], ["torch.manual_seed", "numpy.random.seed", "random.seed", "torch.nn.CrossEntropyLoss", "getattr().Model", "getattr().Model.to", "getattr().Model.apply", "getattr", "enumerate", "wandb.init", "wandb.config.update", "getattr.", "validloaders.append", "getattr.", "contflame.data.utils.MultiLoader", "torch.optim.SGD", "run.Train", "copy.deepcopy", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "range", "getattr", "torch.utils.data.DataLoader", "getattr().Model.parameters", "Train.", "run.distill", "memories.append", "len", "enumerate", "len", "getattr.", "next", "run.print_images", "run.print_images", "next", "run.print_images", "run.print_images", "int", "run.test", "print", "wandb.log", "contflame.data.utils.Buffer", "iter", "iter", "int", "int", "len", "contflame.data.utils.Buffer", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "len", "len"], "function", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.distill", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.print_images", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.print_images", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.print_images", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.print_images", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.test"], ["wandb", ".", "config", ".", "update", "(", "config", ")", "\n", "\n", "# Reproducibility", "\n", "", "seed", "=", "run_config", "[", "'seed'", "]", "\n", "torch", ".", "manual_seed", "(", "seed", ")", "\n", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "random", ".", "seed", "(", "seed", ")", "\n", "\n", "# Loss", "\n", "criterion", "=", "nn", ".", "CrossEntropyLoss", "(", ")", "\n", "\n", "# Model", "\n", "net", "=", "getattr", "(", "model", ",", "model_config", "[", "'arch'", "]", ")", ".", "Model", "(", "model_config", ")", "\n", "net", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "net", ".", "apply", "(", "initialize_weights", ")", "\n", "\n", "# Data", "\n", "Dataset", "=", "getattr", "(", "datasets", ",", "data_config", "[", "'dataset'", "]", ")", "\n", "\n", "# Training", "\n", "memories", "=", "[", "]", "\n", "validloaders", "=", "[", "]", "\n", "s", "=", "0", "\n", "\n", "for", "task_id", ",", "task", "in", "enumerate", "(", "run_config", "[", "'tasks'", "]", ",", "0", ")", ":", "\n", "\n", "        ", "validset", "=", "Dataset", "(", "dset", "=", "'test'", ",", "valid", "=", "data_config", "[", "'valid'", "]", ",", "transform", "=", "data_config", "[", "'test_transform'", "]", ",", "task", "=", "task", ")", "\n", "validloaders", ".", "append", "(", "DataLoader", "(", "validset", ",", "batch_size", "=", "param_config", "[", "'batch_size'", "]", ",", "shuffle", "=", "False", ",", "pin_memory", "=", "True", ",", "num_workers", "=", "data_config", "[", "'num_workers'", "]", ")", ")", "\n", "trainset", "=", "Dataset", "(", "dset", "=", "'train'", ",", "valid", "=", "data_config", "[", "'valid'", "]", ",", "transform", "=", "data_config", "[", "'train_transform'", "]", ",", "task", "=", "task", ")", "\n", "\n", "\n", "bufferloader", "=", "MultiLoader", "(", "[", "trainset", "]", "+", "memories", ",", "batch_size", "=", "param_config", "[", "'batch_size'", "]", ")", "\n", "\n", "optimizer", "=", "torch", ".", "optim", ".", "SGD", "(", "net", ".", "parameters", "(", ")", ",", "lr", "=", "param_config", "[", "'model_lr'", "]", ",", ")", "\n", "train", "=", "Train", "(", "optimizer", ",", "criterion", ",", "bufferloader", ",", "config", ")", "\n", "\n", "\n", "d_net", "=", "copy", ".", "deepcopy", "(", "net", ")", "\n", "d_trainloader", "=", "DataLoader", "(", "trainset", ",", "batch_size", "=", "param_config", "[", "'distill_batch_size'", "]", ",", "shuffle", "=", "True", ",", "pin_memory", "=", "True", ",", "num_workers", "=", "data_config", "[", "'num_workers'", "]", ")", "\n", "d_validloader", "=", "DataLoader", "(", "validset", ",", "batch_size", "=", "param_config", "[", "'distill_batch_size'", "]", ",", "shuffle", "=", "False", ",", "pin_memory", "=", "True", ",", "num_workers", "=", "data_config", "[", "'num_workers'", "]", ")", "\n", "\n", "if", "param_config", "[", "'steps'", "]", "==", "'epoch'", ":", "\n", "            ", "steps", "=", "len", "(", "bufferloader", ")", "*", "param_config", "[", "'no_steps'", "]", "\n", "", "elif", "param_config", "[", "'steps'", "]", "==", "'minibatch'", ":", "\n", "            ", "steps", "=", "param_config", "[", "'no_steps'", "]", "\n", "", "else", ":", "raise", "ValueError", "\n", "\n", "for", "step", "in", "range", "(", "steps", ")", ":", "\n", "\n", "            ", "buffer_loss", ",", "buffer_accuracy", "=", "train", "(", "net", ")", "\n", "\n", "if", "int", "(", "steps", "*", "0.05", ")", "<=", "0", "or", "step", "%", "int", "(", "steps", "*", "0.05", ")", "==", "int", "(", "steps", "*", "0.05", ")", "-", "1", "or", "step", "==", "0", ":", "\n", "\n", "                ", "valid_m", "=", "{", "'Test accuracy avg'", ":", "0", "}", "\n", "for", "i", ",", "vl", "in", "enumerate", "(", "validloaders", ")", ":", "\n", "                    ", "test_loss", ",", "test_accuracy", "=", "test", "(", "net", ",", "criterion", ",", "vl", ",", "run_config", ")", "\n", "valid_m", "=", "{", "**", "valid_m", ",", "**", "{", "f'Test loss {i}'", ":", "test_loss", ",", "\n", "f'Test accuracy {i}'", ":", "test_accuracy", ",", "}", "}", "\n", "valid_m", "[", "'Test accuracy avg'", "]", "+=", "(", "test_accuracy", "/", "len", "(", "validloaders", ")", ")", "\n", "\n", "", "train_m", "=", "{", "f'Buffer loss'", ":", "buffer_loss", ",", "\n", "f'Buffer accuracy'", ":", "buffer_accuracy", ",", "\n", "f'Step'", ":", "s", "}", "\n", "s", "+=", "1", "\n", "if", "log_config", "[", "'print'", "]", ":", "\n", "                    ", "print", "(", "{", "**", "valid_m", ",", "**", "train_m", "}", ")", "\n", "", "if", "log_config", "[", "'wandb'", "]", ":", "\n", "                    ", "wandb", ".", "log", "(", "{", "**", "valid_m", ",", "**", "train_m", "}", ")", "\n", "\n", "\n", "", "", "", "if", "task_id", "==", "len", "(", "run_config", "[", "'tasks'", "]", ")", "-", "1", ":", "\n", "            ", "break", "\n", "\n", "", "if", "param_config", "[", "'buffer_size'", "]", "!=", "0", ":", "\n", "            ", "buffer", "=", "None", "\n", "for", "b", "in", "range", "(", "param_config", "[", "'buffer_size'", "]", ")", ":", "\n", "                ", "buff", "=", "None", "\n", "\n", "for", "c", "in", "range", "(", "model_config", "[", "'n_classes'", "]", ")", ":", "\n", "                    ", "ds", "=", "list", "(", "filter", "(", "lambda", "x", ":", "x", "[", "1", "]", "==", "c", ",", "Dataset", "(", "dset", "=", "'train'", ",", "valid", "=", "data_config", "[", "'valid'", "]", ",", "\n", "transform", "=", "data_config", "[", "'train_transform'", "]", ",", "task", "=", "task", ")", ")", ")", "\n", "buff", "=", "Buffer", "(", "ds", ",", "1", ")", "if", "buff", "is", "None", "else", "buff", "+", "Buffer", "(", "ds", ",", "1", ")", "\n", "\n", "\n", "", "net", ".", "drop", "=", "nn", ".", "Dropout", "(", "0.0", ")", "\n", "buff", ",", "_", "=", "distill", "(", "d_net", ",", "buff", ",", "config", ",", "criterion", ",", "d_trainloader", ",", "d_validloader", ",", "task_id", ")", "\n", "net", ".", "drop", "=", "nn", ".", "Dropout", "(", "model_config", "[", "'dropout'", "]", ")", "\n", "\n", "buffer", "=", "buff", "if", "buffer", "is", "None", "else", "buffer", "+", "buff", "\n", "\n", "", "if", "param_config", "[", "'buffer_size'", "]", "==", "-", "1", ":", "\n", "                ", "memories", ".", "append", "(", "Dataset", "(", "dset", "=", "'train'", ",", "valid", "=", "data_config", "[", "'valid'", "]", ",", "transform", "=", "data_config", "[", "'train_transform'", "]", ",", "task", "=", "task", ")", ")", "\n", "", "else", ":", "\n", "                ", "memories", ".", "append", "(", "buffer", ")", "\n", "\n", "", "", "", "", "def", "distill", "(", "model", ",", "buffer", ",", "config", ",", "criterion", ",", "train_loader", ",", "valid_loader", ",", "id", ")", ":", "\n", "    ", "model", "=", "copy", ".", "deepcopy", "(", "model", ")", "\n", "\n", "run_config", "=", "config", "[", "'run_config'", "]", "\n", "param_config", "=", "config", "[", "'param_config'", "]", "\n", "log_config", "=", "config", "[", "'log_config'", "]", "\n", "\n", "model", ".", "train", "(", ")", "\n", "eval_trainloader", "=", "copy", ".", "deepcopy", "(", "train_loader", ")", "\n", "\n", "buff_imgs", ",", "buff_trgs", "=", "next", "(", "iter", "(", "DataLoader", "(", "buffer", ",", "batch_size", "=", "len", "(", "buffer", ")", ")", ")", ")", "\n", "buff_imgs", ",", "buff_trgs", "=", "buff_imgs", ".", "to", "(", "run_config", "[", "'device'", "]", ")", ",", "buff_trgs", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "\n", "buff_imgs", ".", "requires_grad", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.distill": [[238, 341], ["copy.deepcopy", "copy.deepcopy.train", "copy.deepcopy", "next", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "iter", "torch.optim.SGD", "range", "range", "range", "iter", "buff_imgs.to", "buff_trgs.to", "run.ModelInitDataset", "run.ModelInitDataset", "numpy.log", "torch.tensor", "lr_list.append", "lr_opts.append", "enumerate", "buff_imgs.detach().cpu", "buff_trgs.detach().cpu", "buff_imgs.size", "aux.append", "numpy.log", "contflame.data.utils.Buffer", "torch.utils.data.DataLoader", "torch.optim.SGD", "ds_imgs.to.to", "ds_trgs.to.to", "enumerate", "range", "torch.optim.SGD.zero_grad", "acc_loss.backward", "torch.optim.SGD.step", "len", "numpy.exp", "next", "copy.deepcopy.load_state_dict", "torch.optim.SGD", "lr_opts[].zero_grad", "torch.autograd.grad", "lr_opts[].step", "buff_imgs.detach", "buff_trgs.detach", "numpy.exp", "len", "iter", "next", "range", "copy.deepcopy.parameters", "higher.innerloop_ctx", "range", "torch.tensor.item", "fmodel", "criterion", "diffopt.step", "fmodel", "criterion", "torch.log", "run.test_distill", "run.test_distill", "numpy.log", "wandb.log", "print", "torch.exp", "enumerate", "int", "int", "numpy.exp", "len", "round", "round", "len", "torch.tensor.item", "len", "len", "len"], "function", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.test_distill", "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.test_distill"], ["init_loader", "=", "DataLoader", "(", "ModelInitDataset", "(", "model", ",", "-", "1", ")", ",", "batch_size", "=", "1", ",", "collate_fn", "=", "lambda", "x", ":", "x", ")", "\n", "init_iter", "=", "iter", "(", "init_loader", ")", "\n", "\n", "buff_opt", "=", "torch", ".", "optim", ".", "SGD", "(", "[", "buff_imgs", "]", ",", "lr", "=", "param_config", "[", "'meta_lr'", "]", ",", ")", "\n", "\n", "lr_list", "=", "[", "]", "\n", "lr_opts", "=", "[", "]", "\n", "for", "_", "in", "range", "(", "param_config", "[", "'inner_steps'", "]", ")", ":", "\n", "        ", "lr", "=", "np", ".", "log", "(", "np", ".", "exp", "(", "[", "param_config", "[", "'model_lr'", "]", "]", ")", "-", "1", ")", "\n", "lr", "=", "torch", ".", "tensor", "(", "lr", ",", "requires_grad", "=", "True", ",", "device", "=", "run_config", "[", "'device'", "]", ")", "\n", "lr_list", ".", "append", "(", "lr", ")", "\n", "lr_opts", ".", "append", "(", "torch", ".", "optim", ".", "SGD", "(", "[", "lr", "]", ",", "param_config", "[", "'lr_lr'", "]", ",", ")", ")", "\n", "\n", "", "for", "i", "in", "range", "(", "param_config", "[", "'outer_steps'", "]", ")", ":", "\n", "        ", "for", "step", ",", "(", "ds_imgs", ",", "ds_trgs", ")", "in", "enumerate", "(", "train_loader", ")", ":", "\n", "            ", "try", ":", "init_batch", "=", "next", "(", "init_iter", ")", "\n", "except", "StopIteration", ":", "init_iter", "=", "iter", "(", "init_loader", ")", ";", "init_batch", "=", "next", "(", "init_iter", ")", "\n", "\n", "ds_imgs", "=", "ds_imgs", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "ds_trgs", "=", "ds_trgs", ".", "to", "(", "run_config", "[", "'device'", "]", ")", "\n", "\n", "acc_loss", "=", "None", "\n", "epoch_loss", "=", "[", "None", "for", "_", "in", "range", "(", "param_config", "[", "'inner_steps'", "]", ")", "]", "\n", "\n", "for", "r", ",", "sigma", "in", "enumerate", "(", "init_batch", ")", ":", "\n", "                ", "model", ".", "load_state_dict", "(", "sigma", ")", "\n", "model_opt", "=", "torch", ".", "optim", ".", "SGD", "(", "model", ".", "parameters", "(", ")", ",", "lr", "=", "1", ",", ")", "\n", "with", "higher", ".", "innerloop_ctx", "(", "model", ",", "model_opt", ")", "as", "(", "fmodel", ",", "diffopt", ")", ":", "\n", "                    ", "for", "j", "in", "range", "(", "param_config", "[", "'inner_steps'", "]", ")", ":", "\n", "\n", "                        ", "buff_out", "=", "fmodel", "(", "buff_imgs", ")", "\n", "buff_loss", "=", "criterion", "(", "buff_out", ",", "buff_trgs", ")", "\n", "buff_loss", "=", "buff_loss", "*", "torch", ".", "log", "(", "1", "+", "torch", ".", "exp", "(", "lr_list", "[", "j", "]", ")", ")", "\n", "diffopt", ".", "step", "(", "buff_loss", ")", "\n", "\n", "ds_out", "=", "fmodel", "(", "ds_imgs", ")", "\n", "ds_loss", "=", "criterion", "(", "ds_out", ",", "ds_trgs", ")", "\n", "\n", "epoch_loss", "[", "j", "]", "=", "epoch_loss", "[", "j", "]", "+", "ds_loss", "if", "epoch_loss", "[", "j", "]", "is", "not", "None", "else", "ds_loss", "\n", "acc_loss", "=", "acc_loss", "+", "ds_loss", "if", "acc_loss", "is", "not", "None", "else", "ds_loss", "\n", "\n", "\n", "if", "(", "(", "(", "step", "+", "i", "*", "len", "(", "train_loader", ")", ")", "%", "int", "(", "round", "(", "len", "(", "train_loader", ")", "*", "param_config", "[", "'outer_steps'", "]", "*", "0.05", ")", ")", "==", "int", "(", "round", "(", "len", "(", "train_loader", ")", "*", "param_config", "[", "'outer_steps'", "]", "*", "0.05", ")", ")", "-", "1", ")", "or", "(", "step", "+", "i", "*", "len", "(", "train_loader", ")", ")", "==", "0", ")", "and", "j", "==", "param_config", "[", "'inner_steps'", "]", "-", "1", "and", "r", "==", "0", ":", "\n", "\n", "                            ", "lrs", "=", "[", "np", ".", "log", "(", "np", ".", "exp", "(", "lr", ".", "item", "(", ")", ")", "+", "1", ")", "for", "lr", "in", "lr_list", "]", "\n", "lrs_log", "=", "{", "f'Learning rate {i} - {id}'", ":", "lr", "for", "(", "i", ",", "lr", ")", "in", "enumerate", "(", "lrs", ")", "}", "\n", "train_loss", ",", "train_accuracy", "=", "test_distill", "(", "init_valid", ",", "lrs", ",", "[", "buff_imgs", ",", "buff_trgs", "]", ",", "model", ",", "criterion", ",", "eval_trainloader", ",", "run_config", ")", "\n", "test_loss", ",", "test_accuracy", "=", "test_distill", "(", "init_valid", ",", "lrs", ",", "[", "buff_imgs", ",", "buff_trgs", "]", ",", "model", ",", "criterion", ",", "valid_loader", ",", "run_config", ")", "\n", "metrics", "=", "{", "f'Distill train loss {id}'", ":", "train_loss", ",", "f'Distill train accuracy {id}'", ":", "train_accuracy", ",", "\n", "f'Distill test loss {id}'", ":", "test_loss", ",", "f'Distill test accuracy {id}'", ":", "test_accuracy", ",", "\n", "f'Distill step {id}'", ":", "step", "+", "i", "*", "len", "(", "train_loader", ")", "}", "\n", "\n", "if", "log_config", "[", "'wandb'", "]", ":", "\n", "                                ", "wandb", ".", "log", "(", "{", "**", "metrics", ",", "**", "lrs_log", "}", ")", "\n", "\n", "", "if", "log_config", "[", "'print'", "]", ":", "\n", "                                ", "print", "(", "metrics", ")", "\n", "\n", "# Update the lrs", "\n", "", "", "", "", "", "for", "j", "in", "range", "(", "param_config", "[", "'inner_steps'", "]", ")", ":", "\n", "                ", "lr_opts", "[", "j", "]", ".", "zero_grad", "(", ")", "\n", "grad", ",", "=", "autograd", ".", "grad", "(", "epoch_loss", "[", "j", "]", ",", "lr_list", "[", "j", "]", ",", "retain_graph", "=", "True", ")", "\n", "lr_list", "[", "j", "]", ".", "grad", "=", "grad", "\n", "lr_opts", "[", "j", "]", ".", "step", "(", ")", "\n", "\n", "", "buff_opt", ".", "zero_grad", "(", ")", "\n", "acc_loss", ".", "backward", "(", ")", "\n", "buff_opt", ".", "step", "(", ")", "\n", "\n", "", "", "aux", "=", "[", "]", "\n", "buff_imgs", ",", "buff_trgs", "=", "buff_imgs", ".", "detach", "(", ")", ".", "cpu", "(", ")", ",", "buff_trgs", ".", "detach", "(", ")", ".", "cpu", "(", ")", "\n", "for", "i", "in", "range", "(", "buff_imgs", ".", "size", "(", "0", ")", ")", ":", "\n", "        ", "aux", ".", "append", "(", "[", "buff_imgs", "[", "i", "]", ",", "buff_trgs", "[", "i", "]", "]", ")", "\n", "", "lr_list", "=", "[", "np", ".", "log", "(", "1", "+", "np", ".", "exp", "(", "lr", ".", "item", "(", ")", ")", ")", "for", "lr", "in", "lr_list", "]", "\n", "\n", "return", "Buffer", "(", "aux", ",", "len", "(", "aux", ")", ",", ")", ",", "lr_list", "\n", "\n", "\n", "", "def", "test_distill", "(", "init_valid", ",", "lrs", ",", "buffer", ",", "model", ",", "criterion", ",", "eval_trainloader", ",", "run_config", ")", ":", "\n", "    ", "buff_imgs", ",", "buff_trgs", "=", "buffer", "\n", "\n", "avg_loss", "=", "avg_accuracy", "=", "0", "\n", "\n", "for", "init_batch", "in", "init_valid", ":", "\n", "        ", "for", "init", "in", "init_batch", ":", "\n", "            ", "model", ".", "load_state_dict", "(", "init", ")", "\n", "\n", "for", "lr", "in", "lrs", ":", "\n", "                ", "opt", "=", "torch", ".", "optim", ".", "SGD", "(", "model", ".", "parameters", "(", ")", ",", "lr", "=", "lr", ",", ")", "\n", "pred", "=", "model", "(", "buff_imgs", ")", "\n", "loss", "=", "criterion", "(", "pred", ",", "buff_trgs", ")", "\n", "\n", "opt", ".", "zero_grad", "(", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "opt", ".", "step", "(", ")", "\n", "\n", "", "test_loss", ",", "test_accuracy", "=", "test", "(", "model", ",", "criterion", ",", "eval_trainloader", ",", "run_config", ")", "\n", "avg_loss", "+=", "(", "test_loss", "/", "len", "(", "init_valid", ")", ")", "\n", "avg_accuracy", "+=", "(", "test_accuracy", "/", "len", "(", "init_valid", ")", ")", "\n", "\n", "", "", "return", "avg_loss", ",", "avg_accuracy", "\n", "\n"]], "home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.test_distill": [[343, 366], ["model.load_state_dict", "run.test", "torch.optim.SGD", "criterion", "torch.optim.SGD.zero_grad", "criterion.backward", "torch.optim.SGD.step", "len", "len", "model.parameters"], "function", ["home.repos.pwc.inspect_result.andrew-r96_DistilledReplay.sfmnist_exp.run.test"], ["", "class", "ModelInitDataset", "(", "IterableDataset", ")", ":", "\n", "\n", "    ", "def", "__init__", "(", "self", ",", "target", ",", "len", ")", ":", "\n", "        ", "self", ".", "target", "=", "copy", ".", "deepcopy", "(", "target", ")", "\n", "self", ".", "len", "=", "len", "\n", "self", ".", "inits", "=", "[", "]", "\n", "self", ".", "i", "=", "0", "\n", "\n", "", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "self", ".", "i", "=", "0", "\n", "return", "self", "\n", "\n", "", "def", "__next__", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "i", ">=", "self", ".", "len", "and", "self", ".", "len", ">=", "0", ":", "\n", "            ", "raise", "StopIteration", "\n", "\n", "", "if", "len", "(", "self", ".", "inits", ")", "-", "1", ">=", "self", ".", "i", ":", "\n", "            ", "res", "=", "self", ".", "inits", "[", "self", ".", "i", "]", "\n", "", "else", ":", "\n", "            ", "res", "=", "copy", ".", "deepcopy", "(", "self", ".", "target", ".", "apply", "(", "initialize_weights", ")", ".", "state_dict", "(", ")", ")", "\n", "if", "self", ".", "len", ">=", "0", ":", "\n", "                ", "self", ".", "inits", ".", "append", "(", "res", ")", "\n", "\n", "", "", "self", ".", "i", "+=", "1", "\n"]]}