{"home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.bert_finetuning.get_parser": [[17, 27], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument"], "function", ["None"], ["def", "get_parser", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n", "parser", ".", "add_argument", "(", "\"--config-file\"", ",", "type", "=", "str", ",", "default", "=", "'config.yaml'", ",", "help", "=", "'Configuration file.'", ")", "\n", "parser", ".", "add_argument", "(", "\"--max-N-parts\"", ",", "type", "=", "int", ",", "default", "=", "1", ",", "\n", "help", "=", "'Maximum number of training parts that are taken to bert finetuning.'", ")", "\n", "parser", ".", "add_argument", "(", "\"--num-epochs\"", ",", "type", "=", "int", ",", "default", "=", "1", ",", "help", "=", "'Number of epochs.'", ")", "\n", "parser", ".", "add_argument", "(", "\"--max_num_tokens\"", ",", "type", "=", "int", ",", "default", "=", "100", ",", "help", "=", "'Maximum number of tokens from tweet.'", ")", "\n", "parser", ".", "add_argument", "(", "\"--batch-size\"", ",", "type", "=", "int", ",", "default", "=", "16", ",", "help", "=", "'Batch size.'", ")", "\n", "parser", ".", "add_argument", "(", "\"--save-steps\"", ",", "type", "=", "int", ",", "default", "=", "100_000", ",", "help", "=", "' Every N Steps model checkpoint is saved'", ")", "\n", "return", "parser", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.bert_finetuning.update_data": [[29, 33], ["data[].append", "data[].append", "data[].append", "numpy.array", "numpy.array", "numpy.zeros"], "function", ["None"], ["", "def", "update_data", "(", "data", ",", "tokens", ",", "max_num_tokens", ")", ":", "\n", "    ", "data", "[", "'text'", "]", ".", "append", "(", "''", ")", "\n", "data", "[", "'input_ids'", "]", ".", "append", "(", "tokens", ")", "\n", "data", "[", "'attention_mask'", "]", ".", "append", "(", "np", ".", "array", "(", "np", ".", "array", "(", "tokens", ")", "!=", "np", ".", "zeros", "(", "max_num_tokens", ")", ",", "dtype", "=", "'int'", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.bert_finetuning.finetune_bert": [[35, 99], ["transformers.DistilBertTokenizer.from_pretrained", "transformers.DistilBertForMaskedLM.from_pretrained().cuda", "log.info", "transformers.DataCollatorForLanguageModeling", "transformers.TrainingArguments", "open", "yaml.load", "log.info", "datasets.Dataset.from_dict", "datasets.Dataset.from_dict", "transformers.Trainer", "transformers.Trainer.train", "transformers.DistilBertForMaskedLM.from_pretrained", "os.path.join", "open", "os.listdir", "line.strip.strip", "line.strip.split", "features[].split", "list", "map", "random.uniform", "bert_finetuning.update_data", "bert_finetuning.update_data", "len"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.train.train", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.bert_finetuning.update_data", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.bert_finetuning.update_data"], ["", "def", "finetune_bert", "(", "params", ")", ":", "\n", "    ", "with", "open", "(", "params", ".", "config_file", ")", "as", "f", ":", "\n", "        ", "config", "=", "yaml", ".", "load", "(", "f", ")", "\n", "\n", "", "VALIDATION_PERCENTAGE", "=", "0.02", "\n", "BERT_CONFIG_NAME", "=", "'distilbert-base-multilingual-cased'", "\n", "tokenizer", "=", "DistilBertTokenizer", ".", "from_pretrained", "(", "BERT_CONFIG_NAME", ")", "\n", "model", "=", "DistilBertForMaskedLM", ".", "from_pretrained", "(", "BERT_CONFIG_NAME", ")", ".", "cuda", "(", ")", "\n", "\n", "\n", "filenames", "=", "[", "os", ".", "path", ".", "join", "(", "config", "[", "'recsys_data'", "]", ",", "f", ")", "for", "f", "in", "os", ".", "listdir", "(", "config", "[", "'recsys_data'", "]", ")", "if", "'part'", "in", "f", "]", "[", ":", "params", ".", "max_N_parts", "]", "\n", "log", ".", "info", "(", "f\"Used input filenames: {filenames}\"", ")", "\n", "\n", "data_collator", "=", "DataCollatorForLanguageModeling", "(", "\n", "tokenizer", "=", "tokenizer", ",", "\n", "mlm_probability", "=", "0.15", ",", "\n", "pad_to_multiple_of", "=", "8", "\n", ")", "\n", "\n", "\n", "training_args", "=", "TrainingArguments", "(", "output_dir", "=", "\"./distilbert_checkpoints\"", ",", "\n", "logging_dir", "=", "'./logs'", ",", "\n", "logging_steps", "=", "0", ",", "\n", "warmup_steps", "=", "1000", ",", "\n", "weight_decay", "=", "0.01", ",", "\n", "save_strategy", "=", "\"steps\"", ",", "\n", "evaluation_strategy", "=", "\"steps\"", ",", "\n", "eval_steps", "=", "params", ".", "save_steps", ",", "\n", "save_steps", "=", "params", ".", "save_steps", ",", "\n", "per_device_train_batch_size", "=", "params", ".", "batch_size", ",", "\n", "num_train_epochs", "=", "params", ".", "num_epochs", ",", "\n", "do_predict", "=", "True", ",", "\n", "dataloader_num_workers", "=", "8", ",", "\n", ")", "\n", "\n", "data_train", "=", "{", "\"text\"", ":", "[", "]", ",", "\"input_ids\"", ":", "[", "]", ",", "\"attention_mask\"", ":", "[", "]", "}", "\n", "data_valid", "=", "{", "\"text\"", ":", "[", "]", ",", "\"input_ids\"", ":", "[", "]", ",", "\"attention_mask\"", ":", "[", "]", "}", "\n", "\n", "for", "filename", "in", "filenames", ":", "\n", "        ", "log", ".", "info", "(", "f'Processing {filename}'", ")", "\n", "with", "open", "(", "filename", ",", "encoding", "=", "\"utf-8\"", ")", "as", "f", ":", "\n", "            ", "for", "line", "in", "f", ":", "\n", "                ", "line", "=", "line", ".", "strip", "(", ")", "\n", "features", "=", "line", ".", "split", "(", "\"\\x01\"", ")", "\n", "tokens", "=", "features", "[", "all_features_to_idx", "[", "'text_ tokens'", "]", "]", ".", "split", "(", "'\\t'", ")", "\n", "tokens", "=", "list", "(", "map", "(", "int", ",", "tokens", ")", ")", "\n", "tokens", "=", "tokens", "[", ":", "params", ".", "max_num_tokens", "]", "+", "[", "0", "]", "*", "(", "params", ".", "max_num_tokens", "-", "len", "(", "tokens", ")", ")", "\n", "\n", "if", "random", ".", "uniform", "(", "0", ",", "1", ")", ">", "VALIDATION_PERCENTAGE", ":", "\n", "                    ", "update_data", "(", "data_train", ",", "tokens", ",", "params", ".", "max_num_tokens", ")", "\n", "", "else", ":", "\n", "                    ", "update_data", "(", "data_valid", ",", "tokens", ",", "params", ".", "max_num_tokens", ")", "\n", "\n", "", "", "", "dataset_train", "=", "Dataset", ".", "from_dict", "(", "data_train", ")", "\n", "dataset_valid", "=", "Dataset", ".", "from_dict", "(", "data_valid", ")", "\n", "\n", "trainer", "=", "Trainer", "(", "\n", "model", "=", "model", ",", "\n", "args", "=", "training_args", ",", "\n", "train_dataset", "=", "dataset_train", ",", "\n", "eval_dataset", "=", "dataset_valid", ",", "\n", "data_collator", "=", "data_collator", "\n", ")", "\n", "trainer", ".", "train", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.fourier_feature_encoding.multiscale": [[4, 6], ["numpy.hstack", "x.reshape", "pow"], "function", ["None"], ["def", "multiscale", "(", "x", ",", "scales", ")", ":", "\n", "    ", "return", "np", ".", "hstack", "(", "[", "x", ".", "reshape", "(", "-", "1", ",", "1", ")", "/", "pow", "(", "2.", ",", "i", ")", "for", "i", "in", "scales", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.fourier_feature_encoding.encode_scalar_column": [[8, 10], ["numpy.hstack", "numpy.sin", "numpy.cos", "fourier_feature_encoding.multiscale", "fourier_feature_encoding.multiscale"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.fourier_feature_encoding.multiscale", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.fourier_feature_encoding.multiscale"], ["", "def", "encode_scalar_column", "(", "x", ",", "scales", "=", "[", "-", "1", ",", "0", ",", "1", ",", "2", ",", "3", ",", "4", ",", "5", ",", "6", "]", ")", ":", "\n", "    ", "return", "np", ".", "hstack", "(", "[", "np", ".", "sin", "(", "multiscale", "(", "x", ",", "scales", ")", ")", ",", "np", ".", "cos", "(", "multiscale", "(", "x", ",", "scales", ")", ")", "]", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.prepare_token_embeddings.get_parser": [[16, 23], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument"], "function", ["None"], ["def", "get_parser", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n", "parser", ".", "add_argument", "(", "\"--config-file\"", ",", "type", "=", "str", ",", "default", "=", "'config.yaml'", ",", "help", "=", "'Configuration file.'", ")", "\n", "parser", ".", "add_argument", "(", "\"--checkpoint-path\"", ",", "type", "=", "str", ",", "required", "=", "True", ",", "help", "=", "'Path to bert checkpoint model'", ")", "\n", "parser", ".", "add_argument", "(", "\"--max-N-parts\"", ",", "type", "=", "int", ",", "default", "=", "1", ",", "\n", "help", "=", "'Maximum number of training parts that are taken to bert finetuning.'", ")", "\n", "return", "parser", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.prepare_token_embeddings.prepare_sketches": [[25, 66], ["transformers.DistilBertForMaskedLM.from_pretrained().cuda", "log.info", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict.items", "log.info", "os.makedirs", "open", "yaml.load", "os.path.join", "open", "f.write", "collections.defaultdict.items", "transformers.DistilBertForMaskedLM.from_pretrained", "os.path.join", "numpy.zeros", "open", "os.path.join", "f.write", "f.write", "f.write", "os.listdir", "line.strip.strip", "line.strip.split", "features[].split", "list", "embeddings[].squeeze", "zip", "len", "map", "DistilBertForMaskedLM.from_pretrained().cuda.", "v.to().detach().numpy.to().detach().numpy", "map", "torch.tensor().unsqueeze().cuda", "v.to().detach().numpy.to().detach", "str", "torch.tensor().unsqueeze", "v.to().detach().numpy.to", "torch.tensor"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split"], ["", "def", "prepare_sketches", "(", "params", ")", ":", "\n", "    ", "BERT_EMBEDDING_SIZE", "=", "768", "\n", "with", "open", "(", "params", ".", "config_file", ")", "as", "f", ":", "\n", "        ", "config", "=", "yaml", ".", "load", "(", "f", ")", "\n", "\n", "", "model", "=", "DistilBertForMaskedLM", ".", "from_pretrained", "(", "params", ".", "checkpoint_path", ")", ".", "cuda", "(", ")", "\n", "filenames", "=", "[", "os", ".", "path", ".", "join", "(", "config", "[", "'recsys_data'", "]", ",", "f", ")", "for", "f", "in", "os", ".", "listdir", "(", "config", "[", "'recsys_data'", "]", ")", "if", "'part'", "in", "f", "]", "[", ":", "params", ".", "max_N_parts", "]", "\n", "log", ".", "info", "(", "f\"Used input filenames: {filenames}\"", ")", "\n", "\n", "bert_tokens", "=", "defaultdict", "(", "lambda", ":", "np", ".", "zeros", "(", "BERT_EMBEDDING_SIZE", ")", ")", "\n", "token_occurences", "=", "defaultdict", "(", "int", ")", "\n", "\n", "for", "filename", "in", "filenames", ":", "\n", "        ", "with", "open", "(", "filename", ",", "encoding", "=", "\"utf-8\"", ")", "as", "f", ":", "\n", "            ", "for", "line", "in", "f", ":", "\n", "                ", "line", "=", "line", ".", "strip", "(", ")", "\n", "features", "=", "line", ".", "split", "(", "\"\\x01\"", ")", "\n", "\n", "tokens", "=", "features", "[", "all_features_to_idx", "[", "'text_ tokens'", "]", "]", ".", "split", "(", "'\\t'", ")", "\n", "tokens", "=", "list", "(", "map", "(", "int", ",", "tokens", ")", ")", "\n", "\n", "embeddings", "=", "model", "(", "torch", ".", "tensor", "(", "tokens", ")", ".", "unsqueeze", "(", "0", ")", ".", "cuda", "(", ")", ",", "output_hidden_states", "=", "True", ")", ".", "hidden_states", "\n", "embeddings", "=", "embeddings", "[", "-", "1", "]", ".", "squeeze", "(", ")", "\n", "\n", "for", "k", ",", "v", "in", "zip", "(", "tokens", ",", "embeddings", ")", ":", "\n", "                    ", "v", "=", "v", ".", "to", "(", "'cpu'", ")", ".", "detach", "(", ")", ".", "numpy", "(", ")", "\n", "bert_tokens", "[", "k", "]", "+=", "v", "\n", "token_occurences", "[", "k", "]", "+=", "1", "\n", "\n", "", "", "", "", "for", "k", ",", "v", "in", "bert_tokens", ".", "items", "(", ")", ":", "\n", "        ", "v", "/=", "token_occurences", "[", "k", "]", "\n", "bert_tokens", "[", "k", "]", "=", "v", "\n", "\n", "", "log", ".", "info", "(", "f\"Number of tokens: {len(bert_tokens)}\"", ")", "\n", "os", ".", "makedirs", "(", "os", ".", "path", ".", "join", "(", "config", "[", "'working_dir'", "]", ")", ",", "exist_ok", "=", "True", ")", "\n", "with", "open", "(", "os", ".", "path", ".", "join", "(", "config", "[", "'working_dir'", "]", ",", "'subwords_bert_pretrained.txt'", ")", ",", "'w'", ")", "as", "f", ":", "\n", "        ", "f", ".", "write", "(", "'control line\\n'", ")", "\n", "for", "k", ",", "v", "in", "bert_tokens", ".", "items", "(", ")", ":", "\n", "            ", "f", ".", "write", "(", "str", "(", "k", ")", "+", "' '", "+", "'-1'", "+", "' '", ")", "\n", "f", ".", "write", "(", "' '", ".", "join", "(", "map", "(", "str", ",", "v", ")", ")", ")", "\n", "f", ".", "write", "(", "'\\n'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64": [[9, 12], ["s.encode", "lib.sipHash64", "len"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.emde.encode", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64"], ["def", "sipHash64", "(", "s", ")", ":", "\n", "    ", "st", "=", "s", ".", "encode", "(", "'ascii'", ",", "errors", "=", "'ignore'", ")", "\n", "return", "lib", ".", "sipHash64", "(", "st", ",", "len", "(", "st", ")", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.interactions_extraction.get_parser": [[17, 21], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument"], "function", ["None"], ["def", "get_parser", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n", "parser", ".", "add_argument", "(", "\"--config-file\"", ",", "type", "=", "str", ",", "default", "=", "'config.yaml'", ",", "help", "=", "'Configuration file.'", ")", "\n", "return", "parser", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.interactions_extraction.interactions_extraction": [[23, 36], ["preprocessing.split_by_date.split_training_parts", "preprocessing.authors_similarity.find_similar_authors", "preprocessing.compute_interactions.compute_interactions", "preprocessing.compute_interactions.save_interactions", "preprocessing.split_validation.split_validation", "preprocessing.add_training_interactions_to_valid.add_interactions", "preprocessing.compute_validation_interactions.compute_validation_interactions", "preprocessing.add_validation_interactions_to_training.add_validation_interactions", "preprocessing.valid_interactions_per_chunk.add_interactions_per_chunk", "open", "yaml.load"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split_training_parts", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.authors_similarity.find_similar_authors", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.compute_interactions.compute_interactions", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.compute_interactions.save_interactions", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_validation.split_validation", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.add_training_interactions_to_valid.add_interactions", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.compute_validation_interactions.compute_validation_interactions", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.add_validation_interactions_to_training.add_validation_interactions", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.valid_interactions_per_chunk.add_interactions_per_chunk"], ["", "def", "interactions_extraction", "(", "params", ")", ":", "\n", "    ", "with", "open", "(", "params", ".", "config_file", ")", "as", "f", ":", "\n", "        ", "config", "=", "yaml", ".", "load", "(", "f", ",", "Loader", "=", "yaml", ".", "FullLoader", ")", "\n", "\n", "", "split_training_parts", "(", "config", ")", "\n", "find_similar_authors", "(", "config", ")", "\n", "compute_interactions", "(", "config", ")", "\n", "save_interactions", "(", "config", ")", "\n", "split_validation", "(", "config", ")", "\n", "add_interactions", "(", "config", ")", "\n", "compute_validation_interactions", "(", "config", ")", "\n", "add_validation_interactions", "(", "config", ")", "\n", "add_interactions_per_chunk", "(", "config", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.train.get_parser": [[18, 28], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument"], "function", ["None"], ["def", "get_parser", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n", "parser", ".", "add_argument", "(", "\"--config-file\"", ",", "type", "=", "str", ",", "default", "=", "'config.yaml'", ",", "help", "=", "'Configuration file.'", ")", "\n", "parser", ".", "add_argument", "(", "\"--hidden-size\"", ",", "type", "=", "int", ",", "default", "=", "1500", ",", "help", "=", "'Hidden size of neural network'", ")", "\n", "parser", ".", "add_argument", "(", "\"--batch-size\"", ",", "type", "=", "int", ",", "default", "=", "256", ",", "help", "=", "'Batch size'", ")", "\n", "parser", ".", "add_argument", "(", "\"--learning-rate\"", ",", "type", "=", "int", ",", "default", "=", "1e-4", ",", "help", "=", "'Start learning rate'", ")", "\n", "parser", ".", "add_argument", "(", "\"--decay\"", ",", "type", "=", "float", ",", "default", "=", "0.96", ",", "help", "=", "'Learning rate decay'", ")", "\n", "parser", ".", "add_argument", "(", "\"--validation-decay\"", ",", "type", "=", "float", ",", "default", "=", "0.5", ",", "help", "=", "'Learning rate decay for training on validation part'", ")", "\n", "parser", ".", "add_argument", "(", "\"--num-validation-epochs\"", ",", "type", "=", "int", ",", "default", "=", "1", ",", "help", "=", "'Number of epochs for training on validation part'", ")", "\n", "return", "parser", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.train.train": [[30, 91], ["log.info", "twitter_dataset.TwitterDataset", "torch.utils.data.DataLoader", "model.net.Model", "model.trainer.Trainer", "pytorch_lightning.Trainer", "log.info", "pl.Trainer.test", "range", "random.shuffle", "log.info", "twitter_dataset.TwitterDataset", "torch.utils.data.DataLoader", "range", "pl.Trainer.test", "open", "yaml.load", "open", "pickle.load", "open", "json.load", "open", "pickle.load", "len", "os.path.join", "log.info", "twitter_dataset.TwitterDataset", "torch.utils.data.DataLoader", "pl.Trainer.fit", "pl.Trainer.fit", "os.path.join", "os.listdir", "open", "pickle.load", "open", "pickle.load", "os.path.join"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.Coder.fit", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.Coder.fit"], ["", "def", "train", "(", "params", ")", ":", "\n", "    ", "log", ".", "info", "(", "\"Loading data\"", ")", "\n", "with", "open", "(", "params", ".", "config_file", ")", "as", "f", ":", "\n", "        ", "config", "=", "yaml", ".", "load", "(", "f", ",", "Loader", "=", "yaml", ".", "FullLoader", ")", "\n", "\n", "", "with", "open", "(", "f\"{config['working_dir']}/language2id\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "language2id", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "subword_codes_name", "=", "f\"{config['working_dir']}/subwords_bert.json\"", "\n", "with", "open", "(", "subword_codes_name", ")", "as", "f", ":", "\n", "        ", "subword_codes", "=", "json", ".", "load", "(", "f", ")", "\n", "\n", "", "with", "open", "(", "os", ".", "path", ".", "join", "(", "config", "[", "'working_dir'", "]", ",", "'validation_split_holdout'", ")", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "valid_day", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "valid_dataset", "=", "TwitterDataset", "(", "valid_day", ",", "subword_codes", ",", "language2id", ",", "config", "[", "'sketch_width'", "]", ",", "config", "[", "'sketch_depth'", "]", ",", "labels_available", "=", "True", ")", "\n", "valid_loader", "=", "DataLoader", "(", "valid_dataset", ",", "batch_size", "=", "params", ".", "batch_size", ",", "num_workers", "=", "15", ",", "shuffle", "=", "False", ")", "\n", "\n", "\n", "EMBEDDING_SIZE", "=", "20", "# size of embeddings for day, language and hour", "\n", "NUM_CATEGORICAL_FEATURES", "=", "12", "# number of categortical features created in TwitterDataset", "\n", "NUM_NUMERICAL_FEATURES", "=", "73", "# number of numerical features created in TwitterDataset", "\n", "\n", "net", "=", "Model", "(", "params", ".", "hidden_size", ",", "len", "(", "language2id", ")", ",", "EMBEDDING_SIZE", ",", "NUM_CATEGORICAL_FEATURES", ",", "NUM_NUMERICAL_FEATURES", ",", "config", "[", "'sketch_depth'", "]", ",", "config", "[", "'sketch_width'", "]", ")", "\n", "lr", "=", "params", ".", "learning_rate", "\n", "model", "=", "Trainer", "(", "net", ",", "lr", ")", "\n", "trainer", "=", "pl", ".", "Trainer", "(", "gpus", "=", "1", ",", "max_epochs", "=", "1", ",", "logger", "=", "False", ",", "checkpoint_callback", "=", "False", ")", "\n", "\n", "log", ".", "info", "(", "\"Start training\"", ")", "\n", "filenames", "=", "[", "os", ".", "path", ".", "join", "(", "config", "[", "'working_dir'", "]", ",", "f", ")", "for", "f", "in", "os", ".", "listdir", "(", "config", "[", "'working_dir'", "]", ")", "if", "'train_set_all'", "in", "f", "]", "\n", "for", "training_filename", "in", "filenames", ":", "\n", "        ", "log", ".", "info", "(", "f\"Training on {training_filename}\"", ")", "\n", "model", ".", "learning_rate", "=", "lr", "\n", "with", "open", "(", "training_filename", ",", "'rb'", ")", "as", "handle", ":", "\n", "            ", "traininig_part", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "train_dataset", "=", "TwitterDataset", "(", "traininig_part", ",", "subword_codes", ",", "language2id", ",", "config", "[", "'sketch_width'", "]", ",", "config", "[", "'sketch_depth'", "]", ",", "labels_available", "=", "True", ")", "\n", "train_loader", "=", "DataLoader", "(", "train_dataset", ",", "batch_size", "=", "params", ".", "batch_size", ",", "num_workers", "=", "15", ",", "shuffle", "=", "True", ")", "\n", "trainer", ".", "fit", "(", "model", ",", "train_loader", ")", "\n", "lr", "=", "lr", "*", "params", ".", "decay", "\n", "\n", "", "trainer", ".", "test", "(", "model", ",", "valid_loader", ")", "\n", "\n", "train_day", "=", "[", "]", "\n", "for", "chunk_idx", "in", "range", "(", "config", "[", "'num_validation_chunks'", "]", ")", ":", "\n", "        ", "with", "open", "(", "os", ".", "path", ".", "join", "(", "config", "[", "'working_dir'", "]", ",", "f\"validation_train_with_valid_interactions_{chunk_idx}\"", ")", ",", "'rb'", ")", "as", "handle", ":", "\n", "            ", "train_day_current", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "", "train_day", "+=", "train_day_current", "\n", "", "random", ".", "shuffle", "(", "train_day", ")", "\n", "\n", "log", ".", "info", "(", "\"Finetunning on validation set\"", ")", "\n", "lr", "=", "params", ".", "learning_rate", "\n", "train_dataset", "=", "TwitterDataset", "(", "train_day", ",", "subword_codes", ",", "language2id", ",", "config", "[", "'sketch_width'", "]", ",", "config", "[", "'sketch_depth'", "]", ",", "labels_available", "=", "True", ")", "\n", "train_loader", "=", "DataLoader", "(", "train_dataset", ",", "batch_size", "=", "params", ".", "batch_size", ",", "num_workers", "=", "15", ",", "shuffle", "=", "True", ")", "\n", "\n", "for", "_", "in", "range", "(", "params", ".", "num_validation_epochs", ")", ":", "\n", "        ", "model", ".", "learning_rate", "=", "lr", "\n", "trainer", ".", "fit", "(", "model", ",", "train_loader", ")", "\n", "lr", "=", "lr", "*", "params", ".", "validation_decay", "\n", "\n", "", "trainer", ".", "test", "(", "model", ",", "valid_loader", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.emde.get_parser": [[14, 18], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument"], "function", ["None"], ["def", "get_parser", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n", "parser", ".", "add_argument", "(", "\"--config-file\"", ",", "type", "=", "str", ",", "default", "=", "'config.yaml'", ",", "help", "=", "'Configuration file.'", ")", "\n", "return", "parser", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.emde.load_emb": [[20, 35], ["numpy.vstack", "open", "next", "line.split.rstrip", "line.split.split", "numpy.array", "ids.append", "np.vstack.append", "len", "list", "map"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split"], ["", "def", "load_emb", "(", "fname", ")", ":", "\n", "    ", "ids", "=", "[", "]", "\n", "vecs", "=", "[", "]", "\n", "with", "open", "(", "fname", ")", "as", "f", ":", "\n", "        ", "next", "(", "f", ")", "\n", "for", "line", "in", "f", ":", "\n", "            ", "line", "=", "line", ".", "rstrip", "(", "'\\n'", ")", "\n", "line", "=", "line", ".", "split", "(", ")", "\n", "emb_len", "=", "len", "(", "line", ")", "-", "2", "\n", "idx", "=", "line", "[", "0", "]", "\n", "vec", "=", "np", ".", "array", "(", "list", "(", "map", "(", "float", ",", "line", "[", "-", "emb_len", ":", "]", ")", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "ids", ".", "append", "(", "idx", ")", "\n", "vecs", ".", "append", "(", "vec", ")", "\n", "", "", "vecs", "=", "np", ".", "vstack", "(", "vecs", ")", "\n", "return", "ids", ",", "vecs", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.emde.cs_lsh": [[37, 41], ["coders.DLSH", "coders.DLSH.fit", "coders.DLSH.transform_to_absolute_codes"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.Coder.fit", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.Coder.transform_to_absolute_codes"], ["", "def", "cs_lsh", "(", "embeddings", ",", "sketch_width", ",", "sketch_depth", ")", ":", "\n", "    ", "coder", "=", "DLSH", "(", "sketch_depth", ",", "sketch_width", ")", "\n", "coder", ".", "fit", "(", "embeddings", ")", "\n", "return", "coder", ".", "transform_to_absolute_codes", "(", "embeddings", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.emde.process_file": [[43, 50], ["emde.load_emb", "func", "range", "len", "list", "map", "list"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.emde.load_emb"], ["", "def", "process_file", "(", "fname", ",", "func", ")", ":", "\n", "    ", "codedict", "=", "{", "}", "\n", "ids", ",", "embeddings", "=", "load_emb", "(", "fname", ")", "\n", "codes", "=", "func", "(", "embeddings", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "ids", ")", ")", ":", "\n", "        ", "codedict", "[", "ids", "[", "i", "]", "]", "=", "list", "(", "map", "(", "int", ",", "list", "(", "codes", "[", "i", "]", ")", ")", ")", "\n", "", "return", "codedict", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.emde.encode": [[52, 60], ["os.path.join", "emde.process_file", "os.path.join", "log.info", "emde.cs_lsh", "open", "json.dump"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.emde.process_file", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.emde.cs_lsh"], ["", "def", "encode", "(", "config", ")", ":", "\n", "    ", "method", "=", "lambda", "x", ":", "cs_lsh", "(", "x", ",", "config", "[", "'sketch_width'", "]", ",", "config", "[", "'sketch_depth'", "]", ")", "\n", "input_fname", "=", "os", ".", "path", ".", "join", "(", "config", "[", "'working_dir'", "]", ",", "'subwords_bert_pretrained.txt'", ")", "\n", "codedict", "=", "process_file", "(", "input_fname", ",", "method", ")", "\n", "fname", "=", "os", ".", "path", ".", "join", "(", "config", "[", "'working_dir'", "]", ",", "'subwords_bert.json'", ")", "\n", "with", "open", "(", "fname", ",", "'w'", ")", "as", "f", ":", "\n", "        ", "json", ".", "dump", "(", "codedict", ",", "f", ")", "\n", "", "log", ".", "info", "(", "f\"Wrote results to: {fname}\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.Coder.__init__": [[9, 14], ["sklearn.preprocessing.StandardScaler", "sklearn.random_projection.GaussianRandomProjection"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "n_sketches", ",", "sketch_dim", ")", ":", "\n", "        ", "self", ".", "n_sketches", "=", "n_sketches", "\n", "self", ".", "sketch_dim", "=", "sketch_dim", "\n", "self", ".", "ss", "=", "StandardScaler", "(", ")", "\n", "self", ".", "sp", "=", "GaussianRandomProjection", "(", "n_components", "=", "16", "*", "n_sketches", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.Coder.fit": [[15, 21], ["coders.Coder.ss.fit", "coders.Coder.ss.transform", "coders.Coder.sp.fit", "coders.Coder.sp.transform", "coders.Coder.init_biases"], "methods", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.Coder.fit", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.Coder.transform", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.Coder.fit", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.Coder.transform", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.DLSH.init_biases"], ["", "def", "fit", "(", "self", ",", "v", ")", ":", "\n", "        ", "self", ".", "ss", "=", "self", ".", "ss", ".", "fit", "(", "v", ")", "\n", "vv", "=", "self", ".", "ss", ".", "transform", "(", "v", ")", "\n", "self", ".", "sp", "=", "self", ".", "sp", ".", "fit", "(", "vv", ")", "\n", "vvv", "=", "self", ".", "sp", ".", "transform", "(", "vv", ")", "\n", "self", ".", "init_biases", "(", "vvv", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.Coder.transform": [[22, 29], ["coders.Coder.ss.transform", "coders.Coder.sp.transform", "coders.Coder.discretize", "numpy.packbits", "numpy.frombuffer().reshape", "numpy.frombuffer", "numpy.ascontiguousarray"], "methods", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.Coder.transform", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.Coder.transform", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.DLSH.discretize"], ["", "def", "transform", "(", "self", ",", "v", ")", ":", "\n", "        ", "v", "=", "self", ".", "ss", ".", "transform", "(", "v", ")", "\n", "v", "=", "self", ".", "sp", ".", "transform", "(", "v", ")", "\n", "v", "=", "self", ".", "discretize", "(", "v", ")", "\n", "v", "=", "np", ".", "packbits", "(", "v", ",", "axis", "=", "-", "1", ")", "\n", "v", "=", "np", ".", "frombuffer", "(", "np", ".", "ascontiguousarray", "(", "v", ")", ",", "dtype", "=", "np", ".", "uint16", ")", ".", "reshape", "(", "v", ".", "shape", "[", "0", "]", ",", "-", "1", ")", "%", "self", ".", "sketch_dim", "\n", "return", "v", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.Coder.transform_to_absolute_codes": [[30, 35], ["coders.Coder.transform", "numpy.array", "range"], "methods", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.Coder.transform"], ["", "def", "transform_to_absolute_codes", "(", "self", ",", "v", ",", "labels", "=", "None", ")", ":", "\n", "        ", "codes", "=", "self", ".", "transform", "(", "v", ")", "\n", "pos_index", "=", "np", ".", "array", "(", "[", "i", "*", "self", ".", "sketch_dim", "for", "i", "in", "range", "(", "self", ".", "n_sketches", ")", "]", ",", "dtype", "=", "np", ".", "int_", ")", "\n", "index", "=", "codes", "+", "pos_index", "\n", "return", "index", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.DLSH.__init__": [[38, 40], ["coders.Coder.__init__"], "methods", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.model.net.Model.__init__"], ["    ", "def", "__init__", "(", "self", ",", "n_sketches", ",", "sketch_dim", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "n_sketches", ",", "sketch_dim", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.DLSH.init_biases": [[41, 43], ["numpy.array", "numpy.percentile", "range"], "methods", ["None"], ["", "def", "init_biases", "(", "self", ",", "v", ")", ":", "\n", "        ", "self", ".", "biases", "=", "np", ".", "array", "(", "[", "np", ".", "percentile", "(", "v", "[", ":", ",", "i", "]", ",", "q", "=", "50", ",", "axis", "=", "0", ")", "for", "i", "in", "range", "(", "v", ".", "shape", "[", "1", "]", ")", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.coders.DLSH.discretize": [[44, 46], ["numpy.sign"], "methods", ["None"], ["", "def", "discretize", "(", "self", ",", "v", ")", ":", "\n", "        ", "return", "(", "(", "np", ".", "sign", "(", "v", "-", "self", ".", "biases", ")", "+", "1", ")", "/", "2", ")", ".", "astype", "(", "np", ".", "uint8", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.twitter_dataset.TwitterDataset.__init__": [[11, 18], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "data", ",", "subword_codes", ",", "language2id", ",", "sketch_width", ",", "sketch_depth", ",", "labels_available", ")", ":", "\n", "        ", "self", ".", "data", "=", "data", "\n", "self", ".", "labels_available", "=", "labels_available", "\n", "self", ".", "subword_codes", "=", "subword_codes", "\n", "self", ".", "language2id", "=", "language2id", "\n", "self", ".", "sketch_width", "=", "sketch_width", "\n", "self", ".", "sketch_depth", "=", "sketch_depth", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.twitter_dataset.TwitterDataset.__len__": [[19, 21], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "data", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.twitter_dataset.TwitterDataset.__getitem__": [[22, 100], ["[].split", "len", "features[].split", "numpy.zeros", "sklearn.preprocessing.normalize().reshape", "len", "int", "int", "int", "int", "set", "datetime.datetime.datetime.fromtimestamp", "fourier_feature_encoding.encode_scalar_column().flatten", "features[].split", "features[].split", "len", "set.split", "int", "torch.LongTensor", "numpy.concatenate", "twitter_dataset.TwitterDataset.subword_codes.keys", "sklearn.preprocessing.normalize", "datetime.datetime.datetime.fromtimestamp", "datetime.datetime.datetime.fromtimestamp", "fourier_feature_encoding.encode_scalar_column", "sklearn.preprocessing.normalize().reshape.reshape", "int", "int", "numpy.array"], "methods", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.fourier_feature_encoding.encode_scalar_column"], ["", "def", "__getitem__", "(", "self", ",", "idx", ")", ":", "\n", "        ", "features", "=", "self", ".", "data", "[", "idx", "]", "[", "'line'", "]", ".", "split", "(", "\"\\x01\"", ")", "\n", "num_tokens", "=", "len", "(", "features", "[", "all_features_to_idx", "[", "'text_ tokens'", "]", "]", ".", "split", "(", "'\\t'", ")", ")", "\n", "subwords", "=", "features", "[", "all_features_to_idx", "[", "'text_ tokens'", "]", "]", ".", "split", "(", "'\\t'", ")", "\n", "\n", "# calcualte tweet tokens sketch", "\n", "subword_sketch", "=", "np", ".", "zeros", "(", "[", "self", ".", "sketch_width", "*", "self", ".", "sketch_depth", "]", ")", "\n", "for", "sw", "in", "subwords", "[", "1", ":", "-", "1", "]", ":", "\n", "            ", "if", "sw", "in", "self", ".", "subword_codes", ".", "keys", "(", ")", ":", "\n", "                ", "subword_sketch", "[", "self", ".", "subword_codes", "[", "sw", "]", "]", "+=", "1", "\n", "", "", "subword_sketch", "=", "normalize", "(", "subword_sketch", ".", "reshape", "(", "-", "1", ",", "self", ".", "sketch_width", ")", ",", "'l2'", ")", ".", "reshape", "(", "(", "self", ".", "sketch_width", "*", "self", ".", "sketch_depth", ",", ")", ")", "\n", "\n", "\n", "interactions", "=", "self", ".", "data", "[", "idx", "]", "[", "'interactions'", "]", "+", "self", ".", "data", "[", "idx", "]", "[", "'interactions_valid'", "]", "+", "self", ".", "data", "[", "idx", "]", "[", "'interactions_valid_negatives'", "]", "\n", "num_hashtags", "=", "len", "(", "features", "[", "all_features_to_idx", "[", "'hashtags'", "]", "]", ".", "split", "(", ")", ")", "\n", "\n", "engaged_with_user_follower_count", "=", "int", "(", "features", "[", "all_features_to_idx", "[", "'engaged_with_user_follower_count'", "]", "]", ")", "\n", "engaged_with_user_following_count", "=", "int", "(", "features", "[", "all_features_to_idx", "[", "'engaged_with_user_following_count'", "]", "]", ")", "\n", "enaging_user_follower_count", "=", "int", "(", "features", "[", "all_features_to_idx", "[", "'enaging_user_follower_count'", "]", "]", ")", "\n", "enaging_user_following_count", "=", "int", "(", "features", "[", "all_features_to_idx", "[", "'enaging_user_following_count'", "]", "]", ")", "\n", "\n", "engaged_with_user_is_verified", "=", "1", "if", "features", "[", "all_features_to_idx", "[", "'engaged_with_user_is_verified'", "]", "]", "==", "'true'", "else", "0", "\n", "enaging_user_is_verified", "=", "1", "if", "features", "[", "all_features_to_idx", "[", "'enaging_user_is_verified'", "]", "]", "==", "'true'", "else", "0", "\n", "\n", "if", "features", "[", "all_features_to_idx", "[", "'language'", "]", "]", "in", "self", ".", "language2id", ":", "\n", "            ", "language", "=", "self", ".", "language2id", "[", "features", "[", "all_features_to_idx", "[", "'language'", "]", "]", "]", "\n", "", "else", ":", "\n", "            ", "language", "=", "len", "(", "self", ".", "language2id", ")", "\n", "\n", "", "is_hashtag", "=", "1", "if", "features", "[", "all_features_to_idx", "[", "'hashtags'", "]", "]", "!=", "''", "else", "0", "\n", "media", "=", "features", "[", "all_features_to_idx", "[", "'present_media'", "]", "]", "\n", "media", "=", "set", "(", "media", ".", "split", "(", "'\\t'", ")", ")", "\n", "is_gif", "=", "1", "if", "'GIF'", "in", "media", "else", "0", "\n", "is_photo", "=", "1", "if", "'Photo'", "in", "media", "else", "0", "\n", "is_video", "=", "1", "if", "'Video'", "in", "media", "else", "0", "\n", "is_link", "=", "1", "if", "features", "[", "all_features_to_idx", "[", "'present_links'", "]", "]", "!=", "''", "else", "0", "\n", "is_domain", "=", "1", "if", "features", "[", "all_features_to_idx", "[", "'present_domains'", "]", "]", "!=", "''", "else", "0", "\n", "tweet_type", "=", "features", "[", "all_features_to_idx", "[", "'tweet_type'", "]", "]", "\n", "is_quote", "=", "1", "if", "tweet_type", "==", "'Quote'", "else", "0", "\n", "is_retweet", "=", "1", "if", "tweet_type", "==", "'Retweet'", "else", "0", "\n", "is_top_level", "=", "1", "if", "tweet_type", "==", "'TopLevel'", "else", "0", "\n", "\n", "\n", "twitt_date", "=", "datetime", ".", "fromtimestamp", "(", "int", "(", "features", "[", "all_features_to_idx", "[", "'tweet_timestamp'", "]", "]", ")", ")", "\n", "enaging_account_creation_diff", "=", "(", "twitt_date", "-", "datetime", ".", "fromtimestamp", "(", "int", "(", "features", "[", "all_features_to_idx", "[", "'enaging_user_account_creation'", "]", "]", ")", ")", ")", ".", "days", "\n", "enaged_account_creation_diff", "=", "(", "twitt_date", "-", "datetime", ".", "fromtimestamp", "(", "int", "(", "features", "[", "all_features_to_idx", "[", "'engaged_with_user_account_creation'", "]", "]", ")", ")", ")", ".", "days", "\n", "\n", "twitt_hour", "=", "twitt_date", ".", "hour", "\n", "twitt_day", "=", "twitt_date", ".", "day", "-", "1", "# indexing days from 0", "\n", "\n", "\n", "if", "self", ".", "labels_available", ":", "\n", "            ", "label_like", "=", "1", "if", "features", "[", "labels_to_idx", "[", "'like_timestamp'", "]", "]", "!=", "''", "else", "0", "\n", "label_retweet", "=", "1", "if", "features", "[", "labels_to_idx", "[", "'retweet_timestamp'", "]", "]", "!=", "''", "else", "0", "\n", "label_retweet_with_comment", "=", "1", "if", "features", "[", "labels_to_idx", "[", "'retweet_with_comment_timestamp'", "]", "]", "!=", "''", "else", "0", "\n", "label_reply", "=", "1", "if", "features", "[", "labels_to_idx", "[", "'reply_timestamp'", "]", "]", "!=", "''", "else", "0", "\n", "labels", "=", "torch", ".", "LongTensor", "(", "[", "label_like", ",", "label_retweet", ",", "label_retweet_with_comment", ",", "label_reply", "]", ")", "\n", "\n", "\n", "", "features_interactions", "=", "encode_scalar_column", "(", "np", ".", "array", "(", "interactions", "+", "\n", "[", "num_hashtags", ",", "num_tokens", ",", "engaged_with_user_follower_count", ",", "engaged_with_user_following_count", ",", "\n", "enaging_user_follower_count", ",", "enaging_user_following_count", ",", "enaging_account_creation_diff", ",", "\n", "enaged_account_creation_diff", "]", ")", ")", ".", "flatten", "(", ")", "\n", "engagee_follows_engager", "=", "1", "if", "features", "[", "all_features_to_idx", "[", "'engagee_follows_engager'", "]", "]", "==", "'true'", "else", "0", "\n", "\n", "result", "=", "{", "\n", "'input'", ":", "np", ".", "concatenate", "(", "(", "subword_sketch", ",", "\n", "features_interactions", ",", "\n", "[", "engagee_follows_engager", ",", "engaged_with_user_is_verified", ",", "enaging_user_is_verified", ",", "\n", "is_hashtag", ",", "is_gif", ",", "is_photo", ",", "is_video", ",", "is_link", ",", "is_domain", ",", "is_quote", ",", "is_retweet", ",", "is_top_level", "]", ")", ")", ",", "\n", "'language'", ":", "language", ",", "\n", "'twitt_hour'", ":", "twitt_hour", ",", "\n", "'twitt_day'", ":", "twitt_day", "\n", "}", "\n", "\n", "if", "self", ".", "labels_available", ":", "\n", "            ", "result", "[", "'labels'", "]", "=", "labels", "\n", "", "return", "result", "", "", "", ""]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.utils.get_similar_interactions": [[5, 24], ["sipHash64.sipHash64"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64"], ["def", "get_similar_interactions", "(", "auth2similar", ",", "engaged_with_user_id_orig", ",", "enaging_user_id_orig", ",", "interactions", ")", ":", "\n", "    ", "similar_authors", "=", "auth2similar", "[", "engaged_with_user_id_orig", "]", "\n", "interaction_users_similar_like", "=", "0", "\n", "interaction_users_similar_reply", "=", "0", "\n", "interaction_users_similar_retweet", "=", "0", "\n", "interaction_users_similar_retweet_with_comment", "=", "0", "\n", "\n", "score_all", "=", "0", "\n", "for", "sa", "in", "similar_authors", ":", "\n", "        ", "author", "=", "sa", "[", "0", "]", "\n", "score", "=", "sa", "[", "1", "]", "\n", "key_sim", "=", "sipHash64", "(", "f'{author}_{enaging_user_id_orig}'", ")", "\n", "interaction_users_similar_like", "+=", "interactions", "[", "'like'", "]", "[", "key_sim", "]", "*", "score", "\n", "interaction_users_similar_reply", "+=", "interactions", "[", "'reply'", "]", "[", "key_sim", "]", "*", "score", "\n", "interaction_users_similar_retweet", "+=", "interactions", "[", "'retweet'", "]", "[", "key_sim", "]", "*", "score", "\n", "interaction_users_similar_retweet_with_comment", "+=", "interactions", "[", "'retweet_with_comment'", "]", "[", "key_sim", "]", "*", "score", "\n", "score_all", "+=", "score", "\n", "\n", "", "return", "[", "interaction_users_similar_like", ",", "interaction_users_similar_reply", ",", "interaction_users_similar_retweet", ",", "interaction_users_similar_retweet_with_comment", ",", "score_all", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.utils.compute_validation_interactions_datapoint": [[26, 80], ["line.split", "sipHash64.sipHash64", "features[].split", "sipHash64.sipHash64", "sipHash64.sipHash64", "sipHash64.sipHash64", "sipHash64.sipHash64", "utils.compute_validation_interactions_datapoint.increase_reaction"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64"], ["", "def", "compute_validation_interactions_datapoint", "(", "datapoint", ",", "interaction_counter_all", ",", "num_enaged_all", ",", "num_enaging_all", ",", "user_hashtag_all", ",", "\n", "interaction_counter_lang_all", ",", "twit_positive", ",", "interaction_counter_all_negative", ",", "\n", "num_enaged_all_negative", ",", "num_enaging_all_negative", ",", "twit_negative", ")", ":", "\n", "\n", "    ", "def", "increase_reaction", "(", "relation", ",", "key", ",", "engaged_with_user_id", ",", "enaging_user_id", ",", "key_hashtags", ",", "key_language", ")", ":", "\n", "        ", "interaction_counter_all", "[", "relation", "]", "[", "key", "]", "+=", "1", "\n", "num_enaged_all", "[", "relation", "]", "[", "engaged_with_user_id", "]", "+=", "1", "\n", "num_enaging_all", "[", "relation", "]", "[", "enaging_user_id", "]", "+=", "1", "\n", "\n", "for", "key_hashtag_current", "in", "key_hashtags", ":", "\n", "            ", "user_hashtag_all", "[", "relation", "]", "[", "key_hashtag_current", "]", "+=", "1", "\n", "", "interaction_counter_lang_all", "[", "relation", "]", "[", "key_language", "]", "+=", "1", "\n", "\n", "", "line", "=", "datapoint", "[", "'line'", "]", "\n", "features", "=", "line", ".", "split", "(", "\"\\x01\"", ")", "\n", "tweet_id", "=", "features", "[", "all_features_to_idx", "[", "'tweet_id'", "]", "]", "\n", "\n", "engaged_with_user_id", "=", "features", "[", "all_features_to_idx", "[", "'engaged_with_user_id'", "]", "]", "\n", "enaging_user_id", "=", "features", "[", "all_features_to_idx", "[", "'enaging_user_id'", "]", "]", "\n", "\n", "key", "=", "sipHash64", "(", "f'{engaged_with_user_id}_{enaging_user_id}'", ")", "\n", "\n", "hashtags", "=", "features", "[", "all_features_to_idx", "[", "'hashtags'", "]", "]", ".", "split", "(", ")", "\n", "key_hashtags", "=", "[", "sipHash64", "(", "f'{h}_{enaging_user_id}'", ")", "for", "h", "in", "hashtags", "]", "\n", "\n", "language", "=", "features", "[", "all_features_to_idx", "[", "'language'", "]", "]", "\n", "key_language", "=", "sipHash64", "(", "f'{language}_{enaging_user_id}'", ")", "\n", "\n", "engaged_with_user_id", "=", "sipHash64", "(", "engaged_with_user_id", ")", "\n", "enaging_user_id", "=", "sipHash64", "(", "enaging_user_id", ")", "\n", "\n", "if", "features", "[", "labels_to_idx", "[", "f'like_timestamp'", "]", "]", "!=", "''", ":", "\n", "        ", "increase_reaction", "(", "'like'", ",", "key", ",", "engaged_with_user_id", ",", "enaging_user_id", ",", "key_hashtags", ",", "key_language", ")", "\n", "twit_positive", "[", "'like'", "]", "[", "tweet_id", "]", "+=", "1", "\n", "\n", "", "if", "features", "[", "labels_to_idx", "[", "f'reply_timestamp'", "]", "]", "!=", "''", ":", "\n", "        ", "increase_reaction", "(", "'reply'", ",", "key", ",", "engaged_with_user_id", ",", "enaging_user_id", ",", "key_hashtags", ",", "key_language", ")", "\n", "twit_positive", "[", "'reply'", "]", "[", "tweet_id", "]", "+=", "1", "\n", "\n", "", "if", "features", "[", "labels_to_idx", "[", "f'retweet_timestamp'", "]", "]", "!=", "''", ":", "\n", "        ", "increase_reaction", "(", "'retweet'", ",", "key", ",", "engaged_with_user_id", ",", "enaging_user_id", ",", "key_hashtags", ",", "key_language", ")", "\n", "twit_positive", "[", "'retweet'", "]", "[", "tweet_id", "]", "+=", "1", "\n", "\n", "", "if", "features", "[", "labels_to_idx", "[", "f'retweet_with_comment_timestamp'", "]", "]", "!=", "''", ":", "\n", "        ", "increase_reaction", "(", "'retweet_with_comment'", ",", "key", ",", "engaged_with_user_id", ",", "enaging_user_id", ",", "key_hashtags", ",", "key_language", ")", "\n", "twit_positive", "[", "'retweet_with_comment'", "]", "[", "tweet_id", "]", "+=", "1", "\n", "\n", "", "if", "features", "[", "labels_to_idx", "[", "f'like_timestamp'", "]", "]", "==", "''", "and", "features", "[", "labels_to_idx", "[", "f'reply_timestamp'", "]", "]", "==", "''", "and", "features", "[", "labels_to_idx", "[", "f'retweet_timestamp'", "]", "]", "==", "''", "and", "features", "[", "labels_to_idx", "[", "f'retweet_with_comment_timestamp'", "]", "]", "==", "''", ":", "\n", "\n", "        ", "interaction_counter_all_negative", "[", "key", "]", "+=", "1", "\n", "num_enaged_all_negative", "[", "engaged_with_user_id", "]", "+=", "1", "\n", "num_enaging_all_negative", "[", "enaging_user_id", "]", "+=", "1", "\n", "twit_negative", "[", "tweet_id", "]", "+=", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.utils.update_interactions_datapoint": [[82, 168], ["line.split", "sipHash64.sipHash64", "sipHash64.sipHash64", "features[].split", "sipHash64.sipHash64", "sipHash64.sipHash64", "sipHash64.sipHash64", "sipHash64.sipHash64"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64"], ["", "", "def", "update_interactions_datapoint", "(", "datapoint", ",", "num_enaged_all", ",", "num_enaging_all", ",", "interaction_counter_all", ",", "interaction_counter_lang_all", ",", "\n", "user_hashtag_all", ",", "twit_positive", ",", "interaction_counter_all_negative", ",", "num_enaged_all_negative", ",", "\n", "num_enaging_all_negative", ",", "twit_negative", ")", ":", "\n", "    ", "line", "=", "datapoint", "[", "'line'", "]", "\n", "features", "=", "line", ".", "split", "(", "\"\\x01\"", ")", "\n", "\n", "tweet_id", "=", "features", "[", "all_features_to_idx", "[", "'tweet_id'", "]", "]", "\n", "\n", "engaged_with_user_id_orig", "=", "features", "[", "all_features_to_idx", "[", "'engaged_with_user_id'", "]", "]", "\n", "enaging_user_id_orig", "=", "features", "[", "all_features_to_idx", "[", "'enaging_user_id'", "]", "]", "\n", "\n", "key", "=", "sipHash64", "(", "f'{engaged_with_user_id_orig}_{enaging_user_id_orig}'", ")", "\n", "key2", "=", "sipHash64", "(", "f'{enaging_user_id_orig}_{engaged_with_user_id_orig}'", ")", "\n", "\n", "hashtags", "=", "features", "[", "all_features_to_idx", "[", "'hashtags'", "]", "]", ".", "split", "(", ")", "\n", "key_hashtags", "=", "[", "sipHash64", "(", "f'{h}_{enaging_user_id_orig}'", ")", "for", "h", "in", "hashtags", "]", "\n", "language", "=", "features", "[", "all_features_to_idx", "[", "'language'", "]", "]", "\n", "key_language", "=", "sipHash64", "(", "f'{language}_{enaging_user_id_orig}'", ")", "\n", "\n", "engaged_with_user_id", "=", "sipHash64", "(", "engaged_with_user_id_orig", ")", "\n", "enaging_user_id", "=", "sipHash64", "(", "enaging_user_id_orig", ")", "\n", "\n", "num_enaged_like", "=", "num_enaged_all", "[", "'like'", "]", "[", "engaged_with_user_id", "]", "\n", "num_enaged_reply", "=", "num_enaged_all", "[", "'reply'", "]", "[", "engaged_with_user_id", "]", "\n", "num_enaged_retweet", "=", "num_enaged_all", "[", "'retweet'", "]", "[", "engaged_with_user_id", "]", "\n", "num_enaged_retweet_with_comment", "=", "num_enaged_all", "[", "'retweet_with_comment'", "]", "[", "engaged_with_user_id", "]", "\n", "\n", "\n", "num_enaging_like", "=", "num_enaging_all", "[", "'like'", "]", "[", "enaging_user_id", "]", "\n", "num_enaging_reply", "=", "num_enaging_all", "[", "'reply'", "]", "[", "enaging_user_id", "]", "\n", "num_enaging_retweet", "=", "num_enaging_all", "[", "'retweet'", "]", "[", "enaging_user_id", "]", "\n", "num_enaging_retweet_with_comment", "=", "num_enaging_all", "[", "'retweet_with_comment'", "]", "[", "enaging_user_id", "]", "\n", "\n", "interaction_users_like", "=", "interaction_counter_all", "[", "'like'", "]", "[", "key", "]", "\n", "interaction_users_reply", "=", "interaction_counter_all", "[", "'reply'", "]", "[", "key", "]", "\n", "interaction_users_retweet", "=", "interaction_counter_all", "[", "'retweet'", "]", "[", "key", "]", "\n", "interaction_users_retweet_with_comment", "=", "interaction_counter_all", "[", "'retweet_with_comment'", "]", "[", "key", "]", "\n", "\n", "num_enaged_like_reverse", "=", "num_enaged_all", "[", "'like'", "]", "[", "enaging_user_id", "]", "\n", "num_enaged_reply_reverse", "=", "num_enaged_all", "[", "'reply'", "]", "[", "enaging_user_id", "]", "\n", "num_enaged_retweet_reverse", "=", "num_enaged_all", "[", "'retweet'", "]", "[", "enaging_user_id", "]", "\n", "num_enaged_retweet_with_comment_reverse", "=", "num_enaged_all", "[", "'retweet_with_comment'", "]", "[", "enaging_user_id", "]", "\n", "\n", "\n", "num_enaging_like_reverse", "=", "num_enaging_all", "[", "'like'", "]", "[", "engaged_with_user_id", "]", "\n", "num_enaging_reply_reverse", "=", "num_enaging_all", "[", "'reply'", "]", "[", "engaged_with_user_id", "]", "\n", "num_enaging_retweet_reverse", "=", "num_enaging_all", "[", "'retweet'", "]", "[", "engaged_with_user_id", "]", "\n", "num_enaging_retweet_with_comment_reverse", "=", "num_enaging_all", "[", "'retweet_with_comment'", "]", "[", "engaged_with_user_id", "]", "\n", "\n", "interaction_users_like_reverse", "=", "interaction_counter_all", "[", "'like'", "]", "[", "key2", "]", "\n", "interaction_users_reply_reverse", "=", "interaction_counter_all", "[", "'reply'", "]", "[", "key2", "]", "\n", "interaction_users_retweet_reverse", "=", "interaction_counter_all", "[", "'retweet'", "]", "[", "key2", "]", "\n", "interaction_users_retweet_with_comment_reverse", "=", "interaction_counter_all", "[", "'retweet_with_comment'", "]", "[", "key2", "]", "\n", "\n", "\n", "interaction_counter_lang_like", "=", "interaction_counter_lang_all", "[", "'like'", "]", "[", "key_language", "]", "\n", "interaction_counter_lang_reply", "=", "interaction_counter_lang_all", "[", "'reply'", "]", "[", "key_language", "]", "\n", "interaction_counter_lang_retweet", "=", "interaction_counter_lang_all", "[", "'retweet'", "]", "[", "key_language", "]", "\n", "interaction_counter_lang_retweet_with_comment", "=", "interaction_counter_lang_all", "[", "'retweet_with_comment'", "]", "[", "key_language", "]", "\n", "user_hashtag_like", "=", "0", "\n", "user_hashtag_reply", "=", "0", "\n", "user_hashtag_retweet", "=", "0", "\n", "user_hashtag_retweet_with_comment", "=", "0", "\n", "for", "key_hashtag_current", "in", "key_hashtags", ":", "\n", "        ", "user_hashtag_like", "+=", "user_hashtag_all", "[", "'like'", "]", "[", "key_hashtag_current", "]", "\n", "user_hashtag_reply", "+=", "user_hashtag_all", "[", "'reply'", "]", "[", "key_hashtag_current", "]", "\n", "user_hashtag_retweet", "+=", "user_hashtag_all", "[", "'retweet'", "]", "[", "key_hashtag_current", "]", "\n", "user_hashtag_retweet_with_comment", "+=", "user_hashtag_all", "[", "'retweet_with_comment'", "]", "[", "key_hashtag_current", "]", "\n", "\n", "\n", "", "interactions_valid", "=", "[", "interaction_users_like", ",", "interaction_users_reply", ",", "interaction_users_retweet", ",", "interaction_users_retweet_with_comment", ",", "\n", "num_enaged_like", ",", "num_enaged_reply", ",", "num_enaged_retweet", ",", "num_enaged_retweet_with_comment", ",", "\n", "num_enaging_like", ",", "num_enaging_reply", ",", "num_enaging_retweet", ",", "num_enaging_retweet_with_comment", ",", "\n", "interaction_counter_lang_like", ",", "interaction_counter_lang_reply", ",", "interaction_counter_lang_retweet", ",", "interaction_counter_lang_retweet_with_comment", ",", "\n", "user_hashtag_like", ",", "user_hashtag_reply", ",", "user_hashtag_retweet", ",", "user_hashtag_retweet_with_comment", ",", "\n", "twit_positive", "[", "'like'", "]", "[", "tweet_id", "]", ",", "twit_positive", "[", "'reply'", "]", "[", "tweet_id", "]", ",", "\n", "twit_positive", "[", "'retweet'", "]", "[", "tweet_id", "]", ",", "twit_positive", "[", "'retweet_with_comment'", "]", "[", "tweet_id", "]", "\n", "]", "\n", "\n", "interactions_valid_negatives", "=", "[", "interaction_users_like_reverse", ",", "interaction_users_reply_reverse", ",", "interaction_users_retweet_reverse", ",", "interaction_users_retweet_with_comment_reverse", ",", "\n", "num_enaged_like_reverse", ",", "num_enaged_reply_reverse", ",", "num_enaged_retweet_reverse", ",", "num_enaged_retweet_with_comment_reverse", ",", "\n", "num_enaging_like_reverse", ",", "num_enaging_reply_reverse", ",", "num_enaging_retweet_reverse", ",", "num_enaging_retweet_with_comment_reverse", ",", "\n", "interaction_counter_all_negative", "[", "key", "]", ",", "num_enaged_all_negative", "[", "engaged_with_user_id", "]", ",", "num_enaging_all_negative", "[", "enaging_user_id", "]", ",", "\n", "twit_negative", "[", "tweet_id", "]", "\n", "]", "\n", "return", "interactions_valid", ",", "interactions_valid_negatives", "", "", ""]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.add_validation_interactions_to_training.get_parser": [[12, 16], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument"], "function", ["None"], ["def", "get_parser", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n", "parser", ".", "add_argument", "(", "\"--config-file\"", ",", "type", "=", "str", ",", "default", "=", "'config.yaml'", ",", "help", "=", "'Configuration file.'", ")", "\n", "return", "parser", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.add_validation_interactions_to_training.add_validation_interactions": [[18, 71], ["log.info", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "os.path.join", "os.path.join", "log.info", "enumerate", "os.listdir", "open", "pickle.load", "utils.update_interactions_datapoint", "open", "pickle.dump"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.utils.update_interactions_datapoint"], ["", "def", "add_validation_interactions", "(", "config", ")", ":", "\n", "    ", "log", ".", "info", "(", "\"Adding validation interactions to training data\"", ")", "\n", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_interaction_counter_all\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "interaction_counter_all", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_num_enaged_all\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "num_enaged_all", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_num_enaging_all\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "num_enaging_all", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_user_hashtag_all\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "user_hashtag_all", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_interaction_counter_lang_all\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "interaction_counter_lang_all", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_twit_positive\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "twit_positive", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_interaction_counter_all_NOT\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "interaction_counter_all_negative", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_num_enaged_all_NOT\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "num_enaged_all_negative", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_num_enaging_all_NOT\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "num_enaging_all_negative", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_twit_negative\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "twit_negative", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "\n", "", "filenames", "=", "[", "os", ".", "path", ".", "join", "(", "config", "[", "'working_dir'", "]", ",", "'validation_split_holdout'", ")", "]", "\n", "filenames", "+=", "[", "os", ".", "path", ".", "join", "(", "config", "[", "'working_dir'", "]", ",", "f", ")", "for", "f", "in", "os", ".", "listdir", "(", "config", "[", "'working_dir'", "]", ")", "if", "'train_set_all'", "in", "f", "]", "\n", "for", "filename", "in", "filenames", ":", "\n", "        ", "log", ".", "info", "(", "f\"Processing {filename}\"", ")", "\n", "\n", "# loading data from current day", "\n", "with", "open", "(", "filename", ",", "'rb'", ")", "as", "handle", ":", "\n", "            ", "train_day", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "for", "i", ",", "example", "in", "enumerate", "(", "train_day", ")", ":", "\n", "            ", "interactions_valid", ",", "interactions_valid_negatives", "=", "update_interactions_datapoint", "(", "example", ",", "num_enaged_all", ",", "num_enaging_all", ",", "interaction_counter_all", ",", "interaction_counter_lang_all", ",", "\n", "user_hashtag_all", ",", "twit_positive", ",", "interaction_counter_all_negative", ",", "num_enaged_all_negative", ",", "\n", "num_enaging_all_negative", ",", "twit_negative", ")", "\n", "\n", "train_day", "[", "i", "]", "[", "'interactions_valid'", "]", "=", "interactions_valid", "\n", "\n", "train_day", "[", "i", "]", "[", "'interactions_valid_negatives'", "]", "=", "interactions_valid_negatives", "\n", "\n", "", "with", "open", "(", "filename", ",", "'wb'", ")", "as", "handle", ":", "\n", "            ", "pickle", ".", "dump", "(", "train_day", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.get_parser": [[23, 27], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument"], "function", ["None"], ["def", "get_parser", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n", "parser", ".", "add_argument", "(", "\"--config-file\"", ",", "type", "=", "str", ",", "default", "=", "'config.yaml'", ",", "help", "=", "'Configuration file.'", ")", "\n", "return", "parser", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split": [[29, 54], ["set", "set", "enumerate", "collections.defaultdict", "collections.defaultdict.keys", "log.info", "set.add", "open", "open", "pickle.dump", "line.strip.strip", "line.strip.split", "set.add", "int", "any", "train_set[].append", "int", "max", "key.strftime", "int", "datetime.datetime.utcfromtimestamp().date", "list", "list", "read_dataset_utils.labels_to_idx.values", "read_dataset_utils.labels_to_idx.values", "datetime.datetime.utcfromtimestamp"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split"], ["", "def", "split", "(", "config", ":", "dict", ",", "parts_filenames_chunks", ":", "List", "[", "List", "[", "str", "]", "]", ")", ":", "\n", "    ", "all_languages", "=", "set", "(", ")", "\n", "days", "=", "set", "(", ")", "\n", "for", "chunk_idx", ",", "filenames", "in", "enumerate", "(", "parts_filenames_chunks", ")", ":", "\n", "        ", "train_set", "=", "defaultdict", "(", "list", ")", "\n", "for", "filename", "in", "filenames", ":", "\n", "            ", "log", ".", "info", "(", "f'Processing {filename}'", ")", "\n", "with", "open", "(", "filename", ",", "encoding", "=", "\"utf-8\"", ")", "as", "f", ":", "\n", "                ", "for", "line", "in", "f", ":", "\n", "                    ", "line", "=", "line", ".", "strip", "(", ")", "\n", "features", "=", "line", ".", "split", "(", "\"\\x01\"", ")", "\n", "all_languages", ".", "add", "(", "features", "[", "all_features_to_idx", "[", "'language'", "]", "]", ")", "\n", "timestamp", "=", "int", "(", "features", "[", "all_features_to_idx", "[", "'tweet_timestamp'", "]", "]", ")", "\n", "if", "any", "(", "t", "!=", "''", "for", "t", "in", "[", "features", "[", "f", "]", "for", "f", "in", "list", "(", "labels_to_idx", ".", "values", "(", ")", ")", "]", ")", ":", "\n", "                        ", "reaction_timestamp", "=", "int", "(", "max", "(", "[", "int", "(", "features", "[", "f", "]", ")", "for", "f", "in", "list", "(", "labels_to_idx", ".", "values", "(", ")", ")", "if", "features", "[", "f", "]", "!=", "''", "]", ")", ")", "\n", "timestamp", "=", "reaction_timestamp", "\n", "\n", "", "train_set", "[", "datetime", ".", "utcfromtimestamp", "(", "timestamp", ")", ".", "date", "(", ")", "]", ".", "append", "(", "{", "'line'", ":", "line", ",", "'timestamp'", ":", "timestamp", "}", ")", "\n", "\n", "", "", "", "for", "key", "in", "train_set", ".", "keys", "(", ")", ":", "\n", "            ", "days", ".", "add", "(", "key", ")", "\n", "with", "open", "(", "f\"\"\"{config['working_dir']}/train_set_{chunk_idx}_{key.strftime('%d-%m-%y')}\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "                ", "pickle", ".", "dump", "(", "train_set", "[", "key", "]", ",", "handle", ",", "\n", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "", "", "", "return", "all_languages", ",", "days", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.merge": [[56, 67], ["log.info", "range", "len", "os.remove", "open", "pickle.dump", "open", "pickle.load", "day.strftime", "day.strftime"], "function", ["None"], ["", "def", "merge", "(", "config", ":", "dict", ",", "days", ":", "set", ",", "parts_filenames_chunks", ":", "List", "[", "List", "[", "str", "]", "]", ")", ":", "\n", "    ", "for", "day", "in", "days", ":", "\n", "        ", "log", ".", "info", "(", "f\"Merging date: {day}\"", ")", "\n", "train_day_all", "=", "[", "]", "\n", "for", "chunk_idx", "in", "range", "(", "len", "(", "parts_filenames_chunks", ")", ")", ":", "\n", "            ", "chunk_filename", "=", "f\"\"\"{config['working_dir']}/train_set_{chunk_idx}_{day.strftime('%d-%m-%y')}\"\"\"", "\n", "with", "open", "(", "chunk_filename", ",", "'rb'", ")", "as", "handle", ":", "\n", "                ", "train_day_all", "+=", "pickle", ".", "load", "(", "handle", ")", "\n", "", "os", ".", "remove", "(", "chunk_filename", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/train_set_all_{day.strftime('%d-%m-%y')}\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "            ", "pickle", ".", "dump", "(", "train_day_all", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split_training_parts": [[69, 82], ["os.makedirs", "log.info", "split_by_date.split", "split_by_date.merge", "open", "pickle.dump", "os.path.join", "range", "enumerate", "os.listdir", "len", "math.ceil", "len"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.merge"], ["", "", "", "def", "split_training_parts", "(", "config", ":", "dict", ")", ":", "\n", "    ", "os", ".", "makedirs", "(", "config", "[", "'working_dir'", "]", ",", "exist_ok", "=", "True", ")", "\n", "\n", "part_files", "=", "[", "os", ".", "path", ".", "join", "(", "config", "[", "'recsys_data'", "]", ",", "f", ")", "for", "f", "in", "os", ".", "listdir", "(", "config", "[", "'recsys_data'", "]", ")", "if", "'part'", "in", "f", "]", "[", ":", "config", "[", "'max_n_parts'", "]", "]", "\n", "log", ".", "info", "(", "f\"Number of used training parts: {len(part_files)}\"", ")", "\n", "\n", "parts_filenames_chunks", "=", "[", "part_files", "[", "i", "*", "config", "[", "'max_n_parts_in_memory'", "]", ":", "(", "i", "+", "1", ")", "*", "config", "[", "'max_n_parts_in_memory'", "]", "]", "for", "i", "in", "range", "(", "math", ".", "ceil", "(", "len", "(", "part_files", ")", "/", "config", "[", "'max_n_parts_in_memory'", "]", ")", ")", "]", "\n", "all_languages", ",", "days", "=", "split", "(", "config", ",", "parts_filenames_chunks", ")", "\n", "merge", "(", "config", ",", "days", ",", "parts_filenames_chunks", ")", "\n", "\n", "language2id", "=", "{", "l", ":", "i", "for", "i", ",", "l", "in", "enumerate", "(", "all_languages", ")", "}", "\n", "with", "open", "(", "f\"{config['working_dir']}/language2id\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "language2id", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.add_training_interactions_to_valid.get_parser": [[14, 18], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument"], "function", ["None"], ["def", "get_parser", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n", "parser", ".", "add_argument", "(", "\"--config-file\"", ",", "type", "=", "str", ",", "default", "=", "'config.yaml'", ",", "help", "=", "'Configuration file.'", ")", "\n", "return", "parser", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.add_training_interactions_to_valid.get_training_interactions": [[20, 78], ["line.split", "sipHash64.sipHash64", "features[].split", "sipHash64.sipHash64", "sipHash64.sipHash64", "sipHash64.sipHash64", "utils.get_similar_interactions", "sipHash64.sipHash64"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.utils.get_similar_interactions", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64"], ["", "def", "get_training_interactions", "(", "line", ",", "interaction_users", ",", "num_enaged", ",", "num_enaging", ",", "interaction_counter_lang", ",", "user_hashtag", ",", "auth2similar_followers", ")", ":", "\n", "    ", "features", "=", "line", ".", "split", "(", "\"\\x01\"", ")", "\n", "\n", "engaged_with_user_id_orig", "=", "features", "[", "all_features_to_idx", "[", "'engaged_with_user_id'", "]", "]", "\n", "enaging_user_id_orig", "=", "features", "[", "all_features_to_idx", "[", "'enaging_user_id'", "]", "]", "\n", "key", "=", "sipHash64", "(", "f'{engaged_with_user_id_orig}_{enaging_user_id_orig}'", ")", "\n", "\n", "hashtags", "=", "features", "[", "all_features_to_idx", "[", "'hashtags'", "]", "]", ".", "split", "(", ")", "\n", "key_hashtags", "=", "[", "sipHash64", "(", "f'{h}_{enaging_user_id_orig}'", ")", "for", "h", "in", "hashtags", "]", "\n", "language", "=", "features", "[", "all_features_to_idx", "[", "'language'", "]", "]", "\n", "key_language", "=", "sipHash64", "(", "f'{language}_{enaging_user_id_orig}'", ")", "\n", "\n", "\n", "engaged_with_user_id", "=", "sipHash64", "(", "engaged_with_user_id_orig", ")", "\n", "enaging_user_id", "=", "sipHash64", "(", "enaging_user_id_orig", ")", "\n", "\n", "\n", "interaction_counter_lang_like", "=", "interaction_counter_lang", "[", "'like'", "]", "[", "key_language", "]", "\n", "interaction_counter_lang_reply", "=", "interaction_counter_lang", "[", "'reply'", "]", "[", "key_language", "]", "\n", "interaction_counter_lang_retweet", "=", "interaction_counter_lang", "[", "'retweet'", "]", "[", "key_language", "]", "\n", "interaction_counter_lang_retweet_with_comment", "=", "interaction_counter_lang", "[", "'retweet_with_comment'", "]", "[", "key_language", "]", "\n", "\n", "user_hashtag_like", "=", "0", "\n", "user_hashtag_reply", "=", "0", "\n", "user_hashtag_retweet", "=", "0", "\n", "user_hashtag_retweet_with_comment", "=", "0", "\n", "\n", "for", "key_hashtag_current", "in", "key_hashtags", ":", "\n", "        ", "user_hashtag_like", "+=", "user_hashtag", "[", "'like'", "]", "[", "key_hashtag_current", "]", "\n", "user_hashtag_reply", "+=", "user_hashtag", "[", "'reply'", "]", "[", "key_hashtag_current", "]", "\n", "user_hashtag_retweet", "+=", "user_hashtag", "[", "'retweet'", "]", "[", "key_hashtag_current", "]", "\n", "user_hashtag_retweet_with_comment", "+=", "user_hashtag", "[", "'retweet_with_comment'", "]", "[", "key_hashtag_current", "]", "\n", "\n", "\n", "", "similar_followers", "=", "get_similar_interactions", "(", "auth2similar_followers", ",", "engaged_with_user_id_orig", ",", "enaging_user_id_orig", ",", "interaction_users", ")", "\n", "\n", "\n", "interactions", "=", "[", "interaction_users", "[", "'like'", "]", "[", "key", "]", ",", "\n", "interaction_users", "[", "'reply'", "]", "[", "key", "]", ",", "\n", "interaction_users", "[", "'retweet'", "]", "[", "key", "]", ",", "\n", "interaction_users", "[", "'retweet_with_comment'", "]", "[", "key", "]", ",", "\n", "num_enaged", "[", "'like'", "]", "[", "engaged_with_user_id", "]", ",", "\n", "num_enaged", "[", "'reply'", "]", "[", "engaged_with_user_id", "]", ",", "\n", "num_enaged", "[", "'retweet'", "]", "[", "engaged_with_user_id", "]", ",", "\n", "num_enaged", "[", "'retweet_with_comment'", "]", "[", "engaged_with_user_id", "]", ",", "\n", "num_enaging", "[", "'like'", "]", "[", "enaging_user_id", "]", ",", "\n", "num_enaging", "[", "'reply'", "]", "[", "enaging_user_id", "]", ",", "\n", "num_enaging", "[", "'retweet'", "]", "[", "enaging_user_id", "]", ",", "\n", "num_enaging", "[", "'retweet_with_comment'", "]", "[", "enaging_user_id", "]", ",", "\n", "interaction_counter_lang_like", ",", "\n", "interaction_counter_lang_reply", ",", "\n", "interaction_counter_lang_retweet", ",", "\n", "interaction_counter_lang_retweet_with_comment", ",", "\n", "user_hashtag_like", ",", "\n", "user_hashtag_reply", ",", "\n", "user_hashtag_retweet", ",", "\n", "user_hashtag_retweet_with_comment", "]", "+", "similar_followers", "\n", "return", "interactions", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.add_training_interactions_to_valid.add_interactions": [[80, 123], ["log.info", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "open", "open", "pickle.dump", "open", "open", "pickle.dump", "os.path.join", "line.strip.strip", "add_training_interactions_to_valid.get_training_interactions", "data.append", "os.path.join", "line.strip.strip", "add_training_interactions_to_valid.get_training_interactions", "data.append"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.add_training_interactions_to_valid.get_training_interactions", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.add_training_interactions_to_valid.get_training_interactions"], ["", "def", "add_interactions", "(", "config", ")", ":", "\n", "    ", "log", ".", "info", "(", "\"Adding training interactions to valid\"", ")", "\n", "with", "open", "(", "f\"\"\"{config['working_dir']}/author2similar_follow.pkl\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "auth2similar_followers", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/interaction_users\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "interaction_users", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/num_enaging\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "num_enaging", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/num_enaged\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "num_enaged", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/interaction_counter_lang\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "interaction_counter_lang", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/user_hashtag\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "user_hashtag", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "data", "=", "[", "]", "\n", "\n", "with", "open", "(", "os", ".", "path", ".", "join", "(", "config", "[", "'working_dir'", "]", ",", "'validation_for_training'", ")", ",", "encoding", "=", "\"utf-8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "line", "=", "line", ".", "strip", "(", ")", "\n", "interactions", "=", "get_training_interactions", "(", "line", ",", "interaction_users", ",", "num_enaged", ",", "num_enaging", ",", "interaction_counter_lang", ",", "user_hashtag", ",", "auth2similar_followers", ")", "\n", "data", ".", "append", "(", "{", "'line'", ":", "line", ",", "\n", "'interactions'", ":", "interactions", "}", ")", "\n", "", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_split_train_with_interactions\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "data", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n", "\n", "", "data", "=", "[", "]", "\n", "\n", "with", "open", "(", "os", ".", "path", ".", "join", "(", "config", "[", "'working_dir'", "]", ",", "'validation_holdout'", ")", ",", "encoding", "=", "\"utf-8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "line", "=", "line", ".", "strip", "(", ")", "\n", "interactions", "=", "get_training_interactions", "(", "line", ",", "interaction_users", ",", "num_enaged", ",", "num_enaging", ",", "interaction_counter_lang", ",", "user_hashtag", ",", "auth2similar_followers", ")", "\n", "data", ".", "append", "(", "{", "'line'", ":", "line", ",", "\n", "'interactions'", ":", "interactions", "}", ")", "\n", "\n", "", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_split_holdout\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "data", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.compute_validation_interactions.get_parser": [[13, 17], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument"], "function", ["None"], ["def", "get_parser", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n", "parser", ".", "add_argument", "(", "\"--config-file\"", ",", "type", "=", "str", ",", "default", "=", "'config.yaml'", ",", "help", "=", "'Configuration file.'", ")", "\n", "return", "parser", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.compute_validation_interactions.compute_validation_interactions": [[19, 63], ["log.info", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "open", "pickle.load", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "utils.compute_validation_interactions_datapoint", "open", "pickle.dump", "open", "pickle.dump", "open", "pickle.dump", "open", "pickle.dump", "open", "pickle.dump", "open", "pickle.dump", "open", "pickle.dump", "open", "pickle.dump", "open", "pickle.dump", "open", "pickle.dump"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.utils.compute_validation_interactions_datapoint"], ["", "def", "compute_validation_interactions", "(", "config", ")", ":", "\n", "    ", "log", ".", "info", "(", "\"Computting validation interactions\"", ")", "\n", "\n", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_split_train_with_interactions\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "valid_set_for_training", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "interaction_counter_all", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "num_enaged_all", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "num_enaging_all", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "user_hashtag_all", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "interaction_counter_lang_all", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "twit_positive", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "\n", "interaction_counter_all_negative", "=", "Counter", "(", ")", "\n", "num_enaged_all_negative", "=", "Counter", "(", ")", "\n", "num_enaging_all_negative", "=", "Counter", "(", ")", "\n", "twit_negative", "=", "Counter", "(", ")", "\n", "\n", "for", "example", "in", "valid_set_for_training", ":", "\n", "        ", "compute_validation_interactions_datapoint", "(", "example", ",", "interaction_counter_all", ",", "num_enaged_all", ",", "num_enaging_all", ",", "user_hashtag_all", ",", "\n", "interaction_counter_lang_all", ",", "twit_positive", ",", "interaction_counter_all_negative", ",", "\n", "num_enaged_all_negative", ",", "num_enaging_all_negative", ",", "twit_negative", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_interaction_counter_all\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "interaction_counter_all", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_num_enaged_all\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "num_enaged_all", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_num_enaging_all\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "num_enaging_all", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_user_hashtag_all\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "user_hashtag_all", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_interaction_counter_lang_all\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "interaction_counter_lang_all", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_twit_positive\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "twit_positive", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_interaction_counter_all_NOT\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "interaction_counter_all_negative", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_num_enaged_all_NOT\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "num_enaged_all_negative", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_num_enaging_all_NOT\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "num_enaging_all_negative", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_twit_negative\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "twit_negative", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.valid_interactions_per_chunk.get_parser": [[13, 18], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument"], "function", ["None"], ["def", "get_parser", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n", "parser", ".", "add_argument", "(", "\"--config-file\"", ",", "type", "=", "str", ",", "default", "=", "'config.yaml'", ",", "help", "=", "'Configuration file.'", ")", "\n", "# parser.add_argument(\"--num-chunks\", type=str, default='config.yaml', help='Number of validation chunks.')", "\n", "return", "parser", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.valid_interactions_per_chunk.add_interactions_per_chunk": [[20, 63], ["log.info", "range", "open", "pickle.load", "log.info", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "range", "range", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "len", "len", "open", "pickle.dump", "sipHash64.sipHash64", "utils.compute_validation_interactions_datapoint", "sipHash64.sipHash64", "utils.update_interactions_datapoint", "valid_for_training_with_valid_interactions.append", "str", "str"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.utils.compute_validation_interactions_datapoint", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.utils.update_interactions_datapoint"], ["", "def", "add_interactions_per_chunk", "(", "config", ")", ":", "\n", "    ", "log", ".", "info", "(", "\"Processing validation chunks\"", ")", "\n", "with", "open", "(", "f\"\"\"{config['working_dir']}/validation_split_train_with_interactions\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "valid_set_for_training", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "for", "fake_day_training", "in", "range", "(", "config", "[", "'num_validation_chunks'", "]", ")", ":", "\n", "        ", "log", ".", "info", "(", "f\"Processing chunk id: {fake_day_training}\"", ")", "\n", "interaction_counter_all", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "num_enaged_all", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "num_enaging_all", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "user_hashtag_all", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "interaction_counter_lang_all", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "twit_positive", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "\n", "twit_negative", "=", "Counter", "(", ")", "\n", "interaction_counter_all_negative", "=", "Counter", "(", ")", "\n", "num_enaged_all_negative", "=", "Counter", "(", ")", "\n", "num_enaging_all_negative", "=", "Counter", "(", ")", "\n", "\n", "for", "line_idx", "in", "range", "(", "len", "(", "valid_set_for_training", ")", ")", ":", "\n", "            ", "fake_day", "=", "sipHash64", "(", "str", "(", "line_idx", ")", ")", "%", "config", "[", "'num_validation_chunks'", "]", "\n", "if", "fake_day", "!=", "fake_day_training", ":", "\n", "                ", "compute_validation_interactions_datapoint", "(", "valid_set_for_training", "[", "line_idx", "]", ",", "interaction_counter_all", ",", "num_enaged_all", ",", "num_enaging_all", ",", "user_hashtag_all", ",", "\n", "interaction_counter_lang_all", ",", "twit_positive", ",", "interaction_counter_all_negative", ",", "\n", "num_enaged_all_negative", ",", "num_enaging_all_negative", ",", "twit_negative", ")", "\n", "\n", "\n", "", "", "valid_for_training_with_valid_interactions", "=", "[", "]", "\n", "\n", "for", "line_idx", "in", "range", "(", "len", "(", "valid_set_for_training", ")", ")", ":", "\n", "            ", "fake_day", "=", "sipHash64", "(", "str", "(", "line_idx", ")", ")", "%", "config", "[", "'num_validation_chunks'", "]", "\n", "if", "fake_day", "==", "fake_day_training", ":", "\n", "                ", "interactions_valid", ",", "interactions_valid_negatives", "=", "update_interactions_datapoint", "(", "valid_set_for_training", "[", "line_idx", "]", ",", "num_enaged_all", ",", "num_enaging_all", ",", "interaction_counter_all", ",", "\n", "interaction_counter_lang_all", ",", "user_hashtag_all", ",", "twit_positive", ",", "interaction_counter_all_negative", ",", "\n", "num_enaged_all_negative", ",", "num_enaging_all_negative", ",", "twit_negative", ")", "\n", "\n", "current_example", "=", "valid_set_for_training", "[", "line_idx", "]", "\n", "current_example", "[", "'interactions_valid'", "]", "=", "interactions_valid", "\n", "current_example", "[", "'interactions_valid_negatives'", "]", "=", "interactions_valid_negatives", "\n", "valid_for_training_with_valid_interactions", ".", "append", "(", "current_example", ")", "\n", "\n", "", "", "with", "open", "(", "f\"{config['working_dir']}/validation_train_with_valid_interactions_{fake_day_training}\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "            ", "pickle", ".", "dump", "(", "valid_for_training_with_valid_interactions", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_validation.get_parser": [[11, 15], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument"], "function", ["None"], ["def", "get_parser", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n", "parser", ".", "add_argument", "(", "\"--config-file\"", ",", "type", "=", "str", ",", "default", "=", "'config.yaml'", ",", "help", "=", "'Configuration file.'", ")", "\n", "return", "parser", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_validation.split_validation": [[17, 35], ["log.info", "open", "open", "open", "os.path.join", "f.write", "os.path.join", "f.write", "random.random", "valid_lines.append", "training_lines.append"], "function", ["None"], ["", "def", "split_validation", "(", "config", ")", ":", "\n", "    ", "log", ".", "info", "(", "\"Split validation into training and testing parts\"", ")", "\n", "valid_lines", "=", "[", "]", "\n", "training_lines", "=", "[", "]", "\n", "with", "open", "(", "config", "[", "'validation_part'", "]", ",", "encoding", "=", "\"utf-8\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "if", "random", ".", "random", "(", ")", "<=", "config", "[", "'validation_percentage'", "]", ":", "\n", "                ", "valid_lines", ".", "append", "(", "line", ")", "\n", "", "else", ":", "\n", "                ", "training_lines", ".", "append", "(", "line", ")", "\n", "\n", "", "", "", "with", "open", "(", "os", ".", "path", ".", "join", "(", "config", "[", "'working_dir'", "]", ",", "'validation_for_training'", ")", ",", "'w'", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "training_lines", ":", "\n", "            ", "f", ".", "write", "(", "line", ")", "\n", "\n", "", "", "with", "open", "(", "os", ".", "path", ".", "join", "(", "config", "[", "'working_dir'", "]", ",", "'validation_holdout'", ")", ",", "'w'", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "valid_lines", ":", "\n", "            ", "f", ".", "write", "(", "line", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.authors_similarity.get_parser": [[19, 23], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument"], "function", ["None"], ["def", "get_parser", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n", "parser", ".", "add_argument", "(", "\"--config-file\"", ",", "type", "=", "str", ",", "default", "=", "'config.yaml'", ",", "help", "=", "'Configuration file.'", ")", "\n", "return", "parser", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.authors_similarity.compute_most_similar": [[25, 40], ["log.info", "list", "SetSimilaritySearch.SearchIndex", "collections.defaultdict", "tqdm.tqdm", "authors2followers.keys", "list", "enumerate", "SetSimilaritySearch.SearchIndex.query", "sorted", "authors2followers.values", "auth2similar[].append"], "function", ["None"], ["", "def", "compute_most_similar", "(", "authors2followers", ",", "threshold", ",", "topN", ")", ":", "\n", "    ", "log", ".", "info", "(", "\"Computting authors similarity\"", ")", "\n", "author_list", "=", "list", "(", "authors2followers", ".", "keys", "(", ")", ")", "\n", "index", "=", "SearchIndex", "(", "list", "(", "authors2followers", ".", "values", "(", ")", ")", ",", "similarity_func_name", "=", "\"jaccard\"", ",", "similarity_threshold", "=", "threshold", ")", "\n", "\n", "auth2similar", "=", "defaultdict", "(", "list", ")", "\n", "\n", "for", "idx", ",", "auth", "in", "tqdm", "(", "enumerate", "(", "author_list", ")", ")", ":", "\n", "        ", "most_similar", "=", "index", ".", "query", "(", "authors2followers", "[", "auth", "]", ")", "\n", "most_similar", "=", "sorted", "(", "most_similar", ",", "key", "=", "lambda", "x", ":", "x", "[", "1", "]", ",", "reverse", "=", "True", ")", "\n", "\n", "for", "s", "in", "most_similar", "[", ":", "topN", "]", ":", "\n", "            ", "if", "s", "[", "0", "]", "!=", "idx", ":", "\n", "                ", "auth2similar", "[", "auth", "]", ".", "append", "(", "(", "author_list", "[", "s", "[", "0", "]", "]", ",", "s", "[", "1", "]", ")", ")", "\n", "", "", "", "return", "auth2similar", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.authors_similarity.find_similar_authors": [[42, 68], ["collections.defaultdict", "authors_similarity.compute_most_similar", "os.path.join", "log.info", "range", "open", "pickle.dump", "os.listdir", "open", "pickle.load", "len", "line.split", "auth2follow_all[].add"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.authors_similarity.compute_most_similar", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split"], ["", "def", "find_similar_authors", "(", "config", ")", ":", "\n", "    ", "filenames", "=", "[", "os", ".", "path", ".", "join", "(", "config", "[", "'working_dir'", "]", ",", "f", ")", "for", "f", "in", "os", ".", "listdir", "(", "config", "[", "'working_dir'", "]", ")", "if", "'train_set'", "in", "f", "]", "\n", "\n", "auth2follow_all", "=", "defaultdict", "(", "set", ")", "\n", "\n", "for", "filename", "in", "filenames", ":", "\n", "        ", "log", ".", "info", "(", "f\"Processing {filename}\"", ")", "\n", "with", "open", "(", "filename", ",", "'rb'", ")", "as", "handle", ":", "\n", "            ", "train_day", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "for", "i", "in", "range", "(", "len", "(", "train_day", ")", ")", ":", "\n", "            ", "line", "=", "train_day", "[", "i", "]", "[", "'line'", "]", "\n", "features", "=", "line", ".", "split", "(", "\"\\x01\"", ")", "\n", "\n", "engaged_with_user_id", "=", "features", "[", "all_features_to_idx", "[", "'engaged_with_user_id'", "]", "]", "\n", "enaging_user_id", "=", "features", "[", "all_features_to_idx", "[", "'enaging_user_id'", "]", "]", "\n", "\n", "# users who follow", "\n", "if", "features", "[", "all_features_to_idx", "[", "f'engagee_follows_engager'", "]", "]", "==", "'true'", ":", "\n", "                ", "auth2follow_all", "[", "engaged_with_user_id", "]", ".", "add", "(", "enaging_user_id", ")", "\n", "\n", "\n", "", "", "", "auth2similar_follow", "=", "compute_most_similar", "(", "auth2follow_all", ",", "config", "[", "'authors_similarity_threshold'", "]", ",", "config", "[", "'authors_similarity_top_N'", "]", ")", "\n", "\n", "with", "open", "(", "f\"\"\"{config['working_dir']}/author2similar_follow.pkl\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "auth2similar_follow", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.compute_interactions.get_parser": [[15, 19], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument"], "function", ["None"], ["def", "get_parser", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n", "parser", ".", "add_argument", "(", "\"--config-file\"", ",", "type", "=", "str", ",", "default", "=", "'config.yaml'", ",", "help", "=", "'Configuration file.'", ")", "\n", "return", "parser", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.compute_interactions.process_example": [[21, 40], ["sipHash64.sipHash64", "features[].split", "sipHash64.sipHash64", "sipHash64.sipHash64", "sipHash64.sipHash64", "sipHash64.sipHash64"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.sipHash64.sipHash64"], ["", "def", "process_example", "(", "features", ")", ":", "\n", "    ", "engaged_with_user_id", "=", "features", "[", "all_features_to_idx", "[", "'engaged_with_user_id'", "]", "]", "\n", "enaging_user_id", "=", "features", "[", "all_features_to_idx", "[", "'enaging_user_id'", "]", "]", "\n", "\n", "# compute hash of `engaged_with_user_id` and `enaging_user_id` pairs", "\n", "key", "=", "sipHash64", "(", "f'{engaged_with_user_id}_{enaging_user_id}'", ")", "\n", "\n", "hashtags", "=", "features", "[", "all_features_to_idx", "[", "'hashtags'", "]", "]", ".", "split", "(", ")", "\n", "# compute hash of hashtag and  `enaging_user_id`", "\n", "key_hashtags", "=", "[", "sipHash64", "(", "f'{h}_{enaging_user_id}'", ")", "for", "h", "in", "hashtags", "]", "\n", "\n", "language", "=", "features", "[", "all_features_to_idx", "[", "'language'", "]", "]", "\n", "# compute hash of language and  `enaging_user_id`", "\n", "key_language", "=", "sipHash64", "(", "f'{language}_{enaging_user_id}'", ")", "\n", "\n", "# compute hashes of users", "\n", "engaged_with_user_id", "=", "sipHash64", "(", "engaged_with_user_id", ")", "\n", "enaging_user_id", "=", "sipHash64", "(", "enaging_user_id", ")", "\n", "return", "engaged_with_user_id", ",", "enaging_user_id", ",", "key", ",", "key_hashtags", ",", "key_language", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.compute_interactions.compute_interactions": [[42, 135], ["os.path.join", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "log.info", "open", "pickle.dump", "open", "pickle.dump", "open", "pickle.dump", "open", "pickle.dump", "open", "pickle.dump", "os.listdir", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "open", "pickle.load", "line.split", "compute_interactions.process_example", "filename.split", "open", "pickle.dump", "open", "pickle.dump", "open", "pickle.dump", "open", "pickle.dump", "open", "pickle.dump", "compute_interactions.compute_interactions.increase_reaction"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.compute_interactions.process_example", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split"], ["", "def", "compute_interactions", "(", "config", ")", ":", "\n", "    ", "def", "increase_reaction", "(", "relation", ",", "key", ",", "engaged_with_user_id", ",", "enaging_user_id", ",", "key_hashtags", ",", "key_language", ")", ":", "\n", "        ", "interaction_counter", "[", "relation", "]", "[", "key", "]", "+=", "1", "\n", "num_enaged", "[", "relation", "]", "[", "engaged_with_user_id", "]", "+=", "1", "\n", "num_enaging", "[", "relation", "]", "[", "enaging_user_id", "]", "+=", "1", "\n", "\n", "interaction_counter_all", "[", "relation", "]", "[", "key", "]", "+=", "1", "\n", "num_enaged_all", "[", "relation", "]", "[", "engaged_with_user_id", "]", "+=", "1", "\n", "num_enaging_all", "[", "relation", "]", "[", "enaging_user_id", "]", "+=", "1", "\n", "\n", "for", "key_hashtag_current", "in", "key_hashtags", ":", "\n", "            ", "user_hashtag_all", "[", "relation", "]", "[", "key_hashtag_current", "]", "+=", "1", "\n", "user_hashtag", "[", "relation", "]", "[", "key_hashtag_current", "]", "+=", "1", "\n", "\n", "\n", "", "interaction_counter_lang_all", "[", "relation", "]", "[", "key_language", "]", "+=", "1", "\n", "interaction_counter_lang", "[", "relation", "]", "[", "key_language", "]", "+=", "1", "\n", "\n", "# filenames with training data sepearated by day - calculated in `splt_by_date.py`", "\n", "", "filenames", "=", "[", "os", ".", "path", ".", "join", "(", "config", "[", "'working_dir'", "]", ",", "f", ")", "for", "f", "in", "os", ".", "listdir", "(", "config", "[", "'working_dir'", "]", ")", "if", "'train_set'", "in", "f", "]", "\n", "\n", "# number of all enaged-enaging users interactions per each relation", "\n", "interaction_counter_all", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "\n", "# number of all interactions of enaged users per each relation", "\n", "num_enaged_all", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "\n", "# number of all interactions of enaging users per each relation", "\n", "num_enaging_all", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "\n", "# number of all interactions with hashtags per each relation", "\n", "user_hashtag_all", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "\n", "# number of all interactions of enaging users with twitts from each language", "\n", "interaction_counter_lang_all", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "\n", "\n", "for", "filename", "in", "filenames", ":", "\n", "        ", "log", ".", "info", "(", "f\"Processing {filename}\"", ")", "\n", "# interactions only for data from current day", "\n", "interaction_counter", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "num_enaged", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "num_enaging", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "user_hashtag", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "interaction_counter_lang", "=", "{", "'like'", ":", "Counter", "(", ")", ",", "'reply'", ":", "Counter", "(", ")", ",", "'retweet'", ":", "Counter", "(", ")", ",", "'retweet_with_comment'", ":", "Counter", "(", ")", "}", "\n", "\n", "# loading data from current day", "\n", "with", "open", "(", "filename", ",", "'rb'", ")", "as", "handle", ":", "\n", "            ", "train_day", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "for", "example", "in", "train_day", ":", "\n", "            ", "line", "=", "example", "[", "'line'", "]", "\n", "features", "=", "line", ".", "split", "(", "\"\\x01\"", ")", "\n", "engaged_with_user_id", ",", "enaging_user_id", ",", "key", ",", "key_hashtags", ",", "key_language", "=", "process_example", "(", "features", ")", "\n", "\n", "if", "features", "[", "labels_to_idx", "[", "f'like_timestamp'", "]", "]", "!=", "''", ":", "\n", "                ", "increase_reaction", "(", "'like'", ",", "key", ",", "engaged_with_user_id", ",", "enaging_user_id", ",", "key_hashtags", ",", "key_language", ")", "\n", "\n", "", "if", "features", "[", "labels_to_idx", "[", "f'reply_timestamp'", "]", "]", "!=", "''", ":", "\n", "                ", "increase_reaction", "(", "'reply'", ",", "key", ",", "engaged_with_user_id", ",", "enaging_user_id", ",", "key_hashtags", ",", "key_language", ")", "\n", "\n", "\n", "", "if", "features", "[", "labels_to_idx", "[", "f'retweet_timestamp'", "]", "]", "!=", "''", ":", "\n", "                ", "increase_reaction", "(", "'retweet'", ",", "key", ",", "engaged_with_user_id", ",", "enaging_user_id", ",", "key_hashtags", ",", "key_language", ")", "\n", "\n", "", "if", "features", "[", "labels_to_idx", "[", "f'retweet_with_comment_timestamp'", "]", "]", "!=", "''", ":", "\n", "                ", "increase_reaction", "(", "'retweet_with_comment'", ",", "key", ",", "engaged_with_user_id", ",", "enaging_user_id", ",", "key_hashtags", ",", "key_language", ")", "\n", "\n", "\n", "", "", "file_suffix", "=", "filename", ".", "split", "(", "'_'", ")", "[", "-", "1", "]", "\n", "\n", "with", "open", "(", "f\"\"\"{config['working_dir']}/interaction_users_day_{file_suffix}\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "            ", "pickle", ".", "dump", "(", "interaction_counter", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/num_enaged_day_{file_suffix}\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "            ", "pickle", ".", "dump", "(", "num_enaged", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/num_enaging_day_{file_suffix}\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "            ", "pickle", ".", "dump", "(", "num_enaging", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/user_hashtag_day_{file_suffix}\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "            ", "pickle", ".", "dump", "(", "user_hashtag", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/interaction_counter_lang_day_{file_suffix}\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "            ", "pickle", ".", "dump", "(", "interaction_counter_lang", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n", "\n", "", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/interaction_users\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "interaction_counter_all", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/num_enaging\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "num_enaging_all", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/num_enaged\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "num_enaged_all", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/user_hashtag\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "user_hashtag_all", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/interaction_counter_lang\"\"\"", ",", "'wb'", ")", "as", "handle", ":", "\n", "        ", "pickle", ".", "dump", "(", "interaction_counter_lang_all", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.compute_interactions.save_interactions": [[137, 237], ["log.info", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "os.path.join", "log.info", "enumerate", "os.listdir", "open", "pickle.load", "filename.split", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "open", "pickle.load", "line.split", "compute_interactions.process_example", "utils.get_similar_interactions", "open", "pickle.dump"], "function", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.split_by_date.split", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.preprocessing.compute_interactions.process_example", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.src.utils.get_similar_interactions"], ["", "", "def", "save_interactions", "(", "config", ")", ":", "\n", "    ", "log", ".", "info", "(", "\"Saving interactions\"", ")", "\n", "with", "open", "(", "f\"\"\"{config['working_dir']}/author2similar_follow.pkl\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "auth2similar_followers", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/interaction_users\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "interaction_counter_all", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/num_enaging\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "num_enaging_all", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/num_enaged\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "num_enaged_all", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/interaction_counter_lang\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "        ", "interaction_counter_lang_all", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/user_hashtag\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "            ", "user_hashtag_all", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "filenames", "=", "[", "os", ".", "path", ".", "join", "(", "config", "[", "'working_dir'", "]", ",", "f", ")", "for", "f", "in", "os", ".", "listdir", "(", "config", "[", "'working_dir'", "]", ")", "if", "'train_set_all'", "in", "f", "]", "\n", "for", "filename", "in", "filenames", ":", "\n", "        ", "log", ".", "info", "(", "f\"Processing {filename}\"", ")", "\n", "\n", "# loading data from current day", "\n", "with", "open", "(", "filename", ",", "'rb'", ")", "as", "handle", ":", "\n", "            ", "train_day", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "file_suffix", "=", "filename", ".", "split", "(", "'_'", ")", "[", "-", "1", "]", "\n", "\n", "with", "open", "(", "f\"\"\"{config['working_dir']}/interaction_users_day_{file_suffix}\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "            ", "interaction_counter", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/num_enaged_day_{file_suffix}\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "            ", "num_enaged", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/num_enaging_day_{file_suffix}\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "            ", "num_enaging", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/user_hashtag_day_{file_suffix}\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "            ", "user_hashtag", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "", "with", "open", "(", "f\"\"\"{config['working_dir']}/interaction_counter_lang_day_{file_suffix}\"\"\"", ",", "'rb'", ")", "as", "handle", ":", "\n", "            ", "interaction_counter_lang", "=", "pickle", ".", "load", "(", "handle", ")", "\n", "\n", "", "interactions_without_current_day", "=", "{", "\n", "'like'", ":", "interaction_counter_all", "[", "'like'", "]", "-", "interaction_counter", "[", "'like'", "]", ",", "\n", "'reply'", ":", "interaction_counter_all", "[", "'reply'", "]", "-", "interaction_counter", "[", "'reply'", "]", ",", "\n", "'retweet'", ":", "interaction_counter_all", "[", "'retweet'", "]", "-", "interaction_counter", "[", "'retweet'", "]", ",", "\n", "'retweet_with_comment'", ":", "interaction_counter_all", "[", "'retweet_with_comment'", "]", "-", "interaction_counter", "[", "'retweet_with_comment'", "]", "\n", "}", "\n", "\n", "for", "i", ",", "example", "in", "enumerate", "(", "train_day", ")", ":", "\n", "            ", "line", "=", "example", "[", "'line'", "]", "\n", "features", "=", "line", ".", "split", "(", "\"\\x01\"", ")", "\n", "\n", "engaged_with_user_id_orig", "=", "features", "[", "all_features_to_idx", "[", "'engaged_with_user_id'", "]", "]", "\n", "enaging_user_id_orig", "=", "features", "[", "all_features_to_idx", "[", "'enaging_user_id'", "]", "]", "\n", "\n", "engaged_with_user_id", ",", "enaging_user_id", ",", "key", ",", "key_hashtags", ",", "key_language", "=", "process_example", "(", "features", ")", "\n", "\n", "num_enaged_like", "=", "num_enaged_all", "[", "'like'", "]", "[", "engaged_with_user_id", "]", "-", "num_enaged", "[", "'like'", "]", "[", "engaged_with_user_id", "]", "\n", "num_enaged_reply", "=", "num_enaged_all", "[", "'reply'", "]", "[", "engaged_with_user_id", "]", "-", "num_enaged", "[", "'reply'", "]", "[", "engaged_with_user_id", "]", "\n", "num_enaged_retweet", "=", "num_enaged_all", "[", "'retweet'", "]", "[", "engaged_with_user_id", "]", "-", "num_enaged", "[", "'retweet'", "]", "[", "engaged_with_user_id", "]", "\n", "num_enaged_retweet_with_comment", "=", "num_enaged_all", "[", "'retweet_with_comment'", "]", "[", "engaged_with_user_id", "]", "-", "num_enaged", "[", "'retweet_with_comment'", "]", "[", "engaged_with_user_id", "]", "\n", "\n", "num_enaging_like", "=", "num_enaging_all", "[", "'like'", "]", "[", "enaging_user_id", "]", "-", "num_enaging", "[", "'like'", "]", "[", "enaging_user_id", "]", "\n", "num_enaging_reply", "=", "num_enaging_all", "[", "'reply'", "]", "[", "enaging_user_id", "]", "-", "num_enaging", "[", "'reply'", "]", "[", "enaging_user_id", "]", "\n", "num_enaging_retweet", "=", "num_enaging_all", "[", "'retweet'", "]", "[", "enaging_user_id", "]", "-", "num_enaging", "[", "'retweet'", "]", "[", "enaging_user_id", "]", "\n", "num_enaging_retweet_with_comment", "=", "num_enaging_all", "[", "'retweet_with_comment'", "]", "[", "enaging_user_id", "]", "-", "num_enaging", "[", "'retweet_with_comment'", "]", "[", "enaging_user_id", "]", "\n", "\n", "interaction_users_like", "=", "interactions_without_current_day", "[", "'like'", "]", "[", "key", "]", "\n", "interaction_users_reply", "=", "interactions_without_current_day", "[", "'reply'", "]", "[", "key", "]", "\n", "interaction_users_retweet", "=", "interactions_without_current_day", "[", "'retweet'", "]", "[", "key", "]", "\n", "interaction_users_retweet_with_comment", "=", "interactions_without_current_day", "[", "'retweet_with_comment'", "]", "[", "key", "]", "\n", "\n", "similar_followers", "=", "get_similar_interactions", "(", "auth2similar_followers", ",", "engaged_with_user_id_orig", ",", "enaging_user_id_orig", ",", "interactions_without_current_day", ")", "\n", "\n", "interaction_counter_lang_like", "=", "interaction_counter_lang_all", "[", "'like'", "]", "[", "key_language", "]", "-", "interaction_counter_lang", "[", "'like'", "]", "[", "key_language", "]", "\n", "interaction_counter_lang_reply", "=", "interaction_counter_lang_all", "[", "'reply'", "]", "[", "key_language", "]", "-", "interaction_counter_lang", "[", "'reply'", "]", "[", "key_language", "]", "\n", "interaction_counter_lang_retweet", "=", "interaction_counter_lang_all", "[", "'retweet'", "]", "[", "key_language", "]", "-", "interaction_counter_lang", "[", "'retweet'", "]", "[", "key_language", "]", "\n", "interaction_counter_lang_retweet_with_comment", "=", "interaction_counter_lang_all", "[", "'retweet_with_comment'", "]", "[", "key_language", "]", "-", "interaction_counter_lang", "[", "'retweet_with_comment'", "]", "[", "key_language", "]", "\n", "user_hashtag_like", "=", "0", "\n", "user_hashtag_reply", "=", "0", "\n", "user_hashtag_retweet", "=", "0", "\n", "user_hashtag_retweet_with_comment", "=", "0", "\n", "\n", "for", "key_hashtag_current", "in", "key_hashtags", ":", "\n", "                ", "user_hashtag_like", "+=", "(", "user_hashtag_all", "[", "'like'", "]", "[", "key_hashtag_current", "]", "-", "user_hashtag", "[", "'like'", "]", "[", "key_hashtag_current", "]", ")", "\n", "user_hashtag_reply", "+=", "(", "user_hashtag_all", "[", "'reply'", "]", "[", "key_hashtag_current", "]", "-", "user_hashtag", "[", "'reply'", "]", "[", "key_hashtag_current", "]", ")", "\n", "user_hashtag_retweet", "+=", "(", "user_hashtag_all", "[", "'retweet'", "]", "[", "key_hashtag_current", "]", "-", "user_hashtag", "[", "'retweet'", "]", "[", "key_hashtag_current", "]", ")", "\n", "user_hashtag_retweet_with_comment", "+=", "(", "user_hashtag_all", "[", "'retweet_with_comment'", "]", "[", "key_hashtag_current", "]", "-", "user_hashtag", "[", "'retweet_with_comment'", "]", "[", "key_hashtag_current", "]", ")", "\n", "\n", "\n", "", "train_day", "[", "i", "]", "[", "'interactions'", "]", "=", "[", "interaction_users_like", ",", "interaction_users_reply", ",", "interaction_users_retweet", ",", "interaction_users_retweet_with_comment", ",", "\n", "num_enaged_like", ",", "num_enaged_reply", ",", "num_enaged_retweet", ",", "num_enaged_retweet_with_comment", ",", "\n", "num_enaging_like", ",", "num_enaging_reply", ",", "num_enaging_retweet", ",", "num_enaging_retweet_with_comment", ",", "\n", "interaction_counter_lang_like", ",", "interaction_counter_lang_reply", ",", "interaction_counter_lang_retweet", ",", "interaction_counter_lang_retweet_with_comment", ",", "\n", "user_hashtag_like", ",", "user_hashtag_reply", ",", "user_hashtag_retweet", ",", "user_hashtag_retweet_with_comment", "\n", "]", "+", "similar_followers", "\n", "\n", "", "with", "open", "(", "filename", ",", "'wb'", ")", "as", "handle", ":", "\n", "            ", "pickle", ".", "dump", "(", "train_day", ",", "handle", ",", "protocol", "=", "pickle", ".", "HIGHEST_PROTOCOL", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.model.trainer.Trainer.__init__": [[9, 25], ["pytorch_lightning.LightningModule.__init__", "torch.BCEWithLogitsLoss", "torch.BCEWithLogitsLoss", "pytorch_lightning.metrics.AveragePrecision", "pytorch_lightning.metrics.AveragePrecision", "pytorch_lightning.metrics.AveragePrecision", "pytorch_lightning.metrics.AveragePrecision", "pytorch_lightning.metrics.AveragePrecision", "pytorch_lightning.metrics.AveragePrecision", "pytorch_lightning.metrics.AveragePrecision", "pytorch_lightning.metrics.AveragePrecision"], "methods", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.model.net.Model.__init__"], ["    ", "def", "__init__", "(", "self", ",", "model", ",", "learning_rate", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "model", "=", "model", "\n", "self", ".", "learning_rate", "=", "learning_rate", "\n", "self", ".", "loss", "=", "nn", ".", "BCEWithLogitsLoss", "(", ")", "\n", "self", ".", "train_AP", "=", "{", "\n", "'like'", ":", "AveragePrecision", "(", ")", ",", "\n", "'reply'", ":", "AveragePrecision", "(", ")", ",", "\n", "'retweet'", ":", "AveragePrecision", "(", ")", ",", "\n", "'retweet_with_comment'", ":", "AveragePrecision", "(", ")", "\n", "}", "\n", "self", ".", "val_AP", "=", "{", "\n", "'like'", ":", "AveragePrecision", "(", ")", ",", "\n", "'reply'", ":", "AveragePrecision", "(", ")", ",", "\n", "'retweet'", ":", "AveragePrecision", "(", ")", ",", "\n", "'retweet_with_comment'", ":", "AveragePrecision", "(", ")", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.model.trainer.Trainer.forward": [[27, 29], ["trainer.Trainer.model", "batch[].float"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "batch", ")", ":", "\n", "        ", "return", "self", ".", "model", "(", "batch", "[", "'input'", "]", ".", "float", "(", ")", ",", "batch", "[", "'language'", "]", ",", "batch", "[", "'twitt_hour'", "]", ",", "batch", "[", "'twitt_day'", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.model.trainer.Trainer.training_step": [[30, 39], ["trainer.Trainer.", "trainer.Trainer.loss", "batch[].float", "[].long", "[].long", "[].long", "[].long"], "methods", ["None"], ["", "def", "training_step", "(", "self", ",", "batch", ",", "batch_idx", ")", ":", "\n", "        ", "output", "=", "self", "(", "batch", ")", "\n", "loss", "=", "self", ".", "loss", "(", "output", ",", "batch", "[", "'labels'", "]", ".", "float", "(", ")", ")", "\n", "self", ".", "train_AP", "[", "'like'", "]", "(", "output", "[", ":", ",", "0", "]", ",", "batch", "[", "'labels'", "]", "[", ":", ",", "0", "]", ".", "long", "(", ")", ")", "\n", "self", ".", "train_AP", "[", "'retweet'", "]", "(", "output", "[", ":", ",", "1", "]", ",", "batch", "[", "'labels'", "]", "[", ":", ",", "1", "]", ".", "long", "(", ")", ")", "\n", "self", ".", "train_AP", "[", "'retweet_with_comment'", "]", "(", "output", "[", ":", ",", "2", "]", ",", "batch", "[", "'labels'", "]", "[", ":", ",", "2", "]", ".", "long", "(", ")", ")", "\n", "self", ".", "train_AP", "[", "'reply'", "]", "(", "output", "[", ":", ",", "3", "]", ",", "batch", "[", "'labels'", "]", "[", ":", ",", "3", "]", ".", "long", "(", ")", ")", "\n", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.model.trainer.Trainer.validation_step": [[40, 48], ["trainer.Trainer.", "trainer.Trainer.loss", "batch[].float", "[].long", "[].long", "[].long", "[].long"], "methods", ["None"], ["", "def", "validation_step", "(", "self", ",", "batch", ",", "batch_idx", ":", "int", ")", ":", "\n", "        ", "output", "=", "self", "(", "batch", ")", "\n", "loss", "=", "self", ".", "loss", "(", "output", ",", "batch", "[", "'labels'", "]", ".", "float", "(", ")", ")", "\n", "self", ".", "val_AP", "[", "'like'", "]", "(", "output", "[", ":", ",", "0", "]", ",", "batch", "[", "'labels'", "]", "[", ":", ",", "0", "]", ".", "long", "(", ")", ")", "\n", "self", ".", "val_AP", "[", "'retweet'", "]", "(", "output", "[", ":", ",", "1", "]", ",", "batch", "[", "'labels'", "]", "[", ":", ",", "1", "]", ".", "long", "(", ")", ")", "\n", "self", ".", "val_AP", "[", "'retweet_with_comment'", "]", "(", "output", "[", ":", ",", "2", "]", ",", "batch", "[", "'labels'", "]", "[", ":", ",", "2", "]", ".", "long", "(", ")", ")", "\n", "self", ".", "val_AP", "[", "'reply'", "]", "(", "output", "[", ":", ",", "3", "]", ",", "batch", "[", "'labels'", "]", "[", ":", ",", "3", "]", ".", "long", "(", ")", ")", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.model.trainer.Trainer.test_epoch_end": [[49, 59], ["print", "print", "print", "print", "trainer.Trainer.val_AP[].reset", "trainer.Trainer.val_AP[].reset", "trainer.Trainer.val_AP[].reset", "trainer.Trainer.val_AP[].reset", "trainer.Trainer.val_AP[].compute().item", "trainer.Trainer.val_AP[].compute().item", "trainer.Trainer.val_AP[].compute().item", "trainer.Trainer.val_AP[].compute().item", "trainer.Trainer.val_AP[].compute", "trainer.Trainer.val_AP[].compute", "trainer.Trainer.val_AP[].compute", "trainer.Trainer.val_AP[].compute"], "methods", ["None"], ["", "def", "test_epoch_end", "(", "self", ",", "out", ")", ":", "\n", "        ", "print", "(", "f\"\"\"Validation AP like: {self.val_AP['like'].compute().item()}\"\"\"", ")", "\n", "print", "(", "f\"\"\"Validation AP retweet: {self.val_AP['retweet'].compute().item()}\"\"\"", ")", "\n", "print", "(", "f\"\"\"Validation AP retweet_with_comment: {self.val_AP['retweet_with_comment'].compute().item()}\"\"\"", ")", "\n", "print", "(", "f\"\"\"Validation AP reply: {self.val_AP['reply'].compute().item()}\"\"\"", ")", "\n", "\n", "self", ".", "val_AP", "[", "'like'", "]", ".", "reset", "(", ")", "\n", "self", ".", "val_AP", "[", "'retweet'", "]", ".", "reset", "(", ")", "\n", "self", ".", "val_AP", "[", "'retweet_with_comment'", "]", ".", "reset", "(", ")", "\n", "self", ".", "val_AP", "[", "'reply'", "]", ".", "reset", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.model.trainer.Trainer.test_step": [[60, 68], ["trainer.Trainer.", "trainer.Trainer.loss", "batch[].float", "[].long", "[].long", "[].long", "[].long"], "methods", ["None"], ["", "def", "test_step", "(", "self", ",", "batch", ",", "batch_idx", ":", "int", ")", ":", "\n", "        ", "output", "=", "self", "(", "batch", ")", "\n", "loss", "=", "self", ".", "loss", "(", "output", ",", "batch", "[", "'labels'", "]", ".", "float", "(", ")", ")", "\n", "self", ".", "val_AP", "[", "'like'", "]", "(", "output", "[", ":", ",", "0", "]", ",", "batch", "[", "'labels'", "]", "[", ":", ",", "0", "]", ".", "long", "(", ")", ")", "\n", "self", ".", "val_AP", "[", "'retweet'", "]", "(", "output", "[", ":", ",", "1", "]", ",", "batch", "[", "'labels'", "]", "[", ":", ",", "1", "]", ".", "long", "(", ")", ")", "\n", "self", ".", "val_AP", "[", "'retweet_with_comment'", "]", "(", "output", "[", ":", ",", "2", "]", ",", "batch", "[", "'labels'", "]", "[", ":", ",", "2", "]", ".", "long", "(", ")", ")", "\n", "self", ".", "val_AP", "[", "'reply'", "]", "(", "output", "[", ":", ",", "3", "]", ",", "batch", "[", "'labels'", "]", "[", ":", ",", "3", "]", ".", "long", "(", ")", ")", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.model.trainer.Trainer.validation_epoch_end": [[69, 79], ["print", "print", "print", "print", "trainer.Trainer.val_AP[].reset", "trainer.Trainer.val_AP[].reset", "trainer.Trainer.val_AP[].reset", "trainer.Trainer.val_AP[].reset", "trainer.Trainer.val_AP[].compute().item", "trainer.Trainer.val_AP[].compute().item", "trainer.Trainer.val_AP[].compute().item", "trainer.Trainer.val_AP[].compute().item", "trainer.Trainer.val_AP[].compute", "trainer.Trainer.val_AP[].compute", "trainer.Trainer.val_AP[].compute", "trainer.Trainer.val_AP[].compute"], "methods", ["None"], ["", "def", "validation_epoch_end", "(", "self", ",", "out", ")", ":", "\n", "        ", "print", "(", "f\"\"\"Validation AP like: {self.val_AP['like'].compute().item()}\"\"\"", ")", "\n", "print", "(", "f\"\"\"Validation AP retweet: {self.val_AP['retweet'].compute().item()}\"\"\"", ")", "\n", "print", "(", "f\"\"\"Validation AP retweet_with_comment: {self.val_AP['retweet_with_comment'].compute().item()}\"\"\"", ")", "\n", "print", "(", "f\"\"\"Validation AP reply: {self.val_AP['reply'].compute().item()}\"\"\"", ")", "\n", "\n", "self", ".", "val_AP", "[", "'like'", "]", ".", "reset", "(", ")", "\n", "self", ".", "val_AP", "[", "'retweet'", "]", ".", "reset", "(", ")", "\n", "self", ".", "val_AP", "[", "'retweet_with_comment'", "]", ".", "reset", "(", ")", "\n", "self", ".", "val_AP", "[", "'reply'", "]", ".", "reset", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.model.trainer.Trainer.training_epoch_end": [[80, 91], ["print", "print", "print", "print", "print", "trainer.Trainer.train_AP[].reset", "trainer.Trainer.train_AP[].reset", "trainer.Trainer.train_AP[].reset", "trainer.Trainer.train_AP[].reset", "numpy.mean", "trainer.Trainer.train_AP[].compute().item", "trainer.Trainer.train_AP[].compute().item", "trainer.Trainer.train_AP[].compute().item", "trainer.Trainer.train_AP[].compute().item", "i[].item", "trainer.Trainer.train_AP[].compute", "trainer.Trainer.train_AP[].compute", "trainer.Trainer.train_AP[].compute", "trainer.Trainer.train_AP[].compute"], "methods", ["None"], ["", "def", "training_epoch_end", "(", "self", ",", "losses", ")", ":", "\n", "        ", "print", "(", "f\"\"\"Training loss: {np.mean([i['loss'].item() for i in losses])}\"\"\"", ")", "\n", "print", "(", "f\"\"\"Training AP like: {self.train_AP['like'].compute().item()}\"\"\"", ")", "\n", "print", "(", "f\"\"\"Training AP retweet: {self.train_AP['retweet'].compute().item()}\"\"\"", ")", "\n", "print", "(", "f\"\"\"Training AP retweet_with_comment: {self.train_AP['retweet_with_comment'].compute().item()}\"\"\"", ")", "\n", "print", "(", "f\"\"\"Training AP reply: {self.train_AP['reply'].compute().item()}\"\"\"", ")", "\n", "\n", "self", ".", "train_AP", "[", "'like'", "]", ".", "reset", "(", ")", "\n", "self", ".", "train_AP", "[", "'retweet'", "]", ".", "reset", "(", ")", "\n", "self", ".", "train_AP", "[", "'retweet_with_comment'", "]", ".", "reset", "(", ")", "\n", "self", ".", "train_AP", "[", "'reply'", "]", ".", "reset", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.model.trainer.Trainer.configure_optimizers": [[92, 95], ["torch.optim.AdamW", "torch.optim.AdamW", "torch.optim.AdamW", "torch.optim.AdamW", "trainer.Trainer.model.parameters"], "methods", ["None"], ["", "def", "configure_optimizers", "(", "self", ")", ":", "\n", "        ", "optimizer", "=", "torch", ".", "optim", ".", "AdamW", "(", "self", ".", "model", ".", "parameters", "(", ")", ",", "lr", "=", "self", ".", "learning_rate", ",", "weight_decay", "=", "0.01", ")", "\n", "return", "optimizer", "\n", "", "", ""]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.model.net.Embedding.__init__": [[14, 17], ["torch.Embedding.__init__", "net.trunc_normal_"], "methods", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.model.net.Model.__init__", "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.model.net.trunc_normal_"], ["def", "__init__", "(", "self", ",", "ni", ",", "nf", ",", "std", "=", "0.01", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "ni", ",", "nf", ")", "\n", "trunc_normal_", "(", "self", ".", "weight", ".", "data", ",", "std", "=", "std", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.model.net.Model.__init__": [[20, 38], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "torch.BatchNorm1d", "net.Embedding", "net.Embedding", "net.Embedding"], "methods", ["home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.model.net.Model.__init__"], ["    ", "def", "__init__", "(", "self", ",", "hidden_size", ",", "num_languages", ",", "embedding_size", ",", "num_categorical_features", ",", "num_numerical_features", ",", "sketch_depth", ",", "sketch_width", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "input_dim", "=", "num_categorical_features", "+", "16", "*", "num_numerical_features", "+", "embedding_size", "*", "3", "+", "sketch_depth", "*", "sketch_width", "\n", "self", ".", "l1", "=", "nn", ".", "Linear", "(", "input_dim", ",", "hidden_size", ")", "\n", "self", ".", "l2", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "hidden_size", ")", "\n", "self", ".", "l3", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "hidden_size", ")", "\n", "self", ".", "l4", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "hidden_size", ")", "\n", "self", ".", "l_output", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "4", ")", "\n", "self", ".", "projection", "=", "nn", ".", "Linear", "(", "input_dim", ",", "hidden_size", ")", "\n", "\n", "self", ".", "bn1", "=", "nn", ".", "BatchNorm1d", "(", "hidden_size", ")", "\n", "self", ".", "bn2", "=", "nn", ".", "BatchNorm1d", "(", "hidden_size", ")", "\n", "self", ".", "bn3", "=", "nn", ".", "BatchNorm1d", "(", "hidden_size", ")", "\n", "self", ".", "bn4", "=", "nn", ".", "BatchNorm1d", "(", "hidden_size", ")", "\n", "\n", "self", ".", "language", "=", "Embedding", "(", "num_languages", "+", "1", ",", "embedding_size", ")", "\n", "self", ".", "hour", "=", "Embedding", "(", "24", ",", "embedding_size", ")", "\n", "self", ".", "day", "=", "Embedding", "(", "31", ",", "embedding_size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.model.net.Model.forward": [[40, 51], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "net.Model.projection", "net.Model.bn1", "net.Model.bn2", "net.Model.bn3", "net.Model.l_output", "torch.leaky_relu", "torch.leaky_relu", "torch.leaky_relu", "torch.leaky_relu", "torch.leaky_relu", "torch.leaky_relu", "torch.leaky_relu", "torch.leaky_relu", "torch.leaky_relu", "net.Model.bn4", "net.Model.language", "net.Model.hour", "net.Model.day", "net.Model.l1", "torch.leaky_relu", "torch.leaky_relu", "torch.leaky_relu", "net.Model.l2", "net.Model.l3", "net.Model.l4"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x_input", ",", "language", ",", "twitt_hour", ",", "twitt_day", ")", ":", "\n", "        ", "\"\"\"\n        Feed forward network with residual connections.\n        \"\"\"", "\n", "x_input", "=", "torch", ".", "cat", "(", "(", "x_input", ",", "self", ".", "language", "(", "language", ")", ",", "self", ".", "hour", "(", "twitt_hour", ")", ",", "self", ".", "day", "(", "twitt_day", ")", ")", ",", "axis", "=", "1", ")", "\n", "x_proj", "=", "self", ".", "projection", "(", "x_input", ")", "\n", "x_", "=", "self", ".", "bn1", "(", "F", ".", "leaky_relu", "(", "self", ".", "l1", "(", "x_input", ")", ")", ")", "\n", "x", "=", "self", ".", "bn2", "(", "F", ".", "leaky_relu", "(", "self", ".", "l2", "(", "x_", ")", "+", "x_proj", ")", ")", "\n", "x", "=", "self", ".", "bn3", "(", "F", ".", "leaky_relu", "(", "self", ".", "l3", "(", "x", ")", "+", "x_proj", ")", ")", "\n", "x", "=", "self", ".", "l_output", "(", "self", ".", "bn4", "(", "F", ".", "leaky_relu", "(", "self", ".", "l4", "(", "x", ")", "+", "x_", ")", ")", ")", "\n", "return", "x", "", "", "", ""]], "home.repos.pwc.inspect_result.synerise_recsys-challenge-2021.model.net.trunc_normal_": [[6, 10], ["x.normal_().fmod_().mul_().add_", "x.normal_().fmod_().mul_", "x.normal_().fmod_", "x.normal_"], "function", ["None"], ["def", "trunc_normal_", "(", "x", ",", "mean", "=", "0.", ",", "std", "=", "1.", ")", ":", "\n", "    ", "\"Truncated normal initialization (approximation)\"", "\n", "# From https://discuss.pytorch.org/t/implementing-truncated-normal-initializer/4778/12", "\n", "return", "x", ".", "normal_", "(", ")", ".", "fmod_", "(", "2", ")", ".", "mul_", "(", "std", ")", ".", "add_", "(", "mean", ")", "\n", "\n"]]}