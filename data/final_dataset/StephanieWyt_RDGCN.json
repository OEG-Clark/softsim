{"home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Load.loadfile": [[5, 16], ["print", "open", "line[].split", "range", "ret.append", "x.append", "tuple", "int"], "function", ["None"], ["def", "loadfile", "(", "fn", ",", "num", "=", "1", ")", ":", "\n", "    ", "print", "(", "'loading a file...'", "+", "fn", ")", "\n", "ret", "=", "[", "]", "\n", "with", "open", "(", "fn", ",", "encoding", "=", "'utf-8'", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ":", "\n", "            ", "th", "=", "line", "[", ":", "-", "1", "]", ".", "split", "(", "'\\t'", ")", "\n", "x", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "num", ")", ":", "\n", "                ", "x", ".", "append", "(", "int", "(", "th", "[", "i", "]", ")", ")", "\n", "", "ret", ".", "append", "(", "tuple", "(", "x", ")", ")", "\n", "", "", "return", "ret", "\n", "", ""]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Test.get_hits": [[5, 29], ["numpy.array", "numpy.array", "scipy.spatial.distance.cdist", "range", "range", "print", "range", "print", "range", "len", "sim[].argsort", "range", "len", "sim[].argsort", "range", "len", "print", "len", "print", "len", "len", "numpy.where", "numpy.where", "len", "len"], "function", ["None"], ["def", "get_hits", "(", "vec", ",", "test_pair", ",", "top_k", "=", "(", "1", ",", "10", ",", "50", ",", "100", ")", ")", ":", "\n", "    ", "Lvec", "=", "np", ".", "array", "(", "[", "vec", "[", "e1", "]", "for", "e1", ",", "e2", "in", "test_pair", "]", ")", "\n", "Rvec", "=", "np", ".", "array", "(", "[", "vec", "[", "e2", "]", "for", "e1", ",", "e2", "in", "test_pair", "]", ")", "\n", "sim", "=", "scipy", ".", "spatial", ".", "distance", ".", "cdist", "(", "Lvec", ",", "Rvec", ",", "metric", "=", "'cityblock'", ")", "\n", "top_lr", "=", "[", "0", "]", "*", "len", "(", "top_k", ")", "\n", "for", "i", "in", "range", "(", "Lvec", ".", "shape", "[", "0", "]", ")", ":", "\n", "        ", "rank", "=", "sim", "[", "i", ",", ":", "]", ".", "argsort", "(", ")", "\n", "rank_index", "=", "np", ".", "where", "(", "rank", "==", "i", ")", "[", "0", "]", "[", "0", "]", "\n", "for", "j", "in", "range", "(", "len", "(", "top_k", ")", ")", ":", "\n", "            ", "if", "rank_index", "<", "top_k", "[", "j", "]", ":", "\n", "                ", "top_lr", "[", "j", "]", "+=", "1", "\n", "", "", "", "top_rl", "=", "[", "0", "]", "*", "len", "(", "top_k", ")", "\n", "for", "i", "in", "range", "(", "Rvec", ".", "shape", "[", "0", "]", ")", ":", "\n", "        ", "rank", "=", "sim", "[", ":", ",", "i", "]", ".", "argsort", "(", ")", "\n", "rank_index", "=", "np", ".", "where", "(", "rank", "==", "i", ")", "[", "0", "]", "[", "0", "]", "\n", "for", "j", "in", "range", "(", "len", "(", "top_k", ")", ")", ":", "\n", "            ", "if", "rank_index", "<", "top_k", "[", "j", "]", ":", "\n", "                ", "top_rl", "[", "j", "]", "+=", "1", "\n", "", "", "", "print", "(", "'For each left:'", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "top_lr", ")", ")", ":", "\n", "        ", "print", "(", "'Hits@%d: %.2f%%'", "%", "(", "top_k", "[", "i", "]", ",", "top_lr", "[", "i", "]", "/", "len", "(", "test_pair", ")", "*", "100", ")", ")", "\n", "", "print", "(", "'For each right:'", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "top_rl", ")", ")", ":", "\n", "        ", "print", "(", "'Hits@%d: %.2f%%'", "%", "(", "top_k", "[", "i", "]", ",", "top_rl", "[", "i", "]", "/", "len", "(", "test_pair", ")", "*", "100", ")", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Init.uniform": [[8, 12], ["tensorflow.random_uniform", "tensorflow.Variable"], "function", ["None"], ["def", "uniform", "(", "shape", ",", "scale", "=", "0.05", ",", "name", "=", "None", ")", ":", "\n", "\t", "\"\"\"Uniform init.\"\"\"", "\n", "initial", "=", "tf", ".", "random_uniform", "(", "shape", ",", "minval", "=", "-", "scale", ",", "maxval", "=", "scale", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "return", "tf", ".", "Variable", "(", "initial", ",", "name", "=", "name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Init.glorot": [[14, 19], ["numpy.sqrt", "tensorflow.random_uniform", "tensorflow.Variable"], "function", ["None"], ["", "def", "glorot", "(", "shape", ",", "name", "=", "None", ")", ":", "\n", "\t", "\"\"\"Glorot & Bengio (AISTATS 2010) init.\"\"\"", "\n", "init_range", "=", "np", ".", "sqrt", "(", "6.0", "/", "(", "shape", "[", "0", "]", "+", "shape", "[", "1", "]", ")", ")", "\n", "initial", "=", "tf", ".", "random_uniform", "(", "shape", ",", "minval", "=", "-", "init_range", ",", "maxval", "=", "init_range", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "return", "tf", ".", "Variable", "(", "initial", ",", "name", "=", "name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Init.zeros": [[21, 25], ["tensorflow.zeros", "tensorflow.Variable"], "function", ["home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Init.zeros"], ["", "def", "zeros", "(", "shape", ",", "name", "=", "None", ")", ":", "\n", "\t", "\"\"\"All zeros.\"\"\"", "\n", "initial", "=", "tf", ".", "zeros", "(", "shape", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "return", "tf", ".", "Variable", "(", "initial", ",", "name", "=", "name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Init.ones": [[27, 31], ["tensorflow.ones", "tensorflow.Variable"], "function", ["home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Init.ones"], ["", "def", "ones", "(", "shape", ",", "name", "=", "None", ")", ":", "\n", "\t", "\"\"\"All ones.\"\"\"", "\n", "initial", "=", "tf", ".", "ones", "(", "shape", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "return", "tf", ".", "Variable", "(", "initial", ",", "name", "=", "name", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.rfunc": [[8, 35], ["len", "np.zeros", "np.zeros", "tf.SparseTensor", "r_mat_ind.append", "r_mat_val.append", "set", "set", "head[].add", "tail[].add"], "function", ["home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Init.zeros", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Init.zeros"], ["def", "rfunc", "(", "KG", ",", "e", ")", ":", "\n", "    ", "head", "=", "{", "}", "\n", "tail", "=", "{", "}", "\n", "cnt", "=", "{", "}", "\n", "for", "tri", "in", "KG", ":", "\n", "        ", "if", "tri", "[", "1", "]", "not", "in", "cnt", ":", "\n", "            ", "cnt", "[", "tri", "[", "1", "]", "]", "=", "1", "\n", "head", "[", "tri", "[", "1", "]", "]", "=", "set", "(", "[", "tri", "[", "0", "]", "]", ")", "\n", "tail", "[", "tri", "[", "1", "]", "]", "=", "set", "(", "[", "tri", "[", "2", "]", "]", ")", "\n", "", "else", ":", "\n", "            ", "cnt", "[", "tri", "[", "1", "]", "]", "+=", "1", "\n", "head", "[", "tri", "[", "1", "]", "]", ".", "add", "(", "tri", "[", "0", "]", ")", "\n", "tail", "[", "tri", "[", "1", "]", "]", ".", "add", "(", "tri", "[", "2", "]", ")", "\n", "", "", "r_num", "=", "len", "(", "head", ")", "\n", "head_r", "=", "np", ".", "zeros", "(", "(", "e", ",", "r_num", ")", ")", "\n", "tail_r", "=", "np", ".", "zeros", "(", "(", "e", ",", "r_num", ")", ")", "\n", "r_mat_ind", "=", "[", "]", "\n", "r_mat_val", "=", "[", "]", "\n", "for", "tri", "in", "KG", ":", "\n", "        ", "head_r", "[", "tri", "[", "0", "]", "]", "[", "tri", "[", "1", "]", "]", "=", "1", "\n", "tail_r", "[", "tri", "[", "2", "]", "]", "[", "tri", "[", "1", "]", "]", "=", "1", "\n", "r_mat_ind", ".", "append", "(", "[", "tri", "[", "0", "]", ",", "tri", "[", "2", "]", "]", ")", "\n", "r_mat_val", ".", "append", "(", "tri", "[", "1", "]", ")", "\n", "", "r_mat", "=", "tf", ".", "SparseTensor", "(", "\n", "indices", "=", "r_mat_ind", ",", "values", "=", "r_mat_val", ",", "dense_shape", "=", "[", "e", ",", "e", "]", ")", "\n", "\n", "return", "head", ",", "tail", ",", "head_r", ",", "tail_r", ",", "r_mat", "\n", "\n"]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.get_mat": [[37, 60], ["range", "len", "range", "du[].add", "du[].add"], "function", ["None"], ["", "def", "get_mat", "(", "e", ",", "KG", ")", ":", "\n", "    ", "du", "=", "[", "{", "e_id", "}", "for", "e_id", "in", "range", "(", "e", ")", "]", "\n", "for", "tri", "in", "KG", ":", "\n", "        ", "if", "tri", "[", "0", "]", "!=", "tri", "[", "2", "]", ":", "\n", "            ", "du", "[", "tri", "[", "0", "]", "]", ".", "add", "(", "tri", "[", "2", "]", ")", "\n", "du", "[", "tri", "[", "2", "]", "]", ".", "add", "(", "tri", "[", "0", "]", ")", "\n", "", "", "du", "=", "[", "len", "(", "d", ")", "for", "d", "in", "du", "]", "\n", "M", "=", "{", "}", "\n", "for", "tri", "in", "KG", ":", "\n", "        ", "if", "tri", "[", "0", "]", "==", "tri", "[", "2", "]", ":", "\n", "            ", "continue", "\n", "", "if", "(", "tri", "[", "0", "]", ",", "tri", "[", "2", "]", ")", "not", "in", "M", ":", "\n", "            ", "M", "[", "(", "tri", "[", "0", "]", ",", "tri", "[", "2", "]", ")", "]", "=", "1", "\n", "", "else", ":", "\n", "            ", "pass", "\n", "", "if", "(", "tri", "[", "2", "]", ",", "tri", "[", "0", "]", ")", "not", "in", "M", ":", "\n", "            ", "M", "[", "(", "tri", "[", "2", "]", ",", "tri", "[", "0", "]", ")", "]", "=", "1", "\n", "", "else", ":", "\n", "            ", "pass", "\n", "\n", "", "", "for", "i", "in", "range", "(", "e", ")", ":", "\n", "        ", "M", "[", "(", "i", ",", "i", ")", "]", "=", "1", "\n", "", "return", "M", ",", "du", "\n", "\n"]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.get_sparse_tensor": [[63, 76], ["print", "Model.get_mat", "np.zeros", "tf.SparseTensor", "ind.append", "val.append", "math.sqrt", "math.sqrt"], "function", ["home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.get_mat", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Init.zeros"], ["", "def", "get_sparse_tensor", "(", "e", ",", "KG", ")", ":", "\n", "    ", "print", "(", "'getting a sparse tensor...'", ")", "\n", "M", ",", "du", "=", "get_mat", "(", "e", ",", "KG", ")", "\n", "ind", "=", "[", "]", "\n", "val", "=", "[", "]", "\n", "M_arr", "=", "np", ".", "zeros", "(", "(", "e", ",", "e", ")", ")", "\n", "for", "fir", ",", "sec", "in", "M", ":", "\n", "        ", "ind", ".", "append", "(", "(", "sec", ",", "fir", ")", ")", "\n", "val", ".", "append", "(", "M", "[", "(", "fir", ",", "sec", ")", "]", "/", "math", ".", "sqrt", "(", "du", "[", "fir", "]", ")", "/", "math", ".", "sqrt", "(", "du", "[", "sec", "]", ")", ")", "\n", "M_arr", "[", "fir", "]", "[", "sec", "]", "=", "1.0", "\n", "", "M", "=", "tf", ".", "SparseTensor", "(", "indices", "=", "ind", ",", "values", "=", "val", ",", "dense_shape", "=", "[", "e", ",", "e", "]", ")", "\n", "\n", "return", "M", ",", "M_arr", "\n", "\n"]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.add_diag_layer": [[79, 88], ["tf.nn.dropout", "print", "init", "tf.sparse_tensor_dense_matmul", "tf.multiply", "act_func"], "function", ["None"], ["", "def", "add_diag_layer", "(", "inlayer", ",", "dimension", ",", "M", ",", "act_func", ",", "dropout", "=", "0.0", ",", "init", "=", "ones", ")", ":", "\n", "    ", "inlayer", "=", "tf", ".", "nn", ".", "dropout", "(", "inlayer", ",", "1", "-", "dropout", ")", "\n", "print", "(", "'adding a diag layer...'", ")", "\n", "w0", "=", "init", "(", "[", "1", ",", "dimension", "]", ")", "\n", "tosum", "=", "tf", ".", "sparse_tensor_dense_matmul", "(", "M", ",", "tf", ".", "multiply", "(", "inlayer", ",", "w0", ")", ")", "\n", "if", "act_func", "is", "None", ":", "\n", "        ", "return", "tosum", "\n", "", "else", ":", "\n", "        ", "return", "act_func", "(", "tosum", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.add_full_layer": [[90, 99], ["tf.nn.dropout", "print", "init", "tf.sparse_tensor_dense_matmul", "tf.matmul", "act_func"], "function", ["None"], ["", "", "def", "add_full_layer", "(", "inlayer", ",", "dimension_in", ",", "dimension_out", ",", "M", ",", "act_func", ",", "dropout", "=", "0.0", ",", "init", "=", "glorot", ")", ":", "\n", "    ", "inlayer", "=", "tf", ".", "nn", ".", "dropout", "(", "inlayer", ",", "1", "-", "dropout", ")", "\n", "print", "(", "'adding a full layer...'", ")", "\n", "w0", "=", "init", "(", "[", "dimension_in", ",", "dimension_out", "]", ")", "\n", "tosum", "=", "tf", ".", "sparse_tensor_dense_matmul", "(", "M", ",", "tf", ".", "matmul", "(", "inlayer", ",", "w0", ")", ")", "\n", "if", "act_func", "is", "None", ":", "\n", "        ", "return", "tosum", "\n", "", "else", ":", "\n", "        ", "return", "act_func", "(", "tosum", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.add_sparse_att_layer": [[101, 116], ["tf.reshape", "tf.reshape", "print", "tf.SparseTensor", "tf.sparse_softmax", "tf.sparse_tensor_dense_matmul", "tf.layers.conv1d", "tf.nn.embedding_lookup", "act_func", "tf.expand_dims", "tf.nn.leaky_relu"], "function", ["None"], ["", "", "def", "add_sparse_att_layer", "(", "inlayer", ",", "dual_layer", ",", "r_mat", ",", "act_func", ",", "e", ")", ":", "\n", "    ", "dual_transform", "=", "tf", ".", "reshape", "(", "tf", ".", "layers", ".", "conv1d", "(", "\n", "tf", ".", "expand_dims", "(", "dual_layer", ",", "0", ")", ",", "1", ",", "1", ")", ",", "(", "-", "1", ",", "1", ")", ")", "\n", "logits", "=", "tf", ".", "reshape", "(", "tf", ".", "nn", ".", "embedding_lookup", "(", "\n", "dual_transform", ",", "r_mat", ".", "values", ")", ",", "[", "-", "1", "]", ")", "\n", "print", "(", "'adding sparse attention layer...'", ")", "\n", "lrelu", "=", "tf", ".", "SparseTensor", "(", "indices", "=", "r_mat", ".", "indices", ",", "\n", "values", "=", "tf", ".", "nn", ".", "leaky_relu", "(", "logits", ")", ",", "\n", "dense_shape", "=", "(", "r_mat", ".", "dense_shape", ")", ")", "\n", "coefs", "=", "tf", ".", "sparse_softmax", "(", "lrelu", ")", "\n", "vals", "=", "tf", ".", "sparse_tensor_dense_matmul", "(", "coefs", ",", "inlayer", ")", "\n", "if", "act_func", "is", "None", ":", "\n", "        ", "return", "vals", "\n", "", "else", ":", "\n", "        ", "return", "act_func", "(", "vals", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.add_dual_att_layer": [[118, 134], ["tf.layers.conv1d", "tf.reshape", "tf.reshape", "print", "tf.constant", "tf.multiply", "tf.nn.softmax", "tf.matmul", "tf.expand_dims", "tf.layers.conv1d", "tf.layers.conv1d", "tf.transpose", "act_func", "tf.nn.leaky_relu"], "function", ["None"], ["", "", "def", "add_dual_att_layer", "(", "inlayer", ",", "inlayer2", ",", "adj_mat", ",", "act_func", ",", "hid_dim", ")", ":", "\n", "    ", "in_fts", "=", "tf", ".", "layers", ".", "conv1d", "(", "tf", ".", "expand_dims", "(", "inlayer2", ",", "0", ")", ",", "hid_dim", ",", "1", ")", "\n", "f_1", "=", "tf", ".", "reshape", "(", "tf", ".", "layers", ".", "conv1d", "(", "in_fts", ",", "1", ",", "1", ")", ",", "(", "-", "1", ",", "1", ")", ")", "\n", "f_2", "=", "tf", ".", "reshape", "(", "tf", ".", "layers", ".", "conv1d", "(", "in_fts", ",", "1", ",", "1", ")", ",", "(", "-", "1", ",", "1", ")", ")", "\n", "logits", "=", "f_1", "+", "tf", ".", "transpose", "(", "f_2", ")", "\n", "print", "(", "'adding dual attention layer...'", ")", "\n", "adj_tensor", "=", "tf", ".", "constant", "(", "adj_mat", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "bias_mat", "=", "-", "1e9", "*", "(", "1.0", "-", "(", "adj_mat", ">", "0", ")", ")", "\n", "logits", "=", "tf", ".", "multiply", "(", "adj_tensor", ",", "logits", ")", "\n", "coefs", "=", "tf", ".", "nn", ".", "softmax", "(", "tf", ".", "nn", ".", "leaky_relu", "(", "logits", ")", "+", "bias_mat", ")", "\n", "\n", "vals", "=", "tf", ".", "matmul", "(", "coefs", ",", "inlayer", ")", "\n", "if", "act_func", "is", "None", ":", "\n", "        ", "return", "vals", "\n", "", "else", ":", "\n", "        ", "return", "act_func", "(", "vals", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.add_self_att_layer": [[136, 153], ["tf.layers.conv1d", "tf.reshape", "tf.reshape", "print", "tf.constant", "tf.multiply", "tf.nn.softmax", "tf.matmul", "tf.expand_dims", "tf.layers.conv1d", "tf.layers.conv1d", "tf.transpose", "act_func", "tf.nn.leaky_relu"], "function", ["None"], ["", "", "def", "add_self_att_layer", "(", "inlayer", ",", "adj_mat", ",", "act_func", ",", "hid_dim", ")", ":", "\n", "    ", "in_fts", "=", "tf", ".", "layers", ".", "conv1d", "(", "tf", ".", "expand_dims", "(", "\n", "inlayer", ",", "0", ")", ",", "hid_dim", ",", "1", ",", "use_bias", "=", "False", ")", "\n", "f_1", "=", "tf", ".", "reshape", "(", "tf", ".", "layers", ".", "conv1d", "(", "in_fts", ",", "1", ",", "1", ")", ",", "(", "-", "1", ",", "1", ")", ")", "\n", "f_2", "=", "tf", ".", "reshape", "(", "tf", ".", "layers", ".", "conv1d", "(", "in_fts", ",", "1", ",", "1", ")", ",", "(", "-", "1", ",", "1", ")", ")", "\n", "logits", "=", "f_1", "+", "tf", ".", "transpose", "(", "f_2", ")", "\n", "print", "(", "'adding self attention layer...'", ")", "\n", "adj_tensor", "=", "tf", ".", "constant", "(", "adj_mat", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "logits", "=", "tf", ".", "multiply", "(", "adj_tensor", ",", "logits", ")", "\n", "bias_mat", "=", "-", "1e9", "*", "(", "1.0", "-", "(", "adj_mat", ">", "0", ")", ")", "\n", "coefs", "=", "tf", ".", "nn", ".", "softmax", "(", "tf", ".", "nn", ".", "leaky_relu", "(", "logits", ")", "+", "bias_mat", ")", "\n", "\n", "vals", "=", "tf", ".", "matmul", "(", "coefs", ",", "inlayer", ")", "\n", "if", "act_func", "is", "None", ":", "\n", "        ", "return", "vals", "\n", "", "else", ":", "\n", "        ", "return", "act_func", "(", "vals", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.highway": [[155, 162], ["Init.glorot", "Init.zeros", "tf.nn.sigmoid", "tf.matmul"], "function", ["home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Init.glorot", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Init.zeros"], ["", "", "def", "highway", "(", "layer1", ",", "layer2", ",", "dimension", ")", ":", "\n", "    ", "kernel_gate", "=", "glorot", "(", "[", "dimension", ",", "dimension", "]", ")", "\n", "bias_gate", "=", "zeros", "(", "[", "dimension", "]", ")", "\n", "transform_gate", "=", "tf", ".", "matmul", "(", "layer1", ",", "kernel_gate", ")", "+", "bias_gate", "\n", "transform_gate", "=", "tf", ".", "nn", ".", "sigmoid", "(", "transform_gate", ")", "\n", "carry_gate", "=", "1.0", "-", "transform_gate", "\n", "return", "transform_gate", "*", "layer2", "+", "carry_gate", "*", "layer1", "\n", "\n"]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.compute_r": [[164, 173], ["tf.transpose", "tf.transpose", "tf.concat", "tf.constant", "tf.constant", "tf.matmul", "tf.expand_dims", "tf.matmul", "tf.expand_dims", "tf.reduce_sum", "tf.reduce_sum"], "function", ["None"], ["", "def", "compute_r", "(", "inlayer", ",", "head_r", ",", "tail_r", ",", "dimension", ")", ":", "\n", "    ", "head_l", "=", "tf", ".", "transpose", "(", "tf", ".", "constant", "(", "head_r", ",", "dtype", "=", "tf", ".", "float32", ")", ")", "\n", "tail_l", "=", "tf", ".", "transpose", "(", "tf", ".", "constant", "(", "tail_r", ",", "dtype", "=", "tf", ".", "float32", ")", ")", "\n", "L", "=", "tf", ".", "matmul", "(", "head_l", ",", "inlayer", ")", "/", "tf", ".", "expand_dims", "(", "tf", ".", "reduce_sum", "(", "head_l", ",", "axis", "=", "-", "1", ")", ",", "-", "1", ")", "\n", "R", "=", "tf", ".", "matmul", "(", "tail_l", ",", "inlayer", ")", "/", "tf", ".", "expand_dims", "(", "tf", ".", "reduce_sum", "(", "tail_l", ",", "axis", "=", "-", "1", ")", ",", "-", "1", ")", "\n", "r_embeddings", "=", "tf", ".", "concat", "(", "[", "L", ",", "R", "]", ",", "axis", "=", "-", "1", ")", "\n", "return", "r_embeddings", "\n", "\n"]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.get_dual_input": [[175, 186], ["Model.compute_r", "print", "len", "np.zeros", "range", "range", "len", "len", "len", "len"], "function", ["home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.compute_r", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Init.zeros"], ["", "def", "get_dual_input", "(", "inlayer", ",", "head", ",", "tail", ",", "head_r", ",", "tail_r", ",", "dimension", ")", ":", "\n", "    ", "dual_X", "=", "compute_r", "(", "inlayer", ",", "head_r", ",", "tail_r", ",", "dimension", ")", "\n", "print", "(", "'computing the dual input...'", ")", "\n", "count_r", "=", "len", "(", "head", ")", "\n", "dual_A", "=", "np", ".", "zeros", "(", "(", "count_r", ",", "count_r", ")", ")", "\n", "for", "i", "in", "range", "(", "count_r", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "count_r", ")", ":", "\n", "            ", "a_h", "=", "len", "(", "head", "[", "i", "]", "&", "head", "[", "j", "]", ")", "/", "len", "(", "head", "[", "i", "]", "|", "head", "[", "j", "]", ")", "\n", "a_t", "=", "len", "(", "tail", "[", "i", "]", "&", "tail", "[", "j", "]", ")", "/", "len", "(", "tail", "[", "i", "]", "|", "tail", "[", "j", "]", ")", "\n", "dual_A", "[", "i", "]", "[", "j", "]", "=", "a_h", "+", "a_t", "\n", "", "", "return", "dual_X", ",", "dual_A", "\n", "\n"]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.get_input_layer": [[188, 196], ["print", "tf.convert_to_tensor", "tf.Variable", "tf.nn.l2_normalize", "open", "json.load", "print", "len", "len"], "function", ["None"], ["", "def", "get_input_layer", "(", "e", ",", "dimension", ",", "lang", ")", ":", "\n", "    ", "print", "(", "'adding the primal input layer...'", ")", "\n", "with", "open", "(", "file", "=", "'data/'", "+", "lang", "+", "'_en/'", "+", "lang", "+", "'_vectorList.json'", ",", "mode", "=", "'r'", ",", "encoding", "=", "'utf-8'", ")", "as", "f", ":", "\n", "        ", "embedding_list", "=", "json", ".", "load", "(", "f", ")", "\n", "print", "(", "len", "(", "embedding_list", ")", ",", "'rows,'", ",", "len", "(", "embedding_list", "[", "0", "]", ")", ",", "'columns.'", ")", "\n", "", "input_embeddings", "=", "tf", ".", "convert_to_tensor", "(", "embedding_list", ")", "\n", "ent_embeddings", "=", "tf", ".", "Variable", "(", "input_embeddings", ")", "\n", "return", "tf", ".", "nn", ".", "l2_normalize", "(", "ent_embeddings", ",", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.get_loss": [[198, 222], ["print", "len", "tf.nn.embedding_lookup", "tf.nn.embedding_lookup", "tf.reduce_sum", "tf.placeholder", "tf.placeholder", "tf.nn.embedding_lookup", "tf.nn.embedding_lookup", "tf.reduce_sum", "tf.nn.relu", "tf.placeholder", "tf.placeholder", "tf.nn.embedding_lookup", "tf.nn.embedding_lookup", "tf.reduce_sum", "tf.nn.relu", "tf.abs", "tf.abs", "tf.reshape", "tf.add", "tf.abs", "tf.reshape", "tf.add", "tf.reshape", "tf.reshape", "tf.reduce_sum", "tf.reduce_sum"], "function", ["None"], ["", "def", "get_loss", "(", "outlayer", ",", "ILL", ",", "gamma", ",", "k", ")", ":", "\n", "    ", "print", "(", "'getting loss...'", ")", "\n", "left", "=", "ILL", "[", ":", ",", "0", "]", "\n", "right", "=", "ILL", "[", ":", ",", "1", "]", "\n", "t", "=", "len", "(", "ILL", ")", "\n", "left_x", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "outlayer", ",", "left", ")", "\n", "right_x", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "outlayer", ",", "right", ")", "\n", "A", "=", "tf", ".", "reduce_sum", "(", "tf", ".", "abs", "(", "left_x", "-", "right_x", ")", ",", "1", ")", "\n", "neg_left", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "[", "t", "*", "k", "]", ",", "\"neg_left\"", ")", "\n", "neg_right", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "[", "t", "*", "k", "]", ",", "\"neg_right\"", ")", "\n", "neg_l_x", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "outlayer", ",", "neg_left", ")", "\n", "neg_r_x", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "outlayer", ",", "neg_right", ")", "\n", "B", "=", "tf", ".", "reduce_sum", "(", "tf", ".", "abs", "(", "neg_l_x", "-", "neg_r_x", ")", ",", "1", ")", "\n", "C", "=", "-", "tf", ".", "reshape", "(", "B", ",", "[", "t", ",", "k", "]", ")", "\n", "D", "=", "A", "+", "gamma", "\n", "L1", "=", "tf", ".", "nn", ".", "relu", "(", "tf", ".", "add", "(", "C", ",", "tf", ".", "reshape", "(", "D", ",", "[", "t", ",", "1", "]", ")", ")", ")", "\n", "neg_left", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "[", "t", "*", "k", "]", ",", "\"neg2_left\"", ")", "\n", "neg_right", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "[", "t", "*", "k", "]", ",", "\"neg2_right\"", ")", "\n", "neg_l_x", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "outlayer", ",", "neg_left", ")", "\n", "neg_r_x", "=", "tf", ".", "nn", ".", "embedding_lookup", "(", "outlayer", ",", "neg_right", ")", "\n", "B", "=", "tf", ".", "reduce_sum", "(", "tf", ".", "abs", "(", "neg_l_x", "-", "neg_r_x", ")", ",", "1", ")", "\n", "C", "=", "-", "tf", ".", "reshape", "(", "B", ",", "[", "t", ",", "k", "]", ")", "\n", "L2", "=", "tf", ".", "nn", ".", "relu", "(", "tf", ".", "add", "(", "C", ",", "tf", ".", "reshape", "(", "D", ",", "[", "t", ",", "1", "]", ")", ")", ")", "\n", "return", "(", "tf", ".", "reduce_sum", "(", "L1", ")", "+", "tf", ".", "reduce_sum", "(", "L2", ")", ")", "/", "(", "2.0", "*", "k", "*", "t", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.build": [[224, 257], ["tf.reset_default_graph", "Model.get_input_layer", "Model.get_sparse_tensor", "Model.rfunc", "print", "Model.get_dual_input", "Model..", "Model.add_sparse_att_layer", "print", "Model.get_dual_input", "Model.add_dual_att_layer", "Model.add_sparse_att_layer", "print", "Model.add_diag_layer", "Model.highway", "Model.add_diag_layer", "Model.highway", "Model.get_loss"], "function", ["home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.get_input_layer", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.get_sparse_tensor", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.rfunc", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.get_dual_input", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.add_sparse_att_layer", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.get_dual_input", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.add_dual_att_layer", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.add_sparse_att_layer", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.add_diag_layer", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.highway", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.add_diag_layer", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.highway", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.get_loss"], ["", "def", "build", "(", "dimension", ",", "act_func", ",", "alpha", ",", "beta", ",", "gamma", ",", "k", ",", "lang", ",", "e", ",", "ILL", ",", "KG", ")", ":", "\n", "    ", "tf", ".", "reset_default_graph", "(", ")", "\n", "primal_X_0", "=", "get_input_layer", "(", "e", ",", "dimension", ",", "lang", ")", "\n", "M", ",", "M_arr", "=", "get_sparse_tensor", "(", "e", ",", "KG", ")", "\n", "head", ",", "tail", ",", "head_r", ",", "tail_r", ",", "r_mat", "=", "rfunc", "(", "KG", ",", "e", ")", "\n", "\n", "print", "(", "'first interaction...'", ")", "\n", "dual_X_1", ",", "dual_A_1", "=", "get_dual_input", "(", "\n", "primal_X_0", ",", "head", ",", "tail", ",", "head_r", ",", "tail_r", ",", "dimension", ")", "\n", "dual_H_1", "=", "add_self_att_layer", "(", "dual_X_1", ",", "dual_A_1", ",", "tf", ".", "nn", ".", "relu", ",", "600", ")", "\n", "primal_H_1", "=", "add_sparse_att_layer", "(", "\n", "primal_X_0", ",", "dual_H_1", ",", "r_mat", ",", "tf", ".", "nn", ".", "relu", ",", "e", ")", "\n", "primal_X_1", "=", "primal_X_0", "+", "alpha", "*", "primal_H_1", "\n", "\n", "print", "(", "'second interaction...'", ")", "\n", "dual_X_2", ",", "dual_A_2", "=", "get_dual_input", "(", "\n", "primal_X_1", ",", "head", ",", "tail", ",", "head_r", ",", "tail_r", ",", "dimension", ")", "\n", "dual_H_2", "=", "add_dual_att_layer", "(", "\n", "dual_H_1", ",", "dual_X_2", ",", "dual_A_2", ",", "tf", ".", "nn", ".", "relu", ",", "600", ")", "\n", "primal_H_2", "=", "add_sparse_att_layer", "(", "\n", "primal_X_1", ",", "dual_H_2", ",", "r_mat", ",", "tf", ".", "nn", ".", "relu", ",", "e", ")", "\n", "primal_X_2", "=", "primal_X_0", "+", "beta", "*", "primal_H_2", "\n", "\n", "print", "(", "'gcn layers...'", ")", "\n", "gcn_layer_1", "=", "add_diag_layer", "(", "\n", "primal_X_2", ",", "dimension", ",", "M", ",", "act_func", ",", "dropout", "=", "0.0", ")", "\n", "gcn_layer_1", "=", "highway", "(", "primal_X_2", ",", "gcn_layer_1", ",", "dimension", ")", "\n", "gcn_layer_2", "=", "add_diag_layer", "(", "\n", "gcn_layer_1", ",", "dimension", ",", "M", ",", "act_func", ",", "dropout", "=", "0.0", ")", "\n", "output_layer", "=", "highway", "(", "gcn_layer_1", ",", "gcn_layer_2", ",", "dimension", ")", "\n", "\n", "loss", "=", "get_loss", "(", "output_layer", ",", "ILL", ",", "gamma", ",", "k", ")", "\n", "return", "output_layer", ",", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.get_neg": [[260, 273], ["len", "np.array", "np.array", "scipy.spatial.distance.cdist", "range", "np.array", "neg.reshape.reshape", "sim[].argsort", "neg.reshape.append"], "function", ["None"], ["", "def", "get_neg", "(", "ILL", ",", "output_layer", ",", "k", ")", ":", "\n", "    ", "neg", "=", "[", "]", "\n", "t", "=", "len", "(", "ILL", ")", "\n", "ILL_vec", "=", "np", ".", "array", "(", "[", "output_layer", "[", "e1", "]", "for", "e1", "in", "ILL", "]", ")", "\n", "KG_vec", "=", "np", ".", "array", "(", "output_layer", ")", "\n", "sim", "=", "scipy", ".", "spatial", ".", "distance", ".", "cdist", "(", "ILL_vec", ",", "KG_vec", ",", "metric", "=", "'cityblock'", ")", "\n", "for", "i", "in", "range", "(", "t", ")", ":", "\n", "        ", "rank", "=", "sim", "[", "i", ",", ":", "]", ".", "argsort", "(", ")", "\n", "neg", ".", "append", "(", "rank", "[", "0", ":", "k", "]", ")", "\n", "\n", "", "neg", "=", "np", ".", "array", "(", "neg", ")", "\n", "neg", "=", "neg", ".", "reshape", "(", "(", "t", "*", "k", ",", ")", ")", "\n", "return", "neg", "\n", "\n"]], "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.training": [[275, 309], ["tf.train.AdamOptimizer().minimize", "print", "tf.global_variables_initializer", "tf.Session", "tf.Session.run", "print", "len", "np.array", "L.reshape", "L.reshape", "range", "tf.Session.run", "tf.Session.close", "np.ones", "ILL[].reshape", "np.ones", "ILL[].reshape", "tf.Session.run", "print", "tf.train.AdamOptimizer", "tf.Session.run", "Model.get_neg", "Model.get_neg", "tf.Session.run", "J.append", "include.Test.get_hits"], "function", ["home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Init.ones", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Init.ones", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.get_neg", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Model.get_neg", "home.repos.pwc.inspect_result.StephanieWyt_RDGCN.include.Test.get_hits"], ["", "def", "training", "(", "output_layer", ",", "loss", ",", "learning_rate", ",", "epochs", ",", "ILL", ",", "e", ",", "k", ",", "test", ")", ":", "\n", "    ", "train_step", "=", "tf", ".", "train", ".", "AdamOptimizer", "(", "learning_rate", ")", ".", "minimize", "(", "loss", ")", "\n", "print", "(", "'initializing...'", ")", "\n", "init", "=", "tf", ".", "global_variables_initializer", "(", ")", "\n", "sess", "=", "tf", ".", "Session", "(", ")", "\n", "sess", ".", "run", "(", "init", ")", "\n", "print", "(", "'running...'", ")", "\n", "J", "=", "[", "]", "\n", "t", "=", "len", "(", "ILL", ")", "\n", "ILL", "=", "np", ".", "array", "(", "ILL", ")", "\n", "L", "=", "np", ".", "ones", "(", "(", "t", ",", "k", ")", ")", "*", "(", "ILL", "[", ":", ",", "0", "]", ".", "reshape", "(", "(", "t", ",", "1", ")", ")", ")", "\n", "neg_left", "=", "L", ".", "reshape", "(", "(", "t", "*", "k", ",", ")", ")", "\n", "L", "=", "np", ".", "ones", "(", "(", "t", ",", "k", ")", ")", "*", "(", "ILL", "[", ":", ",", "1", "]", ".", "reshape", "(", "(", "t", ",", "1", ")", ")", ")", "\n", "neg2_right", "=", "L", ".", "reshape", "(", "(", "t", "*", "k", ",", ")", ")", "\n", "for", "i", "in", "range", "(", "epochs", ")", ":", "\n", "        ", "if", "i", "%", "10", "==", "0", ":", "\n", "            ", "out", "=", "sess", ".", "run", "(", "output_layer", ")", "\n", "neg2_left", "=", "get_neg", "(", "ILL", "[", ":", ",", "1", "]", ",", "out", ",", "k", ")", "\n", "neg_right", "=", "get_neg", "(", "ILL", "[", ":", ",", "0", "]", ",", "out", ",", "k", ")", "\n", "feeddict", "=", "{", "\"neg_left:0\"", ":", "neg_left", ",", "\n", "\"neg_right:0\"", ":", "neg_right", ",", "\n", "\"neg2_left:0\"", ":", "neg2_left", ",", "\n", "\"neg2_right:0\"", ":", "neg2_right", "}", "\n", "\n", "", "_", ",", "th", "=", "sess", ".", "run", "(", "[", "train_step", ",", "loss", "]", ",", "feed_dict", "=", "feeddict", ")", "\n", "if", "i", "%", "10", "==", "0", ":", "\n", "            ", "th", ",", "outvec", "=", "sess", ".", "run", "(", "[", "loss", ",", "output_layer", "]", ",", "feed_dict", "=", "feeddict", ")", "\n", "J", ".", "append", "(", "th", ")", "\n", "get_hits", "(", "outvec", ",", "test", ")", "\n", "\n", "", "print", "(", "'%d/%d'", "%", "(", "i", "+", "1", ",", "epochs", ")", ",", "'epochs...'", ",", "th", ")", "\n", "", "outvec", "=", "sess", ".", "run", "(", "output_layer", ")", "\n", "sess", ".", "close", "(", ")", "\n", "return", "outvec", ",", "J", "\n", "", ""]]}