{"home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.train.train": [[27, 114], ["tensorflow.placeholder", "tensorflow.placeholder", "model.C3D", "tensorflow.Variable", "tensorflow.trainable_variables", "tensorflow.train.exponential_decay", "tensorflow.train.exponential_decay", "tensorflow.train.MomentumOptimizer", "tensorflow.train.MomentumOptimizer", "tensorflow.reduce_mean", "tensorflow.add_n", "tensorflow.summary.scalar", "tensorflow.summary.scalar", "tensorflow.summary.scalar", "tf.train.MomentumOptimizer.compute_gradients", "tf.train.MomentumOptimizer.compute_gradients", "tf.train.MomentumOptimizer.apply_gradients", "tf.train.MomentumOptimizer.apply_gradients", "tensorflow.group", "tensorflow.train.Saver", "tensorflow.summary.merge_all", "tensorflow.squared_difference", "tensorflow.get_collection", "tensorflow.Session", "tensorflow.summary.FileWriter", "tensorflow.global_variables_initializer", "sess.run", "range", "varlist_weight.append", "time.time", "input_data.read_all", "print", "sess.run", "print", "varlist_bias.append", "time.time", "print", "print", "tf.summary.FileWriter.add_summary", "time.time", "tf.train.Saver.save", "os.path.join"], "function", ["home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.model.C3D", "home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.input_data.read_all"], ["def", "train", "(", ")", ":", "\n", "    ", "img_input", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "shape", "=", "(", "FLAGS", ".", "batch_size", ",", "16", ",", "112", ",", "112", ",", "3", ")", ")", "\n", "y_target", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "shape", "=", "(", "FLAGS", ".", "batch_size", ",", "FLAGS", ".", "dimension", ")", ")", "\n", "\n", "y", "=", "model", ".", "C3D", "(", "img_input", ",", "dimensions", "=", "FLAGS", ".", "dimension", ",", "dropout", "=", "False", ",", "regularizer", "=", "True", ")", "# not label!", "\n", "\n", "global_step", "=", "tf", ".", "Variable", "(", "0", ",", "trainable", "=", "False", ")", "\n", "\n", "varlist_weight", "=", "[", "]", "\n", "varlist_bias", "=", "[", "]", "\n", "trainable_variables", "=", "tf", ".", "trainable_variables", "(", ")", "\n", "for", "var", "in", "trainable_variables", ":", "\n", "        ", "if", "'weight'", "in", "var", ".", "name", ":", "\n", "            ", "varlist_weight", ".", "append", "(", "var", ")", "\n", "", "elif", "'bias'", "in", "var", ".", "name", ":", "\n", "            ", "varlist_bias", ".", "append", "(", "var", ")", "\n", "\n", "", "", "lr_weight", "=", "tf", ".", "train", ".", "exponential_decay", "(", "FLAGS", ".", "base_lr", ",", "global_step", ",", "20000", ",", "0.1", ",", "\n", "staircase", "=", "True", ")", "\n", "lr_bias", "=", "tf", ".", "train", ".", "exponential_decay", "(", "FLAGS", ".", "base_lr", "*", "2", ",", "global_step", ",", "20000", ",", "0.1", ",", "\n", "staircase", "=", "True", ")", "\n", "\n", "opt_weight", "=", "tf", ".", "train", ".", "MomentumOptimizer", "(", "lr_weight", ",", "momentum", "=", "momentum", ")", "\n", "opt_bias", "=", "tf", ".", "train", ".", "MomentumOptimizer", "(", "lr_bias", ",", "momentum", "=", "momentum", ")", "\n", "\n", "mse_loss", "=", "tf", ".", "reduce_mean", "(", "tf", ".", "squared_difference", "(", "y", ",", "y_target", ")", ")", "\n", "\n", "weight_decay_loss", "=", "tf", ".", "add_n", "(", "tf", ".", "get_collection", "(", "'weight_decay_loss'", ")", ")", "\n", "\n", "loss", "=", "mse_loss", "+", "weight_decay_loss", "\n", "\n", "tf", ".", "summary", ".", "scalar", "(", "'mse_loss'", ",", "mse_loss", ")", "\n", "tf", ".", "summary", ".", "scalar", "(", "'weight_decay_loss'", ",", "weight_decay_loss", ")", "\n", "tf", ".", "summary", ".", "scalar", "(", "'total_loss'", ",", "loss", ")", "\n", "\n", "grad_weight", "=", "opt_weight", ".", "compute_gradients", "(", "loss", ",", "varlist_weight", ")", "\n", "grad_bias", "=", "opt_bias", ".", "compute_gradients", "(", "loss", ",", "varlist_bias", ")", "\n", "apply_gradient_op_weight", "=", "opt_weight", ".", "apply_gradients", "(", "grad_weight", ")", "\n", "apply_gradient_op_bias", "=", "opt_bias", ".", "apply_gradients", "(", "grad_bias", ",", "global_step", "=", "global_step", ")", "\n", "train_op", "=", "tf", ".", "group", "(", "apply_gradient_op_weight", ",", "apply_gradient_op_bias", ")", "\n", "\n", "saver", "=", "tf", ".", "train", ".", "Saver", "(", ")", "\n", "merged", "=", "tf", ".", "summary", ".", "merge_all", "(", ")", "\n", "\n", "rgb_list", "=", "'list/rgb_train_linux.list'", "\n", "u_flow_list", "=", "'list/u_flow_train_linux.list'", "\n", "v_flow_list", "=", "'list/v_flow_train_linux.list'", "\n", "\n", "\n", "with", "tf", ".", "Session", "(", ")", "as", "sess", ":", "\n", "        ", "train_writer", "=", "tf", ".", "summary", ".", "FileWriter", "(", "'./visual_logs/train'", ",", "sess", ".", "graph", ")", "\n", "init", "=", "tf", ".", "global_variables_initializer", "(", ")", "\n", "sess", ".", "run", "(", "init", ")", "\n", "\n", "for", "i", "in", "range", "(", "FLAGS", ".", "max_iter", ")", ":", "\n", "            ", "start_time", "=", "time", ".", "time", "(", ")", "\n", "\n", "train_images", ",", "train_labels", ",", "next_batch_start", "=", "input_data", ".", "read_all", "(", "\n", "rgb_filename", "=", "rgb_list", ",", "\n", "u_flow_filename", "=", "u_flow_list", ",", "\n", "v_flow_filename", "=", "v_flow_list", ",", "\n", "batch_size", "=", "FLAGS", ".", "batch_size", ",", "\n", "start_pos", "=", "-", "1", ",", "\n", "shuffle", "=", "True", ",", "\n", "cpu_num", "=", "FLAGS", ".", "cpu_num", "\n", ")", "\n", "\n", "\n", "duration", "=", "time", ".", "time", "(", ")", "-", "start_time", "\n", "print", "(", "'read data time %.3f sec'", "%", "(", "duration", ")", ")", "\n", "\n", "summary", ",", "loss_value", ",", "ce_loss", ",", "_", ",", "old_weight", "=", "sess", ".", "run", "(", "[", "\n", "merged", ",", "loss", ",", "mse_loss", ",", "train_op", ",", "grad_weight", "]", ",", "feed_dict", "=", "{", "\n", "img_input", ":", "train_images", ",", "\n", "y_target", ":", "train_labels", "\n", "}", ")", "\n", "\n", "if", "i", "%", "(", "FLAGS", ".", "display", ")", "==", "0", ":", "\n", "                ", "print", "(", "\"mse_loss:\"", ",", "ce_loss", ")", "\n", "print", "(", "\"loss:\"", ",", "loss_value", ")", "\n", "train_writer", ".", "add_summary", "(", "summary", ",", "i", ")", "\n", "", "duration", "=", "time", ".", "time", "(", ")", "-", "start_time", "\n", "print", "(", "'Step %d: %.3f sec'", "%", "(", "i", ",", "duration", ")", ")", "\n", "\n", "\n", "if", "i", "%", "1000", "==", "0", ":", "\n", "                ", "saver", ".", "save", "(", "sess", ",", "os", ".", "path", ".", "join", "(", "FLAGS", ".", "model_save_path", ",", "model_name", ")", ",", "global_step", "=", "global_step", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.train.main": [[116, 118], ["train.train"], "function", ["home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.train.train"], ["", "", "", "", "def", "main", "(", "_", ")", ":", "\n", "    ", "train", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.input_data.read_batch": [[24, 193], ["int", "random.randint", "random.randint", "range", "numpy.array().astype", "range", "range", "cv2.cartToPolar", "cv2.cartToPolar", "comput_motion_statistics_fast.pattern_1", "comput_motion_statistics_fast.pattern_1", "comput_motion_statistics_fast.pattern_2", "comput_motion_statistics_fast.pattern_2", "comput_motion_statistics_fast.pattern_3", "comput_motion_statistics_fast.pattern_3", "range", "numpy.array", "range", "numpy.array", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "numpy.array", "os.path.join", "cv2.imread", "cv2.resize", "cv2.resize.astype", "np.array().astype.append", "os.path.join", "cv2.imread", "cv2.resize", "cv2.resize.astype", "numpy.array", "numpy.array", "scipy.ndimage.convolve", "scipy.ndimage.convolve", "du_x_all.append", "du_y_all.append", "os.path.join", "cv2.imread", "cv2.resize", "cv2.resize.astype", "numpy.array", "numpy.array", "scipy.ndimage.convolve", "scipy.ndimage.convolve", "dv_x_all.append", "dv_y_all.append", "cv2.cartToPolar", "numpy.sum", "np.array.append", "numpy.argmax", "cv2.cartToPolar", "numpy.sum", "np.array.append", "numpy.argmax", "numpy.array"], "function", ["home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.comput_motion_statistics_fast.pattern_1", "home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.comput_motion_statistics_fast.pattern_1", "home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.comput_motion_statistics_fast.pattern_2", "home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.comput_motion_statistics_fast.pattern_2", "home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.comput_motion_statistics_fast.pattern_3", "home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.comput_motion_statistics_fast.pattern_3"], ["def", "read_batch", "(", "input", ")", ":", "\n", "\n", "    ", "rgb_line", ",", "u_flow_line", ",", "v_flow_line", "=", "input", "\n", "\n", "\n", "\n", "\n", "rgb_img_dir", "=", "rgb_line", "[", "0", "]", "\n", "start_frame", "=", "int", "(", "rgb_line", "[", "1", "]", ")", "\n", "\n", "\n", "crop_x", "=", "random", ".", "randint", "(", "0", ",", "new_height", "-", "crop_size", ")", "# crop size should be applied to all images", "\n", "crop_y", "=", "random", ".", "randint", "(", "0", ",", "new_width", "-", "crop_size", ")", "\n", "clip_sample_one", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "clip_length", ")", ":", "\n", "        ", "cur_img_path", "=", "os", ".", "path", ".", "join", "(", "rgb_img_dir", ",", "\"frame\"", "+", "\"{:06}.jpg\"", ".", "format", "(", "start_frame", "+", "i", ")", ")", "\n", "\n", "img_origin", "=", "cv2", ".", "imread", "(", "cur_img_path", ")", "\n", "\n", "img_res", "=", "cv2", ".", "resize", "(", "img_origin", ",", "(", "171", ",", "128", ")", ")", "\n", "img", "=", "img_res", ".", "astype", "(", "np", ".", "float32", ")", "\n", "\n", "img", "=", "img", "[", "crop_x", ":", "crop_x", "+", "crop_size", ",", "crop_y", ":", "crop_y", "+", "crop_size", ",", ":", "]", "\n", "\n", "clip_sample_one", ".", "append", "(", "img", ")", "\n", "\n", "", "clip_sample_one", "=", "np", ".", "array", "(", "clip_sample_one", ")", ".", "astype", "(", "np", ".", "float32", ")", "# 16 x 112 x 112 x 3", "\n", "\n", "u_flow_dir", "=", "u_flow_line", "[", "0", "]", "\n", "\n", "v_flow_dir", "=", "v_flow_line", "[", "0", "]", "\n", "\n", "label_sample_one", "=", "[", "]", "\n", "# compute sum of motion boundaries on u_flow", "\n", "du_x", "=", "0", "\n", "du_y", "=", "0", "\n", "\n", "du_x_all", "=", "[", "]", "\n", "du_y_all", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "clip_length", "-", "1", ")", ":", "\n", "        ", "cur_img_path", "=", "os", ".", "path", ".", "join", "(", "u_flow_dir", ",", "'frame'", "+", "'{:06}.jpg'", ".", "format", "(", "start_frame", "+", "i", ")", ")", "\n", "img", "=", "cv2", ".", "imread", "(", "cur_img_path", ")", "\n", "img", "=", "img", "[", "...", ",", "0", "]", "\n", "img", "=", "cv2", ".", "resize", "(", "img", ",", "(", "171", ",", "128", ")", ")", "\n", "\n", "u_flow", "=", "img", ".", "astype", "(", "np", ".", "float32", ")", "\n", "u_flow", "=", "(", "(", "u_flow", "*", "40.", ")", "/", "255.", ")", "-", "20", "\n", "\n", "\n", "u_flow", "=", "u_flow", "[", "crop_x", ":", "crop_x", "+", "crop_size", ",", "crop_y", ":", "crop_y", "+", "crop_size", "]", "\n", "\n", "\n", "mx", "=", "np", ".", "array", "(", "[", "[", "-", "1", ",", "0", ",", "1", "]", ",", "[", "-", "1", ",", "0", ",", "1", "]", ",", "[", "-", "1", ",", "0", ",", "1", "]", "]", ")", "\n", "my", "=", "np", ".", "array", "(", "[", "[", "-", "1", ",", "-", "1", ",", "-", "1", "]", ",", "[", "0", ",", "0", ",", "0", "]", ",", "[", "1", ",", "1", ",", "1", "]", "]", ")", "\n", "\n", "d_x", "=", "ndimage", ".", "convolve", "(", "u_flow", ",", "mx", ")", "\n", "d_y", "=", "ndimage", ".", "convolve", "(", "u_flow", ",", "my", ")", "\n", "\n", "du_x_all", ".", "append", "(", "d_x", ")", "\n", "du_y_all", ".", "append", "(", "d_y", ")", "\n", "\n", "du_x", "+=", "d_x", "\n", "du_y", "+=", "d_y", "\n", "\n", "# compute sum of motion boundaries on v_flow", "\n", "", "dv_x", "=", "0", "\n", "dv_y", "=", "0", "\n", "\n", "dv_x_all", "=", "[", "]", "\n", "dv_y_all", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "clip_length", "-", "1", ")", ":", "\n", "        ", "cur_img_path", "=", "os", ".", "path", ".", "join", "(", "v_flow_dir", ",", "'frame'", "+", "'{:06}.jpg'", ".", "format", "(", "start_frame", "+", "i", ")", ")", "\n", "img", "=", "cv2", ".", "imread", "(", "cur_img_path", ")", "\n", "img", "=", "img", "[", "...", ",", "0", "]", "\n", "img", "=", "cv2", ".", "resize", "(", "img", ",", "(", "171", ",", "128", ")", ")", "\n", "\n", "v_flow", "=", "img", ".", "astype", "(", "np", ".", "float32", ")", "\n", "v_flow", "=", "(", "(", "v_flow", "*", "40.", ")", "/", "255.", ")", "-", "20", "\n", "\n", "\n", "v_flow", "=", "v_flow", "[", "crop_x", ":", "crop_x", "+", "crop_size", ",", "crop_y", ":", "crop_y", "+", "crop_size", "]", "\n", "\n", "\n", "\n", "mx", "=", "np", ".", "array", "(", "[", "[", "-", "1", ",", "0", ",", "1", "]", ",", "[", "-", "1", ",", "0", ",", "1", "]", ",", "[", "-", "1", ",", "0", ",", "1", "]", "]", ")", "\n", "my", "=", "np", ".", "array", "(", "[", "[", "-", "1", ",", "-", "1", ",", "-", "1", "]", ",", "[", "0", ",", "0", ",", "0", "]", ",", "[", "1", ",", "1", ",", "1", "]", "]", ")", "\n", "\n", "d_x", "=", "ndimage", ".", "convolve", "(", "v_flow", ",", "mx", ")", "\n", "d_y", "=", "ndimage", ".", "convolve", "(", "v_flow", ",", "my", ")", "\n", "\n", "dv_x_all", ".", "append", "(", "d_x", ")", "\n", "dv_y_all", ".", "append", "(", "d_y", ")", "\n", "\n", "dv_x", "+=", "d_x", "\n", "dv_y", "+=", "d_y", "\n", "\n", "", "mag_u", ",", "ang_u", "=", "cv2", ".", "cartToPolar", "(", "du_x", ",", "du_y", ",", "angleInDegrees", "=", "True", ")", "\n", "mag_v", ",", "ang_v", "=", "cv2", ".", "cartToPolar", "(", "dv_x", ",", "dv_y", ",", "angleInDegrees", "=", "True", ")", "\n", "\n", "\n", "u_max_mag_1", ",", "u_max_ang_1", "=", "pattern_1", "(", "mag_u", ",", "ang_u", ")", "\n", "v_max_mag_1", ",", "v_max_ang_1", "=", "pattern_1", "(", "mag_v", ",", "ang_v", ")", "\n", "\n", "u_max_mag_2", ",", "u_max_ang_2", "=", "pattern_2", "(", "mag_u", ",", "ang_u", ")", "\n", "v_max_mag_2", ",", "v_max_ang_2", "=", "pattern_2", "(", "mag_v", ",", "ang_v", ")", "\n", "\n", "u_max_mag_3", ",", "u_max_ang_3", "=", "pattern_3", "(", "mag_u", ",", "ang_u", ")", "\n", "v_max_mag_3", ",", "v_max_ang_3", "=", "pattern_3", "(", "mag_v", ",", "ang_v", ")", "\n", "\n", "\n", "\n", "\n", "### compute max du_all", "\n", "\n", "du_sum_mag", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "15", ")", ":", "\n", "        ", "cur_du_x", "=", "du_x_all", "[", "i", "]", "\n", "cur_du_y", "=", "du_y_all", "[", "i", "]", "\n", "mag_u", ",", "ang_u", "=", "cv2", ".", "cartToPolar", "(", "cur_du_x", ",", "cur_du_y", ",", "angleInDegrees", "=", "True", ")", "\n", "tmp_sum_mag", "=", "np", ".", "sum", "(", "mag_u", ")", "\n", "du_sum_mag", ".", "append", "(", "tmp_sum_mag", ")", "\n", "\n", "", "du_sum_mag", "=", "np", ".", "array", "(", "du_sum_mag", ")", "\n", "max_du_idx", "=", "np", ".", "argmax", "(", "du_sum_mag", ")", "+", "1", "# start from 1", "\n", "\n", "\n", "### compute max dv_all", "\n", "\n", "dv_sum_mag", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "15", ")", ":", "\n", "        ", "cur_dv_x", "=", "dv_x_all", "[", "i", "]", "\n", "cur_dv_y", "=", "dv_y_all", "[", "i", "]", "\n", "\n", "mag_v", ",", "ang_v", "=", "cv2", ".", "cartToPolar", "(", "cur_dv_x", ",", "cur_dv_y", ",", "angleInDegrees", "=", "True", ")", "\n", "tmp_sum_mag", "=", "np", ".", "sum", "(", "mag_v", ")", "\n", "dv_sum_mag", ".", "append", "(", "tmp_sum_mag", ")", "\n", "\n", "", "dv_sum_mag", "=", "np", ".", "array", "(", "dv_sum_mag", ")", "\n", "max_dv_idx", "=", "np", ".", "argmax", "(", "dv_sum_mag", ")", "+", "1", "# start from 1", "\n", "\n", "\n", "\n", "\n", "label_sample_one", ".", "append", "(", "u_max_mag_1", ")", "\n", "label_sample_one", ".", "append", "(", "u_max_ang_1", ")", "\n", "label_sample_one", ".", "append", "(", "v_max_mag_1", ")", "\n", "label_sample_one", ".", "append", "(", "v_max_ang_1", ")", "\n", "\n", "label_sample_one", ".", "append", "(", "u_max_mag_2", ")", "\n", "label_sample_one", ".", "append", "(", "u_max_ang_2", ")", "\n", "label_sample_one", ".", "append", "(", "v_max_mag_2", ")", "\n", "label_sample_one", ".", "append", "(", "v_max_ang_2", ")", "\n", "\n", "label_sample_one", ".", "append", "(", "u_max_mag_3", ")", "\n", "label_sample_one", ".", "append", "(", "u_max_ang_3", ")", "\n", "label_sample_one", ".", "append", "(", "v_max_mag_3", ")", "\n", "label_sample_one", ".", "append", "(", "v_max_ang_3", ")", "\n", "\n", "label_sample_one", ".", "append", "(", "max_du_idx", ")", "\n", "label_sample_one", ".", "append", "(", "max_dv_idx", ")", "\n", "\n", "label_sample_one", "=", "np", ".", "array", "(", "label_sample_one", ")", "\n", "\n", "\n", "\n", "return", "clip_sample_one", ",", "label_sample_one", "\n", "\n"]], "home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.input_data.read_all": [[195, 254], ["open", "list", "open", "list", "open", "list", "multiprocessing.Pool", "multiprocessing.Pool.map", "multiprocessing.Pool.close", "multiprocessing.Pool.join", "numpy.array().astype", "numpy.array().astype", "list", "random.shuffle", "range", "train_clips.append", "label.append", "range", "len", "rgb_lines[].strip().split", "u_flow_lines[].strip().split", "v_flow_lines[].strip().split", "lines_batch.append", "numpy.array", "numpy.array", "len", "rgb_lines[].strip", "u_flow_lines[].strip", "v_flow_lines[].strip"], "function", ["None"], ["", "def", "read_all", "(", "rgb_filename", ",", "u_flow_filename", ",", "v_flow_filename", ",", "batch_size", ",", "start_pos", "=", "-", "1", ",", "shuffle", "=", "True", ",", "cpu_num", "=", "1", ")", ":", "\n", "    ", "rgb_lines", "=", "open", "(", "rgb_filename", ",", "'r'", ")", "\n", "rgb_lines", "=", "list", "(", "rgb_lines", ")", "\n", "\n", "u_flow_lines", "=", "open", "(", "u_flow_filename", ",", "'r'", ")", "\n", "u_flow_lines", "=", "list", "(", "u_flow_lines", ")", "\n", "\n", "v_flow_lines", "=", "open", "(", "v_flow_filename", ",", "'r'", ")", "\n", "v_flow_lines", "=", "list", "(", "v_flow_lines", ")", "\n", "\n", "batch_index", "=", "0", "\n", "next_batch_start", "=", "-", "1", "\n", "\n", "train_clips", "=", "[", "]", "\n", "label", "=", "[", "]", "\n", "\n", "\n", "if", "start_pos", "<", "0", ":", "\n", "        ", "shuffle", "=", "True", "\n", "\n", "", "if", "shuffle", ":", "\n", "        ", "video_indices", "=", "list", "(", "range", "(", "len", "(", "rgb_lines", ")", ")", ")", "\n", "random", ".", "shuffle", "(", "video_indices", ")", "# shuffle index!", "\n", "", "else", ":", "\n", "        ", "video_indices", "=", "range", "(", "start_pos", ",", "len", "(", "rgb_lines", ")", ")", "\n", "\n", "", "lines_batch", "=", "[", "]", "\n", "for", "index", "in", "video_indices", ":", "\n", "\n", "        ", "if", "(", "batch_index", ">=", "batch_size", ")", ":", "# get 30 samples", "\n", "            ", "next_batch_start", "=", "index", "\n", "break", "\n", "", "else", ":", "\n", "            ", "rgb_line", "=", "rgb_lines", "[", "index", "]", ".", "strip", "(", "'\\n'", ")", ".", "split", "(", ")", "\n", "#print(rgb_line)", "\n", "u_flow_line", "=", "u_flow_lines", "[", "index", "]", ".", "strip", "(", "'\\n'", ")", ".", "split", "(", ")", "\n", "v_flow_line", "=", "v_flow_lines", "[", "index", "]", ".", "strip", "(", "'\\n'", ")", ".", "split", "(", ")", "\n", "lines_batch", ".", "append", "(", "(", "rgb_line", ",", "u_flow_line", ",", "v_flow_line", ")", ")", "\n", "batch_index", "=", "batch_index", "+", "1", "\n", "\n", "", "", "data", "=", "(", "lines_batch", ")", "\n", "p", "=", "multiprocessing", ".", "Pool", "(", "processes", "=", "cpu_num", ")", "\n", "\n", "results", "=", "p", ".", "map", "(", "read_batch", ",", "data", ")", "# results: 16 x 8", "\n", "\n", "p", ".", "close", "(", ")", "\n", "p", ".", "join", "(", ")", "\n", "\n", "train_clips", "=", "[", "]", "\n", "label", "=", "[", "]", "\n", "for", "result", "in", "results", ":", "# 30 x 16 x 112 x 112 x 3 label: 30 x 1", "\n", "        ", "sample_one", ",", "label_one", "=", "result", "\n", "train_clips", ".", "append", "(", "sample_one", ")", "\n", "label", ".", "append", "(", "label_one", ")", "\n", "\n", "", "np_train_clips", "=", "np", ".", "array", "(", "train_clips", ")", ".", "astype", "(", "np", ".", "float32", ")", "# N x 16 x 112 x 112 x 3", "\n", "np_arr_label", "=", "np", ".", "array", "(", "label", ")", ".", "astype", "(", "np", ".", "float32", ")", "\n", "\n", "return", "np_train_clips", ",", "np_arr_label", ",", "next_batch_start", "\n", "\n"]], "home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.model.C3D": [[7, 59], ["tensorflow.contrib.layers.l2_regularizer", "tensorflow.variable_scope", "slim.max_pool3d.get_shape().as_list", "tensorflow.reshape", "tensorflow.arg_scope", "tensorflow.conv3d", "tensorflow.max_pool3d", "tensorflow.conv3d", "tensorflow.max_pool3d", "tensorflow.conv3d", "tensorflow.max_pool3d", "tensorflow.conv3d", "tensorflow.max_pool3d", "tensorflow.conv3d", "tensorflow.max_pool3d", "tensorflow.variable_scope", "tensorflow.get_variable", "tensorflow.get_variable", "tensorflow.nn.relu", "tensorflow.variable_scope", "tensorflow.get_variable", "tensorflow.get_variable", "tensorflow.nn.relu", "tensorflow.variable_scope", "tensorflow.get_variable", "tensorflow.get_variable", "slim.max_pool3d.get_shape", "tensorflow.add_to_collection", "tensorflow.nn.dropout", "tensorflow.add_to_collection", "tensorflow.nn.dropout", "tensorflow.add_to_collection", "tensorflow.matmul", "tensorflow.random_normal_initializer", "tensorflow.random_normal_initializer", "tf.contrib.layers.l2_regularizer.", "tensorflow.constant_initializer", "tensorflow.matmul", "tensorflow.random_normal_initializer", "tf.contrib.layers.l2_regularizer.", "tensorflow.constant_initializer", "tensorflow.matmul", "tensorflow.random_normal_initializer", "tf.contrib.layers.l2_regularizer.", "tensorflow.constant_initializer"], "function", ["None"], ["def", "C3D", "(", "input", ",", "dimensions", ",", "dropout", "=", "False", ",", "regularizer", "=", "True", ")", ":", "\n", "\n", "    ", "if", "regularizer", ":", "regularizer", "=", "tf", ".", "contrib", ".", "layers", ".", "l2_regularizer", "(", "0.005", ")", "# 0.005", "\n", "\n", "with", "tf", ".", "variable_scope", "(", "'C3D'", ")", ":", "\n", "        ", "with", "slim", ".", "arg_scope", "(", "[", "slim", ".", "conv3d", "]", ",", "\n", "padding", "=", "'SAME'", ",", "\n", "weights_initializer", "=", "tf", ".", "random_normal_initializer", "(", "stddev", "=", "0.01", ")", "\n", "#weights_regularizer=slim.l2_regularizer(0.0005)", "\n", ")", ":", "\n", "            ", "conv_1", "=", "slim", ".", "conv3d", "(", "input", ",", "64", ",", "3", ",", "1", ",", "scope", "=", "'conv_1'", ")", "\n", "maxpool_1", "=", "slim", ".", "max_pool3d", "(", "conv_1", ",", "kernel_size", "=", "[", "1", ",", "2", ",", "2", "]", ",", "stride", "=", "[", "1", ",", "2", ",", "2", "]", ",", "padding", "=", "'SAME'", ",", "scope", "=", "'maxpool_1'", ")", "\n", "conv_2", "=", "slim", ".", "conv3d", "(", "maxpool_1", ",", "128", ",", "3", ",", "1", ",", "scope", "=", "'conv_2'", ")", "\n", "maxpool_2", "=", "slim", ".", "max_pool3d", "(", "conv_2", ",", "[", "2", ",", "2", ",", "2", "]", ",", "[", "2", ",", "2", ",", "2", "]", ",", "padding", "=", "'SAME'", ",", "scope", "=", "'maxpool_2'", ")", "\n", "conv_3", "=", "slim", ".", "conv3d", "(", "maxpool_2", ",", "256", ",", "3", ",", "1", ",", "scope", "=", "'conv_3'", ")", "\n", "maxpool_3", "=", "slim", ".", "max_pool3d", "(", "conv_3", ",", "[", "2", ",", "2", ",", "2", "]", ",", "[", "2", ",", "2", ",", "2", "]", ",", "padding", "=", "'SAME'", ",", "scope", "=", "'maxpool_3'", ")", "\n", "conv_4", "=", "slim", ".", "conv3d", "(", "maxpool_3", ",", "256", ",", "3", ",", "1", ",", "scope", "=", "'conv_4'", ")", "\n", "maxpool_4", "=", "slim", ".", "max_pool3d", "(", "conv_4", ",", "[", "2", ",", "2", ",", "2", "]", ",", "[", "2", ",", "2", ",", "2", "]", ",", "padding", "=", "'SAME'", ",", "scope", "=", "'maxpool_4'", ")", "\n", "conv_5", "=", "slim", ".", "conv3d", "(", "maxpool_4", ",", "256", ",", "3", ",", "1", ",", "scope", "=", "'conv_5'", ")", "\n", "maxpool_5", "=", "slim", ".", "max_pool3d", "(", "conv_5", ",", "[", "2", ",", "2", ",", "2", "]", ",", "[", "2", ",", "2", ",", "2", "]", ",", "padding", "=", "'SAME'", ",", "scope", "=", "'maxpool_5'", ")", "\n", "\n", "", "pool_shape", "=", "maxpool_5", ".", "get_shape", "(", ")", ".", "as_list", "(", ")", "\n", "nodes", "=", "pool_shape", "[", "1", "]", "*", "pool_shape", "[", "2", "]", "*", "pool_shape", "[", "3", "]", "*", "pool_shape", "[", "4", "]", "# 1 x 4 x 4 x 256 = 4096", "\n", "reshaped", "=", "tf", ".", "reshape", "(", "maxpool_5", ",", "[", "pool_shape", "[", "0", "]", ",", "nodes", "]", ")", "# pool_shape[0] is N, batch_size", "\n", "\n", "with", "tf", ".", "variable_scope", "(", "'fc6'", ")", ":", "\n", "            ", "fc6_weight", "=", "tf", ".", "get_variable", "(", "'weight'", ",", "[", "nodes", ",", "2048", "]", ",", "\n", "initializer", "=", "tf", ".", "random_normal_initializer", "(", "stddev", "=", "0.005", ")", ")", "\n", "if", "regularizer", ":", "\n", "                ", "tf", ".", "add_to_collection", "(", "\"weight_decay_loss\"", ",", "regularizer", "(", "fc6_weight", ")", ")", "\n", "", "fc6_bias", "=", "tf", ".", "get_variable", "(", "'bias'", ",", "[", "2048", "]", ",", "initializer", "=", "tf", ".", "constant_initializer", "(", "1.0", ")", ")", "\n", "fc6", "=", "tf", ".", "nn", ".", "relu", "(", "tf", ".", "matmul", "(", "reshaped", ",", "fc6_weight", ")", "+", "fc6_bias", ")", "\n", "if", "dropout", ":", "\n", "                ", "fc6", "=", "tf", ".", "nn", ".", "dropout", "(", "fc6", ",", "0.5", ")", "\n", "\n", "", "", "with", "tf", ".", "variable_scope", "(", "'fc7'", ")", ":", "\n", "            ", "fc7_weight", "=", "tf", ".", "get_variable", "(", "'weight'", ",", "[", "2048", ",", "2048", "]", ",", "initializer", "=", "tf", ".", "random_normal_initializer", "(", "stddev", "=", "0.005", ")", ")", "\n", "if", "regularizer", ":", "\n", "                ", "tf", ".", "add_to_collection", "(", "\"weight_decay_loss\"", ",", "regularizer", "(", "fc7_weight", ")", ")", "\n", "", "fc7_bias", "=", "tf", ".", "get_variable", "(", "'bias'", ",", "[", "2048", "]", ",", "initializer", "=", "tf", ".", "constant_initializer", "(", "1.0", ")", ")", "\n", "fc7", "=", "tf", ".", "nn", ".", "relu", "(", "tf", ".", "matmul", "(", "fc6", ",", "fc7_weight", ")", "+", "fc7_bias", ")", "\n", "if", "dropout", ":", "\n", "                ", "fc7", "=", "tf", ".", "nn", ".", "dropout", "(", "fc7", ",", "0.5", ")", "\n", "\n", "", "", "with", "tf", ".", "variable_scope", "(", "'fc8'", ")", ":", "# fc8", "\n", "            ", "out_weight", "=", "tf", ".", "get_variable", "(", "'weight'", ",", "[", "2048", ",", "dimensions", "]", ",", "initializer", "=", "tf", ".", "random_normal_initializer", "(", "stddev", "=", "0.01", ")", ")", "\n", "if", "regularizer", ":", "\n", "                ", "tf", ".", "add_to_collection", "(", "\"weight_decay_loss\"", ",", "regularizer", "(", "out_weight", ")", ")", "\n", "", "out_bias", "=", "tf", ".", "get_variable", "(", "'bias'", ",", "[", "dimensions", "]", ",", "initializer", "=", "tf", ".", "constant_initializer", "(", "0.0", ")", ")", "\n", "out", "=", "tf", ".", "matmul", "(", "fc7", ",", "out_weight", ")", "+", "out_bias", "# DO NOT ADD RELU!!!", "\n", "\n", "", "return", "out", "", "", "", ""]], "home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.comput_motion_statistics_fast.cell_gradient": [[9, 21], ["range", "range", "int"], "function", ["None"], ["def", "cell_gradient", "(", "cell_magnitude", ",", "cell_angle", ")", ":", "\n", "    ", "orientation_centers", "=", "[", "0", "]", "*", "bin_size", "\n", "for", "k", "in", "range", "(", "cell_magnitude", ".", "shape", "[", "0", "]", ")", ":", "\n", "        ", "for", "l", "in", "range", "(", "cell_magnitude", ".", "shape", "[", "1", "]", ")", ":", "\n", "            ", "gradient_strength", "=", "cell_magnitude", "[", "k", "]", "[", "l", "]", "\n", "gradient_angle", "=", "cell_angle", "[", "k", "]", "[", "l", "]", "\n", "min_angle", "=", "int", "(", "gradient_angle", "/", "angle_unit", ")", "%", "8", "\n", "max_angle", "=", "(", "min_angle", "+", "1", ")", "%", "bin_size", "\n", "mod", "=", "gradient_angle", "%", "angle_unit", "\n", "orientation_centers", "[", "min_angle", "]", "+=", "(", "gradient_strength", "*", "(", "1", "-", "(", "mod", "/", "angle_unit", ")", ")", ")", "\n", "orientation_centers", "[", "max_angle", "]", "+=", "(", "gradient_strength", "*", "(", "mod", "/", "angle_unit", ")", ")", "\n", "", "", "return", "orientation_centers", "\n", "\n"]], "home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.comput_motion_statistics_fast.pattern_1": [[24, 60], ["range", "int", "comput_motion_statistics_fast.cell_gradient", "range", "numpy.argmax", "numpy.sum"], "function", ["home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.comput_motion_statistics_fast.cell_gradient"], ["", "def", "pattern_1", "(", "mag", ",", "ang", ")", ":", "\n", "\n", "    ", "max_sum", "=", "0", "\n", "max_idx", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "4", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "4", ")", ":", "\n", "            ", "x_start", "=", "i", "*", "28", "\n", "x_end", "=", "x_start", "+", "28", "\n", "y_start", "=", "j", "*", "28", "\n", "y_end", "=", "y_start", "+", "28", "\n", "\n", "tmp_block", "=", "mag", "[", "x_start", ":", "x_end", ",", "y_start", ":", "y_end", "]", "\n", "# print(tmp_block.shape)", "\n", "\n", "block_sum", "=", "np", ".", "sum", "(", "tmp_block", ")", "\n", "if", "block_sum", ">", "max_sum", ":", "\n", "                ", "max_sum", "=", "block_sum", "\n", "max_block", "=", "4", "*", "i", "+", "j", "+", "1", "\n", "\n", "", "", "", "j", "=", "(", "max_block", "-", "1", ")", "%", "4", "\n", "i", "=", "int", "(", "(", "max_block", "-", "1", "-", "j", ")", "/", "4", ")", "\n", "\n", "x_start", "=", "i", "*", "28", "\n", "x_end", "=", "x_start", "+", "28", "\n", "y_start", "=", "j", "*", "28", "\n", "y_end", "=", "y_start", "+", "28", "\n", "\n", "max_mag_block", "=", "mag", "[", "x_start", ":", "x_end", ",", "y_start", ":", "y_end", "]", "\n", "max_ang_block", "=", "ang", "[", "x_start", ":", "x_end", ",", "y_start", ":", "y_end", "]", "\n", "\n", "\n", "orientation_center", "=", "cell_gradient", "(", "max_mag_block", ",", "max_ang_block", ")", "\n", "\n", "max_idx", "=", "np", ".", "argmax", "(", "orientation_center", ")", "+", "1", "\n", "\n", "return", "max_block", ",", "max_idx", "\n", "\n"]], "home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.comput_motion_statistics_fast.pattern_2": [[63, 126], ["numpy.sum", "total_sum.append", "numpy.sum", "total_sum.append", "numpy.sum", "total_sum.append", "numpy.sum", "total_sum.append", "total_sum.index", "comput_motion_statistics_fast.cell_gradient", "numpy.argmax", "max", "numpy.zeros_like", "numpy.zeros_like", "numpy.zeros_like", "numpy.zeros_like", "numpy.zeros_like", "numpy.zeros_like"], "function", ["home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.comput_motion_statistics_fast.cell_gradient"], ["", "def", "pattern_2", "(", "mag", ",", "ang", ")", ":", "\n", "    ", "total_sum", "=", "[", "]", "\n", "block1", "=", "mag", "[", "42", ":", "70", ",", "42", ":", "70", "]", "# 28 x 28", "\n", "sum_1", "=", "np", ".", "sum", "(", "block1", ")", "\n", "block1_sum", "=", "sum_1", "/", "(", "28", "*", "28", ")", "\n", "total_sum", ".", "append", "(", "block1_sum", ")", "\n", "\n", "\n", "block2", "=", "mag", "[", "28", ":", "84", ",", "28", ":", "84", "]", "# 56 * 56", "\n", "sum_2", "=", "np", ".", "sum", "(", "block2", ")", "\n", "block2_sum", "=", "(", "sum_2", "-", "sum_1", ")", "/", "(", "56", "*", "56", "-", "28", "*", "28", ")", "\n", "total_sum", ".", "append", "(", "block2_sum", ")", "\n", "\n", "block3", "=", "mag", "[", "14", ":", "98", ",", "14", ":", "98", "]", "# 84 * 84", "\n", "sum_3", "=", "np", ".", "sum", "(", "block3", ")", "\n", "block3_sum", "=", "(", "sum_3", "-", "sum_2", ")", "/", "(", "84", "*", "84", "-", "56", "*", "56", ")", "\n", "total_sum", ".", "append", "(", "block3_sum", ")", "\n", "\n", "\n", "block4", "=", "mag", "[", "0", ":", "112", ",", "0", ":", "112", "]", "# 112 x 112", "\n", "sum_4", "=", "np", ".", "sum", "(", "block4", ")", "\n", "block4_sum", "=", "(", "sum_4", "-", "sum_3", ")", "/", "(", "112", "*", "112", "-", "84", "*", "84", ")", "\n", "total_sum", ".", "append", "(", "block4_sum", ")", "\n", "\n", "max_idx", "=", "total_sum", ".", "index", "(", "max", "(", "total_sum", ")", ")", "\n", "\n", "if", "max_idx", "==", "0", ":", "# block 1 28 x 28", "\n", "        ", "max_mag_block", "=", "mag", "[", "42", ":", "70", ",", "42", ":", "70", "]", "\n", "max_ang_block", "=", "ang", "[", "42", ":", "70", ",", "42", ":", "70", "]", "\n", "", "elif", "max_idx", "==", "1", ":", "# block 2 56 x 56", "\n", "        ", "tmp_mag", "=", "np", ".", "zeros_like", "(", "block2", ")", "\n", "tmp_mag", "[", "14", ":", "42", ",", "14", ":", "42", "]", "=", "mag", "[", "42", ":", "70", ",", "42", ":", "70", "]", "\n", "max_mag_block", "=", "mag", "[", "28", ":", "84", ",", "28", ":", "84", "]", "-", "tmp_mag", "\n", "\n", "tmp_ang", "=", "np", ".", "zeros_like", "(", "block2", ")", "\n", "tmp_ang", "[", "14", ":", "42", ",", "14", ":", "42", "]", "=", "ang", "[", "42", ":", "70", ",", "42", ":", "70", "]", "\n", "max_ang_block", "=", "ang", "[", "28", ":", "84", ",", "28", ":", "84", "]", "-", "tmp_ang", "\n", "\n", "", "elif", "max_idx", "==", "2", ":", "# block 3 84 x 84", "\n", "        ", "tmp_mag", "=", "np", ".", "zeros_like", "(", "block3", ")", "\n", "tmp_mag", "[", "14", ":", "70", ",", "14", ":", "70", "]", "=", "mag", "[", "28", ":", "84", ",", "28", ":", "84", "]", "\n", "max_mag_block", "=", "mag", "[", "14", ":", "98", ",", "14", ":", "98", "]", "-", "tmp_mag", "\n", "\n", "tmp_ang", "=", "np", ".", "zeros_like", "(", "block3", ")", "\n", "tmp_ang", "[", "14", ":", "70", ",", "14", ":", "70", "]", "=", "ang", "[", "28", ":", "84", ",", "28", ":", "84", "]", "\n", "max_ang_block", "=", "ang", "[", "14", ":", "98", ",", "14", ":", "98", "]", "-", "tmp_ang", "\n", "\n", "", "elif", "max_idx", "==", "3", ":", "# block 4 112 x 112", "\n", "        ", "tmp_mag", "=", "np", ".", "zeros_like", "(", "block4", ")", "\n", "tmp_mag", "[", "14", ":", "98", ",", "14", ":", "98", "]", "=", "mag", "[", "14", ":", "98", ",", "14", ":", "98", "]", "\n", "max_mag_block", "=", "mag", "[", "0", ":", "112", ",", "0", ":", "112", "]", "-", "tmp_mag", "\n", "\n", "tmp_ang", "=", "np", ".", "zeros_like", "(", "block4", ")", "\n", "tmp_ang", "[", "14", ":", "98", ",", "14", ":", "98", "]", "=", "ang", "[", "14", ":", "98", ",", "14", ":", "98", "]", "\n", "max_ang_block", "=", "ang", "[", "0", ":", "112", ",", "0", ":", "112", "]", "-", "tmp_ang", "\n", "\n", "\n", "", "orientation_center", "=", "cell_gradient", "(", "max_mag_block", ",", "max_ang_block", ")", "\n", "\n", "max_ang", "=", "np", ".", "argmax", "(", "orientation_center", ")", "\n", "\n", "\n", "return", "(", "max_idx", "+", "1", ")", ",", "(", "max_ang", "+", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.comput_motion_statistics_fast.pattern_3": [[129, 218], ["numpy.flip", "numpy.flip", "numpy.flip", "numpy.flip", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "numpy.array", "numpy.sum", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "numpy.array", "numpy.argmax", "numpy.reshape", "numpy.reshape", "comput_motion_statistics_fast.cell_gradient", "numpy.argmax", "numpy.tril_indices", "numpy.triu_indices", "numpy.tril_indices", "numpy.triu_indices", "numpy.triu_indices", "numpy.tril_indices", "numpy.triu_indices", "numpy.tril_indices", "numpy.triu_indices", "numpy.tril_indices", "numpy.triu_indices", "numpy.tril_indices", "numpy.tril_indices", "numpy.triu_indices", "numpy.tril_indices", "numpy.triu_indices"], "function", ["home.repos.pwc.inspect_result.laura-wang_video_repres_mas.None.comput_motion_statistics_fast.cell_gradient"], ["", "def", "pattern_3", "(", "mag", ",", "ang", ")", ":", "\n", "\n", "    ", "mag_block_all", "=", "[", "]", "\n", "ang_block_all", "=", "[", "]", "\n", "\n", "block_one", "=", "mag", "[", "0", ":", "56", ",", "0", ":", "56", "]", "\n", "mag_block_1", "=", "block_one", "[", "np", ".", "tril_indices", "(", "56", ")", "]", "\n", "mag_block_2", "=", "block_one", "[", "np", ".", "triu_indices", "(", "56", ")", "]", "\n", "\n", "ang_block_one", "=", "ang", "[", "0", ":", "56", ",", "0", ":", "56", "]", "\n", "ang_block_1", "=", "ang_block_one", "[", "np", ".", "tril_indices", "(", "56", ")", "]", "\n", "ang_block_2", "=", "ang_block_one", "[", "np", ".", "triu_indices", "(", "56", ")", "]", "\n", "\n", "############################################################", "\n", "\n", "block_two", "=", "mag", "[", "0", ":", "56", ",", "56", ":", "112", "]", "\n", "block_two", "=", "np", ".", "flip", "(", "block_two", ",", "1", ")", "\n", "\n", "mag_block_3", "=", "block_two", "[", "np", ".", "triu_indices", "(", "56", ")", "]", "\n", "mag_block_4", "=", "block_two", "[", "np", ".", "tril_indices", "(", "56", ")", "]", "\n", "\n", "\n", "ang_block_two", "=", "ang", "[", "0", ":", "56", ",", "56", ":", "112", "]", "\n", "ang_block_two", "=", "np", ".", "flip", "(", "ang_block_two", ",", "1", ")", "\n", "ang_block_3", "=", "ang_block_two", "[", "np", ".", "triu_indices", "(", "56", ")", "]", "\n", "ang_block_4", "=", "ang_block_two", "[", "np", ".", "tril_indices", "(", "56", ")", "]", "\n", "\n", "\n", "################################################", "\n", "block_three", "=", "mag", "[", "56", ":", "112", ",", "0", ":", "56", "]", "\n", "block_three", "=", "np", ".", "flip", "(", "block_three", ",", "1", ")", "\n", "mag_block_5", "=", "block_three", "[", "np", ".", "triu_indices", "(", "56", ")", "]", "\n", "mag_block_6", "=", "block_three", "[", "np", ".", "tril_indices", "(", "56", ")", "]", "\n", "\n", "\n", "ang_block_three", "=", "ang", "[", "56", ":", "112", ",", "0", ":", "56", "]", "\n", "ang_block_three", "=", "np", ".", "flip", "(", "ang_block_three", ",", "1", ")", "\n", "ang_block_5", "=", "ang_block_three", "[", "np", ".", "triu_indices", "(", "56", ")", "]", "\n", "ang_block_6", "=", "ang_block_three", "[", "np", ".", "tril_indices", "(", "56", ")", "]", "\n", "\n", "############################################", "\n", "block_four", "=", "mag", "[", "56", ":", "112", ",", "56", ":", "112", "]", "\n", "mag_block_7", "=", "block_four", "[", "np", ".", "tril_indices", "(", "56", ")", "]", "\n", "mag_block_8", "=", "block_four", "[", "np", ".", "triu_indices", "(", "56", ")", "]", "\n", "\n", "\n", "ang_block_four", "=", "ang", "[", "56", ":", "112", ",", "56", ":", "112", "]", "\n", "ang_block_7", "=", "ang_block_four", "[", "np", ".", "tril_indices", "(", "56", ")", "]", "\n", "ang_block_8", "=", "ang_block_four", "[", "np", ".", "triu_indices", "(", "56", ")", "]", "\n", "\n", "############################################", "\n", "\n", "\n", "mag_block_all", ".", "append", "(", "mag_block_1", ")", "\n", "mag_block_all", ".", "append", "(", "mag_block_2", ")", "\n", "mag_block_all", ".", "append", "(", "mag_block_3", ")", "\n", "mag_block_all", ".", "append", "(", "mag_block_4", ")", "\n", "mag_block_all", ".", "append", "(", "mag_block_5", ")", "\n", "mag_block_all", ".", "append", "(", "mag_block_6", ")", "\n", "mag_block_all", ".", "append", "(", "mag_block_7", ")", "\n", "mag_block_all", ".", "append", "(", "mag_block_8", ")", "\n", "mag_block_all", "=", "np", ".", "array", "(", "mag_block_all", ")", "\n", "sum_all", "=", "np", ".", "sum", "(", "mag_block_all", ",", "1", ")", "\n", "\n", "ang_block_all", ".", "append", "(", "ang_block_1", ")", "\n", "ang_block_all", ".", "append", "(", "ang_block_2", ")", "\n", "ang_block_all", ".", "append", "(", "ang_block_3", ")", "\n", "ang_block_all", ".", "append", "(", "ang_block_4", ")", "\n", "ang_block_all", ".", "append", "(", "ang_block_5", ")", "\n", "ang_block_all", ".", "append", "(", "ang_block_6", ")", "\n", "ang_block_all", ".", "append", "(", "ang_block_7", ")", "\n", "ang_block_all", ".", "append", "(", "ang_block_8", ")", "\n", "ang_block_all", "=", "np", ".", "array", "(", "ang_block_all", ")", "\n", "\n", "\n", "#############################################", "\n", "max_mag_idx", "=", "np", ".", "argmax", "(", "sum_all", ")", "\n", "\n", "max_mag_block", "=", "mag_block_all", "[", "max_mag_idx", "]", "\n", "max_ang_block", "=", "ang_block_all", "[", "max_mag_idx", "]", "\n", "\n", "max_mag_block", "=", "np", ".", "reshape", "(", "max_mag_block", ",", "[", "12", ",", "133", "]", ")", "\n", "max_ang_block", "=", "np", ".", "reshape", "(", "max_ang_block", ",", "[", "12", ",", "133", "]", ")", "\n", "\n", "orientation_center", "=", "cell_gradient", "(", "max_mag_block", ",", "max_ang_block", ")", "\n", "max_ang_idx", "=", "np", ".", "argmax", "(", "orientation_center", ")", "\n", "\n", "\n", "return", "max_mag_idx", "+", "1", ",", "max_ang_idx", "+", "1", "\n", "\n"]]}