{"home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.check_if_exist": [[8, 10], ["os.path.exists"], "function", ["None"], ["def", "check_if_exist", "(", "path", ")", ":", "\n", "    ", "return", "os", ".", "path", ".", "exists", "(", "path", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.make_if_not_exist": [[11, 14], ["os.path.exists", "os.makedirs"], "function", ["None"], ["", "def", "make_if_not_exist", "(", "path", ")", ":", "\n", "    ", "if", "not", "os", ".", "path", ".", "exists", "(", "path", ")", ":", "\n", "        ", "os", ".", "makedirs", "(", "path", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.UnpackVariable": [[15, 29], ["type", "len", "type", "xrange", "xrange", "len", "ret.append", "ret.append"], "function", ["None"], ["", "", "def", "UnpackVariable", "(", "var", ",", "num", ")", ":", "\n", "  ", "assert", "len", ">", "0", "\n", "if", "type", "(", "var", ")", "is", "list", "and", "len", "(", "var", ")", "==", "num", ":", "\n", "    ", "return", "var", "\n", "", "else", ":", "\n", "    ", "ret", "=", "[", "]", "\n", "if", "type", "(", "var", ")", "is", "list", ":", "\n", "      ", "assert", "len", "(", "var", ")", "==", "1", "\n", "for", "i", "in", "xrange", "(", "0", ",", "num", ")", ":", "\n", "        ", "ret", ".", "append", "(", "var", "[", "0", "]", ")", "\n", "", "", "else", ":", "\n", "      ", "for", "i", "in", "xrange", "(", "0", ",", "num", ")", ":", "\n", "        ", "ret", ".", "append", "(", "var", ")", "\n", "", "", "return", "ret", "\n", "\n"]], "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ConvBNLayer": [[30, 117], ["model_libs.UnpackVariable", "model_libs.UnpackVariable", "model_libs.UnpackVariable", "bn_params.get", "bn_params.get", "bn_params.get", "caffe.layers.Convolution", "caffe.layers.Convolution", "net.update", "caffe.layers.BatchNorm", "caffe.layers.ReLU", "dict", "dict", "dict", "caffe.layers.Scale", "caffe.layers.Bias", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict"], "function", ["home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.UnpackVariable", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.UnpackVariable", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.UnpackVariable"], ["", "", "def", "ConvBNLayer", "(", "net", ",", "from_layer", ",", "out_layer", ",", "use_bn", ",", "use_relu", ",", "num_output", ",", "\n", "kernel_size", ",", "pad", ",", "stride", ",", "dilation", "=", "1", ",", "use_scale", "=", "True", ",", "lr_mult", "=", "1", ",", "\n", "conv_prefix", "=", "''", ",", "conv_postfix", "=", "''", ",", "bn_prefix", "=", "''", ",", "bn_postfix", "=", "'_bn'", ",", "\n", "scale_prefix", "=", "''", ",", "scale_postfix", "=", "'_scale'", ",", "bias_prefix", "=", "''", ",", "bias_postfix", "=", "'_bias'", ",", "\n", "**", "bn_params", ")", ":", "\n", "  ", "if", "use_bn", ":", "\n", "# parameters for convolution layer with batchnorm.", "\n", "    ", "kwargs", "=", "{", "\n", "'param'", ":", "[", "dict", "(", "lr_mult", "=", "lr_mult", ",", "decay_mult", "=", "1", ")", "]", ",", "\n", "'weight_filler'", ":", "dict", "(", "type", "=", "'gaussian'", ",", "std", "=", "0.01", ")", ",", "\n", "'bias_term'", ":", "False", ",", "\n", "}", "\n", "eps", "=", "bn_params", ".", "get", "(", "'eps'", ",", "0.001", ")", "\n", "moving_average_fraction", "=", "bn_params", ".", "get", "(", "'moving_average_fraction'", ",", "0.999", ")", "\n", "use_global_stats", "=", "bn_params", ".", "get", "(", "'use_global_stats'", ",", "False", ")", "\n", "# parameters for batchnorm layer.", "\n", "bn_kwargs", "=", "{", "\n", "'param'", ":", "[", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", "]", ",", "\n", "'eps'", ":", "eps", ",", "\n", "'moving_average_fraction'", ":", "moving_average_fraction", ",", "\n", "}", "\n", "bn_lr_mult", "=", "lr_mult", "\n", "if", "use_global_stats", ":", "\n", "# only specify if use_global_stats is explicitly provided;", "\n", "# otherwise, use_global_stats_ = this->phase_ == TEST;", "\n", "      ", "bn_kwargs", "=", "{", "\n", "'param'", ":", "[", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", "]", ",", "\n", "'eps'", ":", "eps", ",", "\n", "'use_global_stats'", ":", "use_global_stats", ",", "\n", "}", "\n", "# not updating scale/bias parameters", "\n", "bn_lr_mult", "=", "0", "\n", "# parameters for scale bias layer after batchnorm.", "\n", "", "if", "use_scale", ":", "\n", "      ", "sb_kwargs", "=", "{", "\n", "'bias_term'", ":", "True", ",", "\n", "'param'", ":", "[", "\n", "dict", "(", "lr_mult", "=", "bn_lr_mult", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "bn_lr_mult", ",", "decay_mult", "=", "0", ")", "]", ",", "\n", "'filler'", ":", "dict", "(", "type", "=", "'constant'", ",", "value", "=", "1.0", ")", ",", "\n", "'bias_filler'", ":", "dict", "(", "type", "=", "'constant'", ",", "value", "=", "0.0", ")", ",", "\n", "}", "\n", "", "else", ":", "\n", "      ", "bias_kwargs", "=", "{", "\n", "'param'", ":", "[", "dict", "(", "lr_mult", "=", "bn_lr_mult", ",", "decay_mult", "=", "0", ")", "]", ",", "\n", "'filler'", ":", "dict", "(", "type", "=", "'constant'", ",", "value", "=", "0.0", ")", ",", "\n", "}", "\n", "", "", "else", ":", "\n", "    ", "kwargs", "=", "{", "\n", "'param'", ":", "[", "\n", "dict", "(", "lr_mult", "=", "lr_mult", ",", "decay_mult", "=", "1", ")", ",", "\n", "dict", "(", "lr_mult", "=", "2", "*", "lr_mult", ",", "decay_mult", "=", "0", ")", "]", ",", "\n", "'weight_filler'", ":", "dict", "(", "type", "=", "'xavier'", ")", ",", "\n", "'bias_filler'", ":", "dict", "(", "type", "=", "'constant'", ",", "value", "=", "0", ")", "\n", "}", "\n", "\n", "", "conv_name", "=", "'{}{}{}'", ".", "format", "(", "conv_prefix", ",", "out_layer", ",", "conv_postfix", ")", "\n", "[", "kernel_h", ",", "kernel_w", "]", "=", "UnpackVariable", "(", "kernel_size", ",", "2", ")", "\n", "[", "pad_h", ",", "pad_w", "]", "=", "UnpackVariable", "(", "pad", ",", "2", ")", "\n", "[", "stride_h", ",", "stride_w", "]", "=", "UnpackVariable", "(", "stride", ",", "2", ")", "\n", "if", "kernel_h", "==", "kernel_w", ":", "\n", "    ", "net", "[", "conv_name", "]", "=", "L", ".", "Convolution", "(", "net", "[", "from_layer", "]", ",", "num_output", "=", "num_output", ",", "\n", "kernel_size", "=", "kernel_h", ",", "pad", "=", "pad_h", ",", "stride", "=", "stride_h", ",", "**", "kwargs", ")", "\n", "", "else", ":", "\n", "    ", "net", "[", "conv_name", "]", "=", "L", ".", "Convolution", "(", "net", "[", "from_layer", "]", ",", "num_output", "=", "num_output", ",", "\n", "kernel_h", "=", "kernel_h", ",", "kernel_w", "=", "kernel_w", ",", "pad_h", "=", "pad_h", ",", "pad_w", "=", "pad_w", ",", "\n", "stride_h", "=", "stride_h", ",", "stride_w", "=", "stride_w", ",", "**", "kwargs", ")", "\n", "", "if", "dilation", ">", "1", ":", "\n", "    ", "net", ".", "update", "(", "conv_name", ",", "{", "'dilation'", ":", "dilation", "}", ")", "\n", "", "if", "use_bn", ":", "\n", "    ", "bn_name", "=", "'{}{}{}'", ".", "format", "(", "bn_prefix", ",", "out_layer", ",", "bn_postfix", ")", "\n", "net", "[", "bn_name", "]", "=", "L", ".", "BatchNorm", "(", "net", "[", "conv_name", "]", ",", "in_place", "=", "True", ",", "**", "bn_kwargs", ")", "\n", "if", "use_scale", ":", "\n", "      ", "sb_name", "=", "'{}{}{}'", ".", "format", "(", "scale_prefix", ",", "out_layer", ",", "scale_postfix", ")", "\n", "net", "[", "sb_name", "]", "=", "L", ".", "Scale", "(", "net", "[", "bn_name", "]", ",", "in_place", "=", "True", ",", "**", "sb_kwargs", ")", "\n", "", "else", ":", "\n", "      ", "bias_name", "=", "'{}{}{}'", ".", "format", "(", "bias_prefix", ",", "out_layer", ",", "bias_postfix", ")", "\n", "net", "[", "bias_name", "]", "=", "L", ".", "Bias", "(", "net", "[", "bn_name", "]", ",", "in_place", "=", "True", ",", "**", "bias_kwargs", ")", "\n", "", "", "if", "use_relu", ":", "\n", "    ", "relu_name", "=", "'{}_relu'", ".", "format", "(", "conv_name", ")", "\n", "net", "[", "relu_name", "]", "=", "L", ".", "ReLU", "(", "net", "[", "conv_name", "]", ",", "in_place", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody": [[118, 176], ["model_libs.ConvBNLayer", "model_libs.ConvBNLayer", "caffe.layers.Eltwise", "caffe.layers.ReLU", "model_libs.ConvBNLayer", "model_libs.ConvBNLayer", "model_libs.ConvBNLayer", "int"], "function", ["home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ConvBNLayer", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ConvBNLayer", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ConvBNLayer", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ConvBNLayer", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ConvBNLayer"], ["", "", "def", "ResBody", "(", "net", ",", "from_layer", ",", "block_name", ",", "out2a", ",", "out2b", ",", "out2c", ",", "stride", ",", "use_branch1", ",", "dilation", "=", "1", ",", "**", "bn_param", ")", ":", "\n", "# ResBody(net, 'pool1', '2a', 64, 64, 256, 1, True)", "\n", "\n", "  ", "conv_prefix", "=", "'res{}_'", ".", "format", "(", "block_name", ")", "\n", "conv_postfix", "=", "''", "\n", "bn_prefix", "=", "'bn{}_'", ".", "format", "(", "block_name", ")", "\n", "bn_postfix", "=", "''", "\n", "scale_prefix", "=", "'scale{}_'", ".", "format", "(", "block_name", ")", "\n", "scale_postfix", "=", "''", "\n", "use_scale", "=", "True", "\n", "\n", "if", "use_branch1", ":", "\n", "    ", "branch_name", "=", "'branch1'", "\n", "ConvBNLayer", "(", "net", ",", "from_layer", ",", "branch_name", ",", "use_bn", "=", "True", ",", "use_relu", "=", "False", ",", "\n", "num_output", "=", "out2c", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "stride", ",", "use_scale", "=", "use_scale", ",", "\n", "conv_prefix", "=", "conv_prefix", ",", "conv_postfix", "=", "conv_postfix", ",", "\n", "bn_prefix", "=", "bn_prefix", ",", "bn_postfix", "=", "bn_postfix", ",", "\n", "scale_prefix", "=", "scale_prefix", ",", "scale_postfix", "=", "scale_postfix", ",", "**", "bn_param", ")", "\n", "branch1", "=", "'{}{}'", ".", "format", "(", "conv_prefix", ",", "branch_name", ")", "\n", "", "else", ":", "\n", "    ", "branch1", "=", "from_layer", "\n", "\n", "", "branch_name", "=", "'branch2a'", "\n", "ConvBNLayer", "(", "net", ",", "from_layer", ",", "branch_name", ",", "use_bn", "=", "True", ",", "use_relu", "=", "True", ",", "\n", "num_output", "=", "out2a", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "stride", ",", "use_scale", "=", "use_scale", ",", "\n", "conv_prefix", "=", "conv_prefix", ",", "conv_postfix", "=", "conv_postfix", ",", "\n", "bn_prefix", "=", "bn_prefix", ",", "bn_postfix", "=", "bn_postfix", ",", "\n", "scale_prefix", "=", "scale_prefix", ",", "scale_postfix", "=", "scale_postfix", ",", "**", "bn_param", ")", "\n", "out_name", "=", "'{}{}'", ".", "format", "(", "conv_prefix", ",", "branch_name", ")", "\n", "\n", "branch_name", "=", "'branch2b'", "\n", "if", "dilation", "==", "1", ":", "\n", "    ", "ConvBNLayer", "(", "net", ",", "out_name", ",", "branch_name", ",", "use_bn", "=", "True", ",", "use_relu", "=", "True", ",", "\n", "num_output", "=", "out2b", ",", "kernel_size", "=", "3", ",", "pad", "=", "1", ",", "stride", "=", "1", ",", "use_scale", "=", "use_scale", ",", "\n", "conv_prefix", "=", "conv_prefix", ",", "conv_postfix", "=", "conv_postfix", ",", "\n", "bn_prefix", "=", "bn_prefix", ",", "bn_postfix", "=", "bn_postfix", ",", "\n", "scale_prefix", "=", "scale_prefix", ",", "scale_postfix", "=", "scale_postfix", ",", "**", "bn_param", ")", "\n", "", "else", ":", "\n", "    ", "pad", "=", "int", "(", "(", "3", "+", "(", "dilation", "-", "1", ")", "*", "2", ")", "-", "1", ")", "/", "2", "\n", "ConvBNLayer", "(", "net", ",", "out_name", ",", "branch_name", ",", "use_bn", "=", "True", ",", "use_relu", "=", "True", ",", "\n", "num_output", "=", "out2b", ",", "kernel_size", "=", "3", ",", "pad", "=", "pad", ",", "stride", "=", "1", ",", "use_scale", "=", "use_scale", ",", "\n", "dilation", "=", "dilation", ",", "conv_prefix", "=", "conv_prefix", ",", "conv_postfix", "=", "conv_postfix", ",", "\n", "bn_prefix", "=", "bn_prefix", ",", "bn_postfix", "=", "bn_postfix", ",", "\n", "scale_prefix", "=", "scale_prefix", ",", "scale_postfix", "=", "scale_postfix", ",", "**", "bn_param", ")", "\n", "", "out_name", "=", "'{}{}'", ".", "format", "(", "conv_prefix", ",", "branch_name", ")", "\n", "\n", "branch_name", "=", "'branch2c'", "\n", "ConvBNLayer", "(", "net", ",", "out_name", ",", "branch_name", ",", "use_bn", "=", "True", ",", "use_relu", "=", "False", ",", "\n", "num_output", "=", "out2c", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "1", ",", "use_scale", "=", "use_scale", ",", "\n", "conv_prefix", "=", "conv_prefix", ",", "conv_postfix", "=", "conv_postfix", ",", "\n", "bn_prefix", "=", "bn_prefix", ",", "bn_postfix", "=", "bn_postfix", ",", "\n", "scale_prefix", "=", "scale_prefix", ",", "scale_postfix", "=", "scale_postfix", ",", "**", "bn_param", ")", "\n", "branch2", "=", "'{}{}'", ".", "format", "(", "conv_prefix", ",", "branch_name", ")", "\n", "\n", "res_name", "=", "'res{}'", ".", "format", "(", "block_name", ")", "\n", "net", "[", "res_name", "]", "=", "L", ".", "Eltwise", "(", "net", "[", "branch1", "]", ",", "net", "[", "branch2", "]", ")", "\n", "relu_name", "=", "'{}_relu'", ".", "format", "(", "res_name", ")", "\n", "net", "[", "relu_name", "]", "=", "L", ".", "ReLU", "(", "net", "[", "res_name", "]", ",", "in_place", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower": [[177, 190], ["caffe.layers.Pooling", "param.update", "model_libs.ConvBNLayer"], "function", ["home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ConvBNLayer"], ["", "def", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "layer_params", ",", "**", "bn_param", ")", ":", "\n", "  ", "use_scale", "=", "False", "\n", "for", "param", "in", "layer_params", ":", "\n", "    ", "tower_layer", "=", "'{}/{}'", ".", "format", "(", "tower_name", ",", "param", "[", "'name'", "]", ")", "\n", "del", "param", "[", "'name'", "]", "\n", "if", "'pool'", "in", "tower_layer", ":", "\n", "      ", "net", "[", "tower_layer", "]", "=", "L", ".", "Pooling", "(", "net", "[", "from_layer", "]", ",", "**", "param", ")", "\n", "", "else", ":", "\n", "      ", "param", ".", "update", "(", "bn_param", ")", "\n", "ConvBNLayer", "(", "net", ",", "from_layer", ",", "tower_layer", ",", "use_bn", "=", "True", ",", "use_relu", "=", "True", ",", "\n", "use_scale", "=", "use_scale", ",", "**", "param", ")", "\n", "", "from_layer", "=", "tower_layer", "\n", "", "return", "net", "[", "from_layer", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.CreateAnnotatedDataLayer": [[191, 216], ["caffe.layers.AnnotatedData", "annotated_data_param.update", "dict", "dict", "dict", "caffe.proto.caffe_pb2.Phase.Value", "caffe.proto.caffe_pb2.Phase.Value"], "function", ["None"], ["", "def", "CreateAnnotatedDataLayer", "(", "source", ",", "batch_size", "=", "32", ",", "backend", "=", "P", ".", "Data", ".", "LMDB", ",", "\n", "output_label", "=", "True", ",", "train", "=", "True", ",", "label_map_file", "=", "''", ",", "anno_type", "=", "None", ",", "\n", "transform_param", "=", "{", "}", ",", "batch_sampler", "=", "[", "{", "}", "]", ")", ":", "\n", "    ", "if", "train", ":", "\n", "        ", "kwargs", "=", "{", "\n", "'include'", ":", "dict", "(", "phase", "=", "caffe_pb2", ".", "Phase", ".", "Value", "(", "'TRAIN'", ")", ")", ",", "\n", "'transform_param'", ":", "transform_param", ",", "\n", "}", "\n", "", "else", ":", "\n", "        ", "kwargs", "=", "{", "\n", "'include'", ":", "dict", "(", "phase", "=", "caffe_pb2", ".", "Phase", ".", "Value", "(", "'TEST'", ")", ")", ",", "\n", "'transform_param'", ":", "transform_param", ",", "\n", "}", "\n", "", "ntop", "=", "1", "\n", "if", "output_label", ":", "\n", "        ", "ntop", "=", "2", "\n", "", "annotated_data_param", "=", "{", "\n", "'label_map_file'", ":", "label_map_file", ",", "\n", "'batch_sampler'", ":", "batch_sampler", ",", "\n", "}", "\n", "if", "anno_type", "is", "not", "None", ":", "\n", "        ", "annotated_data_param", ".", "update", "(", "{", "'anno_type'", ":", "anno_type", "}", ")", "\n", "", "return", "L", ".", "AnnotatedData", "(", "name", "=", "\"data\"", ",", "annotated_data_param", "=", "annotated_data_param", ",", "\n", "data_param", "=", "dict", "(", "batch_size", "=", "batch_size", ",", "backend", "=", "backend", ",", "source", "=", "source", ")", ",", "\n", "ntop", "=", "ntop", ",", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.VGGNetBody": [[217, 358], ["caffe.layers.Convolution", "caffe.layers.ReLU", "caffe.layers.Convolution", "caffe.layers.ReLU", "caffe.layers.Convolution", "caffe.layers.ReLU", "caffe.layers.Convolution", "caffe.layers.ReLU", "caffe.layers.Convolution", "caffe.layers.ReLU", "caffe.layers.Convolution", "caffe.layers.ReLU", "caffe.layers.Convolution", "caffe.layers.ReLU", "caffe.layers.Convolution", "caffe.layers.ReLU", "caffe.layers.Convolution", "caffe.layers.ReLU", "caffe.layers.Convolution", "caffe.layers.ReLU", "caffe.layers.Convolution", "caffe.layers.ReLU", "caffe.layers.Convolution", "caffe.layers.ReLU", "caffe.layers.Convolution", "caffe.layers.ReLU", "net.keys", "dict", "dict", "net.keys", "caffe.layers.Convolution", "caffe.layers.Pooling", "caffe.layers.Convolution", "caffe.layers.Pooling", "caffe.layers.Convolution", "caffe.layers.Pooling", "caffe.layers.Convolution", "int", "dict", "dict", "dict", "dict", "caffe.layers.Pooling", "caffe.layers.Pooling", "caffe.layers.Convolution", "caffe.layers.ReLU", "caffe.layers.ReLU", "caffe.layers.InnerProduct", "caffe.layers.ReLU", "caffe.layers.InnerProduct", "caffe.layers.ReLU", "net.update", "caffe.layers.Convolution", "caffe.layers.Pooling", "caffe.layers.Convolution", "caffe.layers.Pooling", "int", "caffe.layers.Dropout", "caffe.layers.Convolution", "caffe.layers.Convolution", "caffe.layers.Dropout", "caffe.layers.Dropout", "caffe.layers.Dropout"], "function", ["None"], ["", "def", "VGGNetBody", "(", "net", ",", "from_layer", ",", "need_fc", "=", "True", ",", "fully_conv", "=", "False", ",", "reduced", "=", "False", ",", "\n", "dilated", "=", "False", ",", "nopool", "=", "False", ",", "dropout", "=", "True", ",", "freeze_layers", "=", "[", "]", ",", "dilate_pool4", "=", "False", ")", ":", "\n", "    ", "kwargs", "=", "{", "\n", "'param'", ":", "[", "dict", "(", "lr_mult", "=", "1", ",", "decay_mult", "=", "1", ")", ",", "dict", "(", "lr_mult", "=", "2", ",", "decay_mult", "=", "0", ")", "]", ",", "\n", "'weight_filler'", ":", "dict", "(", "type", "=", "'xavier'", ")", ",", "\n", "'bias_filler'", ":", "dict", "(", "type", "=", "'constant'", ",", "value", "=", "0", ")", "}", "\n", "\n", "assert", "from_layer", "in", "net", ".", "keys", "(", ")", "\n", "net", ".", "conv1_1", "=", "L", ".", "Convolution", "(", "net", "[", "from_layer", "]", ",", "num_output", "=", "64", ",", "pad", "=", "1", ",", "kernel_size", "=", "3", ",", "**", "kwargs", ")", "\n", "\n", "net", ".", "relu1_1", "=", "L", ".", "ReLU", "(", "net", ".", "conv1_1", ",", "in_place", "=", "True", ")", "\n", "net", ".", "conv1_2", "=", "L", ".", "Convolution", "(", "net", ".", "relu1_1", ",", "num_output", "=", "64", ",", "pad", "=", "1", ",", "kernel_size", "=", "3", ",", "**", "kwargs", ")", "\n", "net", ".", "relu1_2", "=", "L", ".", "ReLU", "(", "net", ".", "conv1_2", ",", "in_place", "=", "True", ")", "\n", "\n", "if", "nopool", ":", "\n", "        ", "name", "=", "'conv1_3'", "\n", "net", "[", "name", "]", "=", "L", ".", "Convolution", "(", "net", ".", "relu1_2", ",", "num_output", "=", "64", ",", "pad", "=", "1", ",", "kernel_size", "=", "3", ",", "stride", "=", "2", ",", "**", "kwargs", ")", "\n", "", "else", ":", "\n", "        ", "name", "=", "'pool1'", "\n", "net", ".", "pool1", "=", "L", ".", "Pooling", "(", "net", ".", "relu1_2", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "\n", "\n", "", "net", ".", "conv2_1", "=", "L", ".", "Convolution", "(", "net", "[", "name", "]", ",", "num_output", "=", "128", ",", "pad", "=", "1", ",", "kernel_size", "=", "3", ",", "**", "kwargs", ")", "\n", "net", ".", "relu2_1", "=", "L", ".", "ReLU", "(", "net", ".", "conv2_1", ",", "in_place", "=", "True", ")", "\n", "net", ".", "conv2_2", "=", "L", ".", "Convolution", "(", "net", ".", "relu2_1", ",", "num_output", "=", "128", ",", "pad", "=", "1", ",", "kernel_size", "=", "3", ",", "**", "kwargs", ")", "\n", "net", ".", "relu2_2", "=", "L", ".", "ReLU", "(", "net", ".", "conv2_2", ",", "in_place", "=", "True", ")", "\n", "\n", "if", "nopool", ":", "\n", "        ", "name", "=", "'conv2_3'", "\n", "net", "[", "name", "]", "=", "L", ".", "Convolution", "(", "net", ".", "relu2_2", ",", "num_output", "=", "128", ",", "pad", "=", "1", ",", "kernel_size", "=", "3", ",", "stride", "=", "2", ",", "**", "kwargs", ")", "\n", "", "else", ":", "\n", "        ", "name", "=", "'pool2'", "\n", "net", "[", "name", "]", "=", "L", ".", "Pooling", "(", "net", ".", "relu2_2", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "\n", "\n", "", "net", ".", "conv3_1", "=", "L", ".", "Convolution", "(", "net", "[", "name", "]", ",", "num_output", "=", "256", ",", "pad", "=", "1", ",", "kernel_size", "=", "3", ",", "**", "kwargs", ")", "\n", "net", ".", "relu3_1", "=", "L", ".", "ReLU", "(", "net", ".", "conv3_1", ",", "in_place", "=", "True", ")", "\n", "net", ".", "conv3_2", "=", "L", ".", "Convolution", "(", "net", ".", "relu3_1", ",", "num_output", "=", "256", ",", "pad", "=", "1", ",", "kernel_size", "=", "3", ",", "**", "kwargs", ")", "\n", "net", ".", "relu3_2", "=", "L", ".", "ReLU", "(", "net", ".", "conv3_2", ",", "in_place", "=", "True", ")", "\n", "net", ".", "conv3_3", "=", "L", ".", "Convolution", "(", "net", ".", "relu3_2", ",", "num_output", "=", "256", ",", "pad", "=", "1", ",", "kernel_size", "=", "3", ",", "**", "kwargs", ")", "\n", "net", ".", "relu3_3", "=", "L", ".", "ReLU", "(", "net", ".", "conv3_3", ",", "in_place", "=", "True", ")", "\n", "\n", "if", "nopool", ":", "\n", "        ", "name", "=", "'conv3_4'", "\n", "net", "[", "name", "]", "=", "L", ".", "Convolution", "(", "net", ".", "relu3_3", ",", "num_output", "=", "256", ",", "pad", "=", "1", ",", "kernel_size", "=", "3", ",", "stride", "=", "2", ",", "**", "kwargs", ")", "\n", "", "else", ":", "\n", "        ", "name", "=", "'pool3'", "\n", "net", "[", "name", "]", "=", "L", ".", "Pooling", "(", "net", ".", "relu3_3", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "\n", "\n", "", "net", ".", "conv4_1", "=", "L", ".", "Convolution", "(", "net", "[", "name", "]", ",", "num_output", "=", "512", ",", "pad", "=", "1", ",", "kernel_size", "=", "3", ",", "**", "kwargs", ")", "\n", "net", ".", "relu4_1", "=", "L", ".", "ReLU", "(", "net", ".", "conv4_1", ",", "in_place", "=", "True", ")", "\n", "net", ".", "conv4_2", "=", "L", ".", "Convolution", "(", "net", ".", "relu4_1", ",", "num_output", "=", "512", ",", "pad", "=", "1", ",", "kernel_size", "=", "3", ",", "**", "kwargs", ")", "\n", "net", ".", "relu4_2", "=", "L", ".", "ReLU", "(", "net", ".", "conv4_2", ",", "in_place", "=", "True", ")", "\n", "net", ".", "conv4_3", "=", "L", ".", "Convolution", "(", "net", ".", "relu4_2", ",", "num_output", "=", "512", ",", "pad", "=", "1", ",", "kernel_size", "=", "3", ",", "**", "kwargs", ")", "\n", "net", ".", "relu4_3", "=", "L", ".", "ReLU", "(", "net", ".", "conv4_3", ",", "in_place", "=", "True", ")", "\n", "\n", "if", "nopool", ":", "\n", "        ", "name", "=", "'conv4_4'", "\n", "net", "[", "name", "]", "=", "L", ".", "Convolution", "(", "net", ".", "relu4_3", ",", "num_output", "=", "512", ",", "pad", "=", "1", ",", "kernel_size", "=", "3", ",", "stride", "=", "2", ",", "**", "kwargs", ")", "\n", "", "else", ":", "\n", "        ", "name", "=", "'pool4'", "\n", "if", "dilate_pool4", ":", "\n", "            ", "net", "[", "name", "]", "=", "L", ".", "Pooling", "(", "net", ".", "relu4_3", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "pad", "=", "1", ")", "\n", "dilation", "=", "2", "\n", "", "else", ":", "\n", "            ", "net", "[", "name", "]", "=", "L", ".", "Pooling", "(", "net", ".", "relu4_3", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "\n", "dilation", "=", "1", "\n", "\n", "", "", "kernel_size", "=", "3", "\n", "pad", "=", "int", "(", "(", "kernel_size", "+", "(", "dilation", "-", "1", ")", "*", "(", "kernel_size", "-", "1", ")", ")", "-", "1", ")", "/", "2", "\n", "net", ".", "conv5_1", "=", "L", ".", "Convolution", "(", "net", "[", "name", "]", ",", "num_output", "=", "512", ",", "pad", "=", "pad", ",", "kernel_size", "=", "kernel_size", ",", "dilation", "=", "dilation", ",", "**", "kwargs", ")", "\n", "net", ".", "relu5_1", "=", "L", ".", "ReLU", "(", "net", ".", "conv5_1", ",", "in_place", "=", "True", ")", "\n", "net", ".", "conv5_2", "=", "L", ".", "Convolution", "(", "net", ".", "relu5_1", ",", "num_output", "=", "512", ",", "pad", "=", "pad", ",", "kernel_size", "=", "kernel_size", ",", "dilation", "=", "dilation", ",", "**", "kwargs", ")", "\n", "net", ".", "relu5_2", "=", "L", ".", "ReLU", "(", "net", ".", "conv5_2", ",", "in_place", "=", "True", ")", "\n", "net", ".", "conv5_3", "=", "L", ".", "Convolution", "(", "net", ".", "relu5_2", ",", "num_output", "=", "512", ",", "pad", "=", "pad", ",", "kernel_size", "=", "kernel_size", ",", "dilation", "=", "dilation", ",", "**", "kwargs", ")", "\n", "net", ".", "relu5_3", "=", "L", ".", "ReLU", "(", "net", ".", "conv5_3", ",", "in_place", "=", "True", ")", "\n", "\n", "if", "need_fc", ":", "\n", "        ", "if", "dilated", ":", "\n", "            ", "if", "nopool", ":", "\n", "                ", "name", "=", "'conv5_4'", "\n", "net", "[", "name", "]", "=", "L", ".", "Convolution", "(", "net", ".", "relu5_3", ",", "num_output", "=", "512", ",", "pad", "=", "1", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "**", "kwargs", ")", "\n", "", "else", ":", "\n", "                ", "name", "=", "'pool5'", "\n", "net", "[", "name", "]", "=", "L", ".", "Pooling", "(", "net", ".", "relu5_3", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "pad", "=", "1", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ")", "\n", "", "", "else", ":", "\n", "            ", "if", "nopool", ":", "\n", "                ", "name", "=", "'conv5_4'", "\n", "net", "[", "name", "]", "=", "L", ".", "Convolution", "(", "net", ".", "relu5_3", ",", "num_output", "=", "512", ",", "pad", "=", "1", ",", "kernel_size", "=", "3", ",", "stride", "=", "2", ",", "**", "kwargs", ")", "\n", "", "else", ":", "\n", "                ", "name", "=", "'pool5'", "\n", "net", "[", "name", "]", "=", "L", ".", "Pooling", "(", "net", ".", "relu5_3", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "\n", "\n", "", "", "if", "fully_conv", ":", "\n", "            ", "if", "dilated", ":", "\n", "                ", "if", "reduced", ":", "\n", "                    ", "dilation", "=", "dilation", "*", "6", "\n", "kernel_size", "=", "3", "\n", "num_output", "=", "1024", "\n", "", "else", ":", "\n", "                    ", "dilation", "=", "dilation", "*", "2", "\n", "kernel_size", "=", "7", "\n", "num_output", "=", "4096", "\n", "", "", "else", ":", "\n", "                ", "if", "reduced", ":", "\n", "                    ", "dilation", "=", "dilation", "*", "3", "\n", "kernel_size", "=", "3", "\n", "num_output", "=", "1024", "\n", "", "else", ":", "\n", "                    ", "kernel_size", "=", "7", "\n", "num_output", "=", "4096", "\n", "", "", "pad", "=", "int", "(", "(", "kernel_size", "+", "(", "dilation", "-", "1", ")", "*", "(", "kernel_size", "-", "1", ")", ")", "-", "1", ")", "/", "2", "\n", "net", ".", "fc6", "=", "L", ".", "Convolution", "(", "net", "[", "name", "]", ",", "num_output", "=", "num_output", ",", "pad", "=", "pad", ",", "kernel_size", "=", "kernel_size", ",", "dilation", "=", "dilation", ",", "**", "kwargs", ")", "\n", "\n", "net", ".", "relu6", "=", "L", ".", "ReLU", "(", "net", ".", "fc6", ",", "in_place", "=", "True", ")", "\n", "if", "dropout", ":", "\n", "                ", "net", ".", "drop6", "=", "L", ".", "Dropout", "(", "net", ".", "relu6", ",", "dropout_ratio", "=", "0.5", ",", "in_place", "=", "True", ")", "\n", "\n", "", "if", "reduced", ":", "\n", "                ", "net", ".", "fc7", "=", "L", ".", "Convolution", "(", "net", ".", "relu6", ",", "num_output", "=", "1024", ",", "kernel_size", "=", "1", ",", "**", "kwargs", ")", "\n", "", "else", ":", "\n", "                ", "net", ".", "fc7", "=", "L", ".", "Convolution", "(", "net", ".", "relu6", ",", "num_output", "=", "4096", ",", "kernel_size", "=", "1", ",", "**", "kwargs", ")", "\n", "", "net", ".", "relu7", "=", "L", ".", "ReLU", "(", "net", ".", "fc7", ",", "in_place", "=", "True", ")", "\n", "if", "dropout", ":", "\n", "                ", "net", ".", "drop7", "=", "L", ".", "Dropout", "(", "net", ".", "relu7", ",", "dropout_ratio", "=", "0.5", ",", "in_place", "=", "True", ")", "\n", "", "", "else", ":", "\n", "            ", "net", ".", "fc6", "=", "L", ".", "InnerProduct", "(", "net", ".", "pool5", ",", "num_output", "=", "4096", ")", "\n", "net", ".", "relu6", "=", "L", ".", "ReLU", "(", "net", ".", "fc6", ",", "in_place", "=", "True", ")", "\n", "if", "dropout", ":", "\n", "                ", "net", ".", "drop6", "=", "L", ".", "Dropout", "(", "net", ".", "relu6", ",", "dropout_ratio", "=", "0.5", ",", "in_place", "=", "True", ")", "\n", "", "net", ".", "fc7", "=", "L", ".", "InnerProduct", "(", "net", ".", "relu6", ",", "num_output", "=", "4096", ")", "\n", "net", ".", "relu7", "=", "L", ".", "ReLU", "(", "net", ".", "fc7", ",", "in_place", "=", "True", ")", "\n", "if", "dropout", ":", "\n", "                ", "net", ".", "drop7", "=", "L", ".", "Dropout", "(", "net", ".", "relu7", ",", "dropout_ratio", "=", "0.5", ",", "in_place", "=", "True", ")", "\n", "\n", "# Update freeze layers.", "\n", "", "", "", "kwargs", "[", "'param'", "]", "=", "[", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", "]", "\n", "layers", "=", "net", ".", "keys", "(", ")", "\n", "for", "freeze_layer", "in", "freeze_layers", ":", "\n", "        ", "if", "freeze_layer", "in", "layers", ":", "\n", "            ", "net", ".", "update", "(", "freeze_layer", ",", "kwargs", ")", "\n", "\n", "", "", "return", "net", "\n", "\n"]], "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.DSOD300_V3_Body": [[359, 480], ["caffe.layers.Convolution", "caffe.layers.BatchNorm", "caffe.layers.Scale", "caffe.layers.ReLU", "caffe.layers.Convolution", "caffe.layers.BatchNorm", "caffe.layers.Scale", "caffe.layers.ReLU", "caffe.layers.Convolution", "caffe.layers.BatchNorm", "caffe.layers.Scale", "caffe.layers.ReLU", "caffe.layers.Pooling", "range", "int", "model_libs.DSOD300_V3_Body.transition"], "function", ["None"], ["", "def", "DSOD300_V3_Body", "(", "net", ",", "from_layer", ")", ":", "\n", "\n", "    ", "def", "bn_relu_conv", "(", "bottom", ",", "ks", ",", "nout", ",", "stride", ",", "pad", ",", "dropout", ",", "inplace", "=", "True", ")", ":", "\n", "        ", "batch_norm", "=", "L", ".", "BatchNorm", "(", "bottom", ",", "in_place", "=", "False", ",", "\n", "param", "=", "[", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", "]", ")", "\n", "scale", "=", "L", ".", "Scale", "(", "batch_norm", ",", "bias_term", "=", "True", ",", "in_place", "=", "True", ",", "filler", "=", "dict", "(", "value", "=", "1", ")", ",", "bias_filler", "=", "dict", "(", "value", "=", "0", ")", ")", "\n", "relu", "=", "L", ".", "ReLU", "(", "scale", ",", "in_place", "=", "inplace", ")", "\n", "conv", "=", "L", ".", "Convolution", "(", "relu", ",", "kernel_size", "=", "ks", ",", "stride", "=", "stride", ",", "\n", "num_output", "=", "nout", ",", "pad", "=", "pad", ",", "bias_term", "=", "False", ",", "weight_filler", "=", "dict", "(", "type", "=", "'xavier'", ")", ",", "\n", "bias_filler", "=", "dict", "(", "type", "=", "'constant'", ")", ")", "\n", "if", "dropout", ">", "0", ":", "\n", "            ", "conv", "=", "L", ".", "Dropout", "(", "conv", ",", "dropout_ratio", "=", "dropout", ")", "\n", "", "return", "conv", "\n", "\n", "", "def", "add_layer", "(", "bottom", ",", "num_filter", ",", "dropout", ")", ":", "\n", "        ", "conv", "=", "bn_relu_conv", "(", "bottom", ",", "ks", "=", "3", ",", "nout", "=", "num_filter", ",", "stride", "=", "1", ",", "pad", "=", "1", ",", "dropout", "=", "dropout", ")", "\n", "concate", "=", "L", ".", "Concat", "(", "bottom", ",", "conv", ",", "axis", "=", "1", ")", "\n", "return", "concate", "\n", "\n", "", "def", "add_bl_layer", "(", "bottom", ",", "num_filter", ",", "dropout", ",", "width", ")", ":", "\n", "        ", "conv", "=", "bn_relu_conv", "(", "bottom", ",", "ks", "=", "1", ",", "nout", "=", "int", "(", "width", "*", "num_filter", ")", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ")", "\n", "conv", "=", "bn_relu_conv", "(", "conv", ",", "ks", "=", "3", ",", "nout", "=", "num_filter", ",", "stride", "=", "1", ",", "pad", "=", "1", ",", "dropout", "=", "dropout", ")", "\n", "concate", "=", "L", ".", "Concat", "(", "bottom", ",", "conv", ",", "axis", "=", "1", ")", "\n", "return", "concate", "\n", "\n", "", "def", "add_bl_layer2", "(", "bottom", ",", "num_filter", ",", "dropout", ",", "width", ")", ":", "\n", "        ", "conv", "=", "bn_relu_conv", "(", "bottom", ",", "ks", "=", "1", ",", "nout", "=", "int", "(", "width", "*", "num_filter", ")", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ")", "\n", "conv", "=", "bn_relu_conv", "(", "conv", ",", "ks", "=", "3", ",", "nout", "=", "num_filter", ",", "stride", "=", "2", ",", "pad", "=", "1", ",", "dropout", "=", "dropout", ")", "\n", "conv2", "=", "L", ".", "Pooling", "(", "bottom", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "\n", "conv2", "=", "bn_relu_conv", "(", "conv2", ",", "ks", "=", "1", ",", "nout", "=", "num_filter", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ")", "\n", "concate", "=", "L", ".", "Concat", "(", "conv2", ",", "conv", ",", "axis", "=", "1", ")", "\n", "return", "concate", "\n", "\n", "", "def", "transition", "(", "bottom", ",", "num_filter", ",", "dropout", ")", ":", "\n", "        ", "conv", "=", "bn_relu_conv", "(", "bottom", ",", "ks", "=", "1", ",", "nout", "=", "num_filter", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ",", "inplace", "=", "False", ")", "\n", "pooling", "=", "L", ".", "Pooling", "(", "conv", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "\n", "return", "pooling", "\n", "\n", "", "def", "transition3x3", "(", "bottom", ",", "num_filter", ",", "dropout", ")", ":", "\n", "        ", "conv", "=", "bn_relu_conv", "(", "bottom", ",", "ks", "=", "3", ",", "nout", "=", "num_filter", ",", "stride", "=", "2", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ",", "inplace", "=", "False", ")", "\n", "# pooling = L.Pooling(conv, pool=P.Pooling.MAX, kernel_size=2, stride=2)", "\n", "return", "conv", "\n", "\n", "", "def", "transition_w_o_pooling", "(", "bottom", ",", "num_filter", ",", "dropout", ")", ":", "\n", "        ", "conv", "=", "bn_relu_conv", "(", "bottom", ",", "ks", "=", "1", ",", "nout", "=", "num_filter", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ",", "inplace", "=", "False", ")", "\n", "return", "conv", "\n", "\n", "", "first_output", "=", "128", "\n", "growth_rate", "=", "48", "\n", "dropout", "=", "0", "\n", "nchannels", "=", "first_output", "\n", "\n", "assert", "from_layer", "in", "net", ".", "keys", "(", ")", "\n", "\n", "# Stem", "\n", "model", "=", "L", ".", "Convolution", "(", "net", "[", "from_layer", "]", ",", "kernel_size", "=", "3", ",", "stride", "=", "2", ",", "num_output", "=", "64", ",", "# output: 150x150", "\n", "pad", "=", "1", ",", "bias_term", "=", "False", ",", "weight_filler", "=", "dict", "(", "type", "=", "'xavier'", ")", ",", "\n", "bias_filler", "=", "dict", "(", "type", "=", "'constant'", ")", ")", "\n", "\n", "model", "=", "L", ".", "BatchNorm", "(", "model", ",", "in_place", "=", "False", ",", "param", "=", "[", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", "]", ")", "\n", "model", "=", "L", ".", "Scale", "(", "model", ",", "bias_term", "=", "True", ",", "in_place", "=", "True", ",", "filler", "=", "dict", "(", "value", "=", "1", ")", ",", "bias_filler", "=", "dict", "(", "value", "=", "0", ")", ")", "\n", "model", "=", "L", ".", "ReLU", "(", "model", ",", "in_place", "=", "True", ")", "\n", "\n", "model", "=", "L", ".", "Convolution", "(", "model", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "num_output", "=", "64", ",", "\n", "pad", "=", "1", ",", "bias_term", "=", "False", ",", "weight_filler", "=", "dict", "(", "type", "=", "'xavier'", ")", ",", "\n", "bias_filler", "=", "dict", "(", "type", "=", "'constant'", ")", ")", "\n", "model", "=", "L", ".", "BatchNorm", "(", "model", ",", "in_place", "=", "False", ",", "param", "=", "[", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", "]", ")", "\n", "model", "=", "L", ".", "Scale", "(", "model", ",", "bias_term", "=", "True", ",", "in_place", "=", "True", ",", "filler", "=", "dict", "(", "value", "=", "1", ")", ",", "bias_filler", "=", "dict", "(", "value", "=", "0", ")", ")", "\n", "model", "=", "L", ".", "ReLU", "(", "model", ",", "in_place", "=", "True", ")", "\n", "\n", "model", "=", "L", ".", "Convolution", "(", "model", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "num_output", "=", "128", ",", "\n", "pad", "=", "1", ",", "bias_term", "=", "False", ",", "weight_filler", "=", "dict", "(", "type", "=", "'xavier'", ")", ",", "\n", "bias_filler", "=", "dict", "(", "type", "=", "'constant'", ")", ")", "\n", "model", "=", "L", ".", "BatchNorm", "(", "model", ",", "in_place", "=", "False", ",", "param", "=", "[", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", "]", ")", "\n", "model", "=", "L", ".", "Scale", "(", "model", ",", "bias_term", "=", "True", ",", "in_place", "=", "True", ",", "filler", "=", "dict", "(", "value", "=", "1", ")", ",", "bias_filler", "=", "dict", "(", "value", "=", "0", ")", ")", "\n", "model", "=", "L", ".", "ReLU", "(", "model", ",", "in_place", "=", "True", ")", "\n", "model", "=", "L", ".", "Pooling", "(", "model", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "# pooling1: 75x75", "\n", "\n", "times", "=", "1", "\n", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "        ", "model", "=", "add_bl_layer", "(", "model", ",", "growth_rate", ",", "dropout", ",", "4", ")", "\n", "nchannels", "+=", "growth_rate", "\n", "", "nchannels", "=", "int", "(", "nchannels", "/", "times", ")", "\n", "model", "=", "transition", "(", "model", ",", "nchannels", ",", "dropout", ")", "# pooling2: 38x38", "\n", "for", "i", "in", "range", "(", "8", ")", ":", "\n", "        ", "model", "=", "add_bl_layer", "(", "model", ",", "growth_rate", ",", "dropout", ",", "4", ")", "\n", "nchannels", "+=", "growth_rate", "\n", "", "nchannels", "=", "int", "(", "nchannels", "/", "times", ")", "\n", "model", "=", "transition_w_o_pooling", "(", "model", ",", "nchannels", ",", "dropout", ")", "# 38x38", "\n", "net", ".", "First", "=", "model", "\n", "model1", "=", "L", ".", "Pooling", "(", "model", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "\n", "for", "i", "in", "range", "(", "8", ")", ":", "\n", "        ", "model1", "=", "add_bl_layer", "(", "model1", ",", "growth_rate", ",", "dropout", ",", "4", ")", "\n", "nchannels", "+=", "growth_rate", "\n", "", "nchannels", "=", "int", "(", "nchannels", "/", "times", ")", "\n", "model1", "=", "transition_w_o_pooling", "(", "model1", ",", "nchannels", ",", "dropout", ")", "# without pooling", "\n", "for", "i", "in", "range", "(", "8", ")", ":", "\n", "        ", "model1", "=", "add_bl_layer", "(", "model1", ",", "growth_rate", ",", "dropout", ",", "4", ")", "\n", "nchannels", "+=", "growth_rate", "\n", "# nchannels = int(nchannels / times)", "\n", "", "model1", "=", "transition_w_o_pooling", "(", "model1", ",", "256", ",", "dropout", ")", "# without pooling", "\n", "\n", "f_first", "=", "L", ".", "Pooling", "(", "net", ".", "First", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "\n", "f_first", "=", "bn_relu_conv", "(", "f_first", ",", "ks", "=", "1", ",", "nout", "=", "256", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ")", "\n", "model1", "=", "L", ".", "Concat", "(", "model1", ",", "f_first", ",", "axis", "=", "1", ")", "\n", "net", ".", "Second", "=", "model1", "# pooling3: 19x19", "\n", "# name = 'Second'", "\n", "#AddExtraLayers", "\n", "model2", "=", "add_bl_layer2", "(", "model1", ",", "256", ",", "dropout", ",", "1", ")", "# pooling4: 10x10", "\n", "net", ".", "Third", "=", "model2", "\n", "model3", "=", "add_bl_layer2", "(", "model2", ",", "128", ",", "dropout", ",", "1", ")", "# pooling5: 5x5", "\n", "net", ".", "Fourth", "=", "model3", "\n", "model4", "=", "add_bl_layer2", "(", "model3", ",", "128", ",", "dropout", ",", "1", ")", "# pooling6: 3x3", "\n", "net", ".", "Fifth", "=", "model4", "\n", "model5", "=", "add_bl_layer2", "(", "model4", ",", "128", ",", "dropout", ",", "1", ")", "# pooling7: 2x2", "\n", "net", ".", "Sixth", "=", "model5", "\n", "return", "net", "\n", "\n"]], "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.DSOD512_V3_Body": [[481, 605], ["caffe.layers.Convolution", "caffe.layers.BatchNorm", "caffe.layers.Scale", "caffe.layers.ReLU", "caffe.layers.Convolution", "caffe.layers.BatchNorm", "caffe.layers.Scale", "caffe.layers.ReLU", "caffe.layers.Convolution", "caffe.layers.BatchNorm", "caffe.layers.Scale", "caffe.layers.ReLU", "caffe.layers.Pooling", "range", "int", "model_libs.DSOD300_V3_Body.transition"], "function", ["None"], ["", "def", "DSOD512_V3_Body", "(", "net", ",", "from_layer", ")", ":", "\n", "\n", "    ", "def", "bn_relu_conv", "(", "bottom", ",", "ks", ",", "nout", ",", "stride", ",", "pad", ",", "dropout", ",", "inplace", "=", "True", ")", ":", "\n", "        ", "batch_norm", "=", "L", ".", "BatchNorm", "(", "bottom", ",", "in_place", "=", "False", ",", "\n", "param", "=", "[", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", "]", ")", "\n", "scale", "=", "L", ".", "Scale", "(", "batch_norm", ",", "bias_term", "=", "True", ",", "in_place", "=", "True", ",", "filler", "=", "dict", "(", "value", "=", "1", ")", ",", "bias_filler", "=", "dict", "(", "value", "=", "0", ")", ")", "\n", "relu", "=", "L", ".", "ReLU", "(", "scale", ",", "in_place", "=", "inplace", ")", "\n", "conv", "=", "L", ".", "Convolution", "(", "relu", ",", "kernel_size", "=", "ks", ",", "stride", "=", "stride", ",", "\n", "num_output", "=", "nout", ",", "pad", "=", "pad", ",", "bias_term", "=", "False", ",", "weight_filler", "=", "dict", "(", "type", "=", "'xavier'", ")", ",", "\n", "bias_filler", "=", "dict", "(", "type", "=", "'constant'", ")", ")", "\n", "if", "dropout", ">", "0", ":", "\n", "            ", "conv", "=", "L", ".", "Dropout", "(", "conv", ",", "dropout_ratio", "=", "dropout", ")", "\n", "", "return", "conv", "\n", "\n", "", "def", "add_layer", "(", "bottom", ",", "num_filter", ",", "dropout", ")", ":", "\n", "        ", "conv", "=", "bn_relu_conv", "(", "bottom", ",", "ks", "=", "3", ",", "nout", "=", "num_filter", ",", "stride", "=", "1", ",", "pad", "=", "1", ",", "dropout", "=", "dropout", ")", "\n", "concate", "=", "L", ".", "Concat", "(", "bottom", ",", "conv", ",", "axis", "=", "1", ")", "\n", "return", "concate", "\n", "\n", "", "def", "add_bl_layer", "(", "bottom", ",", "num_filter", ",", "dropout", ",", "width", ")", ":", "\n", "        ", "conv", "=", "bn_relu_conv", "(", "bottom", ",", "ks", "=", "1", ",", "nout", "=", "int", "(", "width", "*", "num_filter", ")", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ")", "\n", "conv", "=", "bn_relu_conv", "(", "conv", ",", "ks", "=", "3", ",", "nout", "=", "num_filter", ",", "stride", "=", "1", ",", "pad", "=", "1", ",", "dropout", "=", "dropout", ")", "\n", "concate", "=", "L", ".", "Concat", "(", "bottom", ",", "conv", ",", "axis", "=", "1", ")", "\n", "return", "concate", "\n", "\n", "", "def", "add_bl_layer2", "(", "bottom", ",", "num_filter", ",", "dropout", ",", "width", ")", ":", "\n", "        ", "conv", "=", "bn_relu_conv", "(", "bottom", ",", "ks", "=", "1", ",", "nout", "=", "int", "(", "width", "*", "num_filter", ")", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ")", "\n", "conv", "=", "bn_relu_conv", "(", "conv", ",", "ks", "=", "3", ",", "nout", "=", "num_filter", ",", "stride", "=", "2", ",", "pad", "=", "1", ",", "dropout", "=", "dropout", ")", "\n", "conv2", "=", "L", ".", "Pooling", "(", "bottom", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "\n", "conv2", "=", "bn_relu_conv", "(", "conv2", ",", "ks", "=", "1", ",", "nout", "=", "num_filter", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ")", "\n", "concate", "=", "L", ".", "Concat", "(", "conv2", ",", "conv", ",", "axis", "=", "1", ")", "\n", "return", "concate", "\n", "\n", "", "def", "transition", "(", "bottom", ",", "num_filter", ",", "dropout", ")", ":", "\n", "        ", "conv", "=", "bn_relu_conv", "(", "bottom", ",", "ks", "=", "1", ",", "nout", "=", "num_filter", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ",", "inplace", "=", "False", ")", "\n", "pooling", "=", "L", ".", "Pooling", "(", "conv", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "\n", "return", "pooling", "\n", "\n", "", "def", "transition3x3", "(", "bottom", ",", "num_filter", ",", "dropout", ")", ":", "\n", "        ", "conv", "=", "bn_relu_conv", "(", "bottom", ",", "ks", "=", "3", ",", "nout", "=", "num_filter", ",", "stride", "=", "2", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ",", "inplace", "=", "False", ")", "\n", "# pooling = L.Pooling(conv, pool=P.Pooling.MAX, kernel_size=2, stride=2)", "\n", "return", "conv", "\n", "\n", "", "def", "transition_w_o_pooling", "(", "bottom", ",", "num_filter", ",", "dropout", ")", ":", "\n", "        ", "conv", "=", "bn_relu_conv", "(", "bottom", ",", "ks", "=", "1", ",", "nout", "=", "num_filter", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ",", "inplace", "=", "False", ")", "\n", "# pooling = L.Pooling(conv, pool=P.Pooling.AVE, kernel_size=2, stride=2)", "\n", "return", "conv", "\n", "\n", "", "first_output", "=", "128", "\n", "growth_rate", "=", "48", "\n", "dropout", "=", "0", "\n", "nchannels", "=", "first_output", "\n", "\n", "assert", "from_layer", "in", "net", ".", "keys", "(", ")", "\n", "# Stem", "\n", "model", "=", "L", ".", "Convolution", "(", "net", "[", "from_layer", "]", ",", "kernel_size", "=", "3", ",", "stride", "=", "2", ",", "num_output", "=", "64", ",", "# output: 256x256", "\n", "pad", "=", "1", ",", "bias_term", "=", "False", ",", "weight_filler", "=", "dict", "(", "type", "=", "'xavier'", ")", ",", "\n", "bias_filler", "=", "dict", "(", "type", "=", "'constant'", ")", ")", "\n", "\n", "model", "=", "L", ".", "BatchNorm", "(", "model", ",", "in_place", "=", "False", ",", "param", "=", "[", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", "]", ")", "\n", "model", "=", "L", ".", "Scale", "(", "model", ",", "bias_term", "=", "True", ",", "in_place", "=", "True", ",", "filler", "=", "dict", "(", "value", "=", "1", ")", ",", "bias_filler", "=", "dict", "(", "value", "=", "0", ")", ")", "\n", "model", "=", "L", ".", "ReLU", "(", "model", ",", "in_place", "=", "True", ")", "\n", "\n", "model", "=", "L", ".", "Convolution", "(", "model", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "num_output", "=", "64", ",", "\n", "pad", "=", "1", ",", "bias_term", "=", "False", ",", "weight_filler", "=", "dict", "(", "type", "=", "'xavier'", ")", ",", "\n", "bias_filler", "=", "dict", "(", "type", "=", "'constant'", ")", ")", "\n", "model", "=", "L", ".", "BatchNorm", "(", "model", ",", "in_place", "=", "False", ",", "param", "=", "[", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", "]", ")", "\n", "model", "=", "L", ".", "Scale", "(", "model", ",", "bias_term", "=", "True", ",", "in_place", "=", "True", ",", "filler", "=", "dict", "(", "value", "=", "1", ")", ",", "bias_filler", "=", "dict", "(", "value", "=", "0", ")", ")", "\n", "model", "=", "L", ".", "ReLU", "(", "model", ",", "in_place", "=", "True", ")", "\n", "\n", "model", "=", "L", ".", "Convolution", "(", "model", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "num_output", "=", "128", ",", "\n", "pad", "=", "1", ",", "bias_term", "=", "False", ",", "weight_filler", "=", "dict", "(", "type", "=", "'xavier'", ")", ",", "\n", "bias_filler", "=", "dict", "(", "type", "=", "'constant'", ")", ")", "\n", "model", "=", "L", ".", "BatchNorm", "(", "model", ",", "in_place", "=", "False", ",", "param", "=", "[", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", "]", ")", "\n", "model", "=", "L", ".", "Scale", "(", "model", ",", "bias_term", "=", "True", ",", "in_place", "=", "True", ",", "filler", "=", "dict", "(", "value", "=", "1", ")", ",", "bias_filler", "=", "dict", "(", "value", "=", "0", ")", ")", "\n", "model", "=", "L", ".", "ReLU", "(", "model", ",", "in_place", "=", "True", ")", "\n", "model", "=", "L", ".", "Pooling", "(", "model", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "# pooling1: 128x128", "\n", "\n", "times", "=", "1", "\n", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "        ", "model", "=", "add_bl_layer", "(", "model", ",", "growth_rate", ",", "dropout", ",", "4", ")", "\n", "nchannels", "+=", "growth_rate", "\n", "", "nchannels", "=", "int", "(", "nchannels", "/", "times", ")", "\n", "model", "=", "transition", "(", "model", ",", "nchannels", ",", "dropout", ")", "# pooling2: 64x64", "\n", "for", "i", "in", "range", "(", "8", ")", ":", "\n", "        ", "model", "=", "add_bl_layer", "(", "model", ",", "growth_rate", ",", "dropout", ",", "4", ")", "\n", "nchannels", "+=", "growth_rate", "\n", "", "nchannels", "=", "int", "(", "nchannels", "/", "times", ")", "\n", "model", "=", "transition_w_o_pooling", "(", "model", ",", "nchannels", ",", "dropout", ")", "# 64x64", "\n", "net", ".", "First", "=", "model", "\n", "model1", "=", "L", ".", "Pooling", "(", "model", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "\n", "for", "i", "in", "range", "(", "8", ")", ":", "\n", "        ", "model1", "=", "add_bl_layer", "(", "model1", ",", "growth_rate", ",", "dropout", ",", "4", ")", "\n", "nchannels", "+=", "growth_rate", "\n", "", "nchannels", "=", "int", "(", "nchannels", "/", "times", ")", "\n", "model1", "=", "transition_w_o_pooling", "(", "model1", ",", "nchannels", ",", "dropout", ")", "# without pooling", "\n", "\n", "for", "i", "in", "range", "(", "8", ")", ":", "\n", "        ", "model1", "=", "add_bl_layer", "(", "model1", ",", "growth_rate", ",", "dropout", ",", "4", ")", "\n", "nchannels", "+=", "growth_rate", "\n", "# nchannels = int(nchannels / times)", "\n", "", "model1", "=", "transition_w_o_pooling", "(", "model1", ",", "256", ",", "dropout", ")", "# without pooling", "\n", "\n", "f_first", "=", "L", ".", "Pooling", "(", "net", ".", "First", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "\n", "f_first", "=", "bn_relu_conv", "(", "f_first", ",", "ks", "=", "1", ",", "nout", "=", "256", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ")", "\n", "model1", "=", "L", ".", "Concat", "(", "model1", ",", "f_first", ",", "axis", "=", "1", ")", "\n", "net", ".", "Second", "=", "model1", "# pooling3: 32x32", "\n", "# name = 'Second'", "\n", "#AddExtraLayers", "\n", "model2", "=", "add_bl_layer2", "(", "model1", ",", "256", ",", "dropout", ",", "1", ")", "# pooling4: 16x16", "\n", "net", ".", "Third", "=", "model2", "\n", "model3", "=", "add_bl_layer2", "(", "model2", ",", "128", ",", "dropout", ",", "1", ")", "# pooling5: 8x8", "\n", "net", ".", "Fourth", "=", "model3", "\n", "model4", "=", "add_bl_layer2", "(", "model3", ",", "128", ",", "dropout", ",", "1", ")", "# pooling6: 4x4", "\n", "net", ".", "Fifth_", "=", "model4", "\n", "model5", "=", "add_bl_layer2", "(", "model4", ",", "128", ",", "dropout", ",", "1", ")", "# pooling7: 2x2", "\n", "net", ".", "Sixth_", "=", "model5", "\n", "model6", "=", "add_bl_layer2", "(", "model5", ",", "128", ",", "dropout", ",", "1", ")", "# pooling8: 1x1", "\n", "net", ".", "Seventh_", "=", "model6", "\n", "return", "net", "\n", "\n"]], "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.GRP_DSOD320_V6_Recurrent_Pyramid": [[606, 812], ["caffe.layers.Convolution", "caffe.layers.BatchNorm", "caffe.layers.Scale", "caffe.layers.ReLU", "caffe.layers.Convolution", "caffe.layers.BatchNorm", "caffe.layers.Scale", "caffe.layers.ReLU", "caffe.layers.Convolution", "caffe.layers.BatchNorm", "caffe.layers.Scale", "caffe.layers.ReLU", "caffe.layers.Pooling", "range", "int", "model_libs.DSOD300_V3_Body.transition_w_o_pooling"], "function", ["None"], ["", "def", "GRP_DSOD320_V6_Recurrent_Pyramid", "(", "net", ",", "from_layer", ")", ":", "\n", "\n", "    ", "def", "conv_bn_relu", "(", "bottom", ",", "ks", ",", "nout", ",", "stride", ",", "pad", ",", "dropout", ",", "inplace", "=", "True", ")", ":", "\n", "        ", "conv", "=", "L", ".", "Convolution", "(", "bottom", ",", "kernel_size", "=", "ks", ",", "stride", "=", "stride", ",", "\n", "num_output", "=", "nout", ",", "pad", "=", "pad", ",", "bias_term", "=", "False", ",", "weight_filler", "=", "dict", "(", "type", "=", "'xavier'", ")", ",", "\n", "bias_filler", "=", "dict", "(", "type", "=", "'constant'", ")", ")", "\n", "batch_norm", "=", "L", ".", "BatchNorm", "(", "conv", ",", "in_place", "=", "True", ",", "batch_norm_param", "=", "dict", "(", "eps", "=", "1e-4", ")", ",", "\n", "param", "=", "[", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", "]", ")", "\n", "scale", "=", "L", ".", "Scale", "(", "batch_norm", ",", "bias_term", "=", "True", ",", "in_place", "=", "True", ",", "filler", "=", "dict", "(", "value", "=", "1", ")", ",", "bias_filler", "=", "dict", "(", "value", "=", "0", ")", ")", "\n", "relu", "=", "L", ".", "ReLU", "(", "scale", ",", "in_place", "=", "True", ")", "\n", "if", "dropout", ">", "0", ":", "\n", "            ", "conv", "=", "L", ".", "Dropout", "(", "relu", ",", "dropout_ratio", "=", "dropout", ")", "\n", "", "return", "relu", "\n", "\n", "", "def", "deconv", "(", "bottom", ",", "ks", ",", "nout", ",", "stride", ",", "dropout", ",", "inplace", "=", "True", ")", ":", "\n", "        ", "deconv", "=", "L", ".", "Deconvolution", "(", "bottom", ",", "convolution_param", "=", "dict", "(", "num_output", "=", "nout", ",", "kernel_size", "=", "ks", ",", "stride", "=", "stride", ",", "\n", "bias_term", "=", "False", ",", "weight_filler", "=", "dict", "(", "type", "=", "'bilinear'", ")", ")", ",", "param", "=", "[", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", "]", ")", "\n", "batch_norm", "=", "L", ".", "BatchNorm", "(", "deconv", ",", "in_place", "=", "True", ",", "batch_norm_param", "=", "dict", "(", "eps", "=", "1e-4", ")", ",", "\n", "param", "=", "[", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", "]", ")", "\n", "scale", "=", "L", ".", "Scale", "(", "batch_norm", ",", "bias_term", "=", "True", ",", "in_place", "=", "True", ",", "filler", "=", "dict", "(", "value", "=", "1", ")", ",", "bias_filler", "=", "dict", "(", "value", "=", "0", ")", ")", "\n", "relu", "=", "L", ".", "ReLU", "(", "scale", ",", "in_place", "=", "True", ")", "\n", "if", "dropout", ">", "0", ":", "\n", "            ", "conv", "=", "L", ".", "Dropout", "(", "relu", ",", "dropout_ratio", "=", "dropout", ")", "\n", "", "return", "relu", "\n", "\n", "", "def", "dilation_conv", "(", "bottom", ",", "ks", ",", "nout", ",", "stride", ",", "pad", ",", "dropout", ",", "dilation", ",", "inplace", "=", "True", ")", ":", "\n", "        ", "conv", "=", "L", ".", "Convolution", "(", "bottom", ",", "kernel_size", "=", "ks", ",", "stride", "=", "stride", ",", "\n", "num_output", "=", "nout", ",", "pad", "=", "pad", ",", "dilation", "=", "dilation", ",", "bias_term", "=", "False", ",", "weight_filler", "=", "dict", "(", "type", "=", "'xavier'", ")", ",", "\n", "bias_filler", "=", "dict", "(", "type", "=", "'constant'", ")", ")", "\n", "batch_norm", "=", "L", ".", "BatchNorm", "(", "conv", ",", "in_place", "=", "True", ",", "batch_norm_param", "=", "dict", "(", "eps", "=", "1e-4", ")", ",", "\n", "param", "=", "[", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", "]", ")", "\n", "scale", "=", "L", ".", "Scale", "(", "batch_norm", ",", "bias_term", "=", "True", ",", "in_place", "=", "True", ",", "filler", "=", "dict", "(", "value", "=", "1", ")", ",", "bias_filler", "=", "dict", "(", "value", "=", "0", ")", ")", "\n", "relu", "=", "L", ".", "ReLU", "(", "scale", ",", "in_place", "=", "True", ")", "\n", "if", "dropout", ">", "0", ":", "\n", "            ", "conv", "=", "L", ".", "Dropout", "(", "relu", ",", "dropout_ratio", "=", "dropout", ")", "\n", "", "return", "relu", "\n", "\n", "", "def", "add_recurrent_layer", "(", "bottom", ",", "ks", ",", "num_filter", ",", "dropout", ")", ":", "\n", "# conv = conv_bn_relu(bottom, ks=1, nout=int(width*num_filter), stride=1, pad=0, dropout=dropout)", "\n", "# conv = conv_bn_relu(conv, ks=3, nout=num_filter, stride=2, pad=1, dropout=dropout)  # new conv", "\n", "# conv2 = L.Pooling(bottom, pool=P.Pooling.MAX, kernel_size=2, stride=2)", "\n", "# conv2 = conv_bn_relu(conv2, ks=1, nout=num_filter, stride=1, pad=0, dropout=dropout)  # previous conv", "\n", "        ", "extra_de", "=", "deconv", "(", "bottom", ",", "ks", "=", "ks", ",", "nout", "=", "num_filter", ",", "stride", "=", "2", ",", "dropout", "=", "dropout", ")", "# later conv", "\n", "# concate = L.concate(conv, conv2, extra_de, axis=1)", "\n", "return", "extra_de", "\n", "\n", "", "def", "add_layer", "(", "bottom", ",", "num_filter", ",", "dropout", ")", ":", "\n", "        ", "conv", "=", "conv_bn_relu", "(", "bottom", ",", "ks", "=", "3", ",", "nout", "=", "num_filter", ",", "stride", "=", "1", ",", "pad", "=", "1", ",", "dropout", "=", "dropout", ")", "\n", "concate", "=", "L", ".", "Concat", "(", "bottom", ",", "conv", ",", "axis", "=", "1", ")", "\n", "return", "concate", "\n", "\n", "", "def", "add_bl_layer", "(", "bottom", ",", "num_filter", ",", "dropout", ",", "width", ")", ":", "\n", "        ", "conv", "=", "conv_bn_relu", "(", "bottom", ",", "ks", "=", "1", ",", "nout", "=", "int", "(", "width", "*", "num_filter", ")", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ")", "\n", "conv", "=", "conv_bn_relu", "(", "conv", ",", "ks", "=", "3", ",", "nout", "=", "num_filter", ",", "stride", "=", "1", ",", "pad", "=", "1", ",", "dropout", "=", "dropout", ")", "\n", "concate", "=", "L", ".", "Concat", "(", "bottom", ",", "conv", ",", "axis", "=", "1", ")", "\n", "return", "concate", "\n", "\n", "", "def", "add_bl_layer2", "(", "bottom", ",", "num_filter", ",", "dropout", ",", "width", ")", ":", "\n", "        ", "conv", "=", "conv_bn_relu", "(", "bottom", ",", "ks", "=", "1", ",", "nout", "=", "int", "(", "width", "*", "num_filter", ")", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ")", "\n", "conv", "=", "conv_bn_relu", "(", "conv", ",", "ks", "=", "3", ",", "nout", "=", "num_filter", ",", "stride", "=", "2", ",", "pad", "=", "1", ",", "dropout", "=", "dropout", ")", "\n", "conv2", "=", "L", ".", "Pooling", "(", "bottom", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "\n", "conv2", "=", "conv_bn_relu", "(", "conv2", ",", "ks", "=", "1", ",", "nout", "=", "num_filter", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ")", "\n", "concate", "=", "L", ".", "Concat", "(", "conv2", ",", "conv", ",", "axis", "=", "1", ")", "\n", "return", "concate", "\n", "\n", "", "def", "transition", "(", "bottom", ",", "num_filter", ",", "dropout", ")", ":", "\n", "        ", "conv", "=", "conv_bn_relu", "(", "bottom", ",", "ks", "=", "1", ",", "nout", "=", "num_filter", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ",", "inplace", "=", "False", ")", "\n", "pooling", "=", "L", ".", "Pooling", "(", "bottom", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "\n", "return", "pooling", "\n", "\n", "", "def", "transition3x3", "(", "bottom", ",", "num_filter", ",", "dropout", ")", ":", "\n", "        ", "conv", "=", "conv_bn_relu", "(", "bottom", ",", "ks", "=", "3", ",", "nout", "=", "num_filter", ",", "stride", "=", "2", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ",", "inplace", "=", "False", ")", "\n", "# pooling = L.Pooling(conv, pool=P.Pooling.MAX, kernel_size=2, stride=2)", "\n", "return", "conv", "\n", "\n", "", "def", "transition_w_o_pooling", "(", "bottom", ",", "num_filter", ",", "dropout", ")", ":", "\n", "        ", "conv", "=", "conv_bn_relu", "(", "bottom", ",", "ks", "=", "1", ",", "nout", "=", "num_filter", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ",", "inplace", "=", "False", ")", "\n", "return", "conv", "\n", "\n", "", "first_output", "=", "128", "\n", "growth_rate", "=", "48", "\n", "dropout", "=", "0.0", "\n", "nchannels", "=", "first_output", "\n", "\n", "assert", "from_layer", "in", "net", ".", "keys", "(", ")", "\n", "\n", "# Stem", "\n", "model", "=", "L", ".", "Convolution", "(", "net", "[", "from_layer", "]", ",", "kernel_size", "=", "3", ",", "stride", "=", "2", ",", "num_output", "=", "64", ",", "# output: 16x160", "\n", "pad", "=", "1", ",", "bias_term", "=", "False", ",", "weight_filler", "=", "dict", "(", "type", "=", "'xavier'", ")", ",", "\n", "bias_filler", "=", "dict", "(", "type", "=", "'constant'", ")", ")", "\n", "model", "=", "L", ".", "BatchNorm", "(", "model", ",", "in_place", "=", "True", ",", "batch_norm_param", "=", "dict", "(", "eps", "=", "1e-4", ")", ",", "\n", "param", "=", "[", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", "]", ")", "\n", "model", "=", "L", ".", "Scale", "(", "model", ",", "bias_term", "=", "True", ",", "in_place", "=", "True", ",", "filler", "=", "dict", "(", "value", "=", "1", ")", ",", "bias_filler", "=", "dict", "(", "value", "=", "0", ")", ")", "\n", "model", "=", "L", ".", "ReLU", "(", "model", ",", "in_place", "=", "True", ")", "\n", "\n", "model", "=", "L", ".", "Convolution", "(", "model", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "num_output", "=", "64", ",", "\n", "pad", "=", "1", ",", "bias_term", "=", "False", ",", "weight_filler", "=", "dict", "(", "type", "=", "'xavier'", ")", ",", "\n", "bias_filler", "=", "dict", "(", "type", "=", "'constant'", ")", ")", "\n", "model", "=", "L", ".", "BatchNorm", "(", "model", ",", "in_place", "=", "True", ",", "batch_norm_param", "=", "dict", "(", "eps", "=", "1e-4", ")", ",", "\n", "param", "=", "[", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", "]", ")", "\n", "model", "=", "L", ".", "Scale", "(", "model", ",", "bias_term", "=", "True", ",", "in_place", "=", "True", ",", "filler", "=", "dict", "(", "value", "=", "1", ")", ",", "bias_filler", "=", "dict", "(", "value", "=", "0", ")", ")", "\n", "model", "=", "L", ".", "ReLU", "(", "model", ",", "in_place", "=", "True", ")", "\n", "\n", "model", "=", "L", ".", "Convolution", "(", "model", ",", "kernel_size", "=", "3", ",", "stride", "=", "1", ",", "num_output", "=", "128", ",", "\n", "pad", "=", "1", ",", "bias_term", "=", "False", ",", "weight_filler", "=", "dict", "(", "type", "=", "'xavier'", ")", ",", "\n", "bias_filler", "=", "dict", "(", "type", "=", "'constant'", ")", ")", "\n", "model", "=", "L", ".", "BatchNorm", "(", "model", ",", "in_place", "=", "True", ",", "batch_norm_param", "=", "dict", "(", "eps", "=", "1e-4", ")", ",", "\n", "param", "=", "[", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", ",", "\n", "dict", "(", "lr_mult", "=", "0", ",", "decay_mult", "=", "0", ")", "]", ")", "\n", "model", "=", "L", ".", "Scale", "(", "model", ",", "bias_term", "=", "True", ",", "in_place", "=", "True", ",", "filler", "=", "dict", "(", "value", "=", "1", ")", ",", "bias_filler", "=", "dict", "(", "value", "=", "0", ")", ")", "\n", "model", "=", "L", ".", "ReLU", "(", "model", ",", "in_place", "=", "True", ")", "\n", "model0", "=", "L", ".", "Pooling", "(", "model", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "# pooling1: 80x80", "\n", "\n", "times", "=", "1", "\n", "\n", "for", "i", "in", "range", "(", "6", ")", ":", "\n", "        ", "model0", "=", "add_bl_layer", "(", "model0", ",", "growth_rate", ",", "dropout", ",", "4", ")", "\n", "nchannels", "+=", "growth_rate", "\n", "", "nchannels", "=", "int", "(", "nchannels", "/", "times", ")", "\n", "model0", "=", "transition_w_o_pooling", "(", "model0", ",", "nchannels", ",", "dropout", ")", "# 80x80", "\n", "\n", "model1", "=", "L", ".", "Pooling", "(", "model0", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "# 40x40", "\n", "for", "i", "in", "range", "(", "8", ")", ":", "\n", "        ", "model1", "=", "add_bl_layer", "(", "model1", ",", "growth_rate", ",", "dropout", ",", "4", ")", "\n", "nchannels", "+=", "growth_rate", "\n", "", "nchannels", "=", "int", "(", "nchannels", "/", "times", ")", "\n", "model1", "=", "transition_w_o_pooling", "(", "model1", ",", "nchannels", ",", "dropout", ")", "# 40x40", "\n", "\n", "f_extra0", "=", "L", ".", "Pooling", "(", "model", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "4", ",", "stride", "=", "4", ")", "\n", "f_extra0", "=", "conv_bn_relu", "(", "f_extra0", ",", "ks", "=", "1", ",", "nout", "=", "128", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ")", "\n", "f_extra1", "=", "L", ".", "Pooling", "(", "model0", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "\n", "f_extra1", "=", "conv_bn_relu", "(", "f_extra1", ",", "ks", "=", "1", ",", "nout", "=", "128", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ")", "\n", "Concat1", "=", "L", ".", "Concat", "(", "model1", ",", "f_extra0", ",", "f_extra1", ",", "axis", "=", "1", ")", "\n", "net", ".", "First", "=", "Concat1", "#  40x40", "\n", "\n", "model2", "=", "L", ".", "Pooling", "(", "model1", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "\n", "for", "i", "in", "range", "(", "8", ")", ":", "\n", "        ", "model2", "=", "add_bl_layer", "(", "model2", ",", "growth_rate", ",", "dropout", ",", "4", ")", "\n", "nchannels", "+=", "growth_rate", "\n", "", "nchannels", "=", "int", "(", "nchannels", "/", "times", ")", "\n", "model2", "=", "transition_w_o_pooling", "(", "model2", ",", "nchannels", ",", "dropout", ")", "# without pooling", "\n", "for", "i", "in", "range", "(", "8", ")", ":", "\n", "        ", "model2", "=", "add_bl_layer", "(", "model2", ",", "growth_rate", ",", "dropout", ",", "4", ")", "\n", "nchannels", "+=", "growth_rate", "\n", "# nchannels = int(nchannels / times)", "\n", "", "model2", "=", "transition_w_o_pooling", "(", "model2", ",", "171", ",", "dropout", ")", "# without pooling", "\n", "\n", "f_first", "=", "L", ".", "Pooling", "(", "net", ".", "First", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "2", ",", "stride", "=", "2", ")", "\n", "f_first", "=", "conv_bn_relu", "(", "f_first", ",", "ks", "=", "1", ",", "nout", "=", "171", ",", "stride", "=", "1", ",", "pad", "=", "0", ",", "dropout", "=", "dropout", ")", "\n", "model2", "=", "L", ".", "Concat", "(", "model2", ",", "f_first", ",", "axis", "=", "1", ")", "\n", "net", ".", "Second", "=", "model2", "# pooling3: 20x20", "\n", "# name = 'Second'", "\n", "#AddExtraLayers", "\n", "model3", "=", "add_bl_layer2", "(", "model2", ",", "86", ",", "dropout", ",", "1", ")", "# pooling4: 10x10", "\n", "net", ".", "Third", "=", "model3", "\n", "model4", "=", "add_bl_layer2", "(", "model3", ",", "86", ",", "dropout", ",", "1", ")", "# pooling5: 5x5", "\n", "net", ".", "Fourth", "=", "model4", "\n", "model5", "=", "add_bl_layer2", "(", "model4", ",", "86", ",", "dropout", ",", "1", ")", "# pooling6: 3x3", "\n", "net", ".", "Fifth", "=", "model5", "\n", "model6", "=", "add_bl_layer2", "(", "model5", ",", "128", ",", "dropout", ",", "1", ")", "# pooling7: 2x2", "\n", "net", ".", "Sixth", "=", "model6", "\n", "\n", "# AddRecurrentLayers", "\n", "# # 300x300", "\n", "\n", "# ks = 2", "\n", "# Recurrent1 = add_recurrent_layer(model2, ks, 128, dropout)  # 38x38", "\n", "# net.Recurrent1 = L.Concat(Recurrent1, Concat1, axis=1)  ", "\n", "# ks=1", "\n", "# Recurrent2 = add_recurrent_layer(model3, ks, 171, dropout)    # 19x19", "\n", "# net.Recurrent2 = L.Concat(Recurrent2, model2, axis=1)  ", "\n", "# ks=2", "\n", "# Recurrent3 = add_recurrent_layer(model4, ks, 86, dropout)    # 10x10", "\n", "# net.Recurrent3 = L.Concat(Recurrent3, model3, axis=1)", "\n", "# ks=1", "\n", "# Recurrent4 = add_recurrent_layer(model5, ks, 86, dropout)    # 5x5", "\n", "# net.Recurrent4 = L.Concat(Recurrent4, model4, axis=1)", "\n", "# ks=1", "\n", "# Recurrent5 = add_recurrent_layer(model6, ks, 86, dropout)    # 3x3", "\n", "# net.Recurrent5 = L.Concat(Recurrent5, model5, axis=1)", "\n", "# net.Recurrent6 = model6", "\n", "\n", "# 320x320", "\n", "ks", "=", "2", "\n", "Recurrent1", "=", "add_recurrent_layer", "(", "model2", ",", "ks", ",", "128", ",", "dropout", ")", "# 40x40", "\n", "net", ".", "Recurrent1", "=", "L", ".", "Concat", "(", "Recurrent1", ",", "Concat1", ",", "axis", "=", "1", ")", "\n", "ks", "=", "2", "\n", "Recurrent2", "=", "add_recurrent_layer", "(", "model3", ",", "ks", ",", "171", ",", "dropout", ")", "# 20x20", "\n", "net", ".", "Recurrent2", "=", "L", ".", "Concat", "(", "Recurrent2", ",", "model2", ",", "axis", "=", "1", ")", "\n", "ks", "=", "2", "\n", "Recurrent3", "=", "add_recurrent_layer", "(", "model4", ",", "ks", ",", "86", ",", "dropout", ")", "# 10x10", "\n", "net", ".", "Recurrent3", "=", "L", ".", "Concat", "(", "Recurrent3", ",", "model3", ",", "axis", "=", "1", ")", "\n", "ks", "=", "1", "\n", "Recurrent4", "=", "add_recurrent_layer", "(", "model5", ",", "ks", ",", "86", ",", "dropout", ")", "# 5x5", "\n", "net", ".", "Recurrent4", "=", "L", ".", "Concat", "(", "Recurrent4", ",", "model4", ",", "axis", "=", "1", ")", "\n", "ks", "=", "1", "\n", "Recurrent5", "=", "add_recurrent_layer", "(", "model6", ",", "ks", ",", "86", ",", "dropout", ")", "# 3x3", "\n", "net", ".", "Recurrent5", "=", "L", ".", "Concat", "(", "Recurrent5", ",", "model5", ",", "axis", "=", "1", ")", "\n", "net", ".", "Recurrent6", "=", "model6", "\n", "\n", "return", "net", "\n", "\n"]], "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.Gated_module": [[813, 851], ["len", "range", "caffe.layers.InnerProduct", "caffe.layers.Sigmoid", "caffe.layers.Scale", "caffe.layers.ReLU", "caffe.layers.InnerProduct", "caffe.layers.Sigmoid", "caffe.layers.Reshape", "caffe.layers.Scale", "caffe.layers.Eltwise", "caffe.layers.Pooling", "caffe.layers.InnerProduct", "caffe.layers.ReLU", "model_libs.Gated_module.channel_level"], "function", ["None"], ["", "def", "Gated_module", "(", "net", ",", "channel_nums", "=", "[", "]", ",", "from_layers", "=", "[", "]", ")", ":", "\n", "    ", "def", "channel_level", "(", "net", ",", "from_layer", ",", "channel_num", ",", "relu_name", ")", ":", "\n", "        ", "fc", "=", "L", ".", "InnerProduct", "(", "net", "[", "relu_name", "]", ",", "num_output", "=", "int", "(", "channel_num", ")", ")", "\n", "sigmoid", "=", "L", ".", "Sigmoid", "(", "fc", ",", "in_place", "=", "True", ")", "\n", "scale", "=", "L", ".", "Scale", "(", "net", "[", "from_layer", "]", ",", "sigmoid", ",", "axis", "=", "0", ",", "bias_term", "=", "False", ",", "bias_filler", "=", "dict", "(", "value", "=", "0", ")", ")", "\n", "relu", "=", "L", ".", "ReLU", "(", "scale", ",", "in_place", "=", "True", ")", "\n", "att_name", "=", "\"{}_att\"", ".", "format", "(", "from_layer", ")", "\n", "net", "[", "att_name", "]", "=", "relu", "\n", "return", "net", "\n", "\n", "", "def", "global_level", "(", "net", ",", "from_layer", ",", "relu_name", ")", ":", "\n", "        ", "fc", "=", "L", ".", "InnerProduct", "(", "net", "[", "relu_name", "]", ",", "num_output", "=", "1", ")", "\n", "sigmoid", "=", "L", ".", "Sigmoid", "(", "fc", ",", "in_place", "=", "True", ")", "\n", "att_name", "=", "\"{}_att\"", ".", "format", "(", "from_layer", ")", "\n", "sigmoid", "=", "L", ".", "Reshape", "(", "sigmoid", ",", "reshape_param", "=", "dict", "(", "shape", "=", "dict", "(", "dim", "=", "[", "-", "1", "]", ")", ")", ")", "\n", "scale", "=", "L", ".", "Scale", "(", "net", "[", "att_name", "]", ",", "sigmoid", ",", "axis", "=", "0", ",", "bias_term", "=", "False", ",", "bias_filler", "=", "dict", "(", "value", "=", "0", ")", ")", "\n", "# relu = L.ReLU(scale, in_place=True)", "\n", "residual", "=", "L", ".", "Eltwise", "(", "net", "[", "from_layer", "]", ",", "scale", ")", "\n", "gatt_name", "=", "\"{}_gate\"", ".", "format", "(", "from_layer", ")", "\n", "net", "[", "gatt_name", "]", "=", "residual", "\n", "return", "net", "\n", "\n", "", "num", "=", "len", "(", "from_layers", ")", "\n", "for", "i", "in", "range", "(", "0", ",", "num", ")", ":", "\n", "        ", "from_layer", "=", "from_layers", "[", "i", "]", "\n", "channel_num", "=", "channel_nums", "[", "i", "]", "\n", "# shared params", "\n", "gate_name", "=", "\"{}_gate\"", ".", "format", "(", "from_layer", ")", "\n", "pool_name", "=", "\"{}_pool\"", ".", "format", "(", "from_layer", ")", "\n", "fc_name", "=", "\"{}_fc\"", ".", "format", "(", "from_layer", ")", "\n", "relu_name", "=", "\"{}_relu\"", ".", "format", "(", "from_layer", ")", "\n", "net", "[", "pool_name", "]", "=", "L", ".", "Pooling", "(", "net", "[", "from_layer", "]", ",", "pool", "=", "P", ".", "Pooling", ".", "AVE", ",", "global_pooling", "=", "True", ")", "\n", "net", "[", "fc_name", "]", "=", "L", ".", "InnerProduct", "(", "net", "[", "pool_name", "]", ",", "num_output", "=", "int", "(", "channel_num", "/", "16.0", ")", ")", "\n", "net", "[", "relu_name", "]", "=", "L", ".", "ReLU", "(", "net", "[", "fc_name", "]", ",", "in_place", "=", "True", ")", "\n", "net", "=", "channel_level", "(", "net", ",", "from_layer", ",", "channel_num", ",", "relu_name", ")", "\n", "net", "=", "global_level", "(", "net", ",", "from_layer", ",", "relu_name", ")", "\n", "\n", "", "return", "net", "\n", "\n"]], "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResNet101Body": [[852, 901], ["model_libs.ConvBNLayer", "caffe.layers.Pooling", "model_libs.ResBody", "model_libs.ResBody", "model_libs.ResBody", "model_libs.ResBody", "xrange", "model_libs.ResBody", "xrange", "model_libs.ResBody", "model_libs.ResBody", "model_libs.ResBody", "model_libs.ResBody", "model_libs.ResBody", "caffe.layers.Pooling"], "function", ["home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ConvBNLayer", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody"], ["", "def", "ResNet101Body", "(", "net", ",", "from_layer", ",", "use_pool5", "=", "True", ",", "use_dilation_conv5", "=", "False", ",", "**", "bn_param", ")", ":", "\n", "    ", "conv_prefix", "=", "''", "\n", "conv_postfix", "=", "''", "\n", "bn_prefix", "=", "'bn_'", "\n", "bn_postfix", "=", "''", "\n", "scale_prefix", "=", "'scale_'", "\n", "scale_postfix", "=", "''", "\n", "ConvBNLayer", "(", "net", ",", "from_layer", ",", "'conv1'", ",", "use_bn", "=", "True", ",", "use_relu", "=", "True", ",", "\n", "num_output", "=", "64", ",", "kernel_size", "=", "7", ",", "pad", "=", "3", ",", "stride", "=", "2", ",", "\n", "conv_prefix", "=", "conv_prefix", ",", "conv_postfix", "=", "conv_postfix", ",", "\n", "bn_prefix", "=", "bn_prefix", ",", "bn_postfix", "=", "bn_postfix", ",", "\n", "scale_prefix", "=", "scale_prefix", ",", "scale_postfix", "=", "scale_postfix", ",", "**", "bn_param", ")", "\n", "\n", "net", ".", "pool1", "=", "L", ".", "Pooling", "(", "net", ".", "conv1", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "3", ",", "stride", "=", "2", ")", "\n", "\n", "ResBody", "(", "net", ",", "'pool1'", ",", "'2a'", ",", "out2a", "=", "64", ",", "out2b", "=", "64", ",", "out2c", "=", "256", ",", "stride", "=", "1", ",", "use_branch1", "=", "True", ",", "**", "bn_param", ")", "\n", "ResBody", "(", "net", ",", "'res2a'", ",", "'2b'", ",", "out2a", "=", "64", ",", "out2b", "=", "64", ",", "out2c", "=", "256", ",", "stride", "=", "1", ",", "use_branch1", "=", "False", ",", "**", "bn_param", ")", "\n", "ResBody", "(", "net", ",", "'res2b'", ",", "'2c'", ",", "out2a", "=", "64", ",", "out2b", "=", "64", ",", "out2c", "=", "256", ",", "stride", "=", "1", ",", "use_branch1", "=", "False", ",", "**", "bn_param", ")", "\n", "\n", "ResBody", "(", "net", ",", "'res2c'", ",", "'3a'", ",", "out2a", "=", "128", ",", "out2b", "=", "128", ",", "out2c", "=", "512", ",", "stride", "=", "2", ",", "use_branch1", "=", "True", ",", "**", "bn_param", ")", "\n", "\n", "from_layer", "=", "'res3a'", "\n", "for", "i", "in", "xrange", "(", "1", ",", "4", ")", ":", "\n", "      ", "block_name", "=", "'3b{}'", ".", "format", "(", "i", ")", "\n", "ResBody", "(", "net", ",", "from_layer", ",", "block_name", ",", "out2a", "=", "128", ",", "out2b", "=", "128", ",", "out2c", "=", "512", ",", "stride", "=", "1", ",", "use_branch1", "=", "False", ",", "**", "bn_param", ")", "\n", "from_layer", "=", "'res{}'", ".", "format", "(", "block_name", ")", "\n", "\n", "", "ResBody", "(", "net", ",", "from_layer", ",", "'4a'", ",", "out2a", "=", "256", ",", "out2b", "=", "256", ",", "out2c", "=", "1024", ",", "stride", "=", "2", ",", "use_branch1", "=", "True", ",", "**", "bn_param", ")", "\n", "\n", "from_layer", "=", "'res4a'", "\n", "for", "i", "in", "xrange", "(", "1", ",", "23", ")", ":", "\n", "      ", "block_name", "=", "'4b{}'", ".", "format", "(", "i", ")", "\n", "ResBody", "(", "net", ",", "from_layer", ",", "block_name", ",", "out2a", "=", "256", ",", "out2b", "=", "256", ",", "out2c", "=", "1024", ",", "stride", "=", "1", ",", "use_branch1", "=", "False", ",", "**", "bn_param", ")", "\n", "from_layer", "=", "'res{}'", ".", "format", "(", "block_name", ")", "\n", "\n", "", "stride", "=", "2", "\n", "dilation", "=", "1", "\n", "if", "use_dilation_conv5", ":", "\n", "      ", "stride", "=", "1", "\n", "dilation", "=", "2", "\n", "\n", "", "ResBody", "(", "net", ",", "from_layer", ",", "'5a'", ",", "out2a", "=", "512", ",", "out2b", "=", "512", ",", "out2c", "=", "2048", ",", "stride", "=", "stride", ",", "use_branch1", "=", "True", ",", "dilation", "=", "dilation", ",", "**", "bn_param", ")", "\n", "ResBody", "(", "net", ",", "'res5a'", ",", "'5b'", ",", "out2a", "=", "512", ",", "out2b", "=", "512", ",", "out2c", "=", "2048", ",", "stride", "=", "1", ",", "use_branch1", "=", "False", ",", "dilation", "=", "dilation", ",", "**", "bn_param", ")", "\n", "ResBody", "(", "net", ",", "'res5b'", ",", "'5c'", ",", "out2a", "=", "512", ",", "out2b", "=", "512", ",", "out2c", "=", "2048", ",", "stride", "=", "1", ",", "use_branch1", "=", "False", ",", "dilation", "=", "dilation", ",", "**", "bn_param", ")", "\n", "\n", "if", "use_pool5", ":", "\n", "      ", "net", ".", "pool5", "=", "L", ".", "Pooling", "(", "net", ".", "res5c", ",", "pool", "=", "P", ".", "Pooling", ".", "AVE", ",", "global_pooling", "=", "True", ")", "\n", "\n", "", "return", "net", "\n", "\n"]], "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResNet152Body": [[902, 951], ["model_libs.ConvBNLayer", "caffe.layers.Pooling", "model_libs.ResBody", "model_libs.ResBody", "model_libs.ResBody", "model_libs.ResBody", "xrange", "model_libs.ResBody", "xrange", "model_libs.ResBody", "model_libs.ResBody", "model_libs.ResBody", "model_libs.ResBody", "model_libs.ResBody", "caffe.layers.Pooling"], "function", ["home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ConvBNLayer", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ResBody"], ["", "def", "ResNet152Body", "(", "net", ",", "from_layer", ",", "use_pool5", "=", "True", ",", "use_dilation_conv5", "=", "False", ",", "**", "bn_param", ")", ":", "\n", "    ", "conv_prefix", "=", "''", "\n", "conv_postfix", "=", "''", "\n", "bn_prefix", "=", "'bn_'", "\n", "bn_postfix", "=", "''", "\n", "scale_prefix", "=", "'scale_'", "\n", "scale_postfix", "=", "''", "\n", "ConvBNLayer", "(", "net", ",", "from_layer", ",", "'conv1'", ",", "use_bn", "=", "True", ",", "use_relu", "=", "True", ",", "\n", "num_output", "=", "64", ",", "kernel_size", "=", "7", ",", "pad", "=", "3", ",", "stride", "=", "2", ",", "\n", "conv_prefix", "=", "conv_prefix", ",", "conv_postfix", "=", "conv_postfix", ",", "\n", "bn_prefix", "=", "bn_prefix", ",", "bn_postfix", "=", "bn_postfix", ",", "\n", "scale_prefix", "=", "scale_prefix", ",", "scale_postfix", "=", "scale_postfix", ",", "**", "bn_param", ")", "\n", "\n", "net", ".", "pool1", "=", "L", ".", "Pooling", "(", "net", ".", "conv1", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "3", ",", "stride", "=", "2", ")", "\n", "\n", "ResBody", "(", "net", ",", "'pool1'", ",", "'2a'", ",", "out2a", "=", "64", ",", "out2b", "=", "64", ",", "out2c", "=", "256", ",", "stride", "=", "1", ",", "use_branch1", "=", "True", ",", "**", "bn_param", ")", "\n", "ResBody", "(", "net", ",", "'res2a'", ",", "'2b'", ",", "out2a", "=", "64", ",", "out2b", "=", "64", ",", "out2c", "=", "256", ",", "stride", "=", "1", ",", "use_branch1", "=", "False", ",", "**", "bn_param", ")", "\n", "ResBody", "(", "net", ",", "'res2b'", ",", "'2c'", ",", "out2a", "=", "64", ",", "out2b", "=", "64", ",", "out2c", "=", "256", ",", "stride", "=", "1", ",", "use_branch1", "=", "False", ",", "**", "bn_param", ")", "\n", "\n", "ResBody", "(", "net", ",", "'res2c'", ",", "'3a'", ",", "out2a", "=", "128", ",", "out2b", "=", "128", ",", "out2c", "=", "512", ",", "stride", "=", "2", ",", "use_branch1", "=", "True", ",", "**", "bn_param", ")", "\n", "\n", "from_layer", "=", "'res3a'", "\n", "for", "i", "in", "xrange", "(", "1", ",", "8", ")", ":", "\n", "      ", "block_name", "=", "'3b{}'", ".", "format", "(", "i", ")", "\n", "ResBody", "(", "net", ",", "from_layer", ",", "block_name", ",", "out2a", "=", "128", ",", "out2b", "=", "128", ",", "out2c", "=", "512", ",", "stride", "=", "1", ",", "use_branch1", "=", "False", ",", "**", "bn_param", ")", "\n", "from_layer", "=", "'res{}'", ".", "format", "(", "block_name", ")", "\n", "\n", "", "ResBody", "(", "net", ",", "from_layer", ",", "'4a'", ",", "out2a", "=", "256", ",", "out2b", "=", "256", ",", "out2c", "=", "1024", ",", "stride", "=", "2", ",", "use_branch1", "=", "True", ",", "**", "bn_param", ")", "\n", "\n", "from_layer", "=", "'res4a'", "\n", "for", "i", "in", "xrange", "(", "1", ",", "36", ")", ":", "\n", "      ", "block_name", "=", "'4b{}'", ".", "format", "(", "i", ")", "\n", "ResBody", "(", "net", ",", "from_layer", ",", "block_name", ",", "out2a", "=", "256", ",", "out2b", "=", "256", ",", "out2c", "=", "1024", ",", "stride", "=", "1", ",", "use_branch1", "=", "False", ",", "**", "bn_param", ")", "\n", "from_layer", "=", "'res{}'", ".", "format", "(", "block_name", ")", "\n", "\n", "", "stride", "=", "2", "\n", "dilation", "=", "1", "\n", "if", "use_dilation_conv5", ":", "\n", "      ", "stride", "=", "1", "\n", "dilation", "=", "2", "\n", "\n", "", "ResBody", "(", "net", ",", "from_layer", ",", "'5a'", ",", "out2a", "=", "512", ",", "out2b", "=", "512", ",", "out2c", "=", "2048", ",", "stride", "=", "stride", ",", "use_branch1", "=", "True", ",", "dilation", "=", "dilation", ",", "**", "bn_param", ")", "\n", "ResBody", "(", "net", ",", "'res5a'", ",", "'5b'", ",", "out2a", "=", "512", ",", "out2b", "=", "512", ",", "out2c", "=", "2048", ",", "stride", "=", "1", ",", "use_branch1", "=", "False", ",", "dilation", "=", "dilation", ",", "**", "bn_param", ")", "\n", "ResBody", "(", "net", ",", "'res5b'", ",", "'5c'", ",", "out2a", "=", "512", ",", "out2b", "=", "512", ",", "out2c", "=", "2048", ",", "stride", "=", "1", ",", "use_branch1", "=", "False", ",", "dilation", "=", "dilation", ",", "**", "bn_param", ")", "\n", "\n", "if", "use_pool5", ":", "\n", "      ", "net", ".", "pool5", "=", "L", ".", "Pooling", "(", "net", ".", "res5c", ",", "pool", "=", "P", ".", "Pooling", ".", "AVE", ",", "global_pooling", "=", "True", ")", "\n", "\n", "", "return", "net", "\n", "\n"]], "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionV3Body": [[952, 1190], ["model_libs.ConvBNLayer", "model_libs.ConvBNLayer", "model_libs.ConvBNLayer", "caffe.layers.Pooling", "model_libs.ConvBNLayer", "model_libs.ConvBNLayer", "caffe.layers.Pooling", "xrange", "model_libs.InceptionTower", "towers.append", "model_libs.InceptionTower", "towers.append", "model_libs.InceptionTower", "towers.append", "caffe.layers.Concat", "xrange", "model_libs.InceptionTower", "towers.append", "model_libs.InceptionTower", "towers.append", "model_libs.InceptionTower", "towers.append", "caffe.layers.Concat", "xrange", "model_libs.InceptionTower", "towers.append", "model_libs.InceptionTower", "towers.append", "model_libs.InceptionTower", "towers.append", "model_libs.InceptionTower", "towers.append", "caffe.layers.Concat", "model_libs.InceptionTower", "towers.append", "model_libs.InceptionTower", "towers.append", "model_libs.InceptionTower", "towers.append", "model_libs.InceptionTower", "towers.append", "caffe.layers.Concat", "model_libs.InceptionTower", "towers.append", "model_libs.InceptionTower", "model_libs.InceptionTower", "subtowers.append", "model_libs.InceptionTower", "subtowers.append", "caffe.layers.Concat", "towers.append", "model_libs.InceptionTower", "model_libs.InceptionTower", "subtowers.append", "model_libs.InceptionTower", "subtowers.append", "caffe.layers.Concat", "towers.append", "model_libs.InceptionTower", "towers.append", "caffe.layers.Concat", "caffe.layers.Pooling", "caffe.layers.InnerProduct", "caffe.layers.Softmax", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict", "dict"], "function", ["home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ConvBNLayer", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ConvBNLayer", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ConvBNLayer", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ConvBNLayer", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ConvBNLayer", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.InceptionTower"], ["", "def", "InceptionV3Body", "(", "net", ",", "from_layer", ",", "output_pred", "=", "False", ",", "**", "bn_param", ")", ":", "\n", "# scale is fixed to 1, thus we ignore it.", "\n", "  ", "use_scale", "=", "False", "\n", "\n", "out_layer", "=", "'conv'", "\n", "ConvBNLayer", "(", "net", ",", "from_layer", ",", "out_layer", ",", "use_bn", "=", "True", ",", "use_relu", "=", "True", ",", "\n", "num_output", "=", "32", ",", "kernel_size", "=", "3", ",", "pad", "=", "0", ",", "stride", "=", "2", ",", "use_scale", "=", "use_scale", ",", "\n", "**", "bn_param", ")", "\n", "from_layer", "=", "out_layer", "\n", "\n", "out_layer", "=", "'conv_1'", "\n", "ConvBNLayer", "(", "net", ",", "from_layer", ",", "out_layer", ",", "use_bn", "=", "True", ",", "use_relu", "=", "True", ",", "\n", "num_output", "=", "32", ",", "kernel_size", "=", "3", ",", "pad", "=", "0", ",", "stride", "=", "1", ",", "use_scale", "=", "use_scale", ",", "\n", "**", "bn_param", ")", "\n", "from_layer", "=", "out_layer", "\n", "\n", "out_layer", "=", "'conv_2'", "\n", "ConvBNLayer", "(", "net", ",", "from_layer", ",", "out_layer", ",", "use_bn", "=", "True", ",", "use_relu", "=", "True", ",", "\n", "num_output", "=", "64", ",", "kernel_size", "=", "3", ",", "pad", "=", "1", ",", "stride", "=", "1", ",", "use_scale", "=", "use_scale", ",", "\n", "**", "bn_param", ")", "\n", "from_layer", "=", "out_layer", "\n", "\n", "out_layer", "=", "'pool'", "\n", "net", "[", "out_layer", "]", "=", "L", ".", "Pooling", "(", "net", "[", "from_layer", "]", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "\n", "kernel_size", "=", "3", ",", "stride", "=", "2", ",", "pad", "=", "0", ")", "\n", "from_layer", "=", "out_layer", "\n", "\n", "out_layer", "=", "'conv_3'", "\n", "ConvBNLayer", "(", "net", ",", "from_layer", ",", "out_layer", ",", "use_bn", "=", "True", ",", "use_relu", "=", "True", ",", "\n", "num_output", "=", "80", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "1", ",", "use_scale", "=", "use_scale", ",", "\n", "**", "bn_param", ")", "\n", "from_layer", "=", "out_layer", "\n", "\n", "out_layer", "=", "'conv_4'", "\n", "ConvBNLayer", "(", "net", ",", "from_layer", ",", "out_layer", ",", "use_bn", "=", "True", ",", "use_relu", "=", "True", ",", "\n", "num_output", "=", "192", ",", "kernel_size", "=", "3", ",", "pad", "=", "0", ",", "stride", "=", "1", ",", "use_scale", "=", "use_scale", ",", "\n", "**", "bn_param", ")", "\n", "from_layer", "=", "out_layer", "\n", "\n", "out_layer", "=", "'pool_1'", "\n", "net", "[", "out_layer", "]", "=", "L", ".", "Pooling", "(", "net", "[", "from_layer", "]", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "\n", "kernel_size", "=", "3", ",", "stride", "=", "2", ",", "pad", "=", "0", ")", "\n", "from_layer", "=", "out_layer", "\n", "\n", "# inceptions with 1x1, 3x3, 5x5 convolutions", "\n", "for", "inception_id", "in", "xrange", "(", "0", ",", "3", ")", ":", "\n", "    ", "if", "inception_id", "==", "0", ":", "\n", "      ", "out_layer", "=", "'mixed'", "\n", "tower_2_conv_num_output", "=", "32", "\n", "", "else", ":", "\n", "      ", "out_layer", "=", "'mixed_{}'", ".", "format", "(", "inception_id", ")", "\n", "tower_2_conv_num_output", "=", "64", "\n", "", "towers", "=", "[", "]", "\n", "tower_name", "=", "'{}'", ".", "format", "(", "out_layer", ")", "\n", "tower", "=", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "[", "\n", "dict", "(", "name", "=", "'conv'", ",", "num_output", "=", "64", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "1", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "towers", ".", "append", "(", "tower", ")", "\n", "tower_name", "=", "'{}/tower'", ".", "format", "(", "out_layer", ")", "\n", "tower", "=", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "[", "\n", "dict", "(", "name", "=", "'conv'", ",", "num_output", "=", "48", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "1", ")", ",", "\n", "dict", "(", "name", "=", "'conv_1'", ",", "num_output", "=", "64", ",", "kernel_size", "=", "5", ",", "pad", "=", "2", ",", "stride", "=", "1", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "towers", ".", "append", "(", "tower", ")", "\n", "tower_name", "=", "'{}/tower_1'", ".", "format", "(", "out_layer", ")", "\n", "tower", "=", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "[", "\n", "dict", "(", "name", "=", "'conv'", ",", "num_output", "=", "64", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "1", ")", ",", "\n", "dict", "(", "name", "=", "'conv_1'", ",", "num_output", "=", "96", ",", "kernel_size", "=", "3", ",", "pad", "=", "1", ",", "stride", "=", "1", ")", ",", "\n", "dict", "(", "name", "=", "'conv_2'", ",", "num_output", "=", "96", ",", "kernel_size", "=", "3", ",", "pad", "=", "1", ",", "stride", "=", "1", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "towers", ".", "append", "(", "tower", ")", "\n", "tower_name", "=", "'{}/tower_2'", ".", "format", "(", "out_layer", ")", "\n", "tower", "=", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "[", "\n", "dict", "(", "name", "=", "'pool'", ",", "pool", "=", "P", ".", "Pooling", ".", "AVE", ",", "kernel_size", "=", "3", ",", "pad", "=", "1", ",", "stride", "=", "1", ")", ",", "\n", "dict", "(", "name", "=", "'conv'", ",", "num_output", "=", "tower_2_conv_num_output", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "1", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "towers", ".", "append", "(", "tower", ")", "\n", "out_layer", "=", "'{}/join'", ".", "format", "(", "out_layer", ")", "\n", "net", "[", "out_layer", "]", "=", "L", ".", "Concat", "(", "*", "towers", ",", "axis", "=", "1", ")", "\n", "from_layer", "=", "out_layer", "\n", "\n", "# inceptions with 1x1, 3x3(in sequence) convolutions", "\n", "", "out_layer", "=", "'mixed_3'", "\n", "towers", "=", "[", "]", "\n", "tower_name", "=", "'{}'", ".", "format", "(", "out_layer", ")", "\n", "tower", "=", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "[", "\n", "dict", "(", "name", "=", "'conv'", ",", "num_output", "=", "384", ",", "kernel_size", "=", "3", ",", "pad", "=", "0", ",", "stride", "=", "2", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "towers", ".", "append", "(", "tower", ")", "\n", "tower_name", "=", "'{}/tower'", ".", "format", "(", "out_layer", ")", "\n", "tower", "=", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "[", "\n", "dict", "(", "name", "=", "'conv'", ",", "num_output", "=", "64", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "1", ")", ",", "\n", "dict", "(", "name", "=", "'conv_1'", ",", "num_output", "=", "96", ",", "kernel_size", "=", "3", ",", "pad", "=", "1", ",", "stride", "=", "1", ")", ",", "\n", "dict", "(", "name", "=", "'conv_2'", ",", "num_output", "=", "96", ",", "kernel_size", "=", "3", ",", "pad", "=", "0", ",", "stride", "=", "2", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "towers", ".", "append", "(", "tower", ")", "\n", "tower_name", "=", "'{}'", ".", "format", "(", "out_layer", ")", "\n", "tower", "=", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "[", "\n", "dict", "(", "name", "=", "'pool'", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "3", ",", "pad", "=", "0", ",", "stride", "=", "2", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "towers", ".", "append", "(", "tower", ")", "\n", "out_layer", "=", "'{}/join'", ".", "format", "(", "out_layer", ")", "\n", "net", "[", "out_layer", "]", "=", "L", ".", "Concat", "(", "*", "towers", ",", "axis", "=", "1", ")", "\n", "from_layer", "=", "out_layer", "\n", "\n", "# inceptions with 1x1, 7x1, 1x7 convolutions", "\n", "for", "inception_id", "in", "xrange", "(", "4", ",", "8", ")", ":", "\n", "    ", "if", "inception_id", "==", "4", ":", "\n", "      ", "num_output", "=", "128", "\n", "", "elif", "inception_id", "==", "5", "or", "inception_id", "==", "6", ":", "\n", "      ", "num_output", "=", "160", "\n", "", "elif", "inception_id", "==", "7", ":", "\n", "      ", "num_output", "=", "192", "\n", "", "out_layer", "=", "'mixed_{}'", ".", "format", "(", "inception_id", ")", "\n", "towers", "=", "[", "]", "\n", "tower_name", "=", "'{}'", ".", "format", "(", "out_layer", ")", "\n", "tower", "=", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "[", "\n", "dict", "(", "name", "=", "'conv'", ",", "num_output", "=", "192", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "1", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "towers", ".", "append", "(", "tower", ")", "\n", "tower_name", "=", "'{}/tower'", ".", "format", "(", "out_layer", ")", "\n", "tower", "=", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "[", "\n", "dict", "(", "name", "=", "'conv'", ",", "num_output", "=", "num_output", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "1", ")", ",", "\n", "dict", "(", "name", "=", "'conv_1'", ",", "num_output", "=", "num_output", ",", "kernel_size", "=", "[", "1", ",", "7", "]", ",", "pad", "=", "[", "0", ",", "3", "]", ",", "stride", "=", "[", "1", ",", "1", "]", ")", ",", "\n", "dict", "(", "name", "=", "'conv_2'", ",", "num_output", "=", "192", ",", "kernel_size", "=", "[", "7", ",", "1", "]", ",", "pad", "=", "[", "3", ",", "0", "]", ",", "stride", "=", "[", "1", ",", "1", "]", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "towers", ".", "append", "(", "tower", ")", "\n", "tower_name", "=", "'{}/tower_1'", ".", "format", "(", "out_layer", ")", "\n", "tower", "=", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "[", "\n", "dict", "(", "name", "=", "'conv'", ",", "num_output", "=", "num_output", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "1", ")", ",", "\n", "dict", "(", "name", "=", "'conv_1'", ",", "num_output", "=", "num_output", ",", "kernel_size", "=", "[", "7", ",", "1", "]", ",", "pad", "=", "[", "3", ",", "0", "]", ",", "stride", "=", "[", "1", ",", "1", "]", ")", ",", "\n", "dict", "(", "name", "=", "'conv_2'", ",", "num_output", "=", "num_output", ",", "kernel_size", "=", "[", "1", ",", "7", "]", ",", "pad", "=", "[", "0", ",", "3", "]", ",", "stride", "=", "[", "1", ",", "1", "]", ")", ",", "\n", "dict", "(", "name", "=", "'conv_3'", ",", "num_output", "=", "num_output", ",", "kernel_size", "=", "[", "7", ",", "1", "]", ",", "pad", "=", "[", "3", ",", "0", "]", ",", "stride", "=", "[", "1", ",", "1", "]", ")", ",", "\n", "dict", "(", "name", "=", "'conv_4'", ",", "num_output", "=", "192", ",", "kernel_size", "=", "[", "1", ",", "7", "]", ",", "pad", "=", "[", "0", ",", "3", "]", ",", "stride", "=", "[", "1", ",", "1", "]", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "towers", ".", "append", "(", "tower", ")", "\n", "tower_name", "=", "'{}/tower_2'", ".", "format", "(", "out_layer", ")", "\n", "tower", "=", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "[", "\n", "dict", "(", "name", "=", "'pool'", ",", "pool", "=", "P", ".", "Pooling", ".", "AVE", ",", "kernel_size", "=", "3", ",", "pad", "=", "1", ",", "stride", "=", "1", ")", ",", "\n", "dict", "(", "name", "=", "'conv'", ",", "num_output", "=", "192", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "1", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "towers", ".", "append", "(", "tower", ")", "\n", "out_layer", "=", "'{}/join'", ".", "format", "(", "out_layer", ")", "\n", "net", "[", "out_layer", "]", "=", "L", ".", "Concat", "(", "*", "towers", ",", "axis", "=", "1", ")", "\n", "from_layer", "=", "out_layer", "\n", "\n", "# inceptions with 1x1, 3x3, 1x7, 7x1 filters", "\n", "", "out_layer", "=", "'mixed_8'", "\n", "towers", "=", "[", "]", "\n", "tower_name", "=", "'{}/tower'", ".", "format", "(", "out_layer", ")", "\n", "tower", "=", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "[", "\n", "dict", "(", "name", "=", "'conv'", ",", "num_output", "=", "192", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "1", ")", ",", "\n", "dict", "(", "name", "=", "'conv_1'", ",", "num_output", "=", "320", ",", "kernel_size", "=", "3", ",", "pad", "=", "0", ",", "stride", "=", "2", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "towers", ".", "append", "(", "tower", ")", "\n", "tower_name", "=", "'{}/tower_1'", ".", "format", "(", "out_layer", ")", "\n", "tower", "=", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "[", "\n", "dict", "(", "name", "=", "'conv'", ",", "num_output", "=", "192", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "1", ")", ",", "\n", "dict", "(", "name", "=", "'conv_1'", ",", "num_output", "=", "192", ",", "kernel_size", "=", "[", "1", ",", "7", "]", ",", "pad", "=", "[", "0", ",", "3", "]", ",", "stride", "=", "[", "1", ",", "1", "]", ")", ",", "\n", "dict", "(", "name", "=", "'conv_2'", ",", "num_output", "=", "192", ",", "kernel_size", "=", "[", "7", ",", "1", "]", ",", "pad", "=", "[", "3", ",", "0", "]", ",", "stride", "=", "[", "1", ",", "1", "]", ")", ",", "\n", "dict", "(", "name", "=", "'conv_3'", ",", "num_output", "=", "192", ",", "kernel_size", "=", "3", ",", "pad", "=", "0", ",", "stride", "=", "2", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "towers", ".", "append", "(", "tower", ")", "\n", "tower_name", "=", "'{}'", ".", "format", "(", "out_layer", ")", "\n", "tower", "=", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "[", "\n", "dict", "(", "name", "=", "'pool'", ",", "pool", "=", "P", ".", "Pooling", ".", "MAX", ",", "kernel_size", "=", "3", ",", "pad", "=", "0", ",", "stride", "=", "2", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "towers", ".", "append", "(", "tower", ")", "\n", "out_layer", "=", "'{}/join'", ".", "format", "(", "out_layer", ")", "\n", "net", "[", "out_layer", "]", "=", "L", ".", "Concat", "(", "*", "towers", ",", "axis", "=", "1", ")", "\n", "from_layer", "=", "out_layer", "\n", "\n", "for", "inception_id", "in", "xrange", "(", "9", ",", "11", ")", ":", "\n", "    ", "num_output", "=", "384", "\n", "num_output2", "=", "448", "\n", "if", "inception_id", "==", "9", ":", "\n", "      ", "pool", "=", "P", ".", "Pooling", ".", "AVE", "\n", "", "else", ":", "\n", "      ", "pool", "=", "P", ".", "Pooling", ".", "MAX", "\n", "", "out_layer", "=", "'mixed_{}'", ".", "format", "(", "inception_id", ")", "\n", "towers", "=", "[", "]", "\n", "tower_name", "=", "'{}'", ".", "format", "(", "out_layer", ")", "\n", "tower", "=", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "[", "\n", "dict", "(", "name", "=", "'conv'", ",", "num_output", "=", "320", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "1", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "towers", ".", "append", "(", "tower", ")", "\n", "\n", "tower_name", "=", "'{}/tower'", ".", "format", "(", "out_layer", ")", "\n", "tower", "=", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "[", "\n", "dict", "(", "name", "=", "'conv'", ",", "num_output", "=", "num_output", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "1", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "subtowers", "=", "[", "]", "\n", "subtower_name", "=", "'{}/mixed'", ".", "format", "(", "tower_name", ")", "\n", "subtower", "=", "InceptionTower", "(", "net", ",", "'{}/conv'", ".", "format", "(", "tower_name", ")", ",", "subtower_name", ",", "[", "\n", "dict", "(", "name", "=", "'conv'", ",", "num_output", "=", "num_output", ",", "kernel_size", "=", "[", "1", ",", "3", "]", ",", "pad", "=", "[", "0", ",", "1", "]", ",", "stride", "=", "[", "1", ",", "1", "]", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "subtowers", ".", "append", "(", "subtower", ")", "\n", "subtower", "=", "InceptionTower", "(", "net", ",", "'{}/conv'", ".", "format", "(", "tower_name", ")", ",", "subtower_name", ",", "[", "\n", "dict", "(", "name", "=", "'conv_1'", ",", "num_output", "=", "num_output", ",", "kernel_size", "=", "[", "3", ",", "1", "]", ",", "pad", "=", "[", "1", ",", "0", "]", ",", "stride", "=", "[", "1", ",", "1", "]", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "subtowers", ".", "append", "(", "subtower", ")", "\n", "net", "[", "subtower_name", "]", "=", "L", ".", "Concat", "(", "*", "subtowers", ",", "axis", "=", "1", ")", "\n", "towers", ".", "append", "(", "net", "[", "subtower_name", "]", ")", "\n", "\n", "tower_name", "=", "'{}/tower_1'", ".", "format", "(", "out_layer", ")", "\n", "tower", "=", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "[", "\n", "dict", "(", "name", "=", "'conv'", ",", "num_output", "=", "num_output2", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "1", ")", ",", "\n", "dict", "(", "name", "=", "'conv_1'", ",", "num_output", "=", "num_output", ",", "kernel_size", "=", "3", ",", "pad", "=", "1", ",", "stride", "=", "1", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "subtowers", "=", "[", "]", "\n", "subtower_name", "=", "'{}/mixed'", ".", "format", "(", "tower_name", ")", "\n", "subtower", "=", "InceptionTower", "(", "net", ",", "'{}/conv_1'", ".", "format", "(", "tower_name", ")", ",", "subtower_name", ",", "[", "\n", "dict", "(", "name", "=", "'conv'", ",", "num_output", "=", "num_output", ",", "kernel_size", "=", "[", "1", ",", "3", "]", ",", "pad", "=", "[", "0", ",", "1", "]", ",", "stride", "=", "[", "1", ",", "1", "]", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "subtowers", ".", "append", "(", "subtower", ")", "\n", "subtower", "=", "InceptionTower", "(", "net", ",", "'{}/conv_1'", ".", "format", "(", "tower_name", ")", ",", "subtower_name", ",", "[", "\n", "dict", "(", "name", "=", "'conv_1'", ",", "num_output", "=", "num_output", ",", "kernel_size", "=", "[", "3", ",", "1", "]", ",", "pad", "=", "[", "1", ",", "0", "]", ",", "stride", "=", "[", "1", ",", "1", "]", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "subtowers", ".", "append", "(", "subtower", ")", "\n", "net", "[", "subtower_name", "]", "=", "L", ".", "Concat", "(", "*", "subtowers", ",", "axis", "=", "1", ")", "\n", "towers", ".", "append", "(", "net", "[", "subtower_name", "]", ")", "\n", "\n", "tower_name", "=", "'{}/tower_2'", ".", "format", "(", "out_layer", ")", "\n", "tower", "=", "InceptionTower", "(", "net", ",", "from_layer", ",", "tower_name", ",", "[", "\n", "dict", "(", "name", "=", "'pool'", ",", "pool", "=", "pool", ",", "kernel_size", "=", "3", ",", "pad", "=", "1", ",", "stride", "=", "1", ")", ",", "\n", "dict", "(", "name", "=", "'conv'", ",", "num_output", "=", "192", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "stride", "=", "1", ")", ",", "\n", "]", ",", "**", "bn_param", ")", "\n", "towers", ".", "append", "(", "tower", ")", "\n", "out_layer", "=", "'{}/join'", ".", "format", "(", "out_layer", ")", "\n", "net", "[", "out_layer", "]", "=", "L", ".", "Concat", "(", "*", "towers", ",", "axis", "=", "1", ")", "\n", "from_layer", "=", "out_layer", "\n", "\n", "", "if", "output_pred", ":", "\n", "    ", "net", ".", "pool_3", "=", "L", ".", "Pooling", "(", "net", "[", "from_layer", "]", ",", "pool", "=", "P", ".", "Pooling", ".", "AVE", ",", "kernel_size", "=", "8", ",", "pad", "=", "0", ",", "stride", "=", "1", ")", "\n", "net", ".", "softmax", "=", "L", ".", "InnerProduct", "(", "net", ".", "pool_3", ",", "num_output", "=", "1008", ")", "\n", "net", ".", "softmax_prob", "=", "L", ".", "Softmax", "(", "net", ".", "softmax", ")", "\n", "\n", "", "return", "net", "\n", "\n"]], "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.CreateMultiBoxHead": [[1191, 1333], ["net.keys", "len", "range", "caffe.layers.Concat", "mbox_layers.append", "caffe.layers.Concat", "mbox_layers.append", "caffe.layers.Concat", "mbox_layers.append", "len", "len", "model_libs.ConvBNLayer", "caffe.layers.Permute", "caffe.layers.Flatten", "loc_layers.append", "model_libs.ConvBNLayer", "caffe.layers.Permute", "caffe.layers.Flatten", "conf_layers.append", "caffe.layers.PriorBox", "priorbox_layers.append", "caffe.layers.Concat", "mbox_layers.append", "len", "len", "len", "len", "len", "len", "len", "len", "len", "len", "type", "len", "len", "len", "net.update", "net.update", "net.update", "model_libs.ConvBNLayer", "caffe.layers.Permute", "caffe.layers.Flatten", "objectness_layers.append", "caffe.layers.Normalize", "model_libs.ConvBNLayer", "type", "type", "len", "len", "len", "len", "net.update", "net.update", "len", "len", "len", "len", "dict"], "function", ["home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ConvBNLayer", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ConvBNLayer", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ConvBNLayer", "home.repos.pwc.inspect_result.szq0214_DSOD.None.model_libs.ConvBNLayer"], ["", "def", "CreateMultiBoxHead", "(", "net", ",", "data_layer", "=", "\"data\"", ",", "num_classes", "=", "[", "]", ",", "from_layers", "=", "[", "]", ",", "\n", "use_objectness", "=", "False", ",", "normalizations", "=", "[", "]", ",", "use_batchnorm", "=", "True", ",", "lr_mult", "=", "1", ",", "\n", "use_scale", "=", "True", ",", "min_sizes", "=", "[", "]", ",", "max_sizes", "=", "[", "]", ",", "prior_variance", "=", "[", "0.1", "]", ",", "\n", "aspect_ratios", "=", "[", "]", ",", "steps", "=", "[", "]", ",", "img_height", "=", "0", ",", "img_width", "=", "0", ",", "share_location", "=", "True", ",", "\n", "flip", "=", "True", ",", "clip", "=", "True", ",", "offset", "=", "0.5", ",", "inter_layer_depth", "=", "[", "]", ",", "kernel_size", "=", "1", ",", "pad", "=", "0", ",", "\n", "conf_postfix", "=", "''", ",", "loc_postfix", "=", "''", ",", "**", "bn_param", ")", ":", "\n", "    ", "assert", "num_classes", ",", "\"must provide num_classes\"", "\n", "assert", "num_classes", ">", "0", ",", "\"num_classes must be positive number\"", "\n", "if", "normalizations", ":", "\n", "        ", "assert", "len", "(", "from_layers", ")", "==", "len", "(", "normalizations", ")", ",", "\"from_layers and normalizations should have same length\"", "\n", "", "assert", "len", "(", "from_layers", ")", "==", "len", "(", "min_sizes", ")", ",", "\"from_layers and min_sizes should have same length\"", "\n", "if", "max_sizes", ":", "\n", "        ", "assert", "len", "(", "from_layers", ")", "==", "len", "(", "max_sizes", ")", ",", "\"from_layers and max_sizes should have same length\"", "\n", "", "if", "aspect_ratios", ":", "\n", "        ", "assert", "len", "(", "from_layers", ")", "==", "len", "(", "aspect_ratios", ")", ",", "\"from_layers and aspect_ratios should have same length\"", "\n", "", "if", "steps", ":", "\n", "        ", "assert", "len", "(", "from_layers", ")", "==", "len", "(", "steps", ")", ",", "\"from_layers and steps should have same length\"", "\n", "", "net_layers", "=", "net", ".", "keys", "(", ")", "\n", "assert", "data_layer", "in", "net_layers", ",", "\"data_layer is not in net's layers\"", "\n", "if", "inter_layer_depth", ":", "\n", "        ", "assert", "len", "(", "from_layers", ")", "==", "len", "(", "inter_layer_depth", ")", ",", "\"from_layers and inter_layer_depth should have same length\"", "\n", "\n", "", "num", "=", "len", "(", "from_layers", ")", "\n", "priorbox_layers", "=", "[", "]", "\n", "loc_layers", "=", "[", "]", "\n", "conf_layers", "=", "[", "]", "\n", "objectness_layers", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "0", ",", "num", ")", ":", "\n", "        ", "from_layer", "=", "from_layers", "[", "i", "]", "\n", "\n", "# Get the normalize value.", "\n", "if", "normalizations", ":", "\n", "            ", "if", "normalizations", "[", "i", "]", "!=", "-", "1", ":", "\n", "                ", "norm_name", "=", "\"{}_norm\"", ".", "format", "(", "from_layer", ")", "\n", "net", "[", "norm_name", "]", "=", "L", ".", "Normalize", "(", "net", "[", "from_layer", "]", ",", "scale_filler", "=", "dict", "(", "type", "=", "\"constant\"", ",", "value", "=", "normalizations", "[", "i", "]", ")", ",", "\n", "across_spatial", "=", "False", ",", "channel_shared", "=", "False", ")", "\n", "from_layer", "=", "norm_name", "\n", "\n", "# Add intermediate layers.", "\n", "", "", "if", "inter_layer_depth", ":", "\n", "            ", "if", "inter_layer_depth", "[", "i", "]", ">", "0", ":", "\n", "                ", "inter_name", "=", "\"{}_inter\"", ".", "format", "(", "from_layer", ")", "\n", "ConvBNLayer", "(", "net", ",", "from_layer", ",", "inter_name", ",", "use_bn", "=", "use_batchnorm", ",", "use_relu", "=", "True", ",", "lr_mult", "=", "lr_mult", ",", "\n", "num_output", "=", "inter_layer_depth", "[", "i", "]", ",", "kernel_size", "=", "3", ",", "pad", "=", "1", ",", "stride", "=", "1", ",", "**", "bn_param", ")", "\n", "from_layer", "=", "inter_name", "\n", "\n", "# Estimate number of priors per location given provided parameters.", "\n", "", "", "min_size", "=", "min_sizes", "[", "i", "]", "\n", "if", "type", "(", "min_size", ")", "is", "not", "list", ":", "\n", "            ", "min_size", "=", "[", "min_size", "]", "\n", "", "aspect_ratio", "=", "[", "]", "\n", "if", "len", "(", "aspect_ratios", ")", ">", "i", ":", "\n", "            ", "aspect_ratio", "=", "aspect_ratios", "[", "i", "]", "\n", "if", "type", "(", "aspect_ratio", ")", "is", "not", "list", ":", "\n", "                ", "aspect_ratio", "=", "[", "aspect_ratio", "]", "\n", "", "", "max_size", "=", "[", "]", "\n", "if", "len", "(", "max_sizes", ")", ">", "i", ":", "\n", "            ", "max_size", "=", "max_sizes", "[", "i", "]", "\n", "if", "type", "(", "max_size", ")", "is", "not", "list", ":", "\n", "                ", "max_size", "=", "[", "max_size", "]", "\n", "", "if", "max_size", ":", "\n", "                ", "assert", "len", "(", "max_size", ")", "==", "len", "(", "min_size", ")", ",", "\"max_size and min_size should have same length.\"", "\n", "", "", "if", "max_size", ":", "\n", "            ", "num_priors_per_location", "=", "(", "2", "+", "len", "(", "aspect_ratio", ")", ")", "*", "len", "(", "min_size", ")", "\n", "", "else", ":", "\n", "            ", "num_priors_per_location", "=", "(", "1", "+", "len", "(", "aspect_ratio", ")", ")", "*", "len", "(", "min_size", ")", "\n", "", "if", "flip", ":", "\n", "            ", "num_priors_per_location", "+=", "len", "(", "aspect_ratio", ")", "*", "len", "(", "min_size", ")", "\n", "", "step", "=", "[", "]", "\n", "if", "len", "(", "steps", ")", ">", "i", ":", "\n", "            ", "step", "=", "steps", "[", "i", "]", "\n", "\n", "# Create location prediction layer.", "\n", "", "name", "=", "\"{}_mbox_loc{}\"", ".", "format", "(", "from_layer", ",", "loc_postfix", ")", "\n", "num_loc_output", "=", "num_priors_per_location", "*", "4", ";", "\n", "if", "not", "share_location", ":", "\n", "            ", "num_loc_output", "*=", "num_classes", "\n", "", "ConvBNLayer", "(", "net", ",", "from_layer", ",", "name", ",", "use_bn", "=", "use_batchnorm", ",", "use_relu", "=", "False", ",", "lr_mult", "=", "lr_mult", ",", "\n", "num_output", "=", "num_loc_output", ",", "kernel_size", "=", "kernel_size", ",", "pad", "=", "pad", ",", "stride", "=", "1", ",", "**", "bn_param", ")", "\n", "permute_name", "=", "\"{}_perm\"", ".", "format", "(", "name", ")", "\n", "net", "[", "permute_name", "]", "=", "L", ".", "Permute", "(", "net", "[", "name", "]", ",", "order", "=", "[", "0", ",", "2", ",", "3", ",", "1", "]", ")", "\n", "flatten_name", "=", "\"{}_flat\"", ".", "format", "(", "name", ")", "\n", "net", "[", "flatten_name", "]", "=", "L", ".", "Flatten", "(", "net", "[", "permute_name", "]", ",", "axis", "=", "1", ")", "\n", "loc_layers", ".", "append", "(", "net", "[", "flatten_name", "]", ")", "\n", "\n", "# Create confidence prediction layer.", "\n", "name", "=", "\"{}_mbox_conf{}\"", ".", "format", "(", "from_layer", ",", "conf_postfix", ")", "\n", "num_conf_output", "=", "num_priors_per_location", "*", "num_classes", ";", "\n", "ConvBNLayer", "(", "net", ",", "from_layer", ",", "name", ",", "use_bn", "=", "use_batchnorm", ",", "use_relu", "=", "False", ",", "lr_mult", "=", "lr_mult", ",", "\n", "num_output", "=", "num_conf_output", ",", "kernel_size", "=", "kernel_size", ",", "pad", "=", "pad", ",", "stride", "=", "1", ",", "**", "bn_param", ")", "\n", "permute_name", "=", "\"{}_perm\"", ".", "format", "(", "name", ")", "\n", "net", "[", "permute_name", "]", "=", "L", ".", "Permute", "(", "net", "[", "name", "]", ",", "order", "=", "[", "0", ",", "2", ",", "3", ",", "1", "]", ")", "\n", "flatten_name", "=", "\"{}_flat\"", ".", "format", "(", "name", ")", "\n", "net", "[", "flatten_name", "]", "=", "L", ".", "Flatten", "(", "net", "[", "permute_name", "]", ",", "axis", "=", "1", ")", "\n", "conf_layers", ".", "append", "(", "net", "[", "flatten_name", "]", ")", "\n", "\n", "# Create prior generation layer.", "\n", "name", "=", "\"{}_mbox_priorbox\"", ".", "format", "(", "from_layer", ")", "\n", "net", "[", "name", "]", "=", "L", ".", "PriorBox", "(", "net", "[", "from_layer", "]", ",", "net", "[", "data_layer", "]", ",", "min_size", "=", "min_size", ",", "\n", "clip", "=", "clip", ",", "variance", "=", "prior_variance", ",", "offset", "=", "offset", ")", "\n", "if", "max_size", ":", "\n", "            ", "net", ".", "update", "(", "name", ",", "{", "'max_size'", ":", "max_size", "}", ")", "\n", "", "if", "aspect_ratio", ":", "\n", "            ", "net", ".", "update", "(", "name", ",", "{", "'aspect_ratio'", ":", "aspect_ratio", ",", "'flip'", ":", "flip", "}", ")", "\n", "", "if", "step", ":", "\n", "            ", "net", ".", "update", "(", "name", ",", "{", "'step'", ":", "step", "}", ")", "\n", "", "if", "img_height", "!=", "0", "and", "img_width", "!=", "0", ":", "\n", "            ", "if", "img_height", "==", "img_width", ":", "\n", "                ", "net", ".", "update", "(", "name", ",", "{", "'img_size'", ":", "img_height", "}", ")", "\n", "", "else", ":", "\n", "                ", "net", ".", "update", "(", "name", ",", "{", "'img_h'", ":", "img_height", ",", "'img_w'", ":", "img_width", "}", ")", "\n", "", "", "priorbox_layers", ".", "append", "(", "net", "[", "name", "]", ")", "\n", "\n", "# Create objectness prediction layer.", "\n", "if", "use_objectness", ":", "\n", "            ", "name", "=", "\"{}_mbox_objectness\"", ".", "format", "(", "from_layer", ")", "\n", "num_obj_output", "=", "num_priors_per_location", "*", "2", ";", "\n", "ConvBNLayer", "(", "net", ",", "from_layer", ",", "name", ",", "use_bn", "=", "use_batchnorm", ",", "use_relu", "=", "False", ",", "lr_mult", "=", "lr_mult", ",", "\n", "num_output", "=", "num_obj_output", ",", "kernel_size", "=", "kernel_size", ",", "pad", "=", "pad", ",", "stride", "=", "1", ",", "**", "bn_param", ")", "\n", "permute_name", "=", "\"{}_perm\"", ".", "format", "(", "name", ")", "\n", "net", "[", "permute_name", "]", "=", "L", ".", "Permute", "(", "net", "[", "name", "]", ",", "order", "=", "[", "0", ",", "2", ",", "3", ",", "1", "]", ")", "\n", "flatten_name", "=", "\"{}_flat\"", ".", "format", "(", "name", ")", "\n", "net", "[", "flatten_name", "]", "=", "L", ".", "Flatten", "(", "net", "[", "permute_name", "]", ",", "axis", "=", "1", ")", "\n", "objectness_layers", ".", "append", "(", "net", "[", "flatten_name", "]", ")", "\n", "\n", "# Concatenate priorbox, loc, and conf layers.", "\n", "", "", "mbox_layers", "=", "[", "]", "\n", "name", "=", "\"mbox_loc\"", "\n", "net", "[", "name", "]", "=", "L", ".", "Concat", "(", "*", "loc_layers", ",", "axis", "=", "1", ")", "\n", "mbox_layers", ".", "append", "(", "net", "[", "name", "]", ")", "\n", "name", "=", "\"mbox_conf\"", "\n", "net", "[", "name", "]", "=", "L", ".", "Concat", "(", "*", "conf_layers", ",", "axis", "=", "1", ")", "\n", "mbox_layers", ".", "append", "(", "net", "[", "name", "]", ")", "\n", "name", "=", "\"mbox_priorbox\"", "\n", "net", "[", "name", "]", "=", "L", ".", "Concat", "(", "*", "priorbox_layers", ",", "axis", "=", "2", ")", "\n", "mbox_layers", ".", "append", "(", "net", "[", "name", "]", ")", "\n", "if", "use_objectness", ":", "\n", "        ", "name", "=", "\"mbox_objectness\"", "\n", "net", "[", "name", "]", "=", "L", ".", "Concat", "(", "*", "objectness_layers", ",", "axis", "=", "1", ")", "\n", "mbox_layers", ".", "append", "(", "net", "[", "name", "]", ")", "\n", "\n", "", "return", "mbox_layers", "\n", "", ""]], "home.repos.pwc.inspect_result.szq0214_DSOD.None.DSOD300_detection_demo.get_labelname": [[33, 47], ["len", "type", "xrange", "labelnames.append"], "function", ["None"], ["def", "get_labelname", "(", "labelmap", ",", "labels", ")", ":", "\n", "    ", "num_labels", "=", "len", "(", "labelmap", ".", "item", ")", "\n", "labelnames", "=", "[", "]", "\n", "if", "type", "(", "labels", ")", "is", "not", "list", ":", "\n", "        ", "labels", "=", "[", "labels", "]", "\n", "", "for", "label", "in", "labels", ":", "\n", "        ", "found", "=", "False", "\n", "for", "i", "in", "xrange", "(", "0", ",", "num_labels", ")", ":", "\n", "            ", "if", "label", "==", "labelmap", ".", "item", "[", "i", "]", ".", "label", ":", "\n", "                ", "found", "=", "True", "\n", "labelnames", ".", "append", "(", "labelmap", ".", "item", "[", "i", "]", ".", "display_name", ")", "\n", "break", "\n", "", "", "assert", "found", "==", "True", "\n", "", "return", "labelnames", "\n", "\n"]]}