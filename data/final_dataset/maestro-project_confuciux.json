{"home.repos.pwc.inspect_result.maestro-project_confuciux.utils.get_action_space.get_action_space": [[3, 18], ["NameError", "numpy.max", "numpy.min", "numpy.array", "numpy.array", "range", "len", "range"], "function", ["None"], ["def", "get_action_space", "(", "use_default", "=", "True", ")", ":", "\n", "    ", "if", "use_default", ":", "\n", "        ", "action_size", "=", "12", "\n", "action_space", "=", "[", "np", ".", "array", "(", "[", "1", ",", "2", ",", "4", ",", "8", ",", "12", ",", "16", ",", "24", ",", "32", ",", "48", ",", "64", ",", "96", ",", "128", "]", ")", ",", "# Choice for number of PEs", "\n", "np", ".", "array", "(", "[", "i", "+", "1", "for", "i", "in", "range", "(", "action_size", ")", "]", ")", ",", "]", "# Choice for number of buffer unit", "\n", "\n", "", "else", ":", "\n", "\n", "\n", "        ", "raise", "NameError", "(", "\"Please define the customized action space.\"", ")", "\n", "\n", "", "action_bound", "=", "[", "np", ".", "max", "(", "a", ")", "for", "a", "in", "action_space", "]", "\n", "action_bottom", "=", "[", "np", ".", "min", "(", "a", ")", "for", "a", "in", "action_space", "]", "\n", "action_space", "=", "[", "action_space", "[", "i", "]", "/", "action_bound", "[", "i", "]", "for", "i", "in", "range", "(", "len", "(", "action_space", ")", ")", "]", "\n", "return", "action_space", ",", "action_bound", ",", "action_bottom", "", "", ""]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.main.policy_graident": [[27, 80], ["collections.deque", "range", "env.shuffle_model", "env.reset", "range", "collections.deque.append", "scores.append", "agent.get_chkpt", "env.get_chkpt", "max", "agent.ajust_lr", "agent.act", "env.step", "agent.step", "np.mean", "np.mean", "env.save_chkpt", "torch.save", "print", "print"], "function", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.shuffle_model", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.reset", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.get_chkpt", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.get_chkpt", "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.ajust_lr", "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.act", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.step", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.step", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.save_chkpt"], ["def", "policy_graident", "(", "n_episodes", "=", "100000", ",", "max_t", "=", "1000", ",", "print_every", "=", "10", ",", "outfile", "=", "\"out.plt\"", ",", "chkpt_file", "=", "\"trial.plt\"", ",", "eps", "=", "0", ",", "temperature", "=", "1", ")", ":", "\n", "\n", "    ", "best_score", "=", "-", "2", "**", "20", "\n", "scores_window", "=", "deque", "(", "maxlen", "=", "print_every", ")", "\n", "scores", "=", "[", "]", "\n", "episodes", "=", "0", "\n", "has_succeed_history", "=", "False", "\n", "for", "i_episode", "in", "range", "(", "1", "+", "episodes", ",", "n_episodes", "+", "episodes", "+", "1", ")", ":", "\n", "        ", "if", "(", "i_episode", "+", "1", ")", "%", "100", "==", "0", "and", "has_succeed_history", ":", "\n", "            ", "eps", "/=", "1.2", "\n", "temperature", "/=", "1.01", "\n", "temperature", "=", "max", "(", "temperature", ",", "1", ")", "\n", "agent", ".", "ajust_lr", "(", "ratio", "=", "0.8", ",", "min_lr", "=", "1e-6", ")", "\n", "\n", "", "score", "=", "0", "\n", "env", ".", "shuffle_model", "(", ")", "\n", "state", ",", "infos", "=", "env", ".", "reset", "(", ")", "\n", "for", "t", "in", "range", "(", "max_t", ")", ":", "\n", "            ", "action", ",", "log_prob", "=", "agent", ".", "act", "(", "state", ",", "infos", ",", "eps", ",", "temperature", ")", "\n", "next_state", ",", "reward", ",", "done", ",", "infos", ",", "sig", ",", "impt", "=", "env", ".", "step", "(", "action", ")", "\n", "agent", ".", "step", "(", "state", ",", "action", ",", "log_prob", ",", "reward", ",", "next_state", ",", "done", ",", "sig", ",", "impt", ",", "infos", ")", "\n", "state", "=", "next_state", "\n", "score", "+=", "reward", "\n", "if", "done", ":", "\n", "                ", "break", "\n", "", "", "scores_window", ".", "append", "(", "score", ")", "\n", "scores", ".", "append", "(", "score", ")", "\n", "if", "np", ".", "mean", "(", "scores_window", ")", ">", "best_score", ":", "\n", "            ", "best_score", "=", "np", ".", "mean", "(", "scores_window", ")", "\n", "", "agent_chkpt", "=", "agent", ".", "get_chkpt", "(", ")", "\n", "env_chkpt", "=", "env", ".", "get_chkpt", "(", ")", "\n", "others_chkpt", "=", "{", "\n", "\"scores\"", ":", "scores", ",", "\n", "\"best_score\"", ":", "best_score", ",", "\n", "\"scores_window\"", ":", "scores_window", ",", "\n", "\"episodes\"", ":", "i_episode", "}", "\n", "chkpt", "=", "{", "\"agent_chkpt\"", ":", "agent_chkpt", ",", "\n", "\"env_chkpt\"", ":", "env_chkpt", ",", "\n", "\"others_chkpt\"", ":", "others_chkpt", "}", "\n", "if", "i_episode", "%", "5", "==", "0", ":", "\n", "            ", "env", ".", "save_chkpt", "(", "chkpt_file", ")", "\n", "torch", ".", "save", "(", "chkpt", ",", "outfile", ")", "\n", "\n", "", "if", "infos", "[", "\"succeed\"", "]", ":", "\n", "            ", "has_succeed_history", "=", "True", "\n", "print", "(", "\"Episode {}: succeed\"", ".", "format", "(", "i_episode", ")", ")", "\n", "", "else", ":", "\n", "            ", "print", "(", "\"Episode {}: finding\"", ".", "format", "(", "i_episode", ")", ")", "\n", "\n", "\n", "\n", "\n", "", "", "return", "scores", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.main.get_probe_int": [[81, 86], ["np.array", "sol.flatten.flatten", "enumerate"], "function", ["None"], ["", "def", "get_probe_int", "(", "sol", ")", ":", "\n", "    ", "sol", "=", "np", ".", "array", "(", "sol", ")", "\n", "sol", "=", "sol", ".", "flatten", "(", ")", "\n", "parms", "=", "{", "\"{}\"", ".", "format", "(", "i", ")", ":", "e", "for", "i", ",", "e", "in", "enumerate", "(", "sol", ")", "}", "\n", "return", "parms", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.main.get_probe": [[87, 92], ["np.log2", "sol.flatten.flatten", "enumerate"], "function", ["None"], ["", "def", "get_probe", "(", "sol", ")", ":", "\n", "    ", "sol", "=", "np", ".", "log2", "(", "sol", ")", "\n", "sol", "=", "sol", ".", "flatten", "(", ")", "\n", "parms", "=", "{", "\"{}\"", ".", "format", "(", "i", ")", ":", "e", "for", "i", ",", "e", "in", "enumerate", "(", "sol", ")", "}", "\n", "return", "parms", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.main.genetic_search": [[94, 152], ["range", "len", "np.ones", "np.ones", "max", "src.select_parents", "src.mutation", "src.self_crossover", "range", "np.argmax", "reward_record_g.append", "best_rewards_g.append", "print", "float", "min", "env.exterior_search", "max", "np.array", "copy.deepcopy", "copy.deepcopy", "copy.deepcopy", "float", "np.nanmean", "float"], "function", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.select_parents", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.mutation", "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.ga_confx.self_crossover", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search"], ["", "def", "genetic_search", "(", "best_sol", ",", "best_reward", ",", "action_bound", ",", "action_bottom", ",", "num_layers", "=", "None", ",", "num_generations", "=", "100", ",", "num_pop", "=", "20", ")", ":", "\n", "    ", "reward_record_g", "=", "[", "]", "\n", "best_rewards_g", "=", "[", "]", "\n", "best_sol_g", "=", "best_sol", "\n", "best_reward_g", "=", "best_reward", "\n", "num_layers", "=", "num_layers", "if", "num_layers", "else", "len", "(", "model_defs", ")", "\n", "\n", "\n", "num_generations", "=", "num_generations", "\n", "num_population", "=", "num_pop", "\n", "num_parents_init", "=", "8", "\n", "\n", "new_population", "=", "np", ".", "ones", "(", "(", "num_population", ",", "num_layers", ",", "2", ")", ")", "*", "best_sol", "\n", "\n", "count", "=", "0", "\n", "\n", "fitness", "=", "np", ".", "ones", "(", "(", "num_population", ",", "2", ")", ",", "float", ")", "*", "best_reward", "\n", "\n", "# print(\"Cases {}: reward: {}\".format(0, best_reward_g))", "\n", "count_non_valid", "=", "0", "\n", "for", "g", "in", "range", "(", "num_generations", ")", ":", "\n", "        ", "gen_best", "=", "-", "float", "(", "\"Inf\"", ")", "\n", "num_parents", "=", "max", "(", "1", ",", "min", "(", "num_parents_init", ",", "num_population", "-", "count_non_valid", ")", ")", "\n", "count_non_valid", "=", "0", "\n", "\n", "parents", "=", "ga", ".", "select_parents", "(", "new_population", ",", "fitness", ",", "\n", "num_parents", ",", "num_layers", ")", "\n", "\n", "\n", "ga", ".", "mutation", "(", "parents", ",", "new_population", ",", "action_bound", ",", "action_bottom", ",", "env", ",", "fitness", ",", "range_alpha", "=", "ratio", ")", "\n", "ga", ".", "self_crossover", "(", "new_population", ",", "eps", "=", "0.2", ")", "\n", "new_population", "[", "0", ",", ":", "]", "=", "parents", "[", "0", "]", "\n", "\n", "for", "i", "in", "range", "(", "num_population", ")", ":", "\n", "            ", "reward", ",", "total_constraint", "=", "env", ".", "exterior_search", "(", "new_population", "[", "i", "]", ")", "\n", "if", "total_constraint", ">", "env", ".", "constraint_value", ":", "\n", "                ", "reward", "=", "float", "(", "\"-Inf\"", ")", "\n", "count_non_valid", "+=", "1", "\n", "", "gen_best", "=", "max", "(", "gen_best", ",", "reward", ")", "\n", "fitness", "[", "i", "]", "=", "np", ".", "array", "(", "[", "reward", ",", "total_constraint", "]", ")", "\n", "", "max_idx", "=", "np", ".", "argmax", "(", "fitness", "[", ":", ",", "0", "]", ")", "\n", "reward_record_g", ".", "append", "(", "copy", ".", "deepcopy", "(", "np", ".", "nanmean", "(", "fitness", "[", "fitness", "[", ":", ",", "0", "]", ">", "float", "(", "\"-Inf\"", ")", "]", ",", "axis", "=", "0", ")", ")", ")", "\n", "if", "best_reward_g", "[", "0", "]", "<", "fitness", "[", "max_idx", "]", "[", "0", "]", ":", "\n", "            ", "best_reward_g", "=", "copy", ".", "deepcopy", "(", "fitness", "[", "max_idx", "]", ")", "\n", "best_sol_g", "=", "copy", ".", "deepcopy", "(", "new_population", "[", "max_idx", "]", ")", "\n", "", "best_rewards_g", ".", "append", "(", "best_reward_g", ")", "\n", "chkpt", "=", "{", "\n", "\"best_sol_g\"", ":", "best_sol_g", ",", "\n", "\"best_rewards_g\"", ":", "best_rewards_g", ",", "\n", "\"reward_record_g\"", ":", "reward_record_g", ",", "\n", "\"num_population_g\"", ":", "num_population", ",", "\n", "\"num_generations_g\"", ":", "num_generations", ",", "\n", "\"num_parents_g\"", ":", "num_parents", "\n", "}", "\n", "\n", "print", "(", "f\"Gen {g+1}:  Best reward: {best_reward_g[0]:.4e}, Used Constraint: {best_reward_g[1]/env.constraint_value * 100:.1f}%\"", ")", "\n", "\n", "", "return", "chkpt", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.main.check_sol": [[154, 158], ["env.exterior_search", "print"], "function", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search"], ["", "def", "check_sol", "(", "sol", ")", ":", "\n", "    ", "reward", "=", "env", ".", "exterior_search", "(", "sol", ")", "\n", "print", "(", "\"Reward: {}\"", ".", "format", "(", "reward", ")", ")", "\n", "return", "reward", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.ga_confx.get_population_fitness": [[4, 9], ["numpy.sum"], "function", ["None"], ["def", "get_population_fitness", "(", "equation_inputs", ",", "pop", ")", ":", "\n", "# Calculating the fitness value of each solution in the current population.", "\n", "# The fitness function caulcuates the sum of products between each input and its corresponding weight.", "\n", "    ", "fitness", "=", "np", ".", "sum", "(", "pop", "*", "equation_inputs", ",", "axis", "=", "1", ")", "\n", "return", "fitness", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.ga_confx.select_parents": [[10, 18], ["copy.deepcopy", "numpy.argsort"], "function", ["None"], ["", "def", "select_parents", "(", "pop", ",", "fitness", ",", "num_parents", ",", "num_layers", ")", ":", "\n", "# Selecting the best individuals in the current generation as parents for producing the offspring of the next generation.", "\n", "    ", "idx", "=", "np", ".", "argsort", "(", "fitness", "[", ":", ",", "0", "]", ")", "[", ":", ":", "-", "1", "]", "\n", "pop", "[", ":", "]", "=", "pop", "[", "idx", "]", "\n", "fitness", "[", ":", "]", "=", "fitness", "[", "idx", "]", "\n", "parents", "=", "copy", ".", "deepcopy", "(", "pop", "[", ":", "num_parents", "]", ")", "\n", "\n", "return", "parents", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.ga_confx.self_crossover": [[22, 28], ["range", "random.random", "numpy.random.randint", "random.randint"], "function", ["None"], ["", "def", "self_crossover", "(", "pop", ",", "eps", "=", "0", ")", ":", "\n", "    ", "for", "idx", "in", "range", "(", "1", ",", "pop", ".", "shape", "[", "0", "]", ")", ":", "\n", "        ", "if", "random", ".", "random", "(", ")", "<", "eps", ":", "\n", "            ", "picks", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "pop", ".", "shape", "[", "1", "]", ",", "2", ")", "\n", "pick", "=", "random", ".", "randint", "(", "0", ",", "1", ")", "\n", "pop", "[", "idx", "]", "[", "picks", "[", "0", "]", "]", "[", "pick", "]", ",", "pop", "[", "idx", "]", "[", "picks", "[", "1", "]", "]", "[", "pick", "]", "=", "pop", "[", "idx", "]", "[", "picks", "[", "1", "]", "]", "[", "pick", "]", ",", "pop", "[", "idx", "]", "[", "picks", "[", "0", "]", "]", "[", "pick", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.ga_confx.crossover": [[40, 55], ["numpy.empty", "numpy.uint8", "range"], "function", ["None"], ["", "", "", "def", "crossover", "(", "parents", ",", "offspring_size", ",", "num_layers", ",", "eps", "=", "1", ")", ":", "\n", "    ", "offspring", "=", "np", ".", "empty", "(", "(", "offspring_size", ",", "num_layers", ",", "2", ")", ")", "\n", "crossover_point", "=", "np", ".", "uint8", "(", "num_layers", "/", "2", ")", "\n", "\n", "for", "k", "in", "range", "(", "offspring_size", ")", ":", "\n", "# Index of the first parent to mate.", "\n", "        ", "parent1_idx", "=", "k", "%", "parents", ".", "shape", "[", "0", "]", "\n", "# Index of the second parent to mate.", "\n", "parent2_idx", "=", "(", "k", "+", "1", ")", "%", "parents", ".", "shape", "[", "0", "]", "\n", "# The new offspring will have its first half of its genes taken from the first parent.", "\n", "offspring", "[", "k", "]", "[", "0", ":", "crossover_point", "]", "=", "parents", "[", "parent1_idx", "]", "[", "0", ":", "crossover_point", "]", "\n", "# The new offspring will have its second half of its genes taken from the second parent.", "\n", "offspring", "[", "k", "]", "[", "crossover_point", ":", "]", "=", "parents", "[", "parent2_idx", "]", "[", "crossover_point", ":", "]", "\n", "\n", "", "return", "offspring", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.ga_confx.mutation_pe": [[59, 110], ["copy.deepcopy", "numpy.sum", "range", "random.randint", "random.randint", "numpy.concatenate", "env.quick_observe", "max", "numpy.random.uniform", "int", "copy.deepcopy", "min", "numpy.concatenate", "env.quick_observe", "min", "max", "len", "len"], "function", ["home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.quick_observe", "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.quick_observe"], ["", "def", "mutation_pe", "(", "parents", ",", "pop", ",", "action_bound", ",", "action_bottom", ",", "env", ",", "fitness_list", ",", "pe_cstr", "=", "8192", ",", "range_alpha", "=", "1", ")", ":", "\n", "# Mutation changes a single gene in each offspring randomly.", "\n", "    ", "idx", "=", "0", "\n", "count", "=", "0", "\n", "max_count", "=", "pop", ".", "shape", "[", "0", "]", "*", "2", "\n", "while", "idx", "<", "pop", ".", "shape", "[", "0", "]", ":", "\n", "        ", "max_count", "-=", "1", "\n", "if", "max_count", "<", "0", ":", "\n", "            ", "break", "\n", "# The random value to be added to the gene.", "\n", "", "parent", "=", "parents", "[", "idx", "%", "len", "(", "parents", ")", "]", "\n", "pop", "[", "idx", "]", "=", "copy", ".", "deepcopy", "(", "parent", ")", "\n", "reward", ",", "constraint", "=", "fitness_list", "[", "idx", "]", "\n", "constraint_budget", "=", "env", ".", "constraint_value", "-", "constraint", "\n", "num_pe", "=", "np", ".", "sum", "(", "p", ",", "0", ")", "\n", "left_pe", "=", "pe_cstr", "-", "num_pe", "[", "0", "]", "\n", "succeed", "=", "0", "\n", "for", "_", "in", "range", "(", "3", ")", ":", "\n", "            ", "p", "=", "pop", "[", "idx", "]", "\n", "\n", "pick", "=", "random", ".", "randint", "(", "0", ",", "1", ")", "\n", "i", "=", "random", ".", "randint", "(", "0", ",", "len", "(", "pop", "[", "idx", "]", ")", "-", "1", ")", "\n", "maestro_state", "=", "np", ".", "concatenate", "(", "(", "env", ".", "model_defs", "[", "i", "]", ",", "p", "[", "i", "]", ")", ")", "\n", "reward_layer", ",", "constraint_layer", "=", "env", ".", "quick_observe", "(", "maestro_state", ")", "\n", "thr", "=", "max", "(", "1", ",", "action_bound", "[", "pick", "]", "//", "2", ")", "\n", "# thr = min(64, parent[i][pick]//2)", "\n", "sampling", "=", "np", ".", "random", ".", "uniform", "(", "-", "range_alpha", ",", "range_alpha", ",", "1", ")", "\n", "# sampling = min(left_resource, int(sampling * thr))", "\n", "sampling", "=", "int", "(", "sampling", "*", "thr", ")", "\n", "saved_value", "=", "copy", ".", "deepcopy", "(", "p", "[", "i", "]", "[", "pick", "]", ")", "\n", "if", "pick", "==", "0", ":", "\n", "                ", "adding_pe", "=", "min", "(", "left_pe", ",", "sampling", ")", "\n", "p", "[", "i", "]", "[", "pick", "]", "=", "p", "[", "i", "]", "[", "pick", "]", "+", "adding_pe", "\n", "left_pe", "=", "left_pe", "-", "adding_pe", "\n", "", "else", ":", "\n", "                ", "p", "[", "i", "]", "[", "pick", "]", "=", "p", "[", "i", "]", "[", "pick", "]", "+", "sampling", "\n", "\n", "", "p", "[", "i", "]", "[", "pick", "]", "=", "min", "(", "max", "(", "action_bottom", "[", "pick", "]", ",", "p", "[", "i", "]", "[", "pick", "]", ")", ",", "action_bound", "[", "pick", "]", ")", "\n", "maestro_state", "=", "np", ".", "concatenate", "(", "(", "env", ".", "model_defs", "[", "i", "]", ",", "p", "[", "i", "]", ")", ")", "\n", "reward_layer_new", ",", "constraint_layer_new", "=", "env", ".", "quick_observe", "(", "maestro_state", ")", "\n", "# if reward_layer_new < reward_layer:", "\n", "#     p[i][pick] = saved_value", "\n", "if", "constraint_layer_new", "-", "constraint_layer", ">", "constraint_budget", ":", "\n", "                ", "p", "[", "i", "]", "[", "pick", "]", "=", "saved_value", "\n", "", "else", ":", "\n", "                ", "constraint_budget", "-=", "(", "constraint_layer_new", "-", "constraint_layer", ")", "\n", "succeed", "=", "1", "\n", "", "", "if", "not", "succeed", ":", "\n", "            ", "count", "+=", "1", "\n", "", "else", ":", "\n", "            ", "idx", "+=", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.ga_confx.mutation_coarse": [[116, 178], ["copy.deepcopy", "range", "random.randint", "random.randint", "numpy.concatenate", "env.quick_observe", "copy.deepcopy", "numpy.concatenate", "env.quick_observe", "len", "len", "random.randint"], "function", ["home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.quick_observe", "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.quick_observe"], ["", "", "", "def", "mutation_coarse", "(", "parents", ",", "pop", ",", "action_bound", ",", "action_bottom", ",", "action_space", ",", "env", ",", "fitness_list", ",", "range_alpha", "=", "1", ")", ":", "\n", "# Mutation changes a single gene in each offspring randomly.", "\n", "    ", "idx", "=", "0", "\n", "count", "=", "0", "\n", "max_count", "=", "pop", ".", "shape", "[", "0", "]", "*", "2", "\n", "while", "idx", "<", "pop", ".", "shape", "[", "0", "]", ":", "\n", "        ", "max_count", "-=", "1", "\n", "if", "max_count", "<", "0", ":", "\n", "            ", "break", "\n", "# The random value to be added to the gene.", "\n", "", "parent", "=", "parents", "[", "idx", "%", "len", "(", "parents", ")", "]", "\n", "pop", "[", "idx", "]", "=", "copy", ".", "deepcopy", "(", "parent", ")", "\n", "reward", ",", "constraint", "=", "fitness_list", "[", "idx", "]", "\n", "constraint_budget", "=", "env", ".", "constraint_value", "-", "constraint", "\n", "succeed", "=", "0", "\n", "for", "_", "in", "range", "(", "1", ")", ":", "\n", "            ", "p", "=", "pop", "[", "idx", "]", "\n", "\n", "pick", "=", "random", ".", "randint", "(", "0", ",", "1", ")", "\n", "i", "=", "random", ".", "randint", "(", "0", ",", "len", "(", "pop", "[", "idx", "]", ")", "-", "1", ")", "\n", "maestro_state", "=", "np", ".", "concatenate", "(", "(", "env", ".", "model_defs", "[", "i", "]", ",", "p", "[", "i", "]", ")", ")", "\n", "reward_layer", ",", "constraint_layer", "=", "env", ".", "quick_observe", "(", "maestro_state", ")", "\n", "saved_value", "=", "copy", ".", "deepcopy", "(", "p", "[", "i", "]", "[", "pick", "]", ")", "\n", "\n", "choice", "=", "action_space", "[", "pick", "]", "*", "action_bound", "[", "pick", "]", "\n", "p", "[", "i", "]", "[", "pick", "]", "=", "choice", "[", "random", ".", "randint", "(", "0", ",", "11", ")", "]", "\n", "# thr = max(1, action_bound[pick]//2)", "\n", "# # thr = min(64, parent[i][pick]//2)", "\n", "# sampling =  np.random.uniform(-range_alpha,range_alpha,1)", "\n", "# # sampling = min(left_resource, int(sampling * thr))", "\n", "# sampling = int(sampling * thr)", "\n", "# p[i][pick] = p[i][pick] + sampling", "\n", "# p[i][pick] = min(max(action_bottom[pick],p[i][pick]), action_bound[pick])", "\n", "# if pick==0:", "\n", "#     #=====method 1=============================", "\n", "#     choice = action_space[pick] * action_bound[pick]", "\n", "#     value = saved_value", "\n", "#     min_idx = np.argmin(np.abs(choice - value))", "\n", "#     p[i][pick] = choice[max(0, min_idx - 1)]", "\n", "#     if sampling <0:", "\n", "#         p[i][pick] = choice[max(0,min_idx-1)]", "\n", "#     else:", "\n", "#         p[i][pick] = choice[min(11, min_idx + 1)]", "\n", "\n", "#======method 2==============================", "\n", "# choice = action_space[pick]*action_bound[pick]", "\n", "# value = p[i][pick]", "\n", "# min_idx = np.argmin(np.abs(choice - value))", "\n", "# p[i][pick] = choice[min_idx]", "\n", "maestro_state", "=", "np", ".", "concatenate", "(", "(", "env", ".", "model_defs", "[", "i", "]", ",", "p", "[", "i", "]", ")", ")", "\n", "reward_layer_new", ",", "constraint_layer_new", "=", "env", ".", "quick_observe", "(", "maestro_state", ")", "\n", "# if reward_layer_new < reward_layer:", "\n", "#     p[i][pick] = saved_value", "\n", "if", "constraint_layer_new", "-", "constraint_layer", ">", "constraint_budget", ":", "\n", "                ", "p", "[", "i", "]", "[", "pick", "]", "=", "saved_value", "\n", "", "else", ":", "\n", "                ", "constraint_budget", "-=", "(", "constraint_layer_new", "-", "constraint_layer", ")", "\n", "succeed", "=", "1", "\n", "", "", "if", "not", "succeed", ":", "\n", "            ", "count", "+=", "1", "\n", "", "else", ":", "\n", "            ", "idx", "+=", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.ga_confx.mutation": [[182, 225], ["copy.deepcopy", "range", "random.randint", "random.randint", "numpy.concatenate", "env.quick_observe", "max", "numpy.random.uniform", "int", "copy.deepcopy", "min", "numpy.concatenate", "env.quick_observe", "max", "len", "len"], "function", ["home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.quick_observe", "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.quick_observe"], ["", "", "", "def", "mutation", "(", "parents", ",", "pop", ",", "action_bound", ",", "action_bottom", ",", "env", ",", "fitness_list", ",", "range_alpha", "=", "1", ")", ":", "\n", "# Mutation changes a single gene in each offspring randomly.", "\n", "    ", "idx", "=", "0", "\n", "count", "=", "0", "\n", "max_count", "=", "pop", ".", "shape", "[", "0", "]", "*", "2", "\n", "while", "idx", "<", "pop", ".", "shape", "[", "0", "]", ":", "\n", "        ", "max_count", "-=", "1", "\n", "if", "max_count", "<", "0", ":", "\n", "            ", "break", "\n", "# The random value to be added to the gene.", "\n", "", "parent", "=", "parents", "[", "idx", "%", "len", "(", "parents", ")", "]", "\n", "pop", "[", "idx", "]", "=", "copy", ".", "deepcopy", "(", "parent", ")", "\n", "reward", ",", "constraint", "=", "fitness_list", "[", "idx", "]", "\n", "constraint_budget", "=", "env", ".", "constraint_value", "-", "constraint", "\n", "succeed", "=", "0", "\n", "for", "_", "in", "range", "(", "3", ")", ":", "\n", "            ", "p", "=", "pop", "[", "idx", "]", "\n", "\n", "pick", "=", "random", ".", "randint", "(", "0", ",", "1", ")", "\n", "i", "=", "random", ".", "randint", "(", "0", ",", "len", "(", "pop", "[", "idx", "]", ")", "-", "1", ")", "\n", "maestro_state", "=", "np", ".", "concatenate", "(", "(", "env", ".", "model_defs", "[", "i", "]", ",", "p", "[", "i", "]", ")", ")", "\n", "reward_layer", ",", "constraint_layer", "=", "env", ".", "quick_observe", "(", "maestro_state", ")", "\n", "thr", "=", "max", "(", "1", ",", "action_bound", "[", "pick", "]", "//", "2", ")", "\n", "# thr = min(64, parent[i][pick]//2)", "\n", "sampling", "=", "np", ".", "random", ".", "uniform", "(", "-", "range_alpha", ",", "range_alpha", ",", "1", ")", "\n", "# sampling = min(left_resource, int(sampling * thr))", "\n", "sampling", "=", "int", "(", "sampling", "*", "thr", ")", "\n", "saved_value", "=", "copy", ".", "deepcopy", "(", "p", "[", "i", "]", "[", "pick", "]", ")", "\n", "p", "[", "i", "]", "[", "pick", "]", "=", "p", "[", "i", "]", "[", "pick", "]", "+", "sampling", "\n", "p", "[", "i", "]", "[", "pick", "]", "=", "min", "(", "max", "(", "action_bottom", "[", "pick", "]", ",", "p", "[", "i", "]", "[", "pick", "]", ")", ",", "action_bound", "[", "pick", "]", ")", "\n", "maestro_state", "=", "np", ".", "concatenate", "(", "(", "env", ".", "model_defs", "[", "i", "]", ",", "p", "[", "i", "]", ")", ")", "\n", "reward_layer_new", ",", "constraint_layer_new", "=", "env", ".", "quick_observe", "(", "maestro_state", ")", "\n", "# if reward_layer_new < reward_layer:", "\n", "#     p[i][pick] = saved_value", "\n", "if", "constraint_layer_new", "-", "constraint_layer", ">", "constraint_budget", ":", "\n", "                ", "p", "[", "i", "]", "[", "pick", "]", "=", "saved_value", "\n", "", "else", ":", "\n", "                ", "constraint_budget", "-=", "(", "constraint_layer_new", "-", "constraint_layer", ")", "\n", "succeed", "=", "1", "\n", "", "", "if", "not", "succeed", ":", "\n", "            ", "count", "+=", "1", "\n", "", "else", ":", "\n", "            ", "idx", "+=", "1", "\n", "# print(\"Invalid num: {}\".format(count))", ""]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.__init__": [[29, 57], ["numpy.cumsum", "random.seed", "Actor().to", "torch.Adam", "torch.Adam", "torch.Adam", "torch.Adam", "torch.lr_scheduler.ReduceLROnPlateau", "torch.lr_scheduler.ReduceLROnPlateau", "torch.lr_scheduler.ReduceLROnPlateau", "torch.lr_scheduler.ReduceLROnPlateau", "rl_confx.Agent.init_hidden_lstm", "float", "rl_confx.Agent.actor.parameters", "rl_confx.Actor"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.init_hidden_lstm"], ["    ", "def", "__init__", "(", "self", ",", "dim_size", ",", "resource_size", ",", "n_action_steps", ",", "action_size", ",", "seed", ",", "action_step_obs_size", "=", "1", ",", "lstm_hid_size", "=", "128", ",", "decay", "=", "0.95", ",", "is_gemm", "=", "False", ")", ":", "\n", "        ", "self", ".", "dim_size", "=", "dim_size", "\n", "self", ".", "action_size", "=", "action_size", "\n", "self", ".", "n_action_steps", "=", "n_action_steps", "\n", "self", ".", "resource_size", "=", "resource_size", "\n", "self", ".", "action_step_obs_size", "=", "action_step_obs_size", "\n", "# state_div = [self.dim_size, self.resource_size, self.n_action_steps, self.action_step_obs_size ]", "\n", "self", ".", "is_gemm", "=", "is_gemm", "\n", "if", "is_gemm", ":", "\n", "            ", "state_div", "=", "[", "3", ",", "1", ",", "2", ",", "1", "]", "\n", "", "else", ":", "\n", "            ", "state_div", "=", "[", "7", ",", "1", ",", "2", ",", "1", "]", "\n", "", "self", ".", "state_div", "=", "np", ".", "cumsum", "(", "state_div", ")", "\n", "self", ".", "seed", "=", "random", ".", "seed", "(", "seed", ")", "\n", "\n", "self", ".", "actor", "=", "Actor", "(", "dim_size", ",", "resource_size", ",", "n_action_steps", ",", "action_size", ",", "seed", ",", "lstm_hid_size", ")", ".", "to", "(", "device", ")", "\n", "self", ".", "actor_optimizer", "=", "optim", ".", "Adam", "(", "self", ".", "actor", ".", "parameters", "(", ")", ",", "lr", "=", "LR_ACTOR", ")", "\n", "self", ".", "scheduler", "=", "optim", ".", "lr_scheduler", ".", "ReduceLROnPlateau", "(", "self", ".", "actor_optimizer", ",", "factor", "=", "0.9", ",", "min_lr", "=", "1e-6", ")", "\n", "self", ".", "saved_log_probs", "=", "[", "]", "\n", "self", ".", "rewards", "=", "[", "]", "\n", "self", ".", "baseline", "=", "None", "\n", "self", ".", "decay", "=", "decay", "\n", "self", ".", "lstm_hid_size", "=", "lstm_hid_size", "\n", "self", ".", "lstm_hid_value", "=", "self", ".", "init_hidden_lstm", "(", ")", "\n", "self", ".", "lowest_reward", "=", "0", "\n", "self", ".", "best_reward_whole_eps", "=", "float", "(", "\"-Inf\"", ")", "\n", "self", ".", "has_succeed_history", "=", "False", "\n", "self", ".", "bad_counts", "=", "0", "\n", "", "def", "step", "(", "self", ",", "state", ",", "actions", ",", "log_prob", ",", "reward", ",", "next_state", ",", "done", ",", "sig", ",", "impt", ",", "infos", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.step": [[57, 63], ["rl_confx.Agent.rewards.append", "rl_confx.Agent.saved_log_probs.append", "rl_confx.Agent.learn"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.learn"], ["", "def", "step", "(", "self", ",", "state", ",", "actions", ",", "log_prob", ",", "reward", ",", "next_state", ",", "done", ",", "sig", ",", "impt", ",", "infos", ")", ":", "\n", "\n", "        ", "self", ".", "rewards", ".", "append", "(", "reward", ")", "\n", "self", ".", "saved_log_probs", ".", "append", "(", "log_prob", ")", "\n", "if", "done", "and", "sig", ":", "\n", "            ", "self", ".", "learn", "(", "GAMMA", ",", "impt", ",", "infos", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.save_hidden_lstm": [[64, 66], ["copy.deepcopy", "rl_confx.Agent.actor.lstm.state_dict"], "methods", ["None"], ["", "", "def", "save_hidden_lstm", "(", "self", ")", ":", "\n", "        ", "self", ".", "lstm_hid", "=", "copy", ".", "deepcopy", "(", "self", ".", "actor", ".", "lstm", ".", "state_dict", "(", ")", ")", "\n", "", "def", "load_hidden_lstm", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.load_hidden_lstm": [[66, 69], ["rl_confx.Agent.actor.lstm.load_state_dict"], "methods", ["None"], ["", "def", "load_hidden_lstm", "(", "self", ")", ":", "\n", "        ", "self", ".", "actor", ".", "lstm", ".", "load_state_dict", "(", "self", ".", "lstm_hid", ")", "\n", "del", "self", ".", "lstm_hid", "\n", "", "def", "init_hidden_lstm", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.init_hidden_lstm": [[69, 71], ["None"], "methods", ["None"], ["", "def", "init_hidden_lstm", "(", "self", ")", ":", "\n", "        ", "return", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.act": [[72, 96], ["torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "torch.from_numpy().type().to", "rl_confx.Agent.actor", "torch.distributions.Categorical", "torch.distributions.Categorical", "torch.distributions.Categorical", "torch.distributions.Categorical", "torch.distributions.Categorical.sample", "torch.distributions.Categorical.sample", "torch.distributions.Categorical.sample", "torch.distributions.Categorical.sample", "random.random", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.clamp", "torch.clamp", "torch.clamp", "torch.clamp", "torch.clamp", "torch.clamp", "torch.clamp", "torch.clamp", "torch.clamp", "torch.clamp", "torch.clamp", "torch.clamp", "torch.clamp", "torch.clamp", "torch.clamp", "torch.clamp", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "torch.from_numpy().type", "numpy.array", "torch.distributions.Categorical.log_prob", "torch.distributions.Categorical.log_prob", "torch.distributions.Categorical.log_prob", "torch.distributions.Categorical.log_prob", "torch.distributions.Categorical.log_prob", "torch.distributions.Categorical.log_prob", "torch.distributions.Categorical.log_prob", "torch.distributions.Categorical.log_prob", "random.random", "p.size", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy"], "methods", ["None"], ["", "def", "act", "(", "self", ",", "state", ",", "infos", ",", "eps", "=", "0.0", ",", "temperature", "=", "1", ")", ":", "\n", "\n", "        ", "dimensions", "=", "state", "[", "0", ":", "self", ".", "state_div", "[", "0", "]", "]", "\n", "action_status", "=", "state", "[", "self", ".", "state_div", "[", "0", "]", ":", "self", ".", "state_div", "[", "1", "]", "]", "\n", "actions", "=", "state", "[", "self", ".", "state_div", "[", "1", "]", ":", "self", ".", "state_div", "[", "2", "]", "]", "\n", "\n", "action_step", "=", "state", "[", "self", ".", "state_div", "[", "2", "]", ":", "self", ".", "state_div", "[", "3", "]", "]", "\n", "\n", "dimensions", "=", "torch", ".", "from_numpy", "(", "dimensions", ")", ".", "type", "(", "torch", ".", "FloatTensor", ")", ".", "to", "(", "device", ")", "\n", "action_status", "=", "torch", ".", "from_numpy", "(", "action_status", ")", ".", "type", "(", "torch", ".", "FloatTensor", ")", ".", "to", "(", "device", ")", "\n", "actions", "=", "torch", ".", "from_numpy", "(", "actions", ")", ".", "type", "(", "torch", ".", "FloatTensor", ")", ".", "to", "(", "device", ")", "\n", "action_step", "=", "torch", ".", "from_numpy", "(", "action_step", ")", ".", "type", "(", "torch", ".", "LongTensor", ")", ".", "to", "(", "device", ")", "\n", "\n", "(", "p", ")", ",", "self", ".", "lstm_hid_value", "=", "self", ".", "actor", "(", "dimensions", ",", "action_status", ",", "actions", ",", "action_step", ",", "self", ".", "lstm_hid_value", ",", "temperature", "=", "temperature", ")", "\n", "m", "=", "Categorical", "(", "p", ")", "\n", "\n", "action", "=", "m", ".", "sample", "(", ")", "\n", "if", "random", ".", "random", "(", ")", "<", "eps", ":", "\n", "            ", "action2", "=", "action", ".", "data", "+", "1", "if", "random", ".", "random", "(", ")", "<", "0.5", "else", "action", "-", "1", "\n", "action2", "=", "torch", ".", "from_numpy", "(", "np", ".", "array", "(", "[", "action2", "]", ")", ")", "\n", "action2", "=", "torch", ".", "clamp", "(", "action2", ",", "0", ",", "p", ".", "size", "(", "1", ")", "-", "1", ")", "\n", "return", "action2", ".", "data", ",", "m", ".", "log_prob", "(", "action2", ")", "\n", "", "else", ":", "\n", "            ", "return", "action", ".", "data", ",", "m", ".", "log_prob", "(", "action", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.ajust_lr": [[98, 101], ["max"], "methods", ["None"], ["", "", "def", "ajust_lr", "(", "self", ",", "ratio", ",", "min_lr", "=", "1e-8", ")", ":", "\n", "        ", "for", "param_group", "in", "self", ".", "actor_optimizer", ".", "param_groups", ":", "\n", "            ", "param_group", "[", "'lr'", "]", "=", "max", "(", "min_lr", ",", "param_group", "[", "'lr'", "]", "*", "ratio", ")", "\n", "", "", "def", "reset", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.reset": [[101, 105], ["rl_confx.Agent.init_hidden_lstm"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.init_hidden_lstm"], ["", "", "def", "reset", "(", "self", ")", ":", "\n", "        ", "self", ".", "saved_log_probs", "=", "[", "]", "\n", "self", ".", "rewards", "=", "[", "]", "\n", "self", ".", "lstm_hid_value", "=", "self", ".", "init_hidden_lstm", "(", ")", "\n", "", "def", "set_fitness", "(", "self", ",", "fitness", "=", "\"energy\"", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.set_fitness": [[105, 107], ["None"], "methods", ["None"], ["", "def", "set_fitness", "(", "self", ",", "fitness", "=", "\"energy\"", ")", ":", "\n", "        ", "self", ".", "fitness", "=", "fitness", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.minmax_reward": [[108, 111], ["max", "numpy.min"], "methods", ["None"], ["", "def", "minmax_reward", "(", "self", ",", "reward", ")", ":", "\n", "        ", "self", ".", "lowest_reward", "=", "max", "(", "self", ".", "lowest_reward", ",", "np", ".", "min", "(", "reward", ")", ")", "\n", "reward", "-=", "self", ".", "lowest_reward", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.modify_reward": [[113, 118], ["len", "reward[].mean", "reward[].std"], "methods", ["None"], ["", "def", "modify_reward", "(", "self", ",", "reward", ")", ":", "\n", "        ", "pick_idx", "=", "reward", "!=", "0", "\n", "pick", "=", "reward", "[", "pick_idx", "]", "\n", "if", "len", "(", "pick", ")", ">", "0", ":", "\n", "            ", "reward", "[", "pick_idx", "]", "=", "(", "reward", "[", "pick_idx", "]", "-", "reward", "[", "pick_idx", "]", ".", "mean", "(", ")", ")", "/", "(", "reward", "[", "pick_idx", "]", ".", "std", "(", ")", "+", "EPISIOLON", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.impt_adj_reward": [[120, 124], ["len", "len"], "methods", ["None"], ["", "", "def", "impt_adj_reward", "(", "self", ",", "reward", ",", "impt", ")", ":", "\n", "        ", "if", "impt", "is", "not", "None", ":", "\n", "            ", "reward", "[", ":", "len", "(", "impt", ")", "]", "=", "reward", "[", ":", "len", "(", "impt", ")", "]", "*", "impt", "\n", "", "return", "reward", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.backup": [[125, 137], ["copy.deepcopy", "rl_confx.Agent.actor.state_dict"], "methods", ["None"], ["", "def", "backup", "(", "self", ",", "infos", ")", ":", "\n", "        ", "if", "infos", "[", "\"succeed\"", "]", ":", "\n", "            ", "self", ".", "has_succeed_history", "=", "True", "\n", "reward_whole_eps", "=", "infos", "[", "\"reward_whole_eps\"", "]", "\n", "if", "self", ".", "best_reward_whole_eps", "<", "reward_whole_eps", ":", "\n", "                ", "self", ".", "best_reward_whole_eps", "=", "reward_whole_eps", "\n", "self", ".", "actor_backup", "=", "copy", ".", "deepcopy", "(", "self", ".", "actor", ".", "state_dict", "(", ")", ")", "\n", "self", ".", "bad_counts", "=", "0", "\n", "", "else", ":", "\n", "                ", "self", ".", "bad_counts", "+=", "1", "\n", "", "", "elif", "self", ".", "has_succeed_history", ":", "\n", "            ", "self", ".", "bad_counts", "+=", "1", "\n", "", "", "def", "actor_refresh", "(", "self", ",", "refresh_threshold", "=", "50", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.actor_refresh": [[137, 141], ["rl_confx.Agent.actor.load_state_dict"], "methods", ["None"], ["", "", "def", "actor_refresh", "(", "self", ",", "refresh_threshold", "=", "50", ")", ":", "\n", "        ", "if", "self", ".", "bad_counts", ">", "refresh_threshold", ":", "\n", "            ", "self", ".", "actor", ".", "load_state_dict", "(", "self", ".", "actor_backup", ")", "\n", "self", ".", "bad_counts", "=", "0", "\n", "", "", "def", "learn", "(", "self", ",", "gamma", ",", "impt", ",", "infos", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.learn": [[141, 168], ["numpy.array", "rl_confx.Agent.impt_adj_reward", "numpy.array", "zip", "torch.cat().sum", "torch.cat().sum", "torch.cat().sum", "torch.cat().sum", "torch.cat().sum", "torch.cat().sum", "torch.cat().sum", "torch.cat().sum", "torch.cat().sum", "torch.cat().sum", "torch.cat().sum", "torch.cat().sum", "torch.cat().sum", "torch.cat().sum", "torch.cat().sum", "torch.cat().sum", "rl_confx.Agent.actor_optimizer.zero_grad", "torch.cat().sum.backward", "torch.cat().sum.backward", "torch.cat().sum.backward", "torch.cat().sum.backward", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "torch.nn.utils.clip_grad_norm_", "rl_confx.Agent.actor_optimizer.step", "rl_confx.Agent.reset", "rl_confx.Agent.minmax_reward", "numpy.array.insert", "torch.cat().sum.append", "torch.cat().sum.append", "torch.cat().sum.append", "torch.cat().sum.append", "rl_confx.Agent.actor.parameters", "rl_confx.Agent.actor.lstm.parameters", "rl_confx.Agent.mean", "rl_confx.Agent.std", "numpy.array.mean", "numpy.array.std", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.impt_adj_reward", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.step", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.reset", "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.minmax_reward"], ["", "", "def", "learn", "(", "self", ",", "gamma", ",", "impt", ",", "infos", ")", ":", "\n", "# self.backup(infos)", "\n", "        ", "rewards", "=", "np", ".", "array", "(", "self", ".", "rewards", ")", "\n", "rewards", "=", "(", "rewards", "-", "rewards", ".", "mean", "(", ")", ")", "/", "(", "rewards", ".", "std", "(", ")", "+", "EPISIOLON", ")", "\n", "rewards", "=", "self", ".", "impt_adj_reward", "(", "rewards", ",", "impt", ")", "\n", "if", "self", ".", "fitness", "==", "\"thrpt_btnk\"", ":", "\n", "            ", "self", ".", "minmax_reward", "(", "rewards", ")", "\n", "", "dis_rewards", "=", "[", "]", "\n", "R", "=", "0", "\n", "for", "r", "in", "rewards", "[", ":", ":", "-", "1", "]", ":", "\n", "            ", "R", "=", "r", "+", "gamma", "*", "R", "\n", "dis_rewards", ".", "insert", "(", "0", ",", "R", ")", "\n", "", "dis_rewards", "=", "np", ".", "array", "(", "dis_rewards", ")", "\n", "dis_rewards", "=", "(", "dis_rewards", "-", "dis_rewards", ".", "mean", "(", ")", ")", "/", "(", "dis_rewards", ".", "std", "(", ")", "+", "EPISIOLON", ")", "\n", "\n", "\n", "policy_loss", "=", "[", "]", "\n", "for", "log_prob", ",", "r", "in", "zip", "(", "self", ".", "saved_log_probs", ",", "dis_rewards", ")", ":", "\n", "            ", "policy_loss", ".", "append", "(", "-", "log_prob", "*", "r", ")", "\n", "", "policy_loss", "=", "torch", ".", "cat", "(", "policy_loss", ")", ".", "sum", "(", ")", "\n", "self", ".", "actor_optimizer", ".", "zero_grad", "(", ")", "\n", "policy_loss", ".", "backward", "(", ")", "\n", "torch", ".", "nn", ".", "utils", ".", "clip_grad_norm_", "(", "self", ".", "actor", ".", "parameters", "(", ")", ",", "CLIPPING_MODEL", ")", "\n", "torch", ".", "nn", ".", "utils", ".", "clip_grad_norm_", "(", "self", ".", "actor", ".", "lstm", ".", "parameters", "(", ")", ",", "CLIPPING_LSTM", ")", "\n", "self", ".", "actor_optimizer", ".", "step", "(", ")", "\n", "# self.actor_refresh()", "\n", "self", ".", "reset", "(", ")", "\n", "", "def", "get_chkpt", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.get_chkpt": [[168, 175], ["rl_confx.Agent.actor.state_dict", "rl_confx.Agent.actor_optimizer.state_dict"], "methods", ["None"], ["", "def", "get_chkpt", "(", "self", ")", ":", "\n", "        ", "chkpt", "=", "{", "\"seed\"", ":", "self", ".", "seed", ",", "\n", "\"actor\"", ":", "self", ".", "actor", ".", "state_dict", "(", ")", ",", "\n", "\"baseline\"", ":", "self", ".", "baseline", ",", "\n", "\"scheduler\"", ":", "self", ".", "scheduler", ",", "\n", "\"optimizer\"", ":", "self", ".", "actor_optimizer", ".", "state_dict", "(", ")", "}", "\n", "return", "chkpt", "\n", "", "def", "load_actor", "(", "self", ",", "chkpt", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Agent.load_actor": [[175, 180], ["rl_confx.Agent.actor.load_state_dict", "rl_confx.Agent.actor_optimizer.load_state_dict"], "methods", ["None"], ["", "def", "load_actor", "(", "self", ",", "chkpt", ")", ":", "\n", "        ", "self", ".", "actor", ".", "load_state_dict", "(", "chkpt", "[", "\"actor\"", "]", ")", "\n", "self", ".", "actor_optimizer", ".", "load_state_dict", "(", "chkpt", "[", "\"optimizer\"", "]", ")", "\n", "self", ".", "baseline", "=", "chkpt", "[", "\"baseline\"", "]", "\n", "self", ".", "scheduler", "=", "chkpt", "[", "\"scheduler\"", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Actor.__init__": [[188, 208], ["torch.Module.__init__", "torch.manual_seed", "torch.manual_seed", "torch.manual_seed", "torch.manual_seed", "torch.manual_seed", "torch.manual_seed", "torch.manual_seed", "torch.manual_seed", "torch.manual_seed", "torch.manual_seed", "torch.manual_seed", "torch.manual_seed", "torch.manual_seed", "torch.manual_seed", "torch.manual_seed", "torch.manual_seed", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.nn.LSTMCell", "torch.nn.LSTMCell", "torch.nn.LSTMCell", "torch.nn.LSTMCell", "torch.nn.LSTMCell", "torch.nn.LSTMCell", "torch.nn.LSTMCell", "torch.nn.LSTMCell", "torch.nn.LSTMCell", "torch.nn.LSTMCell", "torch.nn.LSTMCell", "torch.nn.LSTMCell", "torch.nn.LSTMCell", "torch.nn.LSTMCell", "torch.nn.LSTMCell", "torch.nn.LSTMCell"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.__init__"], ["    ", "def", "__init__", "(", "self", ",", "dim_size", ",", "resource_size", ",", "n_action_steps", ",", "action_size", ",", "seed", ",", "h_size", "=", "128", ",", "hidden_dim", "=", "10", ")", ":", "\n", "        ", "super", "(", "Actor", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "seed", "=", "torch", ".", "manual_seed", "(", "seed", ")", "\n", "self", ".", "encoder", "=", "nn", ".", "Linear", "(", "dim_size", ",", "hidden_dim", ")", "\n", "self", ".", "encoder_status", "=", "nn", ".", "Linear", "(", "1", ",", "hidden_dim", ")", "\n", "self", ".", "encoder_action_range", "=", "nn", ".", "Linear", "(", "action_size", ",", "hidden_dim", ")", "\n", "self", ".", "encoder_action", "=", "torch", ".", "nn", ".", "Linear", "(", "n_action_steps", ",", "hidden_dim", ")", "\n", "# self.encoder_action = torch.nn.ModuleList([torch.nn.Embedding(action_size, hidden_dim) for i in range(3)])", "\n", "self", ".", "fc10", "=", "nn", ".", "Linear", "(", "resource_size", ",", "hidden_dim", ")", "\n", "self", ".", "fc11", "=", "nn", ".", "Linear", "(", "3", "*", "hidden_dim", ",", "h_size", ")", "\n", "self", ".", "fc12", "=", "nn", ".", "Linear", "(", "h_size", ",", "h_size", ")", "\n", "self", ".", "fc13", "=", "nn", ".", "Linear", "(", "h_size", ",", "h_size", ")", "\n", "self", ".", "fc21", "=", "nn", ".", "Linear", "(", "h_size", ",", "action_size", ")", "\n", "self", ".", "fc22", "=", "nn", ".", "Linear", "(", "h_size", ",", "action_size", ")", "\n", "self", ".", "fc23", "=", "nn", ".", "Linear", "(", "h_size", ",", "action_size", ")", "\n", "self", ".", "output1", "=", "nn", ".", "Linear", "(", "action_size", ",", "action_size", ")", "\n", "self", ".", "output2", "=", "nn", ".", "Linear", "(", "action_size", ",", "action_size", ")", "\n", "self", ".", "decoder", "=", "[", "self", ".", "fc21", ",", "self", ".", "fc22", ",", "self", ".", "fc23", "]", "\n", "self", ".", "lstm", "=", "torch", ".", "nn", ".", "LSTMCell", "(", "h_size", ",", "h_size", ")", "\n", "self", ".", "n_action_steps", "=", "n_action_steps", "\n", "# self.init_weight()", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Actor.init_weight": [[209, 211], ["rl_confx.Actor.apply"], "methods", ["None"], ["", "def", "init_weight", "(", "self", ")", ":", "\n", "        ", "self", ".", "apply", "(", "init_weights", ")", "\n", "", "def", "forward", "(", "self", ",", "dimension", ",", "action_status", ",", "action_val", ",", "action_step", ",", "lstm_hid", ",", "temperature", "=", "1", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.Actor.forward": [[211, 238], ["rl_confx.Actor.encoder", "torch.softmax.unsqueeze", "rl_confx.Actor.encoder_action", "torch.softmax.unsqueeze", "rl_confx.Actor.encoder_status", "x3.unsqueeze.unsqueeze.unsqueeze", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "rl_confx.Actor.lstm", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "rl_confx.Actor.output1", "torch.softmax", "torch.softmax", "torch.softmax", "torch.softmax", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "rl_confx.Actor.output2", "torch.softmax", "torch.softmax", "torch.softmax", "torch.softmax", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "rl_confx.Actor.fc11", "rl_confx.Actor.fc12", "rl_confx.Actor.fc13", "decoder", "decoder"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "dimension", ",", "action_status", ",", "action_val", ",", "action_step", ",", "lstm_hid", ",", "temperature", "=", "1", ")", ":", "\n", "        ", "x1", "=", "self", ".", "encoder", "(", "dimension", ")", "\n", "x1", "=", "x1", ".", "unsqueeze", "(", "0", ")", "\n", "x2", "=", "self", ".", "encoder_action", "(", "action_val", ")", "\n", "x2", "=", "x2", ".", "unsqueeze", "(", "0", ")", "\n", "x3", "=", "self", ".", "encoder_status", "(", "action_status", ")", "\n", "x3", "=", "x3", ".", "unsqueeze", "(", "0", ")", "\n", "x", "=", "torch", ".", "cat", "(", "(", "x1", ",", "x2", ",", "x3", ")", ",", "dim", "=", "1", ")", "\n", "x", "=", "F", ".", "relu", "(", "self", ".", "fc11", "(", "x", ")", ")", "\n", "x", "=", "F", ".", "relu", "(", "self", ".", "fc12", "(", "x", ")", ")", "\n", "x", "=", "F", ".", "relu", "(", "self", ".", "fc13", "(", "x", ")", ")", "\n", "hx", ",", "cx", "=", "self", ".", "lstm", "(", "x", ",", "lstm_hid", ")", "\n", "x", "=", "hx", "\n", "decoder_idx", "=", "0", "\n", "decoder", "=", "self", ".", "decoder", "[", "decoder_idx", "]", "\n", "x1", "=", "F", ".", "relu", "(", "decoder", "(", "x", ")", ")", "\n", "x1", "=", "self", ".", "output1", "(", "x1", ")", "\n", "x1", "=", "F", ".", "softmax", "(", "x1", "/", "temperature", ",", "dim", "=", "1", ")", "\n", "\n", "decoder_idx", "=", "1", "\n", "decoder", "=", "self", ".", "decoder", "[", "decoder_idx", "]", "\n", "x2", "=", "F", ".", "relu", "(", "decoder", "(", "x", ")", ")", "\n", "x2", "=", "self", ".", "output2", "(", "x2", ")", "\n", "x2", "=", "F", ".", "softmax", "(", "x2", "/", "temperature", ",", "dim", "=", "1", ")", "\n", "x", "=", "torch", ".", "cat", "(", "(", "x1", ",", "x2", ")", ",", "dim", "=", "0", ")", "\n", "\n", "return", "(", "x", ")", ",", "(", "hx", ",", "cx", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.hidden_init": [[23, 27], ["layer.weight.data.size", "numpy.sqrt"], "function", ["None"], ["def", "hidden_init", "(", "layer", ")", ":", "\n", "    ", "fan_in", "=", "layer", ".", "weight", ".", "data", ".", "size", "(", ")", "[", "0", "]", "\n", "lim", "=", "1.", "/", "np", ".", "sqrt", "(", "fan_in", ")", "\n", "return", "(", "-", "lim", ",", "lim", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.rl_confx.init_weights": [[182, 186], ["type", "torch.nn.init.orthogonal_", "torch.nn.init.orthogonal_", "torch.nn.init.orthogonal_", "torch.nn.init.orthogonal_", "torch.nn.init.orthogonal_", "torch.nn.init.orthogonal_", "torch.nn.init.orthogonal_", "torch.nn.init.orthogonal_"], "function", ["None"], ["", "", "def", "init_weights", "(", "m", ")", ":", "\n", "    ", "if", "type", "(", "m", ")", "==", "nn", ".", "LSTMCell", ":", "\n", "        ", "torch", ".", "nn", ".", "init", ".", "orthogonal_", "(", "m", ".", "weight_hh", ")", "\n", "torch", ".", "nn", ".", "init", ".", "orthogonal_", "(", "m", ".", "weight_ih", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.__init__": [[21, 82], ["object.__init__", "random.seed", "random.randint", "get_action_space", "np.array", "len", "copy.deepcopy", "np.max", "copy.deepcopy", "float", "np.arange", "len", "len", "range"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.__init__", "home.repos.pwc.inspect_result.maestro-project_confuciux.utils.get_action_space.get_action_space"], ["    ", "def", "__init__", "(", "self", ",", "model_defs", ",", "finish_reward", "=", "100", ",", "dim_size", "=", "6", ",", "n_action_steps", "=", "2", ",", "resource_size", "=", "2", ",", "dataflow", "=", "\"dla\"", ")", ":", "\n", "        ", "super", "(", "MaestroEnvironment", ",", "self", ")", ".", "__init__", "(", ")", "\n", "dst_path", "=", "\"../../cost_model/maestro\"", "\n", "\n", "maestro", "=", "dst_path", "\n", "self", ".", "_executable", "=", "\"{}\"", ".", "format", "(", "maestro", ")", "\n", "random", ".", "seed", "(", ")", "\n", "random_file_name", "=", "random", ".", "randint", "(", "0", ",", "2", "**", "31", ")", "\n", "self", ".", "random_file_name", "=", "\"{}\"", ".", "format", "(", "random_file_name", ")", "\n", "\n", "\n", "global", "action_space", ",", "action_bound", ",", "action_bottom", "\n", "action_space", ",", "action_bound", ",", "action_bottom", "=", "get_action_space", "(", ")", "\n", "self", ".", "state", "=", "np", ".", "array", "(", "[", "0.5", "]", "*", "8", ")", "\n", "self", ".", "last_runtime", "=", "2", "**", "64", "\n", "self", ".", "last_energy", "=", "2", "**", "64", "\n", "self", ".", "last_throughput", "=", "1", "\n", "self", ".", "observation", "=", "[", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", "]", "\n", "self", ".", "resource_state", "=", "[", "0", ",", "0", "]", "\n", "self", ".", "consecutive_fail", "=", "0", "\n", "self", ".", "max_fail", "=", "0", "\n", "self", ".", "total_resources", "=", "action_bound", "\n", "self", ".", "action_bound", "=", "action_bound", "[", ":", "n_action_steps", "]", "\n", "self", ".", "total_step", "=", "len", "(", "model_defs", ")", "\n", "self", ".", "model_defs", "=", "model_defs", "\n", "self", ".", "model_defs_saved", "=", "copy", ".", "deepcopy", "(", "model_defs", ")", "\n", "model_bound", "=", "np", ".", "max", "(", "model_defs", ",", "axis", "=", "0", ",", "keepdims", "=", "True", ")", "\n", "self", ".", "model_defs_norm", "=", "model_defs", "/", "model_bound", "\n", "self", ".", "model_defs_norm_saved", "=", "copy", ".", "deepcopy", "(", "self", ".", "model_defs_norm", ")", "\n", "self", ".", "best_reward_whole", "=", "float", "(", "\"-inf\"", ")", "\n", "self", ".", "best_rewards", "=", "[", "]", "\n", "self", ".", "best_sol", "=", "None", "\n", "self", ".", "reward", "=", "0", "\n", "self", ".", "mae_reward", "=", "0", "\n", "self", ".", "finish_reward", "=", "finish_reward", "\n", "self", ".", "mae_reward_decay", "=", "0.", "\n", "self", ".", "worst_reward", "=", "None", "\n", "self", ".", "best_reward", "=", "None", "\n", "self", ".", "reward_scale", "=", "0", "\n", "self", ".", "n_action_steps", "=", "n_action_steps", "\n", "self", ".", "emptyinfo", "=", "[", "-", "1", "]", "*", "(", "len", "(", "self", ".", "observation", ")", "+", "len", "(", "self", ".", "resource_state", ")", ")", "\n", "self", ".", "resource_size", "=", "resource_size", "\n", "self", ".", "reward_whole_eps", "=", "0", "\n", "self", ".", "dim_size", "=", "dim_size", "\n", "self", ".", "reward_rec", "=", "[", "]", "\n", "self", ".", "min_reward", "=", "None", "\n", "self", ".", "running_ave_reward", "=", "None", "\n", "self", ".", "worst_reward_list", "=", "[", "None", "for", "_", "in", "range", "(", "self", ".", "total_step", ")", "]", "\n", "\n", "self", ".", "sig", "=", "1", "\n", "self", ".", "mac_rec", "=", "[", "]", "\n", "self", ".", "epoch", "=", "0", "\n", "self", ".", "sol_record", "=", "[", "]", "\n", "self", ".", "sol_reward_record", "=", "[", "]", "\n", "self", ".", "dataflow", "=", "dataflow", "\n", "self", ".", "constraint_value", "=", "2", "**", "63", "\n", "self", ".", "constraint", "=", "\"area\"", "\n", "self", ".", "prev_reward_whole_eps", "=", "0", "\n", "self", ".", "exp_table", "=", "{", "}", "\n", "self", ".", "draw", "=", "np", ".", "arange", "(", "0", ",", "self", ".", "total_step", ")", "\n", "self", ".", "is_gemm", "=", "False", "\n", "", "@", "property", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.get_state": [[82, 88], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "get_state", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n\n        \"\"\"", "\n", "return", "self", ".", "state", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.shuffle_model": [[89, 94], ["np.random.permutation"], "methods", ["None"], ["", "def", "shuffle_model", "(", "self", ")", ":", "\n", "        ", "draw", "=", "np", ".", "random", ".", "permutation", "(", "self", ".", "total_step", ")", "\n", "self", ".", "model_defs", "=", "self", ".", "model_defs_saved", "[", "draw", "]", "\n", "self", ".", "model_defs_norm", "=", "self", ".", "model_defs_norm_saved", "[", "draw", "]", "\n", "self", ".", "draw", "=", "draw", "\n", "", "def", "set_fitness", "(", "self", ",", "fitness", "=", "\"latency\"", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.set_fitness": [[94, 96], ["None"], "methods", ["None"], ["", "def", "set_fitness", "(", "self", ",", "fitness", "=", "\"latency\"", ")", ":", "\n", "        ", "self", ".", "fitness", "=", "fitness", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.set_constraint_value": [[97, 102], ["None"], "methods", ["None"], ["", "def", "set_constraint_value", "(", "self", ",", "max_constraint", ",", "min_constraint", ",", "constraint_value", ")", ":", "\n", "        ", "self", ".", "constraint_value", "=", "constraint_value", "\n", "self", ".", "constraint_info", "=", "{", "\"value\"", ":", "constraint_value", ",", "\n", "\"max\"", ":", "max_constraint", ",", "\n", "\"min\"", ":", "min_constraint", "}", "\n", "", "def", "set_constraint", "(", "self", ",", "constraint", "=", "\"area\"", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.set_constraint": [[102, 104], ["None"], "methods", ["None"], ["", "def", "set_constraint", "(", "self", ",", "constraint", "=", "\"area\"", ")", ":", "\n", "        ", "self", ".", "constraint", "=", "constraint", "\n", "", "def", "reset", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.reset": [[104, 124], ["np.array", "np.concatenate", "np.array", "enumerate"], "methods", ["None"], ["", "def", "reset", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n\n        \"\"\"", "\n", "self", ".", "reward_whole_eps", "=", "0", "\n", "self", ".", "mac_rec", "=", "[", "]", "\n", "self", ".", "sig", "=", "1", "\n", "self", ".", "reward_record", "=", "[", "]", "\n", "self", ".", "reward", "=", "0", "\n", "self", ".", "sol", "=", "[", "]", "\n", "self", ".", "mode", "=", "0", "\n", "self", ".", "actions_step", "=", "0", "\n", "self", ".", "total_used_constraints", "=", "0", "\n", "dimensions", "=", "self", ".", "model_defs_norm", "[", "self", ".", "mode", "]", "\n", "self", ".", "action_idx", "=", "[", "0", ",", "0", "]", "\n", "self", ".", "action", "=", "np", ".", "array", "(", "[", "action_space", "[", "idx", "]", "[", "val", "]", "for", "idx", ",", "val", "in", "enumerate", "(", "self", ".", "action_idx", ")", "]", ")", "\n", "self", ".", "state", "=", "np", ".", "concatenate", "(", "(", "dimensions", ",", "np", ".", "array", "(", "[", "0", ",", "0", ",", "0", ",", "0", "]", ",", "dtype", "=", "np", ".", "float", ")", ")", ")", "\n", "self", ".", "total_eps_rewards", "=", "0", "\n", "infos", "=", "{", "}", "\n", "return", "self", ".", "state", ",", "infos", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.norm_mac": [[125, 129], ["np.array", "np.sum"], "methods", ["None"], ["", "def", "norm_mac", "(", "self", ")", ":", "\n", "        ", "mac_rec", "=", "np", ".", "array", "(", "self", ".", "mac_rec", ")", "\n", "impt", "=", "mac_rec", "/", "np", ".", "sum", "(", "mac_rec", ")", "\n", "return", "impt", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.update_reward_impt": [[131, 143], ["env_confx.MaestroEnvironment.mac_rec.append", "env_confx.MaestroEnvironment.norm_mac"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.norm_mac"], ["", "def", "update_reward_impt", "(", "self", ",", "done", ")", ":", "\n", "# impt = np.ones(1, (self.mode) * self.n_action_steps + self.actions_step + 1)", "\n", "# if self.fitness == \"thrpt_ave\":", "\n", "#     impt_thrpt = self.norm_mac()", "\n", "#     impt[:len(impt_thrpt)] = impt_thrpt", "\n", "# return impt", "\n", "        ", "impt", "=", "None", "\n", "if", "self", ".", "fitness", "==", "\"thrpt_ave\"", ":", "\n", "            ", "self", ".", "mac_rec", ".", "append", "(", "self", ".", "observation", "[", "-", "1", "]", ")", "\n", "if", "done", ":", "\n", "                ", "impt", "=", "self", ".", "norm_mac", "(", ")", "\n", "", "", "return", "impt", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.norm_state": [[144, 147], ["None"], "methods", ["None"], ["", "def", "norm_state", "(", "self", ",", "T", ")", ":", "\n", "        ", "T", "[", ":", "-", "1", "]", "=", "(", "T", "[", ":", "-", "1", "]", "-", "0.5", ")", "*", "2", "\n", "return", "T", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.update_mode_and_step": [[148, 153], ["None"], "methods", ["None"], ["", "def", "update_mode_and_step", "(", "self", ")", ":", "\n", "        ", "self", ".", "actions_step", "+=", "2", "\n", "if", "self", ".", "actions_step", "==", "self", ".", "n_action_steps", ":", "\n", "            ", "self", ".", "mode", "+=", "1", "\n", "self", ".", "actions_step", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.get_ref_constraint": [[154, 158], ["env_confx.MaestroEnvironment.exterior_search", "range", "len"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search"], ["", "", "def", "get_ref_constraint", "(", "self", ",", "bound", "=", "action_bound", ")", ":", "\n", "        ", "sol", "=", "[", "bound", "[", ":", "self", ".", "n_action_steps", "]", "for", "i", "in", "range", "(", "len", "(", "self", ".", "model_defs", ")", ")", "]", "\n", "_", ",", "total_constraint", "=", "self", ".", "exterior_search", "(", "sol", ")", "\n", "return", "total_constraint", "\n", "", "def", "update_best_reward_list", "(", "self", ",", "succeed", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.update_best_reward_list": [[158, 164], ["env_confx.MaestroEnvironment.reward_rec.append", "env_confx.MaestroEnvironment.best_rewards.append"], "methods", ["None"], ["", "def", "update_best_reward_list", "(", "self", ",", "succeed", ")", ":", "\n", "        ", "self", ".", "epoch", "+=", "1", "\n", "self", ".", "reward_whole_eps", "=", "self", ".", "prev_reward_whole_eps", "if", "not", "succeed", "else", "self", ".", "reward_whole_eps", "\n", "self", ".", "prev_reward_whole_eps", "=", "self", ".", "reward_whole_eps", "\n", "self", ".", "reward_rec", ".", "append", "(", "self", ".", "reward_whole_eps", ")", "\n", "self", ".", "best_rewards", ".", "append", "(", "self", ".", "best_reward_whole", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.update_reward_whole": [[166, 175], ["env_confx.MaestroEnvironment.retrive_sol_order", "print"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.retrive_sol_order"], ["", "def", "update_reward_whole", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "reward_whole_eps", ">", "self", ".", "best_reward_whole", ":", "\n", "            ", "self", ".", "best_reward_whole", "=", "self", ".", "reward_whole_eps", "\n", "self", ".", "sol", "=", "self", ".", "retrive_sol_order", "(", "self", ".", "sol", ")", "\n", "print", "(", "\"Epoch {}: New best reward: {:9e}\"", ".", "format", "(", "self", ".", "epoch", ",", "self", ".", "best_reward_whole", ")", ")", "\n", "self", ".", "best_sol", "=", "{", "\"epoch\"", ":", "self", ".", "epoch", ",", "\n", "\"draw\"", ":", "self", ".", "draw", ",", "\n", "\"sol\"", ":", "self", ".", "sol", ",", "\n", "\"ctr\"", ":", "self", ".", "total_used_constraints", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.retrive_sol_order": [[176, 181], ["enumerate", "copy.deepcopy", "range", "len"], "methods", ["None"], ["", "", "def", "retrive_sol_order", "(", "self", ",", "sol", ")", ":", "\n", "        ", "ordered_sol", "=", "[", "None", "for", "_", "in", "range", "(", "len", "(", "sol", ")", ")", "]", "\n", "for", "i", ",", "d", "in", "enumerate", "(", "self", ".", "draw", ")", ":", "\n", "            ", "ordered_sol", "[", "d", "]", "=", "copy", ".", "deepcopy", "(", "sol", "[", "i", "]", ")", "\n", "", "return", "ordered_sol", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.get_reward": [[182, 206], ["tuple", "reward.copy", "min", "env_confx.MaestroEnvironment.oberserve_maestro", "float", "float"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.oberserve_maestro"], ["", "def", "get_reward", "(", "self", ",", "maestro_state", ")", ":", "\n", "        ", "table_entry", "=", "tuple", "(", "maestro_state", ")", "\n", "if", "table_entry", "in", "self", ".", "exp_table", ":", "\n", "            ", "reward", ",", "constraint", "=", "self", ".", "exp_table", "[", "table_entry", "]", "\n", "", "else", ":", "\n", "            ", "ret", "=", "self", ".", "oberserve_maestro", "(", "maestro_state", ")", "\n", "if", "ret", "is", "None", ":", "\n", "                ", "return", "-", "1", ",", "float", "(", "\"Inf\"", ")", ",", "-", "1", "\n", "", "reward", ",", "constraint", "=", "ret", "\n", "self", ".", "exp_table", "[", "table_entry", "]", "=", "(", "reward", ",", "constraint", ")", "\n", "# self.worst_reward = min(reward, self.worst_reward) if self.worst_reward else reward", "\n", "", "if", "not", "reward", ":", "\n", "            ", "self", ".", "sig", "=", "-", "1", "\n", "return", "-", "1", ",", "float", "(", "\"Inf\"", ")", ",", "-", "1", "\n", "", "if", "self", ".", "min_reward", "==", "None", ":", "\n", "            ", "self", ".", "min_reward", "=", "reward", "\n", "", "reward_saved", "=", "reward", ".", "copy", "(", ")", "\n", "# self.reward_window.append(reward)", "\n", "self", ".", "min_reward", "=", "min", "(", "self", ".", "min_reward", ",", "reward_saved", ")", "\n", "reward", "-=", "self", ".", "min_reward", "\n", "\n", "# reward -= min(self.reward_window)", "\n", "self", ".", "total_eps_rewards", "+=", "reward", "\n", "return", "reward", ",", "constraint", ",", "reward_saved", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.get_valid_action_range": [[209, 215], ["enumerate", "np.vstack().astype", "valid_action_range.append", "np.vstack"], "methods", ["None"], ["", "def", "get_valid_action_range", "(", "self", ")", ":", "\n", "        ", "valid_action_range", "=", "[", "]", "\n", "for", "i", ",", "r", "in", "enumerate", "(", "self", ".", "left_resource", ")", ":", "\n", "            ", "action_space_this", "=", "action_space", "[", "i", "]", "\n", "valid_action_range", ".", "append", "(", "[", "1", "if", "val", "==", "True", "else", "0", "for", "val", "in", "action_space_this", "<", "r", "]", ")", "\n", "", "return", "np", ".", "vstack", "(", "valid_action_range", ")", ".", "astype", "(", "float", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.update_total_reward_constraint": [[217, 220], ["None"], "methods", ["None"], ["", "def", "update_total_reward_constraint", "(", "self", ",", "constraint", ",", "reward_saved", ")", ":", "\n", "        ", "self", ".", "total_used_constraints", "+=", "constraint", "\n", "self", ".", "reward_whole_eps", "+=", "reward_saved", "\n", "", "def", "is_cluster_step", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.is_cluster_step": [[220, 226], ["min"], "methods", ["None"], ["", "def", "is_cluster_step", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "n_action_steps", ">", "2", ":", "\n", "            ", "if", "self", ".", "actions_step", "==", "self", ".", "n_action_steps", "-", "1", ":", "\n", "                ", "return", "True", "\n", "", "self", ".", "action", "[", "2", "]", "=", "min", "(", "self", ".", "action", "[", "2", "]", ",", "self", ".", "action", "[", "0", "]", ")", "\n", "", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.step": [[227, 270], ["action.cpu().numpy().flatten.cpu().numpy().flatten.cpu().numpy().flatten", "np.concatenate().copy", "env_confx.MaestroEnvironment.get_reward", "env_confx.MaestroEnvironment.update_total_reward_constraint", "env_confx.MaestroEnvironment.sol.append", "env_confx.MaestroEnvironment.norm_state", "env_confx.MaestroEnvironment.update_mode_and_step", "env_confx.MaestroEnvironment.update_reward_impt", "copy.deepcopy().clip", "np.concatenate", "env_confx.MaestroEnvironment.update_reward_whole", "env_confx.MaestroEnvironment.sol_record.append", "env_confx.MaestroEnvironment.sol_reward_record.append", "env_confx.MaestroEnvironment.update_best_reward_list", "action.cpu().numpy().flatten.cpu().numpy().flatten.cpu().numpy", "enumerate", "np.concatenate", "int", "copy.deepcopy", "np.array", "action.cpu().numpy().flatten.cpu().numpy().flatten.cpu"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.get_reward", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.update_total_reward_constraint", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.norm_state", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.update_mode_and_step", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.update_reward_impt", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.update_reward_whole", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.update_best_reward_list"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "infos", "=", "{", "}", "\n", "infos", "[", "\"succeed\"", "]", "=", "0", "\n", "done", "=", "0", "\n", "action", "=", "action", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ".", "flatten", "(", ")", "\n", "#===use continuous========================================", "\n", "# action = np.clip((action+1)/0.5 * 12, a_min=0, a_max=11)", "\n", "#=======================================================", "\n", "self", ".", "action_idx", "[", ":", "]", "=", "action", "\n", "action_val", "=", "[", "action_space", "[", "i", "]", "[", "int", "(", "a", ")", "]", "for", "i", ",", "a", "in", "enumerate", "(", "action", ")", "]", "\n", "self", ".", "action", "[", ":", "]", "=", "action_val", "\n", "maestro_state", "=", "np", ".", "concatenate", "(", "(", "self", ".", "model_defs", "[", "self", ".", "mode", "]", ",", "self", ".", "action", "*", "self", ".", "action_bound", ")", ")", ".", "copy", "(", ")", "\n", "dimensions", "=", "self", ".", "model_defs_norm", "[", "self", ".", "mode", "]", "\n", "\n", "reward", ",", "constraint", ",", "reward_saved", "=", "self", ".", "get_reward", "(", "maestro_state", ")", "\n", "self", ".", "update_total_reward_constraint", "(", "constraint", ",", "reward_saved", ")", "\n", "self", ".", "sol", ".", "append", "(", "(", "copy", ".", "deepcopy", "(", "self", ".", "action", "*", "self", ".", "action_bound", ")", ")", ".", "clip", "(", "1", ")", ")", "\n", "# self.action[:] = 0", "\n", "if", "self", ".", "total_used_constraints", ">", "self", ".", "constraint_value", ":", "\n", "# reward = (-self.total_eps_rewards + reward)", "\n", "            ", "reward", "=", "(", "-", "self", ".", "total_eps_rewards", "+", "reward", ")", "*", "(", "self", ".", "total_used_constraints", "-", "self", ".", "constraint_value", ")", "/", "self", ".", "constraint_value", "\n", "\n", "# reward =  -(self.total_used_constraints - self.constraint_value)/self.constraint_value", "\n", "done", "=", "1", "\n", "", "if", "reward", "==", "-", "1", ":", "\n", "            ", "done", "=", "1", "\n", "# self.state = self.norm_state(np.concatenate(", "\n", "#     (dimensions, np.array([ *[a/self.action_size for a in self.action_idx], self.actions_step], dtype=np.float))))", "\n", "", "self", ".", "state", "=", "self", ".", "norm_state", "(", "np", ".", "concatenate", "(", "\n", "(", "dimensions", ",", "\n", "np", ".", "array", "(", "[", "self", ".", "mode", "/", "self", ".", "total_step", ",", "*", "self", ".", "action", ",", "self", ".", "actions_step", "]", ",", "dtype", "=", "np", ".", "float", ")", ")", ")", ")", "\n", "self", ".", "update_mode_and_step", "(", ")", "\n", "\n", "if", "self", ".", "mode", "==", "self", ".", "total_step", "and", "not", "done", ":", "\n", "            ", "infos", "[", "\"succeed\"", "]", "=", "1", "\n", "done", "=", "1", "\n", "self", ".", "update_reward_whole", "(", ")", "\n", "self", ".", "sol_record", ".", "append", "(", "self", ".", "sol", ")", "\n", "self", ".", "sol_reward_record", ".", "append", "(", "self", ".", "reward_whole_eps", ")", "\n", "", "infos", "[", "\"reward_whole_eps\"", "]", "=", "self", ".", "reward_whole_eps", "\n", "self", ".", "update_best_reward_list", "(", "infos", "[", "\"succeed\"", "]", ")", "if", "done", "else", "None", "\n", "impt", "=", "self", ".", "update_reward_impt", "(", "done", ")", "\n", "return", "self", ".", "state", ",", "reward", ",", "done", ",", "infos", ",", "self", ".", "sig", ",", "impt", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.judge": [[273, 305], ["values.append", "abs", "NameError"], "methods", ["None"], ["", "def", "judge", "(", "self", ")", ":", "\n", "        ", "runtime", ",", "throughput", ",", "energy", ",", "area", ",", "l1_size", ",", "l2_size", ",", "mac", ",", "power", "=", "self", ".", "observation", "\n", "values", "=", "[", "]", "\n", "for", "term", "in", "[", "self", ".", "fitness", ",", "self", ".", "constraint", "]", ":", "\n", "            ", "if", "term", "==", "\"energy\"", ":", "\n", "                ", "reward", "=", "-", "energy", "\n", "", "elif", "term", "==", "\"thrpt_ave\"", ":", "\n", "                ", "reward", "=", "throughput", "\n", "", "elif", "term", "==", "\"LEP\"", ":", "\n", "                ", "reward", "=", "-", "energy", "*", "runtime", "\n", "", "elif", "term", "==", "\"LAP\"", ":", "\n", "                ", "reward", "=", "-", "area", "*", "runtime", "\n", "", "elif", "term", "==", "\"EAP\"", ":", "\n", "                ", "reward", "=", "-", "area", "*", "energy", "\n", "", "elif", "term", "==", "\"thrpt\"", "or", "term", "==", "\"thrpt_naive\"", ":", "\n", "                ", "reward", "=", "throughput", "\n", "", "elif", "term", "==", "\"thrpt_btnk\"", ":", "\n", "                ", "reward", "=", "throughput", "\n", "", "elif", "term", "==", "\"latency\"", ":", "\n", "                ", "reward", "=", "-", "runtime", "\n", "", "elif", "term", "==", "\"area\"", ":", "\n", "                ", "reward", "=", "-", "area", "\n", "", "elif", "term", "==", "\"l1_size\"", ":", "\n", "                ", "reward", "=", "-", "l1_size", "\n", "", "elif", "term", "==", "\"l2_size\"", ":", "\n", "                ", "reward", "=", "-", "l2_size", "\n", "", "elif", "term", "==", "\"power\"", ":", "\n", "                ", "reward", "=", "-", "power", "\n", "", "else", ":", "\n", "                ", "raise", "NameError", "(", "'Undefined fitness type'", ")", "\n", "", "values", ".", "append", "(", "reward", ")", "\n", "", "return", "values", "[", "0", "]", ",", "abs", "(", "values", "[", "1", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.check_constraint": [[307, 312], ["np.sum", "any", "len"], "methods", ["None"], ["", "def", "check_constraint", "(", "self", ",", "actions", ")", ":", "\n", "        ", "used", "=", "np", ".", "sum", "(", "actions", ",", "axis", "=", "0", ")", "\n", "if", "any", "(", "used", ">", "self", ".", "total_resources", "[", "len", "(", "used", ")", "]", ")", ":", "\n", "            ", "return", "False", "\n", "", "return", "True", "\n", "", "def", "ransom_search", "(", "self", ",", "max_epoch", "=", "1000", ",", "chpt_file", "=", "\"trial.plt\"", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.ransom_search": [[312, 341], ["len", "range", "range", "print", "env_confx.MaestroEnvironment.best_rewards.append", "guess_action.append", "env_confx.MaestroEnvironment.check_constraint", "env_confx.MaestroEnvironment.exterior_search", "env_confx.MaestroEnvironment.save_chkpt", "random.randint", "random.randint"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.check_constraint", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.save_chkpt"], ["", "def", "ransom_search", "(", "self", ",", "max_epoch", "=", "1000", ",", "chpt_file", "=", "\"trial.plt\"", ")", ":", "\n", "        ", "self", ".", "chkpt_file", "=", "chpt_file", "\n", "n_layer", "=", "len", "(", "self", ".", "model_defs", ")", "\n", "best_reward", "=", "0", "\n", "best_sol", "=", "None", "\n", "best_reward_record", "=", "[", "]", "\n", "\n", "for", "epoch", "in", "range", "(", "max_epoch", ")", ":", "\n", "            ", "self", ".", "epoch", "=", "epoch", "\n", "guess_action", "=", "[", "]", "\n", "for", "_", "in", "range", "(", "n_layer", ")", ":", "\n", "                ", "pe", "=", "2", "**", "random", ".", "randint", "(", "PE_RANGE_LOG", "[", "0", "]", ",", "PE_RANGE_LOG", "[", "1", "]", ")", "\n", "bw", "=", "2", "**", "random", ".", "randint", "(", "BW_RANGE_LOG", "[", "0", "]", ",", "BW_RANGE_LOG", "[", "1", "]", ")", "\n", "action", "=", "[", "pe", ",", "bw", "]", "\n", "guess_action", ".", "append", "(", "action", ")", "\n", "", "if", "not", "self", ".", "check_constraint", "(", "guess_action", ")", ":", "\n", "                ", "reward", "=", "0", "\n", "", "else", ":", "\n", "                ", "reward", "=", "self", ".", "exterior_search", "(", "guess_action", ")", "\n", "\n", "", "if", "reward", ">", "self", ".", "best_reward", ":", "\n", "                ", "self", ".", "best_reward", "=", "reward", "\n", "self", ".", "best_sol", "=", "guess_action", "\n", "", "print", "(", "\"Epoch {}: reward: {}\"", ".", "format", "(", "self", ".", "epoch", ",", "self", ".", "best_reward", ")", ")", "\n", "if", "self", ".", "epoch", "%", "100", "==", "0", ":", "\n", "                ", "self", ".", "save_chkpt", "(", ")", "\n", "\n", "", "self", ".", "best_rewards", ".", "append", "(", "self", ".", "best_reward", ")", "\n", "", "return", "self", ".", "best_rewards", ",", "self", ".", "best_sol", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.dfs": [[342, 362], ["env_confx.MaestroEnvironment.check_constraint", "env_confx.MaestroEnvironment.best_rewards.append", "env_confx.MaestroEnvironment.exterior_search", "print", "env_confx.MaestroEnvironment.save_chkpt", "range", "guess_action.append", "env_confx.MaestroEnvironment.dfs", "guess_action.pop", "range"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.check_constraint", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.save_chkpt", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.dfs"], ["", "def", "dfs", "(", "self", ",", "left_layers", ",", "guess_action", ")", ":", "\n", "        ", "if", "left_layers", "==", "0", ":", "\n", "            ", "self", ".", "epoch", "+=", "1", "\n", "if", "self", ".", "check_constraint", "(", "guess_action", ")", ":", "\n", "                ", "reward", "=", "self", ".", "exterior_search", "(", "guess_action", ")", "\n", "if", "reward", ">", "self", ".", "best_reward", ":", "\n", "                    ", "self", ".", "best_reward", "=", "reward", "\n", "self", ".", "best_sol", "=", "guess_action", "\n", "", "print", "(", "\"Epoch {}: reward: {}\"", ".", "format", "(", "self", ".", "epoch", ",", "self", ".", "best_reward", ")", ")", "\n", "", "self", ".", "best_rewards", ".", "append", "(", "self", ".", "best_reward", ")", "\n", "\n", "if", "self", ".", "epoch", "%", "100", "==", "0", ":", "\n", "                ", "self", ".", "save_chkpt", "(", ")", "\n", "", "return", "\n", "", "for", "pe", "in", "[", "2", "**", "i", "for", "i", "in", "range", "(", "PE_RANGE_LOG", "[", "0", "]", ",", "PE_RANGE_LOG", "[", "1", "]", "+", "1", ")", "]", ":", "\n", "            ", "for", "bw", "in", "[", "2", "**", "i", "for", "i", "in", "range", "(", "BW_RANGE_LOG", "[", "0", "]", ",", "BW_RANGE_LOG", "[", "1", "]", "+", "1", ")", "]", ":", "\n", "                ", "action", "=", "[", "pe", ",", "bw", "]", "\n", "guess_action", ".", "append", "(", "action", ")", "\n", "self", ".", "dfs", "(", "left_layers", "-", "1", ",", "guess_action", ")", "\n", "guess_action", ".", "pop", "(", ")", "\n", "", "", "", "def", "exhasustive_search", "(", "self", ",", "chkpt_file", "=", "\"trial.pgt\"", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.exhasustive_search": [[362, 374], ["len", "env_confx.MaestroEnvironment.dfs"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.dfs"], ["", "", "", "def", "exhasustive_search", "(", "self", ",", "chkpt_file", "=", "\"trial.pgt\"", ")", ":", "\n", "        ", "n_layer", "=", "len", "(", "self", ".", "model_defs", ")", "\n", "self", ".", "best_reward", "=", "0", "\n", "best_sol", "=", "None", "\n", "best_reward_record", "=", "[", "]", "\n", "guess_action", "=", "[", "]", "\n", "self", ".", "best_rewards", "=", "[", "]", "\n", "self", ".", "epoch", "=", "0", "\n", "self", ".", "best_sol", "=", "None", "\n", "self", ".", "chkpt_file", "=", "chkpt_file", "\n", "self", ".", "dfs", "(", "n_layer", ",", "guess_action", ")", "\n", "return", "self", ".", "best_rewards", ",", "self", ".", "best_sol", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.load_chkpt": [[375, 381], ["None"], "methods", ["None"], ["", "def", "load_chkpt", "(", "self", ",", "chkpt", ")", ":", "\n", "        ", "self", ".", "reward_rec", "=", "chkpt", "[", "\"reward_rec\"", "]", "\n", "self", ".", "best_reward", "=", "chkpt", "[", "\"best_reward\"", "]", "\n", "self", ".", "best_rewards", "=", "chkpt", "[", "\"best_rewards\"", "]", "\n", "self", ".", "best_sol", "=", "chkpt", "[", "\"best_sol\"", "]", "\n", "self", ".", "worst_reward", "=", "chkpt", "[", "\"worst_reward\"", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.get_chkpt": [[382, 392], ["None"], "methods", ["None"], ["", "def", "get_chkpt", "(", "self", ")", ":", "\n", "        ", "return", "{", "\n", "\"reward_rec\"", ":", "self", ".", "reward_rec", ",", "\n", "\"best_rewards\"", ":", "self", ".", "best_rewards", ",", "\n", "\"best_sol\"", ":", "self", ".", "best_sol", ",", "\n", "\"best_reward\"", ":", "self", ".", "best_reward", ",", "\n", "\"worst_reward\"", ":", "self", ".", "worst_reward", ",", "\n", "\"sols\"", ":", "self", ".", "sol_record", ",", "\n", "\"sol_reward_record\"", ":", "self", ".", "sol_reward_record", ",", "\n", "\"ctrs_info\"", ":", "self", ".", "constraint_info", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.save_chkpt": [[393, 399], ["env_confx.MaestroEnvironment.get_chkpt", "open", "pickle.dump"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.get_chkpt"], ["", "def", "save_chkpt", "(", "self", ",", "chkpt_file", "=", "None", ")", ":", "\n", "        ", "if", "chkpt_file", "is", "None", ":", "\n", "            ", "chkpt_file", "=", "self", ".", "chkpt_file", "\n", "", "chkpt", "=", "self", ".", "get_chkpt", "(", ")", "\n", "with", "open", "(", "chkpt_file", ",", "\"wb\"", ")", "as", "fd", ":", "\n", "            ", "pickle", ".", "dump", "(", "chkpt", ",", "fd", ")", "\n", "# print(self.sol)", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.exterior_search_special": [[402, 419], ["range", "len", "np.concatenate", "env_confx.MaestroEnvironment.oberserve_maestro", "sum", "sum", "mac_rec_list.append", "latency_list.append"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.oberserve_maestro"], ["", "", "def", "exterior_search_special", "(", "self", ",", "actions", ",", "action_size", "=", "2", ")", ":", "\n", "        ", "total_reward", "=", "None", "\n", "mac_rec_list", "=", "[", "]", "\n", "latency_list", "=", "[", "]", "\n", "total_constraint", "=", "0", "\n", "for", "i", "in", "range", "(", "len", "(", "actions", ")", ")", ":", "\n", "            ", "action", "=", "actions", "[", "i", "]", "\n", "maestro_state", "=", "np", ".", "concatenate", "(", "(", "self", ".", "model_defs", "[", "i", "]", ",", "action", ")", ")", "\n", "reward", ",", "constraint", "=", "self", ".", "oberserve_maestro", "(", "maestro_state", ")", "\n", "if", "reward", "==", "None", ":", "\n", "                ", "return", "None", "\n", "", "else", ":", "\n", "                ", "mac_rec_list", ".", "append", "(", "self", ".", "observation", "[", "-", "1", "]", ")", "\n", "latency_list", ".", "append", "(", "self", ".", "observation", "[", "0", "]", ")", "\n", "", "total_constraint", "+=", "constraint", "\n", "", "total_reward", "=", "sum", "(", "mac_rec_list", ")", "/", "sum", "(", "latency_list", ")", "\n", "return", "total_reward", ",", "total_constraint", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.quick_observe": [[420, 431], ["tuple", "env_confx.MaestroEnvironment.oberserve_maestro", "float"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.oberserve_maestro"], ["", "def", "quick_observe", "(", "self", ",", "maestro_state", ")", ":", "\n", "        ", "table_entry", "=", "tuple", "(", "maestro_state", ")", "\n", "if", "table_entry", "in", "self", ".", "exp_table", ":", "\n", "            ", "reward", ",", "constraint", "=", "self", ".", "exp_table", "[", "table_entry", "]", "\n", "", "else", ":", "\n", "            ", "ret", "=", "self", ".", "oberserve_maestro", "(", "maestro_state", ")", "\n", "if", "ret", "is", "None", ":", "\n", "                ", "return", "None", ",", "float", "(", "\"Inf\"", ")", "\n", "", "reward", ",", "constraint", "=", "ret", "\n", "self", ".", "exp_table", "[", "table_entry", "]", "=", "(", "reward", ",", "constraint", ")", "\n", "", "return", "reward", ",", "constraint", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.exterior_search": [[432, 452], ["float", "range", "env_confx.MaestroEnvironment.exterior_search_special", "len", "np.concatenate", "env_confx.MaestroEnvironment.oberserve_maestro", "min", "float"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search_special", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.oberserve_maestro"], ["", "def", "exterior_search", "(", "self", ",", "actions", ",", "action_size", "=", "2", ")", ":", "\n", "        ", "if", "self", ".", "fitness", "==", "\"thrpt_ave\"", "or", "self", ".", "fitness", "==", "\"thrpt_naive\"", ":", "\n", "            ", "return", "self", ".", "exterior_search_special", "(", "actions", ",", "action_size", ")", "\n", "", "total_reward", "=", "0", "\n", "total_constraint", "=", "0", "\n", "min_reward", "=", "float", "(", "\"Inf\"", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "actions", ")", ")", ":", "\n", "            ", "action", "=", "actions", "[", "i", "]", "\n", "maestro_state", "=", "np", ".", "concatenate", "(", "(", "self", ".", "model_defs", "[", "i", "]", ",", "action", ")", ")", "\n", "reward", ",", "constraint", "=", "self", ".", "oberserve_maestro", "(", "maestro_state", ")", "\n", "if", "not", "reward", ":", "\n", "                ", "return", "None", ",", "float", "(", "\"Inf\"", ")", "\n", "# return float(\"-inf\")", "\n", "", "if", "self", ".", "fitness", "==", "\"thrpt_btnk\"", ":", "\n", "                ", "min_reward", "=", "min", "(", "min_reward", ",", "reward", ")", "\n", "total_reward", "=", "min_reward", "\n", "", "else", ":", "\n", "                ", "total_reward", "+=", "reward", "\n", "", "total_constraint", "+=", "constraint", "\n", "", "return", "total_reward", ",", "total_constraint", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.write_maestro": [[453, 480], ["len", "open", "open", "int", "open", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fd.seek", "fo.write", "fdpt.seek", "fo.write", "fd.read", "fdpt.read"], "methods", ["None"], ["", "def", "write_maestro", "(", "self", ",", "dimension", ",", "dataflow", "=", "\"dla\"", ",", "KTileSz", "=", "1", ",", "CTileSz", "=", "1", ",", "ClusterSz", "=", "4", ",", "m_file", "=", "None", ",", "layer_id", "=", "0", ",", "df_idx", "=", "None", ")", ":", "\n", "        ", "if", "df_idx", "is", "not", "None", ":", "\n", "            ", "dataflow", "=", "df_dict", "[", "df_idx", "]", "\n", "", "if", "len", "(", "dimension", ")", ">", "6", ":", "\n", "            ", "m_type", "=", "m_type_dicts", "[", "int", "(", "dimension", "[", "-", "1", "]", ")", "]", "\n", "", "else", ":", "\n", "            ", "m_type", "=", "\"CONV\"", "\n", "", "with", "open", "(", "\"../../data/dataflow/{}.m\"", ".", "format", "(", "dataflow", ")", ",", "\"r\"", ")", "as", "fd", ":", "\n", "            ", "with", "open", "(", "\"../../data/dataflow/dpt.m\"", ",", "\"r\"", ")", "as", "fdpt", ":", "\n", "                ", "with", "open", "(", "\"{}.m\"", ".", "format", "(", "m_file", ")", ",", "\"w\"", ")", "as", "fo", ":", "\n", "                    ", "fo", ".", "write", "(", "\"Constant KTileSz {};\\n\"", ".", "format", "(", "KTileSz", ")", ")", "\n", "fo", ".", "write", "(", "\"Constant CTileSz {};\\n\"", ".", "format", "(", "CTileSz", ")", ")", "\n", "fo", ".", "write", "(", "\"Constant ClusterSz {};\\n\"", ".", "format", "(", "ClusterSz", ")", ")", "\n", "fo", ".", "write", "(", "\"Network {} {{\\n\"", ".", "format", "(", "layer_id", ")", ")", "\n", "fo", ".", "write", "(", "\"Layer {} {{\\n\"", ".", "format", "(", "m_type", ")", ")", "\n", "fo", ".", "write", "(", "\"Type: {}\\n\"", ".", "format", "(", "m_type", ")", ")", "\n", "fo", ".", "write", "(", "\n", "\"Dimensions {{ K: {:.0f}, C: {:.0f}, Y: {:.0f}, X: {:.0f}, R: {:.0f}, S: {:.0f} }}\\n\"", ".", "format", "(", "\n", "*", "dimension", ")", ")", "\n", "if", "m_type", "==", "\"CONV\"", ":", "\n", "                        ", "fd", ".", "seek", "(", "0", ")", "\n", "fo", ".", "write", "(", "fd", ".", "read", "(", ")", ")", "\n", "", "else", ":", "\n", "                        ", "fdpt", ".", "seek", "(", "0", ")", "\n", "fo", ".", "write", "(", "fdpt", ".", "read", "(", ")", ")", "\n", "", "fo", ".", "write", "(", "\"}\\n\"", ")", "\n", "fo", ".", "write", "(", "\"}\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.oberserve_maestro": [[481, 546], ["subprocess.Popen", "subprocess.Popen.communicate", "subprocess.Popen.wait", "actions.astype().squeeze", "actions.astype().squeeze", "os.path.exists", "os.path.exists", "os.path.exists", "os.path.exists", "os.remove", "os.remove", "os.remove", "os.remove", "pandas.read_csv", "np.array().reshape", "np.array().reshape", "np.array().reshape", "np.array().reshape", "np.array().reshape", "np.array().reshape", "np.array().reshape", "np.array().reshape", "env_confx.MaestroEnvironment.judge", "env_confx.MaestroEnvironment.write_maestro_gemm", "env_confx.MaestroEnvironment.write_maestro", "env_confx.MaestroEnvironment.write_maestro_gemm", "env_confx.MaestroEnvironment.write_maestro", "os.path.exists", "os.path.exists", "os.path.exists", "os.path.exists", "os.remove", "os.remove", "os.remove", "os.remove", "os.path.exists", "os.path.exists", "os.path.exists", "os.path.exists", "os.remove", "os.remove", "os.remove", "os.remove", "np.mean", "print", "print", "print", "actions.astype", "actions.astype", "np.array", "np.array", "np.array", "np.array", "np.array", "np.array", "np.array", "np.array"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.judge", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.write_maestro_gemm", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.write_maestro", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.write_maestro_gemm", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.write_maestro"], ["", "", "", "", "def", "oberserve_maestro", "(", "self", ",", "state", ",", "firsttime", "=", "False", ")", ":", "\n", "        ", "m_file", "=", "self", ".", "random_file_name", "\n", "dimension", "=", "state", "[", ":", "self", ".", "dim_size", "]", "\n", "\n", "actions", "=", "state", "[", "-", "self", ".", "n_action_steps", ":", "]", "\n", "if", "self", ".", "n_action_steps", "==", "2", ":", "\n", "            ", "num_pe", ",", "KTileSz", "=", "actions", ".", "astype", "(", "int", ")", ".", "squeeze", "(", ")", "\n", "ClusterSz", "=", "num_pe", "\n", "self", ".", "resource_state", "=", "[", "num_pe", ",", "KTileSz", "]", "\n", "if", "self", ".", "is_gemm", ":", "\n", "                ", "self", ".", "write_maestro_gemm", "(", "dimension", ",", "dataflow", "=", "self", ".", "dataflow", ",", "KTileSz", "=", "KTileSz", ",", "ClusterSz", "=", "ClusterSz", ",", "m_file", "=", "m_file", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "write_maestro", "(", "dimension", ",", "dataflow", "=", "self", ".", "dataflow", ",", "KTileSz", "=", "KTileSz", ",", "ClusterSz", "=", "ClusterSz", ",", "m_file", "=", "m_file", ")", "\n", "", "", "else", ":", "\n", "            ", "num_pe", ",", "KTileSz", ",", "df_idx", "=", "actions", ".", "astype", "(", "int", ")", ".", "squeeze", "(", ")", "\n", "self", ".", "resource_state", "=", "[", "num_pe", ",", "KTileSz", "]", "\n", "ClusterSz", "=", "num_pe", "\n", "if", "self", ".", "is_gemm", ":", "\n", "                ", "self", ".", "write_maestro_gemm", "(", "dimension", ",", "dataflow", "=", "self", ".", "dataflow", ",", "KTileSz", "=", "KTileSz", ",", "ClusterSz", "=", "ClusterSz", ",", "\n", "m_file", "=", "m_file", ",", "df_idx", "=", "df_idx", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "write_maestro", "(", "dimension", ",", "dataflow", "=", "self", ".", "dataflow", ",", "KTileSz", "=", "KTileSz", ",", "ClusterSz", "=", "ClusterSz", ",", "\n", "m_file", "=", "m_file", ",", "df_idx", "=", "df_idx", ")", "\n", "\n", "# print(num_pe, bw, l1_size)", "\n", "", "", "os", ".", "remove", "(", "\"./{}.csv\"", ".", "format", "(", "m_file", ")", ")", "if", "os", ".", "path", ".", "exists", "(", "\"./{}.csv\"", ".", "format", "(", "m_file", ")", ")", "else", "None", "\n", "command", "=", "[", "self", ".", "_executable", ",", "\n", "\"--Mapping_file={}.m\"", ".", "format", "(", "m_file", ")", ",", "\n", "\"--full_buffer=false\"", ",", "\"--noc_bw_cstr=81920000\"", ",", "\n", "\"--noc_hops=1\"", ",", "\"--noc_hop_latency=1\"", ",", "\n", "\"--noc_mc_support=true\"", ",", "\"--num_pes={}\"", ".", "format", "(", "num_pe", ")", ",", "\n", "\"--num_simd_lanes=1\"", ",", "\"--l1_size_cstr=819200000\"", ",", "\n", "\"--l2_size_cstr=819200000\"", ",", "\"--print_res=false\"", ",", "\"--print_res_csv_file=true\"", ",", "\"--print_log_file=false\"", ",", "\"--print_design_space=false\"", ",", "\"--msg_print_lv=0\"", "]", "\n", "\n", "\n", "process", "=", "Popen", "(", "command", ",", "stdout", "=", "PIPE", ",", "stderr", "=", "PIPE", ")", "\n", "stdout", ",", "stderr", "=", "process", ".", "communicate", "(", ")", "\n", "process", ".", "wait", "(", ")", "\n", "\n", "\n", "\n", "\n", "try", ":", "\n", "\n", "            ", "df", "=", "pd", ".", "read_csv", "(", "\"./{}.csv\"", ".", "format", "(", "m_file", ")", ")", "\n", "layer_name", "=", "df", "[", "\" Layer Number\"", "]", "\n", "runtime", "=", "np", ".", "array", "(", "df", "[", "\" Runtime (Cycles)\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "throughput", "=", "np", ".", "array", "(", "df", "[", "\" Throughput (MACs/Cycle)\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "energy", "=", "np", ".", "array", "(", "df", "[", "\" Activity count-based Energy (nJ)\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "area", "=", "np", ".", "array", "(", "df", "[", "\" Area\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "power", "=", "np", ".", "array", "(", "df", "[", "\" Power\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "l1_size", "=", "np", ".", "array", "(", "df", "[", "\" L1 SRAM Size Req (Bytes)\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "l2_size", "=", "np", ".", "array", "(", "df", "[", "\"  L2 SRAM Size Req (Bytes)\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "mac", "=", "np", ".", "array", "(", "df", "[", "\" Num MACs\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "os", ".", "remove", "(", "\"./{}.csv\"", ".", "format", "(", "m_file", ")", ")", "if", "os", ".", "path", ".", "exists", "(", "\"./{}.csv\"", ".", "format", "(", "m_file", ")", ")", "else", "None", "\n", "os", ".", "remove", "(", "\"./log.txt\"", ")", "if", "os", ".", "path", ".", "exists", "(", "\"./log.txt\"", ")", "else", "None", "\n", "self", ".", "observation", "=", "[", "np", ".", "mean", "(", "x", ")", "for", "x", "in", "[", "runtime", ",", "throughput", ",", "energy", ",", "area", ",", "l1_size", ",", "l2_size", ",", "mac", ",", "power", "]", "]", "\n", "# penalty = 1 / num_pe + 1 / bw", "\n", "# penalty= 1/penalty", "\n", "return", "self", ".", "judge", "(", ")", "\n", "", "except", ":", "\n", "            ", "print", "(", "\"+\"", "*", "20", ")", "\n", "print", "(", "num_pe", ",", "KTileSz", ",", "ClusterSz", ")", "\n", "print", "(", "\"+\"", "*", "20", ")", "\n", "return", "None", "\n", "# penalty = max(1, (num_pe-500))", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.ConfX.env_confx.MaestroEnvironment.write_maestro_gemm": [[549, 575], ["open", "open", "open", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fd.seek", "fo.write", "fdpt.seek", "fo.write", "fd.read", "fdpt.read"], "methods", ["None"], ["", "", "def", "write_maestro_gemm", "(", "self", ",", "dimension", ",", "dataflow", "=", "\"dla\"", ",", "KTileSz", "=", "1", ",", "CTileSz", "=", "1", ",", "ClusterSz", "=", "4", ",", "m_file", "=", "None", ",", "layer_id", "=", "0", ",", "df_idx", "=", "None", ")", ":", "\n", "        ", "if", "df_idx", "is", "not", "None", ":", "\n", "            ", "dataflow", "=", "df_dict", "[", "df_idx", "]", "\n", "", "m_type", "=", "\"CONV\"", "\n", "SzM", ",", "SzN", ",", "SzK", "=", "dimension", "\n", "dimension", "=", "[", "SzN", ",", "SzK", ",", "SzM", ",", "1", ",", "1", ",", "1", "]", "\n", "with", "open", "(", "\"{}_f.m\"", ".", "format", "(", "dataflow", ")", ",", "\"r\"", ")", "as", "fd", ":", "\n", "            ", "with", "open", "(", "\"dpt_f.m\"", ",", "\"r\"", ")", "as", "fdpt", ":", "\n", "                ", "with", "open", "(", "\"{}.m\"", ".", "format", "(", "m_file", ")", ",", "\"w\"", ")", "as", "fo", ":", "\n", "                    ", "fo", ".", "write", "(", "\"Constant KTileSz {};\\n\"", ".", "format", "(", "KTileSz", ")", ")", "\n", "fo", ".", "write", "(", "\"Constant CTileSz {};\\n\"", ".", "format", "(", "CTileSz", ")", ")", "\n", "fo", ".", "write", "(", "\"Constant ClusterSz {};\\n\"", ".", "format", "(", "ClusterSz", ")", ")", "\n", "fo", ".", "write", "(", "\"Network {} {{\\n\"", ".", "format", "(", "layer_id", ")", ")", "\n", "fo", ".", "write", "(", "\"Layer {} {{\\n\"", ".", "format", "(", "\"CONV\"", ")", ")", "\n", "fo", ".", "write", "(", "\"Type: {}\\n\"", ".", "format", "(", "m_type", ")", ")", "\n", "fo", ".", "write", "(", "\n", "\"Dimensions {{ K: {:.0f}, C: {:.0f}, Y: {:.0f}, X: {:.0f}, R: {:.0f}, S: {:.0f} }}\\n\"", ".", "format", "(", "\n", "*", "dimension", ")", ")", "\n", "if", "m_type", "==", "\"CONV\"", ":", "\n", "                        ", "fd", ".", "seek", "(", "0", ")", "\n", "fo", ".", "write", "(", "fd", ".", "read", "(", ")", ")", "\n", "", "else", ":", "\n", "                        ", "fdpt", ".", "seek", "(", "0", ")", "\n", "fo", ".", "write", "(", "fdpt", ".", "read", "(", ")", ")", "\n", "", "fo", ".", "write", "(", "\"}\\n\"", ")", "\n", "fo", ".", "write", "(", "\"}\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.main.NormalizeActionWrapper.__init__": [[42, 55], ["isinstance", "gym.spaces.Box", "gym.Wrapper.__init__"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.__init__"], ["env", ".", "shuffle_model", "(", ")", "\n", "state", ",", "infos", "=", "env", ".", "reset", "(", ")", "\n", "for", "t", "in", "range", "(", "max_t", ")", ":", "\n", "            ", "action", ",", "log_prob", "=", "agent", ".", "act", "(", "state", ",", "infos", ",", "eps", ",", "temperature", ")", "\n", "next_state", ",", "reward", ",", "done", ",", "infos", ",", "sig", ",", "impt", "=", "env", ".", "step", "(", "action", ")", "\n", "agent", ".", "step", "(", "state", ",", "action", ",", "log_prob", ",", "reward", ",", "next_state", ",", "done", ",", "sig", ",", "impt", ",", "infos", ")", "\n", "state", "=", "next_state", "\n", "score", "+=", "reward", "\n", "if", "done", ":", "\n", "                ", "break", "\n", "", "", "scores_window", ".", "append", "(", "score", ")", "\n", "scores", ".", "append", "(", "score", ")", "\n", "if", "np", ".", "mean", "(", "scores_window", ")", ">", "best_score", ":", "\n", "            ", "best_score", "=", "np", ".", "mean", "(", "scores_window", ")", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.main.NormalizeActionWrapper.rescale_action": [[56, 64], ["None"], "methods", ["None"], ["", "agent_chkpt", "=", "agent", ".", "get_chkpt", "(", ")", "\n", "env_chkpt", "=", "env", ".", "get_chkpt", "(", ")", "\n", "others_chkpt", "=", "{", "\n", "\"scores\"", ":", "scores", ",", "\n", "\"best_score\"", ":", "best_score", ",", "\n", "\"scores_window\"", ":", "scores_window", ",", "\n", "\"episodes\"", ":", "i_episode", "}", "\n", "chkpt", "=", "{", "\"agent_chkpt\"", ":", "agent_chkpt", ",", "\n", "\"env_chkpt\"", ":", "env_chkpt", ",", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.main.NormalizeActionWrapper.reset": [[65, 71], ["main.NormalizeActionWrapper.env.reset"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.reset"], ["\"others_chkpt\"", ":", "others_chkpt", "}", "\n", "if", "i_episode", "%", "5", "==", "0", ":", "\n", "            ", "env", ".", "save_chkpt", "(", "chkpt_file", ")", "\n", "torch", ".", "save", "(", "chkpt", ",", "outfile", ")", "\n", "\n", "", "if", "infos", "[", "\"succeed\"", "]", ":", "\n", "            ", "has_succeed_history", "=", "True", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.main.NormalizeActionWrapper.step": [[72, 81], ["main.NormalizeActionWrapper.rescale_action", "main.NormalizeActionWrapper.env.step"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.main.NormalizeActionWrapper.rescale_action", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.step"], ["print", "(", "\"Episode {}: succeed\"", ".", "format", "(", "i_episode", ")", ")", "\n", "", "else", ":", "\n", "            ", "print", "(", "\"Episode {}: finding\"", ".", "format", "(", "i_episode", ")", ")", "\n", "\n", "\n", "\n", "\n", "", "", "return", "scores", "\n", "\n", "", "def", "get_probe_int", "(", "sol", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.__init__": [[19, 98], ["gym.Env.__init__", "random.seed", "random.randint", "get_action_space", "numpy.array", "len", "copy.deepcopy", "numpy.max", "copy.deepcopy", "float", "numpy.arange", "gym.spaces.Box", "numpy.zeros", "len", "len", "gym.spaces.MultiDiscrete", "gym.spaces.Box", "float", "len", "len", "range", "float"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.__init__", "home.repos.pwc.inspect_result.maestro-project_confuciux.utils.get_action_space.get_action_space"], ["    ", "def", "__init__", "(", "self", ",", "model_defs", ",", "finish_reward", "=", "100", ",", "dim_size", "=", "6", ",", "n_action_steps", "=", "2", ",", "resource_size", "=", "2", ",", "dataflow", "=", "\"dla\"", ",", "is_discrete", "=", "True", ",", "true_continuous", "=", "False", ",", "chkpt_file", "=", "\"./chkpt.plt\"", ")", ":", "\n", "        ", "super", "(", "MaestroEnvironment", ",", "self", ")", ".", "__init__", "(", ")", "\n", "dst_path", "=", "\"../../cost_model/maestro\"", "\n", "\n", "maestro", "=", "dst_path", "\n", "self", ".", "_executable", "=", "\"{}\"", ".", "format", "(", "maestro", ")", "\n", "random", ".", "seed", "(", ")", "\n", "random_file_name", "=", "random", ".", "randint", "(", "0", ",", "2", "**", "31", ")", "\n", "self", ".", "random_file_name", "=", "\"{}\"", ".", "format", "(", "random_file_name", ")", "\n", "\n", "\n", "self", ".", "chkpt_file", "=", "chkpt_file", "\n", "self", ".", "is_gemm", "=", "False", "\n", "global", "action_space", ",", "action_bound", ",", "action_bottom", "\n", "action_space", ",", "action_bound", ",", "action_bottom", "=", "get_action_space", "(", ")", "\n", "self", ".", "action_bottom", "=", "action_bound", "\n", "self", ".", "state", "=", "np", ".", "array", "(", "[", "0.5", "]", "*", "8", ")", "\n", "self", ".", "last_runtime", "=", "2", "**", "64", "\n", "self", ".", "last_energy", "=", "2", "**", "64", "\n", "self", ".", "last_throughput", "=", "1", "\n", "self", ".", "observation", "=", "[", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", "]", "\n", "self", ".", "resource_state", "=", "[", "0", ",", "0", "]", "\n", "self", ".", "consecutive_fail", "=", "0", "\n", "self", ".", "max_fail", "=", "0", "\n", "self", ".", "total_resources", "=", "action_bound", "\n", "self", ".", "action_bound", "=", "action_bound", "[", ":", "n_action_steps", "]", "\n", "self", ".", "total_step", "=", "len", "(", "model_defs", ")", "\n", "self", ".", "model_defs", "=", "model_defs", "\n", "self", ".", "model_defs_saved", "=", "copy", ".", "deepcopy", "(", "model_defs", ")", "\n", "model_bound", "=", "np", ".", "max", "(", "model_defs", ",", "axis", "=", "0", ",", "keepdims", "=", "True", ")", "\n", "self", ".", "model_defs_norm", "=", "model_defs", "/", "model_bound", "\n", "self", ".", "model_defs_norm_saved", "=", "copy", ".", "deepcopy", "(", "self", ".", "model_defs_norm", ")", "\n", "self", ".", "best_reward_whole", "=", "float", "(", "\"-inf\"", ")", "\n", "self", ".", "best_rewards", "=", "[", "]", "\n", "self", ".", "best_sol", "=", "None", "\n", "self", ".", "reward", "=", "0", "\n", "self", ".", "mae_reward", "=", "0", "\n", "self", ".", "finish_reward", "=", "finish_reward", "\n", "self", ".", "mae_reward_decay", "=", "0.", "\n", "self", ".", "worst_reward", "=", "None", "\n", "self", ".", "best_reward", "=", "None", "\n", "self", ".", "reward_scale", "=", "0", "\n", "self", ".", "n_action_steps", "=", "n_action_steps", "\n", "self", ".", "emptyinfo", "=", "[", "-", "1", "]", "*", "(", "len", "(", "self", ".", "observation", ")", "+", "len", "(", "self", ".", "resource_state", ")", ")", "\n", "self", ".", "resource_size", "=", "resource_size", "\n", "self", ".", "reward_whole_eps", "=", "0", "\n", "self", ".", "dim_size", "=", "dim_size", "\n", "self", ".", "reward_rec", "=", "[", "]", "\n", "self", ".", "min_reward", "=", "None", "\n", "self", ".", "running_ave_reward", "=", "None", "\n", "self", ".", "worst_reward_list", "=", "[", "None", "for", "_", "in", "range", "(", "self", ".", "total_step", ")", "]", "\n", "self", ".", "sig", "=", "1", "\n", "self", ".", "mac_rec", "=", "[", "]", "\n", "\n", "\n", "self", ".", "epoch", "=", "0", "\n", "self", ".", "sol_record", "=", "[", "]", "\n", "self", ".", "sol_reward_record", "=", "[", "]", "\n", "self", ".", "dataflow", "=", "dataflow", "\n", "self", ".", "constraint_value", "=", "2", "**", "63", "\n", "self", ".", "constraint", "=", "\"area\"", "\n", "self", ".", "prev_reward_whole_eps", "=", "0", "\n", "self", ".", "exp_table", "=", "{", "}", "\n", "self", ".", "draw", "=", "np", ".", "arange", "(", "0", ",", "self", ".", "total_step", ")", "\n", "self", ".", "is_discrete", "=", "is_discrete", "\n", "self", ".", "true_contiunous", "=", "true_continuous", "and", "not", "is_discrete", "\n", "self", ".", "state_size", "=", "len", "(", "self", ".", "model_defs_norm", "[", "0", "]", ")", "+", "3", "\n", "if", "self", ".", "is_discrete", ":", "\n", "            ", "self", ".", "N_DISCRETE_ACTIONS", "=", "len", "(", "action_space", "[", "0", "]", ")", "\n", "self", ".", "action_space", "=", "spaces", ".", "MultiDiscrete", "(", "[", "self", ".", "N_DISCRETE_ACTIONS", ",", "self", ".", "N_DISCRETE_ACTIONS", "]", ")", "\n", "\n", "", "else", ":", "\n", "            ", "self", ".", "action_space", "=", "spaces", ".", "Box", "(", "low", "=", "0", ",", "high", "=", "1", ",", "\n", "shape", "=", "(", "self", ".", "n_action_steps", ",", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "low", "=", "0", ",", "high", "=", "1", ",", "\n", "shape", "=", "(", "self", ".", "state_size", ",", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "self", ".", "metadata", "=", "{", "'render.modes'", ":", "[", "]", "}", "\n", "self", ".", "reward_range", "=", "(", "-", "float", "(", "'inf'", ")", ",", "float", "(", "'inf'", ")", ")", "\n", "self", ".", "resources_denorm", "=", "np", ".", "zeros", "(", "(", "self", ".", "resource_size", ",", ")", ")", "\n", "", "@", "property", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.get_state": [[98, 104], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "get_state", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n\n        \"\"\"", "\n", "return", "self", ".", "state", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.shuffle_model": [[105, 110], ["numpy.random.permutation"], "methods", ["None"], ["", "def", "shuffle_model", "(", "self", ")", ":", "\n", "        ", "draw", "=", "np", ".", "random", ".", "permutation", "(", "self", ".", "total_step", ")", "\n", "self", ".", "model_defs", "=", "self", ".", "model_defs_saved", "[", "draw", "]", "\n", "self", ".", "model_defs_norm", "=", "self", ".", "model_defs_norm_saved", "[", "draw", "]", "\n", "self", ".", "draw", "=", "draw", "\n", "", "def", "set_fitness", "(", "self", ",", "fitness", "=", "\"latency\"", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.set_fitness": [[110, 112], ["None"], "methods", ["None"], ["", "def", "set_fitness", "(", "self", ",", "fitness", "=", "\"latency\"", ")", ":", "\n", "        ", "self", ".", "fitness", "=", "fitness", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.set_constraint_value": [[113, 118], ["None"], "methods", ["None"], ["", "def", "set_constraint_value", "(", "self", ",", "max_constraint", ",", "min_constraint", ",", "constraint_value", ")", ":", "\n", "        ", "self", ".", "constraint_value", "=", "constraint_value", "\n", "self", ".", "constraint_info", "=", "{", "\"value\"", ":", "constraint_value", ",", "\n", "\"max\"", ":", "max_constraint", ",", "\n", "\"min\"", ":", "min_constraint", "}", "\n", "", "def", "set_constraint", "(", "self", ",", "constraint", "=", "\"area\"", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.set_constraint": [[118, 120], ["None"], "methods", ["None"], ["", "def", "set_constraint", "(", "self", ",", "constraint", "=", "\"area\"", ")", ":", "\n", "        ", "self", ".", "constraint", "=", "constraint", "\n", "", "def", "reset", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.reset": [[120, 141], ["numpy.array", "numpy.concatenate", "numpy.array", "enumerate"], "methods", ["None"], ["", "def", "reset", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n\n        \"\"\"", "\n", "self", ".", "update_best_sol", "=", "False", "\n", "self", ".", "reward_whole_eps", "=", "0", "\n", "self", ".", "mac_rec", "=", "[", "]", "\n", "self", ".", "sig", "=", "1", "\n", "self", ".", "fitness_record", "=", "[", "]", "\n", "self", ".", "reward", "=", "0", "\n", "self", ".", "sol", "=", "[", "]", "\n", "self", ".", "mode", "=", "0", "\n", "self", ".", "actions_step", "=", "0", "\n", "self", ".", "total_used_constraints", "=", "0", "\n", "dimensions", "=", "self", ".", "model_defs_norm", "[", "self", ".", "mode", "]", "\n", "self", ".", "action_idx", "=", "[", "0", ",", "0", "]", "\n", "self", ".", "action", "=", "np", ".", "array", "(", "[", "action_space", "[", "idx", "]", "[", "val", "]", "for", "idx", ",", "val", "in", "enumerate", "(", "self", ".", "action_idx", ")", "]", ")", "\n", "self", ".", "state", "=", "np", ".", "concatenate", "(", "(", "dimensions", ",", "np", ".", "array", "(", "[", "0", ",", "0", ",", "0", "]", ",", "dtype", "=", "np", ".", "float", ")", ")", ")", "\n", "self", ".", "total_eps_rewards", "=", "0", "\n", "infos", "=", "{", "}", "\n", "return", "self", ".", "state", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.norm_mac": [[142, 146], ["numpy.array", "numpy.sum"], "methods", ["None"], ["", "def", "norm_mac", "(", "self", ")", ":", "\n", "        ", "mac_rec", "=", "np", ".", "array", "(", "self", ".", "mac_rec", ")", "\n", "impt", "=", "mac_rec", "/", "np", ".", "sum", "(", "mac_rec", ")", "\n", "return", "impt", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.update_reward_impt": [[148, 160], ["other_rl_env.MaestroEnvironment.mac_rec.append", "other_rl_env.MaestroEnvironment.norm_mac"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.norm_mac"], ["", "def", "update_reward_impt", "(", "self", ",", "done", ")", ":", "\n", "# impt = np.ones(1, (self.mode) * self.n_action_steps + self.actions_step + 1)", "\n", "# if self.fitness == \"thrpt_ave\":", "\n", "#     impt_thrpt = self.norm_mac()", "\n", "#     impt[:len(impt_thrpt)] = impt_thrpt", "\n", "# return impt", "\n", "        ", "impt", "=", "None", "\n", "if", "self", ".", "fitness", "==", "\"thrpt_ave\"", ":", "\n", "            ", "self", ".", "mac_rec", ".", "append", "(", "self", ".", "observation", "[", "-", "1", "]", ")", "\n", "if", "done", ":", "\n", "                ", "impt", "=", "self", ".", "norm_mac", "(", ")", "\n", "", "", "return", "impt", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.norm_state": [[161, 164], ["None"], "methods", ["None"], ["", "def", "norm_state", "(", "self", ",", "T", ")", ":", "\n", "        ", "T", "[", ":", "-", "1", "]", "=", "(", "T", "[", ":", "-", "1", "]", "-", "0.5", ")", "*", "2", "\n", "return", "T", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.update_mode_and_step": [[165, 170], ["None"], "methods", ["None"], ["", "def", "update_mode_and_step", "(", "self", ")", ":", "\n", "        ", "self", ".", "actions_step", "+=", "2", "\n", "if", "self", ".", "actions_step", "==", "self", ".", "n_action_steps", ":", "\n", "            ", "self", ".", "mode", "+=", "1", "\n", "self", ".", "actions_step", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.get_ref_constraint": [[171, 175], ["other_rl_env.MaestroEnvironment.exterior_search", "range", "len"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search"], ["", "", "def", "get_ref_constraint", "(", "self", ",", "bound", "=", "action_bound", ")", ":", "\n", "        ", "sol", "=", "[", "bound", "[", ":", "self", ".", "n_action_steps", "]", "for", "i", "in", "range", "(", "len", "(", "self", ".", "model_defs", ")", ")", "]", "\n", "_", ",", "total_constraint", "=", "self", ".", "exterior_search", "(", "sol", ")", "\n", "return", "total_constraint", "\n", "", "def", "update_best_reward_list", "(", "self", ",", "succeed", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.update_best_reward_list": [[175, 181], ["other_rl_env.MaestroEnvironment.reward_rec.append", "other_rl_env.MaestroEnvironment.best_rewards.append"], "methods", ["None"], ["", "def", "update_best_reward_list", "(", "self", ",", "succeed", ")", ":", "\n", "        ", "self", ".", "epoch", "+=", "1", "\n", "self", ".", "reward_whole_eps", "=", "self", ".", "prev_reward_whole_eps", "if", "not", "succeed", "else", "self", ".", "reward_whole_eps", "\n", "self", ".", "prev_reward_whole_eps", "=", "self", ".", "reward_whole_eps", "\n", "self", ".", "reward_rec", ".", "append", "(", "self", ".", "reward_whole_eps", ")", "\n", "self", ".", "best_rewards", ".", "append", "(", "self", ".", "best_reward_whole", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.update_reward_whole": [[184, 194], ["other_rl_env.MaestroEnvironment.retrive_sol_order", "print"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.retrive_sol_order"], ["", "def", "update_reward_whole", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "reward_whole_eps", ">", "self", ".", "best_reward_whole", ":", "\n", "            ", "self", ".", "best_reward_whole", "=", "self", ".", "reward_whole_eps", "\n", "self", ".", "sol", "=", "self", ".", "retrive_sol_order", "(", "self", ".", "sol", ")", "\n", "self", ".", "update_best_sol", "=", "True", "\n", "print", "(", "\"Epoch {}: New best reward: {:9e}\"", ".", "format", "(", "self", ".", "epoch", ",", "self", ".", "best_reward_whole", ")", ")", "\n", "self", ".", "best_sol", "=", "{", "\"epoch\"", ":", "self", ".", "epoch", ",", "\n", "\"draw\"", ":", "self", ".", "draw", ",", "\n", "\"sol\"", ":", "self", ".", "sol", ",", "\n", "\"ctr\"", ":", "self", ".", "total_used_constraints", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.retrive_sol_order": [[195, 200], ["enumerate", "copy.deepcopy", "range", "len"], "methods", ["None"], ["", "", "def", "retrive_sol_order", "(", "self", ",", "sol", ")", ":", "\n", "        ", "ordered_sol", "=", "[", "None", "for", "_", "in", "range", "(", "len", "(", "sol", ")", ")", "]", "\n", "for", "i", ",", "d", "in", "enumerate", "(", "self", ".", "draw", ")", ":", "\n", "            ", "ordered_sol", "[", "d", "]", "=", "copy", ".", "deepcopy", "(", "sol", "[", "i", "]", ")", "\n", "", "return", "ordered_sol", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.get_reward": [[201, 222], ["tuple", "reward.copy", "min", "other_rl_env.MaestroEnvironment.oberserve_maestro"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.oberserve_maestro"], ["", "def", "get_reward", "(", "self", ",", "maestro_state", ")", ":", "\n", "        ", "table_entry", "=", "tuple", "(", "[", "self", ".", "mode", "]", "+", "self", ".", "action_idx", ")", "\n", "if", "table_entry", "in", "self", ".", "exp_table", ":", "\n", "            ", "reward", ",", "constraint", "=", "self", ".", "exp_table", "[", "table_entry", "]", "\n", "", "else", ":", "\n", "            ", "reward", ",", "constraint", "=", "self", ".", "oberserve_maestro", "(", "maestro_state", ")", "\n", "self", ".", "exp_table", "[", "table_entry", "]", "=", "(", "reward", ",", "constraint", ")", "\n", "", "if", "not", "reward", ":", "\n", "            ", "self", ".", "sig", "=", "-", "1", "\n", "return", "-", "1", "\n", "# self.worst_reward = min(reward, self.worst_reward) if self.worst_reward else reward", "\n", "", "if", "self", ".", "min_reward", "==", "None", ":", "\n", "            ", "self", ".", "min_reward", "=", "reward", "\n", "", "reward_saved", "=", "reward", ".", "copy", "(", ")", "\n", "# self.reward_window.append(reward)", "\n", "self", ".", "min_reward", "=", "min", "(", "self", ".", "min_reward", ",", "reward_saved", ")", "\n", "reward", "-=", "self", ".", "min_reward", "\n", "\n", "# reward -= min(self.reward_window)", "\n", "self", ".", "total_eps_rewards", "+=", "reward", "\n", "return", "reward", ",", "constraint", ",", "reward_saved", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.get_valid_action_range": [[225, 231], ["enumerate", "numpy.vstack().astype", "valid_action_range.append", "numpy.vstack"], "methods", ["None"], ["", "def", "get_valid_action_range", "(", "self", ")", ":", "\n", "        ", "valid_action_range", "=", "[", "]", "\n", "for", "i", ",", "r", "in", "enumerate", "(", "self", ".", "left_resource", ")", ":", "\n", "            ", "action_space_this", "=", "action_space", "[", "i", "]", "\n", "valid_action_range", ".", "append", "(", "[", "1", "if", "val", "==", "True", "else", "0", "for", "val", "in", "action_space_this", "<", "r", "]", ")", "\n", "", "return", "np", ".", "vstack", "(", "valid_action_range", ")", ".", "astype", "(", "float", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.update_total_reward_constraint": [[233, 236], ["None"], "methods", ["None"], ["", "def", "update_total_reward_constraint", "(", "self", ",", "constraint", ",", "reward_saved", ")", ":", "\n", "        ", "self", ".", "total_used_constraints", "+=", "constraint", "\n", "self", ".", "reward_whole_eps", "+=", "reward_saved", "\n", "", "def", "is_cluster_step", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.is_cluster_step": [[236, 242], ["min"], "methods", ["None"], ["", "def", "is_cluster_step", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "n_action_steps", ">", "2", ":", "\n", "            ", "if", "self", ".", "actions_step", "==", "self", ".", "n_action_steps", "-", "1", ":", "\n", "                ", "return", "True", "\n", "", "self", ".", "action", "[", "2", "]", "=", "min", "(", "self", ".", "action", "[", "2", "]", ",", "self", ".", "action", "[", "0", "]", ")", "\n", "", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.step": [[243, 298], ["numpy.array", "numpy.concatenate().copy", "other_rl_env.MaestroEnvironment.get_reward", "other_rl_env.MaestroEnvironment.update_total_reward_constraint", "other_rl_env.MaestroEnvironment.sol.append", "other_rl_env.MaestroEnvironment.norm_state", "other_rl_env.MaestroEnvironment.update_mode_and_step", "bool", "other_rl_env.MaestroEnvironment.get_chkpt", "other_rl_env.MaestroEnvironment.update_reward_impt", "numpy.clip().astype", "numpy.clip().astype", "copy.deepcopy().clip", "numpy.concatenate", "print", "other_rl_env.MaestroEnvironment.update_reward_whole", "other_rl_env.MaestroEnvironment.sol_record.append", "other_rl_env.MaestroEnvironment.sol_reward_record.append", "other_rl_env.MaestroEnvironment.update_best_reward_list", "other_rl_env.MaestroEnvironment.save_chkpt", "numpy.concatenate", "numpy.clip", "enumerate", "numpy.clip", "copy.deepcopy", "numpy.array", "int", "len", "len", "len"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.get_reward", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.update_total_reward_constraint", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.norm_state", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.update_mode_and_step", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.get_chkpt", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.update_reward_impt", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.update_reward_whole", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.update_best_reward_list", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.save_chkpt"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "\n", "        ", "infos", "=", "{", "}", "\n", "infos", "[", "\"is_success\"", "]", "=", "0", "\n", "done", "=", "0", "\n", "if", "self", ".", "is_discrete", ":", "\n", "            ", "self", ".", "action_idx", "[", ":", "]", "=", "action", "\n", "", "else", ":", "\n", "            ", "self", ".", "action_idx", "[", ":", "]", "=", "np", ".", "clip", "(", "action", "*", "len", "(", "action_space", "[", "0", "]", ")", ",", "a_min", "=", "0", ",", "a_max", "=", "11", ")", ".", "astype", "(", "int", ")", "\n", "", "action_val", "=", "np", ".", "array", "(", "[", "action_space", "[", "i", "]", "[", "int", "(", "a", ")", "]", "for", "i", ",", "a", "in", "enumerate", "(", "self", ".", "action_idx", ")", "]", ")", "\n", "self", ".", "action", "=", "action_val", "\n", "maestro_action", "=", "self", ".", "action", "*", "self", ".", "action_bound", "\n", "if", "self", ".", "true_contiunous", ":", "\n", "            ", "self", ".", "action_idx", "[", ":", "]", "=", "np", ".", "clip", "(", "action", "*", "self", ".", "action_bound", ",", "a_min", "=", "action_bottom", "[", ":", "len", "(", "action", ")", "]", ",", "a_max", "=", "action_bound", "[", ":", "len", "(", "action", ")", "]", ")", ".", "astype", "(", "int", ")", "\n", "self", ".", "action", "=", "action", "\n", "maestro_action", "=", "self", ".", "action_idx", "\n", "", "maestro_state", "=", "np", ".", "concatenate", "(", "(", "self", ".", "model_defs", "[", "self", ".", "mode", "]", ",", "maestro_action", ")", ")", ".", "copy", "(", ")", "\n", "dimensions", "=", "self", ".", "model_defs_norm", "[", "self", ".", "mode", "]", "\n", "\n", "reward", ",", "constraint", ",", "reward_saved", "=", "self", ".", "get_reward", "(", "maestro_state", ")", "\n", "self", ".", "update_total_reward_constraint", "(", "constraint", ",", "reward_saved", ")", "\n", "self", ".", "sol", ".", "append", "(", "(", "copy", ".", "deepcopy", "(", "self", ".", "action", "*", "self", ".", "action_bound", ")", ")", ".", "clip", "(", "1", ")", ")", "\n", "# self.action[:] = 0", "\n", "if", "self", ".", "total_used_constraints", ">", "self", ".", "constraint_value", ":", "\n", "# reward = (-self.total_eps_rewards + reward)", "\n", "            ", "reward", "=", "(", "-", "self", ".", "total_eps_rewards", "+", "reward", ")", "*", "(", "self", ".", "total_used_constraints", "-", "self", ".", "constraint_value", ")", "/", "self", ".", "constraint_value", "\n", "\n", "# reward =  -(self.total_used_constraints - self.constraint_value)/self.constraint_value", "\n", "done", "=", "1", "\n", "", "if", "reward", "==", "-", "1", ":", "\n", "            ", "done", "=", "1", "\n", "# self.state = self.norm_state(np.concatenate(", "\n", "#     (dimensions, np.array([ *[a/self.action_size for a in self.action_idx], self.actions_step], dtype=np.float))))", "\n", "", "self", ".", "state", "=", "self", ".", "norm_state", "(", "np", ".", "concatenate", "(", "\n", "(", "dimensions", ",", "\n", "np", ".", "array", "(", "[", "*", "self", ".", "action", ",", "self", ".", "actions_step", "]", ",", "dtype", "=", "np", ".", "float", ")", ")", ")", ")", "\n", "self", ".", "update_mode_and_step", "(", ")", "\n", "\n", "if", "self", ".", "mode", "==", "self", ".", "total_step", "and", "not", "done", ":", "\n", "            ", "print", "(", "\"Done! Reward: {}\"", ".", "format", "(", "self", ".", "reward_whole_eps", ")", ")", "\n", "infos", "[", "\"is_success\"", "]", "=", "1", "\n", "done", "=", "1", "\n", "self", ".", "update_reward_whole", "(", ")", "\n", "self", ".", "sol_record", ".", "append", "(", "self", ".", "sol", ")", "\n", "self", ".", "sol_reward_record", ".", "append", "(", "self", ".", "reward_whole_eps", ")", "\n", "", "done", "=", "bool", "(", "done", "==", "1", ")", "\n", "infos", "[", "\"eps_rewards\"", "]", "=", "self", ".", "reward_whole_eps", "\n", "infos", "[", "\"Best_eps_rewards\"", "]", "=", "self", ".", "best_reward_whole", "\n", "infos", "[", "\"chkpt\"", "]", "=", "self", ".", "get_chkpt", "(", ")", "\n", "infos", "[", "\"reward_whole_eps\"", "]", "=", "self", ".", "reward_whole_eps", "\n", "self", ".", "update_best_reward_list", "(", "infos", "[", "\"is_success\"", "]", ")", "if", "done", "else", "None", "\n", "impt", "=", "self", ".", "update_reward_impt", "(", "done", ")", "\n", "if", "done", ":", "\n", "            ", "self", ".", "save_chkpt", "(", "self", ".", "chkpt_file", ")", "\n", "", "return", "self", ".", "state", ",", "reward", ",", "done", ",", "infos", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.judge": [[301, 333], ["values.append", "abs", "NameError"], "methods", ["None"], ["", "def", "judge", "(", "self", ")", ":", "\n", "        ", "runtime", ",", "throughput", ",", "energy", ",", "area", ",", "l1_size", ",", "l2_size", ",", "mac", ",", "power", "=", "self", ".", "observation", "\n", "values", "=", "[", "]", "\n", "for", "term", "in", "[", "self", ".", "fitness", ",", "self", ".", "constraint", "]", ":", "\n", "            ", "if", "term", "==", "\"energy\"", ":", "\n", "                ", "reward", "=", "-", "energy", "\n", "", "elif", "term", "==", "\"thrpt_ave\"", ":", "\n", "                ", "reward", "=", "throughput", "\n", "", "elif", "term", "==", "\"LEP\"", ":", "\n", "                ", "reward", "=", "-", "energy", "*", "runtime", "\n", "", "elif", "term", "==", "\"LAP\"", ":", "\n", "                ", "reward", "=", "-", "area", "*", "runtime", "\n", "", "elif", "term", "==", "\"EAP\"", ":", "\n", "                ", "reward", "=", "-", "area", "*", "energy", "\n", "", "elif", "term", "==", "\"thrpt\"", "or", "term", "==", "\"thrpt_naive\"", ":", "\n", "                ", "reward", "=", "throughput", "\n", "", "elif", "term", "==", "\"thrpt_btnk\"", ":", "\n", "                ", "reward", "=", "throughput", "\n", "", "elif", "term", "==", "\"latency\"", ":", "\n", "                ", "reward", "=", "-", "runtime", "\n", "", "elif", "term", "==", "\"area\"", ":", "\n", "                ", "reward", "=", "-", "area", "\n", "", "elif", "term", "==", "\"l1_size\"", ":", "\n", "                ", "reward", "=", "-", "l1_size", "\n", "", "elif", "term", "==", "\"l2_size\"", ":", "\n", "                ", "reward", "=", "-", "l2_size", "\n", "", "elif", "term", "==", "\"power\"", ":", "\n", "                ", "reward", "=", "-", "power", "\n", "", "else", ":", "\n", "                ", "raise", "NameError", "(", "'Undefined fitness type'", ")", "\n", "", "values", ".", "append", "(", "reward", ")", "\n", "", "return", "values", "[", "0", "]", ",", "abs", "(", "values", "[", "1", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.check_constraint": [[335, 340], ["numpy.sum", "any", "len"], "methods", ["None"], ["", "def", "check_constraint", "(", "self", ",", "actions", ")", ":", "\n", "        ", "used", "=", "np", ".", "sum", "(", "actions", ",", "axis", "=", "0", ")", "\n", "if", "any", "(", "used", ">", "self", ".", "total_resources", "[", "len", "(", "used", ")", "]", ")", ":", "\n", "            ", "return", "False", "\n", "", "return", "True", "\n", "", "def", "ransom_search", "(", "self", ",", "max_epoch", "=", "1000", ",", "chpt_file", "=", "\"trial.plt\"", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.ransom_search": [[340, 369], ["len", "range", "range", "print", "other_rl_env.MaestroEnvironment.best_rewards.append", "guess_action.append", "other_rl_env.MaestroEnvironment.check_constraint", "other_rl_env.MaestroEnvironment.exterior_search", "other_rl_env.MaestroEnvironment.save_chkpt", "random.randint", "random.randint"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.check_constraint", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.save_chkpt"], ["", "def", "ransom_search", "(", "self", ",", "max_epoch", "=", "1000", ",", "chpt_file", "=", "\"trial.plt\"", ")", ":", "\n", "        ", "self", ".", "chkpt_file", "=", "chpt_file", "\n", "n_layer", "=", "len", "(", "self", ".", "model_defs", ")", "\n", "best_reward", "=", "0", "\n", "best_sol", "=", "None", "\n", "best_reward_record", "=", "[", "]", "\n", "\n", "for", "epoch", "in", "range", "(", "max_epoch", ")", ":", "\n", "            ", "self", ".", "epoch", "=", "epoch", "\n", "guess_action", "=", "[", "]", "\n", "for", "_", "in", "range", "(", "n_layer", ")", ":", "\n", "                ", "pe", "=", "2", "**", "random", ".", "randint", "(", "PE_RANGE_LOG", "[", "0", "]", ",", "PE_RANGE_LOG", "[", "1", "]", ")", "\n", "bw", "=", "2", "**", "random", ".", "randint", "(", "BW_RANGE_LOG", "[", "0", "]", ",", "BW_RANGE_LOG", "[", "1", "]", ")", "\n", "action", "=", "[", "pe", ",", "bw", "]", "\n", "guess_action", ".", "append", "(", "action", ")", "\n", "", "if", "not", "self", ".", "check_constraint", "(", "guess_action", ")", ":", "\n", "                ", "reward", "=", "0", "\n", "", "else", ":", "\n", "                ", "reward", "=", "self", ".", "exterior_search", "(", "guess_action", ")", "\n", "\n", "", "if", "reward", ">", "self", ".", "best_reward", ":", "\n", "                ", "self", ".", "best_reward", "=", "reward", "\n", "self", ".", "best_sol", "=", "guess_action", "\n", "", "print", "(", "\"Epoch {}: reward: {}\"", ".", "format", "(", "self", ".", "epoch", ",", "self", ".", "best_reward", ")", ")", "\n", "if", "self", ".", "epoch", "%", "100", "==", "0", ":", "\n", "                ", "self", ".", "save_chkpt", "(", ")", "\n", "\n", "", "self", ".", "best_rewards", ".", "append", "(", "self", ".", "best_reward", ")", "\n", "", "return", "self", ".", "best_rewards", ",", "self", ".", "best_sol", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.dfs": [[370, 390], ["other_rl_env.MaestroEnvironment.check_constraint", "other_rl_env.MaestroEnvironment.best_rewards.append", "other_rl_env.MaestroEnvironment.exterior_search", "print", "other_rl_env.MaestroEnvironment.save_chkpt", "range", "guess_action.append", "other_rl_env.MaestroEnvironment.dfs", "guess_action.pop", "range"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.check_constraint", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.save_chkpt", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.dfs"], ["", "def", "dfs", "(", "self", ",", "left_layers", ",", "guess_action", ")", ":", "\n", "        ", "if", "left_layers", "==", "0", ":", "\n", "            ", "self", ".", "epoch", "+=", "1", "\n", "if", "self", ".", "check_constraint", "(", "guess_action", ")", ":", "\n", "                ", "reward", "=", "self", ".", "exterior_search", "(", "guess_action", ")", "\n", "if", "reward", ">", "self", ".", "best_reward", ":", "\n", "                    ", "self", ".", "best_reward", "=", "reward", "\n", "self", ".", "best_sol", "=", "guess_action", "\n", "", "print", "(", "\"Epoch {}: reward: {}\"", ".", "format", "(", "self", ".", "epoch", ",", "self", ".", "best_reward", ")", ")", "\n", "", "self", ".", "best_rewards", ".", "append", "(", "self", ".", "best_reward", ")", "\n", "\n", "if", "self", ".", "epoch", "%", "100", "==", "0", ":", "\n", "                ", "self", ".", "save_chkpt", "(", ")", "\n", "", "return", "\n", "", "for", "pe", "in", "[", "2", "**", "i", "for", "i", "in", "range", "(", "PE_RANGE_LOG", "[", "0", "]", ",", "PE_RANGE_LOG", "[", "1", "]", "+", "1", ")", "]", ":", "\n", "            ", "for", "bw", "in", "[", "2", "**", "i", "for", "i", "in", "range", "(", "BW_RANGE_LOG", "[", "0", "]", ",", "BW_RANGE_LOG", "[", "1", "]", "+", "1", ")", "]", ":", "\n", "                ", "action", "=", "[", "pe", ",", "bw", "]", "\n", "guess_action", ".", "append", "(", "action", ")", "\n", "self", ".", "dfs", "(", "left_layers", "-", "1", ",", "guess_action", ")", "\n", "guess_action", ".", "pop", "(", ")", "\n", "", "", "", "def", "exhasustive_search", "(", "self", ",", "chkpt_file", "=", "\"trial.pgt\"", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.exhasustive_search": [[390, 402], ["len", "other_rl_env.MaestroEnvironment.dfs"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.dfs"], ["", "", "", "def", "exhasustive_search", "(", "self", ",", "chkpt_file", "=", "\"trial.pgt\"", ")", ":", "\n", "        ", "n_layer", "=", "len", "(", "self", ".", "model_defs", ")", "\n", "self", ".", "best_reward", "=", "0", "\n", "best_sol", "=", "None", "\n", "best_reward_record", "=", "[", "]", "\n", "guess_action", "=", "[", "]", "\n", "self", ".", "best_rewards", "=", "[", "]", "\n", "self", ".", "epoch", "=", "0", "\n", "self", ".", "best_sol", "=", "None", "\n", "self", ".", "chkpt_file", "=", "chkpt_file", "\n", "self", ".", "dfs", "(", "n_layer", ",", "guess_action", ")", "\n", "return", "self", ".", "best_rewards", ",", "self", ".", "best_sol", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.load_chkpt": [[403, 409], ["None"], "methods", ["None"], ["", "def", "load_chkpt", "(", "self", ",", "chkpt", ")", ":", "\n", "        ", "self", ".", "reward_rec", "=", "chkpt", "[", "\"reward_rec\"", "]", "\n", "self", ".", "best_reward", "=", "chkpt", "[", "\"best_reward\"", "]", "\n", "self", ".", "best_rewards", "=", "chkpt", "[", "\"best_rewards\"", "]", "\n", "self", ".", "best_sol", "=", "chkpt", "[", "\"best_sol\"", "]", "\n", "self", ".", "worst_reward", "=", "chkpt", "[", "\"worst_reward\"", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.get_chkpt": [[410, 421], ["None"], "methods", ["None"], ["", "def", "get_chkpt", "(", "self", ")", ":", "\n", "        ", "return", "{", "\n", "\"reward_rec\"", ":", "self", ".", "reward_rec", ",", "\n", "\"best_rewards\"", ":", "self", ".", "best_rewards", ",", "\n", "\"best_sol\"", ":", "self", ".", "best_sol", ",", "\n", "\"update_best_sol\"", ":", "self", ".", "update_best_sol", ",", "\n", "\"best_reward\"", ":", "self", ".", "best_reward", ",", "\n", "\"worst_reward\"", ":", "self", ".", "worst_reward", ",", "\n", "\"sols\"", ":", "self", ".", "sol_record", ",", "\n", "\"sol_reward_record\"", ":", "self", ".", "sol_reward_record", ",", "\n", "\"ctrs_info\"", ":", "self", ".", "constraint_info", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.save_chkpt": [[422, 428], ["other_rl_env.MaestroEnvironment.get_chkpt", "open", "pickle.dump"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.get_chkpt"], ["", "def", "save_chkpt", "(", "self", ",", "chkpt_file", "=", "None", ")", ":", "\n", "        ", "if", "chkpt_file", "is", "None", ":", "\n", "            ", "chkpt_file", "=", "self", ".", "chkpt_file", "\n", "", "chkpt", "=", "self", ".", "get_chkpt", "(", ")", "\n", "with", "open", "(", "chkpt_file", ",", "\"wb\"", ")", "as", "fd", ":", "\n", "            ", "pickle", ".", "dump", "(", "chkpt", ",", "fd", ")", "\n", "# print(self.sol)", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.exterior_search_special": [[431, 448], ["range", "len", "numpy.concatenate", "other_rl_env.MaestroEnvironment.oberserve_maestro", "sum", "sum", "mac_rec_list.append", "latency_list.append"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.oberserve_maestro"], ["", "", "def", "exterior_search_special", "(", "self", ",", "actions", ",", "action_size", "=", "2", ")", ":", "\n", "        ", "total_reward", "=", "None", "\n", "mac_rec_list", "=", "[", "]", "\n", "latency_list", "=", "[", "]", "\n", "total_constraint", "=", "0", "\n", "for", "i", "in", "range", "(", "len", "(", "actions", ")", ")", ":", "\n", "            ", "action", "=", "actions", "[", "i", "]", "\n", "maestro_state", "=", "np", ".", "concatenate", "(", "(", "self", ".", "model_defs", "[", "i", "]", ",", "action", ")", ")", "\n", "reward", ",", "constraint", "=", "self", ".", "oberserve_maestro", "(", "maestro_state", ")", "\n", "if", "reward", "==", "None", ":", "\n", "                ", "return", "None", "\n", "", "else", ":", "\n", "                ", "mac_rec_list", ".", "append", "(", "self", ".", "observation", "[", "-", "1", "]", ")", "\n", "latency_list", ".", "append", "(", "self", ".", "observation", "[", "0", "]", ")", "\n", "", "total_constraint", "+=", "constraint", "\n", "", "total_reward", "=", "sum", "(", "mac_rec_list", ")", "/", "sum", "(", "latency_list", ")", "\n", "return", "total_reward", ",", "total_constraint", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.exterior_search": [[449, 469], ["float", "range", "other_rl_env.MaestroEnvironment.exterior_search_special", "len", "numpy.concatenate", "other_rl_env.MaestroEnvironment.oberserve_maestro", "min"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search_special", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.oberserve_maestro"], ["", "def", "exterior_search", "(", "self", ",", "actions", ",", "action_size", "=", "2", ")", ":", "\n", "        ", "if", "self", ".", "fitness", "==", "\"thrpt_ave\"", "or", "self", ".", "fitness", "==", "\"thrpt_naive\"", ":", "\n", "            ", "return", "self", ".", "exterior_search_special", "(", "actions", ",", "action_size", ")", "\n", "", "total_reward", "=", "0", "\n", "total_constraint", "=", "0", "\n", "min_reward", "=", "float", "(", "\"Inf\"", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "actions", ")", ")", ":", "\n", "            ", "action", "=", "actions", "[", "i", "]", "\n", "maestro_state", "=", "np", ".", "concatenate", "(", "(", "self", ".", "model_defs", "[", "i", "]", ",", "action", ")", ")", "\n", "reward", ",", "constraint", "=", "self", ".", "oberserve_maestro", "(", "maestro_state", ")", "\n", "if", "reward", "==", "None", ":", "\n", "                ", "return", "None", "\n", "# return float(\"-inf\")", "\n", "", "if", "self", ".", "fitness", "==", "\"thrpt_btnk\"", ":", "\n", "                ", "min_reward", "=", "min", "(", "min_reward", ",", "reward", ")", "\n", "total_reward", "=", "min_reward", "\n", "", "else", ":", "\n", "                ", "total_reward", "+=", "reward", "\n", "", "total_constraint", "+=", "constraint", "\n", "", "return", "total_reward", ",", "total_constraint", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.write_maestro": [[470, 495], ["len", "open", "open", "int", "open", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fd.seek", "fo.write", "fdpt.seek", "fo.write", "fd.read", "fdpt.read"], "methods", ["None"], ["", "def", "write_maestro", "(", "self", ",", "dimension", ",", "dataflow", "=", "\"dla\"", ",", "KTileSz", "=", "1", ",", "CTileSz", "=", "1", ",", "ClusterSz", "=", "4", ",", "m_file", "=", "None", ",", "layer_id", "=", "0", ")", ":", "\n", "        ", "if", "len", "(", "dimension", ")", ">", "6", ":", "\n", "            ", "m_type", "=", "m_type_dicts", "[", "int", "(", "dimension", "[", "-", "1", "]", ")", "]", "\n", "", "else", ":", "\n", "            ", "m_type", "=", "\"CONV\"", "\n", "", "with", "open", "(", "\"../../data/dataflow/{}.m\"", ".", "format", "(", "dataflow", ")", ",", "\"r\"", ")", "as", "fd", ":", "\n", "            ", "with", "open", "(", "\"../../data/dataflow/dpt.m\"", ",", "\"r\"", ")", "as", "fdpt", ":", "\n", "                ", "with", "open", "(", "\"{}.m\"", ".", "format", "(", "m_file", ")", ",", "\"w\"", ")", "as", "fo", ":", "\n", "                    ", "fo", ".", "write", "(", "\"Constant KTileSz {};\\n\"", ".", "format", "(", "KTileSz", ")", ")", "\n", "fo", ".", "write", "(", "\"Constant CTileSz {};\\n\"", ".", "format", "(", "CTileSz", ")", ")", "\n", "fo", ".", "write", "(", "\"Constant ClusterSz {};\\n\"", ".", "format", "(", "ClusterSz", ")", ")", "\n", "fo", ".", "write", "(", "\"Network {} {{\\n\"", ".", "format", "(", "layer_id", ")", ")", "\n", "fo", ".", "write", "(", "\"Layer {} {{\\n\"", ".", "format", "(", "m_type", ")", ")", "\n", "fo", ".", "write", "(", "\"Type: {}\\n\"", ".", "format", "(", "m_type", ")", ")", "\n", "fo", ".", "write", "(", "\n", "\"Dimensions {{ K: {:.0f}, C: {:.0f}, Y: {:.0f}, X: {:.0f}, R: {:.0f}, S: {:.0f} }}\\n\"", ".", "format", "(", "\n", "*", "dimension", ")", ")", "\n", "if", "m_type", "==", "\"CONV\"", ":", "\n", "                        ", "fd", ".", "seek", "(", "0", ")", "\n", "fo", ".", "write", "(", "fd", ".", "read", "(", ")", ")", "\n", "", "else", ":", "\n", "                        ", "fdpt", ".", "seek", "(", "0", ")", "\n", "fo", ".", "write", "(", "fdpt", ".", "read", "(", ")", ")", "\n", "", "fo", ".", "write", "(", "\"}\\n\"", ")", "\n", "fo", ".", "write", "(", "\"}\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.oberserve_maestro": [[496, 563], ["subprocess.Popen", "subprocess.Popen.communicate", "subprocess.Popen.wait", "actions.astype().squeeze", "actions.astype().squeeze", "max", "os.path.exists", "os.remove", "pandas.read_csv", "numpy.array().reshape", "numpy.array().reshape", "numpy.array().reshape", "numpy.array().reshape", "numpy.array().reshape", "numpy.array().reshape", "numpy.array().reshape", "numpy.array().reshape", "other_rl_env.MaestroEnvironment.judge", "other_rl_env.MaestroEnvironment.write_maestro_gemm", "other_rl_env.MaestroEnvironment.write_maestro", "other_rl_env.MaestroEnvironment.write_maestro_gemm", "other_rl_env.MaestroEnvironment.write_maestro", "os.path.exists", "os.remove", "os.path.exists", "os.remove", "numpy.mean", "print", "print", "print", "actions.astype", "actions.astype", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.judge", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.write_maestro_gemm", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.write_maestro", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.write_maestro_gemm", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.write_maestro"], ["", "", "", "", "def", "oberserve_maestro", "(", "self", ",", "state", ",", "firsttime", "=", "False", ")", ":", "\n", "        ", "m_file", "=", "self", ".", "random_file_name", "\n", "dimension", "=", "state", "[", ":", "self", ".", "dim_size", "]", "\n", "\n", "actions", "=", "state", "[", "-", "self", ".", "n_action_steps", ":", "]", "\n", "if", "self", ".", "n_action_steps", "==", "2", ":", "\n", "            ", "num_pe", ",", "KTileSz", "=", "actions", ".", "astype", "(", "int", ")", ".", "squeeze", "(", ")", "\n", "ClusterSz", "=", "num_pe", "\n", "self", ".", "resource_state", "=", "[", "num_pe", ",", "KTileSz", "]", "\n", "if", "self", ".", "is_gemm", ":", "\n", "                ", "self", ".", "write_maestro_gemm", "(", "dimension", ",", "dataflow", "=", "self", ".", "dataflow", ",", "KTileSz", "=", "KTileSz", ",", "ClusterSz", "=", "ClusterSz", ",", "m_file", "=", "m_file", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "write_maestro", "(", "dimension", ",", "dataflow", "=", "self", ".", "dataflow", ",", "KTileSz", "=", "KTileSz", ",", "ClusterSz", "=", "ClusterSz", ",", "m_file", "=", "m_file", ")", "\n", "", "", "else", ":", "\n", "            ", "num_pe", ",", "KTileSz", ",", "ClusterSz", "=", "actions", ".", "astype", "(", "int", ")", ".", "squeeze", "(", ")", "\n", "ClusterSz", "=", "max", "(", "1", ",", "ClusterSz", ")", "\n", "self", ".", "resource_state", "=", "[", "num_pe", ",", "KTileSz", "]", "\n", "if", "self", ".", "is_gemm", ":", "\n", "                ", "self", ".", "write_maestro_gemm", "(", "dimension", ",", "dataflow", "=", "self", ".", "dataflow", ",", "KTileSz", "=", "KTileSz", ",", "ClusterSz", "=", "ClusterSz", ",", "m_file", "=", "m_file", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "write_maestro", "(", "dimension", ",", "dataflow", "=", "self", ".", "dataflow", ",", "KTileSz", "=", "KTileSz", ",", "ClusterSz", "=", "ClusterSz", ",", "m_file", "=", "m_file", ")", "\n", "\n", "\n", "\n", "\n", "\n", "# print(num_pe, bw, l1_size)", "\n", "", "", "os", ".", "remove", "(", "\"./{}.csv\"", ".", "format", "(", "m_file", ")", ")", "if", "os", ".", "path", ".", "exists", "(", "\"./{}.csv\"", ".", "format", "(", "m_file", ")", ")", "else", "None", "\n", "command", "=", "[", "self", ".", "_executable", ",", "\n", "\"--Mapping_file={}.m\"", ".", "format", "(", "m_file", ")", ",", "\n", "\"--full_buffer=false\"", ",", "\"--noc_bw_cstr=81920000\"", ",", "\n", "\"--noc_hops=1\"", ",", "\"--noc_hop_latency=1\"", ",", "\n", "\"--noc_mc_support=true\"", ",", "\"--num_pes={}\"", ".", "format", "(", "num_pe", ")", ",", "\n", "\"--num_simd_lanes=1\"", ",", "\"--l1_size_cstr=819200000\"", ",", "\n", "\"--l2_size_cstr=819200000\"", ",", "\"--print_res=false\"", ",", "\"--print_res_csv_file=true\"", ",", "\"--print_log_file=false\"", ",", "\"--print_design_space=false\"", ",", "\"--msg_print_lv=0\"", "]", "\n", "\n", "\n", "process", "=", "Popen", "(", "command", ",", "stdout", "=", "PIPE", ",", "stderr", "=", "PIPE", ")", "\n", "stdout", ",", "stderr", "=", "process", ".", "communicate", "(", ")", "\n", "process", ".", "wait", "(", ")", "\n", "\n", "\n", "\n", "\n", "try", ":", "\n", "\n", "            ", "df", "=", "pd", ".", "read_csv", "(", "\"./{}.csv\"", ".", "format", "(", "m_file", ")", ")", "\n", "layer_name", "=", "df", "[", "\" Layer Number\"", "]", "\n", "runtime", "=", "np", ".", "array", "(", "df", "[", "\" Runtime (Cycles)\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "throughput", "=", "np", ".", "array", "(", "df", "[", "\" Throughput (MACs/Cycle)\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "energy", "=", "np", ".", "array", "(", "df", "[", "\" Activity count-based Energy (nJ)\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "area", "=", "np", ".", "array", "(", "df", "[", "\" Area\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "power", "=", "np", ".", "array", "(", "df", "[", "\" Power\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "l1_size", "=", "np", ".", "array", "(", "df", "[", "\" L1 SRAM Size Req (Bytes)\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "l2_size", "=", "np", ".", "array", "(", "df", "[", "\"  L2 SRAM Size Req (Bytes)\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "mac", "=", "np", ".", "array", "(", "df", "[", "\" Num MACs\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "os", ".", "remove", "(", "\"./{}.csv\"", ".", "format", "(", "m_file", ")", ")", "if", "os", ".", "path", ".", "exists", "(", "\"./{}.csv\"", ".", "format", "(", "m_file", ")", ")", "else", "None", "\n", "os", ".", "remove", "(", "\"./log.txt\"", ")", "if", "os", ".", "path", ".", "exists", "(", "\"./log.txt\"", ")", "else", "None", "\n", "self", ".", "observation", "=", "[", "np", ".", "mean", "(", "x", ")", "for", "x", "in", "[", "runtime", ",", "throughput", ",", "energy", ",", "area", ",", "l1_size", ",", "l2_size", ",", "mac", ",", "power", "]", "]", "\n", "# penalty = 1 / num_pe + 1 / bw", "\n", "# penalty= 1/penalty", "\n", "return", "self", ".", "judge", "(", ")", "\n", "", "except", ":", "\n", "            ", "print", "(", "\"+\"", "*", "20", ")", "\n", "print", "(", "num_pe", ",", "KTileSz", ",", "ClusterSz", ")", "\n", "print", "(", "\"+\"", "*", "20", ")", "\n", "return", "None", "\n", "# penalty = max(1, (num_pe-500))", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_RLs.other_rl_env.MaestroEnvironment.write_maestro_gemm": [[567, 591], ["open", "open", "open", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fd.seek", "fo.write", "fdpt.seek", "fo.write", "fd.read", "fdpt.read"], "methods", ["None"], ["", "", "def", "write_maestro_gemm", "(", "self", ",", "dimension", ",", "dataflow", "=", "\"dla\"", ",", "KTileSz", "=", "1", ",", "CTileSz", "=", "1", ",", "ClusterSz", "=", "4", ",", "m_file", "=", "None", ",", "layer_id", "=", "0", ")", ":", "\n", "        ", "m_type", "=", "\"CONV\"", "\n", "SzM", ",", "SzN", ",", "SzK", "=", "dimension", "\n", "dimension", "=", "[", "SzN", ",", "SzK", ",", "SzM", ",", "1", ",", "1", ",", "1", "]", "\n", "with", "open", "(", "\"{}_f.m\"", ".", "format", "(", "dataflow", ")", ",", "\"r\"", ")", "as", "fd", ":", "\n", "            ", "with", "open", "(", "\"dpt_f.m\"", ",", "\"r\"", ")", "as", "fdpt", ":", "\n", "                ", "with", "open", "(", "\"{}.m\"", ".", "format", "(", "m_file", ")", ",", "\"w\"", ")", "as", "fo", ":", "\n", "                    ", "fo", ".", "write", "(", "\"Constant KTileSz {};\\n\"", ".", "format", "(", "KTileSz", ")", ")", "\n", "fo", ".", "write", "(", "\"Constant CTileSz {};\\n\"", ".", "format", "(", "CTileSz", ")", ")", "\n", "fo", ".", "write", "(", "\"Constant ClusterSz {};\\n\"", ".", "format", "(", "ClusterSz", ")", ")", "\n", "fo", ".", "write", "(", "\"Network {} {{\\n\"", ".", "format", "(", "layer_id", ")", ")", "\n", "fo", ".", "write", "(", "\"Layer {} {{\\n\"", ".", "format", "(", "\"CONV\"", ")", ")", "\n", "fo", ".", "write", "(", "\"Type: {}\\n\"", ".", "format", "(", "m_type", ")", ")", "\n", "fo", ".", "write", "(", "\n", "\"Dimensions {{ K: {:.0f}, C: {:.0f}, Y: {:.0f}, X: {:.0f}, R: {:.0f}, S: {:.0f} }}\\n\"", ".", "format", "(", "\n", "*", "dimension", ")", ")", "\n", "if", "m_type", "==", "\"CONV\"", ":", "\n", "                        ", "fd", ".", "seek", "(", "0", ")", "\n", "fo", ".", "write", "(", "fd", ".", "read", "(", ")", ")", "\n", "", "else", ":", "\n", "                        ", "fdpt", ".", "seek", "(", "0", ")", "\n", "fo", ".", "write", "(", "fdpt", ".", "read", "(", ")", ")", "\n", "", "fo", ".", "write", "(", "\"}\\n\"", ")", "\n", "fo", ".", "write", "(", "\"}\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MyBounds.__init__": [[25, 30], ["np.array", "np.array", "range", "range"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "length", ")", ":", "\n", "        ", "xmax", "=", "[", "11", "for", "_", "in", "range", "(", "length", ")", "]", "\n", "xmin", "=", "[", "0", "for", "_", "in", "range", "(", "length", ")", "]", "\n", "self", ".", "xmax", "=", "np", ".", "array", "(", "xmax", ")", "\n", "self", ".", "xmin", "=", "np", ".", "array", "(", "xmin", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MyBounds.__call__": [[31, 36], ["bool", "bool", "np.all", "np.all"], "methods", ["None"], ["", "def", "__call__", "(", "self", ",", "**", "kwargs", ")", ":", "\n", "        ", "x", "=", "kwargs", "[", "\"x_new\"", "]", "\n", "tmax", "=", "bool", "(", "np", ".", "all", "(", "x", "<=", "self", ".", "xmax", ")", ")", "\n", "tmin", "=", "bool", "(", "np", ".", "all", "(", "x", ">=", "self", ".", "xmin", ")", ")", "\n", "return", "tmax", "and", "tmin", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.__init__": [[70, 133], ["object.__init__", "random.seed", "random.randint", "np.array", "len", "copy.deepcopy", "np.max", "copy.deepcopy", "float", "np.arange", "len", "len", "len", "range"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.__init__"], ["    ", "def", "__init__", "(", "self", ",", "model_defs", ",", "finish_reward", "=", "100", ",", "dim_size", "=", "6", ",", "n_action_steps", "=", "2", ",", "resource_size", "=", "2", ",", "dataflow", "=", "\"dla\"", ",", "is_discrete", "=", "True", ")", ":", "\n", "        ", "super", "(", "MaestroEnvironment", ",", "self", ")", ".", "__init__", "(", ")", "\n", "dst_path", "=", "\"../../cost_model/maestro\"", "\n", "\n", "maestro", "=", "dst_path", "\n", "self", ".", "_executable", "=", "\"{}\"", ".", "format", "(", "maestro", ")", "\n", "random", ".", "seed", "(", ")", "\n", "random_file_name", "=", "random", ".", "randint", "(", "0", ",", "2", "**", "31", ")", "\n", "self", ".", "random_file_name", "=", "\"{}\"", ".", "format", "(", "random_file_name", ")", "\n", "self", ".", "is_gemm", "=", "False", "\n", "\n", "self", ".", "state", "=", "np", ".", "array", "(", "[", "0.5", "]", "*", "8", ")", "\n", "self", ".", "last_runtime", "=", "2", "**", "64", "\n", "self", ".", "last_energy", "=", "2", "**", "64", "\n", "self", ".", "last_throughput", "=", "1", "\n", "self", ".", "observation", "=", "[", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", "]", "\n", "self", ".", "resource_state", "=", "[", "0", ",", "0", "]", "\n", "self", ".", "consecutive_fail", "=", "0", "\n", "self", ".", "max_fail", "=", "0", "\n", "self", ".", "total_resources", "=", "action_bound", "\n", "self", ".", "action_bound", "=", "action_bound", "[", ":", "n_action_steps", "]", "\n", "self", ".", "total_step", "=", "len", "(", "model_defs", ")", "\n", "self", ".", "model_defs", "=", "model_defs", "\n", "self", ".", "model_defs_saved", "=", "copy", ".", "deepcopy", "(", "model_defs", ")", "\n", "model_bound", "=", "np", ".", "max", "(", "model_defs", ",", "axis", "=", "0", ",", "keepdims", "=", "True", ")", "\n", "self", ".", "model_defs_norm", "=", "model_defs", "/", "model_bound", "\n", "self", ".", "model_defs_norm_saved", "=", "copy", ".", "deepcopy", "(", "self", ".", "model_defs_norm", ")", "\n", "self", ".", "best_reward_whole", "=", "float", "(", "\"-inf\"", ")", "\n", "self", ".", "best_rewards", "=", "[", "]", "\n", "self", ".", "best_sol", "=", "None", "\n", "self", ".", "reward", "=", "0", "\n", "self", ".", "mae_reward", "=", "0", "\n", "self", ".", "finish_reward", "=", "finish_reward", "\n", "self", ".", "mae_reward_decay", "=", "0.", "\n", "self", ".", "worst_reward", "=", "None", "\n", "self", ".", "best_reward", "=", "None", "\n", "self", ".", "reward_scale", "=", "0", "\n", "self", ".", "n_action_steps", "=", "n_action_steps", "\n", "self", ".", "emptyinfo", "=", "[", "-", "1", "]", "*", "(", "len", "(", "self", ".", "observation", ")", "+", "len", "(", "self", ".", "resource_state", ")", ")", "\n", "self", ".", "resource_size", "=", "resource_size", "\n", "self", ".", "reward_whole_eps", "=", "0", "\n", "self", ".", "dim_size", "=", "dim_size", "\n", "self", ".", "reward_rec", "=", "[", "]", "\n", "self", ".", "min_reward", "=", "None", "\n", "self", ".", "running_ave_reward", "=", "None", "\n", "self", ".", "worst_reward_list", "=", "[", "None", "for", "_", "in", "range", "(", "self", ".", "total_step", ")", "]", "\n", "self", ".", "sig", "=", "1", "\n", "self", ".", "mac_rec", "=", "[", "]", "\n", "self", ".", "count_invalid", "=", "0", "\n", "self", ".", "best_rewards_iteration", "=", "[", "]", "\n", "self", ".", "epoch", "=", "0", "\n", "self", ".", "sol_record", "=", "[", "]", "\n", "self", ".", "exp_table", "=", "{", "}", "\n", "self", ".", "sol_reward_record", "=", "[", "]", "\n", "self", ".", "dataflow", "=", "dataflow", "\n", "self", ".", "constraint_value", "=", "2", "**", "63", "\n", "self", ".", "constraint", "=", "\"area\"", "\n", "self", ".", "prev_reward_whole_eps", "=", "0", "\n", "self", ".", "exp_table", "=", "{", "}", "\n", "self", ".", "draw", "=", "np", ".", "arange", "(", "0", ",", "self", ".", "total_step", ")", "\n", "self", ".", "is_discrete", "=", "is_discrete", "\n", "self", ".", "state_size", "=", "len", "(", "self", ".", "model_defs_norm", "[", "0", "]", ")", "+", "3", "\n", "self", ".", "update_best_sol", "=", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.reset": [[135, 152], ["np.array", "np.zeros", "range", "enumerate"], "methods", ["None"], ["", "def", "reset", "(", "self", ")", ":", "\n", "\n", "        ", "self", ".", "update_best_sol", "=", "False", "\n", "self", ".", "mac_rec", "=", "[", "]", "\n", "self", ".", "sig", "=", "1", "\n", "self", ".", "reward_record", "=", "[", "]", "\n", "self", ".", "reward", "=", "0", "\n", "self", ".", "sol", "=", "[", "]", "\n", "self", ".", "mode", "=", "0", "\n", "self", ".", "actions_step", "=", "0", "\n", "action_idx", "=", "[", "3", ",", "3", "]", "\n", "self", ".", "action", "=", "np", ".", "array", "(", "[", "action_space", "[", "idx", "]", "[", "val", "]", "for", "idx", ",", "val", "in", "enumerate", "(", "action_idx", ")", "]", ")", "\n", "self", ".", "left_resource", "=", "[", "1", "for", "_", "in", "range", "(", "self", ".", "resource_size", ")", "]", "\n", "dimensions", "=", "self", ".", "model_defs_norm", "[", "self", ".", "mode", "]", "\n", "self", ".", "state", "=", "np", ".", "zeros", "(", "(", "self", ".", "state_size", ",", ")", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "self", ".", "total_eps_rewards", "=", "0", "\n", "return", "self", ".", "state", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.get_ref_constraint": [[153, 157], ["other_opt_env.MaestroEnvironment.exterior_search", "range", "len"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search"], ["", "def", "get_ref_constraint", "(", "self", ",", "bound", "=", "action_bound", ")", ":", "\n", "        ", "sol", "=", "[", "bound", "[", ":", "self", ".", "n_action_steps", "]", "for", "i", "in", "range", "(", "len", "(", "self", ".", "model_defs", ")", ")", "]", "\n", "_", ",", "total_constraint", "=", "self", ".", "exterior_search", "(", "sol", ")", "\n", "return", "total_constraint", "\n", "", "def", "set_constraint_value", "(", "self", ",", "max_constraint", ",", "min_constraint", ",", "constraint_value", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.set_constraint_value": [[157, 162], ["None"], "methods", ["None"], ["", "def", "set_constraint_value", "(", "self", ",", "max_constraint", ",", "min_constraint", ",", "constraint_value", ")", ":", "\n", "        ", "self", ".", "constraint_value", "=", "constraint_value", "\n", "self", ".", "constraint_info", "=", "{", "\"value\"", ":", "constraint_value", ",", "\n", "\"max\"", ":", "max_constraint", ",", "\n", "\"min\"", ":", "min_constraint", "}", "\n", "", "def", "set_constraint", "(", "self", ",", "constraint", "=", "\"area\"", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.set_constraint": [[162, 164], ["None"], "methods", ["None"], ["", "def", "set_constraint", "(", "self", ",", "constraint", "=", "\"area\"", ")", ":", "\n", "        ", "self", ".", "constraint", "=", "constraint", "\n", "", "def", "set_fitness", "(", "self", ",", "fitness", "=", "\"energy\"", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.set_fitness": [[164, 166], ["None"], "methods", ["None"], ["", "def", "set_fitness", "(", "self", ",", "fitness", "=", "\"energy\"", ")", ":", "\n", "        ", "self", ".", "fitness", "=", "fitness", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.resource_check": [[170, 172], ["any", "np.array"], "methods", ["None"], ["", "def", "resource_check", "(", "self", ")", ":", "\n", "        ", "return", "not", "any", "(", "np", ".", "array", "(", "self", ".", "left_resource", ")", "<", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.judge": [[173, 205], ["values.append", "abs", "NameError"], "methods", ["None"], ["", "def", "judge", "(", "self", ")", ":", "\n", "        ", "runtime", ",", "throughput", ",", "energy", ",", "area", ",", "l1_size", ",", "l2_size", ",", "mac", ",", "power", "=", "self", ".", "observation", "\n", "values", "=", "[", "]", "\n", "for", "term", "in", "[", "self", ".", "fitness", ",", "self", ".", "constraint", "]", ":", "\n", "            ", "if", "term", "==", "\"energy\"", ":", "\n", "                ", "reward", "=", "-", "energy", "\n", "", "elif", "term", "==", "\"thrpt_ave\"", ":", "\n", "                ", "reward", "=", "throughput", "\n", "", "elif", "term", "==", "\"LEP\"", ":", "\n", "                ", "reward", "=", "-", "energy", "*", "runtime", "\n", "", "elif", "term", "==", "\"LAP\"", ":", "\n", "                ", "reward", "=", "-", "area", "*", "runtime", "\n", "", "elif", "term", "==", "\"EAP\"", ":", "\n", "                ", "reward", "=", "-", "area", "*", "energy", "\n", "", "elif", "term", "==", "\"thrpt\"", "or", "term", "==", "\"thrpt_naive\"", ":", "\n", "                ", "reward", "=", "throughput", "\n", "", "elif", "term", "==", "\"thrpt_btnk\"", ":", "\n", "                ", "reward", "=", "throughput", "\n", "", "elif", "term", "==", "\"latency\"", ":", "\n", "                ", "reward", "=", "-", "runtime", "\n", "", "elif", "term", "==", "\"area\"", ":", "\n", "                ", "reward", "=", "-", "area", "\n", "", "elif", "term", "==", "\"l1_size\"", ":", "\n", "                ", "reward", "=", "-", "l1_size", "\n", "", "elif", "term", "==", "\"l2_size\"", ":", "\n", "                ", "reward", "=", "-", "l2_size", "\n", "", "elif", "term", "==", "\"power\"", ":", "\n", "                ", "reward", "=", "-", "power", "\n", "", "else", ":", "\n", "                ", "raise", "NameError", "(", "'Undefined fitness type'", ")", "\n", "", "values", ".", "append", "(", "reward", ")", "\n", "", "return", "values", "[", "0", "]", ",", "abs", "(", "values", "[", "1", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.check_constraint": [[207, 212], ["np.sum", "any"], "methods", ["None"], ["", "def", "check_constraint", "(", "self", ",", "actions", ")", ":", "\n", "        ", "used", "=", "np", ".", "sum", "(", "actions", ",", "axis", "=", "0", ")", "\n", "if", "any", "(", "used", ">", "self", ".", "resource_bound", ")", ":", "\n", "            ", "return", "False", "\n", "", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.black_box_function": [[215, 235], ["np.zeros", "range", "other_opt_env.MaestroEnvironment.exterior_search", "other_opt_env.MaestroEnvironment.best_rewards.append", "other_opt_env.MaestroEnvironment.pbar.update", "len", "print", "other_opt_env.MaestroEnvironment.best_rewards_iteration.append", "len", "other_opt_env.MaestroEnvironment.fd.write", "int", "int"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search"], ["", "def", "black_box_function", "(", "self", ",", "**", "args", ")", ":", "\n", "\n", "        ", "sol", "=", "np", ".", "zeros", "(", "(", "len", "(", "self", ".", "model_defs", ")", ",", "2", ")", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "self", ".", "model_defs", ")", ")", ":", "\n", "            ", "sol", "[", "i", ",", ":", "]", "=", "action_space", "[", "0", "]", "[", "int", "(", "args", "[", "\"{}\"", ".", "format", "(", "2", "*", "i", ")", "]", ")", "]", ",", "action_space", "[", "1", "]", "[", "int", "(", "args", "[", "\"{}\"", ".", "format", "(", "2", "*", "i", "+", "1", ")", "]", ")", "]", "\n", "\n", "", "reward", ",", "total_used_constraint", "=", "self", ".", "exterior_search", "(", "sol", ")", "\n", "if", "total_used_constraint", ">", "self", ".", "constraint_value", ":", "\n", "            ", "reward", "=", "-", "2", "**", "63", "\n", "", "if", "(", "reward", ">", "self", ".", "best_reward", ")", ":", "\n", "            ", "self", ".", "best_sol", "=", "sol", "\n", "self", ".", "best_reward", "=", "reward", "\n", "print", "(", "\"Epoch {}: new best award reward: {}\"", ".", "format", "(", "self", ".", "epoch", ",", "self", ".", "best_reward", ")", ")", "\n", "self", ".", "fd", ".", "write", "(", "\"\\nEpoch {}: new best award reward: {}\"", ".", "format", "(", "self", ".", "epoch", ",", "self", ".", "best_reward", ")", ")", "if", "self", ".", "fd", "else", "None", "\n", "self", ".", "best_rewards_iteration", ".", "append", "(", "self", ".", "epoch", ")", "\n", "", "self", ".", "best_rewards", ".", "append", "(", "self", ".", "best_reward", ")", "\n", "self", ".", "epoch", "+=", "1", "\n", "self", ".", "pbar", ".", "update", "(", "1", ")", "\n", "\n", "return", "reward", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.anneal_f": [[236, 244], ["np.zeros", "range", "other_opt_env.MaestroEnvironment.exterior_search", "abs", "len", "len", "min", "min", "int", "int"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search"], ["", "def", "anneal_f", "(", "self", ",", "args", ")", ":", "\n", "        ", "sol", "=", "np", ".", "zeros", "(", "(", "len", "(", "self", ".", "model_defs", ")", ",", "2", ")", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "self", ".", "model_defs", ")", ")", ":", "\n", "            ", "sol", "[", "i", ",", ":", "]", "=", "action_space", "[", "0", "]", "[", "min", "(", "11", ",", "int", "(", "args", "[", "2", "*", "i", "]", ")", ")", "]", ",", "action_space", "[", "1", "]", "[", "min", "(", "11", ",", "int", "(", "args", "[", "2", "*", "i", "+", "1", "]", ")", ")", "]", "\n", "", "reward", ",", "total_used_constraint", "=", "self", ".", "exterior_search", "(", "sol", ")", "\n", "if", "total_used_constraint", ">", "self", ".", "constraint_value", ":", "\n", "            ", "reward", "=", "-", "2", "**", "63", "\n", "", "return", "abs", "(", "reward", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.print_fun": [[245, 256], ["other_opt_env.MaestroEnvironment.best_rewards.append", "print", "other_opt_env.MaestroEnvironment.best_rewards_iteration.append", "print", "other_opt_env.MaestroEnvironment.fd.write"], "methods", ["None"], ["", "def", "print_fun", "(", "self", ",", "x", ",", "f", ",", "accepted", ")", ":", "\n", "\n", "        ", "if", "(", "f", "<", "self", ".", "best_reward", ")", ":", "\n", "            ", "self", ".", "best_sol", "=", "x", "\n", "self", ".", "best_reward", "=", "f", "\n", "print", "(", "\"Epoch {}: new best award reward: {}\"", ".", "format", "(", "self", ".", "epoch", ",", "self", ".", "best_reward", ")", ")", "\n", "self", ".", "fd", ".", "write", "(", "\"\\nEpoch {}: new best award reward: {}\"", ".", "format", "(", "self", ".", "epoch", ",", "self", ".", "best_reward", ")", ")", "if", "self", ".", "fd", "else", "None", "\n", "self", ".", "best_rewards_iteration", ".", "append", "(", "self", ".", "epoch", ")", "\n", "print", "(", "f", ")", "\n", "", "self", ".", "epoch", "+=", "1", "\n", "self", ".", "best_rewards", ".", "append", "(", "self", ".", "best_reward", ")", "\n", "", "def", "anealing_search", "(", "self", ",", "epochs", ",", "chkpt_file", ",", "fd", "=", "None", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.anealing_search": [[256, 272], ["np.array", "other_opt_env.MyBounds", "scipy.optimize.basinhopping", "print", "print", "other_opt_env.MaestroEnvironment.save_chkpt", "float", "other_opt_env.MaestroEnvironment.fd.write", "other_opt_env.MaestroEnvironment.fd.write", "len", "range", "int", "int", "len"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.save_chkpt"], ["", "def", "anealing_search", "(", "self", ",", "epochs", ",", "chkpt_file", ",", "fd", "=", "None", ")", ":", "\n", "        ", "self", ".", "chkpt_file", "=", "chkpt_file", "\n", "self", ".", "start_range", "=", "start_range", "\n", "self", ".", "end_range", "=", "end_range", "-", "1", "\n", "x0", "=", "np", ".", "array", "(", "[", "8", "for", "_", "in", "range", "(", "len", "(", "self", ".", "model_defs", ")", "*", "2", ")", "]", ")", "\n", "self", ".", "fd", "=", "fd", "\n", "if", "self", ".", "best_reward", "is", "None", ":", "\n", "            ", "self", ".", "best_reward", "=", "float", "(", "\"Inf\"", ")", "\n", "\n", "", "mybounds", "=", "MyBounds", "(", "len", "(", "self", ".", "model_defs", ")", "*", "2", ")", "\n", "ret", "=", "optimize", ".", "basinhopping", "(", "self", ".", "anneal_f", ",", "x0", ",", "niter", "=", "epochs", ",", "accept_test", "=", "mybounds", ",", "stepsize", "=", "2", ",", "T", "=", "10", ",", "callback", "=", "self", ".", "print_fun", ")", "\n", "print", "(", "\"Best fitness: {}\"", ".", "format", "(", "ret", ".", "fun", ")", ")", "\n", "print", "(", "\"sol:{}\"", ".", "format", "(", "[", "int", "(", "a", ")", "for", "a", "in", "ret", ".", "x", "]", ")", ")", "\n", "self", ".", "fd", ".", "write", "(", "\"Best fitness: {}\"", ".", "format", "(", "ret", ".", "fun", ")", ")", "if", "self", ".", "fd", "else", "None", "\n", "self", ".", "fd", ".", "write", "(", "\"\\nsol:{}\"", ".", "format", "(", "[", "int", "(", "a", ")", "for", "a", "in", "ret", ".", "x", "]", ")", ")", "if", "self", ".", "fd", "else", "None", "\n", "self", ".", "save_chkpt", "(", ")", "\n", "", "def", "bayesian_search", "(", "self", ",", "epochs", ",", "chkpt_file", ",", "fd", "=", "None", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.bayesian_search": [[272, 299], ["tqdm.tqdm.tqdm", "bayes_opt.BayesianOptimization", "bayes_opt.BayesianOptimization.maximize", "other_opt_env.MaestroEnvironment.save_chkpt", "float", "range", "len"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.save_chkpt"], ["", "def", "bayesian_search", "(", "self", ",", "epochs", ",", "chkpt_file", ",", "fd", "=", "None", ")", ":", "\n", "        ", "self", ".", "fd", "=", "fd", "\n", "self", ".", "chkpt_file", "=", "chkpt_file", "\n", "self", ".", "pbar", "=", "tqdm", "(", "total", "=", "epochs", ")", "\n", "self", ".", "start_range", "=", "start_range", "\n", "self", ".", "end_range", "=", "end_range", "-", "1", "\n", "self", ".", "epoch", "=", "0", "\n", "self", ".", "count_invalid", "=", "0", "\n", "\n", "self", ".", "num_init_points", "=", "10", "\n", "if", "self", ".", "best_reward", "is", "None", ":", "\n", "            ", "self", ".", "best_reward", "=", "float", "(", "\"-Inf\"", ")", "\n", "\n", "\n", "", "pbounds", "=", "{", "\"{}\"", ".", "format", "(", "i", ")", ":", "(", "self", ".", "start_range", ",", "self", ".", "end_range", ")", "for", "i", "in", "range", "(", "len", "(", "self", ".", "model_defs", ")", "*", "2", ")", "}", "\n", "optimizer", "=", "BayesianOptimization", "(", "\n", "f", "=", "self", ".", "black_box_function", ",", "\n", "pbounds", "=", "pbounds", ",", "\n", "verbose", "=", "1", ",", "# verbose = 1 prints only when a maximum is observed, verbose = 0 is silent", "\n", "random_state", "=", "1", ",", "\n", ")", "\n", "optimizer", ".", "maximize", "(", "\n", "init_points", "=", "self", ".", "num_init_points", ",", "\n", "n_iter", "=", "epochs", "-", "self", ".", "num_init_points", ",", "\n", ")", "\n", "\n", "self", ".", "save_chkpt", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.random_search": [[302, 339], ["len", "print", "range", "other_opt_env.MaestroEnvironment.save_chkpt", "float", "range", "other_opt_env.MaestroEnvironment.exterior_search", "other_opt_env.MaestroEnvironment.best_rewards.append", "guess_action.append", "float", "print", "other_opt_env.MaestroEnvironment.best_rewards_iteration.append", "other_opt_env.MaestroEnvironment.fd.write", "random.randint", "random.randint"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.save_chkpt", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search"], ["", "def", "random_search", "(", "self", ",", "max_epoch", ",", "chkpt_file", ",", "fd", "=", "None", ")", ":", "\n", "        ", "self", ".", "fd", "=", "fd", "\n", "self", ".", "chkpt_file", "=", "chkpt_file", "\n", "self", ".", "start_range", "=", "start_range", "\n", "self", ".", "end_range", "=", "end_range", "-", "1", "\n", "\n", "n_layer", "=", "len", "(", "self", ".", "model_defs", ")", "\n", "print", "(", "\"Num layers: {}\"", ".", "format", "(", "n_layer", ")", ")", "\n", "assert", "(", "self", ".", "count_invalid", "==", "0", ")", "\n", "if", "self", ".", "best_reward", "is", "None", ":", "\n", "            ", "self", ".", "best_reward", "=", "float", "(", "\"-Inf\"", ")", "\n", "", "for", "epoch", "in", "range", "(", "max_epoch", ")", ":", "\n", "            ", "self", ".", "epoch", "=", "epoch", "\n", "guess_action", "=", "[", "]", "\n", "for", "_", "in", "range", "(", "n_layer", ")", ":", "\n", "                ", "self", ".", "start_range", "=", "start_range", "\n", "self", ".", "end_range", "=", "end_range", "-", "1", "\n", "pe", "=", "action_space", "[", "0", "]", "[", "random", ".", "randint", "(", "self", ".", "start_range", ",", "self", ".", "end_range", ")", "]", "\n", "bf", "=", "action_space", "[", "1", "]", "[", "random", ".", "randint", "(", "self", ".", "start_range", ",", "self", ".", "end_range", ")", "]", "\n", "\n", "action", "=", "[", "pe", ",", "bf", "]", "\n", "guess_action", ".", "append", "(", "action", ")", "\n", "\n", "", "reward", ",", "total_used_constraint", "=", "self", ".", "exterior_search", "(", "guess_action", ")", "\n", "if", "total_used_constraint", ">", "self", ".", "constraint_value", ":", "\n", "                ", "reward", "=", "float", "(", "\"-Inf\"", ")", "\n", "self", ".", "count_invalid", "+=", "1", "\n", "", "if", "reward", ">", "self", ".", "best_reward", ":", "\n", "                ", "self", ".", "best_reward", "=", "reward", "\n", "self", ".", "best_sol", "=", "guess_action", "\n", "self", ".", "best_sol_constraint", "=", "total_used_constraint", "\n", "print", "(", "\"Epoch {}: new best award reward: {}\"", ".", "format", "(", "self", ".", "epoch", ",", "self", ".", "best_reward", ")", ")", "\n", "self", ".", "fd", ".", "write", "(", "\"\\nEpoch {}: new best award reward: {}\"", ".", "format", "(", "self", ".", "epoch", ",", "self", ".", "best_reward", ")", ")", "if", "self", ".", "fd", "else", "None", "\n", "self", ".", "best_rewards_iteration", ".", "append", "(", "epoch", ")", "\n", "", "self", ".", "best_rewards", ".", "append", "(", "self", ".", "best_reward", ")", "\n", "", "self", ".", "save_chkpt", "(", ")", "\n", "return", "self", ".", "best_rewards", ",", "self", ".", "best_sol", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.dfs": [[340, 378], ["other_opt_env.MaestroEnvironment.exterior_search", "other_opt_env.MaestroEnvironment.save_chkpt", "print", "print", "float", "print", "other_opt_env.MaestroEnvironment.best_rewards.append", "other_opt_env.MaestroEnvironment.best_rewards_iteration.append", "other_opt_env.MaestroEnvironment.save_chkpt", "range", "guess_action.append", "other_opt_env.MaestroEnvironment.dfs", "guess_action.pop", "other_opt_env.MaestroEnvironment.fd.write", "range", "str", "str"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.save_chkpt", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.save_chkpt", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.dfs"], ["", "def", "dfs", "(", "self", ",", "left_layers", ",", "guess_action", ",", "stride", ")", ":", "\n", "        ", "if", "self", ".", "epochs", ">", "0", ":", "\n", "            ", "if", "(", "self", ".", "epoch", ">", "self", ".", "epochs", ")", ":", "\n", "                ", "return", "\n", "", "if", "self", ".", "epoch", "==", "self", ".", "epochs", ":", "\n", "                ", "self", ".", "save_chkpt", "(", ")", "\n", "print", "(", "\"Number of cases covered in this algorithms: \"", "+", "str", "(", "self", ".", "epochs", ")", ")", "\n", "print", "(", "\"Number of invalid cases: \"", "+", "str", "(", "self", ".", "count_invalid", ")", ")", "\n", "self", ".", "epoch", "+=", "1", "\n", "return", "\n", "\n", "", "", "if", "left_layers", "==", "0", ":", "\n", "            ", "reward", ",", "total_used_constraint", "=", "self", ".", "exterior_search", "(", "guess_action", ")", "\n", "if", "total_used_constraint", ">", "self", ".", "constraint_value", ":", "\n", "                ", "reward", "=", "float", "(", "\"-Inf\"", ")", "\n", "self", ".", "count_invalid", "+=", "1", "\n", "", "if", "reward", ">", "self", ".", "best_reward", ":", "\n", "                ", "self", ".", "best_reward", "=", "reward", "\n", "self", ".", "best_sol", "=", "guess_action", "\n", "print", "(", "\"Epoch {}: new best award reward: {}\"", ".", "format", "(", "self", ".", "epoch", ",", "self", ".", "best_reward", ")", ")", "\n", "self", ".", "fd", ".", "write", "(", "\"\\nEpoch {}: new best award reward: {}\"", ".", "format", "(", "self", ".", "epoch", ",", "self", ".", "best_reward", ")", ")", "if", "self", ".", "fd", "else", "None", "\n", "self", ".", "best_rewards", ".", "append", "(", "self", ".", "best_reward", ")", "\n", "self", ".", "best_rewards_iteration", ".", "append", "(", "self", ".", "epoch", ")", "\n", "\n", "\n", "", "if", "self", ".", "epoch", "%", "100", "==", "0", ":", "\n", "                ", "self", ".", "save_chkpt", "(", ")", "\n", "\n", "", "self", ".", "epoch", "+=", "1", "\n", "return", "\n", "\n", "\n", "", "for", "pe", "in", "[", "2", "**", "i", "for", "i", "in", "range", "(", "self", ".", "start_range", ",", "self", ".", "end_range", "+", "1", ",", "stride", ")", "]", ":", "\n", "            ", "for", "bf", "in", "[", "2", "**", "i", "for", "i", "in", "range", "(", "self", ".", "start_range", ",", "self", ".", "end_range", "+", "1", ",", "stride", ")", "]", ":", "\n", "                ", "action", "=", "[", "pe", ",", "bf", "]", "\n", "guess_action", ".", "append", "(", "action", ")", "\n", "self", ".", "dfs", "(", "left_layers", "-", "1", ",", "guess_action", ",", "stride", ")", "\n", "guess_action", ".", "pop", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exhaustive_search": [[379, 411], ["len", "print", "print", "print", "other_opt_env.MaestroEnvironment.dfs", "float", "int", "range", "str", "str", "str"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.dfs"], ["", "", "", "def", "exhaustive_search", "(", "self", ",", "epochs", ",", "chkpt_file", ",", "stride", "=", "5", ",", "fd", "=", "None", ")", ":", "\n", "        ", "self", ".", "epochs", "=", "epochs", "\n", "self", ".", "fd", "=", "fd", "\n", "self", ".", "count_invalid", "=", "0", "\n", "self", ".", "chkpt_file", "=", "chkpt_file", "\n", "self", ".", "start_range", "=", "start_range", "\n", "self", ".", "end_range", "=", "end_range", "-", "1", "\n", "\n", "if", "self", ".", "best_reward", "is", "None", ":", "\n", "            ", "self", ".", "best_reward", "=", "float", "(", "\"-Inf\"", ")", "\n", "\n", "", "n_layer", "=", "len", "(", "self", ".", "model_defs", ")", "\n", "\n", "num_candidates_pe", "=", "int", "(", "(", "end_range", "-", "start_range", ")", "/", "stride", ")", "+", "1", "\n", "count", "=", "0", "\n", "\n", "for", "pe", "in", "[", "2", "**", "i", "for", "i", "in", "range", "(", "start_range", ",", "end_range", "+", "1", ",", "stride", ")", "]", ":", "\n", "          ", "count", "+=", "1", "\n", "\n", "", "num_candidates_pe", "=", "count", "\n", "\n", "print", "(", "\"Num candidates pe: \"", "+", "str", "(", "num_candidates_pe", ")", ")", "\n", "print", "(", "\"Num layers of this model: \"", "+", "str", "(", "n_layer", ")", ")", "\n", "print", "(", "\"Total design space: \"", "+", "str", "(", "num_candidates_pe", "**", "(", "2", "*", "n_layer", ")", ")", ")", "\n", "\n", "guess_action", "=", "[", "]", "\n", "self", ".", "best_rewards", "=", "[", "]", "\n", "self", ".", "epoch", "=", "0", "\n", "self", ".", "best_sol", "=", "None", "\n", "self", ".", "dfs", "(", "n_layer", ",", "guess_action", ",", "stride", ")", "\n", "\n", "return", "self", ".", "best_rewards", ",", "self", ".", "best_sol", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.genetic_search": [[412, 520], ["len", "print", "print", "print", "np.empty", "np.empty", "print", "np.empty", "range", "tqdm.tqdm.tqdm", "other_opt_env.MaestroEnvironment.save_chkpt", "float", "range", "np.zeros", "range", "other_opt_env.MaestroEnvironment.exterior_search", "range", "other_opt_env.select_parents", "other_opt_env.crossover", "other_opt_env.mutation", "range", "other_opt_env.MaestroEnvironment.save_chkpt", "str", "str", "str", "random.randint", "random.randint", "np.array", "np.empty", "len", "print", "print", "exit", "float", "np.zeros", "range", "other_opt_env.MaestroEnvironment.exterior_search", "other_opt_env.MaestroEnvironment.best_rewards_iteration.append", "other_opt_env.MaestroEnvironment.best_rewards.append", "print", "len", "print", "print", "exit", "float", "other_opt_env.MaestroEnvironment.fd.write"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.save_chkpt", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.select_parents", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.crossover", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.mutation", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.save_chkpt", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search"], ["", "def", "genetic_search", "(", "self", ",", "epochs", "=", "100", ",", "chkpt_file", "=", "\"genetic_chkpt.plt\"", ",", "fd", "=", "None", ")", ":", "\n", "\n", "        ", "num_pop", "=", "50", "\n", "num_gen", "=", "epochs", "//", "num_pop", "\n", "num_parents", "=", "10", "\n", "self", ".", "fd", "=", "fd", "\n", "self", ".", "chkpt_file", "=", "chkpt_file", "\n", "self", ".", "start_range", "=", "start_range", "\n", "self", ".", "end_range", "=", "end_range", "-", "1", "\n", "\n", "if", "self", ".", "best_reward", "is", "None", ":", "\n", "            ", "self", ".", "best_reward", "=", "float", "(", "\"-Inf\"", ")", "\n", "", "self", ".", "best_rewards", "=", "[", "]", "\n", "self", ".", "epoch", "=", "0", "\n", "self", ".", "best_sol", "=", "None", "\n", "num_layers", "=", "len", "(", "self", ".", "model_defs", ")", "\n", "\n", "\n", "self", ".", "num_generations", "=", "num_gen", "\n", "self", ".", "num_population", "=", "num_pop", "\n", "self", ".", "num_parents", "=", "num_parents", "\n", "\n", "print", "(", "\"Number of generations: \"", "+", "str", "(", "num_gen", ")", ")", "\n", "print", "(", "\"Number of population: \"", "+", "str", "(", "num_pop", ")", ")", "\n", "print", "(", "\"Number of parents: \"", "+", "str", "(", "num_parents", ")", ")", "\n", "\n", "new_population", "=", "np", ".", "empty", "(", "(", "num_pop", ",", "num_layers", ",", "2", ")", ",", "dtype", "=", "int", ")", "\n", "guess_action", "=", "np", ".", "empty", "(", "(", "num_layers", ",", "2", ")", ")", "\n", "count", "=", "0", "\n", "while", "(", "True", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "num_layers", ")", ":", "\n", "                ", "pe", "=", "random", ".", "randint", "(", "self", ".", "start_range", ",", "self", ".", "end_range", ")", "\n", "bf", "=", "random", ".", "randint", "(", "self", ".", "start_range", ",", "self", ".", "end_range", ")", "\n", "\n", "action", "=", "np", ".", "array", "(", "[", "pe", ",", "bf", "]", ",", "dtype", "=", "int", ")", "\n", "guess_action", "[", "i", "]", "=", "action", "\n", "\n", "", "if", "1", ":", "\n", "                ", "new_population", "[", "count", "]", "=", "guess_action", "\n", "guess_action", "=", "np", ".", "empty", "(", "(", "num_layers", ",", "2", ")", ")", "\n", "count", "+=", "1", "\n", "if", "(", "count", "==", "num_pop", ")", ":", "\n", "                    ", "break", "\n", "", "", "", "print", "(", "\"[SYSTEM] Generated intial {} population\"", ".", "format", "(", "num_pop", ")", ")", "\n", "fitness", "=", "np", ".", "empty", "(", "num_pop", ",", "float", ")", "\n", "for", "i", "in", "range", "(", "num_pop", ")", ":", "\n", "            ", "action_id", "=", "new_population", "[", "i", "]", "\n", "action", "=", "np", ".", "zeros", "(", "action_id", ".", "shape", ")", "\n", "for", "p", "in", "range", "(", "len", "(", "action_id", ")", ")", ":", "\n", "                ", "action", "[", "p", ",", "0", "]", "=", "action_space", "[", "0", "]", "[", "action_id", "[", "p", "]", "[", "0", "]", "]", "\n", "action", "[", "p", ",", "1", "]", "=", "action_space", "[", "1", "]", "[", "action_id", "[", "p", "]", "[", "1", "]", "]", "\n", "\n", "", "reward", ",", "total_used_constraint", "=", "self", ".", "exterior_search", "(", "action", ")", "\n", "if", "reward", "is", "None", ":", "\n", "                ", "print", "(", "\"Error with reward\"", ")", "\n", "print", "(", "new_population", "[", "i", "]", ")", "\n", "exit", "(", "-", "1", ")", "\n", "", "if", "total_used_constraint", ">", "self", ".", "constraint_value", ":", "\n", "                ", "reward", "=", "float", "(", "\"-Inf\"", ")", "\n", "", "fitness", "[", "i", "]", "=", "reward", "\n", "\n", "\n", "\n", "", "iteration", "=", "0", "\n", "for", "generation", "in", "tqdm", "(", "range", "(", "num_gen", ")", ")", ":", "\n", "            ", "best_gen_reward", "=", "None", "\n", "parents", "=", "select_parents", "(", "new_population", ",", "fitness", ",", "\n", "num_parents", ",", "num_layers", ")", "\n", "\n", "offspring_crossover", "=", "crossover", "(", "parents", ",", "\n", "num_pop", "-", "num_parents", ",", "\n", "num_layers", ")", "\n", "offspring_mutation", "=", "mutation", "(", "offspring_crossover", ",", "num_layers", ")", "\n", "\n", "new_population", "[", "0", ":", "parents", ".", "shape", "[", "0", "]", ",", ":", "]", "=", "parents", "\n", "new_population", "[", "parents", ".", "shape", "[", "0", "]", ":", ",", ":", "]", "=", "offspring_mutation", "\n", "num_invalid_node", "=", "0", "\n", "\n", "for", "i", "in", "range", "(", "num_pop", ")", ":", "\n", "                ", "action_id", "=", "new_population", "[", "i", "]", "\n", "action", "=", "np", ".", "zeros", "(", "action_id", ".", "shape", ")", "\n", "for", "p", "in", "range", "(", "len", "(", "action_id", ")", ")", ":", "\n", "                    ", "action", "[", "p", ",", "0", "]", "=", "action_space", "[", "0", "]", "[", "action_id", "[", "p", "]", "[", "0", "]", "]", "\n", "action", "[", "p", ",", "1", "]", "=", "action_space", "[", "1", "]", "[", "action_id", "[", "p", "]", "[", "1", "]", "]", "\n", "\n", "", "reward", ",", "total_used_constraint", "=", "self", ".", "exterior_search", "(", "action", ")", "\n", "if", "reward", "is", "None", ":", "\n", "                      ", "print", "(", "\"Error with reward\"", ")", "\n", "print", "(", "new_population", "[", "i", "]", ")", "\n", "exit", "(", "-", "1", ")", "\n", "", "if", "total_used_constraint", ">", "self", ".", "constraint_value", ":", "\n", "                    ", "reward", "=", "float", "(", "\"-Inf\"", ")", "\n", "num_invalid_node", "+=", "1", "\n", "", "if", "reward", ">", "self", ".", "best_reward", ":", "\n", "                    ", "best_gen_reward", "=", "reward", "\n", "self", ".", "best_reward", "=", "reward", "\n", "self", ".", "best_sol", "=", "new_population", "[", "i", "]", "\n", "\n", "", "fitness", "[", "i", "]", "=", "reward", "\n", "iteration", "+=", "1", "\n", "self", ".", "best_rewards_iteration", ".", "append", "(", "iteration", ")", "\n", "self", ".", "best_rewards", ".", "append", "(", "self", ".", "best_reward", ")", "\n", "", "if", "best_gen_reward", "is", "not", "None", ":", "\n", "                ", "self", ".", "fd", ".", "write", "(", "\"\\nGeneration {}: new best award reward: {:9e}\"", ".", "format", "(", "generation", "+", "1", ",", "self", ".", "best_reward", ")", ")", "if", "self", ".", "fd", "else", "None", "\n", "print", "(", "\"\\nGeneration {}: new best award reward: {:9e}\"", ".", "format", "(", "generation", "+", "1", ",", "self", ".", "best_reward", ")", ")", "\n", "", "self", ".", "count_invalid", "+=", "num_invalid_node", "\n", "self", ".", "save_chkpt", "(", ")", "\n", "", "self", ".", "save_chkpt", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.load_chkpt": [[526, 532], ["None"], "methods", ["None"], ["", "def", "load_chkpt", "(", "self", ",", "chkpt", ")", ":", "\n", "        ", "self", ".", "reward_rec", "=", "chkpt", "[", "\"reward_rec\"", "]", "\n", "self", ".", "best_reward", "=", "chkpt", "[", "\"best_reward\"", "]", "\n", "self", ".", "best_rewards", "=", "chkpt", "[", "\"best_rewards\"", "]", "\n", "self", ".", "best_sol", "=", "chkpt", "[", "\"best_sol\"", "]", "\n", "self", ".", "worst_reward", "=", "chkpt", "[", "\"worst_reward\"", "]", "\n", "", "def", "get_chkpt", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.get_chkpt": [[532, 544], ["None"], "methods", ["None"], ["", "def", "get_chkpt", "(", "self", ")", ":", "\n", "        ", "return", "{", "\n", "\"reward_rec\"", ":", "self", ".", "reward_rec", ",", "\n", "\"best_rewards\"", ":", "self", ".", "best_rewards", ",", "\n", "\"best_rewards_iteration\"", ":", "self", ".", "best_rewards_iteration", ",", "\n", "\"best_sol\"", ":", "self", ".", "best_sol", ",", "\n", "\"update_best_sol\"", ":", "self", ".", "update_best_sol", ",", "\n", "\"best_reward\"", ":", "self", ".", "best_reward", ",", "\n", "\"worst_reward\"", ":", "self", ".", "worst_reward", ",", "\n", "\"count_invalid\"", ":", "self", ".", "count_invalid", ",", "\n", "\"start_range\"", ":", "self", ".", "start_range", ",", "\n", "\"end_range\"", ":", "self", ".", "end_range", ",", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.save_chkpt": [[545, 551], ["other_opt_env.MaestroEnvironment.get_chkpt", "open", "pickle.dump"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.get_chkpt"], ["", "def", "save_chkpt", "(", "self", ",", "chkpt_file", "=", "None", ")", ":", "\n", "        ", "if", "chkpt_file", "is", "None", ":", "\n", "            ", "chkpt_file", "=", "self", ".", "chkpt_file", "\n", "", "chkpt", "=", "self", ".", "get_chkpt", "(", ")", "\n", "with", "open", "(", "chkpt_file", ",", "\"wb\"", ")", "as", "fd", ":", "\n", "            ", "pickle", ".", "dump", "(", "chkpt", ",", "fd", ")", "\n", "# print(self.sol)", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search_special": [[553, 570], ["range", "len", "np.concatenate", "other_opt_env.MaestroEnvironment.oberserve_maestro", "sum", "sum", "mac_rec_list.append", "latency_list.append"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.oberserve_maestro"], ["", "", "def", "exterior_search_special", "(", "self", ",", "actions", ",", "action_size", "=", "2", ")", ":", "\n", "        ", "total_reward", "=", "None", "\n", "mac_rec_list", "=", "[", "]", "\n", "latency_list", "=", "[", "]", "\n", "total_constraint", "=", "0", "\n", "for", "i", "in", "range", "(", "len", "(", "actions", ")", ")", ":", "\n", "            ", "action", "=", "actions", "[", "i", "]", "\n", "maestro_state", "=", "np", ".", "concatenate", "(", "(", "self", ".", "model_defs", "[", "i", "]", ",", "action", ")", ")", "\n", "reward", ",", "constraint", "=", "self", ".", "oberserve_maestro", "(", "maestro_state", ")", "\n", "if", "reward", "==", "None", ":", "\n", "                ", "return", "None", "\n", "", "else", ":", "\n", "                ", "mac_rec_list", ".", "append", "(", "self", ".", "observation", "[", "-", "1", "]", ")", "\n", "latency_list", ".", "append", "(", "self", ".", "observation", "[", "0", "]", ")", "\n", "", "total_constraint", "+=", "constraint", "\n", "", "total_reward", "=", "sum", "(", "mac_rec_list", ")", "/", "sum", "(", "latency_list", ")", "\n", "return", "total_reward", ",", "total_constraint", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search": [[571, 596], ["float", "range", "other_opt_env.MaestroEnvironment.exterior_search_special", "len", "np.concatenate", "tuple", "other_opt_env.MaestroEnvironment.oberserve_maestro", "min"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.exterior_search_special", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.oberserve_maestro"], ["", "def", "exterior_search", "(", "self", ",", "actions", ",", "action_size", "=", "2", ")", ":", "\n", "        ", "if", "self", ".", "fitness", "==", "\"thrpt_ave\"", "or", "self", ".", "fitness", "==", "\"thrpt_naive\"", ":", "\n", "            ", "return", "self", ".", "exterior_search_special", "(", "actions", ",", "action_size", ")", "\n", "", "total_reward", "=", "0", "\n", "total_constraint", "=", "0", "\n", "min_reward", "=", "float", "(", "\"Inf\"", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "actions", ")", ")", ":", "\n", "            ", "action", "=", "actions", "[", "i", "]", "\n", "maestro_state", "=", "np", ".", "concatenate", "(", "(", "self", ".", "model_defs", "[", "i", "]", ",", "action", ")", ")", "\n", "table_entry", "=", "tuple", "(", "maestro_state", ")", "\n", "if", "table_entry", "in", "self", ".", "exp_table", ":", "\n", "                ", "reward", ",", "constraint", "=", "self", ".", "exp_table", "[", "table_entry", "]", "\n", "", "else", ":", "\n", "                ", "reward", ",", "constraint", "=", "self", ".", "oberserve_maestro", "(", "maestro_state", ")", "\n", "self", ".", "exp_table", "[", "table_entry", "]", "=", "(", "reward", ",", "constraint", ")", "\n", "", "if", "reward", "==", "None", ":", "\n", "                ", "return", "None", "\n", "# return float(\"-inf\")", "\n", "", "if", "self", ".", "fitness", "==", "\"thrpt_btnk\"", ":", "\n", "                ", "min_reward", "=", "min", "(", "min_reward", ",", "reward", ")", "\n", "total_reward", "=", "min_reward", "\n", "", "else", ":", "\n", "                ", "total_reward", "+=", "reward", "\n", "", "total_constraint", "+=", "constraint", "\n", "", "return", "total_reward", ",", "total_constraint", "\n", "", "def", "write_maestro", "(", "self", ",", "dimension", ",", "dataflow", "=", "\"dla\"", ",", "KTileSz", "=", "1", ",", "CTileSz", "=", "1", ",", "ClusterSz", "=", "4", ",", "m_file", "=", "None", ",", "layer_id", "=", "0", ")", ":", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.write_maestro": [[596, 621], ["len", "open", "open", "int", "open", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fd.seek", "fo.write", "fdpt.seek", "fo.write", "fd.read", "fdpt.read"], "methods", ["None"], ["", "def", "write_maestro", "(", "self", ",", "dimension", ",", "dataflow", "=", "\"dla\"", ",", "KTileSz", "=", "1", ",", "CTileSz", "=", "1", ",", "ClusterSz", "=", "4", ",", "m_file", "=", "None", ",", "layer_id", "=", "0", ")", ":", "\n", "        ", "if", "len", "(", "dimension", ")", ">", "6", ":", "\n", "            ", "m_type", "=", "m_type_dicts", "[", "int", "(", "dimension", "[", "-", "1", "]", ")", "]", "\n", "", "else", ":", "\n", "            ", "m_type", "=", "\"CONV\"", "\n", "", "with", "open", "(", "\"../../data/dataflow/{}.m\"", ".", "format", "(", "dataflow", ")", ",", "\"r\"", ")", "as", "fd", ":", "\n", "            ", "with", "open", "(", "\"../../data/dataflow/dpt.m\"", ",", "\"r\"", ")", "as", "fdpt", ":", "\n", "                ", "with", "open", "(", "\"{}.m\"", ".", "format", "(", "m_file", ")", ",", "\"w\"", ")", "as", "fo", ":", "\n", "                    ", "fo", ".", "write", "(", "\"Constant KTileSz {};\\n\"", ".", "format", "(", "KTileSz", ")", ")", "\n", "fo", ".", "write", "(", "\"Constant CTileSz {};\\n\"", ".", "format", "(", "CTileSz", ")", ")", "\n", "fo", ".", "write", "(", "\"Constant ClusterSz {};\\n\"", ".", "format", "(", "ClusterSz", ")", ")", "\n", "fo", ".", "write", "(", "\"Network {} {{\\n\"", ".", "format", "(", "layer_id", ")", ")", "\n", "fo", ".", "write", "(", "\"Layer {} {{\\n\"", ".", "format", "(", "m_type", ")", ")", "\n", "fo", ".", "write", "(", "\"Type: {}\\n\"", ".", "format", "(", "m_type", ")", ")", "\n", "fo", ".", "write", "(", "\n", "\"Dimensions {{ K: {:.0f}, C: {:.0f}, Y: {:.0f}, X: {:.0f}, R: {:.0f}, S: {:.0f} }}\\n\"", ".", "format", "(", "\n", "*", "dimension", ")", ")", "\n", "if", "m_type", "==", "\"CONV\"", ":", "\n", "                        ", "fd", ".", "seek", "(", "0", ")", "\n", "fo", ".", "write", "(", "fd", ".", "read", "(", ")", ")", "\n", "", "else", ":", "\n", "                        ", "fdpt", ".", "seek", "(", "0", ")", "\n", "fo", ".", "write", "(", "fdpt", ".", "read", "(", ")", ")", "\n", "", "fo", ".", "write", "(", "\"}\\n\"", ")", "\n", "fo", ".", "write", "(", "\"}\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.oberserve_maestro": [[622, 691], ["subprocess.Popen", "subprocess.Popen.communicate", "subprocess.Popen.wait", "actions.astype().squeeze", "actions.astype().squeeze", "os.path.exists", "os.remove", "pandas.read_csv", "np.array().reshape", "np.array().reshape", "np.array().reshape", "np.array().reshape", "np.array().reshape", "np.array().reshape", "np.array().reshape", "np.array().reshape", "other_opt_env.MaestroEnvironment.judge", "other_opt_env.MaestroEnvironment.write_maestro_gemm", "other_opt_env.MaestroEnvironment.write_maestro", "other_opt_env.MaestroEnvironment.write_maestro_gemm", "other_opt_env.MaestroEnvironment.write_maestro", "os.path.exists", "os.remove", "os.path.exists", "os.remove", "np.mean", "print", "print", "print", "actions.astype", "actions.astype", "np.array", "np.array", "np.array", "np.array", "np.array", "np.array", "np.array", "np.array"], "methods", ["home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.judge", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.write_maestro_gemm", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.write_maestro", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.write_maestro_gemm", "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.write_maestro"], ["", "", "", "", "def", "oberserve_maestro", "(", "self", ",", "state", ",", "firsttime", "=", "False", ")", ":", "\n", "        ", "m_file", "=", "self", ".", "random_file_name", "\n", "dimension", "=", "state", "[", ":", "self", ".", "dim_size", "]", "\n", "\n", "actions", "=", "state", "[", "-", "self", ".", "n_action_steps", ":", "]", "\n", "if", "self", ".", "n_action_steps", "==", "2", ":", "\n", "            ", "num_pe", ",", "KTileSz", "=", "actions", ".", "astype", "(", "int", ")", ".", "squeeze", "(", ")", "\n", "ClusterSz", "=", "num_pe", "\n", "self", ".", "resource_state", "=", "[", "num_pe", ",", "KTileSz", "]", "\n", "if", "self", ".", "is_gemm", ":", "\n", "                ", "self", ".", "write_maestro_gemm", "(", "dimension", ",", "dataflow", "=", "self", ".", "dataflow", ",", "KTileSz", "=", "KTileSz", ",", "ClusterSz", "=", "ClusterSz", ",", "\n", "m_file", "=", "m_file", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "write_maestro", "(", "dimension", ",", "dataflow", "=", "self", ".", "dataflow", ",", "KTileSz", "=", "KTileSz", ",", "ClusterSz", "=", "ClusterSz", ",", "\n", "m_file", "=", "m_file", ")", "\n", "", "", "else", ":", "\n", "            ", "num_pe", ",", "KTileSz", ",", "df_idx", "=", "actions", ".", "astype", "(", "int", ")", ".", "squeeze", "(", ")", "\n", "self", ".", "resource_state", "=", "[", "num_pe", ",", "KTileSz", "]", "\n", "ClusterSz", "=", "num_pe", "\n", "if", "self", ".", "is_gemm", ":", "\n", "                ", "self", ".", "write_maestro_gemm", "(", "dimension", ",", "dataflow", "=", "self", ".", "dataflow", ",", "KTileSz", "=", "KTileSz", ",", "ClusterSz", "=", "ClusterSz", ",", "\n", "m_file", "=", "m_file", ",", "df_idx", "=", "df_idx", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "write_maestro", "(", "dimension", ",", "dataflow", "=", "self", ".", "dataflow", ",", "KTileSz", "=", "KTileSz", ",", "ClusterSz", "=", "ClusterSz", ",", "\n", "m_file", "=", "m_file", ",", "df_idx", "=", "df_idx", ")", "\n", "\n", "\n", "\n", "\n", "\n", "", "", "os", ".", "remove", "(", "\"./{}.csv\"", ".", "format", "(", "m_file", ")", ")", "if", "os", ".", "path", ".", "exists", "(", "\"./{}.csv\"", ".", "format", "(", "m_file", ")", ")", "else", "None", "\n", "command", "=", "[", "self", ".", "_executable", ",", "\n", "\"--Mapping_file={}.m\"", ".", "format", "(", "m_file", ")", ",", "\n", "\"--full_buffer=false\"", ",", "\"--noc_bw_cstr=81920000\"", ",", "\n", "\"--noc_hops=1\"", ",", "\"--noc_hop_latency=1\"", ",", "\n", "\"--noc_mc_support=true\"", ",", "\"--num_pes={}\"", ".", "format", "(", "num_pe", ")", ",", "\n", "\"--num_simd_lanes=1\"", ",", "\"--l1_size_cstr=819200000\"", ",", "\n", "\"--l2_size_cstr=819200000\"", ",", "\"--print_res=false\"", ",", "\"--print_res_csv_file=true\"", ",", "\"--print_log_file=false\"", ",", "\"--print_design_space=false\"", ",", "\"--msg_print_lv=0\"", "]", "\n", "\n", "\n", "process", "=", "Popen", "(", "command", ",", "stdout", "=", "PIPE", ",", "stderr", "=", "PIPE", ")", "\n", "stdout", ",", "stderr", "=", "process", ".", "communicate", "(", ")", "\n", "process", ".", "wait", "(", ")", "\n", "\n", "\n", "\n", "\n", "try", ":", "\n", "\n", "            ", "df", "=", "pd", ".", "read_csv", "(", "\"./{}.csv\"", ".", "format", "(", "m_file", ")", ")", "\n", "layer_name", "=", "df", "[", "\" Layer Number\"", "]", "\n", "runtime", "=", "np", ".", "array", "(", "df", "[", "\" Runtime (Cycles)\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "throughput", "=", "np", ".", "array", "(", "df", "[", "\" Throughput (MACs/Cycle)\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "energy", "=", "np", ".", "array", "(", "df", "[", "\" Activity count-based Energy (nJ)\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "area", "=", "np", ".", "array", "(", "df", "[", "\" Area\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "power", "=", "np", ".", "array", "(", "df", "[", "\" Power\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "l1_size", "=", "np", ".", "array", "(", "df", "[", "\" L1 SRAM Size Req (Bytes)\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "l2_size", "=", "np", ".", "array", "(", "df", "[", "\"  L2 SRAM Size Req (Bytes)\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "mac", "=", "np", ".", "array", "(", "df", "[", "\" Num MACs\"", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "os", ".", "remove", "(", "\"./{}.csv\"", ".", "format", "(", "m_file", ")", ")", "if", "os", ".", "path", ".", "exists", "(", "\"./{}.csv\"", ".", "format", "(", "m_file", ")", ")", "else", "None", "\n", "os", ".", "remove", "(", "\"./log.txt\"", ")", "if", "os", ".", "path", ".", "exists", "(", "\"./log.txt\"", ")", "else", "None", "\n", "self", ".", "observation", "=", "[", "np", ".", "mean", "(", "x", ")", "for", "x", "in", "[", "runtime", ",", "throughput", ",", "energy", ",", "area", ",", "l1_size", ",", "l2_size", ",", "mac", ",", "power", "]", "]", "\n", "\n", "return", "self", ".", "judge", "(", ")", "\n", "", "except", ":", "\n", "            ", "print", "(", "\"+\"", "*", "20", ")", "\n", "print", "(", "num_pe", ",", "KTileSz", ",", "ClusterSz", ")", "\n", "print", "(", "\"+\"", "*", "20", ")", "\n", "return", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.MaestroEnvironment.write_maestro_gemm": [[693, 719], ["open", "open", "open", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fo.write", "fd.seek", "fo.write", "fdpt.seek", "fo.write", "fd.read", "fdpt.read"], "methods", ["None"], ["", "", "def", "write_maestro_gemm", "(", "self", ",", "dimension", ",", "dataflow", "=", "\"dla\"", ",", "KTileSz", "=", "1", ",", "CTileSz", "=", "1", ",", "ClusterSz", "=", "4", ",", "m_file", "=", "None", ",", "layer_id", "=", "0", ",", "df_idx", "=", "None", ")", ":", "\n", "        ", "if", "df_idx", "is", "not", "None", ":", "\n", "            ", "dataflow", "=", "df_dict", "[", "df_idx", "]", "\n", "", "m_type", "=", "\"CONV\"", "\n", "SzM", ",", "SzN", ",", "SzK", "=", "dimension", "\n", "dimension", "=", "[", "SzN", ",", "SzK", ",", "SzM", ",", "1", ",", "1", ",", "1", "]", "\n", "with", "open", "(", "\"{}_f.m\"", ".", "format", "(", "dataflow", ")", ",", "\"r\"", ")", "as", "fd", ":", "\n", "            ", "with", "open", "(", "\"dpt_f.m\"", ",", "\"r\"", ")", "as", "fdpt", ":", "\n", "                ", "with", "open", "(", "\"{}.m\"", ".", "format", "(", "m_file", ")", ",", "\"w\"", ")", "as", "fo", ":", "\n", "                    ", "fo", ".", "write", "(", "\"Constant KTileSz {};\\n\"", ".", "format", "(", "KTileSz", ")", ")", "\n", "fo", ".", "write", "(", "\"Constant CTileSz {};\\n\"", ".", "format", "(", "CTileSz", ")", ")", "\n", "fo", ".", "write", "(", "\"Constant ClusterSz {};\\n\"", ".", "format", "(", "ClusterSz", ")", ")", "\n", "fo", ".", "write", "(", "\"Network {} {{\\n\"", ".", "format", "(", "layer_id", ")", ")", "\n", "fo", ".", "write", "(", "\"Layer {} {{\\n\"", ".", "format", "(", "\"CONV\"", ")", ")", "\n", "fo", ".", "write", "(", "\"Type: {}\\n\"", ".", "format", "(", "m_type", ")", ")", "\n", "fo", ".", "write", "(", "\n", "\"Dimensions {{ K: {:.0f}, C: {:.0f}, Y: {:.0f}, X: {:.0f}, R: {:.0f}, S: {:.0f} }}\\n\"", ".", "format", "(", "\n", "*", "dimension", ")", ")", "\n", "if", "m_type", "==", "\"CONV\"", ":", "\n", "                        ", "fd", ".", "seek", "(", "0", ")", "\n", "fo", ".", "write", "(", "fd", ".", "read", "(", ")", ")", "\n", "", "else", ":", "\n", "                        ", "fdpt", ".", "seek", "(", "0", ")", "\n", "fo", ".", "write", "(", "fdpt", ".", "read", "(", ")", ")", "\n", "", "fo", ".", "write", "(", "\"}\\n\"", ")", "\n", "fo", ".", "write", "(", "\"}\"", ")", "\n", "", "", "", "", "", ""]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.select_parents": [[37, 45], ["np.empty", "range", "np.where", "float", "np.max"], "function", ["None"], ["", "", "def", "select_parents", "(", "pop", ",", "fitness", ",", "num_parents", ",", "num_layers", ")", ":", "\n", "    ", "parents", "=", "np", ".", "empty", "(", "(", "num_parents", ",", "num_layers", ",", "2", ")", ")", "\n", "for", "parent_num", "in", "range", "(", "num_parents", ")", ":", "\n", "        ", "max_fitness_idx", "=", "np", ".", "where", "(", "fitness", "==", "np", ".", "max", "(", "fitness", ")", ")", "\n", "max_fitness_idx", "=", "max_fitness_idx", "[", "0", "]", "[", "0", "]", "\n", "parents", "[", "parent_num", "]", "=", "pop", "[", "max_fitness_idx", "]", "\n", "fitness", "[", "max_fitness_idx", "]", "=", "float", "(", "\"-Inf\"", ")", "\n", "", "return", "parents", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.crossover": [[46, 56], ["np.empty", "np.uint8", "range", "np.random.randint"], "function", ["None"], ["", "def", "crossover", "(", "parents", ",", "offspring_size", ",", "num_layers", ")", ":", "\n", "    ", "offspring", "=", "np", ".", "empty", "(", "(", "offspring_size", ",", "num_layers", ",", "2", ")", ")", "\n", "crossover_point", "=", "np", ".", "uint8", "(", "num_layers", "/", "2", ")", "\n", "\n", "for", "k", "in", "range", "(", "offspring_size", ")", ":", "\n", "        ", "parent1_idx", "=", "k", "%", "parents", ".", "shape", "[", "0", "]", "\n", "parent2_idx", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "parents", ".", "shape", "[", "0", "]", ")", "#(k+1)%parents.shape[0]", "\n", "offspring", "[", "k", "]", "[", "0", ":", "crossover_point", "]", "=", "parents", "[", "parent1_idx", "]", "[", "0", ":", "crossover_point", "]", "\n", "offspring", "[", "k", "]", "[", "crossover_point", ":", "]", "=", "parents", "[", "parent2_idx", "]", "[", "crossover_point", ":", "]", "\n", "", "return", "offspring", "\n", "\n"]], "home.repos.pwc.inspect_result.maestro-project_confuciux.Other_Opts.other_opt_env.mutation": [[57, 66], ["range", "range", "range", "random.random", "random.randint"], "function", ["None"], ["", "def", "mutation", "(", "offsprings", ",", "num_layers", ",", "rate", "=", "0.05", ")", ":", "\n", "    ", "for", "idx", "in", "range", "(", "offsprings", ".", "shape", "[", "0", "]", ")", ":", "\n", "        ", "for", "lay", "in", "range", "(", "offsprings", ".", "shape", "[", "1", "]", ")", ":", "\n", "            ", "for", "p", "in", "range", "(", "offsprings", ".", "shape", "[", "2", "]", ")", ":", "\n", "                ", "if", "random", ".", "random", "(", ")", "<", "rate", ":", "\n", "                    ", "offsprings", "[", "idx", "]", "[", "lay", "]", "[", "p", "]", "=", "random", ".", "randint", "(", "0", ",", "11", ")", "\n", "\n", "\n", "", "", "", "", "return", "offsprings", "\n", "\n"]]}