{"home.repos.pwc.inspect_result.gi-z_movementdetection-demo.None.data_handler.load_csi_data": [[34, 89], ["len", "float", "float", "CSIKit.util.csitools.get_CSI", "numpy.squeeze", "numpy.transpose", "numpy.transpose", "abs", "range", "numpy.nan_to_num", "int", "CSIKit.util.filters.lowpass", "range"], "function", ["None"], ["def", "load_csi_data", "(", "csi_data", ",", "subcarrier_range", "=", "ALL_CHANNELS", ",", "target_sample_rate", "=", "10", ",", "lowpass", "=", "True", ")", ":", "\n", "\n", "    ", "frames", "=", "csi_data", ".", "frames", "\n", "\n", "#Identify the need for source resampling.", "\n", "no_frames", "=", "len", "(", "frames", ")", "\n", "first_timestamp", "=", "float", "(", "frames", "[", "0", "]", ".", "real_timestamp", ")", "\n", "last_timestamp", "=", "float", "(", "frames", "[", "-", "1", "]", ".", "real_timestamp", ")", "\n", "\n", "final_timestamp", "=", "last_timestamp", "-", "first_timestamp", "\n", "average_sample_rate", "=", "no_frames", "/", "final_timestamp", "\n", "\n", "#Check the average sample rate is close enough to that we'd expect.", "\n", "if", "abs", "(", "average_sample_rate", "-", "DEFAULT_FS", ")", ">", "10", ":", "\n", "\n", "#Ideally we'd like to use some interpolation.", "\n", "#But supposedly scipy's interp1d is slow.", "\n", "#For now, we'll stick with downsampling since we're in control of data capture.", "\n", "\n", "        ", "if", "average_sample_rate", ">", "DEFAULT_FS", ":", "\n", "            ", "downsample_factor", "=", "int", "(", "average_sample_rate", "/", "DEFAULT_FS", ")", "\n", "frames", "=", "frames", "[", ":", ":", "downsample_factor", "]", "\n", "\n", "#At this point, our trace object should have an avg sampling rate of 100Hz.", "\n", "\n", "#Retrieve CSI for the data we've got now.", "\n", "", "", "csi", ",", "_", ",", "_", "=", "get_CSI", "(", "csi_data", ")", "\n", "timestamps", "=", "csi_data", ".", "timestamps", "\n", "\n", "csi", "=", "np", ".", "squeeze", "(", "csi", ")", "\n", "csi", "=", "np", ".", "transpose", "(", "csi", ")", "\n", "# timestamps = [x[\"timestamp\"] for x in trace]", "\n", "# timestamps_unscaled = [x[\"timestamp_low\"] for x in trace]", "\n", "\n", "#Filter out unwanted subcarriers.", "\n", "csi", "=", "csi", "[", "[", "x", "for", "x", "in", "range", "(", "64", ")", "if", "x", "not", "in", "USELESS_SUBCARRIERS", "]", "]", "\n", "# csi = csi[[x for x in subcarrier_range]]", "\n", "\n", "#Handle Lowpass filter.", "\n", "if", "lowpass", ":", "\n", "        ", "sampling_rate", "=", "100", "#Hz", "\n", "lowpass_cutoff", "=", "10", "#Hz", "\n", "order", "=", "5", "#n", "\n", "\n", "for", "x", "in", "range", "(", "csi", ".", "shape", "[", "0", "]", ")", ":", "\n", "            ", "csi", "[", "x", "]", "=", "filters", ".", "lowpass", "(", "csi", "[", "x", "]", ",", "lowpass_cutoff", ",", "sampling_rate", ",", "order", ")", "\n", "", "csi", "=", "np", ".", "nan_to_num", "(", "csi", ")", "\n", "\n", "", "csi_trans", "=", "np", ".", "transpose", "(", "csi", ")", "\n", "\n", "#Downsample to 10Hz.", "\n", "csi_trans", "=", "csi_trans", "[", ":", ":", "10", "]", "\n", "timestamps", "=", "timestamps", "[", ":", ":", "10", "]", "\n", "\n", "return", "csi_trans", ",", "timestamps", ",", "timestamps", "\n", "# return csi_trans, timestamps, timestamps_unscaled", ""]], "home.repos.pwc.inspect_result.gi-z_movementdetection-demo.None.stats.get_h_hat_t": [[3, 10], ["numpy.mean", "numpy.std"], "function", ["None"], ["def", "get_h_hat_t", "(", "csi_vec", ")", ":", "\n", "    ", "csi_mean", "=", "np", ".", "mean", "(", "csi_vec", ")", "\n", "\n", "translation", "=", "csi_vec", "-", "csi_mean", "\n", "scaling", "=", "np", ".", "std", "(", "csi_vec", ")", "\n", "\n", "return", "translation", "/", "scaling", "\n", "\n"]], "home.repos.pwc.inspect_result.gi-z_movementdetection-demo.None.stats.get_sti": [[11, 16], ["stats.get_h_hat_t", "stats.get_h_hat_t", "numpy.linalg.norm"], "function", ["home.repos.pwc.inspect_result.gi-z_movementdetection-demo.None.stats.get_h_hat_t", "home.repos.pwc.inspect_result.gi-z_movementdetection-demo.None.stats.get_h_hat_t"], ["", "def", "get_sti", "(", "csi_vec_1", ",", "csi_vec_2", ")", ":", "\n", "    ", "h1", "=", "get_h_hat_t", "(", "csi_vec_1", ")", "\n", "h2", "=", "get_h_hat_t", "(", "csi_vec_2", ")", "\n", "\n", "return", "np", ".", "linalg", ".", "norm", "(", "h1", "-", "h2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gi-z_movementdetection-demo.None.stats.get_correlation_coefficient": [[17, 19], ["numpy.corrcoef"], "function", ["None"], ["", "def", "get_correlation_coefficient", "(", "csi_vec_1", ",", "csi_vec_2", ")", ":", "\n", "    ", "return", "np", ".", "corrcoef", "(", "[", "csi_vec_1", ",", "csi_vec_2", "]", ")", "[", "0", ",", "1", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.gi-z_movementdetection-demo.None.stats.slidingpeaks": [[20, 73], ["numpy.zeros", "max", "numpy.full", "numpy.full", "range", "len", "len", "numpy.abs", "int", "diffs.append", "len", "len", "len", "numpy.mean", "numpy.mean", "min", "markers.append", "markers.append"], "function", ["None"], ["", "def", "slidingpeaks", "(", "y", ",", "corr", ",", "containsmovement_threshold", ",", "moving_threshold", ",", "notmoving_threshold", ")", ":", "\n", "    ", "window_length", "=", "5", "\n", "i", "=", "0", "\n", "\n", "signals", "=", "np", ".", "zeros", "(", "len", "(", "y", ")", ")", "\n", "markers", "=", "[", "]", "\n", "diffs", "=", "[", "]", "\n", "\n", "is_moving", "=", "False", "\n", "\n", "max_val", "=", "max", "(", "y", ")", "\n", "\n", "while", "i", "<", "len", "(", "y", ")", ":", "\n", "        ", "first_window", "=", "y", "[", "i", ":", "i", "+", "window_length", "]", "\n", "second_window", "=", "y", "[", "i", "+", "window_length", ":", "i", "+", "window_length", "*", "2", "]", "\n", "\n", "first_mean", "=", "np", ".", "mean", "(", "first_window", ")", "/", "max_val", "\n", "second_mean", "=", "np", ".", "mean", "(", "second_window", ")", "/", "max_val", "\n", "\n", "diff", "=", "np", ".", "abs", "(", "second_mean", "-", "first_mean", ")", "\n", "\n", "if", "min", "(", "corr", ")", "<", "containsmovement_threshold", ":", "\n", "            ", "if", "is_moving", ":", "\n", "#Large diff means movement continues.", "\n", "#Small diff means return to steady.", "\n", "                ", "if", "diff", "<", "notmoving_threshold", ":", "\n", "                    ", "is_moving", "=", "False", "\n", "", "else", ":", "\n", "                    ", "markers", ".", "append", "(", "i", ")", "\n", "", "", "else", ":", "\n", "                ", "if", "diff", ">", "moving_threshold", ":", "\n", "                    ", "markers", ".", "append", "(", "i", ")", "\n", "is_moving", "=", "True", "\n", "\n", "", "", "", "signals", "[", "i", "]", "=", "int", "(", "is_moving", ")", "\n", "diffs", ".", "append", "(", "diff", ")", "\n", "\n", "i", "+=", "1", "\n", "\n", "", "thresh_mov", "=", "np", ".", "full", "(", "len", "(", "y", ")", ",", "fill_value", "=", "moving_threshold", ")", "\n", "thresh_nomov", "=", "np", ".", "full", "(", "len", "(", "y", ")", ",", "fill_value", "=", "notmoving_threshold", ")", "\n", "\n", "#Merges movement samples to chunk_size*fs precision.", "\n", "#Assumes 10Hz.", "\n", "chunk_size", "=", "10", "\n", "for", "i", "in", "range", "(", "len", "(", "signals", ")", ")", ":", "\n", "        ", "if", "i", "%", "chunk_size", "==", "0", ":", "\n", "#Get previous second's worth of data and check for movement.", "\n", "            ", "win", "=", "signals", "[", "i", "-", "chunk_size", ":", "i", "]", "\n", "if", "1", "in", "win", ":", "\n", "                ", "signals", "[", "i", "-", "chunk_size", ":", "i", "]", "=", "1", "\n", "\n", "", "", "", "return", "(", "diffs", ",", "markers", ",", "signals", ",", "thresh_mov", ",", "thresh_nomov", ")", "", "", ""]], "home.repos.pwc.inspect_result.gi-z_movementdetection-demo.None.plot.heatmap": [[14, 29], ["matplotlib.subplots", "ax.imshow", "ax.figure.colorbar", "ax.figure.colorbar.ax.set_ylabel", "matplotlib.xlabel", "matplotlib.ylabel", "matplotlib.title", "matplotlib.show"], "function", ["None"], ["def", "heatmap", "(", "csi", ",", "timestamps", ")", ":", "\n", "    ", "extent", "=", "[", "0", ",", "timestamps", "[", "-", "1", "]", ",", "1", ",", "csi", ".", "shape", "[", "0", "]", "]", "\n", "\n", "_", ",", "ax", "=", "plt", ".", "subplots", "(", ")", "\n", "im", "=", "ax", ".", "imshow", "(", "csi", ",", "cmap", "=", "\"jet\"", ",", "aspect", "=", "\"auto\"", ",", "extent", "=", "extent", ")", "\n", "\n", "cbar", "=", "ax", ".", "figure", ".", "colorbar", "(", "im", ",", "ax", "=", "ax", ")", "\n", "cbar", ".", "ax", ".", "set_ylabel", "(", "\"Amplitude (dBm)\"", ")", "\n", "\n", "plt", ".", "xlabel", "(", "\"Time (s)\"", ")", "\n", "plt", ".", "ylabel", "(", "\"Subcarrier Index\"", ")", "\n", "\n", "plt", ".", "title", "(", "\"Channel State Information\"", ")", "\n", "\n", "plt", ".", "show", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gi-z_movementdetection-demo.None.plot.heatmap_3d": [[30, 52], ["matplotlib.figure", "plt.figure.gca", "numpy.transpose", "numpy.arange", "numpy.meshgrid", "numpy.transpose", "fig.gca.plot_surface", "fig.gca.set_xlabel", "fig.gca.set_ylabel", "fig.gca.set_zlabel", "plt.figure.colorbar", "matplotlib.show"], "function", ["None"], ["", "def", "heatmap_3d", "(", "csi", ",", "timestamps", ")", ":", "\n", "    ", "fig", "=", "plt", ".", "figure", "(", ")", "\n", "ax", "=", "fig", ".", "gca", "(", "projection", "=", "'3d'", ")", "\n", "\n", "csi", "=", "np", ".", "transpose", "(", "csi", ")", "\n", "\n", "x", "=", "np", ".", "arange", "(", "csi", ".", "shape", "[", "0", "]", ")", "\n", "y", "=", "timestamps", "\n", "\n", "x", ",", "y", "=", "np", ".", "meshgrid", "(", "x", ",", "y", ")", "\n", "\n", "csi", "=", "np", ".", "transpose", "(", "csi", ")", "\n", "\n", "surf", "=", "ax", ".", "plot_surface", "(", "x", ",", "y", ",", "csi", ",", "cmap", "=", "\"jet\"", ",", "linewidth", "=", "0", ",", "antialiased", "=", "True", ")", "\n", "\n", "ax", ".", "set_xlabel", "(", "'Subcarrier Index'", ")", "\n", "ax", ".", "set_ylabel", "(", "'Time (s)'", ")", "\n", "ax", ".", "set_zlabel", "(", "'Amplitude (dBm)'", ")", "\n", "\n", "fig", ".", "colorbar", "(", "surf", ")", "\n", "\n", "plt", ".", "show", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gi-z_movementdetection-demo.None.plot.plot_movement": [[349, 447], ["CSIKit.util.filters.running_variance", "CSIKit.util.filters.running_stdev", "stats.slidingpeaks", "numpy.array", "numpy.array", "matplotlib.subplot", "matplotlib.imshow", "matplotlib.xlabel", "matplotlib.ylabel", "matplotlib.title", "matplotlib.subplot", "matplotlib.title", "matplotlib.xlabel", "matplotlib.plot", "matplotlib.plot", "matplotlib.legend", "matplotlib.subplot", "range", "matplotlib.title", "matplotlib.xlabel", "matplotlib.plot", "matplotlib.subplot", "matplotlib.title", "matplotlib.xlabel", "matplotlib.plot", "matplotlib.subplot", "matplotlib.title", "matplotlib.xlabel", "matplotlib.plot", "matplotlib.subplot", "matplotlib.title", "matplotlib.xlabel", "matplotlib.plot", "matplotlib.subplot", "matplotlib.title", "matplotlib.xlabel", "matplotlib.plot", "matplotlib.subplot", "matplotlib.title", "matplotlib.xlabel", "matplotlib.plot", "matplotlib.subplot", "matplotlib.title", "matplotlib.xlabel", "matplotlib.plot", "matplotlib.plot", "matplotlib.plot", "matplotlib.suptitle", "matplotlib.show", "numpy.transpose", "numpy.full", "len", "np.array.append", "np.array.append", "np.array.append", "np.array.append", "len"], "function", ["home.repos.pwc.inspect_result.gi-z_movementdetection-demo.None.stats.slidingpeaks"], ["", "def", "plot_movement", "(", "path", ",", "csi", ",", "sti_values", ",", "corr_values", ",", "timestamps", ",", "timestamps_unscaled", ",", "filename", ",", "containsmovement_threshold", ",", "moving_threshold", ",", "notmoving_threshold", ")", ":", "\n", "\n", "    ", "var_corr", "=", "filters", ".", "running_variance", "(", "corr_values", ",", "10", ")", "\n", "std_corr", "=", "filters", ".", "running_stdev", "(", "corr_values", ",", "10", ")", "\n", "\n", "diffs", ",", "markers", ",", "signals", ",", "thresh_mov", ",", "thresh_nomov", "=", "slidingpeaks", "(", "var_corr", ",", "corr_values", ",", "containsmovement_threshold", ",", "moving_threshold", ",", "notmoving_threshold", ")", "\n", "\n", "mov_vals", "=", "[", "]", "\n", "for", "x", "in", "corr_values", ":", "\n", "        ", "if", "x", "<", "containsmovement_threshold", ":", "\n", "            ", "mov_vals", ".", "append", "(", "1", ")", "\n", "", "else", ":", "\n", "            ", "mov_vals", ".", "append", "(", "0", ")", "\n", "", "", "mov_vals", "=", "np", ".", "array", "(", "mov_vals", ")", "\n", "\n", "mov_vals2", "=", "[", "]", "\n", "for", "x", "in", "sti_values", ":", "\n", "        ", "if", "x", ">", "0.8", ":", "\n", "            ", "mov_vals2", ".", "append", "(", "1", ")", "\n", "", "else", ":", "\n", "            ", "mov_vals2", ".", "append", "(", "0", ")", "\n", "", "", "mov_vals2", "=", "np", ".", "array", "(", "mov_vals2", ")", "\n", "\n", "plt", ".", "subplot", "(", "3", ",", "3", ",", "1", ")", "\n", "extent", "=", "[", "0", ",", "timestamps", "[", "-", "1", "]", ",", "1", ",", "csi", ".", "shape", "[", "1", "]", "]", "\n", "\n", "plt", ".", "imshow", "(", "np", ".", "transpose", "(", "csi", ")", ",", "cmap", "=", "\"jet\"", ",", "aspect", "=", "\"auto\"", ",", "extent", "=", "extent", ")", "\n", "\n", "plt", ".", "xlabel", "(", "\"Time (s)\"", ")", "\n", "plt", ".", "ylabel", "(", "\"Subcarrier Index\"", ")", "\n", "\n", "plt", ".", "title", "(", "\"Channel State Information\"", ")", "\n", "\n", "#Plot Correlation Coefficient", "\n", "plt", ".", "subplot", "(", "3", ",", "3", ",", "4", ")", "\n", "\n", "plt", ".", "title", "(", "\"Pearson Correlation Coefficient\"", ")", "\n", "plt", ".", "xlabel", "(", "\"Time (s)\"", ")", "\n", "\n", "plt", ".", "plot", "(", "timestamps", ",", "corr_values", ",", "color", "=", "\"blue\"", ",", "label", "=", "\"PCC\"", ")", "\n", "plt", ".", "plot", "(", "timestamps", ",", "np", ".", "full", "(", "(", "len", "(", "timestamps", ")", ")", ",", "fill_value", "=", "containsmovement_threshold", ")", ",", "color", "=", "\"red\"", ",", "label", "=", "\"Threshold\"", ")", "\n", "\n", "plt", ".", "legend", "(", ")", "\n", "\n", "plt", ".", "subplot", "(", "3", ",", "3", ",", "3", ")", "\n", "\n", "chunk_size", "=", "10", "\n", "for", "i", "in", "range", "(", "len", "(", "mov_vals", ")", ")", ":", "\n", "        ", "if", "i", "%", "chunk_size", "==", "0", ":", "\n", "#Get previous second's worth of data and check for movement.", "\n", "            ", "win", "=", "mov_vals", "[", "i", "-", "chunk_size", ":", "i", "]", "\n", "if", "1", "in", "win", ":", "\n", "                ", "mov_vals", "[", "i", "-", "chunk_size", ":", "i", "]", "=", "1", "\n", "\n", "", "", "", "plt", ".", "title", "(", "\"PCC Thresh\"", ")", "\n", "plt", ".", "xlabel", "(", "\"Time (s)\"", ")", "\n", "plt", ".", "plot", "(", "timestamps", ",", "mov_vals", ",", "color", "=", "\"red\"", ")", "\n", "\n", "plt", ".", "subplot", "(", "3", ",", "3", ",", "2", ")", "\n", "plt", ".", "title", "(", "\"STI\"", ")", "\n", "plt", ".", "xlabel", "(", "\"Time (s)\"", ")", "\n", "plt", ".", "plot", "(", "timestamps", ",", "sti_values", ",", "color", "=", "\"red\"", ")", "\n", "\n", "plt", ".", "subplot", "(", "3", ",", "3", ",", "6", ")", "\n", "plt", ".", "title", "(", "\"STI Thresh (Movement)\"", ")", "\n", "plt", ".", "xlabel", "(", "\"Time (s)\"", ")", "\n", "plt", ".", "plot", "(", "timestamps", ",", "mov_vals2", ",", "color", "=", "\"red\"", ")", "\n", "\n", "#PCC Variance Plot", "\n", "plt", ".", "subplot", "(", "3", ",", "3", ",", "7", ")", "\n", "\n", "plt", ".", "title", "(", "\"PCC Running Variance (Movement)\"", ")", "\n", "plt", ".", "xlabel", "(", "\"Time (s)\"", ")", "\n", "plt", ".", "plot", "(", "timestamps", ",", "var_corr", ",", "\"-gD\"", ",", "color", "=", "\"red\"", ",", "markevery", "=", "markers", ")", "\n", "\n", "#PCC Stdev Plot", "\n", "plt", ".", "subplot", "(", "3", ",", "3", ",", "5", ")", "\n", "\n", "plt", ".", "title", "(", "\"PCC Running Standard Deviation (Movement)\"", ")", "\n", "plt", ".", "xlabel", "(", "\"Time (s)\"", ")", "\n", "plt", ".", "plot", "(", "timestamps", ",", "std_corr", ",", "color", "=", "\"red\"", ")", "\n", "\n", "plt", ".", "subplot", "(", "3", ",", "3", ",", "8", ")", "\n", "\n", "plt", ".", "title", "(", "\"Movement\"", ")", "\n", "plt", ".", "xlabel", "(", "\"Time (s)\"", ")", "\n", "plt", ".", "plot", "(", "timestamps", ",", "signals", ",", "color", "=", "\"red\"", ")", "\n", "\n", "plt", ".", "subplot", "(", "3", ",", "3", ",", "9", ")", "\n", "\n", "plt", ".", "title", "(", "\"Mean Diffs (+/- 0.5s)\"", ")", "\n", "plt", ".", "xlabel", "(", "\"Time (s)\"", ")", "\n", "plt", ".", "plot", "(", "timestamps", ",", "diffs", ",", "color", "=", "\"blue\"", ")", "\n", "plt", ".", "plot", "(", "timestamps", ",", "thresh_mov", ",", "color", "=", "\"red\"", ",", "label", "=", "\"Movement Threshold\"", ")", "\n", "plt", ".", "plot", "(", "timestamps", ",", "thresh_nomov", ",", "color", "=", "\"green\"", ",", "label", "=", "\"No Movement Threshold\"", ")", "\n", "\n", "plt", ".", "suptitle", "(", "filename", ")", "\n", "plt", ".", "show", "(", ")", "\n", "\n"]]}