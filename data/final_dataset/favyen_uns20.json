{"home.repos.pwc.inspect_result.favyen_uns20.None.geom.Point.__init__": [[5, 8], ["int", "int"], "methods", ["None"], ["\t", "def", "__init__", "(", "self", ",", "x", ",", "y", ")", ":", "\n", "\t\t", "self", ".", "x", "=", "int", "(", "x", ")", "\n", "self", ".", "y", "=", "int", "(", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Point.distance": [[9, 13], ["math.sqrt"], "methods", ["None"], ["", "def", "distance", "(", "self", ",", "other", ")", ":", "\n", "\t\t", "dx", "=", "self", ".", "x", "-", "other", ".", "x", "\n", "dy", "=", "self", ".", "y", "-", "other", ".", "y", "\n", "return", "math", ".", "sqrt", "(", "dx", "*", "dx", "+", "dy", "*", "dy", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Point.sub": [[14, 16], ["geom.Point"], "methods", ["None"], ["", "def", "sub", "(", "self", ",", "other", ")", ":", "\n", "\t\t", "return", "Point", "(", "self", ".", "x", "-", "other", ".", "x", ",", "self", ".", "y", "-", "other", ".", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Point.add": [[17, 19], ["geom.Point"], "methods", ["None"], ["", "def", "add", "(", "self", ",", "other", ")", ":", "\n", "\t\t", "return", "Point", "(", "self", ".", "x", "+", "other", ".", "x", ",", "self", ".", "y", "+", "other", ".", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Point.scale": [[20, 22], ["geom.Point"], "methods", ["None"], ["", "def", "scale", "(", "self", ",", "f", ")", ":", "\n", "\t\t", "return", "Point", "(", "self", ".", "x", "*", "f", ",", "self", ".", "y", "*", "f", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Point.magnitude": [[23, 25], ["math.sqrt"], "methods", ["None"], ["", "def", "magnitude", "(", "self", ")", ":", "\n", "\t\t", "return", "math", ".", "sqrt", "(", "self", ".", "x", "*", "self", ".", "x", "+", "self", ".", "y", "*", "self", ".", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Point.angle_to": [[26, 36], ["math.acos", "other.magnitude", "abs", "geom.Point.magnitude", "other.magnitude", "geom.Point.magnitude", "abs"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.magnitude", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.magnitude", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.magnitude", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.magnitude"], ["", "def", "angle_to", "(", "self", ",", "other", ")", ":", "\n", "\t\t", "if", "self", ".", "magnitude", "(", ")", "==", "0", "or", "other", ".", "magnitude", "(", ")", "==", "0", ":", "\n", "\t\t\t", "return", "0", "\n", "", "s", "=", "(", "self", ".", "x", "*", "other", ".", "x", "+", "self", ".", "y", "*", "other", ".", "y", ")", "/", "self", ".", "magnitude", "(", ")", "/", "other", ".", "magnitude", "(", ")", "\n", "if", "abs", "(", "s", ")", ">", "1", ":", "s", "=", "s", "/", "abs", "(", "s", ")", "\n", "angle", "=", "math", ".", "acos", "(", "s", ")", "\n", "if", "angle", ">", "math", ".", "pi", ":", "\n", "\t\t\t", "return", "2", "*", "math", ".", "pi", "-", "angle", "\n", "", "else", ":", "\n", "\t\t\t", "return", "angle", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Point.signed_angle": [[37, 39], ["math.atan2", "math.atan2"], "methods", ["None"], ["", "", "def", "signed_angle", "(", "self", ",", "other", ")", ":", "\n", "\t\t", "return", "math", ".", "atan2", "(", "other", ".", "y", ",", "other", ".", "x", ")", "-", "math", ".", "atan2", "(", "self", ".", "y", ",", "self", ".", "x", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Point.bounds": [[40, 42], ["geom.Rectangle"], "methods", ["None"], ["", "def", "bounds", "(", "self", ")", ":", "\n", "\t\t", "return", "Rectangle", "(", "self", ",", "self", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Point.dot": [[43, 45], ["None"], "methods", ["None"], ["", "def", "dot", "(", "self", ",", "point", ")", ":", "\n", "\t\t", "return", "self", ".", "x", "*", "point", ".", "x", "+", "self", ".", "y", "*", "point", ".", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Point.rotate": [[46, 52], ["geom.Point", "math.cos", "math.sin", "math.sin", "math.cos", "int", "int"], "methods", ["None"], ["", "def", "rotate", "(", "self", ",", "center", ",", "angle", ")", ":", "\n", "\t\t", "dx", "=", "self", ".", "x", "-", "center", ".", "x", "\n", "dy", "=", "self", ".", "y", "-", "center", ".", "y", "\n", "rx", "=", "math", ".", "cos", "(", "angle", ")", "*", "dx", "-", "math", ".", "sin", "(", "angle", ")", "*", "dy", "\n", "ry", "=", "math", ".", "sin", "(", "angle", ")", "*", "dx", "+", "math", ".", "cos", "(", "angle", ")", "*", "dy", "\n", "return", "Point", "(", "center", ".", "x", "+", "int", "(", "rx", ")", ",", "center", ".", "y", "+", "int", "(", "ry", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Point.__repr__": [[53, 55], ["None"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "\t\t", "return", "'Point({}, {})'", ".", "format", "(", "self", ".", "x", ",", "self", ".", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Point.__eq__": [[56, 58], ["None"], "methods", ["None"], ["", "def", "__eq__", "(", "self", ",", "other", ")", ":", "\n", "\t\t", "return", "self", ".", "x", "==", "other", ".", "x", "and", "self", ".", "y", "==", "other", ".", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Point.__ne__": [[59, 61], ["geom.Point.__eq__"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.__eq__"], ["", "def", "__ne__", "(", "self", ",", "other", ")", ":", "\n", "\t\t", "return", "not", "self", ".", "__eq__", "(", "other", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Point.__hash__": [[62, 64], ["hash"], "methods", ["None"], ["", "def", "__hash__", "(", "self", ")", ":", "\n", "\t\t", "return", "hash", "(", "(", "self", ".", "x", ",", "self", ".", "y", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.__init__": [[66, 69], ["float", "float"], "methods", ["None"], ["\t", "def", "__init__", "(", "self", ",", "x", ",", "y", ")", ":", "\n", "\t\t", "self", ".", "x", "=", "float", "(", "x", ")", "\n", "self", ".", "y", "=", "float", "(", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.distance": [[70, 74], ["math.sqrt"], "methods", ["None"], ["", "def", "distance", "(", "self", ",", "other", ")", ":", "\n", "\t\t", "dx", "=", "self", ".", "x", "-", "other", ".", "x", "\n", "dy", "=", "self", ".", "y", "-", "other", ".", "y", "\n", "return", "math", ".", "sqrt", "(", "dx", "*", "dx", "+", "dy", "*", "dy", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.sub": [[75, 77], ["geom.FPoint"], "methods", ["None"], ["", "def", "sub", "(", "self", ",", "other", ")", ":", "\n", "\t\t", "return", "FPoint", "(", "self", ".", "x", "-", "other", ".", "x", ",", "self", ".", "y", "-", "other", ".", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.add": [[78, 80], ["geom.FPoint"], "methods", ["None"], ["", "def", "add", "(", "self", ",", "other", ")", ":", "\n", "\t\t", "return", "FPoint", "(", "self", ".", "x", "+", "other", ".", "x", ",", "self", ".", "y", "+", "other", ".", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.scale": [[81, 83], ["geom.FPoint"], "methods", ["None"], ["", "def", "scale", "(", "self", ",", "f", ")", ":", "\n", "\t\t", "return", "FPoint", "(", "self", ".", "x", "*", "f", ",", "self", ".", "y", "*", "f", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.scale_to_length": [[84, 86], ["geom.FPoint.scale", "geom.FPoint.magnitude"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.scale", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.magnitude"], ["", "def", "scale_to_length", "(", "self", ",", "l", ")", ":", "\n", "\t\t", "return", "self", ".", "scale", "(", "l", "/", "self", ".", "magnitude", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.magnitude": [[87, 89], ["math.sqrt"], "methods", ["None"], ["", "def", "magnitude", "(", "self", ")", ":", "\n", "\t\t", "return", "math", ".", "sqrt", "(", "self", ".", "x", "*", "self", ".", "x", "+", "self", ".", "y", "*", "self", ".", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.angle_to": [[90, 100], ["math.acos", "other.magnitude", "abs", "geom.FPoint.magnitude", "other.magnitude", "geom.FPoint.magnitude", "abs"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.magnitude", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.magnitude", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.magnitude", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.magnitude"], ["", "def", "angle_to", "(", "self", ",", "other", ")", ":", "\n", "\t\t", "if", "self", ".", "magnitude", "(", ")", "==", "0", "or", "other", ".", "magnitude", "(", ")", "==", "0", ":", "\n", "\t\t\t", "return", "0", "\n", "", "s", "=", "(", "self", ".", "x", "*", "other", ".", "x", "+", "self", ".", "y", "*", "other", ".", "y", ")", "/", "self", ".", "magnitude", "(", ")", "/", "other", ".", "magnitude", "(", ")", "\n", "if", "abs", "(", "s", ")", ">", "1", ":", "s", "=", "s", "/", "abs", "(", "s", ")", "\n", "angle", "=", "math", ".", "acos", "(", "s", ")", "\n", "if", "angle", ">", "math", ".", "pi", ":", "\n", "\t\t\t", "return", "2", "*", "math", ".", "pi", "-", "angle", "\n", "", "else", ":", "\n", "\t\t\t", "return", "angle", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.signed_angle": [[101, 103], ["math.atan2", "math.atan2"], "methods", ["None"], ["", "", "def", "signed_angle", "(", "self", ",", "other", ")", ":", "\n", "\t\t", "return", "math", ".", "atan2", "(", "other", ".", "y", ",", "other", ".", "x", ")", "-", "math", ".", "atan2", "(", "self", ".", "y", ",", "self", ".", "x", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.bounds": [[104, 106], ["geom.Rectangle"], "methods", ["None"], ["", "def", "bounds", "(", "self", ")", ":", "\n", "\t\t", "return", "Rectangle", "(", "self", ",", "self", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.dot": [[107, 109], ["None"], "methods", ["None"], ["", "def", "dot", "(", "self", ",", "point", ")", ":", "\n", "\t\t", "return", "self", ".", "x", "*", "point", ".", "x", "+", "self", ".", "y", "*", "point", ".", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.__repr__": [[110, 112], ["None"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "\t\t", "return", "'FPoint({}, {})'", ".", "format", "(", "self", ".", "x", ",", "self", ".", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.to_point": [[113, 115], ["geom.Point"], "methods", ["None"], ["", "def", "to_point", "(", "self", ")", ":", "\n", "\t\t", "return", "Point", "(", "self", ".", "x", ",", "self", ".", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.__eq__": [[116, 118], ["None"], "methods", ["None"], ["", "def", "__eq__", "(", "self", ",", "other", ")", ":", "\n", "\t\t", "return", "self", ".", "x", "==", "other", ".", "x", "and", "self", ".", "y", "==", "other", ".", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.__ne__": [[119, 121], ["geom.FPoint.__eq__"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.__eq__"], ["", "def", "__ne__", "(", "self", ",", "other", ")", ":", "\n", "\t\t", "return", "not", "self", ".", "__eq__", "(", "other", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.__hash__": [[122, 124], ["hash"], "methods", ["None"], ["", "def", "__hash__", "(", "self", ")", ":", "\n", "\t\t", "return", "hash", "(", "(", "self", ".", "x", ",", "self", ".", "y", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.__init__": [[126, 129], ["None"], "methods", ["None"], ["\t", "def", "__init__", "(", "self", ",", "start", ",", "end", ")", ":", "\n", "\t\t", "self", ".", "start", "=", "start", "\n", "self", ".", "end", "=", "end", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.length": [[130, 132], ["geom.Segment.start.distance"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.distance"], ["", "def", "length", "(", "self", ")", ":", "\n", "\t\t", "return", "self", ".", "start", ".", "distance", "(", "self", ".", "end", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.project_factor": [[133, 141], ["geom.Segment.length", "point.sub().dot", "max", "geom.Segment.end.sub", "min", "point.sub"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.length", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.dot", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.sub", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.sub"], ["", "def", "project_factor", "(", "self", ",", "point", ",", "line", "=", "False", ")", ":", "\n", "\t\t", "l", "=", "self", ".", "length", "(", ")", "\n", "if", "l", "==", "0", ":", "\n", "\t\t\t", "return", "0", "\n", "", "t", "=", "point", ".", "sub", "(", "self", ".", "start", ")", ".", "dot", "(", "self", ".", "end", ".", "sub", "(", "self", ".", "start", ")", ")", "/", "l", "\n", "if", "not", "line", ":", "\n", "\t\t\t", "t", "=", "max", "(", "0", ",", "min", "(", "l", ",", "t", ")", ")", "\n", "", "return", "t", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.project": [[142, 145], ["geom.Segment.project_factor", "geom.Segment.point_at_factor"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.project_factor", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.point_at_factor"], ["", "def", "project", "(", "self", ",", "point", ",", "line", "=", "False", ")", ":", "\n", "\t\t", "t", "=", "self", ".", "project_factor", "(", "point", ",", "line", "=", "line", ")", "\n", "return", "self", ".", "point_at_factor", "(", "t", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.point_at_factor": [[146, 151], ["geom.Segment.length", "geom.Segment.start.add", "geom.Segment.end.sub().scale", "geom.Segment.end.sub"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.length", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.add", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.scale", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.sub"], ["", "def", "point_at_factor", "(", "self", ",", "t", ")", ":", "\n", "\t\t", "l", "=", "self", ".", "length", "(", ")", "\n", "if", "l", "==", "0", ":", "\n", "\t\t\t", "return", "self", ".", "start", "\n", "", "return", "self", ".", "start", ".", "add", "(", "self", ".", "end", ".", "sub", "(", "self", ".", "start", ")", ".", "scale", "(", "t", "/", "l", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.distance": [[152, 155], ["geom.Segment.project", "geom.Segment.distance"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.project", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.distance"], ["", "def", "distance", "(", "self", ",", "point", ",", "line", "=", "False", ")", ":", "\n", "\t\t", "p", "=", "self", ".", "project", "(", "point", ",", "line", "=", "line", ")", "\n", "return", "p", ".", "distance", "(", "point", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.intersection": [[156, 176], ["geom.Segment.vector", "other.vector", "other.start.sub", "geom.Segment.point_at_factor", "geom.Segment.length", "float", "float", "float", "float", "float"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.vector", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.vector", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.sub", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.point_at_factor", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.length"], ["", "def", "intersection", "(", "self", ",", "other", ")", ":", "\n", "\t\t", "d1", "=", "self", ".", "vector", "(", ")", "\n", "d2", "=", "other", ".", "vector", "(", ")", "\n", "d12", "=", "other", ".", "start", ".", "sub", "(", "self", ".", "start", ")", "\n", "\n", "den", "=", "d1", ".", "y", "*", "d2", ".", "x", "-", "d1", ".", "x", "*", "d2", ".", "y", "\n", "u1", "=", "d1", ".", "x", "*", "d12", ".", "y", "-", "d1", ".", "y", "*", "d12", ".", "x", "\n", "u2", "=", "d2", ".", "x", "*", "d12", ".", "y", "-", "d2", ".", "y", "*", "d12", ".", "x", "\n", "\n", "if", "den", "==", "0", ":", "\n", "# collinear", "\n", "\t\t\t", "if", "u1", "==", "0", "and", "u2", "==", "0", ":", "\n", "\t\t\t\t", "return", "self", ".", "start", "\n", "", "else", ":", "\n", "\t\t\t\t", "return", "None", "\n", "\n", "", "", "if", "float", "(", "u1", ")", "/", "den", "<", "0", "or", "float", "(", "u1", ")", "/", "den", ">", "1", "or", "float", "(", "u2", ")", "/", "den", "<", "0", "or", "float", "(", "u2", ")", "/", "den", ">", "1", ":", "\n", "\t\t\t", "return", "None", "\n", "\n", "", "return", "self", ".", "point_at_factor", "(", "float", "(", "u2", ")", "/", "den", "*", "self", ".", "length", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.vector": [[177, 179], ["geom.Segment.end.sub"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.sub"], ["", "def", "vector", "(", "self", ")", ":", "\n", "\t\t", "return", "self", ".", "end", ".", "sub", "(", "self", ".", "start", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.bounds": [[180, 182], ["geom.Segment.start.bounds().extend", "geom.Segment.start.bounds"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.extend", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.bounds"], ["", "def", "bounds", "(", "self", ")", ":", "\n", "\t\t", "return", "self", ".", "start", ".", "bounds", "(", ")", ".", "extend", "(", "self", ".", "end", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.extend": [[183, 189], ["geom.Segment.vector", "v.scale.scale.scale", "geom.Segment", "geom.Segment.start.sub", "geom.Segment.end.add", "v.scale.scale.magnitude"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.vector", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.scale", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.sub", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.add", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.magnitude"], ["", "def", "extend", "(", "self", ",", "amount", ")", ":", "\n", "\t\t", "v", "=", "self", ".", "vector", "(", ")", "\n", "v", "=", "v", ".", "scale", "(", "amount", "/", "v", ".", "magnitude", "(", ")", ")", "\n", "return", "Segment", "(", "\n", "self", ".", "start", ".", "sub", "(", "v", ")", ",", "\n", "self", ".", "end", ".", "add", "(", "v", ")", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Segment.__repr__": [[191, 193], ["None"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "\t\t", "return", "'Segment({}, {})'", ".", "format", "(", "self", ".", "start", ",", "self", ".", "end", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.__init__": [[195, 198], ["None"], "methods", ["None"], ["\t", "def", "__init__", "(", "self", ",", "start", ",", "end", ")", ":", "\n", "\t\t", "self", ".", "start", "=", "start", "\n", "self", ".", "end", "=", "end", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.lengths": [[199, 201], ["geom.Point"], "methods", ["None"], ["", "def", "lengths", "(", "self", ")", ":", "\n", "\t\t", "return", "Point", "(", "self", ".", "end", ".", "x", "-", "self", ".", "start", ".", "x", ",", "self", ".", "end", ".", "y", "-", "self", ".", "start", ".", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.clip": [[202, 213], ["geom.Point"], "methods", ["None"], ["", "def", "clip", "(", "self", ",", "point", ")", ":", "\n", "\t\t", "npoint", "=", "Point", "(", "point", ".", "x", ",", "point", ".", "y", ")", "\n", "if", "npoint", ".", "x", "<", "self", ".", "start", ".", "x", ":", "\n", "\t\t\t", "npoint", ".", "x", "=", "self", ".", "start", ".", "x", "\n", "", "elif", "npoint", ".", "x", ">=", "self", ".", "end", ".", "x", ":", "\n", "\t\t\t", "npoint", ".", "x", "=", "self", ".", "end", ".", "x", "-", "1", "\n", "", "if", "npoint", ".", "y", "<", "self", ".", "start", ".", "y", ":", "\n", "\t\t\t", "npoint", ".", "y", "=", "self", ".", "start", ".", "y", "\n", "", "elif", "npoint", ".", "y", ">=", "self", ".", "end", ".", "y", ":", "\n", "\t\t\t", "npoint", ".", "y", "=", "self", ".", "end", ".", "y", "-", "1", "\n", "", "return", "npoint", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.clip_rect": [[214, 216], ["geom.Rectangle", "geom.Rectangle.clip", "geom.Rectangle.clip"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.clip", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.clip"], ["", "def", "clip_rect", "(", "self", ",", "r", ")", ":", "\n", "\t\t", "return", "Rectangle", "(", "self", ".", "clip", "(", "r", ".", "start", ")", ",", "self", ".", "clip", "(", "r", ".", "end", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.add_tol": [[217, 221], ["geom.Rectangle", "geom.Rectangle.start.sub", "geom.Rectangle.end.add", "geom.Point", "geom.Point"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.sub", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.add"], ["", "def", "add_tol", "(", "self", ",", "tol", ")", ":", "\n", "\t\t", "return", "Rectangle", "(", "\n", "self", ".", "start", ".", "sub", "(", "Point", "(", "tol", ",", "tol", ")", ")", ",", "\n", "self", ".", "end", ".", "add", "(", "Point", "(", "tol", ",", "tol", ")", ")", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.contains": [[223, 225], ["None"], "methods", ["None"], ["", "def", "contains", "(", "self", ",", "point", ")", ":", "\n", "\t\t", "return", "point", ".", "x", ">=", "self", ".", "start", ".", "x", "and", "point", ".", "x", "<", "self", ".", "end", ".", "x", "and", "point", ".", "y", ">=", "self", ".", "start", ".", "y", "and", "point", ".", "y", "<", "self", ".", "end", ".", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.extend": [[226, 230], ["geom.Rectangle", "geom.Point", "geom.Point", "min", "min", "max", "max"], "methods", ["None"], ["", "def", "extend", "(", "self", ",", "point", ")", ":", "\n", "\t\t", "return", "Rectangle", "(", "\n", "Point", "(", "min", "(", "self", ".", "start", ".", "x", ",", "point", ".", "x", ")", ",", "min", "(", "self", ".", "start", ".", "y", ",", "point", ".", "y", ")", ")", ",", "\n", "Point", "(", "max", "(", "self", ".", "end", ".", "x", ",", "point", ".", "x", ")", ",", "max", "(", "self", ".", "end", ".", "y", ",", "point", ".", "y", ")", ")", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.extend_rect": [[232, 236], ["geom.Rectangle", "geom.Point", "geom.Point", "min", "min", "max", "max"], "methods", ["None"], ["", "def", "extend_rect", "(", "self", ",", "rect", ")", ":", "\n", "\t\t", "return", "Rectangle", "(", "\n", "Point", "(", "min", "(", "self", ".", "start", ".", "x", ",", "rect", ".", "start", ".", "x", ")", ",", "min", "(", "self", ".", "start", ".", "y", ",", "rect", ".", "start", ".", "y", ")", ")", ",", "\n", "Point", "(", "max", "(", "self", ".", "end", ".", "x", ",", "rect", ".", "end", ".", "x", ")", ",", "max", "(", "self", ".", "end", ".", "y", ",", "rect", ".", "end", ".", "y", ")", ")", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.intersects": [[238, 240], ["None"], "methods", ["None"], ["", "def", "intersects", "(", "self", ",", "other", ")", ":", "\n", "\t\t", "return", "self", ".", "end", ".", "y", ">=", "other", ".", "start", ".", "y", "and", "other", ".", "end", ".", "y", ">=", "self", ".", "start", ".", "y", "and", "self", ".", "end", ".", "x", ">=", "other", ".", "start", ".", "x", "and", "other", ".", "end", ".", "x", ">=", "self", ".", "start", ".", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.scale": [[241, 243], ["geom.Rectangle", "geom.Rectangle.start.scale", "geom.Rectangle.end.scale"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.scale", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.scale"], ["", "def", "scale", "(", "self", ",", "f", ")", ":", "\n", "\t\t", "return", "Rectangle", "(", "self", ".", "start", ".", "scale", "(", "f", ")", ",", "self", ".", "end", ".", "scale", "(", "f", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.intersection": [[244, 254], ["geom.Rectangle", "geom.Point", "geom.Point", "max", "max", "min", "min"], "methods", ["None"], ["", "def", "intersection", "(", "self", ",", "other", ")", ":", "\n", "\t\t", "intersection", "=", "Rectangle", "(", "\n", "Point", "(", "max", "(", "self", ".", "start", ".", "x", ",", "other", ".", "start", ".", "x", ")", ",", "max", "(", "self", ".", "start", ".", "y", ",", "other", ".", "start", ".", "y", ")", ")", ",", "\n", "Point", "(", "min", "(", "self", ".", "end", ".", "x", ",", "other", ".", "end", ".", "x", ")", ",", "min", "(", "self", ".", "end", ".", "y", ",", "other", ".", "end", ".", "y", ")", ")", "\n", ")", "\n", "if", "intersection", ".", "end", ".", "x", "<=", "intersection", ".", "start", ".", "x", ":", "\n", "\t\t\t", "intersection", ".", "end", ".", "x", "=", "intersection", ".", "start", ".", "x", "\n", "", "if", "intersection", ".", "end", ".", "y", "<=", "intersection", ".", "start", ".", "y", ":", "\n", "\t\t\t", "intersection", ".", "end", ".", "y", "=", "intersection", ".", "start", ".", "y", "\n", "", "return", "intersection", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.area": [[255, 257], ["None"], "methods", ["None"], ["", "def", "area", "(", "self", ")", ":", "\n", "\t\t", "return", "(", "self", ".", "end", ".", "x", "-", "self", ".", "start", ".", "x", ")", "*", "(", "self", ".", "end", ".", "y", "-", "self", ".", "start", ".", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.iou": [[258, 263], ["geom.Rectangle.intersection().area", "float", "geom.Rectangle.intersection", "geom.Rectangle.area", "other.area"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.area", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.intersection", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.area", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.area"], ["", "def", "iou", "(", "self", ",", "other", ")", ":", "\n", "\t\t", "intersect_area", "=", "self", ".", "intersection", "(", "other", ")", ".", "area", "(", ")", "\n", "if", "intersect_area", "==", "0", ":", "\n", "\t\t\t", "return", "0", "\n", "", "return", "float", "(", "intersect_area", ")", "/", "(", "self", ".", "area", "(", ")", "+", "other", ".", "area", "(", ")", "-", "intersect_area", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.__repr__": [[264, 266], ["None"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "\t\t", "return", "'Rectangle({}, {})'", ".", "format", "(", "self", ".", "start", ",", "self", ".", "end", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.draw_line": [[267, 315], ["geom.Point", "abs", "abs", "abs", "abs", "points.append", "geom.draw_line.add_point"], "function", ["None"], ["", "", "def", "draw_line", "(", "start", ",", "end", ",", "lengths", ")", ":", "\n", "# followX indicates whether to move along x or y coordinates", "\n", "\t", "followX", "=", "abs", "(", "end", ".", "y", "-", "start", ".", "y", ")", "<=", "abs", "(", "end", ".", "x", "-", "start", ".", "x", ")", "\n", "if", "followX", ":", "\n", "\t\t", "x0", "=", "start", ".", "x", "\n", "x1", "=", "end", ".", "x", "\n", "y0", "=", "start", ".", "y", "\n", "y1", "=", "end", ".", "y", "\n", "", "else", ":", "\n", "\t\t", "x0", "=", "start", ".", "y", "\n", "x1", "=", "end", ".", "y", "\n", "y0", "=", "start", ".", "x", "\n", "y1", "=", "end", ".", "x", "\n", "\n", "", "delta", "=", "Point", "(", "abs", "(", "x1", "-", "x0", ")", ",", "abs", "(", "y1", "-", "y0", ")", ")", "\n", "current_error", "=", "0", "\n", "\n", "if", "x0", "<", "x1", ":", "\n", "\t\t", "xstep", "=", "1", "\n", "", "else", ":", "\n", "\t\t", "xstep", "=", "-", "1", "\n", "\n", "", "if", "y0", "<", "y1", ":", "\n", "\t\t", "ystep", "=", "1", "\n", "", "else", ":", "\n", "\t\t", "ystep", "=", "-", "1", "\n", "\n", "", "points", "=", "[", "]", "\n", "def", "add_point", "(", "p", ")", ":", "\n", "\t\t", "if", "p", ".", "x", ">=", "0", "and", "p", ".", "x", "<", "lengths", ".", "x", "and", "p", ".", "y", ">=", "0", "and", "p", ".", "y", "<", "lengths", ".", "y", ":", "\n", "\t\t\t", "points", ".", "append", "(", "p", ")", "\n", "\n", "", "", "x", "=", "x0", "\n", "y", "=", "y0", "\n", "\n", "while", "x", "!=", "x1", "+", "xstep", ":", "\n", "\t\t", "if", "followX", ":", "\n", "\t\t\t", "add_point", "(", "Point", "(", "x", ",", "y", ")", ")", "\n", "", "else", ":", "\n", "\t\t\t", "add_point", "(", "Point", "(", "y", ",", "x", ")", ")", "\n", "\n", "", "x", "+=", "xstep", "\n", "current_error", "+=", "delta", ".", "y", "\n", "if", "current_error", ">=", "delta", ".", "x", ":", "\n", "\t\t\t", "y", "+=", "ystep", "\n", "current_error", "-=", "delta", ".", "x", "\n", "\n", "", "", "return", "points", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.draw_lines": [[316, 333], ["numpy.zeros", "numpy.zeros", "enumerate", "bres_segments_count", "numpy.logical_or", "Exception", "len"], "function", ["None"], ["", "def", "draw_lines", "(", "segments", ",", "im", "=", "None", ",", "shape", "=", "None", ")", ":", "\n", "\t", "from", "eyediagram", ".", "_brescount", "import", "bres_segments_count", "\n", "if", "not", "shape", ":", "\n", "\t\t", "if", "not", "im", ":", "\n", "\t\t\t", "raise", "Exception", "(", "'shape or im must be provided'", ")", "\n", "", "shape", "=", "im", ".", "shape", "\n", "", "tmpim", "=", "numpy", ".", "zeros", "(", "(", "shape", "[", "0", "]", ",", "shape", "[", "1", "]", ")", ",", "dtype", "=", "'int32'", ")", "\n", "\n", "sticks", "=", "numpy", ".", "zeros", "(", "(", "len", "(", "segments", ")", ",", "4", ")", ",", "dtype", "=", "'int32'", ")", "\n", "for", "i", ",", "segment", "in", "enumerate", "(", "segments", ")", ":", "\n", "\t\t", "sticks", "[", "i", "]", "=", "[", "segment", ".", "start", ".", "x", ",", "segment", ".", "start", ".", "y", ",", "segment", ".", "end", ".", "x", ",", "segment", ".", "end", ".", "y", "]", "\n", "", "bres_segments_count", "(", "sticks", ",", "tmpim", ")", "\n", "tmpim", "=", "tmpim", ">", "0", "\n", "if", "im", ":", "\n", "\t\t", "return", "numpy", ".", "logical_or", "(", "im", ",", "tmpim", ")", "\n", "", "else", ":", "\n", "\t\t", "return", "tmpim", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.geom.vector_from_angle": [[334, 336], ["geom.Point", "math.cos", "math.sin"], "function", ["None"], ["", "", "def", "vector_from_angle", "(", "angle", ",", "length", ")", ":", "\n", "\t", "return", "Point", "(", "math", ".", "cos", "(", "angle", ")", "*", "length", ",", "math", ".", "sin", "(", "angle", ")", "*", "length", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.favyen_uns20.None.train.get_frame_fname": [[55, 60], ["str", "len"], "function", ["None"], ["def", "get_frame_fname", "(", "frame_idx", ")", ":", "\n", "\t", "s", "=", "str", "(", "frame_idx", ")", "\n", "while", "len", "(", "s", ")", "<", "6", ":", "\n", "\t\t", "s", "=", "'0'", "+", "s", "\n", "", "return", "s", "+", "'.jpg'", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.train.get_loc": [[61, 67], ["float", "float"], "function", ["None"], ["", "def", "get_loc", "(", "detection", ")", ":", "\n", "\t", "cx", "=", "(", "detection", "[", "'left'", "]", "+", "detection", "[", "'right'", "]", ")", "/", "2", "\n", "cy", "=", "(", "detection", "[", "'top'", "]", "+", "detection", "[", "'bottom'", "]", ")", "/", "2", "\n", "cx", "=", "float", "(", "cx", ")", "/", "ORIG_WIDTH", "\n", "cy", "=", "float", "(", "cy", ")", "/", "ORIG_HEIGHT", "\n", "return", "cx", ",", "cy", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.train.to_rect": [[68, 72], ["geom.Rectangle", "geom.Point", "geom.Point"], "function", ["None"], ["", "def", "to_rect", "(", "detection", ")", ":", "\n", "\t", "return", "geom", ".", "Rectangle", "(", "\n", "geom", ".", "Point", "(", "detection", "[", "'left'", "]", ",", "detection", "[", "'top'", "]", ")", ",", "\n", "geom", ".", "Point", "(", "detection", "[", "'right'", "]", ",", "detection", "[", "'bottom'", "]", ")", ",", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.train.get_stuff": [[74, 117], ["enumerate", "enumerate", "numpy.zeros", "enumerate", "train.get_stuff.per_info"], "function", ["None"], ["", "def", "get_stuff", "(", "infos", ",", "matches", ")", ":", "\n", "\t", "def", "per_info", "(", "info", ")", ":", "\n", "\t\t", "images", "=", "[", "]", "\n", "boxes", "=", "numpy", ".", "zeros", "(", "(", "len", "(", "info", ")", ",", "4", ")", ",", "dtype", "=", "'float32'", ")", "\n", "for", "i", ",", "(", "detection", ",", "crop", ",", "_", ")", "in", "enumerate", "(", "info", ")", ":", "\n", "\t\t\t", "images", ".", "append", "(", "crop", ")", "\n", "cx", ",", "cy", "=", "get_loc", "(", "detection", ")", "\n", "boxes", "[", "i", ",", ":", "]", "=", "[", "cx", ",", "cy", ",", "detection", "[", "'width'", "]", ",", "detection", "[", "'height'", "]", "]", "\n", "", "detections", "=", "[", "get_loc", "(", "detection", ")", "for", "detection", ",", "_", ",", "_", "in", "info", "]", "\n", "return", "images", ",", "boxes", ",", "detections", ",", "len", "(", "info", ")", "\n", "\n", "", "all_images", "=", "[", "]", "\n", "all_boxes", "=", "[", "]", "\n", "all_detections", "=", "[", "]", "\n", "all_counts", "=", "[", "]", "\n", "for", "i", ",", "info", "in", "enumerate", "(", "infos", ")", ":", "\n", "\t\t", "images", ",", "boxes", ",", "detections", ",", "count", "=", "per_info", "(", "info", ")", "\n", "all_images", ".", "append", "(", "images", ")", "\n", "all_boxes", ".", "append", "(", "boxes", ")", "\n", "all_detections", ".", "append", "(", "detections", ")", "\n", "all_counts", ".", "append", "(", "count", ")", "\n", "\n", "", "all_masks", "=", "[", "]", "\n", "for", "i", ",", "match_len", "in", "enumerate", "(", "MATCH_LENGTHS", ")", ":", "\n", "\t\t", "last_idx", "=", "match_len", "\n", "mask", "=", "numpy", ".", "zeros", "(", "(", "len", "(", "infos", "[", "0", "]", ")", ",", "len", "(", "infos", "[", "last_idx", "]", ")", "+", "1", ")", ",", "dtype", "=", "'float32'", ")", "\n", "mask", "[", ":", ",", "len", "(", "infos", "[", "last_idx", "]", ")", "]", "=", "1", "\n", "first_map", "=", "{", "}", "\n", "for", "j", ",", "(", "_", ",", "_", ",", "orig_idx", ")", "in", "enumerate", "(", "infos", "[", "0", "]", ")", ":", "\n", "\t\t\t", "first_map", "[", "orig_idx", "]", "=", "j", "\n", "", "last_map", "=", "{", "}", "\n", "for", "j", ",", "(", "_", ",", "_", ",", "orig_idx", ")", "in", "enumerate", "(", "infos", "[", "last_idx", "]", ")", ":", "\n", "\t\t\t", "last_map", "[", "orig_idx", "]", "=", "j", "\n", "", "for", "left_idx", "in", "matches", "[", "i", "]", ":", "\n", "\t\t\t", "if", "left_idx", "not", "in", "first_map", ":", "\n", "\t\t\t\t", "continue", "\n", "", "for", "right_idx", "in", "matches", "[", "i", "]", "[", "left_idx", "]", ":", "\n", "\t\t\t\t", "if", "right_idx", "not", "in", "last_map", ":", "\n", "\t\t\t\t\t", "continue", "\n", "", "mask", "[", "first_map", "[", "left_idx", "]", ",", "last_map", "[", "right_idx", "]", "]", "=", "1", "\n", "", "", "all_masks", ".", "append", "(", "mask", ".", "flatten", "(", ")", ")", "\n", "\n", "", "return", "all_images", ",", "all_boxes", ",", "all_detections", ",", "all_counts", ",", "all_masks", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.train.get_random_info": [[149, 160], ["sum", "len", "numpy.random.choice", "random.choice", "all_frame_data.keys", "float", "float", "list", "len", "frame_infos.keys"], "function", ["None"], ["def", "get_random_info", "(", "exclude_label", ")", ":", "\n", "\t", "labels", "=", "[", "label", "for", "label", "in", "all_frame_data", ".", "keys", "(", ")", "if", "label", "!=", "exclude_label", "]", "\n", "weights", "=", "[", "len", "(", "all_frame_data", "[", "label", "]", "[", "0", "]", ")", "for", "label", "in", "labels", "]", "\n", "weight_sum", "=", "sum", "(", "weights", ")", "\n", "weights", "=", "[", "float", "(", "x", ")", "/", "float", "(", "weight_sum", ")", "for", "x", "in", "weights", "]", "\n", "while", "True", ":", "\n", "\t\t", "label", "=", "numpy", ".", "random", ".", "choice", "(", "labels", ",", "p", "=", "weights", ")", "\n", "frame_infos", "=", "all_frame_data", "[", "label", "]", "[", "0", "]", "\n", "frame_idx", "=", "random", ".", "choice", "(", "list", "(", "frame_infos", ".", "keys", "(", ")", ")", ")", "\n", "if", "len", "(", "frame_infos", "[", "frame_idx", "]", ")", ">", "4", ":", "\n", "\t\t\t", "return", "frame_infos", "[", "frame_idx", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.train.train": [[201, 281], ["print", "range", "time.time", "range", "numpy.mean", "time.time", "range", "numpy.mean", "time.time", "print", "random.sample", "enumerate", "numpy.concatenate", "train_losses.append", "len", "numpy.concatenate", "val_losses.append", "m.saver.save", "max", "random.choice", "batch.append", "counts[].append", "session.run", "session.run", "int", "int", "range", "len", "counts[].append", "session.run", "session.run", "MATCH_LENGTHS.index", "len"], "function", ["None"], ["def", "train", "(", "learning_rate", ",", "num_epochs", ")", ":", "\n", "\t", "global", "best_loss", "\n", "\n", "print", "(", "'training mode={} at lr={} for {} epochs'", ".", "format", "(", "MODE", ",", "learning_rate", ",", "num_epochs", ")", ")", "\n", "for", "epoch", "in", "range", "(", "num_epochs", ")", ":", "\n", "\t\t", "start_time", "=", "time", ".", "time", "(", ")", "\n", "train_losses", "=", "[", "]", "\n", "for", "_", "in", "range", "(", "2048", "//", "model", ".", "BATCH_SIZE", ")", ":", "\n", "\t\t\t", "if", "MODE", "==", "'imsp-finesp'", ":", "\n", "\t\t\t\t", "match_len", "=", "max", "(", "MATCH_LENGTHS", ")", "\n", "", "else", ":", "\n", "\t\t\t\t", "match_len", "=", "random", ".", "choice", "(", "MATCH_LENGTHS", ")", "\n", "\n", "", "batch", "=", "[", "]", "\n", "for", "example", "in", "random", ".", "sample", "(", "train_examples", ",", "model", ".", "BATCH_SIZE", ")", ":", "\n", "\t\t\t\t", "imlists", "=", "example", "[", "0", "]", "[", "0", ":", "match_len", "+", "1", "]", "+", "[", "example", "[", "0", "]", "[", "model", ".", "SEQ_LEN", "]", "]", "\n", "boxlists", "=", "example", "[", "1", "]", "[", "0", ":", "match_len", "+", "1", "]", "+", "[", "example", "[", "1", "]", "[", "model", ".", "SEQ_LEN", "]", "]", "\n", "counts", "=", "example", "[", "2", "]", "[", "0", ":", "match_len", "+", "1", "]", "+", "[", "example", "[", "2", "]", "[", "model", ".", "SEQ_LEN", "]", "]", "\n", "mask", "=", "example", "[", "3", "]", "[", "MATCH_LENGTHS", ".", "index", "(", "match_len", ")", "]", "\n", "batch", ".", "append", "(", "(", "imlists", ",", "boxlists", ",", "counts", ",", "mask", ")", ")", "\n", "\n", "", "imlists", "=", "[", "imlist", "for", "example", "in", "batch", "for", "imlist", "in", "example", "[", "0", "]", "]", "\n", "boxlists", "=", "[", "boxlist", "for", "example", "in", "batch", "for", "boxlist", "in", "example", "[", "1", "]", "]", "\n", "counts", "=", "[", "[", "]", "for", "_", "in", "range", "(", "len", "(", "batch", ")", ")", "]", "\n", "for", "i", ",", "example", "in", "enumerate", "(", "batch", ")", ":", "\n", "\t\t\t\t", "counts", "[", "i", "]", "=", "example", "[", "2", "]", "[", "0", ":", "match_len", "+", "1", "]", "\n", "while", "len", "(", "counts", "[", "i", "]", ")", "<", "model", ".", "SEQ_LEN", ":", "\n", "\t\t\t\t\t", "counts", "[", "i", "]", ".", "append", "(", "0", ")", "\n", "", "counts", "[", "i", "]", ".", "append", "(", "example", "[", "2", "]", "[", "-", "1", "]", ")", "\n", "\n", "", "images", "=", "[", "im", "for", "imlist", "in", "imlists", "for", "im", "in", "imlist", "]", "\n", "boxes", "=", "[", "box", "for", "boxlist", "in", "boxlists", "for", "box", "in", "boxlist", "]", "\n", "\n", "masks", "=", "numpy", ".", "concatenate", "(", "[", "example", "[", "3", "]", "for", "example", "in", "batch", "]", ",", "axis", "=", "0", ")", "\n", "feed_dict", "=", "{", "\n", "m", ".", "raw_images", ":", "images", ",", "\n", "m", ".", "input_boxes", ":", "boxes", ",", "\n", "m", ".", "n_image", ":", "counts", ",", "\n", "m", ".", "input_masks", ":", "masks", ",", "\n", "m", ".", "match_length", ":", "match_len", ",", "\n", "m", ".", "is_training", ":", "True", ",", "\n", "m", ".", "learning_rate", ":", "learning_rate", ",", "\n", "}", "\n", "if", "MODE", "==", "'imsp-longim'", ":", "\n", "\t\t\t\t", "_", ",", "loss", "=", "session", ".", "run", "(", "[", "m", ".", "longim_optimizer", ",", "m", ".", "longim_loss", "]", ",", "feed_dict", "=", "feed_dict", ")", "\n", "", "elif", "MODE", "==", "'imsp-finesp'", ":", "\n", "\t\t\t\t", "_", ",", "loss", "=", "session", ".", "run", "(", "[", "m", ".", "finesp_optimizer", ",", "m", ".", "finesp_loss", "]", ",", "feed_dict", "=", "feed_dict", ")", "\n", "", "train_losses", ".", "append", "(", "loss", ")", "\n", "", "train_loss", "=", "numpy", ".", "mean", "(", "train_losses", ")", "\n", "train_time", "=", "time", ".", "time", "(", ")", "\n", "\n", "val_losses", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "0", ",", "len", "(", "val_examples", ")", ",", "model", ".", "BATCH_SIZE", ")", ":", "\n", "\t\t\t", "batch", "=", "val_examples", "[", "i", ":", "i", "+", "model", ".", "BATCH_SIZE", "]", "\n", "images", "=", "[", "im", "for", "example", "in", "batch", "for", "imlist", "in", "example", "[", "0", "]", "for", "im", "in", "imlist", "]", "\n", "boxes", "=", "[", "box", "for", "example", "in", "batch", "for", "boxlist", "in", "example", "[", "1", "]", "for", "box", "in", "boxlist", "]", "\n", "counts", "=", "[", "example", "[", "2", "]", "for", "example", "in", "batch", "]", "\n", "masks", "=", "numpy", ".", "concatenate", "(", "[", "example", "[", "3", "]", "[", "-", "1", "]", "for", "example", "in", "batch", "]", ",", "axis", "=", "0", ")", "\n", "feed_dict", "=", "{", "\n", "m", ".", "raw_images", ":", "images", ",", "\n", "m", ".", "input_boxes", ":", "boxes", ",", "\n", "m", ".", "n_image", ":", "counts", ",", "\n", "m", ".", "input_masks", ":", "masks", ",", "\n", "m", ".", "match_length", ":", "model", ".", "SEQ_LEN", "-", "1", ",", "\n", "m", ".", "is_training", ":", "False", ",", "\n", "}", "\n", "if", "MODE", "==", "'imsp-longim'", ":", "\n", "\t\t\t\t", "loss", "=", "session", ".", "run", "(", "m", ".", "longim_loss", ",", "feed_dict", "=", "feed_dict", ")", "\n", "", "elif", "MODE", "==", "'imsp-finesp'", ":", "\n", "\t\t\t\t", "loss", "=", "session", ".", "run", "(", "m", ".", "finesp_loss", ",", "feed_dict", "=", "feed_dict", ")", "\n", "", "val_losses", ".", "append", "(", "loss", ")", "\n", "\n", "", "val_loss", "=", "numpy", ".", "mean", "(", "val_losses", ")", "\n", "val_time", "=", "time", ".", "time", "(", ")", "\n", "\n", "print", "(", "'iteration {}: train_time={}, val_time={}, train_loss={}, val_loss={}/{}'", ".", "format", "(", "epoch", ",", "int", "(", "train_time", "-", "start_time", ")", ",", "int", "(", "val_time", "-", "train_time", ")", ",", "train_loss", ",", "val_loss", ",", "best_loss", ")", ")", "\n", "\n", "if", "best_loss", "is", "None", "or", "val_loss", "<", "best_loss", ":", "\n", "\t\t\t", "best_loss", "=", "val_loss", "\n", "m", ".", "saver", ".", "save", "(", "session", ",", "model_path", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.infer.get_frame_fname": [[43, 48], ["str", "len"], "function", ["None"], ["def", "get_frame_fname", "(", "frame_idx", ")", ":", "\n", "\t", "s", "=", "str", "(", "frame_idx", ")", "\n", "while", "len", "(", "s", ")", "<", "6", ":", "\n", "\t\t", "s", "=", "'0'", "+", "s", "\n", "", "return", "s", "+", "'.jpg'", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.model.Model._conv_layer": [[14, 74], ["options.get", "options.get", "options.get", "options.get", "options.get", "tensorflow.variable_scope", "tensorflow.get_variable", "tensorflow.get_variable", "tensorflow.nn.bias_add", "tensorflow.nn.bias_add", "tensorflow.contrib.layers.batch_norm", "tensorflow.nn.dropout", "tensorflow.nn.relu", "tensorflow.truncated_normal_initializer", "tensorflow.constant_initializer", "tensorflow.nn.conv2d", "tensorflow.shape", "tensorflow.shape", "tensorflow.nn.conv2d_transpose", "tensorflow.nn.sigmoid", "Exception", "math.sqrt"], "methods", ["None"], ["\t", "def", "_conv_layer", "(", "self", ",", "name", ",", "input_var", ",", "stride", ",", "in_channels", ",", "out_channels", ",", "options", "=", "{", "}", ")", ":", "\n", "\t\t", "activation", "=", "options", ".", "get", "(", "'activation'", ",", "'relu'", ")", "\n", "dropout", "=", "options", ".", "get", "(", "'dropout'", ",", "None", ")", "\n", "padding", "=", "options", ".", "get", "(", "'padding'", ",", "'SAME'", ")", "\n", "batchnorm", "=", "options", ".", "get", "(", "'batchnorm'", ",", "False", ")", "\n", "transpose", "=", "options", ".", "get", "(", "'transpose'", ",", "False", ")", "\n", "\n", "with", "tf", ".", "variable_scope", "(", "name", ")", "as", "scope", ":", "\n", "\t\t\t", "if", "not", "transpose", ":", "\n", "\t\t\t\t", "filter_shape", "=", "[", "KERNEL_SIZE", ",", "KERNEL_SIZE", ",", "in_channels", ",", "out_channels", "]", "\n", "", "else", ":", "\n", "\t\t\t\t", "filter_shape", "=", "[", "KERNEL_SIZE", ",", "KERNEL_SIZE", ",", "out_channels", ",", "in_channels", "]", "\n", "", "kernel", "=", "tf", ".", "get_variable", "(", "\n", "'weights'", ",", "\n", "shape", "=", "filter_shape", ",", "\n", "initializer", "=", "tf", ".", "truncated_normal_initializer", "(", "stddev", "=", "math", ".", "sqrt", "(", "2.0", "/", "KERNEL_SIZE", "/", "KERNEL_SIZE", "/", "in_channels", ")", ")", ",", "\n", "dtype", "=", "tf", ".", "float32", "\n", ")", "\n", "biases", "=", "tf", ".", "get_variable", "(", "\n", "'biases'", ",", "\n", "shape", "=", "[", "out_channels", "]", ",", "\n", "initializer", "=", "tf", ".", "constant_initializer", "(", "0.0", ")", ",", "\n", "dtype", "=", "tf", ".", "float32", "\n", ")", "\n", "if", "not", "transpose", ":", "\n", "\t\t\t\t", "output", "=", "tf", ".", "nn", ".", "bias_add", "(", "\n", "tf", ".", "nn", ".", "conv2d", "(", "\n", "input_var", ",", "\n", "kernel", ",", "\n", "[", "1", ",", "stride", ",", "stride", ",", "1", "]", ",", "\n", "padding", "=", "padding", "\n", ")", ",", "\n", "biases", "\n", ")", "\n", "", "else", ":", "\n", "\t\t\t\t", "batch", "=", "tf", ".", "shape", "(", "input_var", ")", "[", "0", "]", "\n", "side", "=", "tf", ".", "shape", "(", "input_var", ")", "[", "1", "]", "\n", "output", "=", "tf", ".", "nn", ".", "bias_add", "(", "\n", "tf", ".", "nn", ".", "conv2d_transpose", "(", "\n", "input_var", ",", "\n", "kernel", ",", "\n", "[", "batch", ",", "side", "*", "stride", ",", "side", "*", "stride", ",", "out_channels", "]", ",", "\n", "[", "1", ",", "stride", ",", "stride", ",", "1", "]", ",", "\n", "padding", "=", "padding", "\n", ")", ",", "\n", "biases", "\n", ")", "\n", "", "if", "batchnorm", ":", "\n", "\t\t\t\t", "output", "=", "tf", ".", "contrib", ".", "layers", ".", "batch_norm", "(", "output", ",", "center", "=", "True", ",", "scale", "=", "True", ",", "is_training", "=", "self", ".", "is_training", ",", "decay", "=", "0.99", ")", "\n", "", "if", "dropout", "is", "not", "None", ":", "\n", "\t\t\t\t", "output", "=", "tf", ".", "nn", ".", "dropout", "(", "output", ",", "keep_prob", "=", "1", "-", "dropout", ")", "\n", "\n", "", "if", "activation", "==", "'relu'", ":", "\n", "\t\t\t\t", "return", "tf", ".", "nn", ".", "relu", "(", "output", ",", "name", "=", "scope", ".", "name", ")", "\n", "", "elif", "activation", "==", "'sigmoid'", ":", "\n", "\t\t\t\t", "return", "tf", ".", "nn", ".", "sigmoid", "(", "output", ",", "name", "=", "scope", ".", "name", ")", "\n", "", "elif", "activation", "==", "'none'", ":", "\n", "\t\t\t\t", "return", "output", "\n", "", "else", ":", "\n", "\t\t\t\t", "raise", "Exception", "(", "'invalid activation {} specified'", ".", "format", "(", "activation", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.model.Model._fc_layer": [[75, 107], ["options.get", "options.get", "options.get", "tensorflow.variable_scope", "tensorflow.get_variable", "tensorflow.get_variable", "tensorflow.matmul", "tensorflow.contrib.layers.batch_norm", "tensorflow.nn.dropout", "tensorflow.nn.relu", "tensorflow.truncated_normal_initializer", "tensorflow.constant_initializer", "tensorflow.nn.sigmoid", "Exception", "math.sqrt"], "methods", ["None"], ["", "", "", "def", "_fc_layer", "(", "self", ",", "name", ",", "input_var", ",", "input_size", ",", "output_size", ",", "options", "=", "{", "}", ")", ":", "\n", "\t\t", "activation", "=", "options", ".", "get", "(", "'activation'", ",", "'relu'", ")", "\n", "dropout", "=", "options", ".", "get", "(", "'dropout'", ",", "None", ")", "\n", "batchnorm", "=", "options", ".", "get", "(", "'batchnorm'", ",", "False", ")", "\n", "\n", "with", "tf", ".", "variable_scope", "(", "name", ")", "as", "scope", ":", "\n", "\t\t\t", "weights", "=", "tf", ".", "get_variable", "(", "\n", "'weights'", ",", "\n", "shape", "=", "[", "input_size", ",", "output_size", "]", ",", "\n", "initializer", "=", "tf", ".", "truncated_normal_initializer", "(", "stddev", "=", "math", ".", "sqrt", "(", "2.0", "/", "input_size", ")", ")", ",", "\n", "dtype", "=", "tf", ".", "float32", "\n", ")", "\n", "biases", "=", "tf", ".", "get_variable", "(", "\n", "'biases'", ",", "\n", "shape", "=", "[", "output_size", "]", ",", "\n", "initializer", "=", "tf", ".", "constant_initializer", "(", "0.0", ")", ",", "\n", "dtype", "=", "tf", ".", "float32", "\n", ")", "\n", "output", "=", "tf", ".", "matmul", "(", "input_var", ",", "weights", ")", "+", "biases", "\n", "if", "batchnorm", ":", "\n", "\t\t\t\t", "output", "=", "tf", ".", "contrib", ".", "layers", ".", "batch_norm", "(", "output", ",", "center", "=", "True", ",", "scale", "=", "True", ",", "is_training", "=", "self", ".", "is_training", ",", "decay", "=", "0.99", ")", "\n", "", "if", "dropout", "is", "not", "None", ":", "\n", "\t\t\t\t", "output", "=", "tf", ".", "nn", ".", "dropout", "(", "output", ",", "keep_prob", "=", "1", "-", "dropout", ")", "\n", "\n", "", "if", "activation", "==", "'relu'", ":", "\n", "\t\t\t\t", "return", "tf", ".", "nn", ".", "relu", "(", "output", ",", "name", "=", "scope", ".", "name", ")", "\n", "", "elif", "activation", "==", "'sigmoid'", ":", "\n", "\t\t\t\t", "return", "tf", ".", "nn", ".", "sigmoid", "(", "output", ",", "name", "=", "scope", ".", "name", ")", "\n", "", "elif", "activation", "==", "'none'", ":", "\n", "\t\t\t\t", "return", "output", "\n", "", "else", ":", "\n", "\t\t\t\t", "raise", "Exception", "(", "'invalid activation {} specified'", ".", "format", "(", "activation", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.model.Model.__init__": [[108, 177], ["tensorflow.reset_default_graph", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "range", "tensorflow.initialize_all_variables", "tensorflow.train.Saver", "tensorflow.cast", "tensorflow.reshape", "model.Model.masks.append", "range", "tensorflow.concat", "range", "tensorflow.reduce_mean", "tensorflow.reduce_mean", "options.get", "tensorflow.reduce_min", "tensorflow.reduce_min", "tensorflow.reduce_min", "tensorflow.reduce_min", "tensorflow.reduce_min", "tensorflow.reduce_min", "tensorflow.reduce_mean", "tensorflow.reduce_mean", "tensorflow.reduce_mean", "tensorflow.reduce_mean", "tensorflow.reduce_mean", "tensorflow.reduce_mean", "tensorflow.control_dependencies", "tensorflow.train.AdamOptimizer().minimize", "tensorflow.train.AdamOptimizer().minimize", "tensorflow.variable_scope", "model.Model.make_part", "stuffs.append", "tensorflow.variable_scope", "model.Model.make_part", "longim_losses.append", "finesp_losses.append", "tensorflow.get_collection", "tensorflow.train.AdamOptimizer", "tensorflow.train.AdamOptimizer", "str", "str"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.model.Model.make_part", "home.repos.pwc.inspect_result.favyen_uns20.None.model.Model.make_part"], ["", "", "", "def", "__init__", "(", "self", ",", "options", "=", "{", "}", ")", ":", "\n", "\t\t", "tf", ".", "reset_default_graph", "(", ")", "\n", "self", ".", "options", "=", "options", "\n", "\n", "self", ".", "is_training", "=", "tf", ".", "placeholder", "(", "tf", ".", "bool", ")", "\n", "self", ".", "raw_images", "=", "tf", ".", "placeholder", "(", "tf", ".", "uint8", ",", "[", "None", ",", "64", ",", "64", ",", "3", "]", ")", "\n", "self", ".", "input_images", "=", "tf", ".", "cast", "(", "self", ".", "raw_images", ",", "tf", ".", "float32", ")", "/", "255.0", "\n", "self", ".", "input_boxes", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "[", "None", ",", "4", "]", ")", "\n", "self", ".", "n_image", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "[", "BATCH_SIZE", ",", "SEQ_LEN", "+", "1", "]", ")", "\n", "self", ".", "input_masks", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "[", "None", "]", ")", "\n", "self", ".", "match_length", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ")", "\n", "self", ".", "learning_rate", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ")", "\n", "\n", "# for inference", "\n", "self", ".", "infer_sel", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "[", "None", "]", ")", "\n", "self", ".", "infer_hidden", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ",", "[", "None", ",", "256", "]", ")", "\n", "\n", "# extract masks", "\n", "self", ".", "masks", "=", "[", "]", "\n", "s", "=", "0", "\n", "for", "batch", "in", "range", "(", "BATCH_SIZE", ")", ":", "\n", "\t\t\t", "n_first", "=", "self", ".", "n_image", "[", "batch", ",", "0", "]", "\n", "n_last", "=", "self", ".", "n_image", "[", "batch", ",", "self", ".", "match_length", "]", "\n", "cur_count", "=", "n_first", "*", "(", "n_last", "+", "1", ")", "\n", "cur_mask", "=", "tf", ".", "reshape", "(", "self", ".", "input_masks", "[", "s", ":", "s", "+", "cur_count", "]", ",", "[", "n_first", ",", "n_last", "+", "1", "]", ")", "\n", "self", ".", "masks", ".", "append", "(", "cur_mask", ")", "\n", "s", "+=", "cur_count", "\n", "\n", "", "if", "SEQ_LEN", "<", "4", ":", "\n", "\t\t\t", "stuffs", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "4", ")", ":", "\n", "\t\t\t\t", "with", "tf", ".", "variable_scope", "(", "'ensemble'", "+", "str", "(", "i", ")", ")", ":", "\n", "\t\t\t\t\t", "stuff", "=", "self", ".", "make_part", "(", "options", ",", "infer_hidden", "=", "self", ".", "infer_hidden", "[", ":", ",", "64", "*", "i", ":", "64", "*", "(", "i", "+", "1", ")", "]", ")", "\n", "stuffs", ".", "append", "(", "stuff", ")", "\n", "\n", "", "", "if", "options", ".", "get", "(", "'infer_op'", ",", "'mean'", ")", "==", "'min'", ":", "\n", "\t\t\t\t", "self", ".", "out_mat_finesp", "=", "tf", ".", "reduce_min", "(", "[", "stuff", "[", "0", "]", "for", "stuff", "in", "stuffs", "]", ",", "axis", "=", "0", ")", "\n", "self", ".", "out_logits_finesp", "=", "tf", ".", "reduce_min", "(", "[", "stuff", "[", "1", "]", "for", "stuff", "in", "stuffs", "]", ",", "axis", "=", "0", ")", "\n", "self", ".", "out_mat_longim", "=", "tf", ".", "reduce_min", "(", "[", "stuff", "[", "2", "]", "for", "stuff", "in", "stuffs", "]", ",", "axis", "=", "0", ")", "\n", "self", ".", "out_logits_longim", "=", "tf", ".", "reduce_min", "(", "[", "stuff", "[", "3", "]", "for", "stuff", "in", "stuffs", "]", ",", "axis", "=", "0", ")", "\n", "self", ".", "out_mat", "=", "tf", ".", "reduce_min", "(", "[", "stuff", "[", "4", "]", "for", "stuff", "in", "stuffs", "]", ",", "axis", "=", "0", ")", "\n", "self", ".", "out_mat_reweight", "=", "tf", ".", "reduce_min", "(", "[", "stuff", "[", "5", "]", "for", "stuff", "in", "stuffs", "]", ",", "axis", "=", "0", ")", "\n", "", "else", ":", "\n", "\t\t\t\t", "self", ".", "out_mat_finesp", "=", "tf", ".", "reduce_mean", "(", "[", "stuff", "[", "0", "]", "for", "stuff", "in", "stuffs", "]", ",", "axis", "=", "0", ")", "\n", "self", ".", "out_logits_finesp", "=", "tf", ".", "reduce_mean", "(", "[", "stuff", "[", "1", "]", "for", "stuff", "in", "stuffs", "]", ",", "axis", "=", "0", ")", "\n", "self", ".", "out_mat_longim", "=", "tf", ".", "reduce_mean", "(", "[", "stuff", "[", "2", "]", "for", "stuff", "in", "stuffs", "]", ",", "axis", "=", "0", ")", "\n", "self", ".", "out_logits_longim", "=", "tf", ".", "reduce_mean", "(", "[", "stuff", "[", "3", "]", "for", "stuff", "in", "stuffs", "]", ",", "axis", "=", "0", ")", "\n", "self", ".", "out_mat", "=", "tf", ".", "reduce_mean", "(", "[", "stuff", "[", "4", "]", "for", "stuff", "in", "stuffs", "]", ",", "axis", "=", "0", ")", "\n", "self", ".", "out_mat_reweight", "=", "tf", ".", "reduce_mean", "(", "[", "stuff", "[", "5", "]", "for", "stuff", "in", "stuffs", "]", ",", "axis", "=", "0", ")", "\n", "\n", "", "self", ".", "out_hidden", "=", "tf", ".", "concat", "(", "[", "stuff", "[", "6", "]", "for", "stuff", "in", "stuffs", "]", ",", "axis", "=", "2", ")", "\n", "", "else", ":", "\n", "\t\t\t", "longim_losses", "=", "[", "]", "\n", "finesp_losses", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "4", ")", ":", "\n", "\t\t\t\t", "with", "tf", ".", "variable_scope", "(", "'ensemble'", "+", "str", "(", "i", ")", ")", ":", "\n", "\t\t\t\t\t", "longim_loss", ",", "finesp_loss", "=", "self", ".", "make_part", "(", "options", ")", "\n", "longim_losses", ".", "append", "(", "longim_loss", ")", "\n", "finesp_losses", ".", "append", "(", "finesp_loss", ")", "\n", "\n", "", "", "self", ".", "longim_loss", "=", "tf", ".", "reduce_mean", "(", "longim_losses", ")", "\n", "self", ".", "finesp_loss", "=", "tf", ".", "reduce_mean", "(", "finesp_losses", ")", "\n", "\n", "with", "tf", ".", "control_dependencies", "(", "tf", ".", "get_collection", "(", "tf", ".", "GraphKeys", ".", "UPDATE_OPS", ")", ")", ":", "\n", "\t\t\t\t", "self", ".", "longim_optimizer", "=", "tf", ".", "train", ".", "AdamOptimizer", "(", "learning_rate", "=", "self", ".", "learning_rate", ")", ".", "minimize", "(", "self", ".", "longim_loss", ")", "\n", "self", ".", "finesp_optimizer", "=", "tf", ".", "train", ".", "AdamOptimizer", "(", "learning_rate", "=", "self", ".", "learning_rate", ")", ".", "minimize", "(", "self", ".", "finesp_loss", ")", "\n", "\n", "", "", "self", ".", "init_op", "=", "tf", ".", "initialize_all_variables", "(", ")", "\n", "self", ".", "saver", "=", "tf", ".", "train", ".", "Saver", "(", "max_to_keep", "=", "None", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.None.model.Model.make_part": [[178, 490], ["options.get", "model.Model._conv_layer", "model.Model._conv_layer", "model.Model._conv_layer", "model.Model._conv_layer", "model.Model._conv_layer", "range", "tensorflow.get_variable", "range", "range", "range", "range", "tensorflow.reduce_mean", "range", "tensorflow.reduce_mean", "model.Model._conv_layer", "range", "tensorflow.concat", "tensorflow.reshape", "model.Model.make_part.matcher"], "methods", ["home.repos.pwc.inspect_result.favyen_uns20.None.model.Model._conv_layer", "home.repos.pwc.inspect_result.favyen_uns20.None.model.Model._conv_layer", "home.repos.pwc.inspect_result.favyen_uns20.None.model.Model._conv_layer", "home.repos.pwc.inspect_result.favyen_uns20.None.model.Model._conv_layer", "home.repos.pwc.inspect_result.favyen_uns20.None.model.Model._conv_layer", "home.repos.pwc.inspect_result.favyen_uns20.None.model.Model._conv_layer"], ["", "def", "make_part", "(", "self", ",", "options", ",", "infer_hidden", "=", "None", ")", ":", "\n", "\t\t", "c_image", "=", "options", ".", "get", "(", "'c_image'", ",", "64", ")", "\n", "c_spatial", "=", "4", "\n", "c_features", "=", "c_image", "+", "c_spatial", "\n", "c_rnn", "=", "64", "\n", "\n", "# CNN for long-term image", "\n", "layer1", "=", "self", ".", "_conv_layer", "(", "'layer1'", ",", "self", ".", "input_images", ",", "2", ",", "3", ",", "64", ")", "# -> 32x32x64", "\n", "layer2", "=", "self", ".", "_conv_layer", "(", "'layer2'", ",", "layer1", ",", "2", ",", "64", ",", "c_image", ")", "# -> 16x16x64", "\n", "layer3", "=", "self", ".", "_conv_layer", "(", "'layer3'", ",", "layer2", ",", "2", ",", "c_image", ",", "c_image", ")", "# -> 8x8x64", "\n", "layer4", "=", "self", ".", "_conv_layer", "(", "'layer4'", ",", "layer3", ",", "2", ",", "c_image", ",", "c_image", ")", "# -> 4x4x64", "\n", "layer5", "=", "self", ".", "_conv_layer", "(", "'layer5'", ",", "layer4", ",", "2", ",", "c_image", ",", "c_image", ")", "# -> 2x2x64", "\n", "layer6", "=", "self", ".", "_conv_layer", "(", "'layer6'", ",", "layer5", ",", "2", ",", "c_image", ",", "c_image", ",", "{", "'activation'", ":", "'none'", "}", ")", "[", ":", ",", "0", ",", "0", ",", ":", "]", "\n", "\n", "features", "=", "[", "[", "]", "for", "_", "in", "range", "(", "BATCH_SIZE", ")", "]", "\n", "s", "=", "0", "\n", "for", "batch", "in", "range", "(", "BATCH_SIZE", ")", ":", "\n", "\t\t\t", "for", "i", "in", "range", "(", "SEQ_LEN", "+", "1", ")", ":", "\n", "\t\t\t\t", "cur_count", "=", "self", ".", "n_image", "[", "batch", ",", "i", "]", "\n", "cur_features", "=", "tf", ".", "concat", "(", "[", "\n", "self", ".", "input_boxes", "[", "s", ":", "s", "+", "cur_count", ",", ":", "]", ",", "\n", "layer6", "[", "s", ":", "s", "+", "cur_count", ",", ":", "]", ",", "\n", "]", ",", "axis", "=", "1", ")", "\n", "cur_features", "=", "tf", ".", "concat", "(", "[", "\n", "cur_features", ",", "\n", "tf", ".", "zeros", "(", "[", "1", ",", "c_features", "]", ",", "dtype", "=", "tf", ".", "float32", ")", ",", "\n", "]", ",", "axis", "=", "0", ")", "\n", "features", "[", "batch", "]", ".", "append", "(", "cur_features", ")", "\n", "s", "+=", "cur_count", "\n", "\n", "# MATCHER", "\n", "# context is longim or finesp", "\n", "", "", "def", "matcher", "(", "pairs", ",", "context", ")", ":", "\n", "\t\t\t", "with", "tf", ".", "variable_scope", "(", "'matcher'", "+", "context", ",", "reuse", "=", "tf", ".", "AUTO_REUSE", ")", ":", "\n", "\t\t\t\t", "im_pairs", "=", "tf", ".", "concat", "(", "[", "pairs", "[", ":", ",", "0", ":", "c_rnn", "]", ",", "pairs", "[", ":", ",", "c_rnn", "+", "4", ":", "c_rnn", "+", "c_features", "]", ",", "pairs", "[", ":", ",", "c_rnn", "+", "c_features", "+", "4", ":", "]", "]", ",", "axis", "=", "1", ")", "\n", "if", "options", ".", "get", "(", "'spatial_rel'", ",", "False", ")", ":", "\n", "\t\t\t\t\t", "sp1", "=", "pairs", "[", ":", ",", "c_rnn", ":", "c_rnn", "+", "4", "]", "\n", "sp2", "=", "pairs", "[", ":", ",", "c_rnn", "+", "c_features", ":", "c_rnn", "+", "c_features", "+", "4", "]", "\n", "spatial_pairs", "=", "tf", ".", "concat", "(", "[", "\n", "pairs", "[", ":", ",", "0", ":", "c_rnn", "]", ",", "\n", "sp1", "[", ":", ",", "0", ":", "2", "]", "-", "sp2", "[", ":", ",", "0", ":", "2", "]", ",", "\n", "sp1", "[", ":", ",", "2", ":", "4", "]", ",", "\n", "sp2", "[", ":", ",", "0", ":", "2", "]", "-", "sp1", "[", ":", ",", "0", ":", "2", "]", ",", "\n", "sp2", "[", ":", ",", "2", ":", "4", "]", ",", "\n", "]", ",", "axis", "=", "1", ")", "\n", "", "else", ":", "\n", "\t\t\t\t\t", "spatial_pairs", "=", "tf", ".", "concat", "(", "[", "pairs", "[", ":", ",", "0", ":", "c_rnn", "+", "4", "]", ",", "pairs", "[", ":", ",", "c_rnn", "+", "c_features", ":", "c_rnn", "+", "c_features", "+", "4", "]", "]", ",", "axis", "=", "1", ")", "\n", "\n", "", "if", "context", "==", "'longim'", ":", "\n", "\t\t\t\t\t", "matcher1", "=", "self", ".", "_fc_layer", "(", "'matcher1'", ",", "im_pairs", ",", "c_rnn", "+", "2", "*", "c_image", ",", "256", ")", "\n", "matcher2", "=", "self", ".", "_fc_layer", "(", "'matcher2'", ",", "matcher1", ",", "256", ",", "65", ",", "{", "'activation'", ":", "'none'", "}", ")", "\n", "return", "matcher2", "\n", "", "elif", "context", "==", "'finesp'", ":", "\n", "\t\t\t\t\t", "matcher1", "=", "self", ".", "_fc_layer", "(", "'matcher1'", ",", "spatial_pairs", ",", "c_rnn", "+", "2", "*", "c_spatial", ",", "256", ")", "\n", "matcher2", "=", "self", ".", "_fc_layer", "(", "'matcher2'", ",", "matcher1", ",", "256", ",", "128", ")", "\n", "matcher3", "=", "self", ".", "_fc_layer", "(", "'matcher3'", ",", "matcher2", ",", "128", ",", "128", ")", "\n", "matcher4", "=", "self", ".", "_fc_layer", "(", "'matcher4'", ",", "matcher3", ",", "128", ",", "1", ",", "{", "'activation'", ":", "'none'", "}", ")", "\n", "\n", "matcher5", "=", "self", ".", "_fc_layer", "(", "'matcher5'", ",", "spatial_pairs", ",", "c_rnn", "+", "2", "*", "c_spatial", ",", "256", ")", "\n", "matcher6", "=", "self", ".", "_fc_layer", "(", "'matcher6'", ",", "matcher1", ",", "256", ",", "128", ")", "\n", "matcher7", "=", "self", ".", "_fc_layer", "(", "'matcher7'", ",", "matcher2", ",", "128", ",", "128", ")", "\n", "matcher8", "=", "self", ".", "_fc_layer", "(", "'matcher8'", ",", "matcher3", ",", "128", ",", "c_rnn", ",", "{", "'activation'", ":", "'none'", "}", ")", "\n", "\n", "return", "tf", ".", "concat", "(", "[", "matcher4", ",", "matcher8", "]", ",", "axis", "=", "1", ")", "\n", "", "elif", "context", "==", "'combined'", ":", "\n", "\t\t\t\t\t", "matcher1", "=", "self", ".", "_fc_layer", "(", "'matcher1'", ",", "pairs", ",", "c_rnn", "+", "2", "*", "c_features", ",", "256", ")", "\n", "matcher2", "=", "self", ".", "_fc_layer", "(", "'matcher2'", ",", "matcher1", ",", "256", ",", "128", ")", "\n", "matcher3", "=", "self", ".", "_fc_layer", "(", "'matcher3'", ",", "matcher2", ",", "128", ",", "128", ")", "\n", "matcher4", "=", "self", ".", "_fc_layer", "(", "'matcher4'", ",", "matcher3", ",", "128", ",", "1", ",", "{", "'activation'", ":", "'none'", "}", ")", "\n", "\n", "matcher5", "=", "self", ".", "_fc_layer", "(", "'matcher5'", ",", "pairs", ",", "c_rnn", "+", "2", "*", "c_features", ",", "256", ")", "\n", "matcher6", "=", "self", ".", "_fc_layer", "(", "'matcher6'", ",", "matcher1", ",", "256", ",", "128", ")", "\n", "matcher7", "=", "self", ".", "_fc_layer", "(", "'matcher7'", ",", "matcher2", ",", "128", ",", "128", ")", "\n", "matcher8", "=", "self", ".", "_fc_layer", "(", "'matcher8'", ",", "matcher3", ",", "128", ",", "c_rnn", ",", "{", "'activation'", ":", "'none'", "}", ")", "\n", "\n", "return", "tf", ".", "concat", "(", "[", "matcher4", ",", "matcher8", "]", ",", "axis", "=", "1", ")", "\n", "\n", "# logit replacing matching some detection with the zero (null/fake) detection", "\n", "", "", "", "no_match_logit", "=", "tf", ".", "get_variable", "(", "'no_match_logit'", ",", "shape", "=", "[", "1", "]", ",", "initializer", "=", "tf", ".", "constant_initializer", "(", "0.0", ")", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "\n", "def", "get_mat_hidden", "(", "n_prev", ",", "n_next", ",", "rnn_features", ",", "prev_features", ",", "next_features", ",", "context", ",", "incl_logits", "=", "False", ",", "do_neg", "=", "True", ")", ":", "\n", "\t\t\t", "do_neg", "=", "do_neg", "and", "options", ".", "get", "(", "'do_neg'", ",", "True", ")", "\n", "if", "do_neg", ":", "\n", "# include min(n_next, n_neg) negative examples where we borrow the next spatial features", "\n", "# now we also include n_prev previous images as negatives", "\n", "#fake_next1 = tf.minimum(n_prev, n_next)", "\n", "#fake_next2 = tf.maximum(0, n_prev - n_next)", "\n", "\t\t\t\t", "fake_next1", "=", "n_prev", "\n", "fake_next2", "=", "tf", ".", "minimum", "(", "n_next", ",", "self", ".", "n_image", "[", "0", ",", "SEQ_LEN", "]", ")", "\n", "fake_next", "=", "fake_next1", "+", "fake_next2", "\n", "n_next", "+=", "fake_next", "\n", "#neg_features1 = tf.concat([", "\n", "#\tnext_features[0:fake_next1, 0:c_spatial],", "\n", "#\tprev_features[0:fake_next1, c_spatial:],", "\n", "#], axis=1)", "\n", "#neg_features2 = tf.concat([", "\n", "#\tprev_features[0:fake_next2, 0:c_spatial],", "\n", "#\tprev_features[fake_next1:n_prev, c_spatial:],", "\n", "#], axis=1)", "\n", "neg_features1", "=", "prev_features", "\n", "neg_features2", "=", "tf", ".", "concat", "(", "[", "\n", "next_features", "[", "0", ":", "fake_next2", ",", "0", ":", "c_spatial", "]", ",", "\n", "features", "[", "0", "]", "[", "SEQ_LEN", "]", "[", "0", ":", "fake_next2", ",", "c_spatial", ":", "]", ",", "\n", "]", ",", "axis", "=", "1", ")", "\n", "next_features", "=", "tf", ".", "concat", "(", "[", "neg_features1", ",", "neg_features2", ",", "next_features", "]", ",", "axis", "=", "0", ")", "\n", "\n", "", "cur_pairs", "=", "tf", ".", "concat", "(", "[", "\n", "tf", ".", "tile", "(", "\n", "tf", ".", "reshape", "(", "rnn_features", ",", "[", "n_prev", ",", "1", ",", "c_rnn", "]", ")", ",", "\n", "[", "1", ",", "n_next", "+", "1", ",", "1", "]", "\n", ")", ",", "\n", "tf", ".", "tile", "(", "\n", "tf", ".", "reshape", "(", "prev_features", ",", "[", "n_prev", ",", "1", ",", "c_features", "]", ")", ",", "\n", "[", "1", ",", "n_next", "+", "1", ",", "1", "]", "\n", ")", ",", "\n", "tf", ".", "tile", "(", "\n", "tf", ".", "reshape", "(", "next_features", ",", "[", "1", ",", "n_next", "+", "1", ",", "c_features", "]", ")", ",", "\n", "[", "n_prev", ",", "1", ",", "1", "]", "\n", ")", ",", "\n", "]", ",", "axis", "=", "2", ")", "\n", "\n", "cur_pairs", "=", "tf", ".", "reshape", "(", "cur_pairs", ",", "[", "n_prev", "*", "(", "n_next", "+", "1", ")", ",", "c_rnn", "+", "2", "*", "c_features", "]", ")", "\n", "cur_outputs", "=", "matcher", "(", "cur_pairs", ",", "context", "=", "context", ")", "\n", "cur_outputs", "=", "tf", ".", "reshape", "(", "cur_outputs", ",", "[", "n_prev", ",", "n_next", "+", "1", ",", "1", "+", "c_rnn", "]", ")", "\n", "\n", "cur_logits", "=", "cur_outputs", "[", ":", ",", ":", ",", "0", "]", "\n", "if", "options", ".", "get", "(", "'no_match_logit'", ",", "True", ")", ":", "\n", "\t\t\t\t", "cur_logits", "=", "tf", ".", "concat", "(", "[", "\n", "cur_logits", "[", ":", ",", ":", "-", "1", "]", ",", "\n", "tf", ".", "tile", "(", "tf", ".", "reshape", "(", "no_match_logit", ",", "[", "1", ",", "1", "]", ")", ",", "[", "n_prev", ",", "1", "]", ")", ",", "\n", "]", ",", "axis", "=", "1", ")", "\n", "\n", "", "if", "do_neg", ":", "\n", "# need to eliminate logits that are connecting the same features", "\n", "# these are in the first n_prev x n_prev of the matrix", "\n", "\t\t\t\t", "elim_mat", "=", "tf", ".", "eye", "(", "num_rows", "=", "n_prev", ",", "num_columns", "=", "n_next", "+", "1", ")", "\n", "cur_logits", "=", "(", "cur_logits", "*", "(", "1", "-", "elim_mat", ")", ")", "-", "50", "*", "elim_mat", "\n", "\n", "", "if", "options", ".", "get", "(", "'linearnorm'", ",", "False", ")", ":", "\n", "# multiply rows and columns by a factor so that they add up to at most 1", "\n", "# we do rows first, then columns", "\n", "\t\t\t\t", "cur_mat", "=", "tf", ".", "nn", ".", "sigmoid", "(", "cur_logits", ")", "\n", "cur_mat", "=", "tf", ".", "concat", "(", "[", "\n", "cur_mat", "[", ":", ",", ":", "-", "1", "]", ",", "\n", "tf", ".", "maximum", "(", "1", "-", "tf", ".", "reduce_sum", "(", "cur_mat", "[", ":", ",", ":", "-", "1", "]", ",", "axis", "=", "1", ",", "keepdims", "=", "True", ")", ",", "tf", ".", "maximum", "(", "0.01", ",", "no_match_logit", ")", ")", ",", "\n", "]", ",", "axis", "=", "1", ")", "\n", "row_factors", "=", "1.0", "/", "tf", ".", "maximum", "(", "1.0", ",", "tf", ".", "reduce_sum", "(", "cur_mat", ",", "axis", "=", "1", ",", "keepdims", "=", "True", ")", ")", "\n", "cur_mat", "*=", "tf", ".", "tile", "(", "row_factors", ",", "[", "1", ",", "n_next", "+", "1", "]", ")", "\n", "col_factors", "=", "1.0", "/", "tf", ".", "maximum", "(", "1.0", ",", "tf", ".", "reduce_sum", "(", "cur_mat", ",", "axis", "=", "0", ",", "keepdims", "=", "True", ")", ")", "\n", "cur_mat", "*=", "tf", ".", "tile", "(", "col_factors", ",", "[", "n_prev", ",", "1", "]", ")", "\n", "", "else", ":", "\n", "\t\t\t\t", "cur_mat", "=", "tf", ".", "math", ".", "minimum", "(", "\n", "tf", ".", "nn", ".", "softmax", "(", "cur_logits", ",", "axis", "=", "0", ")", ",", "\n", "tf", ".", "nn", ".", "softmax", "(", "cur_logits", ",", "axis", "=", "1", ")", "\n", ")", "\n", "", "cur_hidden", "=", "cur_outputs", "[", ":", ",", ":", ",", "1", ":", "]", "\n", "\n", "if", "do_neg", ":", "\n", "\t\t\t\t", "cur_logits", "=", "cur_logits", "[", ":", ",", "fake_next", ":", "]", "\n", "cur_mat", "=", "cur_mat", "[", ":", ",", "fake_next", ":", "]", "\n", "cur_hidden", "=", "cur_hidden", "[", ":", ",", "fake_next", ":", ",", ":", "]", "\n", "\n", "", "if", "incl_logits", ":", "\n", "\t\t\t\t", "return", "cur_mat", ",", "cur_hidden", ",", "cur_logits", "\n", "", "else", ":", "\n", "\t\t\t\t", "return", "cur_mat", ",", "cur_hidden", "\n", "\n", "", "", "def", "index_list", "(", "l", ",", "idx", ",", "out_shape", ")", ":", "\n", "\t\t\t", "flatlist", "=", "[", "]", "\n", "sums", "=", "[", "0", "]", "\n", "for", "t", "in", "l", ":", "\n", "\t\t\t\t", "flat", "=", "tf", ".", "reshape", "(", "t", ",", "[", "-", "1", "]", ")", "\n", "flatlist", ".", "append", "(", "flat", ")", "\n", "sums", ".", "append", "(", "sums", "[", "-", "1", "]", "+", "tf", ".", "shape", "(", "flat", ")", "[", "0", "]", ")", "\n", "", "flatlist", "=", "tf", ".", "concat", "(", "flatlist", ",", "axis", "=", "0", ")", "\n", "sums", "=", "tf", ".", "stack", "(", "sums", ",", "axis", "=", "0", ")", "\n", "output", "=", "flatlist", "[", "sums", "[", "idx", "]", ":", "sums", "[", "idx", "+", "1", "]", "]", "\n", "return", "tf", ".", "reshape", "(", "output", ",", "out_shape", ")", "\n", "\n", "", "def", "terminal_reweight", "(", "mat", ")", ":", "\n", "\t\t\t", "mat_term", "=", "mat", "[", ":", ",", "-", "1", "]", "\n", "factor", "=", "tf", ".", "minimum", "(", "1.0", "/", "(", "tf", ".", "reduce_sum", "(", "mat_term", ")", "+", "1e-2", ")", ",", "tf", ".", "cast", "(", "tf", ".", "shape", "(", "mat", ")", "[", "0", "]", ",", "tf", ".", "float32", ")", ")", "\n", "mat_term", "=", "mat_term", "*", "factor", "\n", "row_maxes", "=", "1", "-", "tf", ".", "reduce_sum", "(", "mat", "[", ":", ",", ":", "-", "1", "]", ",", "axis", "=", "1", ")", "\n", "row_maxes", "=", "tf", ".", "maximum", "(", "row_maxes", ",", "0", ")", "\n", "mat_term", "=", "tf", ".", "minimum", "(", "mat_term", ",", "row_maxes", ")", "\n", "return", "tf", ".", "concat", "(", "[", "mat", "[", ":", ",", ":", "-", "1", "]", ",", "tf", ".", "reshape", "(", "mat_term", ",", "[", "-", "1", ",", "1", "]", ")", "]", ",", "axis", "=", "1", ")", "\n", "\n", "", "def", "get_recur_sel", "(", "mat", ")", ":", "\n", "\t\t\t", "if", "options", ".", "get", "(", "'simple_sel'", ",", "False", ")", ":", "\n", "\t\t\t\t", "return", "tf", ".", "argmax", "(", "mat", ",", "axis", "=", "1", ",", "output_type", "=", "tf", ".", "int32", ")", "\n", "", "def", "f", "(", "mat", ")", ":", "\n", "# take argmax along rows (over columns)", "\n", "# but only use it if it is higher value than other rows in same column", "\n", "\t\t\t\t", "row_argmax", "=", "numpy", ".", "argmax", "(", "mat", ",", "axis", "=", "1", ")", "\n", "col_argmax", "=", "numpy", ".", "argmax", "(", "mat", ",", "axis", "=", "0", ")", "\n", "out", "=", "row_argmax", "\n", "for", "i", "in", "range", "(", "out", ".", "shape", "[", "0", "]", ")", ":", "\n", "\t\t\t\t\t", "if", "col_argmax", "[", "out", "[", "i", "]", "]", "!=", "i", ":", "\n", "\t\t\t\t\t\t", "out", "[", "i", "]", "=", "mat", ".", "shape", "[", "1", "]", "-", "1", "\n", "", "", "return", "out", ".", "astype", "(", "'int32'", ")", "\n", "\n", "", "sel", "=", "tf", ".", "py_func", "(", "f", ",", "[", "mat", "]", ",", "tf", ".", "int32", ",", "stateful", "=", "False", ")", "\n", "return", "sel", "\n", "\n", "", "def", "compute_loss", "(", "mat1", ",", "mat2", ",", "batch", ",", "apply_mask", "=", "True", ")", ":", "\n", "\t\t\t", "if", "apply_mask", ":", "\n", "\t\t\t\t", "mask", "=", "self", ".", "masks", "[", "batch", "]", "\n", "", "else", ":", "\n", "\t\t\t\t", "mask", "=", "tf", ".", "ones", "(", "tf", ".", "shape", "(", "mat1", ")", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "\n", "", "epsilon", "=", "options", ".", "get", "(", "'epsilon'", ",", "1e-8", ")", "\n", "if", "options", ".", "get", "(", "'no_terminal'", ",", "False", ")", ":", "\n", "\t\t\t\t", "loss", "=", "-", "tf", ".", "reduce_mean", "(", "tf", ".", "log", "(", "tf", ".", "reduce_sum", "(", "mat1", "[", ":", ",", ":", "-", "1", "]", "*", "mat2", "[", ":", ",", ":", "-", "1", "]", "*", "mask", "[", ":", ",", ":", "-", "1", "]", ",", "axis", "=", "1", ")", "+", "epsilon", ")", ")", "\n", "", "elif", "options", ".", "get", "(", "'terminal_reweight'", ",", "True", ")", ":", "\n", "\t\t\t\t", "loss", "=", "-", "tf", ".", "reduce_mean", "(", "tf", ".", "log", "(", "tf", ".", "reduce_sum", "(", "terminal_reweight", "(", "mat1", ")", "*", "terminal_reweight", "(", "mat2", ")", "*", "mask", ",", "axis", "=", "1", ")", "+", "epsilon", ")", ")", "\n", "", "else", ":", "\n", "\t\t\t\t", "loss", "=", "-", "tf", ".", "reduce_mean", "(", "tf", ".", "log", "(", "tf", ".", "reduce_sum", "(", "mat1", "*", "mat2", "*", "mask", ",", "axis", "=", "1", ")", "+", "epsilon", ")", ")", "\n", "\n", "", "return", "loss", "\n", "\n", "\n", "", "if", "SEQ_LEN", "<", "4", ":", "\n", "# inference", "\n", "\t\t\t", "n_prev", "=", "tf", ".", "shape", "(", "self", ".", "infer_sel", ")", "[", "0", "]", "\n", "n_next", "=", "self", ".", "n_image", "[", "0", ",", "1", "]", "\n", "rnn_features", "=", "infer_hidden", "\n", "prev_features", "=", "tf", ".", "gather", "(", "features", "[", "0", "]", "[", "0", "]", ",", "self", ".", "infer_sel", ",", "axis", "=", "0", ")", "\n", "next_features", "=", "features", "[", "0", "]", "[", "1", "]", "\n", "\n", "out_mat_finesp", ",", "out_hidden", ",", "out_logits_finesp", "=", "get_mat_hidden", "(", "n_prev", ",", "n_next", ",", "rnn_features", ",", "prev_features", ",", "next_features", ",", "'finesp'", ",", "incl_logits", "=", "True", ",", "do_neg", "=", "False", ")", "\n", "out_mat_longim", ",", "_", ",", "out_logits_longim", "=", "get_mat_hidden", "(", "n_prev", ",", "n_next", ",", "tf", ".", "zeros", "(", "tf", ".", "shape", "(", "rnn_features", ")", ",", "dtype", "=", "tf", ".", "float32", ")", ",", "prev_features", ",", "next_features", ",", "'longim'", ",", "incl_logits", "=", "True", ",", "do_neg", "=", "False", ")", "\n", "out_mat", "=", "tf", ".", "minimum", "(", "out_mat_finesp", ",", "out_mat_longim", ")", "\n", "\n", "if", "options", ".", "get", "(", "'terminal_reweight'", ",", "True", ")", ":", "\n", "\t\t\t\t", "out_mat_reweight", "=", "terminal_reweight", "(", "out_mat", ")", "\n", "\n", "", "return", "out_mat_finesp", ",", "out_logits_finesp", ",", "out_mat_longim", ",", "out_logits_longim", ",", "out_mat", ",", "out_mat_reweight", ",", "out_hidden", "\n", "\n", "\n", "", "finesp_indices", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "SEQ_LEN", "-", "1", ")", ":", "\n", "\t\t\t", "finesp_indices", ".", "append", "(", "(", "i", ",", "i", "+", "1", ")", ")", "\n", "\n", "# LONGIM", "\n", "", "extra_mats", "=", "[", "[", "]", "for", "_", "in", "range", "(", "BATCH_SIZE", ")", "]", "\n", "extra_mats_finesp", "=", "[", "[", "]", "for", "_", "in", "range", "(", "BATCH_SIZE", ")", "]", "\n", "for", "batch", "in", "range", "(", "BATCH_SIZE", ")", ":", "\n", "\t\t\t", "n_prev", "=", "self", ".", "n_image", "[", "batch", ",", "0", "]", "\n", "n_next", "=", "self", ".", "n_image", "[", "batch", ",", "self", ".", "match_length", "]", "\n", "rnn_features", "=", "tf", ".", "zeros", "(", "(", "n_prev", ",", "1", ",", "c_rnn", ")", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "prev_features", "=", "features", "[", "batch", "]", "[", "0", "]", "[", ":", "-", "1", ",", ":", "]", "\n", "# next_features = features[batch][match_length]", "\n", "next_features", "=", "index_list", "(", "features", "[", "batch", "]", ",", "self", ".", "match_length", ",", "[", "n_next", "+", "1", ",", "c_features", "]", ")", "\n", "cur_mat", ",", "_", "=", "get_mat_hidden", "(", "n_prev", ",", "n_next", ",", "rnn_features", ",", "prev_features", ",", "next_features", ",", "'longim'", ")", "\n", "extra_mats", "[", "batch", "]", ".", "append", "(", "cur_mat", ")", "\n", "\n", "for", "i", "in", "range", "(", "SEQ_LEN", "-", "1", ")", ":", "\n", "# for extra_mats_finesp we always have SEQ_LEN inputs", "\n", "\t\t\t\t", "n_prev", "=", "self", ".", "n_image", "[", "batch", ",", "0", "]", "\n", "n_next", "=", "self", ".", "n_image", "[", "batch", ",", "i", "+", "1", "]", "\n", "rnn_features", "=", "tf", ".", "zeros", "(", "(", "n_prev", ",", "1", ",", "c_rnn", ")", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "prev_features", "=", "features", "[", "batch", "]", "[", "0", "]", "[", ":", "-", "1", ",", ":", "]", "\n", "next_features", "=", "features", "[", "batch", "]", "[", "i", "+", "1", "]", "\n", "cur_mat", ",", "_", "=", "get_mat_hidden", "(", "n_prev", ",", "n_next", ",", "rnn_features", ",", "prev_features", ",", "next_features", ",", "'longim'", ",", "do_neg", "=", "False", ")", "\n", "extra_mats_finesp", "[", "batch", "]", ".", "append", "(", "cur_mat", ")", "\n", "\n", "# FINESP (note: this can't be executed with variable matchlen, at least for now)", "\n", "", "", "finesp_mats", "=", "[", "[", "]", "for", "_", "in", "range", "(", "BATCH_SIZE", ")", "]", "\n", "finesp_hiddens", "=", "[", "[", "]", "for", "_", "in", "range", "(", "BATCH_SIZE", ")", "]", "\n", "for", "batch", "in", "range", "(", "BATCH_SIZE", ")", ":", "\n", "\t\t\t", "for", "prev_idx", ",", "next_idx", "in", "finesp_indices", ":", "\n", "\t\t\t\t", "n_next", "=", "self", ".", "n_image", "[", "batch", ",", "next_idx", "]", "\n", "if", "prev_idx", "==", "0", ":", "\n", "\t\t\t\t\t", "n_prev", "=", "self", ".", "n_image", "[", "batch", ",", "prev_idx", "]", "\n", "prev_features", "=", "features", "[", "batch", "]", "[", "prev_idx", "]", "[", ":", "-", "1", ",", ":", "]", "\n", "rnn_features", "=", "tf", ".", "zeros", "(", "(", "n_prev", ",", "1", ",", "c_rnn", ")", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "", "else", ":", "\n", "\t\t\t\t\t", "n_prev", "=", "self", ".", "n_image", "[", "batch", ",", "0", "]", "\n", "if", "options", ".", "get", "(", "'follow_longim'", ",", "False", ")", ":", "\n", "\t\t\t\t\t\t", "sel", "=", "get_recur_sel", "(", "extra_mats_finesp", "[", "batch", "]", "[", "prev_idx", "-", "1", "]", ")", "\n", "", "else", ":", "\n", "\t\t\t\t\t\t", "sel", "=", "get_recur_sel", "(", "finesp_mats", "[", "batch", "]", "[", "-", "1", "]", ")", "\n", "", "rnn_sel", "=", "tf", ".", "stack", "(", "[", "\n", "tf", ".", "range", "(", "n_prev", ",", "dtype", "=", "tf", ".", "int32", ")", ",", "\n", "sel", ",", "\n", "]", ",", "axis", "=", "1", ")", "\n", "prev_features", "=", "tf", ".", "gather", "(", "features", "[", "batch", "]", "[", "prev_idx", "]", ",", "sel", ",", "axis", "=", "0", ")", "\n", "rnn_features", "=", "tf", ".", "gather_nd", "(", "finesp_hiddens", "[", "batch", "]", "[", "-", "1", "]", ",", "rnn_sel", ")", "\n", "\n", "", "cur_mat", ",", "cur_hidden", "=", "get_mat_hidden", "(", "n_prev", ",", "n_next", ",", "rnn_features", ",", "prev_features", ",", "features", "[", "batch", "]", "[", "next_idx", "]", ",", "'finesp'", ",", "do_neg", "=", "False", ")", "\n", "finesp_mats", "[", "batch", "]", ".", "append", "(", "cur_mat", ")", "\n", "finesp_hiddens", "[", "batch", "]", ".", "append", "(", "cur_hidden", ")", "\n", "\n", "# longim loss", "\n", "", "", "longim_losses", "=", "[", "]", "\n", "for", "batch", "in", "range", "(", "BATCH_SIZE", ")", ":", "\n", "\t\t\t", "mat", "=", "extra_mats", "[", "batch", "]", "[", "0", "]", "\n", "loss", "=", "compute_loss", "(", "mat", ",", "mat", ",", "batch", ")", "\n", "longim_losses", ".", "append", "(", "loss", ")", "\n", "", "longim_loss", "=", "tf", ".", "reduce_mean", "(", "longim_losses", ")", "\n", "\n", "# finespatial loss", "\n", "finesp_losses", "=", "[", "]", "\n", "for", "batch", "in", "range", "(", "BATCH_SIZE", ")", ":", "\n", "\t\t\t", "for", "i", ",", "finesp_mat", "in", "enumerate", "(", "finesp_mats", "[", "batch", "]", ")", ":", "\n", "\t\t\t\t", "extra_mat", "=", "tf", ".", "stop_gradient", "(", "extra_mats_finesp", "[", "batch", "]", "[", "i", "]", ")", "\n", "loss", "=", "compute_loss", "(", "finesp_mat", ",", "extra_mat", ",", "batch", ",", "apply_mask", "=", "(", "i", "==", "SEQ_LEN", "-", "2", ")", ")", "\n", "finesp_losses", ".", "append", "(", "loss", ")", "\n", "", "", "finesp_loss", "=", "tf", ".", "reduce_mean", "(", "finesp_losses", ")", "\n", "\n", "return", "longim_loss", ",", "finesp_loss", "\n", "", "", ""]], "home.repos.pwc.inspect_result.favyen_uns20.scripts.preprocess-info.get_frame_fname": [[42, 47], ["str", "len"], "function", ["None"], ["def", "get_frame_fname", "(", "frame_idx", ")", ":", "\n", "\t", "s", "=", "str", "(", "frame_idx", ")", "\n", "while", "len", "(", "s", ")", "<", "6", ":", "\n", "\t\t", "s", "=", "'0'", "+", "s", "\n", "", "return", "s", "+", "'.jpg'", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.scripts.preprocess-info.to_rect": [[48, 52], ["geom.Rectangle", "geom.Point", "geom.Point"], "function", ["None"], ["", "def", "to_rect", "(", "detection", ")", ":", "\n", "\t", "return", "geom", ".", "Rectangle", "(", "\n", "geom", ".", "Point", "(", "detection", "[", "'left'", "]", ",", "detection", "[", "'top'", "]", ")", ",", "\n", "geom", ".", "Point", "(", "detection", "[", "'right'", "]", ",", "detection", "[", "'bottom'", "]", ")", ",", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.scripts.preprocess-info.get_potential_matches": [[55, 94], ["range", "range", "cur_matches.items", "len", "set", "cur_matches.values", "set.update", "range", "set", "len", "preprocess-info.to_rect", "preprocess-info.to_rect", "to_rect.intersection().area", "set.update", "float", "float", "connections[].append", "set.add", "to_rect.intersection", "to_rect.area", "to_rect.area"], "function", ["home.repos.pwc.inspect_result.favyen_uns20.scripts.preprocess-info.to_rect", "home.repos.pwc.inspect_result.favyen_uns20.scripts.preprocess-info.to_rect", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.area", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.FPoint.add", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.intersection", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.area", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.area"], ["def", "get_potential_matches", "(", "detections", ",", "first_frame", ",", "last_frame", ")", ":", "\n", "# from detection_idx in frame #first_idx to iterable of matching tuples (frame, det_idx)", "\n", "\t", "cur_matches", "=", "{", "}", "\n", "for", "idx", "in", "range", "(", "len", "(", "detections", "[", "first_frame", "]", ")", ")", ":", "\n", "\t\t", "cur_matches", "[", "idx", "]", "=", "[", "(", "first_frame", ",", "idx", ")", "]", "\n", "\n", "", "for", "right_frame", "in", "range", "(", "first_frame", "+", "1", ",", "last_frame", "+", "1", ")", ":", "\n", "# list the detections we need to match", "\n", "\t\t", "check_set", "=", "set", "(", ")", "\n", "for", "l", "in", "cur_matches", ".", "values", "(", ")", ":", "\n", "\t\t\t", "check_set", ".", "update", "(", "l", ")", "\n", "\n", "", "connections", "=", "{", "}", "\n", "for", "left_frame", ",", "left_idx", "in", "check_set", ":", "\n", "\t\t\t", "connections", "[", "(", "left_frame", ",", "left_idx", ")", "]", "=", "[", "]", "\n", "\n", "for", "right_idx", "in", "range", "(", "len", "(", "detections", "[", "right_frame", "]", ")", ")", ":", "\n", "\t\t\t\t", "rect1", "=", "to_rect", "(", "detections", "[", "left_frame", "]", "[", "left_idx", "]", ")", "\n", "rect2", "=", "to_rect", "(", "detections", "[", "right_frame", "]", "[", "right_idx", "]", ")", "\n", "intersect_area", "=", "rect1", ".", "intersection", "(", "rect2", ")", ".", "area", "(", ")", "\n", "if", "intersect_area", "<", "0", ":", "\n", "\t\t\t\t\t", "intersect_area", "=", "0", "\n", "", "union_area", "=", "rect1", ".", "area", "(", ")", "+", "rect2", ".", "area", "(", ")", "-", "intersect_area", "\n", "iou_score", "=", "float", "(", "intersect_area", ")", "/", "float", "(", "union_area", ")", "\n", "if", "iou_score", ">", "0.1", ":", "\n", "\t\t\t\t\t", "connections", "[", "(", "left_frame", ",", "left_idx", ")", "]", ".", "append", "(", "(", "right_frame", ",", "right_idx", ")", ")", "\n", "\n", "", "", "", "for", "idx", "in", "cur_matches", ":", "\n", "\t\t\t", "new_matches", "=", "set", "(", ")", "\n", "for", "left_frame", ",", "left_idx", "in", "cur_matches", "[", "idx", "]", ":", "\n", "\t\t\t\t", "new_matches", ".", "update", "(", "connections", "[", "(", "left_frame", ",", "left_idx", ")", "]", ")", "\n", "if", "right_frame", "-", "left_frame", "<", "MAX_MATCH_AGE", ":", "\n", "\t\t\t\t\t", "new_matches", ".", "add", "(", "(", "left_frame", ",", "left_idx", ")", ")", "\n", "", "", "cur_matches", "[", "idx", "]", "=", "new_matches", "\n", "\n", "", "", "final_matches", "=", "{", "}", "\n", "for", "idx", ",", "matches", "in", "cur_matches", ".", "items", "(", ")", ":", "\n", "\t\t", "final_matches", "[", "idx", "]", "=", "[", "right_idx", "for", "right_frame", ",", "right_idx", "in", "matches", "if", "right_frame", "==", "last_frame", "]", "\n", "", "return", "final_matches", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.scripts.preprocess-info.zip_frame_info": [[95, 124], ["FRAME_PATH.format", "skimage.io.imread", "skimage.io.imread", "geom.Rectangle", "enumerate", "geom.Point", "geom.Point", "geom.Rectangle", "min", "numpy.zeros", "info.append", "preprocess-info.get_frame_fname", "geom.Point", "geom.Point", "int", "int", "float", "float", "geom.Rectangle.lengths", "geom.Rectangle.lengths", "float", "float", "skimage.transform.resize", "skimage.transform.resize"], "function", ["home.repos.pwc.inspect_result.favyen_uns20.scripts.preprocess-info.get_frame_fname", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.lengths", "home.repos.pwc.inspect_result.favyen_uns20.None.geom.Rectangle.lengths"], ["", "def", "zip_frame_info", "(", "detections", ",", "label", ",", "frame_idx", ")", ":", "\n", "\t", "if", "not", "detections", ":", "\n", "\t\t", "return", "[", "]", "\n", "", "frame_path", "=", "FRAME_PATH", ".", "format", "(", "label", ")", "\n", "im", "=", "skimage", ".", "io", ".", "imread", "(", "'{}/{}'", ".", "format", "(", "frame_path", ",", "get_frame_fname", "(", "frame_idx", ")", ")", ")", "\n", "im_bounds", "=", "geom", ".", "Rectangle", "(", "\n", "geom", ".", "Point", "(", "0", ",", "0", ")", ",", "\n", "geom", ".", "Point", "(", "im", ".", "shape", "[", "0", "]", ",", "im", ".", "shape", "[", "1", "]", ")", "\n", ")", "\n", "info", "=", "[", "]", "\n", "for", "idx", ",", "detection", "in", "enumerate", "(", "detections", ")", ":", "\n", "\t\t", "rect", "=", "geom", ".", "Rectangle", "(", "\n", "geom", ".", "Point", "(", "detection", "[", "'top'", "]", "/", "FRAME_SCALE", ",", "detection", "[", "'left'", "]", "/", "FRAME_SCALE", ")", ",", "\n", "geom", ".", "Point", "(", "detection", "[", "'bottom'", "]", "/", "FRAME_SCALE", ",", "detection", "[", "'right'", "]", "/", "FRAME_SCALE", ")", "\n", ")", "\n", "if", "rect", ".", "lengths", "(", ")", ".", "x", "<", "4", "or", "rect", ".", "lengths", "(", ")", ".", "y", "<", "4", ":", "\n", "\t\t\t", "continue", "\n", "", "crop", "=", "im", "[", "rect", ".", "start", ".", "x", ":", "rect", ".", "end", ".", "x", ",", "rect", ".", "start", ".", "y", ":", "rect", ".", "end", ".", "y", ",", ":", "]", "\n", "resize_factor", "=", "min", "(", "[", "float", "(", "CROP_SIZE", ")", "/", "crop", ".", "shape", "[", "0", "]", ",", "float", "(", "CROP_SIZE", ")", "/", "crop", ".", "shape", "[", "1", "]", "]", ")", "\n", "resize_shape", "=", "[", "int", "(", "crop", ".", "shape", "[", "0", "]", "*", "resize_factor", ")", ",", "int", "(", "crop", ".", "shape", "[", "1", "]", "*", "resize_factor", ")", "]", "\n", "if", "resize_shape", "[", "0", "]", "==", "0", "or", "resize_shape", "[", "1", "]", "==", "0", ":", "\n", "\t\t\t", "continue", "\n", "", "crop", "=", "(", "skimage", ".", "transform", ".", "resize", "(", "crop", ",", "resize_shape", ")", "*", "255", ")", ".", "astype", "(", "'uint8'", ")", "\n", "fix_crop", "=", "numpy", ".", "zeros", "(", "(", "CROP_SIZE", ",", "CROP_SIZE", ",", "3", ")", ",", "dtype", "=", "'uint8'", ")", "\n", "fix_crop", "[", "0", ":", "crop", ".", "shape", "[", "0", "]", ",", "0", ":", "crop", ".", "shape", "[", "1", "]", ",", ":", "]", "=", "crop", "\n", "detection", "[", "'width'", "]", "=", "float", "(", "detection", "[", "'right'", "]", "-", "detection", "[", "'left'", "]", ")", "/", "ORIG_WIDTH", "\n", "detection", "[", "'height'", "]", "=", "float", "(", "detection", "[", "'bottom'", "]", "-", "detection", "[", "'top'", "]", ")", "/", "ORIG_HEIGHT", "\n", "info", ".", "append", "(", "(", "detection", ",", "fix_crop", ",", "idx", ")", ")", "\n", "", "return", "info", "\n", "\n"]], "home.repos.pwc.inspect_result.favyen_uns20.scripts.preprocess-info.process": [[125, 155], ["PICKLE_PATH.format", "os.path.exists", "os.path.exists", "print", "range", "open", "json.load", "len", "print", "preprocess-info.zip_frame_info", "open", "pickle.dump", "DETECTION_PATH.format"], "function", ["home.repos.pwc.inspect_result.favyen_uns20.scripts.preprocess-info.zip_frame_info"], ["", "def", "process", "(", "label", ")", ":", "\n", "\t", "pickle_path", "=", "PICKLE_PATH", ".", "format", "(", "label", ")", "\n", "if", "os", ".", "path", ".", "exists", "(", "pickle_path", ")", ":", "\n", "\t\t", "return", "\n", "", "print", "(", "'reading from {}'", ".", "format", "(", "label", ")", ")", "\n", "with", "open", "(", "DETECTION_PATH", ".", "format", "(", "label", ")", ",", "'r'", ")", "as", "f", ":", "\n", "\t\t", "detections", "=", "json", ".", "load", "(", "f", ")", "\n", "\n", "", "if", "not", "detections", ":", "\n", "\t\t", "return", "\n", "\n", "", "frame_infos", "=", "{", "}", "\n", "#matches = {}", "\n", "for", "frame_idx", "in", "range", "(", "0", ",", "len", "(", "detections", ")", ",", "SKIP", ")", ":", "\n", "\t\t", "if", "frame_idx", "%", "30000", ">", "10000", ":", "\n", "\t\t\t", "continue", "\n", "", "print", "(", "label", ",", "frame_idx", ")", "\n", "if", "not", "detections", "[", "frame_idx", "]", ":", "\n", "\t\t\t", "continue", "\n", "", "frame_infos", "[", "frame_idx", "]", "=", "zip_frame_info", "(", "detections", "[", "frame_idx", "]", ",", "label", ",", "frame_idx", ")", "\n", "#for match_len in [10, 15, 25, 35, 45, 55, 65]:", "\n", "#\tframe_range = range(frame_idx, frame_idx+match_len+1)", "\n", "#\tif not all([detections[i] is not None and len(detections[i]) > 0 for i in frame_range]):", "\n", "#\t\tcontinue", "\n", "#\tfor i in frame_range:", "\n", "#\t\tframe_infos[i] = zip_frame_info(detections[i], label, i)", "\n", "#\tmatches[(frame_idx, frame_idx+match_len)] = get_potential_matches(detections, frame_idx, frame_idx+match_len)", "\n", "\n", "", "with", "open", "(", "pickle_path", ",", "'wb'", ")", "as", "f", ":", "\n", "\t\t", "pickle", ".", "dump", "(", "frame_infos", ",", "f", ")", "\n", "\n"]]}