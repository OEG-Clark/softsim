{"home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.cnn_model.ConvolutionalNet.__init__": [[7, 21], ["torch.Module.__init__", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Dropout", "torch.Dropout", "torch.ReLU", "torch.ReLU", "torch.Sequential", "torch.Sequential"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "num_channels", ":", "int", ",", "cnn_kernel_size", ":", "int", ",", "num_conv_channels", ":", "int", ",", "dropout_probability", ":", "float", ",", "\n", "stride", "=", "1", ")", ":", "\n", "        ", "super", "(", "ConvolutionalNet", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "conv_1", "=", "nn", ".", "Conv2d", "(", "in_channels", "=", "num_channels", ",", "out_channels", "=", "num_conv_channels", ",", "kernel_size", "=", "1", ",", "\n", "padding", "=", "0", ",", "stride", "=", "stride", ")", "\n", "self", ".", "conv_2", "=", "nn", ".", "Conv2d", "(", "in_channels", "=", "num_channels", ",", "out_channels", "=", "num_conv_channels", ",", "kernel_size", "=", "5", ",", "\n", "stride", "=", "stride", ",", "padding", "=", "2", ")", "\n", "self", ".", "conv_3", "=", "nn", ".", "Conv2d", "(", "in_channels", "=", "num_channels", ",", "out_channels", "=", "num_conv_channels", ",", "kernel_size", "=", "cnn_kernel_size", ",", "\n", "stride", "=", "stride", ",", "padding", "=", "cnn_kernel_size", "//", "2", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "p", "=", "dropout_probability", ")", "\n", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", ")", "\n", "layers", "=", "[", "self", ".", "relu", ",", "self", ".", "dropout", "]", "\n", "self", ".", "layers", "=", "nn", ".", "Sequential", "(", "*", "layers", ")", "\n", "self", ".", "output_dimension", "=", "num_conv_channels", "*", "3", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.cnn_model.ConvolutionalNet.forward": [[22, 37], ["input_images.transpose.transpose.size", "input_images.transpose.transpose.transpose", "cnn_model.ConvolutionalNet.conv_1", "cnn_model.ConvolutionalNet.conv_2", "cnn_model.ConvolutionalNet.conv_3", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "cnn_model.ConvolutionalNet.size", "cnn_model.ConvolutionalNet.transpose", "cnn_model.ConvolutionalNet.layers", "cnn_model.ConvolutionalNet.reshape"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "forward", "(", "self", ",", "input_images", ":", "torch", ".", "Tensor", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "\"\"\"\n        :param input_images: [batch_size, image_width, image_width, image_channels]\n        :return: [batch_size, image_width * image_width, num_conv_channels]\n        \"\"\"", "\n", "batch_size", "=", "input_images", ".", "size", "(", "0", ")", "\n", "input_images", "=", "input_images", ".", "transpose", "(", "1", ",", "3", ")", "\n", "conved_1", "=", "self", ".", "conv_1", "(", "input_images", ")", "\n", "conved_2", "=", "self", ".", "conv_2", "(", "input_images", ")", "\n", "conved_3", "=", "self", ".", "conv_3", "(", "input_images", ")", "\n", "images_features", "=", "torch", ".", "cat", "(", "[", "conved_1", ",", "conved_2", ",", "conved_3", "]", ",", "dim", "=", "1", ")", "\n", "_", ",", "num_channels", ",", "_", ",", "image_dimension", "=", "images_features", ".", "size", "(", ")", "\n", "images_features", "=", "images_features", ".", "transpose", "(", "1", ",", "3", ")", "\n", "images_features", "=", "self", ".", "layers", "(", "images_features", ")", "\n", "return", "images_features", ".", "reshape", "(", "batch_size", ",", "image_dimension", "*", "image_dimension", ",", "num_channels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.cnn_model.DeepConvolutionalNet.__init__": [[41, 55], ["torch.Module.__init__", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Dropout", "torch.Dropout", "torch.ReLU", "torch.ReLU", "torch.Sequential", "torch.Sequential"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "num_channels", ":", "int", ",", "num_conv_channels", ":", "int", ",", "kernel_size", ":", "int", ",", "dropout_probability", ":", "float", ",", "\n", "stride", "=", "1", ")", ":", "\n", "        ", "super", "(", "DeepConvolutionalNet", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "conv_1", "=", "nn", ".", "Conv2d", "(", "in_channels", "=", "num_channels", ",", "out_channels", "=", "num_conv_channels", ",", "kernel_size", "=", "1", ",", "\n", "padding", "=", "0", ",", "stride", "=", "stride", ")", "\n", "self", ".", "conv_2", "=", "nn", ".", "Conv2d", "(", "in_channels", "=", "num_channels", ",", "out_channels", "=", "num_conv_channels", ",", "kernel_size", "=", "3", ",", "\n", "stride", "=", "stride", ",", "padding", "=", "1", ")", "\n", "self", ".", "conv_3", "=", "nn", ".", "Conv2d", "(", "in_channels", "=", "num_channels", ",", "out_channels", "=", "num_conv_channels", ",", "kernel_size", "=", "5", ",", "\n", "stride", "=", "stride", ",", "padding", "=", "2", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "p", "=", "dropout_probability", ")", "\n", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", ")", "\n", "layers", "=", "[", "self", ".", "relu", ",", "self", ".", "dropout", "]", "\n", "self", ".", "layers", "=", "nn", ".", "Sequential", "(", "*", "layers", ")", "\n", "self", ".", "output_dimension", "=", "num_conv_channels", "*", "3", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.cnn_model.DeepConvolutionalNet.forward": [[56, 70], ["input_images.transpose.transpose.size", "input_images.transpose.transpose.transpose", "cnn_model.DeepConvolutionalNet.conv_1", "cnn_model.DeepConvolutionalNet.conv_2", "cnn_model.DeepConvolutionalNet.conv_3", "cnn_model.DeepConvolutionalNet.layers", "images_features.transpose.transpose.size", "images_features.transpose.transpose.transpose", "images_features.transpose.transpose.reshape", "torch.cat", "torch.cat", "torch.cat", "torch.cat"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "forward", "(", "self", ",", "input_images", ":", "torch", ".", "Tensor", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "\"\"\"\n        :param input_images: [batch_size, image_width, image_width, image_channels]\n        :return: [batch_size, image_width * image_width, num_conv_channels]\n        \"\"\"", "\n", "batch_size", "=", "input_images", ".", "size", "(", "0", ")", "\n", "input_images", "=", "input_images", ".", "transpose", "(", "1", ",", "3", ")", "\n", "conved_1", "=", "self", ".", "conv_1", "(", "input_images", ")", "\n", "conved_2", "=", "self", ".", "conv_2", "(", "input_images", ")", "\n", "conved_3", "=", "self", ".", "conv_3", "(", "input_images", ")", "\n", "images_features", "=", "self", ".", "layers", "(", "torch", ".", "cat", "(", "[", "conved_1", ",", "conved_2", ",", "conved_3", "]", ",", "dim", "=", "1", ")", ")", "\n", "_", ",", "num_channels", ",", "_", ",", "image_dimension", "=", "images_features", ".", "size", "(", ")", "\n", "images_features", "=", "images_features", ".", "transpose", "(", "1", ",", "3", ")", "\n", "return", "images_features", ".", "reshape", "(", "batch_size", ",", "image_dimension", "*", "image_dimension", ",", "num_channels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.cnn_model.DownSamplingConvolutionalNet.__init__": [[74, 88], ["torch.Module.__init__", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Dropout2d", "torch.Dropout2d", "torch.ReLU", "torch.ReLU", "torch.Sequential", "torch.Sequential"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "num_channels", ":", "int", ",", "num_conv_channels", ":", "int", ",", "dropout_probability", ":", "float", ")", ":", "\n", "        ", "super", "(", "DownSamplingConvolutionalNet", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "conv_1", "=", "nn", ".", "Conv2d", "(", "in_channels", "=", "num_channels", ",", "out_channels", "=", "num_conv_channels", ",", "kernel_size", "=", "5", ",", "\n", "stride", "=", "5", ")", "\n", "self", ".", "conv_2", "=", "nn", ".", "Conv2d", "(", "in_channels", "=", "num_conv_channels", ",", "out_channels", "=", "num_conv_channels", ",", "kernel_size", "=", "3", ",", "\n", "stride", "=", "3", ",", "padding", "=", "0", ")", "\n", "self", ".", "conv_3", "=", "nn", ".", "Conv2d", "(", "in_channels", "=", "num_conv_channels", ",", "out_channels", "=", "num_conv_channels", ",", "kernel_size", "=", "3", ",", "\n", "stride", "=", "3", ",", "padding", "=", "1", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout2d", "(", "dropout_probability", ")", "\n", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", ")", "\n", "layers", "=", "[", "self", ".", "conv_1", ",", "self", ".", "relu", ",", "self", ".", "dropout", ",", "self", ".", "conv_2", ",", "self", ".", "relu", ",", "self", ".", "dropout", ",", "self", ".", "conv_3", ",", "\n", "self", ".", "relu", ",", "self", ".", "dropout", "]", "\n", "self", ".", "layers", "=", "nn", ".", "Sequential", "(", "*", "layers", ")", "\n", "self", ".", "output_dimension", "=", "num_conv_channels", "*", "3", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.cnn_model.DownSamplingConvolutionalNet.forward": [[89, 100], ["input_images.transpose.transpose.size", "input_images.transpose.transpose.transpose", "cnn_model.DownSamplingConvolutionalNet.layers", "images_features.transpose.transpose.size", "images_features.transpose.transpose.transpose", "images_features.transpose.transpose.reshape"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "forward", "(", "self", ",", "input_images", ":", "torch", ".", "Tensor", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "\"\"\"\n        :param input_images: [batch_size, image_width, image_width, image_channels]\n        :return: [batch_size, 6 * 6, output_dim]\n        \"\"\"", "\n", "batch_size", "=", "input_images", ".", "size", "(", "0", ")", "\n", "input_images", "=", "input_images", ".", "transpose", "(", "1", ",", "3", ")", "\n", "images_features", "=", "self", ".", "layers", "(", "input_images", ")", "\n", "_", ",", "num_channels", ",", "_", ",", "image_dimension", "=", "images_features", ".", "size", "(", ")", "\n", "images_features", "=", "images_features", ".", "transpose", "(", "1", ",", "3", ")", "\n", "return", "images_features", ".", "reshape", "(", "batch_size", ",", "image_dimension", ",", "image_dimension", ",", "num_channels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.predict.predict_and_save": [[16, 61], ["locals().copy", "open", "logger.info", "logger.info", "json.dump", "locals", "torch.no_grad", "torch.no_grad", "torch.no_grad", "predict.predict", "dataset.get_data_iterator", "seq2seq.helpers.sequence_accuracy", "dataset.array_to_sentence", "dataset.array_to_sentence", "dataset.array_to_sentence", "output.append", "input_sequence[].tolist", "target_sequence[].tolist", "target_sequence[].tolist"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_data_iterator", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.helpers.sequence_accuracy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.array_to_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.array_to_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.array_to_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["def", "predict_and_save", "(", "dataset", ":", "GroundedScanDataset", ",", "model", ":", "nn", ".", "Module", ",", "output_file_path", ":", "str", ",", "max_decoding_steps", ":", "int", ",", "\n", "max_testing_examples", "=", "None", ",", "**", "kwargs", ")", ":", "\n", "    ", "\"\"\"\n    Predict all data in dataset with a model and write the predictions to output_file_path.\n    :param dataset: a dataset with test examples\n    :param model: a trained model from model.py\n    :param output_file_path: a path where a .json file with predictions will be saved.\n    :param max_decoding_steps: after how many steps to force quit decoding\n    :param max_testing_examples: after how many examples to stop predicting, if None all examples will be evaluated\n    \"\"\"", "\n", "cfg", "=", "locals", "(", ")", ".", "copy", "(", ")", "\n", "\n", "with", "open", "(", "output_file_path", ",", "mode", "=", "'w'", ")", "as", "outfile", ":", "\n", "        ", "output", "=", "[", "]", "\n", "num_exact_matches", "=", "0", "\n", "num_total", "=", "0", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "i", "=", "0", "\n", "for", "(", "input_sequence", ",", "derivation_spec", ",", "situation_spec", ",", "output_sequence", ",", "target_sequence", ",", "\n", "attention_weights_commands", ",", "attention_weights_situations", ",", "position_accuracy", ")", "in", "predict", "(", "\n", "dataset", ".", "get_data_iterator", "(", "batch_size", "=", "1", ")", ",", "model", "=", "model", ",", "max_decoding_steps", "=", "max_decoding_steps", ",", "\n", "pad_idx", "=", "dataset", ".", "target_vocabulary", ".", "pad_idx", ",", "sos_idx", "=", "dataset", ".", "target_vocabulary", ".", "sos_idx", ",", "\n", "eos_idx", "=", "dataset", ".", "target_vocabulary", ".", "eos_idx", ")", ":", "\n", "                ", "i", "+=", "1", "\n", "accuracy", "=", "sequence_accuracy", "(", "output_sequence", ",", "target_sequence", "[", "0", "]", ".", "tolist", "(", ")", "[", "1", ":", "-", "1", "]", ")", "\n", "input_str_sequence", "=", "dataset", ".", "array_to_sentence", "(", "input_sequence", "[", "0", "]", ".", "tolist", "(", ")", ",", "vocabulary", "=", "\"input\"", ")", "\n", "input_str_sequence", "=", "input_str_sequence", "[", "1", ":", "-", "1", "]", "# Get rid of <SOS> and <EOS>", "\n", "target_str_sequence", "=", "dataset", ".", "array_to_sentence", "(", "target_sequence", "[", "0", "]", ".", "tolist", "(", ")", ",", "vocabulary", "=", "\"target\"", ")", "\n", "target_str_sequence", "=", "target_str_sequence", "[", "1", ":", "-", "1", "]", "# Get rid of <SOS> and <EOS>", "\n", "output_str_sequence", "=", "dataset", ".", "array_to_sentence", "(", "output_sequence", ",", "vocabulary", "=", "\"target\"", ")", "\n", "output", ".", "append", "(", "{", "\"input\"", ":", "input_str_sequence", ",", "\"prediction\"", ":", "output_str_sequence", ",", "\n", "\"derivation\"", ":", "derivation_spec", ",", "\n", "\"target\"", ":", "target_str_sequence", ",", "\"situation\"", ":", "situation_spec", ",", "\n", "\"attention_weights_input\"", ":", "attention_weights_commands", ",", "\n", "\"attention_weights_situation\"", ":", "attention_weights_situations", ",", "\n", "\"accuracy\"", ":", "accuracy", ",", "\n", "\"exact_match\"", ":", "True", "if", "accuracy", "==", "100", "else", "False", ",", "\n", "\"position_accuracy\"", ":", "position_accuracy", "}", ")", "\n", "if", "accuracy", "==", "100", ":", "\n", "                    ", "num_exact_matches", "+=", "1", "\n", "", "num_total", "+=", "1", "\n", "", "", "logger", ".", "info", "(", "\"Wrote predictions for {} examples.\"", ".", "format", "(", "i", ")", ")", "\n", "logger", ".", "info", "(", "\"Average exact match: {}\"", ".", "format", "(", "num_exact_matches", "/", "num_total", ")", ")", "\n", "json", ".", "dump", "(", "output", ",", "outfile", ",", "indent", "=", "4", ")", "\n", "", "return", "output_file_path", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.predict.predict": [[63, 135], ["model.eval", "time.time", "logging.info", "logging.info", "model.encode_input", "model.visual_attention.key_layer", "model.textual_attention.key_layer", "model.attention_decoder.initialize_hidden", "torch.tensor", "torch.tensor", "torch.tensor", "time.time", "model.tanh", "model.decode_input", "torch.log_softmax", "output_sequence.append", "attention_weights_commands.append", "attention_weights_situations.append", "contexts_situation.append", "output_sequence.pop", "attention_weights_commands.pop", "attention_weights_situations.pop", "model.auxiliary_task_forward", "model.get_auxiliary_accuracy", "model.enc_hidden_to_dec_hidden", "F.log_softmax.max", "torch.tensor.data[].item", "attention_weights_command.tolist", "attention_weights_situation.tolist", "context_situation.unsqueeze", "torch.cat().sum", "torch.cat().sum", "torch.cat().sum", "torch.cat", "torch.cat", "torch.cat"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.encode_input", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.initialize_hidden", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.decode_input", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.auxiliary_task_forward", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.get_auxiliary_accuracy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max"], ["", "def", "predict", "(", "data_iterator", ":", "Iterator", ",", "model", ":", "nn", ".", "Module", ",", "max_decoding_steps", ":", "int", ",", "pad_idx", ":", "int", ",", "sos_idx", ":", "int", ",", "\n", "eos_idx", ":", "int", ",", "max_examples_to_evaluate", "=", "None", ")", "->", "torch", ".", "Tensor", ":", "\n", "    ", "\"\"\"\n    Loop over all data in data_iterator and predict until <EOS> token is reached.\n    :param data_iterator: iterator containing the data to predict\n    :param model: a trained model from model.py\n    :param max_decoding_steps: after how many steps to abort decoding\n    :param pad_idx: the padding idx of the target vocabulary\n    :param sos_idx: the start-of-sequence idx of the target vocabulary\n    :param eos_idx: the end-of-sequence idx of the target vocabulary\n    :param: max_examples_to_evaluate: after how many examples to break prediction, if none all are predicted\n    \"\"\"", "\n", "# Disable dropout and other regularization.", "\n", "model", ".", "eval", "(", ")", "\n", "start_time", "=", "time", ".", "time", "(", ")", "\n", "\n", "# Loop over the data.", "\n", "i", "=", "0", "\n", "for", "(", "input_sequence", ",", "input_lengths", ",", "derivation_spec", ",", "situation", ",", "situation_spec", ",", "target_sequence", ",", "\n", "target_lengths", ",", "agent_positions", ",", "target_positions", ")", "in", "data_iterator", ":", "\n", "        ", "i", "+=", "1", "\n", "if", "max_examples_to_evaluate", ":", "\n", "            ", "if", "i", ">", "max_examples_to_evaluate", ":", "\n", "                ", "break", "\n", "# Encode the input sequence.", "\n", "", "", "encoded_input", "=", "model", ".", "encode_input", "(", "commands_input", "=", "input_sequence", ",", "\n", "commands_lengths", "=", "input_lengths", ",", "\n", "situations_input", "=", "situation", ")", "\n", "\n", "# For efficiency", "\n", "projected_keys_visual", "=", "model", ".", "visual_attention", ".", "key_layer", "(", "\n", "encoded_input", "[", "\"encoded_situations\"", "]", ")", "# [bsz, situation_length, dec_hidden_dim]", "\n", "projected_keys_textual", "=", "model", ".", "textual_attention", ".", "key_layer", "(", "\n", "encoded_input", "[", "\"encoded_commands\"", "]", "[", "\"encoder_outputs\"", "]", ")", "# [max_input_length, bsz, dec_hidden_dim]", "\n", "\n", "# Iteratively decode the output.", "\n", "output_sequence", "=", "[", "]", "\n", "contexts_situation", "=", "[", "]", "\n", "hidden", "=", "model", ".", "attention_decoder", ".", "initialize_hidden", "(", "\n", "model", ".", "tanh", "(", "model", ".", "enc_hidden_to_dec_hidden", "(", "encoded_input", "[", "\"hidden_states\"", "]", ")", ")", ")", "\n", "token", "=", "torch", ".", "tensor", "(", "[", "sos_idx", "]", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", "\n", "decoding_iteration", "=", "0", "\n", "attention_weights_commands", "=", "[", "]", "\n", "attention_weights_situations", "=", "[", "]", "\n", "while", "token", "!=", "eos_idx", "and", "decoding_iteration", "<=", "max_decoding_steps", ":", "\n", "            ", "(", "output", ",", "hidden", ",", "context_situation", ",", "attention_weights_command", ",", "\n", "attention_weights_situation", ")", "=", "model", ".", "decode_input", "(", "\n", "target_token", "=", "token", ",", "hidden", "=", "hidden", ",", "encoder_outputs", "=", "projected_keys_textual", ",", "\n", "input_lengths", "=", "input_lengths", ",", "encoded_situations", "=", "projected_keys_visual", ")", "\n", "output", "=", "F", ".", "log_softmax", "(", "output", ",", "dim", "=", "-", "1", ")", "\n", "token", "=", "output", ".", "max", "(", "dim", "=", "-", "1", ")", "[", "1", "]", "\n", "output_sequence", ".", "append", "(", "token", ".", "data", "[", "0", "]", ".", "item", "(", ")", ")", "\n", "attention_weights_commands", ".", "append", "(", "attention_weights_command", ".", "tolist", "(", ")", ")", "\n", "attention_weights_situations", ".", "append", "(", "attention_weights_situation", ".", "tolist", "(", ")", ")", "\n", "contexts_situation", ".", "append", "(", "context_situation", ".", "unsqueeze", "(", "1", ")", ")", "\n", "decoding_iteration", "+=", "1", "\n", "\n", "", "if", "output_sequence", "[", "-", "1", "]", "==", "eos_idx", ":", "\n", "            ", "output_sequence", ".", "pop", "(", ")", "\n", "attention_weights_commands", ".", "pop", "(", ")", "\n", "attention_weights_situations", ".", "pop", "(", ")", "\n", "", "if", "model", ".", "auxiliary_task", ":", "\n", "            ", "target_position_scores", "=", "model", ".", "auxiliary_task_forward", "(", "torch", ".", "cat", "(", "contexts_situation", ",", "dim", "=", "1", ")", ".", "sum", "(", "dim", "=", "1", ")", ")", "\n", "auxiliary_accuracy_target", "=", "model", ".", "get_auxiliary_accuracy", "(", "target_position_scores", ",", "target_positions", ")", "\n", "", "else", ":", "\n", "            ", "auxiliary_accuracy_agent", ",", "auxiliary_accuracy_target", "=", "0", ",", "0", "\n", "", "yield", "(", "input_sequence", ",", "derivation_spec", ",", "situation_spec", ",", "output_sequence", ",", "target_sequence", ",", "\n", "attention_weights_commands", ",", "attention_weights_situations", ",", "auxiliary_accuracy_target", ")", "\n", "\n", "", "elapsed_time", "=", "time", ".", "time", "(", ")", "-", "start_time", "\n", "logging", ".", "info", "(", "\"Predicted for {} examples.\"", ".", "format", "(", "i", ")", ")", "\n", "logging", ".", "info", "(", "\"Done predicting in {} seconds.\"", ".", "format", "(", "elapsed_time", ")", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.evaluate.evaluate": [[10, 25], ["seq2seq.predict.predict", "seq2seq.helpers.sequence_accuracy", "accuracies.append", "target_accuracies.append", "float", "float", "numpy.mean", "numpy.mean", "target_sequence[].tolist", "numpy.array", "len", "numpy.array"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.helpers.sequence_accuracy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["def", "evaluate", "(", "data_iterator", ":", "Iterator", ",", "model", ":", "nn", ".", "Module", ",", "max_decoding_steps", ":", "int", ",", "pad_idx", ":", "int", ",", "sos_idx", ":", "int", ",", "\n", "eos_idx", ":", "int", ",", "max_examples_to_evaluate", "=", "None", ")", "->", "Tuple", "[", "float", ",", "float", ",", "float", "]", ":", "\n", "    ", "accuracies", "=", "[", "]", "\n", "target_accuracies", "=", "[", "]", "\n", "exact_match", "=", "0", "\n", "for", "input_sequence", ",", "_", ",", "_", ",", "output_sequence", ",", "target_sequence", ",", "_", ",", "_", ",", "aux_acc_target", "in", "predict", "(", "\n", "data_iterator", "=", "data_iterator", ",", "model", "=", "model", ",", "max_decoding_steps", "=", "max_decoding_steps", ",", "pad_idx", "=", "pad_idx", ",", "\n", "sos_idx", "=", "sos_idx", ",", "eos_idx", "=", "eos_idx", ",", "max_examples_to_evaluate", "=", "max_examples_to_evaluate", ")", ":", "\n", "        ", "accuracy", "=", "sequence_accuracy", "(", "output_sequence", ",", "target_sequence", "[", "0", "]", ".", "tolist", "(", ")", "[", "1", ":", "-", "1", "]", ")", "\n", "if", "accuracy", "==", "100", ":", "\n", "            ", "exact_match", "+=", "1", "\n", "", "accuracies", ".", "append", "(", "accuracy", ")", "\n", "target_accuracies", ".", "append", "(", "aux_acc_target", ")", "\n", "", "return", "(", "float", "(", "np", ".", "mean", "(", "np", ".", "array", "(", "accuracies", ")", ")", ")", ",", "(", "exact_match", "/", "len", "(", "accuracies", ")", ")", "*", "100", ",", "\n", "float", "(", "np", ".", "mean", "(", "np", ".", "array", "(", "target_accuracies", ")", ")", ")", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.train.train": [[18, 162], ["locals().copy", "torch.manual_seed", "logger.info", "seq2seq.gSCAN_dataset.GroundedScanDataset", "logger.info", "logger.info", "logger.info", "logger.info", "logger.info", "logger.info", "logger.info", "seq2seq.gSCAN_dataset.GroundedScanDataset", "seq2seq.gSCAN_dataset.GroundedScanDataset.shuffle_data", "logger.info", "seq2seq.model.Model", "model.to.to", "seq2seq.helpers.log_parameters", "torch.optim.Adam", "torch.optim.lr_scheduler.LambdaLR", "float", "logger.info", "logger.info", "torch.device", "torch.device", "seq2seq.gSCAN_dataset.GroundedScanDataset.save_vocabularies", "logger.info", "os.path.isfile", "logger.info", "model.to.load_model", "torch.optim.Adam.load_state_dict", "logger.info", "seq2seq.gSCAN_dataset.GroundedScanDataset.get_data_iterator", "locals", "seq2seq.gSCAN_dataset.GroundedScanDataset.input_vocabulary.most_common", "seq2seq.gSCAN_dataset.GroundedScanDataset.target_vocabulary.most_common", "model.to.parameters", "model.to.train", "model.to.", "model.to.get_loss", "model.get_loss.backward", "torch.optim.Adam.step", "torch.optim.lr_scheduler.LambdaLR.step", "torch.optim.Adam.zero_grad", "model.to.update_state", "model.to.get_auxiliary_loss", "model.to.get_metrics", "logger.info", "model.to.get_auxiliary_accuracy", "torch.optim.lr_scheduler.LambdaLR.get_lr", "torch.no_grad", "model.to.eval", "logger.info", "seq2seq.evaluate.evaluate", "logger.info", "seq2seq.gSCAN_dataset.GroundedScanDataset.get_data_iterator", "model.to.update_state", "str", "model.to.save_checkpoint", "torch.optim.Adam.state_dict"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.shuffle_data", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.helpers.log_parameters", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.save_vocabularies", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.helpers.load_model", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_data_iterator", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.most_common", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.most_common", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.train.train", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_loss", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.update_state", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.get_auxiliary_loss", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_metrics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.get_auxiliary_accuracy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.evaluate.evaluate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_data_iterator", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.update_state", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.save_checkpoint"], ["num_decoder_layers", ":", "int", ",", "decoder_dropout_p", ":", "float", ",", "cnn_kernel_size", ":", "int", ",", "cnn_dropout_p", ":", "float", ",", "\n", "cnn_hidden_num_channels", ":", "int", ",", "simple_situation_representation", ":", "bool", ",", "decoder_hidden_size", ":", "int", ",", "\n", "encoder_hidden_size", ":", "int", ",", "learning_rate", ":", "float", ",", "adam_beta_1", ":", "float", ",", "adam_beta_2", ":", "float", ",", "lr_decay", ":", "float", ",", "\n", "lr_decay_steps", ":", "int", ",", "resume_from_file", ":", "str", ",", "max_training_iterations", ":", "int", ",", "output_directory", ":", "str", ",", "\n", "print_every", ":", "int", ",", "evaluate_every", ":", "int", ",", "conditional_attention", ":", "bool", ",", "auxiliary_task", ":", "bool", ",", "\n", "weight_target_loss", ":", "float", ",", "attention_type", ":", "str", ",", "k", ":", "int", ",", "max_training_examples", "=", "None", ",", "seed", "=", "42", ",", "**", "kwargs", ")", ":", "\n", "    ", "device", "=", "torch", ".", "device", "(", "type", "=", "'cuda'", ")", "if", "use_cuda", "else", "torch", ".", "device", "(", "type", "=", "'cpu'", ")", "\n", "cfg", "=", "locals", "(", ")", ".", "copy", "(", ")", "\n", "\n", "torch", ".", "manual_seed", "(", "seed", ")", "\n", "\n", "logger", ".", "info", "(", "\"Loading Training set...\"", ")", "\n", "training_set", "=", "GroundedScanDataset", "(", "data_path", ",", "data_directory", ",", "split", "=", "\"train\"", ",", "\n", "input_vocabulary_file", "=", "input_vocab_path", ",", "\n", "target_vocabulary_file", "=", "target_vocab_path", ",", "\n", "generate_vocabulary", "=", "generate_vocabularies", ",", "k", "=", "k", ")", "\n", "training_set", ".", "read_dataset", "(", "max_examples", "=", "max_training_examples", ",", "\n", "simple_situation_representation", "=", "simple_situation_representation", ")", "\n", "logger", ".", "info", "(", "\"Done Loading Training set.\"", ")", "\n", "logger", ".", "info", "(", "\"  Loaded {} training examples.\"", ".", "format", "(", "training_set", ".", "num_examples", ")", ")", "\n", "logger", ".", "info", "(", "\"  Input vocabulary size training set: {}\"", ".", "format", "(", "training_set", ".", "input_vocabulary_size", ")", ")", "\n", "logger", ".", "info", "(", "\"  Most common input words: {}\"", ".", "format", "(", "training_set", ".", "input_vocabulary", ".", "most_common", "(", "5", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"  Output vocabulary size training set: {}\"", ".", "format", "(", "training_set", ".", "target_vocabulary_size", ")", ")", "\n", "logger", ".", "info", "(", "\"  Most common target words: {}\"", ".", "format", "(", "training_set", ".", "target_vocabulary", ".", "most_common", "(", "5", ")", ")", ")", "\n", "\n", "if", "generate_vocabularies", ":", "\n", "        ", "training_set", ".", "save_vocabularies", "(", "input_vocab_path", ",", "target_vocab_path", ")", "\n", "logger", ".", "info", "(", "\"Saved vocabularies to {} for input and {} for target.\"", ".", "format", "(", "input_vocab_path", ",", "target_vocab_path", ")", ")", "\n", "\n", "", "logger", ".", "info", "(", "\"Loading Dev. set...\"", ")", "\n", "test_set", "=", "GroundedScanDataset", "(", "data_path", ",", "data_directory", ",", "split", "=", "\"dev\"", ",", "# TODO: use dev set here", "\n", "input_vocabulary_file", "=", "input_vocab_path", ",", "\n", "target_vocabulary_file", "=", "target_vocab_path", ",", "generate_vocabulary", "=", "False", ",", "k", "=", "0", ")", "\n", "test_set", ".", "read_dataset", "(", "max_examples", "=", "None", ",", "\n", "simple_situation_representation", "=", "simple_situation_representation", ")", "\n", "\n", "# Shuffle the test set to make sure that if we only evaluate max_testing_examples we get a random part of the set.", "\n", "test_set", ".", "shuffle_data", "(", ")", "\n", "logger", ".", "info", "(", "\"Done Loading Dev. set.\"", ")", "\n", "\n", "model", "=", "Model", "(", "input_vocabulary_size", "=", "training_set", ".", "input_vocabulary_size", ",", "\n", "target_vocabulary_size", "=", "training_set", ".", "target_vocabulary_size", ",", "\n", "num_cnn_channels", "=", "training_set", ".", "image_channels", ",", "\n", "input_padding_idx", "=", "training_set", ".", "input_vocabulary", ".", "pad_idx", ",", "\n", "target_pad_idx", "=", "training_set", ".", "target_vocabulary", ".", "pad_idx", ",", "\n", "target_eos_idx", "=", "training_set", ".", "target_vocabulary", ".", "eos_idx", ",", "\n", "**", "cfg", ")", "\n", "model", "=", "model", ".", "cuda", "(", ")", "if", "use_cuda", "else", "model", "\n", "log_parameters", "(", "model", ")", "\n", "trainable_parameters", "=", "[", "parameter", "for", "parameter", "in", "model", ".", "parameters", "(", ")", "if", "parameter", ".", "requires_grad", "]", "\n", "optimizer", "=", "torch", ".", "optim", ".", "Adam", "(", "trainable_parameters", ",", "lr", "=", "learning_rate", ",", "betas", "=", "(", "adam_beta_1", ",", "adam_beta_2", ")", ")", "\n", "scheduler", "=", "LambdaLR", "(", "optimizer", ",", "\n", "lr_lambda", "=", "lambda", "t", ":", "lr_decay", "**", "(", "t", "/", "lr_decay_steps", ")", ")", "\n", "\n", "# Load model and vocabularies if resuming.", "\n", "start_iteration", "=", "1", "\n", "best_iteration", "=", "1", "\n", "best_accuracy", "=", "0", "\n", "best_exact_match", "=", "0", "\n", "best_loss", "=", "float", "(", "'inf'", ")", "\n", "if", "resume_from_file", ":", "\n", "        ", "assert", "os", ".", "path", ".", "isfile", "(", "resume_from_file", ")", ",", "\"No checkpoint found at {}\"", ".", "format", "(", "resume_from_file", ")", "\n", "logger", ".", "info", "(", "\"Loading checkpoint from file at '{}'\"", ".", "format", "(", "resume_from_file", ")", ")", "\n", "optimizer_state_dict", "=", "model", ".", "load_model", "(", "resume_from_file", ")", "\n", "optimizer", ".", "load_state_dict", "(", "optimizer_state_dict", ")", "\n", "start_iteration", "=", "model", ".", "trained_iterations", "\n", "logger", ".", "info", "(", "\"Loaded checkpoint '{}' (iter {})\"", ".", "format", "(", "resume_from_file", ",", "start_iteration", ")", ")", "\n", "\n", "", "logger", ".", "info", "(", "\"Training starts..\"", ")", "\n", "training_iteration", "=", "start_iteration", "\n", "while", "training_iteration", "<", "max_training_iterations", ":", "\n", "\n", "# Shuffle the dataset and loop over it.", "\n", "        ", "training_set", ".", "shuffle_data", "(", ")", "\n", "for", "(", "input_batch", ",", "input_lengths", ",", "_", ",", "situation_batch", ",", "_", ",", "target_batch", ",", "\n", "target_lengths", ",", "agent_positions", ",", "target_positions", ")", "in", "training_set", ".", "get_data_iterator", "(", "\n", "batch_size", "=", "training_batch_size", ")", ":", "\n", "            ", "is_best", "=", "False", "\n", "model", ".", "train", "(", ")", "\n", "\n", "# Forward pass.", "\n", "target_scores", ",", "target_position_scores", "=", "model", "(", "commands_input", "=", "input_batch", ",", "commands_lengths", "=", "input_lengths", ",", "\n", "situations_input", "=", "situation_batch", ",", "target_batch", "=", "target_batch", ",", "\n", "target_lengths", "=", "target_lengths", ")", "\n", "loss", "=", "model", ".", "get_loss", "(", "target_scores", ",", "target_batch", ")", "\n", "if", "auxiliary_task", ":", "\n", "                ", "target_loss", "=", "model", ".", "get_auxiliary_loss", "(", "target_position_scores", ",", "target_positions", ")", "\n", "", "else", ":", "\n", "                ", "target_loss", "=", "0", "\n", "", "loss", "+=", "weight_target_loss", "*", "target_loss", "\n", "\n", "# Backward pass and update model parameters.", "\n", "loss", ".", "backward", "(", ")", "\n", "optimizer", ".", "step", "(", ")", "\n", "scheduler", ".", "step", "(", ")", "\n", "optimizer", ".", "zero_grad", "(", ")", "\n", "model", ".", "update_state", "(", "is_best", "=", "is_best", ")", "\n", "\n", "# Print current metrics.", "\n", "if", "training_iteration", "%", "print_every", "==", "0", ":", "\n", "                ", "accuracy", ",", "exact_match", "=", "model", ".", "get_metrics", "(", "target_scores", ",", "target_batch", ")", "\n", "if", "auxiliary_task", ":", "\n", "                    ", "auxiliary_accuracy_target", "=", "model", ".", "get_auxiliary_accuracy", "(", "target_position_scores", ",", "target_positions", ")", "\n", "", "else", ":", "\n", "                    ", "auxiliary_accuracy_target", "=", "0.", "\n", "", "learning_rate", "=", "scheduler", ".", "get_lr", "(", ")", "[", "0", "]", "\n", "logger", ".", "info", "(", "\"Iteration %08d, loss %8.4f, accuracy %5.2f, exact match %5.2f, learning_rate %.5f,\"", "\n", "\" aux. accuracy target pos %5.2f\"", "%", "(", "training_iteration", ",", "loss", ",", "accuracy", ",", "exact_match", ",", "\n", "learning_rate", ",", "auxiliary_accuracy_target", ")", ")", "\n", "\n", "# Evaluate on test set.", "\n", "", "if", "training_iteration", "%", "evaluate_every", "==", "0", ":", "\n", "                ", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "                    ", "model", ".", "eval", "(", ")", "\n", "logger", ".", "info", "(", "\"Evaluating..\"", ")", "\n", "accuracy", ",", "exact_match", ",", "target_accuracy", "=", "evaluate", "(", "\n", "test_set", ".", "get_data_iterator", "(", "batch_size", "=", "1", ")", ",", "model", "=", "model", ",", "\n", "max_decoding_steps", "=", "max_decoding_steps", ",", "pad_idx", "=", "test_set", ".", "target_vocabulary", ".", "pad_idx", ",", "\n", "sos_idx", "=", "test_set", ".", "target_vocabulary", ".", "sos_idx", ",", "\n", "eos_idx", "=", "test_set", ".", "target_vocabulary", ".", "eos_idx", ",", "\n", "max_examples_to_evaluate", "=", "kwargs", "[", "\"max_testing_examples\"", "]", ")", "\n", "logger", ".", "info", "(", "\"  Evaluation Accuracy: %5.2f Exact Match: %5.2f \"", "\n", "\" Target Accuracy: %5.2f\"", "%", "(", "accuracy", ",", "exact_match", ",", "target_accuracy", ")", ")", "\n", "if", "exact_match", ">", "best_exact_match", ":", "\n", "                        ", "is_best", "=", "True", "\n", "best_accuracy", "=", "accuracy", "\n", "best_exact_match", "=", "exact_match", "\n", "model", ".", "update_state", "(", "accuracy", "=", "accuracy", ",", "exact_match", "=", "exact_match", ",", "is_best", "=", "is_best", ")", "\n", "", "file_name", "=", "\"checkpoint.pth.tar\"", ".", "format", "(", "str", "(", "training_iteration", ")", ")", "\n", "if", "is_best", ":", "\n", "                        ", "model", ".", "save_checkpoint", "(", "file_name", "=", "file_name", ",", "is_best", "=", "is_best", ",", "\n", "optimizer_state_dict", "=", "optimizer", ".", "state_dict", "(", ")", ")", "\n", "\n", "", "", "", "training_iteration", "+=", "1", "\n", "if", "training_iteration", ">", "max_training_iterations", ":", "\n", "                ", "break", "\n", "", "", "", "logger", ".", "info", "(", "\"Finished training.\"", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.__main__.main": [[108, 195], ["flags.items", "os.path.join", "ValueError", "os.path.exists", "os.mkdir", "NotImplementedError", "NotImplementedError", "logger.info", "seq2seq.train.train", "os.path.join", "ValueError", "flags[].split", "os.getcwd", "os.path.exists", "os.path.exists", "logger.info", "seq2seq.gSCAN_dataset.GroundedScanDataset", "seq2seq.gSCAN_dataset.GroundedScanDataset.read_dataset", "logger.info", "logger.info", "logger.info", "logger.info", "logger.info", "logger.info", "seq2seq.model.Model", "os.path.isfile", "logger.info", "seq2seq.model.Model.load_model", "logger.info", "os.path.join", "seq2seq.predict.predict_and_save", "logger.info", "NotImplementedError", "ValueError", "os.path.join", "os.path.join", "seq2seq.model.Model.cuda", "seq2seq.gSCAN_dataset.GroundedScanDataset.input_vocabulary.most_common", "seq2seq.gSCAN_dataset.GroundedScanDataset.target_vocabulary.most_common"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.train.train", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.read_dataset", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.helpers.load_model", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_and_save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.most_common", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.most_common"], ["\n", "", "if", "not", "os", ".", "path", ".", "exists", "(", "flags", "[", "\"output_directory\"", "]", ")", ":", "\n", "        ", "os", ".", "mkdir", "(", "os", ".", "path", ".", "join", "(", "os", ".", "getcwd", "(", ")", ",", "flags", "[", "\"output_directory\"", "]", ")", ")", "\n", "\n", "", "if", "not", "flags", "[", "\"simple_situation_representation\"", "]", ":", "\n", "        ", "raise", "NotImplementedError", "(", "\"Full RGB input image not implemented. Implement or set \"", "\n", "\"--simple_situation_representation\"", ")", "\n", "# Some checks on the flags", "\n", "", "if", "flags", "[", "\"generate_vocabularies\"", "]", ":", "\n", "        ", "assert", "flags", "[", "\"input_vocab_path\"", "]", "and", "flags", "[", "\"target_vocab_path\"", "]", ",", "\"Please specify paths to vocabularies to save.\"", "\n", "\n", "", "if", "flags", "[", "\"test_batch_size\"", "]", ">", "1", ":", "\n", "        ", "raise", "NotImplementedError", "(", "\"Test batch size larger than 1 not implemented.\"", ")", "\n", "\n", "", "data_path", "=", "os", ".", "path", ".", "join", "(", "flags", "[", "\"data_directory\"", "]", ",", "\"dataset.txt\"", ")", "\n", "if", "flags", "[", "\"mode\"", "]", "==", "\"train\"", ":", "\n", "        ", "train", "(", "data_path", "=", "data_path", ",", "**", "flags", ")", "\n", "", "elif", "flags", "[", "\"mode\"", "]", "==", "\"test\"", ":", "\n", "        ", "assert", "os", ".", "path", ".", "exists", "(", "os", ".", "path", ".", "join", "(", "flags", "[", "\"data_directory\"", "]", ",", "flags", "[", "\"input_vocab_path\"", "]", ")", ")", "and", "os", ".", "path", ".", "exists", "(", "\n", "os", ".", "path", ".", "join", "(", "flags", "[", "\"data_directory\"", "]", ",", "flags", "[", "\"target_vocab_path\"", "]", ")", ")", ",", "\"No vocabs found at {} and {}\"", ".", "format", "(", "flags", "[", "\"input_vocab_path\"", "]", ",", "flags", "[", "\"target_vocab_path\"", "]", ")", "\n", "splits", "=", "flags", "[", "\"splits\"", "]", ".", "split", "(", "\",\"", ")", "\n", "for", "split", "in", "splits", ":", "\n", "            ", "logger", ".", "info", "(", "\"Loading {} dataset split...\"", ".", "format", "(", "split", ")", ")", "\n", "test_set", "=", "GroundedScanDataset", "(", "data_path", ",", "flags", "[", "\"data_directory\"", "]", ",", "split", "=", "split", ",", "\n", "input_vocabulary_file", "=", "flags", "[", "\"input_vocab_path\"", "]", ",", "\n", "target_vocabulary_file", "=", "flags", "[", "\"target_vocab_path\"", "]", ",", "generate_vocabulary", "=", "False", ",", "\n", "k", "=", "flags", "[", "\"k\"", "]", ")", "\n", "test_set", ".", "read_dataset", "(", "max_examples", "=", "None", ",", "\n", "simple_situation_representation", "=", "flags", "[", "\"simple_situation_representation\"", "]", ")", "\n", "logger", ".", "info", "(", "\"Done Loading {} dataset split.\"", ".", "format", "(", "flags", "[", "\"split\"", "]", ")", ")", "\n", "logger", ".", "info", "(", "\"  Loaded {} examples.\"", ".", "format", "(", "test_set", ".", "num_examples", ")", ")", "\n", "logger", ".", "info", "(", "\"  Input vocabulary size: {}\"", ".", "format", "(", "test_set", ".", "input_vocabulary_size", ")", ")", "\n", "logger", ".", "info", "(", "\"  Most common input words: {}\"", ".", "format", "(", "test_set", ".", "input_vocabulary", ".", "most_common", "(", "5", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"  Output vocabulary size: {}\"", ".", "format", "(", "test_set", ".", "target_vocabulary_size", ")", ")", "\n", "logger", ".", "info", "(", "\"  Most common target words: {}\"", ".", "format", "(", "test_set", ".", "target_vocabulary", ".", "most_common", "(", "5", ")", ")", ")", "\n", "\n", "model", "=", "Model", "(", "input_vocabulary_size", "=", "test_set", ".", "input_vocabulary_size", ",", "\n", "target_vocabulary_size", "=", "test_set", ".", "target_vocabulary_size", ",", "\n", "num_cnn_channels", "=", "test_set", ".", "image_channels", ",", "\n", "input_padding_idx", "=", "test_set", ".", "input_vocabulary", ".", "pad_idx", ",", "\n", "target_pad_idx", "=", "test_set", ".", "target_vocabulary", ".", "pad_idx", ",", "\n", "target_eos_idx", "=", "test_set", ".", "target_vocabulary", ".", "eos_idx", ",", "\n", "**", "flags", ")", "\n", "model", "=", "model", ".", "cuda", "(", ")", "if", "use_cuda", "else", "model", "\n", "\n", "# Load model and vocabularies if resuming.", "\n", "assert", "os", ".", "path", ".", "isfile", "(", "flags", "[", "\"resume_from_file\"", "]", ")", ",", "\"No checkpoint found at {}\"", ".", "format", "(", "flags", "[", "\"resume_from_file\"", "]", ")", "\n", "logger", ".", "info", "(", "\"Loading checkpoint from file at '{}'\"", ".", "format", "(", "flags", "[", "\"resume_from_file\"", "]", ")", ")", "\n", "model", ".", "load_model", "(", "flags", "[", "\"resume_from_file\"", "]", ")", "\n", "start_iteration", "=", "model", ".", "trained_iterations", "\n", "logger", ".", "info", "(", "\"Loaded checkpoint '{}' (iter {})\"", ".", "format", "(", "flags", "[", "\"resume_from_file\"", "]", ",", "start_iteration", ")", ")", "\n", "output_file_name", "=", "\"_\"", ".", "join", "(", "[", "split", ",", "flags", "[", "\"output_file_name\"", "]", "]", ")", "\n", "output_file_path", "=", "os", ".", "path", ".", "join", "(", "flags", "[", "\"output_directory\"", "]", ",", "output_file_name", ")", "\n", "output_file", "=", "predict_and_save", "(", "dataset", "=", "test_set", ",", "model", "=", "model", ",", "output_file_path", "=", "output_file_path", ",", "**", "flags", ")", "\n", "logger", ".", "info", "(", "\"Saved predictions to {}\"", ".", "format", "(", "output_file", ")", ")", "\n", "", "", "elif", "flags", "[", "\"mode\"", "]", "==", "\"predict\"", ":", "\n", "        ", "raise", "NotImplementedError", "(", ")", "\n", "", "else", ":", "\n", "        ", "raise", "ValueError", "(", "\"Wrong value for parameters --mode ({}).\"", ".", "format", "(", "flags", "[", "\"mode\"", "]", ")", ")", "\n", "\n", "\n", "", "", "if", "__name__", "==", "\"__main__\"", ":", "\n", "    ", "input_flags", "=", "vars", "(", "parser", ".", "parse_args", "(", ")", ")", "\n", "main", "(", "flags", "=", "input_flags", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.__init__": [[26, 112], ["torch.Module.__init__", "seq2seq.cnn_model.ConvolutionalNet", "seq2seq.seq2seq_model.Attention", "seq2seq.seq2seq_model.EncoderRNN", "torch.Linear", "torch.Linear", "torch.Linear", "seq2seq.seq2seq_model.Attention", "torch.NLLLoss", "torch.NLLLoss", "torch.NLLLoss", "torch.Tanh", "torch.Tanh", "torch.Tanh", "logger.warning", "seq2seq.cnn_model.DownSamplingConvolutionalNet", "torch.NLLLoss", "torch.NLLLoss", "torch.NLLLoss", "seq2seq.seq2seq_model.BahdanauAttentionDecoderRNN", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "logger.warning", "seq2seq.seq2seq_model.LuongAttentionDecoderRNN", "ValueError", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input_vocabulary_size", ":", "int", ",", "embedding_dimension", ":", "int", ",", "encoder_hidden_size", ":", "int", ",", "\n", "num_encoder_layers", ":", "int", ",", "target_vocabulary_size", ":", "int", ",", "encoder_dropout_p", ":", "float", ",", "\n", "encoder_bidirectional", ":", "bool", ",", "num_decoder_layers", ":", "int", ",", "decoder_dropout_p", ":", "float", ",", "\n", "decoder_hidden_size", ":", "int", ",", "num_cnn_channels", ":", "int", ",", "cnn_kernel_size", ":", "int", ",", "\n", "cnn_dropout_p", ":", "float", ",", "cnn_hidden_num_channels", ":", "int", ",", "input_padding_idx", ":", "int", ",", "target_pad_idx", ":", "int", ",", "\n", "target_eos_idx", ":", "int", ",", "output_directory", ":", "str", ",", "conditional_attention", ":", "bool", ",", "auxiliary_task", ":", "bool", ",", "\n", "simple_situation_representation", ":", "bool", ",", "attention_type", ":", "str", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "Model", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "simple_situation_representation", "=", "simple_situation_representation", "\n", "if", "not", "simple_situation_representation", ":", "\n", "            ", "logger", ".", "warning", "(", "\"DownSamplingConvolutionalNet not correctly implemented. Update or set \"", "\n", "\"--simple_situation_representation\"", ")", "\n", "self", ".", "downsample_image", "=", "DownSamplingConvolutionalNet", "(", "num_channels", "=", "num_cnn_channels", ",", "\n", "num_conv_channels", "=", "cnn_hidden_num_channels", ",", "\n", "dropout_probability", "=", "cnn_dropout_p", ")", "\n", "cnn_input_channels", "=", "cnn_hidden_num_channels", "\n", "", "else", ":", "\n", "            ", "cnn_input_channels", "=", "num_cnn_channels", "\n", "# Input: [batch_size, image_width, image_width, num_channels]", "\n", "# Output: [batch_size, image_width * image_width, num_conv_channels * 3]", "\n", "", "self", ".", "situation_encoder", "=", "ConvolutionalNet", "(", "num_channels", "=", "cnn_input_channels", ",", "\n", "cnn_kernel_size", "=", "cnn_kernel_size", ",", "\n", "num_conv_channels", "=", "cnn_hidden_num_channels", ",", "\n", "dropout_probability", "=", "cnn_dropout_p", ")", "\n", "# Attention over the output features of the ConvolutionalNet.", "\n", "# Input: [bsz, 1, decoder_hidden_size], [bsz, image_width * image_width, cnn_hidden_num_channels * 3]", "\n", "# Output: [bsz, 1, decoder_hidden_size], [bsz, 1, image_width * image_width]", "\n", "self", ".", "visual_attention", "=", "Attention", "(", "key_size", "=", "cnn_hidden_num_channels", "*", "3", ",", "query_size", "=", "decoder_hidden_size", ",", "\n", "hidden_size", "=", "decoder_hidden_size", ")", "\n", "\n", "self", ".", "auxiliary_task", "=", "auxiliary_task", "\n", "if", "auxiliary_task", ":", "\n", "            ", "self", ".", "auxiliary_loss_criterion", "=", "nn", ".", "NLLLoss", "(", ")", "\n", "\n", "# Input: [batch_size, max_input_length]", "\n", "# Output: [batch_size, hidden_size], [batch_size, max_input_length, hidden_size]", "\n", "", "self", ".", "encoder", "=", "EncoderRNN", "(", "input_size", "=", "input_vocabulary_size", ",", "\n", "embedding_dim", "=", "embedding_dimension", ",", "\n", "rnn_input_size", "=", "embedding_dimension", ",", "\n", "hidden_size", "=", "encoder_hidden_size", ",", "num_layers", "=", "num_encoder_layers", ",", "\n", "dropout_probability", "=", "encoder_dropout_p", ",", "bidirectional", "=", "encoder_bidirectional", ",", "\n", "padding_idx", "=", "input_padding_idx", ")", "\n", "# Used to project the final encoder state to the decoder hidden state such that it can be initialized with it.", "\n", "self", ".", "enc_hidden_to_dec_hidden", "=", "nn", ".", "Linear", "(", "encoder_hidden_size", ",", "decoder_hidden_size", ")", "\n", "self", ".", "textual_attention", "=", "Attention", "(", "key_size", "=", "encoder_hidden_size", ",", "query_size", "=", "decoder_hidden_size", ",", "\n", "hidden_size", "=", "decoder_hidden_size", ")", "\n", "\n", "# Input: [batch_size, max_target_length], initial hidden: ([batch_size, hidden_size], [batch_size, hidden_size])", "\n", "# Input for attention: [batch_size, max_input_length, hidden_size],", "\n", "#                      [batch_size, image_width * image_width, hidden_size]", "\n", "# Output: [max_target_length, batch_size, target_vocabulary_size]", "\n", "self", ".", "attention_type", "=", "attention_type", "\n", "if", "attention_type", "==", "\"bahdanau\"", ":", "\n", "            ", "self", ".", "attention_decoder", "=", "BahdanauAttentionDecoderRNN", "(", "hidden_size", "=", "decoder_hidden_size", ",", "\n", "output_size", "=", "target_vocabulary_size", ",", "\n", "num_layers", "=", "num_decoder_layers", ",", "\n", "dropout_probability", "=", "decoder_dropout_p", ",", "\n", "padding_idx", "=", "target_pad_idx", ",", "\n", "textual_attention", "=", "self", ".", "textual_attention", ",", "\n", "visual_attention", "=", "self", ".", "visual_attention", ",", "\n", "conditional_attention", "=", "conditional_attention", ")", "\n", "", "elif", "attention_type", "==", "\"luong\"", ":", "\n", "            ", "logger", ".", "warning", "(", "\"Luong attention not correctly implemented.\"", ")", "\n", "self", ".", "attention_decoder", "=", "LuongAttentionDecoderRNN", "(", "hidden_size", "=", "decoder_hidden_size", ",", "\n", "output_size", "=", "target_vocabulary_size", ",", "\n", "num_layers", "=", "num_decoder_layers", ",", "\n", "dropout_probability", "=", "decoder_dropout_p", ",", "\n", "conditional_attention", "=", "conditional_attention", ")", "\n", "", "else", ":", "\n", "            ", "raise", "ValueError", "(", "\"Unknown attention type {} specified.\"", ".", "format", "(", "attention_type", ")", ")", "\n", "\n", "", "self", ".", "target_eos_idx", "=", "target_eos_idx", "\n", "self", ".", "target_pad_idx", "=", "target_pad_idx", "\n", "self", ".", "loss_criterion", "=", "nn", ".", "NLLLoss", "(", "ignore_index", "=", "target_pad_idx", ")", "\n", "self", ".", "tanh", "=", "nn", ".", "Tanh", "(", ")", "\n", "self", ".", "output_directory", "=", "output_directory", "\n", "self", ".", "trained_iterations", "=", "0", "\n", "self", ".", "best_iteration", "=", "0", "\n", "self", ".", "best_exact_match", "=", "0", "\n", "self", ".", "best_accuracy", "=", "0", "\n", "\n", "", "@", "staticmethod", "\n", "def", "remove_start_of_sequence", "(", "input_tensor", ":", "torch", ".", "Tensor", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "\"\"\"Get rid of SOS-tokens in targets batch and append a padding token to each example in the batch.\"\"\"", "\n", "batch_size", ",", "max_time", "=", "input_tensor", ".", "size", "(", ")", "\n", "input_tensor", "=", "input_tensor", "[", ":", ",", "1", ":", "]", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.remove_start_of_sequence": [[112, 120], ["input_tensor.size", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["input_tensor", "=", "input_tensor", "[", ":", ",", "1", ":", "]", "\n", "output_tensor", "=", "torch", ".", "cat", "(", "[", "input_tensor", ",", "torch", ".", "zeros", "(", "batch_size", ",", "device", "=", "device", ",", "dtype", "=", "torch", ".", "long", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "1", ")", "]", ",", "dim", "=", "1", ")", "\n", "return", "output_tensor", "\n", "\n", "", "def", "get_metrics", "(", "self", ",", "target_scores", ":", "torch", ".", "Tensor", ",", "targets", ":", "torch", ".", "Tensor", ")", "->", "Tuple", "[", "float", ",", "float", "]", ":", "\n", "        "]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.get_metrics": [[121, 142], ["torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "model.Model.remove_start_of_sequence", "mask.sum().data.item", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "match_targets.sum", "mask.sum", "mask.sum.size", "match_targets.sum().data.item", "target_scores.max", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "mask.sum", "match_targets.sum"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.remove_start_of_sequence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max"], ["\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "targets", "=", "self", ".", "remove_start_of_sequence", "(", "targets", ")", "\n", "mask", "=", "(", "targets", "!=", "self", ".", "target_pad_idx", ")", ".", "long", "(", ")", "\n", "total", "=", "mask", ".", "sum", "(", ")", ".", "data", ".", "item", "(", ")", "\n", "predicted_targets", "=", "target_scores", ".", "max", "(", "dim", "=", "2", ")", "[", "1", "]", "\n", "equal_targets", "=", "torch", ".", "eq", "(", "targets", ".", "data", ",", "predicted_targets", ".", "data", ")", ".", "long", "(", ")", "\n", "match_targets", "=", "(", "equal_targets", "*", "mask", ")", "\n", "match_sum_per_example", "=", "match_targets", ".", "sum", "(", "dim", "=", "1", ")", "\n", "expected_sum_per_example", "=", "mask", ".", "sum", "(", "dim", "=", "1", ")", "\n", "batch_size", "=", "expected_sum_per_example", ".", "size", "(", "0", ")", "\n", "exact_match", "=", "100.", "*", "(", "match_sum_per_example", "==", "expected_sum_per_example", ")", ".", "sum", "(", ")", ".", "data", ".", "item", "(", ")", "/", "batch_size", "\n", "match_targets_sum", "=", "match_targets", ".", "sum", "(", ")", ".", "data", ".", "item", "(", ")", "\n", "accuracy", "=", "100.", "*", "match_targets_sum", "/", "total", "\n", "", "return", "accuracy", ",", "exact_match", "\n", "\n", "", "@", "staticmethod", "\n", "def", "get_auxiliary_accuracy", "(", "target_scores", ":", "torch", ".", "Tensor", ",", "targets", ":", "torch", ".", "Tensor", ")", "->", "float", ":", "\n", "        ", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "predicted_targets", "=", "target_scores", ".", "max", "(", "dim", "=", "1", ")", "[", "1", "]", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.get_auxiliary_accuracy": [[143, 150], ["torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "target_scores.max", "len", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max"], ["equal_targets", "=", "torch", ".", "eq", "(", "targets", ".", "data", ",", "predicted_targets", ".", "data", ")", ".", "long", "(", ")", ".", "sum", "(", ")", ".", "data", ".", "item", "(", ")", "\n", "accuracy", "=", "100.", "*", "equal_targets", "/", "len", "(", "targets", ")", "\n", "", "return", "accuracy", "\n", "\n", "", "def", "get_loss", "(", "self", ",", "target_scores", ":", "torch", ".", "Tensor", ",", "targets", ":", "torch", ".", "Tensor", ")", "->", "torch", ".", "Tensor", ":", "\n", "        "]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.get_loss": [[151, 165], ["model.Model.remove_start_of_sequence", "target_scores.size", "target_scores.reshape", "model.Model.loss_criterion", "model.Model.view"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.remove_start_of_sequence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["\n", "targets", "=", "self", ".", "remove_start_of_sequence", "(", "targets", ")", "\n", "\n", "# Calculate the loss.", "\n", "_", ",", "_", ",", "vocabulary_size", "=", "target_scores", ".", "size", "(", ")", "\n", "target_scores_2d", "=", "target_scores", ".", "reshape", "(", "-", "1", ",", "vocabulary_size", ")", "\n", "loss", "=", "self", ".", "loss_criterion", "(", "target_scores_2d", ",", "targets", ".", "view", "(", "-", "1", ")", ")", "\n", "return", "loss", "\n", "\n", "", "def", "get_auxiliary_loss", "(", "self", ",", "auxiliary_scores_target", ":", "torch", ".", "Tensor", ",", "target_target_positions", ":", "torch", ".", "Tensor", ")", ":", "\n", "        ", "target_loss", "=", "self", ".", "auxiliary_loss_criterion", "(", "auxiliary_scores_target", ",", "target_target_positions", ".", "view", "(", "-", "1", ")", ")", "\n", "return", "target_loss", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.get_auxiliary_loss": [[166, 169], ["model.Model.auxiliary_loss_criterion", "target_target_positions.view"], "methods", ["None"], ["", "def", "auxiliary_task_forward", "(", "self", ",", "output_scores_target_pos", ":", "torch", ".", "Tensor", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "assert", "self", ".", "auxiliary_task", ",", "\"Please set auxiliary_task to True if using it.\"", "\n", "batch_size", ",", "_", "=", "output_scores_target_pos", ".", "size", "(", ")", "\n", "output_scores_target_pos", "=", "F", ".", "log_softmax", "(", "output_scores_target_pos", ",", "-", "1", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.auxiliary_task_forward": [[170, 175], ["torch.log_softmax.size", "torch.log_softmax", "torch.log_softmax", "torch.log_softmax"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["return", "output_scores_target_pos", "\n", "\n", "", "def", "encode_input", "(", "self", ",", "commands_input", ":", "torch", ".", "LongTensor", ",", "commands_lengths", ":", "List", "[", "int", "]", ",", "\n", "situations_input", ":", "torch", ".", "Tensor", ")", "->", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"Pass the input commands through an RNN encoder and the situation input through a CNN encoder.\"\"\"", "\n", "if", "not", "self", ".", "simple_situation_representation", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.encode_input": [[176, 184], ["model.Model.situation_encoder", "model.Model.encoder", "model.Model.downsample_image"], "methods", ["None"], ["            ", "situations_input", "=", "self", ".", "downsample_image", "(", "situations_input", ")", "\n", "", "encoded_image", "=", "self", ".", "situation_encoder", "(", "situations_input", ")", "\n", "hidden", ",", "encoder_outputs", "=", "self", ".", "encoder", "(", "commands_input", ",", "commands_lengths", ")", "\n", "return", "{", "\"encoded_situations\"", ":", "encoded_image", ",", "\"encoded_commands\"", ":", "encoder_outputs", ",", "\"hidden_states\"", ":", "hidden", "}", "\n", "\n", "", "def", "decode_input", "(", "self", ",", "target_token", ":", "torch", ".", "LongTensor", ",", "hidden", ":", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "\n", "encoder_outputs", ":", "torch", ".", "Tensor", ",", "input_lengths", ":", "List", "[", "int", "]", ",", "\n", "encoded_situations", ":", "torch", ".", "Tensor", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "\n", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.decode_input": [[185, 193], ["model.Model.attention_decoder.forward_step"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.forward_step"], ["        ", "\"\"\"One decoding step based on the previous hidden state of the decoder and the previous target token.\"\"\"", "\n", "return", "self", ".", "attention_decoder", ".", "forward_step", "(", "input_tokens", "=", "target_token", ",", "last_hidden", "=", "hidden", ",", "\n", "encoded_commands", "=", "encoder_outputs", ",", "commands_lengths", "=", "input_lengths", ",", "\n", "encoded_situations", "=", "encoded_situations", ")", "\n", "\n", "", "def", "decode_input_batched", "(", "self", ",", "target_batch", ":", "torch", ".", "LongTensor", ",", "target_lengths", ":", "List", "[", "int", "]", ",", "\n", "initial_hidden", ":", "torch", ".", "Tensor", ",", "encoded_commands", ":", "torch", ".", "Tensor", ",", "\n", "command_lengths", ":", "List", "[", "int", "]", ",", "encoded_situations", ":", "torch", ".", "Tensor", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "\n", "torch", ".", "Tensor", "]", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.decode_input_batched": [[194, 209], ["model.Model.attention_decoder.initialize_hidden", "model.Model.attention_decoder", "torch.log_softmax", "torch.log_softmax", "torch.log_softmax", "model.Model.tanh", "model.Model.enc_hidden_to_dec_hidden"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.initialize_hidden"], ["        ", "\"\"\"Decode a batch of input sequences.\"\"\"", "\n", "initial_hidden", "=", "self", ".", "attention_decoder", ".", "initialize_hidden", "(", "\n", "self", ".", "tanh", "(", "self", ".", "enc_hidden_to_dec_hidden", "(", "initial_hidden", ")", ")", ")", "\n", "decoder_output_batched", ",", "_", ",", "context_situation", "=", "self", ".", "attention_decoder", "(", "input_tokens", "=", "target_batch", ",", "\n", "input_lengths", "=", "target_lengths", ",", "\n", "init_hidden", "=", "initial_hidden", ",", "\n", "encoded_commands", "=", "encoded_commands", ",", "\n", "commands_lengths", "=", "command_lengths", ",", "\n", "encoded_situations", "=", "encoded_situations", ")", "\n", "decoder_output_batched", "=", "F", ".", "log_softmax", "(", "decoder_output_batched", ",", "dim", "=", "-", "1", ")", "\n", "return", "decoder_output_batched", ",", "context_situation", "\n", "\n", "", "def", "forward", "(", "self", ",", "commands_input", ":", "torch", ".", "LongTensor", ",", "commands_lengths", ":", "List", "[", "int", "]", ",", "situations_input", ":", "torch", ".", "Tensor", ",", "\n", "target_batch", ":", "torch", ".", "LongTensor", ",", "target_lengths", ":", "List", "[", "int", "]", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "encoder_output", "=", "self", ".", "encode_input", "(", "commands_input", "=", "commands_input", ",", "commands_lengths", "=", "commands_lengths", ",", "\n", "situations_input", "=", "situations_input", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.forward": [[210, 226], ["model.Model.encode_input", "model.Model.decode_input_batched", "model.Model.auxiliary_task_forward", "torch.mm", "torch.mm", "torch.mm", "torch.mm", "torch.mm", "torch.mm", "torch.mm", "torch.mm", "torch.mm", "decoder_output.transpose", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.encode_input", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.decode_input_batched", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.auxiliary_task_forward"], ["decoder_output", ",", "context_situation", "=", "self", ".", "decode_input_batched", "(", "\n", "target_batch", "=", "target_batch", ",", "target_lengths", "=", "target_lengths", ",", "initial_hidden", "=", "encoder_output", "[", "\"hidden_states\"", "]", ",", "\n", "encoded_commands", "=", "encoder_output", "[", "\"encoded_commands\"", "]", "[", "\"encoder_outputs\"", "]", ",", "command_lengths", "=", "commands_lengths", ",", "\n", "encoded_situations", "=", "encoder_output", "[", "\"encoded_situations\"", "]", ")", "\n", "if", "self", ".", "auxiliary_task", ":", "\n", "            ", "target_position_scores", "=", "self", ".", "auxiliary_task_forward", "(", "context_situation", ")", "\n", "", "else", ":", "\n", "            ", "target_position_scores", "=", "torch", ".", "zeros", "(", "1", ")", ",", "torch", ".", "zeros", "(", "1", ")", "\n", "", "return", "(", "decoder_output", ".", "transpose", "(", "0", ",", "1", ")", ",", "# [batch_size, max_target_seq_length, target_vocabulary_size]", "\n", "target_position_scores", ")", "\n", "\n", "", "def", "update_state", "(", "self", ",", "is_best", ":", "bool", ",", "accuracy", "=", "None", ",", "exact_match", "=", "None", ")", "->", "{", "}", ":", "\n", "        ", "self", ".", "trained_iterations", "+=", "1", "\n", "if", "is_best", ":", "\n", "            ", "self", ".", "best_exact_match", "=", "exact_match", "\n", "self", ".", "best_accuracy", "=", "accuracy", "\n", "self", ".", "best_iteration", "=", "self", ".", "trained_iterations", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.update_state": [[227, 233], ["None"], "methods", ["None"], ["\n", "", "", "def", "load_model", "(", "self", ",", "path_to_checkpoint", ":", "str", ")", "->", "dict", ":", "\n", "        ", "checkpoint", "=", "torch", ".", "load", "(", "path_to_checkpoint", ")", "\n", "self", ".", "trained_iterations", "=", "checkpoint", "[", "\"iteration\"", "]", "\n", "self", ".", "best_iteration", "=", "checkpoint", "[", "\"best_iteration\"", "]", "\n", "self", ".", "load_state_dict", "(", "checkpoint", "[", "\"state_dict\"", "]", ")", "\n", "self", ".", "best_exact_match", "=", "checkpoint", "[", "\"best_exact_match\"", "]", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.load_model": [[234, 242], ["torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "model.Model.load_state_dict"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load"], ["self", ".", "best_accuracy", "=", "checkpoint", "[", "\"best_accuracy\"", "]", "\n", "return", "checkpoint", "[", "\"optimizer_state_dict\"", "]", "\n", "\n", "", "def", "get_current_state", "(", "self", ")", ":", "\n", "        ", "return", "{", "\n", "\"iteration\"", ":", "self", ".", "trained_iterations", ",", "\n", "\"state_dict\"", ":", "self", ".", "state_dict", "(", ")", ",", "\n", "\"best_iteration\"", ":", "self", ".", "best_iteration", ",", "\n", "\"best_accuracy\"", ":", "self", ".", "best_accuracy", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.get_current_state": [[243, 250], ["model.Model.state_dict"], "methods", ["None"], ["\"best_exact_match\"", ":", "self", ".", "best_exact_match", "\n", "}", "\n", "\n", "", "def", "save_checkpoint", "(", "self", ",", "file_name", ":", "str", ",", "is_best", ":", "bool", ",", "optimizer_state_dict", ":", "dict", ")", "->", "str", ":", "\n", "        "]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.model.Model.save_checkpoint": [[252, 268], ["os.path.join", "model.Model.get_current_state", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "os.path.join", "shutil.copyfile"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_current_state", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save"], ["\n", "path", "=", "os", ".", "path", ".", "join", "(", "self", ".", "output_directory", ",", "file_name", ")", "\n", "state", "=", "self", ".", "get_current_state", "(", ")", "\n", "state", "[", "\"optimizer_state_dict\"", "]", "=", "optimizer_state_dict", "\n", "torch", ".", "save", "(", "state", ",", "path", ")", "\n", "if", "is_best", ":", "\n", "            ", "best_path", "=", "os", ".", "path", ".", "join", "(", "self", ".", "output_directory", ",", "'model_best.pth.tar'", ")", "\n", "shutil", ".", "copyfile", "(", "path", ",", "best_path", ")", "\n", "", "return", "path", "\n", "", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.helpers.sequence_mask": [[11, 33], ["sequence_lengths.size", "torch.arange().long().to", "torch.arange().long().to.unsqueeze().expand", "sequence_lengths.unsqueeze().expand_as", "sequence_lengths.data.max", "torch.arange().long", "torch.arange().long().to.unsqueeze", "sequence_lengths.unsqueeze", "torch.arange"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max"], ["def", "sequence_mask", "(", "sequence_lengths", ":", "torch", ".", "LongTensor", ",", "max_len", "=", "None", ")", "->", "torch", ".", "tensor", ":", "\n", "    ", "\"\"\"\n    Create a sequence mask that masks out all indices larger than some sequence length as defined by\n    sequence_lengths entries.\n\n    :param sequence_lengths: [batch_size] sequence lengths per example in batch\n    :param max_len: int defining the maximum sequence length in the batch\n    :return: [batch_size, max_len] boolean mask\n    \"\"\"", "\n", "if", "max_len", "is", "None", ":", "\n", "        ", "max_len", "=", "sequence_lengths", ".", "data", ".", "max", "(", ")", "\n", "", "batch_size", "=", "sequence_lengths", ".", "size", "(", "0", ")", "\n", "sequence_range", "=", "torch", ".", "arange", "(", "0", ",", "max_len", ")", ".", "long", "(", ")", ".", "to", "(", "device", "=", "device", ")", "\n", "\n", "# [batch_size, max_len]", "\n", "sequence_range_expand", "=", "sequence_range", ".", "unsqueeze", "(", "0", ")", ".", "expand", "(", "batch_size", ",", "max_len", ")", "\n", "\n", "# [batch_size, max_len]", "\n", "seq_length_expand", "=", "(", "sequence_lengths", ".", "unsqueeze", "(", "1", ")", ".", "expand_as", "(", "sequence_range_expand", ")", ")", "\n", "\n", "# [batch_size, max_len](boolean array of which elements to include)", "\n", "return", "sequence_range_expand", "<", "seq_length_expand", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.helpers.log_parameters": [[35, 42], ["filter", "sum", "logger.info", "model.named_parameters", "model.parameters", "numpy.prod", "logger.info", "p.size", "list", "p.size"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "log_parameters", "(", "model", ":", "torch", ".", "nn", ".", "Module", ")", "->", "{", "}", ":", "\n", "    ", "model_parameters", "=", "filter", "(", "lambda", "p", ":", "p", ".", "requires_grad", ",", "model", ".", "parameters", "(", ")", ")", "\n", "n_params", "=", "sum", "(", "[", "np", ".", "prod", "(", "p", ".", "size", "(", ")", ")", "for", "p", "in", "model_parameters", "]", ")", "\n", "logger", ".", "info", "(", "\"Total parameters: %d\"", "%", "n_params", ")", "\n", "for", "name", ",", "p", "in", "model", ".", "named_parameters", "(", ")", ":", "\n", "        ", "if", "p", ".", "requires_grad", ":", "\n", "            ", "logger", ".", "info", "(", "\"%s : %s\"", "%", "(", "name", ",", "list", "(", "p", ".", "size", "(", ")", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.helpers.sequence_accuracy": [[44, 65], ["prediction.copy.copy", "target.copy.copy", "enumerate", "len", "len", "prediction.copy.extend", "len", "len", "target.copy.extend", "len", "len", "len", "len", "len"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend"], ["", "", "", "def", "sequence_accuracy", "(", "prediction", ":", "List", "[", "int", "]", ",", "target", ":", "List", "[", "int", "]", ")", "->", "float", ":", "\n", "    ", "correct", "=", "0", "\n", "total", "=", "0", "\n", "prediction", "=", "prediction", ".", "copy", "(", ")", "\n", "target", "=", "target", ".", "copy", "(", ")", "\n", "if", "len", "(", "prediction", ")", "<", "len", "(", "target", ")", ":", "\n", "        ", "difference", "=", "len", "(", "target", ")", "-", "len", "(", "prediction", ")", "\n", "prediction", ".", "extend", "(", "[", "0", "]", "*", "difference", ")", "\n", "", "if", "len", "(", "target", ")", "<", "len", "(", "prediction", ")", ":", "\n", "        ", "difference", "=", "len", "(", "prediction", ")", "-", "len", "(", "target", ")", "\n", "target", ".", "extend", "(", "[", "-", "1", "]", "*", "difference", ")", "\n", "", "for", "i", ",", "target_int", "in", "enumerate", "(", "target", ")", ":", "\n", "        ", "if", "i", ">=", "len", "(", "prediction", ")", ":", "\n", "            ", "break", "\n", "", "prediction_int", "=", "prediction", "[", "i", "]", "\n", "if", "prediction_int", "==", "target_int", ":", "\n", "            ", "correct", "+=", "1", "\n", "", "total", "+=", "1", "\n", "", "if", "not", "total", ":", "\n", "        ", "return", "0.", "\n", "", "return", "(", "correct", "/", "total", ")", "*", "100", "\n", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.EncoderRNN.__init__": [[26, 46], ["torch.Module.__init__", "torch.Embedding", "torch.Embedding", "torch.Embedding", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.LSTM", "torch.LSTM", "torch.LSTM"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "input_size", ":", "int", ",", "embedding_dim", ":", "int", ",", "rnn_input_size", ":", "int", ",", "hidden_size", ":", "int", ",", "num_layers", ":", "int", ",", "\n", "dropout_probability", ":", "float", ",", "bidirectional", ":", "bool", ",", "padding_idx", ":", "int", ")", ":", "\n", "        ", "\"\"\"\n        :param input_size: number of input symbols\n        :param embedding_dim: number of hidden units in RNN encoder, and size of all embeddings\n        :param num_layers: number of hidden layers\n        :param dropout_probability: dropout applied to symbol embeddings and RNNs\n        :param bidirectional: use a bidirectional LSTM instead and sum of the resulting embeddings\n        \"\"\"", "\n", "super", "(", "EncoderRNN", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "num_layers", "=", "num_layers", "\n", "self", ".", "hidden_size", "=", "hidden_size", "\n", "self", ".", "input_size", "=", "input_size", "\n", "self", ".", "embedding_dim", "=", "embedding_dim", "\n", "self", ".", "dropout_probability", "=", "dropout_probability", "\n", "self", ".", "bidirectional", "=", "bidirectional", "\n", "self", ".", "embedding", "=", "nn", ".", "Embedding", "(", "input_size", ",", "embedding_dim", ",", "padding_idx", "=", "padding_idx", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "dropout_probability", ")", "\n", "self", ".", "lstm", "=", "nn", ".", "LSTM", "(", "input_size", "=", "rnn_input_size", ",", "hidden_size", "=", "hidden_size", ",", "num_layers", "=", "num_layers", ",", "\n", "dropout", "=", "dropout_probability", ",", "bidirectional", "=", "bidirectional", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.EncoderRNN.forward": [[47, 90], ["seq2seq_model.EncoderRNN.embedding", "seq2seq_model.EncoderRNN.dropout", "len", "max", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "input_embeddings.index_select.index_select.index_select", "torch.nn.utils.rnn.pack_padded_sequence", "torch.nn.utils.rnn.pack_padded_sequence", "torch.nn.utils.rnn.pack_padded_sequence", "seq2seq_model.EncoderRNN.lstm", "torch.nn.utils.rnn.pad_packed_sequence", "torch.nn.utils.rnn.pad_packed_sequence", "torch.nn.utils.rnn.pad_packed_sequence", "perm_idx.sort", "torch.sum.index_select", "torch.sum.index_select", "torch.sum.index_select", "torch.sum.index_select", "torch.sum.index_select", "torch.sum.index_select", "input_lengths[].tolist", "input_batch.size", "len", "input_lengths[].tolist.cpu", "torch.sum.view", "torch.sum.view", "torch.sum.view", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum.view", "torch.sum.view", "torch.sum.view", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "int"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "forward", "(", "self", ",", "input_batch", ":", "torch", ".", "LongTensor", ",", "input_lengths", ":", "List", "[", "int", "]", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "dict", "]", ":", "\n", "        ", "\"\"\"\n        :param input_batch: [batch_size, max_length]; batched padded input sequences\n        :param input_lengths: length of each padded input sequence.\n        :return: hidden states for last layer of last time step, the output of the last layer per time step and\n        the sequence lengths per example in the batch.\n        NB: The hidden states in the bidirectional case represent the final hidden state of each directional encoder,\n        meaning the whole sequence in both directions, whereas the output per time step represents different parts of\n        the sequences (0:t for the forward LSTM, t:T for the backward LSTM).\n        \"\"\"", "\n", "assert", "input_batch", ".", "size", "(", "0", ")", "==", "len", "(", "input_lengths", ")", ",", "\"Wrong amount of lengths passed to .forward()\"", "\n", "input_embeddings", "=", "self", ".", "embedding", "(", "input_batch", ")", "# [batch_size, max_length, embedding_dim]", "\n", "input_embeddings", "=", "self", ".", "dropout", "(", "input_embeddings", ")", "# [batch_size, max_length, embedding_dim]", "\n", "\n", "# Sort the sequences by length in descending order.", "\n", "batch_size", "=", "len", "(", "input_lengths", ")", "\n", "max_length", "=", "max", "(", "input_lengths", ")", "\n", "input_lengths", "=", "torch", ".", "tensor", "(", "input_lengths", ",", "device", "=", "device", ",", "dtype", "=", "torch", ".", "long", ")", "\n", "input_lengths", ",", "perm_idx", "=", "torch", ".", "sort", "(", "input_lengths", ",", "descending", "=", "True", ")", "\n", "input_embeddings", "=", "input_embeddings", ".", "index_select", "(", "dim", "=", "0", ",", "index", "=", "perm_idx", ")", "\n", "\n", "# RNN embedding.", "\n", "packed_input", "=", "pack_padded_sequence", "(", "input_embeddings", ",", "input_lengths", ".", "cpu", "(", ")", ",", "batch_first", "=", "True", ")", "\n", "packed_output", ",", "(", "hidden", ",", "cell", ")", "=", "self", ".", "lstm", "(", "packed_input", ")", "\n", "# hidden, cell [num_layers * num_directions, batch_size, embedding_dim]", "\n", "# hidden and cell are unpacked, such that they store the last hidden state for each sequence in the batch.", "\n", "output_per_timestep", ",", "_", "=", "pad_packed_sequence", "(", "\n", "packed_output", ")", "# [max_length, batch_size, hidden_size * num_directions]", "\n", "\n", "# If biLSTM, sum the outputs for each direction", "\n", "if", "self", ".", "bidirectional", ":", "\n", "            ", "output_per_timestep", "=", "output_per_timestep", ".", "view", "(", "int", "(", "max_length", ")", ",", "batch_size", ",", "2", ",", "self", ".", "hidden_size", ")", "\n", "output_per_timestep", "=", "torch", ".", "sum", "(", "output_per_timestep", ",", "2", ")", "# [max_length, batch_size, hidden_size]", "\n", "hidden", "=", "hidden", ".", "view", "(", "self", ".", "num_layers", ",", "2", ",", "batch_size", ",", "self", ".", "hidden_size", ")", "\n", "hidden", "=", "torch", ".", "sum", "(", "hidden", ",", "1", ")", "# [num_layers, batch_size, hidden_size]", "\n", "", "hidden", "=", "hidden", "[", "-", "1", ",", ":", ",", ":", "]", "# [batch_size, hidden_size] (get the last layer)", "\n", "\n", "# Reverse the sorting.", "\n", "_", ",", "unperm_idx", "=", "perm_idx", ".", "sort", "(", "0", ")", "\n", "hidden", "=", "hidden", ".", "index_select", "(", "dim", "=", "0", ",", "index", "=", "unperm_idx", ")", "\n", "output_per_timestep", "=", "output_per_timestep", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "unperm_idx", ")", "\n", "input_lengths", "=", "input_lengths", "[", "unperm_idx", "]", ".", "tolist", "(", ")", "\n", "return", "hidden", ",", "{", "\"encoder_outputs\"", ":", "output_per_timestep", ",", "\"sequence_lengths\"", ":", "input_lengths", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.EncoderRNN.extra_repr": [[91, 95], ["None"], "methods", ["None"], ["", "def", "extra_repr", "(", "self", ")", "->", "str", ":", "\n", "        ", "return", "\"EncoderRNN\\n bidirectional={} \\n num_layers={}\\n hidden_size={}\\n dropout={}\\n \"", "\"n_input_symbols={}\\n\"", ".", "format", "(", "self", ".", "bidirectional", ",", "self", ".", "num_lauers", ",", "self", ".", "hidden_size", ",", "\n", "self", ".", "dropout_probability", ",", "self", ".", "input_size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.Attention.__init__": [[99, 104], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "key_size", ":", "int", ",", "query_size", ":", "int", ",", "hidden_size", ":", "int", ")", ":", "\n", "        ", "super", "(", "Attention", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "key_layer", "=", "nn", ".", "Linear", "(", "key_size", ",", "hidden_size", ",", "bias", "=", "False", ")", "\n", "self", ".", "query_layer", "=", "nn", ".", "Linear", "(", "query_size", ",", "hidden_size", ",", "bias", "=", "False", ")", "\n", "self", ".", "energy_layer", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "1", ",", "bias", "=", "False", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.Attention.forward": [[105, 140], ["projected_keys.size", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "seq2seq_model.Attention.query_layer", "seq2seq_model.Attention.energy_layer", "scores.masked_fill.masked_fill.squeeze().unsqueeze", "seq2seq.helpers.sequence_mask", "mask.unsqueeze.unsqueeze.unsqueeze", "scores.masked_fill.masked_fill.masked_fill", "torch.softmax", "torch.softmax", "torch.softmax", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "len", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "float", "scores.masked_fill.masked_fill.squeeze"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.sequence_mask"], ["", "def", "forward", "(", "self", ",", "queries", ":", "torch", ".", "Tensor", ",", "projected_keys", ":", "torch", ".", "Tensor", ",", "values", ":", "torch", ".", "Tensor", ",", "\n", "memory_lengths", ":", "List", "[", "int", "]", ")", ":", "\n", "        ", "\"\"\"\n        Key-value memory which takes queries and retrieves weighted combinations of values\n          This version masks out certain memories, so that you can differing numbers of memories per batch.\n\n        :param queries: [batch_size, 1, query_dim]\n        :param projected_keys: [batch_size, num_memory, query_dim]\n        :param values: [batch_size, num_memory, value_dim]\n        :param memory_lengths: [batch_size] actual number of keys in each batch\n        :return:\n            soft_values_retrieval : soft-retrieval of values; [batch_size, 1, value_dim]\n            attention_weights : soft-retrieval of values; [batch_size, 1, n_memory]\n        \"\"\"", "\n", "batch_size", "=", "projected_keys", ".", "size", "(", "0", ")", "\n", "assert", "len", "(", "memory_lengths", ")", "==", "batch_size", "\n", "memory_lengths", "=", "torch", ".", "tensor", "(", "memory_lengths", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", "\n", "\n", "# Project queries down to the correct dimension.", "\n", "# [bsz, 1, query_dimension] X [bsz, query_dimension, hidden_dim] = [bsz, 1, hidden_dim]", "\n", "queries", "=", "self", ".", "query_layer", "(", "queries", ")", "\n", "\n", "# [bsz, 1, query_dim] X [bsz, query_dim, num_memory] = [bsz, num_memory, 1]", "\n", "scores", "=", "self", ".", "energy_layer", "(", "torch", ".", "tanh", "(", "queries", "+", "projected_keys", ")", ")", "\n", "scores", "=", "scores", ".", "squeeze", "(", "2", ")", ".", "unsqueeze", "(", "1", ")", "\n", "\n", "# Mask out keys that are on a padding location.encoded_commands", "\n", "mask", "=", "sequence_mask", "(", "memory_lengths", ")", "# [batch_size, num_memory]", "\n", "mask", "=", "mask", ".", "unsqueeze", "(", "1", ")", "# [batch_size, 1, num_memory]", "\n", "scores", "=", "scores", ".", "masked_fill", "(", "mask", "==", "0", ",", "float", "(", "'-inf'", ")", ")", "# fill with large negative numbers", "\n", "attention_weights", "=", "F", ".", "softmax", "(", "scores", ",", "dim", "=", "2", ")", "# [batch_size, 1, num_memory]", "\n", "\n", "# [bsz, 1, num_memory] X\u00a0[bsz, num_memory, value_dim] = [bsz, 1, value_dim]", "\n", "soft_values_retrieval", "=", "torch", ".", "bmm", "(", "attention_weights", ",", "values", ")", "\n", "return", "soft_values_retrieval", ",", "attention_weights", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.LuongAttentionDecoderRNN.__init__": [[145, 168], ["torch.Module.__init__", "torch.Tanh", "torch.Tanh", "torch.Tanh", "torch.Embedding", "torch.Embedding", "torch.Embedding", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.LSTM", "torch.LSTM", "torch.LSTM", "seq2seq_model.Attention", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "hidden_size", ":", "int", ",", "output_size", ":", "int", ",", "num_layers", ":", "int", ",", "dropout_probability", "=", "0.1", ",", "\n", "conditional_attention", "=", "False", ")", ":", "\n", "        ", "\"\"\"\n        :param hidden_size: number of hidden units in RNN, and embedding size for output symbols\n        :param output_size: number of output symbols\n        :param num_layers: number of hidden layers\n        :param dropout_probability: dropout applied to symbol embeddings and RNNs\n        \"\"\"", "\n", "super", "(", "LuongAttentionDecoderRNN", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "num_layers", "=", "num_layers", "\n", "self", ".", "conditional_attention", "=", "conditional_attention", "\n", "if", "self", ".", "conditional_attention", ":", "\n", "            ", "self", ".", "queries_to_keys", "=", "nn", ".", "Linear", "(", "hidden_size", "*", "2", ",", "hidden_size", ")", "\n", "", "self", ".", "hidden_size", "=", "hidden_size", "\n", "self", ".", "output_size", "=", "output_size", "\n", "self", ".", "dropout_probability", "=", "dropout_probability", "\n", "self", ".", "tanh", "=", "nn", ".", "Tanh", "(", ")", "\n", "self", ".", "embedding", "=", "nn", ".", "Embedding", "(", "output_size", ",", "hidden_size", ",", "padding_idx", "=", "0", ")", "# TODO: change", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "dropout_probability", ")", "\n", "self", ".", "lstm", "=", "nn", ".", "LSTM", "(", "hidden_size", ",", "hidden_size", ",", "num_layers", "=", "num_layers", ",", "dropout", "=", "dropout_probability", ")", "\n", "self", ".", "attention", "=", "Attention", "(", ")", "\n", "self", ".", "hidden_context_to_hidden", "=", "nn", ".", "Linear", "(", "hidden_size", "*", "3", ",", "hidden_size", ")", "\n", "self", ".", "hidden_to_output", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "output_size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.LuongAttentionDecoderRNN.forward_step": [[169, 232], ["seq2seq_model.LuongAttentionDecoderRNN.embedding", "seq2seq_model.LuongAttentionDecoderRNN.dropout", "embedded_input.unsqueeze.unsqueeze.unsqueeze", "seq2seq_model.LuongAttentionDecoderRNN.lstm", "seq2seq_model.LuongAttentionDecoderRNN.attention.forward_masked", "encoded_situations.size", "seq2seq_model.LuongAttentionDecoderRNN.attention.forward_masked", "lstm_output.squeeze.squeeze.squeeze", "context_command.squeeze.squeeze.squeeze", "context_situation.squeeze.squeeze.squeeze", "attention_weights_commands.squeeze.squeeze.squeeze", "attention_weights_situations.squeeze.squeeze.squeeze", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "seq2seq_model.LuongAttentionDecoderRNN.tanh", "seq2seq_model.LuongAttentionDecoderRNN.hidden_to_output", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "seq2seq_model.LuongAttentionDecoderRNN.queries_to_keys", "seq2seq_model.LuongAttentionDecoderRNN.tanh", "lstm_output.squeeze.squeeze.transpose", "seq2seq_model.LuongAttentionDecoderRNN.hidden_context_to_hidden", "attention_weights_situations.squeeze.squeeze.squeeze", "lstm_output.squeeze.squeeze.transpose", "encoded_commands.transpose", "encoded_commands.transpose", "range", "lstm_output.squeeze.squeeze.transpose"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "forward_step", "(", "self", ",", "input_tokens", ":", "torch", ".", "LongTensor", ",", "last_hidden", ":", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "\n", "encoded_commands", ":", "torch", ".", "Tensor", ",", "commands_lengths", ":", "List", "[", "int", "]", ",", "\n", "encoded_situations", ":", "torch", ".", "Tensor", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "\n", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"\n        Run batch decoder forward for a single time step.\n         Each decoder step considers all of the encoder_outputs through attention.\n             Attention retrieval is based on decoder hidden state (not cell state)\n\n        :param input_tokens: one time step inputs tokens of length batch_size\n        :param last_hidden: previous decoder state, which is pair of tensors [num_layers, batch_size, hidden_size]\n        (pair for hidden and cell)\n        :param encoded_commands: all encoder outputs, [max_input_length, batch_size, hidden_size]  # TODO: embedding dim is hidden dim\n        :param commands_lengths: length of each padded input sequence that were passed to the encoder.\n        :param encoded_situations: the situation encoder outputs, [image_dimension * image_dimension, batch_size,\n         hidden_size]\n        :return: output : un-normalized output probabilities, [batch_size, output_size]\n          hidden : current decoder state, which is a pair of tensors [num_layers, batch_size, hidden_size]\n           (pair for hidden and cell)\n          attention_weights : attention weights, [batch_size, 1, max_input_length]\n        \"\"\"", "\n", "\n", "# Embed each input symbol", "\n", "embedded_input", "=", "self", ".", "embedding", "(", "input_tokens", ")", "# [batch_size, hidden_size]", "\n", "embedded_input", "=", "self", ".", "dropout", "(", "embedded_input", ")", "\n", "embedded_input", "=", "embedded_input", ".", "unsqueeze", "(", "0", ")", "# [1, batch_size, hidden_size]", "\n", "\n", "lstm_output", ",", "hidden", "=", "self", ".", "lstm", "(", "embedded_input", ",", "last_hidden", ")", "\n", "# lstm_output: [1, batch_size, hidden_size]", "\n", "# hidden: tuple of each [num_layers, batch_size, hidden_size] (pair for hidden and cell)", "\n", "context_command", ",", "attention_weights_commands", "=", "self", ".", "attention", ".", "forward_masked", "(", "\n", "queries", "=", "lstm_output", ".", "transpose", "(", "0", ",", "1", ")", ",", "keys", "=", "encoded_commands", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "values", "=", "encoded_commands", ".", "transpose", "(", "0", ",", "1", ")", ",", "memory_lengths", "=", "commands_lengths", ")", "\n", "batch_size", ",", "image_num_memory", ",", "_", "=", "encoded_situations", ".", "size", "(", ")", "\n", "situation_lengths", "=", "[", "image_num_memory", "for", "_", "in", "range", "(", "batch_size", ")", "]", "\n", "\n", "if", "self", ".", "conditional_attention", ":", "\n", "            ", "queries", "=", "torch", ".", "cat", "(", "[", "lstm_output", ".", "transpose", "(", "0", ",", "1", ")", ",", "context_command", "]", ",", "dim", "=", "-", "1", ")", "\n", "queries", "=", "self", ".", "queries_to_keys", "(", "queries", ")", "\n", "queries", "=", "self", ".", "tanh", "(", "queries", ")", "\n", "", "else", ":", "\n", "            ", "queries", "=", "lstm_output", ".", "transpose", "(", "0", ",", "1", ")", "\n", "\n", "", "context_situation", ",", "attention_weights_situations", "=", "self", ".", "attention", ".", "forward_masked", "(", "\n", "queries", "=", "queries", ",", "keys", "=", "encoded_situations", ",", "\n", "values", "=", "encoded_situations", ",", "memory_lengths", "=", "situation_lengths", ")", "\n", "# context : [batch_size, 1, hidden_size]", "\n", "# attention_weights : [batch_size, 1, max_input_length]", "\n", "\n", "# Concatenate the context vector and RNN hidden state, and map to an output", "\n", "lstm_output", "=", "lstm_output", ".", "squeeze", "(", "0", ")", "# [batch_size, hidden_size]", "\n", "context_command", "=", "context_command", ".", "squeeze", "(", "1", ")", "# [batch_size, hidden_size]", "\n", "context_situation", "=", "context_situation", ".", "squeeze", "(", "1", ")", "# [batch_size, hidden_size]", "\n", "attention_weights_commands", "=", "attention_weights_commands", ".", "squeeze", "(", "1", ")", "# [batch_size, max_input_length]", "\n", "attention_weights_situations", "=", "attention_weights_situations", ".", "squeeze", "(", "1", ")", "# [batch_size, im_dim * im_dim]", "\n", "concat_input", "=", "torch", ".", "cat", "(", "[", "lstm_output", ",", "\n", "context_command", ",", "\n", "context_situation", "]", ",", "dim", "=", "1", ")", "# [batch_size, hidden_size*3]", "\n", "concat_output", "=", "self", ".", "tanh", "(", "self", ".", "hidden_context_to_hidden", "(", "concat_input", ")", ")", "# [batch_size, hidden_size]", "\n", "# concat_output = self.dropout(concat_output)", "\n", "output", "=", "self", ".", "hidden_to_output", "(", "concat_output", ")", "# [batch_size, output_size]", "\n", "return", "(", "output", ",", "hidden", ",", "attention_weights_situations", ".", "squeeze", "(", "dim", "=", "1", ")", ",", "attention_weights_commands", ",", "\n", "attention_weights_situations", ")", "\n", "# output : [un-normalized probabilities] [batch_size, output_size]", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.LuongAttentionDecoderRNN.forward": [[236, 309], ["seq2seq_model.LuongAttentionDecoderRNN.embedding", "seq2seq_model.LuongAttentionDecoderRNN.dropout", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "input_embedded.index_select.index_select.index_select", "torch.nn.utils.rnn.pack_padded_sequence", "torch.nn.utils.rnn.pack_padded_sequence", "torch.nn.utils.rnn.pack_padded_sequence", "seq2seq_model.LuongAttentionDecoderRNN.lstm", "torch.nn.utils.rnn.pad_packed_sequence", "torch.nn.utils.rnn.pad_packed_sequence", "torch.nn.utils.rnn.pad_packed_sequence", "perm_idx.sort", "lstm_output.index_select.index_select.index_select", "input_lengths[].tolist", "seq2seq_model.LuongAttentionDecoderRNN.attention.forward_masked", "encoded_situations.size", "seq2seq_model.LuongAttentionDecoderRNN.attention.forward_masked", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "seq2seq_model.LuongAttentionDecoderRNN.tanh", "seq2seq_model.LuongAttentionDecoderRNN.hidden_to_output", "initial_h.index_select", "initial_c.index_select", "torch.tensor.cpu", "torch.tensor.cpu", "torch.tensor.cpu", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "seq2seq_model.LuongAttentionDecoderRNN.queries_to_keys", "seq2seq_model.LuongAttentionDecoderRNN.tanh", "lstm_output.index_select.index_select.transpose", "seq2seq_model.LuongAttentionDecoderRNN.hidden_context_to_hidden", "attention_weights.sum", "lstm_output.index_select.index_select.transpose", "encoded_commands.transpose", "encoded_commands.transpose", "range", "context_commands.transpose", "context_situation.transpose", "lstm_output.index_select.index_select.transpose"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "forward", "(", "self", ",", "input_tokens", ":", "torch", ".", "LongTensor", ",", "input_lengths", ":", "List", "[", "int", "]", ",", "\n", "init_hidden", ":", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "encoded_commands", ":", "torch", ".", "Tensor", ",", "\n", "commands_lengths", ":", "List", "[", "int", "]", ",", "encoded_situations", ":", "torch", ".", "Tensor", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", ",", "\n", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"\n        Run batch attention decoder forward for a series of steps\n         Each decoder step considers all of the encoder_outputs through attention.\n         Attention retrieval is based on decoder hidden state (not cell state)\n\n        :param input_tokens: [batch_size, max_length];  padded target sequences\n        :param input_lengths: [batch_size] for sequence length of each padded target sequence\n        :param init_hidden: tuple of tensors [num_layers, batch_size, hidden_size] (for hidden and cell)\n        :param encoded_commands: [max_input_length, batch_size, embedding_dim]\n        :param commands_lengths: [batch_size] sequence length of each encoder sequence (without padding)\n        :param encoded_situations: [] TODO\n        :return: output : unnormalized log-score, [max_length, batch_size, output_size]\n          hidden : current decoder state, tuple with each [num_layers, batch_size, hidden_size] (for hidden and cell)\n        \"\"\"", "\n", "input_embedded", "=", "self", ".", "embedding", "(", "input_tokens", ")", "# [batch_size, max_length, embedding_dim]", "\n", "input_embedded", "=", "self", ".", "dropout", "(", "input_embedded", ")", "# [batch_size, max_length, embedding_dim]", "\n", "\n", "# Sort the sequences by length in descending order", "\n", "input_lengths", "=", "torch", ".", "tensor", "(", "input_lengths", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", "\n", "input_lengths", ",", "perm_idx", "=", "torch", ".", "sort", "(", "input_lengths", ",", "descending", "=", "True", ")", "\n", "input_embedded", "=", "input_embedded", ".", "index_select", "(", "dim", "=", "0", ",", "index", "=", "perm_idx", ")", "\n", "initial_h", ",", "initial_c", "=", "init_hidden", "\n", "init_hidden", "=", "(", "initial_h", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "perm_idx", ")", ",", "\n", "initial_c", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "perm_idx", ")", ")", "\n", "\n", "# RNN decoder", "\n", "packed_input", "=", "pack_padded_sequence", "(", "input_embedded", ",", "input_lengths", ".", "cpu", "(", ")", ",", "batch_first", "=", "True", ")", "\n", "packed_output", ",", "(", "hidden", ",", "cell", ")", "=", "self", ".", "lstm", "(", "packed_input", ",", "init_hidden", ")", "\n", "# hidden is [num_layers, batch_size, hidden_size] (pair for hidden and cell)", "\n", "lstm_output", ",", "_", "=", "pad_packed_sequence", "(", "packed_output", ")", "# [max_length, batch_size, hidden_size]", "\n", "\n", "# Reverse the sorting", "\n", "_", ",", "unperm_idx", "=", "perm_idx", ".", "sort", "(", "0", ")", "\n", "lstm_output", "=", "lstm_output", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "unperm_idx", ")", "# [max_length, batch_size, hidden_size]", "\n", "seq_len", "=", "input_lengths", "[", "unperm_idx", "]", ".", "tolist", "(", ")", "\n", "\n", "# Compute context vector using attention", "\n", "context_commands", ",", "attention_weights", "=", "self", ".", "attention", ".", "forward_masked", "(", "queries", "=", "lstm_output", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "keys", "=", "encoded_commands", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "values", "=", "encoded_commands", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "memory_lengths", "=", "commands_lengths", ")", "\n", "# context_commands = self.dropout(context_commands)", "\n", "\n", "# Compute context vector using attention", "\n", "if", "self", ".", "conditional_attention", ":", "\n", "            ", "queries", "=", "torch", ".", "cat", "(", "[", "lstm_output", ".", "transpose", "(", "0", ",", "1", ")", ",", "context_commands", "]", ",", "dim", "=", "-", "1", ")", "\n", "queries", "=", "self", ".", "queries_to_keys", "(", "queries", ")", "\n", "queries", "=", "self", ".", "tanh", "(", "queries", ")", "\n", "", "else", ":", "\n", "            ", "queries", "=", "lstm_output", ".", "transpose", "(", "0", ",", "1", ")", "\n", "", "batch_size", ",", "image_num_memory", ",", "_", "=", "encoded_situations", ".", "size", "(", ")", "\n", "situation_lengths", "=", "[", "image_num_memory", "for", "_", "in", "range", "(", "batch_size", ")", "]", "\n", "context_situation", ",", "attention_weights", "=", "self", ".", "attention", ".", "forward_masked", "(", "queries", "=", "queries", ",", "\n", "keys", "=", "encoded_situations", ",", "\n", "values", "=", "encoded_situations", ",", "\n", "memory_lengths", "=", "situation_lengths", ")", "\n", "# context_situation = self.dropout(context_situation)", "\n", "\n", "# context: [batch_size, max_length, hidden_size]", "\n", "# attention_weights: [batch_size, max_length, max_input_length]", "\n", "\n", "# Concatenate the context vector and RNN hidden state, and map to an output", "\n", "concat_input", "=", "torch", ".", "cat", "(", "[", "lstm_output", ",", "\n", "context_commands", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "context_situation", ".", "transpose", "(", "0", ",", "1", ")", "]", ",", "2", ")", "# [max_length, batch_size, hidden_size*3]", "\n", "concat_output", "=", "self", ".", "tanh", "(", "self", ".", "hidden_context_to_hidden", "(", "concat_input", ")", ")", "# [max_length, batch_size, hidden_size]", "\n", "# concat_output = self.dropout(concat_output)", "\n", "output", "=", "self", ".", "hidden_to_output", "(", "concat_output", ")", "# [max_length, batch_size, output_size]", "\n", "return", "output", ",", "seq_len", ",", "attention_weights", ".", "sum", "(", "dim", "=", "1", ")", "\n", "# output : [unnormalized log-score] [max_length, batch_size, output_size]", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.LuongAttentionDecoderRNN.initialize_hidden": [[312, 323], ["encoder_message.expand().contiguous.expand().contiguous.unsqueeze", "encoder_message.expand().contiguous.expand().contiguous.expand().contiguous", "encoder_message.expand().contiguous.expand().contiguous.clone", "encoder_message.expand().contiguous.expand().contiguous.clone", "encoder_message.expand().contiguous.expand().contiguous.expand"], "methods", ["None"], ["", "def", "initialize_hidden", "(", "self", ",", "encoder_message", ":", "torch", ".", "Tensor", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"\n        Populate the hidden variables with a message from the encoder.\n        All layers, and both the hidden and cell vectors, are filled with the same message.\n        :param encoder_message:  [batch_size, hidden_size] tensor\n        :return: tuple of Tensors representing the hidden and cell state of shape: [num_layers, batch_size, hidden_dim]\n        \"\"\"", "\n", "encoder_message", "=", "encoder_message", ".", "unsqueeze", "(", "0", ")", "# [1, batch_size, hidden_size]", "\n", "encoder_message", "=", "encoder_message", ".", "expand", "(", "self", ".", "num_layers", ",", "-", "1", ",", "\n", "-", "1", ")", ".", "contiguous", "(", ")", "# [num_layers, batch_size, hidden_size]", "\n", "return", "encoder_message", ".", "clone", "(", ")", ",", "encoder_message", ".", "clone", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.LuongAttentionDecoderRNN.extra_repr": [[324, 327], ["None"], "methods", ["None"], ["", "def", "extra_repr", "(", "self", ")", "->", "str", ":", "\n", "        ", "return", "\"AttentionDecoderRNN\\n num_layers={}\\n hidden_size={}\\n dropout={}\\n num_output_symbols={}\\n\"", ".", "format", "(", "\n", "self", ".", "num_layers", ",", "self", ".", "hidden_size", ",", "self", ".", "dropout_probability", ",", "self", ".", "output_size", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.BahdanauAttentionDecoderRNN.__init__": [[333, 358], ["torch.Module.__init__", "torch.Tanh", "torch.Tanh", "torch.Tanh", "torch.Embedding", "torch.Embedding", "torch.Embedding", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.LSTM", "torch.LSTM", "torch.LSTM", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "hidden_size", ":", "int", ",", "output_size", ":", "int", ",", "num_layers", ":", "int", ",", "textual_attention", ":", "Attention", ",", "\n", "visual_attention", ":", "Attention", ",", "dropout_probability", "=", "0.1", ",", "padding_idx", "=", "0", ",", "\n", "conditional_attention", "=", "False", ")", ":", "\n", "        ", "\"\"\"\n        :param hidden_size: number of hidden units in RNN, and embedding size for output symbols\n        :param output_size: number of output symbols\n        :param num_layers: number of hidden layers\n        :param dropout_probability: dropout applied to symbol embeddings and RNNs\n        \"\"\"", "\n", "super", "(", "BahdanauAttentionDecoderRNN", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "num_layers", "=", "num_layers", "\n", "self", ".", "conditional_attention", "=", "conditional_attention", "\n", "if", "self", ".", "conditional_attention", ":", "\n", "            ", "self", ".", "queries_to_keys", "=", "nn", ".", "Linear", "(", "hidden_size", "*", "2", ",", "hidden_size", ")", "\n", "", "self", ".", "hidden_size", "=", "hidden_size", "\n", "self", ".", "output_size", "=", "output_size", "\n", "self", ".", "dropout_probability", "=", "dropout_probability", "\n", "self", ".", "tanh", "=", "nn", ".", "Tanh", "(", ")", "\n", "self", ".", "embedding", "=", "nn", ".", "Embedding", "(", "output_size", ",", "hidden_size", ",", "padding_idx", "=", "padding_idx", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "dropout_probability", ")", "\n", "self", ".", "lstm", "=", "nn", ".", "LSTM", "(", "hidden_size", "*", "3", ",", "hidden_size", ",", "num_layers", "=", "num_layers", ",", "dropout", "=", "dropout_probability", ")", "\n", "self", ".", "textual_attention", "=", "textual_attention", "\n", "self", ".", "visual_attention", "=", "visual_attention", "\n", "self", ".", "output_to_hidden", "=", "nn", ".", "Linear", "(", "hidden_size", "*", "4", ",", "hidden_size", ",", "bias", "=", "False", ")", "\n", "self", ".", "hidden_to_output", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "output_size", ",", "bias", "=", "False", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.BahdanauAttentionDecoderRNN.forward_step": [[359, 429], ["seq2seq_model.BahdanauAttentionDecoderRNN.embedding", "seq2seq_model.BahdanauAttentionDecoderRNN.dropout", "embedded_input.unsqueeze.unsqueeze.unsqueeze", "seq2seq_model.BahdanauAttentionDecoderRNN.textual_attention", "encoded_situations.size", "seq2seq_model.BahdanauAttentionDecoderRNN.visual_attention", "attention_weights_commands.squeeze.squeeze.squeeze", "attention_weights_situations.squeeze.squeeze.squeeze", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "seq2seq_model.BahdanauAttentionDecoderRNN.lstm", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "seq2seq_model.BahdanauAttentionDecoderRNN.output_to_hidden", "seq2seq_model.BahdanauAttentionDecoderRNN.hidden_to_output", "output.squeeze.squeeze.squeeze", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "seq2seq_model.BahdanauAttentionDecoderRNN.tanh", "last_hidden.transpose", "attention_weights_situations.squeeze.squeeze.squeeze", "last_hidden.transpose", "encoded_commands.transpose", "encoded_commands.transpose", "range", "seq2seq_model.BahdanauAttentionDecoderRNN.queries_to_keys", "context_command.transpose", "context_situation.transpose", "context_command.transpose", "context_situation.transpose", "last_hidden.transpose"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "forward_step", "(", "self", ",", "input_tokens", ":", "torch", ".", "LongTensor", ",", "last_hidden", ":", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "\n", "encoded_commands", ":", "torch", ".", "Tensor", ",", "commands_lengths", ":", "torch", ".", "Tensor", ",", "\n", "encoded_situations", ":", "torch", ".", "Tensor", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "\n", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"\n        Run batch decoder forward for a single time step.\n         Each decoder step considers all of the encoder_outputs through attention.\n         Attention retrieval is based on decoder hidden state (not cell state)\n\n        :param input_tokens: one time step inputs tokens of length batch_size\n        :param last_hidden: previous decoder state, which is pair of tensors [num_layers, batch_size, hidden_size]\n        (pair for hidden and cell)\n        :param encoded_commands: all encoder outputs, [max_input_length, batch_size, hidden_size]\n        :param commands_lengths: length of each padded input seqencoded_commandsuence that were passed to the encoder.\n        :param encoded_situations: the situation encoder outputs, [image_dimension * image_dimension, batch_size,\n         hidden_size]\n        :return: output : un-normalized output probabilities, [batch_size, output_size]\n          hidden : current decoder state, which is a pair of tensors [num_layers, batch_size, hidden_size]\n           (pair for hidden and cell)\n          attention_weights : attention weights, [batch_size, 1, max_input_length]\n        \"\"\"", "\n", "last_hidden", ",", "last_cell", "=", "last_hidden", "\n", "\n", "# Embed each input symbol", "\n", "embedded_input", "=", "self", ".", "embedding", "(", "input_tokens", ")", "# [batch_size, hidden_size]", "\n", "embedded_input", "=", "self", ".", "dropout", "(", "embedded_input", ")", "\n", "embedded_input", "=", "embedded_input", ".", "unsqueeze", "(", "0", ")", "# [1, batch_size, hidden_size]", "\n", "\n", "# Bahdanau attention", "\n", "context_command", ",", "attention_weights_commands", "=", "self", ".", "textual_attention", "(", "\n", "queries", "=", "last_hidden", ".", "transpose", "(", "0", ",", "1", ")", ",", "projected_keys", "=", "encoded_commands", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "values", "=", "encoded_commands", ".", "transpose", "(", "0", ",", "1", ")", ",", "memory_lengths", "=", "commands_lengths", ")", "\n", "batch_size", ",", "image_num_memory", ",", "_", "=", "encoded_situations", ".", "size", "(", ")", "\n", "situation_lengths", "=", "[", "image_num_memory", "for", "_", "in", "range", "(", "batch_size", ")", "]", "\n", "\n", "if", "self", ".", "conditional_attention", ":", "\n", "            ", "queries", "=", "torch", ".", "cat", "(", "[", "last_hidden", ".", "transpose", "(", "0", ",", "1", ")", ",", "context_command", "]", ",", "dim", "=", "-", "1", ")", "\n", "queries", "=", "self", ".", "tanh", "(", "self", ".", "queries_to_keys", "(", "queries", ")", ")", "\n", "", "else", ":", "\n", "            ", "queries", "=", "last_hidden", ".", "transpose", "(", "0", ",", "1", ")", "\n", "\n", "", "context_situation", ",", "attention_weights_situations", "=", "self", ".", "visual_attention", "(", "\n", "queries", "=", "queries", ",", "projected_keys", "=", "encoded_situations", ",", "\n", "values", "=", "encoded_situations", ",", "memory_lengths", "=", "situation_lengths", ")", "\n", "# context : [batch_size, 1, hidden_size]", "\n", "# attention_weights : [batch_size, 1, max_input_length]", "\n", "\n", "# Concatenate the context vector and RNN hidden state, and map to an output", "\n", "attention_weights_commands", "=", "attention_weights_commands", ".", "squeeze", "(", "1", ")", "# [batch_size, max_input_length]", "\n", "attention_weights_situations", "=", "attention_weights_situations", ".", "squeeze", "(", "1", ")", "# [batch_size, im_dim * im_dim]", "\n", "concat_input", "=", "torch", ".", "cat", "(", "[", "embedded_input", ",", "\n", "context_command", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "context_situation", ".", "transpose", "(", "0", ",", "1", ")", "]", ",", "dim", "=", "2", ")", "# [1, batch_size hidden_size*3]", "\n", "\n", "last_hidden", "=", "(", "last_hidden", ",", "last_cell", ")", "\n", "lstm_output", ",", "hidden", "=", "self", ".", "lstm", "(", "concat_input", ",", "last_hidden", ")", "\n", "# lstm_output: [1, batch_size, hidden_size]", "\n", "# hidden: tuple of each [num_layers, batch_size, hidden_size] (pair for hidden and cell)", "\n", "# output = self.hidden_to_output(lstm_output)  # [batch_size, output_size]", "\n", "# output = output.squeeze(dim=0)", "\n", "\n", "# Concatenate all outputs and project to output size.", "\n", "pre_output", "=", "torch", ".", "cat", "(", "[", "embedded_input", ",", "lstm_output", ",", "\n", "context_command", ".", "transpose", "(", "0", ",", "1", ")", ",", "context_situation", ".", "transpose", "(", "0", ",", "1", ")", "]", ",", "dim", "=", "2", ")", "\n", "pre_output", "=", "self", ".", "output_to_hidden", "(", "pre_output", ")", "# [1, batch_size, hidden_size]", "\n", "output", "=", "self", ".", "hidden_to_output", "(", "pre_output", ")", "# [batch_size, output_size]", "\n", "output", "=", "output", ".", "squeeze", "(", "dim", "=", "0", ")", "# [batch_size, output_size]", "\n", "\n", "return", "(", "output", ",", "hidden", ",", "attention_weights_situations", ".", "squeeze", "(", "dim", "=", "1", ")", ",", "attention_weights_commands", ",", "\n", "attention_weights_situations", ")", "\n", "# output : [un-normalized probabilities] [batch_size, output_size]", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.BahdanauAttentionDecoderRNN.forward": [[433, 491], ["input_tokens.size", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "input_tokens.index_select", "encoded_commands.index_select.index_select.index_select", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "commands_lengths.index_select.index_select.index_select", "encoded_situations.index_select.index_select.index_select", "seq2seq_model.BahdanauAttentionDecoderRNN.visual_attention.key_layer", "seq2seq_model.BahdanauAttentionDecoderRNN.textual_attention.key_layer", "range", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "perm_idx.sort", "lstm_output.index_select.index_select.index_select", "input_lengths[].tolist", "attention_weights.index_select.index_select.index_select", "initial_h.index_select", "initial_c.index_select", "seq2seq_model.BahdanauAttentionDecoderRNN.forward_step", "all_attention_weights.append", "lstm_output.index_select.index_select.append", "attention_weights.index_select.index_select.sum", "attention_weights_situations.unsqueeze", "output.unsqueeze"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.forward_step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "forward", "(", "self", ",", "input_tokens", ":", "torch", ".", "LongTensor", ",", "input_lengths", ":", "List", "[", "int", "]", ",", "\n", "init_hidden", ":", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "encoded_commands", ":", "torch", ".", "Tensor", ",", "\n", "commands_lengths", ":", "List", "[", "int", "]", ",", "encoded_situations", ":", "torch", ".", "Tensor", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", ",", "\n", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"\n        Run batch attention decoder forward for a series of steps\n         Each decoder step considers all of the encoder_outputs through attention.\n         Attention retrieval is based on decoder hidden state (not cell state)\n\n        :param input_tokens: [batch_size, max_length];  padded target sequences\n        :param input_lengths: [batch_size] for sequence length of each padded target sequence\n        :param init_hidden: tuple of tensors [num_layers, batch_size, hidden_size] (for hidden and cell)\n        :param encoded_commands: [max_input_length, batch_size, embedding_dim]\n        :param commands_lengths: [batch_size] sequence length of each encoder sequence (without padding)\n        :param encoded_situations: [batch_size, image_width * image_width, image_features]; encoded image situations.\n        :return: output : unnormalized log-score, [max_length, batch_size, output_size]\n          hidden : current decoder state, tuple with each [num_layers, batch_size, hidden_size] (for hidden and cell)\n        \"\"\"", "\n", "batch_size", ",", "max_time", "=", "input_tokens", ".", "size", "(", ")", "\n", "\n", "# Sort the sequences by length in descending order", "\n", "input_lengths", "=", "torch", ".", "tensor", "(", "input_lengths", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", "\n", "input_lengths", ",", "perm_idx", "=", "torch", ".", "sort", "(", "input_lengths", ",", "descending", "=", "True", ")", "\n", "input_tokens_sorted", "=", "input_tokens", ".", "index_select", "(", "dim", "=", "0", ",", "index", "=", "perm_idx", ")", "\n", "initial_h", ",", "initial_c", "=", "init_hidden", "\n", "hidden", "=", "(", "initial_h", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "perm_idx", ")", ",", "\n", "initial_c", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "perm_idx", ")", ")", "\n", "encoded_commands", "=", "encoded_commands", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "perm_idx", ")", "\n", "commands_lengths", "=", "torch", ".", "tensor", "(", "commands_lengths", ",", "device", "=", "device", ")", "\n", "commands_lengths", "=", "commands_lengths", ".", "index_select", "(", "dim", "=", "0", ",", "index", "=", "perm_idx", ")", "\n", "encoded_situations", "=", "encoded_situations", ".", "index_select", "(", "dim", "=", "0", ",", "index", "=", "perm_idx", ")", "\n", "\n", "# For efficiency", "\n", "projected_keys_visual", "=", "self", ".", "visual_attention", ".", "key_layer", "(", "\n", "encoded_situations", ")", "# [batch_size, situation_length, dec_hidden_dim]", "\n", "projected_keys_textual", "=", "self", ".", "textual_attention", ".", "key_layer", "(", "\n", "encoded_commands", ")", "# [max_input_length, batch_size, dec_hidden_dim]", "\n", "\n", "all_attention_weights", "=", "[", "]", "\n", "lstm_output", "=", "[", "]", "\n", "for", "time", "in", "range", "(", "max_time", ")", ":", "\n", "            ", "input_token", "=", "input_tokens_sorted", "[", ":", ",", "time", "]", "\n", "(", "output", ",", "hidden", ",", "context_situation", ",", "attention_weights_commands", ",", "\n", "attention_weights_situations", ")", "=", "self", ".", "forward_step", "(", "input_token", ",", "hidden", ",", "projected_keys_textual", ",", "\n", "commands_lengths", ",", "\n", "projected_keys_visual", ")", "\n", "all_attention_weights", ".", "append", "(", "attention_weights_situations", ".", "unsqueeze", "(", "0", ")", ")", "\n", "lstm_output", ".", "append", "(", "output", ".", "unsqueeze", "(", "0", ")", ")", "\n", "", "lstm_output", "=", "torch", ".", "cat", "(", "lstm_output", ",", "dim", "=", "0", ")", "# [max_time, batch_size, output_size]", "\n", "attention_weights", "=", "torch", ".", "cat", "(", "all_attention_weights", ",", "dim", "=", "0", ")", "# [max_time, batch_size, situation_dim**2]", "\n", "\n", "# Reverse the sorting", "\n", "_", ",", "unperm_idx", "=", "perm_idx", ".", "sort", "(", "0", ")", "\n", "lstm_output", "=", "lstm_output", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "unperm_idx", ")", "# [max_time, batch_size, output_size]", "\n", "seq_len", "=", "input_lengths", "[", "unperm_idx", "]", ".", "tolist", "(", ")", "\n", "attention_weights", "=", "attention_weights", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "unperm_idx", ")", "\n", "\n", "return", "lstm_output", ",", "seq_len", ",", "attention_weights", ".", "sum", "(", "dim", "=", "0", ")", "\n", "# output : [unnormalized log-score] [max_length, batch_size, output_size]", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.BahdanauAttentionDecoderRNN.initialize_hidden": [[494, 505], ["encoder_message.expand().contiguous.expand().contiguous.unsqueeze", "encoder_message.expand().contiguous.expand().contiguous.expand().contiguous", "encoder_message.expand().contiguous.expand().contiguous.clone", "encoder_message.expand().contiguous.expand().contiguous.clone", "encoder_message.expand().contiguous.expand().contiguous.expand"], "methods", ["None"], ["", "def", "initialize_hidden", "(", "self", ",", "encoder_message", ":", "torch", ".", "Tensor", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"\n        Populate the hidden variables with a message from the encoder.\n        All layers, and both the hidden and cell vectors, are filled with the same message.\n        :param encoder_message:  [batch_size, hidden_size] tensor\n        :return: tuple of Tensors representing the hidden and cell state of shape: [num_layers, batch_size, hidden_dim]\n        \"\"\"", "\n", "encoder_message", "=", "encoder_message", ".", "unsqueeze", "(", "0", ")", "# [1, batch_size, hidden_size]", "\n", "encoder_message", "=", "encoder_message", ".", "expand", "(", "self", ".", "num_layers", ",", "-", "1", ",", "\n", "-", "1", ")", ".", "contiguous", "(", ")", "# [num_layers, batch_size, hidden_size]", "\n", "return", "encoder_message", ".", "clone", "(", ")", ",", "encoder_message", ".", "clone", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.BahdanauAttentionDecoderRNN.extra_repr": [[506, 509], ["None"], "methods", ["None"], ["", "def", "extra_repr", "(", "self", ")", "->", "str", ":", "\n", "        ", "return", "\"AttentionDecoderRNN\\n num_layers={}\\n hidden_size={}\\n dropout={}\\n num_output_symbols={}\\n\"", ".", "format", "(", "\n", "self", ".", "num_layers", ",", "self", ".", "hidden_size", ",", "self", ".", "dropout_probability", ",", "self", ".", "output_size", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.DecoderRNN.__init__": [[515, 531], ["torch.Module.__init__", "torch.Embedding", "torch.Embedding", "torch.Embedding", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.LSTM", "torch.LSTM", "torch.LSTM", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "hidden_size", ":", "int", ",", "output_size", ":", "int", ",", "num_layers", ":", "int", ",", "dropout_probability", "=", "0.1", ")", ":", "\n", "        ", "\"\"\"\n        :param hidden_size: number of hidden units in RNN, and embedding size for output symbols\n        :param output_size: number of output symbols\n        :param num_layers: number of hidden layers\n        :param dropout_probability: dropout applied to symbol embeddings and RNNs\n        \"\"\"", "\n", "super", "(", "DecoderRNN", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "num_layers", "=", "num_layers", "\n", "self", ".", "hidden_size", "=", "hidden_size", "\n", "self", ".", "output_size", "=", "output_size", "\n", "self", ".", "dropout_probability", "=", "dropout_probability", "\n", "self", ".", "embedding", "=", "nn", ".", "Embedding", "(", "output_size", ",", "hidden_size", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "dropout_probability", ")", "\n", "self", ".", "lstm", "=", "nn", ".", "LSTM", "(", "hidden_size", ",", "hidden_size", ",", "num_layers", "=", "num_layers", ",", "dropout", "=", "dropout_probability", ")", "\n", "self", ".", "hidden_to_output", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "output_size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.DecoderRNN.forward": [[532, 553], ["seq2seq_model.DecoderRNN.embedding", "seq2seq_model.DecoderRNN.dropout", "embedding.unsqueeze.unsqueeze.unsqueeze", "seq2seq_model.DecoderRNN.lstm", "lstm_output.squeeze.squeeze.squeeze", "seq2seq_model.DecoderRNN.hidden_to_output"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "input_tokens", ":", "torch", ".", "LongTensor", ",", "last_hidden", ":", "torch", ".", "Tensor", ")", ":", "\n", "        ", "\"\"\"\n        Run batch decoder forward for a single time step.\n\n        :param input_tokens: [batch_size]\n        :param last_hidden: previous decoder state, tuple of [num_layers, batch_size, hidden_size] (for hidden and cell)\n        :return:\n          output : un-normalized output probabilities, [batch_size, output_size]\n          hidden : current decoder state, tuple of [num_layers, batch_size, hidden_size] (for hidden and cell)\n        \"\"\"", "\n", "\n", "# Embed each input symbol", "\n", "embedding", "=", "self", ".", "embedding", "(", "input_tokens", ")", "# [batch_size, hidden_size]", "\n", "embedding", "=", "self", ".", "dropout", "(", "embedding", ")", "\n", "embedding", "=", "embedding", ".", "unsqueeze", "(", "0", ")", "# [1, batch_size, hidden_size]", "\n", "lstm_output", ",", "hidden", "=", "self", ".", "lstm", "(", "embedding", ",", "last_hidden", ")", "\n", "# rnn_output is [1, batch_size, hidden_size]", "\n", "# hidden is [num_layers, batch_size, hidden_size] (pair for hidden and cell)", "\n", "lstm_output", "=", "lstm_output", ".", "squeeze", "(", "0", ")", "# [batch_size, hidden_size]", "\n", "output", "=", "self", ".", "hidden_to_output", "(", "lstm_output", ")", "# [batch_size, output_size]", "\n", "return", "output", ",", "hidden", "\n", "# output : un-normalized probabilities [batch_size, output_size]", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.DecoderRNN.init_hidden": [[556, 567], ["encoder_message.expand().contiguous.expand().contiguous.unsqueeze", "encoder_message.expand().contiguous.expand().contiguous.expand().contiguous", "encoder_message.expand().contiguous.expand().contiguous.clone", "encoder_message.expand().contiguous.expand().contiguous.clone", "encoder_message.expand().contiguous.expand().contiguous.expand"], "methods", ["None"], ["", "def", "init_hidden", "(", "self", ",", "encoder_message", ":", "torch", ".", "Tensor", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"\n        Populate the hidden variables with a message from the decoder.\n        All layers, and both the hidden and cell vectors, are filled with the same message.\n        :param encoder_message: [batch_size, hidden_size]\n        :return:\n        \"\"\"", "\n", "encoder_message", "=", "encoder_message", ".", "unsqueeze", "(", "0", ")", "# 1, batch_size, hidden_size", "\n", "encoder_message", "=", "encoder_message", ".", "expand", "(", "self", ".", "num_layers", ",", "-", "1", ",", "\n", "-", "1", ")", ".", "contiguous", "(", ")", "# nlayers, batch_size, hidden_size tensor", "\n", "return", "encoder_message", ".", "clone", "(", ")", ",", "encoder_message", ".", "clone", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_model.DecoderRNN.extra_repr": [[568, 571], ["None"], "methods", ["None"], ["", "def", "extra_repr", "(", "self", ")", "->", "str", ":", "\n", "        ", "return", "\"DecoderRNN\\n num_layers={}\\n hidden_size={}\\n dropout={}\\n num_output_symbols={}\\n\"", ".", "format", "(", "\n", "self", ".", "num_layers", ",", "self", ".", "hidden_size", ",", "self", ".", "dropout_probability", ",", "self", ".", "output_size", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.__init__": [[22, 34], ["collections.defaultdict", "collections.Counter", "gSCAN_dataset.Vocabulary._idx_to_word.index"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "sos_token", "=", "\"<SOS>\"", ",", "eos_token", "=", "\"<EOS>\"", ",", "pad_token", "=", "\"<PAD>\"", ")", ":", "\n", "        ", "\"\"\"\n        NB: <PAD> token is by construction idx 0.\n        \"\"\"", "\n", "self", ".", "sos_token", "=", "sos_token", "\n", "self", ".", "eos_token", "=", "eos_token", "\n", "self", ".", "pad_token", "=", "pad_token", "\n", "self", ".", "_idx_to_word", "=", "[", "pad_token", ",", "sos_token", ",", "eos_token", "]", "\n", "self", ".", "_word_to_idx", "=", "defaultdict", "(", "lambda", ":", "self", ".", "_idx_to_word", ".", "index", "(", "self", ".", "pad_token", ")", ")", "\n", "self", ".", "_word_to_idx", "[", "sos_token", "]", "=", "1", "\n", "self", ".", "_word_to_idx", "[", "eos_token", "]", "=", "2", "\n", "self", ".", "_word_frequencies", "=", "Counter", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.word_to_idx": [[35, 37], ["None"], "methods", ["None"], ["", "def", "word_to_idx", "(", "self", ",", "word", ":", "str", ")", "->", "int", ":", "\n", "        ", "return", "self", ".", "_word_to_idx", "[", "word", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.idx_to_word": [[38, 40], ["None"], "methods", ["None"], ["", "def", "idx_to_word", "(", "self", ",", "idx", ":", "int", ")", "->", "str", ":", "\n", "        ", "return", "self", ".", "_idx_to_word", "[", "idx", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.contains_word": [[41, 46], ["None"], "methods", ["None"], ["", "def", "contains_word", "(", "self", ",", "word", ":", "str", ")", "->", "bool", ":", "\n", "        ", "if", "self", ".", "_word_to_idx", "[", "word", "]", "!=", "0", ":", "\n", "            ", "return", "True", "\n", "", "else", ":", "\n", "            ", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.add_sentence": [[47, 53], ["gSCAN_dataset.Vocabulary._idx_to_word.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "", "def", "add_sentence", "(", "self", ",", "sentence", ":", "List", "[", "str", "]", ")", ":", "\n", "        ", "for", "word", "in", "sentence", ":", "\n", "            ", "if", "word", "not", "in", "self", ".", "_word_to_idx", ":", "\n", "                ", "self", ".", "_word_to_idx", "[", "word", "]", "=", "self", ".", "size", "\n", "self", ".", "_idx_to_word", ".", "append", "(", "word", ")", "\n", "", "self", ".", "_word_frequencies", "[", "word", "]", "+=", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.most_common": [[54, 56], ["gSCAN_dataset.Vocabulary._word_frequencies.most_common"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.most_common"], ["", "", "def", "most_common", "(", "self", ",", "n", "=", "10", ")", ":", "\n", "        ", "return", "self", ".", "_word_frequencies", ".", "most_common", "(", "n", "=", "n", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.pad_idx": [[57, 60], ["gSCAN_dataset.Vocabulary.word_to_idx"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.word_to_idx"], ["", "@", "property", "\n", "def", "pad_idx", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "word_to_idx", "(", "self", ".", "pad_token", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.sos_idx": [[61, 64], ["gSCAN_dataset.Vocabulary.word_to_idx"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.word_to_idx"], ["", "@", "property", "\n", "def", "sos_idx", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "word_to_idx", "(", "self", ".", "sos_token", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.eos_idx": [[65, 68], ["gSCAN_dataset.Vocabulary.word_to_idx"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.word_to_idx"], ["", "@", "property", "\n", "def", "eos_idx", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "word_to_idx", "(", "self", ".", "eos_token", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.size": [[69, 72], ["len"], "methods", ["None"], ["", "@", "property", "\n", "def", "size", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "_idx_to_word", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.load": [[73, 88], ["os.path.exists", "open", "json.load", "cls", "collections.defaultdict", "all_data[].items", "collections.Counter"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load"], ["", "@", "classmethod", "\n", "def", "load", "(", "cls", ",", "path", ":", "str", ")", ":", "\n", "        ", "assert", "os", ".", "path", ".", "exists", "(", "path", ")", ",", "\"Trying to load a vocabulary from a non-existing file {}\"", ".", "format", "(", "path", ")", "\n", "with", "open", "(", "path", ",", "'r'", ")", "as", "infile", ":", "\n", "            ", "all_data", "=", "json", ".", "load", "(", "infile", ")", "\n", "sos_token", "=", "all_data", "[", "\"sos_token\"", "]", "\n", "eos_token", "=", "all_data", "[", "\"eos_token\"", "]", "\n", "pad_token", "=", "all_data", "[", "\"pad_token\"", "]", "\n", "vocab", "=", "cls", "(", "sos_token", "=", "sos_token", ",", "eos_token", "=", "eos_token", ",", "pad_token", "=", "pad_token", ")", "\n", "vocab", ".", "_idx_to_word", "=", "all_data", "[", "\"idx_to_word\"", "]", "\n", "vocab", ".", "_word_to_idx", "=", "defaultdict", "(", "int", ")", "\n", "for", "word", ",", "idx", "in", "all_data", "[", "\"word_to_idx\"", "]", ".", "items", "(", ")", ":", "\n", "                ", "vocab", ".", "_word_to_idx", "[", "word", "]", "=", "idx", "\n", "", "vocab", ".", "_word_frequencies", "=", "Counter", "(", "all_data", "[", "\"word_frequencies\"", "]", ")", "\n", "", "return", "vocab", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.to_dict": [[89, 97], ["None"], "methods", ["None"], ["", "def", "to_dict", "(", "self", ")", "->", "dict", ":", "\n", "        ", "return", "{", "\n", "\"sos_token\"", ":", "self", ".", "sos_token", ",", "\n", "\"eos_token\"", ":", "self", ".", "eos_token", ",", "\n", "\"pad_token\"", ":", "self", ".", "pad_token", ",", "\n", "\"idx_to_word\"", ":", "self", ".", "_idx_to_word", ",", "\n", "\"word_to_idx\"", ":", "self", ".", "_word_to_idx", ",", "\n", "\"word_frequencies\"", ":", "self", ".", "_word_frequencies", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.save": [[99, 103], ["open", "json.dump", "gSCAN_dataset.Vocabulary.to_dict"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.Situation.to_dict"], ["", "def", "save", "(", "self", ",", "path", ":", "str", ")", "->", "str", ":", "\n", "        ", "with", "open", "(", "path", ",", "'w'", ")", "as", "outfile", ":", "\n", "            ", "json", ".", "dump", "(", "self", ".", "to_dict", "(", ")", ",", "outfile", ",", "indent", "=", "4", ")", "\n", "", "return", "path", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.__init__": [[110, 164], ["os.path.exists", "GroundedScan.dataset.GroundedScan.dataset.GroundedScan.load_dataset_from_file", "gSCAN_dataset.GroundedScanDataset.dataset._data_statistics.get", "numpy.array", "numpy.array", "numpy.array", "logger.warning", "logger.info", "[].items", "logger.info", "[].items", "logger.info", "gSCAN_dataset.Vocabulary", "gSCAN_dataset.Vocabulary", "gSCAN_dataset.GroundedScanDataset.read_vocabularies", "logger.info", "logger.info", "gSCAN_dataset.Vocabulary.load", "gSCAN_dataset.Vocabulary.load", "logger.info", "os.path.exists", "os.path.exists", "logger.info", "items.items", "logger.info", "items.items", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "logger.info", "logger.info"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.load_dataset_from_file", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.read_vocabularies", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load"], ["def", "__init__", "(", "self", ",", "path_to_data", ":", "str", ",", "save_directory", ":", "str", ",", "k", ":", "int", ",", "split", "=", "\"train\"", ",", "input_vocabulary_file", "=", "\"\"", ",", "\n", "target_vocabulary_file", "=", "\"\"", ",", "generate_vocabulary", "=", "False", ",", "upsample_isolated", "=", "1", ",", "seed", "=", "1", ",", "\n", "isolate_adverb_types", "=", "None", ",", "only_keep_adverbs", "=", "None", ",", "isolate_examples_with", "=", "\"cautiously\"", ")", ":", "\n", "        ", "assert", "os", ".", "path", ".", "exists", "(", "path_to_data", ")", ",", "\"Trying to read a gSCAN dataset from a non-existing file {}.\"", ".", "format", "(", "\n", "path_to_data", ")", "\n", "if", "not", "generate_vocabulary", ":", "\n", "            ", "assert", "os", ".", "path", ".", "exists", "(", "os", ".", "path", ".", "join", "(", "save_directory", ",", "input_vocabulary_file", ")", ")", "and", "os", ".", "path", ".", "exists", "(", "\n", "os", ".", "path", ".", "join", "(", "save_directory", ",", "target_vocabulary_file", ")", ")", ",", "\"Trying to load vocabularies from non-existing files.\"", "\n", "", "if", "split", "==", "\"test\"", "and", "generate_vocabulary", ":", "\n", "            ", "logger", ".", "warning", "(", "\"WARNING: generating a vocabulary from the test set.\"", ")", "\n", "", "self", ".", "dataset", "=", "GroundedScan", ".", "load_dataset_from_file", "(", "path_to_data", ",", "splits", "=", "[", "split", "]", ",", "\n", "save_directory", "=", "save_directory", ",", "k", "=", "k", ",", "\n", "upsample_isolated", "=", "upsample_isolated", ",", "\n", "isolate_adverb_types", "=", "isolate_adverb_types", ",", "\n", "only_keep_adverbs", "=", "only_keep_adverbs", ",", "\n", "isolate_examples_with", "=", "isolate_examples_with", ",", "\n", "seed", "=", "seed", ")", "\n", "if", "self", ".", "dataset", ".", "_data_statistics", ".", "get", "(", "\"adverb_1\"", ")", ":", "\n", "            ", "logger", ".", "info", "(", "\"Verb-adverb combinations in training set: \"", ")", "\n", "for", "adverb", ",", "items", "in", "self", ".", "dataset", ".", "_data_statistics", "[", "\"train\"", "]", "[", "\"verb_adverb_combinations\"", "]", ".", "items", "(", ")", ":", "\n", "                ", "logger", ".", "info", "(", "\"Verbs for adverb: {}\"", ".", "format", "(", "adverb", ")", ")", "\n", "for", "key", ",", "count", "in", "items", ".", "items", "(", ")", ":", "\n", "                    ", "logger", ".", "info", "(", "\"   {}: {} occurrences.\"", ".", "format", "(", "key", ",", "count", ")", ")", "\n", "", "", "logger", ".", "info", "(", "\"Verb-adverb combinations in dev set: \"", ")", "\n", "for", "adverb", ",", "items", "in", "self", ".", "dataset", ".", "_data_statistics", "[", "\"dev\"", "]", "[", "\"verb_adverb_combinations\"", "]", ".", "items", "(", ")", ":", "\n", "                ", "logger", ".", "info", "(", "\"Verbs for adverb: {}\"", ".", "format", "(", "adverb", ")", ")", "\n", "for", "key", ",", "count", "in", "items", ".", "items", "(", ")", ":", "\n", "                    ", "logger", ".", "info", "(", "\"   {}: {} occurrences.\"", ".", "format", "(", "key", ",", "count", ")", ")", "\n", "", "", "", "self", ".", "image_dimensions", "=", "None", "\n", "self", ".", "image_channels", "=", "16", "\n", "self", ".", "split", "=", "split", "\n", "self", ".", "directory", "=", "save_directory", "\n", "\n", "# Keeping track of data.", "\n", "self", ".", "_examples", "=", "np", ".", "array", "(", "[", "]", ")", "\n", "self", ".", "_input_lengths", "=", "np", ".", "array", "(", "[", "]", ")", "\n", "self", ".", "_target_lengths", "=", "np", ".", "array", "(", "[", "]", ")", "\n", "if", "generate_vocabulary", ":", "\n", "            ", "logger", ".", "info", "(", "\"Generating vocabularies...\"", ")", "\n", "self", ".", "input_vocabulary", "=", "Vocabulary", "(", ")", "\n", "self", ".", "target_vocabulary", "=", "Vocabulary", "(", ")", "\n", "self", ".", "read_vocabularies", "(", ")", "\n", "logger", ".", "info", "(", "\"Done generating vocabularies.\"", ")", "\n", "", "else", ":", "\n", "            ", "logger", ".", "info", "(", "\"Loading vocabularies...\"", ")", "\n", "self", ".", "input_vocabulary", "=", "Vocabulary", ".", "load", "(", "os", ".", "path", ".", "join", "(", "save_directory", ",", "input_vocabulary_file", ")", ")", "\n", "self", ".", "target_vocabulary", "=", "Vocabulary", ".", "load", "(", "os", ".", "path", ".", "join", "(", "save_directory", ",", "target_vocabulary_file", ")", ")", "\n", "logger", ".", "info", "(", "\"Done loading vocabularies.\"", ")", "\n", "\n", "", "", "def", "read_vocabularies", "(", "self", ")", "->", "{", "}", ":", "\n", "        ", "\"\"\"\n        Loop over all examples in the dataset and add the words in them to the vocabularies.\n        \"\"\"", "\n", "logger", ".", "info", "(", "\"Populating vocabulary...\"", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.read_vocabularies": [[181, 194], ["logger.info", "enumerate", "gSCAN_dataset.GroundedScanDataset.dataset.get_examples_with_image", "gSCAN_dataset.GroundedScanDataset.input_vocabulary.add_sentence", "gSCAN_dataset.GroundedScanDataset.target_vocabulary.add_sentence", "gSCAN_dataset.GroundedScanDataset.convert_target_to_simple", "gSCAN_dataset.GroundedScanDataset.target_vocabulary.add_sentence"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_examples_with_image", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.add_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.add_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.convert_target_to_simple", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.add_sentence"], ["\n", "", "def", "shuffle_data", "(", "self", ")", "->", "{", "}", ":", "\n", "        ", "\"\"\"\n        Reorder the data examples and reorder the lengths of the input and target commands accordingly.\n        \"\"\"", "\n", "random_permutation", "=", "np", ".", "random", ".", "permutation", "(", "len", "(", "self", ".", "_examples", ")", ")", "\n", "self", ".", "_examples", "=", "self", ".", "_examples", "[", "random_permutation", "]", "\n", "self", ".", "_target_lengths", "=", "self", ".", "_target_lengths", "[", "random_permutation", "]", "\n", "self", ".", "_input_lengths", "=", "self", ".", "_input_lengths", "[", "random_permutation", "]", "\n", "\n", "", "def", "get_data_iterator", "(", "self", ",", "batch_size", "=", "10", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", ",", "torch", ".", "Tensor", ",", "List", "[", "dict", "]", ",", "\n", "torch", ".", "Tensor", ",", "List", "[", "int", "]", ",", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ":", "\n", "        "]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.save_vocabularies": [[195, 198], ["gSCAN_dataset.GroundedScanDataset.input_vocabulary.save", "gSCAN_dataset.GroundedScanDataset.target_vocabulary.save", "os.path.join", "os.path.join"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.get_vocabulary": [[199, 207], ["ValueError"], "methods", ["None"], ["\n", "for", "example_i", "in", "range", "(", "0", ",", "len", "(", "self", ".", "_examples", ")", ",", "batch_size", ")", ":", "\n", "            ", "if", "example_i", "+", "batch_size", ">", "len", "(", "self", ".", "_examples", ")", ":", "\n", "                ", "batch_size", "=", "len", "(", "self", ".", "_examples", ")", "-", "example_i", "\n", "", "examples", "=", "self", ".", "_examples", "[", "example_i", ":", "example_i", "+", "batch_size", "]", "\n", "input_lengths", "=", "self", ".", "_input_lengths", "[", "example_i", ":", "example_i", "+", "batch_size", "]", "\n", "target_lengths", "=", "self", ".", "_target_lengths", "[", "example_i", ":", "example_i", "+", "batch_size", "]", "\n", "max_input_length", "=", "np", ".", "max", "(", "input_lengths", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.shuffle_data": [[208, 216], ["numpy.random.permutation", "len"], "methods", ["None"], ["max_target_length", "=", "np", ".", "max", "(", "target_lengths", ")", "\n", "input_batch", "=", "[", "]", "\n", "target_batch", "=", "[", "]", "\n", "situation_batch", "=", "[", "]", "\n", "situation_representation_batch", "=", "[", "]", "\n", "derivation_representation_batch", "=", "[", "]", "\n", "agent_positions_batch", "=", "[", "]", "\n", "target_positions_batch", "=", "[", "]", "\n", "for", "example", "in", "examples", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.get_data_iterator": [[217, 274], ["isinstance", "logger.info", "numpy.array", "numpy.array", "numpy.array", "enumerate", "gSCAN_dataset.GroundedScanDataset.dataset.get_examples_with_image", "gSCAN_dataset.GroundedScanDataset.sentence_to_array", "gSCAN_dataset.GroundedScanDataset.sentence_to_array", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "numpy.append", "numpy.append", "numpy.append", "gSCAN_dataset.GroundedScanDataset.convert_target_to_simple", "len", "numpy.array", "numpy.array", "numpy.array", "len", "torch.tensor", "torch.tensor", "torch.tensor", "len", "len", "gSCAN_dataset.GroundedScanDataset.make_batch"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_examples_with_image", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.convert_target_to_simple", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.make_batch"], ["                ", "to_pad_input", "=", "max_input_length", "-", "example", "[", "\"input_tensor\"", "]", ".", "size", "(", "1", ")", "\n", "to_pad_target", "=", "max_target_length", "-", "example", "[", "\"target_tensor\"", "]", ".", "size", "(", "1", ")", "\n", "padded_input", "=", "torch", ".", "cat", "(", "[", "\n", "example", "[", "\"input_tensor\"", "]", ",", "\n", "torch", ".", "zeros", "(", "int", "(", "to_pad_input", ")", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "0", ")", "]", ",", "dim", "=", "1", ")", "\n", "padded_target", "=", "torch", ".", "cat", "(", "[", "\n", "example", "[", "\"target_tensor\"", "]", ",", "\n", "torch", ".", "zeros", "(", "int", "(", "to_pad_target", ")", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "0", ")", "]", ",", "dim", "=", "1", ")", "\n", "input_batch", ".", "append", "(", "padded_input", ")", "\n", "target_batch", ".", "append", "(", "padded_target", ")", "\n", "situation_batch", ".", "append", "(", "example", "[", "\"situation_tensor\"", "]", ")", "\n", "situation_representation_batch", ".", "append", "(", "example", "[", "\"situation_representation\"", "]", ")", "\n", "derivation_representation_batch", ".", "append", "(", "example", "[", "\"derivation_representation\"", "]", ")", "\n", "agent_positions_batch", ".", "append", "(", "example", "[", "\"agent_position\"", "]", ")", "\n", "target_positions_batch", ".", "append", "(", "example", "[", "\"target_position\"", "]", ")", "\n", "\n", "", "yield", "(", "torch", ".", "cat", "(", "input_batch", ",", "dim", "=", "0", ")", ",", "input_lengths", ",", "derivation_representation_batch", ",", "\n", "torch", ".", "cat", "(", "situation_batch", ",", "dim", "=", "0", ")", ",", "situation_representation_batch", ",", "torch", ".", "cat", "(", "target_batch", ",", "dim", "=", "0", ")", ",", "\n", "target_lengths", ",", "torch", ".", "cat", "(", "agent_positions_batch", ",", "dim", "=", "0", ")", ",", "torch", ".", "cat", "(", "target_positions_batch", ",", "dim", "=", "0", ")", ")", "\n", "\n", "", "", "def", "read_dataset", "(", "self", ",", "max_examples", "=", "None", ",", "simple_situation_representation", "=", "True", ")", "->", "{", "}", ":", "\n", "        ", "\"\"\"\n        Loop over the data examples in GroundedScan and convert them to tensors, also save the lengths\n        for input and target sequences that are needed for padding.\n        :param max_examples: how many examples to read maximally, read all if None.\n        :param simple_situation_representation: whether to read the full situation image in RGB or the simplified\n        smaller representation.\n        \"\"\"", "\n", "logger", ".", "info", "(", "\"Converting dataset to tensors...\"", ")", "\n", "for", "i", ",", "example", "in", "enumerate", "(", "self", ".", "dataset", ".", "get_examples_with_image", "(", "self", ".", "split", ",", "simple_situation_representation", ")", ")", ":", "\n", "            ", "if", "max_examples", ":", "\n", "                ", "if", "len", "(", "self", ".", "_examples", ")", ">", "max_examples", ":", "\n", "                    ", "return", "\n", "", "", "empty_example", "=", "{", "}", "\n", "input_commands", "=", "example", "[", "\"input_command\"", "]", "\n", "target_commands", "=", "example", "[", "\"target_command\"", "]", "\n", "#equivalent_target_commands = example[\"equivalent_target_command\"]", "\n", "situation_image", "=", "example", "[", "\"situation_image\"", "]", "\n", "if", "i", "==", "0", ":", "\n", "                ", "self", ".", "image_dimensions", "=", "situation_image", ".", "shape", "[", "0", "]", "\n", "self", ".", "image_channels", "=", "situation_image", ".", "shape", "[", "-", "1", "]", "\n", "", "situation_repr", "=", "example", "[", "\"situation_representation\"", "]", "\n", "input_array", "=", "self", ".", "sentence_to_array", "(", "input_commands", ",", "vocabulary", "=", "\"input\"", ")", "\n", "target_array", "=", "self", ".", "sentence_to_array", "(", "target_commands", ",", "vocabulary", "=", "\"target\"", ")", "\n", "#equivalent_target_array = self.sentence_to_array(equivalent_target_commands, vocabulary=\"target\")", "\n", "empty_example", "[", "\"input_tensor\"", "]", "=", "torch", ".", "tensor", "(", "input_array", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"target_tensor\"", "]", "=", "torch", ".", "tensor", "(", "target_array", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "#empty_example[\"equivalent_target_tensor\"] = torch.tensor(equivalent_target_array, dtype=torch.long,", "\n", "#                                                         device=device).unsqueeze(dim=0)", "\n", "empty_example", "[", "\"situation_tensor\"", "]", "=", "torch", ".", "tensor", "(", "situation_image", ",", "dtype", "=", "torch", ".", "float", ",", "device", "=", "device", "\n", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"situation_representation\"", "]", "=", "situation_repr", "\n", "empty_example", "[", "\"derivation_representation\"", "]", "=", "example", "[", "\"derivation_representation\"", "]", "\n", "empty_example", "[", "\"agent_position\"", "]", "=", "torch", ".", "tensor", "(", "\n", "(", "int", "(", "situation_repr", "[", "\"agent_position\"", "]", "[", "\"row\"", "]", ")", "*", "int", "(", "situation_repr", "[", "\"grid_size\"", "]", ")", ")", "+", "\n", "int", "(", "situation_repr", "[", "\"agent_position\"", "]", "[", "\"column\"", "]", ")", ",", "dtype", "=", "torch", ".", "long", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.read_dataset": [[334, 380], ["logger.info", "enumerate", "gSCAN_dataset.GroundedScanDataset.dataset.get_examples_with_image", "gSCAN_dataset.GroundedScanDataset.sentence_to_array", "gSCAN_dataset.GroundedScanDataset.sentence_to_array", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "numpy.append", "numpy.append", "numpy.append", "len", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "len", "len", "int", "int", "int", "int", "int", "int"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_examples_with_image", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.sentence_to_array": [[381, 395], ["gSCAN_dataset.GroundedScanDataset.get_vocabulary", "sentence_array.append", "sentence_array.append", "gSCAN_dataset.GroundedScanDataset.word_to_idx"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_vocabulary", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.word_to_idx"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.array_to_sentence": [[396, 405], ["gSCAN_dataset.GroundedScanDataset.get_vocabulary", "gSCAN_dataset.GroundedScanDataset.idx_to_word"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_vocabulary", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.idx_to_word"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.num_examples": [[406, 409], ["len"], "methods", ["None"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.input_vocabulary_size": [[410, 413], ["None"], "methods", ["None"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.target_vocabulary_size": [[414, 417], ["None"], "methods", ["None"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.convert_target_to_simple": [[165, 180], ["None"], "methods", ["None"], ["for", "i", ",", "example", "in", "enumerate", "(", "self", ".", "dataset", ".", "get_examples_with_image", "(", "self", ".", "split", ")", ")", ":", "\n", "            ", "self", ".", "input_vocabulary", ".", "add_sentence", "(", "example", "[", "\"input_command\"", "]", ")", "\n", "self", ".", "target_vocabulary", ".", "add_sentence", "(", "example", "[", "\"target_command\"", "]", ")", "\n", "\n", "", "", "def", "save_vocabularies", "(", "self", ",", "input_vocabulary_file", ":", "str", ",", "target_vocabulary_file", ":", "str", ")", ":", "\n", "        ", "self", ".", "input_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "input_vocabulary_file", ")", ")", "\n", "self", ".", "target_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "target_vocabulary_file", ")", ")", "\n", "\n", "", "def", "get_vocabulary", "(", "self", ",", "vocabulary", ":", "str", ")", "->", "Vocabulary", ":", "\n", "        ", "if", "vocabulary", "==", "\"input\"", ":", "\n", "            ", "vocab", "=", "self", ".", "input_vocabulary", "\n", "", "elif", "vocabulary", "==", "\"target\"", ":", "\n", "            ", "vocab", "=", "self", ".", "target_vocabulary", "\n", "", "else", ":", "\n", "            ", "raise", "ValueError", "(", "\"Specified unknown vocabulary in sentence_to_array: {}\"", ".", "format", "(", "vocabulary", ")", ")", "\n", "", "return", "vocab", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.make_batch": [[275, 333], ["numpy.max", "numpy.max", "torch.cat", "torch.cat", "input_batch.append", "target_batch.append", "situation_representation_batch.append", "situation_batch.append", "torch.tensor().unsqueeze", "agent_positions_batch.append", "torch.tensor().unsqueeze", "target_positions_batch.append", "derivation_representation_batch.append", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "example[].size", "example[].size", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.tensor", "torch.tensor", "torch.zeros", "torch.zeros", "int", "int", "int", "int", "int", "int", "int", "int"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"target_position\"", "]", "=", "torch", ".", "tensor", "(", "\n", "(", "int", "(", "situation_repr", "[", "\"target_object\"", "]", "[", "\"position\"", "]", "[", "\"row\"", "]", ")", "*", "int", "(", "situation_repr", "[", "\"grid_size\"", "]", ")", ")", "+", "\n", "int", "(", "situation_repr", "[", "\"target_object\"", "]", "[", "\"position\"", "]", "[", "\"column\"", "]", ")", ",", "\n", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "self", ".", "_input_lengths", "=", "np", ".", "append", "(", "self", ".", "_input_lengths", ",", "[", "len", "(", "input_array", ")", "]", ")", "\n", "self", ".", "_target_lengths", "=", "np", ".", "append", "(", "self", ".", "_target_lengths", ",", "[", "len", "(", "target_array", ")", "]", ")", "\n", "self", ".", "_examples", "=", "np", ".", "append", "(", "self", ".", "_examples", ",", "[", "empty_example", "]", ")", "\n", "\n", "", "", "def", "sentence_to_array", "(", "self", ",", "sentence", ":", "List", "[", "str", "]", ",", "vocabulary", ":", "str", ")", "->", "List", "[", "int", "]", ":", "\n", "        ", "\"\"\"\n        Convert each string word in a sentence to the corresponding integer from the vocabulary and append\n        a start-of-sequence and end-of-sequence token.\n        :param sentence: the sentence in words (strings)\n        :param vocabulary: whether to use the input or target vocabulary.\n        :return: the sentence in integers.\n        \"\"\"", "\n", "vocab", "=", "self", ".", "get_vocabulary", "(", "vocabulary", ")", "\n", "sentence_array", "=", "[", "vocab", ".", "sos_idx", "]", "\n", "for", "word", "in", "sentence", ":", "\n", "            ", "sentence_array", ".", "append", "(", "vocab", ".", "word_to_idx", "(", "word", ")", ")", "\n", "", "sentence_array", ".", "append", "(", "vocab", ".", "eos_idx", ")", "\n", "return", "sentence_array", "\n", "\n", "", "def", "array_to_sentence", "(", "self", ",", "sentence_array", ":", "List", "[", "int", "]", ",", "vocabulary", ":", "str", ")", "->", "List", "[", "str", "]", ":", "\n", "        ", "\"\"\"\n        Translate each integer in a sentence array to the corresponding word.\n        :param sentence_array: array with integers representing words from the vocabulary.\n        :param vocabulary: whether to use the input or target vocabulary.\n        :return: the sentence in words.\n        \"\"\"", "\n", "vocab", "=", "self", ".", "get_vocabulary", "(", "vocabulary", ")", "\n", "return", "[", "vocab", ".", "idx_to_word", "(", "word_idx", ")", "for", "word_idx", "in", "sentence_array", "]", "\n", "\n", "", "@", "property", "\n", "def", "num_examples", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "_examples", ")", "\n", "\n", "", "@", "property", "\n", "def", "input_vocabulary_size", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "input_vocabulary", ".", "size", "\n", "\n", "", "@", "property", "\n", "def", "target_vocabulary_size", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "target_vocabulary", ".", "size", "\n", "", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_test.TestGroundedScanDataset.test_situation_encoder": [[19, 22], ["torch.zeros", "seq2seq_test.TestGroundedScanDataset.assertEqual"], "methods", ["None"], ["    ", "def", "test_situation_encoder", "(", "self", ")", ":", "\n", "        ", "input_image", "=", "torch", ".", "zeros", "(", ")", "\n", "self", ".", "assertEqual", "(", "'foo'", ".", "upper", "(", ")", ",", "'FOO'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_test.TestGroundedScanDataset.test_isupper": [[23, 26], ["seq2seq_test.TestGroundedScanDataset.assertTrue", "seq2seq_test.TestGroundedScanDataset.assertFalse"], "methods", ["None"], ["", "def", "test_isupper", "(", "self", ")", ":", "\n", "        ", "self", ".", "assertTrue", "(", "'FOO'", ".", "isupper", "(", ")", ")", "\n", "self", ".", "assertFalse", "(", "'Foo'", ".", "isupper", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.seq2seq_test.TestGroundedScanDataset.test_split": [[27, 33], ["seq2seq_test.TestGroundedScanDataset.assertEqual", "s.split", "seq2seq_test.TestGroundedScanDataset.assertRaises", "s.split"], "methods", ["None"], ["", "def", "test_split", "(", "self", ")", ":", "\n", "        ", "s", "=", "'hello world'", "\n", "self", ".", "assertEqual", "(", "s", ".", "split", "(", ")", ",", "[", "'hello'", ",", "'world'", "]", ")", "\n", "# check that s.split fails when the separator is not a string", "\n", "with", "self", ".", "assertRaises", "(", "TypeError", ")", ":", "\n", "            ", "s", ".", "split", "(", "2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_and_save_full_model": [[16, 159], ["locals().copy", "open", "model.modules.items", "logger.info", "model.modules.items", "logger.info", "logger.info", "logger.info", "json.dump", "locals", "torch.no_grad", "torch.no_grad", "torch.no_grad", "predict.predict_full", "logger.info", "logger.info", "logger.info", "dataset.get_data_iterator", "all_predictions_batch.keys", "output.append", "logger.info", "logger.info", "logger.info", "logger.info", "logger.info", "logger.info", "logger.info", "logger.info", "dataset.array_to_sentence", "dataset.array_to_sentence", "len", "output_str_sequence.squeeze", "full_pred.squeeze"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_full", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_data_iterator", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.array_to_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.array_to_sentence"], ["def", "predict_and_save", "(", "dataset", ":", "GroundedScanDataset", ",", "model", ":", "nn", ".", "Module", ",", "output_file_path", ":", "str", ",", "max_decoding_steps", ":", "int", ",", "\n", "max_testing_examples", "=", "None", ",", "**", "kwargs", ")", ":", "\n", "    ", "\"\"\"\n    Predict all data in dataset with a model and write the predictions to output_file_path.\n    :param dataset: a dataset with test examples\n    :param model: a trained model from model.py\n    :param output_file_path: a path where a .json file with predictions will be saved.\n    :param max_decoding_steps: after how many steps to force quit decoding\n    :param max_testing_examples: after how many examples to stop predicting, if None all examples will be evaluated\n    \"\"\"", "\n", "cfg", "=", "locals", "(", ")", ".", "copy", "(", ")", "\n", "\n", "with", "open", "(", "output_file_path", ",", "mode", "=", "'w'", ")", "as", "outfile", ":", "\n", "        ", "output", "=", "[", "]", "\n", "num_exact_matches", "=", "0", "\n", "num_total", "=", "0", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "i", "=", "0", "\n", "for", "(", "input_sequence", ",", "derivation_spec", ",", "situation_spec", ",", "output_sequence", ",", "target_sequence", ",", "\n", "attention_weights_commands", ",", "attention_weights_situations", ",", "position_accuracy", ")", "in", "predict", "(", "\n", "dataset", ".", "get_data_iterator", "(", "batch_size", "=", "1", ")", ",", "model", "=", "model", ",", "max_decoding_steps", "=", "max_decoding_steps", ",", "\n", "pad_idx", "=", "dataset", ".", "target_vocabulary", ".", "pad_idx", ",", "sos_idx", "=", "dataset", ".", "target_vocabulary", ".", "sos_idx", ",", "\n", "eos_idx", "=", "dataset", ".", "target_vocabulary", ".", "eos_idx", ")", ":", "\n", "                ", "i", "+=", "1", "\n", "accuracy", "=", "sequence_accuracy", "(", "output_sequence", ",", "target_sequence", "[", "0", "]", ".", "tolist", "(", ")", "[", "1", ":", "-", "1", "]", ")", "\n", "input_str_sequence", "=", "dataset", ".", "array_to_sentence", "(", "input_sequence", "[", "0", "]", ".", "tolist", "(", ")", ",", "vocabulary", "=", "\"input\"", ")", "\n", "input_str_sequence", "=", "input_str_sequence", "[", "1", ":", "-", "1", "]", "# Get rid of <SOS> and <EOS>", "\n", "target_str_sequence", "=", "dataset", ".", "array_to_sentence", "(", "target_sequence", "[", "0", "]", ".", "tolist", "(", ")", ",", "vocabulary", "=", "\"target\"", ")", "\n", "target_str_sequence", "=", "target_str_sequence", "[", "1", ":", "-", "1", "]", "# Get rid of <SOS> and <EOS>", "\n", "output_str_sequence", "=", "dataset", ".", "array_to_sentence", "(", "output_sequence", ",", "vocabulary", "=", "\"target\"", ")", "\n", "output", ".", "append", "(", "{", "\"input\"", ":", "input_str_sequence", ",", "\"prediction\"", ":", "output_str_sequence", ",", "\n", "\"derivation\"", ":", "derivation_spec", ",", "\n", "\"target\"", ":", "target_str_sequence", ",", "\"situation\"", ":", "situation_spec", ",", "\n", "\"attention_weights_input\"", ":", "attention_weights_commands", ",", "\n", "\"attention_weights_situation\"", ":", "attention_weights_situations", ",", "\n", "\"accuracy\"", ":", "accuracy", ",", "\n", "\"exact_match\"", ":", "True", "if", "accuracy", "==", "100", "else", "False", ",", "\n", "\"position_accuracy\"", ":", "position_accuracy", "}", ")", "\n", "if", "accuracy", "==", "100", ":", "\n", "                    ", "num_exact_matches", "+=", "1", "\n", "", "num_total", "+=", "1", "\n", "", "", "logger", ".", "info", "(", "\"Wrote predictions for {} examples.\"", ".", "format", "(", "i", ")", ")", "\n", "logger", ".", "info", "(", "\"Average exact match: {}\"", ".", "format", "(", "num_exact_matches", "/", "num_total", ")", ")", "\n", "json", ".", "dump", "(", "output", ",", "outfile", ",", "indent", "=", "4", ")", "\n", "", "return", "output_file_path", "\n", "\n", "\n", "", "def", "predict", "(", "data_iterator", ":", "Iterator", ",", "model", ":", "nn", ".", "Module", ",", "max_decoding_steps", ":", "int", ",", "pad_idx", ":", "int", ",", "sos_idx", ":", "int", ",", "\n", "eos_idx", ":", "int", ",", "max_examples_to_evaluate", "=", "None", ")", "->", "torch", ".", "Tensor", ":", "\n", "    ", "\"\"\"\n    Loop over all data in data_iterator and predict until <EOS> token is reached.\n    :param data_iterator: iterator containing the data to predict\n    :param model: a trained model from model.py\n    :param max_decoding_steps: after how many steps to abort decoding\n    :param pad_idx: the padding idx of the target vocabulary\n    :param sos_idx: the start-of-sequence idx of the target vocabulary\n    :param eos_idx: the end-of-sequence idx of the target vocabulary\n    :param: max_examples_to_evaluate: after how many examples to break prediction, if none all are predicted\n    \"\"\"", "\n", "# Disable dropout and other regularization.", "\n", "model", ".", "eval", "(", ")", "\n", "start_time", "=", "time", ".", "time", "(", ")", "\n", "\n", "# Loop over the data.", "\n", "i", "=", "0", "\n", "for", "(", "input_sequence", ",", "input_lengths", ",", "derivation_spec", ",", "situation", ",", "situation_spec", ",", "target_sequence", ",", "\n", "target_lengths", ",", "agent_positions", ",", "target_positions", ")", "in", "data_iterator", ":", "\n", "        ", "i", "+=", "1", "\n", "if", "max_examples_to_evaluate", ":", "\n", "            ", "if", "i", ">", "max_examples_to_evaluate", ":", "\n", "                ", "break", "\n", "# Encode the input sequence.", "\n", "", "", "encoded_input", "=", "model", ".", "encode_input", "(", "commands_input", "=", "input_sequence", ",", "\n", "commands_lengths", "=", "input_lengths", ",", "\n", "situations_input", "=", "situation", ")", "\n", "\n", "# For efficiency", "\n", "projected_keys_visual", "=", "model", ".", "visual_attention", ".", "key_layer", "(", "\n", "encoded_input", "[", "\"encoded_situations\"", "]", ")", "# [bsz, situation_length, dec_hidden_dim]", "\n", "projected_keys_textual", "=", "model", ".", "textual_attention", ".", "key_layer", "(", "\n", "encoded_input", "[", "\"encoded_commands\"", "]", "[", "\"encoder_outputs\"", "]", ")", "# [max_input_length, bsz, dec_hidden_dim]", "\n", "\n", "# Iteratively decode the output.", "\n", "output_sequence", "=", "[", "]", "\n", "contexts_situation", "=", "[", "]", "\n", "hidden", "=", "model", ".", "attention_decoder", ".", "initialize_hidden", "(", "\n", "model", ".", "tanh", "(", "model", ".", "enc_hidden_to_dec_hidden", "(", "encoded_input", "[", "\"hidden_states\"", "]", ")", ")", ")", "\n", "token", "=", "torch", ".", "tensor", "(", "[", "sos_idx", "]", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", "\n", "decoding_iteration", "=", "0", "\n", "attention_weights_commands", "=", "[", "]", "\n", "attention_weights_situations", "=", "[", "]", "\n", "while", "token", "!=", "eos_idx", "and", "decoding_iteration", "<=", "max_decoding_steps", ":", "\n", "            ", "(", "output", ",", "hidden", ",", "context_situation", ",", "attention_weights_command", ",", "\n", "attention_weights_situation", ")", "=", "model", ".", "decode_input", "(", "\n", "target_token", "=", "token", ",", "hidden", "=", "hidden", ",", "encoder_outputs", "=", "projected_keys_textual", ",", "\n", "input_lengths", "=", "input_lengths", ",", "encoded_situations", "=", "projected_keys_visual", ")", "\n", "output", "=", "F", ".", "log_softmax", "(", "output", ",", "dim", "=", "-", "1", ")", "\n", "token", "=", "output", ".", "max", "(", "dim", "=", "-", "1", ")", "[", "1", "]", "\n", "output_sequence", ".", "append", "(", "token", ".", "data", "[", "0", "]", ".", "item", "(", ")", ")", "\n", "attention_weights_commands", ".", "append", "(", "attention_weights_command", ".", "tolist", "(", ")", ")", "\n", "attention_weights_situations", ".", "append", "(", "attention_weights_situation", ".", "tolist", "(", ")", ")", "\n", "contexts_situation", ".", "append", "(", "context_situation", ".", "unsqueeze", "(", "1", ")", ")", "\n", "decoding_iteration", "+=", "1", "\n", "\n", "", "if", "output_sequence", "[", "-", "1", "]", "==", "eos_idx", ":", "\n", "            ", "output_sequence", ".", "pop", "(", ")", "\n", "attention_weights_commands", ".", "pop", "(", ")", "\n", "attention_weights_situations", ".", "pop", "(", ")", "\n", "", "if", "model", ".", "auxiliary_task", ":", "\n", "            ", "target_position_scores", "=", "model", ".", "auxiliary_task_forward", "(", "torch", ".", "cat", "(", "contexts_situation", ",", "dim", "=", "1", ")", ".", "sum", "(", "dim", "=", "1", ")", ")", "\n", "auxiliary_accuracy_target", "=", "model", ".", "get_auxiliary_accuracy", "(", "target_position_scores", ",", "target_positions", ")", "\n", "", "else", ":", "\n", "            ", "auxiliary_accuracy_agent", ",", "auxiliary_accuracy_target", "=", "0", ",", "0", "\n", "", "yield", "(", "input_sequence", ",", "derivation_spec", ",", "situation_spec", ",", "output_sequence", ",", "target_sequence", ",", "\n", "attention_weights_commands", ",", "attention_weights_situations", ",", "auxiliary_accuracy_target", ")", "\n", "\n", "", "elapsed_time", "=", "time", ".", "time", "(", ")", "-", "start_time", "\n", "logging", ".", "info", "(", "\"Predicted for {} examples.\"", ".", "format", "(", "i", ")", ")", "\n", "logging", ".", "info", "(", "\"Done predicting in {} seconds.\"", ".", "format", "(", "elapsed_time", ")", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_and_save": [[161, 285], ["locals().copy", "open", "logger.info", "json.dump", "locals", "torch.no_grad", "torch.no_grad", "torch.no_grad", "predict.predict", "logger.info", "logger.info", "logger.info", "dataset.get_data_iterator", "dataset.array_to_sentence", "len", "predictions.items", "output.append", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "len", "len", "model.remove_start_of_sequence", "Modularity.nn.get_exact_match", "accuracy_per_sequence.mean().item", "exact_match_per_sequence.sum().item", "exact_match_per_sequence.sum", "len", "exact_match_per_sequence.mean().item", "dataset.array_to_sentence", "[].squeeze", "dataset.array_to_sentence", "[].item", "torch.tensor", "torch.tensor", "torch.tensor", "[].squeeze", "[].item", "accuracy_per_sequence.mean", "exact_match_per_sequence.sum", "exact_match_per_sequence.mean", "sequence_preds.squeeze", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "sequence_pred_lengths.item", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq", "torch.eq", "torch.eq"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_data_iterator", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.array_to_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.remove_start_of_sequence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.get_exact_match", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.array_to_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.array_to_sentence"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_step": [[287, 296], ["model", "model.items", "values.max", "len", "pred.unsqueeze.unsqueeze", "key.split"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_sequence": [[298, 339], ["model.encode_input", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.zeros", "torch.zeros", "torch.zeros", "model.decode_step", "torch.log_softmax", "ending_sequences.to.to", "torch.clip", "torch.clip", "torch.clip", "torch.where", "torch.where", "torch.where", "torch.logical_or().long", "torch.logical_or().long", "torch.logical_or().long", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "F.log_softmax.max", "torch.where.squeeze", "int", "attention_weights.squeeze", "torch.logical_or", "torch.logical_or", "torch.logical_or", "max"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.encode_input", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.decode_step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict": [[341, 381], ["model.eval", "time.time", "logging.info", "logging.info", "time.time", "predict.predict_sequence", "model", "outputs[].max"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_sequence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_full": [[383, 410], ["model.eval", "time.time", "logging.info", "logging.info", "time.time", "model"], "function", ["None"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.evaluate.evaluate": [[14, 47], ["Modularity.predict.predict", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "len", "model.remove_start_of_sequence", "Modularity.nn.get_exact_match", "accuracy_per_sequence.mean().item", "exact_match_per_sequence.mean().item", "torch.tensor", "torch.tensor", "accuracy_per_sequence.mean", "exact_match_per_sequence.mean", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long", "torch.eq().long", "torch.eq", "torch.eq"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.remove_start_of_sequence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.get_exact_match"], ["exact_match", "=", "0", "\n", "for", "input_sequence", ",", "_", ",", "_", ",", "output_sequence", ",", "target_sequence", ",", "_", ",", "_", ",", "aux_acc_target", "in", "predict", "(", "\n", "data_iterator", "=", "data_iterator", ",", "model", "=", "model", ",", "max_decoding_steps", "=", "max_decoding_steps", ",", "pad_idx", "=", "pad_idx", ",", "\n", "sos_idx", "=", "sos_idx", ",", "eos_idx", "=", "eos_idx", ",", "max_examples_to_evaluate", "=", "max_examples_to_evaluate", ")", ":", "\n", "        ", "accuracy", "=", "sequence_accuracy", "(", "output_sequence", ",", "target_sequence", "[", "0", "]", ".", "tolist", "(", ")", "[", "1", ":", "-", "1", "]", ")", "\n", "if", "accuracy", "==", "100", ":", "\n", "            ", "exact_match", "+=", "1", "\n", "", "accuracies", ".", "append", "(", "accuracy", ")", "\n", "target_accuracies", ".", "append", "(", "aux_acc_target", ")", "\n", "", "return", "(", "float", "(", "np", ".", "mean", "(", "np", ".", "array", "(", "accuracies", ")", ")", ")", ",", "(", "exact_match", "/", "len", "(", "accuracies", ")", ")", "*", "100", ",", "\n", "float", "(", "np", ".", "mean", "(", "np", ".", "array", "(", "target_accuracies", ")", ")", ")", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.__init__": [[27, 226], ["torch.Module.__init__", "input_specs.items", "len", "torch.ModuleDict", "torch.ModuleDict", "torch.ModuleDict", "target_specs.items", "torch.ModuleDict", "torch.ModuleDict", "torch.ModuleDict", "torch.Tanh", "torch.Tanh", "torch.Tanh", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.ones().unsqueeze", "torch.Linear", "torch.Linear", "torch.Linear", "Modularity.nn.MLP", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.NLLLoss", "torch.NLLLoss", "torch.NLLLoss", "torch.NLLLoss", "torch.NLLLoss", "torch.NLLLoss", "modules.SuperModule.input_keys.append", "seq2seq.cnn_model.ConvolutionalNet", "len", "modules.SuperModule.target_keys_to_pad.append", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "modules.SuperModule.input_keys.append", "mlp_inputs.append", "Modularity.nn.LuongDecoder", "modules.SuperModule.target_keys.append", "Modularity.nn.LearnedAttention", "torch.ModuleDict", "torch.ModuleDict", "torch.ModuleDict", "modules.SuperModule.input_keys_to_pad.append", "seq2seq.seq2seq_model.EncoderRNN", "Modularity.nn.LearnedAttention", "Modularity.nn.BahdanauAttentionDecoderRNN", "ValueError", "modules.SuperModule.target_keys.append", "Modularity.nn.LearnedAttention", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.ModuleDict", "torch.ModuleDict", "torch.ModuleDict", "torch.Sequential", "torch.Sequential", "torch.Sequential", "Modularity.nn.BOW", "modules.SuperModule.input_keys_to_pad.append", "Modularity.nn.LearnedAttention", "torch.Tanh", "torch.Tanh", "torch.Tanh", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Sequential", "torch.Sequential", "torch.Sequential", "ValueError", "torch.Embedding", "torch.Embedding", "torch.Embedding", "modules.SuperModule.input_keys.append", "ValueError", "torch.Tanh", "torch.Tanh", "torch.Tanh"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["def", "__init__", "(", "self", ",", "input_specs", ":", "Dict", "[", "str", ",", "Dict", "[", "str", ",", "Union", "[", "int", ",", "bool", "]", "]", "]", ",", "\n", "target_specs", ":", "Dict", "[", "str", ",", "Dict", "[", "str", ",", "Union", "[", "str", ",", "int", ",", "bool", "]", "]", "]", ",", "metric", ":", "str", ",", "\n", "embedding_dimension", ":", "int", ",", "encoder_hidden_size", ":", "int", ",", "target_vocabulary", ":", "str", ",", "\n", "num_encoder_layers", ":", "int", ",", "encoder_dropout_p", ":", "float", ",", "encoder_bidirectional", ":", "bool", ",", "\n", "output_directory", ":", "str", ",", "main_input_key", ":", "str", ",", "input_vocabulary", ":", "str", ",", "decoder_hidden_size", "=", "0", ",", "\n", "num_decoder_layers", "=", "0", ",", "decoder_dropout_p", "=", "0.", ",", "\n", "cnn_kernel_size", "=", "0", ",", "cnn_dropout_p", "=", "0.", ",", "cnn_hidden_num_channels", "=", "0", ",", "\n", "grid_size", "=", "0", ",", "gpu_util", "=", "True", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "SuperModule", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "embedding_dimension", "=", "embedding_dimension", "\n", "self", ".", "encoder_hidden_size", "=", "encoder_hidden_size", "\n", "self", ".", "decoder_hidden_size", "=", "decoder_hidden_size", "\n", "self", ".", "num_encoder_layers", "=", "num_encoder_layers", "\n", "self", ".", "encoder_bidirectional", "=", "encoder_bidirectional", "\n", "self", ".", "num_decoder_layers", "=", "num_decoder_layers", "\n", "self", ".", "cnn_kernel_size", "=", "cnn_kernel_size", "\n", "self", ".", "cnn_hidden_num_channels", "=", "cnn_hidden_num_channels", "\n", "self", ".", "grid_size", "=", "grid_size", "\n", "\n", "self", ".", "input_keys", "=", "[", "]", "\n", "self", ".", "input_keys_to_pad", "=", "[", "]", "\n", "self", ".", "full_model", "=", "False", "\n", "self", ".", "gpu_util", "=", "gpu_util", "\n", "self", ".", "target_vocabulary", "=", "target_vocabulary", "\n", "self", ".", "main_input_key", "=", "main_input_key", "\n", "self", ".", "input_vocabulary", "=", "input_vocabulary", "\n", "if", "gpu_util", ":", "\n", "            ", "self", ".", "friend_one", "=", "torch", ".", "ones", "(", "10000", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "1", ")", "\n", "self", ".", "friend_two", "=", "torch", ".", "ones", "(", "10000", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "\n", "", "encoder_modules", "=", "{", "}", "\n", "\n", "mlp_inputs", "=", "[", "]", "\n", "for", "input_key", ",", "input_args", "in", "input_specs", ".", "items", "(", ")", ":", "\n", "            ", "if", "input_args", "[", "\"data_type\"", "]", "==", "\"grid\"", ":", "\n", "                ", "self", ".", "input_keys", ".", "append", "(", "input_key", ")", "\n", "self", ".", "grid_size", "=", "grid_size", "\n", "# Input: [batch_size, image_width, image_width, num_channels]", "\n", "# Output: [batch_size, image_width * image_width, num_conv_channels * 3]", "\n", "world_state_encoder", "=", "ConvolutionalNet", "(", "num_channels", "=", "input_args", "[", "\"num_input_channels\"", "]", ",", "\n", "cnn_kernel_size", "=", "cnn_kernel_size", ",", "\n", "num_conv_channels", "=", "cnn_hidden_num_channels", ",", "\n", "dropout_probability", "=", "cnn_dropout_p", ")", "\n", "encoder_modules", "[", "input_key", "]", "=", "world_state_encoder", "\n", "", "elif", "input_args", "[", "\"data_type\"", "]", "==", "\"int\"", ":", "\n", "                ", "self", ".", "input_keys", ".", "append", "(", "input_key", ")", "\n", "mlp_inputs", ".", "append", "(", "input_key", ")", "\n", "", "elif", "input_args", "[", "\"data_type\"", "]", "==", "\"sequence\"", ":", "\n", "                ", "self", ".", "input_keys_to_pad", ".", "append", "(", "input_key", ")", "\n", "# Input: [batch_size, max_input_length]", "\n", "# Output: [batch_size, hidden_size], [batch_size, max_input_length, hidden_size]", "\n", "encoder", "=", "EncoderRNN", "(", "input_size", "=", "input_args", "[", "\"input_vocabulary_size\"", "]", ",", "\n", "embedding_dim", "=", "embedding_dimension", ",", "\n", "rnn_input_size", "=", "embedding_dimension", ",", "\n", "hidden_size", "=", "encoder_hidden_size", ",", "num_layers", "=", "num_encoder_layers", ",", "\n", "dropout_probability", "=", "encoder_dropout_p", ",", "\n", "bidirectional", "=", "encoder_bidirectional", ",", "\n", "padding_idx", "=", "input_args", "[", "\"input_padding_idx\"", "]", ")", "\n", "encoder_modules", "[", "input_key", "]", "=", "encoder", "\n", "", "elif", "input_args", "[", "\"data_type\"", "]", "==", "\"bow\"", ":", "\n", "                ", "encoder", "=", "BOW", "(", "input_size", "=", "input_args", "[", "\"input_vocabulary_size\"", "]", ",", "\n", "embedding_dim", "=", "encoder_hidden_size", ",", "\n", "dropout_probability", "=", "encoder_dropout_p", ",", "\n", "padding_idx", "=", "input_args", "[", "\"input_padding_idx\"", "]", ")", "\n", "self", ".", "input_keys_to_pad", ".", "append", "(", "input_key", ")", "\n", "encoder_modules", "[", "input_key", "]", "=", "encoder", "\n", "", "elif", "input_args", "[", "\"data_type\"", "]", "==", "\"embedding\"", ":", "\n", "                ", "encoder", "=", "nn", ".", "Embedding", "(", "input_args", "[", "\"input_vocabulary_size\"", "]", ",", "\n", "embedding_dimension", ",", "\n", "padding_idx", "=", "input_args", "[", "\"input_padding_idx\"", "]", ")", "\n", "self", ".", "input_keys", ".", "append", "(", "input_key", ")", "\n", "encoder_modules", "[", "input_key", "]", "=", "encoder", "\n", "", "else", ":", "\n", "                ", "raise", "ValueError", "(", "\"Unrecognized data_type=%s for input_key=%s in constructor class for SuperModule\"", "%", "(", "\n", "input_args", "[", "\"data_type\"", "]", ",", "input_key", "\n", ")", ")", "\n", "\n", "", "", "if", "len", "(", "mlp_inputs", ")", ":", "\n", "            ", "input_to_mlp", "=", "nn", ".", "Linear", "(", "len", "(", "mlp_inputs", ")", ",", "encoder_hidden_size", ")", "\n", "mlp", "=", "MLP", "(", "input_dim", "=", "encoder_hidden_size", ",", "hidden_dim", "=", "encoder_hidden_size", ",", "\n", "dropout_p", "=", "encoder_dropout_p", ")", "\n", "encoder_modules", "[", "\"mlp\"", "]", "=", "nn", ".", "Sequential", "(", "input_to_mlp", ",", "mlp", ")", "\n", "\n", "", "self", ".", "encoder_module_dict", "=", "nn", ".", "ModuleDict", "(", "encoder_modules", ")", "\n", "\n", "self", ".", "target_keys", "=", "[", "]", "\n", "self", ".", "target_keys_to_pad", "=", "[", "]", "\n", "self", ".", "sequence_decoder", "=", "False", "\n", "self", ".", "target_eos_idx", "=", "None", "\n", "self", ".", "target_pad_idx", "=", "None", "\n", "self", ".", "target_sos_idx", "=", "None", "\n", "\n", "decoder_modules", "=", "{", "}", "\n", "for", "target_key", ",", "target_args", "in", "target_specs", ".", "items", "(", ")", ":", "\n", "            ", "if", "target_args", "[", "\"output_type\"", "]", "==", "\"sequence\"", ":", "\n", "                ", "self", ".", "target_keys_to_pad", ".", "append", "(", "target_key", ")", "\n", "# Input: [batch_size, max_target_length], initial hidden: ([batch_size, hidden_size], [batch_size, hidden_size])", "\n", "# Input for attention: [batch_size, max_input_length, hidden_size],", "\n", "#                      [batch_size, image_width * image_width, hidden_size]", "\n", "if", "target_args", "[", "\"type_attention\"", "]", "==", "\"luong\"", ":", "\n", "                    ", "attention_decoder", "=", "LuongDecoder", "(", "hidden_size", "=", "decoder_hidden_size", ",", "\n", "output_size", "=", "target_args", "[", "\"target_vocabulary_size\"", "]", ",", "\n", "num_layers", "=", "num_decoder_layers", ",", "\n", "dropout_probability", "=", "decoder_dropout_p", ",", "\n", "padding_idx", "=", "target_args", "[", "\"target_pad_idx\"", "]", ",", "\n", "attention", "=", "target_args", "[", "\"attention\"", "]", ",", "\n", "conditional_attention", "=", "target_args", "[", "\"conditional_attention\"", "]", ")", "\n", "", "elif", "target_args", "[", "\"type_attention\"", "]", "==", "\"bahdanau\"", ":", "\n", "# attention = LearnedAttention(key_size=encoder_hidden_size, query_size=decoder_hidden_size,", "\n", "#                              hidden_size=decoder_hidden_size)", "\n", "# if target_args[\"conditional_attention\"]:", "\n", "#     conditional_attention = LearnedAttention(key_size=cnn_hidden_num_channels * 3,", "\n", "#                                              query_size=decoder_hidden_size,", "\n", "#                                              hidden_size=decoder_hidden_size)", "\n", "# else:", "\n", "#     conditional_attention = None", "\n", "# attention_decoder = BahdanauDecoder(hidden_size=decoder_hidden_size,", "\n", "#                                     output_size=target_args[\"target_vocabulary_size\"],", "\n", "#                                     num_layers=num_decoder_layers,", "\n", "#                                     dropout_probability=decoder_dropout_p,", "\n", "#                                     padding_idx=target_args[\"target_pad_idx\"],", "\n", "#                                     key_size=encoder_hidden_size,", "\n", "#                                     attention=attention,", "\n", "#                                     conditional_attention=conditional_attention)", "\n", "# Attention over the output features of the ConvolutionalNet.", "\n", "# Input: [bsz, 1, decoder_hidden_size], [bsz, image_width * image_width, cnn_hidden_num_channels * 3]", "\n", "# Output: [bsz, 1, decoder_hidden_size], [bsz, 1, image_width * image_width]", "\n", "                    ", "if", "target_args", "[", "\"conditional_attention\"", "]", ":", "\n", "                        ", "self", ".", "visual_attention", "=", "LearnedAttention", "(", "key_size", "=", "cnn_hidden_num_channels", "*", "3", ",", "\n", "query_size", "=", "decoder_hidden_size", ",", "\n", "hidden_size", "=", "decoder_hidden_size", ")", "\n", "", "else", ":", "\n", "                        ", "self", ".", "visual_attention", "=", "None", "\n", "", "self", ".", "textual_attention", "=", "LearnedAttention", "(", "key_size", "=", "encoder_hidden_size", ",", "\n", "query_size", "=", "decoder_hidden_size", ",", "\n", "hidden_size", "=", "decoder_hidden_size", ")", "\n", "attention_decoder", "=", "BahdanauAttentionDecoderRNN", "(", "hidden_size", "=", "decoder_hidden_size", ",", "\n", "output_size", "=", "target_args", "[", "\"target_vocabulary_size\"", "]", ",", "\n", "num_layers", "=", "num_decoder_layers", ",", "\n", "dropout_probability", "=", "decoder_dropout_p", ",", "\n", "padding_idx", "=", "target_args", "[", "\"target_pad_idx\"", "]", ",", "\n", "textual_attention", "=", "self", ".", "textual_attention", ",", "\n", "visual_attention", "=", "self", ".", "visual_attention", ",", "\n", "conditional_attention", "=", "target_args", "[", "\"conditional_attention\"", "]", ")", "\n", "", "else", ":", "\n", "                    ", "raise", "ValueError", "(", "\"Unknown type_attention=%s in target_specs, options are 'bahdanau' and \"", "\n", "\"'luong'\"", "%", "target_args", "[", "\"type_attention\"", "]", ")", "\n", "", "decoder_modules", "[", "target_key", "]", "=", "attention_decoder", "\n", "self", ".", "sequence_decoder", "=", "True", "\n", "self", ".", "target_pad_idx", "=", "target_args", "[", "\"target_pad_idx\"", "]", "\n", "self", ".", "target_sos_idx", "=", "target_args", "[", "\"target_sos_idx\"", "]", "\n", "self", ".", "target_eos_idx", "=", "target_args", "[", "\"target_eos_idx\"", "]", "\n", "", "elif", "target_args", "[", "\"output_type\"", "]", "==", "\"attention_map\"", ":", "\n", "                ", "self", ".", "target_keys", ".", "append", "(", "target_key", ")", "\n", "# Attention over the output features of the ConvolutionalNet.", "\n", "# Input: [bsz, 1, decoder_hidden_size], [bsz, image_width * image_width, cnn_hidden_num_channels * 3]", "\n", "# Output: [bsz, 1, decoder_hidden_size], [bsz, 1, image_width * image_width]", "\n", "world_attention", "=", "LearnedAttention", "(", "key_size", "=", "cnn_hidden_num_channels", "*", "3", ",", "query_size", "=", "encoder_hidden_size", ",", "\n", "hidden_size", "=", "encoder_hidden_size", ")", "\n", "decoder_modules", "[", "target_key", "]", "=", "nn", ".", "ModuleDict", "(", ")", "\n", "decoder_modules", "[", "target_key", "]", "[", "\"attention\"", "]", "=", "world_attention", "\n", "# decoder_modules[target_key][\"projection\"] = nn.Sequential(hidden_to_hidden, nn.Tanh(), hidden_to_output)", "\n", "", "elif", "target_args", "[", "\"output_type\"", "]", "==", "\"attention_map_projection\"", ":", "\n", "                ", "self", ".", "target_keys", ".", "append", "(", "target_key", ")", "\n", "# Attention over the output features of the ConvolutionalNet.", "\n", "# Input: [bsz, 1, decoder_hidden_size], [bsz, image_width * image_width, cnn_hidden_num_channels * 3]", "\n", "# Output: [bsz, 1, decoder_hidden_size], [bsz, 1, image_width * image_width]", "\n", "world_attention", "=", "LearnedAttention", "(", "key_size", "=", "cnn_hidden_num_channels", "*", "3", ",", "query_size", "=", "encoder_hidden_size", ",", "\n", "hidden_size", "=", "encoder_hidden_size", ")", "\n", "hidden_to_hidden", "=", "nn", ".", "Linear", "(", "encoder_hidden_size", "*", "2", ",", "\n", "target_args", "[", "\"hidden_size\"", "]", ")", "\n", "hidden_to_output", "=", "nn", ".", "Linear", "(", "target_args", "[", "\"hidden_size\"", "]", ",", "target_args", "[", "\"output_size\"", "]", ")", "\n", "decoder_modules", "[", "target_key", "]", "=", "nn", ".", "ModuleDict", "(", ")", "\n", "decoder_modules", "[", "target_key", "]", "[", "\"attention\"", "]", "=", "world_attention", "\n", "decoder_modules", "[", "target_key", "]", "[", "\"projection\"", "]", "=", "nn", ".", "Sequential", "(", "hidden_to_hidden", ",", "nn", ".", "Tanh", "(", ")", ",", "hidden_to_output", ")", "\n", "", "elif", "target_args", "[", "\"output_type\"", "]", "==", "\"mlp\"", ":", "\n", "                ", "hidden_to_hidden", "=", "nn", ".", "Linear", "(", "decoder_hidden_size", ",", "\n", "target_args", "[", "\"hidden_size\"", "]", ")", "\n", "dropout", "=", "nn", ".", "Dropout", "(", "p", "=", "decoder_dropout_p", ")", "\n", "hidden_to_output", "=", "nn", ".", "Linear", "(", "target_args", "[", "\"hidden_size\"", "]", ",", "target_args", "[", "\"output_size\"", "]", ")", "\n", "decoder_modules", "[", "target_key", "]", "=", "nn", ".", "Sequential", "(", "hidden_to_hidden", ",", "nn", ".", "Tanh", "(", ")", ",", "dropout", ",", "hidden_to_output", ")", "\n", "", "else", ":", "\n", "                ", "raise", "ValueError", "(", "\"Unrecognized data_type=%s for target_key=%s in constructor class for SuperModule\"", "%", "(", "\n", "target_args", "[", "\"data_type\"", "]", ",", "target_key", "\n", ")", ")", "\n", "\n", "", "", "if", "self", ".", "sequence_decoder", ":", "\n", "            ", "self", ".", "loss_criterion", "=", "nn", ".", "NLLLoss", "(", "ignore_index", "=", "self", ".", "target_pad_idx", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "loss_criterion", "=", "nn", ".", "NLLLoss", "(", ")", "\n", "\n", "", "self", ".", "decoder_module_dict", "=", "nn", ".", "ModuleDict", "(", "decoder_modules", ")", "\n", "\n", "self", ".", "tanh", "=", "nn", ".", "Tanh", "(", ")", "\n", "self", ".", "output_directory", "=", "output_directory", "\n", "self", ".", "trained_iterations", "=", "0", "\n", "self", ".", "best_iteration", "=", "0", "\n", "self", ".", "best_metric", "=", "0", "\n", "self", ".", "metric", "=", "metric", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.remove_start_of_sequence": [[227, 235], ["input_tensor.size", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "@", "staticmethod", "\n", "def", "remove_start_of_sequence", "(", "input_tensor", ":", "torch", ".", "Tensor", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "\"\"\"Get rid of SOS-tokens in targets batch and append a padding token to each example in the batch.\"\"\"", "\n", "batch_size", ",", "max_time", "=", "input_tensor", ".", "size", "(", ")", "\n", "input_tensor", "=", "input_tensor", "[", ":", ",", "1", ":", "]", "\n", "output_tensor", "=", "torch", ".", "cat", "(", "[", "input_tensor", ",", "torch", ".", "zeros", "(", "batch_size", ",", "device", "=", "device", ",", "dtype", "=", "torch", ".", "long", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "1", ")", "]", ",", "dim", "=", "1", ")", "\n", "return", "output_tensor", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.add_start_of_sequence": [[236, 241], ["input_tensor.size", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "add_start_of_sequence", "(", "self", ",", "input_tensor", ":", "torch", ".", "Tensor", ")", ":", "\n", "        ", "batch_size", ",", "max_time", "=", "input_tensor", ".", "size", "(", ")", "\n", "sos_tensor", "=", "torch", ".", "tensor", "(", "[", "self", ".", "target_sos_idx", "]", "*", "batch_size", ",", "device", "=", "device", ",", "\n", "dtype", "=", "input_tensor", ".", "dtype", ")", ".", "unsqueeze", "(", "dim", "=", "1", ")", "\n", "return", "torch", ".", "cat", "(", "[", "sos_tensor", ",", "input_tensor", "]", ",", "dim", "=", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.get_prediction": [[243, 248], ["target_scores.max", "len", "pred.unsqueeze.unsqueeze.unsqueeze"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max"], ["", "def", "get_prediction", "(", "self", ",", "target_scores", ":", "torch", ".", "Tensor", ")", ":", "\n", "        ", "pred", "=", "target_scores", ".", "max", "(", "dim", "=", "-", "1", ")", "[", "1", "]", "\n", "if", "not", "len", "(", "pred", ".", "shape", ")", ":", "\n", "            ", "pred", "=", "pred", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "", "return", "pred", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.get_single_accuracy": [[249, 261], ["targets.unsqueeze.unsqueeze.size", "len", "target_scores.unsqueeze.unsqueeze.unsqueeze", "len", "targets.unsqueeze.unsqueeze.unsqueeze", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "target_scores.unsqueeze.unsqueeze.max", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max"], ["", "@", "staticmethod", "\n", "def", "get_single_accuracy", "(", "target_scores", ":", "torch", ".", "Tensor", ",", "targets", ":", "torch", ".", "Tensor", ")", "->", "float", ":", "\n", "        ", "num_targets", "=", "targets", ".", "size", "(", "0", ")", "\n", "if", "len", "(", "target_scores", ".", "shape", ")", "==", "1", ":", "\n", "            ", "target_scores", "=", "target_scores", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "", "if", "len", "(", "targets", ".", "shape", ")", "==", "1", ":", "\n", "            ", "targets", "=", "targets", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "predicted_targets", "=", "target_scores", ".", "max", "(", "dim", "=", "1", ")", "[", "1", "]", "\n", "equal_targets", "=", "torch", ".", "eq", "(", "targets", ".", "data", ",", "predicted_targets", ".", "data", ")", ".", "long", "(", ")", ".", "sum", "(", ")", ".", "data", ".", "item", "(", ")", "\n", "accuracy", "=", "100.", "*", "equal_targets", "/", "num_targets", "\n", "", "return", "accuracy", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.get_exact_match": [[262, 283], ["torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "modules.SuperModule.remove_start_of_sequence", "mask.sum().data.item", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "match_targets.sum", "mask.sum", "mask.sum.size", "match_targets.sum().data.item", "scores.max", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "mask.sum", "match_targets.sum"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.remove_start_of_sequence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max"], ["", "def", "get_exact_match", "(", "self", ",", "scores", ":", "torch", ".", "Tensor", ",", "targets", ":", "torch", ".", "Tensor", ")", ":", "\n", "        ", "\"\"\"\n        :param scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param targets:  ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar float of accuracy averaged over sequence length and batch size.\n        \"\"\"", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "targets", "=", "self", ".", "remove_start_of_sequence", "(", "targets", ")", "\n", "mask", "=", "(", "targets", "!=", "self", ".", "target_pad_idx", ")", ".", "long", "(", ")", "\n", "total", "=", "mask", ".", "sum", "(", ")", ".", "data", ".", "item", "(", ")", "\n", "predicted_targets", "=", "scores", ".", "max", "(", "dim", "=", "2", ")", "[", "1", "]", "\n", "equal_targets", "=", "torch", ".", "eq", "(", "targets", ".", "data", ",", "predicted_targets", ".", "data", ")", ".", "long", "(", ")", "\n", "match_targets", "=", "(", "equal_targets", "*", "mask", ")", "\n", "match_sum_per_example", "=", "match_targets", ".", "sum", "(", "dim", "=", "1", ")", "\n", "expected_sum_per_example", "=", "mask", ".", "sum", "(", "dim", "=", "1", ")", "\n", "batch_size", "=", "expected_sum_per_example", ".", "size", "(", "0", ")", "\n", "exact_match", "=", "100.", "*", "(", "match_sum_per_example", "==", "expected_sum_per_example", ")", ".", "sum", "(", ")", ".", "data", ".", "item", "(", ")", "/", "batch_size", "\n", "match_targets_sum", "=", "match_targets", ".", "sum", "(", ")", ".", "data", ".", "item", "(", ")", "\n", "accuracy", "=", "100.", "*", "match_targets_sum", "/", "total", "\n", "", "return", "accuracy", ",", "exact_match", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.get_scores": [[284, 287], ["torch.log_softmax", "torch.log_softmax", "torch.log_softmax"], "methods", ["None"], ["", "def", "get_scores", "(", "self", ",", "output_scores", ":", "torch", ".", "Tensor", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "output_scores_normalized", "=", "F", ".", "log_softmax", "(", "output_scores", ",", "-", "1", ")", "\n", "return", "output_scores_normalized", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.get_single_loss": [[288, 291], ["modules.SuperModule.loss_criterion", "targets.view"], "methods", ["None"], ["", "def", "get_single_loss", "(", "self", ",", "scores", ":", "torch", ".", "Tensor", ",", "targets", ":", "torch", ".", "Tensor", ")", ":", "\n", "        ", "loss", "=", "self", ".", "loss_criterion", "(", "scores", ",", "targets", ".", "view", "(", "-", "1", ")", ")", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.get_sequence_loss": [[292, 300], ["modules.SuperModule.remove_start_of_sequence", "scores.size", "scores.reshape", "modules.SuperModule.loss_criterion", "modules.SuperModule.view"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.remove_start_of_sequence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "get_sequence_loss", "(", "self", ",", "scores", ":", "torch", ".", "Tensor", ",", "targets", ":", "torch", ".", "Tensor", ")", ":", "\n", "        ", "targets", "=", "self", ".", "remove_start_of_sequence", "(", "targets", ")", "\n", "\n", "# Calculate the loss.", "\n", "vocabulary_size", "=", "scores", ".", "size", "(", "2", ")", "\n", "target_scores_2d", "=", "scores", ".", "reshape", "(", "-", "1", ",", "vocabulary_size", ")", "\n", "loss", "=", "self", ".", "loss_criterion", "(", "target_scores_2d", ",", "targets", ".", "view", "(", "-", "1", ")", ")", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.get_metrics": [[301, 303], ["NotImplementedError"], "methods", ["None"], ["", "def", "get_metrics", "(", "self", ",", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "float", "]", ":", "\n", "        ", "raise", "NotImplementedError", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.get_loss": [[304, 306], ["NotImplementedError"], "methods", ["None"], ["", "def", "get_loss", "(", "self", ",", "**", "kwargs", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "raise", "NotImplementedError", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.prepare_encoder_output_decoder": [[307, 309], ["NotImplementedError"], "methods", ["None"], ["", "def", "prepare_encoder_output_decoder", "(", "self", ",", "encoder_outputs", ":", "Dict", "[", "str", ",", "Union", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", "]", "]", ")", ":", "\n", "        ", "raise", "NotImplementedError", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.encode_input": [[310, 330], ["modules.SuperModule.input_specs.items", "len", "modules.SuperModule.prepare_encoder_output_decoder", "torch.mm", "torch.mm", "torch.mm", "torch.mm", "torch.mm", "torch.mm", "torch.mm", "torch.mm", "torch.mm", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "mlp_inputs.float", "mlp_inputs.append", "inputs[].unsqueeze"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.AloTransform.prepare_encoder_output_decoder", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "encode_input", "(", "self", ",", "inputs", ":", "Dict", "[", "str", ",", "Union", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", "]", "]", ",", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"Pass the inputs through encoders.\"\"\"", "\n", "\n", "encoded_inputs", "=", "{", "}", "\n", "mlp_inputs", "=", "[", "]", "\n", "for", "input_key", ",", "input_args", "in", "self", ".", "input_specs", ".", "items", "(", ")", ":", "\n", "            ", "if", "input_args", "[", "\"data_type\"", "]", "==", "\"sequence\"", "or", "input_args", "[", "\"data_type\"", "]", "==", "\"bow\"", ":", "\n", "                ", "encoded_input", "=", "self", ".", "encoder_module_dict", "[", "input_key", "]", "(", "inputs", "[", "input_key", "]", ",", "inputs", "[", "input_key", "+", "\"_lengths\"", "]", ")", "\n", "encoded_inputs", "[", "input_key", "]", "=", "encoded_input", "\n", "", "elif", "input_args", "[", "\"data_type\"", "]", "==", "\"int\"", ":", "\n", "                ", "mlp_inputs", ".", "append", "(", "inputs", "[", "input_key", "]", ".", "unsqueeze", "(", "dim", "=", "1", ")", ")", "\n", "", "else", ":", "\n", "                ", "encoded_input", "=", "self", ".", "encoder_module_dict", "[", "input_key", "]", "(", "inputs", "[", "input_key", "]", ")", "\n", "encoded_inputs", "[", "input_key", "]", "=", "encoded_input", "\n", "", "", "if", "len", "(", "mlp_inputs", ")", ":", "\n", "            ", "mlp_inputs", "=", "torch", ".", "cat", "(", "mlp_inputs", ",", "dim", "=", "1", ")", "+", "1", "# TODO: keep this?", "\n", "encoded_inputs", "[", "\"mlp\"", "]", "=", "self", ".", "encoder_module_dict", "[", "\"mlp\"", "]", "(", "mlp_inputs", ".", "float", "(", ")", ")", "\n", "", "if", "self", ".", "gpu_util", ":", "\n", "            ", "torch", ".", "mm", "(", "self", ".", "friend_one", ",", "self", ".", "friend_two", ")", "\n", "", "return", "self", ".", "prepare_encoder_output_decoder", "(", "encoded_inputs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.decode_input": [[331, 357], ["modules.SuperModule.target_specs.items", "encoder_output[].size", "[].forward", "modules.SuperModule.get_scores", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "modules.SuperModule.get_scores", "ValueError", "range", "encoder_output[].unsqueeze", "torch.tanh.squeeze", "torch.tanh.squeeze", "torch.tanh.squeeze"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.forward", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_scores", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_scores"], ["", "def", "decode_input", "(", "self", ",", "encoder_output", ")", "->", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"Pass the input commands through an RNN encoder and the situation input through a CNN encoder.\"\"\"", "\n", "\n", "decoded_inputs", "=", "{", "}", "\n", "for", "target_key", ",", "target_args", "in", "self", ".", "target_specs", ".", "items", "(", ")", ":", "\n", "            ", "if", "target_args", "[", "\"output_type\"", "]", "==", "\"attention_map\"", "or", "target_args", "[", "\"output_type\"", "]", "==", "\"attention_map_projection\"", ":", "\n", "                ", "batch_size", ",", "image_num_memory", ",", "image_dim", "=", "encoder_output", "[", "\"world_state_tensor\"", "]", ".", "size", "(", ")", "\n", "situation_lengths", "=", "[", "image_num_memory", "for", "_", "in", "range", "(", "batch_size", ")", "]", "\n", "context", ",", "attention_weights", "=", "self", ".", "decoder_module_dict", "[", "target_key", "]", "[", "\"attention\"", "]", ".", "forward", "(", "\n", "queries", "=", "encoder_output", "[", "\"hidden\"", "]", ".", "unsqueeze", "(", "dim", "=", "1", ")", ",", "\n", "keys", "=", "encoder_output", "[", "\"world_state_tensor\"", "]", ",", "\n", "values", "=", "encoder_output", "[", "\"world_state_tensor\"", "]", ",", "\n", "memory_lengths", "=", "situation_lengths", ")", "\n", "if", "target_args", "[", "\"output_type\"", "]", "==", "\"attention_map_projection\"", ":", "\n", "                    ", "context", "=", "torch", ".", "tanh", "(", "context", ")", "\n", "final_hidden", "=", "torch", ".", "cat", "(", "[", "context", ".", "squeeze", "(", "dim", "=", "1", ")", ",", "encoder_output", "[", "\"hidden\"", "]", "]", ",", "dim", "=", "-", "1", ")", "\n", "attention_weights", "=", "self", ".", "decoder_module_dict", "[", "target_key", "]", "[", "\"projection\"", "]", "(", "final_hidden", ")", "\n", "", "scores_normalized", "=", "self", ".", "get_scores", "(", "attention_weights", ")", "\n", "", "elif", "target_args", "[", "\"output_type\"", "]", "==", "\"mlp\"", ":", "\n", "                ", "output_states", "=", "self", ".", "decoder_module_dict", "[", "target_key", "]", "(", "encoder_output", "[", "\"hidden\"", "]", ")", "\n", "scores_normalized", "=", "self", ".", "get_scores", "(", "output_states", ")", "\n", "", "else", ":", "\n", "                ", "raise", "ValueError", "(", "\"unrecognized output_type %s for target_key %s\"", "%", "(", "target_args", "[", "\"output_type\"", "]", ",", "\n", "target_key", ")", ")", "\n", "", "decoded_inputs", "[", "target_key", "]", "=", "scores_normalized", "\n", "", "return", "decoded_inputs", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.decode_step": [[358, 364], ["modules.SuperModule.decoder_module_dict[].forward_step"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.forward_step"], ["", "def", "decode_step", "(", "self", ",", "targets", ",", "encoder_outputs", ",", "**", "kwargs", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "\n", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"One decoding step based on the previous hidden state of the decoder and the previous target token.\"\"\"", "\n", "target_key", "=", "self", ".", "target_keys_to_pad", "[", "0", "]", "\n", "return", "self", ".", "decoder_module_dict", "[", "target_key", "]", ".", "forward_step", "(", "\n", "target_tokens", "=", "targets", "[", "target_key", "+", "\"_targets\"", "]", ",", "**", "encoder_outputs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.decode_input_batched": [[365, 378], ["torch.log_softmax", "torch.log_softmax", "torch.log_softmax"], "methods", ["None"], ["", "def", "decode_input_batched", "(", "self", ",", "targets", ":", "Dict", "[", "str", ",", "Union", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", "]", "]", ",", "\n", "encoder_outputs", ":", "Dict", "[", "str", ",", "Union", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", ",", "tuple", "]", "]", ",", "\n", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"Decode a batch of input sequences.\"\"\"", "\n", "target_key", "=", "self", ".", "target_keys_to_pad", "[", "0", "]", "\n", "decoder_output_batched", ",", "_", ",", "attention_weights", "=", "self", ".", "decoder_module_dict", "[", "target_key", "]", "(", "\n", "target_tokens", "=", "targets", "[", "target_key", "+", "\"_targets\"", "]", ",", "\n", "target_lengths", "=", "targets", "[", "target_key", "+", "\"_lengths\"", "]", ",", "\n", "**", "encoder_outputs", ")", "\n", "decoder_output_batched", "=", "F", ".", "log_softmax", "(", "decoder_output_batched", ",", "dim", "=", "-", "1", ")", "\n", "return", "{", "\n", "\"decoder_output_batched\"", ":", "decoder_output_batched", ",", "\n", "\"attention_weights\"", ":", "attention_weights", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.forward": [[380, 382], ["NotImplementedError"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "batch", ",", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "raise", "NotImplementedError", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.update_state": [[383, 388], ["None"], "methods", ["None"], ["", "def", "update_state", "(", "self", ",", "is_best", ":", "bool", ",", "metric", "=", "None", ")", "->", "{", "}", ":", "\n", "        ", "self", ".", "trained_iterations", "+=", "1", "\n", "if", "is_best", ":", "\n", "            ", "self", ".", "best_metric", "=", "metric", "\n", "self", ".", "best_iteration", "=", "self", ".", "trained_iterations", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.load_model": [[389, 397], ["torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "modules.SuperModule.load_state_dict", "torch.device", "torch.device", "torch.device", "torch.device", "torch.device", "torch.device", "torch.device", "torch.device", "torch.device"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load"], ["", "", "def", "load_model", "(", "self", ",", "path_to_checkpoint", ":", "str", ")", "->", "dict", ":", "\n", "        ", "checkpoint", "=", "torch", ".", "load", "(", "path_to_checkpoint", ",", "map_location", "=", "torch", ".", "device", "(", "'cpu'", ")", ")", "\n", "self", ".", "trained_iterations", "=", "checkpoint", "[", "\"iteration\"", "]", "\n", "self", ".", "best_iteration", "=", "checkpoint", "[", "\"best_iteration\"", "]", "\n", "self", ".", "load_state_dict", "(", "checkpoint", "[", "\"state_dict\"", "]", ")", "\n", "self", ".", "best_metric", "=", "checkpoint", "[", "\"best_metric\"", "]", "\n", "self", ".", "metric", "=", "checkpoint", "[", "\"metric\"", "]", "\n", "return", "checkpoint", "[", "\"optimizer_state_dict\"", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.get_current_state": [[398, 420], ["modules.SuperModule.state_dict"], "methods", ["None"], ["", "def", "get_current_state", "(", "self", ")", ":", "\n", "        ", "return", "{", "\n", "\"iteration\"", ":", "self", ".", "trained_iterations", ",", "\n", "\"state_dict\"", ":", "self", ".", "state_dict", "(", ")", ",", "\n", "\"best_iteration\"", ":", "self", ".", "best_iteration", ",", "\n", "\"best_metric\"", ":", "self", ".", "best_metric", ",", "\n", "\"metric\"", ":", "self", ".", "metric", ",", "\n", "\"simplified_architecture\"", ":", "self", ".", "simplified_architecture", ",", "\n", "\"use_attention\"", ":", "self", ".", "use_attention", ",", "\n", "\"use_conditional_attention\"", ":", "self", ".", "use_conditional_attention", ",", "\n", "\"attention_values_key\"", ":", "self", ".", "attention_values_key", ",", "\n", "\"conditional_attention_values_key\"", ":", "self", ".", "conditional_attention_values_key", ",", "\n", "\"type_attention\"", ":", "self", ".", "type_attention", ",", "\n", "\"embedding_dimension\"", ":", "self", ".", "embedding_dimension", ",", "\n", "\"encoder_hidden_size\"", ":", "self", ".", "encoder_hidden_size", ",", "\n", "\"decoder_hidden_size\"", ":", "self", ".", "decoder_hidden_size", ",", "\n", "\"num_encoder_layers\"", ":", "self", ".", "num_encoder_layers", ",", "\n", "\"encoder_bidirectional\"", ":", "self", ".", "encoder_bidirectional", ",", "\n", "\"num_decoder_layers\"", ":", "self", ".", "num_decoder_layers", ",", "\n", "\"cnn_kernel_size\"", ":", "self", ".", "cnn_kernel_size", ",", "\n", "\"cnn_hidden_num_channels\"", ":", "self", ".", "cnn_hidden_num_channels", ",", "\n", "\"grid_size\"", ":", "self", ".", "grid_size", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.save_checkpoint": [[422, 438], ["os.path.join", "modules.SuperModule.get_current_state", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "os.path.join", "shutil.copyfile"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_current_state", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save"], ["", "def", "save_checkpoint", "(", "self", ",", "file_name", ":", "str", ",", "is_best", ":", "bool", ",", "optimizer_state_dict", ":", "dict", ")", "->", "str", ":", "\n", "        ", "\"\"\"\n\n        :param file_name: filename to save checkpoint in.\n        :param is_best: boolean describing whether or not the current state is the best the model has ever been.\n        :param optimizer_state_dict: state of the optimizer.\n        :return: str to path where the model is saved.\n        \"\"\"", "\n", "path", "=", "os", ".", "path", ".", "join", "(", "self", ".", "output_directory", ",", "file_name", ")", "\n", "state", "=", "self", ".", "get_current_state", "(", ")", "\n", "state", "[", "\"optimizer_state_dict\"", "]", "=", "optimizer_state_dict", "\n", "torch", ".", "save", "(", "state", ",", "path", ")", "\n", "if", "is_best", ":", "\n", "            ", "best_path", "=", "os", ".", "path", ".", "join", "(", "self", ".", "output_directory", ",", "'model_best.pth.tar'", ")", "\n", "shutil", ".", "copyfile", "(", "path", ",", "best_path", ")", "\n", "", "return", "path", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.InteractionModel.__init__": [[442, 545], ["modules.SuperModule.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input_vocabulary_size", ":", "int", ",", "embedding_dimension", ":", "int", ",", "encoder_hidden_size", ":", "int", ",", "\n", "transitive_input_vocabulary_size", ":", "int", ",", "transitive_input_padding_idx", ":", "int", ",", "input_vocabulary", ":", "str", ",", "\n", "num_encoder_layers", ":", "int", ",", "encoder_dropout_p", ":", "float", ",", "encoder_bidirectional", ":", "bool", ",", "input_padding_idx", ":", "int", ",", "\n", "output_directory", ":", "str", ",", "decoder_hidden_size", ":", "int", ",", "transitive_target_pad_idx", ":", "int", ",", "\n", "transitive_target_sos_idx", ":", "int", ",", "transitive_target_vocabulary_size", ":", "int", ",", "num_decoder_layers", ":", "int", ",", "\n", "decoder_dropout_p", ":", "float", ",", "transitive_target_eos_idx", ":", "int", ",", "num_cnn_channels", ":", "int", ",", "cnn_kernel_size", ":", "int", ",", "\n", "cnn_dropout_p", ":", "float", ",", "cnn_hidden_num_channels", ":", "int", ",", "grid_size", ":", "int", ",", "simplified_architecture", ":", "bool", ",", "\n", "use_attention", ":", "bool", ",", "use_conditional_attention", ":", "bool", ",", "target_vocabulary", ":", "str", ",", "main_input_key", ":", "str", ",", "\n", "type_attention", ":", "str", ",", "attention_values_key", ":", "str", ",", "conditional_attention_values_key", ":", "str", ",", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "simplified_architecture", "=", "simplified_architecture", "\n", "assert", "type_attention", "in", "[", "\"bahdanau\"", ",", "\"luong\"", "]", ",", "\"Unknown type_attention=%s. Options are 'bahdanau', 'luong'\"", "\n", "if", "not", "simplified_architecture", ":", "\n", "            ", "self", ".", "input_specs", "=", "{", "\n", "\"world_state_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"grid\"", ",", "\n", "\"num_input_channels\"", ":", "num_cnn_channels", ",", "\n", "}", ",", "\n", "\"input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"sequence\"", ",", "\n", "\"input_vocabulary_size\"", ":", "input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "input_padding_idx", "\n", "}", ",", "\n", "\"transitive_input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"sequence\"", ",", "\n", "\"input_vocabulary_size\"", ":", "transitive_input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "transitive_input_padding_idx", "\n", "}", "\n", "}", "\n", "self", ".", "target_specs", "=", "{", "\n", "\"transitive_target_tensor\"", ":", "{", "\n", "\"output_type\"", ":", "\"sequence\"", ",", "\n", "\"type_attention\"", ":", "type_attention", ",", "\n", "\"attention\"", ":", "use_attention", ",", "\n", "\"conditional_attention\"", ":", "use_conditional_attention", ",", "\n", "\"target_vocabulary_size\"", ":", "transitive_target_vocabulary_size", ",", "\n", "\"target_pad_idx\"", ":", "transitive_target_pad_idx", ",", "\n", "\"target_eos_idx\"", ":", "transitive_target_eos_idx", ",", "\n", "\"target_sos_idx\"", ":", "transitive_target_sos_idx", "\n", "}", "\n", "}", "\n", "", "else", ":", "\n", "            ", "self", ".", "input_specs", "=", "{", "\n", "\"world_state_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"grid\"", ",", "\n", "\"num_input_channels\"", ":", "num_cnn_channels", ",", "\n", "}", ",", "\n", "\"input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"bow\"", ",", "\n", "\"input_vocabulary_size\"", ":", "input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "input_padding_idx", "\n", "}", ",", "\n", "\"transitive_input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"sequence\"", ",", "\n", "\"input_vocabulary_size\"", ":", "transitive_input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "transitive_input_padding_idx", "\n", "}", "\n", "}", "\n", "self", ".", "target_specs", "=", "{", "\n", "\"transitive_target_tensor\"", ":", "{", "\n", "\"output_type\"", ":", "\"sequence\"", ",", "\n", "\"type_attention\"", ":", "type_attention", ",", "\n", "\"attention\"", ":", "use_attention", ",", "\n", "\"conditional_attention\"", ":", "use_conditional_attention", ",", "\n", "\"target_vocabulary_size\"", ":", "transitive_target_vocabulary_size", ",", "\n", "\"target_pad_idx\"", ":", "transitive_target_pad_idx", ",", "\n", "\"target_eos_idx\"", ":", "transitive_target_eos_idx", ",", "\n", "\"target_sos_idx\"", ":", "transitive_target_sos_idx", "\n", "}", "\n", "}", "\n", "", "metric", "=", "\"exact match\"", "\n", "self", ".", "attention_values_key", "=", "attention_values_key", "\n", "self", ".", "conditional_attention_values_key", "=", "conditional_attention_values_key", "\n", "\n", "self", ".", "input_keys", "=", "[", "\"world_state_tensor\"", "]", "\n", "self", ".", "input_keys_to_pad", "=", "[", "\"input_tensor\"", ",", "\"transitive_input_tensor\"", "]", "\n", "self", ".", "target_keys", "=", "[", "]", "\n", "self", ".", "target_keys_to_pad", "=", "[", "\"transitive_target_tensor\"", "]", "\n", "self", ".", "sequence_decoder", "=", "True", "\n", "self", ".", "use_attention", "=", "use_attention", "\n", "self", ".", "use_conditional_attention", "=", "use_conditional_attention", "\n", "self", ".", "type_attention", "=", "type_attention", "\n", "\n", "super", "(", ")", ".", "__init__", "(", "input_specs", "=", "self", ".", "input_specs", ",", "target_specs", "=", "self", ".", "target_specs", ",", "metric", "=", "metric", ",", "\n", "embedding_dimension", "=", "embedding_dimension", ",", "encoder_hidden_size", "=", "encoder_hidden_size", ",", "\n", "num_encoder_layers", "=", "num_encoder_layers", ",", "encoder_dropout_p", "=", "encoder_dropout_p", ",", "\n", "encoder_bidirectional", "=", "encoder_bidirectional", ",", "output_directory", "=", "output_directory", ",", "\n", "decoder_hidden_size", "=", "decoder_hidden_size", ",", "num_decoder_layers", "=", "num_decoder_layers", ",", "\n", "decoder_dropout_p", "=", "decoder_dropout_p", ",", "cnn_kernel_size", "=", "cnn_kernel_size", ",", "\n", "cnn_dropout_p", "=", "cnn_dropout_p", ",", "cnn_hidden_num_channels", "=", "cnn_hidden_num_channels", ",", "\n", "grid_size", "=", "grid_size", ",", "target_vocabulary", "=", "target_vocabulary", ",", "input_vocabulary", "=", "input_vocabulary", ",", "\n", "main_input_key", "=", "main_input_key", ")", "\n", "\n", "# Module specific combination parameters", "\n", "if", "not", "simplified_architecture", ":", "\n", "            ", "self", ".", "world_state_to_decoder_hidden", "=", "nn", ".", "Linear", "(", "cnn_hidden_num_channels", "*", "3", ",", "\n", "decoder_hidden_size", ")", "\n", "self", ".", "encoder_hiddens_to_initial_hidden", "=", "nn", ".", "Linear", "(", "encoder_hidden_size", "*", "2", ",", "\n", "decoder_hidden_size", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "world_state_to_decoder_hidden", "=", "nn", ".", "Linear", "(", "cnn_hidden_num_channels", "*", "3", "*", "grid_size", "**", "2", ",", "\n", "decoder_hidden_size", ")", "\n", "self", ".", "encoder_to_initial_hidden", "=", "nn", ".", "Linear", "(", "decoder_hidden_size", "+", "(", "encoder_hidden_size", "*", "2", ")", ",", "\n", "decoder_hidden_size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.InteractionModel.get_predictions": [[546, 548], ["Modularity.predict.predict_sequence"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_sequence"], ["", "", "def", "get_predictions", "(", "self", ",", "batch", ",", "max_decoding_steps", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "predict_sequence", "(", "self", ",", "batch", ",", "max_decoding_steps", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.InteractionModel.get_metrics": [[549, 562], ["modules.InteractionModel.get_exact_match"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.get_exact_match"], ["", "def", "get_metrics", "(", "self", ",", "transitive_target_tensor_scores", ":", "torch", ".", "Tensor", ",", "transitive_target_tensor_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "float", "]", ":", "\n", "        ", "\"\"\"\n        :param transitive_target_tensor_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param transitive_target_tensor_targets:  ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar float of accuracy averaged over sequence length and batch size.\n        \"\"\"", "\n", "accuracy", ",", "exact_match", "=", "self", ".", "get_exact_match", "(", "scores", "=", "transitive_target_tensor_scores", ",", "\n", "targets", "=", "transitive_target_tensor_targets", ")", "\n", "return", "{", "\n", "\"transitive_target_tensor_accuracy\"", ":", "accuracy", ",", "\n", "\"transitive_target_tensor_exact_match\"", ":", "exact_match", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.InteractionModel.get_loss": [[564, 573], ["modules.InteractionModel.get_sequence_loss"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.get_sequence_loss"], ["", "def", "get_loss", "(", "self", ",", "transitive_target_tensor_scores", ":", "torch", ".", "Tensor", ",", "transitive_target_tensor_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "\"\"\"\n        :param transitive_target_tensor_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param transitive_target_tensor_targets: ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar negative log-likelihood loss averaged over the sequence length and batch size.\n        \"\"\"", "\n", "return", "self", ".", "get_sequence_loss", "(", "transitive_target_tensor_scores", ",", "transitive_target_tensor_targets", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.InteractionModel.prepare_encoder_output_decoder": [[574, 614], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "modules.InteractionModel.size", "modules.InteractionModel.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "modules.InteractionModel.decoder_module_dict[].initialize_hidden", "encoded_world_state.size", "modules.InteractionModel.world_state_to_decoder_hidden", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "modules.InteractionModel.tanh", "modules.InteractionModel.decoder_module_dict[].initialize_hidden", "modules.InteractionModel.encoder_hiddens_to_initial_hidden", "modules.InteractionModel.world_state_to_decoder_hidden", "encoded_world_state.reshape", "modules.InteractionModel.encoder_to_initial_hidden", "encoder_output[].transpose"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.initialize_hidden", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.initialize_hidden"], ["", "def", "prepare_encoder_output_decoder", "(", "self", ",", "encoder_output", ":", "Dict", "[", "str", ",", "Union", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", ",", "tuple", "]", "]", ")", ":", "\n", "        ", "if", "not", "self", ".", "simplified_architecture", ":", "\n", "            ", "hidden_state_input_tensor", "=", "encoder_output", "[", "\"input_tensor\"", "]", "[", "0", "]", "\n", "hidden_state_adverb_input_tensor", "=", "encoder_output", "[", "\"transitive_input_tensor\"", "]", "[", "0", "]", "\n", "attention_values", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"encoder_outputs\"", "]", "\n", "attention_values_lengths", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"sequence_lengths\"", "]", "\n", "initial_hidden", "=", "torch", ".", "cat", "(", "[", "hidden_state_input_tensor", ",", "\n", "hidden_state_adverb_input_tensor", "]", ",", "dim", "=", "1", ")", "\n", "batch_size", "=", "initial_hidden", ".", "size", "(", "0", ")", "\n", "initial_hidden", "=", "self", ".", "tanh", "(", "self", ".", "encoder_hiddens_to_initial_hidden", "(", "initial_hidden", ")", ")", "\n", "conditional_attention_values", "=", "torch", ".", "tanh", "(", "\n", "self", ".", "world_state_to_decoder_hidden", "(", "encoder_output", "[", "self", ".", "conditional_attention_values_key", "]", ".", "transpose", "(", "0", ",", "1", ")", ")", ")", "\n", "target_key", "=", "self", ".", "target_keys_to_pad", "[", "0", "]", "\n", "initial_hidden", "=", "self", ".", "decoder_module_dict", "[", "target_key", "]", ".", "initialize_hidden", "(", "\n", "initial_hidden", ")", "\n", "conditional_attention_values_lengths", "=", "[", "self", ".", "grid_size", "**", "2", "]", "*", "batch_size", "\n", "", "else", ":", "\n", "            ", "encoded_world_state", "=", "encoder_output", "[", "\"world_state_tensor\"", "]", "\n", "batch_size", ",", "image_num_memory", ",", "image_dim", "=", "encoded_world_state", ".", "size", "(", ")", "\n", "hidden_state_input_tensor", "=", "encoder_output", "[", "\"input_tensor\"", "]", "[", "0", "]", "\n", "hidden_state_transitive_input_tensor", "=", "encoder_output", "[", "\"transitive_input_tensor\"", "]", "[", "0", "]", "\n", "context_world_state", "=", "self", ".", "world_state_to_decoder_hidden", "(", "\n", "encoded_world_state", ".", "reshape", "(", "batch_size", ",", "image_num_memory", "*", "image_dim", ")", ")", "\n", "attention_values", "=", "None", "\n", "attention_values_lengths", "=", "None", "\n", "initial_hidden", "=", "torch", ".", "cat", "(", "[", "context_world_state", ",", "\n", "hidden_state_transitive_input_tensor", ",", "\n", "hidden_state_input_tensor", "]", ",", "dim", "=", "1", ")", "\n", "initial_hidden", "=", "self", ".", "tanh", "(", "self", ".", "encoder_to_initial_hidden", "(", "initial_hidden", ")", ")", "\n", "conditional_attention_values", "=", "None", "\n", "conditional_attention_values_lengths", "=", "None", "\n", "target_key", "=", "self", ".", "target_keys_to_pad", "[", "0", "]", "\n", "initial_hidden", "=", "self", ".", "decoder_module_dict", "[", "target_key", "]", ".", "initialize_hidden", "(", "\n", "initial_hidden", ")", "\n", "", "return", "{", "\"hidden\"", ":", "initial_hidden", ",", "\n", "\"attention_keys\"", ":", "attention_values", ",", "\n", "\"attention_values\"", ":", "attention_values", ",", "\n", "\"attention_values_lengths\"", ":", "attention_values_lengths", ",", "\n", "\"conditional_attention_values\"", ":", "conditional_attention_values", ",", "\n", "\"conditional_attention_values_lengths\"", ":", "conditional_attention_values_lengths", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.InteractionModel.forward": [[615, 624], ["modules.InteractionModel.encode_input", "modules.InteractionModel.decode_input_batched", "decoder_output[].transpose"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.encode_input", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.decode_input_batched"], ["", "def", "forward", "(", "self", ",", "batch", ",", "**", "kwargs", ")", "->", "Dict", "[", "\n", "str", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "encoder_output", "=", "self", ".", "encode_input", "(", "batch", "[", "\"inputs\"", "]", ")", "\n", "decoder_output", "=", "self", ".", "decode_input_batched", "(", "batch", "[", "\"targets\"", "]", ",", "encoder_output", ")", "\n", "# decoder_output_batched: [max_target_length, batch_size, output_size]", "\n", "# attention_weights: [batch_size, max_target_length, max_input_length]", "\n", "return", "{", "\n", "\"transitive_target_tensor_scores\"", ":", "decoder_output", "[", "\"decoder_output_batched\"", "]", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "\"decoder_attention_weights\"", ":", "decoder_output", "[", "\"attention_weights\"", "]", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.NewInteractionModel.__init__": [[629, 728], ["modules.SuperModule.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input_vocabulary_size", ":", "int", ",", "embedding_dimension", ":", "int", ",", "encoder_hidden_size", ":", "int", ",", "\n", "input_vocabulary", ":", "str", ",", "\n", "num_encoder_layers", ":", "int", ",", "encoder_dropout_p", ":", "float", ",", "encoder_bidirectional", ":", "bool", ",", "input_padding_idx", ":", "int", ",", "\n", "output_directory", ":", "str", ",", "decoder_hidden_size", ":", "int", ",", "transitive_target_pad_idx", ":", "int", ",", "\n", "transitive_target_sos_idx", ":", "int", ",", "transitive_target_vocabulary_size", ":", "int", ",", "num_decoder_layers", ":", "int", ",", "\n", "decoder_dropout_p", ":", "float", ",", "transitive_target_eos_idx", ":", "int", ",", "num_cnn_channels", ":", "int", ",", "cnn_kernel_size", ":", "int", ",", "\n", "cnn_dropout_p", ":", "float", ",", "cnn_hidden_num_channels", ":", "int", ",", "grid_size", ":", "int", ",", "simplified_architecture", ":", "bool", ",", "\n", "use_attention", ":", "bool", ",", "use_conditional_attention", ":", "bool", ",", "target_vocabulary", ":", "str", ",", "main_input_key", ":", "str", ",", "\n", "type_attention", ":", "str", ",", "attention_values_key", ":", "str", ",", "conditional_attention_values_key", ":", "str", ",", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "simplified_architecture", "=", "simplified_architecture", "\n", "assert", "type_attention", "in", "[", "\"bahdanau\"", ",", "\"luong\"", "]", ",", "\"Unknown type_attention=%s. Options are 'bahdanau', 'luong'\"", "\n", "self", ".", "type_attention", "=", "type_attention", "\n", "if", "not", "simplified_architecture", ":", "\n", "            ", "self", ".", "input_specs", "=", "{", "\n", "\"world_state_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"grid\"", ",", "\n", "\"num_input_channels\"", ":", "num_cnn_channels", ",", "\n", "}", ",", "\n", "\"input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"sequence\"", ",", "\n", "\"input_vocabulary_size\"", ":", "input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "input_padding_idx", "\n", "}", ",", "\n", "\"target_position\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", "\n", "}", "\n", "self", ".", "target_specs", "=", "{", "\n", "\"transitive_target_tensor\"", ":", "{", "\n", "\"output_type\"", ":", "\"sequence\"", ",", "\n", "\"type_attention\"", ":", "type_attention", ",", "\n", "\"attention\"", ":", "use_attention", ",", "\n", "\"conditional_attention\"", ":", "use_conditional_attention", ",", "\n", "\"target_vocabulary_size\"", ":", "transitive_target_vocabulary_size", ",", "\n", "\"target_pad_idx\"", ":", "transitive_target_pad_idx", ",", "\n", "\"target_eos_idx\"", ":", "transitive_target_eos_idx", ",", "\n", "\"target_sos_idx\"", ":", "transitive_target_sos_idx", "\n", "}", "\n", "}", "\n", "", "else", ":", "\n", "            ", "self", ".", "input_specs", "=", "{", "\n", "\"world_state_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"grid\"", ",", "\n", "\"num_input_channels\"", ":", "num_cnn_channels", ",", "\n", "}", ",", "\n", "\"input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"bow\"", ",", "\n", "\"input_vocabulary_size\"", ":", "input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "input_padding_idx", "\n", "}", ",", "\n", "\"target_position\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", "\n", "}", "\n", "self", ".", "target_specs", "=", "{", "\n", "\"transitive_target_tensor\"", ":", "{", "\n", "\"output_type\"", ":", "\"sequence\"", ",", "\n", "\"type_attention\"", ":", "type_attention", ",", "\n", "\"attention\"", ":", "use_attention", ",", "\n", "\"conditional_attention\"", ":", "use_conditional_attention", ",", "\n", "\"target_vocabulary_size\"", ":", "transitive_target_vocabulary_size", ",", "\n", "\"target_pad_idx\"", ":", "transitive_target_pad_idx", ",", "\n", "\"target_eos_idx\"", ":", "transitive_target_eos_idx", ",", "\n", "\"target_sos_idx\"", ":", "transitive_target_sos_idx", "\n", "}", "\n", "}", "\n", "", "metric", "=", "\"exact match\"", "\n", "self", ".", "attention_values_key", "=", "attention_values_key", "\n", "self", ".", "conditional_attention_values_key", "=", "conditional_attention_values_key", "\n", "\n", "self", ".", "input_keys", "=", "[", "\"world_state_tensor\"", ",", "\"target_position\"", "]", "\n", "self", ".", "input_keys_to_pad", "=", "[", "\"input_tensor\"", "]", "\n", "self", ".", "target_keys", "=", "[", "]", "\n", "self", ".", "target_keys_to_pad", "=", "[", "\"transitive_target_tensor\"", "]", "\n", "self", ".", "sequence_decoder", "=", "True", "\n", "self", ".", "use_attention", "=", "use_attention", "\n", "self", ".", "use_conditional_attention", "=", "use_conditional_attention", "\n", "\n", "super", "(", ")", ".", "__init__", "(", "input_specs", "=", "self", ".", "input_specs", ",", "target_specs", "=", "self", ".", "target_specs", ",", "metric", "=", "metric", ",", "\n", "embedding_dimension", "=", "embedding_dimension", ",", "encoder_hidden_size", "=", "encoder_hidden_size", ",", "\n", "num_encoder_layers", "=", "num_encoder_layers", ",", "encoder_dropout_p", "=", "encoder_dropout_p", ",", "\n", "encoder_bidirectional", "=", "encoder_bidirectional", ",", "output_directory", "=", "output_directory", ",", "\n", "decoder_hidden_size", "=", "decoder_hidden_size", ",", "num_decoder_layers", "=", "num_decoder_layers", ",", "\n", "decoder_dropout_p", "=", "decoder_dropout_p", ",", "cnn_kernel_size", "=", "cnn_kernel_size", ",", "\n", "cnn_dropout_p", "=", "cnn_dropout_p", ",", "cnn_hidden_num_channels", "=", "cnn_hidden_num_channels", ",", "\n", "grid_size", "=", "grid_size", ",", "target_vocabulary", "=", "target_vocabulary", ",", "input_vocabulary", "=", "input_vocabulary", ",", "\n", "main_input_key", "=", "main_input_key", ")", "\n", "\n", "# Module specific combination parameters", "\n", "if", "not", "simplified_architecture", ":", "\n", "            ", "self", ".", "world_state_to_decoder_hidden", "=", "nn", ".", "Linear", "(", "cnn_hidden_num_channels", "*", "3", ",", "\n", "decoder_hidden_size", ")", "\n", "self", ".", "encoder_hiddens_to_initial_hidden", "=", "nn", ".", "Linear", "(", "encoder_hidden_size", "*", "2", ",", "\n", "decoder_hidden_size", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "world_state_to_decoder_hidden", "=", "nn", ".", "Linear", "(", "cnn_hidden_num_channels", "*", "3", "*", "grid_size", "**", "2", ",", "\n", "decoder_hidden_size", ")", "\n", "self", ".", "encoder_to_initial_hidden", "=", "nn", ".", "Linear", "(", "decoder_hidden_size", "+", "(", "encoder_hidden_size", "*", "2", ")", ",", "\n", "decoder_hidden_size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.NewInteractionModel.get_predictions": [[729, 731], ["Modularity.predict.predict_sequence"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_sequence"], ["", "", "def", "get_predictions", "(", "self", ",", "batch", ",", "max_decoding_steps", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "predict_sequence", "(", "self", ",", "batch", ",", "max_decoding_steps", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.NewInteractionModel.get_metrics": [[732, 745], ["modules.NewInteractionModel.get_exact_match"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.get_exact_match"], ["", "def", "get_metrics", "(", "self", ",", "transitive_target_tensor_scores", ":", "torch", ".", "Tensor", ",", "transitive_target_tensor_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "float", "]", ":", "\n", "        ", "\"\"\"\n        :param transitive_target_tensor_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param transitive_target_tensor_targets:  ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar float of accuracy averaged over sequence length and batch size.\n        \"\"\"", "\n", "accuracy", ",", "exact_match", "=", "self", ".", "get_exact_match", "(", "scores", "=", "transitive_target_tensor_scores", ",", "\n", "targets", "=", "transitive_target_tensor_targets", ")", "\n", "return", "{", "\n", "\"transitive_target_tensor_accuracy\"", ":", "accuracy", ",", "\n", "\"transitive_target_tensor_exact_match\"", ":", "exact_match", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.NewInteractionModel.get_loss": [[747, 756], ["modules.NewInteractionModel.get_sequence_loss"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.get_sequence_loss"], ["", "def", "get_loss", "(", "self", ",", "transitive_target_tensor_scores", ":", "torch", ".", "Tensor", ",", "transitive_target_tensor_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "\"\"\"\n        :param transitive_target_tensor_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param transitive_target_tensor_targets: ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar negative log-likelihood loss averaged over the sequence length and batch size.\n        \"\"\"", "\n", "return", "self", ".", "get_sequence_loss", "(", "transitive_target_tensor_scores", ",", "transitive_target_tensor_targets", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.NewInteractionModel.prepare_encoder_output_decoder": [[757, 800], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "modules.NewInteractionModel.size", "modules.NewInteractionModel.tanh", "modules.NewInteractionModel.decoder_module_dict[].initialize_hidden", "encoded_world_state.size", "modules.NewInteractionModel.world_state_to_decoder_hidden", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "modules.NewInteractionModel.tanh", "modules.NewInteractionModel.decoder_module_dict[].initialize_hidden", "modules.NewInteractionModel.encoder_hiddens_to_initial_hidden", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "encoder_output[].transpose", "encoded_world_state.reshape", "modules.NewInteractionModel.encoder_to_initial_hidden", "modules.NewInteractionModel.world_state_to_decoder_hidden", "encoder_output[].transpose"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.initialize_hidden", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.initialize_hidden"], ["", "def", "prepare_encoder_output_decoder", "(", "self", ",", "encoder_output", ":", "Dict", "[", "str", ",", "Union", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", ",", "tuple", "]", "]", ")", ":", "\n", "        ", "if", "not", "self", ".", "simplified_architecture", ":", "\n", "            ", "hidden_state_input_tensor", "=", "encoder_output", "[", "\"input_tensor\"", "]", "[", "0", "]", "\n", "attention_values", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"encoder_outputs\"", "]", "\n", "attention_values_lengths", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"sequence_lengths\"", "]", "\n", "encoded_position", "=", "encoder_output", "[", "\"mlp\"", "]", "\n", "initial_hidden", "=", "torch", ".", "cat", "(", "[", "hidden_state_input_tensor", ",", "\n", "encoded_position", "]", ",", "dim", "=", "1", ")", "\n", "batch_size", "=", "initial_hidden", ".", "size", "(", "0", ")", "\n", "initial_hidden", "=", "self", ".", "tanh", "(", "self", ".", "encoder_hiddens_to_initial_hidden", "(", "initial_hidden", ")", ")", "\n", "if", "self", ".", "type_attention", "==", "\"luong\"", ":", "\n", "                ", "conditional_attention_values", "=", "torch", ".", "tanh", "(", "\n", "self", ".", "world_state_to_decoder_hidden", "(", "encoder_output", "[", "self", ".", "conditional_attention_values_key", "]", ".", "transpose", "(", "0", ",", "1", ")", ")", ")", "\n", "", "else", ":", "\n", "                ", "conditional_attention_values", "=", "encoder_output", "[", "self", ".", "conditional_attention_values_key", "]", ".", "transpose", "(", "0", ",", "1", ")", "\n", "", "target_key", "=", "self", ".", "target_keys_to_pad", "[", "0", "]", "\n", "initial_hidden", "=", "self", ".", "decoder_module_dict", "[", "target_key", "]", ".", "initialize_hidden", "(", "\n", "initial_hidden", ")", "\n", "conditional_attention_values_lengths", "=", "[", "self", ".", "grid_size", "**", "2", "]", "*", "batch_size", "\n", "", "else", ":", "\n", "            ", "encoded_world_state", "=", "encoder_output", "[", "\"world_state_tensor\"", "]", "\n", "batch_size", ",", "image_num_memory", ",", "image_dim", "=", "encoded_world_state", ".", "size", "(", ")", "\n", "hidden_state_input_tensor", "=", "encoder_output", "[", "\"input_tensor\"", "]", "[", "0", "]", "\n", "encoded_position", "=", "encoder_output", "[", "\"mlp\"", "]", "\n", "context_world_state", "=", "self", ".", "world_state_to_decoder_hidden", "(", "\n", "encoded_world_state", ".", "reshape", "(", "batch_size", ",", "image_num_memory", "*", "image_dim", ")", ")", "\n", "attention_values", "=", "None", "\n", "attention_values_lengths", "=", "None", "\n", "initial_hidden", "=", "torch", ".", "cat", "(", "[", "context_world_state", ",", "\n", "encoded_position", ",", "\n", "hidden_state_input_tensor", "]", ",", "dim", "=", "1", ")", "\n", "initial_hidden", "=", "self", ".", "tanh", "(", "self", ".", "encoder_to_initial_hidden", "(", "initial_hidden", ")", ")", "\n", "conditional_attention_values", "=", "None", "\n", "conditional_attention_values_lengths", "=", "None", "\n", "target_key", "=", "self", ".", "target_keys_to_pad", "[", "0", "]", "\n", "initial_hidden", "=", "self", ".", "decoder_module_dict", "[", "target_key", "]", ".", "initialize_hidden", "(", "\n", "initial_hidden", ")", "\n", "", "return", "{", "\"hidden\"", ":", "initial_hidden", ",", "\n", "\"attention_keys\"", ":", "attention_values", ",", "\n", "\"attention_values\"", ":", "attention_values", ",", "\n", "\"attention_values_lengths\"", ":", "attention_values_lengths", ",", "\n", "\"conditional_attention_values\"", ":", "conditional_attention_values", ",", "\n", "\"conditional_attention_values_lengths\"", ":", "conditional_attention_values_lengths", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.NewInteractionModel.forward": [[801, 810], ["modules.NewInteractionModel.encode_input", "modules.NewInteractionModel.decode_input_batched", "decoder_output[].transpose"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.encode_input", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.decode_input_batched"], ["", "def", "forward", "(", "self", ",", "batch", ",", "**", "kwargs", ")", "->", "Dict", "[", "\n", "str", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "encoder_output", "=", "self", ".", "encode_input", "(", "batch", "[", "\"inputs\"", "]", ")", "\n", "decoder_output", "=", "self", ".", "decode_input_batched", "(", "batch", "[", "\"targets\"", "]", ",", "encoder_output", ")", "\n", "# decoder_output_batched: [max_target_length, batch_size, output_size]", "\n", "# attention_weights: [batch_size, max_target_length, max_input_length]", "\n", "return", "{", "\n", "\"transitive_target_tensor_scores\"", ":", "decoder_output", "[", "\"decoder_output_batched\"", "]", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "\"decoder_attention_weights\"", ":", "decoder_output", "[", "\"attention_weights\"", "]", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.DummyInteractionModel.__init__": [[815, 903], ["modules.SuperModule.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input_vocabulary_size", ":", "int", ",", "embedding_dimension", ":", "int", ",", "encoder_hidden_size", ":", "int", ",", "\n", "transitive_input_vocabulary_size", ":", "int", ",", "transitive_input_padding_idx", ":", "int", ",", "\n", "num_encoder_layers", ":", "int", ",", "encoder_dropout_p", ":", "float", ",", "encoder_bidirectional", ":", "bool", ",", "input_padding_idx", ":", "int", ",", "\n", "output_directory", ":", "str", ",", "decoder_hidden_size", ":", "int", ",", "transitive_target_pad_idx", ":", "int", ",", "\n", "transitive_target_sos_idx", ":", "int", ",", "transitive_target_vocabulary_size", ":", "int", ",", "num_decoder_layers", ":", "int", ",", "\n", "decoder_dropout_p", ":", "float", ",", "transitive_target_eos_idx", ":", "int", ",", "num_cnn_channels", ":", "int", ",", "cnn_kernel_size", ":", "int", ",", "\n", "cnn_dropout_p", ":", "float", ",", "cnn_hidden_num_channels", ":", "int", ",", "grid_size", ":", "int", ",", "simplified_architecture", ":", "bool", ",", "\n", "use_attention", ":", "bool", ",", "use_conditional_attention", ":", "bool", ",", "target_vocabulary", ":", "str", ",", "\n", "main_input_key", ":", "str", ",", "input_vocabulary", ":", "str", ",", "\n", "type_attention", ":", "str", ",", "attention_values_key", ":", "str", ",", "conditional_attention_values_key", ":", "str", ",", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "simplified_architecture", "=", "simplified_architecture", "\n", "assert", "type_attention", "in", "[", "\"bahdanau\"", ",", "\"luong\"", "]", ",", "\"Unknown type_attention=%s. Options are 'bahdanau', 'luong'\"", "\n", "if", "not", "simplified_architecture", ":", "\n", "            ", "self", ".", "input_specs", "=", "{", "\n", "\"world_state_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"grid\"", ",", "\n", "\"num_input_channels\"", ":", "num_cnn_channels", ",", "\n", "}", ",", "\n", "\"input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"sequence\"", ",", "\n", "\"input_vocabulary_size\"", ":", "input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "input_padding_idx", "\n", "}", "\n", "}", "\n", "self", ".", "target_specs", "=", "{", "\n", "\"transitive_target_tensor\"", ":", "{", "\n", "\"output_type\"", ":", "\"sequence\"", ",", "\n", "\"type_attention\"", ":", "type_attention", ",", "\n", "\"attention\"", ":", "use_attention", ",", "\n", "\"conditional_attention\"", ":", "use_conditional_attention", ",", "\n", "\"target_vocabulary_size\"", ":", "transitive_target_vocabulary_size", ",", "\n", "\"target_pad_idx\"", ":", "transitive_target_pad_idx", ",", "\n", "\"target_eos_idx\"", ":", "transitive_target_eos_idx", ",", "\n", "\"target_sos_idx\"", ":", "transitive_target_sos_idx", "\n", "}", "\n", "}", "\n", "", "else", ":", "\n", "            ", "self", ".", "input_specs", "=", "{", "\n", "\"world_state_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"grid\"", ",", "\n", "\"num_input_channels\"", ":", "num_cnn_channels", ",", "\n", "}", ",", "\n", "\"input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"bow\"", ",", "\n", "\"input_vocabulary_size\"", ":", "input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "input_padding_idx", "\n", "}", "\n", "}", "\n", "self", ".", "target_specs", "=", "{", "\n", "\"transitive_target_tensor\"", ":", "{", "\n", "\"output_type\"", ":", "\"sequence\"", ",", "\n", "\"type_attention\"", ":", "type_attention", ",", "\n", "\"attention\"", ":", "use_attention", ",", "\n", "\"conditional_attention\"", ":", "use_conditional_attention", ",", "\n", "\"target_vocabulary_size\"", ":", "transitive_target_vocabulary_size", ",", "\n", "\"target_pad_idx\"", ":", "transitive_target_pad_idx", ",", "\n", "\"target_eos_idx\"", ":", "transitive_target_eos_idx", ",", "\n", "\"target_sos_idx\"", ":", "transitive_target_sos_idx", "\n", "}", "\n", "}", "\n", "", "metric", "=", "\"exact match\"", "\n", "self", ".", "attention_values_key", "=", "attention_values_key", "\n", "self", ".", "conditional_attention_values_key", "=", "conditional_attention_values_key", "\n", "\n", "self", ".", "input_keys", "=", "[", "\"world_state_tensor\"", "]", "\n", "self", ".", "input_keys_to_pad", "=", "[", "\"input_tensor\"", "]", "\n", "self", ".", "target_keys", "=", "[", "]", "\n", "self", ".", "target_keys_to_pad", "=", "[", "\"transitive_target_tensor\"", "]", "\n", "self", ".", "sequence_decoder", "=", "True", "\n", "self", ".", "use_attention", "=", "use_attention", "\n", "self", ".", "use_conditional_attention", "=", "use_conditional_attention", "\n", "\n", "super", "(", ")", ".", "__init__", "(", "input_specs", "=", "self", ".", "input_specs", ",", "target_specs", "=", "self", ".", "target_specs", ",", "metric", "=", "metric", ",", "\n", "embedding_dimension", "=", "embedding_dimension", ",", "encoder_hidden_size", "=", "encoder_hidden_size", ",", "\n", "num_encoder_layers", "=", "num_encoder_layers", ",", "encoder_dropout_p", "=", "encoder_dropout_p", ",", "\n", "encoder_bidirectional", "=", "encoder_bidirectional", ",", "output_directory", "=", "output_directory", ",", "\n", "decoder_hidden_size", "=", "decoder_hidden_size", ",", "num_decoder_layers", "=", "num_decoder_layers", ",", "\n", "decoder_dropout_p", "=", "decoder_dropout_p", ",", "cnn_kernel_size", "=", "cnn_kernel_size", ",", "\n", "cnn_dropout_p", "=", "cnn_dropout_p", ",", "cnn_hidden_num_channels", "=", "cnn_hidden_num_channels", ",", "\n", "grid_size", "=", "grid_size", ",", "target_vocabulary", "=", "target_vocabulary", ",", "main_input_key", "=", "main_input_key", ",", "\n", "input_vocabulary", "=", "input_vocabulary", ")", "\n", "# Module specific combination parameters", "\n", "if", "not", "simplified_architecture", ":", "\n", "# self.world_state_to_decoder_hidden = nn.Linear(cnn_hidden_num_channels * 3, decoder_hidden_size)", "\n", "            ", "self", ".", "encoder_hiddens_to_initial_hidden", "=", "nn", ".", "Linear", "(", "encoder_hidden_size", ",", "decoder_hidden_size", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "encoder_to_initial_hidden", "=", "nn", ".", "Linear", "(", "cnn_hidden_num_channels", "*", "3", "+", "encoder_hidden_size", ",", "\n", "decoder_hidden_size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.DummyInteractionModel.get_predictions": [[904, 906], ["Modularity.predict.predict_sequence"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_sequence"], ["", "", "def", "get_predictions", "(", "self", ",", "batch", ",", "max_decoding_steps", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "predict_sequence", "(", "self", ",", "batch", ",", "max_decoding_steps", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.DummyInteractionModel.get_metrics": [[907, 920], ["modules.DummyInteractionModel.get_exact_match"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.get_exact_match"], ["", "def", "get_metrics", "(", "self", ",", "transitive_target_tensor_scores", ":", "torch", ".", "Tensor", ",", "transitive_target_tensor_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "float", "]", ":", "\n", "        ", "\"\"\"\n        :param transitive_target_tensor_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param transitive_target_tensor_targets:  ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar float of accuracy averaged over sequence length and batch size.\n        \"\"\"", "\n", "accuracy", ",", "exact_match", "=", "self", ".", "get_exact_match", "(", "scores", "=", "transitive_target_tensor_scores", ",", "\n", "targets", "=", "transitive_target_tensor_targets", ")", "\n", "return", "{", "\n", "\"transitive_target_tensor_accuracy\"", ":", "accuracy", ",", "\n", "\"transitive_target_tensor_exact_match\"", ":", "exact_match", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.DummyInteractionModel.get_loss": [[922, 931], ["modules.DummyInteractionModel.get_sequence_loss"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.get_sequence_loss"], ["", "def", "get_loss", "(", "self", ",", "transitive_target_tensor_scores", ":", "torch", ".", "Tensor", ",", "transitive_target_tensor_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "\"\"\"\n        :param transitive_target_tensor_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param transitive_target_tensor_targets: ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar negative log-likelihood loss averaged over the sequence length and batch size.\n        \"\"\"", "\n", "return", "self", ".", "get_sequence_loss", "(", "transitive_target_tensor_scores", ",", "transitive_target_tensor_targets", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.DummyInteractionModel.prepare_encoder_output_decoder": [[932, 982], ["modules.DummyInteractionModel.size", "modules.DummyInteractionModel.tanh", "encoder_output[].transpose", "modules.DummyInteractionModel.decoder_module_dict[].initialize_hidden", "NotImplementedError", "encoded_world_state.size", "modules.DummyInteractionModel.attention", "modules.DummyInteractionModel.attention_two", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "modules.DummyInteractionModel.size", "modules.DummyInteractionModel.tanh", "modules.DummyInteractionModel.decoder_module_dict[].initialize_hidden", "modules.DummyInteractionModel.encoder_hiddens_to_initial_hidden", "modules.DummyInteractionModel.encoder_to_initial_hidden", "range", "hidden_state_adverb_input_tensor.unsqueeze", "hidden_state_adverb_input_tensor.unsqueeze", "context_world_state.squeeze", "context_input.squeeze"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.initialize_hidden", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.initialize_hidden"], ["", "def", "prepare_encoder_output_decoder", "(", "self", ",", "encoder_output", ":", "Dict", "[", "str", ",", "Union", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", ",", "tuple", "]", "]", ")", ":", "\n", "        ", "if", "not", "self", ".", "simplified_architecture", ":", "\n", "            ", "encoded_world_state", "=", "encoder_output", "[", "\"world_state_tensor\"", "]", "\n", "hidden_state_input_tensor", "=", "encoder_output", "[", "\"input_tensor\"", "]", "[", "0", "]", "\n", "attention_values", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"encoder_outputs\"", "]", "\n", "attention_values_lengths", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"sequence_lengths\"", "]", "\n", "initial_hidden", "=", "hidden_state_input_tensor", "\n", "batch_size", "=", "initial_hidden", ".", "size", "(", "0", ")", "\n", "initial_hidden", "=", "self", ".", "tanh", "(", "self", ".", "encoder_hiddens_to_initial_hidden", "(", "initial_hidden", ")", ")", "\n", "# conditional_attention_values = torch.tanh(", "\n", "#     self.world_state_to_decoder_hidden(encoder_output[self.conditional_attention_values_key].transpose(0, 1)))", "\n", "conditional_attention_values", "=", "encoder_output", "[", "self", ".", "conditional_attention_values_key", "]", ".", "transpose", "(", "0", ",", "1", ")", "\n", "target_key", "=", "self", ".", "target_keys_to_pad", "[", "0", "]", "\n", "initial_hidden", "=", "self", ".", "decoder_module_dict", "[", "target_key", "]", ".", "initialize_hidden", "(", "\n", "initial_hidden", ")", "\n", "conditional_attention_values_lengths", "=", "[", "self", ".", "grid_size", "**", "2", "]", "*", "batch_size", "\n", "", "else", ":", "\n", "            ", "raise", "NotImplementedError", "(", "\"Simplified dummy interaction module not implemented.\"", ")", "\n", "encoded_world_state", "=", "encoder_output", "[", "\"world_state_tensor\"", "]", "\n", "batch_size", ",", "image_num_memory", ",", "image_dim", "=", "encoded_world_state", ".", "size", "(", ")", "\n", "situation_lengths", "=", "[", "image_num_memory", "for", "_", "in", "range", "(", "batch_size", ")", "]", "\n", "hidden_state_input_tensor", "=", "encoder_output", "[", "\"input_tensor\"", "]", "[", "0", "]", "\n", "input_tensor_embeddings", "=", "encoder_output", "[", "\"input_tensor\"", "]", "[", "1", "]", "[", "\"encoder_outputs\"", "]", "\n", "input_tensor_lengths", "=", "encoder_output", "[", "\"input_tensor\"", "]", "[", "1", "]", "[", "\"sequence_lengths\"", "]", "\n", "hidden_state_adverb_input_tensor", "=", "encoder_output", "[", "\"transitive_input_tensor\"", "]", "[", "0", "]", "\n", "\n", "context_world_state", ",", "attention_weights", "=", "self", ".", "attention", "(", "\n", "queries", "=", "hidden_state_adverb_input_tensor", ".", "unsqueeze", "(", "dim", "=", "1", ")", ",", "keys", "=", "encoded_world_state", ",", "\n", "values", "=", "encoded_world_state", ",", "memory_lengths", "=", "situation_lengths", ")", "\n", "context_input", ",", "attention_weights_input", "=", "self", ".", "attention_two", "(", "\n", "queries", "=", "hidden_state_adverb_input_tensor", ".", "unsqueeze", "(", "dim", "=", "1", ")", ",", "keys", "=", "input_tensor_embeddings", ",", "\n", "values", "=", "input_tensor_embeddings", ",", "memory_lengths", "=", "input_tensor_lengths", ")", "\n", "\n", "attention_values", "=", "None", "\n", "attention_values_lengths", "=", "None", "\n", "initial_hidden", "=", "torch", ".", "cat", "(", "[", "context_world_state", ".", "squeeze", "(", "dim", "=", "1", ")", ",", "\n", "context_input", ".", "squeeze", "(", "dim", "=", "1", ")", "]", ",", "dim", "=", "1", ")", "\n", "batch_size", "=", "initial_hidden", ".", "size", "(", "0", ")", "\n", "initial_hidden", "=", "self", ".", "tanh", "(", "self", ".", "encoder_to_initial_hidden", "(", "initial_hidden", ")", ")", "\n", "conditional_attention_values", "=", "None", "\n", "conditional_attention_values_lengths", "=", "None", "\n", "target_key", "=", "self", ".", "target_keys_to_pad", "[", "0", "]", "\n", "initial_hidden", "=", "self", ".", "decoder_module_dict", "[", "target_key", "]", ".", "initialize_hidden", "(", "\n", "initial_hidden", ")", "\n", "", "return", "{", "\"hidden\"", ":", "initial_hidden", ",", "\n", "\"attention_keys\"", ":", "attention_values", ",", "\n", "\"attention_values\"", ":", "attention_values", ",", "\n", "\"attention_values_lengths\"", ":", "attention_values_lengths", ",", "\n", "\"conditional_attention_values\"", ":", "conditional_attention_values", ",", "\n", "\"conditional_attention_values_lengths\"", ":", "conditional_attention_values_lengths", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.DummyInteractionModel.forward": [[983, 992], ["modules.DummyInteractionModel.encode_input", "modules.DummyInteractionModel.decode_input_batched", "decoder_output[].transpose"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.encode_input", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.decode_input_batched"], ["", "def", "forward", "(", "self", ",", "batch", ",", "**", "kwargs", ")", "->", "Dict", "[", "\n", "str", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "encoder_output", "=", "self", ".", "encode_input", "(", "batch", "[", "\"inputs\"", "]", ")", "\n", "decoder_output", "=", "self", ".", "decode_input_batched", "(", "batch", "[", "\"targets\"", "]", ",", "encoder_output", ")", "\n", "# decoder_output_batched: [max_target_length, batch_size, output_size]", "\n", "# attention_weights: [batch_size, max_target_length, max_input_length]", "\n", "return", "{", "\n", "\"transitive_target_tensor_scores\"", ":", "decoder_output", "[", "\"decoder_output_batched\"", "]", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "\"decoder_attention_weights\"", ":", "decoder_output", "[", "\"attention_weights\"", "]", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.PlannerModel.__init__": [[997, 1102], ["modules.SuperModule.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Tanh", "torch.Tanh", "torch.Tanh"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input_vocabulary_size", ":", "int", ",", "embedding_dimension", ":", "int", ",", "encoder_hidden_size", ":", "int", ",", "\n", "num_encoder_layers", ":", "int", ",", "encoder_dropout_p", ":", "float", ",", "encoder_bidirectional", ":", "bool", ",", "input_padding_idx", ":", "int", ",", "\n", "output_directory", ":", "str", ",", "decoder_hidden_size", ":", "int", ",", "planner_target_pad_idx", ":", "int", ",", "input_vocabulary", ":", "str", ",", "\n", "planner_target_sos_idx", ":", "int", ",", "planner_target_vocabulary_size", ":", "int", ",", "num_decoder_layers", ":", "int", ",", "\n", "decoder_dropout_p", ":", "float", ",", "planner_target_eos_idx", ":", "int", ",", "simplified_architecture", ":", "bool", ",", "\n", "use_attention", ":", "bool", ",", "use_conditional_attention", ":", "bool", ",", "type_attention", ":", "str", ",", "attention_values_key", ":", "str", ",", "\n", "conditional_attention_values_key", ":", "str", ",", "target_vocabulary", ":", "str", ",", "main_input_key", ":", "str", ",", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "simplified_architecture", "=", "simplified_architecture", "\n", "assert", "type_attention", "in", "[", "\"bahdanau\"", ",", "\"luong\"", "]", ",", "\"Unknown type_attention=%s. Options are 'bahdanau', 'luong'\"", "\n", "assert", "not", "use_conditional_attention", ",", "\"Cannot use conditional attention in PlannerModel.\"", "\n", "if", "not", "simplified_architecture", ":", "\n", "            ", "self", ".", "input_specs", "=", "{", "\n", "\"input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"sequence\"", ",", "\n", "\"input_vocabulary_size\"", ":", "input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "input_padding_idx", "\n", "}", ",", "\n", "\"agent_position\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", ",", "\n", "\"target_position\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", ",", "\n", "\"agent_direction\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", "\n", "}", "\n", "self", ".", "target_specs", "=", "{", "\n", "\"planner_target_tensor\"", ":", "{", "\n", "\"output_type\"", ":", "\"sequence\"", ",", "\n", "\"type_attention\"", ":", "type_attention", ",", "\n", "\"attention\"", ":", "use_attention", ",", "\n", "\"attention_values\"", ":", "\"input_tensor\"", ",", "\n", "\"conditional_attention\"", ":", "use_conditional_attention", ",", "\n", "\"target_vocabulary_size\"", ":", "planner_target_vocabulary_size", ",", "\n", "\"target_pad_idx\"", ":", "planner_target_pad_idx", ",", "\n", "\"target_eos_idx\"", ":", "planner_target_eos_idx", ",", "\n", "\"target_sos_idx\"", ":", "planner_target_sos_idx", "\n", "}", "\n", "}", "\n", "", "else", ":", "\n", "            ", "self", ".", "input_specs", "=", "{", "\n", "\"input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"bow\"", ",", "\n", "\"input_vocabulary_size\"", ":", "input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "input_padding_idx", "\n", "}", ",", "\n", "\"agent_position\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", ",", "\n", "\"target_position\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", ",", "\n", "\"agent_direction\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", "\n", "}", "\n", "self", ".", "target_specs", "=", "{", "\n", "\"planner_target_tensor\"", ":", "{", "\n", "\"output_type\"", ":", "\"sequence\"", ",", "\n", "\"type_attention\"", ":", "\"luong\"", ",", "\n", "\"attention\"", ":", "use_attention", ",", "\n", "\"conditional_attention\"", ":", "use_conditional_attention", ",", "\n", "\"target_vocabulary_size\"", ":", "planner_target_vocabulary_size", ",", "\n", "\"target_pad_idx\"", ":", "planner_target_pad_idx", ",", "\n", "\"target_eos_idx\"", ":", "planner_target_eos_idx", ",", "\n", "\"target_sos_idx\"", ":", "planner_target_sos_idx", "\n", "}", "\n", "}", "\n", "", "metric", "=", "\"exact match\"", "\n", "self", ".", "attention_values_key", "=", "attention_values_key", "\n", "self", ".", "conditional_attention_values_key", "=", "conditional_attention_values_key", "\n", "\n", "self", ".", "input_keys", "=", "[", "\"agent_position\"", ",", "\"target_position\"", ",", "\"agent_direction\"", "]", "\n", "self", ".", "input_keys_to_pad", "=", "[", "\"input_tensor\"", "]", "\n", "self", ".", "target_keys", "=", "[", "]", "\n", "self", ".", "target_keys_to_pad", "=", "[", "\"planner_target_tensor\"", "]", "\n", "self", ".", "sequence_decoder", "=", "True", "\n", "self", ".", "use_attention", "=", "use_attention", "\n", "self", ".", "use_conditional_attention", "=", "use_conditional_attention", "\n", "self", ".", "type_attention", "=", "type_attention", "\n", "\n", "super", "(", ")", ".", "__init__", "(", "input_specs", "=", "self", ".", "input_specs", ",", "target_specs", "=", "self", ".", "target_specs", ",", "metric", "=", "metric", ",", "\n", "embedding_dimension", "=", "embedding_dimension", ",", "encoder_hidden_size", "=", "encoder_hidden_size", ",", "\n", "num_encoder_layers", "=", "num_encoder_layers", ",", "encoder_dropout_p", "=", "encoder_dropout_p", ",", "\n", "encoder_bidirectional", "=", "encoder_bidirectional", ",", "output_directory", "=", "output_directory", ",", "\n", "decoder_hidden_size", "=", "decoder_hidden_size", ",", "num_decoder_layers", "=", "num_decoder_layers", ",", "\n", "decoder_dropout_p", "=", "decoder_dropout_p", ",", "target_vocabulary", "=", "target_vocabulary", ",", "\n", "input_vocabulary", "=", "input_vocabulary", ",", "main_input_key", "=", "main_input_key", ")", "\n", "\n", "# Used to project the final encoder state to the decoder hidden state such that it can be initialized with it.", "\n", "self", ".", "encoder_hiddens_to_initial_hidden", "=", "nn", ".", "Linear", "(", "encoder_hidden_size", "*", "2", ",", "decoder_hidden_size", ")", "\n", "\n", "self", ".", "tanh", "=", "nn", ".", "Tanh", "(", ")", "\n", "self", ".", "output_directory", "=", "output_directory", "\n", "self", ".", "trained_iterations", "=", "0", "\n", "self", ".", "best_iteration", "=", "0", "\n", "self", ".", "best_metric", "=", "0", "\n", "self", ".", "metric", "=", "\"exact match\"", "\n", "\n", "self", ".", "input_keys", "=", "[", "\"agent_position\"", ",", "\"target_position\"", ",", "\"agent_direction\"", "]", "\n", "self", ".", "input_keys_to_pad", "=", "[", "\"input_tensor\"", "]", "\n", "self", ".", "target_keys", "=", "[", "]", "\n", "self", ".", "target_keys_to_pad", "=", "[", "\"planner_target_tensor\"", "]", "\n", "self", ".", "sequence_decoder", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.PlannerModel.get_predictions": [[1103, 1105], ["Modularity.predict.predict_sequence"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_sequence"], ["", "def", "get_predictions", "(", "self", ",", "batch", ",", "max_decoding_steps", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "predict_sequence", "(", "self", ",", "batch", ",", "max_decoding_steps", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.PlannerModel.get_metrics": [[1106, 1119], ["modules.PlannerModel.get_exact_match"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.get_exact_match"], ["", "def", "get_metrics", "(", "self", ",", "planner_target_tensor_scores", ":", "torch", ".", "Tensor", ",", "planner_target_tensor_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "float", "]", ":", "\n", "        ", "\"\"\"\n        :param planner_target_tensor_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param planner_target_tensor_targets:  ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar float of accuracy averaged over sequence length and batch size.\n        \"\"\"", "\n", "accuracy", ",", "exact_match", "=", "self", ".", "get_exact_match", "(", "scores", "=", "planner_target_tensor_scores", ",", "\n", "targets", "=", "planner_target_tensor_targets", ")", "\n", "return", "{", "\n", "\"planner_target_tensor_accuracy\"", ":", "accuracy", ",", "\n", "\"planner_target_tensor_exact_match\"", ":", "exact_match", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.PlannerModel.get_loss": [[1121, 1130], ["modules.PlannerModel.get_sequence_loss"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.get_sequence_loss"], ["", "def", "get_loss", "(", "self", ",", "planner_target_tensor_scores", ":", "torch", ".", "Tensor", ",", "planner_target_tensor_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "\"\"\"\n        :param planner_target_tensor_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param planner_target_tensor_targets: ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar negative log-likelihood loss averaged over the sequence length and batch size.\n        \"\"\"", "\n", "return", "self", ".", "get_sequence_loss", "(", "planner_target_tensor_scores", ",", "planner_target_tensor_targets", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.PlannerModel.prepare_encoder_output_decoder": [[1131, 1168], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "modules.PlannerModel.tanh", "modules.PlannerModel.decoder_module_dict[].initialize_hidden", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "modules.PlannerModel.tanh", "modules.PlannerModel.decoder_module_dict[].initialize_hidden", "modules.PlannerModel.encoder_hiddens_to_initial_hidden", "[].transpose", "modules.PlannerModel.encoder_hiddens_to_initial_hidden"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.initialize_hidden", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.initialize_hidden"], ["", "def", "prepare_encoder_output_decoder", "(", "self", ",", "encoder_output", ":", "Dict", "[", "str", ",", "Union", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", ",", "tuple", "]", "]", ")", ":", "\n", "        ", "if", "not", "self", ".", "simplified_architecture", ":", "\n", "            ", "hidden_state_input_tensor", "=", "encoder_output", "[", "\"input_tensor\"", "]", "[", "0", "]", "\n", "if", "self", ".", "use_attention", ":", "\n", "                ", "attention_values", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"encoder_outputs\"", "]", "\n", "attention_values_lengths", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"sequence_lengths\"", "]", "\n", "", "else", ":", "\n", "                ", "attention_values", "=", "None", "\n", "attention_values_lengths", "=", "None", "\n", "", "encoded_positions", "=", "encoder_output", "[", "\"mlp\"", "]", "\n", "initial_hidden", "=", "torch", ".", "cat", "(", "[", "hidden_state_input_tensor", ",", "\n", "encoded_positions", "]", ",", "dim", "=", "1", ")", "\n", "initial_hidden", "=", "self", ".", "tanh", "(", "self", ".", "encoder_hiddens_to_initial_hidden", "(", "initial_hidden", ")", ")", "\n", "target_key", "=", "self", ".", "target_keys_to_pad", "[", "0", "]", "\n", "initial_hidden", "=", "self", ".", "decoder_module_dict", "[", "target_key", "]", ".", "initialize_hidden", "(", "\n", "initial_hidden", ")", "\n", "", "else", ":", "\n", "            ", "hidden_state_input_tensor", "=", "encoder_output", "[", "\"input_tensor\"", "]", "[", "0", "]", "\n", "if", "not", "self", ".", "use_attention", ":", "\n", "                ", "attention_values", "=", "None", "\n", "attention_values_lengths", "=", "None", "\n", "", "else", ":", "\n", "                ", "attention_values", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"encoder_outputs\"", "]", ".", "transpose", "(", "0", ",", "1", ")", "\n", "attention_values_lengths", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"sequence_lengths\"", "]", "\n", "", "encoded_positions", "=", "encoder_output", "[", "\"mlp\"", "]", "\n", "initial_hidden", "=", "torch", ".", "cat", "(", "[", "hidden_state_input_tensor", ",", "\n", "encoded_positions", "]", ",", "dim", "=", "1", ")", "\n", "initial_hidden", "=", "self", ".", "tanh", "(", "self", ".", "encoder_hiddens_to_initial_hidden", "(", "initial_hidden", ")", ")", "\n", "target_key", "=", "self", ".", "target_keys_to_pad", "[", "0", "]", "\n", "initial_hidden", "=", "self", ".", "decoder_module_dict", "[", "target_key", "]", ".", "initialize_hidden", "(", "\n", "initial_hidden", ")", "\n", "", "return", "{", "\"hidden\"", ":", "initial_hidden", ",", "\n", "\"attention_keys\"", ":", "attention_values", ",", "\n", "\"attention_values\"", ":", "attention_values", ",", "\n", "\"attention_values_lengths\"", ":", "attention_values_lengths", ",", "\n", "\"conditional_attention_values\"", ":", "None", ",", "\n", "\"conditional_attention_values_lengths\"", ":", "None", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.PlannerModel.forward": [[1169, 1177], ["modules.PlannerModel.encode_input", "modules.PlannerModel.decode_input_batched", "decoder_output[].transpose"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.encode_input", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.decode_input_batched"], ["", "def", "forward", "(", "self", ",", "batch", ",", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "encoder_output", "=", "self", ".", "encode_input", "(", "batch", "[", "\"inputs\"", "]", ")", "\n", "decoder_output", "=", "self", ".", "decode_input_batched", "(", "batch", "[", "\"targets\"", "]", ",", "encoder_output", ")", "\n", "# decoder_output: [max_target_length, batch_size, output_size]", "\n", "# attention_weights: [batch_size, max_target_length, max_input_length]", "\n", "return", "{", "\n", "\"planner_target_tensor_scores\"", ":", "decoder_output", "[", "\"decoder_output_batched\"", "]", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "\"decoder_attention_weights\"", ":", "decoder_output", "[", "\"attention_weights\"", "]", ",", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.DummyPlannerModel.__init__": [[1182, 1278], ["modules.SuperModule.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Tanh", "torch.Tanh", "torch.Tanh", "Modularity.nn.LearnedAttention"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input_vocabulary_size", ":", "int", ",", "embedding_dimension", ":", "int", ",", "encoder_hidden_size", ":", "int", ",", "\n", "num_encoder_layers", ":", "int", ",", "encoder_dropout_p", ":", "float", ",", "encoder_bidirectional", ":", "bool", ",", "input_padding_idx", ":", "int", ",", "\n", "output_directory", ":", "str", ",", "decoder_hidden_size", ":", "int", ",", "planner_target_pad_idx", ":", "int", ",", "\n", "planner_target_sos_idx", ":", "int", ",", "planner_target_vocabulary_size", ":", "int", ",", "num_decoder_layers", ":", "int", ",", "\n", "decoder_dropout_p", ":", "float", ",", "planner_target_eos_idx", ":", "int", ",", "simplified_architecture", ":", "bool", ",", "\n", "use_attention", ":", "bool", ",", "use_conditional_attention", ":", "bool", ",", "type_attention", ":", "str", ",", "attention_values_key", ":", "str", ",", "\n", "conditional_attention_values_key", ":", "str", ",", "grid_size", ":", "int", ",", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "simplified_architecture", "=", "simplified_architecture", "\n", "assert", "type_attention", "in", "[", "\"bahdanau\"", ",", "\"luong\"", "]", ",", "\"Unknown type_attention=%s. Options are 'bahdanau', 'luong'\"", "\n", "assert", "not", "use_conditional_attention", ",", "\"Cannot use conditional attention in DummyPlannerModel.\"", "\n", "if", "not", "simplified_architecture", ":", "\n", "            ", "self", ".", "input_specs", "=", "{", "\n", "\"input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"sequence\"", ",", "\n", "\"input_vocabulary_size\"", ":", "input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "input_padding_idx", "\n", "}", ",", "\n", "\"agent_position\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", ",", "\n", "\"target_position\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", ",", "\n", "\"agent_direction\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", "\n", "}", "\n", "self", ".", "target_specs", "=", "{", "\n", "\"dummy_planner_target\"", ":", "{", "\n", "\"output_type\"", ":", "\"mlp\"", ",", "\n", "\"hidden_size\"", ":", "encoder_hidden_size", ",", "\n", "\"output_size\"", ":", "7", "\n", "}", "\n", "}", "\n", "", "else", ":", "\n", "            ", "self", ".", "input_specs", "=", "{", "\n", "\"input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"bow\"", ",", "\n", "\"input_vocabulary_size\"", ":", "input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "input_padding_idx", "\n", "}", ",", "\n", "\"agent_position\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", ",", "\n", "\"target_position\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", ",", "\n", "\"agent_direction\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", "\n", "}", "\n", "self", ".", "target_specs", "=", "{", "\n", "\"dummy_planner_target\"", ":", "{", "\n", "\"output_type\"", ":", "\"mlp\"", ",", "\n", "\"hidden_size\"", ":", "encoder_hidden_size", ",", "\n", "\"output_size\"", ":", "7", "\n", "}", "\n", "}", "\n", "", "metric", "=", "\"exact match\"", "\n", "self", ".", "attention_values_key", "=", "attention_values_key", "\n", "self", ".", "conditional_attention_values_key", "=", "conditional_attention_values_key", "\n", "\n", "self", ".", "input_keys", "=", "[", "\"agent_position\"", ",", "\"target_position\"", ",", "\"agent_direction\"", "]", "\n", "self", ".", "input_keys_to_pad", "=", "[", "\"input_tensor\"", "]", "\n", "self", ".", "target_keys", "=", "[", "\"dummy_planner_target\"", "]", "\n", "self", ".", "target_keys_to_pad", "=", "[", "]", "\n", "self", ".", "sequence_decoder", "=", "False", "\n", "self", ".", "use_attention", "=", "use_attention", "\n", "\n", "super", "(", ")", ".", "__init__", "(", "input_specs", "=", "self", ".", "input_specs", ",", "target_specs", "=", "self", ".", "target_specs", ",", "metric", "=", "metric", ",", "\n", "embedding_dimension", "=", "embedding_dimension", ",", "encoder_hidden_size", "=", "encoder_hidden_size", ",", "\n", "num_encoder_layers", "=", "num_encoder_layers", ",", "encoder_dropout_p", "=", "encoder_dropout_p", ",", "\n", "encoder_bidirectional", "=", "encoder_bidirectional", ",", "output_directory", "=", "output_directory", ",", "\n", "decoder_hidden_size", "=", "decoder_hidden_size", ",", "num_decoder_layers", "=", "num_decoder_layers", ",", "\n", "decoder_dropout_p", "=", "decoder_dropout_p", ")", "\n", "\n", "if", "self", ".", "simplified_architecture", ":", "\n", "            ", "self", ".", "attention", "=", "LearnedAttention", "(", "key_size", "=", "encoder_hidden_size", ",", "\n", "query_size", "=", "encoder_hidden_size", ",", "\n", "hidden_size", "=", "decoder_hidden_size", ")", "\n", "\n", "# Used to project the final encoder state to the decoder hidden state such that it can be initialized with it.", "\n", "", "self", ".", "encoder_hiddens_to_initial_hidden", "=", "nn", ".", "Linear", "(", "encoder_hidden_size", "*", "2", ",", "decoder_hidden_size", ")", "\n", "\n", "self", ".", "tanh", "=", "nn", ".", "Tanh", "(", ")", "\n", "self", ".", "output_directory", "=", "output_directory", "\n", "self", ".", "trained_iterations", "=", "0", "\n", "self", ".", "best_iteration", "=", "0", "\n", "self", ".", "best_metric", "=", "0", "\n", "self", ".", "metric", "=", "\"exact match\"", "\n", "\n", "self", ".", "input_keys", "=", "[", "\"agent_position\"", ",", "\"target_position\"", ",", "\"agent_direction\"", "]", "\n", "self", ".", "input_keys_to_pad", "=", "[", "\"input_tensor\"", "]", "\n", "self", ".", "target_keys", "=", "[", "\"dummy_planner_target\"", "]", "\n", "self", ".", "target_keys_to_pad", "=", "[", "]", "\n", "self", ".", "sequence_decoder", "=", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.DummyPlannerModel.get_predictions": [[1279, 1281], ["Modularity.predict.predict_sequence"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_sequence"], ["", "def", "get_predictions", "(", "self", ",", "batch", ",", "max_decoding_steps", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "predict_sequence", "(", "self", ",", "batch", ",", "max_decoding_steps", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.DummyPlannerModel.get_metrics": [[1282, 1294], ["modules.DummyPlannerModel.get_single_accuracy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_single_accuracy"], ["", "def", "get_metrics", "(", "self", ",", "dummy_planner_target_scores", ":", "torch", ".", "Tensor", ",", "dummy_planner_target_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "float", "]", ":", "\n", "        ", "\"\"\"\n        :param dummy_planner_target_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param dummy_planner_target_targets:  ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar float of accuracy averaged over sequence length and batch size.\n        \"\"\"", "\n", "accuracy", "=", "self", ".", "get_single_accuracy", "(", "target_scores", "=", "dummy_planner_target_scores", ",", "\n", "targets", "=", "dummy_planner_target_targets", ")", "\n", "return", "{", "\n", "\"dummy_planner_target_accuracy\"", ":", "accuracy", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.DummyPlannerModel.get_loss": [[1296, 1305], ["modules.DummyPlannerModel.get_single_loss"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_single_loss"], ["", "def", "get_loss", "(", "self", ",", "dummy_planner_target_scores", ":", "torch", ".", "Tensor", ",", "dummy_planner_target_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "\"\"\"\n        :param dummy_planner_target_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param dummy_planner_target_targets: ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar negative log-likelihood loss averaged over the sequence length and batch size.\n        \"\"\"", "\n", "return", "self", ".", "get_single_loss", "(", "dummy_planner_target_scores", ",", "dummy_planner_target_targets", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.DummyPlannerModel.prepare_encoder_output_decoder": [[1306, 1329], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "modules.DummyPlannerModel.tanh", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "modules.DummyPlannerModel.tanh", "modules.DummyPlannerModel.encoder_hiddens_to_initial_hidden", "modules.DummyPlannerModel.encoder_hiddens_to_initial_hidden"], "methods", ["None"], ["", "def", "prepare_encoder_output_decoder", "(", "self", ",", "encoder_output", ":", "Dict", "[", "str", ",", "Union", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", ",", "tuple", "]", "]", ")", ":", "\n", "        ", "if", "not", "self", ".", "simplified_architecture", ":", "\n", "            ", "hidden_state_input_tensor", "=", "encoder_output", "[", "\"input_tensor\"", "]", "[", "0", "]", "\n", "attention_values", "=", "None", "\n", "attention_values_lengths", "=", "None", "\n", "encoded_positions", "=", "encoder_output", "[", "\"mlp\"", "]", "\n", "initial_hidden", "=", "torch", ".", "cat", "(", "[", "hidden_state_input_tensor", ",", "\n", "encoded_positions", "]", ",", "dim", "=", "1", ")", "\n", "initial_hidden", "=", "self", ".", "tanh", "(", "self", ".", "encoder_hiddens_to_initial_hidden", "(", "initial_hidden", ")", ")", "\n", "", "else", ":", "\n", "            ", "hidden_state_input_tensor", "=", "encoder_output", "[", "\"input_tensor\"", "]", "[", "0", "]", "\n", "attention_values", "=", "None", "\n", "attention_values_lengths", "=", "None", "\n", "encoded_positions", "=", "encoder_output", "[", "\"mlp\"", "]", "\n", "initial_hidden", "=", "torch", ".", "cat", "(", "[", "hidden_state_input_tensor", ",", "\n", "encoded_positions", "]", ",", "dim", "=", "1", ")", "\n", "initial_hidden", "=", "self", ".", "tanh", "(", "self", ".", "encoder_hiddens_to_initial_hidden", "(", "initial_hidden", ")", ")", "\n", "", "return", "{", "\"hidden\"", ":", "initial_hidden", ",", "\n", "\"attention_keys\"", ":", "attention_values", ",", "\n", "\"attention_values\"", ":", "attention_values", ",", "\n", "\"attention_values_lengths\"", ":", "attention_values_lengths", ",", "\n", "\"conditional_attention_values\"", ":", "None", ",", "\n", "\"conditional_attention_values_lengths\"", ":", "None", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.DummyPlannerModel.forward": [[1330, 1337], ["modules.DummyPlannerModel.encode_input", "modules.DummyPlannerModel.decode_input"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.encode_input", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.decode_input"], ["", "def", "forward", "(", "self", ",", "batch", ",", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "encoder_output", "=", "self", ".", "encode_input", "(", "batch", "[", "\"inputs\"", "]", ")", "\n", "decoder_output", "=", "self", ".", "decode_input", "(", "encoder_output", ")", "\n", "# decoder_output: [max_target_length, batch_size, output_size]", "\n", "# attention_weights: [batch_size, max_target_length, max_input_length]", "\n", "return", "{", "\n", "\"dummy_planner_target_scores\"", ":", "decoder_output", "[", "\"dummy_planner_target\"", "]", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.DummySequencePlannerModel.__init__": [[1342, 1450], ["modules.SuperModule.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Tanh", "torch.Tanh", "torch.Tanh", "Modularity.nn.LearnedAttention"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input_vocabulary_size", ":", "int", ",", "embedding_dimension", ":", "int", ",", "encoder_hidden_size", ":", "int", ",", "\n", "num_encoder_layers", ":", "int", ",", "encoder_dropout_p", ":", "float", ",", "encoder_bidirectional", ":", "bool", ",", "input_padding_idx", ":", "int", ",", "\n", "output_directory", ":", "str", ",", "decoder_hidden_size", ":", "int", ",", "planner_target_pad_idx", ":", "int", ",", "\n", "planner_target_sos_idx", ":", "int", ",", "planner_target_vocabulary_size", ":", "int", ",", "num_decoder_layers", ":", "int", ",", "\n", "decoder_dropout_p", ":", "float", ",", "planner_target_eos_idx", ":", "int", ",", "simplified_architecture", ":", "bool", ",", "\n", "use_attention", ":", "bool", ",", "use_conditional_attention", ":", "bool", ",", "type_attention", ":", "str", ",", "attention_values_key", ":", "str", ",", "\n", "conditional_attention_values_key", ":", "str", ",", "grid_size", ":", "int", ",", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "simplified_architecture", "=", "simplified_architecture", "\n", "assert", "type_attention", "in", "[", "\"bahdanau\"", ",", "\"luong\"", "]", ",", "\"Unknown type_attention=%s. Options are 'bahdanau', 'luong'\"", "\n", "assert", "not", "use_conditional_attention", ",", "\"Cannot use conditional attention in DummyPlannerModel.\"", "\n", "if", "not", "simplified_architecture", ":", "\n", "            ", "self", ".", "input_specs", "=", "{", "\n", "\"input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"sequence\"", ",", "\n", "\"input_vocabulary_size\"", ":", "input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "input_padding_idx", "\n", "}", ",", "\n", "\"agent_position\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", ",", "\n", "\"target_position\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", ",", "\n", "\"agent_direction\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", "\n", "}", "\n", "self", ".", "target_specs", "=", "{", "\n", "\"dummy_planner_target_tensor\"", ":", "{", "\n", "\"output_type\"", ":", "\"sequence\"", ",", "\n", "\"type_attention\"", ":", "type_attention", ",", "\n", "\"attention\"", ":", "use_attention", ",", "\n", "\"attention_values\"", ":", "\"input_tensor\"", ",", "\n", "\"conditional_attention\"", ":", "use_conditional_attention", ",", "\n", "\"target_vocabulary_size\"", ":", "planner_target_vocabulary_size", ",", "\n", "\"target_pad_idx\"", ":", "planner_target_pad_idx", ",", "\n", "\"target_eos_idx\"", ":", "planner_target_eos_idx", ",", "\n", "\"target_sos_idx\"", ":", "planner_target_sos_idx", "\n", "}", "\n", "}", "\n", "", "else", ":", "\n", "            ", "self", ".", "input_specs", "=", "{", "\n", "\"input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"bow\"", ",", "\n", "\"input_vocabulary_size\"", ":", "input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "input_padding_idx", "\n", "}", ",", "\n", "\"agent_position\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", ",", "\n", "\"target_position\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", ",", "\n", "\"agent_direction\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", "\n", "}", "\n", "self", ".", "target_specs", "=", "{", "\n", "\"dummy_planner_target_tensor\"", ":", "{", "\n", "\"output_type\"", ":", "\"sequence\"", ",", "\n", "\"type_attention\"", ":", "type_attention", ",", "\n", "\"attention\"", ":", "use_attention", ",", "\n", "\"attention_values\"", ":", "\"input_tensor\"", ",", "\n", "\"conditional_attention\"", ":", "use_conditional_attention", ",", "\n", "\"target_vocabulary_size\"", ":", "planner_target_vocabulary_size", ",", "\n", "\"target_pad_idx\"", ":", "planner_target_pad_idx", ",", "\n", "\"target_eos_idx\"", ":", "planner_target_eos_idx", ",", "\n", "\"target_sos_idx\"", ":", "planner_target_sos_idx", "\n", "}", "\n", "}", "\n", "", "metric", "=", "\"exact match\"", "\n", "self", ".", "attention_values_key", "=", "attention_values_key", "\n", "self", ".", "conditional_attention_values_key", "=", "conditional_attention_values_key", "\n", "\n", "self", ".", "input_keys", "=", "[", "\"agent_position\"", ",", "\"target_position\"", ",", "\"agent_direction\"", "]", "\n", "self", ".", "input_keys_to_pad", "=", "[", "\"input_tensor\"", "]", "\n", "self", ".", "target_keys", "=", "[", "]", "\n", "self", ".", "target_keys_to_pad", "=", "[", "\"dummy_planner_target_tensor\"", "]", "\n", "self", ".", "sequence_decoder", "=", "True", "\n", "self", ".", "use_attention", "=", "use_attention", "\n", "\n", "super", "(", ")", ".", "__init__", "(", "input_specs", "=", "self", ".", "input_specs", ",", "target_specs", "=", "self", ".", "target_specs", ",", "metric", "=", "metric", ",", "\n", "embedding_dimension", "=", "embedding_dimension", ",", "encoder_hidden_size", "=", "encoder_hidden_size", ",", "\n", "num_encoder_layers", "=", "num_encoder_layers", ",", "encoder_dropout_p", "=", "encoder_dropout_p", ",", "\n", "encoder_bidirectional", "=", "encoder_bidirectional", ",", "output_directory", "=", "output_directory", ",", "\n", "decoder_hidden_size", "=", "decoder_hidden_size", ",", "num_decoder_layers", "=", "num_decoder_layers", ",", "\n", "decoder_dropout_p", "=", "decoder_dropout_p", ")", "\n", "\n", "if", "self", ".", "simplified_architecture", ":", "\n", "            ", "self", ".", "attention", "=", "LearnedAttention", "(", "key_size", "=", "encoder_hidden_size", ",", "\n", "query_size", "=", "encoder_hidden_size", ",", "\n", "hidden_size", "=", "decoder_hidden_size", ")", "\n", "\n", "# Used to project the final encoder state to the decoder hidden state such that it can be initialized with it.", "\n", "", "self", ".", "encoder_hiddens_to_initial_hidden", "=", "nn", ".", "Linear", "(", "encoder_hidden_size", "*", "2", ",", "decoder_hidden_size", ")", "\n", "\n", "self", ".", "tanh", "=", "nn", ".", "Tanh", "(", ")", "\n", "self", ".", "output_directory", "=", "output_directory", "\n", "self", ".", "trained_iterations", "=", "0", "\n", "self", ".", "best_iteration", "=", "0", "\n", "self", ".", "best_metric", "=", "0", "\n", "self", ".", "metric", "=", "\"exact match\"", "\n", "\n", "self", ".", "input_keys", "=", "[", "\"agent_position\"", ",", "\"target_position\"", ",", "\"agent_direction\"", "]", "\n", "self", ".", "input_keys_to_pad", "=", "[", "\"input_tensor\"", "]", "\n", "self", ".", "target_keys", "=", "[", "]", "\n", "self", ".", "target_keys_to_pad", "=", "[", "\"dummy_planner_target_tensor\"", "]", "\n", "self", ".", "sequence_decoder", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.DummySequencePlannerModel.get_predictions": [[1451, 1453], ["Modularity.predict.predict_sequence"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_sequence"], ["", "def", "get_predictions", "(", "self", ",", "batch", ",", "max_decoding_steps", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "predict_sequence", "(", "self", ",", "batch", ",", "max_decoding_steps", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.DummySequencePlannerModel.get_metrics": [[1454, 1467], ["modules.DummySequencePlannerModel.get_exact_match"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.get_exact_match"], ["", "def", "get_metrics", "(", "self", ",", "dummy_planner_target_tensor_scores", ":", "torch", ".", "Tensor", ",", "dummy_planner_target_tensor_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "float", "]", ":", "\n", "        ", "\"\"\"\n        :param dummy_planner_target_tensor_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param dummy_planner_target_tensor_targets:  ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar float of accuracy averaged over sequence length and batch size.\n        \"\"\"", "\n", "accuracy", ",", "exact_match", "=", "self", ".", "get_exact_match", "(", "scores", "=", "dummy_planner_target_tensor_scores", ",", "\n", "targets", "=", "dummy_planner_target_tensor_targets", ")", "\n", "return", "{", "\n", "\"dummy_planner_target_tensor_accuracy\"", ":", "accuracy", ",", "\n", "\"dummy_planner_target_tensor_exact_match\"", ":", "exact_match", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.DummySequencePlannerModel.get_loss": [[1469, 1478], ["modules.DummySequencePlannerModel.get_sequence_loss"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.get_sequence_loss"], ["", "def", "get_loss", "(", "self", ",", "dummy_planner_target_tensor_scores", ":", "torch", ".", "Tensor", ",", "dummy_planner_target_tensor_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "\"\"\"\n        :param dummy_planner_target_tensor_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param dummy_planner_target_tensor_targets: ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar negative log-likelihood loss averaged over the sequence length and batch size.\n        \"\"\"", "\n", "return", "self", ".", "get_sequence_loss", "(", "dummy_planner_target_tensor_scores", ",", "dummy_planner_target_tensor_targets", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.DummySequencePlannerModel.prepare_encoder_output_decoder": [[1479, 1516], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "modules.DummySequencePlannerModel.tanh", "modules.DummySequencePlannerModel.decoder_module_dict[].initialize_hidden", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "modules.DummySequencePlannerModel.tanh", "modules.DummySequencePlannerModel.decoder_module_dict[].initialize_hidden", "modules.DummySequencePlannerModel.encoder_hiddens_to_initial_hidden", "[].transpose", "modules.DummySequencePlannerModel.encoder_hiddens_to_initial_hidden"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.initialize_hidden", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.initialize_hidden"], ["", "def", "prepare_encoder_output_decoder", "(", "self", ",", "encoder_output", ":", "Dict", "[", "str", ",", "Union", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", ",", "tuple", "]", "]", ")", ":", "\n", "        ", "if", "not", "self", ".", "simplified_architecture", ":", "\n", "            ", "hidden_state_input_tensor", "=", "encoder_output", "[", "\"input_tensor\"", "]", "[", "0", "]", "\n", "if", "not", "self", ".", "use_attention", ":", "\n", "                ", "attention_values", "=", "None", "\n", "attention_values_lengths", "=", "None", "\n", "", "else", ":", "\n", "                ", "attention_values", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"encoder_outputs\"", "]", "\n", "attention_values_lengths", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"sequence_lengths\"", "]", "\n", "", "encoded_positions", "=", "encoder_output", "[", "\"mlp\"", "]", "\n", "initial_hidden", "=", "torch", ".", "cat", "(", "[", "hidden_state_input_tensor", ",", "\n", "encoded_positions", "]", ",", "dim", "=", "1", ")", "\n", "initial_hidden", "=", "self", ".", "tanh", "(", "self", ".", "encoder_hiddens_to_initial_hidden", "(", "initial_hidden", ")", ")", "\n", "target_key", "=", "self", ".", "target_keys_to_pad", "[", "0", "]", "\n", "initial_hidden", "=", "self", ".", "decoder_module_dict", "[", "target_key", "]", ".", "initialize_hidden", "(", "\n", "initial_hidden", ")", "\n", "", "else", ":", "\n", "            ", "hidden_state_input_tensor", "=", "encoder_output", "[", "\"input_tensor\"", "]", "[", "0", "]", "\n", "if", "not", "self", ".", "use_attention", ":", "\n", "                ", "attention_values", "=", "None", "\n", "attention_values_lengths", "=", "None", "\n", "", "else", ":", "\n", "                ", "attention_values", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"encoder_outputs\"", "]", ".", "transpose", "(", "0", ",", "1", ")", "\n", "attention_values_lengths", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"sequence_lengths\"", "]", "\n", "", "encoded_positions", "=", "encoder_output", "[", "\"mlp\"", "]", "\n", "initial_hidden", "=", "torch", ".", "cat", "(", "[", "hidden_state_input_tensor", ",", "\n", "encoded_positions", "]", ",", "dim", "=", "1", ")", "\n", "initial_hidden", "=", "self", ".", "tanh", "(", "self", ".", "encoder_hiddens_to_initial_hidden", "(", "initial_hidden", ")", ")", "\n", "target_key", "=", "self", ".", "target_keys_to_pad", "[", "0", "]", "\n", "initial_hidden", "=", "self", ".", "decoder_module_dict", "[", "target_key", "]", ".", "initialize_hidden", "(", "\n", "initial_hidden", ")", "\n", "", "return", "{", "\"hidden\"", ":", "initial_hidden", ",", "\n", "\"attention_keys\"", ":", "attention_values", ",", "\n", "\"attention_values\"", ":", "attention_values", ",", "\n", "\"attention_values_lengths\"", ":", "attention_values_lengths", ",", "\n", "\"conditional_attention_values\"", ":", "None", ",", "\n", "\"conditional_attention_values_lengths\"", ":", "None", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.DummySequencePlannerModel.forward": [[1517, 1525], ["modules.DummySequencePlannerModel.encode_input", "modules.DummySequencePlannerModel.decode_input_batched", "decoder_output[].transpose"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.encode_input", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.decode_input_batched"], ["", "def", "forward", "(", "self", ",", "batch", ",", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "encoder_output", "=", "self", ".", "encode_input", "(", "batch", "[", "\"inputs\"", "]", ")", "\n", "decoder_output", "=", "self", ".", "decode_input_batched", "(", "batch", "[", "\"targets\"", "]", ",", "encoder_output", ")", "\n", "# decoder_output: [max_target_length, batch_size, output_size]", "\n", "# attention_weights: [batch_size, max_target_length, max_input_length]", "\n", "return", "{", "\n", "\"dummy_planner_target_tensor_scores\"", ":", "decoder_output", "[", "\"decoder_output_batched\"", "]", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "\"decoder_attention_weights\"", ":", "decoder_output", "[", "\"attention_weights\"", "]", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.PositionModel.__init__": [[1530, 1584], ["modules.SuperModule.__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input_vocabulary_size", ":", "int", ",", "embedding_dimension", ":", "int", ",", "encoder_hidden_size", ":", "int", ",", "\n", "num_encoder_layers", ":", "int", ",", "encoder_dropout_p", ":", "float", ",", "target_vocabulary", ":", "str", ",", "input_vocabulary", ":", "str", ",", "\n", "main_input_key", ":", "str", ",", "encoder_bidirectional", ":", "bool", ",", "num_cnn_channels", ":", "int", ",", "cnn_kernel_size", ":", "int", ",", "\n", "cnn_dropout_p", ":", "float", ",", "cnn_hidden_num_channels", ":", "int", ",", "input_padding_idx", ":", "int", ",", "\n", "output_directory", ":", "str", ",", "grid_size", ":", "int", ",", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "simplified_architecture", "=", "False", "\n", "self", ".", "input_specs", "=", "{", "\n", "\"world_state_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"grid\"", ",", "\n", "\"num_input_channels\"", ":", "num_cnn_channels", ",", "\n", "}", ",", "\n", "\"input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"sequence\"", ",", "\n", "\"input_vocabulary_size\"", ":", "input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "input_padding_idx", "\n", "}", "\n", "}", "\n", "self", ".", "target_specs", "=", "{", "\n", "\"agent_position\"", ":", "{", "\n", "\"output_type\"", ":", "\"attention_map\"", ",", "\n", "\"hidden_size\"", ":", "encoder_hidden_size", ",", "\n", "\"output_size\"", ":", "grid_size", "**", "2", "\n", "}", ",", "\n", "\"target_position\"", ":", "{", "\n", "\"output_type\"", ":", "\"attention_map\"", ",", "\n", "\"hidden_size\"", ":", "encoder_hidden_size", ",", "\n", "\"output_size\"", ":", "grid_size", "**", "2", "\n", "}", ",", "\n", "\"agent_direction\"", ":", "{", "\n", "\"output_type\"", ":", "\"attention_map_projection\"", ",", "\n", "\"hidden_size\"", ":", "encoder_hidden_size", ",", "\n", "\"output_size\"", ":", "4", "\n", "}", "\n", "}", "\n", "metric", "=", "\"accuracy\"", "\n", "\n", "self", ".", "input_keys", "=", "[", "\"world_state_tensor\"", "]", "\n", "self", ".", "input_keys_to_pad", "=", "[", "\"input_tensor\"", "]", "\n", "self", ".", "target_keys", "=", "[", "\"agent_position\"", ",", "\"target_position\"", ",", "\"agent_direction\"", "]", "\n", "self", ".", "target_keys_to_pad", "=", "[", "]", "\n", "self", ".", "sequence_decoder", "=", "False", "\n", "self", ".", "use_attention", "=", "False", "\n", "self", ".", "attention_values_key", "=", "\"\"", "\n", "self", ".", "conditional_attention_values_key", "=", "\"\"", "\n", "self", ".", "use_conditional_attention", "=", "False", "\n", "self", ".", "type_attention", "=", "\"\"", "\n", "\n", "super", "(", ")", ".", "__init__", "(", "input_specs", "=", "self", ".", "input_specs", ",", "target_specs", "=", "self", ".", "target_specs", ",", "metric", "=", "metric", ",", "\n", "embedding_dimension", "=", "embedding_dimension", ",", "encoder_hidden_size", "=", "encoder_hidden_size", ",", "\n", "num_encoder_layers", "=", "num_encoder_layers", ",", "encoder_dropout_p", "=", "encoder_dropout_p", ",", "\n", "encoder_bidirectional", "=", "encoder_bidirectional", ",", "output_directory", "=", "output_directory", ",", "\n", "cnn_kernel_size", "=", "cnn_kernel_size", ",", "cnn_dropout_p", "=", "cnn_dropout_p", ",", "input_vocabulary", "=", "input_vocabulary", ",", "\n", "target_vocabulary", "=", "target_vocabulary", ",", "cnn_hidden_num_channels", "=", "cnn_hidden_num_channels", ",", "\n", "grid_size", "=", "grid_size", ",", "main_input_key", "=", "main_input_key", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.PositionModel.get_predictions": [[1585, 1587], ["Modularity.predict.predict_step"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_step"], ["", "def", "get_predictions", "(", "self", ",", "batch", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "predict_step", "(", "self", ",", "batch", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.PositionModel.get_metrics": [[1588, 1597], ["modules.PositionModel.get_single_accuracy", "modules.PositionModel.get_single_accuracy", "modules.PositionModel.get_single_accuracy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_single_accuracy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_single_accuracy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_single_accuracy"], ["", "def", "get_metrics", "(", "self", ",", "agent_direction_scores", ":", "torch", ".", "Tensor", ",", "agent_position_scores", ":", "torch", ".", "Tensor", ",", "\n", "target_position_scores", ":", "torch", ".", "Tensor", ",", "agent_position_targets", ":", "torch", ".", "Tensor", ",", "\n", "agent_direction_targets", ":", "torch", ".", "Tensor", ",", "target_position_targets", ":", "torch", ".", "Tensor", ")", ":", "\n", "        ", "direction_accuracy", "=", "self", ".", "get_single_accuracy", "(", "agent_direction_scores", ",", "agent_direction_targets", ")", "\n", "agent_position_accuracy", "=", "self", ".", "get_single_accuracy", "(", "agent_position_scores", ",", "agent_position_targets", ")", "\n", "target_position_accuracy", "=", "self", ".", "get_single_accuracy", "(", "target_position_scores", ",", "target_position_targets", ")", "\n", "return", "{", "\"agent_direction_accuracy\"", ":", "direction_accuracy", ",", "\n", "\"agent_position_accuracy\"", ":", "agent_position_accuracy", ",", "\n", "\"target_position_accuracy\"", ":", "target_position_accuracy", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.PositionModel.get_loss": [[1598, 1605], ["modules.PositionModel.get_single_loss", "modules.PositionModel.get_single_loss", "modules.PositionModel.get_single_loss", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_single_loss", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_single_loss", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_single_loss"], ["", "def", "get_loss", "(", "self", ",", "agent_direction_scores", ":", "torch", ".", "Tensor", ",", "agent_position_scores", ":", "torch", ".", "Tensor", ",", "\n", "target_position_scores", ":", "torch", ".", "Tensor", ",", "agent_position_targets", ":", "torch", ".", "Tensor", ",", "\n", "agent_direction_targets", ":", "torch", ".", "Tensor", ",", "target_position_targets", ":", "torch", ".", "Tensor", ")", ":", "\n", "        ", "direction_loss", "=", "self", ".", "get_single_loss", "(", "agent_direction_scores", ",", "agent_direction_targets", ")", "\n", "agent_position_loss", "=", "self", ".", "get_single_loss", "(", "agent_position_scores", ",", "agent_position_targets", ")", "\n", "target_position_loss", "=", "self", ".", "get_single_loss", "(", "target_position_scores", ",", "target_position_targets", ")", "\n", "return", "torch", ".", "tensor", "(", "0.01", ",", "device", "=", "device", ")", "*", "direction_loss", "+", "torch", ".", "tensor", "(", "0.01", ",", "device", "=", "device", ")", "*", "agent_position_loss", "+", "torch", ".", "tensor", "(", "0.98", ",", "device", "=", "device", ")", "*", "target_position_loss", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.PositionModel.prepare_encoder_output_decoder": [[1606, 1616], ["None"], "methods", ["None"], ["", "def", "prepare_encoder_output_decoder", "(", "self", ",", "encoder_output", ":", "Dict", "[", "str", ",", "Union", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", ",", "tuple", "]", "]", ")", ":", "\n", "        ", "encoded_world_state", "=", "encoder_output", "[", "\"world_state_tensor\"", "]", "\n", "hidden_state_input_tensor", "=", "encoder_output", "[", "\"input_tensor\"", "]", "[", "0", "]", "\n", "return", "{", "\"hidden\"", ":", "hidden_state_input_tensor", ",", "\n", "\"world_state_tensor\"", ":", "encoded_world_state", ",", "\n", "\"attention_keys\"", ":", "None", ",", "\n", "\"attention_values\"", ":", "None", ",", "\n", "\"attention_values_lengths\"", ":", "None", ",", "\n", "\"conditional_attention_values\"", ":", "None", ",", "\n", "\"conditional_attention_values_lengths\"", ":", "None", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.PositionModel.forward": [[1617, 1623], ["modules.PositionModel.encode_input", "modules.PositionModel.decode_input", "decoder_output[].squeeze", "decoder_output[].squeeze", "decoder_output[].squeeze"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.encode_input", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.decode_input"], ["", "def", "forward", "(", "self", ",", "batch", ",", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "encoder_output", "=", "self", ".", "encode_input", "(", "batch", "[", "\"inputs\"", "]", ")", "\n", "decoder_output", "=", "self", ".", "decode_input", "(", "encoder_output", ")", "\n", "return", "{", "\"agent_direction_scores\"", ":", "decoder_output", "[", "\"agent_direction\"", "]", ".", "squeeze", "(", ")", ",", "\n", "\"agent_position_scores\"", ":", "decoder_output", "[", "\"agent_position\"", "]", ".", "squeeze", "(", ")", ",", "\n", "\"target_position_scores\"", ":", "decoder_output", "[", "\"target_position\"", "]", ".", "squeeze", "(", ")", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.AdverbTransform.__init__": [[1627, 1718], ["modules.SuperModule.__init__", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input_vocabulary_size", ":", "int", ",", "embedding_dimension", ":", "int", ",", "encoder_hidden_size", ":", "int", ",", "\n", "adverb_input_vocabulary_size", ":", "int", ",", "adverb_input_padding_idx", ":", "int", ",", "input_vocabulary", ":", "str", ",", "\n", "num_encoder_layers", ":", "int", ",", "encoder_dropout_p", ":", "float", ",", "encoder_bidirectional", ":", "bool", ",", "input_padding_idx", ":", "int", ",", "\n", "output_directory", ":", "str", ",", "decoder_hidden_size", ":", "int", ",", "adverb_target_pad_idx", ":", "int", ",", "main_input_key", ":", "str", ",", "\n", "adverb_target_sos_idx", ":", "int", ",", "adverb_target_vocabulary_size", ":", "int", ",", "num_decoder_layers", ":", "int", ",", "\n", "decoder_dropout_p", ":", "float", ",", "adverb_target_eos_idx", ":", "int", ",", "type_attention", ":", "str", ",", "simplified_architecture", ":", "bool", ",", "\n", "use_attention", ":", "bool", ",", "use_conditional_attention", ":", "bool", ",", "target_vocabulary", ":", "str", ",", "\n", "attention_values_key", ":", "str", ",", "conditional_attention_values_key", ":", "str", ",", "adverb_embedding_input_size", ":", "int", ",", "\n", "**", "kwargs", ")", ":", "\n", "        ", "assert", "type_attention", "in", "[", "\"bahdanau\"", ",", "\"luong\"", "]", ",", "\"Unknown type_attention=%s. Options are 'bahdanau', 'luong'\"", "\n", "self", ".", "simplified_architecture", "=", "simplified_architecture", "\n", "if", "not", "self", ".", "simplified_architecture", ":", "\n", "            ", "self", ".", "input_specs", "=", "{", "\n", "\"input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"sequence\"", ",", "\n", "\"input_vocabulary_size\"", ":", "input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "input_padding_idx", "\n", "}", ",", "\n", "\"adverb_input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"sequence\"", ",", "\n", "\"input_vocabulary_size\"", ":", "adverb_input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "adverb_input_padding_idx", "\n", "}", "\n", "}", "\n", "self", ".", "target_specs", "=", "{", "\n", "\"adverb_target_tensor\"", ":", "{", "\n", "\"output_type\"", ":", "\"sequence\"", ",", "\n", "\"attention\"", ":", "use_attention", ",", "\n", "\"type_attention\"", ":", "type_attention", ",", "\n", "\"conditional_attention\"", ":", "use_conditional_attention", ",", "\n", "\"target_vocabulary_size\"", ":", "adverb_target_vocabulary_size", ",", "\n", "\"target_pad_idx\"", ":", "adverb_target_pad_idx", ",", "\n", "\"target_eos_idx\"", ":", "adverb_target_eos_idx", ",", "\n", "\"target_sos_idx\"", ":", "adverb_target_sos_idx", "\n", "}", "\n", "}", "\n", "", "else", ":", "\n", "            ", "self", ".", "input_specs", "=", "{", "\n", "\"adverb_embedding\"", ":", "{", "\n", "\"data_type\"", ":", "\"embedding\"", ",", "\n", "\"input_vocabulary_size\"", ":", "adverb_embedding_input_size", ",", "\n", "\"input_padding_idx\"", ":", "None", "\n", "}", ",", "\n", "\"adverb_input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"sequence\"", ",", "\n", "\"input_vocabulary_size\"", ":", "adverb_input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "adverb_input_padding_idx", "\n", "}", "\n", "}", "\n", "self", ".", "target_specs", "=", "{", "\n", "\"adverb_target_tensor\"", ":", "{", "\n", "\"output_type\"", ":", "\"sequence\"", ",", "\n", "\"attention\"", ":", "use_attention", ",", "\n", "\"type_attention\"", ":", "type_attention", ",", "\n", "\"conditional_attention\"", ":", "use_conditional_attention", ",", "\n", "\"target_vocabulary_size\"", ":", "adverb_target_vocabulary_size", ",", "\n", "\"target_pad_idx\"", ":", "adverb_target_pad_idx", ",", "\n", "\"target_eos_idx\"", ":", "adverb_target_eos_idx", ",", "\n", "\"target_sos_idx\"", ":", "adverb_target_sos_idx", "\n", "}", "\n", "}", "\n", "", "metric", "=", "\"exact match\"", "\n", "self", ".", "attention_values_key", "=", "attention_values_key", "\n", "self", ".", "conditional_attention_values_key", "=", "conditional_attention_values_key", "\n", "\n", "if", "not", "self", ".", "simplified_architecture", ":", "\n", "            ", "self", ".", "input_keys", "=", "[", "]", "\n", "self", ".", "input_keys_to_pad", "=", "[", "\"input_tensor\"", ",", "\"adverb_input_tensor\"", "]", "\n", "", "else", ":", "\n", "            ", "self", ".", "input_keys", "=", "[", "\"adverb_embedding\"", "]", "\n", "self", ".", "input_keys_to_pad", "=", "[", "\"adverb_input_tensor\"", "]", "\n", "", "self", ".", "target_keys", "=", "[", "]", "\n", "self", ".", "target_keys_to_pad", "=", "[", "\"adverb_target_tensor\"", "]", "\n", "self", ".", "sequence_decoder", "=", "True", "\n", "self", ".", "use_attention", "=", "use_attention", "\n", "self", ".", "use_conditional_attention", "=", "use_conditional_attention", "\n", "self", ".", "type_attention", "=", "type_attention", "\n", "\n", "super", "(", ")", ".", "__init__", "(", "input_specs", "=", "self", ".", "input_specs", ",", "target_specs", "=", "self", ".", "target_specs", ",", "metric", "=", "metric", ",", "\n", "embedding_dimension", "=", "embedding_dimension", ",", "encoder_hidden_size", "=", "encoder_hidden_size", ",", "\n", "num_encoder_layers", "=", "num_encoder_layers", ",", "encoder_dropout_p", "=", "encoder_dropout_p", ",", "\n", "encoder_bidirectional", "=", "encoder_bidirectional", ",", "output_directory", "=", "output_directory", ",", "\n", "decoder_hidden_size", "=", "decoder_hidden_size", ",", "num_decoder_layers", "=", "num_decoder_layers", ",", "\n", "decoder_dropout_p", "=", "decoder_dropout_p", ",", "target_vocabulary", "=", "target_vocabulary", ",", "\n", "input_vocabulary", "=", "input_vocabulary", ",", "main_input_key", "=", "main_input_key", ")", "\n", "\n", "# Module specific combination parameters", "\n", "# self.encoder_hiddens_to_initial_hidden = nn.Linear(encoder_hidden_size * 2, decoder_hidden_size)", "\n", "# self.encoder_hiddens_to_initial_hidden = nn.Linear(encoder_hidden_size, decoder_hidden_size)", "\n", "if", "self", ".", "simplified_architecture", ":", "\n", "            ", "self", ".", "adverb_to_dec_hidden", "=", "nn", ".", "Linear", "(", "embedding_dimension", ",", "decoder_hidden_size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.AdverbTransform.get_predictions": [[1719, 1721], ["Modularity.predict.predict_sequence"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_sequence"], ["", "", "def", "get_predictions", "(", "self", ",", "batch", ",", "max_decoding_steps", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "predict_sequence", "(", "self", ",", "batch", ",", "max_decoding_steps", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.AdverbTransform.get_metrics": [[1722, 1735], ["modules.AdverbTransform.get_exact_match"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.get_exact_match"], ["", "def", "get_metrics", "(", "self", ",", "adverb_target_tensor_scores", ":", "torch", ".", "Tensor", ",", "adverb_target_tensor_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "float", "]", ":", "\n", "        ", "\"\"\"\n        :param adverb_target_tensor_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param adverb_target_tensor_targets:  ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar float of accuracy averaged over sequence length and batch size.\n        \"\"\"", "\n", "accuracy", ",", "exact_match", "=", "self", ".", "get_exact_match", "(", "scores", "=", "adverb_target_tensor_scores", ",", "\n", "targets", "=", "adverb_target_tensor_targets", ")", "\n", "return", "{", "\n", "\"adverb_target_tensor_accuracy\"", ":", "accuracy", ",", "\n", "\"adverb_target_tensor_exact_match\"", ":", "exact_match", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.AdverbTransform.get_loss": [[1737, 1746], ["modules.AdverbTransform.get_sequence_loss"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.get_sequence_loss"], ["", "def", "get_loss", "(", "self", ",", "adverb_target_tensor_scores", ":", "torch", ".", "Tensor", ",", "adverb_target_tensor_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "\"\"\"\n        :param adverb_target_tensor_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param adverb_target_tensor_targets: ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar negative log-likelihood loss averaged over the sequence length and batch size.\n        \"\"\"", "\n", "return", "self", ".", "get_sequence_loss", "(", "adverb_target_tensor_scores", ",", "adverb_target_tensor_targets", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.AdverbTransform.prepare_encoder_output_decoder": [[1747, 1789], ["modules.AdverbTransform.decoder_module_dict[].initialize_hidden", "modules.AdverbTransform.adverb_to_dec_hidden", "modules.AdverbTransform.decoder_module_dict[].initialize_hidden", "ValueError", "ValueError"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.initialize_hidden", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.initialize_hidden"], ["", "def", "prepare_encoder_output_decoder", "(", "self", ",", "encoder_output", ":", "Dict", "[", "str", ",", "Union", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", ",", "tuple", "]", "]", ")", ":", "\n", "        ", "if", "not", "self", ".", "simplified_architecture", ":", "\n", "            ", "hidden_state_input_tensor", "=", "encoder_output", "[", "\"input_tensor\"", "]", "[", "0", "]", "\n", "hidden_state_adverb_input_tensor", "=", "encoder_output", "[", "\"adverb_input_tensor\"", "]", "[", "0", "]", "\n", "if", "self", ".", "use_attention", ":", "\n", "                ", "attention_values", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"encoder_outputs\"", "]", "\n", "attention_values_lengths", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"sequence_lengths\"", "]", "\n", "", "else", ":", "\n", "                ", "raise", "ValueError", "(", "\"No attention in adverb transform is not a good model in AdverbTransform\"", ")", "\n", "attention_values", "=", "None", "\n", "attention_values_lengths", "=", "None", "\n", "", "if", "self", ".", "use_conditional_attention", ":", "\n", "                ", "conditional_attention_values", "=", "encoder_output", "[", "self", ".", "conditional_attention_values_key", "]", "[", "1", "]", "[", "\"encoder_outputs\"", "]", "\n", "conditional_attention_values_lengths", "=", "encoder_output", "[", "self", ".", "conditional_attention_values_key", "]", "[", "1", "]", "[", "\"sequence_lengths\"", "]", "\n", "", "else", ":", "\n", "                ", "conditional_attention_values", "=", "None", "\n", "conditional_attention_values_lengths", "=", "None", "\n", "# initial_hidden = torch.cat([hidden_state_input_tensor,", "\n", "#                             hidden_state_adverb_input_tensor], dim=1)", "\n", "", "initial_hidden", "=", "hidden_state_input_tensor", "\n", "# initial_hidden = self.tanh(self.encoder_hiddens_to_initial_hidden(initial_hidden))", "\n", "target_key", "=", "self", ".", "target_keys_to_pad", "[", "0", "]", "\n", "initial_hidden", "=", "self", ".", "decoder_module_dict", "[", "target_key", "]", ".", "initialize_hidden", "(", "\n", "initial_hidden", ")", "\n", "", "else", ":", "\n", "            ", "adverb_embedding", "=", "encoder_output", "[", "\"adverb_embedding\"", "]", "\n", "hidden_state_input_tensor", "=", "self", ".", "adverb_to_dec_hidden", "(", "adverb_embedding", ")", "\n", "if", "self", ".", "use_attention", ":", "\n", "                ", "attention_values", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"encoder_outputs\"", "]", "\n", "attention_values_lengths", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"sequence_lengths\"", "]", "\n", "", "else", ":", "\n", "                ", "raise", "ValueError", "(", "\"No attention in adverb transform is not a good model in AdverbTransform\"", ")", "\n", "", "initial_hidden", "=", "hidden_state_input_tensor", "\n", "target_key", "=", "self", ".", "target_keys_to_pad", "[", "0", "]", "\n", "initial_hidden", "=", "self", ".", "decoder_module_dict", "[", "target_key", "]", ".", "initialize_hidden", "(", "\n", "initial_hidden", ")", "\n", "", "return", "{", "\"hidden\"", ":", "initial_hidden", ",", "\n", "\"attention_keys\"", ":", "attention_values", ",", "\n", "\"attention_values\"", ":", "attention_values", ",", "\n", "\"attention_values_lengths\"", ":", "attention_values_lengths", ",", "\n", "\"conditional_attention_values\"", ":", "None", ",", "\n", "\"conditional_attention_values_lengths\"", ":", "None", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.AdverbTransform.forward": [[1790, 1799], ["modules.AdverbTransform.encode_input", "modules.AdverbTransform.decode_input_batched", "decoder_output[].transpose"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.encode_input", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.decode_input_batched"], ["", "def", "forward", "(", "self", ",", "batch", ",", "**", "kwargs", ")", "->", "Dict", "[", "\n", "str", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "encoder_output", "=", "self", ".", "encode_input", "(", "batch", "[", "\"inputs\"", "]", ")", "\n", "decoder_output", "=", "self", ".", "decode_input_batched", "(", "batch", "[", "\"targets\"", "]", ",", "encoder_output", ")", "\n", "# decoder_output_batched: [max_target_length, batch_size, output_size]", "\n", "# attention_weights: [batch_size, max_target_length, max_input_length]", "\n", "return", "{", "\n", "\"adverb_target_tensor_scores\"", ":", "decoder_output", "[", "\"decoder_output_batched\"", "]", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "\"decoder_attention_weights\"", ":", "decoder_output", "[", "\"attention_weights\"", "]", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.AloTransform.__init__": [[1804, 1860], ["modules.SuperModule.__init__", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "embedding_dimension", ":", "int", ",", "encoder_hidden_size", ":", "int", ",", "target_vocabulary", ":", "str", ",", "\n", "final_input_vocabulary_size", ":", "int", ",", "final_input_padding_idx", ":", "int", ",", "input_vocabulary", ":", "str", ",", "\n", "num_encoder_layers", ":", "int", ",", "encoder_dropout_p", ":", "float", ",", "encoder_bidirectional", ":", "bool", ",", "\n", "simplified_architecture", ":", "bool", ",", "input_vocabulary_size", ":", "int", ",", "input_padding_idx", ":", "int", ",", "\n", "output_directory", ":", "str", ",", "decoder_hidden_size", ":", "int", ",", "target_pad_idx", ":", "int", ",", "target_sos_idx", ":", "int", ",", "\n", "target_vocabulary_size", ":", "int", ",", "num_decoder_layers", ":", "int", ",", "decoder_dropout_p", ":", "float", ",", "target_eos_idx", ":", "int", ",", "\n", "type_attention", ":", "str", ",", "use_attention", ":", "bool", ",", "use_conditional_attention", ":", "bool", ",", "\n", "attention_values_key", ":", "str", ",", "conditional_attention_values_key", ":", "str", ",", "main_input_key", ":", "str", ",", "**", "kwargs", ")", ":", "\n", "        ", "self", ".", "simplified_architecture", "=", "simplified_architecture", "\n", "assert", "type_attention", "in", "[", "\"bahdanau\"", ",", "\"luong\"", "]", ",", "\"Unknown type_attention=%s. Options are 'bahdanau', 'luong'\"", "\n", "assert", "not", "use_conditional_attention", ",", "\"Cannot use conditional attention in AloTransform\"", "\n", "self", ".", "input_specs", "=", "{", "\n", "\"agent_direction\"", ":", "{", "\n", "\"data_type\"", ":", "\"int\"", ",", "\n", "}", ",", "\n", "\"final_input_tensor\"", ":", "{", "\n", "\"data_type\"", ":", "\"sequence\"", ",", "\n", "\"input_vocabulary_size\"", ":", "final_input_vocabulary_size", ",", "\n", "\"input_padding_idx\"", ":", "final_input_padding_idx", "\n", "}", "\n", "}", "\n", "self", ".", "target_specs", "=", "{", "\n", "\"target_tensor\"", ":", "{", "\n", "\"output_type\"", ":", "\"sequence\"", ",", "\n", "\"attention\"", ":", "use_attention", ",", "\n", "\"type_attention\"", ":", "type_attention", ",", "\n", "\"conditional_attention\"", ":", "use_conditional_attention", ",", "\n", "\"target_vocabulary_size\"", ":", "target_vocabulary_size", ",", "\n", "\"target_pad_idx\"", ":", "target_pad_idx", ",", "\n", "\"target_eos_idx\"", ":", "target_eos_idx", ",", "\n", "\"target_sos_idx\"", ":", "target_sos_idx", "\n", "}", "\n", "}", "\n", "metric", "=", "\"exact match\"", "\n", "self", ".", "attention_values_key", "=", "attention_values_key", "\n", "self", ".", "conditional_attention_values_key", "=", "conditional_attention_values_key", "\n", "\n", "self", ".", "input_keys", "=", "[", "\"agent_direction\"", "]", "\n", "self", ".", "input_keys_to_pad", "=", "[", "\"adverb_target_tensor\"", "]", "\n", "self", ".", "target_keys", "=", "[", "]", "\n", "self", ".", "target_keys_to_pad", "=", "[", "\"target_tensor\"", "]", "\n", "self", ".", "sequence_decoder", "=", "True", "\n", "self", ".", "use_attention", "=", "use_attention", "\n", "self", ".", "use_conditional_attention", "=", "use_conditional_attention", "\n", "self", ".", "type_attention", "=", "type_attention", "\n", "\n", "super", "(", ")", ".", "__init__", "(", "input_specs", "=", "self", ".", "input_specs", ",", "target_specs", "=", "self", ".", "target_specs", ",", "metric", "=", "metric", ",", "\n", "embedding_dimension", "=", "embedding_dimension", ",", "encoder_hidden_size", "=", "encoder_hidden_size", ",", "\n", "num_encoder_layers", "=", "num_encoder_layers", ",", "encoder_dropout_p", "=", "encoder_dropout_p", ",", "\n", "encoder_bidirectional", "=", "encoder_bidirectional", ",", "output_directory", "=", "output_directory", ",", "\n", "decoder_hidden_size", "=", "decoder_hidden_size", ",", "num_decoder_layers", "=", "num_decoder_layers", ",", "\n", "decoder_dropout_p", "=", "decoder_dropout_p", ",", "target_vocabulary", "=", "target_vocabulary", ",", "\n", "input_vocabulary", "=", "input_vocabulary", ",", "main_input_key", "=", "main_input_key", ")", "\n", "\n", "# Module specific combination parameters", "\n", "self", ".", "encoder_hiddens_to_initial_hidden", "=", "nn", ".", "Linear", "(", "encoder_hidden_size", "*", "2", ",", "decoder_hidden_size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.AloTransform.get_predictions": [[1861, 1863], ["Modularity.predict.predict_sequence"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_sequence"], ["", "def", "get_predictions", "(", "self", ",", "batch", ",", "max_decoding_steps", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "predict_sequence", "(", "self", ",", "batch", ",", "max_decoding_steps", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.AloTransform.get_metrics": [[1864, 1877], ["modules.AloTransform.get_exact_match"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.get_exact_match"], ["", "def", "get_metrics", "(", "self", ",", "target_tensor_scores", ":", "torch", ".", "Tensor", ",", "target_tensor_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "float", "]", ":", "\n", "        ", "\"\"\"\n        :param target_tensor_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param target_tensor_targets:  ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar float of accuracy averaged over sequence length and batch size.\n        \"\"\"", "\n", "accuracy", ",", "exact_match", "=", "self", ".", "get_exact_match", "(", "scores", "=", "target_tensor_scores", ",", "\n", "targets", "=", "target_tensor_targets", ")", "\n", "return", "{", "\n", "\"target_tensor_accuracy\"", ":", "accuracy", ",", "\n", "\"target_tensor_exact_match\"", ":", "exact_match", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.AloTransform.get_loss": [[1879, 1888], ["modules.AloTransform.get_sequence_loss"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.get_sequence_loss"], ["", "def", "get_loss", "(", "self", ",", "target_tensor_scores", ":", "torch", ".", "Tensor", ",", "target_tensor_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "\"\"\"\n        :param target_tensor_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param target_tensor_targets: ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar negative log-likelihood loss averaged over the sequence length and batch size.\n        \"\"\"", "\n", "return", "self", ".", "get_sequence_loss", "(", "target_tensor_scores", ",", "target_tensor_targets", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.AloTransform.prepare_encoder_output_decoder": [[1889, 1908], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "modules.AloTransform.tanh", "modules.AloTransform.decoder_module_dict[].initialize_hidden", "modules.AloTransform.encoder_hiddens_to_initial_hidden"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.initialize_hidden"], ["", "def", "prepare_encoder_output_decoder", "(", "self", ",", "encoder_output", ":", "Dict", "[", "str", ",", "Union", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", ",", "tuple", "]", "]", ")", ":", "\n", "\n", "        ", "hidden_state_adverb_target_tensor", "=", "encoder_output", "[", "\"final_input_tensor\"", "]", "[", "0", "]", "\n", "encoded_direction", "=", "encoder_output", "[", "\"mlp\"", "]", "\n", "if", "self", ".", "use_attention", ":", "\n", "            ", "attention_values", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"encoder_outputs\"", "]", "\n", "attention_values_lengths", "=", "encoder_output", "[", "self", ".", "attention_values_key", "]", "[", "1", "]", "[", "\"sequence_lengths\"", "]", "\n", "", "else", ":", "\n", "            ", "attention_values", "=", "None", "\n", "attention_values_lengths", "=", "None", "\n", "", "initial_hidden", "=", "torch", ".", "cat", "(", "[", "encoded_direction", ",", "hidden_state_adverb_target_tensor", "]", ",", "dim", "=", "1", ")", "\n", "initial_hidden", "=", "self", ".", "tanh", "(", "self", ".", "encoder_hiddens_to_initial_hidden", "(", "initial_hidden", ")", ")", "\n", "target_key", "=", "self", ".", "target_keys_to_pad", "[", "0", "]", "\n", "initial_hidden", "=", "self", ".", "decoder_module_dict", "[", "target_key", "]", ".", "initialize_hidden", "(", "\n", "initial_hidden", ")", "\n", "return", "{", "\"hidden\"", ":", "initial_hidden", ",", "\n", "\"attention_keys\"", ":", "attention_values", ",", "\n", "\"attention_values\"", ":", "attention_values", ",", "\n", "\"attention_values_lengths\"", ":", "attention_values_lengths", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.AloTransform.forward": [[1909, 1917], ["modules.AloTransform.encode_input", "modules.AloTransform.decode_input_batched", "decoder_output[].transpose"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.encode_input", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.decode_input_batched"], ["", "def", "forward", "(", "self", ",", "batch", ",", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "encoder_output", "=", "self", ".", "encode_input", "(", "batch", "[", "\"inputs\"", "]", ")", "\n", "decoder_output", "=", "self", ".", "decode_input_batched", "(", "batch", "[", "\"targets\"", "]", ",", "encoder_output", ")", "\n", "# decoder_output_batched: [max_target_length, batch_size, output_size]", "\n", "# attention_weights: [batch_size, max_target_length, max_input_length]", "\n", "return", "{", "\n", "\"target_tensor_scores\"", ":", "decoder_output", "[", "\"decoder_output_batched\"", "]", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "\"decoder_attention_weights\"", ":", "decoder_output", "[", "\"attention_weights\"", "]", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.FullModel.__init__": [[1924, 2084], ["torch.Module.__init__", "checkpoints_per_module[].items", "modules.PositionModel", "checkpoints_per_module[].items", "modules.PlannerModel", "checkpoints_per_module[].items", "modules.NewInteractionModel", "checkpoints_per_module[].items", "modules.AdverbTransform", "modules.FullModel.modules.items", "logger.info", "checkpoints_per_module[].items", "modules.AloTransform", "logger.info", "module.to.to.load_model", "module.to.to.to", "logger.info", "module_path_pattern.split", "os.path.join", "os.path.join", "modules.FullModel.modules.items", "modules.FullModel.modules.items", "modules.FullModel.modules.items", "modules.FullModel.modules.items", "int", "str"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.helpers.load_model"], ["def", "__init__", "(", "self", ",", "dataset", ",", "input_vocabulary", ":", "Vocabulary", ",", "num_cnn_channels", ":", "int", ",", "module_path_pattern", ":", "str", ",", "\n", "planner_target_vocabulary", ":", "Vocabulary", ",", "adverb_input_vocabulary", ":", "Vocabulary", ",", "\n", "adverb_target_vocabulary", ":", "Vocabulary", ",", "target_vocabulary", ":", "Vocabulary", ",", "checkpoints_per_module", ",", "\n", "collapse_alo", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "FullModel", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "dataset", "=", "dataset", "\n", "for", "key", ",", "value", "in", "checkpoints_per_module", "[", "\"position\"", "]", ".", "items", "(", ")", ":", "\n", "            ", "if", "key", "in", "kwargs", ":", "\n", "                ", "kwargs", "[", "key", "]", "=", "value", "\n", "", "", "kwargs", "[", "\"decoder_hidden_size\"", "]", "=", "kwargs", "[", "\"encoder_hidden_size\"", "]", "\n", "self", ".", "position_module", "=", "PositionModel", "(", "input_vocabulary_size", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"position\"", "]", "[", "\"input_tensor\"", "]", ".", "size", ",", "\n", "num_cnn_channels", "=", "num_cnn_channels", ",", "\n", "input_padding_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"position\"", "]", "[", "\"input_tensor\"", "]", ".", "pad_idx", ",", "\n", "target_vocabulary", "=", "\"\"", ",", "\n", "input_vocabulary", "=", "\"input\"", ",", "\n", "main_input_key", "=", "\"input_tensor\"", ",", "\n", "**", "kwargs", ")", "\n", "for", "key", ",", "value", "in", "checkpoints_per_module", "[", "\"planner\"", "]", ".", "items", "(", ")", ":", "\n", "            ", "if", "key", "in", "kwargs", ":", "\n", "                ", "kwargs", "[", "key", "]", "=", "value", "\n", "", "", "self", ".", "planner_module", "=", "PlannerModel", "(", "input_vocabulary_size", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"planner\"", "]", "[", "\"input_tensor\"", "]", ".", "size", ",", "\n", "input_padding_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"planner\"", "]", "[", "\"input_tensor\"", "]", ".", "pad_idx", ",", "\n", "planner_target_eos_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"planner\"", "]", "[", "\"planner_target_tensor\"", "]", ".", "eos_idx", ",", "\n", "planner_target_pad_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"planner\"", "]", "[", "\"planner_target_tensor\"", "]", ".", "pad_idx", ",", "\n", "planner_target_sos_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"planner\"", "]", "[", "\"planner_target_tensor\"", "]", ".", "sos_idx", ",", "\n", "planner_target_vocabulary_size", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"planner\"", "]", "[", "\"planner_target_tensor\"", "]", ".", "size", ",", "\n", "target_vocabulary", "=", "\"planner_target\"", ",", "\n", "input_vocabulary", "=", "\"input\"", ",", "\n", "main_input_key", "=", "\"input_tensor\"", ",", "\n", "**", "kwargs", ")", "\n", "for", "key", ",", "value", "in", "checkpoints_per_module", "[", "\"interaction\"", "]", ".", "items", "(", ")", ":", "\n", "            ", "if", "key", "in", "kwargs", ":", "\n", "                ", "kwargs", "[", "key", "]", "=", "value", "\n", "", "", "self", ".", "interaction_module", "=", "NewInteractionModel", "(", "input_vocabulary_size", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"interaction\"", "]", "[", "\"input_tensor\"", "]", ".", "size", ",", "\n", "transitive_input_vocabulary_size", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"planner\"", "]", "[", "\"planner_target_tensor\"", "]", ".", "size", ",", "\n", "transitive_input_padding_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"planner\"", "]", "[", "\"planner_target_tensor\"", "]", ".", "pad_idx", ",", "\n", "num_cnn_channels", "=", "num_cnn_channels", ",", "\n", "input_padding_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"interaction\"", "]", "[", "\"input_tensor\"", "]", ".", "pad_idx", ",", "\n", "transitive_target_eos_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"interaction\"", "]", "[", "\"transitive_target_tensor\"", "]", ".", "eos_idx", ",", "\n", "transitive_target_pad_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"interaction\"", "]", "[", "\"transitive_target_tensor\"", "]", ".", "pad_idx", ",", "\n", "transitive_target_sos_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"interaction\"", "]", "[", "\"transitive_target_tensor\"", "]", ".", "sos_idx", ",", "\n", "transitive_target_vocabulary_size", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"interaction\"", "]", "[", "\"transitive_target_tensor\"", "]", ".", "size", ",", "\n", "target_vocabulary", "=", "\"transitive_target\"", ",", "\n", "input_vocabulary", "=", "\"input\"", ",", "\n", "main_input_key", "=", "\"input_tensor\"", ",", "\n", "**", "kwargs", ")", "\n", "for", "key", ",", "value", "in", "checkpoints_per_module", "[", "\"adverb_transform\"", "]", ".", "items", "(", ")", ":", "\n", "            ", "logger", ".", "info", "(", "\"Key: %s, Value: %s\"", "%", "(", "key", ",", "value", ")", ")", "\n", "if", "key", "in", "kwargs", ":", "\n", "                ", "kwargs", "[", "key", "]", "=", "value", "\n", "", "", "kwargs", "[", "\"decoder_hidden_size\"", "]", "=", "kwargs", "[", "\"encoder_hidden_size\"", "]", "\n", "self", ".", "adverb_module", "=", "AdverbTransform", "(", "input_vocabulary_size", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"adverb_transform\"", "]", "[", "\"input_tensor\"", "]", ".", "size", ",", "\n", "adverb_embedding_input_size", "=", "kwargs", "[", "\"embedding_dimension\"", "]", ",", "\n", "adverb_input_vocabulary_size", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"adverb_transform\"", "]", "[", "\"adverb_input_tensor\"", "]", ".", "size", ",", "\n", "adverb_input_padding_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"adverb_transform\"", "]", "[", "\"adverb_input_tensor\"", "]", ".", "pad_idx", ",", "\n", "input_padding_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"adverb_transform\"", "]", "[", "\"input_tensor\"", "]", ".", "pad_idx", ",", "\n", "adverb_target_eos_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"adverb_transform\"", "]", "[", "\"adverb_target_tensor\"", "]", ".", "eos_idx", ",", "\n", "adverb_target_pad_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"adverb_transform\"", "]", "[", "\"adverb_target_tensor\"", "]", ".", "pad_idx", ",", "\n", "adverb_target_sos_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"adverb_transform\"", "]", "[", "\"adverb_target_tensor\"", "]", ".", "sos_idx", ",", "\n", "adverb_target_vocabulary_size", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"adverb_transform\"", "]", "[", "\"adverb_target_tensor\"", "]", ".", "size", ",", "\n", "target_vocabulary", "=", "\"adverb_target\"", ",", "\n", "input_vocabulary", "=", "\"adverb_input\"", ",", "\n", "main_input_key", "=", "\"adverb_input_tensor\"", ",", "\n", "**", "kwargs", ")", "\n", "self", ".", "collapse_alo", "=", "collapse_alo", "\n", "if", "not", "collapse_alo", ":", "\n", "            ", "for", "key", ",", "value", "in", "checkpoints_per_module", "[", "\"alo_transform\"", "]", ".", "items", "(", ")", ":", "\n", "                ", "if", "key", "in", "kwargs", ":", "\n", "                    ", "kwargs", "[", "key", "]", "=", "value", "\n", "", "", "kwargs", "[", "\"decoder_hidden_size\"", "]", "=", "kwargs", "[", "\"encoder_hidden_size\"", "]", "\n", "self", ".", "alo_transform", "=", "AloTransform", "(", "final_input_vocabulary_size", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"alo_transform\"", "]", "[", "\"adverb_target_tensor\"", "]", ".", "size", ",", "\n", "final_input_padding_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"alo_transform\"", "]", "[", "\"adverb_target_tensor\"", "]", ".", "pad_idx", ",", "\n", "target_eos_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"alo_transform\"", "]", "[", "\"target_tensor\"", "]", ".", "eos_idx", ",", "\n", "target_pad_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"alo_transform\"", "]", "[", "\"target_tensor\"", "]", ".", "pad_idx", ",", "\n", "target_sos_idx", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"alo_transform\"", "]", "[", "\"target_tensor\"", "]", ".", "sos_idx", ",", "\n", "target_vocabulary_size", "=", "self", ".", "dataset", ".", "full_vocabularies", "[", "\"alo_transform\"", "]", "[", "\"target_tensor\"", "]", ".", "size", ",", "\n", "target_vocabulary", "=", "\"target\"", ",", "\n", "input_vocabulary", "=", "\"adverb_target\"", ",", "\n", "main_input_key", "=", "\"final_input_tensor\"", ",", "\n", "**", "kwargs", ")", "\n", "\n", "", "self", ".", "modules", "=", "{", "\"position\"", ":", "self", ".", "position_module", ",", "\n", "\"planner\"", ":", "self", ".", "planner_module", ",", "\n", "\"interaction\"", ":", "self", ".", "interaction_module", ",", "\n", "\"adverb_transform\"", ":", "self", ".", "adverb_module", "}", "\n", "if", "not", "self", ".", "collapse_alo", ":", "\n", "            ", "self", ".", "modules", "[", "\"alo_transform\"", "]", "=", "self", ".", "alo_transform", "\n", "\n", "", "self", ".", "module_input_keys", "=", "{", "\"position\"", ":", "\"input_tensor\"", ",", "\n", "\"planner\"", ":", "\"input_tensor\"", ",", "\n", "\"interaction\"", ":", "\"transitive_input_tensor\"", ",", "\n", "\"adverb_transform\"", ":", "\"adverb_input_tensor\"", "}", "\n", "if", "not", "self", ".", "collapse_alo", ":", "\n", "            ", "self", ".", "module_input_keys", "[", "\"alo_transform\"", "]", "=", "\"final_input_tensor\"", "\n", "\n", "", "self", ".", "output_to_input_translate", "=", "{", "\n", "\"agent_direction\"", ":", "{", "\"new_input_key\"", ":", "\"agent_direction\"", ",", "\n", "\"prediction_module\"", ":", "\"position\"", ",", "\n", "\"prediction_key\"", ":", "\"agent_direction\"", ",", "\n", "\"concatenate\"", ":", "False", ",", "\n", "\"concatenate_with_module\"", ":", "\"\"", ",", "\n", "\"concatenate_with_key\"", ":", "\"\"", "}", ",", "\n", "\"agent_position\"", ":", "{", "\"new_input_key\"", ":", "\"agent_position\"", ",", "\n", "\"prediction_module\"", ":", "\"position\"", ",", "\n", "\"prediction_key\"", ":", "\"agent_position\"", ",", "\n", "\"concatenate\"", ":", "False", ",", "\n", "\"concatenate_with_module\"", ":", "\"\"", ",", "\n", "\"concatenate_with_key\"", ":", "\"\"", "}", ",", "\n", "\"target_position\"", ":", "{", "\"new_input_key\"", ":", "\"target_position\"", ",", "\n", "\"prediction_module\"", ":", "\"position\"", ",", "\n", "\"prediction_key\"", ":", "\"target_position\"", ",", "\n", "\"concatenate\"", ":", "False", ",", "\n", "\"concatenate_with_module\"", ":", "\"\"", ",", "\n", "\"concatenate_with_key\"", ":", "\"\"", "}", ",", "\n", "\"transitive_target_tensor\"", ":", "{", "\"new_input_key\"", ":", "\"adverb_input_tensor\"", ",", "\n", "\"prediction_module\"", ":", "\"planner\"", ",", "\n", "\"prediction_key\"", ":", "\"planner_target_tensor\"", ",", "\n", "\"concatenate\"", ":", "True", ",", "\n", "\"concatenate_with_module\"", ":", "\"interaction\"", ",", "\n", "\"concatenate_with_key\"", ":", "\"transitive_target_tensor\"", "}", ",", "\n", "\"transitive_target_tensor_lengths\"", ":", "\"adverb_input_tensor_lengths\"", ",", "\n", "\"adverb_target_tensor\"", ":", "{", "\"new_input_key\"", ":", "\"final_input_tensor\"", ",", "\n", "\"prediction_module\"", ":", "\"adverb_transform\"", ",", "\n", "\"prediction_key\"", ":", "\"adverb_target_tensor\"", ",", "\n", "\"concatenate\"", ":", "False", ",", "\n", "\"concatenate_with_module\"", ":", "\"\"", ",", "\n", "\"concatenate_with_key\"", ":", "\"\"", "}", ",", "\n", "\"adverb_target_tensor_lengths\"", ":", "\"final_input_tensor_lengths\"", ",", "\n", "\"planner_target_tensor\"", ":", "{", "\"new_input_key\"", ":", "\"target_position\"", ",", "\n", "\"prediction_module\"", ":", "\"position\"", ",", "\n", "\"prediction_key\"", ":", "\"target_position\"", ",", "\n", "\"concatenate\"", ":", "False", ",", "\n", "\"concatenate_with_module\"", ":", "\"\"", ",", "\n", "\"concatenate_with_key\"", ":", "\"\"", "}", ",", "\n", "\"planner_target_tensor_lengths\"", ":", "\"transitive_input_tensor_lengths\"", ",", "\n", "}", "\n", "\n", "for", "module_name", ",", "module", "in", "self", ".", "modules", ".", "items", "(", ")", ":", "\n", "            ", "if", "module_name", "!=", "\"adverb_transform\"", ":", "\n", "                ", "module_path_pattern_split", "=", "module_path_pattern", ".", "split", "(", "\"seed_\"", ")", "\n", "module_path_pattern_seed", "=", "int", "(", "module_path_pattern_split", "[", "-", "1", "]", ")", "%", "5", "\n", "if", "not", "module_path_pattern_seed", ":", "\n", "                    ", "module_path_pattern_seed", "=", "5", "\n", "", "adjusted_module_path_pattern", "=", "module_path_pattern_split", "[", "0", "]", "+", "\"seed_\"", "+", "str", "(", "module_path_pattern_seed", ")", "\n", "module_resume_from_file", "=", "os", ".", "path", ".", "join", "(", "adjusted_module_path_pattern", "%", "module_name", ",", "\"model_best.pth.tar\"", ")", "\n", "", "else", ":", "\n", "                ", "module_resume_from_file", "=", "os", ".", "path", ".", "join", "(", "module_path_pattern", "%", "module_name", ",", "\"model_best.pth.tar\"", ")", "\n", "", "logger", ".", "info", "(", "\"Loading checkpoint from file at '{}'\"", ".", "format", "(", "module_resume_from_file", ")", ")", "\n", "module", ".", "load_model", "(", "module_resume_from_file", ")", "\n", "module", "=", "module", ".", "to", "(", "device", ")", "\n", "start_iteration", "=", "module", ".", "trained_iterations", "\n", "logger", ".", "info", "(", "\"Loaded checkpoint '{}' (iter {})\"", ".", "format", "(", "module_resume_from_file", ",", "start_iteration", ")", ")", "\n", "self", ".", "modules", "[", "module_name", "]", "=", "module", "\n", "\n", "", "self", ".", "input_keys", "=", "{", "module_name", ":", "module", ".", "input_keys", "for", "module_name", ",", "module", "in", "self", ".", "modules", ".", "items", "(", ")", "}", "\n", "self", ".", "input_keys_to_pad", "=", "{", "module_name", ":", "module", ".", "input_keys_to_pad", "for", "module_name", ",", "module", "in", "self", ".", "modules", ".", "items", "(", ")", "}", "\n", "self", ".", "target_keys", "=", "{", "module_name", ":", "module", ".", "target_keys", "for", "module_name", ",", "module", "in", "self", ".", "modules", ".", "items", "(", ")", "}", "\n", "self", ".", "target_keys_to_pad", "=", "{", "module_name", ":", "module", ".", "target_keys_to_pad", "for", "module_name", ",", "module", "in", "self", ".", "modules", ".", "items", "(", ")", "}", "\n", "self", ".", "sequence_decoder", "=", "False", "\n", "self", ".", "full_model", "=", "True", "\n", "# self.sequence_decoders = {module_name: module.sequence_decoder for module_name, module in self.modules.items()}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.FullModel.translate_to_vocab": [[2086, 2092], ["modules.FullModel.dataset.array_to_sentence", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "sequence.squeeze", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "modules.FullModel.dataset.sentence_to_array"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.array_to_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array"], ["", "def", "translate_to_vocab", "(", "self", ",", "sequence", ",", "from_vocab", ":", "str", ",", "to_vocab", ":", "str", ",", "from_module", ":", "str", ",", "to_module", ":", "str", ")", ":", "\n", "        ", "dtype", "=", "sequence", ".", "dtype", "\n", "str_sequence", "=", "self", ".", "dataset", ".", "array_to_sentence", "(", "sequence", ".", "squeeze", "(", ")", ",", "vocabulary", "=", "from_vocab", ",", "module", "=", "from_module", ")", "\n", "return", "torch", ".", "tensor", "(", "self", ".", "dataset", ".", "sentence_to_array", "(", "str_sequence", "[", "1", ":", "-", "1", "]", ",", "vocabulary", "=", "to_vocab", ",", "\n", "module", "=", "to_module", ")", ",", "\n", "device", "=", "device", ",", "dtype", "=", "dtype", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.FullModel.is_special_ending_sequence": [[2093, 2101], ["torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.all", "torch.all", "torch.all", "torch.all", "torch.all", "torch.all", "torch.all", "torch.all", "torch.all"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "is_special_ending_sequence", "(", "sequence", ":", "torch", ".", "Tensor", ")", "->", "bool", ":", "\n", "# The output sequence a module should produce if it shouldn't change the input.", "\n", "        ", "special_ending_tokens", "=", "torch", ".", "tensor", "(", "[", "[", "1", ",", "2", "]", "]", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", "\n", "if", "sequence", ".", "shape", "==", "special_ending_tokens", ".", "shape", ":", "\n", "            ", "if", "torch", ".", "all", "(", "sequence", "==", "special_ending_tokens", ")", ":", "\n", "                ", "return", "True", "\n", "", "", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.FullModel.forward": [[2102, 2288], ["torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "copy.deepcopy", "modules.FullModel.modules.items", "predictions_per_target_key.items", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "Modularity.nn.get_exact_match", "predictions_per_target_key.items", "final_predictions.size", "torch.tensor().unsqueeze.size", "torch.tensor().unsqueeze.size", "torch.tensor().unsqueeze.size", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "final_predictions.size", "torch.tensor().unsqueeze.size", "torch.tensor().unsqueeze.size", "torch.tensor().unsqueeze.size", "full_accuracy.squeeze().item", "full_exact_match.squeeze().item", "modules.FullModel.translate_to_vocab", "modules.FullModel.translate_to_vocab", "module.get_predictions", "module.add_start_of_sequence", "len", "module.get_predictions", "module.get_predictions", "modules.FullModel.is_special_ending_sequence", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "len", "input_key_to_pad.split", "modules.FullModel.is_special_ending_sequence", "module.get_predictions", "preds[].unsqueeze", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "modules.FullModel.translate_to_vocab", "module.remove_start_of_sequence", "Modularity.nn.get_exact_match", "Modularity.nn.get_exact_match", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "len", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "modules.FullModel.dataset.sentence_to_array", "torch.tensor().unsqueeze.size", "torch.tensor().unsqueeze.size", "torch.tensor().unsqueeze.size", "full_accuracy.squeeze", "full_exact_match.squeeze", "[].keys", "modules.FullModel.translate_to_vocab", "torch.cat().unsqueeze", "torch.cat().unsqueeze", "torch.cat().unsqueeze", "torch.cat().unsqueeze", "torch.cat().unsqueeze", "torch.cat().unsqueeze", "torch.cat().unsqueeze", "torch.cat().unsqueeze", "torch.cat().unsqueeze", "modules.FullModel.translate_to_vocab", "target_name.split", "modules.FullModel.translate_to_vocab", "torch.tensor().unsqueeze.size", "torch.tensor().unsqueeze.size", "torch.tensor().unsqueeze.size", "final_predictions.size", "input_info[].split", "input_info[].split", "modules.FullModel.translate_to_vocab", "modules.FullModel.module_input_keys[].split", "modules.FullModel.module_input_keys[].split", "modules.FullModel.translate_to_vocab", "modules.FullModel.size", "float", "float", "float", "float", "input_info[].split", "input_info[].split", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "accuracy_per_sequence.item", "exact_match_per_sequence.item", "non_full_accuracy_per_sequence.item", "non_full_exact_match_per_sequence.item", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.get_exact_match", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.FullModel.translate_to_vocab", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.FullModel.translate_to_vocab", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.AloTransform.get_predictions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.SuperModule.add_start_of_sequence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.AloTransform.get_predictions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.AloTransform.get_predictions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.FullModel.is_special_ending_sequence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.FullModel.is_special_ending_sequence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.AloTransform.get_predictions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.FullModel.translate_to_vocab", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.remove_start_of_sequence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.get_exact_match", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.get_exact_match", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.FullModel.translate_to_vocab", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.FullModel.translate_to_vocab", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.FullModel.translate_to_vocab", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.FullModel.translate_to_vocab", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.modules.FullModel.translate_to_vocab", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "forward", "(", "self", ",", "batch", ",", "max_decoding_steps", ",", "gold_forward_pass", "=", "True", ",", "**", "kwargs", ")", ":", "\n", "\n", "# The output sequence a module should produce if it shouldn't change the input.", "\n", "        ", "special_ending_tokens", "=", "torch", ".", "tensor", "(", "[", "[", "1", ",", "2", "]", "]", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", "\n", "\n", "# Initialize some trackers", "\n", "previous_module", "=", "None", "\n", "all_predictions", "=", "{", "}", "\n", "predictions_per_target_key", "=", "{", "}", "\n", "final_predictions", "=", "None", "\n", "final_predictions_vocabulary", "=", "None", "\n", "final_predictions_module", "=", "None", "\n", "final_module", "=", "\"alo_transform\"", "if", "not", "self", ".", "collapse_alo", "else", "\"adverb_transform\"", "\n", "final_target_vocabulary", "=", "\"target\"", "if", "not", "self", ".", "collapse_alo", "else", "\"adverb_target\"", "\n", "\n", "# A running batch of examples that is updated with the predictions of the previous module for every new module.", "\n", "running_batch", "=", "copy", ".", "deepcopy", "(", "batch", ")", "\n", "\n", "# Loop over all the modules.", "\n", "for", "module_name", ",", "module", "in", "self", ".", "modules", ".", "items", "(", ")", ":", "\n", "\n", "# Translate the inputs from the master vocabulary to the module-specific vocabularies.", "\n", "            ", "for", "input_key_to_pad", "in", "self", ".", "input_keys_to_pad", "[", "module_name", "]", ":", "\n", "                ", "input_sequence", "=", "running_batch", "[", "module_name", "]", "[", "\"inputs\"", "]", "[", "input_key_to_pad", "]", "\n", "if", "not", "len", "(", "input_sequence", ")", ":", "\n", "                    ", "continue", "\n", "", "from_vocab", "=", "input_key_to_pad", ".", "split", "(", "\"_tensor\"", ")", "[", "0", "]", "\n", "to_vocab", "=", "from_vocab", "# The translation here is for the same vocabulary but between different modules.", "\n", "running_batch", "[", "module_name", "]", "[", "\"inputs\"", "]", "[", "input_key_to_pad", "]", "=", "self", ".", "translate_to_vocab", "(", "input_sequence", ",", "\n", "from_vocab", ",", "\n", "to_vocab", ",", "\n", "from_module", "=", "\"\"", ",", "\n", "to_module", "=", "module_name", ")", "\n", "original_input_sequence", "=", "batch", "[", "module_name", "]", "[", "\"inputs\"", "]", "[", "input_key_to_pad", "]", "\n", "batch", "[", "module_name", "]", "[", "\"inputs\"", "]", "[", "input_key_to_pad", "]", "=", "self", ".", "translate_to_vocab", "(", "original_input_sequence", ",", "\n", "from_vocab", ",", "\n", "to_vocab", ",", "\n", "from_module", "=", "\"\"", ",", "\n", "to_module", "=", "module_name", ")", "\n", "\n", "# Replace ground-truth input with predictions by previous module.", "\n", "", "for", "target_key", ",", "prediction", "in", "predictions_per_target_key", ".", "items", "(", ")", ":", "\n", "\n", "# Get the dict that specifies which inputs need to be translated from previous to next module.", "\n", "                ", "input_info", "=", "self", ".", "output_to_input_translate", "[", "target_key", "]", "\n", "if", "\"lengths\"", "not", "in", "target_key", ":", "# Only translate predictions and not length tensors.", "\n", "                    ", "assert", "input_info", "[", "\"new_input_key\"", "]", "in", "running_batch", "[", "module_name", "]", "[", "\"inputs\"", "]", ".", "keys", "(", ")", ",", "\"Input key %s not part of input batch for module %s\"", "%", "(", "input_info", "[", "\"new_input_key\"", "]", ",", "module_name", ")", "\n", "\n", "# If the previous module predicted special ending tokens, copy the input from the previous module.", "\n", "prediction", "=", "all_predictions", "[", "input_info", "[", "\"prediction_module\"", "]", "]", "[", "\"predictions\"", "]", "[", "input_info", "[", "\"prediction_key\"", "]", "]", "\n", "if", "\"_tensor\"", "in", "input_info", "[", "\"prediction_key\"", "]", ":", "\n", "                        ", "from_vocab", "=", "input_info", "[", "\"prediction_key\"", "]", ".", "split", "(", "\"_tensor\"", ")", "[", "0", "]", "\n", "to_vocab", "=", "input_info", "[", "\"new_input_key\"", "]", ".", "split", "(", "\"_tensor\"", ")", "[", "0", "]", "\n", "prediction", "=", "self", ".", "translate_to_vocab", "(", "prediction", ",", "from_vocab", ",", "to_vocab", ",", "\n", "from_module", "=", "input_info", "[", "\"prediction_module\"", "]", ",", "\n", "to_module", "=", "module_name", ")", "\n", "", "if", "input_info", "[", "\"concatenate\"", "]", ":", "# E.g., for the adverb module concat planner + interaction output", "\n", "                        ", "pred2", "=", "all_predictions", "[", "input_info", "[", "\"concatenate_with_module\"", "]", "]", "[", "\"predictions\"", "]", "[", "input_info", "[", "\"concatenate_with_key\"", "]", "]", "\n", "if", "\"_tensor\"", "in", "input_info", "[", "\"prediction_key\"", "]", ":", "\n", "                            ", "from_vocab", "=", "input_info", "[", "\"concatenate_with_key\"", "]", ".", "split", "(", "\"_tensor\"", ")", "[", "0", "]", "\n", "to_vocab", "=", "input_info", "[", "\"new_input_key\"", "]", ".", "split", "(", "\"_tensor\"", ")", "[", "0", "]", "\n", "pred2", "=", "self", ".", "translate_to_vocab", "(", "pred2", ",", "from_vocab", ",", "to_vocab", ",", "\n", "from_module", "=", "input_info", "[", "\"concatenate_with_module\"", "]", ",", "\n", "to_module", "=", "module_name", ")", "\n", "", "prediction", "=", "torch", ".", "cat", "(", "[", "prediction", "[", "0", ",", ":", "-", "1", "]", ",", "pred2", "[", "0", ",", "1", ":", "]", "]", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "# Concatenate without extra <SOS> and <EOS>", "\n", "", "if", "self", ".", "is_special_ending_sequence", "(", "prediction", ")", ":", "\n", "                        ", "prediction", "=", "running_batch", "[", "previous_module", "]", "[", "\"inputs\"", "]", "[", "self", ".", "module_input_keys", "[", "previous_module", "]", "]", "\n", "from_vocab", "=", "self", ".", "module_input_keys", "[", "previous_module", "]", ".", "split", "(", "\"_tensor\"", ")", "[", "0", "]", "\n", "to_vocab", "=", "self", ".", "module_input_keys", "[", "module_name", "]", ".", "split", "(", "\"_tensor\"", ")", "[", "0", "]", "\n", "prediction", "=", "self", ".", "translate_to_vocab", "(", "prediction", ",", "from_vocab", ",", "to_vocab", ",", "\n", "from_module", "=", "previous_module", ",", "\n", "to_module", "=", "module_name", ")", "\n", "", "else", ":", "\n", "                        ", "final_predictions", "=", "prediction", "\n", "final_predictions_vocabulary", "=", "to_vocab", "\n", "final_predictions_module", "=", "module_name", "\n", "if", "input_info", "[", "\"prediction_module\"", "]", "!=", "\"position\"", ":", "\n", "                            ", "final_predictions_translated", "=", "self", ".", "translate_to_vocab", "(", "prediction", ",", "to_vocab", ",", "final_target_vocabulary", ",", "\n", "from_module", "=", "module_name", ",", "\n", "to_module", "=", "final_module", ")", "\n", "", "", "running_batch", "[", "module_name", "]", "[", "\"inputs\"", "]", "[", "input_info", "[", "\"new_input_key\"", "]", "]", "=", "prediction", "\n", "if", "input_info", "[", "\"new_input_key\"", "]", "+", "\"_lengths\"", "in", "running_batch", "[", "module_name", "]", "[", "\"inputs\"", "]", ":", "\n", "                        ", "running_batch", "[", "module_name", "]", "[", "\"inputs\"", "]", "[", "input_info", "[", "\"new_input_key\"", "]", "+", "\"_lengths\"", "]", "=", "[", "prediction", ".", "size", "(", "1", ")", "]", "\n", "\n", "", "", "", "if", "module", ".", "sequence_decoder", ":", "\n", "                ", "predictions_batch", ",", "attn_w", "=", "module", ".", "get_predictions", "(", "running_batch", "[", "module_name", "]", ",", "max_decoding_steps", ")", "\n", "if", "gold_forward_pass", ":", "\n", "                    ", "ground_truth_input_predictions_batch", ",", "non_full_attn_w", "=", "module", ".", "get_predictions", "(", "batch", "[", "module_name", "]", ",", "\n", "max_decoding_steps", ")", "\n", "", "target_name", "=", "module", ".", "target_keys_to_pad", "[", "0", "]", "\n", "sequence_preds", "=", "predictions_batch", "[", "target_name", "+", "\"_sequences\"", "]", "\n", "sequence_pred_lengths", "=", "predictions_batch", "[", "target_name", "+", "\"_sequence_lengths\"", "]", "\n", "preds", "=", "module", ".", "add_start_of_sequence", "(", "sequence_preds", ")", "\n", "predictions_per_target_key", "=", "{", "\n", "target_name", ":", "preds", "[", "0", ",", ":", "(", "sequence_pred_lengths", "+", "1", ")", ".", "item", "(", ")", "]", ".", "unsqueeze", "(", "dim", "=", "0", ")", ",", "\n", "target_name", "+", "\"_lengths\"", ":", "(", "sequence_pred_lengths", "+", "1", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "}", "\n", "if", "gold_forward_pass", ":", "\n", "                    ", "non_full_sequence_preds", "=", "ground_truth_input_predictions_batch", "[", "target_name", "+", "\"_sequences\"", "]", "\n", "non_full_sequence_pred_lengths", "=", "ground_truth_input_predictions_batch", "[", "target_name", "+", "\"_sequence_lengths\"", "]", "\n", "", "target_lengths", "=", "torch", ".", "tensor", "(", "running_batch", "[", "module_name", "]", "[", "\"targets\"", "]", "[", "\"%s_lengths\"", "%", "target_name", "]", ",", "\n", "device", "=", "device", ",", "\n", "dtype", "=", "sequence_pred_lengths", ".", "dtype", ")", "-", "1", "# -1 because SOS gets removed", "\n", "original_targets", "=", "running_batch", "[", "module_name", "]", "[", "\"targets\"", "]", "[", "\"%s_targets\"", "%", "target_name", "]", "\n", "if", "len", "(", "original_targets", ")", ":", "\n", "                    ", "from_vocab", "=", "target_name", ".", "split", "(", "\"_tensor\"", ")", "[", "0", "]", "\n", "to_vocab", "=", "from_vocab", "\n", "translated_targets", "=", "self", ".", "translate_to_vocab", "(", "original_targets", ",", "\n", "from_vocab", ",", "\n", "to_vocab", ",", "\n", "from_module", "=", "\"\"", ",", "\n", "to_module", "=", "module_name", ")", "\n", "sequence_targets", "=", "module", ".", "remove_start_of_sequence", "(", "translated_targets", ")", "\n", "accuracy_per_sequence", ",", "exact_match_per_sequence", "=", "get_exact_match", "(", "sequence_preds", ",", "sequence_pred_lengths", ",", "\n", "sequence_targets", ",", "target_lengths", ")", "\n", "metrics", "=", "{", "target_name", ":", "{", "\"accuracy\"", ":", "float", "(", "accuracy_per_sequence", ".", "item", "(", ")", ")", ",", "\n", "\"exact_match\"", ":", "float", "(", "exact_match_per_sequence", ".", "item", "(", ")", ")", "}", "}", "\n", "", "if", "gold_forward_pass", ":", "\n", "                    ", "non_full_accuracy_per_sequence", ",", "non_full_exact_match_per_sequence", "=", "get_exact_match", "(", "\n", "non_full_sequence_preds", ",", "non_full_sequence_pred_lengths", ",", "sequence_targets", ",", "target_lengths", ")", "\n", "ground_truth_input_metrics", "=", "{", "\n", "target_name", ":", "{", "\"accuracy\"", ":", "float", "(", "non_full_accuracy_per_sequence", ".", "item", "(", ")", ")", ",", "\n", "\"exact_match\"", ":", "float", "(", "non_full_exact_match_per_sequence", ".", "item", "(", ")", ")", "}", "}", "\n", "", "", "else", ":", "\n", "                ", "predictions_batch", "=", "module", ".", "get_predictions", "(", "running_batch", "[", "module_name", "]", ")", "\n", "ground_truth_input_predictions_batch", "=", "module", ".", "get_predictions", "(", "batch", "[", "module_name", "]", ")", "\n", "metrics", "=", "{", "}", "\n", "ground_truth_input_metrics", "=", "{", "}", "\n", "for", "target_name", "in", "module", ".", "target_keys", ":", "\n", "                    ", "equal", "=", "torch", ".", "eq", "(", "running_batch", "[", "module_name", "]", "[", "\"targets\"", "]", "[", "\"%s_targets\"", "%", "target_name", "]", ".", "data", ",", "\n", "predictions_batch", "[", "target_name", "]", ".", "data", ")", ".", "long", "(", ")", ".", "sum", "(", ")", ".", "data", ".", "item", "(", ")", "\n", "total", "=", "len", "(", "\n", "running_batch", "[", "module_name", "]", "[", "\"targets\"", "]", "[", "\"%s_targets\"", "%", "target_name", "]", ")", "\n", "accuracy", "=", "(", "equal", "/", "total", ")", "*", "1.", "\n", "metrics", "[", "target_name", "]", "=", "accuracy", "\n", "ground_truth_input_equal", "=", "torch", ".", "eq", "(", "\n", "running_batch", "[", "module_name", "]", "[", "\"targets\"", "]", "[", "\"%s_targets\"", "%", "target_name", "]", ".", "data", ",", "\n", "ground_truth_input_predictions_batch", "[", "target_name", "]", ".", "data", ")", ".", "long", "(", ")", ".", "sum", "(", ")", ".", "data", ".", "item", "(", ")", "\n", "ground_truth_input_metrics", "[", "target_name", "]", "=", "(", "ground_truth_input_equal", "/", "total", ")", "*", "1.", "\n", "", "predictions_per_target_key", "=", "predictions_batch", "\n", "\n", "", "previous_module", "=", "module_name", "\n", "all_predictions", "[", "module_name", "]", "=", "{", "}", "\n", "all_predictions", "[", "module_name", "]", "[", "\"original_batch\"", "]", "=", "batch", "[", "module_name", "]", "\n", "all_predictions", "[", "module_name", "]", "[", "\"predictions\"", "]", "=", "predictions_per_target_key", "\n", "all_predictions", "[", "module_name", "]", "[", "\"metrics\"", "]", "=", "metrics", "\n", "all_predictions", "[", "module_name", "]", "[", "\"ground_truth_metrics\"", "]", "=", "ground_truth_input_metrics", "\n", "\n", "# Also update the final predictions for the last module", "\n", "", "for", "key", ",", "prediction", "in", "predictions_per_target_key", ".", "items", "(", ")", ":", "\n", "            ", "if", "\"lengths\"", "not", "in", "key", ":", "\n", "                ", "if", "self", ".", "is_special_ending_sequence", "(", "prediction", ")", ":", "\n", "                    ", "prediction", "=", "running_batch", "[", "previous_module", "]", "[", "\"inputs\"", "]", "[", "self", ".", "module_input_keys", "[", "previous_module", "]", "]", "\n", "", "else", ":", "\n", "                    ", "final_predictions", "=", "prediction", "\n", "final_predictions_vocabulary", "=", "\"target\"", "if", "not", "self", ".", "collapse_alo", "else", "\"adverb_target\"", "\n", "final_predictions_module", "=", "module_name", "\n", "if", "previous_module", "!=", "\"position\"", ":", "\n", "                        ", "final_predictions_translated", "=", "self", ".", "translate_to_vocab", "(", "prediction", ",", "to_vocab", ",", "\n", "final_target_vocabulary", ",", "\n", "from_module", "=", "module_name", ",", "\n", "to_module", "=", "final_module", ")", "\n", "\n", "", "", "", "", "final_targets", "=", "batch", "[", "\"position\"", "]", "[", "\"extra_information\"", "]", "[", "0", "]", "[", "\"example_information\"", "]", "[", "\"target_command\"", "]", "\n", "final_targets", "=", "torch", ".", "tensor", "(", "self", ".", "dataset", ".", "sentence_to_array", "(", "final_targets", ",", "final_predictions_vocabulary", ",", "\n", "final_predictions_module", ")", ",", "\n", "device", "=", "device", ",", "\n", "dtype", "=", "final_predictions", ".", "dtype", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "sequence_preds", "=", "final_predictions", "\n", "if", "final_predictions", ".", "size", "(", "-", "1", ")", "<", "final_targets", ".", "size", "(", "-", "1", ")", ":", "\n", "            ", "padding_preds", "=", "torch", ".", "zeros", "(", "[", "final_targets", ".", "size", "(", "0", ")", ",", "\n", "final_targets", ".", "size", "(", "-", "1", ")", "-", "final_predictions", ".", "size", "(", "-", "1", ")", "]", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", "\n", "sequence_preds", "=", "torch", ".", "cat", "(", "[", "sequence_preds", ",", "padding_preds", "]", ",", "dim", "=", "1", ")", "\n", "", "sequence_pred_lengths", "=", "torch", ".", "tensor", "(", "final_predictions", ".", "size", "(", "-", "1", ")", ",", "device", "=", "device", ",", "\n", "dtype", "=", "sequence_pred_lengths", ".", "dtype", ")", "\n", "target_lengths", "=", "torch", ".", "tensor", "(", "final_targets", ".", "size", "(", "-", "1", ")", ",", "device", "=", "device", ",", "\n", "dtype", "=", "sequence_pred_lengths", ".", "dtype", ")", "\n", "sequence_targets", "=", "final_targets", "\n", "full_accuracy", ",", "full_exact_match", "=", "get_exact_match", "(", "sequence_preds", ",", "sequence_pred_lengths", ",", "\n", "sequence_targets", ",", "target_lengths", ")", "\n", "full_prediction", "=", "sequence_preds", "\n", "full_target", "=", "sequence_targets", "\n", "return", "(", "all_predictions", ",", "full_accuracy", ".", "squeeze", "(", ")", ".", "item", "(", ")", ",", "full_exact_match", ".", "squeeze", "(", ")", ".", "item", "(", ")", ",", "full_prediction", ",", "\n", "full_target", ",", "final_predictions_vocabulary", ",", "final_predictions_module", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.train.train": [[16, 274], ["locals().copy", "torch.manual_seed", "logger.info", "Modularity.dataset.ModularDataset", "logger.info", "logger.info", "logger.info", "logger.info", "logger.info", "logger.info", "logger.info", "Modularity.dataset.ModularDataset", "Modularity.dataset.ModularDataset.shuffle_data", "logger.info", "Modularity.modules.AdverbTransform.to", "seq2seq.helpers.log_parameters", "torch.optim.Adam", "torch.optim.lr_scheduler.LambdaLR", "float", "logger.info", "logger.info", "torch.device", "torch.device", "Modularity.dataset.ModularDataset.save_vocabularies", "logger.info", "Modularity.modules.PositionModel", "os.path.isfile", "logger.info", "Modularity.modules.AdverbTransform.load_model", "torch.optim.Adam.load_state_dict", "logger.info", "Modularity.dataset.ModularDataset.shuffle_data", "Modularity.dataset.ModularDataset.get_data_iterator", "locals", "Modularity.dataset.ModularDataset.input_vocabulary.most_common", "Modularity.dataset.ModularDataset.target_vocabulary.most_common", "Modularity.modules.PlannerModel", "Modularity.modules.AdverbTransform.parameters", "Modularity.modules.AdverbTransform.train", "Modularity.modules.AdverbTransform.", "Modularity.modules.AdverbTransform.get_loss", "model.get_loss.backward", "torch.optim.Adam.step", "torch.optim.lr_scheduler.LambdaLR.step", "torch.optim.Adam.zero_grad", "Modularity.modules.AdverbTransform.update_state", "Modularity.modules.DummyPlannerModel", "Modularity.modules.AdverbTransform.get_metrics", "logger.info", "Modularity.modules.DummySequencePlannerModel", "torch.optim.lr_scheduler.LambdaLR.get_lr", "torch.no_grad", "Modularity.modules.AdverbTransform.eval", "logger.info", "logger.info", "Modularity.modules.NewInteractionModel", "Modularity.evaluate.evaluate", "Modularity.evaluate.evaluate", "sum", "len", "Modularity.modules.AdverbTransform.update_state", "str", "len", "Modularity.modules.AdverbTransform.save_checkpoint", "Modularity.modules.DummyInteractionModel", "model.get_metrics.items", "Modularity.dataset.ModularDataset.get_data_iterator", "Modularity.dataset.ModularDataset.get_data_iterator", "Modularity.evaluate.evaluate.values", "Modularity.modules.AdverbTransform.save_checkpoint", "Modularity.modules.AloTransform", "Modularity.evaluate.evaluate.items", "torch.optim.Adam.state_dict", "Modularity.modules.AdverbTransform", "NotImplementedError", "torch.optim.Adam.state_dict"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.shuffle_data", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.helpers.log_parameters", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.save_vocabularies", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.helpers.load_model", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.GroundedScanDataset.shuffle_data", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_data_iterator", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.most_common", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.most_common", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.train.train", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_loss", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.update_state", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_metrics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.evaluate.evaluate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.evaluate.evaluate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.update_state", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.save_checkpoint", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_data_iterator", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_data_iterator", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.save_checkpoint"], ["target_vocab_path", ":", "str", ",", "embedding_dimension", ":", "int", ",", "num_encoder_layers", ":", "int", ",", "encoder_dropout_p", ":", "float", ",", "\n", "encoder_bidirectional", ":", "bool", ",", "training_batch_size", ":", "int", ",", "test_batch_size", ":", "int", ",", "max_decoding_steps", ":", "int", ",", "\n", "num_decoder_layers", ":", "int", ",", "decoder_dropout_p", ":", "float", ",", "cnn_kernel_size", ":", "int", ",", "cnn_dropout_p", ":", "float", ",", "\n", "cnn_hidden_num_channels", ":", "int", ",", "simple_situation_representation", ":", "bool", ",", "decoder_hidden_size", ":", "int", ",", "\n", "encoder_hidden_size", ":", "int", ",", "learning_rate", ":", "float", ",", "adam_beta_1", ":", "float", ",", "adam_beta_2", ":", "float", ",", "lr_decay", ":", "float", ",", "\n", "lr_decay_steps", ":", "int", ",", "resume_from_file", ":", "str", ",", "max_training_iterations", ":", "int", ",", "output_directory", ":", "str", ",", "\n", "print_every", ":", "int", ",", "evaluate_every", ":", "int", ",", "conditional_attention", ":", "bool", ",", "auxiliary_task", ":", "bool", ",", "\n", "weight_target_loss", ":", "float", ",", "attention_type", ":", "str", ",", "k", ":", "int", ",", "max_training_examples", "=", "None", ",", "seed", "=", "42", ",", "**", "kwargs", ")", ":", "\n", "    ", "device", "=", "torch", ".", "device", "(", "type", "=", "'cuda'", ")", "if", "use_cuda", "else", "torch", ".", "device", "(", "type", "=", "'cpu'", ")", "\n", "cfg", "=", "locals", "(", ")", ".", "copy", "(", ")", "\n", "\n", "torch", ".", "manual_seed", "(", "seed", ")", "\n", "\n", "logger", ".", "info", "(", "\"Loading Training set...\"", ")", "\n", "training_set", "=", "GroundedScanDataset", "(", "data_path", ",", "data_directory", ",", "split", "=", "\"train\"", ",", "\n", "input_vocabulary_file", "=", "input_vocab_path", ",", "\n", "target_vocabulary_file", "=", "target_vocab_path", ",", "\n", "generate_vocabulary", "=", "generate_vocabularies", ",", "k", "=", "k", ")", "\n", "training_set", ".", "read_dataset", "(", "max_examples", "=", "max_training_examples", ",", "\n", "simple_situation_representation", "=", "simple_situation_representation", ")", "\n", "logger", ".", "info", "(", "\"Done Loading Training set.\"", ")", "\n", "logger", ".", "info", "(", "\"  Loaded {} training examples.\"", ".", "format", "(", "training_set", ".", "num_examples", ")", ")", "\n", "logger", ".", "info", "(", "\"  Input vocabulary size training set: {}\"", ".", "format", "(", "training_set", ".", "input_vocabulary_size", ")", ")", "\n", "logger", ".", "info", "(", "\"  Most common input words: {}\"", ".", "format", "(", "training_set", ".", "input_vocabulary", ".", "most_common", "(", "5", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"  Output vocabulary size training set: {}\"", ".", "format", "(", "training_set", ".", "target_vocabulary_size", ")", ")", "\n", "logger", ".", "info", "(", "\"  Most common target words: {}\"", ".", "format", "(", "training_set", ".", "target_vocabulary", ".", "most_common", "(", "5", ")", ")", ")", "\n", "\n", "if", "generate_vocabularies", ":", "\n", "        ", "training_set", ".", "save_vocabularies", "(", "input_vocab_path", ",", "target_vocab_path", ")", "\n", "logger", ".", "info", "(", "\"Saved vocabularies to {} for input and {} for target.\"", ".", "format", "(", "input_vocab_path", ",", "target_vocab_path", ")", ")", "\n", "\n", "", "logger", ".", "info", "(", "\"Loading Dev. set...\"", ")", "\n", "test_set", "=", "GroundedScanDataset", "(", "data_path", ",", "data_directory", ",", "split", "=", "\"dev\"", ",", "# TODO: use dev set here", "\n", "input_vocabulary_file", "=", "input_vocab_path", ",", "\n", "target_vocabulary_file", "=", "target_vocab_path", ",", "generate_vocabulary", "=", "False", ",", "k", "=", "0", ")", "\n", "test_set", ".", "read_dataset", "(", "max_examples", "=", "None", ",", "\n", "simple_situation_representation", "=", "simple_situation_representation", ")", "\n", "\n", "# Shuffle the test set to make sure that if we only evaluate max_testing_examples we get a random part of the set.", "\n", "test_set", ".", "shuffle_data", "(", ")", "\n", "logger", ".", "info", "(", "\"Done Loading Dev. set.\"", ")", "\n", "\n", "model", "=", "Model", "(", "input_vocabulary_size", "=", "training_set", ".", "input_vocabulary_size", ",", "\n", "target_vocabulary_size", "=", "training_set", ".", "target_vocabulary_size", ",", "\n", "num_cnn_channels", "=", "training_set", ".", "image_channels", ",", "\n", "input_padding_idx", "=", "training_set", ".", "input_vocabulary", ".", "pad_idx", ",", "\n", "target_pad_idx", "=", "training_set", ".", "target_vocabulary", ".", "pad_idx", ",", "\n", "target_eos_idx", "=", "training_set", ".", "target_vocabulary", ".", "eos_idx", ",", "\n", "**", "cfg", ")", "\n", "model", "=", "model", ".", "cuda", "(", ")", "if", "use_cuda", "else", "model", "\n", "log_parameters", "(", "model", ")", "\n", "trainable_parameters", "=", "[", "parameter", "for", "parameter", "in", "model", ".", "parameters", "(", ")", "if", "parameter", ".", "requires_grad", "]", "\n", "optimizer", "=", "torch", ".", "optim", ".", "Adam", "(", "trainable_parameters", ",", "lr", "=", "learning_rate", ",", "betas", "=", "(", "adam_beta_1", ",", "adam_beta_2", ")", ")", "\n", "scheduler", "=", "LambdaLR", "(", "optimizer", ",", "\n", "lr_lambda", "=", "lambda", "t", ":", "lr_decay", "**", "(", "t", "/", "lr_decay_steps", ")", ")", "\n", "\n", "# Load model and vocabularies if resuming.", "\n", "start_iteration", "=", "1", "\n", "best_iteration", "=", "1", "\n", "best_accuracy", "=", "0", "\n", "best_exact_match", "=", "0", "\n", "best_loss", "=", "float", "(", "'inf'", ")", "\n", "if", "resume_from_file", ":", "\n", "        ", "assert", "os", ".", "path", ".", "isfile", "(", "resume_from_file", ")", ",", "\"No checkpoint found at {}\"", ".", "format", "(", "resume_from_file", ")", "\n", "logger", ".", "info", "(", "\"Loading checkpoint from file at '{}'\"", ".", "format", "(", "resume_from_file", ")", ")", "\n", "optimizer_state_dict", "=", "model", ".", "load_model", "(", "resume_from_file", ")", "\n", "optimizer", ".", "load_state_dict", "(", "optimizer_state_dict", ")", "\n", "start_iteration", "=", "model", ".", "trained_iterations", "\n", "logger", ".", "info", "(", "\"Loaded checkpoint '{}' (iter {})\"", ".", "format", "(", "resume_from_file", ",", "start_iteration", ")", ")", "\n", "\n", "", "logger", ".", "info", "(", "\"Training starts..\"", ")", "\n", "training_iteration", "=", "start_iteration", "\n", "while", "training_iteration", "<", "max_training_iterations", ":", "\n", "\n", "# Shuffle the dataset and loop over it.", "\n", "        ", "training_set", ".", "shuffle_data", "(", ")", "\n", "for", "(", "input_batch", ",", "input_lengths", ",", "_", ",", "situation_batch", ",", "_", ",", "target_batch", ",", "\n", "target_lengths", ",", "agent_positions", ",", "target_positions", ")", "in", "training_set", ".", "get_data_iterator", "(", "\n", "batch_size", "=", "training_batch_size", ")", ":", "\n", "            ", "is_best", "=", "False", "\n", "model", ".", "train", "(", ")", "\n", "\n", "# Forward pass.", "\n", "target_scores", ",", "target_position_scores", "=", "model", "(", "commands_input", "=", "input_batch", ",", "commands_lengths", "=", "input_lengths", ",", "\n", "situations_input", "=", "situation_batch", ",", "target_batch", "=", "target_batch", ",", "\n", "target_lengths", "=", "target_lengths", ")", "\n", "loss", "=", "model", ".", "get_loss", "(", "target_scores", ",", "target_batch", ")", "\n", "if", "auxiliary_task", ":", "\n", "                ", "target_loss", "=", "model", ".", "get_auxiliary_loss", "(", "target_position_scores", ",", "target_positions", ")", "\n", "", "else", ":", "\n", "                ", "target_loss", "=", "0", "\n", "", "loss", "+=", "weight_target_loss", "*", "target_loss", "\n", "\n", "# Backward pass and update model parameters.", "\n", "loss", ".", "backward", "(", ")", "\n", "optimizer", ".", "step", "(", ")", "\n", "scheduler", ".", "step", "(", ")", "\n", "optimizer", ".", "zero_grad", "(", ")", "\n", "model", ".", "update_state", "(", "is_best", "=", "is_best", ")", "\n", "\n", "# Print current metrics.", "\n", "if", "training_iteration", "%", "print_every", "==", "0", ":", "\n", "                ", "accuracy", ",", "exact_match", "=", "model", ".", "get_metrics", "(", "target_scores", ",", "target_batch", ")", "\n", "if", "auxiliary_task", ":", "\n", "                    ", "auxiliary_accuracy_target", "=", "model", ".", "get_auxiliary_accuracy", "(", "target_position_scores", ",", "target_positions", ")", "\n", "", "else", ":", "\n", "                    ", "auxiliary_accuracy_target", "=", "0.", "\n", "", "learning_rate", "=", "scheduler", ".", "get_lr", "(", ")", "[", "0", "]", "\n", "logger", ".", "info", "(", "\"Iteration %08d, loss %8.4f, accuracy %5.2f, exact match %5.2f, learning_rate %.5f,\"", "\n", "\" aux. accuracy target pos %5.2f\"", "%", "(", "training_iteration", ",", "loss", ",", "accuracy", ",", "exact_match", ",", "\n", "learning_rate", ",", "auxiliary_accuracy_target", ")", ")", "\n", "\n", "# Evaluate on test set.", "\n", "", "if", "training_iteration", "%", "evaluate_every", "==", "0", ":", "\n", "                ", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "                    ", "model", ".", "eval", "(", ")", "\n", "logger", ".", "info", "(", "\"Evaluating..\"", ")", "\n", "accuracy", ",", "exact_match", ",", "target_accuracy", "=", "evaluate", "(", "\n", "test_set", ".", "get_data_iterator", "(", "batch_size", "=", "1", ")", ",", "model", "=", "model", ",", "\n", "max_decoding_steps", "=", "max_decoding_steps", ",", "pad_idx", "=", "test_set", ".", "target_vocabulary", ".", "pad_idx", ",", "\n", "sos_idx", "=", "test_set", ".", "target_vocabulary", ".", "sos_idx", ",", "\n", "eos_idx", "=", "test_set", ".", "target_vocabulary", ".", "eos_idx", ",", "\n", "max_examples_to_evaluate", "=", "kwargs", "[", "\"max_testing_examples\"", "]", ")", "\n", "logger", ".", "info", "(", "\"  Evaluation Accuracy: %5.2f Exact Match: %5.2f \"", "\n", "\" Target Accuracy: %5.2f\"", "%", "(", "accuracy", ",", "exact_match", ",", "target_accuracy", ")", ")", "\n", "if", "exact_match", ">", "best_exact_match", ":", "\n", "                        ", "is_best", "=", "True", "\n", "best_accuracy", "=", "accuracy", "\n", "best_exact_match", "=", "exact_match", "\n", "model", ".", "update_state", "(", "accuracy", "=", "accuracy", ",", "exact_match", "=", "exact_match", ",", "is_best", "=", "is_best", ")", "\n", "", "file_name", "=", "\"checkpoint.pth.tar\"", ".", "format", "(", "str", "(", "training_iteration", ")", ")", "\n", "if", "is_best", ":", "\n", "                        ", "model", ".", "save_checkpoint", "(", "file_name", "=", "file_name", ",", "is_best", "=", "is_best", ",", "\n", "optimizer_state_dict", "=", "optimizer", ".", "state_dict", "(", ")", ")", "\n", "\n", "", "", "", "training_iteration", "+=", "1", "\n", "if", "training_iteration", ">", "max_training_iterations", ":", "\n", "                ", "break", "\n", "", "", "", "logger", ".", "info", "(", "\"Finished training.\"", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.AdverbVocabulary.__init__": [[21, 25], ["collections.Counter"], "methods", ["None"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "_idx_to_word", "=", "[", "]", "\n", "self", ".", "_word_to_idx", "=", "{", "}", "\n", "self", ".", "_word_frequencies", "=", "Counter", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.AdverbVocabulary.word_to_idx": [[26, 28], ["None"], "methods", ["None"], ["", "def", "word_to_idx", "(", "self", ",", "word", ":", "str", ")", "->", "int", ":", "\n", "        ", "return", "self", ".", "_word_to_idx", "[", "word", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.AdverbVocabulary.idx_to_word": [[29, 31], ["None"], "methods", ["None"], ["", "def", "idx_to_word", "(", "self", ",", "idx", ":", "int", ")", "->", "str", ":", "\n", "        ", "return", "self", ".", "_idx_to_word", "[", "idx", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.AdverbVocabulary.add_word": [[32, 37], ["dataset.AdverbVocabulary._idx_to_word.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "add_word", "(", "self", ",", "word", ":", "List", "[", "str", "]", ")", ":", "\n", "        ", "if", "word", "not", "in", "self", ".", "_word_to_idx", ":", "\n", "            ", "self", ".", "_word_to_idx", "[", "word", "]", "=", "self", ".", "size", "\n", "self", ".", "_idx_to_word", ".", "append", "(", "word", ")", "\n", "", "self", ".", "_word_frequencies", "[", "word", "]", "+=", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.AdverbVocabulary.most_common": [[38, 40], ["dataset.AdverbVocabulary._word_frequencies.most_common"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.most_common"], ["", "def", "most_common", "(", "self", ",", "n", "=", "10", ")", ":", "\n", "        ", "return", "self", ".", "_word_frequencies", ".", "most_common", "(", "n", "=", "n", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.AdverbVocabulary.contains_word": [[41, 46], ["None"], "methods", ["None"], ["", "def", "contains_word", "(", "self", ",", "word", ":", "str", ")", "->", "bool", ":", "\n", "        ", "if", "word", "in", "self", ".", "_word_to_idx", ":", "\n", "            ", "return", "True", "\n", "", "else", ":", "\n", "            ", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.AdverbVocabulary.size": [[47, 50], ["len"], "methods", ["None"], ["", "", "@", "property", "\n", "def", "size", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "_idx_to_word", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.AdverbVocabulary.load": [[51, 63], ["os.path.exists", "open", "json.load", "cls", "collections.defaultdict", "all_data[].items", "collections.Counter"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load"], ["", "@", "classmethod", "\n", "def", "load", "(", "cls", ",", "path", ":", "str", ")", ":", "\n", "        ", "assert", "os", ".", "path", ".", "exists", "(", "path", ")", ",", "\"Trying to load a vocabulary from a non-existing file {}\"", ".", "format", "(", "path", ")", "\n", "with", "open", "(", "path", ",", "'r'", ")", "as", "infile", ":", "\n", "            ", "all_data", "=", "json", ".", "load", "(", "infile", ")", "\n", "vocab", "=", "cls", "(", ")", "\n", "vocab", ".", "_idx_to_word", "=", "all_data", "[", "\"idx_to_word\"", "]", "\n", "vocab", ".", "_word_to_idx", "=", "defaultdict", "(", "int", ")", "\n", "for", "word", ",", "idx", "in", "all_data", "[", "\"word_to_idx\"", "]", ".", "items", "(", ")", ":", "\n", "                ", "vocab", ".", "_word_to_idx", "[", "word", "]", "=", "idx", "\n", "", "vocab", ".", "_word_frequencies", "=", "Counter", "(", "all_data", "[", "\"word_frequencies\"", "]", ")", "\n", "", "return", "vocab", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.AdverbVocabulary.to_dict": [[64, 69], ["None"], "methods", ["None"], ["", "def", "to_dict", "(", "self", ")", "->", "dict", ":", "\n", "        ", "return", "{", "\n", "\"idx_to_word\"", ":", "self", ".", "_idx_to_word", ",", "\n", "\"word_to_idx\"", ":", "self", ".", "_word_to_idx", ",", "\n", "\"word_frequencies\"", ":", "self", ".", "_word_frequencies", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.AdverbVocabulary.save": [[71, 75], ["open", "json.dump", "dataset.AdverbVocabulary.to_dict"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.Situation.to_dict"], ["", "def", "save", "(", "self", ",", "path", ":", "str", ")", "->", "str", ":", "\n", "        ", "with", "open", "(", "path", ",", "'w'", ")", "as", "outfile", ":", "\n", "            ", "json", ".", "dump", "(", "self", ".", "to_dict", "(", ")", ",", "outfile", ",", "indent", "=", "4", ")", "\n", "", "return", "path", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.ModularDataset.__init__": [[79, 160], ["seq2seq.gSCAN_dataset.GroundedScanDataset.__init__", "dataset.ModularDataset.dataset._vocabulary.get_transitive_verbs", "logger.info", "[].items", "dataset.AdverbVocabulary", "seq2seq.gSCAN_dataset.Vocabulary", "seq2seq.gSCAN_dataset.Vocabulary", "seq2seq.gSCAN_dataset.Vocabulary", "seq2seq.gSCAN_dataset.Vocabulary", "isinstance", "logger.info", "isinstance", "logger.info", "save_directory.split", "dataset.AdverbVocabulary.load", "seq2seq.gSCAN_dataset.Vocabulary.load", "seq2seq.gSCAN_dataset.Vocabulary.load", "seq2seq.gSCAN_dataset.Vocabulary.load", "seq2seq.gSCAN_dataset.Vocabulary.load", "logger.info", "logger.info", "logger.info", "int", "str", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "dataset.ModularDataset.load_full_vocabularies", "len"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_transitive_verbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.load_full_vocabularies"], ["    ", "def", "__init__", "(", "self", ",", "path_to_data", ":", "str", ",", "save_directory", ":", "str", ",", "k", ":", "int", ",", "split", "=", "\"train\"", ",", "input_vocabulary_file", "=", "\"\"", ",", "\n", "adverb_input_vocabulary_file", "=", "\"\"", ",", "adverb_target_vocabulary_file", "=", "\"\"", ",", "planner_target_vocabulary_file", "=", "\"\"", ",", "\n", "target_vocabulary_file", "=", "\"\"", ",", "adverb_vocabulary_file", "=", "\"\"", ",", "transitive_target_vocabulary_file", "=", "\"\"", ",", "\n", "generate_vocabulary", "=", "False", ",", "upsample_isolated", "=", "1", ",", "isolate_adverb_types", "=", "None", ",", "only_keep_adverbs", "=", "None", ",", "\n", "seed", "=", "1", ",", "isolate_examples_with", "=", "\"cautiously\"", ",", "module", "=", "\"\"", ",", "output_folder_pattern", "=", "\"\"", ",", "collapse_alo", "=", "False", ")", ":", "\n", "        ", "if", "generate_vocabulary", ":", "\n", "            ", "self", ".", "adverb_vocabulary", "=", "AdverbVocabulary", "(", ")", "\n", "self", ".", "adverb_input_vocabulary", "=", "Vocabulary", "(", ")", "\n", "self", ".", "adverb_target_vocabulary", "=", "Vocabulary", "(", ")", "\n", "self", ".", "planner_target_vocabulary", "=", "Vocabulary", "(", ")", "\n", "self", ".", "transitive_target_vocabulary", "=", "Vocabulary", "(", ")", "\n", "", "self", ".", "collapse_alo", "=", "collapse_alo", "\n", "if", "module", "==", "\"full\"", ":", "\n", "            ", "assert", "output_folder_pattern", ",", "\"Please provide the pattern of the output folders for all the modules.\"", "\n", "", "self", ".", "all_modules", "=", "[", "\"position\"", ",", "\"planner\"", ",", "\"dummy_planner\"", ",", "\"dummy_sequence_planner\"", ",", "\"interaction\"", ",", "\n", "\"dummy_interaction\"", ",", "\"adverb_transform\"", ",", "\"alo_transform\"", "]", "\n", "if", "isolate_adverb_types", ":", "\n", "            ", "assert", "isinstance", "(", "isolate_adverb_types", ",", "list", ")", ",", "\"Please provide list of strings to isolate_adverb_types.\"", "\n", "logger", ".", "info", "(", "\"Isolating adverb types: %s\"", "%", "','", ".", "join", "(", "isolate_adverb_types", ")", ")", "\n", "", "if", "only_keep_adverbs", ":", "\n", "            ", "assert", "isinstance", "(", "only_keep_adverbs", ",", "list", ")", ",", "\"Please provide list of strings to only_keep_adverbs.\"", "\n", "logger", ".", "info", "(", "\"Only keeping adverbs: %s\"", "%", "','", ".", "join", "(", "only_keep_adverbs", ")", ")", "\n", "", "if", "module", "==", "\"full\"", ":", "\n", "            ", "old_save_directory", "=", "save_directory", "\n", "save_directory", "=", "output_folder_pattern", "%", "\"position\"", "\n", "module_path_pattern_split", "=", "save_directory", ".", "split", "(", "\"seed_\"", ")", "\n", "module_path_pattern_seed", "=", "int", "(", "module_path_pattern_split", "[", "-", "1", "]", ")", "%", "5", "\n", "if", "not", "module_path_pattern_seed", ":", "\n", "                ", "module_path_pattern_seed", "=", "5", "\n", "", "save_directory", "=", "module_path_pattern_split", "[", "0", "]", "+", "\"seed_\"", "+", "str", "(", "module_path_pattern_seed", ")", "\n", "", "super", "(", ")", ".", "__init__", "(", "path_to_data", ",", "save_directory", ",", "k", ",", "split", ",", "input_vocabulary_file", ",", "\n", "target_vocabulary_file", ",", "generate_vocabulary", ",", "upsample_isolated", "=", "upsample_isolated", ",", "\n", "isolate_adverb_types", "=", "isolate_adverb_types", ",", "only_keep_adverbs", "=", "only_keep_adverbs", ",", "\n", "isolate_examples_with", "=", "isolate_examples_with", ",", "seed", "=", "seed", ")", "\n", "if", "not", "generate_vocabulary", ":", "\n", "            ", "self", ".", "adverb_vocabulary", "=", "AdverbVocabulary", ".", "load", "(", "os", ".", "path", ".", "join", "(", "save_directory", ",", "\n", "adverb_vocabulary_file", ")", ")", "\n", "self", ".", "adverb_input_vocabulary", "=", "Vocabulary", ".", "load", "(", "os", ".", "path", ".", "join", "(", "save_directory", ",", "\n", "adverb_input_vocabulary_file", ")", ")", "\n", "self", ".", "adverb_target_vocabulary", "=", "Vocabulary", ".", "load", "(", "os", ".", "path", ".", "join", "(", "save_directory", ",", "\n", "adverb_target_vocabulary_file", ")", ")", "\n", "self", ".", "planner_target_vocabulary", "=", "Vocabulary", ".", "load", "(", "os", ".", "path", ".", "join", "(", "save_directory", ",", "\n", "planner_target_vocabulary_file", ")", ")", "\n", "self", ".", "transitive_target_vocabulary", "=", "Vocabulary", ".", "load", "(", "os", ".", "path", ".", "join", "(", "save_directory", ",", "\n", "transitive_target_vocabulary_file", ")", ")", "\n", "if", "module", "==", "\"full\"", ":", "\n", "                ", "self", ".", "vocabulary_dict", "=", "{", "\n", "\"position\"", ":", "[", "(", "input_vocabulary_file", ",", "\"input_tensor\"", ")", "]", ",", "\n", "\"planner\"", ":", "[", "(", "input_vocabulary_file", ",", "\"input_tensor\"", ")", ",", "\n", "(", "planner_target_vocabulary_file", ",", "\"planner_target_tensor\"", ")", "]", ",", "\n", "\"interaction\"", ":", "[", "(", "input_vocabulary_file", ",", "\"input_tensor\"", ")", ",", "\n", "(", "transitive_target_vocabulary_file", ",", "\"transitive_target_tensor\"", ")", "]", ",", "\n", "\"adverb_transform\"", ":", "[", "(", "input_vocabulary_file", ",", "\"input_tensor\"", ")", ",", "\n", "(", "adverb_input_vocabulary_file", ",", "\"adverb_input_tensor\"", ")", ",", "\n", "(", "adverb_target_vocabulary_file", ",", "\"adverb_target_tensor\"", ")", "]", ",", "\n", "\"alo_transform\"", ":", "[", "(", "adverb_target_vocabulary_file", ",", "\"adverb_target_tensor\"", ")", ",", "\n", "(", "target_vocabulary_file", ",", "\"target_tensor\"", ")", "]", "\n", "}", "\n", "self", ".", "full_vocabularies", "=", "self", ".", "load_full_vocabularies", "(", "\n", "output_folder_pattern", ")", "\n", "", "logger", ".", "info", "(", "\"Also done loading adverb vocabulary.\"", ")", "\n", "", "if", "module", "==", "\"full\"", ":", "\n", "            ", "save_directory", "=", "old_save_directory", "\n", "", "self", ".", "transitive_verbs", "=", "self", ".", "dataset", ".", "_vocabulary", ".", "get_transitive_verbs", "(", ")", "\n", "if", "isolate_adverb_types", ":", "\n", "            ", "logger", ".", "info", "(", "\"Isolated %d examples for adverb types.\"", "%", "len", "(", "self", ".", "dataset", ".", "_data_pairs", "[", "\"isolated_adverb_types\"", "]", ")", ")", "\n", "", "logger", ".", "info", "(", "\"Occurrences of adverb types:\"", ")", "\n", "for", "adverb_type", ",", "count", "in", "self", ".", "dataset", ".", "_data_statistics", "[", "\"train\"", "]", "[", "\"type_adverbs\"", "]", ".", "items", "(", ")", ":", "\n", "            ", "logger", ".", "info", "(", "\"{}: {} occurrences.\"", ".", "format", "(", "adverb_type", ",", "count", ")", ")", "\n", "", "actual_k", "=", "self", ".", "dataset", ".", "_data_statistics", "[", "\"train\"", "]", "[", "\"manners_in_command\"", "]", "[", "isolate_examples_with", "]", "\n", "expected_k", "=", "k", "*", "upsample_isolated", "\n", "if", "split", "in", "[", "\"train\"", ",", "\"dev\"", "]", ":", "\n", "            ", "assert", "actual_k", "==", "expected_k", ",", "\"Chose k=%d and upsample=%d (expected k=%d) but actual number of examples with %s in training set is %d.\"", "%", "(", "\n", "k", ",", "upsample_isolated", ",", "expected_k", ",", "isolate_examples_with", ",", "actual_k", "\n", ")", "\n", "", "self", ".", "adverb_vocabulary_size", "=", "self", ".", "adverb_vocabulary", ".", "size", "\n", "self", ".", "_percentage_not_unk", "=", "{", "\n", "\"input\"", ":", "{", "\"total\"", ":", "0", ",", "\"not_unk\"", ":", "0", "}", ",", "\n", "\"target\"", ":", "{", "\"total\"", ":", "0", ",", "\"not_unk\"", ":", "0", "}", ",", "\n", "\"adverb\"", ":", "{", "\"total\"", ":", "0", ",", "\"not_unk\"", ":", "0", "}", ",", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.ModularDataset.sentence_to_array": [[162, 177], ["dataset.ModularDataset.get_vocabulary", "sentence_array.append", "sentence_array.append", "dataset.ModularDataset.word_to_idx"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_vocabulary", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.word_to_idx"], ["", "def", "sentence_to_array", "(", "self", ",", "sentence", ":", "List", "[", "str", "]", ",", "vocabulary", ":", "str", ",", "module", "=", "\"\"", ")", "->", "List", "[", "int", "]", ":", "\n", "        ", "\"\"\"\n        Convert each string word in a sentence to the corresponding integer from the vocabulary and append\n        a start-of-sequence and end-of-sequence token.\n        :param sentence: the sentence in words (strings)\n        :param vocabulary: whether to use the input or target vocabulary.\n        :param module: if specified, get the module-specific vocabulary\n        :return: the sentence in integers.\n        \"\"\"", "\n", "vocab", "=", "self", ".", "get_vocabulary", "(", "vocabulary", ",", "module", ")", "\n", "sentence_array", "=", "[", "vocab", ".", "sos_idx", "]", "\n", "for", "word", "in", "sentence", ":", "\n", "            ", "sentence_array", ".", "append", "(", "vocab", ".", "word_to_idx", "(", "word", ")", ")", "\n", "", "sentence_array", ".", "append", "(", "vocab", ".", "eos_idx", ")", "\n", "return", "sentence_array", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.ModularDataset.array_to_sentence": [[178, 188], ["dataset.ModularDataset.get_vocabulary", "dataset.ModularDataset.idx_to_word"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_vocabulary", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.idx_to_word"], ["", "def", "array_to_sentence", "(", "self", ",", "sentence_array", ":", "List", "[", "int", "]", ",", "vocabulary", ":", "str", ",", "module", "=", "\"\"", ")", "->", "List", "[", "str", "]", ":", "\n", "        ", "\"\"\"\n        Translate each integer in a sentence array to the corresponding word.\n        :param sentence_array: array with integers representing words from the vocabulary.\n        :param vocabulary: whether to use the input or target vocabulary.\n        :param module: if specified, get the module-specific vocabulary\n        :return: the sentence in words.\n        \"\"\"", "\n", "vocab", "=", "self", ".", "get_vocabulary", "(", "vocabulary", ",", "module", ")", "\n", "return", "[", "vocab", ".", "idx_to_word", "(", "word_idx", ")", "for", "word_idx", "in", "sentence_array", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.ModularDataset.load_full_vocabularies": [[189, 211], ["dataset.ModularDataset.vocabulary_dict.items", "output_folder_pattern.split", "os.path.join", "seq2seq.gSCAN_dataset.Vocabulary.load", "setattr", "setattr", "int", "str", "tensor_name.split"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load"], ["", "def", "load_full_vocabularies", "(", "self", ",", "output_folder_pattern", ":", "str", ")", ":", "\n", "        ", "full_vocabularies", "=", "{", "}", "\n", "for", "module", ",", "vocabs", "in", "self", ".", "vocabulary_dict", ".", "items", "(", ")", ":", "\n", "            ", "if", "module", "!=", "\"adverb_transform\"", ":", "\n", "                ", "module_path_pattern_split", "=", "output_folder_pattern", ".", "split", "(", "\"seed_\"", ")", "\n", "module_path_pattern_seed", "=", "int", "(", "module_path_pattern_split", "[", "-", "1", "]", ")", "%", "5", "\n", "if", "not", "module_path_pattern_seed", ":", "\n", "                    ", "module_path_pattern_seed", "=", "5", "\n", "", "adjusted_output_folder_pattern", "=", "module_path_pattern_split", "[", "0", "]", "+", "\"seed_\"", "+", "str", "(", "module_path_pattern_seed", ")", "\n", "module_folder_path", "=", "adjusted_output_folder_pattern", "%", "module", "\n", "", "else", ":", "\n", "                ", "module_folder_path", "=", "output_folder_pattern", "%", "module", "\n", "", "full_vocabularies", "[", "module", "]", "=", "{", "}", "\n", "for", "vocab", ",", "tensor_name", "in", "vocabs", ":", "\n", "                ", "vocab_file", "=", "os", ".", "path", ".", "join", "(", "module_folder_path", ",", "vocab", ")", "\n", "vocabulary", "=", "Vocabulary", ".", "load", "(", "vocab_file", ")", "\n", "full_vocabularies", "[", "module", "]", "[", "tensor_name", "]", "=", "vocabulary", "\n", "vocab_attribute", "=", "tensor_name", ".", "split", "(", "\"_tensor\"", ")", "[", "0", "]", "+", "\"_vocabulary\"", "\n", "modular_vocab_attribute", "=", "module", "+", "\"_\"", "+", "vocab_attribute", "\n", "setattr", "(", "self", ",", "vocab_attribute", ",", "vocabulary", ")", "\n", "setattr", "(", "self", ",", "modular_vocab_attribute", ",", "vocabulary", ")", "\n", "", "", "return", "full_vocabularies", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.ModularDataset.read_vocabularies": [[212, 236], ["logger.info", "enumerate", "dataset.ModularDataset.dataset.get_examples_with_image", "dataset.ModularDataset.adverb_input_vocabulary.add_sentence", "dataset.ModularDataset.planner_target_vocabulary.add_sentence", "dataset.ModularDataset.adverb_vocabulary.add_word", "dataset.ModularDataset.transitive_target_vocabulary.add_sentence", "dataset.ModularDataset.input_vocabulary.add_sentence", "dataset.ModularDataset.target_vocabulary.add_sentence", "dataset.ModularDataset.adverb_target_vocabulary.add_sentence", "dataset.ModularDataset.adverb_target_vocabulary.add_sentence"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_examples_with_image", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.add_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.add_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.add_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.add_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.add_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.add_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.add_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.add_sentence"], ["", "def", "read_vocabularies", "(", "self", ")", "->", "{", "}", ":", "\n", "        ", "\"\"\"\n        Loop over all examples in the dataset and add the words in them to the vocabularies.\n        \"\"\"", "\n", "logger", ".", "info", "(", "\"Populating vocabulary...\"", ")", "\n", "for", "i", ",", "example", "in", "enumerate", "(", "self", ".", "dataset", ".", "get_examples_with_image", "(", "self", ".", "split", ",", "\n", "simple_situation_representation", "=", "True", ",", "\n", "adverb_inputs", "=", "True", ")", ")", ":", "\n", "            ", "self", ".", "adverb_input_vocabulary", ".", "add_sentence", "(", "example", "[", "\"adverb_input\"", "]", ")", "\n", "if", "example", "[", "\"verb_in_command\"", "]", "==", "\"push\"", "or", "example", "[", "\"verb_in_command\"", "]", "==", "\"pull\"", ":", "\n", "                ", "planner_target", "=", "[", "command", "for", "command", "in", "example", "[", "\"adverb_input\"", "]", "if", "command", "!=", "example", "[", "\"verb_in_command\"", "]", "]", "\n", "interactions", "=", "[", "command", "for", "command", "in", "example", "[", "\"adverb_input\"", "]", "if", "command", "==", "example", "[", "\"verb_in_command\"", "]", "]", "\n", "", "else", ":", "\n", "                ", "interactions", "=", "[", "]", "\n", "planner_target", "=", "example", "[", "\"adverb_input\"", "]", "\n", "", "self", ".", "planner_target_vocabulary", ".", "add_sentence", "(", "planner_target", ")", "\n", "self", ".", "adverb_vocabulary", ".", "add_word", "(", "example", "[", "\"adverb\"", "]", ")", "\n", "self", ".", "transitive_target_vocabulary", ".", "add_sentence", "(", "interactions", ")", "\n", "if", "self", ".", "collapse_alo", ":", "\n", "                ", "self", ".", "adverb_target_vocabulary", ".", "add_sentence", "(", "example", "[", "\"target_command\"", "]", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "adverb_target_vocabulary", ".", "add_sentence", "(", "example", "[", "\"adverb_target\"", "]", ")", "\n", "", "self", ".", "input_vocabulary", ".", "add_sentence", "(", "example", "[", "\"input_command\"", "]", ")", "\n", "self", ".", "target_vocabulary", ".", "add_sentence", "(", "example", "[", "\"target_command\"", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.ModularDataset.get_vocabulary": [[237, 247], ["hasattr", "getattr", "ValueError"], "methods", ["None"], ["", "", "def", "get_vocabulary", "(", "self", ",", "vocabulary", ":", "str", ",", "module", "=", "\"\"", ")", "->", "Vocabulary", ":", "\n", "        ", "vocabulary_attribute", "=", "vocabulary", "+", "\"_vocabulary\"", "\n", "if", "vocabulary_attribute", "==", "\"final_input_vocabulary\"", ":", "\n", "            ", "vocabulary_attribute", "=", "\"adverb_target_vocabulary\"", "\n", "", "if", "module", ":", "\n", "            ", "vocabulary_attribute", "=", "module", "+", "\"_\"", "+", "vocabulary_attribute", "\n", "", "if", "hasattr", "(", "self", ",", "vocabulary_attribute", ")", ":", "\n", "            ", "return", "getattr", "(", "self", ",", "vocabulary_attribute", ")", "\n", "", "else", ":", "\n", "            ", "raise", "ValueError", "(", "\"Specified unknown vocabulary in sentence_to_array: {}\"", ".", "format", "(", "vocabulary", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.ModularDataset.save_vocabularies": [[248, 259], ["dataset.ModularDataset.adverb_input_vocabulary.save", "dataset.ModularDataset.adverb_target_vocabulary.save", "dataset.ModularDataset.input_vocabulary.save", "dataset.ModularDataset.target_vocabulary.save", "dataset.ModularDataset.adverb_vocabulary.save", "dataset.ModularDataset.planner_target_vocabulary.save", "dataset.ModularDataset.transitive_target_vocabulary.save", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save"], ["", "", "def", "save_vocabularies", "(", "self", ",", "input_vocabulary_file", ":", "str", ",", "target_vocabulary_file", ":", "str", ",", "\n", "adverb_input_vocabulary_file", "=", "\"\"", ",", "adverb_target_vocabulary_file", "=", "\"\"", ",", "\n", "adverb_vocabulary_file", "=", "\"\"", ",", "planner_target_vocabulary_file", "=", "\"\"", ",", "\n", "transitive_target_vocabulary_file", "=", "\"\"", ")", ":", "\n", "        ", "self", ".", "adverb_input_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "adverb_input_vocabulary_file", ")", ")", "\n", "self", ".", "adverb_target_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "adverb_target_vocabulary_file", ")", ")", "\n", "self", ".", "input_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "input_vocabulary_file", ")", ")", "\n", "self", ".", "target_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "target_vocabulary_file", ")", ")", "\n", "self", ".", "adverb_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "adverb_vocabulary_file", ")", ")", "\n", "self", ".", "planner_target_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "planner_target_vocabulary_file", ")", ")", "\n", "self", ".", "transitive_target_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "transitive_target_vocabulary_file", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.ModularDataset.get_percentage_unk": [[260, 265], ["ValueError"], "methods", ["None"], ["", "def", "get_percentage_unk", "(", "self", ",", "vocabulary", ":", "str", ")", ":", "\n", "        ", "if", "vocabulary", "not", "in", "self", ".", "_percentage_not_unk", ":", "\n", "            ", "raise", "ValueError", "(", "\"Unknown vocabulary %s passed to get_percentage_unk(). \"", "\n", "\"Options are 'input', 'target', 'adverb'.\"", "%", "vocabulary", ")", "\n", "", "return", "-", "1.", "\n", "#return 1. - (self._percentage_not_unk[vocabulary][\"not_unk\"] / self._percentage_not_unk[vocabulary][\"total\"])", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.ModularDataset.remove_transitive_verbs": [[267, 270], ["None"], "methods", ["None"], ["", "def", "remove_transitive_verbs", "(", "self", ",", "input_sequence", ":", "List", "[", "str", "]", ")", "->", "List", "[", "str", "]", ":", "\n", "        ", "removed_transitive", "=", "[", "word", "for", "word", "in", "input_sequence", "if", "word", "not", "in", "self", ".", "transitive_verbs", "]", "\n", "return", "removed_transitive", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.ModularDataset.convert_example_for_modularity": [[271, 317], ["original_adverb_input.copy", "original_adverb_target.copy", "original_adverb_input.copy", "GroundedScan.dsl.Position", "GroundedScan.dsl.Position", "GroundedScan.dsl.simulate_planner", "GroundedScan.dsl.convert_sequence_to_actions", "egocentric_plan.get_gscan_actions.get_gscan_actions.get_gscan_actions", "original_adverb_target.copy", "int", "int", "int", "int"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.simulate_planner", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.convert_sequence_to_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_gscan_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "convert_example_for_modularity", "(", "self", ",", "example", ")", ":", "\n", "        ", "original_adverb_input", "=", "example", "[", "\"adverb_input\"", "]", "\n", "original_adverb_target", "=", "example", "[", "\"adverb_target\"", "]", "\n", "verb_in_command", "=", "example", "[", "\"verb_in_command\"", "]", "\n", "planner_target", "=", "original_adverb_input", ".", "copy", "(", ")", "\n", "adverb_target", "=", "original_adverb_target", ".", "copy", "(", ")", "\n", "if", "example", "[", "\"type_adverb\"", "]", "==", "\"nonmovement_direction\"", ":", "\n", "            ", "start_position", "=", "example", "[", "\"situation_representation\"", "]", "[", "\"agent_position\"", "]", "\n", "start_position", "=", "Position", "(", "column", "=", "int", "(", "start_position", "[", "\"column\"", "]", ")", ",", "row", "=", "int", "(", "start_position", "[", "\"row\"", "]", ")", ")", "\n", "end_position", "=", "example", "[", "\"situation_representation\"", "]", "[", "\"target_object\"", "]", "[", "\"position\"", "]", "\n", "end_position", "=", "Position", "(", "column", "=", "int", "(", "end_position", "[", "\"column\"", "]", ")", ",", "row", "=", "int", "(", "end_position", "[", "\"row\"", "]", ")", ")", "\n", "alocentric_plan", "=", "simulate_planner", "(", "start_position", ",", "end_position", ")", "\n", "egocentric_plan", "=", "convert_sequence_to_actions", "(", "alocentric_plan", ",", "agent_start_dir", "=", "EAST", ")", "\n", "egocentric_plan", "=", "egocentric_plan", ".", "get_gscan_actions", "(", ")", "\n", "", "if", "verb_in_command", "==", "\"push\"", "or", "verb_in_command", "==", "\"pull\"", ":", "\n", "            ", "planner_target", "=", "[", "command", "for", "command", "in", "planner_target", "if", "command", "!=", "verb_in_command", "]", "\n", "interactions", "=", "[", "command", "for", "command", "in", "example", "[", "\"target_command\"", "]", "if", "command", "==", "verb_in_command", "]", "\n", "", "else", ":", "\n", "            ", "interactions", "=", "[", "]", "\n", "", "interaction_target", "=", "[", "]", "\n", "adverb_input", "=", "original_adverb_input", ".", "copy", "(", ")", "\n", "if", "verb_in_command", "not", "in", "interaction_target", ":", "\n", "            ", "interaction_target", "+=", "interactions", "\n", "", "if", "verb_in_command", "not", "in", "adverb_input", ":", "\n", "            ", "adverb_input", "+=", "interactions", "\n", "", "if", "example", "[", "\"type_adverb\"", "]", "==", "\"movement_rewrite\"", "or", "example", "[", "\"type_adverb\"", "]", "==", "\"movement\"", ":", "\n", "# planner_target = [command for command in original_adverb_target if command != verb_in_command]  # TODO: change back for getting back alo", "\n", "            ", "planner_target", "=", "[", "command", "for", "command", "in", "example", "[", "\"target_command\"", "]", "if", "command", "not", "in", "[", "\"push\"", ",", "\"pull\"", "]", "]", "\n", "interaction_target", "=", "interactions", "\n", "# adverb_input = original_adverb_target.copy() + interactions", "\n", "adverb_input", "=", "planner_target", "+", "interactions", "\n", "adverb_target", "=", "original_adverb_target", ".", "copy", "(", ")", "+", "interactions", "\n", "", "elif", "example", "[", "\"type_adverb\"", "]", "==", "\"nonmovement_direction\"", ":", "\n", "            ", "planner_target", "=", "egocentric_plan", "\n", "adverb_input", "=", "planner_target", "+", "interactions", "\n", "", "if", "not", "example", "[", "\"adverb\"", "]", ":", "\n", "            ", "planner_target", "=", "[", "command", "for", "command", "in", "original_adverb_target", "if", "command", "not", "in", "[", "\"push\"", ",", "\"pull\"", "]", "]", "\n", "adverb_input", "=", "original_adverb_target", "\n", "", "example", "[", "\"adverb_input\"", "]", "=", "adverb_input", "\n", "if", "self", ".", "collapse_alo", ":", "\n", "            ", "example", "[", "\"adverb_target\"", "]", "=", "example", "[", "\"target_command\"", "]", "\n", "", "else", ":", "\n", "            ", "example", "[", "\"adverb_target\"", "]", "=", "adverb_target", "\n", "", "example", "[", "\"planner_target\"", "]", "=", "planner_target", "\n", "example", "[", "\"interaction_target\"", "]", "=", "interaction_target", "\n", "return", "example", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.ModularDataset.convert_example_for_modularity_alo": [[318, 351], ["original_adverb_input.copy", "original_adverb_target.copy", "original_adverb_input.copy", "original_adverb_target.copy", "original_adverb_target.copy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "convert_example_for_modularity_alo", "(", "self", ",", "example", ")", ":", "\n", "        ", "original_adverb_input", "=", "example", "[", "\"adverb_input\"", "]", "\n", "original_adverb_target", "=", "example", "[", "\"adverb_target\"", "]", "\n", "verb_in_command", "=", "example", "[", "\"verb_in_command\"", "]", "\n", "planner_target", "=", "original_adverb_input", ".", "copy", "(", ")", "\n", "adverb_target", "=", "original_adverb_target", ".", "copy", "(", ")", "\n", "if", "verb_in_command", "==", "\"push\"", "or", "verb_in_command", "==", "\"pull\"", ":", "\n", "            ", "planner_target", "=", "[", "command", "for", "command", "in", "planner_target", "if", "command", "!=", "verb_in_command", "]", "\n", "interactions", "=", "[", "command", "for", "command", "in", "example", "[", "\"target_command\"", "]", "if", "command", "==", "verb_in_command", "]", "\n", "", "else", ":", "\n", "            ", "interactions", "=", "[", "]", "\n", "", "interaction_target", "=", "[", "]", "\n", "adverb_input", "=", "original_adverb_input", ".", "copy", "(", ")", "\n", "if", "verb_in_command", "not", "in", "interaction_target", ":", "\n", "            ", "interaction_target", "+=", "interactions", "\n", "", "if", "verb_in_command", "not", "in", "adverb_input", ":", "\n", "            ", "adverb_input", "+=", "interactions", "\n", "", "if", "example", "[", "\"type_adverb\"", "]", "==", "\"movement_rewrite\"", "or", "example", "[", "\"type_adverb\"", "]", "==", "\"movement\"", ":", "\n", "            ", "planner_target", "=", "[", "command", "for", "command", "in", "original_adverb_target", "if", "command", "!=", "verb_in_command", "]", "\n", "interaction_target", "=", "interactions", "\n", "adverb_input", "=", "original_adverb_target", ".", "copy", "(", ")", "+", "interactions", "\n", "adverb_target", "=", "original_adverb_target", ".", "copy", "(", ")", "+", "interactions", "\n", "", "if", "not", "example", "[", "\"adverb\"", "]", ":", "\n", "            ", "planner_target", "=", "[", "command", "for", "command", "in", "example", "[", "\"target_command\"", "]", "if", "command", "not", "in", "[", "\"push\"", ",", "\"pull\"", "]", "]", "\n", "adverb_input", "=", "original_adverb_target", "\n", "", "example", "[", "\"adverb_input\"", "]", "=", "adverb_input", "\n", "if", "self", ".", "collapse_alo", ":", "\n", "            ", "example", "[", "\"adverb_target\"", "]", "=", "example", "[", "\"target_command\"", "]", "\n", "", "else", ":", "\n", "            ", "example", "[", "\"adverb_target\"", "]", "=", "adverb_target", "\n", "", "example", "[", "\"planner_target\"", "]", "=", "planner_target", "\n", "example", "[", "\"interaction_target\"", "]", "=", "interaction_target", "\n", "return", "example", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.ModularDataset.make_dummy_sequence_planner_target": [[352, 408], ["None"], "methods", ["None"], ["", "def", "make_dummy_sequence_planner_target", "(", "self", ",", "example", ",", "sequence", "=", "True", ")", ":", "\n", "        ", "direction_to_target", "=", "example", "[", "\"situation_representation\"", "]", "[", "'direction_to_target'", "]", "\n", "if", "direction_to_target", "in", "[", "'n'", ",", "'e'", ",", "'s'", ",", "'w'", "]", ":", "\n", "            ", "if", "example", "[", "\"adverb\"", "]", "in", "[", "\"hesitantly\"", ",", "\"cautiously\"", "]", ":", "\n", "                ", "direction_translation", "=", "{", "\n", "\"n\"", ":", "\"turn left\"", ",", "\n", "\"e\"", ":", "\"walk\"", ",", "\n", "\"s\"", ":", "\"turn right\"", ",", "\n", "\"w\"", ":", "\"turn left\"", "\n", "}", "\n", "", "else", ":", "\n", "                ", "direction_translation", "=", "{", "\n", "\"n\"", ":", "\"north\"", ",", "\n", "\"e\"", ":", "\"east\"", ",", "\n", "\"s\"", ":", "\"south\"", ",", "\n", "\"w\"", ":", "\"west\"", "\n", "}", "\n", "", "dummy_planner_target", "=", "direction_translation", "[", "direction_to_target", "]", "\n", "", "elif", "example", "[", "\"adverb\"", "]", "==", "\"while zigzagging\"", ":", "\n", "            ", "direction_translation", "=", "{", "\n", "\"ne\"", ":", "\"east\"", ",", "\n", "\"sw\"", ":", "\"west\"", ",", "\n", "\"se\"", ":", "\"east\"", ",", "\n", "\"nw\"", ":", "\"west\"", "\n", "}", "\n", "dummy_planner_target", "=", "direction_translation", "[", "direction_to_target", "]", "\n", "", "else", ":", "\n", "            ", "if", "example", "[", "\"adverb\"", "]", "in", "[", "\"hesitantly\"", ",", "\"cautiously\"", "]", ":", "\n", "                ", "direction_translation", "=", "{", "\n", "\"ne\"", ":", "\"walk\"", ",", "\n", "\"sw\"", ":", "\"turn right\"", ",", "\n", "\"se\"", ":", "\"turn right\"", ",", "\n", "\"nw\"", ":", "\"turn left\"", "\n", "}", "\n", "", "else", ":", "\n", "                ", "direction_translation", "=", "{", "\n", "\"ne\"", ":", "\"north\"", ",", "\n", "\"sw\"", ":", "\"south\"", ",", "\n", "\"se\"", ":", "\"south\"", ",", "\n", "\"nw\"", ":", "\"north\"", "\n", "}", "\n", "", "dummy_planner_target", "=", "direction_translation", "[", "direction_to_target", "]", "\n", "", "if", "sequence", ":", "\n", "            ", "dummy_planner_target", "=", "[", "dummy_planner_target", "]", "\n", "", "else", ":", "\n", "            ", "int_translate", "=", "{", "\n", "\"north\"", ":", "0", ",", "\n", "\"east\"", ":", "1", ",", "\n", "\"south\"", ":", "2", ",", "\n", "\"west\"", ":", "3", ",", "\n", "\"turn left\"", ":", "4", ",", "\n", "\"turn right\"", ":", "5", ",", "\n", "\"walk\"", ":", "6", "\n", "}", "\n", "dummy_planner_target", "=", "int_translate", "[", "dummy_planner_target", "]", "\n", "", "return", "dummy_planner_target", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.ModularDataset.get_data_iterator": [[409, 679], ["isinstance", "logger.info", "numpy.array", "enumerate", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "dataset.ModularDataset.dataset.get_examples_with_image", "dataset.ModularDataset.adverb_vocabulary.word_to_idx", "dataset.ModularDataset.sentence_to_array", "dataset.ModularDataset.sentence_to_array", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "numpy.append", "numpy.append", "numpy.append", "dataset.ModularDataset.convert_example_for_modularity_alo", "int", "int", "dataset.ModularDataset.make_dummy_sequence_planner_target", "dataset.ModularDataset.make_dummy_sequence_planner_target", "dataset.ModularDataset.sentence_to_array", "dataset.ModularDataset.sentence_to_array", "dataset.ModularDataset.sentence_to_array", "dataset.ModularDataset.sentence_to_array", "dataset.ModularDataset.sentence_to_array", "dataset.ModularDataset.adverb_vocabulary.word_to_idx", "dataset.ModularDataset.sentence_to_array", "dataset.ModularDataset.sentence_to_array", "dataset.ModularDataset.sentence_to_array", "sum", "len", "int", "sum", "len", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "numpy.append", "numpy.append", "numpy.append", "numpy.append", "numpy.append", "numpy.append", "numpy.append", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "len", "numpy.array", "len", "int", "int", "dataset.ModularDataset.get_vocabulary().contains_word", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "len", "len", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "int", "int", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "len", "len", "len", "len", "len", "len", "len", "torch.tensor", "torch.tensor", "input_keys_to_pad.keys", "input_keys_to_pad.keys", "dataset.ModularDataset.get_vocabulary().contains_word", "dataset.ModularDataset.get_vocabulary", "dataset.ModularDataset.get_vocabulary().contains_word", "dataset.ModularDataset.make_modular_batch", "dataset.ModularDataset.make_modular_batch", "dataset.ModularDataset.make_batch", "dataset.ModularDataset.make_modular_batch", "dataset.ModularDataset.get_vocabulary", "dataset.ModularDataset.get_vocabulary"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_examples_with_image", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.word_to_idx", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.ModularDataset.convert_example_for_modularity_alo", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.make_dummy_sequence_planner_target", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.make_dummy_sequence_planner_target", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.word_to_idx", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.contains_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.contains_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_vocabulary", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.contains_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.make_modular_batch", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.make_modular_batch", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.make_batch", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.make_modular_batch", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_vocabulary", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_vocabulary"], ["", "def", "get_data_iterator", "(", "self", ",", "input_keys", "=", "None", ",", "input_keys_to_pad", "=", "None", ",", "target_keys", "=", "None", ",", "target_keys_to_pad", "=", "None", ",", "\n", "batch_size", "=", "None", ",", "max_examples", "=", "None", ",", "simple_situation_representation", "=", "True", ",", "shuffle", "=", "False", ",", "\n", "model_to_yield", "=", "\"full\"", ",", "modular", "=", "True", ")", "->", "{", "}", ":", "\n", "        ", "\"\"\"\n        Loop over the data examples in GroundedScan and convert them to tensors, also save the lengths\n        for input and target sequences that are needed for padding.\n        :param input_keys:\n        :param input_keys_to_pad:\n        :param target_keys:\n        :param target_keys_to_pad:\n        :param batch_size\n        :param max_examples: how many examples to read maximally, read all if None.\n        :param simple_situation_representation: whether to read the full situation image in RGB or the simplified\n        :param shuffle:\n        :param model_to_yield:\n        :param modular:\n        smaller representation.\n        \"\"\"", "\n", "assert", "isinstance", "(", "batch_size", ",", "int", ")", ",", "\"Provide a batch size.\"", "\n", "assert", "model_to_yield", "in", "[", "\"full\"", "]", "+", "self", ".", "all_modules", "\n", "\n", "logger", ".", "info", "(", "\"Converting dataset to tensors...\"", ")", "\n", "current_examples_batch", "=", "np", ".", "array", "(", "[", "]", ")", "\n", "current_lengths_batch", "=", "{", "\n", "\"adverb_input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"adverb_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"transitive_input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"transitive_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"planner_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"dummy_planner_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"final_input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", "\n", "}", "\n", "for", "i", ",", "example", "in", "enumerate", "(", "self", ".", "dataset", ".", "get_examples_with_image", "(", "\n", "self", ".", "split", ",", "shuffle", "=", "shuffle", ",", "simple_situation_representation", "=", "simple_situation_representation", ",", "\n", "adverb_inputs", "=", "modular", ")", ")", ":", "\n", "            ", "if", "max_examples", ":", "\n", "                ", "if", "len", "(", "self", ".", "_examples", ")", ">", "max_examples", ":", "\n", "                    ", "return", "\n", "", "", "empty_example", "=", "{", "}", "\n", "\n", "if", "modular", ":", "\n", "                ", "example", "=", "self", ".", "convert_example_for_modularity_alo", "(", "example", ")", "\n", "#  Adverb model input and target TODO: if no adverb?", "\n", "adverb_input", "=", "example", "[", "\"adverb_input\"", "]", "\n", "if", "(", "example", "[", "\"type_adverb\"", "]", "==", "\"movement_rewrite\"", "or", "example", "[", "\"type_adverb\"", "]", "==", "\"movement\"", ")", "and", "not", "self", ".", "collapse_alo", ":", "\n", "# if example[\"type_adverb\"] == \"movement_rewrite\" or example[\"type_adverb\"] == \"movement\":  # TODO: change back for getting back alo", "\n", "                    ", "adverb_target", "=", "[", "]", "\n", "", "else", ":", "\n", "                    ", "adverb_target", "=", "example", "[", "\"adverb_target\"", "]", "\n", "", "if", "not", "example", "[", "\"adverb\"", "]", ":", "\n", "                    ", "adverb_target", "=", "[", "]", "\n", "\n", "", "final_input", "=", "example", "[", "\"adverb_target\"", "]", "\n", "\n", "# Position model input and target", "\n", "", "input_commands", "=", "example", "[", "\"input_command\"", "]", "\n", "situation_image", "=", "example", "[", "\"situation_image\"", "]", "\n", "grid_size", "=", "example", "[", "\"situation_representation\"", "]", "[", "\"grid_size\"", "]", "\n", "agent_position", "=", "example", "[", "\"situation_representation\"", "]", "[", "\"agent_position\"", "]", "\n", "agent_direction", "=", "example", "[", "\"situation_representation\"", "]", "[", "\"agent_direction\"", "]", "\n", "agent_position_representation", "=", "(", "int", "(", "agent_position", "[", "\"row\"", "]", ")", "*", "grid_size", ")", "+", "int", "(", "agent_position", "[", "\"column\"", "]", ")", "\n", "target_position", "=", "example", "[", "\"situation_representation\"", "]", "[", "\"target_object\"", "]", "[", "\"position\"", "]", "\n", "target_position_representation", "=", "(", "int", "(", "target_position", "[", "\"row\"", "]", ")", "*", "grid_size", ")", "+", "int", "(", "target_position", "[", "\"column\"", "]", ")", "\n", "\n", "if", "modular", ":", "\n", "# Planner model input=positions/direction and target", "\n", "# planner_target = self.remove_transitive_verbs(adverb_input)", "\n", "                ", "planner_target", "=", "example", "[", "\"planner_target\"", "]", "\n", "# Transitive model input=planner_target and target", "\n", "transitive_target", "=", "example", "[", "\"interaction_target\"", "]", "if", "example", "[", "\"verb_in_command\"", "]", "in", "self", ".", "transitive_verbs", "else", "[", "]", "\n", "dummy_planner_target", "=", "self", ".", "make_dummy_sequence_planner_target", "(", "example", ",", "sequence", "=", "False", ")", "\n", "dummy_sequence_planner_target", "=", "self", ".", "make_dummy_sequence_planner_target", "(", "example", ",", "sequence", "=", "True", ")", "\n", "# dummy_sequence_planner_target = example[\"planner_target\"][0:1]", "\n", "if", "example", "[", "\"verb_in_command\"", "]", "==", "\"pull\"", ":", "\n", "                    ", "dummy_interaction_target", "=", "transitive_target", "\n", "", "elif", "example", "[", "\"verb_in_command\"", "]", "==", "\"push\"", ":", "\n", "                    ", "dummy_interaction_target", "=", "transitive_target", "\n", "", "else", ":", "\n", "                    ", "dummy_interaction_target", "=", "transitive_target", "\n", "\n", "# Final input=adverb_target and target", "\n", "", "", "target_commands", "=", "example", "[", "\"target_command\"", "]", "\n", "# if example[\"adverb\"] == \"cautiously\" or example[\"adverb\"] == \"hesitantly\" or example[\"type_adverb\"] == \"nonmovement_first_person\":", "\n", "if", "example", "[", "\"type_adverb\"", "]", "==", "\"nonmovement_first_person\"", "and", "not", "self", ".", "collapse_alo", ":", "\n", "                ", "target_commands", "=", "[", "]", "\n", "", "if", "not", "example", "[", "\"adverb\"", "]", ":", "\n", "                ", "target_commands", "=", "[", "]", "\n", "", "adverb_embedding", "=", "self", ".", "adverb_vocabulary", ".", "word_to_idx", "(", "example", "[", "\"adverb\"", "]", ")", "\n", "\n", "example_information", "=", "{", "\n", "\"command\"", ":", "example", "[", "\"input_command\"", "]", ",", "\n", "\"adverb\"", ":", "example", "[", "\"adverb\"", "]", ",", "\n", "\"type_adverb\"", ":", "example", "[", "\"type_adverb\"", "]", "if", "modular", "else", "None", ",", "\n", "\"adverb_input\"", ":", "adverb_input", "if", "modular", "else", "None", ",", "\n", "\"adverb_target\"", ":", "adverb_target", "if", "modular", "else", "None", ",", "\n", "\"final_input\"", ":", "final_input", "if", "modular", "else", "None", ",", "\n", "\"target_command\"", ":", "example", "[", "\"target_command\"", "]", ",", "\n", "\"verb_in_command\"", ":", "example", "[", "\"verb_in_command\"", "]", "if", "modular", "else", "None", ",", "\n", "\"derivation_representation\"", ":", "example", "[", "\"derivation_representation\"", "]", ",", "\n", "\"situation_representation\"", ":", "example", "[", "\"situation_representation\"", "]", "\n", "}", "\n", "\n", "# Position model sequence", "\n", "input_array", "=", "self", ".", "sentence_to_array", "(", "input_commands", ",", "vocabulary", "=", "\"input\"", ")", "\n", "\n", "# Final model sequence", "\n", "target_array", "=", "self", ".", "sentence_to_array", "(", "target_commands", ",", "vocabulary", "=", "\"target\"", ")", "\n", "\n", "if", "modular", ":", "\n", "# Planner model sequence", "\n", "                ", "planner_target_array", "=", "self", ".", "sentence_to_array", "(", "planner_target", ",", "vocabulary", "=", "\"planner_target\"", ")", "\n", "dummy_planner_target_array", "=", "self", ".", "sentence_to_array", "(", "dummy_sequence_planner_target", ",", "\n", "vocabulary", "=", "\"planner_target\"", ")", "\n", "\n", "transitive_input_array", "=", "self", ".", "sentence_to_array", "(", "planner_target", ",", "vocabulary", "=", "\"planner_target\"", ")", "\n", "\n", "# Transitive model sequence", "\n", "transitive_target_array", "=", "self", ".", "sentence_to_array", "(", "transitive_target", ",", "vocabulary", "=", "\"transitive_target\"", ")", "\n", "dummy_interaction_target_array", "=", "self", ".", "sentence_to_array", "(", "dummy_interaction_target", ",", "\n", "vocabulary", "=", "\"transitive_target\"", ")", "\n", "\n", "# Adverb model sequences", "\n", "adverb_state", "=", "self", ".", "adverb_vocabulary", ".", "word_to_idx", "(", "example", "[", "\"adverb\"", "]", ")", "\n", "adverb_input_array", "=", "self", ".", "sentence_to_array", "(", "adverb_input", ",", "vocabulary", "=", "\"adverb_input\"", ")", "\n", "adverb_target_array", "=", "self", ".", "sentence_to_array", "(", "adverb_target", ",", "vocabulary", "=", "\"adverb_target\"", ")", "\n", "\n", "final_input_array", "=", "self", ".", "sentence_to_array", "(", "final_input", ",", "vocabulary", "=", "\"adverb_target\"", ")", "\n", "\n", "num_not_unk_input", "=", "sum", "(", "[", "int", "(", "self", ".", "get_vocabulary", "(", "\"input\"", ")", ".", "contains_word", "(", "word", ")", ")", "\n", "for", "word", "in", "adverb_input", "]", ")", "\n", "self", ".", "_percentage_not_unk", "[", "\"input\"", "]", "[", "\"total\"", "]", "+=", "len", "(", "adverb_input", ")", "\n", "self", ".", "_percentage_not_unk", "[", "\"input\"", "]", "[", "\"not_unk\"", "]", "+=", "num_not_unk_input", "\n", "num_not_unk_adverb", "=", "int", "(", "self", ".", "get_vocabulary", "(", "\"adverb\"", ")", ".", "contains_word", "(", "\n", "example", "[", "\"adverb\"", "]", ")", ")", "\n", "self", ".", "_percentage_not_unk", "[", "\"adverb\"", "]", "[", "\"total\"", "]", "+=", "1", "\n", "self", ".", "_percentage_not_unk", "[", "\"adverb\"", "]", "[", "\"not_unk\"", "]", "+=", "num_not_unk_adverb", "\n", "num_not_unk_target", "=", "sum", "(", "[", "int", "(", "self", ".", "get_vocabulary", "(", "\"adverb_target\"", ")", ".", "contains_word", "(", "word", ")", ")", "\n", "for", "word", "in", "adverb_target", "]", ")", "\n", "self", ".", "_percentage_not_unk", "[", "\"target\"", "]", "[", "\"total\"", "]", "+=", "len", "(", "adverb_target", ")", "\n", "self", ".", "_percentage_not_unk", "[", "\"target\"", "]", "[", "\"not_unk\"", "]", "+=", "num_not_unk_target", "\n", "# Planner model tensor", "\n", "empty_example", "[", "\"planner_target_tensor\"", "]", "=", "torch", ".", "tensor", "(", "planner_target_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"dummy_planner_target_tensor\"", "]", "=", "torch", ".", "tensor", "(", "dummy_planner_target_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "\n", "# Transitive model tensor", "\n", "empty_example", "[", "\"transitive_input_tensor\"", "]", "=", "torch", ".", "tensor", "(", "transitive_input_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"transitive_target_tensor\"", "]", "=", "torch", ".", "tensor", "(", "transitive_target_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "\n", "# Adverb model tensors", "\n", "empty_example", "[", "\"adverb_input_tensor\"", "]", "=", "torch", ".", "tensor", "(", "adverb_input_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"adverb_state\"", "]", "=", "torch", ".", "tensor", "(", "adverb_state", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"adverb_target_tensor\"", "]", "=", "torch", ".", "tensor", "(", "adverb_target_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"final_input_tensor\"", "]", "=", "torch", ".", "tensor", "(", "final_input_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "current_lengths_batch", "[", "\"adverb_input_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "current_lengths_batch", "[", "\"adverb_input_tensor_lengths\"", "]", ",", "\n", "[", "len", "(", "adverb_input_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"adverb_target_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"adverb_target_tensor_lengths\"", "]", ",", "[", "len", "(", "adverb_target_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"planner_target_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"planner_target_tensor_lengths\"", "]", ",", "[", "len", "(", "planner_target_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"dummy_planner_target_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"dummy_planner_target_tensor_lengths\"", "]", ",", "[", "len", "(", "dummy_planner_target_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"transitive_input_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"transitive_input_tensor_lengths\"", "]", ",", "[", "len", "(", "transitive_input_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"transitive_target_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"transitive_target_tensor_lengths\"", "]", ",", "[", "len", "(", "transitive_target_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"final_input_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"final_input_tensor_lengths\"", "]", ",", "[", "len", "(", "final_input_array", ")", "]", ")", "\n", "empty_example", "[", "\"dummy_planner_target\"", "]", "=", "torch", ".", "tensor", "(", "dummy_planner_target", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"dummy_interaction_target\"", "]", "=", "torch", ".", "tensor", "(", "dummy_interaction_target_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "\n", "# Position model tensors", "\n", "", "empty_example", "[", "\"input_tensor\"", "]", "=", "torch", ".", "tensor", "(", "input_array", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"world_state_tensor\"", "]", "=", "torch", ".", "tensor", "(", "situation_image", ",", "dtype", "=", "torch", ".", "float", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"agent_position\"", "]", "=", "torch", ".", "tensor", "(", "agent_position_representation", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"target_position\"", "]", "=", "torch", ".", "tensor", "(", "target_position_representation", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"agent_direction\"", "]", "=", "torch", ".", "tensor", "(", "agent_direction", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"adverb_embedding\"", "]", "=", "torch", ".", "tensor", "(", "adverb_embedding", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "\n", "# Final model tensor", "\n", "empty_example", "[", "\"target_tensor\"", "]", "=", "torch", ".", "tensor", "(", "target_array", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "\n", "empty_example", "[", "\"example_information\"", "]", "=", "example_information", "\n", "\n", "current_lengths_batch", "[", "\"input_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"input_tensor_lengths\"", "]", ",", "[", "len", "(", "input_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"target_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"target_tensor_lengths\"", "]", ",", "[", "len", "(", "target_array", ")", "]", ")", "\n", "\n", "current_examples_batch", "=", "np", ".", "append", "(", "current_examples_batch", ",", "[", "empty_example", "]", ")", "\n", "if", "len", "(", "current_examples_batch", ")", "==", "batch_size", ":", "\n", "                ", "if", "modular", ":", "\n", "                    ", "if", "model_to_yield", "!=", "\"full\"", ":", "\n", "                        ", "input_keys_to_pad_d", "=", "{", "input_key_to_pad", ":", "current_lengths_batch", "[", "input_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "input_key_to_pad", "in", "input_keys_to_pad", "}", "\n", "target_keys_to_pad_d", "=", "{", "target_key_to_pad", ":", "current_lengths_batch", "[", "target_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "target_key_to_pad", "in", "target_keys_to_pad", "}", "\n", "yield", "self", ".", "make_modular_batch", "(", "current_examples_batch", ",", "input_keys", ",", "input_keys_to_pad_d", ",", "\n", "target_keys", ",", "target_keys_to_pad_d", ")", "\n", "", "else", ":", "\n", "                        ", "batches", "=", "{", "}", "\n", "for", "model_name", "in", "input_keys_to_pad", ".", "keys", "(", ")", ":", "\n", "                            ", "input_keys_to_pad_d", "=", "{", "\n", "input_key_to_pad", ":", "current_lengths_batch", "[", "input_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "input_key_to_pad", "in", "input_keys_to_pad", "[", "model_name", "]", "}", "\n", "target_keys_to_pad_d", "=", "{", "\n", "target_key_to_pad", ":", "current_lengths_batch", "[", "target_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "target_key_to_pad", "in", "target_keys_to_pad", "[", "model_name", "]", "}", "\n", "batch", "=", "self", ".", "make_modular_batch", "(", "current_examples_batch", ",", "input_keys", "[", "model_name", "]", ",", "\n", "input_keys_to_pad_d", ",", "target_keys", "[", "model_name", "]", ",", "\n", "target_keys_to_pad_d", ")", "\n", "batches", "[", "model_name", "]", "=", "batch", "\n", "", "yield", "batches", "\n", "", "", "else", ":", "\n", "                    ", "if", "model_to_yield", "==", "\"full\"", ":", "\n", "                        ", "batches", "=", "{", "}", "\n", "for", "model_name", "in", "input_keys_to_pad", ".", "keys", "(", ")", ":", "\n", "                            ", "input_keys_to_pad_d", "=", "{", "\n", "input_key_to_pad", ":", "current_lengths_batch", "[", "input_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "input_key_to_pad", "in", "input_keys_to_pad", "[", "model_name", "]", "}", "\n", "target_keys_to_pad_d", "=", "{", "\n", "target_key_to_pad", ":", "current_lengths_batch", "[", "target_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "target_key_to_pad", "in", "target_keys_to_pad", "[", "model_name", "]", "}", "\n", "batch", "=", "self", ".", "make_batch", "(", "current_examples_batch", ",", "input_keys", "[", "model_name", "]", ",", "\n", "input_keys_to_pad_d", ",", "target_keys", "[", "model_name", "]", ",", "\n", "target_keys_to_pad_d", ")", "\n", "batches", "[", "model_name", "]", "=", "batch", "\n", "", "yield", "batches", "\n", "", "else", ":", "\n", "                        ", "input_keys_to_pad_d", "=", "{", "input_key_to_pad", ":", "current_lengths_batch", "[", "input_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "input_key_to_pad", "in", "input_keys_to_pad", "}", "\n", "target_keys_to_pad_d", "=", "{", "target_key_to_pad", ":", "current_lengths_batch", "[", "target_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "target_key_to_pad", "in", "target_keys_to_pad", "}", "\n", "yield", "self", ".", "make_modular_batch", "(", "current_examples_batch", ",", "input_keys", ",", "input_keys_to_pad_d", ",", "\n", "target_keys", ",", "target_keys_to_pad_d", ")", "\n", "", "", "current_examples_batch", "=", "np", ".", "array", "(", "[", "]", ")", "\n", "current_lengths_batch", "=", "{", "\n", "\"adverb_input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"adverb_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"transitive_input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"transitive_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"planner_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"dummy_planner_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"final_input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.ModularDataset.make_modular_batch": [[681, 734], ["inputs.items", "input_keys_to_pad.items", "targets.items", "target_keys_to_pad.items", "list", "list", "extra_information_batch.append", "torch.cat", "torch.cat", "len", "input_keys_to_pad.keys", "target_keys_to_pad.keys", "numpy.max", "torch.cat", "inputs[].append", "inputs[].append", "numpy.max", "torch.cat", "targets[].append", "targets[].append", "example[].size", "example[].size", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros", "torch.zeros", "int", "int"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "", "", "def", "make_modular_batch", "(", "self", ",", "examples", ":", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ",", "input_keys", ":", "List", "[", "str", "]", ",", "\n", "input_keys_to_pad", ":", "Dict", "[", "str", ",", "np", ".", "ndarray", "]", ",", "target_keys", ":", "List", "[", "str", "]", ",", "\n", "target_keys_to_pad", ":", "Dict", "[", "str", ",", "np", ".", "ndarray", "]", ")", ":", "\n", "        ", "\"\"\"\n        Prepare a batch of inputs and targets for module=position.\n        :param examples: a dict with inputs in tensor form and other information about the examples\n        :param input_keys:\n        :param input_keys_to_pad:\n        :param target_keys:\n        :param target_keys_to_pad:\n        :return: a batch with inputs, targets, and extra information about the examples (needed for writing predictions)\n        \"\"\"", "\n", "all_input_keys", "=", "input_keys", "+", "list", "(", "input_keys_to_pad", ".", "keys", "(", ")", ")", "\n", "all_target_keys", "=", "target_keys", "+", "list", "(", "target_keys_to_pad", ".", "keys", "(", ")", ")", "\n", "inputs", "=", "{", "key", ":", "[", "]", "for", "key", "in", "all_input_keys", "}", "\n", "targets", "=", "{", "key", "+", "\"_targets\"", ":", "[", "]", "for", "key", "in", "all_target_keys", "}", "\n", "extra_information_batch", "=", "[", "]", "\n", "for", "example", "in", "examples", ":", "\n", "            ", "for", "key", "in", "input_keys_to_pad", ":", "\n", "                ", "max_input_length", "=", "np", ".", "max", "(", "input_keys_to_pad", "[", "key", "]", ")", "\n", "to_pad_input", "=", "max_input_length", "-", "example", "[", "key", "]", ".", "size", "(", "1", ")", "\n", "padded_input", "=", "torch", ".", "cat", "(", "[", "\n", "example", "[", "key", "]", ",", "\n", "torch", ".", "zeros", "(", "int", "(", "to_pad_input", ")", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "0", ")", "]", ",", "dim", "=", "1", ")", "\n", "inputs", "[", "key", "]", ".", "append", "(", "padded_input", ")", "\n", "", "for", "key", "in", "input_keys", ":", "\n", "                ", "inputs", "[", "key", "]", ".", "append", "(", "example", "[", "key", "]", ")", "\n", "", "for", "key", "in", "target_keys_to_pad", ":", "\n", "                ", "max_target_length", "=", "np", ".", "max", "(", "target_keys_to_pad", "[", "key", "]", ")", "\n", "to_pad_target", "=", "max_target_length", "-", "example", "[", "key", "]", ".", "size", "(", "1", ")", "\n", "padded_target", "=", "torch", ".", "cat", "(", "[", "\n", "example", "[", "key", "]", ",", "\n", "torch", ".", "zeros", "(", "int", "(", "to_pad_target", ")", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "0", ")", "]", ",", "dim", "=", "1", ")", "\n", "targets", "[", "key", "+", "\"_targets\"", "]", ".", "append", "(", "padded_target", ")", "\n", "", "for", "key", "in", "target_keys", ":", "\n", "                ", "targets", "[", "key", "+", "\"_targets\"", "]", ".", "append", "(", "example", "[", "key", "]", ")", "\n", "", "extra_information_batch", ".", "append", "(", "example", ")", "\n", "\n", "", "for", "input_key", ",", "input_values", "in", "inputs", ".", "items", "(", ")", ":", "\n", "            ", "input_batch", "=", "torch", ".", "cat", "(", "input_values", ",", "dim", "=", "0", ")", "\n", "inputs", "[", "input_key", "]", "=", "input_batch", "\n", "", "for", "input_key", ",", "input_lengths", "in", "input_keys_to_pad", ".", "items", "(", ")", ":", "\n", "            ", "inputs", "[", "input_key", "+", "\"_lengths\"", "]", "=", "input_lengths", "\n", "", "for", "target_key", ",", "target_values", "in", "targets", ".", "items", "(", ")", ":", "\n", "            ", "target_batch", "=", "torch", ".", "cat", "(", "target_values", ",", "dim", "=", "0", ")", "\n", "targets", "[", "target_key", "]", "=", "target_batch", "\n", "", "for", "target_key", ",", "target_lengths", "in", "target_keys_to_pad", ".", "items", "(", ")", ":", "\n", "            ", "targets", "[", "target_key", "+", "\"_lengths\"", "]", "=", "target_keys_to_pad", "[", "target_key", "]", "\n", "", "return", "{", "\n", "\"inputs\"", ":", "inputs", ",", "\n", "\"targets\"", ":", "targets", ",", "\n", "\"batch_size\"", ":", "len", "(", "examples", ")", ",", "\n", "\"extra_information\"", ":", "extra_information_batch", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset.ModularDataset.make_batch": [[736, 799], ["inputs.items", "input_keys_to_pad.items", "targets.items", "target_keys_to_pad.items", "list", "list", "extra_information_batch.append", "len", "len", "len", "input_keys_to_pad.keys", "target_keys_to_pad.keys", "torch.cat", "torch.cat", "numpy.max", "torch.cat", "inputs[].append", "inputs[].append", "numpy.max", "torch.cat", "targets[].append", "targets[].append", "example[].size", "example[].size", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros", "torch.zeros", "int", "int"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "make_batch", "(", "self", ",", "examples", ":", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ",", "input_keys", ":", "List", "[", "str", "]", ",", "\n", "input_keys_to_pad", ":", "Dict", "[", "str", ",", "np", ".", "ndarray", "]", ",", "target_keys", ":", "List", "[", "str", "]", ",", "\n", "target_keys_to_pad", ":", "Dict", "[", "str", ",", "np", ".", "ndarray", "]", ")", ":", "\n", "        ", "\"\"\"\n        Prepare a batch of inputs and targets for module=position.\n        :param examples: a dict with inputs in tensor form and other information about the examples\n        :param input_keys:\n        :param input_keys_to_pad:\n        :param target_keys:\n        :param target_keys_to_pad:\n        :return: a batch with inputs, targets, and extra information about the examples (needed for writing predictions)\n        \"\"\"", "\n", "all_input_keys", "=", "input_keys", "+", "list", "(", "input_keys_to_pad", ".", "keys", "(", ")", ")", "\n", "all_target_keys", "=", "target_keys", "+", "list", "(", "target_keys_to_pad", ".", "keys", "(", ")", ")", "\n", "inputs", "=", "{", "key", ":", "[", "]", "for", "key", "in", "all_input_keys", "}", "\n", "targets", "=", "{", "key", "+", "\"_targets\"", ":", "[", "]", "for", "key", "in", "all_target_keys", "}", "\n", "extra_information_batch", "=", "[", "]", "\n", "for", "example", "in", "examples", ":", "\n", "            ", "for", "key", "in", "input_keys_to_pad", ":", "\n", "                ", "if", "key", "==", "\"input_tensor\"", ":", "\n", "                    ", "max_input_length", "=", "np", ".", "max", "(", "input_keys_to_pad", "[", "key", "]", ")", "\n", "to_pad_input", "=", "max_input_length", "-", "example", "[", "key", "]", ".", "size", "(", "1", ")", "\n", "padded_input", "=", "torch", ".", "cat", "(", "[", "\n", "example", "[", "key", "]", ",", "\n", "torch", ".", "zeros", "(", "int", "(", "to_pad_input", ")", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "0", ")", "]", ",", "dim", "=", "1", ")", "\n", "inputs", "[", "key", "]", ".", "append", "(", "padded_input", ")", "\n", "", "", "for", "key", "in", "input_keys", ":", "\n", "                ", "if", "key", "in", "[", "\"world_state_tensor\"", ",", "'agent_position'", ",", "'target_position'", ",", "'agent_direction'", "]", ":", "\n", "                    ", "inputs", "[", "key", "]", ".", "append", "(", "example", "[", "key", "]", ")", "\n", "", "", "for", "key", "in", "target_keys_to_pad", ":", "\n", "                ", "if", "key", "==", "\"target_tensor\"", ":", "\n", "                    ", "max_target_length", "=", "np", ".", "max", "(", "target_keys_to_pad", "[", "key", "]", ")", "\n", "to_pad_target", "=", "max_target_length", "-", "example", "[", "key", "]", ".", "size", "(", "1", ")", "\n", "padded_target", "=", "torch", ".", "cat", "(", "[", "\n", "example", "[", "key", "]", ",", "\n", "torch", ".", "zeros", "(", "int", "(", "to_pad_target", ")", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "0", ")", "]", ",", "dim", "=", "1", ")", "\n", "targets", "[", "key", "+", "\"_targets\"", "]", ".", "append", "(", "padded_target", ")", "\n", "", "", "for", "key", "in", "target_keys", ":", "\n", "                ", "if", "key", "in", "[", "'agent_position'", ",", "'target_position'", ",", "'agent_direction'", "]", ":", "\n", "                    ", "targets", "[", "key", "+", "\"_targets\"", "]", ".", "append", "(", "example", "[", "key", "]", ")", "\n", "", "", "extra_information_batch", ".", "append", "(", "example", ")", "\n", "\n", "", "for", "input_key", ",", "input_values", "in", "inputs", ".", "items", "(", ")", ":", "\n", "            ", "if", "len", "(", "input_values", ")", ":", "\n", "                ", "input_batch", "=", "torch", ".", "cat", "(", "input_values", ",", "dim", "=", "0", ")", "\n", "", "else", ":", "\n", "                ", "input_batch", "=", "[", "]", "\n", "", "inputs", "[", "input_key", "]", "=", "input_batch", "\n", "", "for", "input_key", ",", "input_lengths", "in", "input_keys_to_pad", ".", "items", "(", ")", ":", "\n", "            ", "inputs", "[", "input_key", "+", "\"_lengths\"", "]", "=", "input_lengths", "\n", "", "for", "target_key", ",", "target_values", "in", "targets", ".", "items", "(", ")", ":", "\n", "            ", "if", "len", "(", "target_values", ")", ":", "\n", "                ", "target_batch", "=", "torch", ".", "cat", "(", "target_values", ",", "dim", "=", "0", ")", "\n", "", "else", ":", "\n", "                ", "target_batch", "=", "[", "]", "\n", "", "targets", "[", "target_key", "]", "=", "target_batch", "\n", "", "for", "target_key", ",", "target_lengths", "in", "target_keys_to_pad", ".", "items", "(", ")", ":", "\n", "            ", "targets", "[", "target_key", "+", "\"_lengths\"", "]", "=", "target_keys_to_pad", "[", "target_key", "]", "\n", "", "return", "{", "\n", "\"inputs\"", ":", "inputs", ",", "\n", "\"targets\"", ":", "targets", ",", "\n", "\"batch_size\"", ":", "len", "(", "examples", ")", ",", "\n", "\"extra_information\"", ":", "extra_information_batch", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.planner_model.PlannerModel.__init__": [[20, 70], ["torch.Module.__init__", "torch.NLLLoss", "torch.NLLLoss", "torch.NLLLoss", "torch.Linear", "torch.Linear", "torch.Linear", "Modularity.nn.MLP", "seq2seq.seq2seq_model.EncoderRNN", "torch.Linear", "torch.Linear", "torch.Linear", "Modularity.nn.LuongDecoder", "torch.Tanh", "torch.Tanh", "torch.Tanh"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input_vocabulary_size", ":", "int", ",", "embedding_dimension", ":", "int", ",", "encoder_hidden_size", ":", "int", ",", "\n", "num_encoder_layers", ":", "int", ",", "encoder_dropout_p", ":", "float", ",", "encoder_bidirectional", ":", "bool", ",", "input_padding_idx", ":", "int", ",", "\n", "output_directory", ":", "str", ",", "decoder_hidden_size", ":", "int", ",", "target_pad_idx", ":", "int", ",", "target_sos_idx", ":", "int", ",", "\n", "target_vocabulary_size", ":", "int", ",", "num_decoder_layers", ":", "int", ",", "decoder_dropout_p", ":", "float", ",", "target_eos_idx", ":", "int", ",", "\n", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "PlannerModel", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "loss_criterion", "=", "nn", ".", "NLLLoss", "(", "ignore_index", "=", "target_pad_idx", ")", "\n", "\n", "self", ".", "input_to_position", "=", "nn", ".", "Linear", "(", "3", ",", "encoder_hidden_size", ")", "\n", "self", ".", "encode_position", "=", "MLP", "(", "input_dim", "=", "encoder_hidden_size", ",", "hidden_dim", "=", "encoder_hidden_size", ",", "\n", "dropout_p", "=", "encoder_dropout_p", ")", "\n", "\n", "# Input: [batch_size, max_input_length]", "\n", "# Output: [batch_size, hidden_size], [batch_size, max_input_length, hidden_size]", "\n", "self", ".", "encoder", "=", "EncoderRNN", "(", "input_size", "=", "input_vocabulary_size", ",", "\n", "embedding_dim", "=", "embedding_dimension", ",", "\n", "rnn_input_size", "=", "embedding_dimension", ",", "\n", "hidden_size", "=", "encoder_hidden_size", ",", "num_layers", "=", "num_encoder_layers", ",", "\n", "dropout_probability", "=", "encoder_dropout_p", ",", "bidirectional", "=", "encoder_bidirectional", ",", "\n", "padding_idx", "=", "input_padding_idx", ")", "\n", "\n", "# Used to project the final encoder state to the decoder hidden state such that it can be initialized with it.", "\n", "self", ".", "enc_hidden_to_dec_hidden", "=", "nn", ".", "Linear", "(", "encoder_hidden_size", "*", "2", ",", "decoder_hidden_size", ")", "\n", "\n", "# Input: [batch_size, max_target_length], initial hidden: ([batch_size, hidden_size], [batch_size, hidden_size])", "\n", "# Input for attention: [batch_size, max_input_length, hidden_size],", "\n", "#                      [batch_size, image_width * image_width, hidden_size]", "\n", "# Output: [max_target_length, batch_size, target_vocabulary_size]", "\n", "self", ".", "attention_decoder", "=", "LuongDecoder", "(", "hidden_size", "=", "decoder_hidden_size", ",", "\n", "output_size", "=", "target_vocabulary_size", ",", "\n", "num_layers", "=", "num_decoder_layers", ",", "\n", "dropout_probability", "=", "decoder_dropout_p", ",", "\n", "padding_idx", "=", "target_pad_idx", ",", "\n", "conditional_attention", "=", "False", ")", "\n", "self", ".", "target_eos_idx", "=", "target_eos_idx", "\n", "self", ".", "target_pad_idx", "=", "target_pad_idx", "\n", "self", ".", "target_sos_idx", "=", "target_sos_idx", "\n", "self", ".", "tanh", "=", "nn", ".", "Tanh", "(", ")", "\n", "self", ".", "output_directory", "=", "output_directory", "\n", "self", ".", "trained_iterations", "=", "0", "\n", "self", ".", "best_iteration", "=", "0", "\n", "self", ".", "best_metric", "=", "0", "\n", "self", ".", "metric", "=", "\"exact match\"", "\n", "\n", "self", ".", "input_keys", "=", "[", "\"agent_position\"", ",", "\"target_position\"", ",", "\"agent_direction\"", "]", "\n", "self", ".", "input_keys_to_pad", "=", "[", "\"input_tensor\"", "]", "\n", "self", ".", "target_keys", "=", "[", "]", "\n", "self", ".", "target_keys_to_pad", "=", "[", "\"planner_target_tensor\"", "]", "\n", "self", ".", "sequence_decoder", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.planner_model.PlannerModel.remove_start_of_sequence": [[71, 79], ["input_tensor.size", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "@", "staticmethod", "\n", "def", "remove_start_of_sequence", "(", "input_tensor", ":", "torch", ".", "Tensor", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "\"\"\"Get rid of SOS-tokens in targets batch and append a padding token to each example in the batch.\"\"\"", "\n", "batch_size", ",", "max_time", "=", "input_tensor", ".", "size", "(", ")", "\n", "input_tensor", "=", "input_tensor", "[", ":", ",", "1", ":", "]", "\n", "output_tensor", "=", "torch", ".", "cat", "(", "[", "input_tensor", ",", "torch", ".", "zeros", "(", "batch_size", ",", "device", "=", "device", ",", "dtype", "=", "torch", ".", "long", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "1", ")", "]", ",", "dim", "=", "1", ")", "\n", "return", "output_tensor", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.planner_model.PlannerModel.get_metrics": [[80, 104], ["torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "planner_model.PlannerModel.remove_start_of_sequence", "mask.sum().data.item", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "match_targets.sum", "mask.sum", "mask.sum.size", "match_targets.sum().data.item", "planner_target_tensor_scores.max", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "mask.sum", "match_targets.sum"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.remove_start_of_sequence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max"], ["", "def", "get_metrics", "(", "self", ",", "planner_target_tensor_scores", ":", "torch", ".", "Tensor", ",", "planner_target_tensor_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "float", "]", ":", "\n", "        ", "\"\"\"\n        :param planner_target_tensor_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param planner_target_tensor_targets:  ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar float of accuracy averaged over sequence length and batch size.\n        \"\"\"", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "targets", "=", "self", ".", "remove_start_of_sequence", "(", "planner_target_tensor_targets", ")", "\n", "mask", "=", "(", "targets", "!=", "self", ".", "target_pad_idx", ")", ".", "long", "(", ")", "\n", "total", "=", "mask", ".", "sum", "(", ")", ".", "data", ".", "item", "(", ")", "\n", "predicted_targets", "=", "planner_target_tensor_scores", ".", "max", "(", "dim", "=", "2", ")", "[", "1", "]", "\n", "equal_targets", "=", "torch", ".", "eq", "(", "targets", ".", "data", ",", "predicted_targets", ".", "data", ")", ".", "long", "(", ")", "\n", "match_targets", "=", "(", "equal_targets", "*", "mask", ")", "\n", "match_sum_per_example", "=", "match_targets", ".", "sum", "(", "dim", "=", "1", ")", "\n", "expected_sum_per_example", "=", "mask", ".", "sum", "(", "dim", "=", "1", ")", "\n", "batch_size", "=", "expected_sum_per_example", ".", "size", "(", "0", ")", "\n", "exact_match", "=", "100.", "*", "(", "match_sum_per_example", "==", "expected_sum_per_example", ")", ".", "sum", "(", ")", ".", "data", ".", "item", "(", ")", "/", "batch_size", "\n", "match_targets_sum", "=", "match_targets", ".", "sum", "(", ")", ".", "data", ".", "item", "(", ")", "\n", "accuracy", "=", "100.", "*", "match_targets_sum", "/", "total", "\n", "", "return", "{", "\n", "\"planner_target_tensor_accuracy\"", ":", "accuracy", ",", "\n", "\"planner_target_tensor_exact_match\"", ":", "exact_match", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.planner_model.PlannerModel.get_loss": [[106, 121], ["planner_model.PlannerModel.remove_start_of_sequence", "planner_target_tensor_scores.size", "planner_target_tensor_scores.reshape", "planner_model.PlannerModel.loss_criterion", "planner_model.PlannerModel.view"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.remove_start_of_sequence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "get_loss", "(", "self", ",", "planner_target_tensor_scores", ":", "torch", ".", "Tensor", ",", "planner_target_tensor_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "\"\"\"\n        :param planner_target_tensor_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param planner_target_tensor_targets: ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar negative log-likelihood loss averaged over the sequence length and batch size.\n        \"\"\"", "\n", "targets", "=", "self", ".", "remove_start_of_sequence", "(", "planner_target_tensor_targets", ")", "\n", "\n", "# Calculate the loss.", "\n", "vocabulary_size", "=", "planner_target_tensor_scores", ".", "size", "(", "2", ")", "\n", "target_scores_2d", "=", "planner_target_tensor_scores", ".", "reshape", "(", "-", "1", ",", "vocabulary_size", ")", "\n", "loss", "=", "self", ".", "loss_criterion", "(", "target_scores_2d", ",", "targets", ".", "view", "(", "-", "1", ")", ")", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.planner_model.PlannerModel.prepare_inputs": [[122, 128], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "agent_direction.unsqueeze", "agent_position.unsqueeze", "target_position.unsqueeze"], "methods", ["None"], ["", "def", "prepare_inputs", "(", "self", ",", "agent_position", ":", "torch", ".", "Tensor", ",", "agent_direction", ":", "torch", ".", "Tensor", ",", "\n", "target_position", ":", "torch", ".", "Tensor", ")", ":", "\n", "        ", "input_tensor", "=", "torch", ".", "cat", "(", "[", "agent_direction", ".", "unsqueeze", "(", "dim", "=", "1", ")", ",", "\n", "agent_position", ".", "unsqueeze", "(", "dim", "=", "1", ")", ",", "\n", "target_position", ".", "unsqueeze", "(", "dim", "=", "1", ")", "]", ",", "dim", "=", "1", ")", "\n", "return", "input_tensor", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.planner_model.PlannerModel.encode_input": [[129, 142], ["planner_model.PlannerModel.prepare_inputs", "planner_model.PlannerModel.input_to_position", "planner_model.PlannerModel.encode_position", "planner_model.PlannerModel.encoder", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "planner_model.PlannerModel.float"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.planner_model.PlannerModel.prepare_inputs"], ["", "def", "encode_input", "(", "self", ",", "input_tensor", ":", "torch", ".", "LongTensor", ",", "input_tensor_lengths", ":", "List", "[", "int", "]", ",", "\n", "agent_position", ":", "torch", ".", "Tensor", ",", "agent_direction", ":", "torch", ".", "Tensor", ",", "\n", "target_position", ":", "torch", ".", "Tensor", ")", "->", "Dict", "[", "str", ",", "Union", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", "]", "]", ":", "\n", "        ", "\"\"\"Pass the input commands through an RNN encoder and the other input through an MLP.\"\"\"", "\n", "position_inputs", "=", "self", ".", "prepare_inputs", "(", "agent_position", ",", "agent_direction", ",", "target_position", ")", "\n", "position_inputs", "=", "self", ".", "input_to_position", "(", "position_inputs", ".", "float", "(", ")", ")", "\n", "encoded_positions", "=", "self", ".", "encode_position", "(", "position_inputs", ")", "\n", "hidden", ",", "encoder_outputs", "=", "self", ".", "encoder", "(", "input_tensor", ",", "input_tensor_lengths", ")", "\n", "initial_hidden", "=", "torch", ".", "cat", "(", "[", "hidden", ",", "encoded_positions", "]", ",", "dim", "=", "1", ")", "\n", "return", "{", "\"encoded_commands\"", ":", "encoder_outputs", ",", "\"hidden_states\"", ":", "hidden", ",", "\n", "\"encoded_positions\"", ":", "encoded_positions", ",", "\"initial_hidden\"", ":", "initial_hidden", ",", "\n", "\"attention_values\"", ":", "encoder_outputs", "[", "\"encoder_outputs\"", "]", ",", "\n", "\"attention_values_lengths\"", ":", "encoder_outputs", "[", "\"sequence_lengths\"", "]", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.planner_model.PlannerModel.decode_step": [[143, 153], ["planner_model.PlannerModel.attention_decoder.forward_step"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.forward_step"], ["", "def", "decode_step", "(", "self", ",", "planner_target_tensor", ":", "torch", ".", "LongTensor", ",", "hidden", ":", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "\n", "attention_values", ":", "torch", ".", "Tensor", ",", "\n", "attention_values_lengths", ":", "List", "[", "int", "]", ",", "**", "kwargs", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "\n", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "\n", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"One decoding step based on the previous hidden state of the decoder and the previous target token.\"\"\"", "\n", "return", "self", ".", "attention_decoder", ".", "forward_step", "(", "target_tokens", "=", "planner_target_tensor", ",", "last_hidden", "=", "hidden", ",", "\n", "attention_keys", "=", "attention_values", ",", "\n", "attention_values_lengths", "=", "attention_values_lengths", ",", "\n", "attention_values", "=", "attention_values", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.planner_model.PlannerModel.decode_input_batched": [[154, 166], ["planner_model.PlannerModel.attention_decoder.initialize_hidden", "planner_model.PlannerModel.attention_decoder", "torch.log_softmax", "torch.log_softmax", "torch.log_softmax", "planner_model.PlannerModel.tanh", "planner_model.PlannerModel.enc_hidden_to_dec_hidden"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.initialize_hidden"], ["", "def", "decode_input_batched", "(", "self", ",", "planner_target_tensor", ":", "torch", ".", "LongTensor", ",", "planner_target_tensor_lengths", ":", "List", "[", "int", "]", ",", "\n", "initial_hidden", ":", "torch", ".", "Tensor", ",", "attention_values", ":", "torch", ".", "Tensor", ",", "\n", "attention_values_lengths", ":", "List", "[", "int", "]", ",", "**", "kwargs", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"Decode a batch of input sequences.\"\"\"", "\n", "initial_hidden", "=", "self", ".", "attention_decoder", ".", "initialize_hidden", "(", "\n", "self", ".", "tanh", "(", "self", ".", "enc_hidden_to_dec_hidden", "(", "initial_hidden", ")", ")", ")", "\n", "decoder_output_batched", ",", "_", ",", "attention_weights", "=", "self", ".", "attention_decoder", "(", "\n", "target_tokens", "=", "planner_target_tensor", ",", "target_lengths", "=", "planner_target_tensor_lengths", ",", "\n", "init_hidden", "=", "initial_hidden", ",", "attention_keys", "=", "attention_values", ",", "attention_values", "=", "attention_values", ",", "\n", "attention_values_lengths", "=", "attention_values_lengths", ")", "\n", "decoder_output_batched", "=", "F", ".", "log_softmax", "(", "decoder_output_batched", ",", "dim", "=", "-", "1", ")", "\n", "return", "decoder_output_batched", ",", "attention_weights", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.planner_model.PlannerModel.forward": [[167, 183], ["planner_model.PlannerModel.encode_input", "planner_model.PlannerModel.decode_input_batched", "decoder_output.transpose"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.encode_input", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.decode_input_batched"], ["", "def", "forward", "(", "self", ",", "input_tensor", ":", "torch", ".", "LongTensor", ",", "input_tensor_lengths", ":", "List", "[", "int", "]", ",", "agent_position", ":", "torch", ".", "Tensor", ",", "\n", "agent_direction", ":", "torch", ".", "Tensor", ",", "target_position", ":", "torch", ".", "Tensor", ",", "planner_target_tensor", ":", "torch", ".", "LongTensor", ",", "\n", "planner_target_tensor_lengths", ":", "List", "[", "int", "]", ")", "->", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "encoder_output", "=", "self", ".", "encode_input", "(", "input_tensor", "=", "input_tensor", ",", "input_tensor_lengths", "=", "input_tensor_lengths", ",", "\n", "agent_position", "=", "agent_position", ",", "agent_direction", "=", "agent_direction", ",", "\n", "target_position", "=", "target_position", ")", "\n", "decoder_output", ",", "attention_weights", "=", "self", ".", "decode_input_batched", "(", "\n", "planner_target_tensor", "=", "planner_target_tensor", ",", "planner_target_tensor_lengths", "=", "planner_target_tensor_lengths", ",", "\n", "initial_hidden", "=", "encoder_output", "[", "\"initial_hidden\"", "]", ",", "\n", "attention_values", "=", "encoder_output", "[", "\"attention_values\"", "]", ",", "\n", "attention_values_lengths", "=", "encoder_output", "[", "\"attention_values_lengths\"", "]", ")", "\n", "# decoder_output: [max_target_length, batch_size, output_size]", "\n", "# attention_weights: [batch_size, max_target_length, max_input_length]", "\n", "return", "{", "\n", "\"planner_target_tensor_scores\"", ":", "decoder_output", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "\"decoder_attention_weights\"", ":", "attention_weights", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.planner_model.PlannerModel.update_state": [[185, 190], ["None"], "methods", ["None"], ["", "def", "update_state", "(", "self", ",", "is_best", ":", "bool", ",", "metric", "=", "None", ")", "->", "{", "}", ":", "\n", "        ", "self", ".", "trained_iterations", "+=", "1", "\n", "if", "is_best", ":", "\n", "            ", "self", ".", "best_metric", "=", "metric", "\n", "self", ".", "best_iteration", "=", "self", ".", "trained_iterations", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.planner_model.PlannerModel.load_model": [[191, 199], ["torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "planner_model.PlannerModel.load_state_dict"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load"], ["", "", "def", "load_model", "(", "self", ",", "path_to_checkpoint", ":", "str", ")", "->", "dict", ":", "\n", "        ", "checkpoint", "=", "torch", ".", "load", "(", "path_to_checkpoint", ")", "\n", "self", ".", "trained_iterations", "=", "checkpoint", "[", "\"iteration\"", "]", "\n", "self", ".", "best_iteration", "=", "checkpoint", "[", "\"best_iteration\"", "]", "\n", "self", ".", "load_state_dict", "(", "checkpoint", "[", "\"state_dict\"", "]", ")", "\n", "self", ".", "best_metric", "=", "checkpoint", "[", "\"best_metric\"", "]", "\n", "self", ".", "metric", "=", "\"exact match\"", "\n", "return", "checkpoint", "[", "\"optimizer_state_dict\"", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.planner_model.PlannerModel.get_current_state": [[200, 207], ["planner_model.PlannerModel.state_dict"], "methods", ["None"], ["", "def", "get_current_state", "(", "self", ")", ":", "\n", "        ", "return", "{", "\n", "\"iteration\"", ":", "self", ".", "trained_iterations", ",", "\n", "\"state_dict\"", ":", "self", ".", "state_dict", "(", ")", ",", "\n", "\"best_iteration\"", ":", "self", ".", "best_iteration", ",", "\n", "\"best_metric\"", ":", "self", ".", "best_metric", ",", "\n", "\"metric\"", ":", "\"exact match\"", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.planner_model.PlannerModel.save_checkpoint": [[209, 225], ["os.path.join", "planner_model.PlannerModel.get_current_state", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "os.path.join", "shutil.copyfile"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_current_state", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save"], ["", "def", "save_checkpoint", "(", "self", ",", "file_name", ":", "str", ",", "is_best", ":", "bool", ",", "optimizer_state_dict", ":", "dict", ")", "->", "str", ":", "\n", "        ", "\"\"\"\n\n        :param file_name: filename to save checkpoint in.\n        :param is_best: boolean describing whether or not the current state is the best the model has ever been.\n        :param optimizer_state_dict: state of the optimizer.\n        :return: str to path where the model is saved.\n        \"\"\"", "\n", "path", "=", "os", ".", "path", ".", "join", "(", "self", ".", "output_directory", ",", "file_name", ")", "\n", "state", "=", "self", ".", "get_current_state", "(", ")", "\n", "state", "[", "\"optimizer_state_dict\"", "]", "=", "optimizer_state_dict", "\n", "torch", ".", "save", "(", "state", ",", "path", ")", "\n", "if", "is_best", ":", "\n", "            ", "best_path", "=", "os", ".", "path", ".", "join", "(", "self", ".", "output_directory", ",", "'model_best.pth.tar'", ")", "\n", "shutil", ".", "copyfile", "(", "path", ",", "best_path", ")", "\n", "", "return", "path", "\n", "", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.MLP.__init__": [[15, 25], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["\n", "self", ".", "depth", "=", "depth", "\n", "self", ".", "inner", "=", "nn", ".", "Linear", "(", "input_dim", ",", "hidden_dim", ")", "\n", "if", "depth", ">", "1", ":", "\n", "            ", "self", ".", "outer", "=", "nn", ".", "Linear", "(", "hidden_dim", ",", "output_dim", ")", "\n", "\n", "", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "p", "=", "dropout_p", ")", "\n", "self", ".", "activation", "=", "activation", "\n", "\n", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "if", "self", ".", "depth", ">", "1", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.MLP.forward": [[26, 31], ["torch.MLP.outer", "torch.MLP.activation", "torch.MLP.activation", "torch.MLP.inner", "torch.MLP.inner"], "methods", ["None"], ["            ", "return", "self", ".", "outer", "(", "self", ".", "activation", "(", "self", ".", "inner", "(", "x", ")", ")", ")", "\n", "", "else", ":", "\n", "            ", "return", "self", ".", "activation", "(", "self", ".", "inner", "(", "x", ")", ")", "\n", "\n", "\n", "", "", "", "def", "get_exact_match", "(", "predictions", ",", "prediction_lengths", ",", "targets_no_sos", ",", "target_lengths_no_sos", ")", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.LearnedAttention.__init__": [[76, 81], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["self", ".", "energy_layer", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "1", ",", "bias", "=", "False", ")", "\n", "\n", "", "def", "forward", "(", "self", ",", "queries", ":", "torch", ".", "Tensor", ",", "keys", ":", "torch", ".", "Tensor", ",", "values", ":", "torch", ".", "Tensor", ",", "\n", "memory_lengths", ":", "List", "[", "int", "]", ")", ":", "\n", "        "]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.LearnedAttention.forward": [[82, 119], ["torch.LearnedAttention.key_layer", "torch.LearnedAttention.key_layer", "torch.LearnedAttention.size", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.LearnedAttention.query_layer", "torch.LearnedAttention.energy_layer", "scores.masked_fill.masked_fill.squeeze().unsqueeze", "nn.sequence_mask", "mask.unsqueeze.unsqueeze.unsqueeze", "scores.masked_fill.masked_fill.masked_fill", "torch.softmax", "torch.softmax", "torch.softmax", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "len", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "float", "scores.masked_fill.masked_fill.squeeze"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.sequence_mask"], ["\n", "projected_keys", "=", "self", ".", "key_layer", "(", "keys", ")", "\n", "values", "=", "self", ".", "key_layer", "(", "values", ")", "\n", "batch_size", "=", "projected_keys", ".", "size", "(", "0", ")", "\n", "assert", "len", "(", "memory_lengths", ")", "==", "batch_size", "\n", "memory_lengths", "=", "torch", ".", "tensor", "(", "memory_lengths", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", "\n", "\n", "# Project queries down to the correct dimension.", "\n", "# [bsz, 1, query_dimension] X [bsz, query_dimension, hidden_dim] = [bsz, 1, hidden_dim]", "\n", "queries", "=", "self", ".", "query_layer", "(", "queries", ")", "\n", "\n", "# [bsz, 1, query_dim] X [bsz, query_dim, num_memory] = [bsz, num_memory, 1]", "\n", "scores", "=", "self", ".", "energy_layer", "(", "torch", ".", "tanh", "(", "queries", "+", "projected_keys", ")", ")", "\n", "scores", "=", "scores", ".", "squeeze", "(", "2", ")", ".", "unsqueeze", "(", "1", ")", "\n", "\n", "# Mask out keys that are on a padding location.encoded_commands", "\n", "mask", "=", "sequence_mask", "(", "memory_lengths", ")", "# [batch_size, num_memory]", "\n", "mask", "=", "mask", ".", "unsqueeze", "(", "1", ")", "# [batch_size, 1, num_memory]", "\n", "scores", "=", "scores", ".", "masked_fill", "(", "mask", "==", "0", ",", "float", "(", "'-inf'", ")", ")", "# fill with large negative numbers", "\n", "attention_weights", "=", "F", ".", "softmax", "(", "scores", ",", "dim", "=", "2", ")", "# [batch_size, 1, num_memory]", "\n", "\n", "# [bsz, 1, num_memory] X\u00a0[bsz, num_memory, value_dim] = [bsz, 1, value_dim]", "\n", "soft_values_retrieval", "=", "torch", ".", "bmm", "(", "attention_weights", ",", "values", ")", "\n", "return", "soft_values_retrieval", ",", "attention_weights", "\n", "\n", "\n", "", "", "class", "Attention", "(", "nn", ".", "Module", ")", ":", "\n", "\n", "    ", "def", "__init__", "(", "self", ",", "rescale", "=", "False", ")", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.Attention.__init__": [[123, 129], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["super", "(", "Attention", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "rescale", "=", "rescale", "\n", "\n", "", "def", "forward", "(", "self", ",", "queries", ":", "torch", ".", "Tensor", ",", "keys", ":", "torch", ".", "Tensor", ",", "values", ":", "torch", ".", "Tensor", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "\n", "torch", ".", "Tensor", "]", ":", "\n", "        "]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.Attention.forward": [[130, 152], ["torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.softmax", "torch.softmax", "torch.softmax", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "keys.transpose", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.div", "torch.div", "torch.div", "torch.div", "torch.div", "torch.div", "torch.div", "torch.div", "torch.div", "float", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "queries.size"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["\n", "# [batch_size, n_queries, query_dim] X [batch_size, query_dim, n_memory] -> [batch_size, n_queries, n_memory]", "\n", "attention_weights", "=", "torch", ".", "bmm", "(", "queries", ",", "keys", ".", "transpose", "(", "1", ",", "2", ")", ")", "\n", "if", "self", ".", "rescale", ":", "\n", "            ", "query_dim", "=", "torch", ".", "tensor", "(", "float", "(", "queries", ".", "size", "(", "2", ")", ")", ",", "device", "=", "device", ")", "\n", "attention_weights", "=", "torch", ".", "div", "(", "attention_weights", ",", "torch", ".", "sqrt", "(", "query_dim", ")", ")", "\n", "# [batch_size, n_queries, n_memory]", "\n", "", "attention_weights", "=", "F", ".", "softmax", "(", "attention_weights", ",", "dim", "=", "2", ")", "\n", "# [batch_size, n_queries, n_memory] X [batch_size, n_memory, value_dim] -> [batch_size, n_queries, value_dim]", "\n", "retrieved_values", "=", "torch", ".", "bmm", "(", "attention_weights", ",", "values", ")", "\n", "return", "retrieved_values", ",", "attention_weights", "\n", "\n", "", "def", "forward_mask", "(", "self", ",", "queries", ":", "torch", ".", "Tensor", ",", "keys", ":", "torch", ".", "Tensor", ",", "values", ":", "torch", ".", "Tensor", ",", "\n", "memory_length", ":", "List", "[", "int", "]", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ":", "\n", "        "]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.Attention.forward_mask": [[153, 187], ["torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "keys.size", "keys.size", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "nn.sequence_mask", "mask.unsqueeze().expand_as.unsqueeze().expand_as.unsqueeze().expand_as", "torch.div.masked_fill", "torch.div.masked_fill", "torch.div.masked_fill", "torch.softmax", "torch.softmax", "torch.softmax", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "float", "len", "keys.transpose", "torch.div", "torch.div", "torch.div", "torch.div", "torch.div", "torch.div", "torch.div", "torch.div", "torch.div", "queries.size", "len", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "torch.sqrt", "mask.unsqueeze().expand_as.unsqueeze().expand_as.unsqueeze"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.sequence_mask", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["\n", "query_dim", "=", "torch", ".", "tensor", "(", "float", "(", "queries", ".", "size", "(", "2", ")", ")", ",", "device", "=", "device", ")", "\n", "n_memory", "=", "keys", ".", "size", "(", "1", ")", "\n", "batch_size", "=", "keys", ".", "size", "(", "0", ")", "\n", "assert", "len", "(", "memory_length", ")", "==", "batch_size", ",", "\"Not enough lengths (%d) provided for batch size (%d) in \"", "\"Attention\"", "\".forward_mask()\"", "%", "(", "len", "(", "memory_length", ")", ",", "batch_size", ")", "\n", "memory_length", "=", "torch", ".", "tensor", "(", "memory_length", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", "\n", "# [batch_size, n_queries, query_dim] x [batch_size, query_dim, n_memory] -> [batch_size, n_queries, n_memory]", "\n", "attention_weights", "=", "torch", ".", "bmm", "(", "queries", ",", "keys", ".", "transpose", "(", "1", ",", "2", ")", ")", "\n", "if", "self", ".", "rescale", ":", "\n", "            ", "attention_weights", "=", "torch", ".", "div", "(", "attention_weights", ",", "torch", ".", "sqrt", "(", "query_dim", ")", ")", "\n", "\n", "# Mask out keys that aren't there in each batch.", "\n", "# [batch_size, n_memory]", "\n", "", "mask", "=", "sequence_mask", "(", "memory_length", ",", "max_len", "=", "n_memory", ")", "\n", "# [batch_size, n_queries, n_memory]", "\n", "mask", "=", "mask", ".", "unsqueeze", "(", "1", ")", ".", "expand_as", "(", "attention_weights", ")", "\n", "attention_weights", "=", "attention_weights", ".", "masked_fill", "(", "mask", "==", "0", ",", "-", "1e9", ")", "\n", "attention_weights", "=", "F", ".", "softmax", "(", "attention_weights", ",", "dim", "=", "2", ")", "\n", "# [batch_size, n_queries, n_memory] x [batch_size, n_memory, value_dim] ->  [batch_size, n_queries, value_dim]", "\n", "retrieved_values", "=", "torch", ".", "bmm", "(", "attention_weights", ",", "values", ")", "\n", "return", "retrieved_values", ",", "attention_weights", "\n", "\n", "\n", "", "", "class", "LuongDecoder", "(", "nn", ".", "Module", ")", ":", "# TODO: make universal decoder (so input is continuous tensor, output also)", "\n", "    ", "\"\"\"One-step batch decoder with Luong attention\"\"\"", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.LuongDecoder.__init__": [[192, 217], ["torch.Module.__init__", "torch.Tanh", "torch.Tanh", "torch.Tanh", "torch.Embedding", "torch.Embedding", "torch.Embedding", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.LSTM", "torch.LSTM", "torch.LSTM", "torch.Attention", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["\n", "super", "(", "LuongDecoder", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "num_layers", "=", "num_layers", "\n", "self", ".", "hidden_size", "=", "hidden_size", "\n", "self", ".", "output_size", "=", "output_size", "\n", "self", ".", "dropout_probability", "=", "dropout_probability", "\n", "self", ".", "use_attention", "=", "attention", "\n", "self", ".", "conditional_attention", "=", "conditional_attention", "\n", "self", ".", "tanh", "=", "nn", ".", "Tanh", "(", ")", "\n", "self", ".", "embedding", "=", "nn", ".", "Embedding", "(", "output_size", ",", "hidden_size", ",", "padding_idx", "=", "padding_idx", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "dropout_probability", ")", "\n", "self", ".", "lstm", "=", "nn", ".", "LSTM", "(", "hidden_size", ",", "hidden_size", ",", "num_layers", "=", "num_layers", ",", "dropout", "=", "dropout_probability", ")", "\n", "self", ".", "attention", "=", "Attention", "(", "rescale", "=", "False", ")", "\n", "self", ".", "join_context", "=", "nn", ".", "Linear", "(", "hidden_size", "*", "2", ",", "hidden_size", ",", "bias", "=", "False", ")", "\n", "self", ".", "hidden_to_output", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "output_size", ",", "bias", "=", "False", ")", "\n", "\n", "", "def", "luong_attention", "(", "self", ",", "queries", ":", "torch", ".", "Tensor", ",", "keys", ":", "torch", ".", "Tensor", ",", "\n", "values", ":", "torch", ".", "Tensor", ",", "value_lengths", ":", "List", "[", "int", "]", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ":", "\n", "        "]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.LuongDecoder.luong_attention": [[218, 240], ["queries.transpose", "torch.LuongDecoder.attention.forward_mask", "keys.transpose", "values.transpose"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.Attention.forward_mask"], ["\n", "# [batch_size, num_queries, hidden_size]", "\n", "decoder_query", "=", "queries", ".", "transpose", "(", "0", ",", "1", ")", "\n", "\n", "# Attention over each time step in the query input.", "\n", "context", ",", "attention_weights", "=", "self", ".", "attention", ".", "forward_mask", "(", "queries", "=", "decoder_query", ",", "\n", "keys", "=", "keys", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "values", "=", "values", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "memory_length", "=", "value_lengths", ")", "\n", "# context : [batch_size, num_queries, hidden_size]", "\n", "# attention_weights : [batch_size, num_queries, num_memory]", "\n", "return", "context", ",", "attention_weights", "\n", "\n", "", "def", "forward_step", "(", "self", ",", "hidden", ":", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "target_tokens", ":", "torch", ".", "Tensor", ",", "\n", "attention_keys", "=", "None", ",", "attention_values", "=", "None", ",", "\n", "attention_values_lengths", "=", "None", ",", "conditional_attention_values", "=", "None", ",", "\n", "conditional_attention_values_lengths", "=", "None", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.LuongDecoder.forward_step": [[241, 279], ["torch.LuongDecoder.dropout", "torch.LuongDecoder.lstm", "torch.LuongDecoder.get_output", "torch.LuongDecoder.embedding"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.LuongDecoder.get_output"], ["Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "\n", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"\n        Run batch decoder forward for a single time step.\n         Each decoder step considers the values in `attention_values` through attention.\n         Attention retrieval is based on decoder hidden state (not cell state)\n\n        :param hidden: previous decoder state, which is pair of tensors [num_layers, batch_size, hidden_size]\n        (pair for hidden and cell)\n        :param target_tokens: [1, batch_size, hidden_size], the current time-step input to the RNN\n        :param attention_keys: [num_keys, batch_size, hidden_size], the keys to do attention over\n        :param attention_values: [num_memory, batch_size, hidden_size], the values to do attention over\n        :param attention_values_lengths: [batch_size], the unpadded length of the sequences in attention_values\n        :param conditional_attention_values: [num_memory, batch_size, hidden_size], values to do cond. attention over\n        :param conditional_attention_values_lengths: [batch_size], unpadded length of sequences in c_attention_values\n        :return: hidden : current decoder state, which is a pair of tensors [num_layers, batch_size, hidden_size]\n                            (pair for hidden and cell)\n                 attention_weights : attention weights, [batch_size, 1, max_input_length]\n        \"\"\"", "\n", "if", "self", ".", "use_attention", ":", "\n", "            ", "assert", "not", "attention_values", "is", "None", ",", "\"Provide attention values for attention.\"", "\n", "", "if", "self", ".", "conditional_attention", ":", "\n", "            ", "assert", "not", "conditional_attention_values", "is", "None", ",", "\"Provide conditional attention values for cond. attn.\"", "\n", "", "embedded_targets", "=", "self", ".", "dropout", "(", "self", ".", "embedding", "(", "target_tokens", ")", ")", "# [batch_size, hidden_size]", "\n", "\n", "# [1, batch_size, hidden_size] -> [1, batch_size, hidden_size]", "\n", "rnn_output", ",", "hidden", "=", "self", ".", "lstm", "(", "embedded_targets", ",", "hidden", ")", "\n", "# hidden: [num_layers, batch_size, hidden_size] (pair for hidden and cell)", "\n", "\n", "output", ",", "attention_weights", "=", "self", ".", "get_output", "(", "rnn_output", ",", "attention_keys", ",", "attention_values", ",", "\n", "attention_values_lengths", ",", "conditional_attention_values", ",", "\n", "conditional_attention_values_lengths", ")", "\n", "\n", "return", "output", ",", "hidden", ",", "attention_weights", "# TODO: return conditional attention values?", "\n", "# output : [un-normalized probabilities] [batch_size, output_size]", "\n", "# hidden: tuple of size [num_layers, batch_size, hidden_size] (for hidden and cell)", "\n", "# attention_weights: [batch_size, max_input_length]", "\n", "\n", "", "def", "get_output", "(", "self", ",", "rnn_output", ",", "attention_keys", ",", "attention_values", ",", "attention_values_lengths", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.LuongDecoder.get_output": [[283, 309], ["torch.LuongDecoder.hidden_to_output", "torch.LuongDecoder.luong_attention", "torch.LuongDecoder.transpose", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.LuongDecoder.tanh", "torch.LuongDecoder.luong_attention", "conditional_context.transpose.transpose.transpose", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.LuongDecoder.tanh", "torch.LuongDecoder.join_context", "torch.LuongDecoder.join_context", "torch.LuongDecoder.join_context"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.LuongDecoder.luong_attention", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.LuongDecoder.luong_attention"], ["            ", "context", ",", "attention_weights", "=", "self", ".", "luong_attention", "(", "queries", "=", "rnn_output", ",", "keys", "=", "attention_keys", ",", "\n", "values", "=", "attention_values", ",", "\n", "value_lengths", "=", "attention_values_lengths", ")", "\n", "context", "=", "context", ".", "transpose", "(", "0", ",", "1", ")", "\n", "\n", "if", "self", ".", "conditional_attention", ":", "\n", "                ", "queries", "=", "torch", ".", "cat", "(", "[", "rnn_output", ",", "context", "]", ",", "dim", "=", "-", "1", ")", "\n", "queries", "=", "self", ".", "tanh", "(", "self", ".", "join_context", "(", "queries", ")", ")", "\n", "conditional_context", ",", "conditional_attention_weights", "=", "self", ".", "luong_attention", "(", "\n", "queries", "=", "queries", ",", "keys", "=", "conditional_attention_values", ",", "values", "=", "conditional_attention_values", ",", "\n", "value_lengths", "=", "conditional_attention_values_lengths", ")", "\n", "conditional_context", "=", "conditional_context", ".", "transpose", "(", "0", ",", "1", ")", "\n", "context", "=", "torch", ".", "cat", "(", "[", "context", ",", "conditional_context", "]", ",", "dim", "=", "-", "1", ")", "\n", "context", "=", "self", ".", "tanh", "(", "self", ".", "join_context", "(", "context", ")", ")", "\n", "\n", "", "joint_context", "=", "torch", ".", "cat", "(", "[", "rnn_output", ",", "context", "]", ",", "dim", "=", "-", "1", ")", "\n", "joint_context", "=", "torch", ".", "relu", "(", "self", ".", "join_context", "(", "joint_context", ")", ")", "# TODO: relu here?", "\n", "", "else", ":", "\n", "            ", "joint_context", "=", "rnn_output", "\n", "attention_weights", "=", "None", "\n", "", "output", "=", "self", ".", "hidden_to_output", "(", "joint_context", ")", "\n", "return", "output", ",", "attention_weights", "\n", "\n", "", "def", "forward", "(", "self", ",", "target_tokens", ":", "torch", ".", "Tensor", ",", "target_lengths", ":", "List", "[", "int", "]", ",", "\n", "hidden", ":", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "attention_keys", ":", "torch", ".", "Tensor", ",", "\n", "attention_values", ":", "torch", ".", "Tensor", ",", "attention_values_lengths", ":", "List", "[", "int", "]", ",", "\n", "conditional_attention_values", "=", "None", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.LuongDecoder.forward": [[310, 364], ["torch.LuongDecoder.dropout", "torch.LuongDecoder.size", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.nn.utils.rnn.pack_padded_sequence", "torch.nn.utils.rnn.pack_padded_sequence", "torch.nn.utils.rnn.pack_padded_sequence", "torch.nn.utils.rnn.pack_padded_sequence", "torch.nn.utils.rnn.pack_padded_sequence", "torch.nn.utils.rnn.pack_padded_sequence", "torch.nn.utils.rnn.pack_padded_sequence", "torch.nn.utils.rnn.pack_padded_sequence", "torch.nn.utils.rnn.pack_padded_sequence", "torch.LuongDecoder.lstm", "torch.nn.utils.rnn.pad_packed_sequence", "torch.nn.utils.rnn.pad_packed_sequence", "torch.nn.utils.rnn.pad_packed_sequence", "torch.nn.utils.rnn.pad_packed_sequence", "torch.nn.utils.rnn.pad_packed_sequence", "torch.nn.utils.rnn.pad_packed_sequence", "torch.nn.utils.rnn.pad_packed_sequence", "torch.nn.utils.rnn.pad_packed_sequence", "torch.nn.utils.rnn.pad_packed_sequence", "perm_idx.sort", "target_lengths[].tolist", "torch.LuongDecoder.get_output", "torch.LuongDecoder.embedding"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.LuongDecoder.get_output"], ["conditional_attention_values_lengths", "=", "None", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"\n        Run batch attention decoder forward for a series of steps\n         Each decoder step considers all sequences in `attention_values` through attention.\n         Attention retrieval is based on decoder hidden state (not cell state)\n\n        :param target_tokens: [batch_size, max_target_length]\n        :param target_lengths: [batch_size], unpadded length of each input sequence in the batch\n        :param hidden: tuple of tensors [num_layers, batch_size, hidden_size] (for hidden and cell)\n        :param attention_keys: [num_keys, batch_size, hidden_size], the keys to do attention over\n        :param attention_values: [num_memory, batch_size, hidden_size], the values to do attention over\n        :param attention_values_lengths: [batch_size], the unpadded length of the sequences in attention_values\n        :param conditional_attention_values: [num_memory, batch_size, hidden_size], values to do cond. attention over\n        :param conditional_attention_values_lengths: [batch_size], unpadded length of sequences in c_attention_values\n        :return: output : unnormalized log-score, [max_length, batch_size, output_size]\n          hidden : current decoder state, tuple with each [num_layers, batch_size, hidden_size] (for hidden and cell)\n        \"\"\"", "\n", "# [batch_size, max_target_length] -> [batch_size, max_target_length, hidden_size]", "\n", "embedded_targets", "=", "self", ".", "dropout", "(", "self", ".", "embedding", "(", "target_tokens", ")", ")", "\n", "# Sort the sequences by length in descending order.", "\n", "max_target_length", "=", "embedded_targets", ".", "size", "(", "1", ")", "\n", "target_lengths", "=", "torch", ".", "tensor", "(", "target_lengths", ",", "dtype", "=", "torch", ".", "long", ")", "\n", "target_lengths", ",", "perm_idx", "=", "torch", ".", "sort", "(", "target_lengths", ",", "descending", "=", "True", ")", "\n", "embedded_targets", "=", "embedded_targets", "[", "perm_idx", "]", "\n", "init_hidden", "=", "(", "hidden", "[", "0", "]", "[", ":", ",", "perm_idx", ",", ":", "]", ",", "hidden", "[", "1", "]", "[", ":", ",", "perm_idx", ",", ":", "]", ")", "\n", "\n", "# [batch_size, max_query_target_length, hidden_size] -> [sum(embedded_target_lengths), hidden_size]", "\n", "packed_input", "=", "torch", ".", "nn", ".", "utils", ".", "rnn", ".", "pack_padded_sequence", "(", "embedded_targets", ",", "target_lengths", ",", "\n", "batch_first", "=", "True", ")", "\n", "\n", "# [sum(target_lengths), hidden_size] -> [sum(target_lengths), hidden_size]", "\n", "packed_output", ",", "(", "hidden", ",", "cell", ")", "=", "self", ".", "lstm", "(", "packed_input", ",", "init_hidden", ")", "\n", "# packed_output: [sum(target_lengths), hidden_size]", "\n", "# hidden and cell: [num_layers, batch_size, hidden_size]", "\n", "\n", "# [sum(target_lengths), hidden_size] -> [max_target_length, batch_size, hidden_size]", "\n", "rnn_output", ",", "_", "=", "torch", ".", "nn", ".", "utils", ".", "rnn", ".", "pad_packed_sequence", "(", "packed_output", ",", "\n", "total_length", "=", "max_target_length", ")", "\n", "\n", "# Reverse the sorting variables.", "\n", "_", ",", "unperm_idx", "=", "perm_idx", ".", "sort", "(", "0", ")", "\n", "embedded_targets", "=", "embedded_targets", "[", "unperm_idx", "]", "\n", "rnn_output", "=", "rnn_output", "[", ":", ",", "unperm_idx", ",", ":", "]", "\n", "seq_len", "=", "target_lengths", "[", "unperm_idx", "]", ".", "tolist", "(", ")", "\n", "\n", "output", ",", "attention_weights", "=", "self", ".", "get_output", "(", "rnn_output", ",", "attention_keys", ",", "attention_values", ",", "\n", "attention_values_lengths", ",", "conditional_attention_values", ",", "\n", "conditional_attention_values_lengths", ")", "\n", "\n", "return", "output", ",", "seq_len", ",", "attention_weights", "\n", "# output : [unnormalized log-score] [max_length, batch_size, output_size]", "\n", "# seq_len : length of each output sequence", "\n", "# attention_weights:", "\n", "\n", "", "def", "initialize_hidden", "(", "self", ",", "encoder_message", ":", "torch", ".", "Tensor", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.LuongDecoder.initialize_hidden": [[368, 379], ["encoder_message.expand().contiguous.expand().contiguous.unsqueeze", "encoder_message.expand().contiguous.expand().contiguous.expand().contiguous", "encoder_message.expand().contiguous.expand().contiguous.clone", "encoder_message.expand().contiguous.expand().contiguous.clone", "encoder_message.expand().contiguous.expand().contiguous.expand"], "methods", ["None"], ["\n", "encoder_message", "=", "encoder_message", ".", "unsqueeze", "(", "0", ")", "# [1, batch_size, hidden_size]", "\n", "encoder_message", "=", "encoder_message", ".", "expand", "(", "self", ".", "num_layers", ",", "-", "1", ",", "\n", "-", "1", ")", ".", "contiguous", "(", ")", "# [num_layers, batch_size, hidden_size]", "\n", "return", "encoder_message", ".", "clone", "(", ")", ",", "encoder_message", ".", "clone", "(", ")", "\n", "\n", "", "def", "extra_repr", "(", "self", ")", "->", "str", ":", "\n", "        ", "return", "\"AttentionDecoderRNN\\n num_layers={}\\n hidden_size={}\\n dropout={}\\n num_output_symbols={}\\n\"", ".", "format", "(", "\n", "self", ".", "num_layers", ",", "self", ".", "hidden_size", ",", "self", ".", "dropout_probability", ",", "self", ".", "output_size", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.LuongDecoder.extra_repr": [[380, 383], ["None"], "methods", ["None"], ["\n", "\n", "", "", "class", "BOW", "(", "nn", ".", "Module", ")", ":", "\n", "    "]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BOW.__init__": [[390, 402], ["torch.Module.__init__", "torch.Embedding", "torch.Embedding", "torch.Embedding", "torch.Dropout", "torch.Dropout", "torch.Dropout"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["\n", "super", "(", "BOW", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "input_size", "=", "input_size", "\n", "self", ".", "embedding_dim", "=", "embedding_dim", "\n", "self", ".", "dropout_probability", "=", "dropout_probability", "\n", "self", ".", "embedding", "=", "nn", ".", "Embedding", "(", "input_size", ",", "embedding_dim", ",", "padding_idx", "=", "padding_idx", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "dropout_probability", ")", "\n", "\n", "", "def", "forward", "(", "self", ",", "input_batch", ":", "torch", ".", "LongTensor", ",", "input_lengths", ":", "List", "[", "int", "]", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "dict", "]", ":", "\n", "        "]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BOW.forward": [[403, 417], ["torch.BOW.embedding", "torch.BOW.dropout", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean", "torch.mean"], "methods", ["None"], ["\n", "input_embeddings", "=", "self", ".", "embedding", "(", "input_batch", ")", "# [batch_size, max_length, embedding_dim]", "\n", "input_embeddings", "=", "self", ".", "dropout", "(", "input_embeddings", ")", "# [batch_size, max_length, embedding_dim]", "\n", "average_embedding", "=", "torch", ".", "mean", "(", "input_embeddings", ",", "dim", "=", "1", ")", "\n", "return", "average_embedding", ",", "{", "\"encoder_outputs\"", ":", "input_embeddings", ",", "\"sequence_lengths\"", ":", "input_lengths", "}", "\n", "\n", "\n", "", "", "class", "BahdanauDecoder", "(", "nn", ".", "Module", ")", ":", "\n", "    ", "\"\"\"One-step batch decoder with Bahdanau et al. attention\"\"\"", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauDecoder.__init__": [[422, 447], ["torch.Module.__init__", "torch.Tanh", "torch.Tanh", "torch.Tanh", "torch.Embedding", "torch.Embedding", "torch.Embedding", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.LSTM", "torch.LSTM", "torch.LSTM", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["\n", "super", "(", "BahdanauDecoder", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "num_layers", "=", "num_layers", "\n", "self", ".", "hidden_size", "=", "hidden_size", "\n", "self", ".", "output_size", "=", "output_size", "\n", "self", ".", "dropout_probability", "=", "dropout_probability", "\n", "self", ".", "tanh", "=", "nn", ".", "Tanh", "(", ")", "\n", "self", ".", "attention", "=", "attention", "\n", "self", ".", "conditional_attention", "=", "conditional_attention", "\n", "self", ".", "embedding", "=", "nn", ".", "Embedding", "(", "output_size", ",", "hidden_size", ",", "padding_idx", "=", "padding_idx", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "dropout_probability", ")", "\n", "self", ".", "lstm", "=", "nn", ".", "LSTM", "(", "hidden_size", "*", "2", ",", "hidden_size", ",", "num_layers", "=", "num_layers", ",", "dropout", "=", "dropout_probability", ")", "\n", "self", ".", "attention", "=", "attention", "\n", "if", "self", ".", "conditional_attention", ":", "\n", "            ", "self", ".", "join_context", "=", "nn", ".", "Linear", "(", "hidden_size", "*", "2", ",", "hidden_size", ",", "bias", "=", "False", ")", "\n", "", "self", ".", "output_to_hidden", "=", "nn", ".", "Linear", "(", "hidden_size", "*", "3", ",", "hidden_size", ",", "bias", "=", "False", ")", "\n", "self", ".", "hidden_to_output", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "output_size", ",", "bias", "=", "False", ")", "\n", "\n", "", "def", "forward_step", "(", "self", ",", "hidden", ":", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "target_tokens", ":", "torch", ".", "Tensor", ",", "\n", "attention_keys", "=", "None", ",", "attention_values", "=", "None", ",", "\n", "attention_values_lengths", "=", "None", ",", "conditional_attention_values", "=", "None", ",", "\n", "conditional_attention_values_lengths", "=", "None", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauDecoder.forward_step": [[448, 514], ["torch.BahdanauDecoder.dropout", "torch.BahdanauDecoder.attention", "attention_weights_commands.squeeze.squeeze.squeeze", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.BahdanauDecoder.lstm", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.BahdanauDecoder.output_to_hidden", "torch.BahdanauDecoder.hidden_to_output", "torch.BahdanauDecoder.embedding", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.BahdanauDecoder.tanh", "torch.BahdanauDecoder.attention", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.BahdanauDecoder.tanh", "last_hidden.transpose", "attention_keys.transpose", "attention_values.transpose", "torch.BahdanauDecoder.join_context", "torch.BahdanauDecoder.join_context", "torch.BahdanauDecoder.transpose", "torch.BahdanauDecoder.transpose", "last_hidden.transpose", "conditional_attention_values.transpose", "conditional_attention_values.transpose"], "methods", ["None"], ["Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "\n", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"\n        Run batch decoder forward for a single time step.\n         Each decoder step considers the values in `attention_values` through attention.\n         Attention retrieval is based on decoder hidden state (not cell state)\n\n        :param hidden: previous decoder state, which is pair of tensors [num_layers, batch_size, hidden_size]\n        (pair for hidden and cell)\n        :param target_tokens: [1, batch_size, hidden_size], the current time-step input to the RNN\n        :param attention_keys: [num_keys, batch_size, hidden_size], the keys to do attention over\n        :param attention_values: [num_memory, batch_size, hidden_size], the values to do attention over\n        :param attention_values_lengths: [batch_size], the unpadded length of the sequences in attention_values\n        :param conditional_attention_values: [num_memory, batch_size, hidden_size], values to do cond. attention over\n        :param conditional_attention_values_lengths: [batch_size], unpadded length of sequences in c_attention_values\n        :return: hidden : current decoder state, which is a pair of tensors [num_layers, batch_size, hidden_size]\n                            (pair for hidden and cell)\n                 attention_weights : attention weights, [batch_size, 1, max_input_length]\n        \"\"\"", "\n", "if", "self", ".", "attention", ":", "\n", "            ", "assert", "not", "attention_values", "is", "None", ",", "\"Provide attention values for attention.\"", "\n", "", "if", "self", ".", "conditional_attention", ":", "\n", "            ", "assert", "not", "conditional_attention_values", "is", "None", ",", "\"Provide conditional attention values for cond. attn.\"", "\n", "", "last_hidden", ",", "last_cell", "=", "hidden", "\n", "\n", "# Embed each input symbol", "\n", "embedded_input", "=", "self", ".", "dropout", "(", "self", ".", "embedding", "(", "target_tokens", ")", ")", "# [batch_size, hidden_size]", "\n", "\n", "# Bahdanau attention", "\n", "context", ",", "attention_weights_commands", "=", "self", ".", "attention", "(", "\n", "queries", "=", "last_hidden", ".", "transpose", "(", "0", ",", "1", ")", ",", "keys", "=", "attention_keys", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "values", "=", "attention_values", ".", "transpose", "(", "0", ",", "1", ")", ",", "memory_lengths", "=", "attention_values_lengths", ")", "\n", "\n", "if", "self", ".", "conditional_attention", ":", "\n", "            ", "queries", "=", "torch", ".", "cat", "(", "[", "last_hidden", ".", "transpose", "(", "0", ",", "1", ")", ",", "context", "]", ",", "dim", "=", "-", "1", ")", "\n", "queries", "=", "self", ".", "tanh", "(", "self", ".", "join_context", "(", "queries", ")", ")", "\n", "conditional_context", ",", "conditional_attention_weights", "=", "self", ".", "attention", "(", "\n", "queries", "=", "queries", ",", "keys", "=", "conditional_attention_values", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "values", "=", "conditional_attention_values", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "memory_lengths", "=", "conditional_attention_values_lengths", ")", "\n", "context", "=", "torch", ".", "cat", "(", "[", "context", ",", "conditional_context", "]", ",", "dim", "=", "-", "1", ")", "\n", "context", "=", "self", ".", "tanh", "(", "self", ".", "join_context", "(", "context", ")", ")", "\n", "\n", "# Concatenate the context vector and RNN hidden state, and map to an output", "\n", "", "attention_weights_commands", "=", "attention_weights_commands", ".", "squeeze", "(", "1", ")", "# [batch_size, max_input_length]", "\n", "concat_input", "=", "torch", ".", "cat", "(", "[", "embedded_input", ",", "\n", "context", ".", "transpose", "(", "0", ",", "1", ")", "]", ",", "dim", "=", "2", ")", "# [1, batch_size hidden_size*2]", "\n", "last_hidden", "=", "(", "last_hidden", ",", "last_cell", ")", "\n", "lstm_output", ",", "hidden", "=", "self", ".", "lstm", "(", "concat_input", ",", "last_hidden", ")", "\n", "# lstm_output: [1, batch_size, hidden_size]", "\n", "# hidden: tuple of each [num_layers, batch_size, hidden_size] (pair for hidden and cell)", "\n", "# output = self.hidden_to_output(lstm_output)  # [batch_size, output_size]", "\n", "# output = output.squeeze(dim=0)", "\n", "\n", "# Concatenate all outputs and project to output size.", "\n", "pre_output", "=", "torch", ".", "cat", "(", "[", "embedded_input", ",", "lstm_output", ",", "\n", "context", ".", "transpose", "(", "0", ",", "1", ")", "]", ",", "dim", "=", "2", ")", "\n", "pre_output", "=", "self", ".", "output_to_hidden", "(", "pre_output", ")", "# [1, batch_size, hidden_size]", "\n", "output", "=", "self", ".", "hidden_to_output", "(", "pre_output", ")", "# [batch_size, output_size]", "\n", "# output = output.squeeze(dim=0)   # [batch_size, output_size]", "\n", "\n", "return", "output", ",", "hidden", ",", "attention_weights_commands", "\n", "# output : [un-normalized probabilities] [batch_size, output_size]", "\n", "# hidden: tuple of size [num_layers, batch_size, hidden_size] (for hidden and cell)", "\n", "# attention_weights: [batch_size, max_input_length]", "\n", "\n", "", "def", "forward", "(", "self", ",", "target_tokens", ":", "torch", ".", "Tensor", ",", "target_lengths", ":", "List", "[", "int", "]", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauDecoder.forward": [[518, 579], ["target_tokens.size", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "target_tokens.index_select", "attention_values.index_select", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "commands_lengths.index_select.index_select.index_select", "range", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "perm_idx.sort", "lstm_output.index_select.index_select.index_select", "input_lengths[].tolist", "attention_weights.index_select.index_select.index_select", "initial_h.index_select", "initial_c.index_select", "torch.BahdanauDecoder.forward_step", "all_attention_weights.append", "lstm_output.index_select.index_select.append", "attention_weights.index_select.index_select.sum", "attention_weights_commands.unsqueeze", "input_token.unsqueeze"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.forward_step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["conditional_attention_values_lengths", "=", "None", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"\n        Run batch attention decoder forward for a series of steps\n         Each decoder step considers all sequences in `attention_values` through attention.\n         Attention retrieval is based on decoder hidden state (not cell state)\n\n        :param target_tokens: [batch_size, max_target_length]\n        :param target_lengths: [batch_size], unpadded length of each input sequence in the batch\n        :param hidden: tuple of tensors [num_layers, batch_size, hidden_size] (for hidden and cell)\n        :param attention_keys: [num_keys, batch_size, hidden_size], the keys to do attention over\n        :param attention_values: [num_memory, batch_size, hidden_size], the values to do attention over\n        :param attention_values_lengths: [batch_size], the unpadded length of the sequences in attention_values\n        :param conditional_attention_values: [num_memory, batch_size, hidden_size], values to do cond. attention over\n        :param conditional_attention_values_lengths: [batch_size], unpadded length of sequences in c_attention_values\n        :return: output : unnormalized log-score, [max_length, batch_size, output_size]\n          hidden : current decoder state, tuple with each [num_layers, batch_size, hidden_size] (for hidden and cell)\n        \"\"\"", "\n", "batch_size", ",", "max_time", "=", "target_tokens", ".", "size", "(", ")", "\n", "\n", "# Sort the sequences by length in descending order", "\n", "input_lengths", "=", "torch", ".", "tensor", "(", "target_lengths", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", "\n", "input_lengths", ",", "perm_idx", "=", "torch", ".", "sort", "(", "input_lengths", ",", "descending", "=", "True", ")", "\n", "input_tokens_sorted", "=", "target_tokens", ".", "index_select", "(", "dim", "=", "0", ",", "index", "=", "perm_idx", ")", "\n", "initial_h", ",", "initial_c", "=", "hidden", "\n", "hidden", "=", "(", "initial_h", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "perm_idx", ")", ",", "\n", "initial_c", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "perm_idx", ")", ")", "\n", "encoded_commands", "=", "attention_values", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "perm_idx", ")", "\n", "commands_lengths", "=", "torch", ".", "tensor", "(", "attention_values_lengths", ",", "device", "=", "device", ")", "\n", "commands_lengths", "=", "commands_lengths", ".", "index_select", "(", "dim", "=", "0", ",", "index", "=", "perm_idx", ")", "\n", "\n", "# # For efficiency", "\n", "# projected_keys_textual = self.attention.key_layer(", "\n", "#     encoded_commands)  # [max_input_length, batch_size, dec_hidden_dim]", "\n", "\n", "all_attention_weights", "=", "[", "]", "\n", "lstm_output", "=", "[", "]", "\n", "for", "time", "in", "range", "(", "max_time", ")", ":", "\n", "            ", "input_token", "=", "input_tokens_sorted", "[", ":", ",", "time", "]", "\n", "(", "output", ",", "hidden", ",", "attention_weights_commands", ")", "=", "self", ".", "forward_step", "(", "target_tokens", "=", "input_token", ".", "unsqueeze", "(", "dim", "=", "0", ")", ",", "\n", "hidden", "=", "hidden", ",", "\n", "attention_keys", "=", "encoded_commands", ",", "\n", "attention_values", "=", "encoded_commands", ",", "\n", "attention_values_lengths", "=", "commands_lengths", ",", "\n", "conditional_attention_values", "=", "conditional_attention_values", ",", "\n", "conditional_attention_values_lengths", "=", "conditional_attention_values_lengths", ")", "\n", "all_attention_weights", ".", "append", "(", "attention_weights_commands", ".", "unsqueeze", "(", "dim", "=", "0", ")", ")", "\n", "lstm_output", ".", "append", "(", "output", ")", "\n", "", "lstm_output", "=", "torch", ".", "cat", "(", "lstm_output", ",", "dim", "=", "0", ")", "# [max_time, batch_size, output_size]", "\n", "attention_weights", "=", "torch", ".", "cat", "(", "all_attention_weights", ",", "dim", "=", "0", ")", "# [max_time, batch_size, command_length]", "\n", "\n", "# Reverse the sorting", "\n", "_", ",", "unperm_idx", "=", "perm_idx", ".", "sort", "(", "0", ")", "\n", "lstm_output", "=", "lstm_output", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "unperm_idx", ")", "# [max_time, batch_size, output_size]", "\n", "seq_len", "=", "input_lengths", "[", "unperm_idx", "]", ".", "tolist", "(", ")", "\n", "attention_weights", "=", "attention_weights", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "unperm_idx", ")", "\n", "\n", "return", "lstm_output", ",", "seq_len", ",", "attention_weights", ".", "sum", "(", "dim", "=", "0", ")", "\n", "# output : [unnormalized log-score] [max_length, batch_size, output_size]", "\n", "# seq_len : length of each output sequence", "\n", "\n", "", "def", "initialize_hidden", "(", "self", ",", "encoder_message", ":", "torch", ".", "Tensor", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ":", "\n", "        "]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauDecoder.initialize_hidden": [[582, 593], ["encoder_message.expand().contiguous.expand().contiguous.unsqueeze", "encoder_message.expand().contiguous.expand().contiguous.expand().contiguous", "encoder_message.expand().contiguous.expand().contiguous.clone", "encoder_message.expand().contiguous.expand().contiguous.clone", "encoder_message.expand().contiguous.expand().contiguous.expand"], "methods", ["None"], ["\n", "encoder_message", "=", "encoder_message", ".", "unsqueeze", "(", "0", ")", "# [1, batch_size, hidden_size]", "\n", "encoder_message", "=", "encoder_message", ".", "expand", "(", "self", ".", "num_layers", ",", "-", "1", ",", "\n", "-", "1", ")", ".", "contiguous", "(", ")", "# [num_layers, batch_size, hidden_size]", "\n", "return", "encoder_message", ".", "clone", "(", ")", ",", "encoder_message", ".", "clone", "(", ")", "\n", "\n", "", "def", "extra_repr", "(", "self", ")", "->", "str", ":", "\n", "        ", "return", "\"AttentionDecoderRNN\\n num_layers={}\\n hidden_size={}\\n dropout={}\\n num_output_symbols={}\\n\"", ".", "format", "(", "\n", "self", ".", "num_layers", ",", "self", ".", "hidden_size", ",", "self", ".", "dropout_probability", ",", "self", ".", "output_size", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauDecoder.extra_repr": [[594, 597], ["None"], "methods", ["None"], ["\n", "\n", "", "", "class", "BahdanauAttentionDecoderRNN", "(", "nn", ".", "Module", ")", ":", "\n", "    ", "\"\"\"One-step batch decoder with Luong et al. attention\"\"\"", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.__init__": [[603, 632], ["torch.Module.__init__", "torch.Tanh", "torch.Tanh", "torch.Tanh", "torch.Embedding", "torch.Embedding", "torch.Embedding", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.LSTM", "torch.LSTM", "torch.LSTM", "torch.Linear", "torch.Linear", "torch.Linear", "torch.LSTM", "torch.LSTM", "torch.LSTM", "torch.Linear", "torch.Linear", "torch.Linear"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["\n", "super", "(", "BahdanauAttentionDecoderRNN", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "num_layers", "=", "num_layers", "\n", "self", ".", "conditional_attention", "=", "conditional_attention", "\n", "if", "self", ".", "conditional_attention", ":", "\n", "            ", "self", ".", "queries_to_keys", "=", "nn", ".", "Linear", "(", "hidden_size", "*", "2", ",", "hidden_size", ")", "\n", "", "self", ".", "hidden_size", "=", "hidden_size", "\n", "self", ".", "output_size", "=", "output_size", "\n", "self", ".", "dropout_probability", "=", "dropout_probability", "\n", "self", ".", "tanh", "=", "nn", ".", "Tanh", "(", ")", "\n", "self", ".", "embedding", "=", "nn", ".", "Embedding", "(", "output_size", ",", "hidden_size", ",", "padding_idx", "=", "padding_idx", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "dropout_probability", ")", "\n", "self", ".", "textual_attention", "=", "textual_attention", "\n", "if", "conditional_attention", ":", "\n", "            ", "self", ".", "visual_attention", "=", "visual_attention", "\n", "self", ".", "lstm", "=", "nn", ".", "LSTM", "(", "hidden_size", "*", "3", ",", "hidden_size", ",", "num_layers", "=", "num_layers", ",", "dropout", "=", "dropout_probability", ")", "\n", "self", ".", "output_to_hidden", "=", "nn", ".", "Linear", "(", "hidden_size", "*", "4", ",", "hidden_size", ",", "bias", "=", "False", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "lstm", "=", "nn", ".", "LSTM", "(", "hidden_size", "*", "2", ",", "hidden_size", ",", "num_layers", "=", "num_layers", ",", "dropout", "=", "dropout_probability", ")", "\n", "self", ".", "output_to_hidden", "=", "nn", ".", "Linear", "(", "hidden_size", "*", "3", ",", "hidden_size", ",", "bias", "=", "False", ")", "\n", "", "self", ".", "hidden_to_output", "=", "nn", ".", "Linear", "(", "hidden_size", ",", "output_size", ",", "bias", "=", "False", ")", "\n", "\n", "", "def", "forward_step", "(", "self", ",", "target_tokens", ":", "torch", ".", "LongTensor", ",", "hidden", ":", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "\n", "attention_keys", ":", "torch", ".", "Tensor", ",", "attention_values", ":", "torch", ".", "Tensor", ",", "\n", "attention_values_lengths", ":", "List", "[", "int", "]", ",", "conditional_attention_values", "=", "None", ",", "\n", "conditional_attention_values_lengths", "=", "None", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.forward_step": [[633, 720], ["target_tokens.squeeze", "torch.BahdanauAttentionDecoderRNN.embedding", "torch.BahdanauAttentionDecoderRNN.dropout", "embedded_input.unsqueeze.unsqueeze.unsqueeze", "torch.BahdanauAttentionDecoderRNN.textual_attention", "attention_weights_commands.squeeze.squeeze.squeeze", "torch.BahdanauAttentionDecoderRNN.lstm", "torch.BahdanauAttentionDecoderRNN.output_to_hidden", "torch.BahdanauAttentionDecoderRNN.hidden_to_output", "conditional_attention_values.transpose", "conditional_attention_values.transpose.size", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.BahdanauAttentionDecoderRNN.tanh", "last_hidden.transpose", "torch.BahdanauAttentionDecoderRNN.visual_attention", "attention_weights_situations.squeeze.squeeze.squeeze", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "last_hidden.transpose", "encoded_commands.transpose", "encoded_commands.transpose", "torch.BahdanauAttentionDecoderRNN.queries_to_keys", "last_hidden.transpose", "context_command.transpose", "context_situation.transpose", "context_command.transpose", "context_command.transpose", "context_situation.transpose", "context_command.transpose"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "\n", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"\n        Run batch decoder forward for a single time step.\n         Each decoder step considers all of the encoder_outputs through attention.\n         Attention retrieval is based on decoder hidden state (not cell state)\n\n        :param target_tokens: one time step inputs tokens of length batch_size\n        :param hidden: previous decoder state, which is pair of tensors [num_layers, batch_size, hidden_size]\n        (pair for hidden and cell)\n        :param attention_values: all encoder outputs, [max_input_length, batch_size, hidden_size]\n        :param attention_values_lengths: length of each padded input seqencoded_commandsuence that were passed to the encoder.\n        :param conditional_attention_values: the situation encoder outputs, [image_dimension * image_dimension, batch_size,\n         hidden_size]\n        :return: output : un-normalized output probabilities, [batch_size, output_size]\n          hidden : current decoder state, which is a pair of tensors [num_layers, batch_size, hidden_size]\n           (pair for hidden and cell)\n          attention_weights : attention weights, [batch_size, 1, max_input_length]\n        \"\"\"", "\n", "last_hidden", "=", "hidden", "\n", "input_tokens", "=", "target_tokens", ".", "squeeze", "(", "dim", "=", "0", ")", "# TODO: check if input tokens should be [1, bsz] or [bsz]", "\n", "encoded_commands", "=", "attention_values", "\n", "commands_lengths", "=", "attention_values_lengths", "\n", "if", "self", ".", "conditional_attention", ":", "\n", "            ", "encoded_situations", "=", "conditional_attention_values", ".", "transpose", "(", "0", ",", "1", ")", "\n", "", "last_hidden", ",", "last_cell", "=", "last_hidden", "\n", "\n", "# Embed each input symbol", "\n", "embedded_input", "=", "self", ".", "embedding", "(", "input_tokens", ")", "# [batch_size, hidden_size]", "\n", "embedded_input", "=", "self", ".", "dropout", "(", "embedded_input", ")", "\n", "embedded_input", "=", "embedded_input", ".", "unsqueeze", "(", "0", ")", "# [1, batch_size, hidden_size]", "\n", "\n", "# Bahdanau attention", "\n", "context_command", ",", "attention_weights_commands", "=", "self", ".", "textual_attention", "(", "\n", "queries", "=", "last_hidden", ".", "transpose", "(", "0", ",", "1", ")", ",", "keys", "=", "encoded_commands", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "values", "=", "encoded_commands", ".", "transpose", "(", "0", ",", "1", ")", ",", "memory_lengths", "=", "commands_lengths", ")", "\n", "if", "self", ".", "conditional_attention", ":", "\n", "            ", "batch_size", ",", "image_num_memory", ",", "_", "=", "encoded_situations", ".", "size", "(", ")", "\n", "", "situation_lengths", "=", "conditional_attention_values_lengths", "\n", "\n", "if", "self", ".", "conditional_attention", ":", "\n", "            ", "queries", "=", "torch", ".", "cat", "(", "[", "last_hidden", ".", "transpose", "(", "0", ",", "1", ")", ",", "context_command", "]", ",", "dim", "=", "-", "1", ")", "\n", "queries", "=", "self", ".", "tanh", "(", "self", ".", "queries_to_keys", "(", "queries", ")", ")", "\n", "", "else", ":", "\n", "            ", "queries", "=", "last_hidden", ".", "transpose", "(", "0", ",", "1", ")", "\n", "\n", "# Concatenate the context vector and RNN hidden state, and map to an output", "\n", "", "attention_weights_commands", "=", "attention_weights_commands", ".", "squeeze", "(", "1", ")", "# [batch_size, max_input_length]", "\n", "\n", "if", "self", ".", "conditional_attention", ":", "\n", "            ", "context_situation", ",", "attention_weights_situations", "=", "self", ".", "visual_attention", "(", "\n", "queries", "=", "queries", ",", "keys", "=", "encoded_situations", ",", "\n", "values", "=", "encoded_situations", ",", "memory_lengths", "=", "situation_lengths", ")", "\n", "# context : [batch_size, 1, hidden_size]", "\n", "# attention_weights : [batch_size, 1, max_input_length]", "\n", "attention_weights_situations", "=", "attention_weights_situations", ".", "squeeze", "(", "1", ")", "# [batch_size, im_dim * im_dim]", "\n", "\n", "concat_input", "=", "torch", ".", "cat", "(", "[", "embedded_input", ",", "\n", "context_command", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "context_situation", ".", "transpose", "(", "0", ",", "1", ")", "]", ",", "dim", "=", "2", ")", "# [1, batch_size hidden_size*3]", "\n", "", "else", ":", "\n", "            ", "concat_input", "=", "torch", ".", "cat", "(", "[", "embedded_input", ",", "\n", "context_command", ".", "transpose", "(", "0", ",", "1", ")", "]", ",", "dim", "=", "2", ")", "# [1, batch_size hidden_size*3]", "\n", "\n", "", "last_hidden", "=", "(", "last_hidden", ",", "last_cell", ")", "\n", "lstm_output", ",", "hidden", "=", "self", ".", "lstm", "(", "concat_input", ",", "last_hidden", ")", "\n", "# lstm_output: [1, batch_size, hidden_size]", "\n", "# hidden: tuple of each [num_layers, batch_size, hidden_size] (pair for hidden and cell)", "\n", "# output = self.hidden_to_output(lstm_output)  # [batch_size, output_size]", "\n", "# output = output.squeeze(dim=0)", "\n", "\n", "# Concatenate all outputs and project to output size.", "\n", "if", "self", ".", "conditional_attention", ":", "\n", "            ", "pre_output", "=", "torch", ".", "cat", "(", "[", "embedded_input", ",", "lstm_output", ",", "\n", "context_command", ".", "transpose", "(", "0", ",", "1", ")", ",", "context_situation", ".", "transpose", "(", "0", ",", "1", ")", "]", ",", "dim", "=", "2", ")", "\n", "", "else", ":", "\n", "            ", "pre_output", "=", "torch", ".", "cat", "(", "[", "embedded_input", ",", "lstm_output", ",", "\n", "context_command", ".", "transpose", "(", "0", ",", "1", ")", "]", ",", "dim", "=", "2", ")", "\n", "", "pre_output", "=", "self", ".", "output_to_hidden", "(", "pre_output", ")", "# [1, batch_size, hidden_size]", "\n", "output", "=", "self", ".", "hidden_to_output", "(", "pre_output", ")", "# [batch_size, output_size]", "\n", "# output = output.squeeze(dim=0)   # [batch_size, output_size]", "\n", "\n", "return", "output", ",", "hidden", ",", "attention_weights_commands", "\n", "# output : [un-normalized probabilities] [batch_size, output_size]", "\n", "# hidden: tuple of size [num_layers, batch_size, hidden_size] (for hidden and cell)", "\n", "# attention_weights: [batch_size, max_input_length]", "\n", "\n", "", "def", "forward", "(", "self", ",", "target_tokens", ":", "torch", ".", "LongTensor", ",", "target_lengths", ":", "List", "[", "int", "]", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.forward": [[724, 793], ["input_tokens.size", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "torch.sort", "input_tokens.index_select", "encoded_commands.index_select.index_select.index_select", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "commands_lengths.index_select.index_select.index_select", "range", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "perm_idx.sort", "lstm_output.index_select.index_select.index_select", "input_lengths[].tolist", "attention_weights.index_select.index_select.index_select", "initial_h.index_select", "initial_c.index_select", "encoded_situations.index_select.index_select.index_select", "torch.BahdanauAttentionDecoderRNN.forward_step", "all_attention_weights.append", "lstm_output.index_select.index_select.append", "attention_weights.index_select.index_select.sum", "attention_weights_commands.unsqueeze"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.forward_step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["conditional_attention_values_lengths", "=", "None", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", ",", "\n", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"\n        Run batch attention decoder forward for a series of steps\n         Each decoder step considers all of the encoder_outputs through attention.\n         Attention retrieval is based on decoder hidden state (not cell state)\n\n        :param input_tokens: [batch_size, max_length];  padded target sequences\n        :param input_lengths: [batch_size] for sequence length of each padded target sequence\n        :param init_hidden: tuple of tensors [num_layers, batch_size, hidden_size] (for hidden and cell)\n        :param encoded_commands: [max_input_length, batch_size, embedding_dim]\n        :param commands_lengths: [batch_size] sequence length of each encoder sequence (without padding)\n        :param encoded_situations: [batch_size, image_width * image_width, image_features]; encoded image situations.\n        :return: output : unnormalized log-score, [max_length, batch_size, output_size]\n          hidden : current decoder state, tuple with each [num_layers, batch_size, hidden_size] (for hidden and cell)\n        \"\"\"", "\n", "input_tokens", "=", "target_tokens", "\n", "input_lengths", "=", "target_lengths", "\n", "init_hidden", "=", "hidden", "\n", "encoded_commands", "=", "attention_values", "\n", "commands_lengths", "=", "attention_values_lengths", "\n", "encoded_situations", "=", "conditional_attention_values", "\n", "\n", "batch_size", ",", "max_time", "=", "input_tokens", ".", "size", "(", ")", "\n", "\n", "# Sort the sequences by length in descending order", "\n", "input_lengths", "=", "torch", ".", "tensor", "(", "input_lengths", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", "\n", "input_lengths", ",", "perm_idx", "=", "torch", ".", "sort", "(", "input_lengths", ",", "descending", "=", "True", ")", "\n", "input_tokens_sorted", "=", "input_tokens", ".", "index_select", "(", "dim", "=", "0", ",", "index", "=", "perm_idx", ")", "\n", "initial_h", ",", "initial_c", "=", "init_hidden", "\n", "hidden", "=", "(", "initial_h", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "perm_idx", ")", ",", "\n", "initial_c", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "perm_idx", ")", ")", "\n", "encoded_commands", "=", "encoded_commands", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "perm_idx", ")", "\n", "commands_lengths", "=", "torch", ".", "tensor", "(", "commands_lengths", ",", "device", "=", "device", ")", "\n", "commands_lengths", "=", "commands_lengths", ".", "index_select", "(", "dim", "=", "0", ",", "index", "=", "perm_idx", ")", "\n", "if", "self", ".", "conditional_attention", ":", "\n", "            ", "encoded_situations", "=", "encoded_situations", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "perm_idx", ")", "\n", "\n", "# For efficiency", "\n", "# projected_keys_visual = self.visual_attention.key_layer(", "\n", "#     encoded_situations)  # [batch_size, situation_length, dec_hidden_dim]", "\n", "# projected_keys_textual = self.textual_attention.key_layer(", "\n", "#     encoded_commands)  # [max_input_length, batch_size, dec_hidden_dim]", "\n", "\n", "", "all_attention_weights", "=", "[", "]", "\n", "lstm_output", "=", "[", "]", "\n", "for", "time", "in", "range", "(", "max_time", ")", ":", "\n", "            ", "input_token", "=", "input_tokens_sorted", "[", ":", ",", "time", "]", "\n", "(", "output", ",", "hidden", ",", "attention_weights_commands", ")", "=", "self", ".", "forward_step", "(", "\n", "target_tokens", "=", "input_token", ",", "hidden", "=", "hidden", ",", "attention_keys", "=", "encoded_commands", ",", "\n", "attention_values", "=", "encoded_commands", ",", "attention_values_lengths", "=", "commands_lengths", ",", "\n", "conditional_attention_values", "=", "encoded_situations", ",", "\n", "conditional_attention_values_lengths", "=", "conditional_attention_values_lengths", ")", "\n", "all_attention_weights", ".", "append", "(", "attention_weights_commands", ".", "unsqueeze", "(", "0", ")", ")", "\n", "lstm_output", ".", "append", "(", "output", ")", "\n", "", "lstm_output", "=", "torch", ".", "cat", "(", "lstm_output", ",", "dim", "=", "0", ")", "# [max_time, batch_size, output_size]", "\n", "attention_weights", "=", "torch", ".", "cat", "(", "all_attention_weights", ",", "dim", "=", "0", ")", "# [max_time, batch_size, situation_dim**2]", "\n", "\n", "# Reverse the sorting", "\n", "_", ",", "unperm_idx", "=", "perm_idx", ".", "sort", "(", "0", ")", "\n", "lstm_output", "=", "lstm_output", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "unperm_idx", ")", "# [max_time, batch_size, output_size]", "\n", "seq_len", "=", "input_lengths", "[", "unperm_idx", "]", ".", "tolist", "(", ")", "\n", "attention_weights", "=", "attention_weights", ".", "index_select", "(", "dim", "=", "1", ",", "index", "=", "unperm_idx", ")", "\n", "\n", "return", "lstm_output", ",", "seq_len", ",", "attention_weights", ".", "sum", "(", "dim", "=", "0", ")", "\n", "# output : [unnormalized log-score] [max_length, batch_size, output_size]", "\n", "# seq_len : length of each output sequence", "\n", "\n", "", "def", "initialize_hidden", "(", "self", ",", "encoder_message", ":", "torch", ".", "Tensor", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ":", "\n", "        "]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.initialize_hidden": [[796, 807], ["encoder_message.expand().contiguous.expand().contiguous.unsqueeze", "encoder_message.expand().contiguous.expand().contiguous.expand().contiguous", "encoder_message.expand().contiguous.expand().contiguous.clone", "encoder_message.expand().contiguous.expand().contiguous.clone", "encoder_message.expand().contiguous.expand().contiguous.expand"], "methods", ["None"], ["\n", "encoder_message", "=", "encoder_message", ".", "unsqueeze", "(", "0", ")", "# [1, batch_size, hidden_size]", "\n", "encoder_message", "=", "encoder_message", ".", "expand", "(", "self", ".", "num_layers", ",", "-", "1", ",", "\n", "-", "1", ")", ".", "contiguous", "(", ")", "# [num_layers, batch_size, hidden_size]", "\n", "return", "encoder_message", ".", "clone", "(", ")", ",", "encoder_message", ".", "clone", "(", ")", "\n", "\n", "", "def", "extra_repr", "(", "self", ")", "->", "str", ":", "\n", "        ", "return", "\"AttentionDecoderRNN\\n num_layers={}\\n hidden_size={}\\n dropout={}\\n num_output_symbols={}\\n\"", ".", "format", "(", "\n", "self", ".", "num_layers", ",", "self", ".", "hidden_size", ",", "self", ".", "dropout_probability", ",", "self", ".", "output_size", "\n", ")", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.extra_repr": [[808, 811], ["None"], "methods", ["None"], ["", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.get_exact_match": [[33, 53], ["torch.where", "torch.where", "torch.where", "sequence_preds.size", "torch.zeros", "torch.zeros", "torch.zeros", "torch.cat", "torch.cat", "torch.cat", "torch.where", "torch.where", "torch.where", "sequence_targets.size", "logger.info", "logger.info", "ValueError", "torch.eq().float().sum", "torch.eq().float().sum", "torch.eq().float().sum", "sequence_targets.size", "sequence_targets.size", "torch.eq().float", "torch.eq().float", "torch.eq().float", "sequence_targets.size", "torch.eq", "torch.eq", "torch.eq"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["sequence_pred_lengths", "=", "prediction_lengths", "\n", "target_lengths", "=", "target_lengths_no_sos", "\n", "max_lengths", "=", "torch", ".", "where", "(", "sequence_pred_lengths", ">", "target_lengths", ",", "sequence_pred_lengths", ",", "target_lengths", ")", "\n", "sequence_targets", "=", "targets_no_sos", "\n", "max_decoding_length", "=", "sequence_preds", ".", "size", "(", "1", ")", "\n", "if", "max_decoding_length", "<", "sequence_targets", ".", "size", "(", "1", ")", ":", "\n", "        ", "raise", "ValueError", "(", "\"--max_decoding_steps=%d too low for targets of >= %d\"", "%", "(", "max_decoding_length", ",", "\n", "sequence_targets", ".", "size", "(", "1", ")", ")", ")", "\n", "", "padding_targets", "=", "torch", ".", "zeros", "(", "[", "sequence_targets", ".", "size", "(", "0", ")", ",", "\n", "max_decoding_length", "-", "sequence_targets", ".", "size", "(", "1", ")", "]", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", "\n", "padded_targets", "=", "torch", ".", "cat", "(", "[", "sequence_targets", ",", "padding_targets", "]", ",", "dim", "=", "1", ")", "\n", "padded_targets", "=", "torch", ".", "where", "(", "padded_targets", "==", "0", ",", "-", "1", ",", "padded_targets", ")", "\n", "accuracy_per_sequence", "=", "torch", ".", "eq", "(", "sequence_preds", ",", "padded_targets", ")", ".", "float", "(", ")", ".", "sum", "(", "dim", "=", "1", ")", "/", "max_lengths", "\n", "exact_match_per_sequence", "=", "(", "accuracy_per_sequence", "==", "1.", ")", ".", "float", "(", ")", "\n", "return", "accuracy_per_sequence", ",", "exact_match_per_sequence", "\n", "\n", "\n", "", "def", "sequence_mask", "(", "sequence_length", ",", "max_len", "=", "None", ")", ":", "\n", "#", "\n", "# Create a binary mask of size (batch,max_len)", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.sequence_mask": [[55, 72], ["sequence_length.size", "torch.arange().long", "torch.arange().long", "torch.arange().long", "torch.arange().long.unsqueeze().expand", "sequence_length.unsqueeze().expand_as", "sequence_length.data.max", "torch.arange", "torch.arange", "torch.arange", "torch.arange().long.unsqueeze", "sequence_length.unsqueeze"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max"], ["#  Input", "\n", "#    sequence_length : (batch,) length of each batch sequence", "\n", "#", "\n", "    ", "if", "max_len", "is", "None", ":", "\n", "        ", "max_len", "=", "sequence_length", ".", "data", ".", "max", "(", ")", "\n", "", "batch_size", "=", "sequence_length", ".", "size", "(", "0", ")", "\n", "seq_range", "=", "torch", ".", "arange", "(", "0", ",", "max_len", ",", "device", "=", "device", ")", ".", "long", "(", ")", "\n", "seq_range_expand", "=", "seq_range", ".", "unsqueeze", "(", "0", ")", ".", "expand", "(", "batch_size", ",", "max_len", ")", "\n", "# if sequence_length.is_cuda:", "\n", "#     seq_range_expand = seq_range_expand.cuda()", "\n", "seq_length_expand", "=", "(", "sequence_length", ".", "unsqueeze", "(", "1", ")", "\n", ".", "expand_as", "(", "seq_range_expand", ")", ")", "\n", "return", "seq_range_expand", "<", "seq_length_expand", "\n", "\n", "\n", "", "class", "LearnedAttention", "(", "nn", ".", "Module", ")", ":", "\n", "\n", "    ", "def", "__init__", "(", "self", ",", "key_size", ":", "int", ",", "query_size", ":", "int", ",", "hidden_size", ":", "int", ")", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.__init__": [[22, 88], ["torch.Module.__init__", "torch.NLLLoss", "torch.NLLLoss", "torch.NLLLoss", "seq2seq.cnn_model.ConvolutionalNet", "torch.Linear", "torch.Linear", "torch.Linear", "seq2seq.seq2seq_model.EncoderRNN", "seq2seq.seq2seq_model.EncoderRNN", "torch.Linear", "torch.Linear", "torch.Linear", "Modularity.nn.LuongDecoder", "torch.Tanh", "torch.Tanh", "torch.Tanh"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input_vocabulary_size", ":", "int", ",", "embedding_dimension", ":", "int", ",", "encoder_hidden_size", ":", "int", ",", "\n", "planner_input_vocabulary_size", ":", "int", ",", "\n", "num_encoder_layers", ":", "int", ",", "encoder_dropout_p", ":", "float", ",", "encoder_bidirectional", ":", "bool", ",", "input_padding_idx", ":", "int", ",", "\n", "output_directory", ":", "str", ",", "decoder_hidden_size", ":", "int", ",", "target_pad_idx", ":", "int", ",", "target_sos_idx", ":", "int", ",", "\n", "target_vocabulary_size", ":", "int", ",", "num_decoder_layers", ":", "int", ",", "decoder_dropout_p", ":", "float", ",", "target_eos_idx", ":", "int", ",", "\n", "num_cnn_channels", ":", "int", ",", "cnn_kernel_size", ":", "int", ",", "cnn_dropout_p", ":", "float", ",", "cnn_hidden_num_channels", ":", "int", ",", "\n", "grid_size", ":", "int", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "InteractionModel", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "loss_criterion", "=", "nn", ".", "NLLLoss", "(", "ignore_index", "=", "target_pad_idx", ")", "\n", "\n", "self", ".", "grid_size", "=", "grid_size", "\n", "cnn_input_channels", "=", "num_cnn_channels", "\n", "# Input: [batch_size, image_width, image_width, num_channels]", "\n", "# Output: [batch_size, image_width * image_width, num_conv_channels * 3]", "\n", "self", ".", "world_state_encoder", "=", "ConvolutionalNet", "(", "num_channels", "=", "cnn_input_channels", ",", "\n", "cnn_kernel_size", "=", "cnn_kernel_size", ",", "\n", "num_conv_channels", "=", "cnn_hidden_num_channels", ",", "\n", "dropout_probability", "=", "cnn_dropout_p", ")", "\n", "self", ".", "world_state_to_decoder_hidden", "=", "nn", ".", "Linear", "(", "cnn_hidden_num_channels", "*", "3", ",", "decoder_hidden_size", ")", "\n", "\n", "# Input: [batch_size, max_input_length]", "\n", "# Output: [batch_size, hidden_size], [batch_size, max_input_length, hidden_size]", "\n", "self", ".", "command_encoder", "=", "EncoderRNN", "(", "input_size", "=", "input_vocabulary_size", ",", "\n", "embedding_dim", "=", "embedding_dimension", ",", "\n", "rnn_input_size", "=", "embedding_dimension", ",", "\n", "hidden_size", "=", "encoder_hidden_size", ",", "num_layers", "=", "num_encoder_layers", ",", "\n", "dropout_probability", "=", "encoder_dropout_p", ",", "bidirectional", "=", "encoder_bidirectional", ",", "\n", "padding_idx", "=", "input_padding_idx", ")", "\n", "\n", "# Input: [batch_size, max_input_length]", "\n", "# Output: [batch_size, hidden_size], [batch_size, max_input_length, hidden_size]", "\n", "self", ".", "plan_encoder", "=", "EncoderRNN", "(", "input_size", "=", "input_vocabulary_size", ",", "# TODO: diff input size and stuff", "\n", "embedding_dim", "=", "embedding_dimension", ",", "\n", "rnn_input_size", "=", "embedding_dimension", ",", "\n", "hidden_size", "=", "encoder_hidden_size", ",", "num_layers", "=", "num_encoder_layers", ",", "\n", "dropout_probability", "=", "encoder_dropout_p", ",", "bidirectional", "=", "encoder_bidirectional", ",", "\n", "padding_idx", "=", "input_padding_idx", ")", "\n", "\n", "# Used to project the final encoder state to the decoder hidden state such that it can be initialized with it.", "\n", "self", ".", "enc_hidden_to_dec_hidden", "=", "nn", ".", "Linear", "(", "encoder_hidden_size", "*", "2", ",", "decoder_hidden_size", ")", "\n", "\n", "# Input: [batch_size, max_target_length], initial hidden: ([batch_size, hidden_size], [batch_size, hidden_size])", "\n", "# Input for attention: [batch_size, max_input_length, hidden_size],", "\n", "#                      [batch_size, image_width * image_width, hidden_size]", "\n", "# Output: [max_target_length, batch_size, target_vocabulary_size]", "\n", "self", ".", "attention_decoder", "=", "LuongDecoder", "(", "hidden_size", "=", "decoder_hidden_size", ",", "\n", "output_size", "=", "target_vocabulary_size", ",", "\n", "num_layers", "=", "num_decoder_layers", ",", "\n", "dropout_probability", "=", "decoder_dropout_p", ",", "\n", "padding_idx", "=", "target_pad_idx", ",", "conditional_attention", "=", "True", ")", "\n", "self", ".", "target_eos_idx", "=", "target_eos_idx", "\n", "self", ".", "target_pad_idx", "=", "target_pad_idx", "\n", "self", ".", "target_sos_idx", "=", "target_sos_idx", "\n", "self", ".", "tanh", "=", "nn", ".", "Tanh", "(", ")", "\n", "self", ".", "output_directory", "=", "output_directory", "\n", "self", ".", "trained_iterations", "=", "0", "\n", "self", ".", "best_iteration", "=", "0", "\n", "self", ".", "best_metric", "=", "0", "\n", "self", ".", "metric", "=", "\"exact match\"", "\n", "\n", "self", ".", "input_keys", "=", "[", "\"world_state_tensor\"", "]", "\n", "self", ".", "input_keys_to_pad", "=", "[", "\"input_tensor\"", ",", "\"adverb_input_tensor\"", "]", "\n", "self", ".", "target_keys", "=", "[", "]", "\n", "self", ".", "target_keys_to_pad", "=", "[", "\"adverb_target_tensor\"", "]", "\n", "self", ".", "sequence_decoder", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.remove_start_of_sequence": [[89, 97], ["input_tensor.size", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "@", "staticmethod", "\n", "def", "remove_start_of_sequence", "(", "input_tensor", ":", "torch", ".", "Tensor", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "\"\"\"Get rid of SOS-tokens in targets batch and append a padding token to each example in the batch.\"\"\"", "\n", "batch_size", ",", "max_time", "=", "input_tensor", ".", "size", "(", ")", "\n", "input_tensor", "=", "input_tensor", "[", ":", ",", "1", ":", "]", "\n", "output_tensor", "=", "torch", ".", "cat", "(", "[", "input_tensor", ",", "torch", ".", "zeros", "(", "batch_size", ",", "device", "=", "device", ",", "dtype", "=", "torch", ".", "long", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "1", ")", "]", ",", "dim", "=", "1", ")", "\n", "return", "output_tensor", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.get_metrics": [[98, 122], ["torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "interaction_model.InteractionModel.remove_start_of_sequence", "mask.sum().data.item", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "match_targets.sum", "mask.sum", "mask.sum.size", "match_targets.sum().data.item", "adverb_target_tensor_scores.max", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "mask.sum", "match_targets.sum"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.remove_start_of_sequence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max"], ["", "def", "get_metrics", "(", "self", ",", "adverb_target_tensor_scores", ":", "torch", ".", "Tensor", ",", "adverb_target_tensor_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "float", "]", ":", "\n", "        ", "\"\"\"\n        :param adverb_target_tensor_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param adverb_target_tensor_targets:  ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar float of accuracy averaged over sequence length and batch size.\n        \"\"\"", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "targets", "=", "self", ".", "remove_start_of_sequence", "(", "adverb_target_tensor_targets", ")", "\n", "mask", "=", "(", "targets", "!=", "self", ".", "target_pad_idx", ")", ".", "long", "(", ")", "\n", "total", "=", "mask", ".", "sum", "(", ")", ".", "data", ".", "item", "(", ")", "\n", "predicted_targets", "=", "adverb_target_tensor_scores", ".", "max", "(", "dim", "=", "2", ")", "[", "1", "]", "\n", "equal_targets", "=", "torch", ".", "eq", "(", "targets", ".", "data", ",", "predicted_targets", ".", "data", ")", ".", "long", "(", ")", "\n", "match_targets", "=", "(", "equal_targets", "*", "mask", ")", "\n", "match_sum_per_example", "=", "match_targets", ".", "sum", "(", "dim", "=", "1", ")", "\n", "expected_sum_per_example", "=", "mask", ".", "sum", "(", "dim", "=", "1", ")", "\n", "batch_size", "=", "expected_sum_per_example", ".", "size", "(", "0", ")", "\n", "exact_match", "=", "100.", "*", "(", "match_sum_per_example", "==", "expected_sum_per_example", ")", ".", "sum", "(", ")", ".", "data", ".", "item", "(", ")", "/", "batch_size", "\n", "match_targets_sum", "=", "match_targets", ".", "sum", "(", ")", ".", "data", ".", "item", "(", ")", "\n", "accuracy", "=", "100.", "*", "match_targets_sum", "/", "total", "\n", "", "return", "{", "\n", "\"adverb_target_tensor_accuracy\"", ":", "accuracy", ",", "\n", "\"adverb_target_tensor_exact_match\"", ":", "exact_match", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.get_loss": [[124, 139], ["interaction_model.InteractionModel.remove_start_of_sequence", "adverb_target_tensor_scores.size", "adverb_target_tensor_scores.reshape", "interaction_model.InteractionModel.loss_criterion", "interaction_model.InteractionModel.view"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.remove_start_of_sequence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "get_loss", "(", "self", ",", "adverb_target_tensor_scores", ":", "torch", ".", "Tensor", ",", "adverb_target_tensor_targets", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "\"\"\"\n        :param adverb_target_tensor_scores: probabilities over target vocabulary outputted by the model, of size\n                              [batch_size, max_target_length, target_vocab_size]\n        :param adverb_target_tensor_targets: ground-truth targets of size [batch_size, max_target_length]\n        :return: scalar negative log-likelihood loss averaged over the sequence length and batch size.\n        \"\"\"", "\n", "targets", "=", "self", ".", "remove_start_of_sequence", "(", "adverb_target_tensor_targets", ")", "\n", "\n", "# Calculate the loss.", "\n", "vocabulary_size", "=", "adverb_target_tensor_scores", ".", "size", "(", "2", ")", "\n", "target_scores_2d", "=", "adverb_target_tensor_scores", ".", "reshape", "(", "-", "1", ",", "vocabulary_size", ")", "\n", "loss", "=", "self", ".", "loss_criterion", "(", "target_scores_2d", ",", "targets", ".", "view", "(", "-", "1", ")", ")", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.encode_input": [[140, 155], ["interaction_model.InteractionModel.world_state_encoder", "interaction_model.InteractionModel.command_encoder", "interaction_model.InteractionModel.plan_encoder", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat.size", "torch.cat.size", "torch.cat.size", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "interaction_model.InteractionModel.world_state_to_decoder_hidden", "interaction_model.InteractionModel.transpose"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "encode_input", "(", "self", ",", "input_tensor", ":", "torch", ".", "LongTensor", ",", "input_tensor_lengths", ":", "List", "[", "int", "]", ",", "\n", "adverb_input_tensor", ":", "torch", ".", "LongTensor", ",", "adverb_input_tensor_lengths", ":", "List", "[", "int", "]", ",", "\n", "world_state_tensor", ":", "torch", ".", "Tensor", ")", "->", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"Pass the input commands through an RNN encoder and the situation input through a CNN encoder.\"\"\"", "\n", "encoded_world_state", "=", "self", ".", "world_state_encoder", "(", "world_state_tensor", ")", "\n", "hidden_command", ",", "encoder_outputs", "=", "self", ".", "command_encoder", "(", "input_tensor", ",", "input_tensor_lengths", ")", "\n", "hidden_plan", ",", "encoder_outputs", "=", "self", ".", "plan_encoder", "(", "adverb_input_tensor", ",", "adverb_input_tensor_lengths", ")", "\n", "initial_hidden", "=", "torch", ".", "cat", "(", "[", "hidden_command", ",", "hidden_plan", "]", ",", "dim", "=", "1", ")", "\n", "batch_size", "=", "initial_hidden", ".", "size", "(", "0", ")", "\n", "conditional_attention_values", "=", "torch", ".", "tanh", "(", "self", ".", "world_state_to_decoder_hidden", "(", "encoded_world_state", ".", "transpose", "(", "0", ",", "1", ")", ")", ")", "\n", "return", "{", "\"encoded_commands\"", ":", "encoder_outputs", ",", "\"initial_hidden\"", ":", "initial_hidden", ",", "\n", "\"attention_values\"", ":", "encoder_outputs", "[", "\"encoder_outputs\"", "]", ",", "\n", "\"attention_values_lengths\"", ":", "encoder_outputs", "[", "\"sequence_lengths\"", "]", ",", "\n", "\"conditional_attention_values\"", ":", "conditional_attention_values", ",", "\n", "\"conditional_attention_values_lengths\"", ":", "[", "self", ".", "grid_size", "**", "2", "]", "*", "batch_size", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.decode_step": [[156, 166], ["interaction_model.InteractionModel.attention_decoder.forward_step"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.forward_step"], ["", "def", "decode_step", "(", "self", ",", "adverb_target_tensor", ":", "torch", ".", "LongTensor", ",", "hidden", ":", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "\n", "attention_values", ":", "torch", ".", "Tensor", ",", "attention_values_lengths", ":", "List", "[", "int", "]", ",", "\n", "conditional_attention_values", ":", "torch", ".", "Tensor", ",", "conditional_attention_values_lengths", ":", "List", "[", "int", "]", ",", "\n", "**", "kwargs", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"One decoding step based on the previous hidden state of the decoder and the previous target token.\"\"\"", "\n", "return", "self", ".", "attention_decoder", ".", "forward_step", "(", "\n", "target_tokens", "=", "adverb_target_tensor", ",", "last_hidden", "=", "hidden", ",", "attention_keys", "=", "attention_values", ",", "\n", "attention_values_lengths", "=", "attention_values_lengths", ",", "attention_values", "=", "attention_values", ",", "\n", "conditional_attention_values", "=", "conditional_attention_values", ",", "\n", "conditional_attention_values_lengths", "=", "conditional_attention_values_lengths", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.decode_input_batched": [[167, 183], ["interaction_model.InteractionModel.attention_decoder.initialize_hidden", "interaction_model.InteractionModel.attention_decoder", "torch.log_softmax", "torch.log_softmax", "torch.log_softmax", "interaction_model.InteractionModel.tanh", "interaction_model.InteractionModel.enc_hidden_to_dec_hidden"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.nn.BahdanauAttentionDecoderRNN.initialize_hidden"], ["", "def", "decode_input_batched", "(", "self", ",", "adverb_target_tensor", ":", "torch", ".", "LongTensor", ",", "adverb_target_tensor_lengths", ":", "List", "[", "int", "]", ",", "\n", "initial_hidden", ":", "torch", ".", "Tensor", ",", "attention_values", ":", "torch", ".", "Tensor", ",", "\n", "attention_values_lengths", ":", "List", "[", "int", "]", ",", "\n", "conditional_attention_values", ":", "torch", ".", "Tensor", ",", "\n", "conditional_attention_values_lengths", ":", "List", "[", "int", "]", ",", "\n", "**", "kwargs", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"Decode a batch of input sequences.\"\"\"", "\n", "initial_hidden", "=", "self", ".", "attention_decoder", ".", "initialize_hidden", "(", "\n", "self", ".", "tanh", "(", "self", ".", "enc_hidden_to_dec_hidden", "(", "initial_hidden", ")", ")", ")", "\n", "decoder_output_batched", ",", "_", ",", "attention_weights", "=", "self", ".", "attention_decoder", "(", "\n", "target_tokens", "=", "adverb_target_tensor", ",", "target_lengths", "=", "adverb_target_tensor_lengths", ",", "\n", "init_hidden", "=", "initial_hidden", ",", "attention_keys", "=", "attention_values", ",", "attention_values", "=", "attention_values", ",", "\n", "attention_values_lengths", "=", "attention_values_lengths", ",", "conditional_attention_values", "=", "conditional_attention_values", ",", "\n", "conditional_attention_values_lengths", "=", "conditional_attention_values_lengths", ")", "\n", "decoder_output_batched", "=", "F", ".", "log_softmax", "(", "decoder_output_batched", ",", "dim", "=", "-", "1", ")", "\n", "return", "decoder_output_batched", ",", "attention_weights", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.forward": [[184, 201], ["interaction_model.InteractionModel.encode_input", "interaction_model.InteractionModel.decode_input_batched", "decoder_output.transpose"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.encode_input", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.decode_input_batched"], ["", "def", "forward", "(", "self", ",", "input_tensor", ":", "torch", ".", "LongTensor", ",", "input_tensor_lengths", ":", "List", "[", "int", "]", ",", "world_state_tensor", ":", "torch", ".", "Tensor", ",", "\n", "adverb_input_tensor", ":", "torch", ".", "LongTensor", ",", "adverb_input_tensor_lengths", ":", "List", "[", "int", "]", ",", "\n", "adverb_target_tensor", ":", "torch", ".", "LongTensor", ",", "adverb_target_tensor_lengths", ":", "List", "[", "int", "]", ")", "->", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "encoder_output", "=", "self", ".", "encode_input", "(", "input_tensor", "=", "input_tensor", ",", "input_tensor_lengths", "=", "input_tensor_lengths", ",", "\n", "adverb_input_tensor", "=", "adverb_input_tensor", ",", "\n", "adverb_input_tensor_lengths", "=", "adverb_input_tensor_lengths", ",", "\n", "world_state_tensor", "=", "world_state_tensor", ")", "\n", "decoder_output", ",", "attention_weights", "=", "self", ".", "decode_input_batched", "(", "\n", "adverb_target_tensor", "=", "adverb_target_tensor", ",", "\n", "adverb_target_tensor_lengths", "=", "adverb_target_tensor_lengths", ",", "\n", "**", "encoder_output", "\n", ")", "\n", "# decoder_output: [max_target_length, batch_size, output_size]", "\n", "# attention_weights: [batch_size, max_target_length, max_input_length]", "\n", "return", "{", "\n", "\"adverb_target_tensor_scores\"", ":", "decoder_output", ".", "transpose", "(", "0", ",", "1", ")", ",", "\n", "\"decoder_attention_weights\"", ":", "attention_weights", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.update_state": [[203, 208], ["None"], "methods", ["None"], ["", "def", "update_state", "(", "self", ",", "is_best", ":", "bool", ",", "metric", "=", "None", ")", "->", "{", "}", ":", "\n", "        ", "self", ".", "trained_iterations", "+=", "1", "\n", "if", "is_best", ":", "\n", "            ", "self", ".", "best_metric", "=", "metric", "\n", "self", ".", "best_iteration", "=", "self", ".", "trained_iterations", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.load_model": [[209, 217], ["torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "interaction_model.InteractionModel.load_state_dict"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load"], ["", "", "def", "load_model", "(", "self", ",", "path_to_checkpoint", ":", "str", ")", "->", "dict", ":", "\n", "        ", "checkpoint", "=", "torch", ".", "load", "(", "path_to_checkpoint", ")", "\n", "self", ".", "trained_iterations", "=", "checkpoint", "[", "\"iteration\"", "]", "\n", "self", ".", "best_iteration", "=", "checkpoint", "[", "\"best_iteration\"", "]", "\n", "self", ".", "load_state_dict", "(", "checkpoint", "[", "\"state_dict\"", "]", ")", "\n", "self", ".", "best_metric", "=", "checkpoint", "[", "\"best_metric\"", "]", "\n", "self", ".", "metric", "=", "\"exact match\"", "\n", "return", "checkpoint", "[", "\"optimizer_state_dict\"", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.get_current_state": [[218, 225], ["interaction_model.InteractionModel.state_dict"], "methods", ["None"], ["", "def", "get_current_state", "(", "self", ")", ":", "\n", "        ", "return", "{", "\n", "\"iteration\"", ":", "self", ".", "trained_iterations", ",", "\n", "\"state_dict\"", ":", "self", ".", "state_dict", "(", ")", ",", "\n", "\"best_iteration\"", ":", "self", ".", "best_iteration", ",", "\n", "\"best_metric\"", ":", "self", ".", "best_metric", ",", "\n", "\"metric\"", ":", "\"exact match\"", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.interaction_model.InteractionModel.save_checkpoint": [[227, 243], ["os.path.join", "interaction_model.InteractionModel.get_current_state", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "os.path.join", "shutil.copyfile"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_current_state", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save"], ["", "def", "save_checkpoint", "(", "self", ",", "file_name", ":", "str", ",", "is_best", ":", "bool", ",", "optimizer_state_dict", ":", "dict", ")", "->", "str", ":", "\n", "        ", "\"\"\"\n\n        :param file_name: filename to save checkpoint in.\n        :param is_best: boolean describing whether or not the current state is the best the model has ever been.\n        :param optimizer_state_dict: state of the optimizer.\n        :return: str to path where the model is saved.\n        \"\"\"", "\n", "path", "=", "os", ".", "path", ".", "join", "(", "self", ".", "output_directory", ",", "file_name", ")", "\n", "state", "=", "self", ".", "get_current_state", "(", ")", "\n", "state", "[", "\"optimizer_state_dict\"", "]", "=", "optimizer_state_dict", "\n", "torch", ".", "save", "(", "state", ",", "path", ")", "\n", "if", "is_best", ":", "\n", "            ", "best_path", "=", "os", ".", "path", ".", "join", "(", "self", ".", "output_directory", ",", "'model_best.pth.tar'", ")", "\n", "shutil", ".", "copyfile", "(", "path", ",", "best_path", ")", "\n", "", "return", "path", "\n", "", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.__init__": [[20, 24], ["collections.Counter"], "methods", ["None"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "_idx_to_word", "=", "[", "]", "\n", "self", ".", "_word_to_idx", "=", "{", "}", "\n", "self", ".", "_word_frequencies", "=", "Counter", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.word_to_idx": [[25, 27], ["None"], "methods", ["None"], ["", "def", "word_to_idx", "(", "self", ",", "word", ":", "str", ")", "->", "int", ":", "\n", "        ", "return", "self", ".", "_word_to_idx", "[", "word", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.idx_to_word": [[28, 30], ["None"], "methods", ["None"], ["", "def", "idx_to_word", "(", "self", ",", "idx", ":", "int", ")", "->", "str", ":", "\n", "        ", "return", "self", ".", "_idx_to_word", "[", "idx", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.add_word": [[31, 36], ["dataset_backup_alo.AdverbVocabulary._idx_to_word.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "add_word", "(", "self", ",", "word", ":", "List", "[", "str", "]", ")", ":", "\n", "        ", "if", "word", "not", "in", "self", ".", "_word_to_idx", ":", "\n", "            ", "self", ".", "_word_to_idx", "[", "word", "]", "=", "self", ".", "size", "\n", "self", ".", "_idx_to_word", ".", "append", "(", "word", ")", "\n", "", "self", ".", "_word_frequencies", "[", "word", "]", "+=", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.most_common": [[37, 39], ["dataset_backup_alo.AdverbVocabulary._word_frequencies.most_common"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.most_common"], ["", "def", "most_common", "(", "self", ",", "n", "=", "10", ")", ":", "\n", "        ", "return", "self", ".", "_word_frequencies", ".", "most_common", "(", "n", "=", "n", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.contains_word": [[40, 45], ["None"], "methods", ["None"], ["", "def", "contains_word", "(", "self", ",", "word", ":", "str", ")", "->", "bool", ":", "\n", "        ", "if", "word", "in", "self", ".", "_word_to_idx", ":", "\n", "            ", "return", "True", "\n", "", "else", ":", "\n", "            ", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size": [[46, 49], ["len"], "methods", ["None"], ["", "", "@", "property", "\n", "def", "size", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "_idx_to_word", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load": [[50, 62], ["os.path.exists", "open", "json.load", "cls", "collections.defaultdict", "all_data[].items", "collections.Counter"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load"], ["", "@", "classmethod", "\n", "def", "load", "(", "cls", ",", "path", ":", "str", ")", ":", "\n", "        ", "assert", "os", ".", "path", ".", "exists", "(", "path", ")", ",", "\"Trying to load a vocabulary from a non-existing file {}\"", ".", "format", "(", "path", ")", "\n", "with", "open", "(", "path", ",", "'r'", ")", "as", "infile", ":", "\n", "            ", "all_data", "=", "json", ".", "load", "(", "infile", ")", "\n", "vocab", "=", "cls", "(", ")", "\n", "vocab", ".", "_idx_to_word", "=", "all_data", "[", "\"idx_to_word\"", "]", "\n", "vocab", ".", "_word_to_idx", "=", "defaultdict", "(", "int", ")", "\n", "for", "word", ",", "idx", "in", "all_data", "[", "\"word_to_idx\"", "]", ".", "items", "(", ")", ":", "\n", "                ", "vocab", ".", "_word_to_idx", "[", "word", "]", "=", "idx", "\n", "", "vocab", ".", "_word_frequencies", "=", "Counter", "(", "all_data", "[", "\"word_frequencies\"", "]", ")", "\n", "", "return", "vocab", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.to_dict": [[63, 68], ["None"], "methods", ["None"], ["", "def", "to_dict", "(", "self", ")", "->", "dict", ":", "\n", "        ", "return", "{", "\n", "\"idx_to_word\"", ":", "self", ".", "_idx_to_word", ",", "\n", "\"word_to_idx\"", ":", "self", ".", "_word_to_idx", ",", "\n", "\"word_frequencies\"", ":", "self", ".", "_word_frequencies", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.save": [[70, 74], ["open", "json.dump", "dataset_backup_alo.AdverbVocabulary.to_dict"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.Situation.to_dict"], ["", "def", "save", "(", "self", ",", "path", ":", "str", ")", "->", "str", ":", "\n", "        ", "with", "open", "(", "path", ",", "'w'", ")", "as", "outfile", ":", "\n", "            ", "json", ".", "dump", "(", "self", ".", "to_dict", "(", ")", ",", "outfile", ",", "indent", "=", "4", ")", "\n", "", "return", "path", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.__init__": [[78, 147], ["seq2seq.gSCAN_dataset.GroundedScanDataset.__init__", "dataset_backup_alo.ModularDataset.dataset._vocabulary.get_transitive_verbs", "logger.info", "[].items", "dataset_backup_alo.AdverbVocabulary", "seq2seq.gSCAN_dataset.Vocabulary", "seq2seq.gSCAN_dataset.Vocabulary", "seq2seq.gSCAN_dataset.Vocabulary", "seq2seq.gSCAN_dataset.Vocabulary", "isinstance", "logger.info", "isinstance", "logger.info", "dataset_backup_alo.AdverbVocabulary.load", "seq2seq.gSCAN_dataset.Vocabulary.load", "seq2seq.gSCAN_dataset.Vocabulary.load", "seq2seq.gSCAN_dataset.Vocabulary.load", "seq2seq.gSCAN_dataset.Vocabulary.load", "logger.info", "logger.info", "logger.info", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "dataset_backup_alo.ModularDataset.load_full_vocabularies", "len"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_transitive_verbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.load_full_vocabularies"], ["    ", "def", "__init__", "(", "self", ",", "path_to_data", ":", "str", ",", "save_directory", ":", "str", ",", "k", ":", "int", ",", "split", "=", "\"train\"", ",", "input_vocabulary_file", "=", "\"\"", ",", "\n", "adverb_input_vocabulary_file", "=", "\"\"", ",", "adverb_target_vocabulary_file", "=", "\"\"", ",", "planner_target_vocabulary_file", "=", "\"\"", ",", "\n", "target_vocabulary_file", "=", "\"\"", ",", "adverb_vocabulary_file", "=", "\"\"", ",", "transitive_target_vocabulary_file", "=", "\"\"", ",", "\n", "generate_vocabulary", "=", "False", ",", "upsample_isolated", "=", "1", ",", "isolate_adverb_types", "=", "None", ",", "only_keep_adverbs", "=", "None", ",", "\n", "seed", "=", "1", ",", "isolate_examples_with", "=", "\"cautiously\"", ",", "module", "=", "\"\"", ",", "output_folder_pattern", "=", "\"\"", ",", "collapse_alo", "=", "False", ")", ":", "\n", "        ", "if", "generate_vocabulary", ":", "\n", "            ", "self", ".", "adverb_vocabulary", "=", "AdverbVocabulary", "(", ")", "\n", "self", ".", "adverb_input_vocabulary", "=", "Vocabulary", "(", ")", "\n", "self", ".", "adverb_target_vocabulary", "=", "Vocabulary", "(", ")", "\n", "self", ".", "planner_target_vocabulary", "=", "Vocabulary", "(", ")", "\n", "self", ".", "transitive_target_vocabulary", "=", "Vocabulary", "(", ")", "\n", "", "self", ".", "collapse_alo", "=", "collapse_alo", "\n", "if", "module", "==", "\"full\"", ":", "\n", "            ", "assert", "output_folder_pattern", ",", "\"Please provide the pattern of the output folders for all the modules.\"", "\n", "", "self", ".", "all_modules", "=", "[", "\"position\"", ",", "\"planner\"", ",", "\"dummy_planner\"", ",", "\"dummy_sequence_planner\"", ",", "\"interaction\"", ",", "\n", "\"dummy_interaction\"", ",", "\"adverb_transform\"", ",", "\"alo_transform\"", "]", "\n", "if", "isolate_adverb_types", ":", "\n", "            ", "assert", "isinstance", "(", "isolate_adverb_types", ",", "list", ")", ",", "\"Please provide list of strings to isolate_adverb_types.\"", "\n", "logger", ".", "info", "(", "\"Isolating adverb types: %s\"", "%", "','", ".", "join", "(", "isolate_adverb_types", ")", ")", "\n", "", "if", "only_keep_adverbs", ":", "\n", "            ", "assert", "isinstance", "(", "only_keep_adverbs", ",", "list", ")", ",", "\"Please provide list of strings to only_keep_adverbs.\"", "\n", "logger", ".", "info", "(", "\"Only keeping adverbs: %s\"", "%", "','", ".", "join", "(", "only_keep_adverbs", ")", ")", "\n", "", "if", "module", "==", "\"full\"", ":", "\n", "            ", "old_save_directory", "=", "save_directory", "\n", "save_directory", "=", "output_folder_pattern", "%", "\"position\"", "\n", "", "super", "(", ")", ".", "__init__", "(", "path_to_data", ",", "save_directory", ",", "k", ",", "split", ",", "input_vocabulary_file", ",", "\n", "target_vocabulary_file", ",", "generate_vocabulary", ",", "upsample_isolated", "=", "upsample_isolated", ",", "\n", "isolate_adverb_types", "=", "isolate_adverb_types", ",", "only_keep_adverbs", "=", "only_keep_adverbs", ",", "\n", "isolate_examples_with", "=", "isolate_examples_with", ",", "seed", "=", "seed", ")", "\n", "if", "not", "generate_vocabulary", ":", "\n", "            ", "self", ".", "adverb_vocabulary", "=", "AdverbVocabulary", ".", "load", "(", "os", ".", "path", ".", "join", "(", "save_directory", ",", "\n", "adverb_vocabulary_file", ")", ")", "\n", "self", ".", "adverb_input_vocabulary", "=", "Vocabulary", ".", "load", "(", "os", ".", "path", ".", "join", "(", "save_directory", ",", "\n", "adverb_input_vocabulary_file", ")", ")", "\n", "self", ".", "adverb_target_vocabulary", "=", "Vocabulary", ".", "load", "(", "os", ".", "path", ".", "join", "(", "save_directory", ",", "\n", "adverb_target_vocabulary_file", ")", ")", "\n", "self", ".", "planner_target_vocabulary", "=", "Vocabulary", ".", "load", "(", "os", ".", "path", ".", "join", "(", "save_directory", ",", "\n", "planner_target_vocabulary_file", ")", ")", "\n", "self", ".", "transitive_target_vocabulary", "=", "Vocabulary", ".", "load", "(", "os", ".", "path", ".", "join", "(", "save_directory", ",", "\n", "transitive_target_vocabulary_file", ")", ")", "\n", "if", "module", "==", "\"full\"", ":", "\n", "                ", "self", ".", "vocabulary_dict", "=", "{", "\n", "\"position\"", ":", "[", "(", "input_vocabulary_file", ",", "\"input_tensor\"", ")", "]", ",", "\n", "\"planner\"", ":", "[", "(", "input_vocabulary_file", ",", "\"input_tensor\"", ")", ",", "\n", "(", "planner_target_vocabulary_file", ",", "\"planner_target_tensor\"", ")", "]", ",", "\n", "\"interaction\"", ":", "[", "(", "input_vocabulary_file", ",", "\"input_tensor\"", ")", ",", "\n", "(", "transitive_target_vocabulary_file", ",", "\"transitive_target_tensor\"", ")", "]", ",", "\n", "\"adverb_transform\"", ":", "[", "(", "input_vocabulary_file", ",", "\"input_tensor\"", ")", ",", "\n", "(", "adverb_input_vocabulary_file", ",", "\"adverb_input_tensor\"", ")", ",", "\n", "(", "adverb_target_vocabulary_file", ",", "\"adverb_target_tensor\"", ")", "]", ",", "\n", "\"alo_transform\"", ":", "[", "(", "adverb_target_vocabulary_file", ",", "\"adverb_target_tensor\"", ")", ",", "\n", "(", "target_vocabulary_file", ",", "\"target_tensor\"", ")", "]", "\n", "}", "\n", "self", ".", "full_vocabularies", "=", "self", ".", "load_full_vocabularies", "(", "\n", "output_folder_pattern", ")", "\n", "", "logger", ".", "info", "(", "\"Also done loading adverb vocabulary.\"", ")", "\n", "", "if", "module", "==", "\"full\"", ":", "\n", "            ", "save_directory", "=", "old_save_directory", "\n", "", "self", ".", "transitive_verbs", "=", "self", ".", "dataset", ".", "_vocabulary", ".", "get_transitive_verbs", "(", ")", "\n", "if", "isolate_adverb_types", ":", "\n", "            ", "logger", ".", "info", "(", "\"Isolated %d examples for adverb types.\"", "%", "len", "(", "self", ".", "dataset", ".", "_data_pairs", "[", "\"isolated_adverb_types\"", "]", ")", ")", "\n", "", "logger", ".", "info", "(", "\"Occurrences of adverb types:\"", ")", "\n", "for", "adverb_type", ",", "count", "in", "self", ".", "dataset", ".", "_data_statistics", "[", "\"train\"", "]", "[", "\"type_adverbs\"", "]", ".", "items", "(", ")", ":", "\n", "            ", "logger", ".", "info", "(", "\"{}: {} occurrences.\"", ".", "format", "(", "adverb_type", ",", "count", ")", ")", "\n", "", "self", ".", "adverb_vocabulary_size", "=", "self", ".", "adverb_vocabulary", ".", "size", "\n", "self", ".", "_percentage_not_unk", "=", "{", "\n", "\"input\"", ":", "{", "\"total\"", ":", "0", ",", "\"not_unk\"", ":", "0", "}", ",", "\n", "\"target\"", ":", "{", "\"total\"", ":", "0", ",", "\"not_unk\"", ":", "0", "}", ",", "\n", "\"adverb\"", ":", "{", "\"total\"", ":", "0", ",", "\"not_unk\"", ":", "0", "}", ",", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array": [[149, 164], ["dataset_backup_alo.ModularDataset.get_vocabulary", "sentence_array.append", "sentence_array.append", "dataset_backup_alo.ModularDataset.word_to_idx"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_vocabulary", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.word_to_idx"], ["", "def", "sentence_to_array", "(", "self", ",", "sentence", ":", "List", "[", "str", "]", ",", "vocabulary", ":", "str", ",", "module", "=", "\"\"", ")", "->", "List", "[", "int", "]", ":", "\n", "        ", "\"\"\"\n        Convert each string word in a sentence to the corresponding integer from the vocabulary and append\n        a start-of-sequence and end-of-sequence token.\n        :param sentence: the sentence in words (strings)\n        :param vocabulary: whether to use the input or target vocabulary.\n        :param module: if specified, get the module-specific vocabulary\n        :return: the sentence in integers.\n        \"\"\"", "\n", "vocab", "=", "self", ".", "get_vocabulary", "(", "vocabulary", ",", "module", ")", "\n", "sentence_array", "=", "[", "vocab", ".", "sos_idx", "]", "\n", "for", "word", "in", "sentence", ":", "\n", "            ", "sentence_array", ".", "append", "(", "vocab", ".", "word_to_idx", "(", "word", ")", ")", "\n", "", "sentence_array", ".", "append", "(", "vocab", ".", "eos_idx", ")", "\n", "return", "sentence_array", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.array_to_sentence": [[165, 175], ["dataset_backup_alo.ModularDataset.get_vocabulary", "dataset_backup_alo.ModularDataset.idx_to_word"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_vocabulary", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.idx_to_word"], ["", "def", "array_to_sentence", "(", "self", ",", "sentence_array", ":", "List", "[", "int", "]", ",", "vocabulary", ":", "str", ",", "module", "=", "\"\"", ")", "->", "List", "[", "str", "]", ":", "\n", "        ", "\"\"\"\n        Translate each integer in a sentence array to the corresponding word.\n        :param sentence_array: array with integers representing words from the vocabulary.\n        :param vocabulary: whether to use the input or target vocabulary.\n        :param module: if specified, get the module-specific vocabulary\n        :return: the sentence in words.\n        \"\"\"", "\n", "vocab", "=", "self", ".", "get_vocabulary", "(", "vocabulary", ",", "module", ")", "\n", "return", "[", "vocab", ".", "idx_to_word", "(", "word_idx", ")", "for", "word_idx", "in", "sentence_array", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.load_full_vocabularies": [[176, 190], ["dataset_backup_alo.ModularDataset.vocabulary_dict.items", "os.path.join", "seq2seq.gSCAN_dataset.Vocabulary.load", "setattr", "setattr", "tensor_name.split"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load"], ["", "def", "load_full_vocabularies", "(", "self", ",", "output_folder_pattern", ":", "str", ")", ":", "\n", "        ", "full_vocabularies", "=", "{", "}", "\n", "for", "module", ",", "vocabs", "in", "self", ".", "vocabulary_dict", ".", "items", "(", ")", ":", "\n", "            ", "module_folder_path", "=", "output_folder_pattern", "%", "module", "\n", "full_vocabularies", "[", "module", "]", "=", "{", "}", "\n", "for", "vocab", ",", "tensor_name", "in", "vocabs", ":", "\n", "                ", "vocab_file", "=", "os", ".", "path", ".", "join", "(", "module_folder_path", ",", "vocab", ")", "\n", "vocabulary", "=", "Vocabulary", ".", "load", "(", "vocab_file", ")", "\n", "full_vocabularies", "[", "module", "]", "[", "tensor_name", "]", "=", "vocabulary", "\n", "vocab_attribute", "=", "tensor_name", ".", "split", "(", "\"_tensor\"", ")", "[", "0", "]", "+", "\"_vocabulary\"", "\n", "modular_vocab_attribute", "=", "module", "+", "\"_\"", "+", "vocab_attribute", "\n", "setattr", "(", "self", ",", "vocab_attribute", ",", "vocabulary", ")", "\n", "setattr", "(", "self", ",", "modular_vocab_attribute", ",", "vocabulary", ")", "\n", "", "", "return", "full_vocabularies", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.read_vocabularies": [[191, 215], ["logger.info", "enumerate", "dataset_backup_alo.ModularDataset.dataset.get_examples_with_image", "dataset_backup_alo.ModularDataset.adverb_input_vocabulary.add_sentence", "dataset_backup_alo.ModularDataset.planner_target_vocabulary.add_sentence", "dataset_backup_alo.ModularDataset.adverb_vocabulary.add_word", "dataset_backup_alo.ModularDataset.transitive_target_vocabulary.add_sentence", "dataset_backup_alo.ModularDataset.input_vocabulary.add_sentence", "dataset_backup_alo.ModularDataset.target_vocabulary.add_sentence", "dataset_backup_alo.ModularDataset.adverb_target_vocabulary.add_sentence", "dataset_backup_alo.ModularDataset.adverb_target_vocabulary.add_sentence"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_examples_with_image", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.add_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.add_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.add_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.add_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.add_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.add_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.add_sentence", "home.repos.pwc.inspect_result.modularcogsci2022_msa.seq2seq.gSCAN_dataset.Vocabulary.add_sentence"], ["", "def", "read_vocabularies", "(", "self", ")", "->", "{", "}", ":", "\n", "        ", "\"\"\"\n        Loop over all examples in the dataset and add the words in them to the vocabularies.\n        \"\"\"", "\n", "logger", ".", "info", "(", "\"Populating vocabulary...\"", ")", "\n", "for", "i", ",", "example", "in", "enumerate", "(", "self", ".", "dataset", ".", "get_examples_with_image", "(", "self", ".", "split", ",", "\n", "simple_situation_representation", "=", "True", ",", "\n", "adverb_inputs", "=", "True", ")", ")", ":", "\n", "            ", "self", ".", "adverb_input_vocabulary", ".", "add_sentence", "(", "example", "[", "\"adverb_input\"", "]", ")", "\n", "if", "example", "[", "\"verb_in_command\"", "]", "==", "\"push\"", "or", "example", "[", "\"verb_in_command\"", "]", "==", "\"pull\"", ":", "\n", "                ", "planner_target", "=", "[", "command", "for", "command", "in", "example", "[", "\"adverb_input\"", "]", "if", "command", "!=", "example", "[", "\"verb_in_command\"", "]", "]", "\n", "interactions", "=", "[", "command", "for", "command", "in", "example", "[", "\"adverb_input\"", "]", "if", "command", "==", "example", "[", "\"verb_in_command\"", "]", "]", "\n", "", "else", ":", "\n", "                ", "interactions", "=", "[", "]", "\n", "planner_target", "=", "example", "[", "\"adverb_input\"", "]", "\n", "", "self", ".", "planner_target_vocabulary", ".", "add_sentence", "(", "planner_target", ")", "\n", "self", ".", "adverb_vocabulary", ".", "add_word", "(", "example", "[", "\"adverb\"", "]", ")", "\n", "self", ".", "transitive_target_vocabulary", ".", "add_sentence", "(", "interactions", ")", "\n", "if", "self", ".", "collapse_alo", ":", "\n", "                ", "self", ".", "adverb_target_vocabulary", ".", "add_sentence", "(", "example", "[", "\"target_command\"", "]", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "adverb_target_vocabulary", ".", "add_sentence", "(", "example", "[", "\"adverb_target\"", "]", ")", "\n", "", "self", ".", "input_vocabulary", ".", "add_sentence", "(", "example", "[", "\"input_command\"", "]", ")", "\n", "self", ".", "target_vocabulary", ".", "add_sentence", "(", "example", "[", "\"target_command\"", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_vocabulary": [[216, 226], ["hasattr", "getattr", "ValueError"], "methods", ["None"], ["", "", "def", "get_vocabulary", "(", "self", ",", "vocabulary", ":", "str", ",", "module", "=", "\"\"", ")", "->", "Vocabulary", ":", "\n", "        ", "vocabulary_attribute", "=", "vocabulary", "+", "\"_vocabulary\"", "\n", "if", "vocabulary_attribute", "==", "\"final_input_vocabulary\"", ":", "\n", "            ", "vocabulary_attribute", "=", "\"adverb_target_vocabulary\"", "\n", "", "if", "module", ":", "\n", "            ", "vocabulary_attribute", "=", "module", "+", "\"_\"", "+", "vocabulary_attribute", "\n", "", "if", "hasattr", "(", "self", ",", "vocabulary_attribute", ")", ":", "\n", "            ", "return", "getattr", "(", "self", ",", "vocabulary_attribute", ")", "\n", "", "else", ":", "\n", "            ", "raise", "ValueError", "(", "\"Specified unknown vocabulary in sentence_to_array: {}\"", ".", "format", "(", "vocabulary", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.save_vocabularies": [[227, 238], ["dataset_backup_alo.ModularDataset.adverb_input_vocabulary.save", "dataset_backup_alo.ModularDataset.adverb_target_vocabulary.save", "dataset_backup_alo.ModularDataset.input_vocabulary.save", "dataset_backup_alo.ModularDataset.target_vocabulary.save", "dataset_backup_alo.ModularDataset.adverb_vocabulary.save", "dataset_backup_alo.ModularDataset.planner_target_vocabulary.save", "dataset_backup_alo.ModularDataset.transitive_target_vocabulary.save", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save"], ["", "", "def", "save_vocabularies", "(", "self", ",", "input_vocabulary_file", ":", "str", ",", "target_vocabulary_file", ":", "str", ",", "\n", "adverb_input_vocabulary_file", "=", "\"\"", ",", "adverb_target_vocabulary_file", "=", "\"\"", ",", "\n", "adverb_vocabulary_file", "=", "\"\"", ",", "planner_target_vocabulary_file", "=", "\"\"", ",", "\n", "transitive_target_vocabulary_file", "=", "\"\"", ")", ":", "\n", "        ", "self", ".", "adverb_input_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "adverb_input_vocabulary_file", ")", ")", "\n", "self", ".", "adverb_target_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "adverb_target_vocabulary_file", ")", ")", "\n", "self", ".", "input_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "input_vocabulary_file", ")", ")", "\n", "self", ".", "target_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "target_vocabulary_file", ")", ")", "\n", "self", ".", "adverb_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "adverb_vocabulary_file", ")", ")", "\n", "self", ".", "planner_target_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "planner_target_vocabulary_file", ")", ")", "\n", "self", ".", "transitive_target_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "transitive_target_vocabulary_file", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_percentage_unk": [[239, 244], ["ValueError"], "methods", ["None"], ["", "def", "get_percentage_unk", "(", "self", ",", "vocabulary", ":", "str", ")", ":", "\n", "        ", "if", "vocabulary", "not", "in", "self", ".", "_percentage_not_unk", ":", "\n", "            ", "raise", "ValueError", "(", "\"Unknown vocabulary %s passed to get_percentage_unk(). \"", "\n", "\"Options are 'input', 'target', 'adverb'.\"", "%", "vocabulary", ")", "\n", "", "return", "-", "1.", "\n", "#return 1. - (self._percentage_not_unk[vocabulary][\"not_unk\"] / self._percentage_not_unk[vocabulary][\"total\"])", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.remove_transitive_verbs": [[246, 249], ["None"], "methods", ["None"], ["", "def", "remove_transitive_verbs", "(", "self", ",", "input_sequence", ":", "List", "[", "str", "]", ")", "->", "List", "[", "str", "]", ":", "\n", "        ", "removed_transitive", "=", "[", "word", "for", "word", "in", "input_sequence", "if", "word", "not", "in", "self", ".", "transitive_verbs", "]", "\n", "return", "removed_transitive", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.convert_example_for_modularity": [[250, 283], ["original_adverb_input.copy", "original_adverb_target.copy", "original_adverb_input.copy", "original_adverb_target.copy", "original_adverb_target.copy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "convert_example_for_modularity", "(", "self", ",", "example", ")", ":", "\n", "        ", "original_adverb_input", "=", "example", "[", "\"adverb_input\"", "]", "\n", "original_adverb_target", "=", "example", "[", "\"adverb_target\"", "]", "\n", "verb_in_command", "=", "example", "[", "\"verb_in_command\"", "]", "\n", "planner_target", "=", "original_adverb_input", ".", "copy", "(", ")", "\n", "adverb_target", "=", "original_adverb_target", ".", "copy", "(", ")", "\n", "if", "verb_in_command", "==", "\"push\"", "or", "verb_in_command", "==", "\"pull\"", ":", "\n", "            ", "planner_target", "=", "[", "command", "for", "command", "in", "planner_target", "if", "command", "!=", "verb_in_command", "]", "\n", "interactions", "=", "[", "command", "for", "command", "in", "example", "[", "\"target_command\"", "]", "if", "command", "==", "verb_in_command", "]", "\n", "", "else", ":", "\n", "            ", "interactions", "=", "[", "]", "\n", "", "interaction_target", "=", "[", "]", "\n", "adverb_input", "=", "original_adverb_input", ".", "copy", "(", ")", "\n", "if", "verb_in_command", "not", "in", "interaction_target", ":", "\n", "            ", "interaction_target", "+=", "interactions", "\n", "", "if", "verb_in_command", "not", "in", "adverb_input", ":", "\n", "            ", "adverb_input", "+=", "interactions", "\n", "", "if", "example", "[", "\"type_adverb\"", "]", "==", "\"movement_rewrite\"", "or", "example", "[", "\"type_adverb\"", "]", "==", "\"movement\"", ":", "\n", "            ", "planner_target", "=", "[", "command", "for", "command", "in", "original_adverb_target", "if", "command", "!=", "verb_in_command", "]", "\n", "interaction_target", "=", "interactions", "\n", "adverb_input", "=", "original_adverb_target", ".", "copy", "(", ")", "+", "interactions", "\n", "adverb_target", "=", "original_adverb_target", ".", "copy", "(", ")", "+", "interactions", "\n", "", "if", "not", "example", "[", "\"adverb\"", "]", ":", "\n", "            ", "planner_target", "=", "[", "command", "for", "command", "in", "original_adverb_target", "if", "command", "not", "in", "[", "\"push\"", ",", "\"pull\"", "]", "]", "\n", "adverb_input", "=", "original_adverb_target", "\n", "", "example", "[", "\"adverb_input\"", "]", "=", "adverb_input", "\n", "if", "self", ".", "collapse_alo", ":", "\n", "            ", "example", "[", "\"adverb_target\"", "]", "=", "example", "[", "\"target_command\"", "]", "\n", "", "else", ":", "\n", "            ", "example", "[", "\"adverb_target\"", "]", "=", "adverb_target", "\n", "", "example", "[", "\"planner_target\"", "]", "=", "planner_target", "\n", "example", "[", "\"interaction_target\"", "]", "=", "interaction_target", "\n", "return", "example", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.make_dummy_sequence_planner_target": [[284, 340], ["None"], "methods", ["None"], ["", "def", "make_dummy_sequence_planner_target", "(", "self", ",", "example", ",", "sequence", "=", "True", ")", ":", "\n", "        ", "direction_to_target", "=", "example", "[", "\"situation_representation\"", "]", "[", "'direction_to_target'", "]", "\n", "if", "direction_to_target", "in", "[", "'n'", ",", "'e'", ",", "'s'", ",", "'w'", "]", ":", "\n", "            ", "if", "example", "[", "\"adverb\"", "]", "in", "[", "\"hesitantly\"", ",", "\"cautiously\"", "]", ":", "\n", "                ", "direction_translation", "=", "{", "\n", "\"n\"", ":", "\"turn left\"", ",", "\n", "\"e\"", ":", "\"walk\"", ",", "\n", "\"s\"", ":", "\"turn right\"", ",", "\n", "\"w\"", ":", "\"turn left\"", "\n", "}", "\n", "", "else", ":", "\n", "                ", "direction_translation", "=", "{", "\n", "\"n\"", ":", "\"north\"", ",", "\n", "\"e\"", ":", "\"east\"", ",", "\n", "\"s\"", ":", "\"south\"", ",", "\n", "\"w\"", ":", "\"west\"", "\n", "}", "\n", "", "dummy_planner_target", "=", "direction_translation", "[", "direction_to_target", "]", "\n", "", "elif", "example", "[", "\"adverb\"", "]", "==", "\"while zigzagging\"", ":", "\n", "            ", "direction_translation", "=", "{", "\n", "\"ne\"", ":", "\"east\"", ",", "\n", "\"sw\"", ":", "\"west\"", ",", "\n", "\"se\"", ":", "\"east\"", ",", "\n", "\"nw\"", ":", "\"west\"", "\n", "}", "\n", "dummy_planner_target", "=", "direction_translation", "[", "direction_to_target", "]", "\n", "", "else", ":", "\n", "            ", "if", "example", "[", "\"adverb\"", "]", "in", "[", "\"hesitantly\"", ",", "\"cautiously\"", "]", ":", "\n", "                ", "direction_translation", "=", "{", "\n", "\"ne\"", ":", "\"walk\"", ",", "\n", "\"sw\"", ":", "\"turn right\"", ",", "\n", "\"se\"", ":", "\"turn right\"", ",", "\n", "\"nw\"", ":", "\"turn left\"", "\n", "}", "\n", "", "else", ":", "\n", "                ", "direction_translation", "=", "{", "\n", "\"ne\"", ":", "\"north\"", ",", "\n", "\"sw\"", ":", "\"south\"", ",", "\n", "\"se\"", ":", "\"south\"", ",", "\n", "\"nw\"", ":", "\"north\"", "\n", "}", "\n", "", "dummy_planner_target", "=", "direction_translation", "[", "direction_to_target", "]", "\n", "", "if", "sequence", ":", "\n", "            ", "dummy_planner_target", "=", "[", "dummy_planner_target", "]", "\n", "", "else", ":", "\n", "            ", "int_translate", "=", "{", "\n", "\"north\"", ":", "0", ",", "\n", "\"east\"", ":", "1", ",", "\n", "\"south\"", ":", "2", ",", "\n", "\"west\"", ":", "3", ",", "\n", "\"turn left\"", ":", "4", ",", "\n", "\"turn right\"", ":", "5", ",", "\n", "\"walk\"", ":", "6", "\n", "}", "\n", "dummy_planner_target", "=", "int_translate", "[", "dummy_planner_target", "]", "\n", "", "return", "dummy_planner_target", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_data_iterator": [[341, 586], ["isinstance", "logger.info", "numpy.array", "enumerate", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "dataset_backup_alo.ModularDataset.dataset.get_examples_with_image", "dataset_backup_alo.ModularDataset.convert_example_for_modularity", "dataset_backup_alo.ModularDataset.adverb_vocabulary.word_to_idx", "dataset_backup_alo.ModularDataset.sentence_to_array", "dataset_backup_alo.ModularDataset.sentence_to_array", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "numpy.append", "numpy.append", "numpy.append", "int", "int", "dataset_backup_alo.ModularDataset.make_dummy_sequence_planner_target", "dataset_backup_alo.ModularDataset.make_dummy_sequence_planner_target", "dataset_backup_alo.ModularDataset.sentence_to_array", "dataset_backup_alo.ModularDataset.sentence_to_array", "dataset_backup_alo.ModularDataset.sentence_to_array", "dataset_backup_alo.ModularDataset.sentence_to_array", "dataset_backup_alo.ModularDataset.sentence_to_array", "dataset_backup_alo.ModularDataset.adverb_vocabulary.word_to_idx", "dataset_backup_alo.ModularDataset.sentence_to_array", "dataset_backup_alo.ModularDataset.sentence_to_array", "dataset_backup_alo.ModularDataset.sentence_to_array", "sum", "len", "int", "sum", "len", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "numpy.append", "numpy.append", "numpy.append", "numpy.append", "numpy.append", "numpy.append", "numpy.append", "torch.tensor().unsqueeze", "torch.tensor().unsqueeze", "len", "numpy.array", "len", "int", "int", "dataset_backup_alo.ModularDataset.get_vocabulary().contains_word", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "len", "len", "NotImplementedError", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "numpy.array", "int", "int", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "len", "len", "len", "len", "len", "len", "len", "torch.tensor", "torch.tensor", "input_keys_to_pad.keys", "dataset_backup_alo.ModularDataset.get_vocabulary().contains_word", "dataset_backup_alo.ModularDataset.get_vocabulary", "dataset_backup_alo.ModularDataset.get_vocabulary().contains_word", "dataset_backup_alo.ModularDataset.make_modular_batch", "dataset_backup_alo.ModularDataset.make_modular_batch", "dataset_backup_alo.ModularDataset.get_vocabulary", "dataset_backup_alo.ModularDataset.get_vocabulary"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_examples_with_image", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.convert_example_for_modularity", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.word_to_idx", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.make_dummy_sequence_planner_target", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.make_dummy_sequence_planner_target", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.word_to_idx", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.sentence_to_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.contains_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.contains_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_vocabulary", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.contains_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.make_modular_batch", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.make_modular_batch", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_vocabulary", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.get_vocabulary"], ["", "def", "get_data_iterator", "(", "self", ",", "input_keys", "=", "None", ",", "input_keys_to_pad", "=", "None", ",", "target_keys", "=", "None", ",", "target_keys_to_pad", "=", "None", ",", "\n", "batch_size", "=", "None", ",", "max_examples", "=", "None", ",", "simple_situation_representation", "=", "True", ",", "shuffle", "=", "False", ",", "\n", "model_to_yield", "=", "\"full\"", ",", "modular", "=", "True", ")", "->", "{", "}", ":", "\n", "        ", "\"\"\"\n        Loop over the data examples in GroundedScan and convert them to tensors, also save the lengths\n        for input and target sequences that are needed for padding.\n        :param input_keys:\n        :param input_keys_to_pad:\n        :param target_keys:\n        :param target_keys_to_pad:\n        :param batch_size\n        :param max_examples: how many examples to read maximally, read all if None.\n        :param simple_situation_representation: whether to read the full situation image in RGB or the simplified\n        :param shuffle:\n        :param model_to_yield:\n        :param modular:\n        smaller representation.\n        \"\"\"", "\n", "assert", "isinstance", "(", "batch_size", ",", "int", ")", ",", "\"Provide a batch size.\"", "\n", "assert", "model_to_yield", "in", "[", "\"full\"", "]", "+", "self", ".", "all_modules", "\n", "\n", "logger", ".", "info", "(", "\"Converting dataset to tensors...\"", ")", "\n", "current_examples_batch", "=", "np", ".", "array", "(", "[", "]", ")", "\n", "current_lengths_batch", "=", "{", "\n", "\"adverb_input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"adverb_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"transitive_input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"transitive_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"planner_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"dummy_planner_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"final_input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", "\n", "}", "\n", "for", "i", ",", "example", "in", "enumerate", "(", "self", ".", "dataset", ".", "get_examples_with_image", "(", "\n", "self", ".", "split", ",", "shuffle", "=", "shuffle", ",", "simple_situation_representation", "=", "simple_situation_representation", ",", "\n", "adverb_inputs", "=", "modular", ")", ")", ":", "\n", "            ", "if", "max_examples", ":", "\n", "                ", "if", "len", "(", "self", ".", "_examples", ")", ">", "max_examples", ":", "\n", "                    ", "return", "\n", "", "", "empty_example", "=", "{", "}", "\n", "\n", "example", "=", "self", ".", "convert_example_for_modularity", "(", "example", ")", "\n", "if", "modular", ":", "\n", "#  Adverb model input and target TODO: if no adverb?", "\n", "                ", "adverb_input", "=", "example", "[", "\"adverb_input\"", "]", "\n", "if", "(", "example", "[", "\"type_adverb\"", "]", "==", "\"movement_rewrite\"", "or", "example", "[", "\"type_adverb\"", "]", "==", "\"movement\"", ")", "and", "not", "self", ".", "collapse_alo", ":", "\n", "                    ", "adverb_target", "=", "[", "]", "\n", "", "else", ":", "\n", "                    ", "adverb_target", "=", "example", "[", "\"adverb_target\"", "]", "\n", "", "if", "not", "example", "[", "\"adverb\"", "]", ":", "\n", "                    ", "adverb_target", "=", "[", "]", "\n", "\n", "", "", "final_input", "=", "example", "[", "\"adverb_target\"", "]", "\n", "\n", "# Position model input and target", "\n", "input_commands", "=", "example", "[", "\"input_command\"", "]", "\n", "situation_image", "=", "example", "[", "\"situation_image\"", "]", "\n", "grid_size", "=", "example", "[", "\"situation_representation\"", "]", "[", "\"grid_size\"", "]", "\n", "agent_position", "=", "example", "[", "\"situation_representation\"", "]", "[", "\"agent_position\"", "]", "\n", "agent_direction", "=", "example", "[", "\"situation_representation\"", "]", "[", "\"agent_direction\"", "]", "\n", "agent_position_representation", "=", "(", "int", "(", "agent_position", "[", "\"row\"", "]", ")", "*", "grid_size", ")", "+", "int", "(", "agent_position", "[", "\"column\"", "]", ")", "\n", "target_position", "=", "example", "[", "\"situation_representation\"", "]", "[", "\"target_object\"", "]", "[", "\"position\"", "]", "\n", "target_position_representation", "=", "(", "int", "(", "target_position", "[", "\"row\"", "]", ")", "*", "grid_size", ")", "+", "int", "(", "target_position", "[", "\"column\"", "]", ")", "\n", "\n", "if", "modular", ":", "\n", "# Planner model input=positions/direction and target", "\n", "# planner_target = self.remove_transitive_verbs(adverb_input)", "\n", "                ", "planner_target", "=", "example", "[", "\"planner_target\"", "]", "\n", "# Transitive model input=planner_target and target", "\n", "transitive_target", "=", "example", "[", "\"interaction_target\"", "]", "if", "example", "[", "\"verb_in_command\"", "]", "in", "self", ".", "transitive_verbs", "else", "[", "]", "\n", "dummy_planner_target", "=", "self", ".", "make_dummy_sequence_planner_target", "(", "example", ",", "sequence", "=", "False", ")", "\n", "dummy_sequence_planner_target", "=", "self", ".", "make_dummy_sequence_planner_target", "(", "example", ",", "sequence", "=", "True", ")", "\n", "# dummy_sequence_planner_target = example[\"planner_target\"][0:1]", "\n", "if", "example", "[", "\"verb_in_command\"", "]", "==", "\"pull\"", ":", "\n", "                    ", "dummy_interaction_target", "=", "transitive_target", "\n", "", "elif", "example", "[", "\"verb_in_command\"", "]", "==", "\"push\"", ":", "\n", "                    ", "dummy_interaction_target", "=", "transitive_target", "\n", "", "else", ":", "\n", "                    ", "dummy_interaction_target", "=", "transitive_target", "\n", "\n", "# Final input=adverb_target and target", "\n", "", "", "target_commands", "=", "example", "[", "\"target_command\"", "]", "\n", "if", "example", "[", "\"adverb\"", "]", "==", "\"cautiously\"", "or", "example", "[", "\"adverb\"", "]", "==", "\"hesitantly\"", ":", "\n", "                ", "target_commands", "=", "[", "]", "\n", "", "adverb_embedding", "=", "self", ".", "adverb_vocabulary", ".", "word_to_idx", "(", "example", "[", "\"adverb\"", "]", ")", "\n", "\n", "example_information", "=", "{", "\n", "\"command\"", ":", "example", "[", "\"input_command\"", "]", ",", "\n", "\"adverb\"", ":", "example", "[", "\"adverb\"", "]", "if", "modular", "else", "None", ",", "\n", "\"type_adverb\"", ":", "example", "[", "\"type_adverb\"", "]", "if", "modular", "else", "None", ",", "\n", "\"adverb_input\"", ":", "adverb_input", "if", "modular", "else", "None", ",", "\n", "\"adverb_target\"", ":", "adverb_target", "if", "modular", "else", "None", ",", "\n", "\"final_input\"", ":", "final_input", "if", "modular", "else", "None", ",", "\n", "\"target_command\"", ":", "example", "[", "\"target_command\"", "]", ",", "\n", "\"verb_in_command\"", ":", "example", "[", "\"verb_in_command\"", "]", "if", "modular", "else", "None", ",", "\n", "\"derivation_representation\"", ":", "example", "[", "\"derivation_representation\"", "]", ",", "\n", "\"situation_representation\"", ":", "example", "[", "\"situation_representation\"", "]", "\n", "}", "\n", "\n", "# Position model sequence", "\n", "input_array", "=", "self", ".", "sentence_to_array", "(", "input_commands", ",", "vocabulary", "=", "\"input\"", ")", "\n", "\n", "# Final model sequence", "\n", "target_array", "=", "self", ".", "sentence_to_array", "(", "target_commands", ",", "vocabulary", "=", "\"target\"", ")", "\n", "\n", "if", "modular", ":", "\n", "# Planner model sequence", "\n", "                ", "planner_target_array", "=", "self", ".", "sentence_to_array", "(", "planner_target", ",", "vocabulary", "=", "\"planner_target\"", ")", "\n", "dummy_planner_target_array", "=", "self", ".", "sentence_to_array", "(", "dummy_sequence_planner_target", ",", "\n", "vocabulary", "=", "\"planner_target\"", ")", "\n", "\n", "transitive_input_array", "=", "self", ".", "sentence_to_array", "(", "planner_target", ",", "vocabulary", "=", "\"planner_target\"", ")", "\n", "\n", "# Transitive model sequence", "\n", "transitive_target_array", "=", "self", ".", "sentence_to_array", "(", "transitive_target", ",", "vocabulary", "=", "\"transitive_target\"", ")", "\n", "dummy_interaction_target_array", "=", "self", ".", "sentence_to_array", "(", "dummy_interaction_target", ",", "\n", "vocabulary", "=", "\"transitive_target\"", ")", "\n", "\n", "# Adverb model sequences", "\n", "adverb_state", "=", "self", ".", "adverb_vocabulary", ".", "word_to_idx", "(", "example", "[", "\"adverb\"", "]", ")", "\n", "adverb_input_array", "=", "self", ".", "sentence_to_array", "(", "adverb_input", ",", "vocabulary", "=", "\"adverb_input\"", ")", "\n", "adverb_target_array", "=", "self", ".", "sentence_to_array", "(", "adverb_target", ",", "vocabulary", "=", "\"adverb_target\"", ")", "\n", "\n", "final_input_array", "=", "self", ".", "sentence_to_array", "(", "final_input", ",", "vocabulary", "=", "\"adverb_target\"", ")", "\n", "\n", "num_not_unk_input", "=", "sum", "(", "[", "int", "(", "self", ".", "get_vocabulary", "(", "\"input\"", ")", ".", "contains_word", "(", "word", ")", ")", "\n", "for", "word", "in", "adverb_input", "]", ")", "\n", "self", ".", "_percentage_not_unk", "[", "\"input\"", "]", "[", "\"total\"", "]", "+=", "len", "(", "adverb_input", ")", "\n", "self", ".", "_percentage_not_unk", "[", "\"input\"", "]", "[", "\"not_unk\"", "]", "+=", "num_not_unk_input", "\n", "num_not_unk_adverb", "=", "int", "(", "self", ".", "get_vocabulary", "(", "\"adverb\"", ")", ".", "contains_word", "(", "\n", "example", "[", "\"adverb\"", "]", ")", ")", "\n", "self", ".", "_percentage_not_unk", "[", "\"adverb\"", "]", "[", "\"total\"", "]", "+=", "1", "\n", "self", ".", "_percentage_not_unk", "[", "\"adverb\"", "]", "[", "\"not_unk\"", "]", "+=", "num_not_unk_adverb", "\n", "num_not_unk_target", "=", "sum", "(", "[", "int", "(", "self", ".", "get_vocabulary", "(", "\"adverb_target\"", ")", ".", "contains_word", "(", "word", ")", ")", "\n", "for", "word", "in", "adverb_target", "]", ")", "\n", "self", ".", "_percentage_not_unk", "[", "\"target\"", "]", "[", "\"total\"", "]", "+=", "len", "(", "adverb_target", ")", "\n", "self", ".", "_percentage_not_unk", "[", "\"target\"", "]", "[", "\"not_unk\"", "]", "+=", "num_not_unk_target", "\n", "# Planner model tensor", "\n", "empty_example", "[", "\"planner_target_tensor\"", "]", "=", "torch", ".", "tensor", "(", "planner_target_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"dummy_planner_target_tensor\"", "]", "=", "torch", ".", "tensor", "(", "dummy_planner_target_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "\n", "# Transitive model tensor", "\n", "empty_example", "[", "\"transitive_input_tensor\"", "]", "=", "torch", ".", "tensor", "(", "transitive_input_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"transitive_target_tensor\"", "]", "=", "torch", ".", "tensor", "(", "transitive_target_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "\n", "# Adverb model tensors", "\n", "empty_example", "[", "\"adverb_input_tensor\"", "]", "=", "torch", ".", "tensor", "(", "adverb_input_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"adverb_state\"", "]", "=", "torch", ".", "tensor", "(", "adverb_state", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"adverb_target_tensor\"", "]", "=", "torch", ".", "tensor", "(", "adverb_target_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"final_input_tensor\"", "]", "=", "torch", ".", "tensor", "(", "final_input_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "current_lengths_batch", "[", "\"adverb_input_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "current_lengths_batch", "[", "\"adverb_input_tensor_lengths\"", "]", ",", "\n", "[", "len", "(", "adverb_input_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"adverb_target_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"adverb_target_tensor_lengths\"", "]", ",", "[", "len", "(", "adverb_target_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"planner_target_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"planner_target_tensor_lengths\"", "]", ",", "[", "len", "(", "planner_target_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"dummy_planner_target_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"dummy_planner_target_tensor_lengths\"", "]", ",", "[", "len", "(", "dummy_planner_target_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"transitive_input_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"transitive_input_tensor_lengths\"", "]", ",", "[", "len", "(", "transitive_input_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"transitive_target_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"transitive_target_tensor_lengths\"", "]", ",", "[", "len", "(", "transitive_target_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"final_input_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"final_input_tensor_lengths\"", "]", ",", "[", "len", "(", "final_input_array", ")", "]", ")", "\n", "empty_example", "[", "\"dummy_planner_target\"", "]", "=", "torch", ".", "tensor", "(", "dummy_planner_target", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"dummy_interaction_target\"", "]", "=", "torch", ".", "tensor", "(", "dummy_interaction_target_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "\n", "# Position model tensors", "\n", "", "empty_example", "[", "\"input_tensor\"", "]", "=", "torch", ".", "tensor", "(", "input_array", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"world_state_tensor\"", "]", "=", "torch", ".", "tensor", "(", "situation_image", ",", "dtype", "=", "torch", ".", "float", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"agent_position\"", "]", "=", "torch", ".", "tensor", "(", "agent_position_representation", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"target_position\"", "]", "=", "torch", ".", "tensor", "(", "target_position_representation", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"agent_direction\"", "]", "=", "torch", ".", "tensor", "(", "agent_direction", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"adverb_embedding\"", "]", "=", "torch", ".", "tensor", "(", "adverb_embedding", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "\n", "# Final model tensor", "\n", "empty_example", "[", "\"target_tensor\"", "]", "=", "torch", ".", "tensor", "(", "target_array", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "\n", "empty_example", "[", "\"example_information\"", "]", "=", "example_information", "\n", "\n", "current_lengths_batch", "[", "\"input_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"input_tensor_lengths\"", "]", ",", "[", "len", "(", "input_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"target_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"target_tensor_lengths\"", "]", ",", "[", "len", "(", "target_array", ")", "]", ")", "\n", "\n", "current_examples_batch", "=", "np", ".", "append", "(", "current_examples_batch", ",", "[", "empty_example", "]", ")", "\n", "if", "len", "(", "current_examples_batch", ")", "==", "batch_size", ":", "\n", "                ", "if", "modular", ":", "\n", "                    ", "if", "model_to_yield", "!=", "\"full\"", ":", "\n", "                        ", "input_keys_to_pad_d", "=", "{", "input_key_to_pad", ":", "current_lengths_batch", "[", "input_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "input_key_to_pad", "in", "input_keys_to_pad", "}", "\n", "target_keys_to_pad_d", "=", "{", "target_key_to_pad", ":", "current_lengths_batch", "[", "target_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "target_key_to_pad", "in", "target_keys_to_pad", "}", "\n", "yield", "self", ".", "make_modular_batch", "(", "current_examples_batch", ",", "input_keys", ",", "input_keys_to_pad_d", ",", "\n", "target_keys", ",", "target_keys_to_pad_d", ")", "\n", "", "else", ":", "\n", "                        ", "batches", "=", "{", "}", "\n", "for", "model_name", "in", "input_keys_to_pad", ".", "keys", "(", ")", ":", "\n", "                            ", "input_keys_to_pad_d", "=", "{", "\n", "input_key_to_pad", ":", "current_lengths_batch", "[", "input_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "input_key_to_pad", "in", "input_keys_to_pad", "[", "model_name", "]", "}", "\n", "target_keys_to_pad_d", "=", "{", "\n", "target_key_to_pad", ":", "current_lengths_batch", "[", "target_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "target_key_to_pad", "in", "target_keys_to_pad", "[", "model_name", "]", "}", "\n", "batch", "=", "self", ".", "make_modular_batch", "(", "current_examples_batch", ",", "input_keys", "[", "model_name", "]", ",", "\n", "input_keys_to_pad_d", ",", "target_keys", "[", "model_name", "]", ",", "\n", "target_keys_to_pad_d", ")", "\n", "batches", "[", "model_name", "]", "=", "batch", "\n", "", "yield", "batches", "\n", "", "", "else", ":", "\n", "                    ", "raise", "NotImplementedError", "(", "\"model_to_yield=%s not implemented.\"", "%", "model_to_yield", ")", "\n", "", "current_examples_batch", "=", "np", ".", "array", "(", "[", "]", ")", "\n", "current_lengths_batch", "=", "{", "\n", "\"adverb_input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"adverb_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"transitive_input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"transitive_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"planner_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"dummy_planner_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"final_input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.make_modular_batch": [[588, 641], ["inputs.items", "input_keys_to_pad.items", "targets.items", "target_keys_to_pad.items", "list", "list", "extra_information_batch.append", "torch.cat", "torch.cat", "len", "input_keys_to_pad.keys", "target_keys_to_pad.keys", "numpy.max", "torch.cat", "inputs[].append", "inputs[].append", "numpy.max", "torch.cat", "targets[].append", "targets[].append", "example[].size", "example[].size", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros", "torch.zeros", "int", "int"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "", "", "def", "make_modular_batch", "(", "self", ",", "examples", ":", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ",", "input_keys", ":", "List", "[", "str", "]", ",", "\n", "input_keys_to_pad", ":", "Dict", "[", "str", ",", "np", ".", "ndarray", "]", ",", "target_keys", ":", "List", "[", "str", "]", ",", "\n", "target_keys_to_pad", ":", "Dict", "[", "str", ",", "np", ".", "ndarray", "]", ")", ":", "\n", "        ", "\"\"\"\n        Prepare a batch of inputs and targets for module=position.\n        :param examples: a dict with inputs in tensor form and other information about the examples\n        :param input_keys:\n        :param input_keys_to_pad:\n        :param target_keys:\n        :param target_keys_to_pad:\n        :return: a batch with inputs, targets, and extra information about the examples (needed for writing predictions)\n        \"\"\"", "\n", "all_input_keys", "=", "input_keys", "+", "list", "(", "input_keys_to_pad", ".", "keys", "(", ")", ")", "\n", "all_target_keys", "=", "target_keys", "+", "list", "(", "target_keys_to_pad", ".", "keys", "(", ")", ")", "\n", "inputs", "=", "{", "key", ":", "[", "]", "for", "key", "in", "all_input_keys", "}", "\n", "targets", "=", "{", "key", "+", "\"_targets\"", ":", "[", "]", "for", "key", "in", "all_target_keys", "}", "\n", "extra_information_batch", "=", "[", "]", "\n", "for", "example", "in", "examples", ":", "\n", "            ", "for", "key", "in", "input_keys_to_pad", ":", "\n", "                ", "max_input_length", "=", "np", ".", "max", "(", "input_keys_to_pad", "[", "key", "]", ")", "\n", "to_pad_input", "=", "max_input_length", "-", "example", "[", "key", "]", ".", "size", "(", "1", ")", "\n", "padded_input", "=", "torch", ".", "cat", "(", "[", "\n", "example", "[", "key", "]", ",", "\n", "torch", ".", "zeros", "(", "int", "(", "to_pad_input", ")", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "0", ")", "]", ",", "dim", "=", "1", ")", "\n", "inputs", "[", "key", "]", ".", "append", "(", "padded_input", ")", "\n", "", "for", "key", "in", "input_keys", ":", "\n", "                ", "inputs", "[", "key", "]", ".", "append", "(", "example", "[", "key", "]", ")", "\n", "", "for", "key", "in", "target_keys_to_pad", ":", "\n", "                ", "max_target_length", "=", "np", ".", "max", "(", "target_keys_to_pad", "[", "key", "]", ")", "\n", "to_pad_target", "=", "max_target_length", "-", "example", "[", "key", "]", ".", "size", "(", "1", ")", "\n", "padded_target", "=", "torch", ".", "cat", "(", "[", "\n", "example", "[", "key", "]", ",", "\n", "torch", ".", "zeros", "(", "int", "(", "to_pad_target", ")", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "0", ")", "]", ",", "dim", "=", "1", ")", "\n", "targets", "[", "key", "+", "\"_targets\"", "]", ".", "append", "(", "padded_target", ")", "\n", "", "for", "key", "in", "target_keys", ":", "\n", "                ", "targets", "[", "key", "+", "\"_targets\"", "]", ".", "append", "(", "example", "[", "key", "]", ")", "\n", "", "extra_information_batch", ".", "append", "(", "example", ")", "\n", "\n", "", "for", "input_key", ",", "input_values", "in", "inputs", ".", "items", "(", ")", ":", "\n", "            ", "input_batch", "=", "torch", ".", "cat", "(", "input_values", ",", "dim", "=", "0", ")", "\n", "inputs", "[", "input_key", "]", "=", "input_batch", "\n", "", "for", "input_key", ",", "input_lengths", "in", "input_keys_to_pad", ".", "items", "(", ")", ":", "\n", "            ", "inputs", "[", "input_key", "+", "\"_lengths\"", "]", "=", "input_lengths", "\n", "", "for", "target_key", ",", "target_values", "in", "targets", ".", "items", "(", ")", ":", "\n", "            ", "target_batch", "=", "torch", ".", "cat", "(", "target_values", ",", "dim", "=", "0", ")", "\n", "targets", "[", "target_key", "]", "=", "target_batch", "\n", "", "for", "target_key", ",", "target_lengths", "in", "target_keys_to_pad", ".", "items", "(", ")", ":", "\n", "            ", "targets", "[", "target_key", "+", "\"_lengths\"", "]", "=", "target_keys_to_pad", "[", "target_key", "]", "\n", "", "return", "{", "\n", "\"inputs\"", ":", "inputs", ",", "\n", "\"targets\"", ":", "targets", ",", "\n", "\"batch_size\"", ":", "len", "(", "examples", ")", ",", "\n", "\"extra_information\"", ":", "extra_information_batch", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.make_position_model_batch": [[643, 685], ["numpy.max", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "extra_information_batch.append", "example[].size", "torch.zeros().unsqueeze", "torch.zeros", "int"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "make_position_model_batch", "(", "self", ",", "examples", ",", "input_lengths", ")", ":", "\n", "        ", "\"\"\"\n        Prepare a batch of inputs and targets for module=position.\n        :param examples: a dict with inputs in tensor form and other information about the examples\n        :param input_lengths: the lengths of the input commands\n        :return: a batch with inputs, targets, and extra information about the examples (needed for writing predictions)\n        \"\"\"", "\n", "max_input_length", "=", "np", ".", "max", "(", "input_lengths", ")", "\n", "input_batch", "=", "[", "]", "\n", "agent_position_batch", "=", "[", "]", "\n", "world_state_batch", "=", "[", "]", "\n", "target_position_batch", "=", "[", "]", "\n", "start_direction_batch", "=", "[", "]", "\n", "extra_information_batch", "=", "[", "]", "\n", "for", "example", "in", "examples", ":", "\n", "            ", "to_pad_input", "=", "max_input_length", "-", "example", "[", "\"input_tensor\"", "]", ".", "size", "(", "1", ")", "\n", "padded_input", "=", "torch", ".", "cat", "(", "[", "\n", "example", "[", "\"input_tensor\"", "]", ",", "\n", "torch", ".", "zeros", "(", "int", "(", "to_pad_input", ")", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "0", ")", "]", ",", "dim", "=", "1", ")", "\n", "input_batch", ".", "append", "(", "padded_input", ")", "\n", "world_state_batch", ".", "append", "(", "example", "[", "\"world_state_tensor\"", "]", ")", "\n", "agent_position_batch", ".", "append", "(", "example", "[", "\"agent_position\"", "]", ")", "\n", "target_position_batch", ".", "append", "(", "example", "[", "\"target_position\"", "]", ")", "\n", "start_direction_batch", ".", "append", "(", "example", "[", "\"agent_direction\"", "]", ")", "\n", "extra_information_batch", ".", "append", "(", "example", ")", "\n", "", "input_batch", "=", "torch", ".", "cat", "(", "input_batch", ",", "dim", "=", "0", ")", "\n", "world_state_batch", "=", "torch", ".", "cat", "(", "world_state_batch", ",", "dim", "=", "0", ")", "\n", "agent_position_batch", "=", "torch", ".", "cat", "(", "agent_position_batch", ",", "dim", "=", "0", ")", "\n", "target_position_batch", "=", "torch", ".", "cat", "(", "target_position_batch", ",", "dim", "=", "0", ")", "\n", "start_direction_batch", "=", "torch", ".", "cat", "(", "start_direction_batch", ",", "dim", "=", "0", ")", "\n", "return", "{", "\n", "\"inputs\"", ":", "{", "\n", "\"input_tensor\"", ":", "input_batch", ",", "\n", "\"input_tensor_lengths\"", ":", "input_lengths", ",", "\n", "\"world_state_tensor\"", ":", "world_state_batch", ",", "\n", "}", ",", "\n", "\"targets\"", ":", "{", "\n", "\"agent_direction_targets\"", ":", "start_direction_batch", ",", "\n", "\"agent_position_targets\"", ":", "agent_position_batch", ",", "\n", "\"target_position_targets\"", ":", "target_position_batch", "\n", "}", ",", "\n", "\"extra_information\"", ":", "extra_information_batch", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.make_planner_batch": [[687, 724], ["numpy.max", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat.append", "torch.cat.append", "torch.cat.append", "torch.cat.append", "extra_information_batch.append", "example[].size", "torch.zeros().unsqueeze", "torch.zeros", "int"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "make_planner_batch", "(", "self", ",", "examples", ",", "planner_target_lengths", ")", ":", "\n", "        ", "\"\"\"\n\n        :param examples:\n        :param planner_target_lengths:\n        :return:\n        \"\"\"", "\n", "max_target_length", "=", "np", ".", "max", "(", "planner_target_lengths", ")", "\n", "target_batch", "=", "[", "]", "\n", "agent_position_batch", "=", "[", "]", "\n", "target_position_batch", "=", "[", "]", "\n", "start_direction_batch", "=", "[", "]", "\n", "extra_information_batch", "=", "[", "]", "\n", "for", "example", "in", "examples", ":", "\n", "            ", "to_pad_target", "=", "max_target_length", "-", "example", "[", "\"planner_target_tensor\"", "]", ".", "size", "(", "1", ")", "\n", "padded_target", "=", "torch", ".", "cat", "(", "[", "\n", "example", "[", "\"planner_target_tensor\"", "]", ",", "\n", "torch", ".", "zeros", "(", "int", "(", "to_pad_target", ")", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "0", ")", "]", ",", "dim", "=", "1", ")", "\n", "target_batch", ".", "append", "(", "padded_target", ")", "\n", "agent_position_batch", ".", "append", "(", "example", "[", "\"agent_position\"", "]", ")", "\n", "target_position_batch", ".", "append", "(", "example", "[", "\"target_position\"", "]", ")", "\n", "start_direction_batch", ".", "append", "(", "example", "[", "\"agent_direction\"", "]", ")", "\n", "extra_information_batch", ".", "append", "(", "example", ")", "\n", "", "target_batch", "=", "torch", ".", "cat", "(", "target_batch", ",", "dim", "=", "0", ")", "\n", "agent_position_batch", "=", "torch", ".", "cat", "(", "agent_position_batch", ",", "dim", "=", "0", ")", "\n", "target_position_batch", "=", "torch", ".", "cat", "(", "target_position_batch", ",", "dim", "=", "0", ")", "\n", "start_direction_batch", "=", "torch", ".", "cat", "(", "start_direction_batch", ",", "dim", "=", "0", ")", "\n", "return", "{", "\n", "\"inputs\"", ":", "{", "\n", "\"agent_directions\"", ":", "start_direction_batch", ",", "\n", "\"agent_positions\"", ":", "agent_position_batch", ",", "\n", "\"target_positions\"", ":", "target_position_batch", "\n", "}", ",", "\n", "\"targets\"", ":", "{", "\n", "\"planner_target\"", ":", "target_batch", "\n", "}", ",", "\n", "\"extra_information\"", ":", "extra_information_batch", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.make_transitive_batch": [[726, 735], ["None"], "methods", ["None"], ["", "def", "make_transitive_batch", "(", "self", ",", "examples", ",", "planner_target_lengths", ",", "adverb_input_tensor_lengths", ")", ":", "\n", "        ", "\"\"\"\n\n        :param examples:\n        :param planner_target_lengths:\n        :param adverb_input_tensor_lengths:\n        :return:\n        \"\"\"", "\n", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.ModularDataset.make_batch": [[736, 787], ["NotImplementedError", "numpy.max", "numpy.max", "torch.cat", "torch.cat", "input_batch.append", "target_batch.append", "adverb_batch.append", "situation_representation_batch.append", "adverb_type_batch.append", "derivation_representation_batch.append", "original_input_batch.append", "original_output_batch.append", "verb_in_command_batch.append", "gscan_final_targets_batch.append", "torch.cat", "torch.cat", "torch.cat", "example[].size", "example[].size", "torch.zeros().unsqueeze", "torch.zeros().unsqueeze", "torch.zeros", "torch.zeros", "int", "int"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "make_batch", "(", "self", ",", "examples", ",", "input_lengths", ",", "target_lengths", ",", "adverb_input_tensor_lengths", ",", "adverb_target_tensor_lengths", ",", "\n", "transitive_target_lengths", ",", "planner_target_lengths", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "List", "[", "int", "]", ",", "\n", "torch", ".", "Tensor", ",", "List", "[", "dict", "]", ",", "\n", "torch", ".", "Tensor", ",", "List", "[", "int", "]", "]", ":", "\n", "        ", "\"\"\"\n        Iterate over batches of example tensors, pad them to the max length in the batch and yield.\n        :param examples:\n        :param input_lengths:\n        :param target_lengths:\n        :param adverb_input_tensor_lengths:\n        :param adverb_target_tensor_lengths:\n        :param transitive_target_lengths:\n        :param planner_target_lengths:\n        :return:\n        \"\"\"", "\n", "raise", "NotImplementedError", "(", "\"TODO: implement full batch\"", ")", "\n", "max_input_length", "=", "np", ".", "max", "(", "input_lengths", ")", "\n", "max_target_length", "=", "np", ".", "max", "(", "target_lengths", ")", "\n", "input_batch", "=", "[", "]", "\n", "adverb_batch", "=", "[", "]", "\n", "target_batch", "=", "[", "]", "\n", "situation_representation_batch", "=", "[", "]", "\n", "derivation_representation_batch", "=", "[", "]", "\n", "original_input_batch", "=", "[", "]", "\n", "original_output_batch", "=", "[", "]", "\n", "verb_in_command_batch", "=", "[", "]", "\n", "adverb_type_batch", "=", "[", "]", "\n", "gscan_final_targets_batch", "=", "[", "]", "\n", "for", "example", "in", "examples", ":", "\n", "            ", "to_pad_input", "=", "max_input_length", "-", "example", "[", "\"input_tensor\"", "]", ".", "size", "(", "1", ")", "\n", "to_pad_target", "=", "max_target_length", "-", "example", "[", "\"target_tensor\"", "]", ".", "size", "(", "1", ")", "\n", "padded_input", "=", "torch", ".", "cat", "(", "[", "\n", "example", "[", "\"input_tensor\"", "]", ",", "\n", "torch", ".", "zeros", "(", "int", "(", "to_pad_input", ")", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "0", ")", "]", ",", "dim", "=", "1", ")", "\n", "padded_target", "=", "torch", ".", "cat", "(", "[", "\n", "example", "[", "\"target_tensor\"", "]", ",", "\n", "torch", ".", "zeros", "(", "int", "(", "to_pad_target", ")", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "0", ")", "]", ",", "dim", "=", "1", ")", "\n", "input_batch", ".", "append", "(", "padded_input", ")", "\n", "target_batch", ".", "append", "(", "padded_target", ")", "\n", "adverb_batch", ".", "append", "(", "example", "[", "\"adverb_input\"", "]", ")", "\n", "situation_representation_batch", ".", "append", "(", "example", "[", "\"example_information\"", "]", "[", "\"situation_representation\"", "]", ")", "\n", "adverb_type_batch", ".", "append", "(", "example", "[", "\"example_information\"", "]", "[", "\"type_adverb\"", "]", ")", "\n", "derivation_representation_batch", ".", "append", "(", "example", "[", "\"example_information\"", "]", "[", "\"derivation_representation\"", "]", ")", "\n", "original_input_batch", ".", "append", "(", "example", "[", "\"example_information\"", "]", "[", "\"original_input\"", "]", ")", "\n", "original_output_batch", ".", "append", "(", "example", "[", "\"example_information\"", "]", "[", "\"original_output\"", "]", ")", "\n", "verb_in_command_batch", ".", "append", "(", "example", "[", "\"example_information\"", "]", "[", "\"verb_in_command\"", "]", ")", "\n", "gscan_final_targets_batch", ".", "append", "(", "example", "[", "\"example_information\"", "]", "[", "\"gscan_final_target\"", "]", ")", "\n", "", "return", "(", "torch", ".", "cat", "(", "input_batch", ",", "dim", "=", "0", ")", ",", "input_lengths", ",", "derivation_representation_batch", ",", "\n", "torch", ".", "cat", "(", "adverb_batch", ",", "dim", "=", "0", ")", ",", "situation_representation_batch", ",", "torch", ".", "cat", "(", "target_batch", ",", "dim", "=", "0", ")", ",", "\n", "target_lengths", ",", "adverb_type_batch", ",", "original_input_batch", ",", "original_output_batch", ",", "\n", "verb_in_command_batch", ",", "gscan_final_targets_batch", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.__init__": [[22, 82], ["torch.Module.__init__", "seq2seq.cnn_model.ConvolutionalNet", "seq2seq.seq2seq_model.Attention", "seq2seq.seq2seq_model.Attention", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.NLLLoss", "torch.NLLLoss", "torch.NLLLoss", "seq2seq.seq2seq_model.EncoderRNN", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Tanh", "torch.Tanh", "torch.Tanh", "logger.warning", "seq2seq.cnn_model.DownSamplingConvolutionalNet"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input_vocabulary_size", ":", "int", ",", "embedding_dimension", ":", "int", ",", "encoder_hidden_size", ":", "int", ",", "\n", "num_encoder_layers", ":", "int", ",", "encoder_dropout_p", ":", "float", ",", "\n", "encoder_bidirectional", ":", "bool", ",", "num_cnn_channels", ":", "int", ",", "cnn_kernel_size", ":", "int", ",", "\n", "cnn_dropout_p", ":", "float", ",", "cnn_hidden_num_channels", ":", "int", ",", "input_padding_idx", ":", "int", ",", "\n", "output_directory", ":", "str", ",", "grid_size", ":", "int", ",", "\n", "simple_situation_representation", ":", "bool", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "PositionModel", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "simple_situation_representation", "=", "simple_situation_representation", "\n", "if", "not", "simple_situation_representation", ":", "\n", "            ", "logger", ".", "warning", "(", "\"DownSamplingConvolutionalNet not correctly implemented. Update or set \"", "\n", "\"--simple_situation_representation\"", ")", "\n", "self", ".", "downsample_image", "=", "DownSamplingConvolutionalNet", "(", "num_channels", "=", "num_cnn_channels", ",", "\n", "num_conv_channels", "=", "cnn_hidden_num_channels", ",", "\n", "dropout_probability", "=", "cnn_dropout_p", ")", "\n", "cnn_input_channels", "=", "cnn_hidden_num_channels", "\n", "", "else", ":", "\n", "            ", "cnn_input_channels", "=", "num_cnn_channels", "\n", "# Input: [batch_size, image_width, image_width, num_channels]", "\n", "# Output: [batch_size, image_width * image_width, num_conv_channels * 3]", "\n", "", "self", ".", "situation_encoder", "=", "ConvolutionalNet", "(", "num_channels", "=", "cnn_input_channels", ",", "\n", "cnn_kernel_size", "=", "cnn_kernel_size", ",", "\n", "num_conv_channels", "=", "cnn_hidden_num_channels", ",", "\n", "dropout_probability", "=", "cnn_dropout_p", ")", "\n", "# Attention over the output features of the ConvolutionalNet.", "\n", "# Input: [bsz, 1, decoder_hidden_size], [bsz, image_width * image_width, cnn_hidden_num_channels * 3]", "\n", "# Output: [bsz, 1, decoder_hidden_size], [bsz, 1, image_width * image_width]", "\n", "self", ".", "agent_attention", "=", "Attention", "(", "key_size", "=", "cnn_hidden_num_channels", "*", "3", ",", "query_size", "=", "encoder_hidden_size", ",", "\n", "hidden_size", "=", "encoder_hidden_size", ")", "\n", "\n", "self", ".", "target_attention", "=", "Attention", "(", "key_size", "=", "cnn_hidden_num_channels", "*", "3", ",", "query_size", "=", "encoder_hidden_size", ",", "\n", "hidden_size", "=", "encoder_hidden_size", ")", "\n", "\n", "self", ".", "hidden_to_hidden", "=", "nn", ".", "Linear", "(", "cnn_hidden_num_channels", "*", "3", "+", "encoder_hidden_size", ",", "encoder_hidden_size", ")", "\n", "self", ".", "hidden_to_output", "=", "nn", ".", "Linear", "(", "encoder_hidden_size", ",", "grid_size", "*", "grid_size", ")", "\n", "\n", "self", ".", "loss_criterion", "=", "nn", ".", "NLLLoss", "(", ")", "\n", "\n", "# Input: [batch_size, max_input_length]", "\n", "# Output: [batch_size, hidden_size], [batch_size, max_input_length, hidden_size]", "\n", "self", ".", "encoder", "=", "EncoderRNN", "(", "input_size", "=", "input_vocabulary_size", ",", "\n", "embedding_dim", "=", "embedding_dimension", ",", "\n", "rnn_input_size", "=", "embedding_dimension", ",", "\n", "hidden_size", "=", "encoder_hidden_size", ",", "num_layers", "=", "num_encoder_layers", ",", "\n", "dropout_probability", "=", "encoder_dropout_p", ",", "bidirectional", "=", "encoder_bidirectional", ",", "\n", "padding_idx", "=", "input_padding_idx", ")", "\n", "\n", "self", ".", "situation_to_directions", "=", "nn", ".", "Linear", "(", "cnn_hidden_num_channels", "*", "3", ",", "4", ")", "\n", "self", ".", "tanh", "=", "nn", ".", "Tanh", "(", ")", "\n", "self", ".", "output_directory", "=", "output_directory", "\n", "self", ".", "trained_iterations", "=", "0", "\n", "self", ".", "best_iteration", "=", "0", "\n", "self", ".", "best_metric", "=", "0", "\n", "self", ".", "metric", "=", "\"accuracy\"", "\n", "\n", "self", ".", "input_keys", "=", "[", "\"world_state_tensor\"", "]", "\n", "self", ".", "input_keys_to_pad", "=", "[", "\"input_tensor\"", "]", "\n", "self", ".", "target_keys", "=", "[", "\"agent_position\"", ",", "\"target_position\"", ",", "\"agent_direction\"", "]", "\n", "self", ".", "target_keys_to_pad", "=", "[", "]", "\n", "self", ".", "sequence_decoder", "=", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_single_accuracy": [[83, 90], ["torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "torch.eq().long().sum().data.item", "target_scores.max", "len", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long().sum", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq().long", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq", "torch.eq"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max"], ["", "@", "staticmethod", "\n", "def", "get_single_accuracy", "(", "target_scores", ":", "torch", ".", "Tensor", ",", "targets", ":", "torch", ".", "Tensor", ")", "->", "float", ":", "\n", "        ", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "predicted_targets", "=", "target_scores", ".", "max", "(", "dim", "=", "1", ")", "[", "1", "]", "\n", "equal_targets", "=", "torch", ".", "eq", "(", "targets", ".", "data", ",", "predicted_targets", ".", "data", ")", ".", "long", "(", ")", ".", "sum", "(", ")", ".", "data", ".", "item", "(", ")", "\n", "accuracy", "=", "100.", "*", "equal_targets", "/", "len", "(", "targets", ")", "\n", "", "return", "accuracy", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_metrics": [[91, 100], ["position_model.PositionModel.get_single_accuracy", "position_model.PositionModel.get_single_accuracy", "position_model.PositionModel.get_single_accuracy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_single_accuracy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_single_accuracy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_single_accuracy"], ["", "def", "get_metrics", "(", "self", ",", "agent_direction_scores", ":", "torch", ".", "Tensor", ",", "agent_position_scores", ":", "torch", ".", "Tensor", ",", "\n", "target_position_scores", ":", "torch", ".", "Tensor", ",", "agent_position_targets", ":", "torch", ".", "Tensor", ",", "\n", "agent_direction_targets", ":", "torch", ".", "Tensor", ",", "target_position_targets", ":", "torch", ".", "Tensor", ")", ":", "\n", "        ", "direction_accuracy", "=", "self", ".", "get_single_accuracy", "(", "agent_direction_scores", ",", "agent_direction_targets", ")", "\n", "agent_position_accuracy", "=", "self", ".", "get_single_accuracy", "(", "agent_position_scores", ",", "agent_position_targets", ")", "\n", "target_position_accuracy", "=", "self", ".", "get_single_accuracy", "(", "target_position_scores", ",", "target_position_targets", ")", "\n", "return", "{", "\"agent_direction_accuracy\"", ":", "direction_accuracy", ",", "\n", "\"agent_position_accuracy\"", ":", "agent_position_accuracy", ",", "\n", "\"target_position_accuracy\"", ":", "target_position_accuracy", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_single_loss": [[101, 104], ["position_model.PositionModel.loss_criterion", "targets.view"], "methods", ["None"], ["", "def", "get_single_loss", "(", "self", ",", "scores", ":", "torch", ".", "Tensor", ",", "targets", ":", "torch", ".", "Tensor", ")", ":", "\n", "        ", "loss", "=", "self", ".", "loss_criterion", "(", "scores", ",", "targets", ".", "view", "(", "-", "1", ")", ")", "\n", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_loss": [[105, 112], ["position_model.PositionModel.get_single_loss", "position_model.PositionModel.get_single_loss", "position_model.PositionModel.get_single_loss", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_single_loss", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_single_loss", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_single_loss"], ["", "def", "get_loss", "(", "self", ",", "agent_direction_scores", ":", "torch", ".", "Tensor", ",", "agent_position_scores", ":", "torch", ".", "Tensor", ",", "\n", "target_position_scores", ":", "torch", ".", "Tensor", ",", "agent_position_targets", ":", "torch", ".", "Tensor", ",", "\n", "agent_direction_targets", ":", "torch", ".", "Tensor", ",", "target_position_targets", ":", "torch", ".", "Tensor", ")", ":", "\n", "        ", "direction_loss", "=", "self", ".", "get_single_loss", "(", "agent_direction_scores", ",", "agent_direction_targets", ")", "\n", "agent_position_loss", "=", "self", ".", "get_single_loss", "(", "agent_position_scores", ",", "agent_position_targets", ")", "\n", "target_position_loss", "=", "self", ".", "get_single_loss", "(", "target_position_scores", ",", "target_position_targets", ")", "\n", "return", "torch", ".", "tensor", "(", "0.01", ",", "device", "=", "device", ")", "*", "direction_loss", "+", "torch", ".", "tensor", "(", "0.01", ",", "device", "=", "device", ")", "*", "agent_position_loss", "+", "torch", ".", "tensor", "(", "0.98", ",", "device", "=", "device", ")", "*", "target_position_loss", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_scores": [[113, 116], ["torch.log_softmax", "torch.log_softmax", "torch.log_softmax"], "methods", ["None"], ["", "def", "get_scores", "(", "self", ",", "output_scores", ":", "torch", ".", "Tensor", ")", "->", "torch", ".", "Tensor", ":", "\n", "        ", "output_scores_normalized", "=", "F", ".", "log_softmax", "(", "output_scores", ",", "-", "1", ")", "\n", "return", "output_scores_normalized", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.encode_input": [[117, 146], ["position_model.PositionModel.encoder", "position_model.PositionModel.situation_encoder", "position_model.PositionModel.size", "position_model.PositionModel.agent_attention.key_layer", "position_model.PositionModel.agent_attention.forward", "position_model.PositionModel.target_attention.key_layer", "position_model.PositionModel.target_attention.forward", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "torch.tanh", "position_model.PositionModel.hidden_to_output", "position_model.PositionModel.downsample_image", "position_model.PositionModel.hidden_to_hidden", "context_situation.unsqueeze", "range", "hidden.unsqueeze", "hidden.unsqueeze", "context_visual.squeeze"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.forward", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.forward"], ["", "def", "encode_input", "(", "self", ",", "input_tensor", ":", "torch", ".", "LongTensor", ",", "input_tensor_lengths", ":", "List", "[", "int", "]", ",", "\n", "world_state_tensor", ":", "torch", ".", "Tensor", ")", "->", "Tuple", "[", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "\"\"\"Pass the input commands through an RNN encoder and the situation input through a CNN encoder.\"\"\"", "\n", "if", "not", "self", ".", "simple_situation_representation", ":", "\n", "            ", "world_state_tensor", "=", "self", ".", "downsample_image", "(", "world_state_tensor", ")", "\n", "\n", "# [batch_size, max_input_length] -> [batch_size, hidden_size], [batch_size, max_input_length, hidden_size]", "\n", "", "hidden", ",", "encoder_outputs", "=", "self", ".", "encoder", "(", "input_tensor", ",", "input_tensor_lengths", ")", "\n", "\n", "# [batch_size, image_width, image_width, num_channels] ->", "\n", "# [batch_size, image_width * image_width, num_conv_channels * 3]", "\n", "encoded_image", "=", "self", ".", "situation_encoder", "(", "world_state_tensor", ")", "\n", "batch_size", ",", "image_num_memory", ",", "image_dim", "=", "encoded_image", ".", "size", "(", ")", "\n", "situation_lengths", "=", "[", "image_num_memory", "for", "_", "in", "range", "(", "batch_size", ")", "]", "\n", "projected_keys_agent", "=", "self", ".", "agent_attention", ".", "key_layer", "(", "encoded_image", ")", "# [bsz, situation_length, dec_hidden_dim]", "\n", "context_situation", ",", "attention_weights_agent", "=", "self", ".", "agent_attention", ".", "forward", "(", "queries", "=", "hidden", ".", "unsqueeze", "(", "dim", "=", "1", ")", ",", "\n", "projected_keys", "=", "projected_keys_agent", ",", "\n", "values", "=", "encoded_image", ",", "\n", "memory_lengths", "=", "situation_lengths", ")", "\n", "\n", "projected_keys_target", "=", "self", ".", "target_attention", ".", "key_layer", "(", "encoded_image", ")", "\n", "context_visual", ",", "attention_weights_target", "=", "self", ".", "target_attention", ".", "forward", "(", "queries", "=", "hidden", ".", "unsqueeze", "(", "dim", "=", "1", ")", ",", "\n", "projected_keys", "=", "projected_keys_target", ",", "\n", "values", "=", "encoded_image", ",", "\n", "memory_lengths", "=", "situation_lengths", ")", "\n", "final_hidden", "=", "torch", ".", "cat", "(", "[", "context_visual", ".", "squeeze", "(", "dim", "=", "1", ")", ",", "hidden", "]", ",", "dim", "=", "-", "1", ")", "\n", "final_hidden", "=", "torch", ".", "tanh", "(", "self", ".", "hidden_to_hidden", "(", "final_hidden", ")", ")", "\n", "output_states", "=", "self", ".", "hidden_to_output", "(", "final_hidden", ")", "\n", "return", "context_situation", ".", "unsqueeze", "(", "dim", "=", "1", ")", ",", "attention_weights_agent", ",", "output_states", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.forward": [[147, 158], ["position_model.PositionModel.encode_input", "position_model.PositionModel.situation_to_directions", "position_model.PositionModel.get_scores", "position_model.PositionModel.get_scores", "position_model.PositionModel.get_scores", "agent_weights.exp", "position_model.PositionModel.squeeze", "position_model.PositionModel.squeeze", "position_model.PositionModel.squeeze"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.encode_input", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_scores", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_scores", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_scores"], ["", "def", "forward", "(", "self", ",", "input_tensor", ":", "torch", ".", "LongTensor", ",", "input_tensor_lengths", ":", "List", "[", "int", "]", ",", "world_state_tensor", ":", "torch", ".", "Tensor", ",", "\n", "**", "kwargs", ")", "->", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ":", "\n", "        ", "context_situation", ",", "agent_weights", ",", "target_states", "=", "self", ".", "encode_input", "(", "\n", "input_tensor", "=", "input_tensor", ",", "input_tensor_lengths", "=", "input_tensor_lengths", ",", "world_state_tensor", "=", "world_state_tensor", ")", "\n", "agent_direction_scores", "=", "self", ".", "situation_to_directions", "(", "context_situation", ")", "\n", "agent_direction_scores_normalized", "=", "self", ".", "get_scores", "(", "agent_direction_scores", ")", "\n", "agent_position_scores_normalized", "=", "self", ".", "get_scores", "(", "agent_weights", ".", "exp", "(", ")", ")", "\n", "target_position_scores_normalized", "=", "self", ".", "get_scores", "(", "target_states", ")", "\n", "return", "{", "\"agent_direction_scores\"", ":", "agent_direction_scores_normalized", ".", "squeeze", "(", ")", ",", "\n", "\"agent_position_scores\"", ":", "agent_position_scores_normalized", ".", "squeeze", "(", ")", ",", "\n", "\"target_position_scores\"", ":", "target_position_scores_normalized", ".", "squeeze", "(", ")", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.update_state": [[159, 164], ["None"], "methods", ["None"], ["", "def", "update_state", "(", "self", ",", "is_best", ":", "bool", ",", "metric", "=", "None", ")", "->", "{", "}", ":", "\n", "        ", "self", ".", "trained_iterations", "+=", "1", "\n", "if", "is_best", ":", "\n", "            ", "self", ".", "best_metric", "=", "metric", "\n", "self", ".", "best_iteration", "=", "self", ".", "trained_iterations", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.load_model": [[165, 173], ["torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "torch.load", "position_model.PositionModel.load_state_dict"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load"], ["", "", "def", "load_model", "(", "self", ",", "path_to_checkpoint", ":", "str", ")", "->", "dict", ":", "\n", "        ", "checkpoint", "=", "torch", ".", "load", "(", "path_to_checkpoint", ")", "\n", "self", ".", "trained_iterations", "=", "checkpoint", "[", "\"iteration\"", "]", "\n", "self", ".", "best_iteration", "=", "checkpoint", "[", "\"best_iteration\"", "]", "\n", "self", ".", "load_state_dict", "(", "checkpoint", "[", "\"state_dict\"", "]", ")", "\n", "self", ".", "best_metric", "=", "checkpoint", "[", "\"best_metric\"", "]", "\n", "self", ".", "metric", "=", "\"accuracy\"", "\n", "return", "checkpoint", "[", "\"optimizer_state_dict\"", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_current_state": [[174, 181], ["position_model.PositionModel.state_dict"], "methods", ["None"], ["", "def", "get_current_state", "(", "self", ")", ":", "\n", "        ", "return", "{", "\n", "\"iteration\"", ":", "self", ".", "trained_iterations", ",", "\n", "\"state_dict\"", ":", "self", ".", "state_dict", "(", ")", ",", "\n", "\"best_iteration\"", ":", "self", ".", "best_iteration", ",", "\n", "\"best_metric\"", ":", "self", ".", "best_metric", ",", "\n", "\"metric\"", ":", "\"accuracy\"", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.save_checkpoint": [[183, 199], ["os.path.join", "position_model.PositionModel.get_current_state", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "torch.save", "os.path.join", "shutil.copyfile"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.position_model.PositionModel.get_current_state", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save"], ["", "def", "save_checkpoint", "(", "self", ",", "file_name", ":", "str", ",", "is_best", ":", "bool", ",", "optimizer_state_dict", ":", "dict", ")", "->", "str", ":", "\n", "        ", "\"\"\"\n\n        :param file_name: filename to save checkpoint in.\n        :param is_best: boolean describing whether or not the current state is the best the model has ever been.\n        :param optimizer_state_dict: state of the optimizer.\n        :return: str to path where the model is saved.\n        \"\"\"", "\n", "path", "=", "os", ".", "path", ".", "join", "(", "self", ".", "output_directory", ",", "file_name", ")", "\n", "state", "=", "self", ".", "get_current_state", "(", ")", "\n", "state", "[", "\"optimizer_state_dict\"", "]", "=", "optimizer_state_dict", "\n", "torch", ".", "save", "(", "state", ",", "path", ")", "\n", "if", "is_best", ":", "\n", "            ", "best_path", "=", "os", ".", "path", ".", "join", "(", "self", ".", "output_directory", ",", "'model_best.pth.tar'", ")", "\n", "shutil", ".", "copyfile", "(", "path", ",", "best_path", ")", "\n", "", "return", "path", "\n", "", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.__main__.main": [[129, 374], ["flags.items", "os.path.join", "ValueError", "logger.info", "flags[].split", "flags[].split", "os.path.exists", "os.mkdir", "os.path.exists", "ValueError", "Modularity.train.train", "os.path.join", "flags[].split", "os.getcwd", "os.path.isfile", "torch.load", "torch.load.items", "Modularity.dataset.ModularDataset", "logger.info", "logger.info", "os.path.join", "os.path.isfile", "logger.info", "torch.load", "Modularity.modules.PositionModel", "logger.info", "Modularity.modules.FullModel.load_model", "Modularity.modules.FullModel.to", "logger.info", "os.path.join", "Modularity.predict.predict_and_save", "os.path.join", "Modularity.predict.predict_and_save_full_model", "os.path.join", "Modularity.helpers.log_metrics", "torch.device", "flags[].split", "flags[].split", "Modularity.modules.PlannerModel", "int", "str", "torch.device", "Modularity.modules.DummyPlannerModel", "Modularity.modules.DummySequencePlannerModel", "Modularity.modules.NewInteractionModel", "Modularity.modules.DummyInteractionModel", "Modularity.modules.AloTransform", "Modularity.modules.AdverbTransform", "Modularity.modules.FullModel", "NotImplementedError"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.train.train", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.helpers.load_model", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_and_save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.predict.predict_and_save_full_model", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.helpers.log_metrics"], ["splits", "=", "flags", "[", "\"splits\"", "]", ".", "split", "(", "\",\"", ")", "\n", "for", "split", "in", "splits", ":", "\n", "            ", "logger", ".", "info", "(", "\"Loading {} dataset split...\"", ".", "format", "(", "split", ")", ")", "\n", "test_set", "=", "GroundedScanDataset", "(", "data_path", ",", "flags", "[", "\"data_directory\"", "]", ",", "split", "=", "split", ",", "\n", "input_vocabulary_file", "=", "flags", "[", "\"input_vocab_path\"", "]", ",", "\n", "target_vocabulary_file", "=", "flags", "[", "\"target_vocab_path\"", "]", ",", "generate_vocabulary", "=", "False", ",", "\n", "k", "=", "flags", "[", "\"k\"", "]", ")", "\n", "test_set", ".", "read_dataset", "(", "max_examples", "=", "None", ",", "\n", "simple_situation_representation", "=", "flags", "[", "\"simple_situation_representation\"", "]", ")", "\n", "logger", ".", "info", "(", "\"Done Loading {} dataset split.\"", ".", "format", "(", "flags", "[", "\"split\"", "]", ")", ")", "\n", "logger", ".", "info", "(", "\"  Loaded {} examples.\"", ".", "format", "(", "test_set", ".", "num_examples", ")", ")", "\n", "logger", ".", "info", "(", "\"  Input vocabulary size: {}\"", ".", "format", "(", "test_set", ".", "input_vocabulary_size", ")", ")", "\n", "logger", ".", "info", "(", "\"  Most common input words: {}\"", ".", "format", "(", "test_set", ".", "input_vocabulary", ".", "most_common", "(", "5", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"  Output vocabulary size: {}\"", ".", "format", "(", "test_set", ".", "target_vocabulary_size", ")", ")", "\n", "logger", ".", "info", "(", "\"  Most common target words: {}\"", ".", "format", "(", "test_set", ".", "target_vocabulary", ".", "most_common", "(", "5", ")", ")", ")", "\n", "\n", "model", "=", "Model", "(", "input_vocabulary_size", "=", "test_set", ".", "input_vocabulary_size", ",", "\n", "target_vocabulary_size", "=", "test_set", ".", "target_vocabulary_size", ",", "\n", "num_cnn_channels", "=", "test_set", ".", "image_channels", ",", "\n", "input_padding_idx", "=", "test_set", ".", "input_vocabulary", ".", "pad_idx", ",", "\n", "target_pad_idx", "=", "test_set", ".", "target_vocabulary", ".", "pad_idx", ",", "\n", "target_eos_idx", "=", "test_set", ".", "target_vocabulary", ".", "eos_idx", ",", "\n", "**", "flags", ")", "\n", "model", "=", "model", ".", "cuda", "(", ")", "if", "use_cuda", "else", "model", "\n", "\n", "# Load model and vocabularies if resuming.", "\n", "assert", "os", ".", "path", ".", "isfile", "(", "flags", "[", "\"resume_from_file\"", "]", ")", ",", "\"No checkpoint found at {}\"", ".", "format", "(", "flags", "[", "\"resume_from_file\"", "]", ")", "\n", "logger", ".", "info", "(", "\"Loading checkpoint from file at '{}'\"", ".", "format", "(", "flags", "[", "\"resume_from_file\"", "]", ")", ")", "\n", "model", ".", "load_model", "(", "flags", "[", "\"resume_from_file\"", "]", ")", "\n", "start_iteration", "=", "model", ".", "trained_iterations", "\n", "logger", ".", "info", "(", "\"Loaded checkpoint '{}' (iter {})\"", ".", "format", "(", "flags", "[", "\"resume_from_file\"", "]", ",", "start_iteration", ")", ")", "\n", "output_file_name", "=", "\"_\"", ".", "join", "(", "[", "split", ",", "flags", "[", "\"output_file_name\"", "]", "]", ")", "\n", "output_file_path", "=", "os", ".", "path", ".", "join", "(", "flags", "[", "\"output_directory\"", "]", ",", "output_file_name", ")", "\n", "output_file", "=", "predict_and_save", "(", "dataset", "=", "test_set", ",", "model", "=", "model", ",", "output_file_path", "=", "output_file_path", ",", "**", "flags", ")", "\n", "logger", ".", "info", "(", "\"Saved predictions to {}\"", ".", "format", "(", "output_file", ")", ")", "\n", "", "", "elif", "flags", "[", "\"mode\"", "]", "==", "\"predict\"", ":", "\n", "        ", "raise", "NotImplementedError", "(", ")", "\n", "", "else", ":", "\n", "        ", "raise", "ValueError", "(", "\"Wrong value for parameters --mode ({}).\"", ".", "format", "(", "flags", "[", "\"mode\"", "]", ")", ")", "\n", "\n", "\n", "", "", "if", "__name__", "==", "\"__main__\"", ":", "\n", "    ", "input_flags", "=", "vars", "(", "parser", ".", "parse_args", "(", ")", ")", "\n", "main", "(", "flags", "=", "input_flags", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.model.Model.__init__": [[9, 12], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["import", "shutil", "\n", "\n", "from", "seq2seq", ".", "cnn_model", "import", "ConvolutionalNet", "\n", "from", "seq2seq", ".", "cnn_model", "import", "DownSamplingConvolutionalNet", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.model.Model.positions": [[13, 15], ["None"], "methods", ["None"], ["from", "seq2seq", ".", "seq2seq_model", "import", "EncoderRNN", "\n", "from", "seq2seq", ".", "seq2seq_model", "import", "Attention", "\n", "from", "seq2seq", ".", "seq2seq_model", "import", "LuongAttentionDecoderRNN", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.helpers.load_model": [[9, 12], ["torch.load"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load"], ["\n", "\n", "def", "sequence_mask", "(", "sequence_lengths", ":", "torch", ".", "LongTensor", ",", "max_len", "=", "None", ")", "->", "torch", ".", "tensor", ":", "\n", "    "]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.helpers.log_metrics": [[14, 38], ["metrics_d.items", "logger.info", "logger.info", "logger.info", "output_lines.append", "output_lines.append", "logger.info", "logger.info", "logger.info", "metrics.items", "logger.info", "target_metrics.items", "open", "outfile.writelines", "logger.info", "output_lines.append"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["\n", "if", "max_len", "is", "None", ":", "\n", "        ", "max_len", "=", "sequence_lengths", ".", "data", ".", "max", "(", ")", "\n", "", "batch_size", "=", "sequence_lengths", ".", "size", "(", "0", ")", "\n", "sequence_range", "=", "torch", ".", "arange", "(", "0", ",", "max_len", ")", ".", "long", "(", ")", ".", "to", "(", "device", "=", "device", ")", "\n", "\n", "# [batch_size, max_len]", "\n", "sequence_range_expand", "=", "sequence_range", ".", "unsqueeze", "(", "0", ")", ".", "expand", "(", "batch_size", ",", "max_len", ")", "\n", "\n", "# [batch_size, max_len]", "\n", "seq_length_expand", "=", "(", "sequence_lengths", ".", "unsqueeze", "(", "1", ")", ".", "expand_as", "(", "sequence_range_expand", ")", ")", "\n", "\n", "# [batch_size, max_len](boolean array of which elements to include)", "\n", "return", "sequence_range_expand", "<", "seq_length_expand", "\n", "\n", "\n", "", "def", "log_parameters", "(", "model", ":", "torch", ".", "nn", ".", "Module", ")", "->", "{", "}", ":", "\n", "    ", "model_parameters", "=", "filter", "(", "lambda", "p", ":", "p", ".", "requires_grad", ",", "model", ".", "parameters", "(", ")", ")", "\n", "n_params", "=", "sum", "(", "[", "np", ".", "prod", "(", "p", ".", "size", "(", ")", ")", "for", "p", "in", "model_parameters", "]", ")", "\n", "logger", ".", "info", "(", "\"Total parameters: %d\"", "%", "n_params", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.analyze_predictions.read_predictions": [[8, 12], ["open", "json.load"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load"], ["def", "read_predictions", "(", "file", ":", "str", ")", ":", "\n", "    ", "with", "open", "(", "file", ",", "'r'", ")", "as", "infile", ":", "\n", "        ", "data", "=", "json", ".", "load", "(", "infile", ")", "\n", "", "return", "data", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.analyze_predictions.analyze_predictions": [[14, 51], ["collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "all_accuracies.append", "exact_matches.append", "len", "len", "len", "error_analysis.keys", "len", "set", "[].append", "[].append"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "analyze_predictions", "(", "data", ":", "List", "[", "dict", "]", ",", "module_target_key", ":", "str", ")", ":", "\n", "    ", "exact_matches", "=", "[", "]", "\n", "all_accuracies", "=", "[", "]", "\n", "error_analysis", "=", "{", "\n", "\"input_length\"", ":", "defaultdict", "(", "lambda", ":", "{", "\"accuracy\"", ":", "[", "]", ",", "\"exact_match\"", ":", "[", "]", "}", ")", ",", "\n", "\"module_input_length\"", ":", "defaultdict", "(", "lambda", ":", "{", "\"accuracy\"", ":", "[", "]", ",", "\"exact_match\"", ":", "[", "]", "}", ")", ",", "\n", "\"module_target_length\"", ":", "defaultdict", "(", "lambda", ":", "{", "\"accuracy\"", ":", "[", "]", ",", "\"exact_match\"", ":", "[", "]", "}", ")", ",", "\n", "\"verb\"", ":", "defaultdict", "(", "lambda", ":", "{", "\"accuracy\"", ":", "[", "]", ",", "\"exact_match\"", ":", "[", "]", "}", ")", ",", "\n", "\"adverb\"", ":", "defaultdict", "(", "lambda", ":", "{", "\"accuracy\"", ":", "[", "]", ",", "\"exact_match\"", ":", "[", "]", "}", ")", ",", "\n", "\"type_adverb\"", ":", "defaultdict", "(", "lambda", ":", "{", "\"accuracy\"", ":", "[", "]", ",", "\"exact_match\"", ":", "[", "]", "}", ")", ",", "\n", "\"target_object_size\"", ":", "defaultdict", "(", "lambda", ":", "{", "\"accuracy\"", ":", "[", "]", ",", "\"exact_match\"", ":", "[", "]", "}", ")", ",", "\n", "\"correct_verb\"", ":", "defaultdict", "(", "lambda", ":", "{", "\"accuracy\"", ":", "[", "]", ",", "\"exact_match\"", ":", "[", "]", "}", ")", ",", "\n", "}", "\n", "for", "predicted_example", "in", "data", ":", "\n", "        ", "example_information", "=", "{", "}", "# TODO: hier gebleven!", "\n", "example_information", "[", "\"accuracy\"", "]", "=", "predicted_example", "[", "\"accuracy\"", "]", "\n", "example_information", "[", "\"exact_match\"", "]", "=", "predicted_example", "[", "\"exact_match\"", "]", "\n", "all_accuracies", ".", "append", "(", "predicted_example", "[", "\"accuracy\"", "]", ")", "\n", "exact_matches", ".", "append", "(", "predicted_example", "[", "\"exact_match\"", "]", ")", "\n", "example_information", "[", "\"input_length\"", "]", "=", "len", "(", "predicted_example", "[", "\"input\"", "]", ")", "\n", "example_information", "[", "\"module_input_length\"", "]", "=", "len", "(", "predicted_example", "[", "\"module_input\"", "]", ")", "\n", "example_information", "[", "\"module_target_length\"", "]", "=", "len", "(", "predicted_example", "[", "\"module_targets\"", "]", ")", "\n", "example_information", "[", "\"verb\"", "]", "=", "predicted_example", "[", "\"verb\"", "]", "\n", "example_information", "[", "\"adverb\"", "]", "=", "predicted_example", "[", "\"adverb\"", "]", "\n", "example_information", "[", "\"type_adverb\"", "]", "=", "predicted_example", "[", "\"type_adverb\"", "]", "\n", "example_information", "[", "\"target_object_size\"", "]", "=", "predicted_example", "[", "\"situation\"", "]", "[", "\"target_object\"", "]", "[", "\"object\"", "]", "[", "\"size\"", "]", "\n", "example_information", "[", "\"prediction\"", "]", "=", "predicted_example", "[", "module_target_key", "+", "\"_prediction\"", "]", "\n", "if", "len", "(", "predicted_example", "[", "\"module_targets\"", "]", ")", ">", "0", ":", "\n", "            ", "predicted_verbs", "=", "set", "(", "example_information", "[", "\"prediction\"", "]", "[", ":", "-", "1", "]", ")", "\n", "example_information", "[", "\"predicted_verbs\"", "]", "=", "' - '", ".", "join", "(", "predicted_verbs", ")", "\n", "", "else", ":", "\n", "            ", "example_information", "[", "\"predicted_verbs\"", "]", "=", "example_information", "[", "\"verb\"", "]", "\n", "", "example_information", "[", "\"correct_verb\"", "]", "=", "example_information", "[", "\"predicted_verbs\"", "]", "==", "example_information", "[", "\"verb\"", "]", "\n", "for", "key", "in", "error_analysis", ".", "keys", "(", ")", ":", "\n", "            ", "error_analysis", "[", "key", "]", "[", "example_information", "[", "key", "]", "]", "[", "\"accuracy\"", "]", ".", "append", "(", "predicted_example", "[", "\"accuracy\"", "]", ")", "\n", "error_analysis", "[", "key", "]", "[", "example_information", "[", "key", "]", "]", "[", "\"exact_match\"", "]", ".", "append", "(", "predicted_example", "[", "\"exact_match\"", "]", ")", "\n", "", "", "return", "error_analysis", ",", "exact_matches", ",", "all_accuracies", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.analyze_predictions.write_error_analysis": [[53, 110], ["xlwt.Workbook", "open", "outfile.write", "outfile.write", "collections.Counter", "outfile.write", "outfile.write", "outfile.write", "error_analysis.items", "xlwt.Workbook.save", "xlwt.Workbook.add_sheet", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "outfile.write", "enumerate", "outfile.write", "numpy.mean", "values.items", "outfile.write", "numpy.array", "numpy.mean", "len", "numpy.std", "collections.Counter", "outfile.write", "outfile.write", "outfile.write", "outfile.write", "outfile.write", "outfile.write", "outfile.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "output_file.split", "numpy.array", "len", "len", "numpy.min", "numpy.max"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.min", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max"], ["", "def", "write_error_analysis", "(", "error_analysis", ":", "Dict", "[", "str", ",", "Counter", "]", ",", "exact_matches", ":", "List", "[", "bool", "]", ",", "all_accuracies", ":", "List", "[", "float", "]", ",", "\n", "output_file", ":", "str", ")", ":", "\n", "    ", "workbook", "=", "Workbook", "(", ")", "\n", "# Write the information to a file and make plots", "\n", "with", "open", "(", "output_file", ",", "'w'", ")", "as", "outfile", ":", "\n", "        ", "outfile", ".", "write", "(", "\"Error Analysis\\n\\n\"", ")", "\n", "outfile", ".", "write", "(", "\" Mean accuracy: {}\\n\"", ".", "format", "(", "np", ".", "mean", "(", "np", ".", "array", "(", "all_accuracies", ")", ")", ")", ")", "\n", "exact_matches_counter", "=", "Counter", "(", "exact_matches", ")", "\n", "outfile", ".", "write", "(", "\" Num. exact matches: {}\\n\"", ".", "format", "(", "exact_matches_counter", "[", "True", "]", ")", ")", "\n", "outfile", ".", "write", "(", "\" Num not exact matches: {}\\n\"", ".", "format", "(", "exact_matches_counter", "[", "False", "]", ")", ")", "\n", "outfile", ".", "write", "(", "\" Exact match percentage: {}\\n\\n\"", ".", "format", "(", "\n", "exact_matches_counter", "[", "True", "]", "/", "(", "exact_matches_counter", "[", "True", "]", "+", "exact_matches_counter", "[", "False", "]", ")", ")", ")", "\n", "for", "key", ",", "values", "in", "error_analysis", ".", "items", "(", ")", ":", "\n", "            ", "sheet", "=", "workbook", ".", "add_sheet", "(", "key", ")", "\n", "sheet", ".", "write", "(", "0", ",", "0", ",", "key", ")", "\n", "sheet", ".", "write", "(", "0", ",", "1", ",", "\"Num examples\"", ")", "\n", "sheet", ".", "write", "(", "0", ",", "2", ",", "\"Mean accuracy\"", ")", "\n", "sheet", ".", "write", "(", "0", ",", "3", ",", "\"Std. accuracy\"", ")", "\n", "sheet", ".", "write", "(", "0", ",", "4", ",", "\"Exact Match\"", ")", "\n", "sheet", ".", "write", "(", "0", ",", "5", ",", "\"Not Exact Match\"", ")", "\n", "sheet", ".", "write", "(", "0", ",", "6", ",", "\"Exact Match Percentage\"", ")", "\n", "outfile", ".", "write", "(", "\"\\nDimension {}\\n\\n\"", ".", "format", "(", "key", ")", ")", "\n", "means", "=", "{", "}", "\n", "standard_deviations", "=", "{", "}", "\n", "num_examples", "=", "{", "}", "\n", "exact_match_distributions", "=", "{", "}", "\n", "exact_match_relative_distributions", "=", "{", "}", "\n", "for", "i", ",", "(", "item_key", ",", "item_values", ")", "in", "enumerate", "(", "values", ".", "items", "(", ")", ")", ":", "\n", "                ", "outfile", ".", "write", "(", "\"  {}:{}\\n\\n\"", ".", "format", "(", "key", ",", "item_key", ")", ")", "\n", "accuracies", "=", "np", ".", "array", "(", "item_values", "[", "\"accuracy\"", "]", ")", "\n", "mean_accuracy", "=", "np", ".", "mean", "(", "accuracies", ")", "\n", "means", "[", "item_key", "]", "=", "mean_accuracy", "\n", "num_examples", "[", "item_key", "]", "=", "len", "(", "item_values", "[", "\"accuracy\"", "]", ")", "\n", "standard_deviation", "=", "np", ".", "std", "(", "accuracies", ")", "\n", "standard_deviations", "[", "item_key", "]", "=", "standard_deviation", "\n", "exact_match_distribution", "=", "Counter", "(", "item_values", "[", "\"exact_match\"", "]", ")", "\n", "exact_match_distributions", "[", "item_key", "]", "=", "exact_match_distribution", "\n", "exact_match_relative_distributions", "[", "item_key", "]", "=", "exact_match_distribution", "[", "True", "]", "/", "(", "\n", "exact_match_distribution", "[", "False", "]", "+", "exact_match_distribution", "[", "True", "]", ")", "\n", "outfile", ".", "write", "(", "\"    Num. examples: {}\\n\"", ".", "format", "(", "len", "(", "item_values", "[", "\"accuracy\"", "]", ")", ")", ")", "\n", "outfile", ".", "write", "(", "\"    Mean accuracy: {}\\n\"", ".", "format", "(", "mean_accuracy", ")", ")", "\n", "outfile", ".", "write", "(", "\"    Min. accuracy: {}\\n\"", ".", "format", "(", "np", ".", "min", "(", "accuracies", ")", ")", ")", "\n", "outfile", ".", "write", "(", "\"    Max. accuracy: {}\\n\"", ".", "format", "(", "np", ".", "max", "(", "accuracies", ")", ")", ")", "\n", "outfile", ".", "write", "(", "\"    Std. accuracy: {}\\n\"", ".", "format", "(", "standard_deviation", ")", ")", "\n", "outfile", ".", "write", "(", "\"    Num. exact match: {}\\n\"", ".", "format", "(", "exact_match_distribution", "[", "True", "]", ")", ")", "\n", "outfile", ".", "write", "(", "\"    Num. not exact match: {}\\n\\n\"", ".", "format", "(", "exact_match_distribution", "[", "False", "]", ")", ")", "\n", "sheet", ".", "write", "(", "i", "+", "1", ",", "0", ",", "item_key", ")", "\n", "sheet", ".", "write", "(", "i", "+", "1", ",", "1", ",", "len", "(", "item_values", "[", "\"accuracy\"", "]", ")", ")", "\n", "sheet", ".", "write", "(", "i", "+", "1", ",", "2", ",", "mean_accuracy", ")", "\n", "sheet", ".", "write", "(", "i", "+", "1", ",", "3", ",", "standard_deviation", ")", "\n", "sheet", ".", "write", "(", "i", "+", "1", ",", "4", ",", "exact_match_distribution", "[", "True", "]", ")", "\n", "sheet", ".", "write", "(", "i", "+", "1", ",", "5", ",", "exact_match_distribution", "[", "False", "]", ")", "\n", "sheet", ".", "write", "(", "i", "+", "1", ",", "6", ",", "exact_match_distribution", "[", "True", "]", "/", "(", "\n", "exact_match_distribution", "[", "False", "]", "+", "exact_match_distribution", "[", "True", "]", ")", ")", "\n", "", "outfile", ".", "write", "(", "\"\\n\\n\\n\"", ")", "\n", "", "outfile_excel", "=", "output_file", ".", "split", "(", "\".txt\"", ")", "[", "0", "]", "+", "\".xls\"", "\n", "workbook", ".", "save", "(", "outfile_excel", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_save_and_load_dataset": [[103, 126], ["time.time", "dataset.get_data_pairs", "dataset.save_dataset", "dataset.save_dataset_statistics", "dataset.save_dataset_statistics", "GroundedScan.dataset.GroundedScan.load_dataset_from_file", "zip", "os.remove", "time.time", "logger.info", "os.path.join", "dataset.get_examples_with_image", "GroundedScan.load_dataset_from_file.get_examples_with_image", "numpy.array_equal", "os.path.join", "dataset.command_repr", "GroundedScan.load_dataset_from_file.command_repr", "dataset.command_repr", "GroundedScan.load_dataset_from_file.command_repr", "dataset.command_repr", "GroundedScan.load_dataset_from_file.command_repr"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_data_pairs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_dataset", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_dataset_statistics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_dataset_statistics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.load_dataset_from_file", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_examples_with_image", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_examples_with_image", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr"], ["def", "test_save_and_load_dataset", "(", "dataset", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "dataset", ".", "get_data_pairs", "(", "max_examples", "=", "EXAMPLES_TO_TEST", ")", "\n", "dataset", ".", "save_dataset", "(", "\"test.txt\"", ")", "\n", "dataset", ".", "save_dataset_statistics", "(", "split", "=", "\"train\"", ")", "\n", "dataset", ".", "save_dataset_statistics", "(", "split", "=", "\"test\"", ")", "\n", "\n", "test_grounded_scan", "=", "GroundedScan", ".", "load_dataset_from_file", "(", "os", ".", "path", ".", "join", "(", "TEST_DIRECTORY", ",", "\"test.txt\"", ")", ",", "\n", "TEST_DIRECTORY", ")", "\n", "for", "example_one", ",", "example_two", "in", "zip", "(", "dataset", ".", "get_examples_with_image", "(", "\"train\"", ")", ",", "\n", "test_grounded_scan", ".", "get_examples_with_image", "(", "\"train\"", ")", ")", ":", "\n", "        ", "assert", "dataset", ".", "command_repr", "(", "example_one", "[", "\"input_command\"", "]", ")", "==", "test_grounded_scan", ".", "command_repr", "(", "\n", "example_two", "[", "\"input_command\"", "]", ")", ",", "\"test_save_and_load_dataset FAILED\"", "\n", "assert", "dataset", ".", "command_repr", "(", "example_one", "[", "\"target_command\"", "]", ")", "==", "test_grounded_scan", ".", "command_repr", "(", "\n", "example_two", "[", "\"target_command\"", "]", ")", ",", "\"test_save_and_load_dataset FAILED\"", "\n", "assert", "np", ".", "array_equal", "(", "example_one", "[", "\"situation_image\"", "]", ",", "example_two", "[", "\"situation_image\"", "]", ")", ",", "\" FAILED\"", "\n", "assert", "dataset", ".", "command_repr", "(", "example_one", "[", "\"input_meaning\"", "]", ")", "==", "test_grounded_scan", ".", "command_repr", "(", "\n", "example_two", "[", "\"input_meaning\"", "]", ")", ",", "\"test_save_and_load_dataset FAILED\"", "\n", "", "os", ".", "remove", "(", "os", ".", "path", ".", "join", "(", "TEST_DIRECTORY", ",", "\"test.txt\"", ")", ")", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_save_and_load_dataset PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "return", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_save_and_load_dataset_nonce": [[128, 152], ["time.time", "TEST_DATASET_NONCE.get_data_pairs", "TEST_DATASET_NONCE.save_dataset", "TEST_DATASET_NONCE.save_dataset_statistics", "TEST_DATASET_NONCE.save_dataset_statistics", "GroundedScan.dataset.GroundedScan.load_dataset_from_file", "zip", "os.remove", "time.time", "logger.info", "os.path.join", "TEST_DATASET_NONCE.get_examples_with_image", "GroundedScan.load_dataset_from_file.get_examples_with_image", "numpy.array_equal", "os.path.join", "TEST_DATASET_NONCE.command_repr", "GroundedScan.load_dataset_from_file.command_repr", "TEST_DATASET_NONCE.command_repr", "GroundedScan.load_dataset_from_file.command_repr", "TEST_DATASET_NONCE.command_repr", "GroundedScan.load_dataset_from_file.command_repr"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_data_pairs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_dataset", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_dataset_statistics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_dataset_statistics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.load_dataset_from_file", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_examples_with_image", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_examples_with_image", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr"], ["", "def", "test_save_and_load_dataset_nonce", "(", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "TEST_DATASET_NONCE", ".", "get_data_pairs", "(", "max_examples", "=", "EXAMPLES_TO_TEST", ")", "\n", "TEST_DATASET_NONCE", ".", "save_dataset", "(", "\"test.txt\"", ")", "\n", "TEST_DATASET_NONCE", ".", "save_dataset_statistics", "(", "split", "=", "\"train\"", ")", "\n", "TEST_DATASET_NONCE", ".", "save_dataset_statistics", "(", "split", "=", "\"test\"", ")", "\n", "\n", "test_grounded_scan", "=", "GroundedScan", ".", "load_dataset_from_file", "(", "os", ".", "path", ".", "join", "(", "TEST_DIRECTORY", ",", "\"test.txt\"", ")", ",", "\n", "TEST_DIRECTORY", ")", "\n", "\n", "for", "example_one", ",", "example_two", "in", "zip", "(", "TEST_DATASET_NONCE", ".", "get_examples_with_image", "(", "\"train\"", ")", ",", "\n", "test_grounded_scan", ".", "get_examples_with_image", "(", "\"train\"", ")", ")", ":", "\n", "        ", "assert", "TEST_DATASET_NONCE", ".", "command_repr", "(", "example_one", "[", "\"input_command\"", "]", ")", "==", "test_grounded_scan", ".", "command_repr", "(", "\n", "example_two", "[", "\"input_command\"", "]", ")", ",", "\"test_save_and_load_dataset FAILED\"", "\n", "assert", "TEST_DATASET_NONCE", ".", "command_repr", "(", "example_one", "[", "\"target_command\"", "]", ")", "==", "test_grounded_scan", ".", "command_repr", "(", "\n", "example_two", "[", "\"target_command\"", "]", ")", ",", "\"test_save_and_load_dataset FAILED\"", "\n", "assert", "np", ".", "array_equal", "(", "example_one", "[", "\"situation_image\"", "]", ",", "example_two", "[", "\"situation_image\"", "]", ")", ",", "\"test_save_and_load_dataset FAILED\"", "\n", "assert", "TEST_DATASET_NONCE", ".", "command_repr", "(", "example_one", "[", "\"input_meaning\"", "]", ")", "==", "test_grounded_scan", ".", "command_repr", "(", "\n", "example_two", "[", "\"input_meaning\"", "]", ")", ",", "\"test_save_and_load_dataset FAILED\"", "\n", "", "os", ".", "remove", "(", "os", ".", "path", ".", "join", "(", "TEST_DIRECTORY", ",", "\"test.txt\"", ")", ")", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_save_and_load_dataset PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "return", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_derivation_from_rules": [[154, 164], ["time.time", "dataset.sample_command", "derivation.to_rules", "GroundedScan.grammar.Derivation.from_rules", "time.time", "logger.info", "Derivation.from_rules.words", "derivation.words"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.sample_command", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.to_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words"], ["", "def", "test_derivation_from_rules", "(", "dataset", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "derivation", ",", "arguments", "=", "dataset", ".", "sample_command", "(", ")", "\n", "rules_list", "=", "[", "]", "\n", "lexicon", "=", "{", "}", "\n", "derivation", ".", "to_rules", "(", "rules_list", ",", "lexicon", ")", "\n", "test", "=", "Derivation", ".", "from_rules", "(", "rules_list", ",", "lexicon", "=", "lexicon", ")", "\n", "assert", "' '", ".", "join", "(", "test", ".", "words", "(", ")", ")", "==", "' '", ".", "join", "(", "derivation", ".", "words", "(", ")", ")", ",", "\"test_derivation_from_rules FAILED\"", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_derivation_from_rules PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_derivation_from_string": [[166, 175], ["time.time", "dataset.sample_command", "derivation.__repr__", "derivation.__repr__.split", "GroundedScan.grammar.Derivation.from_str", "time.time", "logger.info", "Derivation.from_str.words", "derivation.words"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.sample_command", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.__repr__", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_str", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words"], ["", "def", "test_derivation_from_string", "(", "dataset", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "derivation", ",", "arguments", "=", "dataset", ".", "sample_command", "(", ")", "\n", "derivation_str", "=", "derivation", ".", "__repr__", "(", ")", "\n", "rules_str", ",", "lexicon_str", "=", "derivation_str", ".", "split", "(", "';'", ")", "\n", "new_derivation", "=", "Derivation", ".", "from_str", "(", "rules_str", ",", "lexicon_str", ",", "dataset", ".", "_grammar", ")", "\n", "assert", "' '", ".", "join", "(", "new_derivation", ".", "words", "(", ")", ")", "==", "' '", ".", "join", "(", "derivation", ".", "words", "(", ")", ")", ",", "\"test_derivation_from_string FAILED\"", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_derivation_from_string PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_demonstrate_target_commands_one": [[177, 195], ["time.time", "GroundedScan.grammar.Derivation.from_str", "dataset.demonstrate_command", "dataset.demonstrate_target_commands", "time.time", "logger.info", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "Derivation.from_str.words"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_str", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_target_commands", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words"], ["", "def", "test_demonstrate_target_commands_one", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test that target commands sequence resulting from demonstrate_command is the same as the one executed by\n     demonstrate_target_commands\"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "rules_str", "=", "\"NP -> NN,NP -> JJ NP,DP -> 'a' NP,VP -> VV_intrans 'to' DP,ROOT -> VP\"", "\n", "translate_fn", "=", "dataset", ".", "_vocabulary", ".", "translate_meaning", "\n", "lexicon_str", "=", "\"T:{},NT:VV_intransitive -> {},T:to,T:a,T:{},NT:JJ -> {},T:{},NT:NN -> {}\"", ".", "format", "(", "\n", "translate_fn", "(", "\"walk\"", ")", ",", "translate_fn", "(", "\"walk\"", ")", ",", "translate_fn", "(", "\"small\"", ")", ",", "translate_fn", "(", "\"small\"", ")", ",", "\n", "translate_fn", "(", "\"circle\"", ")", ",", "translate_fn", "(", "\"circle\"", ")", "\n", ")", "\n", "derivation", "=", "Derivation", ".", "from_str", "(", "rules_str", ",", "lexicon_str", ",", "dataset", ".", "_grammar", ")", "\n", "actual_target_commands", ",", "_", ",", "_", "=", "dataset", ".", "demonstrate_command", "(", "derivation", ",", "TEST_SITUATION_1", ")", "\n", "command", "=", "' '", ".", "join", "(", "derivation", ".", "words", "(", ")", ")", "\n", "target_commands", ",", "_", ",", "_", ",", "_", "=", "dataset", ".", "demonstrate_target_commands", "(", "command", ",", "TEST_SITUATION_1", ",", "actual_target_commands", ")", "\n", "assert", "','", ".", "join", "(", "actual_target_commands", ")", "==", "','", ".", "join", "(", "target_commands", ")", ",", "\"test_demonstrate_target_commands_one FAILED\"", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_demonstrate_target_commands_one PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_demonstrate_target_commands_two": [[197, 214], ["time.time", "GroundedScan.grammar.Derivation.from_str", "dataset.demonstrate_command", "dataset.demonstrate_target_commands", "time.time", "logger.info", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "Derivation.from_str.words"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_str", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_target_commands", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words"], ["", "def", "test_demonstrate_target_commands_two", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test that target commands sequence resulting from demonstrate_command for pushing a heavy objectis the same as\n     the executed one by demonstrate_target_commands\"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "rules_str", "=", "\"NP -> NN,NP -> JJ NP,DP -> 'a' NP,VP -> VV_trans DP,ROOT -> VP\"", "\n", "translate_fn", "=", "dataset", ".", "_vocabulary", ".", "translate_meaning", "\n", "lexicon_str", "=", "\"T:{},NT:VV_transitive -> {},T:a,T:{},NT:JJ -> {},T:{},NT:NN -> {}\"", ".", "format", "(", "\n", "translate_fn", "(", "\"push\"", ")", ",", "translate_fn", "(", "\"push\"", ")", ",", "translate_fn", "(", "\"big\"", ")", ",", "translate_fn", "(", "\"big\"", ")", ",", "translate_fn", "(", "\"circle\"", ")", ",", "\n", "translate_fn", "(", "\"circle\"", ")", "\n", ")", "\n", "derivation", "=", "Derivation", ".", "from_str", "(", "rules_str", ",", "lexicon_str", ",", "dataset", ".", "_grammar", ")", "\n", "actual_target_commands", ",", "_", ",", "_", "=", "dataset", ".", "demonstrate_command", "(", "derivation", ",", "initial_situation", "=", "TEST_SITUATION_2", ")", "\n", "command", "=", "' '", ".", "join", "(", "derivation", ".", "words", "(", ")", ")", "\n", "target_commands", ",", "_", ",", "_", ",", "_", "=", "dataset", ".", "demonstrate_target_commands", "(", "command", ",", "TEST_SITUATION_2", ",", "actual_target_commands", ")", "\n", "assert", "','", ".", "join", "(", "actual_target_commands", ")", "==", "','", ".", "join", "(", "target_commands", ")", ",", "\"test_demonstrate_target_commands_two FAILED\"", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_demonstrate_target_commands_two PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_demonstrate_target_commands_three": [[216, 233], ["time.time", "GroundedScan.grammar.Derivation.from_str", "dataset.demonstrate_command", "dataset.demonstrate_target_commands", "time.time", "logger.info", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "Derivation.from_str.words"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_str", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_target_commands", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words"], ["", "def", "test_demonstrate_target_commands_three", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test that target commands sequence resulting from demonstrate_command for pushing a light object is the same as\n     the executed one by demonstrate_target_commands\"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "rules_str", "=", "\"NP -> NN,NP -> JJ NP,DP -> 'a' NP,VP -> VV_trans DP,ROOT -> VP\"", "\n", "translate_fn", "=", "dataset", ".", "_vocabulary", ".", "translate_meaning", "\n", "lexicon_str", "=", "\"T:{},NT:VV_transitive -> {},T:a,T:{},NT:JJ -> {},T:{},NT:NN -> {}\"", ".", "format", "(", "\n", "translate_fn", "(", "\"push\"", ")", ",", "translate_fn", "(", "\"push\"", ")", ",", "translate_fn", "(", "\"small\"", ")", ",", "translate_fn", "(", "\"small\"", ")", ",", "\n", "translate_fn", "(", "\"circle\"", ")", ",", "translate_fn", "(", "\"circle\"", ")", "\n", ")", "\n", "derivation", "=", "Derivation", ".", "from_str", "(", "rules_str", ",", "lexicon_str", ",", "dataset", ".", "_grammar", ")", "\n", "actual_target_commands", ",", "_", ",", "_", "=", "dataset", ".", "demonstrate_command", "(", "derivation", ",", "initial_situation", "=", "TEST_SITUATION_1", ")", "\n", "command", "=", "' '", ".", "join", "(", "derivation", ".", "words", "(", ")", ")", "\n", "target_commands", ",", "_", ",", "_", ",", "_", "=", "dataset", ".", "demonstrate_target_commands", "(", "command", ",", "TEST_SITUATION_1", ",", "actual_target_commands", ")", "\n", "assert", "','", ".", "join", "(", "actual_target_commands", ")", "==", "','", ".", "join", "(", "target_commands", ")", ",", "\"test_demonstrate_target_commands_three FAILED\"", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_demonstrate_target_commands_three PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_demonstrate_command_one": [[235, 251], ["time.time", "GroundedScan.grammar.Derivation.from_str", "dataset.demonstrate_command", "time.time", "logger.info", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_str", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command"], ["", "def", "test_demonstrate_command_one", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test pushing a light object (where one target command of 'push <dir>' results in movement of 1 grid).\"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "rules_str", "=", "\"NP -> NN,NP -> JJ NP,DP -> 'a' NP,VP -> VV_trans DP,ROOT -> VP\"", "\n", "translate_fn", "=", "dataset", ".", "_vocabulary", ".", "translate_meaning", "\n", "lexicon_str", "=", "\"T:{},NT:VV_transitive -> {},T:a,T:{},NT:JJ -> {},T:{},NT:NN -> {}\"", ".", "format", "(", "\n", "translate_fn", "(", "\"push\"", ")", ",", "translate_fn", "(", "\"push\"", ")", ",", "translate_fn", "(", "\"small\"", ")", ",", "translate_fn", "(", "\"small\"", ")", ",", "\n", "translate_fn", "(", "\"circle\"", ")", ",", "translate_fn", "(", "\"circle\"", ")", "\n", ")", "\n", "derivation", "=", "Derivation", ".", "from_str", "(", "rules_str", ",", "lexicon_str", ",", "dataset", ".", "_grammar", ")", "\n", "expected_target_commands", "=", "\"walk,walk,turn right,walk,walk,walk,\"", "\"push,push,push,push\"", "\n", "actual_target_commands", ",", "_", ",", "_", "=", "dataset", ".", "demonstrate_command", "(", "derivation", ",", "initial_situation", "=", "TEST_SITUATION_1", ")", "\n", "assert", "expected_target_commands", "==", "','", ".", "join", "(", "actual_target_commands", ")", ",", "\"test_demonstrate_command_one FAILED\"", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_demonstrate_command_one PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_demonstrate_command_two": [[253, 269], ["time.time", "GroundedScan.grammar.Derivation.from_str", "dataset.demonstrate_command", "time.time", "logger.info", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_str", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command"], ["", "def", "test_demonstrate_command_two", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test pushing a heavy object (where one target command of 'push <dir>' results in movement of 1 grid).\"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "rules_str", "=", "\"NP -> NN,NP -> JJ NP,DP -> 'a' NP,VP -> VV_trans DP,ROOT -> VP\"", "\n", "translate_fn", "=", "dataset", ".", "_vocabulary", ".", "translate_meaning", "\n", "lexicon_str", "=", "\"T:{},NT:VV_transitive -> {},T:a,T:{},NT:JJ -> {},T:{},NT:NN -> {}\"", ".", "format", "(", "\n", "translate_fn", "(", "\"push\"", ")", ",", "translate_fn", "(", "\"push\"", ")", ",", "translate_fn", "(", "\"small\"", ")", ",", "translate_fn", "(", "\"small\"", ")", ",", "\n", "translate_fn", "(", "\"circle\"", ")", ",", "translate_fn", "(", "\"circle\"", ")", "\n", ")", "\n", "derivation", "=", "Derivation", ".", "from_str", "(", "rules_str", ",", "lexicon_str", ",", "dataset", ".", "_grammar", ")", "\n", "expected_target_commands", "=", "\"walk,walk,turn right,walk,walk,walk,\"", "\"push,push,push,push,push,push,push,push\"", "\n", "actual_target_commands", ",", "_", ",", "_", "=", "dataset", ".", "demonstrate_command", "(", "derivation", ",", "initial_situation", "=", "TEST_SITUATION_2", ")", "\n", "assert", "expected_target_commands", "==", "','", ".", "join", "(", "actual_target_commands", ")", ",", "\"test_demonstrate_command_two FAILED\"", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_demonstrate_command_two PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_demonstrate_command_three": [[271, 288], ["time.time", "GroundedScan.grammar.Derivation.from_str", "dataset.demonstrate_command", "time.time", "logger.info", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_str", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command"], ["", "def", "test_demonstrate_command_three", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test walk to a small circle, tests that the function demonstrate command is able to find the target small circle\n    even if that circle isn't explicitly set as the target object in the situation (which it wouldn't be at test time).\n    \"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "rules_str", "=", "\"NP -> NN,NP -> JJ NP,DP -> 'a' NP,VP -> VV_intrans 'to' DP,ROOT -> VP\"", "\n", "translate_fn", "=", "dataset", ".", "_vocabulary", ".", "translate_meaning", "\n", "lexicon_str", "=", "\"T:{},NT:VV_intransitive -> {},T:to,T:a,T:{},NT:JJ -> {},T:{},NT:NN -> {}\"", ".", "format", "(", "\n", "translate_fn", "(", "\"walk\"", ")", ",", "translate_fn", "(", "\"walk\"", ")", ",", "translate_fn", "(", "\"small\"", ")", ",", "translate_fn", "(", "\"small\"", ")", ",", "translate_fn", "(", "\"circle\"", ")", ",", "\n", "translate_fn", "(", "\"circle\"", ")", "\n", ")", "\n", "derivation", "=", "Derivation", ".", "from_str", "(", "rules_str", ",", "lexicon_str", ",", "dataset", ".", "_grammar", ")", "\n", "expected_target_commands", "=", "\"walk,walk,turn right,walk,walk,walk\"", "\n", "actual_target_commands", ",", "_", ",", "_", "=", "dataset", ".", "demonstrate_command", "(", "derivation", ",", "initial_situation", "=", "TEST_SITUATION_3", ")", "\n", "assert", "expected_target_commands", "==", "','", ".", "join", "(", "actual_target_commands", ")", ",", "\"test_demonstrate_command_three FAILED\"", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_demonstrate_command_three PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_demonstrate_command_four": [[290, 307], ["time.time", "GroundedScan.grammar.Derivation.from_str", "dataset.demonstrate_command", "time.time", "logger.info", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_str", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command"], ["", "def", "test_demonstrate_command_four", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test walk to a small circle, tests that the function demonstrate command is able to find the target big circle\n    even if that circle isn't explicitly set as the target object in the situation (which it wouldn't be at test time).\n    \"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "rules_str", "=", "\"NP -> NN,NP -> JJ NP,DP -> 'a' NP,VP -> VV_intrans 'to' DP,ROOT -> VP\"", "\n", "translate_fn", "=", "dataset", ".", "_vocabulary", ".", "translate_meaning", "\n", "lexicon_str", "=", "\"T:{},NT:VV_intransitive -> {},T:to,T:a,T:{},NT:JJ -> {},T:{},NT:NN -> {}\"", ".", "format", "(", "\n", "translate_fn", "(", "\"walk\"", ")", ",", "translate_fn", "(", "\"walk\"", ")", ",", "translate_fn", "(", "\"big\"", ")", ",", "translate_fn", "(", "\"big\"", ")", ",", "translate_fn", "(", "\"circle\"", ")", ",", "\n", "translate_fn", "(", "\"circle\"", ")", "\n", ")", "\n", "derivation", "=", "Derivation", ".", "from_str", "(", "rules_str", ",", "lexicon_str", ",", "dataset", ".", "_grammar", ")", "\n", "expected_target_commands", "=", "\"turn left,turn left,walk,turn right,walk,walk,walk,walk\"", "\n", "actual_target_commands", ",", "_", ",", "_", "=", "dataset", ".", "demonstrate_command", "(", "derivation", ",", "initial_situation", "=", "TEST_SITUATION_3", ")", "\n", "assert", "expected_target_commands", "==", "','", ".", "join", "(", "actual_target_commands", ")", ",", "\"test_demonstrate_command_four FAILED\"", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_demonstrate_command_four PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_demonstrate_command_five": [[309, 324], ["time.time", "GroundedScan.grammar.Derivation.from_str", "dataset.demonstrate_command", "time.time", "logger.info", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_str", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command"], ["", "def", "test_demonstrate_command_five", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test that when referring to a small red circle and two present in the world, it finds the correct one.\"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "rules_str", "=", "\"NP -> NN,NP -> JJ NP,NP -> JJ NP,DP -> 'a' NP,VP -> VV_intrans 'to' DP,ROOT -> VP\"", "\n", "translate_fn", "=", "dataset", ".", "_vocabulary", ".", "translate_meaning", "\n", "lexicon_str", "=", "\"T:{},NT:VV_intransitive -> {},T:to,T:a,T:{},NT:JJ -> {}:JJ -> {},T:{},T:{},NT:\"", "\"NN -> {}\"", ".", "format", "(", "translate_fn", "(", "\"walk\"", ")", ",", "translate_fn", "(", "\"walk\"", ")", ",", "translate_fn", "(", "\"red\"", ")", ",", "\n", "translate_fn", "(", "\"small\"", ")", ",", "translate_fn", "(", "\"red\"", ")", ",", "translate_fn", "(", "\"small\"", ")", ",", "\n", "translate_fn", "(", "\"circle\"", ")", ",", "translate_fn", "(", "\"circle\"", ")", ")", "\n", "derivation", "=", "Derivation", ".", "from_str", "(", "rules_str", ",", "lexicon_str", ",", "dataset", ".", "_grammar", ")", "\n", "expected_target_commands", "=", "\"walk,walk,turn right,walk,walk,walk\"", "\n", "actual_target_commands", ",", "_", ",", "_", "=", "dataset", ".", "demonstrate_command", "(", "derivation", ",", "initial_situation", "=", "TEST_SITUATION_4", ")", "\n", "assert", "expected_target_commands", "==", "','", ".", "join", "(", "actual_target_commands", ")", ",", "\"test_demonstrate_command_five FAILED\"", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_demonstrate_command_five PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_demonstrate_command_six": [[326, 344], ["time.time", "GroundedScan.grammar.Derivation.from_str", "time.time", "logger.info", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "dataset.demonstrate_command"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_str", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command"], ["", "def", "test_demonstrate_command_six", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test that when referring to a small red circle but only one red circle is present, demonstrate_commands fails.\"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "rules_str", "=", "\"NP -> NN,NP -> JJ NP,NP -> JJ NP,DP -> 'a' NP,VP -> VV_intrans 'to' DP,ROOT -> VP\"", "\n", "translate_fn", "=", "dataset", ".", "_vocabulary", ".", "translate_meaning", "\n", "lexicon_str", "=", "\"T:{},NT:VV_intransitive -> {},T:to,T:a,T:{},NT:JJ -> {}:JJ -> {},T:{},T:{},NT:\"", "\"NN -> {}\"", ".", "format", "(", "translate_fn", "(", "\"walk\"", ")", ",", "translate_fn", "(", "\"walk\"", ")", ",", "translate_fn", "(", "\"red\"", ")", ",", "\n", "translate_fn", "(", "\"small\"", ")", ",", "translate_fn", "(", "\"red\"", ")", ",", "translate_fn", "(", "\"small\"", ")", ",", "\n", "translate_fn", "(", "\"circle\"", ")", ",", "translate_fn", "(", "\"circle\"", ")", ")", "\n", "derivation", "=", "Derivation", ".", "from_str", "(", "rules_str", ",", "lexicon_str", ",", "dataset", ".", "_grammar", ")", "\n", "expected_target_commands", "=", "\"\"", "\n", "try", ":", "\n", "        ", "actual_target_commands", ",", "_", ",", "_", "=", "dataset", ".", "demonstrate_command", "(", "derivation", ",", "initial_situation", "=", "TEST_SITUATION_3", ")", "\n", "", "except", "AssertionError", ":", "\n", "        ", "actual_target_commands", "=", "\"\"", "\n", "", "assert", "expected_target_commands", "==", "','", ".", "join", "(", "actual_target_commands", ")", ",", "\"test_demonstrate_command_six FAILED\"", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_demonstrate_command_six PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_find_referred_target_one": [[346, 368], ["time.time", "GroundedScan.grammar.Derivation.from_str", "Derivation.from_str.meaning", "arguments.pop().to_predicate", "time.time", "logger.info", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "len", "translate_fn", "translate_fn", "translate_fn", "arguments.pop", "translate_fn_word", "target_str.split"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_str", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.to_predicate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop"], ["", "def", "test_find_referred_target_one", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test that for particular referred targets, the Derivation class identifies it correctly.\"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "rules_str", "=", "\"NP -> NN,NP -> JJ NP,NP -> JJ NP,DP -> 'a' NP,VP -> VV_intrans 'to' DP,ROOT -> VP\"", "\n", "translate_fn", "=", "dataset", ".", "_vocabulary", ".", "translate_meaning", "\n", "lexicon_str", "=", "\"T:{},NT:VV_intransitive -> {},T:to,T:a,T:{},NT:JJ -> {}:JJ -> {},T:{},T:{},NT:\"", "\"NN -> {}\"", ".", "format", "(", "translate_fn", "(", "\"walk\"", ")", ",", "translate_fn", "(", "\"walk\"", ")", ",", "translate_fn", "(", "\"red\"", ")", ",", "\n", "translate_fn", "(", "\"small\"", ")", ",", "translate_fn", "(", "\"red\"", ")", ",", "translate_fn", "(", "\"small\"", ")", ",", "\n", "translate_fn", "(", "\"circle\"", ")", ",", "translate_fn", "(", "\"circle\"", ")", ")", "\n", "derivation", "=", "Derivation", ".", "from_str", "(", "rules_str", ",", "lexicon_str", ",", "dataset", ".", "_grammar", ")", "\n", "arguments", "=", "[", "]", "\n", "derivation", ".", "meaning", "(", "arguments", ")", "\n", "assert", "len", "(", "arguments", ")", "==", "1", ",", "\"test_find_referred_target_one FAILED.\"", "\n", "target_str", ",", "target_predicate", "=", "arguments", ".", "pop", "(", ")", ".", "to_predicate", "(", ")", "\n", "translate_fn_word", "=", "dataset", ".", "_vocabulary", ".", "translate_word", "\n", "translated_target_str", "=", "' '", ".", "join", "(", "[", "translate_fn_word", "(", "word", ")", "for", "word", "in", "target_str", ".", "split", "(", ")", "]", ")", "\n", "assert", "translated_target_str", "==", "\"red circle\"", ",", "\"test_find_referred_target FAILED.\"", "\n", "assert", "target_predicate", "[", "\"noun\"", "]", "==", "translate_fn", "(", "\"circle\"", ")", ",", "\"test_find_referred_target_one FAILED.\"", "\n", "assert", "target_predicate", "[", "\"size\"", "]", "==", "translate_fn", "(", "\"small\"", ")", ",", "\"test_find_referred_target_one FAILED.\"", "\n", "assert", "target_predicate", "[", "\"color\"", "]", "==", "translate_fn", "(", "\"red\"", ")", ",", "\"test_find_referred_target_one FAILED.\"", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_find_referred_target_one PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_find_referred_target_two": [[370, 392], ["time.time", "GroundedScan.grammar.Derivation.from_str", "Derivation.from_str.meaning", "arguments.pop().to_predicate", "time.time", "logger.info", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "len", "translate_fn", "translate_fn", "translate_fn", "arguments.pop", "translate_fn_word", "target_str.split"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_str", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.to_predicate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop"], ["", "def", "test_find_referred_target_two", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test that for particular referred targets, the Derivation class identifies it correctly.\"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "rules_str", "=", "\"NP -> NN,NP -> JJ NP,DP -> 'a' NP,VP -> VV_intrans 'to' DP,ROOT -> VP\"", "\n", "translate_fn", "=", "dataset", ".", "_vocabulary", ".", "translate_meaning", "\n", "lexicon_str", "=", "\"T:{},NT:VV_intransitive -> {},T:to,T:a,T:{},NT:JJ -> {},T:{},NT:NN -> {}\"", ".", "format", "(", "\n", "translate_fn", "(", "\"walk\"", ")", ",", "translate_fn", "(", "\"walk\"", ")", ",", "translate_fn", "(", "\"big\"", ")", ",", "translate_fn", "(", "\"big\"", ")", ",", "translate_fn", "(", "\"circle\"", ")", ",", "\n", "translate_fn", "(", "\"circle\"", ")", "\n", ")", "\n", "derivation", "=", "Derivation", ".", "from_str", "(", "rules_str", ",", "lexicon_str", ",", "dataset", ".", "_grammar", ")", "\n", "arguments", "=", "[", "]", "\n", "derivation", ".", "meaning", "(", "arguments", ")", "\n", "assert", "len", "(", "arguments", ")", "==", "1", ",", "\"test_find_referred_target_two FAILED.\"", "\n", "target_str", ",", "target_predicate", "=", "arguments", ".", "pop", "(", ")", ".", "to_predicate", "(", ")", "\n", "translate_fn_word", "=", "dataset", ".", "_vocabulary", ".", "translate_word", "\n", "translated_target_str", "=", "' '", ".", "join", "(", "[", "translate_fn_word", "(", "word", ")", "for", "word", "in", "target_str", ".", "split", "(", ")", "]", ")", "\n", "assert", "translated_target_str", "==", "\"circle\"", ",", "\"test_find_referred_target_two FAILED.\"", "\n", "assert", "target_predicate", "[", "\"noun\"", "]", "==", "translate_fn", "(", "\"circle\"", ")", ",", "\"test_find_referred_target_two FAILED.\"", "\n", "assert", "target_predicate", "[", "\"size\"", "]", "==", "translate_fn", "(", "\"big\"", ")", ",", "\"test_find_referred_target_two FAILED.\"", "\n", "assert", "target_predicate", "[", "\"color\"", "]", "==", "translate_fn", "(", "\"\"", ")", ",", "\"test_find_referred_target_two FAILED.\"", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_find_referred_target_two PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_generate_possible_targets_one": [[394, 411], ["time.time", "dataset.generate_possible_targets", "time.time", "logger.info", "translate_meaning", "translate_meaning", "translate_meaning", "translate_word", "translate_word", "translate_word"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_possible_targets", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word"], ["", "def", "test_generate_possible_targets_one", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test that for particular referred targets, the right possible target objects get generated.\"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "translate_meaning", "=", "dataset", ".", "_vocabulary", ".", "translate_meaning", "\n", "target_predicate", "=", "{", "\"noun\"", ":", "translate_meaning", "(", "\"circle\"", ")", ",", "\n", "\"color\"", ":", "translate_meaning", "(", "\"red\"", ")", ",", "\n", "\"size\"", ":", "translate_meaning", "(", "\"big\"", ")", "}", "\n", "translate_word", "=", "dataset", ".", "_vocabulary", ".", "translate_word", "\n", "expected_possible_targets", "=", "{", "(", "2", ",", "\"red\"", ",", "\"circle\"", ")", ",", "(", "3", ",", "\"red\"", ",", "\"circle\"", ")", ",", "(", "4", ",", "\"red\"", ",", "\"circle\"", ")", "}", "\n", "actual_possible_targets", "=", "dataset", ".", "generate_possible_targets", "(", "\n", "referred_size", "=", "translate_word", "(", "target_predicate", "[", "\"size\"", "]", ")", ",", "\n", "referred_color", "=", "translate_word", "(", "target_predicate", "[", "\"color\"", "]", ")", ",", "\n", "referred_shape", "=", "translate_word", "(", "target_predicate", "[", "\"noun\"", "]", ")", ")", "\n", "for", "actual_possible_target", "in", "actual_possible_targets", ":", "\n", "        ", "assert", "actual_possible_target", "in", "expected_possible_targets", ",", "\"test_generate_possible_targets_one FAILED.\"", "\n", "", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_generate_possible_targets_one PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_generate_possible_targets_two": [[413, 432], ["time.time", "dataset.generate_possible_targets", "zip", "time.time", "logger.info", "translate_meaning", "translate_meaning", "translate_meaning", "translate_word", "translate_word", "translate_word"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_possible_targets", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word"], ["", "def", "test_generate_possible_targets_two", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test that for particular referred targets, the right possible target objects get generated.\"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "translate_meaning", "=", "dataset", ".", "_vocabulary", ".", "translate_meaning", "\n", "target_predicate", "=", "{", "\"noun\"", ":", "translate_meaning", "(", "\"circle\"", ")", ",", "\n", "\"color\"", ":", "translate_meaning", "(", "\"red\"", ")", ",", "\n", "\"size\"", ":", "translate_meaning", "(", "\"small\"", ")", "}", "\n", "translate_word", "=", "dataset", ".", "_vocabulary", ".", "translate_word", "\n", "expected_possible_targets", "=", "{", "(", "1", ",", "\"red\"", ",", "\"circle\"", ")", ",", "(", "2", ",", "\"red\"", ",", "\"circle\"", ")", ",", "(", "3", ",", "\"red\"", ",", "\"circle\"", ")", ",", "\n", "(", "1", ",", "\"blue\"", ",", "\"circle\"", ")", ",", "(", "2", ",", "\"blue\"", ",", "\"circle\"", ")", ",", "(", "3", ",", "\"blue\"", ",", "\"circle\"", ")", ",", "\n", "(", "1", ",", "\"green\"", ",", "\"circle\"", ")", ",", "(", "2", ",", "\"green\"", ",", "\"circle\"", ")", ",", "(", "3", ",", "\"green\"", ",", "\"circle\"", ")", "}", "\n", "actual_possible_targets", "=", "dataset", ".", "generate_possible_targets", "(", "\n", "referred_size", "=", "translate_word", "(", "target_predicate", "[", "\"size\"", "]", ")", ",", "\n", "referred_color", "=", "translate_word", "(", "target_predicate", "[", "\"color\"", "]", ")", ",", "\n", "referred_shape", "=", "translate_word", "(", "target_predicate", "[", "\"noun\"", "]", ")", ")", "\n", "for", "expected_possible_target", ",", "actual_possible_target", "in", "zip", "(", "expected_possible_targets", ",", "actual_possible_targets", ")", ":", "\n", "        ", "assert", "actual_possible_target", "in", "expected_possible_targets", ",", "\"test_generate_possible_targets_two FAILED.\"", "\n", "", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_generate_possible_targets_two PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_generate_situations_one": [[434, 466], ["time.time", "translate_meaning", "translate_meaning", "translate_meaning", "dataset.generate_situations", "[].pop", "dataset.initialize_world_from_spec", "dataset._world.object_positions().pop", "dataset._world.object_positions", "time.time", "logger.info", "len", "dataset._world.object_positions", "larger_objects.extend"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_situations", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world_from_spec", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.object_positions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.object_positions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend"], ["", "def", "test_generate_situations_one", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test that when a small green circle is referred to there exist no smaller green circles than the target object in\n    the world and at least one larger green circle.\"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "translate_meaning", "=", "dataset", ".", "_vocabulary", ".", "translate_meaning", "\n", "target_shape", "=", "\"circle\"", "\n", "target_color", "=", "\"green\"", "\n", "target_size", "=", "2", "\n", "referred_size", "=", "translate_meaning", "(", "\"small\"", ")", "\n", "referred_color", "=", "translate_meaning", "(", "\"green\"", ")", "\n", "referred_shape", "=", "translate_meaning", "(", "\"circle\"", ")", "\n", "situation_specifications", "=", "dataset", ".", "generate_situations", "(", "num_resampling", "=", "1", ")", "\n", "relevant_situation", "=", "situation_specifications", "[", "target_shape", "]", "[", "target_color", "]", "[", "target_size", "]", ".", "pop", "(", ")", "\n", "dataset", ".", "initialize_world_from_spec", "(", "relevant_situation", ",", "referred_size", "=", "referred_size", ",", "\n", "referred_color", "=", "referred_color", ",", "\n", "referred_shape", "=", "referred_shape", ",", "\n", "actual_size", "=", "target_size", ",", "\n", "sample_percentage", "=", "0.5", "\n", ")", "\n", "smallest_object", "=", "dataset", ".", "_world", ".", "object_positions", "(", "\"green circle\"", ",", "\n", "object_size", "=", "\"small\"", ")", ".", "pop", "(", ")", "\n", "assert", "smallest_object", "==", "relevant_situation", "[", "\"target_position\"", "]", ",", "\"test_generate_situations_one FAILED.\"", "\n", "other_related_objects", "=", "dataset", ".", "_world", ".", "object_positions", "(", "\"green circle\"", ")", "\n", "larger_objects", "=", "[", "]", "\n", "for", "size", ",", "sized_objects", "in", "other_related_objects", ":", "\n", "        ", "if", "size", "<", "target_size", ":", "\n", "            ", "assert", "not", "sized_objects", ",", "\"test_generate_situations_one FAILED.\"", "\n", "", "elif", "size", ">", "target_size", ":", "\n", "            ", "larger_objects", ".", "extend", "(", "sized_objects", ")", "\n", "", "", "assert", "len", "(", "larger_objects", ")", ">=", "1", ",", "\"test_generate_situations_one FAILED.\"", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_generate_situations_one PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_generate_situations_two": [[468, 500], ["time.time", "translate_meaning", "translate_meaning", "translate_meaning", "dataset.generate_situations", "[].pop", "dataset.initialize_world_from_spec", "dataset._world.object_positions().pop", "dataset._world.object_positions", "time.time", "logger.info", "len", "dataset._world.object_positions", "smaller_objects.extend"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_situations", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world_from_spec", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.object_positions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.object_positions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend"], ["", "def", "test_generate_situations_two", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test that when a big green circle is referred to there exists no larger green circles and the exists at least\n    one smaller green circle.\"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "translate_meaning", "=", "dataset", ".", "_vocabulary", ".", "translate_meaning", "\n", "target_shape", "=", "\"circle\"", "\n", "target_color", "=", "\"green\"", "\n", "target_size", "=", "2", "\n", "referred_size", "=", "translate_meaning", "(", "\"big\"", ")", "\n", "referred_color", "=", "translate_meaning", "(", "\"green\"", ")", "\n", "referred_shape", "=", "translate_meaning", "(", "\"circle\"", ")", "\n", "situation_specifications", "=", "dataset", ".", "generate_situations", "(", "num_resampling", "=", "1", ")", "\n", "relevant_situation", "=", "situation_specifications", "[", "target_shape", "]", "[", "target_color", "]", "[", "target_size", "]", ".", "pop", "(", ")", "\n", "dataset", ".", "initialize_world_from_spec", "(", "relevant_situation", ",", "referred_size", "=", "referred_size", ",", "\n", "referred_color", "=", "referred_color", ",", "\n", "referred_shape", "=", "referred_shape", ",", "\n", "actual_size", "=", "target_size", ",", "\n", "sample_percentage", "=", "0.5", "\n", ")", "\n", "largest_object", "=", "dataset", ".", "_world", ".", "object_positions", "(", "\"green circle\"", ",", "\n", "object_size", "=", "\"big\"", ")", ".", "pop", "(", ")", "\n", "assert", "largest_object", "==", "relevant_situation", "[", "\"target_position\"", "]", ",", "\"test_generate_situations_two FAILED.\"", "\n", "other_related_objects", "=", "dataset", ".", "_world", ".", "object_positions", "(", "\"green circle\"", ")", "\n", "smaller_objects", "=", "[", "]", "\n", "for", "size", ",", "sized_objects", "in", "other_related_objects", ":", "\n", "        ", "if", "size", ">", "target_size", ":", "\n", "            ", "assert", "not", "sized_objects", ",", "\"test_generate_situations_two FAILED.\"", "\n", "", "elif", "size", "<", "target_size", ":", "\n", "            ", "smaller_objects", ".", "extend", "(", "sized_objects", ")", "\n", "", "", "assert", "len", "(", "smaller_objects", ")", ">=", "1", ",", "\"test_generate_situations_two FAILED.\"", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_generate_situations_two PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_generate_situations_three": [[502, 532], ["time.time", "translate_meaning", "translate_meaning", "dataset.generate_situations", "[].pop", "dataset.initialize_world_from_spec", "dataset._world.object_positions().pop", "dataset._world.object_positions", "time.time", "logger.info", "len", "dataset._world.object_positions", "smaller_objects.extend"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_situations", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world_from_spec", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.object_positions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.object_positions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend"], ["", "def", "test_generate_situations_three", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test that for particular commands the right situations get matched.\"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "translate_meaning", "=", "dataset", ".", "_vocabulary", ".", "translate_meaning", "\n", "target_shape", "=", "\"circle\"", "\n", "target_color", "=", "\"green\"", "\n", "target_size", "=", "2", "\n", "referred_size", "=", "translate_meaning", "(", "\"big\"", ")", "\n", "referred_shape", "=", "translate_meaning", "(", "\"circle\"", ")", "\n", "situation_specifications", "=", "dataset", ".", "generate_situations", "(", "num_resampling", "=", "1", ")", "\n", "relevant_situation", "=", "situation_specifications", "[", "target_shape", "]", "[", "target_color", "]", "[", "target_size", "]", ".", "pop", "(", ")", "\n", "dataset", ".", "initialize_world_from_spec", "(", "relevant_situation", ",", "referred_size", "=", "referred_size", ",", "\n", "referred_color", "=", "\"\"", ",", "\n", "referred_shape", "=", "referred_shape", ",", "\n", "actual_size", "=", "target_size", ",", "\n", "sample_percentage", "=", "0.5", "\n", ")", "\n", "largest_object", "=", "dataset", ".", "_world", ".", "object_positions", "(", "\"circle\"", ",", "\n", "object_size", "=", "\"big\"", ")", ".", "pop", "(", ")", "\n", "assert", "largest_object", "==", "relevant_situation", "[", "\"target_position\"", "]", ",", "\"test_generate_situations_three FAILED.\"", "\n", "other_related_objects", "=", "dataset", ".", "_world", ".", "object_positions", "(", "\"circle\"", ")", "\n", "smaller_objects", "=", "[", "]", "\n", "for", "size", ",", "sized_objects", "in", "other_related_objects", ":", "\n", "        ", "if", "size", ">", "target_size", ":", "\n", "            ", "assert", "not", "sized_objects", ",", "\"test_generate_situations_three FAILED.\"", "\n", "", "elif", "size", "<", "target_size", ":", "\n", "            ", "smaller_objects", ".", "extend", "(", "sized_objects", ")", "\n", "", "", "assert", "len", "(", "smaller_objects", ")", ">=", "1", ",", "\"test_generate_situations_three FAILED.\"", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_generate_situations_three PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_situation_representation_eq": [[534, 545], ["time.time", "enumerate", "time.time", "logger.info", "enumerate"], "function", ["None"], ["", "def", "test_situation_representation_eq", "(", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "test_situations", "=", "[", "TEST_SITUATION_1", ",", "TEST_SITUATION_2", ",", "TEST_SITUATION_3", ",", "TEST_SITUATION_4", "]", "\n", "for", "i", ",", "test_situation_1", "in", "enumerate", "(", "test_situations", ")", ":", "\n", "        ", "for", "j", ",", "test_situation_2", "in", "enumerate", "(", "test_situations", ")", ":", "\n", "            ", "if", "i", "==", "j", ":", "\n", "                ", "assert", "test_situation_1", "==", "test_situation_2", ",", "\"test_situation_representation_eq FAILED.\"", "\n", "", "else", ":", "\n", "                ", "assert", "test_situation_1", "!=", "test_situation_2", ",", "\"test_situation_representation_eq FAILED.\"", "\n", "", "", "", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_situation_representation_eq PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_example_representation_eq": [[547, 573], ["time.time", "GroundedScan.grammar.Derivation.from_str", "Derivation.from_str.meaning", "arguments.pop().to_predicate", "Derivation.from_str.words", "dataset.demonstrate_command", "TEST_DATASET.fill_example", "TEST_DATASET.get_data_pairs", "dataset._data_pairs.items", "time.time", "logger.info", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "Derivation.from_str.words", "arguments.pop", "dataset._vocabulary.get_adverbs", "dataset.compare_examples"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_str", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.to_predicate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.fill_example", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_data_pairs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.compare_examples"], ["", "def", "test_example_representation_eq", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test that the function for comparing examples returns true when exactly the same example is passed twice.\"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "rules_str", "=", "\"NP -> NN,NP -> JJ NP,DP -> 'a' NP,VP -> VV_intrans 'to' DP,ROOT -> VP\"", "\n", "translate_fn", "=", "dataset", ".", "_vocabulary", ".", "translate_meaning", "\n", "lexicon_str", "=", "\"T:{},NT:VV_intransitive -> {},T:to,T:a,T:{},NT:JJ -> {},T:{},NT:NN -> {}\"", ".", "format", "(", "\n", "translate_fn", "(", "\"walk\"", ")", ",", "translate_fn", "(", "\"walk\"", ")", ",", "translate_fn", "(", "\"big\"", ")", ",", "translate_fn", "(", "\"big\"", ")", ",", "translate_fn", "(", "\"circle\"", ")", ",", "\n", "translate_fn", "(", "\"circle\"", ")", "\n", ")", "\n", "derivation", "=", "Derivation", ".", "from_str", "(", "rules_str", ",", "lexicon_str", ",", "dataset", ".", "_grammar", ")", "\n", "arguments", "=", "[", "]", "\n", "derivation", ".", "meaning", "(", "arguments", ")", "\n", "target_str", ",", "target_predicate", "=", "arguments", ".", "pop", "(", ")", ".", "to_predicate", "(", ")", "\n", "adverb", "=", "\"\"", "\n", "for", "word", "in", "derivation", ".", "words", "(", ")", ":", "\n", "        ", "if", "word", "in", "dataset", ".", "_vocabulary", ".", "get_adverbs", "(", ")", ":", "\n", "            ", "adverb", "=", "word", "\n", "", "", "target_commands", ",", "_", ",", "target_action", "=", "dataset", ".", "demonstrate_command", "(", "derivation", ",", "initial_situation", "=", "TEST_SITUATION_1", ")", "\n", "TEST_DATASET", ".", "fill_example", "(", "derivation", ".", "words", "(", ")", ",", "derivation", ",", "TEST_SITUATION_1", ",", "target_commands", ",", "target_action", ",", "\n", "target_predicate", ",", "visualize", "=", "False", ",", "splits", "=", "[", "\"train\"", "]", ",", "adverb", "=", "adverb", ")", "\n", "TEST_DATASET", ".", "get_data_pairs", "(", "max_examples", "=", "10", ",", "num_resampling", "=", "2", ")", "\n", "for", "split", ",", "examples", "in", "dataset", ".", "_data_pairs", ".", "items", "(", ")", ":", "\n", "        ", "for", "example", "in", "examples", ":", "\n", "            ", "assert", "dataset", ".", "compare_examples", "(", "example", ",", "example", ")", ",", "\"test_example_representation_eq FAILED.\"", "\n", "", "", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_example_representation_eq PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_example_representation": [[575, 616], ["time.time", "GroundedScan.grammar.Derivation.from_str", "Derivation.from_str.meaning", "arguments.pop().to_predicate", "Derivation.from_str.words", "dataset.demonstrate_command", "dataset.fill_example", "dataset._data_pairs[].pop", "dataset.parse_example", "GroundedScan.world.Situation.from_representation", "time.time", "logger.info", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "translate_fn", "Derivation.from_str.words", "dataset.command_repr", "dataset.command_repr", "dataset.derivation_repr", "dataset.command_repr", "dataset._vocabulary.translate_word", "arguments.pop", "dataset._vocabulary.get_adverbs", "dataset._vocabulary.translate_word", "dataset._vocabulary.translate_word", "dataset._vocabulary.translate_word"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_str", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.to_predicate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.fill_example", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.parse_example", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.from_representation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.derivation_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word"], ["", "def", "test_example_representation", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test that when you save an example in its representation its the same if you parse it again.\"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "rules_str", "=", "\"NP -> NN,NP -> JJ NP,DP -> 'a' NP,VP -> VV_intrans 'to' DP,ROOT -> VP\"", "\n", "translate_fn", "=", "dataset", ".", "_vocabulary", ".", "translate_meaning", "\n", "lexicon_str", "=", "\"T:{},NT:VV_intransitive -> {},T:to,T:a,T:{},NT:JJ -> {},T:{},NT:NN -> {}\"", ".", "format", "(", "\n", "translate_fn", "(", "\"walk\"", ")", ",", "translate_fn", "(", "\"walk\"", ")", ",", "translate_fn", "(", "\"big\"", ")", ",", "translate_fn", "(", "\"big\"", ")", ",", "translate_fn", "(", "\"circle\"", ")", ",", "\n", "translate_fn", "(", "\"circle\"", ")", "\n", ")", "\n", "derivation", "=", "Derivation", ".", "from_str", "(", "rules_str", ",", "lexicon_str", ",", "dataset", ".", "_grammar", ")", "\n", "arguments", "=", "[", "]", "\n", "derivation", ".", "meaning", "(", "arguments", ")", "\n", "target_str", ",", "target_predicate", "=", "arguments", ".", "pop", "(", ")", ".", "to_predicate", "(", ")", "\n", "adverb", "=", "\"\"", "\n", "for", "word", "in", "derivation", ".", "words", "(", ")", ":", "\n", "        ", "if", "word", "in", "dataset", ".", "_vocabulary", ".", "get_adverbs", "(", ")", ":", "\n", "            ", "adverb", "=", "word", "\n", "", "", "target_commands", ",", "_", ",", "target_action", "=", "dataset", ".", "demonstrate_command", "(", "derivation", ",", "initial_situation", "=", "TEST_SITUATION_1", ")", "\n", "dataset", ".", "fill_example", "(", "derivation", ".", "words", "(", ")", ",", "derivation", ",", "TEST_SITUATION_1", ",", "target_commands", ",", "target_action", ",", "\n", "target_predicate", ",", "visualize", "=", "False", ",", "splits", "=", "[", "\"train\"", "]", ",", "adverb", "=", "adverb", ")", "\n", "example", "=", "dataset", ".", "_data_pairs", "[", "\"train\"", "]", ".", "pop", "(", ")", "\n", "(", "parsed_command", ",", "parsed_meaning", ",", "parsed_derivation", ",", "parsed_situation", ",", "\n", "parsed_target_commands", ",", "_", ",", "parsed_action", ")", "=", "dataset", ".", "parse_example", "(", "\n", "example", "\n", ")", "\n", "assert", "example", "[", "\"command\"", "]", "==", "dataset", ".", "command_repr", "(", "parsed_command", ")", ",", "\"test_example_representation FAILED.\"", "\n", "assert", "example", "[", "\"meaning\"", "]", "==", "dataset", ".", "command_repr", "(", "parsed_meaning", ")", ",", "\"test_example_representation FAILED.\"", "\n", "assert", "example", "[", "\"derivation\"", "]", "==", "dataset", ".", "derivation_repr", "(", "parsed_derivation", ")", ",", "\"test_example_representation \"", "\"FAILED.\"", "\n", "situation", "=", "Situation", ".", "from_representation", "(", "example", "[", "\"situation\"", "]", ")", "\n", "assert", "situation", "==", "parsed_situation", ",", "\"test_example_representation FAILED.\"", "\n", "assert", "example", "[", "\"target_commands\"", "]", "==", "dataset", ".", "command_repr", "(", "parsed_target_commands", ")", ",", "\"test_example_representation FAILED.\"", "\n", "assert", "example", "[", "\"verb_in_command\"", "]", "==", "dataset", ".", "_vocabulary", ".", "translate_word", "(", "parsed_action", ")", ",", "\"test_example_representation FAILED.\"", "\n", "assert", "example", "[", "\"referred_target\"", "]", "==", "' '", ".", "join", "(", "[", "dataset", ".", "_vocabulary", ".", "translate_word", "(", "target_predicate", "[", "\"size\"", "]", ")", ",", "\n", "dataset", ".", "_vocabulary", ".", "translate_word", "(", "target_predicate", "[", "\"color\"", "]", ")", ",", "\n", "dataset", ".", "_vocabulary", ".", "translate_word", "(", "target_predicate", "[", "\"noun\"", "]", ")", "]", ")", ",", "\"test_example_representation FAILED.\"", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_example_representation PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_initialize_world": [[618, 639], ["time.time", "dataset._world.get_current_situation", "enumerate", "dataset.initialize_world", "time.time", "logger.info", "enumerate", "dataset._world.clear_situation", "dataset.initialize_world", "dataset._world.get_current_situation", "dataset._world.clear_situation", "dataset.initialize_world", "dataset._world.get_current_situation"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation"], ["", "def", "test_initialize_world", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test that two the same situations get represented in exactly the same image by rendering.py and minigrid.py\"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "test_situations", "=", "[", "TEST_SITUATION_1", ",", "TEST_SITUATION_2", ",", "TEST_SITUATION_3", ",", "TEST_SITUATION_4", "]", "\n", "current_situation", "=", "dataset", ".", "_world", ".", "get_current_situation", "(", ")", "\n", "current_mission", "=", "dataset", ".", "_world", ".", "mission", "\n", "for", "i", ",", "test_situation_1", "in", "enumerate", "(", "test_situations", ")", ":", "\n", "        ", "for", "j", ",", "test_situation_2", "in", "enumerate", "(", "test_situations", ")", ":", "\n", "            ", "dataset", ".", "_world", ".", "clear_situation", "(", ")", "\n", "dataset", ".", "initialize_world", "(", "test_situation_1", ")", "\n", "situation_1", "=", "dataset", ".", "_world", ".", "get_current_situation", "(", ")", "\n", "dataset", ".", "_world", ".", "clear_situation", "(", ")", "\n", "dataset", ".", "initialize_world", "(", "test_situation_2", ")", "\n", "situation_2", "=", "dataset", ".", "_world", ".", "get_current_situation", "(", ")", "\n", "if", "i", "==", "j", ":", "\n", "                ", "assert", "situation_1", "==", "situation_2", ",", "\"test_initialize_world FAILED.\"", "\n", "", "else", ":", "\n", "                ", "assert", "situation_1", "!=", "situation_2", ",", "\"test_initialize_world FAILED.\"", "\n", "", "", "", "dataset", ".", "initialize_world", "(", "current_situation", ",", "mission", "=", "current_mission", ")", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_initialize_world PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_generate_manners": [[641, 681], ["GroundedScan.world.Situation", "GroundedScan.dataset.GroundedScan", "GroundedScan.dataset.GroundedScan._world.left_over_manners.keys", "len", "GroundedScan.dataset.GroundedScan._grammar.sample_constrained", "GroundedScan.dataset.GroundedScan.demonstrate_command", "dataset._grammar.sample_constrained.words", "GroundedScan.dataset.GroundedScan.visualize_command", "GroundedScan.world.Position", "GroundedScan.world.PositionedObject", "GroundedScan.world.PositionedObject", "GroundedScan.world.PositionedObject", "GroundedScan.world.Object", "GroundedScan.world.Position", "numpy.array", "GroundedScan.world.Object", "GroundedScan.world.Position", "numpy.array", "GroundedScan.world.Object", "GroundedScan.world.Position", "numpy.array"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample_constrained", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.visualize_command"], ["", "def", "test_generate_manners", "(", ")", ":", "\n", "    ", "intransitive_verbs", "=", "[", "\"walk\"", "]", "\n", "transitive_verbs", "=", "[", "\"push\"", ",", "\"pull\"", "]", "\n", "adverbs", "=", "[", "\"manner1\"", ",", "\"manner2\"", ",", "\"manner3\"", ",", "\n", "\"cautiously\"", ",", "\"while spinning\"", ",", "\"while zigzagging\"", ",", "\"hesitantly\"", "]", "\n", "nouns", "=", "[", "\"circle\"", ",", "\"cylinder\"", ",", "\"square\"", "]", "\n", "color_adjectives", "=", "[", "\"red\"", ",", "\"blue\"", ",", "\"green\"", ",", "\"yellow\"", "]", "\n", "size_adjectives", "=", "[", "\"big\"", ",", "\"small\"", "]", "\n", "situation", "=", "Situation", "(", "grid_size", "=", "6", ",", "agent_position", "=", "Position", "(", "row", "=", "1", ",", "column", "=", "2", ")", ",", "agent_direction", "=", "INT_TO_DIR", "[", "0", "]", ",", "\n", "target_object", "=", "PositionedObject", "(", "object", "=", "Object", "(", "size", "=", "2", ",", "color", "=", "'red'", ",", "shape", "=", "'circle'", ")", ",", "\n", "position", "=", "Position", "(", "row", "=", "4", ",", "column", "=", "2", ")", ",", "\n", "vector", "=", "np", ".", "array", "(", "[", "1", ",", "0", ",", "1", "]", ")", ")", ",", "\n", "placed_objects", "=", "[", "PositionedObject", "(", "object", "=", "Object", "(", "size", "=", "2", ",", "color", "=", "'red'", ",", "shape", "=", "'circle'", ")", ",", "\n", "position", "=", "Position", "(", "row", "=", "4", ",", "column", "=", "2", ")", ",", "\n", "vector", "=", "np", ".", "array", "(", "[", "1", ",", "0", ",", "1", "]", ")", ")", ",", "\n", "PositionedObject", "(", "object", "=", "Object", "(", "size", "=", "4", ",", "color", "=", "'green'", ",", "shape", "=", "'circle'", ")", ",", "\n", "position", "=", "Position", "(", "row", "=", "5", ",", "column", "=", "5", ")", ",", "\n", "vector", "=", "np", ".", "array", "(", "[", "0", ",", "1", ",", "0", "]", ")", ")", "]", ",", "carrying", "=", "None", ")", "\n", "dataset", "=", "GroundedScan", "(", "intransitive_verbs", "=", "intransitive_verbs", ",", "\n", "transitive_verbs", "=", "transitive_verbs", ",", "\n", "adverbs", "=", "adverbs", ",", "nouns", "=", "nouns", ",", "\n", "color_adjectives", "=", "color_adjectives", ",", "\n", "size_adjectives", "=", "size_adjectives", ",", "percentage_train", "=", "0.8", ",", "\n", "min_object_size", "=", "1", ",", "max_object_size", "=", "4", ",", "sample_vocabulary", "=", "'default'", ",", "\n", "save_directory", "=", "TEST_DIRECTORY", ",", "grid_size", "=", "6", ",", "type_grammar", "=", "\"adverb\"", ")", "\n", "generated_manners", "=", "dataset", ".", "_world", ".", "left_over_manners", ".", "keys", "(", ")", "\n", "assert", "len", "(", "generated_manners", ")", "==", "3", ",", "\"test_generate_manners() FAILED.\"", "\n", "for", "extra_manner", "in", "adverbs", "[", ":", "3", "]", ":", "\n", "        ", "deriv", "=", "dataset", ".", "_grammar", ".", "sample_constrained", "(", "lexical_rule", "=", "\"RB -> {}\"", ".", "format", "(", "extra_manner", ")", ")", "\n", "target_commands_1", ",", "target_demonstration_1", ",", "action_1", "=", "dataset", ".", "demonstrate_command", "(", "\n", "deriv", ",", "initial_situation", "=", "situation", ")", "\n", "command", "=", "deriv", ".", "words", "(", ")", "\n", "meaning", "=", "command", "\n", "manner", "=", "dataset", ".", "_world", ".", "left_over_manners", "[", "extra_manner", "]", "\n", "mission", "=", "' '", ".", "join", "(", "[", "\"Command:\"", ",", "' '", ".", "join", "(", "command", ")", ",", "\"\\nMeaning: \"", ",", "' '", ".", "join", "(", "meaning", ")", ",", "\"\\nManner: \"", ",", "\n", "' '", ".", "join", "(", "manner", ")", ",", "\n", "\"\\nTarget:\"", "]", "+", "target_commands_1", ")", "\n", "save_dir", "=", "dataset", ".", "visualize_command", "(", "situation", ",", "command", ",", "target_demonstration_1", ",", "\n", "mission", "=", "mission", ")", "\n", "", "return", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_image_representation_situations": [[683, 716], ["time.time", "dataset._world.get_current_situation", "enumerate", "os.remove", "os.remove", "dataset.initialize_world", "time.time", "logger.info", "enumerate", "os.path.join", "os.path.join", "dataset._world.clear_situation", "dataset.initialize_world", "dataset._world.render().getArray", "GroundedScan.helpers.numpy_array_to_image", "GroundedScan.helpers.image_to_numpy_array", "numpy.array_equal", "dataset._world.clear_situation", "dataset.initialize_world", "dataset._world.render().getArray", "GroundedScan.helpers.numpy_array_to_image", "GroundedScan.helpers.image_to_numpy_array", "numpy.array_equal", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "numpy.array_equal", "dataset._world.render", "dataset._world.render", "numpy.array_equal"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.getArray", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.numpy_array_to_image", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.image_to_numpy_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.getArray", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.numpy_array_to_image", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.image_to_numpy_array", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.render", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.render"], ["", "def", "test_image_representation_situations", "(", "dataset", ")", ":", "\n", "    ", "\"\"\"Test that situations are still the same when they need to be in image / numpy RGB array form.\"\"\"", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "current_situation", "=", "dataset", ".", "_world", ".", "get_current_situation", "(", ")", "\n", "current_mission", "=", "dataset", ".", "_world", ".", "mission", "\n", "test_situations", "=", "[", "TEST_SITUATION_1", ",", "TEST_SITUATION_2", ",", "TEST_SITUATION_3", ",", "TEST_SITUATION_4", "]", "\n", "for", "i", ",", "test_situation_1", "in", "enumerate", "(", "test_situations", ")", ":", "\n", "        ", "for", "j", ",", "test_situation_2", "in", "enumerate", "(", "test_situations", ")", ":", "\n", "            ", "dataset", ".", "_world", ".", "clear_situation", "(", ")", "\n", "dataset", ".", "initialize_world", "(", "test_situation_1", ")", "\n", "np_situation_image_1", "=", "dataset", ".", "_world", ".", "render", "(", "mode", "=", "'human'", ")", ".", "getArray", "(", ")", "\n", "numpy_array_to_image", "(", "np_situation_image_1", ",", "os", ".", "path", ".", "join", "(", "TEST_DIRECTORY", ",", "\"test_im_1.png\"", ")", ")", "\n", "np_situation_image_1_reread", "=", "image_to_numpy_array", "(", "os", ".", "path", ".", "join", "(", "TEST_DIRECTORY", ",", "\"test_im_1.png\"", ")", ")", "\n", "assert", "np", ".", "array_equal", "(", "np_situation_image_1", ",", "\n", "np_situation_image_1_reread", ")", ",", "\"test_image_representation_situations FAILED.\"", "\n", "dataset", ".", "_world", ".", "clear_situation", "(", ")", "\n", "dataset", ".", "initialize_world", "(", "test_situation_2", ")", "\n", "np_situation_image_2", "=", "dataset", ".", "_world", ".", "render", "(", ")", ".", "getArray", "(", ")", "\n", "numpy_array_to_image", "(", "np_situation_image_2", ",", "os", ".", "path", ".", "join", "(", "TEST_DIRECTORY", ",", "\"test_im_2.png\"", ")", ")", "\n", "np_situation_image_2_reread", "=", "image_to_numpy_array", "(", "os", ".", "path", ".", "join", "(", "TEST_DIRECTORY", ",", "\"test_im_2.png\"", ")", ")", "\n", "assert", "np", ".", "array_equal", "(", "np_situation_image_2", ",", "\n", "np_situation_image_2_reread", ")", ",", "\"test_image_representation_situations FAILED.\"", "\n", "if", "i", "==", "j", ":", "\n", "                ", "assert", "np", ".", "array_equal", "(", "np_situation_image_1", ",", "np_situation_image_2", ")", ",", "\"test_image_representation_situations FAILED.\"", "\n", "", "else", ":", "\n", "                ", "assert", "not", "np", ".", "array_equal", "(", "np_situation_image_1", ",", "np_situation_image_2", ")", ",", "\"test_image_representation_situations FAILED.\"", "\n", "", "", "", "os", ".", "remove", "(", "os", ".", "path", ".", "join", "(", "TEST_DIRECTORY", ",", "\"test_im_1.png\"", ")", ")", "\n", "os", ".", "remove", "(", "os", ".", "path", ".", "join", "(", "TEST_DIRECTORY", ",", "\"test_im_2.png\"", ")", ")", "\n", "dataset", ".", "initialize_world", "(", "current_situation", ",", "mission", "=", "current_mission", ")", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_image_representation_situations PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_encode_situation": [[718, 746], ["time.time", "dataset._world.get_current_situation", "GroundedScan.world.Situation", "dataset._world.clear_situation", "dataset.initialize_world", "numpy.zeros", "numpy.array", "dataset._object_vocabulary.get_object_vector", "dataset._object_vocabulary.get_object_vector", "dataset._world.grid.encode", "numpy.array_equal", "dataset.initialize_world", "time.time", "logger.info", "GroundedScan.world.Position", "GroundedScan.world.PositionedObject", "GroundedScan.world.PositionedObject", "GroundedScan.world.PositionedObject", "GroundedScan.world.Object", "GroundedScan.world.Position", "numpy.array", "GroundedScan.world.Object", "GroundedScan.world.Position", "numpy.array", "GroundedScan.world.Object", "GroundedScan.world.Position", "numpy.array"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.get_object_vector", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.get_object_vector", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.encode", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world"], ["", "def", "test_encode_situation", "(", "dataset", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "current_situation", "=", "dataset", ".", "_world", ".", "get_current_situation", "(", ")", "\n", "current_mission", "=", "dataset", ".", "_world", ".", "mission", "\n", "test_situation", "=", "Situation", "(", "grid_size", "=", "15", ",", "agent_position", "=", "Position", "(", "row", "=", "7", ",", "column", "=", "2", ")", ",", "agent_direction", "=", "INT_TO_DIR", "[", "0", "]", ",", "\n", "target_object", "=", "PositionedObject", "(", "object", "=", "Object", "(", "size", "=", "2", ",", "color", "=", "'red'", ",", "shape", "=", "'circle'", ")", ",", "\n", "position", "=", "Position", "(", "row", "=", "7", ",", "column", "=", "2", ")", ",", "\n", "vector", "=", "np", ".", "array", "(", "[", "1", ",", "0", ",", "1", "]", ")", ")", ",", "\n", "placed_objects", "=", "[", "PositionedObject", "(", "object", "=", "Object", "(", "size", "=", "2", ",", "color", "=", "'red'", ",", "shape", "=", "'circle'", ")", ",", "\n", "position", "=", "Position", "(", "row", "=", "7", ",", "column", "=", "2", ")", ",", "\n", "vector", "=", "np", ".", "array", "(", "[", "1", ",", "0", ",", "1", "]", ")", ")", ",", "\n", "PositionedObject", "(", "object", "=", "Object", "(", "size", "=", "4", ",", "color", "=", "'green'", ",", "shape", "=", "'circle'", ")", ",", "\n", "position", "=", "Position", "(", "row", "=", "3", ",", "column", "=", "12", ")", ",", "\n", "vector", "=", "np", ".", "array", "(", "[", "0", ",", "1", ",", "0", "]", ")", ")", "]", ",", "carrying", "=", "None", ")", "\n", "dataset", ".", "_world", ".", "clear_situation", "(", ")", "\n", "dataset", ".", "initialize_world", "(", "test_situation", ")", "\n", "expected_numpy_array", "=", "np", ".", "zeros", "(", "[", "15", ",", "15", ",", "dataset", ".", "_world", ".", "grid", ".", "_num_attributes_object", "+", "1", "+", "4", "]", ",", "dtype", "=", "'uint8'", ")", "\n", "expected_numpy_array", "[", "7", ",", "2", ",", "-", "5", "]", "=", "1", "\n", "expected_numpy_array", "[", "7", ",", "2", ",", "-", "4", ":", "]", "=", "np", ".", "array", "(", "[", "1", ",", "0", ",", "0", ",", "0", "]", ")", "\n", "expected_numpy_array", "[", "7", ",", "2", ",", ":", "-", "5", "]", "=", "dataset", ".", "_object_vocabulary", ".", "get_object_vector", "(", "shape", "=", "'circle'", ",", "color", "=", "'red'", ",", "\n", "size", "=", "2", ")", "\n", "expected_numpy_array", "[", "3", ",", "12", ",", ":", "-", "5", "]", "=", "dataset", ".", "_object_vocabulary", ".", "get_object_vector", "(", "shape", "=", "'circle'", ",", "color", "=", "'green'", ",", "\n", "size", "=", "4", ")", "\n", "encoded_numpy_array", "=", "dataset", ".", "_world", ".", "grid", ".", "encode", "(", "agent_row", "=", "7", ",", "agent_column", "=", "2", ",", "agent_direction", "=", "0", ")", "\n", "assert", "np", ".", "array_equal", "(", "expected_numpy_array", ",", "encoded_numpy_array", ")", ",", "\"test_encode_situation FAILED.\"", "\n", "dataset", ".", "initialize_world", "(", "current_situation", ",", "mission", "=", "current_mission", ")", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_encode_situation PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_k_shot_generalization": [[748, 807], ["time.time", "dataset._world.get_current_situation", "dataset.get_data_pairs", "examples_per_split.items", "dataset.initialize_world", "time.time", "logger.info", "dataset._vocabulary.translate_meaning", "dataset._vocabulary.get_transitive_verbs", "dataset._vocabulary.translate_meaning", "dataset._vocabulary.get_transitive_verbs"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_data_pairs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_transitive_verbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_transitive_verbs"], ["", "def", "test_k_shot_generalization", "(", "dataset", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "current_situation", "=", "dataset", ".", "_world", ".", "get_current_situation", "(", ")", "\n", "current_mission", "=", "dataset", ".", "_world", ".", "mission", "\n", "k_shot_generalization", "=", "5", "\n", "dataset", ".", "get_data_pairs", "(", "max_examples", "=", "100000", ",", "num_resampling", "=", "1", ",", "other_objects_sample_percentage", "=", "0.5", ",", "\n", "split_type", "=", "\"generalization\"", ",", "k_shot_generalization", "=", "k_shot_generalization", ")", "\n", "# Test that all the splits only contain examples related to their split.", "\n", "visual_split_examples", "=", "dataset", ".", "_data_pairs", "[", "\"visual\"", "]", "\n", "for", "example", "in", "visual_split_examples", ":", "\n", "        ", "target_object", "=", "example", "[", "\"situation\"", "]", "[", "\"target_object\"", "]", "[", "\"object\"", "]", "\n", "assert", "target_object", "[", "\"shape\"", "]", "==", "\"square\"", "and", "target_object", "[", "\"color\"", "]", "==", "\"red\"", ",", "\"test_k_shot_generalization FAILED in split visual.\"", "\n", "", "situational_split_1", "=", "dataset", ".", "_data_pairs", "[", "\"situational_1\"", "]", "\n", "for", "example", "in", "situational_split_1", ":", "\n", "        ", "direction_to_target", "=", "example", "[", "\"situation\"", "]", "[", "\"direction_to_target\"", "]", "\n", "assert", "direction_to_target", "==", "\"sw\"", ",", "\"test_k_shot_generalization FAILED in split situational_1.\"", "\n", "", "situational_split_2", "=", "dataset", ".", "_data_pairs", "[", "\"situational_2\"", "]", "\n", "for", "example", "in", "situational_split_2", ":", "\n", "        ", "referred_target", "=", "example", "[", "\"referred_target\"", "]", "\n", "assert", "\"small\"", "in", "referred_target", ",", "\"test_k_shot_generalization FAILED in split situational_2.\"", "\n", "target_size", "=", "example", "[", "\"situation\"", "]", "[", "\"target_object\"", "]", "[", "\"object\"", "]", "[", "\"size\"", "]", "\n", "assert", "target_size", "==", "'2'", ",", "\"test_k_shot_generalization FAILED in split situational_2.\"", "\n", "", "contextual_split", "=", "dataset", ".", "_data_pairs", "[", "\"contextual\"", "]", "\n", "for", "example", "in", "contextual_split", ":", "\n", "        ", "assert", "(", "dataset", ".", "_vocabulary", ".", "translate_meaning", "(", "example", "[", "\"verb_in_command\"", "]", ")", "\n", "in", "dataset", ".", "_vocabulary", ".", "get_transitive_verbs", "(", ")", ")", ",", "\"test_k_shot_generalization FAILED in split contextual.\"", "\n", "target_object", "=", "example", "[", "\"situation\"", "]", "[", "\"target_object\"", "]", "[", "\"object\"", "]", "\n", "assert", "target_object", "[", "\"shape\"", "]", "==", "\"square\"", "and", "target_object", "[", "\"size\"", "]", "==", "'3'", ",", "\"test_k_shot_generalization FAILED in split contextual.\"", "\n", "\n", "# Test that the training set doesn't contain more than k examples of each of the test splits.", "\n", "", "examples_per_split", "=", "{", "\"visual\"", ":", "0", ",", "\"situational_1\"", ":", "0", ",", "\"situational_2\"", ":", "0", ",", "\"contextual\"", ":", "0", ",", "\"adverb_1\"", ":", "0", "}", "\n", "for", "example", "in", "dataset", ".", "_data_pairs", "[", "\"train\"", "]", ":", "\n", "        ", "target_object", "=", "example", "[", "\"situation\"", "]", "[", "\"target_object\"", "]", "[", "\"object\"", "]", "\n", "target_size", "=", "target_object", "[", "\"size\"", "]", "\n", "direction_to_target", "=", "example", "[", "\"situation\"", "]", "[", "\"direction_to_target\"", "]", "\n", "referred_target", "=", "example", "[", "\"referred_target\"", "]", "\n", "if", "target_object", "[", "\"shape\"", "]", "==", "\"square\"", "and", "target_object", "[", "\"color\"", "]", "==", "\"red\"", ":", "\n", "            ", "examples_per_split", "[", "\"visual\"", "]", "+=", "1", "\n", "", "if", "direction_to_target", "==", "\"sw\"", ":", "\n", "            ", "examples_per_split", "[", "\"situational_1\"", "]", "+=", "1", "\n", "", "if", "\"small\"", "in", "referred_target", "and", "target_size", "==", "2", ":", "\n", "            ", "examples_per_split", "[", "\"situational_2\"", "]", "+=", "1", "\n", "", "if", "(", "dataset", ".", "_vocabulary", ".", "translate_meaning", "(", "example", "[", "\"verb_in_command\"", "]", ")", "in", "\n", "dataset", ".", "_vocabulary", ".", "get_transitive_verbs", "(", ")", "and", "\n", "target_object", "[", "\"shape\"", "]", "==", "\"square\"", "and", "target_object", "[", "\"size\"", "]", "==", "'3'", ")", ":", "\n", "            ", "examples_per_split", "[", "\"contextual\"", "]", "+=", "1", "\n", "", "", "for", "split", ",", "examples_count", "in", "examples_per_split", ".", "items", "(", ")", ":", "\n", "        ", "if", "split", "==", "\"adverb_1\"", ":", "\n", "            ", "assert", "examples_count", "==", "k_shot_generalization", ",", "\"test_k_shot_generalization FAILED in split train for split {}.\"", ".", "format", "(", "split", ")", "\n", "", "else", ":", "\n", "            ", "assert", "examples_count", "==", "0", ",", "\"test_k_shot_generalization FAILED in split train for split {}.\"", ".", "format", "(", "split", ")", "\n", "", "", "dataset", ".", "initialize_world", "(", "current_situation", ",", "mission", "=", "current_mission", ")", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_k_shot_generalization PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_apply_while_spinning": [[809, 862], ["time.time", "GroundedScan.MetaGrammar", "GroundedScan.LSystem", "dsl.LSystem.add_rule", "dsl.LSystem.add_rule", "dsl.LSystem.add_rule", "dsl.LSystem.finish_l_system", "GroundedScan.apply_recursion", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "time.time", "logger.info", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "str", "str", "str", "str"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_recursion", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule"], ["", "def", "test_apply_while_spinning", "(", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "meta_grammar", "=", "dsl", ".", "MetaGrammar", "(", ")", "\n", "while_spinning", "=", "dsl", ".", "LSystem", "(", ")", "\n", "while_spinning", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"Walk\"", ",", "\n", "rhs_str", "=", "\"ACTION Walk\"", ")", ")", "\n", "while_spinning", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"ACTION\"", ",", "\n", "rhs_str", "=", "\"Tl\"", ")", ",", "\n", "terminal_rule", "=", "True", ")", "\n", "while_spinning", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"Push\"", ",", "\n", "rhs_str", "=", "\"ACTION Push\"", ")", ")", "\n", "while_spinning", ".", "finish_l_system", "(", ")", "\n", "\n", "while_spinning_2", "=", "dsl", ".", "apply_recursion", "(", "while_spinning", ",", "max_recursion", "=", "4", ")", "\n", "\n", "# First sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "EMPTY", ",", "dsl", ".", "Walk", ",", "dsl", ".", "Tl", ",", "dsl", ".", "Walk", ",", "dsl", ".", "EMPTY", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "while_spinning_2", ",", "0", ",", "1", ")", "\n", "expected_str_sequence", "=", "\"Tl Tl Tl Tl Walk Tl Tl Tl Tl Tl Walk\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_while_spinning FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "# Second sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "EMPTY", ",", "dsl", ".", "Push", ",", "dsl", ".", "Tl", ",", "dsl", ".", "Walk", ",", "dsl", ".", "EMPTY", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "while_spinning", ",", "0", ",", "4", ")", "\n", "expected_str_sequence", "=", "\"Tl Tl Tl Tl Push Tl Tl Tl Tl Tl Walk\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_while_spinning FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "# Third sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "EMPTY", ",", "dsl", ".", "Tl", ",", "dsl", ".", "Stay", ",", "dsl", ".", "EMPTY", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "while_spinning_2", ",", "0", ",", "1", ")", "\n", "expected_str_sequence", "=", "\"Tl Stay\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_while_spinning FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "# Fourth sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "EMPTY", ",", "dsl", ".", "Tl", ",", "dsl", ".", "Tr", ",", "dsl", ".", "Walk", ",", "dsl", ".", "Push", ",", "dsl", ".", "Push", ",", "dsl", ".", "EMPTY", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "while_spinning", ",", "0", ",", "4", ")", "\n", "expected_str_sequence", "=", "\"Tl Tr Tl Tl Tl Tl Walk Tl Tl Tl Tl Push Tl Tl Tl Tl Push\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_while_spinning FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_apply_while_spinning PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_apply_cautiously": [[864, 920], ["time.time", "GroundedScan.MetaGrammar", "GroundedScan.LSystem", "dsl.LSystem.add_rule", "dsl.LSystem.add_rule", "dsl.LSystem.add_rule", "dsl.LSystem.add_rule", "dsl.LSystem.finish_l_system", "GroundedScan.apply_recursion", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "time.time", "logger.info", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "str", "str", "str", "str"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_recursion", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule"], ["", "def", "test_apply_cautiously", "(", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "meta_grammar", "=", "dsl", ".", "MetaGrammar", "(", ")", "\n", "cautiously", "=", "dsl", ".", "LSystem", "(", ")", "\n", "cautiously", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"Walk\"", ",", "\n", "rhs_str", "=", "\"ACTION Walk\"", ")", ")", "\n", "cautiously", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"Push\"", ",", "\n", "rhs_str", "=", "\"ACTION Push\"", ")", ")", "\n", "cautiously", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"{ACTION}ACTION ACTION{ACTION}\"", ",", "\n", "rhs_str", "=", "\"Tl Tl\"", ")", ",", "\n", "terminal_rule", "=", "True", ")", "\n", "cautiously", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"ACTION\"", ",", "\n", "rhs_str", "=", "\"Tr\"", ")", ",", "\n", "terminal_rule", "=", "True", ")", "\n", "cautiously", ".", "finish_l_system", "(", ")", "\n", "\n", "cautiously_2", "=", "dsl", ".", "apply_recursion", "(", "cautiously", ",", "max_recursion", "=", "4", ")", "\n", "\n", "# First sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "EMPTY", ",", "dsl", ".", "Walk", ",", "dsl", ".", "Tl", ",", "dsl", ".", "Walk", ",", "dsl", ".", "EMPTY", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "cautiously_2", ",", "0", ",", "1", ")", "\n", "expected_str_sequence", "=", "\"Tr Tl Tl Tr Walk Tl Tr Tl Tl Tr Walk\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_cautiously FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "# Second sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "Tl", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "cautiously", ",", "0", ",", "4", ")", "\n", "expected_str_sequence", "=", "\"Tl\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_cautiously FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "# Third sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "EMPTY", ",", "dsl", ".", "Push", ",", "dsl", ".", "Tr", ",", "dsl", ".", "Tr", ",", "dsl", ".", "Push", ",", "dsl", ".", "EMPTY", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "cautiously_2", ",", "0", ",", "1", ")", "\n", "expected_str_sequence", "=", "\"Tr Tl Tl Tr Push Tr Tr Tr Tl Tl Tr Push\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_cautiously FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "# Fourth sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "EMPTY", ",", "dsl", ".", "Walk", ",", "dsl", ".", "EMPTY", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "cautiously", ",", "0", ",", "4", ")", "\n", "expected_str_sequence", "=", "\"Tr Tl Tl Tr Walk\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_cautiously FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_apply_cautiously PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_apply_hesitantly": [[922, 984], ["time.time", "GroundedScan.MetaGrammar", "GroundedScan.LSystem", "dsl.LSystem.add_rule", "dsl.LSystem.add_rule", "dsl.LSystem.add_rule", "dsl.LSystem.finish_l_system", "GroundedScan.apply_recursion", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "time.time", "logger.info", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "str", "str", "str", "str", "str"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_recursion", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule"], ["", "def", "test_apply_hesitantly", "(", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "meta_grammar", "=", "dsl", ".", "MetaGrammar", "(", ")", "\n", "hesitantly", "=", "dsl", ".", "LSystem", "(", ")", "\n", "hesitantly", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"Walk\"", ",", "\n", "rhs_str", "=", "\"Walk ACTION\"", ")", ")", "\n", "hesitantly", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"Push\"", ",", "\n", "rhs_str", "=", "\"Push ACTION\"", ")", ")", "\n", "hesitantly", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"ACTION\"", ",", "\n", "rhs_str", "=", "\"Stay\"", ")", ",", "\n", "terminal_rule", "=", "True", ")", "\n", "hesitantly", ".", "finish_l_system", "(", ")", "\n", "\n", "hesitantly_2", "=", "dsl", ".", "apply_recursion", "(", "hesitantly", ",", "max_recursion", "=", "1", ")", "\n", "\n", "# First sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "EMPTY", ",", "dsl", ".", "Walk", ",", "dsl", ".", "Tl", ",", "dsl", ".", "Walk", ",", "dsl", ".", "EMPTY", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "hesitantly", ",", "0", ",", "1", ")", "\n", "expected_str_sequence", "=", "\"Walk Stay Tl Walk Stay\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_hesitantly FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "# Second sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "EMPTY", ",", "dsl", ".", "Tl", ",", "dsl", ".", "Walk", ",", "dsl", ".", "Walk", ",", "dsl", ".", "EMPTY", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "hesitantly_2", ",", "0", ",", "1", ")", "\n", "expected_str_sequence", "=", "\"Tl Walk Stay Walk Stay\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_hesitantly FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "# Third sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "EMPTY", ",", "dsl", ".", "Tl", ",", "dsl", ".", "EMPTY", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "hesitantly", ",", "0", ",", "1", ")", "\n", "expected_str_sequence", "=", "\"Tl\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_hesitantly FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "# Third sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "EMPTY", ",", "dsl", ".", "Push", ",", "dsl", ".", "Walk", ",", "dsl", ".", "EMPTY", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "hesitantly_2", ",", "0", ",", "1", ")", "\n", "expected_str_sequence", "=", "\"Push Stay Walk Stay\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_hesitantly FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "# Fourth sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "EMPTY", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "hesitantly", ",", "0", ",", "1", ")", "\n", "expected_str_sequence", "=", "\"\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_hesitantly FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_apply_hesitantly PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_apply_while_zigzagging": [[986, 1062], ["time.time", "GroundedScan.MetaGrammar", "GroundedScan.LSystem", "dsl.LSystem.add_rule", "dsl.LSystem.add_rule", "dsl.LSystem.add_rule", "dsl.LSystem.add_rule", "dsl.LSystem.finish_l_system", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.apply_lsystem", "str", "time.time", "logger.info", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "str", "str", "str", "str", "str", "str"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule"], ["", "def", "test_apply_while_zigzagging", "(", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "meta_grammar", "=", "dsl", ".", "MetaGrammar", "(", ")", "\n", "while_zigzagging", "=", "dsl", ".", "LSystem", "(", ")", "\n", "while_zigzagging", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"East South\"", ",", "\n", "rhs_str", "=", "\"South East\"", ")", ")", "\n", "while_zigzagging", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"East North\"", ",", "\n", "rhs_str", "=", "\"North East\"", ")", ")", "\n", "while_zigzagging", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"West North\"", ",", "\n", "rhs_str", "=", "\"North West\"", ")", ")", "\n", "while_zigzagging", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"West South\"", ",", "\n", "rhs_str", "=", "\"South West\"", ")", ")", "\n", "while_zigzagging", ".", "finish_l_system", "(", ")", "\n", "\n", "# First sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "# 3 cols, 2 rows", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "East", ",", "dsl", ".", "East", ",", "dsl", ".", "East", ",", "dsl", ".", "South", ",", "dsl", ".", "South", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "while_zigzagging", ",", "0", ",", "2", ")", "\n", "expected_str_sequence", "=", "\"East South East South East\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_while_zigzagging FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "# Second sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "# 5 cols, 2 rows", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "East", ",", "dsl", ".", "East", ",", "dsl", ".", "East", ",", "dsl", ".", "East", ",", "dsl", ".", "East", ",", "dsl", ".", "South", ",", "dsl", ".", "South", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "while_zigzagging", ",", "0", ",", "4", ")", "\n", "expected_str_sequence", "=", "\"East South East South East East East\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_while_zigzagging FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "# Third sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "# 2 cols, 5 rows", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "East", ",", "dsl", ".", "East", ",", "dsl", ".", "South", ",", "dsl", ".", "South", ",", "dsl", ".", "South", ",", "dsl", ".", "South", ",", "dsl", ".", "South", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "while_zigzagging", ",", "0", ",", "1", ")", "\n", "expected_str_sequence", "=", "\"East South East South South South South\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_while_zigzagging FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "# Fourth sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "# 2 cols, 5 rows", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "West", ",", "dsl", ".", "West", ",", "dsl", ".", "South", ",", "dsl", ".", "South", ",", "dsl", ".", "South", ",", "dsl", ".", "South", ",", "dsl", ".", "South", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "while_zigzagging", ",", "0", ",", "1", ")", "\n", "expected_str_sequence", "=", "\"West South West South South South South\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_while_zigzagging FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "# Fifth sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "# 3 cols", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "West", ",", "dsl", ".", "West", ",", "dsl", ".", "West", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "while_zigzagging", ",", "0", ",", "4", ")", "\n", "expected_str_sequence", "=", "\"West West West\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_while_zigzagging FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "# Sixt sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "# 3 cols, 2 rows", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "West", ",", "dsl", ".", "West", ",", "dsl", ".", "West", ",", "dsl", ".", "North", ",", "dsl", ".", "North", "]", ")", "\n", "dsl", ".", "apply_lsystem", "(", "sequence", ",", "while_zigzagging", ",", "0", ",", "2", ")", "\n", "expected_str_sequence", "=", "\"West North West North West\"", "\n", "actual_str_sequence", "=", "str", "(", "sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_apply_while_zigzagging FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "str", "(", "sequence", ")", ")", "\n", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_apply_while_zigzagging PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_convert_sequence_to_actions": [[1064, 1129], ["time.time", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.convert_sequence_to_actions", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.convert_sequence_to_actions", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.convert_sequence_to_actions", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.convert_sequence_to_actions", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.convert_sequence_to_actions", "str", "GroundedScan.Sequence", "dsl.Sequence.extend", "GroundedScan.convert_sequence_to_actions", "str", "time.time", "logger.info"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.convert_sequence_to_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.convert_sequence_to_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.convert_sequence_to_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.convert_sequence_to_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.convert_sequence_to_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.convert_sequence_to_actions"], ["", "def", "test_convert_sequence_to_actions", "(", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "\n", "# First sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "East", ",", "dsl", ".", "East", ",", "dsl", ".", "East", ",", "dsl", ".", "South", ",", "dsl", ".", "South", "]", ")", "\n", "actual_sequence", "=", "dsl", ".", "convert_sequence_to_actions", "(", "sequence", ",", "agent_start_dir", "=", "dsl", ".", "NORTH", ")", "\n", "expected_str_sequence", "=", "\"Tr Walk Walk Walk Tr Walk Walk\"", "\n", "actual_str_sequence", "=", "str", "(", "actual_sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_convert_sequence_to_actions FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "expected_str_sequence", ",", "\n", "actual_str_sequence", ")", "\n", "\n", "# Second sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "East", ",", "dsl", ".", "South", ",", "dsl", ".", "East", ",", "dsl", ".", "South", ",", "dsl", ".", "South", "]", ")", "\n", "actual_sequence", "=", "dsl", ".", "convert_sequence_to_actions", "(", "sequence", ",", "agent_start_dir", "=", "dsl", ".", "WEST", ")", "\n", "expected_str_sequence", "=", "\"Tl Tl Walk Tr Walk Tl Walk Tr Walk Walk\"", "\n", "actual_str_sequence", "=", "str", "(", "actual_sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_convert_sequence_to_actions FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "\n", "expected_str_sequence", ",", "actual_str_sequence", ")", "\n", "\n", "# Third sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "South", ",", "dsl", ".", "South", ",", "dsl", ".", "East", ",", "dsl", ".", "South", ",", "dsl", ".", "South", "]", ")", "\n", "actual_sequence", "=", "dsl", ".", "convert_sequence_to_actions", "(", "sequence", ",", "agent_start_dir", "=", "dsl", ".", "WEST", ")", "\n", "expected_str_sequence", "=", "\"Tl Walk Walk Tl Walk Tr Walk Walk\"", "\n", "actual_str_sequence", "=", "str", "(", "actual_sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_convert_sequence_to_actions FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "\n", "expected_str_sequence", ",", "actual_str_sequence", ")", "\n", "\n", "# Fourth sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "North", ",", "dsl", ".", "South", ",", "dsl", ".", "North", "]", ")", "\n", "actual_sequence", "=", "dsl", ".", "convert_sequence_to_actions", "(", "sequence", ",", "agent_start_dir", "=", "dsl", ".", "SOUTH", ")", "\n", "expected_str_sequence", "=", "\"Tl Tl Walk Tl Tl Walk Tl Tl Walk\"", "\n", "actual_str_sequence", "=", "str", "(", "actual_sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_convert_sequence_to_actions FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "\n", "expected_str_sequence", ",", "actual_str_sequence", ")", "\n", "\n", "# Fifth sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "West", ",", "dsl", ".", "North", ",", "dsl", ".", "North", ",", "dsl", ".", "West", "]", ")", "\n", "actual_sequence", "=", "dsl", ".", "convert_sequence_to_actions", "(", "sequence", ",", "agent_start_dir", "=", "dsl", ".", "SOUTH", ")", "\n", "expected_str_sequence", "=", "\"Tr Walk Tr Walk Walk Tl Walk\"", "\n", "actual_str_sequence", "=", "str", "(", "actual_sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_convert_sequence_to_actions FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "\n", "expected_str_sequence", ",", "actual_str_sequence", ")", "\n", "\n", "# Sixth sequence", "\n", "sequence", "=", "dsl", ".", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "[", "dsl", ".", "West", ",", "dsl", ".", "West", ",", "dsl", ".", "West", "]", ")", "\n", "actual_sequence", "=", "dsl", ".", "convert_sequence_to_actions", "(", "sequence", ",", "agent_start_dir", "=", "dsl", ".", "WEST", ")", "\n", "expected_str_sequence", "=", "\"Walk Walk Walk\"", "\n", "actual_str_sequence", "=", "str", "(", "actual_sequence", ")", "\n", "assert", "actual_str_sequence", "==", "expected_str_sequence", ",", "\"test_convert_sequence_to_actions FAILED for \\nexpected %s \\nactual: %s\"", "%", "(", "\n", "expected_str_sequence", ",", "actual_str_sequence", ")", "\n", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_convert_sequence_to_actions PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_dsl_gscan": [[1131, 1194], ["time.time", "start_positions.extend", "end_positions.copy", "start_directions.copy", "random.shuffle", "random.shuffle", "start_positions.extend", "end_positions.extend", "random.shuffle", "end_positions.extend", "start_directions.extend", "start_directions.extend", "GroundedScan.Gscan", "enumerate", "time.time", "logger.info", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.Position", "reversed", "zip", "GroundedScan.simulate_planner", "abs", "random.randint", "GroundedScan.convert_sequence_to_actions", "dsl.convert_sequence_to_actions.get_gscan_actions", "dataset.demonstrate_target_commands", "dsl.Gscan.zigzag"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.simulate_planner", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.abs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.convert_sequence_to_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_gscan_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_target_commands", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.zigzag"], ["", "def", "test_dsl_gscan", "(", "dataset", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "\n", "original_start_pos", "=", "TEST_SITUATION_1", ".", "agent_pos", "\n", "original_start_dir", "=", "TEST_SITUATION_1", ".", "agent_direction", "\n", "\n", "start_positions", "=", "[", "dsl", ".", "Position", "(", "row", "=", "5", ",", "column", "=", "3", ")", ",", "dsl", ".", "Position", "(", "row", "=", "0", ",", "column", "=", "3", ")", ",", "\n", "dsl", ".", "Position", "(", "row", "=", "7", ",", "column", "=", "7", ")", ",", "dsl", ".", "Position", "(", "row", "=", "13", ",", "column", "=", "7", ")", ",", "\n", "dsl", ".", "Position", "(", "row", "=", "14", ",", "column", "=", "13", ")", ",", "dsl", ".", "Position", "(", "row", "=", "0", ",", "column", "=", "0", ")", ",", "\n", "dsl", ".", "Position", "(", "row", "=", "5", ",", "column", "=", "2", ")", ",", "dsl", ".", "Position", "(", "row", "=", "14", ",", "column", "=", "8", ")", ",", "\n", "dsl", ".", "Position", "(", "row", "=", "9", ",", "column", "=", "0", ")", ",", "dsl", ".", "Position", "(", "row", "=", "0", ",", "column", "=", "1", ")", "]", "\n", "start_directions", "=", "[", "dsl", ".", "WEST", ",", "dsl", ".", "WEST", ",", "dsl", ".", "NORTH", ",", "dsl", ".", "SOUTH", ",", "dsl", ".", "EAST", ",", "dsl", ".", "WEST", ",", "\n", "dsl", ".", "EAST", ",", "dsl", ".", "EAST", ",", "dsl", ".", "NORTH", ",", "dsl", ".", "SOUTH", "]", "\n", "end_positions", "=", "[", "dsl", ".", "Position", "(", "row", "=", "0", ",", "column", "=", "0", ")", ",", "dsl", ".", "Position", "(", "row", "=", "3", ",", "column", "=", "0", ")", ",", "\n", "dsl", ".", "Position", "(", "row", "=", "13", ",", "column", "=", "7", ")", ",", "dsl", ".", "Position", "(", "row", "=", "13", ",", "column", "=", "2", ")", ",", "\n", "dsl", ".", "Position", "(", "row", "=", "0", ",", "column", "=", "2", ")", ",", "dsl", ".", "Position", "(", "row", "=", "0", ",", "column", "=", "0", ")", ",", "\n", "dsl", ".", "Position", "(", "row", "=", "7", ",", "column", "=", "2", ")", ",", "dsl", ".", "Position", "(", "row", "=", "11", ",", "column", "=", "10", ")", ",", "\n", "dsl", ".", "Position", "(", "row", "=", "0", ",", "column", "=", "3", ")", ",", "dsl", ".", "Position", "(", "row", "=", "13", ",", "column", "=", "12", ")", "]", "\n", "start_positions", ".", "extend", "(", "end_positions", ")", "\n", "extra_positions", "=", "end_positions", ".", "copy", "(", ")", "\n", "extra_directions", "=", "start_directions", ".", "copy", "(", ")", "\n", "random", ".", "shuffle", "(", "extra_directions", ")", "\n", "random", ".", "shuffle", "(", "extra_positions", ")", "\n", "start_positions", ".", "extend", "(", "extra_positions", ")", "\n", "end_positions", ".", "extend", "(", "start_positions", ")", "\n", "random", ".", "shuffle", "(", "extra_positions", ")", "\n", "end_positions", ".", "extend", "(", "extra_positions", ")", "\n", "start_directions", ".", "extend", "(", "reversed", "(", "start_directions", ")", ")", "\n", "start_directions", ".", "extend", "(", "extra_directions", ")", "\n", "\n", "gscan", "=", "dsl", ".", "Gscan", "(", ")", "\n", "spinning_adverbs", "=", "[", "gscan", ".", "spin", ",", "gscan", ".", "cautiously", ",", "gscan", ".", "hesitantly", "]", "\n", "spinning_adverb_texts", "=", "[", "\"spin\"", ",", "\"cautious\"", ",", "\"hesitantly\"", "]", "\n", "\n", "for", "i", ",", "(", "start_pos", ",", "agent_start_dir", ",", "end_pos", ")", "in", "enumerate", "(", "zip", "(", "start_positions", ",", "\n", "start_directions", ",", "\n", "end_positions", ")", ")", ":", "\n", "        ", "TEST_SITUATION_1", ".", "agent_pos", "=", "start_pos", "\n", "TEST_SITUATION_1", ".", "agent_direction", "=", "agent_start_dir", "\n", "planned_sequence", "=", "dsl", ".", "simulate_planner", "(", "start_pos", ",", "end_pos", ")", "\n", "col_distance", "=", "abs", "(", "start_pos", ".", "column", "-", "end_pos", ".", "column", ")", "\n", "sample_recursion", "=", "random", ".", "randint", "(", "0", ",", "col_distance", "*", "2", ")", "\n", "if", "(", "i", "+", "1", ")", "%", "4", "==", "0", ":", "\n", "            ", "gscan", ".", "zigzag", "(", "planned_sequence", ",", "sample_recursion", ")", "\n", "", "target_action_sequence", "=", "dsl", ".", "convert_sequence_to_actions", "(", "planned_sequence", ",", "agent_start_dir", ")", "\n", "if", "i", "%", "4", "!=", "0", ":", "\n", "            ", "idx", "=", "i", "%", "3", "\n", "spinning_adverbs", "[", "idx", "]", "(", "target_action_sequence", ",", "recursion_depth", "=", "1", ")", "\n", "", "command", "=", "\"Test\"", "\n", "target_actions", "=", "target_action_sequence", ".", "get_gscan_actions", "(", ")", "\n", "_", ",", "_", ",", "end_column", ",", "end_row", "=", "dataset", ".", "demonstrate_target_commands", "(", "command", ",", "\n", "TEST_SITUATION_1", ",", "\n", "target_actions", ")", "\n", "assert", "end_column", "==", "end_pos", ".", "column", "and", "end_row", "==", "end_pos", ".", "row", ",", "\"test_dsl_gscan FAILED for expected end pos ({},{}), actual ({},{})\"", ".", "format", "(", "\n", "end_pos", ".", "row", ",", "end_pos", ".", "column", ",", "end_row", ",", "end_column", "\n", ")", "\n", "\n", "", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_dsl_gscan PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n", "TEST_SITUATION_1", ".", "agent_pos", "=", "original_start_pos", "\n", "TEST_SITUATION_1", ".", "agent_direction", "=", "original_start_dir", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_get_num_push_pull_actions": [[1196, 1291], ["time.time", "dataset._world.get_current_situation", "dataset._world.clear_situation", "dataset.initialize_world", "GroundedScan.Position", "GroundedScan.get_num_push_actions", "GroundedScan.get_num_pull_actions", "GroundedScan.Position", "GroundedScan.get_num_push_actions", "GroundedScan.get_num_pull_actions", "GroundedScan.Position", "GroundedScan.get_num_push_actions", "GroundedScan.get_num_pull_actions", "GroundedScan.Position", "GroundedScan.get_num_push_actions", "GroundedScan.get_num_pull_actions", "GroundedScan.Position", "GroundedScan.get_num_push_actions", "GroundedScan.get_num_pull_actions", "GroundedScan.Position", "GroundedScan.get_num_push_actions", "GroundedScan.get_num_pull_actions", "dataset.initialize_world", "time.time", "logger.info"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_num_push_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_num_pull_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_num_push_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_num_pull_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_num_push_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_num_pull_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_num_push_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_num_pull_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_num_push_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_num_pull_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_num_push_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_num_pull_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world"], ["", "def", "test_get_num_push_pull_actions", "(", "dataset", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "current_situation", "=", "dataset", ".", "_world", ".", "get_current_situation", "(", ")", "\n", "current_mission", "=", "dataset", ".", "_world", ".", "mission", "\n", "\n", "dataset", ".", "_world", ".", "clear_situation", "(", ")", "\n", "dataset", ".", "initialize_world", "(", "TEST_SITUATION_1", ")", "\n", "\n", "# First test", "\n", "last_direction", "=", "dsl", ".", "EAST", "\n", "position", "=", "dsl", ".", "Position", "(", "column", "=", "0", ",", "row", "=", "0", ")", "\n", "expected_free_push", "=", "14", "\n", "expected_free_pull", "=", "0", "\n", "actual_free_push", "=", "dsl", ".", "get_num_push_actions", "(", "last_direction", ",", "position", ",", "\n", "dataset", ".", "_world", ".", "grid", ")", "\n", "actual_free_pull", "=", "dsl", ".", "get_num_pull_actions", "(", "last_direction", ",", "position", ",", "\n", "dataset", ".", "_world", ".", "grid", ")", "\n", "assert", "actual_free_pull", "==", "expected_free_pull", ",", "\"Wrong number of pull actions, expected {}, actual {}\"", ".", "format", "(", "\n", "expected_free_pull", ",", "actual_free_pull", ")", "\n", "assert", "actual_free_push", "==", "expected_free_push", ",", "\"Wrong number of push actions, expected {}, actual {}\"", ".", "format", "(", "\n", "expected_free_push", ",", "actual_free_push", ")", "\n", "\n", "# Second test", "\n", "last_direction", "=", "dsl", ".", "EAST", "\n", "position", "=", "dsl", ".", "Position", "(", "column", "=", "12", ",", "row", "=", "10", ")", "\n", "expected_free_push", "=", "2", "\n", "expected_free_pull", "=", "7", "\n", "actual_free_push", "=", "dsl", ".", "get_num_push_actions", "(", "last_direction", ",", "position", ",", "\n", "dataset", ".", "_world", ".", "grid", ")", "\n", "actual_free_pull", "=", "dsl", ".", "get_num_pull_actions", "(", "last_direction", ",", "position", ",", "\n", "dataset", ".", "_world", ".", "grid", ")", "\n", "assert", "actual_free_pull", "==", "expected_free_pull", ",", "\"Wrong number of pull actions, expected {}, actual {}\"", ".", "format", "(", "\n", "expected_free_pull", ",", "actual_free_pull", ")", "\n", "assert", "actual_free_push", "==", "expected_free_push", ",", "\"Wrong number of push actions, expected {}, actual {}\"", ".", "format", "(", "\n", "expected_free_push", ",", "actual_free_push", ")", "\n", "\n", "# Third test", "\n", "last_direction", "=", "dsl", ".", "SOUTH", "\n", "position", "=", "dsl", ".", "Position", "(", "column", "=", "12", ",", "row", "=", "10", ")", "\n", "expected_free_push", "=", "4", "\n", "expected_free_pull", "=", "6", "\n", "actual_free_push", "=", "dsl", ".", "get_num_push_actions", "(", "last_direction", ",", "position", ",", "\n", "dataset", ".", "_world", ".", "grid", ")", "\n", "actual_free_pull", "=", "dsl", ".", "get_num_pull_actions", "(", "last_direction", ",", "position", ",", "\n", "dataset", ".", "_world", ".", "grid", ")", "\n", "assert", "actual_free_pull", "==", "expected_free_pull", ",", "\"Wrong number of pull actions, expected {}, actual {}\"", ".", "format", "(", "\n", "expected_free_pull", ",", "actual_free_pull", ")", "\n", "assert", "actual_free_push", "==", "expected_free_push", ",", "\"Wrong number of push actions, expected {}, actual {}\"", ".", "format", "(", "\n", "expected_free_push", ",", "actual_free_push", ")", "\n", "\n", "# Fourth test", "\n", "last_direction", "=", "dsl", ".", "NORTH", "\n", "position", "=", "dsl", ".", "Position", "(", "column", "=", "12", ",", "row", "=", "10", ")", "\n", "expected_free_push", "=", "6", "\n", "expected_free_pull", "=", "4", "\n", "actual_free_push", "=", "dsl", ".", "get_num_push_actions", "(", "last_direction", ",", "position", ",", "\n", "dataset", ".", "_world", ".", "grid", ")", "\n", "actual_free_pull", "=", "dsl", ".", "get_num_pull_actions", "(", "last_direction", ",", "position", ",", "\n", "dataset", ".", "_world", ".", "grid", ")", "\n", "assert", "actual_free_pull", "==", "expected_free_pull", ",", "\"Wrong number of pull actions, expected {}, actual {}\"", ".", "format", "(", "\n", "expected_free_pull", ",", "actual_free_pull", ")", "\n", "assert", "actual_free_push", "==", "expected_free_push", ",", "\"Wrong number of push actions, expected {}, actual {}\"", ".", "format", "(", "\n", "expected_free_push", ",", "actual_free_push", ")", "\n", "\n", "# Fifth test", "\n", "last_direction", "=", "dsl", ".", "WEST", "\n", "position", "=", "dsl", ".", "Position", "(", "column", "=", "6", ",", "row", "=", "9", ")", "\n", "expected_free_push", "=", "6", "\n", "expected_free_pull", "=", "8", "\n", "actual_free_push", "=", "dsl", ".", "get_num_push_actions", "(", "last_direction", ",", "position", ",", "\n", "dataset", ".", "_world", ".", "grid", ")", "\n", "actual_free_pull", "=", "dsl", ".", "get_num_pull_actions", "(", "last_direction", ",", "position", ",", "\n", "dataset", ".", "_world", ".", "grid", ")", "\n", "assert", "actual_free_pull", "==", "expected_free_pull", ",", "\"Wrong number of pull actions, expected {}, actual {}\"", ".", "format", "(", "\n", "expected_free_pull", ",", "actual_free_pull", ")", "\n", "assert", "actual_free_push", "==", "expected_free_push", ",", "\"Wrong number of push actions, expected {}, actual {}\"", ".", "format", "(", "\n", "expected_free_push", ",", "actual_free_push", ")", "\n", "\n", "# Sixth test", "\n", "last_direction", "=", "dsl", ".", "NORTH", "\n", "position", "=", "dsl", ".", "Position", "(", "column", "=", "12", ",", "row", "=", "4", ")", "\n", "expected_free_push", "=", "0", "\n", "expected_free_pull", "=", "10", "\n", "actual_free_push", "=", "dsl", ".", "get_num_push_actions", "(", "last_direction", ",", "position", ",", "\n", "dataset", ".", "_world", ".", "grid", ")", "\n", "actual_free_pull", "=", "dsl", ".", "get_num_pull_actions", "(", "last_direction", ",", "position", ",", "\n", "dataset", ".", "_world", ".", "grid", ")", "\n", "assert", "actual_free_pull", "==", "expected_free_pull", ",", "\"Wrong number of pull actions, expected {}, actual {}\"", ".", "format", "(", "\n", "expected_free_pull", ",", "actual_free_pull", ")", "\n", "assert", "actual_free_push", "==", "expected_free_push", ",", "\"Wrong number of push actions, expected {}, actual {}\"", ".", "format", "(", "\n", "expected_free_push", ",", "actual_free_push", ")", "\n", "\n", "dataset", ".", "initialize_world", "(", "current_situation", ",", "mission", "=", "current_mission", ")", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_get_num_push_pull_actions PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_gscan_examples": [[1293, 1374], ["time.time", "dataset._world.get_current_situation", "logger.info", "random.shuffle", "GroundedScan.Gscan", "verb_adverb.items", "dataset.initialize_world", "time.time", "logger.info", "dataset.get_data_pairs", "int", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.world.Situation.from_representation", "dataset.initialize_world", "dsl.Gscan.parse_example", "adverb_counts.items", "range", "logger.info", "verb_adverb.keys", "verb_adverb[].keys", "dataset._world._object_vocabulary._heavy_weights.keys", "logger.info", "len", "int", "int", "int", "int", "abs", "dsl.Gscan.get_gscan_adverb"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_data_pairs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.from_representation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.parse_example", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.abs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.get_gscan_adverb"], ["", "def", "test_gscan_examples", "(", "dataset", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "current_situation", "=", "dataset", ".", "_world", ".", "get_current_situation", "(", ")", "\n", "current_mission", "=", "dataset", ".", "_world", ".", "mission", "\n", "num_generate_examples", "=", "10000", "\n", "num_test_examples", "=", "1000", "\n", "# TODO: how to make sure push/pull/walk and all adverbs are tested", "\n", "logger", ".", "info", "(", "\"test_gscan_examples loading {} and testing {} examples. Might take a while.\"", ".", "format", "(", "num_generate_examples", ",", "\n", "num_test_examples", ")", ")", "\n", "dataset", ".", "get_data_pairs", "(", "max_examples", "=", "num_generate_examples", ")", "\n", "indices", "=", "[", "i", "for", "i", "in", "range", "(", "len", "(", "dataset", ".", "_data_pairs", "[", "\"train\"", "]", ")", ")", "]", "\n", "random", ".", "shuffle", "(", "indices", ")", "\n", "gscan", "=", "dsl", ".", "Gscan", "(", ")", "\n", "verb_adverb", "=", "{", "}", "\n", "adverb_types", "=", "{", "\n", "\"while zigzagging\"", ":", "\"movement_rewrite\"", ",", "\n", "\"while spinning\"", ":", "\"nonmovement_direction\"", ",", "\n", "\"cautiously\"", ":", "\"nonmovement_first_person\"", ",", "\n", "\"hesitantly\"", ":", "\"nonmovement_first_person\"", "\n", "}", "\n", "num_examples_tested", "=", "0", "\n", "for", "example_idx", "in", "indices", "[", ":", "num_test_examples", "]", ":", "\n", "        ", "example", "=", "dataset", ".", "_data_pairs", "[", "\"train\"", "]", "[", "example_idx", "]", "\n", "if", "(", "num_examples_tested", "+", "1", ")", "%", "500", "==", "0", ":", "\n", "            ", "logger", ".", "info", "(", "\"Tested {} of {} examples succesfully\"", ".", "format", "(", "\n", "num_examples_tested", ",", "num_test_examples", ")", ")", "\n", "", "verb_in_command", "=", "example", "[", "\"verb_in_command\"", "]", "\n", "manner", "=", "example", "[", "\"manner\"", "]", "\n", "if", "verb_in_command", "not", "in", "verb_adverb", ".", "keys", "(", ")", ":", "\n", "            ", "verb_adverb", "[", "verb_in_command", "]", "=", "{", "}", "\n", "", "if", "not", "manner", ":", "\n", "            ", "manner_str", "=", "\"no_manner\"", "\n", "", "else", ":", "\n", "            ", "manner_str", "=", "manner", "\n", "", "if", "manner_str", "not", "in", "verb_adverb", "[", "verb_in_command", "]", ".", "keys", "(", ")", ":", "\n", "            ", "verb_adverb", "[", "verb_in_command", "]", "[", "manner_str", "]", "=", "0", "\n", "", "verb_adverb", "[", "verb_in_command", "]", "[", "manner_str", "]", "+=", "1", "\n", "size", "=", "int", "(", "example", "[", "\"situation\"", "]", "[", "\"target_object\"", "]", "[", "\"object\"", "]", "[", "\"size\"", "]", ")", "\n", "heavy", "=", "False", "\n", "if", "size", "in", "dataset", ".", "_world", ".", "_object_vocabulary", ".", "_heavy_weights", ".", "keys", "(", ")", ":", "\n", "            ", "heavy", "=", "True", "\n", "", "target_position", "=", "example", "[", "\"situation\"", "]", "[", "\"target_object\"", "]", "[", "\"position\"", "]", "\n", "target_position", "=", "dsl", ".", "Position", "(", "column", "=", "int", "(", "target_position", "[", "\"column\"", "]", ")", ",", "\n", "row", "=", "int", "(", "target_position", "[", "\"row\"", "]", ")", ")", "\n", "start_position", "=", "example", "[", "\"situation\"", "]", "[", "\"agent_position\"", "]", "\n", "start_position", "=", "dsl", ".", "Position", "(", "column", "=", "int", "(", "start_position", "[", "\"column\"", "]", ")", ",", "\n", "row", "=", "int", "(", "start_position", "[", "\"row\"", "]", ")", ")", "\n", "situation", "=", "Situation", ".", "from_representation", "(", "example", "[", "\"situation\"", "]", ")", "\n", "dataset", ".", "initialize_world", "(", "situation", ",", "example", "[", "\"command\"", "]", ")", "\n", "grid", "=", "dataset", ".", "_world", ".", "grid", "\n", "start_direction", "=", "example", "[", "\"situation\"", "]", "[", "\"agent_direction\"", "]", "\n", "expected_target_commands", "=", "example", "[", "\"target_commands\"", "]", "\n", "if", "manner", "==", "\"while zigzagging\"", ":", "\n", "            ", "recursion_depth", "=", "abs", "(", "target_position", ".", "column", "-", "start_position", ".", "column", ")", "-", "1", "\n", "", "else", ":", "\n", "            ", "recursion_depth", "=", "1", "\n", "", "output", "=", "gscan", ".", "parse_example", "(", "verb_in_command", "=", "verb_in_command", ",", "\n", "start_position", "=", "start_position", ",", "\n", "start_direction", "=", "start_direction", ",", "\n", "end_position", "=", "target_position", ",", "\n", "adverb", "=", "gscan", ".", "get_gscan_adverb", "(", "manner", ")", ",", "\n", "adverb_type", "=", "adverb_types", "[", "manner", "]", ",", "\n", "grid", "=", "grid", ",", "\n", "heavy", "=", "heavy", ",", "\n", "recursion", "=", "recursion_depth", ")", "\n", "actual_target_commands", "=", "output", "[", "\"target_commands\"", "]", "\n", "actual_target_commands", "=", "\",\"", ".", "join", "(", "actual_target_commands", ")", "\n", "assert", "expected_target_commands", "==", "actual_target_commands", ",", "\"test_gscan_examples FAILED with verb {}, manner {},\"", "\"expected commands: {}, actual commands: {}\"", ".", "format", "(", "verb_in_command", ",", "manner", ",", "\n", "expected_target_commands", ",", "\n", "actual_target_commands", ")", "\n", "num_examples_tested", "+=", "1", "\n", "\n", "", "dataset", ".", "initialize_world", "(", "current_situation", ",", "mission", "=", "current_mission", ")", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_gscan_examples PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n", "\n", "", "def", "test_adverb_sampling", "(", "dataset", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "current_situation", "=", "dataset", ".", "_world", ".", "get_current_situation", "(", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_adverb_sampling": [[1376, 1482], ["time.time", "dataset._world.get_current_situation", "GroundedScan.AdverbWorld", "dsl.AdverbWorld.populate_adverbs", "dataset.initialize_world", "time.time", "logger.info", "random.sample", "random.sample", "enumerate", "range", "os.path.join", "open", "open.write", "range", "open.close", "os.path.exists", "os.mkdir", "os.path.join", "str", "random.randint", "random.randint", "random.randint", "random.randint", "random.randint", "abs", "abs", "recursion_lambda_sequence", "GroundedScan.Position", "GroundedScan.Position", "GroundedScan.world.Situation", "dsl.AdverbWorld.generate_example", "dataset.demonstrate_target_commands", "open.write", "logger.info", "logger.info", "dataset.visualize_command", "GroundedScan.world.PositionedObject", "str", "open.write", "GroundedScan.world.PositionedObject", "GroundedScan.world.Object", "numpy.array", "GroundedScan.world.Object", "numpy.array"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.populate_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.close", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.abs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.abs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.generate_example", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_target_commands", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.visualize_command"], ["\n", "world", "=", "dsl", ".", "AdverbWorld", "(", "seed", "=", "1", ",", "save_directory", "=", "TEST_DIRECTORY", ")", "\n", "world", ".", "populate_adverbs", "(", ")", "\n", "movement_rewrite_adverbs", "=", "world", ".", "_all_adverbs", "[", "\"movement_rewrite\"", "]", "\n", "movement_adverbs", "=", "world", ".", "_all_adverbs", "[", "\"movement\"", "]", "\n", "nonmovement_direction_adverbs", "=", "world", ".", "_all_adverbs", "[", "\"nonmovement_direction\"", "]", "\n", "nonmovement_first_person_adverbs", "=", "world", ".", "_all_adverbs", "[", "\n", "\"nonmovement_first_person\"", "]", "\n", "all_adverbs", "=", "{", "\"nonmovement_direction\"", ":", "nonmovement_direction_adverbs", ",", "\n", "\"movement_adverbs\"", ":", "movement_adverbs", ",", "\n", "\"movement_rewrite\"", ":", "movement_rewrite_adverbs", ",", "\n", "\"nonmovement_first_person\"", ":", "nonmovement_first_person_adverbs", "}", "\n", "recursions_on_sequence", "=", "[", "lambda", "cols", ",", "rows", ":", "1", ",", "\n", "lambda", "cols", ",", "rows", ":", "cols", "-", "1", ",", "\n", "lambda", "cols", ",", "rows", ":", "rows", "-", "1", ",", "\n", "lambda", "cols", ",", "rows", ":", "cols", "+", "rows", "-", "1", "]", "\n", "zero_recursions", "=", "[", "lambda", "cols", ",", "rows", ":", "1", ",", "\n", "lambda", "cols", ",", "rows", ":", "1", ",", "\n", "lambda", "cols", ",", "rows", ":", "1", ",", "\n", "lambda", "cols", ",", "rows", ":", "1", "]", "\n", "all_recursions_sequence", "=", "{", "\"nonmovement_direction\"", ":", "zero_recursions", ",", "\n", "\"movement_adverbs\"", ":", "zero_recursions", ",", "\n", "\"movement_rewrite\"", ":", "recursions_on_sequence", ",", "\n", "\"nonmovement_first_person\"", ":", "zero_recursions", "}", "\n", "adverb_type", "=", "[", "\"nonmovement_first_person\"", ",", "\n", "\"nonmovement_direction\"", ",", "\n", "\"movement_adverbs\"", ",", "\n", "\"movement_rewrite\"", "]", "\n", "num_rejected", "=", "0", "\n", "for", "type", "in", "adverb_type", ":", "\n", "        ", "adverb_list", "=", "all_adverbs", "[", "type", "]", "\n", "recursions_sequence", "=", "all_recursions_sequence", "[", "type", "]", "\n", "adverbs_to_test", "=", "random", ".", "sample", "(", "adverb_list", ",", "10", ")", "\n", "to_visualize", "=", "random", ".", "sample", "(", "range", "(", "10", ")", ",", "5", ")", "\n", "for", "i", ",", "adverb", "in", "enumerate", "(", "adverbs_to_test", ")", ":", "\n", "            ", "if", "i", "in", "to_visualize", ":", "\n", "                ", "parent_save_dir", "=", "\"{}_{}\"", ".", "format", "(", "type", ",", "i", ")", "\n", "save_dir", "=", "os", ".", "path", ".", "join", "(", "TEST_DIRECTORY", ",", "parent_save_dir", ")", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "save_dir", ")", ":", "\n", "                    ", "os", ".", "mkdir", "(", "save_dir", ")", "\n", "", "infile", "=", "open", "(", "os", ".", "path", ".", "join", "(", "save_dir", ",", "\"l_system.txt\"", ")", ",", "\"w\"", ")", "\n", "infile", ".", "write", "(", "str", "(", "adverb", ")", ")", "\n", "", "for", "recursion_lambda_sequence", "in", "recursions_sequence", ":", "\n", "                ", "for", "_", "in", "range", "(", "10", ")", ":", "\n", "                    ", "start_direction", "=", "random", ".", "randint", "(", "0", ",", "3", ")", "\n", "start_row", "=", "random", ".", "randint", "(", "0", ",", "dataset", ".", "_world", ".", "grid_size", "-", "1", ")", "\n", "start_col", "=", "random", ".", "randint", "(", "0", ",", "dataset", ".", "_world", ".", "grid_size", "-", "1", ")", "\n", "end_row", "=", "random", ".", "randint", "(", "0", ",", "dataset", ".", "_world", ".", "grid_size", "-", "1", ")", "\n", "end_col", "=", "random", ".", "randint", "(", "0", ",", "dataset", ".", "_world", ".", "grid_size", "-", "1", ")", "\n", "num_rows", "=", "abs", "(", "end_row", "-", "start_row", ")", "\n", "num_cols", "=", "abs", "(", "end_col", "-", "start_col", ")", "\n", "recursion_sequence", "=", "recursion_lambda_sequence", "(", "num_cols", ",", "num_rows", ")", "\n", "if", "i", "in", "to_visualize", ":", "\n", "                        ", "infile", ".", "write", "(", "\"num_cols %d num_rows %d recursion sequence %d\\n\"", "%", "(", "num_cols", ",", "\n", "num_rows", ",", "\n", "recursion_sequence", ")", ")", "\n", "", "start_position", "=", "dsl", ".", "Position", "(", "row", "=", "start_row", ",", "column", "=", "start_col", ")", "\n", "end_position", "=", "dsl", ".", "Position", "(", "row", "=", "end_row", ",", "column", "=", "end_col", ")", "\n", "current_situation", "=", "Situation", "(", "grid_size", "=", "dataset", ".", "_world", ".", "grid_size", ",", "\n", "agent_position", "=", "start_position", ",", "\n", "agent_direction", "=", "INT_TO_DIR", "[", "start_direction", "]", ",", "\n", "target_object", "=", "PositionedObject", "(", "\n", "object", "=", "Object", "(", "size", "=", "2", ",", "color", "=", "'red'", ",", "shape", "=", "'circle'", ")", ",", "\n", "position", "=", "end_position", ",", "\n", "vector", "=", "np", ".", "array", "(", "[", "1", ",", "0", ",", "1", "]", ")", ")", ",", "\n", "placed_objects", "=", "[", "PositionedObject", "(", "\n", "object", "=", "Object", "(", "size", "=", "2", ",", "color", "=", "'red'", ",", "shape", "=", "'circle'", ")", ",", "\n", "position", "=", "end_position", ",", "\n", "vector", "=", "np", ".", "array", "(", "[", "1", ",", "0", ",", "1", "]", ")", ")", "]", ",", "carrying", "=", "None", ")", "\n", "# dataset.initialize_world(current_situation, mission=current_mission)", "\n", "sequence", ",", "is_rejected", "=", "world", ".", "generate_example", "(", "start_position", ",", "\n", "start_direction", ",", "\n", "end_position", ",", "\n", "adverb", ",", "\n", "recursion_depth_system", "=", "1", ",", "\n", "recursion_depth_sequence", "=", "recursion_sequence", ",", "\n", "grid_size", "=", "dataset", ".", "_world", ".", "grid_size", ",", "\n", "type_adverb", "=", "type", ")", "\n", "if", "is_rejected", ":", "\n", "                        ", "num_rejected", "+=", "1", "\n", "logger", ".", "info", "(", "\"Rejected L-system.\"", ")", "\n", "logger", ".", "info", "(", "str", "(", "adverb", ")", ")", "\n", "if", "i", "in", "to_visualize", ":", "\n", "                            ", "infile", ".", "write", "(", "\"Rejected L-system.\\n\"", ")", "\n", "", "continue", "\n", "", "(", "commands", ",", "demonstration", ",", "\n", "actual_end_col", ",", "actual_end_row", ")", "=", "dataset", ".", "demonstrate_target_commands", "(", "\n", "\"\"", ",", "current_situation", ",", "target_commands", "=", "sequence", ")", "\n", "if", "i", "in", "to_visualize", ":", "\n", "                        ", "mission", "=", "' '", ".", "join", "(", "[", "\"\\n      Target:\"", "]", "+", "commands", ")", "\n", "\n", "save_dir_prediction", "=", "dataset", ".", "visualize_command", "(", "\n", "current_situation", ",", "\"command\"", ",", "demonstration", ",", "mission", "=", "mission", ",", "\n", "parent_save_dir", "=", "parent_save_dir", ")", "\n", "", "assert", "end_col", "==", "actual_end_col", ",", "\"Wrong end col for adverb_type {}\"", ".", "format", "(", "type", ")", "\n", "assert", "end_row", "==", "actual_end_row", ",", "\"Wrong end row for adverb_type {}\"", ".", "format", "(", "type", ")", "\n", "", "", "if", "i", "in", "to_visualize", ":", "\n", "                ", "infile", ".", "close", "(", ")", "\n", "", "", "", "assert", "num_rejected", "==", "0", ",", "\"test_adverb_sampling FAILED. Rejected {} L-systems.\"", ".", "format", "(", "num_rejected", ")", "\n", "dataset", ".", "initialize_world", "(", "current_situation", ",", "mission", "=", "current_mission", ")", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_adverb_sampling PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n", "\n", "", "def", "test_remove_out_of_grid", "(", "dataset", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "init_current_situation", "=", "dataset", ".", "_world", ".", "get_current_situation", "(", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_remove_out_of_grid": [[1484, 1566], ["time.time", "dataset._world.get_current_situation", "GroundedScan.MetaGrammar", "GroundedScan.AdverbWorld", "GroundedScan.LSystem", "dsl.LSystem.add_rule", "dsl.LSystem.add_rule", "dsl.LSystem.add_rule", "dsl.LSystem.add_rule", "dsl.LSystem.finish_l_system", "GroundedScan.Position", "GroundedScan.Position", "dsl.AdverbWorld.generate_example", "dsl.AdverbWorld.generate_example", "dsl.AdverbWorld.generate_example", "GroundedScan.world.Situation", "dataset.demonstrate_target_commands", "dataset.demonstrate_target_commands", "dataset.demonstrate_target_commands", "dataset.initialize_world", "time.time", "logger.info", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "GroundedScan.world.PositionedObject", "GroundedScan.world.PositionedObject", "GroundedScan.world.PositionedObject", "GroundedScan.world.Object", "numpy.array", "GroundedScan.world.Object", "numpy.array", "GroundedScan.world.Object", "GroundedScan.world.Position", "numpy.array"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.generate_example", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.generate_example", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.generate_example", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_target_commands", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_target_commands", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_target_commands", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule"], ["\n", "meta_grammar", "=", "dsl", ".", "MetaGrammar", "(", ")", "\n", "world", "=", "dsl", ".", "AdverbWorld", "(", "seed", "=", "1", ",", "save_directory", "=", "TEST_DIRECTORY", ")", "\n", "l_system", "=", "dsl", ".", "LSystem", "(", ")", "\n", "l_system", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"West\"", ",", "\n", "rhs_str", "=", "\"North West South\"", ")", ")", "\n", "l_system", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"East\"", ",", "\n", "rhs_str", "=", "\"North East South\"", ")", ")", "\n", "l_system", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"North\"", ",", "\n", "rhs_str", "=", "\"East North West\"", ")", ")", "\n", "l_system", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"South\"", ",", "\n", "rhs_str", "=", "\"East South West\"", ")", ")", "\n", "l_system", ".", "finish_l_system", "(", ")", "\n", "\n", "start_direction", "=", "0", "\n", "start_position", "=", "dsl", ".", "Position", "(", "row", "=", "0", ",", "column", "=", "0", ")", "\n", "expected_end_row", "=", "5", "\n", "expected_end_col", "=", "5", "\n", "end_position", "=", "dsl", ".", "Position", "(", "row", "=", "expected_end_row", ",", "column", "=", "expected_end_col", ")", "\n", "sequence", ",", "rejected", "=", "world", ".", "generate_example", "(", "start_position", ",", "\n", "start_direction", ",", "\n", "end_position", ",", "\n", "l_system", ",", "\n", "recursion_depth_system", "=", "0", ",", "\n", "recursion_depth_sequence", "=", "1", ",", "\n", "grid_size", "=", "6", ",", "\n", "type_adverb", "=", "\"movement\"", ")", "\n", "sequence_two", ",", "_", "=", "world", ".", "generate_example", "(", "start_position", ",", "\n", "start_direction", ",", "\n", "end_position", ",", "\n", "l_system", ",", "\n", "recursion_depth_system", "=", "1", ",", "\n", "recursion_depth_sequence", "=", "1", ",", "\n", "grid_size", "=", "6", ",", "\n", "type_adverb", "=", "\"movement\"", ")", "\n", "sequence_three", ",", "_", "=", "world", ".", "generate_example", "(", "start_position", ",", "\n", "start_direction", ",", "\n", "end_position", ",", "\n", "l_system", ",", "\n", "recursion_depth_system", "=", "1", ",", "\n", "recursion_depth_sequence", "=", "2", ",", "\n", "grid_size", "=", "6", ",", "\n", "type_adverb", "=", "\"movement\"", ")", "\n", "current_situation", "=", "Situation", "(", "grid_size", "=", "6", ",", "\n", "agent_position", "=", "start_position", ",", "\n", "agent_direction", "=", "INT_TO_DIR", "[", "start_direction", "]", ",", "\n", "target_object", "=", "PositionedObject", "(", "\n", "object", "=", "Object", "(", "size", "=", "2", ",", "color", "=", "'red'", ",", "shape", "=", "'circle'", ")", ",", "\n", "position", "=", "end_position", ",", "\n", "vector", "=", "np", ".", "array", "(", "[", "1", ",", "0", ",", "1", "]", ")", ")", ",", "\n", "placed_objects", "=", "[", "PositionedObject", "(", "\n", "object", "=", "Object", "(", "size", "=", "2", ",", "color", "=", "'red'", ",", "shape", "=", "'circle'", ")", ",", "\n", "position", "=", "end_position", ",", "\n", "vector", "=", "np", ".", "array", "(", "[", "1", ",", "0", ",", "1", "]", ")", ")", ",", "\n", "PositionedObject", "(", "\n", "object", "=", "Object", "(", "size", "=", "4", ",", "color", "=", "'green'", ",", "shape", "=", "'circle'", ")", ",", "\n", "position", "=", "Position", "(", "row", "=", "3", ",", "column", "=", "3", ")", ",", "\n", "vector", "=", "np", ".", "array", "(", "[", "0", ",", "1", ",", "0", "]", ")", ")", "]", ",", "carrying", "=", "None", ")", "\n", "\n", "(", "commands", ",", "demonstration", ",", "\n", "end_col", ",", "end_row", ")", "=", "dataset", ".", "demonstrate_target_commands", "(", "\n", "\"\"", ",", "current_situation", ",", "target_commands", "=", "sequence", ")", "\n", "assert", "expected_end_col", "==", "end_col", ",", "\"test_remove_out_of_grid FAILED. Wrong end col\"", "\n", "assert", "expected_end_row", "==", "end_row", ",", "\"test_remove_out_of_grid FAILED. Wrong end row\"", "\n", "(", "commands", ",", "demonstration", ",", "\n", "end_col", ",", "end_row", ")", "=", "dataset", ".", "demonstrate_target_commands", "(", "\n", "\"\"", ",", "current_situation", ",", "target_commands", "=", "sequence_two", ")", "\n", "assert", "expected_end_col", "==", "end_col", ",", "\"test_remove_out_of_grid FAILED. Wrong end col\"", "\n", "assert", "expected_end_row", "==", "end_row", ",", "\"test_remove_out_of_grid FAILED. Wrong end row\"", "\n", "(", "commands", ",", "demonstration", ",", "\n", "end_col", ",", "end_row", ")", "=", "dataset", ".", "demonstrate_target_commands", "(", "\n", "\"\"", ",", "current_situation", ",", "target_commands", "=", "sequence_three", ")", "\n", "assert", "expected_end_col", "==", "end_col", ",", "\"test_remove_out_of_grid FAILED. Wrong end col\"", "\n", "assert", "expected_end_row", "==", "end_row", ",", "\"test_remove_out_of_grid FAILED. Wrong end row\"", "\n", "\n", "dataset", ".", "initialize_world", "(", "init_current_situation", ",", "mission", "=", "init_current_mission", ")", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_remove_out_of_grid PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n", "\n", "", "def", "test_generate_adverb_challenge", "(", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "num_train_examples_per_train_adverb", "=", "None", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_generate_adverb_challenge": [[1568, 1634], ["time.time", "GroundedScan.AdverbWorld", "dsl.AdverbWorld.generate_adverb_challenge", "dsl.AdverbWorld.save_adverb_challenge", "dsl.AdverbWorld._gscan_dataset._data_pairs.items", "dsl.AdverbWorld._heldout_adverbs_str.split", "adverb_world._heldout_adverbs_str.split.append", "num_examples_per_adverb_per_split.items", "logger.info", "dsl.AdverbWorld.save_gscan_statistics", "dsl.AdverbWorld.visualize_gscan_examples", "time.time", "logger.info", "occurrences.items", "dsl.AdverbWorld._gscan_dataset.parse_derivation_repr", "GroundedScan.world.Situation.from_representation", "dsl.AdverbWorld._gscan_dataset.demonstrate_command", "dsl.AdverbWorld.get_adverb_type", "dsl.AdverbWorld._gscan_dataset._vocabulary.translate_word", "dsl.AdverbWorld._gscan_dataset._vocabulary.translate_word", "adverb_world._gscan_dataset.parse_derivation_repr.words", "dsl.AdverbWorld._gscan_dataset.demonstrate_target_commands", "example[].split"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.generate_adverb_challenge", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.save_adverb_challenge", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.save_gscan_statistics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.visualize_gscan_examples", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_derivation_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.from_representation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.get_adverb_type", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_target_commands"], ["adverb_world", "=", "dsl", ".", "AdverbWorld", "(", "seed", "=", "1", ",", "save_directory", "=", "TEST_DIRECTORY", ")", "\n", "adverb_world", ".", "generate_adverb_challenge", "(", "num_extra_training_adverbs", "=", "1", ",", "\n", "num_train_examples_per_train_adverb", "=", "num_train_examples_per_train_adverb", ",", "\n", "num_extra_testing_adverbs", "=", "1", ",", "\n", "num_train_examples_per_test_adverb", "=", "num_train_examples_per_test_adverb", ",", "\n", "grid_size", "=", "4", ",", "\n", "make_dev_set", "=", "True", ",", "\n", "use_gscan_adverbs", "=", "False", ")", "\n", "\n", "save_path", "=", "adverb_world", ".", "save_adverb_challenge", "(", "\"adverb_challenge.txt\"", ")", "\n", "\n", "num_examples_per_adverb_per_split", "=", "{", "}", "\n", "\n", "for", "split", ",", "examples", "in", "adverb_world", ".", "_gscan_dataset", ".", "_data_pairs", ".", "items", "(", ")", ":", "\n", "        ", "for", "example", "in", "examples", ":", "\n", "            ", "adverb", "=", "example", "[", "\"manner\"", "]", "\n", "verb", "=", "example", "[", "\"verb_in_command\"", "]", "\n", "derivation", "=", "adverb_world", ".", "_gscan_dataset", ".", "parse_derivation_repr", "(", "example", "[", "\"derivation\"", "]", ")", "\n", "situation", "=", "Situation", ".", "from_representation", "(", "example", "[", "\"situation\"", "]", ")", "\n", "old_target_commands", ",", "old_demonstration", ",", "old_target_action", "=", "adverb_world", ".", "_gscan_dataset", ".", "demonstrate_command", "(", "\n", "derivation", ",", "situation", ")", "\n", "if", "adverb_world", ".", "_gscan_dataset", ".", "_vocabulary", ".", "translate_word", "(", "adverb", ")", "in", "[", "\n", "\"while spinning\"", ",", "\"cautiously\"", ",", "\"hesitantly\"", ",", "\"while zigzagging\"", "]", ":", "\n", "                ", "assert", "','", ".", "join", "(", "old_target_commands", ")", "==", "example", "[", "\"target_commands\"", "]", "\n", "", "expected_end_location", "=", "old_demonstration", "[", "-", "1", "]", ".", "agent_pos", "\n", "current_type", "=", "adverb_world", ".", "get_adverb_type", "(", "adverb_world", ".", "_gscan_dataset", ".", "_vocabulary", ".", "translate_word", "(", "adverb", ")", ")", "\n", "if", "current_type", "!=", "\"movement\"", "and", "current_type", "!=", "\"movement_rewrite\"", "or", "verb", "==", "\"walk\"", ":", "\n", "                ", "command", "=", "derivation", ".", "words", "(", ")", "\n", "_", ",", "_", ",", "actual_end_col", ",", "actual_end_row", "=", "adverb_world", ".", "_gscan_dataset", ".", "demonstrate_target_commands", "(", "\n", "command", ",", "situation", ",", "example", "[", "\"target_commands\"", "]", ".", "split", "(", "\",\"", ")", ")", "\n", "assert", "actual_end_col", "==", "expected_end_location", ".", "column", ",", "\"Wrong end column in \"", "\"generate_adverb_world_states.\"", "\n", "assert", "actual_end_row", "==", "expected_end_location", ".", "row", ",", "\"Wrong end row in \"", "\"generate_adverb_world_states.\"", "\n", "", "if", "adverb", "not", "in", "num_examples_per_adverb_per_split", ":", "\n", "                ", "num_examples_per_adverb_per_split", "[", "adverb", "]", "=", "{", "}", "\n", "", "if", "split", "not", "in", "num_examples_per_adverb_per_split", "[", "adverb", "]", ":", "\n", "                ", "num_examples_per_adverb_per_split", "[", "adverb", "]", "[", "split", "]", "=", "0", "\n", "", "num_examples_per_adverb_per_split", "[", "adverb", "]", "[", "split", "]", "+=", "1", "\n", "\n", "", "", "held_out_adverbs", "=", "adverb_world", ".", "_heldout_adverbs_str", ".", "split", "(", "\",\"", ")", "\n", "held_out_adverbs", ".", "append", "(", "\"cautiously\"", ")", "\n", "for", "adverb", ",", "occurrences", "in", "num_examples_per_adverb_per_split", ".", "items", "(", ")", ":", "\n", "        ", "for", "split", ",", "count", "in", "occurrences", ".", "items", "(", ")", ":", "\n", "            ", "if", "split", "==", "\"train\"", "and", "adverb", "not", "in", "held_out_adverbs", ":", "\n", "                ", "assert", "count", "==", "num_train_examples_per_train_adverb", ",", "\"Wrong count of adverb %s in split %s: %d\"", "%", "(", "\n", "adverb", ",", "split", ",", "count", "\n", ")", "\n", "", "elif", "split", "==", "\"train\"", "and", "adverb", "in", "held_out_adverbs", ":", "\n", "                ", "assert", "count", "==", "num_train_examples_per_test_adverb", ",", "\"Wrong count of adverb %s in split %s: %d\"", "%", "(", "\n", "adverb", ",", "split", ",", "count", "\n", ")", "\n", "\n", "", "", "", "logger", ".", "info", "(", "\"Saved adverb challenge at %s\"", "%", "save_path", ")", "\n", "adverb_world", ".", "save_gscan_statistics", "(", "dev_set", "=", "True", ")", "\n", "adverb_world", ".", "visualize_gscan_examples", "(", ")", "\n", "\n", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_generate_adverb_challenge PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n", "\n", "", "def", "test_save_and_load_adverb_challenge", "(", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "\n", "adverb_world", "=", "dsl", ".", "AdverbWorld", "(", "seed", "=", "1", ",", "save_directory", "=", "TEST_DIRECTORY", ")", "\n", "adverb_world", ".", "generate_adverb_challenge", "(", "num_extra_training_adverbs", "=", "10", ",", "\n", "num_train_examples_per_train_adverb", "=", "200", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_save_and_load_adverb_challenge": [[1734, 1792], ["time.time", "GroundedScan.AdverbWorld", "dsl.AdverbWorld.generate_adverb_challenge", "dsl.AdverbWorld.save_adverb_challenge", "logger.info", "dsl.AdverbWorld.save_gscan_statistics", "GroundedScan.AdverbWorld.load_adverb_challenge", "dsl.AdverbWorld._extra_adverbs.items", "dsl.AdverbWorld._gscan_dataset._data_statistics.items", "dsl.AdverbWorld._gscan_dataset._data_pairs.items", "time.time", "logger.info", "extra_adverb_lsystem.to_representation", "[].to_representation", "stats.items", "zip"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.generate_adverb_challenge", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.save_adverb_challenge", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.save_gscan_statistics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.load_adverb_challenge", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.to_representation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.to_representation"], ["\n", "num_adverbs", "=", "25", "\n", "adverb_world", "=", "dsl", ".", "AdverbWorld", "(", "seed", "=", "1", ",", "save_directory", "=", "TEST_DIRECTORY", ")", "\n", "adverb_world", ".", "populate_adverbs", "(", "max_per_type", "=", "num_adverbs", ")", "\n", "\n", "adverbs", "=", "[", "\"adverb_%d\"", "%", "i", "for", "i", "in", "range", "(", "num_adverbs", ")", "]", "\n", "adverb_world", ".", "assign_adverb_programs", "(", "adverbs", ")", "\n", "adverb_programs", "=", "adverb_world", ".", "_extra_adverbs", "\n", "all_adverb_programs", "=", "[", "]", "\n", "all_adverb_types", "=", "[", "]", "\n", "for", "adverb_str", ",", "adverb_spec", "in", "adverb_programs", ".", "items", "(", ")", ":", "\n", "        ", "type_adverb", "=", "adverb_spec", "[", "\"type\"", "]", "\n", "program_adverb", "=", "adverb_spec", "[", "\"program\"", "]", "\n", "all_adverb_programs", ".", "append", "(", "program_adverb", ")", "\n", "all_adverb_types", ".", "append", "(", "type_adverb", ")", "\n", "\n", "", "assert", "len", "(", "all_adverb_programs", ")", "==", "num_adverbs", ",", "\"test_assign_adverbs FAILED. Assigned %d programs but needed \"", "\" %d programs\"", "%", "(", "\n", "len", "(", "all_adverb_programs", ")", ",", "num_adverbs", "\n", ")", "\n", "# Check unique", "\n", "for", "i", ",", "adverb_program", "in", "enumerate", "(", "all_adverb_programs", ")", ":", "\n", "        ", "for", "j", ",", "other_adverb_program", "in", "enumerate", "(", "all_adverb_programs", ")", ":", "\n", "            ", "if", "i", "==", "j", ":", "\n", "                ", "continue", "\n", "", "assert", "adverb_program", "!=", "other_adverb_program", ",", "\"test_assign_adverbs FAILED. \"", "\"Overlap in assigned adverb programs.\"", "\n", "", "", "gscan_adverbs", "=", "[", "\"cautiously\"", ",", "\"while zigzagging\"", ",", "\"while spinning\"", ",", "\"hesitantly\"", "]", "\n", "gscan_programs", "=", "[", "adverb_world", ".", "get_adverb_program", "(", "gscan_adv", ")", "for", "gscan_adv", "in", "gscan_adverbs", "]", "\n", "for", "gscan_adverb", "in", "gscan_programs", ":", "\n", "        ", "assert", "gscan_adverb", "not", "in", "all_adverb_programs", ",", "\"test_assign_adverbs FAILED. gSCAN adverb %s found in assigned\"", "\" programs.\"", "%", "gscan_adverb", "\n", "\n", "", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_assign_adverbs PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n", "\n", "", "def", "run_all_tests", "(", ")", ":", "\n", "# test_save_and_load_dataset(TEST_DATASET)", "\n", "# test_save_and_load_dataset(TEST_DATASET_NONCE)", "\n", "# test_save_and_load_dataset_nonce()", "\n", "# test_derivation_from_rules(TEST_DATASET)", "\n", "# test_derivation_from_rules(TEST_DATASET_NONCE)", "\n", "# test_derivation_from_string(TEST_DATASET)", "\n", "# test_derivation_from_string(TEST_DATASET_NONCE)", "\n", "# test_demonstrate_target_commands_one(TEST_DATASET)", "\n", "# test_demonstrate_target_commands_one(TEST_DATASET_NONCE)", "\n", "# test_demonstrate_target_commands_two(TEST_DATASET)", "\n", "# test_demonstrate_target_commands_two(TEST_DATASET_NONCE)", "\n", "# test_demonstrate_target_commands_three(TEST_DATASET)", "\n", "# test_demonstrate_target_commands_three(TEST_DATASET_NONCE)", "\n", "# test_demonstrate_command_one(TEST_DATASET)", "\n", "# test_demonstrate_command_one(TEST_DATASET_NONCE)", "\n", "# test_demonstrate_command_two(TEST_DATASET)", "\n", "# test_demonstrate_command_two(TEST_DATASET_NONCE)", "\n", "# test_demonstrate_command_three(TEST_DATASET)", "\n", "# test_demonstrate_command_three(TEST_DATASET_NONCE)", "\n", "# test_demonstrate_command_four(TEST_DATASET)", "\n", "# test_demonstrate_command_four(TEST_DATASET_NONCE)", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_write_and_load_l_systems": [[1794, 1837], ["time.time", "GroundedScan.AdverbWorld", "dsl.AdverbWorld.populate_adverbs", "GroundedScan.MetaGrammar", "dsl.AdverbWorld._all_adverbs.items", "time.time", "logger.info", "random.randint", "random.randint", "random.randint", "random.randint", "random.randint", "GroundedScan.Position", "GroundedScan.Position", "dsl.AdverbWorld.generate_example", "adverb.to_representation", "GroundedScan.LSystem.from_representation", "dsl.AdverbWorld.generate_example", "max", "abs"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.populate_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.generate_example", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.to_representation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.from_representation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.generate_example", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.abs"], ["# test_demonstrate_command_five(TEST_DATASET_NONCE)", "\n", "# test_demonstrate_command_six(TEST_DATASET)", "\n", "# test_demonstrate_command_six(TEST_DATASET_NONCE)", "\n", "# test_find_referred_target_one(TEST_DATASET)", "\n", "# test_find_referred_target_one(TEST_DATASET_NONCE)", "\n", "# test_find_referred_target_two(TEST_DATASET)", "\n", "# test_find_referred_target_two(TEST_DATASET_NONCE)", "\n", "# test_generate_possible_targets_one(TEST_DATASET)", "\n", "# test_generate_possible_targets_one(TEST_DATASET_NONCE)", "\n", "# test_generate_possible_targets_two(TEST_DATASET)", "\n", "# test_generate_possible_targets_two(TEST_DATASET_NONCE)", "\n", "# test_generate_situations_one(TEST_DATASET)", "\n", "# test_generate_situations_one(TEST_DATASET_NONCE)", "\n", "# test_generate_situations_two(TEST_DATASET)", "\n", "# test_generate_situations_two(TEST_DATASET_NONCE)", "\n", "# test_generate_situations_three(TEST_DATASET)", "\n", "# test_generate_situations_three(TEST_DATASET_NONCE)", "\n", "# test_situation_representation_eq()", "\n", "# test_example_representation_eq(TEST_DATASET)", "\n", "# test_example_representation_eq(TEST_DATASET_NONCE)", "\n", "# test_example_representation(TEST_DATASET)", "\n", "# test_example_representation(TEST_DATASET_NONCE)", "\n", "# test_initialize_world(TEST_DATASET)", "\n", "# test_initialize_world(TEST_DATASET_NONCE)", "\n", "# test_image_representation_situations(TEST_DATASET)", "\n", "# test_image_representation_situations(TEST_DATASET_NONCE)", "\n", "# test_encode_situation(TEST_DATASET)", "\n", "# test_encode_situation(TEST_DATASET_NONCE)", "\n", "# test_k_shot_generalization(TEST_DATASET)", "\n", "# test_k_shot_generalization(TEST_DATASET_NONCE)", "\n", "# test_generate_manners()", "\n", "# test_apply_while_spinning()", "\n", "# test_apply_cautiously()", "\n", "# test_apply_hesitantly()", "\n", "# test_apply_while_zigzagging()", "\n", "# test_convert_sequence_to_actions()", "\n", "# test_dsl_gscan(TEST_DATASET)", "\n", "# test_get_num_push_pull_actions(TEST_DATASET)", "\n", "# test_gscan_examples(TEST_DATASET_2)", "\n", "# test_adverb_sampling(TEST_DATASET_2)", "\n", "# test_remove_out_of_grid(TEST_DATASET_2)", "\n", "# test_save_and_load_adverb_challenge()", "\n", "    ", "test_generate_adverb_challenge", "(", ")", "\n", "# test_assign_adverbs()", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_assign_adverbs": [[1839, 1876], ["time.time", "GroundedScan.AdverbWorld", "dsl.AdverbWorld.populate_adverbs", "dsl.AdverbWorld.assign_adverb_programs", "adverb_programs.items", "enumerate", "time.time", "logger.info", "all_adverb_programs.append", "all_adverb_types.append", "len", "enumerate", "dsl.AdverbWorld.get_adverb_program", "range", "len"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.populate_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.assign_adverb_programs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.get_adverb_program"], ["# shutil.rmtree(TEST_DIRECTORY)", "\n", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.run_all_tests": [[1878, 1948], ["dataset_test.test_generate_adverb_challenge"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_generate_adverb_challenge"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.Term.__init__": [[95, 101], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "function", ":", "str", ",", "args", ":", "tuple", ",", "weights", "=", "None", ",", "meta", "=", "None", ",", "specs", "=", "None", ")", ":", "\n", "        ", "self", ".", "function", "=", "function", "\n", "self", ".", "arguments", "=", "args", "\n", "self", ".", "weights", "=", "weights", "\n", "self", ".", "meta", "=", "meta", "\n", "self", ".", "specs", "=", "specs", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.Term.replace": [[102, 109], ["world.Term", "tuple"], "methods", ["None"], ["", "def", "replace", "(", "self", ",", "var_to_find", ":", "Variable", ",", "replace_by_var", ":", "Variable", ")", ":", "\n", "        ", "\"\"\"Find a variable `var_to_find` the arguments and replace it by `replace_by_var`.\"\"\"", "\n", "return", "Term", "(", "\n", "function", "=", "self", ".", "function", ",", "\n", "args", "=", "tuple", "(", "replace_by_var", "if", "variable", "==", "var_to_find", "else", "variable", "for", "variable", "in", "self", ".", "arguments", ")", ",", "\n", "specs", "=", "self", ".", "specs", ",", "\n", "meta", "=", "self", ".", "meta", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.Term.to_predicate": [[111, 120], ["None"], "methods", ["None"], ["", "def", "to_predicate", "(", "self", ",", "predicate", ":", "dict", ")", ":", "\n", "        ", "assert", "self", ".", "specs", "is", "not", "None", "\n", "output", "=", "self", ".", "function", "\n", "if", "self", ".", "specs", ".", "noun", ":", "\n", "            ", "predicate", "[", "\"noun\"", "]", "=", "output", "\n", "", "elif", "self", ".", "specs", ".", "adjective_type", "==", "SIZE", ":", "\n", "            ", "predicate", "[", "\"size\"", "]", "=", "output", "\n", "", "elif", "self", ".", "specs", ".", "adjective_type", "==", "COLOR", ":", "\n", "            ", "predicate", "[", "\"color\"", "]", "=", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.Term.__repr__": [[121, 126], ["parts.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "parts", "=", "[", "self", ".", "function", "]", "\n", "for", "variable", "in", "self", ".", "arguments", ":", "\n", "            ", "parts", ".", "append", "(", "\"{}:{}\"", ".", "format", "(", "variable", ".", "name", ",", "variable", ".", "sem_type", ".", "name", ")", ")", "\n", "", "return", "\"({})\"", ".", "format", "(", "\" \"", ".", "join", "(", "parts", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.__init__": [[135, 140], ["len"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "variables", ":", "Tuple", "[", "Variable", "]", ",", "terms", ":", "Tuple", "[", "Term", "]", ")", ":", "\n", "        ", "self", ".", "variables", "=", "variables", "\n", "self", ".", "terms", "=", "terms", "\n", "if", "len", "(", "variables", ")", ">", "0", ":", "\n", "            ", "self", ".", "head", "=", "variables", "[", "0", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.bind": [[141, 153], ["world.LogicalForm", "term.replace", "tuple"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.replace"], ["", "", "def", "bind", "(", "self", ",", "bind_var", ":", "Variable", ")", ":", "\n", "        ", "\"\"\"\n        Bind a variable to its head, e.g for 'kick the ball', 'kick' is the head and 'the ball' will be bind to it.\n        Or in the case of NP -> JJ NP, bind the JJ (adjective) to the head of the noun-phrase.\n        E.g. 'the big red square', bind 'big' to 'square'.\n        :param bind_var:\n        :return:\n        \"\"\"", "\n", "sub_var", ",", "variables_out", "=", "self", ".", "variables", "[", "0", "]", ",", "self", ".", "variables", "[", "1", ":", "]", "\n", "# assert sub_var.sem_type == bind_var.sem_type", "\n", "terms_out", "=", "[", "term", ".", "replace", "(", "sub_var", ",", "bind_var", ")", "for", "term", "in", "self", ".", "terms", "]", "\n", "return", "LogicalForm", "(", "variables", "=", "(", "bind_var", ",", ")", "+", "variables_out", ",", "terms", "=", "tuple", "(", "terms_out", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.select": [[154, 172], ["frozenset", "list", "set", "list", "world.LogicalForm", "len", "list.pop", "set", "tuple", "tuple", "list.append", "set.add", "list.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "select", "(", "self", ",", "variables", ":", "list", ",", "exclude", "=", "frozenset", "(", ")", ")", ":", "\n", "        ", "\"\"\"Select and return the sub-logical form of the variables in the variables list.\"\"\"", "\n", "queue", "=", "list", "(", "variables", ")", "\n", "used_vars", "=", "set", "(", ")", "\n", "terms_out", "=", "[", "]", "\n", "while", "len", "(", "queue", ")", ">", "0", ":", "\n", "            ", "var", "=", "queue", ".", "pop", "(", ")", "\n", "deps", "=", "[", "term", "for", "term", "in", "self", ".", "terms", "if", "term", ".", "function", "not", "in", "exclude", "and", "term", ".", "arguments", "[", "0", "]", "==", "var", "]", "\n", "for", "term", "in", "deps", ":", "\n", "                ", "terms_out", ".", "append", "(", "term", ")", "\n", "used_vars", ".", "add", "(", "var", ")", "\n", "for", "variable", "in", "term", ".", "arguments", "[", "1", ":", "]", ":", "\n", "                    ", "if", "variable", "not", "in", "used_vars", ":", "\n", "                        ", "queue", ".", "append", "(", "variable", ")", "\n", "\n", "", "", "", "", "vars_out", "=", "[", "var", "for", "var", "in", "self", ".", "variables", "if", "var", "in", "used_vars", "]", "\n", "terms_out", "=", "list", "(", "set", "(", "terms_out", ")", ")", "\n", "return", "LogicalForm", "(", "tuple", "(", "vars_out", ")", ",", "tuple", "(", "terms_out", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.to_predicate": [[173, 183], ["object_str.strip.strip.strip", "len", "term.to_predicate"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.to_predicate"], ["", "def", "to_predicate", "(", "self", ")", ":", "\n", "        ", "assert", "len", "(", "self", ".", "variables", ")", "==", "1", "\n", "predicate", "=", "{", "\"noun\"", ":", "\"\"", ",", "\"size\"", ":", "\"\"", ",", "\"color\"", ":", "\"\"", "}", "\n", "[", "term", ".", "to_predicate", "(", "predicate", ")", "for", "term", "in", "self", ".", "terms", "]", "\n", "object_str", "=", "\"\"", "\n", "if", "predicate", "[", "\"color\"", "]", ":", "\n", "            ", "object_str", "+=", "' '", "+", "predicate", "[", "\"color\"", "]", "\n", "", "object_str", "+=", "' '", "+", "predicate", "[", "\"noun\"", "]", "\n", "object_str", "=", "object_str", ".", "strip", "(", ")", "\n", "return", "object_str", ",", "predicate", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.__repr__": [[184, 186], ["repr"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "\"LF({})\"", ".", "format", "(", "\" ^ \"", ".", "join", "(", "[", "repr", "(", "term", ")", "for", "term", "in", "self", ".", "terms", "]", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.Situation.__init__": [[233, 241], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "grid_size", ":", "int", ",", "agent_position", ":", "Position", ",", "agent_direction", ":", "Direction", ",", "\n", "target_object", ":", "PositionedObject", ",", "placed_objects", ":", "List", "[", "PositionedObject", "]", ",", "carrying", "=", "None", ")", ":", "\n", "        ", "self", ".", "grid_size", "=", "grid_size", "\n", "self", ".", "agent_pos", "=", "agent_position", "# position is [col, row] (i.e. [x-axis, y-axis])", "\n", "self", ".", "agent_direction", "=", "agent_direction", "\n", "self", ".", "placed_objects", "=", "placed_objects", "\n", "self", ".", "carrying", "=", "carrying", "# The object the agent is carrying", "\n", "self", ".", "target_object", "=", "target_object", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.Situation.distance_to_target": [[242, 247], ["abs", "abs"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.abs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.abs"], ["", "@", "property", "\n", "def", "distance_to_target", "(", "self", ")", ":", "\n", "        ", "\"\"\"Number of grid steps to take to reach the target position from the agent position.\"\"\"", "\n", "return", "abs", "(", "self", ".", "agent_pos", ".", "column", "-", "self", ".", "target_object", ".", "position", ".", "column", ")", "+", "abs", "(", "self", ".", "agent_pos", ".", "row", "-", "self", ".", "target_object", ".", "position", ".", "row", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.Situation.direction_to_target": [[248, 256], ["min", "min", "max", "max"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.min", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.min", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max"], ["", "@", "property", "\n", "def", "direction_to_target", "(", "self", ")", ":", "\n", "        ", "\"\"\"Direction to the target in terms of north, east, south, north-east, etc. Needed for a grounded scan split.\"\"\"", "\n", "column_distance", "=", "self", ".", "target_object", ".", "position", ".", "column", "-", "self", ".", "agent_pos", ".", "column", "\n", "column_distance", "=", "min", "(", "max", "(", "-", "1", ",", "column_distance", ")", ",", "1", ")", "\n", "row_distance", "=", "self", ".", "agent_pos", ".", "row", "-", "self", ".", "target_object", ".", "position", ".", "row", "\n", "row_distance", "=", "min", "(", "max", "(", "-", "1", ",", "row_distance", ")", ",", "1", ")", "\n", "return", "DIR_VEC_TO_DIR", "[", "(", "column_distance", ",", "row_distance", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.Situation.to_dict": [[257, 266], ["Position"], "methods", ["None"], ["", "def", "to_dict", "(", "self", ")", "->", "dict", ":", "\n", "        ", "\"\"\"Represent this situation in a dictionary.\"\"\"", "\n", "return", "{", "\n", "\"agent_position\"", ":", "Position", "(", "column", "=", "self", ".", "agent_pos", "[", "0", "]", ",", "row", "=", "self", ".", "agent_pos", "[", "1", "]", ")", ",", "\n", "\"agent_direction\"", ":", "self", ".", "agent_direction", ",", "\n", "\"target_object\"", ":", "self", ".", "target_object", ",", "\n", "\"grid_size\"", ":", "self", ".", "grid_size", ",", "\n", "\"objects\"", ":", "self", ".", "placed_objects", ",", "\n", "\"carrying\"", ":", "self", ".", "carrying", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.Situation.to_representation": [[268, 280], ["world.position_to_repr", "world.positioned_object_to_repr", "str", "str", "world.positioned_object_to_repr", "world.object_to_repr", "enumerate"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.position_to_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.positioned_object_to_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.positioned_object_to_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.object_to_repr"], ["", "def", "to_representation", "(", "self", ")", "->", "dict", ":", "\n", "        ", "\"\"\"Represent this situation in serializable dict that can be written to a file.\"\"\"", "\n", "return", "{", "\n", "\"grid_size\"", ":", "self", ".", "grid_size", ",", "\n", "\"agent_position\"", ":", "position_to_repr", "(", "self", ".", "agent_pos", ")", ",", "\n", "\"agent_direction\"", ":", "DIR_TO_INT", "[", "self", ".", "agent_direction", "]", ",", "\n", "\"target_object\"", ":", "positioned_object_to_repr", "(", "self", ".", "target_object", ")", "if", "self", ".", "target_object", "else", "None", ",", "\n", "\"distance_to_target\"", ":", "str", "(", "self", ".", "distance_to_target", ")", "if", "self", ".", "target_object", "else", "None", ",", "\n", "\"direction_to_target\"", ":", "self", ".", "direction_to_target", "if", "self", ".", "target_object", "else", "None", ",", "\n", "\"placed_objects\"", ":", "{", "str", "(", "i", ")", ":", "positioned_object_to_repr", "(", "placed_object", ")", "for", "i", ",", "placed_object", "\n", "in", "enumerate", "(", "self", ".", "placed_objects", ")", "}", ",", "\n", "\"carrying_object\"", ":", "object_to_repr", "(", "self", ".", "carrying", ")", "if", "self", ".", "carrying", "else", "None", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.Situation.from_representation": [[282, 298], ["placed_object_reps.values", "cls", "placed_objects.append", "world.parse_positioned_object_repr", "world.parse_position_repr", "world.parse_positioned_object_repr", "world.parse_object_repr"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.parse_positioned_object_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_position_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.parse_positioned_object_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.parse_object_repr"], ["", "@", "classmethod", "\n", "def", "from_representation", "(", "cls", ",", "situation_representation", ":", "dict", ")", ":", "\n", "        ", "\"\"\"Initialize this class by some situation as represented by .to_representation().\"\"\"", "\n", "target_object", "=", "situation_representation", "[", "\"target_object\"", "]", "\n", "carrying_object", "=", "situation_representation", "[", "\"carrying_object\"", "]", "\n", "placed_object_reps", "=", "situation_representation", "[", "\"placed_objects\"", "]", "\n", "placed_objects", "=", "[", "]", "\n", "for", "placed_object_rep", "in", "placed_object_reps", ".", "values", "(", ")", ":", "\n", "            ", "placed_objects", ".", "append", "(", "parse_positioned_object_repr", "(", "placed_object_rep", ")", ")", "\n", "", "situation", "=", "cls", "(", "grid_size", "=", "situation_representation", "[", "\"grid_size\"", "]", ",", "\n", "agent_position", "=", "parse_position_repr", "(", "situation_representation", "[", "\"agent_position\"", "]", ")", ",", "\n", "agent_direction", "=", "INT_TO_DIR", "[", "situation_representation", "[", "\"agent_direction\"", "]", "]", ",", "\n", "target_object", "=", "parse_positioned_object_repr", "(", "target_object", ")", "if", "target_object", "else", "None", ",", "\n", "placed_objects", "=", "placed_objects", ",", "\n", "carrying", "=", "parse_object_repr", "(", "carrying_object", ")", "if", "carrying_object", "else", "None", ")", "\n", "return", "situation", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.Situation.__eq__": [[299, 320], ["other.to_representation", "world.Situation.to_representation", "world.Situation.__eq__.compare_nested_dict"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.to_representation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.to_representation"], ["", "def", "__eq__", "(", "self", ",", "other", ")", "->", "bool", ":", "\n", "        ", "\"\"\"Recursive function to compare this situation to another and determine if they are equivalent.\"\"\"", "\n", "representation_other", "=", "other", ".", "to_representation", "(", ")", "\n", "representation_self", "=", "self", ".", "to_representation", "(", ")", "\n", "\n", "def", "compare_nested_dict", "(", "value_1", ",", "value_2", ",", "unequal_values", ")", ":", "\n", "            ", "if", "len", "(", "unequal_values", ")", ">", "0", ":", "\n", "                ", "return", "\n", "", "if", "isinstance", "(", "value_1", ",", "dict", ")", ":", "\n", "                ", "for", "k", ",", "v_1", "in", "value_1", ".", "items", "(", ")", ":", "\n", "                    ", "v_2", "=", "value_2", ".", "get", "(", "k", ")", "\n", "if", "not", "v_2", "and", "v_1", ":", "\n", "                        ", "unequal_values", ".", "append", "(", "False", ")", "\n", "", "compare_nested_dict", "(", "v_1", ",", "v_2", ",", "unequal_values", ")", "\n", "", "", "else", ":", "\n", "                ", "if", "value_1", "!=", "value_2", ":", "\n", "                    ", "unequal_values", ".", "append", "(", "False", ")", "\n", "", "", "return", "\n", "", "result", "=", "[", "]", "\n", "compare_nested_dict", "(", "representation_self", ",", "representation_other", ",", "result", ")", "\n", "return", "not", "len", "(", "result", ")", ">", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.__init__": [[331, 368], ["set", "len", "set", "len", "list", "len", "world.ObjectVocabulary._object_class.update", "world.ObjectVocabulary.generate_objects", "set", "range", "enumerate", "range", "range", "itertools.product"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.generate_objects", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set"], ["def", "__init__", "(", "self", ",", "shapes", ":", "List", "[", "str", "]", ",", "colors", ":", "List", "[", "str", "]", ",", "min_size", ":", "int", ",", "max_size", ":", "int", ")", ":", "\n", "        ", "\"\"\"\n        :param shapes: a list of string names for nouns.\n        :param colors: a list of string names for colors.\n        :param min_size: minimum object size\n        :param max_size: maximum object size\n        \"\"\"", "\n", "assert", "self", ".", "SIZES", "[", "0", "]", "<=", "min_size", "<=", "max_size", "<=", "self", ".", "SIZES", "[", "-", "1", "]", ",", "\"Unsupported object sizes (min: {}, max: {}) specified.\"", ".", "format", "(", "min_size", ",", "max_size", ")", "\n", "self", ".", "_min_size", "=", "min_size", "\n", "self", ".", "_max_size", "=", "max_size", "\n", "\n", "# Translation from shape nouns to shapes.", "\n", "self", ".", "_shapes", "=", "set", "(", "shapes", ")", "\n", "self", ".", "_n_shapes", "=", "len", "(", "self", ".", "_shapes", ")", "\n", "self", ".", "_colors", "=", "set", "(", "colors", ")", "\n", "self", ".", "_n_colors", "=", "len", "(", "self", ".", "_colors", ")", "\n", "self", ".", "_idx_to_shapes_and_colors", "=", "shapes", "+", "colors", "\n", "self", ".", "_shapes_and_colors_to_idx", "=", "{", "token", ":", "i", "for", "i", ",", "token", "in", "enumerate", "(", "self", ".", "_idx_to_shapes_and_colors", ")", "}", "\n", "self", ".", "_sizes", "=", "list", "(", "range", "(", "min_size", ",", "max_size", "+", "1", ")", ")", "\n", "\n", "# Also size specification for 'average' size, e.g. if adjectives are small and big, 3 sizes exist.", "\n", "self", ".", "_n_sizes", "=", "len", "(", "self", ".", "_sizes", ")", "\n", "assert", "(", "self", ".", "_n_sizes", "%", "2", ")", "==", "0", ",", "\"Please specify an even amount of sizes \"", "\" (needs to be split in 2 classes.)\"", "\n", "self", ".", "_middle_size", "=", "(", "max_size", "+", "min_size", ")", "//", "2", "\n", "\n", "# Make object classes.", "\n", "self", ".", "_object_class", "=", "{", "i", ":", "\"light\"", "for", "i", "in", "range", "(", "min_size", ",", "self", ".", "_middle_size", "+", "1", ")", "}", "\n", "self", ".", "_heavy_weights", "=", "{", "i", ":", "\"heavy\"", "for", "i", "in", "range", "(", "self", ".", "_middle_size", "+", "1", ",", "max_size", "+", "1", ")", "}", "\n", "self", ".", "_object_class", ".", "update", "(", "self", ".", "_heavy_weights", ")", "\n", "\n", "# Prepare object vectors.", "\n", "self", ".", "_object_vector_size", "=", "self", ".", "_n_shapes", "+", "self", ".", "_n_colors", "+", "self", ".", "_n_sizes", "\n", "self", ".", "_object_vectors", "=", "self", ".", "generate_objects", "(", ")", "\n", "self", ".", "_possible_colored_objects", "=", "set", "(", "[", "color", "+", "' '", "+", "shape", "for", "color", ",", "shape", "in", "itertools", ".", "product", "(", "self", ".", "_colors", ",", "\n", "self", ".", "_shapes", ")", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.has_object": [[369, 371], ["None"], "methods", ["None"], ["", "def", "has_object", "(", "self", ",", "shape", ":", "str", ",", "color", ":", "str", ",", "size", ":", "int", ")", ":", "\n", "        ", "return", "shape", "in", "self", ".", "_shapes", "and", "color", "in", "self", ".", "_colors", "and", "size", "in", "self", ".", "_sizes", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.object_in_class": [[372, 374], ["None"], "methods", ["None"], ["", "def", "object_in_class", "(", "self", ",", "size", ":", "int", ")", ":", "\n", "        ", "return", "self", ".", "_object_class", "[", "size", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.num_object_attributes": [[375, 379], ["len"], "methods", ["None"], ["", "@", "property", "\n", "def", "num_object_attributes", "(", "self", ")", ":", "\n", "        ", "\"\"\"Dimension of object vectors is one hot for shapes and colors + 1 ordinal dimension for size.\"\"\"", "\n", "return", "len", "(", "self", ".", "_idx_to_shapes_and_colors", ")", "+", "self", ".", "_n_sizes", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.smallest_size": [[380, 383], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "smallest_size", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_min_size", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.largest_size": [[384, 387], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "largest_size", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_max_size", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.object_shapes": [[388, 391], ["world.ObjectVocabulary._shapes.copy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "@", "property", "\n", "def", "object_shapes", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_shapes", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.object_sizes": [[392, 395], ["world.ObjectVocabulary._sizes.copy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "@", "property", "\n", "def", "object_sizes", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_sizes", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.object_colors": [[396, 399], ["world.ObjectVocabulary._colors.copy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "@", "property", "\n", "def", "object_colors", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_colors", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.all_objects": [[400, 403], ["itertools.product"], "methods", ["None"], ["", "@", "property", "\n", "def", "all_objects", "(", "self", ")", ":", "\n", "        ", "return", "product", "(", "self", ".", "object_sizes", ",", "self", ".", "object_colors", ",", "self", ".", "object_shapes", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.sample_size": [[404, 406], ["random.choice"], "methods", ["None"], ["", "def", "sample_size", "(", "self", ")", ":", "\n", "        ", "return", "random", ".", "choice", "(", "self", ".", "_sizes", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.sample_color": [[407, 409], ["random.choice", "list"], "methods", ["None"], ["", "def", "sample_color", "(", "self", ")", ":", "\n", "        ", "return", "random", ".", "choice", "(", "list", "(", "self", ".", "_colors", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.get_object_vector": [[410, 413], ["world.ObjectVocabulary.has_object"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.has_object"], ["", "def", "get_object_vector", "(", "self", ",", "shape", ":", "str", ",", "color", ":", "str", ",", "size", ":", "int", ")", "->", "np", ".", "ndarray", ":", "\n", "        ", "assert", "self", ".", "has_object", "(", "shape", ",", "color", ",", "size", ")", ",", "\"Trying to get an unavailable object vector from the vocabulary/\"", "\n", "return", "self", ".", "_object_vectors", "[", "shape", "]", "[", "color", "]", "[", "size", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.generate_objects": [[414, 434], ["itertools.product", "GroundedScan.helpers.one_hot", "object_to_object_vector.keys", "object_to_object_vector[].keys", "GroundedScan.helpers.one_hot", "GroundedScan.helpers.one_hot"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.one_hot", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.one_hot", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.one_hot"], ["", "def", "generate_objects", "(", "self", ")", "->", "Dict", "[", "str", ",", "Dict", "[", "str", ",", "Dict", "[", "str", ",", "np", ".", "ndarray", "]", "]", "]", ":", "\n", "        ", "\"\"\"\n        An object vector is built as follows: the first entry is an ordinal entry defining the size (from 1 the smallest\n        to 4 the largest), then 2 entries define a one-hot vector over shape, the last two entries define a one-hot\n        vector over color. A red circle of size 1 could then be: [1 0 1 0 1], meaning a blue square of size 2 would be\n        [2 1 0 1 0].\n        \"\"\"", "\n", "object_to_object_vector", "=", "{", "}", "\n", "for", "size", ",", "color", ",", "shape", "in", "itertools", ".", "product", "(", "self", ".", "_sizes", ",", "self", ".", "_colors", ",", "self", ".", "_shapes", ")", ":", "\n", "            ", "object_vector", "=", "one_hot", "(", "self", ".", "_object_vector_size", ",", "size", "-", "1", ")", "+", "one_hot", "(", "self", ".", "_object_vector_size", ",", "self", ".", "_shapes_and_colors_to_idx", "[", "color", "]", "+", "self", ".", "_n_sizes", ")", "+", "one_hot", "(", "self", ".", "_object_vector_size", ",", "self", ".", "_shapes_and_colors_to_idx", "[", "shape", "]", "+", "self", ".", "_n_sizes", ")", "\n", "# object_vector = np.concatenate(([size], object_vector))", "\n", "if", "shape", "not", "in", "object_to_object_vector", ".", "keys", "(", ")", ":", "\n", "                ", "object_to_object_vector", "[", "shape", "]", "=", "{", "}", "\n", "", "if", "color", "not", "in", "object_to_object_vector", "[", "shape", "]", ".", "keys", "(", ")", ":", "\n", "                ", "object_to_object_vector", "[", "shape", "]", "[", "color", "]", "=", "{", "}", "\n", "", "object_to_object_vector", "[", "shape", "]", "[", "color", "]", "[", "size", "]", "=", "object_vector", "\n", "\n", "", "return", "object_to_object_vector", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.__init__": [[448, 491], ["zip", "len", "set", "set", "GroundedScan.gym_minigrid.minigrid.MiniGridEnv.__init__", "set().issubset", "set", "world.World._gen_manners", "GroundedScan.gym_minigrid.minigrid.IDX_TO_OBJECT.keys", "GroundedScan.gym_minigrid.minigrid.OBJECT_TO_IDX.keys", "set"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World._gen_manners", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set"], ["def", "__init__", "(", "self", ",", "grid_size", ":", "int", ",", "shapes", ":", "List", "[", "str", "]", ",", "colors", ":", "List", "[", "str", "]", ",", "manners", ":", "List", "[", "str", "]", ",", "\n", "object_vocabulary", ":", "ObjectVocabulary", ",", "\n", "save_directory", ":", "str", ")", ":", "\n", "# Some checks on the input", "\n", "        ", "for", "shape", ",", "color", "in", "zip", "(", "shapes", ",", "colors", ")", ":", "\n", "            ", "assert", "shape", "in", "self", ".", "AVAILABLE_SHAPES", ",", "\"Specified shape {} not implemented in minigrid env.\"", ".", "format", "(", "shape", ")", "\n", "assert", "color", "in", "self", ".", "AVAILABLE_COLORS", ",", "\"Specified color {}, not implemented in minigrid env.\"", ".", "format", "(", "color", ")", "\n", "\n", "# See whether the semantic manners in the vocabulary are more than the available manners", "\n", "", "self", ".", "min_manner_length", "=", "2", "\n", "self", ".", "max_manner_length", "=", "5", "\n", "if", "not", "set", "(", "manners", ")", ".", "issubset", "(", "self", ".", "AVAILABLE_MANNERS", ")", ":", "\n", "            ", "set_manners", "=", "set", "(", "manners", ")", "\n", "left_over_manners", "=", "set_manners", "-", "self", ".", "AVAILABLE_MANNERS", "\n", "self", ".", "left_over_manners", "=", "{", "manner", ":", "[", "]", "for", "manner", "in", "left_over_manners", "}", "\n", "self", ".", "_gen_manners", "(", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "left_over_manners", "=", "{", "}", "\n", "\n", "# Define the grid world.", "\n", "", "self", ".", "grid_size", "=", "grid_size", "\n", "\n", "# Column, row", "\n", "self", ".", "agent_start_pos", "=", "(", "0", ",", "0", ")", "\n", "self", ".", "agent_start_dir", "=", "DIR_TO_INT", "[", "EAST", "]", "\n", "self", ".", "mission", "=", "None", "\n", "\n", "# Generate the object vocabulary.", "\n", "self", ".", "_object_vocabulary", "=", "object_vocabulary", "\n", "self", ".", "num_available_objects", "=", "len", "(", "IDX_TO_OBJECT", ".", "keys", "(", ")", ")", "\n", "self", ".", "available_objects", "=", "set", "(", "OBJECT_TO_IDX", ".", "keys", "(", ")", ")", "\n", "\n", "# Data structures for keeping track of the current state of the world.", "\n", "self", ".", "_placed_object_list", "=", "[", "]", "\n", "self", ".", "_target_object", "=", "None", "\n", "self", ".", "_observed_commands", "=", "[", "]", "\n", "self", ".", "_observed_situations", "=", "[", "]", "\n", "self", ".", "_occupied_positions", "=", "set", "(", ")", "\n", "# Hash table for looking up locations of objects based on partially formed references (e.g. find the location(s)", "\n", "# of a red cylinder when the grid has both a big red cylinder and a small red cylinder.)", "\n", "self", ".", "_object_lookup_table", "=", "{", "}", "\n", "self", ".", "save_directory", "=", "save_directory", "\n", "super", "(", ")", ".", "__init__", "(", "grid_size", "=", "grid_size", ",", "max_steps", "=", "4", "*", "grid_size", "*", "grid_size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World._gen_manners": [[492, 498], ["world.World.left_over_manners.items", "random.randint", "sequence.extend", "random.choices"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend"], ["", "def", "_gen_manners", "(", "self", ")", ":", "\n", "        ", "non_moving_actions", "=", "[", "\"turn left\"", ",", "\"turn right\"", ",", "\"stay\"", "]", "\n", "for", "manner", ",", "sequence", "in", "self", ".", "left_over_manners", ".", "items", "(", ")", ":", "\n", "            ", "num_actions", "=", "random", ".", "randint", "(", "self", ".", "min_manner_length", ",", "self", ".", "max_manner_length", ")", "\n", "sequence", ".", "extend", "(", "random", ".", "choices", "(", "non_moving_actions", ",", "k", "=", "num_actions", ")", ")", "\n", "", "return", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World._gen_grid": [[499, 510], ["GroundedScan.gym_minigrid.minigrid.Grid", "world.World.place_agent", "world.World._occupied_positions.add"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.place_agent"], ["", "def", "_gen_grid", "(", "self", ",", "width", ",", "height", ")", ":", "\n", "# Create an empty grid", "\n", "        ", "self", ".", "grid", "=", "Grid", "(", "width", ",", "height", ",", "depth", "=", "self", ".", "_object_vocabulary", ".", "num_object_attributes", ")", "\n", "\n", "# Place the agent", "\n", "if", "self", ".", "agent_start_pos", "is", "not", "None", ":", "\n", "            ", "self", ".", "agent_pos", "=", "self", ".", "agent_start_pos", "\n", "self", ".", "agent_dir", "=", "self", ".", "agent_start_dir", "\n", "", "else", ":", "\n", "            ", "position", "=", "self", ".", "place_agent", "(", ")", "\n", "self", ".", "_occupied_positions", ".", "add", "(", "position", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.initialize": [[511, 535], ["world.World.clear_situation", "world.World.place_agent_at", "world.World.place_object", "world.World.create_object", "numpy.array", "world.World._object_vocabulary.get_object_vector"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.place_agent_at", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.place_object", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.create_object", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.get_object_vector"], ["", "", "def", "initialize", "(", "self", ",", "objects", ":", "List", "[", "Tuple", "[", "Object", ",", "Position", "]", "]", ",", "agent_position", ":", "Position", ",", "agent_direction", ":", "Direction", ",", "\n", "target_object", ":", "PositionedObject", ",", "carrying", ":", "Object", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n        Create a grid world by placing the objects that are passed as an argument at the specified locations and the\n        agent at the specified location.\n        \"\"\"", "\n", "self", ".", "clear_situation", "(", ")", "\n", "self", ".", "agent_dir", "=", "DIR_TO_INT", "[", "agent_direction", "]", "\n", "self", ".", "place_agent_at", "(", "agent_position", ")", "\n", "self", ".", "_target_object", "=", "target_object", "\n", "for", "current_object", ",", "current_position", "in", "objects", ":", "\n", "            ", "target", "=", "False", "\n", "if", "target_object", ":", "\n", "                ", "if", "target_object", ".", "position", "==", "current_position", ":", "\n", "                    ", "target", "=", "True", "\n", "", "", "self", ".", "place_object", "(", "current_object", ",", "current_position", ",", "target", "=", "target", ")", "\n", "", "if", "carrying", ":", "\n", "            ", "carrying_object", "=", "self", ".", "create_object", "(", "carrying", ",", "\n", "self", ".", "_object_vocabulary", ".", "get_object_vector", "(", "carrying", ".", "shape", ",", "\n", "carrying", ".", "color", ",", "\n", "carrying", ".", "size", ")", ")", "\n", "self", ".", "carrying", "=", "carrying_object", "\n", "self", ".", "carrying", ".", "cur_pos", "=", "np", ".", "array", "(", "[", "-", "1", ",", "-", "1", "]", ")", "\n", "self", ".", "carrying", ".", "cur_pos", "=", "self", ".", "agent_pos", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.create_object": [[536, 551], ["GroundedScan.gym_minigrid.minigrid.Circle", "GroundedScan.gym_minigrid.minigrid.Square", "world.World._object_vocabulary.object_in_class", "GroundedScan.gym_minigrid.minigrid.Cylinder", "ValueError", "world.World._object_vocabulary.object_in_class", "world.World._object_vocabulary.object_in_class"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.object_in_class", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.object_in_class", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.object_in_class"], ["", "", "def", "create_object", "(", "self", ",", "object_spec", ":", "Object", ",", "object_vector", ":", "np", ".", "ndarray", ",", "target", "=", "False", ")", ":", "\n", "        ", "if", "object_spec", ".", "shape", "==", "\"circle\"", ":", "\n", "            ", "return", "Circle", "(", "object_spec", ".", "color", ",", "size", "=", "object_spec", ".", "size", ",", "vector_representation", "=", "object_vector", ",", "\n", "object_representation", "=", "object_spec", ",", "target", "=", "target", ",", "\n", "weight", "=", "self", ".", "_object_vocabulary", ".", "object_in_class", "(", "object_spec", ".", "size", ")", ")", "\n", "", "elif", "object_spec", ".", "shape", "==", "\"square\"", ":", "\n", "            ", "return", "Square", "(", "object_spec", ".", "color", ",", "size", "=", "object_spec", ".", "size", ",", "vector_representation", "=", "object_vector", ",", "\n", "object_representation", "=", "object_spec", ",", "target", "=", "target", ",", "\n", "weight", "=", "self", ".", "_object_vocabulary", ".", "object_in_class", "(", "object_spec", ".", "size", ")", ")", "\n", "", "elif", "object_spec", ".", "shape", "==", "\"cylinder\"", ":", "\n", "            ", "return", "Cylinder", "(", "object_spec", ".", "color", ",", "size", "=", "object_spec", ".", "size", ",", "vector_representation", "=", "object_vector", ",", "\n", "object_representation", "=", "object_spec", ",", "\n", "weight", "=", "self", ".", "_object_vocabulary", ".", "object_in_class", "(", "object_spec", ".", "size", ")", ")", "\n", "", "else", ":", "\n", "            ", "raise", "ValueError", "(", "\"Trying to create an object shape {} that is not implemented.\"", ".", "format", "(", "object_spec", ".", "shape", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.position_taken": [[552, 554], ["world.World.grid.get"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "", "def", "position_taken", "(", "self", ",", "position", ":", "Position", ")", ":", "\n", "        ", "return", "self", ".", "grid", ".", "get", "(", "position", ".", "column", ",", "position", ".", "row", ")", "is", "not", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.within_grid": [[555, 560], ["None"], "methods", ["None"], ["", "def", "within_grid", "(", "self", ",", "position", ":", "Position", ")", ":", "\n", "        ", "if", "0", "<=", "position", ".", "row", "<", "self", ".", "grid_size", "and", "0", "<=", "position", ".", "column", "<", "self", ".", "grid_size", ":", "\n", "            ", "return", "True", "\n", "", "else", ":", "\n", "            ", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.place_agent_at": [[561, 567], ["world.World.position_taken", "world.World.place_agent", "world.World._occupied_positions.add", "ValueError"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.position_taken", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.place_agent"], ["", "", "def", "place_agent_at", "(", "self", ",", "position", ":", "Position", ")", ":", "\n", "        ", "if", "not", "self", ".", "position_taken", "(", "position", ")", ":", "\n", "            ", "self", ".", "place_agent", "(", "top", "=", "(", "position", ".", "column", ",", "position", ".", "row", ")", ",", "size", "=", "(", "1", ",", "1", ")", ",", "rand_dir", "=", "False", ")", "\n", "self", ".", "_occupied_positions", ".", "add", "(", "(", "position", ".", "column", ",", "position", ".", "row", ")", ")", "\n", "", "else", ":", "\n", "            ", "raise", "ValueError", "(", "\"Trying to place agent on cell that is already taken.\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.sample_position": [[568, 574], ["random.sample().pop", "Position", "itertools.product", "random.sample", "list", "list", "range", "range"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample"], ["", "", "def", "sample_position", "(", "self", ")", "->", "Position", ":", "\n", "        ", "available_positions", "=", "[", "(", "row", ",", "col", ")", "for", "row", ",", "col", "in", "itertools", ".", "product", "(", "list", "(", "range", "(", "self", ".", "grid_size", ")", ")", ",", "\n", "list", "(", "range", "(", "self", ".", "grid_size", ")", ")", ")", "\n", "if", "(", "col", ",", "row", ")", "not", "in", "self", ".", "_occupied_positions", "]", "\n", "sampled_position", "=", "random", ".", "sample", "(", "available_positions", ",", "1", ")", ".", "pop", "(", ")", "\n", "return", "Position", "(", "row", "=", "sampled_position", "[", "0", "]", ",", "column", "=", "sampled_position", "[", "1", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.min_distance_from_edge": [[575, 579], ["min", "min", "min"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.min", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.min", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.min"], ["", "def", "min_distance_from_edge", "(", "self", ",", "position", ":", "Position", ")", ":", "\n", "        ", "row_distance", "=", "min", "(", "self", ".", "grid_size", "-", "position", ".", "row", ",", "position", ".", "row", ")", "\n", "column_distance", "=", "min", "(", "self", ".", "grid_size", "-", "position", ".", "column", ",", "position", ".", "column", ")", "\n", "return", "min", "(", "row_distance", ",", "column_distance", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.sample_position_steps_from_edge": [[580, 590], ["random.sample().pop", "Position", "itertools.product", "world.World.min_distance_from_edge", "actual_available_positions.append", "random.sample", "list", "list", "Position", "range", "range"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.min_distance_from_edge", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample"], ["", "def", "sample_position_steps_from_edge", "(", "self", ",", "distance_from_edge", "=", "1", ")", "->", "Position", ":", "\n", "        ", "available_positions", "=", "[", "(", "row", ",", "col", ")", "for", "row", ",", "col", "in", "itertools", ".", "product", "(", "list", "(", "range", "(", "self", ".", "grid_size", ")", ")", ",", "\n", "list", "(", "range", "(", "self", ".", "grid_size", ")", ")", ")", "\n", "if", "(", "row", ",", "col", ")", "not", "in", "self", ".", "_occupied_positions", "]", "\n", "actual_available_positions", "=", "[", "]", "\n", "for", "row", ",", "col", "in", "available_positions", ":", "\n", "            ", "if", "self", ".", "min_distance_from_edge", "(", "Position", "(", "row", "=", "row", ",", "column", "=", "col", ")", ")", "<=", "distance_from_edge", ":", "\n", "                ", "actual_available_positions", ".", "append", "(", "(", "row", ",", "col", ")", ")", "\n", "", "", "sampled_position", "=", "random", ".", "sample", "(", "actual_available_positions", ",", "1", ")", ".", "pop", "(", ")", "\n", "return", "Position", "(", "row", "=", "sampled_position", "[", "0", "]", ",", "column", "=", "sampled_position", "[", "1", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.sample_position_conditioned": [[591, 608], ["range", "random.sample().pop", "Position", "range", "available_positions.append", "random.sample"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample"], ["", "def", "sample_position_conditioned", "(", "self", ",", "north", ",", "east", ",", "south", ",", "west", ")", ":", "\n", "        ", "\"\"\"\n        Specify for each direction how many steps should be free (i.e. before hitting wall) in that direction.\n        \"\"\"", "\n", "assert", "north", "==", "0", "or", "south", "==", "0", ",", "\"Can't take steps in both North and South direction\"", "\n", "assert", "east", "==", "0", "or", "west", "==", "0", ",", "\"Can't take steps in both East and West direction\"", "\n", "\n", "max_col", "=", "self", ".", "grid_size", "-", "east", "if", "east", ">", "0", "else", "self", ".", "grid_size", "-", "1", "\n", "min_col", "=", "west", "-", "1", "if", "west", ">", "0", "else", "0", "\n", "max_row", "=", "self", ".", "grid_size", "-", "south", "if", "south", ">", "0", "else", "self", ".", "grid_size", "-", "1", "\n", "min_row", "=", "north", "-", "1", "if", "north", ">", "0", "else", "0", "\n", "available_positions", "=", "[", "]", "\n", "for", "col", "in", "range", "(", "min_col", ",", "max_col", "+", "1", ")", ":", "\n", "            ", "for", "row", "in", "range", "(", "min_row", ",", "max_row", "+", "1", ")", ":", "\n", "                ", "available_positions", ".", "append", "(", "(", "row", ",", "col", ")", ")", "\n", "", "", "sampled_position", "=", "random", ".", "sample", "(", "available_positions", ",", "1", ")", ".", "pop", "(", ")", "\n", "return", "Position", "(", "row", "=", "sampled_position", "[", "0", "]", ",", "column", "=", "sampled_position", "[", "1", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.place_object": [[609, 635], ["world.World.position_taken", "world.World.within_grid", "IndexError", "print", "world.World._object_vocabulary.get_object_vector", "PositionedObject", "world.World.place_obj", "world.World._placed_object_list.append", "world.World._add_object_to_lookup_table", "world.World._occupied_positions.add", "world.World.create_object"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.position_taken", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.within_grid", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.get_object_vector", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.place_obj", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World._add_object_to_lookup_table", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.create_object"], ["", "def", "place_object", "(", "self", ",", "object_spec", ":", "Object", ",", "position", ":", "Position", ",", "target", "=", "False", ")", ":", "\n", "        ", "if", "not", "self", ".", "within_grid", "(", "position", ")", ":", "\n", "            ", "raise", "IndexError", "(", "\"Trying to place object '{}' outside of grid of size {}.\"", ".", "format", "(", "\n", "object_spec", ".", "shape", ",", "self", ".", "grid_size", ")", ")", "\n", "# Object already placed at this location", "\n", "", "if", "self", ".", "position_taken", "(", "position", ")", ":", "\n", "            ", "print", "(", "\"WARNING: attempt to place two objects at location ({}, {}), but overlapping objects not \"", "\n", "\"supported. Skipping object.\"", ".", "format", "(", "position", ".", "row", ",", "position", ".", "column", ")", ")", "\n", "", "else", ":", "\n", "            ", "object_vector", "=", "self", ".", "_object_vocabulary", ".", "get_object_vector", "(", "shape", "=", "object_spec", ".", "shape", ",", "color", "=", "object_spec", ".", "color", ",", "\n", "size", "=", "object_spec", ".", "size", ")", "\n", "positioned_object", "=", "PositionedObject", "(", "object", "=", "object_spec", ",", "position", "=", "position", ",", "vector", "=", "object_vector", ")", "\n", "self", ".", "place_obj", "(", "self", ".", "create_object", "(", "object_spec", ",", "object_vector", ",", "target", "=", "target", ")", ",", "\n", "top", "=", "(", "position", ".", "column", ",", "position", ".", "row", ")", ",", "size", "=", "(", "1", ",", "1", ")", ")", "\n", "\n", "# Add to list that keeps track of all objects currently positioned on the grid.", "\n", "self", ".", "_placed_object_list", ".", "append", "(", "positioned_object", ")", "\n", "\n", "# Adjust the object lookup table accordingly.", "\n", "self", ".", "_add_object_to_lookup_table", "(", "positioned_object", ")", "\n", "\n", "# Add to occupied positions:", "\n", "self", ".", "_occupied_positions", ".", "add", "(", "(", "position", ".", "column", ",", "position", ".", "row", ")", ")", "\n", "\n", "if", "target", ":", "\n", "                ", "self", ".", "_target_object", "=", "positioned_object", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World._add_object_to_lookup_table": [[636, 653], ["GroundedScan.helpers.generate_possible_object_names", "[].append", "world.World._object_lookup_table.keys", "world.World._object_lookup_table[].keys"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.generate_possible_object_names", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "", "", "def", "_add_object_to_lookup_table", "(", "self", ",", "positioned_object", ":", "PositionedObject", ")", ":", "\n", "        ", "object_size", "=", "positioned_object", ".", "object", ".", "size", "\n", "object_color", "=", "positioned_object", ".", "object", ".", "color", "\n", "object_shape", "=", "positioned_object", ".", "object", ".", "shape", "\n", "\n", "# Generate all possible names", "\n", "object_names", "=", "generate_possible_object_names", "(", "color", "=", "object_color", ",", "shape", "=", "object_shape", ")", "\n", "for", "possible_object_name", "in", "object_names", ":", "\n", "            ", "if", "possible_object_name", "not", "in", "self", ".", "_object_lookup_table", ".", "keys", "(", ")", ":", "\n", "                ", "self", ".", "_object_lookup_table", "[", "possible_object_name", "]", "=", "{", "}", "\n", "\n", "# This part allows for multiple exactly the same objects (e.g. 2 small red circles) to be on the grid.", "\n", "", "if", "positioned_object", ".", "object", ".", "size", "not", "in", "self", ".", "_object_lookup_table", "[", "possible_object_name", "]", ".", "keys", "(", ")", ":", "\n", "                ", "self", ".", "_object_lookup_table", "[", "possible_object_name", "]", "=", "{", "\n", "size", ":", "[", "]", "for", "size", "in", "self", ".", "_object_vocabulary", ".", "object_sizes", "}", "\n", "", "self", ".", "_object_lookup_table", "[", "possible_object_name", "]", "[", "object_size", "]", ".", "append", "(", "\n", "positioned_object", ".", "position", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World._remove_object": [[654, 673], ["enumerate", "world.World._remove_object_from_lookup_table", "world.World.grid.get", "world.World.grid.set", "world.World._occupied_positions.remove"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World._remove_object_from_lookup_table", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set"], ["", "", "def", "_remove_object", "(", "self", ",", "target_position", ":", "Position", ")", "->", "PositionedObject", ":", "\n", "# remove from placed_object_list", "\n", "        ", "target_object", "=", "None", "\n", "for", "i", ",", "positioned_object", "in", "enumerate", "(", "self", ".", "_placed_object_list", ")", ":", "\n", "            ", "if", "positioned_object", ".", "position", "==", "target_position", ":", "\n", "                ", "target_object", "=", "self", ".", "_placed_object_list", "[", "i", "]", "\n", "del", "self", ".", "_placed_object_list", "[", "i", "]", "\n", "break", "\n", "\n", "# remove from object_lookup Table", "\n", "", "", "self", ".", "_remove_object_from_lookup_table", "(", "target_object", ")", "\n", "\n", "# remove from gym grid", "\n", "self", ".", "grid", ".", "get", "(", "target_position", ".", "column", ",", "target_position", ".", "row", ")", "\n", "self", ".", "grid", ".", "set", "(", "target_position", ".", "column", ",", "target_position", ".", "row", ",", "None", ")", "\n", "\n", "self", ".", "_occupied_positions", ".", "remove", "(", "(", "target_position", ".", "column", ",", "target_position", ".", "row", ")", ")", "\n", "\n", "return", "target_object", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World._remove_object_from_lookup_table": [[674, 680], ["GroundedScan.helpers.generate_possible_object_names", "[].remove"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.generate_possible_object_names"], ["", "def", "_remove_object_from_lookup_table", "(", "self", ",", "positioned_object", ":", "PositionedObject", ")", ":", "\n", "        ", "possible_object_names", "=", "generate_possible_object_names", "(", "positioned_object", ".", "object", ".", "color", ",", "\n", "positioned_object", ".", "object", ".", "shape", ")", "\n", "for", "possible_object_name", "in", "possible_object_names", ":", "\n", "            ", "self", ".", "_object_lookup_table", "[", "possible_object_name", "]", "[", "positioned_object", ".", "object", ".", "size", "]", ".", "remove", "(", "\n", "positioned_object", ".", "position", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.move_object": [[681, 690], ["world.World._remove_object", "world.World.place_object", "ValueError"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World._remove_object", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.place_object"], ["", "", "def", "move_object", "(", "self", ",", "old_position", ":", "Position", ",", "new_position", ":", "Position", ")", ":", "\n", "# Remove object from old position", "\n", "        ", "old_positioned_object", "=", "self", ".", "_remove_object", "(", "old_position", ")", "\n", "if", "not", "old_positioned_object", ":", "\n", "            ", "raise", "ValueError", "(", "\"Trying to move an object from an empty grid location (row {}, col {})\"", ".", "format", "(", "\n", "old_position", ".", "row", ",", "old_position", ".", "column", ")", ")", "\n", "\n", "# Add object at new position", "\n", "", "self", ".", "place_object", "(", "old_positioned_object", ".", "object", ",", "new_position", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.pull": [[691, 695], ["world.World._observed_commands.append", "world.World._observed_situations.append", "world.World.get_current_situation"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation"], ["", "def", "pull", "(", "self", ",", "position", ":", "Position", ")", ":", "\n", "        ", "self", ".", "agent_pos", "=", "(", "position", ".", "column", ",", "position", ".", "row", ")", "\n", "self", ".", "_observed_commands", ".", "append", "(", "\"pull\"", ")", "\n", "self", ".", "_observed_situations", ".", "append", "(", "self", ".", "get_current_situation", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.pick_up_object": [[696, 707], ["world.World.step", "world.World.grid.get", "world.World._remove_object", "world.World._observed_commands.append", "world.World._observed_situations.append", "Position", "world.World.get_current_situation"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World._remove_object", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation"], ["", "def", "pick_up_object", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Picking up an object in gym-minigrid means removing it and saying the agent is carrying it.\n        :return:\n        \"\"\"", "\n", "assert", "self", ".", "grid", ".", "get", "(", "*", "self", ".", "agent_pos", ")", "is", "not", "None", ",", "\"Trying to pick up an object at an empty cell.\"", "\n", "self", ".", "step", "(", "self", ".", "actions", ".", "pickup", ")", "\n", "if", "self", ".", "carrying", ":", "\n", "            ", "self", ".", "_remove_object", "(", "Position", "(", "column", "=", "self", ".", "agent_pos", "[", "0", "]", ",", "row", "=", "self", ".", "agent_pos", "[", "1", "]", ")", ")", "\n", "self", ".", "_observed_commands", ".", "append", "(", "\"PICK UP\"", ")", "\n", "self", ".", "_observed_situations", ".", "append", "(", "self", ".", "get_current_situation", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.drop_object": [[708, 715], ["world.World.place_object", "world.World._observed_commands.append", "world.World._observed_situations.append", "Position", "world.World.get_current_situation"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.place_object", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation"], ["", "", "def", "drop_object", "(", "self", ")", ":", "\n", "        ", "assert", "self", ".", "carrying", "is", "not", "None", ",", "\"Trying to drop something but not carrying anything.\"", "\n", "self", ".", "place_object", "(", "self", ".", "carrying", ".", "object_representation", ",", "Position", "(", "column", "=", "self", ".", "agent_pos", "[", "0", "]", ",", "\n", "row", "=", "self", ".", "agent_pos", "[", "1", "]", ")", ")", "\n", "self", ".", "carrying", "=", "None", "\n", "self", ".", "_observed_commands", ".", "append", "(", "\"DROP\"", ")", "\n", "self", ".", "_observed_situations", ".", "append", "(", "self", ".", "get_current_situation", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.push_or_pull_object": [[716, 739], ["world.World.grid.get", "ValueError", "world.World._observed_commands.append", "world.World._observed_situations.append", "world.World.can_push", "world.World.push", "world.World.get_current_situation", "Position", "world.World.within_grid", "world.World._observed_commands.append", "world.World._observed_situations.append", "world.World.get_current_situation", "world.World.grid.get", "world.World.move_object", "Position", "world.World.take_step_in_direction", "world.World.pull"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.can_push", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.push", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.within_grid", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.move_object", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step_in_direction", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.pull"], ["", "def", "push_or_pull_object", "(", "self", ",", "direction", ":", "Direction", ",", "primitive_command", ":", "str", ")", ":", "\n", "        ", "current_object", "=", "self", ".", "grid", ".", "get", "(", "*", "self", ".", "agent_pos", ")", "\n", "if", "not", "current_object", ":", "\n", "            ", "raise", "ValueError", "(", "\"Trying to {} object where there is none.\"", "%", "primitive_command", ")", "\n", "self", ".", "_observed_commands", ".", "append", "(", "primitive_command", ")", "\n", "self", ".", "_observed_situations", ".", "append", "(", "self", ".", "get_current_situation", "(", ")", ")", "\n", "", "else", ":", "\n", "            ", "assert", "current_object", ".", "can_push", "(", ")", ",", "\"Trying to push an object that cannot be pushed\"", "\n", "if", "current_object", ".", "push", "(", ")", ":", "\n", "                ", "new_position", "=", "self", ".", "agent_pos", "+", "DIR_TO_VEC", "[", "DIR_TO_INT", "[", "direction", "]", "]", "\n", "new_position", "=", "Position", "(", "column", "=", "new_position", "[", "0", "]", ",", "row", "=", "new_position", "[", "1", "]", ")", "\n", "# If the new position isn't occupied by another object, push it forward.", "\n", "if", "self", ".", "within_grid", "(", "new_position", ")", ":", "\n", "                    ", "if", "not", "self", ".", "grid", ".", "get", "(", "new_position", "[", "0", "]", ",", "new_position", "[", "1", "]", ")", ":", "\n", "                        ", "self", ".", "move_object", "(", "Position", "(", "column", "=", "self", ".", "agent_pos", "[", "0", "]", ",", "row", "=", "self", ".", "agent_pos", "[", "1", "]", ")", ",", "new_position", ")", "\n", "if", "primitive_command", "==", "\"push\"", ":", "\n", "                            ", "self", ".", "take_step_in_direction", "(", "direction", ",", "primitive_command", ")", "\n", "", "else", ":", "\n", "                            ", "self", ".", "pull", "(", "position", "=", "new_position", ")", "\n", "", "", "", "", "else", ":", "\n", "# Pushing an object that won't move just yet (because it's heavy).", "\n", "                ", "self", ".", "_observed_commands", ".", "append", "(", "primitive_command", ")", "\n", "self", ".", "_observed_situations", ".", "append", "(", "self", ".", "get_current_situation", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.do_generated_manner": [[740, 748], ["world.World.turn_to_direction", "world.World.execute_command"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.turn_to_direction", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.execute_command"], ["", "", "", "def", "do_generated_manner", "(", "self", ",", "manner", ")", ":", "\n", "        ", "original_direction", "=", "INT_TO_DIR", "[", "self", ".", "agent_dir", "]", "\n", "action_sequence", "=", "self", ".", "left_over_manners", "[", "manner", "]", "\n", "for", "action", "in", "action_sequence", ":", "\n", "            ", "self", ".", "execute_command", "(", "action", ")", "\n", "\n", "# Turn back to original direction", "\n", "", "self", ".", "turn_to_direction", "(", "original_direction", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.move_object_to_wall": [[749, 764], ["world.World.empty_cell_in_direction", "world.World.push_or_pull_object", "world.World.spin", "world.World.hesitate", "world.World.look_left_and_right", "world.World.do_generated_manner"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.empty_cell_in_direction", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.push_or_pull_object", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.spin", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.hesitate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.look_left_and_right", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.do_generated_manner"], ["", "def", "move_object_to_wall", "(", "self", ",", "action", ":", "str", ",", "manner", ":", "str", ")", ":", "\n", "        ", "if", "action", "==", "\"push\"", ":", "\n", "            ", "direction", "=", "INT_TO_DIR", "[", "self", ".", "agent_dir", "]", "\n", "", "else", ":", "\n", "            ", "direction", "=", "INT_TO_DIR", "[", "(", "self", ".", "agent_dir", "+", "2", ")", "%", "4", "]", "\n", "", "while", "self", ".", "empty_cell_in_direction", "(", "direction", "=", "direction", ")", ":", "\n", "            ", "if", "manner", "==", "\"while spinning\"", ":", "\n", "                ", "self", ".", "spin", "(", ")", "\n", "", "elif", "manner", "==", "\"cautiously\"", ":", "\n", "                ", "self", ".", "look_left_and_right", "(", ")", "\n", "", "elif", "manner", "in", "self", ".", "left_over_manners", ":", "\n", "                ", "self", ".", "do_generated_manner", "(", "manner", ")", "\n", "", "self", ".", "push_or_pull_object", "(", "direction", "=", "direction", ",", "primitive_command", "=", "action", ")", "\n", "if", "manner", "==", "\"hesitantly\"", ":", "\n", "                ", "self", ".", "hesitate", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_direction": [[765, 768], ["None"], "methods", ["None"], ["", "", "", "@", "staticmethod", "\n", "def", "get_direction", "(", "direction_str", ":", "str", ")", ":", "\n", "        ", "return", "DIR_STR_TO_DIR", "[", "direction_str", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_position_at": [[769, 778], ["Position", "len", "numpy.array"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "get_position_at", "(", "current_position", ":", "Position", ",", "direction_str", ":", "str", ",", "distance", ":", "int", ")", "->", "Position", ":", "\n", "        ", "\"\"\"Returns the column and row of a position on the grid some distance away in a particular direction.\"\"\"", "\n", "assert", "len", "(", "DIR_STR_TO_DIR", "[", "direction_str", "]", ")", "==", "1", ",", "\"getting a position at a distance only implemented for \"", "\"straight directions\"", "\n", "direction", "=", "DIR_STR_TO_DIR", "[", "direction_str", "]", "\n", "direction_vec", "=", "DIR_TO_VEC", "[", "DIR_TO_INT", "[", "direction", "]", "]", "*", "distance", "\n", "position", "=", "np", ".", "array", "(", "[", "current_position", ".", "column", ",", "current_position", ".", "row", "]", ")", "+", "direction_vec", "\n", "return", "Position", "(", "column", "=", "position", "[", "0", "]", ",", "row", "=", "position", "[", "1", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.direction_to_goal": [[779, 792], ["numpy.array"], "methods", ["None"], ["", "def", "direction_to_goal", "(", "self", ",", "goal", ":", "Position", ")", ":", "\n", "        ", "difference_vec", "=", "np", ".", "array", "(", "[", "goal", ".", "column", "-", "self", ".", "agent_pos", "[", "0", "]", ",", "goal", ".", "row", "-", "self", ".", "agent_pos", "[", "1", "]", "]", ")", "\n", "difference_vec", "[", "difference_vec", "<", "0", "]", "=", "0", "\n", "col_difference", "=", "difference_vec", "[", "0", "]", "\n", "row_difference", "=", "difference_vec", "[", "1", "]", "\n", "if", "col_difference", "and", "row_difference", ":", "\n", "            ", "return", "\"SE\"", ",", "self", ".", "actions", ".", "left", "\n", "", "elif", "col_difference", "and", "not", "row_difference", ":", "\n", "            ", "return", "\"NE\"", ",", "self", ".", "actions", ".", "right", "\n", "", "elif", "row_difference", "and", "not", "col_difference", ":", "\n", "            ", "return", "\"SW\"", ",", "self", ".", "actions", ".", "right", "\n", "", "else", ":", "\n", "            ", "return", "\"NW\"", ",", "self", ".", "actions", ".", "left", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.execute_command": [[793, 819], ["command_str.split", "len", "world.World.take_step", "world.World.take_step_in_direction", "world.World.take_step", "ValueError", "world.World.push_or_pull_object", "world.World.hesitate", "ValueError"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step_in_direction", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.push_or_pull_object", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.hesitate"], ["", "", "def", "execute_command", "(", "self", ",", "command_str", ":", "str", ")", ":", "\n", "        ", "command_list", "=", "command_str", ".", "split", "(", ")", "\n", "verb", "=", "command_list", "[", "0", "]", "\n", "if", "len", "(", "command_list", ")", ">", "1", "and", "verb", "==", "\"turn\"", ":", "\n", "            ", "direction", "=", "command_list", "[", "1", "]", "\n", "if", "direction", "==", "\"left\"", ":", "\n", "                ", "self", ".", "take_step", "(", "self", ".", "actions", ".", "left", ",", "\"turn left\"", ")", "\n", "", "elif", "direction", "==", "\"right\"", ":", "\n", "                ", "self", ".", "take_step", "(", "self", ".", "actions", ".", "right", ",", "\"turn right\"", ")", "\n", "", "else", ":", "\n", "                ", "raise", "ValueError", "(", "\"Trying to turn in an unknown direction\"", ")", "\n", "", "", "elif", "verb", "==", "\"walk\"", "or", "verb", "==", "\"run\"", "or", "verb", "==", "\"jump\"", ":", "\n", "            ", "self", ".", "take_step_in_direction", "(", "direction", "=", "DIR_STR_TO_DIR", "[", "INT_TO_DIR", "[", "self", ".", "agent_dir", "]", ".", "name", "[", "0", "]", "]", ",", "\n", "primitive_command", "=", "verb", ")", "\n", "", "elif", "verb", "==", "\"push\"", "or", "verb", "==", "\"pull\"", ":", "\n", "            ", "if", "verb", "==", "\"push\"", ":", "\n", "                ", "direction", "=", "INT_TO_DIR", "[", "self", ".", "agent_dir", "]", "\n", "", "else", ":", "\n", "                ", "direction", "=", "INT_TO_DIR", "[", "(", "self", ".", "agent_dir", "+", "2", ")", "%", "4", "]", "\n", "", "self", ".", "push_or_pull_object", "(", "direction", "=", "direction", ",", "\n", "primitive_command", "=", "verb", ")", "\n", "", "elif", "verb", "==", "\"stay\"", ":", "\n", "            ", "self", ".", "hesitate", "(", ")", "\n", "return", "\n", "", "else", ":", "\n", "            ", "raise", "ValueError", "(", "\"Incorrect command {}.\"", ".", "format", "(", "command_str", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.empty_cell_in_direction": [[820, 827], ["world.World.within_grid", "Position", "world.World.grid.get"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.within_grid", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "", "def", "empty_cell_in_direction", "(", "self", ",", "direction", ":", "Direction", ")", ":", "\n", "        ", "next_cell", "=", "self", ".", "agent_pos", "+", "DIR_TO_VEC", "[", "DIR_TO_INT", "[", "direction", "]", "]", "\n", "if", "self", ".", "within_grid", "(", "Position", "(", "column", "=", "next_cell", "[", "0", "]", ",", "row", "=", "next_cell", "[", "1", "]", ")", ")", ":", "\n", "            ", "next_cell_object", "=", "self", ".", "grid", ".", "get", "(", "*", "next_cell", ")", "\n", "return", "not", "next_cell_object", "\n", "", "else", ":", "\n", "            ", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.look_left_and_right": [[828, 833], ["world.World.take_step", "world.World.take_step", "world.World.take_step", "world.World.take_step"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step"], ["", "", "def", "look_left_and_right", "(", "self", ")", ":", "\n", "        ", "self", ".", "take_step", "(", "self", ".", "actions", ".", "left", ",", "\"turn left\"", ")", "\n", "self", ".", "take_step", "(", "self", ".", "actions", ".", "right", ",", "\"turn right\"", ")", "\n", "self", ".", "take_step", "(", "self", ".", "actions", ".", "right", ",", "\"turn right\"", ")", "\n", "self", ".", "take_step", "(", "self", ".", "actions", ".", "left", ",", "\"turn left\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.hesitate": [[834, 837], ["world.World._observed_commands.append", "world.World._observed_situations.append", "world.World.get_current_situation"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation"], ["", "def", "hesitate", "(", "self", ")", ":", "\n", "        ", "self", ".", "_observed_commands", ".", "append", "(", "\"stay\"", ")", "\n", "self", ".", "_observed_situations", ".", "append", "(", "self", ".", "get_current_situation", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.spin": [[838, 841], ["range", "world.World.take_step"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step"], ["", "def", "spin", "(", "self", ")", ":", "\n", "        ", "for", "_", "in", "range", "(", "4", ")", ":", "\n", "            ", "self", ".", "take_step", "(", "self", ".", "actions", ".", "left", ",", "\"turn left\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.move_with_manners": [[842, 861], ["world.World.spin", "world.World.take_step_in_direction", "world.World.hesitate", "world.World.turn_to_direction", "world.World.look_left_and_right", "world.World.take_step_in_direction", "world.World.do_generated_manner", "world.World.take_step_in_direction", "world.World.take_step_in_direction"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.spin", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step_in_direction", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.hesitate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.turn_to_direction", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.look_left_and_right", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step_in_direction", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.do_generated_manner", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step_in_direction", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step_in_direction"], ["", "", "def", "move_with_manners", "(", "self", ",", "direction", ":", "Direction", ",", "manner", ":", "str", ",", "primitive_command", ":", "str", ")", ":", "\n", "# Spin to the left", "\n", "        ", "if", "manner", "==", "\"while spinning\"", ":", "\n", "            ", "self", ".", "spin", "(", ")", "\n", "self", ".", "take_step_in_direction", "(", "direction", "=", "direction", ",", "primitive_command", "=", "primitive_command", ")", "\n", "# Look left and right if cautious", "\n", "", "elif", "manner", "==", "\"cautiously\"", ":", "\n", "            ", "self", ".", "turn_to_direction", "(", "direction", "=", "direction", ")", "\n", "self", ".", "look_left_and_right", "(", ")", "\n", "self", ".", "take_step_in_direction", "(", "direction", "=", "direction", ",", "primitive_command", "=", "primitive_command", ")", "\n", "", "elif", "manner", "in", "self", ".", "left_over_manners", ":", "\n", "            ", "self", ".", "do_generated_manner", "(", "manner", ")", "\n", "self", ".", "take_step_in_direction", "(", "direction", "=", "direction", ",", "primitive_command", "=", "primitive_command", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "take_step_in_direction", "(", "direction", "=", "direction", ",", "primitive_command", "=", "primitive_command", ")", "\n", "\n", "# Stop after each step", "\n", "", "if", "manner", "==", "\"hesitantly\"", ":", "\n", "            ", "self", ".", "hesitate", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.go_to_position": [[862, 904], ["world.World.direction_to_goal", "world.World.agent_in_line_with_goal", "world.World.take_step_in_direction", "world.World.take_step_in_direction", "world.World.agent_in_line_with_goal", "world.World.take_step", "world.World.take_step_in_direction", "world.World.take_step_in_direction", "world.World.take_step_in_direction", "world.World.take_step_in_direction", "world.World.move_with_manners", "world.World.move_with_manners", "world.World.move_with_manners", "world.World.move_with_manners", "world.World.take_step", "world.World.take_step"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.direction_to_goal", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.agent_in_line_with_goal", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step_in_direction", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step_in_direction", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.agent_in_line_with_goal", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step_in_direction", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step_in_direction", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step_in_direction", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step_in_direction", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.move_with_manners", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.move_with_manners", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.move_with_manners", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.move_with_manners", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step"], ["", "", "def", "go_to_position", "(", "self", ",", "position", ":", "Position", ",", "manner", ":", "str", ",", "primitive_command", ":", "str", ")", ":", "\n", "        ", "\"\"\"Move to the position denoted in the argument. Adds an action for each step to self._observed_commands\n        and self._observed_situations. If a manner is specified, the sequence of actions will be transformed to\n        represent the specified manner.\"\"\"", "\n", "# Zigzag somewhere until in line with the goal, then just go straight for the goal", "\n", "if", "manner", "==", "\"while zigzagging\"", "and", "not", "self", ".", "agent_in_line_with_goal", "(", "position", ")", ":", "\n", "# Find direction of goal.", "\n", "            ", "direction_to_goal", ",", "first_move", "=", "self", ".", "direction_to_goal", "(", "position", ")", "\n", "previous_step", "=", "first_move", "\n", "if", "direction_to_goal", "==", "\"NE\"", "or", "direction_to_goal", "==", "\"SE\"", ":", "\n", "                ", "self", ".", "take_step_in_direction", "(", "direction", "=", "EAST", ",", "primitive_command", "=", "primitive_command", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "take_step_in_direction", "(", "direction", "=", "WEST", ",", "primitive_command", "=", "primitive_command", ")", "\n", "", "while", "not", "self", ".", "agent_in_line_with_goal", "(", "position", ")", ":", "\n", "# turn in opposite direction of previous step and take take step", "\n", "                ", "if", "previous_step", "==", "self", ".", "actions", ".", "left", ":", "\n", "                    ", "self", ".", "take_step", "(", "self", ".", "actions", ".", "right", ",", "\"turn right\"", ")", "\n", "previous_step", "=", "self", ".", "actions", ".", "right", "\n", "", "else", ":", "\n", "                    ", "self", ".", "take_step", "(", "self", ".", "actions", ".", "left", ",", "\"turn left\"", ")", "\n", "previous_step", "=", "self", ".", "actions", ".", "left", "\n", "", "self", ".", "take_step", "(", "self", ".", "actions", ".", "forward", ",", "primitive_command", ")", "\n", "\n", "# Finish the route not zigzagging", "\n", "", "while", "self", ".", "agent_pos", "[", "0", "]", ">", "position", ".", "column", ":", "\n", "                ", "self", ".", "take_step_in_direction", "(", "direction", "=", "WEST", ",", "primitive_command", "=", "primitive_command", ")", "\n", "", "while", "self", ".", "agent_pos", "[", "0", "]", "<", "position", ".", "column", ":", "\n", "                ", "self", ".", "take_step_in_direction", "(", "direction", "=", "EAST", ",", "primitive_command", "=", "primitive_command", ")", "\n", "", "while", "self", ".", "agent_pos", "[", "1", "]", ">", "position", ".", "row", ":", "\n", "                ", "self", ".", "take_step_in_direction", "(", "direction", "=", "NORTH", ",", "primitive_command", "=", "primitive_command", ")", "\n", "", "while", "self", ".", "agent_pos", "[", "1", "]", "<", "position", ".", "row", ":", "\n", "                ", "self", ".", "take_step_in_direction", "(", "direction", "=", "SOUTH", ",", "primitive_command", "=", "primitive_command", ")", "\n", "", "", "else", ":", "\n", "# Calculate the route to the object on the grid.", "\n", "            ", "while", "self", ".", "agent_pos", "[", "0", "]", ">", "position", ".", "column", ":", "\n", "                ", "self", ".", "move_with_manners", "(", "direction", "=", "WEST", ",", "manner", "=", "manner", ",", "primitive_command", "=", "primitive_command", ")", "\n", "", "while", "self", ".", "agent_pos", "[", "0", "]", "<", "position", ".", "column", ":", "\n", "                ", "self", ".", "move_with_manners", "(", "direction", "=", "EAST", ",", "manner", "=", "manner", ",", "primitive_command", "=", "primitive_command", ")", "\n", "", "while", "self", ".", "agent_pos", "[", "1", "]", ">", "position", ".", "row", ":", "\n", "                ", "self", ".", "move_with_manners", "(", "direction", "=", "NORTH", ",", "manner", "=", "manner", ",", "primitive_command", "=", "primitive_command", ")", "\n", "", "while", "self", ".", "agent_pos", "[", "1", "]", "<", "position", ".", "row", ":", "\n", "                ", "self", ".", "move_with_manners", "(", "direction", "=", "SOUTH", ",", "manner", "=", "manner", ",", "primitive_command", "=", "primitive_command", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.has_object": [[905, 910], ["world.World._object_lookup_table.keys"], "methods", ["None"], ["", "", "", "def", "has_object", "(", "self", ",", "object_str", ":", "str", ")", "->", "bool", ":", "\n", "        ", "if", "object_str", "not", "in", "self", ".", "_object_lookup_table", ".", "keys", "(", ")", ":", "\n", "            ", "return", "False", "\n", "", "else", ":", "\n", "            ", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.object_positions": [[911, 929], ["world.World.has_object", "present_object_sizes.sort", "object_locations.items.items.items", "len", "object_locations.items.items.items", "ValueError"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.has_object"], ["", "", "def", "object_positions", "(", "self", ",", "object_str", ":", "str", ",", "object_size", "=", "None", ")", "->", "List", "[", "Position", "]", ":", "\n", "        ", "assert", "self", ".", "has_object", "(", "object_str", ")", ",", "\"Trying to get an object's position that is not placed in the world.\"", "\n", "object_locations", "=", "self", ".", "_object_lookup_table", "[", "object_str", "]", "\n", "if", "object_size", ":", "\n", "            ", "present_object_sizes", "=", "[", "size", "for", "size", ",", "objects", "in", "object_locations", ".", "items", "(", ")", "if", "objects", "]", "\n", "present_object_sizes", ".", "sort", "(", ")", "\n", "assert", "len", "(", "present_object_sizes", ")", ">=", "2", ",", "\"referring to a {} object but only one of its size present.\"", ".", "format", "(", "\n", "object_size", ")", "\n", "# Perhaps just keep track of smallest and largest object in world", "\n", "if", "object_size", "==", "\"small\"", ":", "\n", "                ", "object_locations", "=", "object_locations", "[", "present_object_sizes", "[", "0", "]", "]", "\n", "", "elif", "object_size", "==", "\"big\"", ":", "\n", "                ", "object_locations", "=", "object_locations", "[", "present_object_sizes", "[", "-", "1", "]", "]", "\n", "", "else", ":", "\n", "                ", "raise", "ValueError", "(", "\"Wrong size in term specifications.\"", ")", "\n", "", "", "else", ":", "\n", "            ", "object_locations", "=", "object_locations", ".", "items", "(", ")", "\n", "", "return", "object_locations", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.agent_in_line_with_goal": [[930, 932], ["None"], "methods", ["None"], ["", "def", "agent_in_line_with_goal", "(", "self", ",", "goal", ":", "Position", ")", ":", "\n", "        ", "return", "goal", ".", "column", "==", "self", ".", "agent_pos", "[", "0", "]", "or", "goal", ".", "row", "==", "self", ".", "agent_pos", "[", "1", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step": [[933, 937], ["world.World.step", "world.World._observed_situations.append", "world.World._observed_commands.append", "world.World.get_current_situation"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation"], ["", "def", "take_step", "(", "self", ",", "action", ",", "observed_command", ":", "str", ")", ":", "\n", "        ", "self", ".", "step", "(", "action", "=", "action", ")", "\n", "self", ".", "_observed_situations", ".", "append", "(", "self", ".", "get_current_situation", "(", ")", ")", "\n", "self", ".", "_observed_commands", ".", "append", "(", "observed_command", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.turn_to_direction": [[938, 966], ["numpy.linalg.norm", "world.World.take_step", "world.World.take_step", "world.World.take_step", "world.World.take_step", "world.World.take_step", "world.World.take_step", "world.World.take_step", "world.World.take_step"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step"], ["", "def", "turn_to_direction", "(", "self", ",", "direction", ":", "Direction", ")", "->", "{", "}", ":", "\n", "        ", "\"\"\"Turn to some direction.\"\"\"", "\n", "current_direction", "=", "self", ".", "agent_dir", "\n", "target_direction", "=", "DIR_TO_INT", "[", "direction", "]", "\n", "if", "current_direction", "==", "target_direction", ":", "\n", "            ", "return", "\n", "", "assert", "current_direction", "!=", "target_direction", ",", "\"Trying to turn to a direction that is the current direction.\"", "\n", "difference_vector", "=", "DIR_TO_VEC", "[", "target_direction", "]", "-", "DIR_TO_VEC", "[", "self", ".", "agent_dir", "]", "\n", "difference_norm", "=", "np", ".", "linalg", ".", "norm", "(", "difference_vector", ",", "ord", "=", "2", ")", "\n", "if", "difference_norm", ">=", "2", ":", "\n", "            ", "self", ".", "take_step", "(", "self", ".", "actions", ".", "left", ",", "\"turn left\"", ")", "\n", "self", ".", "take_step", "(", "self", ".", "actions", ".", "left", ",", "\"turn left\"", ")", "\n", "", "else", ":", "\n", "            ", "if", "current_direction", "==", "0", ":", "# East", "\n", "                ", "if", "target_direction", "==", "1", ":", "\n", "                    ", "self", ".", "take_step", "(", "self", ".", "actions", ".", "right", ",", "\"turn right\"", ")", "\n", "", "else", ":", "\n", "                    ", "self", ".", "take_step", "(", "self", ".", "actions", ".", "left", ",", "\"turn left\"", ")", "\n", "", "", "elif", "current_direction", "==", "3", ":", "# North", "\n", "                ", "if", "target_direction", "==", "0", ":", "\n", "                    ", "self", ".", "take_step", "(", "self", ".", "actions", ".", "right", ",", "\"turn right\"", ")", "\n", "", "else", ":", "\n", "                    ", "self", ".", "take_step", "(", "self", ".", "actions", ".", "left", ",", "\"turn left\"", ")", "\n", "", "", "else", ":", "# South and West", "\n", "                ", "if", "target_direction", ">", "current_direction", ":", "\n", "                    ", "self", ".", "take_step", "(", "self", ".", "actions", ".", "right", ",", "\"turn right\"", ")", "\n", "", "else", ":", "\n", "                    ", "self", ".", "take_step", "(", "self", ".", "actions", ".", "left", ",", "\"turn left\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.take_step_in_direction": [[967, 979], ["world.World.within_grid", "world.World.turn_to_direction", "Position", "world.World.step", "world.World._observed_commands.append", "world.World._observed_situations.append", "ValueError", "world.World.get_current_situation"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.within_grid", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.turn_to_direction", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.step", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation"], ["", "", "", "", "def", "take_step_in_direction", "(", "self", ",", "direction", ":", "Direction", ",", "primitive_command", ":", "str", ")", ":", "\n", "        ", "\"\"\"\n        Turn to some direction and take a step forward.\n        \"\"\"", "\n", "if", "DIR_TO_INT", "[", "direction", "]", "!=", "self", ".", "agent_dir", ":", "\n", "            ", "self", ".", "turn_to_direction", "(", "direction", ")", "\n", "", "if", "self", ".", "within_grid", "(", "Position", "(", "column", "=", "self", ".", "front_pos", "[", "0", "]", ",", "row", "=", "self", ".", "front_pos", "[", "1", "]", ")", ")", ":", "\n", "            ", "self", ".", "step", "(", "action", "=", "self", ".", "actions", ".", "forward", ")", "\n", "self", ".", "_observed_commands", ".", "append", "(", "primitive_command", ")", "\n", "self", ".", "_observed_situations", ".", "append", "(", "self", ".", "get_current_situation", "(", ")", ")", "\n", "", "else", ":", "\n", "            ", "raise", "ValueError", "(", "\"Trying to step outside of grid.\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.save_situation": [[980, 989], ["os.path.join", "os.path.join.endswith", "world.World.render().save", "print", "world.World.render"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.render"], ["", "", "def", "save_situation", "(", "self", ",", "file_name", ",", "attention_weights", "=", "[", "]", ")", "->", "str", ":", "\n", "        ", "save_location", "=", "os", ".", "path", ".", "join", "(", "self", ".", "save_directory", ",", "file_name", ")", "\n", "assert", "save_location", ".", "endswith", "(", "'.png'", ")", ",", "\"Invalid file name passed to save_situation, must end with .png.\"", "\n", "success", "=", "self", ".", "render", "(", "mode", "=", "\"human\"", ",", "attention_weights", "=", "attention_weights", ")", ".", "save", "(", "save_location", ")", "\n", "if", "not", "success", ":", "\n", "            ", "print", "(", "\"WARNING: image with name {} failed to save.\"", ".", "format", "(", "file_name", ")", ")", "\n", "return", "''", "\n", "", "else", ":", "\n", "            ", "return", "save_location", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation_image": [[990, 992], ["world.World.render().getArray", "world.World.render"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.getArray", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.render"], ["", "", "def", "get_current_situation_image", "(", "self", ")", "->", "np", ".", "ndarray", ":", "\n", "        ", "return", "self", ".", "render", "(", ")", ".", "getArray", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation_grid_repr": [[993, 996], ["world.World.grid.encode"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.encode"], ["", "def", "get_current_situation_grid_repr", "(", "self", ")", "->", "np", ".", "ndarray", ":", "\n", "        ", "return", "self", ".", "grid", ".", "encode", "(", "agent_row", "=", "self", ".", "agent_pos", "[", "1", "]", ",", "agent_column", "=", "self", ".", "agent_pos", "[", "0", "]", ",", "\n", "agent_direction", "=", "self", ".", "agent_dir", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.save_current_situation_image": [[997, 1001], ["os.path.join", "world.World.get_current_situation_image", "GroundedScan.helpers.numpy_array_to_image"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation_image", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.numpy_array_to_image"], ["", "def", "save_current_situation_image", "(", "self", ",", "image_name", ":", "str", ")", ":", "\n", "        ", "save_path", "=", "os", ".", "path", ".", "join", "(", "self", ".", "save_directory", ",", "image_name", ")", "\n", "current_situation_array", "=", "self", ".", "get_current_situation_image", "(", ")", "\n", "numpy_array_to_image", "(", "current_situation_array", ",", "save_path", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation": [[1002, 1012], ["world.Situation", "Position", "world.World._placed_object_list.copy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "get_current_situation", "(", "self", ")", "->", "Situation", ":", "\n", "        ", "if", "self", ".", "carrying", ":", "\n", "            ", "carrying", "=", "self", ".", "carrying", ".", "object_representation", "\n", "", "else", ":", "\n", "            ", "carrying", "=", "None", "\n", "", "return", "Situation", "(", "grid_size", "=", "self", ".", "grid_size", ",", "\n", "agent_position", "=", "Position", "(", "column", "=", "self", ".", "agent_pos", "[", "0", "]", ",", "row", "=", "self", ".", "agent_pos", "[", "1", "]", ")", ",", "\n", "target_object", "=", "self", ".", "_target_object", ",", "\n", "agent_direction", "=", "INT_TO_DIR", "[", "self", ".", "agent_dir", "]", ",", "placed_objects", "=", "self", ".", "_placed_object_list", ".", "copy", "(", ")", ",", "\n", "carrying", "=", "carrying", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_observations": [[1013, 1015], ["world.World._observed_commands.copy", "world.World._observed_situations.copy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "get_current_observations", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_observed_commands", ".", "copy", "(", ")", ",", "self", ".", "_observed_situations", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation": [[1016, 1023], ["world.World._object_lookup_table.clear", "world.World._placed_object_list.clear", "world.World._observed_commands.clear", "world.World._observed_situations.clear", "world.World._occupied_positions.clear", "world.World.reset"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.clear", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.clear", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.clear", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.clear", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.clear", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.reset"], ["", "def", "clear_situation", "(", "self", ")", ":", "\n", "        ", "self", ".", "_object_lookup_table", ".", "clear", "(", ")", "\n", "self", ".", "_placed_object_list", ".", "clear", "(", ")", "\n", "self", ".", "_observed_commands", ".", "clear", "(", ")", "\n", "self", ".", "_observed_situations", ".", "clear", "(", ")", "\n", "self", ".", "_occupied_positions", ".", "clear", "(", ")", "\n", "self", ".", "reset", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.set_mission": [[1024, 1026], ["None"], "methods", ["None"], ["", "def", "set_mission", "(", "self", ",", "mission", ":", "str", ")", ":", "\n", "        ", "self", ".", "mission", "=", "mission", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.object_to_repr": [[188, 193], ["str"], "function", ["None"], ["", "", "def", "object_to_repr", "(", "object", ":", "Object", ")", "->", "dict", ":", "\n", "    ", "return", "{", "\n", "\"shape\"", ":", "object", ".", "shape", ",", "\n", "\"color\"", ":", "object", ".", "color", ",", "\n", "\"size\"", ":", "str", "(", "object", ".", "size", ")", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.position_to_repr": [[196, 200], ["str", "str"], "function", ["None"], ["", "def", "position_to_repr", "(", "position", ":", "Position", ")", "->", "dict", ":", "\n", "    ", "return", "{", "\n", "\"row\"", ":", "str", "(", "position", ".", "row", ")", ",", "\n", "\"column\"", ":", "str", "(", "position", ".", "column", ")", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.positioned_object_to_repr": [[203, 208], ["world.position_to_repr", "world.object_to_repr", "str"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.position_to_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.object_to_repr"], ["", "def", "positioned_object_to_repr", "(", "positioned_object", ":", "PositionedObject", ")", "->", "dict", ":", "\n", "    ", "return", "{", "\n", "\"vector\"", ":", "''", ".", "join", "(", "[", "str", "(", "idx", ")", "for", "idx", "in", "positioned_object", ".", "vector", "]", ")", ",", "\n", "\"position\"", ":", "position_to_repr", "(", "positioned_object", ".", "position", ")", ",", "\n", "\"object\"", ":", "object_to_repr", "(", "positioned_object", ".", "object", ")", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.parse_object_repr": [[211, 213], ["Object", "int"], "function", ["None"], ["", "def", "parse_object_repr", "(", "object_repr", ":", "dict", ")", "->", "Object", ":", "\n", "    ", "return", "Object", "(", "shape", "=", "object_repr", "[", "\"shape\"", "]", ",", "color", "=", "object_repr", "[", "\"color\"", "]", ",", "size", "=", "int", "(", "object_repr", "[", "\"size\"", "]", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.parse_position_repr": [[215, 217], ["Position", "int", "int"], "function", ["None"], ["", "def", "parse_position_repr", "(", "position_repr", ":", "dict", ")", "->", "Position", ":", "\n", "    ", "return", "Position", "(", "column", "=", "int", "(", "position_repr", "[", "\"column\"", "]", ")", ",", "row", "=", "int", "(", "position_repr", "[", "\"row\"", "]", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.parse_object_vector_repr": [[219, 221], ["numpy.array", "int"], "function", ["None"], ["", "def", "parse_object_vector_repr", "(", "object_vector_repr", ":", "str", ")", "->", "np", ".", "ndarray", ":", "\n", "    ", "return", "np", ".", "array", "(", "[", "int", "(", "idx", ")", "for", "idx", "in", "object_vector_repr", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.parse_positioned_object_repr": [[223, 227], ["PositionedObject", "world.parse_object_repr", "world.parse_position_repr", "world.parse_object_vector_repr"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.parse_object_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_position_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.parse_object_vector_repr"], ["", "def", "parse_positioned_object_repr", "(", "positioned_object_repr", ":", "dict", ")", ":", "\n", "    ", "return", "PositionedObject", "(", "object", "=", "parse_object_repr", "(", "positioned_object_repr", "[", "\"object\"", "]", ")", ",", "\n", "position", "=", "parse_position_repr", "(", "positioned_object_repr", "[", "\"position\"", "]", ")", ",", "\n", "vector", "=", "parse_object_vector_repr", "(", "positioned_object_repr", "[", "\"vector\"", "]", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.__init__": [[17, 45], ["set", "vocabulary.Vocabulary._translation_table.update", "vocabulary.Vocabulary._translation_table.update", "vocabulary.Vocabulary._translation_table.update", "vocabulary.Vocabulary._translation_table.update", "vocabulary.Vocabulary._translation_table.update", "vocabulary.Vocabulary._translation_table.update", "list", "len", "len", "list", "size_adjectives.keys", "len", "len", "list", "list", "len", "list", "list", "vocabulary.Vocabulary._translation_table.items", "list", "color_adjectives.keys", "vocabulary.Vocabulary._color_adjectives.values", "vocabulary.Vocabulary._size_adjectives.values", "vocabulary.Vocabulary._color_adjectives.values", "vocabulary.Vocabulary._size_adjectives.values", "list", "nouns.keys", "list", "list", "adverbs.keys", "intransitive_verbs.keys", "transitive_verbs.keys"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set"], ["def", "__init__", "(", "self", ",", "intransitive_verbs", ":", "Dict", "[", "str", ",", "str", "]", ",", "transitive_verbs", ":", "Dict", "[", "str", ",", "str", "]", ",", "adverbs", ":", "Dict", "[", "str", ",", "str", "]", ",", "\n", "nouns", ":", "Dict", "[", "str", ",", "str", "]", ",", "color_adjectives", ":", "Dict", "[", "str", ",", "str", "]", ",", "size_adjectives", ":", "Dict", "[", "str", ",", "str", "]", ")", ":", "\n", "        ", "all_words", "=", "list", "(", "intransitive_verbs", ".", "keys", "(", ")", ")", "+", "list", "(", "transitive_verbs", ".", "keys", "(", ")", ")", "+", "list", "(", "adverbs", ".", "keys", "(", ")", ")", "+", "list", "(", "nouns", ".", "keys", "(", ")", ")", "+", "list", "(", "color_adjectives", ".", "keys", "(", ")", ")", "+", "list", "(", "size_adjectives", ".", "keys", "(", ")", ")", "\n", "all_unique_words", "=", "set", "(", "all_words", ")", "\n", "self", ".", "_intransitive_verbs", "=", "intransitive_verbs", "\n", "self", ".", "_transitive_verbs", "=", "transitive_verbs", "\n", "self", ".", "_adverbs", "=", "adverbs", "\n", "self", ".", "_nouns", "=", "nouns", "\n", "self", ".", "_color_adjectives", "=", "color_adjectives", "\n", "self", ".", "_size_adjectives", "=", "size_adjectives", "\n", "assert", "len", "(", "all_words", ")", "==", "len", "(", "all_unique_words", ")", ",", "\"Overlapping vocabulary (the same string used twice,\"", "\"most likely caused by pronounceable generating the same random\"", "\" word twice). Just re-run the same code.\"", "\n", "if", "len", "(", "color_adjectives", ")", ">", "0", "and", "len", "(", "size_adjectives", ")", ">", "0", ":", "\n", "            ", "self", ".", "_adjectives", "=", "list", "(", "self", ".", "_color_adjectives", ".", "values", "(", ")", ")", "+", "list", "(", "self", ".", "_size_adjectives", ".", "values", "(", ")", ")", "\n", "", "elif", "len", "(", "color_adjectives", ")", ">", "0", ":", "\n", "            ", "self", ".", "_adjectives", "=", "list", "(", "self", ".", "_color_adjectives", ".", "values", "(", ")", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "_adjectives", "=", "list", "(", "self", ".", "_size_adjectives", ".", "values", "(", ")", ")", "\n", "", "self", ".", "_translation_table", "=", "{", "'to'", ":", "'to'", ",", "'a'", ":", "'a'", ",", "'and'", ":", "'and'", "}", "\n", "self", ".", "_translation_table", ".", "update", "(", "self", ".", "_intransitive_verbs", ")", "\n", "self", ".", "_translation_table", ".", "update", "(", "self", ".", "_transitive_verbs", ")", "\n", "self", ".", "_translation_table", ".", "update", "(", "self", ".", "_nouns", ")", "\n", "self", ".", "_translation_table", ".", "update", "(", "self", ".", "_color_adjectives", ")", "\n", "self", ".", "_translation_table", ".", "update", "(", "self", ".", "_size_adjectives", ")", "\n", "self", ".", "_translation_table", ".", "update", "(", "self", ".", "_adverbs", ")", "\n", "self", ".", "_translate_to", "=", "{", "semantic_word", ":", "word", "for", "word", ",", "semantic_word", "in", "self", ".", "_translation_table", ".", "items", "(", ")", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_intransitive_verbs": [[46, 48], ["list().copy", "list", "vocabulary.Vocabulary._intransitive_verbs.keys"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "get_intransitive_verbs", "(", "self", ")", ":", "\n", "        ", "return", "list", "(", "self", ".", "_intransitive_verbs", ".", "keys", "(", ")", ")", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_transitive_verbs": [[49, 51], ["list().copy", "list", "vocabulary.Vocabulary._transitive_verbs.keys"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "get_transitive_verbs", "(", "self", ")", ":", "\n", "        ", "return", "list", "(", "self", ".", "_transitive_verbs", ".", "keys", "(", ")", ")", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_adverbs": [[52, 54], ["list().copy", "list", "vocabulary.Vocabulary._adverbs.keys"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "get_adverbs", "(", "self", ")", ":", "\n", "        ", "return", "list", "(", "self", ".", "_adverbs", ".", "keys", "(", ")", ")", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_nouns": [[55, 57], ["list().copy", "list", "vocabulary.Vocabulary._nouns.keys"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "get_nouns", "(", "self", ")", ":", "\n", "        ", "return", "list", "(", "self", ".", "_nouns", ".", "keys", "(", ")", ")", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_color_adjectives": [[58, 60], ["list().copy", "list", "vocabulary.Vocabulary._color_adjectives.keys"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "get_color_adjectives", "(", "self", ")", ":", "\n", "        ", "return", "list", "(", "self", ".", "_color_adjectives", ".", "keys", "(", ")", ")", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_size_adjectives": [[61, 63], ["list().copy", "list", "vocabulary.Vocabulary._size_adjectives.keys"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "get_size_adjectives", "(", "self", ")", ":", "\n", "        ", "return", "list", "(", "self", ".", "_size_adjectives", ".", "keys", "(", ")", ")", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_semantic_shapes": [[64, 66], ["list().copy", "list", "vocabulary.Vocabulary._nouns.values"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "get_semantic_shapes", "(", "self", ")", ":", "\n", "        ", "return", "list", "(", "self", ".", "_nouns", ".", "values", "(", ")", ")", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_semantic_colors": [[67, 69], ["list().copy", "list", "vocabulary.Vocabulary._color_adjectives.values"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "get_semantic_colors", "(", "self", ")", ":", "\n", "        ", "return", "list", "(", "self", ".", "_color_adjectives", ".", "values", "(", ")", ")", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_semantic_manners": [[70, 72], ["list().copy", "list", "vocabulary.Vocabulary._adverbs.values"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "get_semantic_manners", "(", "self", ")", ":", "\n", "        ", "return", "list", "(", "self", ".", "_adverbs", ".", "values", "(", ")", ")", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word": [[73, 78], ["None"], "methods", ["None"], ["", "def", "translate_word", "(", "self", ",", "word", ":", "str", ")", "->", "str", ":", "\n", "        ", "if", "word", "in", "self", ".", "_translation_table", ":", "\n", "            ", "return", "self", ".", "_translation_table", "[", "word", "]", "\n", "", "else", ":", "\n", "            ", "return", "\"\"", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning": [[79, 84], ["None"], "methods", ["None"], ["", "", "def", "translate_meaning", "(", "self", ",", "meaning", ":", "str", ")", "->", "str", ":", "\n", "        ", "if", "meaning", "in", "self", ".", "_translate_to", ":", "\n", "            ", "return", "self", ".", "_translate_to", "[", "meaning", "]", "\n", "", "else", ":", "\n", "            ", "return", "\"\"", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.n_attributes": [[85, 88], ["len", "len"], "methods", ["None"], ["", "", "@", "property", "\n", "def", "n_attributes", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "_nouns", ")", "*", "len", "(", "self", ".", "_color_adjectives", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.bind_words_to_meanings": [[89, 114], ["len", "len", "len", "available_semantic_meanings.remove", "words_left.append", "available_semantic_meanings.pop"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop"], ["", "@", "staticmethod", "\n", "def", "bind_words_to_meanings", "(", "available_words", ":", "List", "[", "str", "]", ",", "available_semantic_meanings", ":", "Set", "[", "str", "]", ",", "\n", "check_size", "=", "True", ",", "word_class", "=", "None", ")", "->", "Dict", "[", "str", ",", "str", "]", ":", "\n", "        ", "if", "check_size", ":", "\n", "            ", "assert", "len", "(", "available_words", ")", "<=", "len", "(", "available_semantic_meanings", ")", ",", "\"Too many words specified for available\"", "\"semantic meanings: {}\"", ".", "format", "(", "\n", "available_semantic_meanings", ")", "\n", "", "if", "not", "check_size", ":", "\n", "            ", "assert", "word_class", ",", "\"Need to pass word_class if want to use extra semantic meanings not pre-defined.\"", "\n", "", "translation_table", "=", "{", "}", "\n", "words_left", "=", "[", "]", "\n", "for", "word", "in", "available_words", ":", "\n", "            ", "if", "word", "in", "available_semantic_meanings", ":", "\n", "                ", "translation_table", "[", "word", "]", "=", "word", "\n", "available_semantic_meanings", ".", "remove", "(", "word", ")", "\n", "", "else", ":", "\n", "                ", "words_left", ".", "append", "(", "word", ")", "\n", "", "", "no_meaning_counter", "=", "0", "\n", "for", "word_left", "in", "words_left", ":", "\n", "            ", "if", "len", "(", "available_semantic_meanings", ")", ":", "\n", "                ", "translation_table", "[", "word_left", "]", "=", "available_semantic_meanings", ".", "pop", "(", ")", "\n", "", "else", ":", "\n", "                ", "translation_table", "[", "word_left", "]", "=", "word_left", "\n", "no_meaning_counter", "+=", "1", "\n", "", "", "return", "translation_table", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.initialize": [[115, 130], ["cls.bind_words_to_meanings", "cls.bind_words_to_meanings", "cls.bind_words_to_meanings", "cls.bind_words_to_meanings", "cls.bind_words_to_meanings", "cls.bind_words_to_meanings", "cls", "cls.INTRANSITIVE_VERBS.copy", "cls.TRANSITIVE_VERBS.copy", "cls.NOUNS.copy", "cls.COLOR_ADJECTIVES.copy", "cls.SIZE_ADJECTIVES.copy", "cls.ADVERBS.copy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.bind_words_to_meanings", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.bind_words_to_meanings", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.bind_words_to_meanings", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.bind_words_to_meanings", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.bind_words_to_meanings", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.bind_words_to_meanings", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "@", "classmethod", "\n", "def", "initialize", "(", "cls", ",", "intransitive_verbs", ":", "List", "[", "str", "]", ",", "transitive_verbs", ":", "List", "[", "str", "]", ",", "adverbs", ":", "List", "[", "str", "]", ",", "\n", "nouns", ":", "List", "[", "str", "]", ",", "color_adjectives", ":", "List", "[", "str", "]", ",", "size_adjectives", ":", "List", "[", "str", "]", ",", "\n", "bind_gscan_adverbs", ":", "bool", ")", ":", "\n", "        ", "intransitive_verbs", "=", "cls", ".", "bind_words_to_meanings", "(", "intransitive_verbs", ",", "cls", ".", "INTRANSITIVE_VERBS", ".", "copy", "(", ")", ")", "\n", "transitive_verbs", "=", "cls", ".", "bind_words_to_meanings", "(", "transitive_verbs", ",", "cls", ".", "TRANSITIVE_VERBS", ".", "copy", "(", ")", ")", "\n", "nouns", "=", "cls", ".", "bind_words_to_meanings", "(", "nouns", ",", "cls", ".", "NOUNS", ".", "copy", "(", ")", ")", "\n", "color_adjectives", "=", "cls", ".", "bind_words_to_meanings", "(", "color_adjectives", ",", "cls", ".", "COLOR_ADJECTIVES", ".", "copy", "(", ")", ")", "\n", "size_adjectives", "=", "cls", ".", "bind_words_to_meanings", "(", "size_adjectives", ",", "cls", ".", "SIZE_ADJECTIVES", ".", "copy", "(", ")", ")", "\n", "if", "bind_gscan_adverbs", ":", "\n", "            ", "semantic_adverbs", "=", "cls", ".", "ADVERBS", ".", "copy", "(", ")", "\n", "", "else", ":", "\n", "            ", "semantic_adverbs", "=", "{", "}", "\n", "", "adverbs", "=", "cls", ".", "bind_words_to_meanings", "(", "adverbs", ",", "semantic_adverbs", ",", "check_size", "=", "False", ",", "word_class", "=", "\"adverb\"", ")", "\n", "return", "cls", "(", "intransitive_verbs", ",", "transitive_verbs", ",", "adverbs", ",", "nouns", ",", "color_adjectives", ",", "size_adjectives", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.sample": [[131, 155], ["cls.bind_words_to_meanings", "cls.bind_words_to_meanings", "cls.bind_words_to_meanings", "cls.bind_words_to_meanings", "cls.bind_words_to_meanings", "cls.bind_words_to_meanings", "cls", "pronounceable.generate_word", "pronounceable.generate_word", "pronounceable.generate_word", "pronounceable.generate_word", "pronounceable.generate_word", "pronounceable.generate_word", "cls.INTRANSITIVE_VERBS.copy", "cls.TRANSITIVE_VERBS.copy", "cls.NOUNS.copy", "cls.COLOR_ADJECTIVES.copy", "cls.SIZE_ADJECTIVES.copy", "cls.ADVERBS.copy", "range", "range", "range", "range", "range", "range"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.bind_words_to_meanings", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.bind_words_to_meanings", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.bind_words_to_meanings", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.bind_words_to_meanings", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.bind_words_to_meanings", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.bind_words_to_meanings", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "@", "classmethod", "\n", "def", "sample", "(", "cls", ",", "num_intransitive", "=", "1", ",", "num_transitive", "=", "1", ",", "num_adverbs", "=", "6", ",", "num_nouns", "=", "3", ",", "\n", "num_color_adjectives", "=", "3", ",", "num_size_adjectives", "=", "2", ",", "bind_gscan_adverbs", "=", "True", ")", ":", "\n", "        ", "\"\"\"\n        Sample random nonce-words and initialize the vocabulary with these.\n        \"\"\"", "\n", "# Generate random nonce-words", "\n", "intransitive_verbs", "=", "[", "pronounceable", ".", "generate_word", "(", ")", "for", "_", "in", "range", "(", "num_intransitive", ")", "]", "\n", "transitive_verbs", "=", "[", "pronounceable", ".", "generate_word", "(", ")", "for", "_", "in", "range", "(", "num_transitive", ")", "]", "\n", "adverbs", "=", "[", "pronounceable", ".", "generate_word", "(", ")", "for", "_", "in", "range", "(", "num_adverbs", ")", "]", "\n", "nouns", "=", "[", "pronounceable", ".", "generate_word", "(", ")", "for", "_", "in", "range", "(", "num_nouns", ")", "]", "\n", "color_adjectives", "=", "[", "pronounceable", ".", "generate_word", "(", ")", "for", "_", "in", "range", "(", "num_color_adjectives", ")", "]", "\n", "size_adjectives", "=", "[", "pronounceable", ".", "generate_word", "(", ")", "for", "_", "in", "range", "(", "num_size_adjectives", ")", "]", "\n", "intransitive_verbs", "=", "cls", ".", "bind_words_to_meanings", "(", "intransitive_verbs", ",", "cls", ".", "INTRANSITIVE_VERBS", ".", "copy", "(", ")", ")", "\n", "transitive_verbs", "=", "cls", ".", "bind_words_to_meanings", "(", "transitive_verbs", ",", "cls", ".", "TRANSITIVE_VERBS", ".", "copy", "(", ")", ")", "\n", "nouns", "=", "cls", ".", "bind_words_to_meanings", "(", "nouns", ",", "cls", ".", "NOUNS", ".", "copy", "(", ")", ")", "\n", "color_adjectives", "=", "cls", ".", "bind_words_to_meanings", "(", "color_adjectives", ",", "cls", ".", "COLOR_ADJECTIVES", ".", "copy", "(", ")", ")", "\n", "size_adjectives", "=", "cls", ".", "bind_words_to_meanings", "(", "size_adjectives", ",", "cls", ".", "SIZE_ADJECTIVES", ".", "copy", "(", ")", ")", "\n", "if", "bind_gscan_adverbs", ":", "\n", "            ", "semantic_adverbs", "=", "cls", ".", "ADVERBS", ".", "copy", "(", ")", "\n", "", "else", ":", "\n", "            ", "semantic_adverbs", "=", "{", "}", "\n", "", "adverbs", "=", "cls", ".", "bind_words_to_meanings", "(", "adverbs", ",", "semantic_adverbs", ")", "\n", "return", "cls", "(", "intransitive_verbs", ",", "transitive_verbs", ",", "adverbs", ",", "nouns", ",", "color_adjectives", ",", "size_adjectives", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.to_representation": [[156, 164], ["None"], "methods", ["None"], ["", "def", "to_representation", "(", "self", ")", ":", "\n", "        ", "return", "{", "\n", "\"intransitive_verbs\"", ":", "self", ".", "_intransitive_verbs", ",", "\n", "\"transitive_verbs\"", ":", "self", ".", "_transitive_verbs", ",", "\n", "\"nouns\"", ":", "self", ".", "_nouns", ",", "\n", "\"adverbs\"", ":", "self", ".", "_adverbs", ",", "\n", "\"color_adjectives\"", ":", "self", ".", "_color_adjectives", ",", "\n", "\"size_adjectives\"", ":", "self", ".", "_size_adjectives", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.from_representation": [[166, 171], ["cls"], "methods", ["None"], ["", "@", "classmethod", "\n", "def", "from_representation", "(", "cls", ",", "representation", ":", "Dict", "[", "str", ",", "Dict", "[", "str", ",", "str", "]", "]", ")", ":", "\n", "        ", "return", "cls", "(", "representation", "[", "\"intransitive_verbs\"", "]", ",", "representation", "[", "\"transitive_verbs\"", "]", ",", "\n", "representation", "[", "\"adverbs\"", "]", ",", "representation", "[", "\"nouns\"", "]", ",", "representation", "[", "\"color_adjectives\"", "]", ",", "\n", "representation", "[", "\"size_adjectives\"", "]", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Rule.__init__": [[46, 51], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "lhs", ":", "Nonterminal", ",", "rhs", ":", "List", ",", "max_recursion", "=", "2", ")", ":", "\n", "        ", "self", ".", "lhs", "=", "lhs", "\n", "self", ".", "rhs", "=", "rhs", "\n", "self", ".", "sem_type", "=", "None", "\n", "self", ".", "max_recursion", "=", "max_recursion", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Rule.instantiate": [[52, 54], ["NotImplementedError"], "methods", ["None"], ["", "def", "instantiate", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "raise", "NotImplementedError", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.LexicalRule.__init__": [[60, 65], ["grammar.Rule.__init__", "Terminal"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "lhs", ":", "Nonterminal", ",", "word", ":", "str", ",", "specs", ":", "Weights", ",", "sem_type", ":", "SemType", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "lhs", "=", "lhs", ",", "rhs", "=", "[", "Terminal", "(", "word", ")", "]", ",", "max_recursion", "=", "1", ")", "\n", "self", ".", "name", "=", "word", "\n", "self", ".", "sem_type", "=", "sem_type", "\n", "self", ".", "specs", "=", "specs", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.LexicalRule.instantiate": [[66, 72], ["grammar.free_var", "GroundedScan.world.LogicalForm", "GroundedScan.world.Term"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.free_var"], ["", "def", "instantiate", "(", "self", ",", "meta", "=", "None", ",", "**", "kwargs", ")", "->", "LogicalForm", ":", "\n", "# TODO a little fishy to have recursion meta here rather than in wrapper", "\n", "        ", "var", "=", "free_var", "(", "self", ".", "sem_type", ")", "\n", "return", "LogicalForm", "(", "\n", "variables", "=", "(", "var", ",", ")", ",", "\n", "terms", "=", "(", "Term", "(", "self", ".", "name", ",", "(", "var", ",", ")", ",", "specs", "=", "self", ".", "specs", ",", "meta", "=", "meta", ")", ",", ")", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.LexicalRule.__repr__": [[74, 78], ["None"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "lhs", "=", "self", ".", "lhs", ".", "name", "\n", "rhs", "=", "self", ".", "rhs", "[", "0", "]", ".", "name", "\n", "return", "\"{} -> {}\"", ".", "format", "(", "lhs", ",", "rhs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Root.__init__": [[81, 83], ["grammar.Rule.__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "lhs", "=", "ROOT", ",", "rhs", "=", "[", "VP", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Root.instantiate": [[84, 86], ["None"], "methods", ["None"], ["", "def", "instantiate", "(", "self", ",", "child", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "child", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Root.__repr__": [[87, 89], ["None"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "\"ROOT -> VP\"", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.RootConj.__init__": [[92, 94], ["grammar.Rule.__init__", "Terminal"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "max_recursion", "=", "0", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "lhs", "=", "ROOT", ",", "rhs", "=", "[", "VP", ",", "Terminal", "(", "\"and\"", ")", ",", "ROOT", "]", ",", "max_recursion", "=", "max_recursion", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.RootConj.instantiate": [[95, 99], ["GroundedScan.world.LogicalForm", "GroundedScan.world.Term"], "methods", ["None"], ["", "def", "instantiate", "(", "self", ",", "left_child", ",", "right_child", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "LogicalForm", "(", "\n", "variables", "=", "left_child", ".", "variables", "+", "right_child", ".", "variables", ",", "\n", "terms", "=", "left_child", ".", "terms", "+", "right_child", ".", "terms", "+", "(", "Term", "(", "\"seq\"", ",", "(", "left_child", ".", "head", ",", "right_child", ".", "head", ")", ")", ",", ")", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.RootConj.__repr__": [[101, 103], ["None"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "\"ROOT -> VP 'and' ROOT\"", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.VpWrapper.__init__": [[106, 108], ["grammar.Rule.__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "max_recursion", "=", "0", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "lhs", "=", "VP", ",", "rhs", "=", "[", "VP", ",", "RB", "]", ",", "max_recursion", "=", "max_recursion", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.VpWrapper.instantiate": [[109, 113], ["rb.bind", "GroundedScan.world.LogicalForm"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.bind"], ["", "def", "instantiate", "(", "self", ",", "rb", ",", "vp", ",", "meta", ",", "**", "kwargs", ")", ":", "\n", "        ", "bound", "=", "rb", ".", "bind", "(", "vp", ".", "head", ")", "\n", "assert", "bound", ".", "variables", "[", "0", "]", "==", "vp", ".", "head", "\n", "return", "LogicalForm", "(", "variables", "=", "vp", ".", "variables", "+", "bound", ".", "variables", "[", "1", ":", "]", ",", "terms", "=", "vp", ".", "terms", "+", "bound", ".", "terms", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.VpWrapper.__repr__": [[114, 116], ["None"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "\"VP -> VP RB\"", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.VpIntransitive.__init__": [[119, 121], ["grammar.Rule.__init__", "Terminal"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "lhs", "=", "VP", ",", "rhs", "=", "[", "VV_intransitive", ",", "Terminal", "(", "\"to\"", ")", ",", "DP", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.VpIntransitive.instantiate": [[122, 126], ["GroundedScan.world.Term", "meta[].append", "GroundedScan.world.LogicalForm"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "instantiate", "(", "self", ",", "vv", ",", "dp", ",", "meta", ",", "**", "kwargs", ")", ":", "\n", "        ", "role", "=", "Term", "(", "\"patient\"", ",", "(", "vv", ".", "head", ",", "dp", ".", "head", ")", ")", "\n", "meta", "[", "\"arguments\"", "]", ".", "append", "(", "dp", ")", "\n", "return", "LogicalForm", "(", "variables", "=", "vv", ".", "variables", "+", "dp", ".", "variables", ",", "terms", "=", "vv", ".", "terms", "+", "dp", ".", "terms", "+", "(", "role", ",", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.VpIntransitive.__repr__": [[127, 129], ["None"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "\"VP -> VV_intrans 'to' DP\"", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.VpTransitive.__init__": [[132, 134], ["grammar.Rule.__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "lhs", "=", "VP", ",", "rhs", "=", "[", "VV_transitive", ",", "DP", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.VpTransitive.instantiate": [[135, 139], ["GroundedScan.world.Term", "meta[].append", "GroundedScan.world.LogicalForm"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "instantiate", "(", "self", ",", "vv", ",", "dp", ",", "meta", ",", "**", "kwargs", ")", ":", "\n", "        ", "role", "=", "Term", "(", "\"patient\"", ",", "(", "vv", ".", "head", ",", "dp", ".", "head", ")", ")", "\n", "meta", "[", "\"arguments\"", "]", ".", "append", "(", "dp", ")", "\n", "return", "LogicalForm", "(", "variables", "=", "vv", ".", "variables", "+", "dp", ".", "variables", ",", "terms", "=", "vv", ".", "terms", "+", "dp", ".", "terms", "+", "(", "role", ",", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.VpTransitive.__repr__": [[140, 142], ["None"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "\"VP -> VV_trans DP\"", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Dp.__init__": [[145, 147], ["grammar.Rule.__init__", "Terminal"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "lhs", "=", "DP", ",", "rhs", "=", "[", "Terminal", "(", "\"a\"", ")", ",", "NP", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Dp.instantiate": [[148, 150], ["None"], "methods", ["None"], ["", "def", "instantiate", "(", "self", ",", "np", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "np", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Dp.__repr__": [[151, 153], ["None"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "\"DP -> 'a' NP\"", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.NpWrapper.__init__": [[156, 158], ["grammar.Rule.__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "max_recursion", "=", "0", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "lhs", "=", "NP", ",", "rhs", "=", "[", "JJ", ",", "NP", "]", ",", "max_recursion", "=", "max_recursion", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.NpWrapper.instantiate": [[159, 163], ["jj.bind", "GroundedScan.world.LogicalForm"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.bind"], ["", "def", "instantiate", "(", "self", ",", "jj", ",", "np", ",", "meta", "=", "None", ",", "**", "kwargs", ")", ":", "\n", "        ", "bound", "=", "jj", ".", "bind", "(", "np", ".", "head", ")", "\n", "assert", "bound", ".", "variables", "[", "0", "]", "==", "np", ".", "head", "\n", "return", "LogicalForm", "(", "variables", "=", "np", ".", "variables", "+", "bound", ".", "variables", "[", "1", ":", "]", ",", "terms", "=", "np", ".", "terms", "+", "bound", ".", "terms", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.NpWrapper.__repr__": [[164, 166], ["None"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "\"NP -> JJ NP\"", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Np.__init__": [[169, 171], ["grammar.Rule.__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "lhs", "=", "NP", ",", "rhs", "=", "[", "NN", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Np.instantiate": [[172, 174], ["None"], "methods", ["None"], ["", "def", "instantiate", "(", "self", ",", "nn", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "nn", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Np.__repr__": [[175, 177], ["None"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "\"NP -> NN\"", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.__init__": [[185, 190], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "rule", ",", "children", "=", "None", ",", "meta", "=", "{", "}", ")", ":", "\n", "        ", "self", ".", "rule", "=", "rule", "\n", "self", ".", "lhs", "=", "rule", ".", "lhs", "\n", "self", ".", "children", "=", "children", "\n", "self", ".", "meta", "=", "meta", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_rules": [[191, 206], ["isinstance", "grammar.Derivation", "lexicon.keys", "rules.pop", "lexicon[].pop", "tuple", "cls.from_rules"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_rules"], ["", "@", "classmethod", "\n", "def", "from_rules", "(", "cls", ",", "rules", ":", "list", ",", "symbol", "=", "ROOT", ",", "lexicon", "=", "None", ")", ":", "\n", "        ", "\"\"\"Recursively form a derivation from a rule list that has been constructed in a depth-first manner,\n        use the lexicon for the Lexical Rules at the leafs of the constituency tree.\"\"\"", "\n", "# If the current symbol is a Terminal, close current branch and return.", "\n", "if", "isinstance", "(", "symbol", ",", "Terminal", ")", ":", "\n", "            ", "return", "symbol", "\n", "", "if", "symbol", "not", "in", "lexicon", ".", "keys", "(", ")", ":", "\n", "            ", "next_rule", "=", "rules", ".", "pop", "(", ")", "\n", "", "else", ":", "\n", "            ", "next_rule", "=", "lexicon", "[", "symbol", "]", ".", "pop", "(", ")", "\n", "\n", "", "return", "Derivation", "(", "\n", "next_rule", ",", "\n", "tuple", "(", "cls", ".", "from_rules", "(", "rules", ",", "symbol", "=", "next_symbol", ",", "lexicon", "=", "lexicon", ")", "for", "next_symbol", "in", "next_rule", ".", "rhs", ")", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.to_rules": [[208, 222], ["isinstance", "isinstance", "rules.append", "child.to_rules"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.to_rules"], ["", "def", "to_rules", "(", "self", ",", "rules", ":", "list", ",", "lexicon", ":", "dict", ")", ":", "\n", "        ", "for", "child", "in", "self", ".", "children", ":", "\n", "            ", "if", "isinstance", "(", "child", ",", "Derivation", ")", ":", "\n", "                ", "child", ".", "to_rules", "(", "rules", ",", "lexicon", ")", "\n", "", "else", ":", "\n", "                ", "lexicon", "[", "child", "]", "=", "[", "child", "]", "\n", "", "", "if", "isinstance", "(", "self", ".", "rule", ",", "LexicalRule", ")", ":", "\n", "            ", "if", "self", ".", "rule", ".", "lhs", "not", "in", "lexicon", ":", "\n", "                ", "lexicon", "[", "self", ".", "rule", ".", "lhs", "]", "=", "[", "self", ".", "rule", "]", "\n", "", "else", ":", "\n", "                ", "lexicon", "[", "self", ".", "rule", ".", "lhs", "]", "=", "[", "self", ".", "rule", "]", "+", "lexicon", "[", "self", ".", "rule", ".", "lhs", "]", "\n", "", "", "else", ":", "\n", "            ", "rules", ".", "append", "(", "self", ".", "rule", ")", "\n", "", "return", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words": [[223, 232], ["tuple", "isinstance", "out.append", "child.words"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words"], ["", "def", "words", "(", "self", ")", "->", "tuple", ":", "\n", "        ", "\"\"\"Obtain all words of a derivation by combining the words of all the children.\"\"\"", "\n", "out", "=", "[", "]", "\n", "for", "child", "in", "self", ".", "children", ":", "\n", "            ", "if", "isinstance", "(", "child", ",", "Terminal", ")", ":", "\n", "                ", "out", ".", "append", "(", "child", ".", "name", ")", "\n", "", "else", ":", "\n", "                ", "out", "+=", "child", ".", "words", "(", ")", "\n", "", "", "return", "tuple", "(", "out", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.meaning": [[234, 246], ["hasattr", "grammar.Derivation.rule.instantiate", "child.meaning", "isinstance"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Np.instantiate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.meaning"], ["", "def", "meaning", "(", "self", ",", "arguments", ":", "list", ")", "->", "LogicalForm", ":", "\n", "        ", "\"\"\"Recursively define the meaning of the derivation by instantiating the meaning of each child.\"\"\"", "\n", "self", ".", "meta", "[", "\"arguments\"", "]", "=", "arguments", "\n", "if", "not", "hasattr", "(", "self", ",", "\"_cached_logical_form\"", ")", ":", "\n", "            ", "child_meanings", "=", "[", "\n", "child", ".", "meaning", "(", "arguments", ")", "\n", "for", "child", "in", "self", ".", "children", "\n", "if", "isinstance", "(", "child", ",", "Derivation", ")", "\n", "]", "\n", "meaning", "=", "self", ".", "rule", ".", "instantiate", "(", "*", "child_meanings", ",", "meta", "=", "self", ".", "meta", ")", "\n", "self", ".", "_cached_logical_form", "=", "meaning", "\n", "", "return", "self", ".", "_cached_logical_form", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_str": [[247, 269], ["rules_str.split", "lexicon_str.split", "cls.from_rules", "rules_list.append", "entry.split", "Terminal", "lexicon[].append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "@", "classmethod", "\n", "def", "from_str", "(", "cls", ",", "rules_str", ",", "lexicon_str", ",", "grammar", ")", ":", "\n", "# TODO: method to instantiate derivation from str (see __repr__)", "\n", "        ", "rules_list", "=", "[", "]", "\n", "for", "rule", "in", "rules_str", ".", "split", "(", "','", ")", ":", "\n", "            ", "rules_list", ".", "append", "(", "grammar", ".", "rule_str_to_rules", "[", "rule", "]", ")", "\n", "", "lexicon", "=", "{", "}", "\n", "lexicon_list", "=", "lexicon_str", ".", "split", "(", "','", ")", "\n", "for", "entry", "in", "lexicon_list", ":", "\n", "            ", "items", "=", "entry", ".", "split", "(", "':'", ")", "\n", "symbol_type", "=", "items", "[", "0", "]", "\n", "for", "item", "in", "items", "[", "1", ":", "]", ":", "\n", "                ", "if", "symbol_type", "==", "'T'", ":", "\n", "                    ", "new_terminal", "=", "Terminal", "(", "item", ")", "\n", "lexicon", "[", "new_terminal", "]", "=", "[", "new_terminal", "]", "\n", "", "else", ":", "\n", "                    ", "rule", "=", "grammar", ".", "rule_str_to_rules", "[", "item", "]", "\n", "if", "rule", ".", "lhs", "not", "in", "lexicon", ":", "\n", "                        ", "lexicon", "[", "rule", ".", "lhs", "]", "=", "[", "rule", "]", "\n", "", "else", ":", "\n", "                        ", "lexicon", "[", "rule", ".", "lhs", "]", ".", "append", "(", "rule", ")", "\n", "", "", "", "", "return", "cls", ".", "from_rules", "(", "rules_list", ",", "lexicon", "=", "lexicon", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.__repr__": [[270, 286], ["grammar.Derivation.to_rules", "lexicon.items", "isinstance", "str", "lexicon_list.append", "lexicon_list.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.to_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "rules", "=", "[", "]", "\n", "lexicon", "=", "{", "}", "\n", "self", ".", "to_rules", "(", "rules", ",", "lexicon", ")", "\n", "rules_str", "=", "','", ".", "join", "(", "[", "str", "(", "rule", ")", "for", "rule", "in", "rules", "]", ")", "\n", "lexicon_list", "=", "[", "]", "\n", "for", "key", ",", "value", "in", "lexicon", ".", "items", "(", ")", ":", "\n", "            ", "if", "isinstance", "(", "key", ",", "Nonterminal", ")", ":", "\n", "                ", "symbol_str", "=", "\"NT\"", "\n", "for", "rhs_symbol", "in", "value", ":", "\n", "                    ", "symbol_str", "+=", "\":{}\"", ".", "format", "(", "rhs_symbol", ")", "\n", "", "lexicon_list", ".", "append", "(", "symbol_str", ")", "\n", "", "else", ":", "\n", "                ", "lexicon_list", ".", "append", "(", "\"T:{}\"", ".", "format", "(", "value", "[", "0", "]", ".", "name", ")", ")", "\n", "", "", "lexicon_str", "=", "','", ".", "join", "(", "lexicon_list", ")", "\n", "return", "rules_str", "+", "';'", "+", "lexicon_str", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Template.__init__": [[294, 299], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "_left_values", "=", "[", "]", "\n", "self", ".", "_right_values", "=", "[", "]", "\n", "self", ".", "_leftmost_nonterminal", "=", "None", "\n", "self", ".", "rules", "=", "[", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Template.add_value": [[300, 307], ["grammar.Template._right_values.append", "grammar.Template._left_values.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "add_value", "(", "self", ",", "value", ",", "expandable", ")", ":", "\n", "        ", "if", "expandable", "and", "not", "self", ".", "_leftmost_nonterminal", ":", "\n", "            ", "self", ".", "_leftmost_nonterminal", "=", "value", "\n", "", "elif", "self", ".", "_leftmost_nonterminal", ":", "\n", "            ", "self", ".", "_right_values", ".", "append", "(", "value", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "_left_values", ".", "append", "(", "value", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Template.has_nonterminal": [[308, 310], ["None"], "methods", ["None"], ["", "", "def", "has_nonterminal", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_leftmost_nonterminal", "is", "not", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Template.get_leftmost_nonterminal": [[311, 314], ["grammar.Template.has_nonterminal"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Template.has_nonterminal"], ["", "def", "get_leftmost_nonterminal", "(", "self", ")", ":", "\n", "        ", "assert", "self", ".", "has_nonterminal", "(", ")", ",", "\"Trying to get a NT but none present in this derivation.\"", "\n", "return", "self", ".", "_leftmost_nonterminal", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Template.expand_leftmost_nonterminal": [[315, 326], ["grammar.Template", "grammar.Template.rules.copy", "Template.rules.append", "grammar.Template.add_value", "grammar.Template.add_value"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Template.add_value", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Template.add_value"], ["", "def", "expand_leftmost_nonterminal", "(", "self", ",", "rule", ",", "expandables", ")", ":", "\n", "        ", "new_derivation", "=", "Template", "(", ")", "\n", "new_derivation_symbols", "=", "self", ".", "_left_values", "+", "rule", ".", "rhs", "+", "self", ".", "_right_values", "\n", "new_derivation", ".", "rules", "=", "self", ".", "rules", ".", "copy", "(", ")", "\n", "new_derivation", ".", "rules", ".", "append", "(", "rule", ")", "\n", "for", "value", "in", "new_derivation_symbols", ":", "\n", "            ", "if", "value", "in", "expandables", ":", "\n", "                ", "new_derivation", ".", "add_value", "(", "value", ",", "expandable", "=", "True", ")", "\n", "", "else", ":", "\n", "                ", "new_derivation", ".", "add_value", "(", "value", ",", "expandable", "=", "False", ")", "\n", "", "", "return", "new_derivation", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Template.to_derivation": [[327, 331], ["grammar.Template.rules.reverse", "grammar.Template.has_nonterminal"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Template.has_nonterminal"], ["", "def", "to_derivation", "(", "self", ")", ":", "\n", "        ", "assert", "not", "self", ".", "has_nonterminal", "(", ")", ",", "\"Trying to write a non-terminal to a string.\"", "\n", "self", ".", "rules", ".", "reverse", "(", ")", "\n", "return", "self", ".", "_left_values", ",", "self", ".", "rules", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.__init__": [[344, 394], ["set", "grammar.Grammar.categories.items", "grammar.Grammar.empty_command_statistics", "grammar.Grammar.lexical_rules", "grammar.Grammar.rules[].append", "set", "set", "set", "len", "vocabulary.get_intransitive_verbs", "vocabulary.get_transitive_verbs", "vocabulary.get_adverbs", "vocabulary.get_nouns", "vocabulary.get_color_adjectives", "vocabulary.get_size_adjectives", "isinstance", "vocabulary.get_adverbs", "vocabulary.get_intransitive_verbs", "len", "str", "grammar.Grammar.rhs_dictionary[].append", "vocabulary.get_nouns", "vocabulary.get_transitive_verbs", "isinstance", "vocabulary.get_color_adjectives", "vocabulary.get_size_adjectives"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.empty_command_statistics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.lexical_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_intransitive_verbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_transitive_verbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_nouns", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_color_adjectives", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_size_adjectives", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_intransitive_verbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_nouns", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_transitive_verbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_color_adjectives", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_size_adjectives"], ["def", "__init__", "(", "self", ",", "vocabulary", ":", "ClassVar", ",", "max_recursion", "=", "1", ",", "type_grammar", "=", "\"normal\"", ")", ":", "\n", "        ", "\"\"\"\n        Defines a grammar of NT -> NT rules and NT -> T rules depending on the vocabulary.\n        :param vocabulary: an instance of class Vocabulary filled with different types of words.\n        :param max_recursion: Maximum recursion to be allowed in generation of examples.\n        :param type_grammar: options are 'full', 'adverb', 'normal' and 'simple'. Determines which set of common rules\n        is chosen.\n        \"\"\"", "\n", "assert", "type_grammar", "in", "self", ".", "RULES", ",", "\"Specified unsupported type grammar {}\"", ".", "format", "(", "type_grammar", ")", "\n", "self", ".", "type_grammar", "=", "type_grammar", "\n", "if", "type_grammar", "==", "\"simple_intrans\"", ":", "\n", "            ", "assert", "len", "(", "vocabulary", ".", "get_intransitive_verbs", "(", ")", ")", ">", "0", ",", "\"Please specify intransitive verbs.\"", "\n", "", "elif", "type_grammar", "==", "\"simple_trans\"", ":", "\n", "            ", "assert", "len", "(", "vocabulary", ".", "get_transitive_verbs", "(", ")", ")", ">", "0", ",", "\"Please specify transitive verbs.\"", "\n", "", "self", ".", "rule_list", "=", "self", ".", "RULES", "[", "type_grammar", "]", "+", "self", ".", "lexical_rules", "(", "vocabulary", ".", "get_intransitive_verbs", "(", ")", ",", "\n", "vocabulary", ".", "get_transitive_verbs", "(", ")", ",", "\n", "vocabulary", ".", "get_adverbs", "(", ")", ",", "\n", "vocabulary", ".", "get_nouns", "(", ")", ",", "\n", "vocabulary", ".", "get_color_adjectives", "(", ")", ",", "\n", "vocabulary", ".", "get_size_adjectives", "(", ")", ")", "\n", "nonterminals", "=", "{", "rule", ".", "lhs", "for", "rule", "in", "self", ".", "rule_list", "}", "\n", "self", ".", "rules", "=", "{", "nonterminal", ":", "[", "]", "for", "nonterminal", "in", "nonterminals", "}", "\n", "self", ".", "nonterminals", "=", "{", "nt", ".", "name", ":", "nt", "for", "nt", "in", "nonterminals", "}", "\n", "self", ".", "terminals", "=", "{", "}", "\n", "self", ".", "rhs_dictionary", "=", "{", "nt", ":", "[", "]", "for", "nt", "in", "nonterminals", "}", "\n", "\n", "self", ".", "vocabulary", "=", "vocabulary", "\n", "self", ".", "rule_str_to_rules", "=", "{", "}", "\n", "for", "rule", "in", "self", ".", "rule_list", ":", "\n", "            ", "self", ".", "rules", "[", "rule", ".", "lhs", "]", ".", "append", "(", "rule", ")", "\n", "self", ".", "rule_str_to_rules", "[", "str", "(", "rule", ")", "]", "=", "rule", "\n", "for", "rhs_symbol", "in", "rule", ".", "rhs", ":", "\n", "                ", "if", "isinstance", "(", "rhs_symbol", ",", "Nonterminal", ")", ":", "\n", "                    ", "self", ".", "rhs_dictionary", "[", "rhs_symbol", "]", ".", "append", "(", "rule", ")", "\n", "", "", "", "self", ".", "expandables", "=", "set", "(", "rule", ".", "lhs", "for", "rule", "in", "self", ".", "rule_list", "if", "not", "isinstance", "(", "rule", ",", "LexicalRule", ")", ")", "\n", "self", ".", "categories", "=", "{", "\n", "\"manner\"", ":", "set", "(", "vocabulary", ".", "get_adverbs", "(", ")", ")", ",", "\n", "\"shape\"", ":", "{", "n", "for", "n", "in", "vocabulary", ".", "get_nouns", "(", ")", "}", ",", "\n", "\"color\"", ":", "set", "(", "[", "v", "for", "v", "in", "vocabulary", ".", "get_color_adjectives", "(", ")", "]", ")", ",", "\n", "\"size\"", ":", "set", "(", "[", "v", "for", "v", "in", "vocabulary", ".", "get_size_adjectives", "(", ")", "]", ")", "\n", "}", "\n", "self", ".", "word_to_category", "=", "{", "}", "\n", "for", "category", ",", "words", "in", "self", ".", "categories", ".", "items", "(", ")", ":", "\n", "            ", "for", "word", "in", "words", ":", "\n", "                ", "self", ".", "word_to_category", "[", "word", "]", "=", "category", "\n", "\n", "", "", "self", ".", "max_recursion", "=", "max_recursion", "\n", "self", ".", "all_templates", "=", "[", "]", "\n", "self", ".", "all_derivations", "=", "{", "}", "\n", "self", ".", "command_statistics", "=", "self", ".", "empty_command_statistics", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.empty_command_statistics": [[395, 403], ["None"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "empty_command_statistics", "(", ")", ":", "\n", "        ", "return", "{", "\n", "VV_intransitive", ":", "{", "}", ",", "\n", "VV_transitive", ":", "{", "}", ",", "\n", "NN", ":", "{", "}", ",", "\n", "JJ", ":", "{", "}", ",", "\n", "RB", ":", "{", "}", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.reset_grammar": [[405, 409], ["grammar.Grammar.empty_command_statistics", "grammar.Grammar.all_templates.clear", "grammar.Grammar.all_derivations.clear"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.empty_command_statistics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.clear", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.clear"], ["", "def", "reset_grammar", "(", "self", ")", ":", "\n", "        ", "self", ".", "command_statistics", "=", "self", ".", "empty_command_statistics", "(", ")", "\n", "self", ".", "all_templates", ".", "clear", "(", ")", "\n", "self", ".", "all_derivations", ".", "clear", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.lexical_rules": [[410, 443], ["grammar.LexicalRule", "grammar.LexicalRule", "jj_rules.extend", "jj_rules.extend", "grammar.LexicalRule", "grammar.LexicalRule", "GroundedScan.world.Weights", "GroundedScan.world.Weights", "grammar.LexicalRule", "grammar.LexicalRule", "GroundedScan.world.Weights", "GroundedScan.world.Weights", "GroundedScan.world.Weights", "GroundedScan.world.Weights"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend"], ["", "def", "lexical_rules", "(", "self", ",", "verbs_intrans", ":", "List", "[", "str", "]", ",", "verbs_trans", ":", "List", "[", "str", "]", ",", "adverbs", ":", "List", "[", "str", "]", ",", "nouns", ":", "List", "[", "str", "]", ",", "\n", "color_adjectives", ":", "List", "[", "str", "]", ",", "size_adjectives", ":", "List", "[", "str", "]", ")", "->", "list", ":", "\n", "        ", "\"\"\"\n        Instantiate the lexical rules with the sampled words from the vocabulary.\n        \"\"\"", "\n", "assert", "size_adjectives", "or", "color_adjectives", ",", "\"Please specify words for at least one of size_adjectives or \"", "\"color_adjectives.\"", "\n", "all_rules", "=", "[", "]", "\n", "vv_intrans_rules", "=", "[", "\n", "LexicalRule", "(", "lhs", "=", "VV_intransitive", ",", "word", "=", "verb", ",", "sem_type", "=", "EVENT", ",", "specs", "=", "Weights", "(", "action", "=", "verb", ",", "is_transitive", "=", "False", ")", ")", "\n", "for", "verb", "in", "verbs_intrans", "\n", "]", "\n", "all_rules", "+=", "vv_intrans_rules", "\n", "if", "self", ".", "type_grammar", "!=", "\"simple\"", ":", "\n", "            ", "vv_trans_rules", "=", "[", "\n", "LexicalRule", "(", "lhs", "=", "VV_transitive", ",", "word", "=", "verb", ",", "sem_type", "=", "EVENT", ",", "specs", "=", "Weights", "(", "action", "=", "verb", ",", "is_transitive", "=", "True", ")", ")", "\n", "for", "verb", "in", "verbs_trans", "\n", "]", "\n", "all_rules", "+=", "vv_trans_rules", "\n", "", "if", "self", ".", "type_grammar", "==", "\"adverb\"", "or", "self", ".", "type_grammar", "==", "\"full\"", ":", "\n", "            ", "rb_rules", "=", "[", "LexicalRule", "(", "lhs", "=", "RB", ",", "word", "=", "word", ",", "sem_type", "=", "EVENT", ",", "specs", "=", "Weights", "(", "manner", "=", "word", ")", ")", "for", "word", "in", "adverbs", "]", "\n", "all_rules", "+=", "rb_rules", "\n", "", "nn_rules", "=", "[", "LexicalRule", "(", "lhs", "=", "NN", ",", "word", "=", "word", ",", "sem_type", "=", "ENTITY", ",", "specs", "=", "Weights", "(", "noun", "=", "word", ")", ")", "for", "word", "in", "nouns", "]", "\n", "all_rules", "+=", "nn_rules", "\n", "jj_rules", "=", "[", "]", "\n", "if", "color_adjectives", ":", "\n", "            ", "jj_rules", ".", "extend", "(", "[", "LexicalRule", "(", "lhs", "=", "JJ", ",", "word", "=", "word", ",", "sem_type", "=", "ENTITY", ",", "specs", "=", "Weights", "(", "adjective_type", "=", "COLOR", ")", ")", "\n", "for", "word", "in", "color_adjectives", "]", ")", "\n", "", "if", "size_adjectives", ":", "\n", "            ", "jj_rules", ".", "extend", "(", "[", "LexicalRule", "(", "lhs", "=", "JJ", ",", "word", "=", "word", ",", "sem_type", "=", "ENTITY", ",", "specs", "=", "Weights", "(", "adjective_type", "=", "SIZE", ")", ")", "\n", "for", "word", "in", "size_adjectives", "]", ")", "\n", "", "all_rules", "+=", "jj_rules", "\n", "return", "all_rules", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample": [[444, 468], ["isinstance", "grammar.Derivation", "tuple", "numpy.random.randint", "len", "grammar.Grammar.sample"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample"], ["", "def", "sample", "(", "self", ",", "symbol", "=", "ROOT", ",", "last_rule", "=", "None", ",", "recursion", "=", "0", ")", ":", "\n", "        ", "\"\"\"\n        Sample a command from the grammar by recursively sampling rules for each symbol.\n        :param symbol: current node in constituency tree.\n        :param last_rule:  previous rule sampled.\n        :param recursion: recursion depth (increases if sample ruled is applied twice).\n        :return: Derivation\n        \"\"\"", "\n", "# If the current symbol is a Terminal, close current branch and return.", "\n", "if", "isinstance", "(", "symbol", ",", "Terminal", ")", ":", "\n", "            ", "return", "symbol", "\n", "", "nonterminal_rules", "=", "self", ".", "rules", "[", "symbol", "]", "\n", "\n", "# Filter out last rule if max recursion depth is reached.", "\n", "if", "recursion", "==", "self", ".", "max_recursion", "-", "1", ":", "\n", "            ", "nonterminal_rules", "=", "[", "rule", "for", "rule", "in", "nonterminal_rules", "if", "rule", "!=", "last_rule", "]", "\n", "\n", "# Sample a random rule.", "\n", "", "next_rule", "=", "nonterminal_rules", "[", "np", ".", "random", ".", "randint", "(", "len", "(", "nonterminal_rules", ")", ")", "]", "\n", "next_recursion", "=", "recursion", "+", "1", "if", "next_rule", "==", "last_rule", "else", "0", "\n", "return", "Derivation", "(", "\n", "next_rule", ",", "\n", "tuple", "(", "self", ".", "sample", "(", "next_symbol", ",", "next_rule", ",", "next_recursion", ")", "for", "next_symbol", "in", "next_rule", ".", "rhs", ")", ",", "\n", "meta", "=", "{", "\"recursion\"", ":", "recursion", "}", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample_constrained": [[470, 517], ["grammar.Derivation", "enumerate", "list", "Nonterminal", "list_derivation.append", "len", "next_children.append", "grammar.Derivation", "grammar.Grammar.rule_str_to_rules.keys", "to_expand_indices.append", "to_expand.append", "to_expand.pop", "numpy.random.randint", "next_children.append", "len", "grammar.Grammar.sample"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample"], ["", "def", "sample_constrained", "(", "self", ",", "lexical_rule", ":", "str", ")", "->", "Derivation", ":", "\n", "        ", "\"\"\"Sample a derivation with a specified lexical rule, e.g. lexical_rule='RB -> cautiously'.\"\"\"", "\n", "assert", "lexical_rule", "in", "self", ".", "rule_str_to_rules", ",", "\"Unknown lexical_rule specified: {}. \\nOptions: {}\"", ".", "format", "(", "lexical_rule", ",", "\n", "list", "(", "self", ".", "rule_str_to_rules", ".", "keys", "(", ")", ")", ")", "\n", "\n", "# Start the list of rules with the constrained lexical rule.", "\n", "lexical_rule", "=", "self", ".", "rule_str_to_rules", "[", "lexical_rule", "]", "\n", "current_nonterminal", "=", "lexical_rule", ".", "lhs", "\n", "list_derivation", "=", "[", "lexical_rule", "]", "\n", "\n", "# Keep track of which NT's in the sampled RHS's of the rules aren't expanded yet.", "\n", "to_expand", "=", "[", "]", "\n", "to_expand_indices", "=", "[", "]", "\n", "rule_count", "=", "0", "\n", "previous_rule", "=", "None", "\n", "\n", "# Go to the left from rule and sample a new rule that contains this in the RHS until ROOT is reached.", "\n", "while", "current_nonterminal", "!=", "Nonterminal", "(", "name", "=", "\"ROOT\"", ")", ":", "\n", "# Find current lhs in a rhs rule.", "\n", "            ", "potential_rules", "=", "self", ".", "rhs_dictionary", "[", "current_nonterminal", "]", "\n", "chosen_rule", "=", "potential_rules", "[", "np", ".", "random", ".", "randint", "(", "len", "(", "potential_rules", ")", ")", "]", "\n", "if", "chosen_rule", "==", "previous_rule", ":", "# No recursion allowed.", "\n", "                ", "continue", "\n", "", "previous_rule", "=", "chosen_rule", "\n", "list_derivation", ".", "append", "(", "chosen_rule", ")", "\n", "nts_to_expand", "=", "[", "nt", "for", "nt", "in", "chosen_rule", ".", "rhs", "if", "nt", "!=", "current_nonterminal", "]", "\n", "if", "len", "(", "nts_to_expand", ")", ":", "\n", "                ", "to_expand_indices", ".", "append", "(", "rule_count", ")", "\n", "to_expand", ".", "append", "(", "nts_to_expand", ")", "\n", "", "rule_count", "+=", "1", "\n", "current_nonterminal", "=", "chosen_rule", ".", "lhs", "\n", "\n", "# Make a constituncy tree of the sampled rules while expanding the NT's that need to be expanded.", "\n", "", "current_children", "=", "list_derivation", "[", "0", "]", ".", "rhs", "\n", "current_rule", "=", "list_derivation", "[", "0", "]", "\n", "current_derivation", "=", "Derivation", "(", "current_rule", ",", "children", "=", "current_children", ")", "\n", "for", "i", ",", "next_rule", "in", "enumerate", "(", "list_derivation", "[", "1", ":", "]", ")", ":", "\n", "            ", "next_children", "=", "[", "]", "\n", "if", "i", "in", "to_expand_indices", ":", "\n", "                ", "nts_to_expand", "=", "to_expand", ".", "pop", "(", "0", ")", "\n", "for", "nt_to_expand", "in", "nts_to_expand", ":", "\n", "                    ", "next_children", ".", "append", "(", "self", ".", "sample", "(", "symbol", "=", "nt_to_expand", ",", "last_rule", "=", "next_rule", ")", ")", "\n", "", "", "next_children", ".", "append", "(", "current_derivation", ")", "\n", "next_derivation", "=", "Derivation", "(", "next_rule", ",", "children", "=", "next_children", ")", "\n", "current_derivation", "=", "next_derivation", "\n", "", "return", "current_derivation", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.generate_all": [[518, 555], ["current_template.get_leftmost_nonterminal", "current_template.has_nonterminal", "all_templates.append", "isinstance", "rule_use_counter.copy", "current_template.expand_leftmost_nonterminal", "grammar.Grammar.generate_all", "current_template.to_derivation", "rule_use_counter.copy.keys"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Template.get_leftmost_nonterminal", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Template.has_nonterminal", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Template.expand_leftmost_nonterminal", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.generate_all", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Template.to_derivation"], ["", "def", "generate_all", "(", "self", ",", "current_template", ":", "Template", ",", "all_templates", ":", "list", ",", "rule_use_counter", ":", "dict", ")", ":", "\n", "\n", "# If the template contains no non-terminals, we close this branch.", "\n", "        ", "if", "not", "current_template", ".", "has_nonterminal", "(", ")", ":", "\n", "            ", "all_templates", ".", "append", "(", "current_template", ".", "to_derivation", "(", ")", ")", "\n", "return", "\n", "\n", "# Retrieve the leftmost non-terminal to expand.", "\n", "", "leftmost_nonterminal", "=", "current_template", ".", "get_leftmost_nonterminal", "(", ")", "\n", "\n", "# Get all possible RHS replacements and start a new derivation branch for each of them.", "\n", "rules_leftmost_nonterminal", "=", "self", ".", "rules", "[", "leftmost_nonterminal", "]", "\n", "for", "rule_leftmost_nonterminal", "in", "rules_leftmost_nonterminal", ":", "\n", "\n", "# Lexical rules are not expandable", "\n", "            ", "if", "isinstance", "(", "rule_leftmost_nonterminal", ",", "LexicalRule", ")", ":", "\n", "                ", "continue", "\n", "\n", "# Each branch gets its own rule usage counter.", "\n", "", "rule_use_counter_copy", "=", "rule_use_counter", ".", "copy", "(", ")", "\n", "\n", "# If this rule has already been applied in the current branch..", "\n", "if", "rule_leftmost_nonterminal", "in", "rule_use_counter_copy", ".", "keys", "(", ")", ":", "\n", "\n", "# ..do not use it again if it has been applied more than a maximum allowed number of times.", "\n", "                ", "if", "rule_use_counter", "[", "rule_leftmost_nonterminal", "]", ">=", "rule_leftmost_nonterminal", ".", "max_recursion", ":", "\n", "                    ", "continue", "\n", "", "rule_use_counter_copy", "[", "rule_leftmost_nonterminal", "]", "+=", "1", "\n", "", "else", ":", "\n", "                ", "rule_use_counter_copy", "[", "rule_leftmost_nonterminal", "]", "=", "1", "\n", "\n", "# Get the next derivation by replacing the leftmost NT with its RHS.", "\n", "", "next_template", "=", "current_template", ".", "expand_leftmost_nonterminal", "(", "rule_leftmost_nonterminal", ",", "\n", "self", ".", "expandables", ")", "\n", "\n", "# Start a new derivation branch for this RHS.", "\n", "self", ".", "generate_all", "(", "next_template", ",", "all_templates", ",", "rule_use_counter_copy", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.form_commands_from_template": [[556, 608], ["isinstance", "zip", "grammar.Derivation.from_rules", "all_derivations.append", "replaced_template.append", "itertools.product", "isinstance", "derivation_rules.copy", "replaced_template.pop", "grammar.Grammar.split_on_category", "replaced_template.append", "replaced_template.append", "replaced_template.append", "grammar.Derivation.from_rules", "grammar.Grammar.command_statistics[].keys"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.split_on_category", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_rules"], ["", "", "def", "form_commands_from_template", "(", "self", ",", "derivation_template", ":", "list", ",", "derivation_rules", ":", "list", ")", ":", "\n", "        ", "\"\"\"\n        Replaces all NT's in a template with the possible T's and forms all possible commands with those.\n        If multiple the same NT's follow each other, e.g. a JJ JJ JJ NN, for each following JJ the possible words\n        will be halved over the possibilities, meaning no words will repeat themselves (e.g. the red red circle),\n        this does mean that whenever the max. recursion depth for a rule is larger than the log(n) where n is the number\n        of words for that particular rule, this does not have an effect.\n        :param derivation_template: list of NT's, e.g. [VV_intrans, 'to', 'a', JJ, JJ, NN, RB]\n        :param derivation_rules: list of rules that build up the constituency tree for this template\n        :return: all possible combinations where all NT's are replaced by the words from the lexicon.\n        \"\"\"", "\n", "\n", "# In the templates, replace each lexical rule with the possible words from the lexicon", "\n", "replaced_template", "=", "[", "]", "\n", "previous_symbol", "=", "None", "\n", "lexicon", "=", "{", "}", "\n", "for", "symbol", "in", "derivation_template", ":", "\n", "            ", "if", "isinstance", "(", "symbol", ",", "Nonterminal", ")", ":", "\n", "                ", "possible_words", "=", "[", "s", ".", "name", "for", "s", "in", "self", ".", "rules", "[", "symbol", "]", "]", "\n", "for", "rule", "in", "self", ".", "rules", "[", "symbol", "]", ":", "\n", "                    ", "lexicon", "[", "rule", ".", "name", "]", "=", "rule", "\n", "", "if", "previous_symbol", "==", "symbol", ":", "\n", "                    ", "previous_words", "=", "replaced_template", ".", "pop", "(", ")", "\n", "first_words", ",", "second_words", "=", "self", ".", "split_on_category", "(", "previous_words", ")", "\n", "replaced_template", ".", "append", "(", "first_words", ")", "\n", "replaced_template", ".", "append", "(", "second_words", ")", "\n", "", "else", ":", "\n", "                    ", "replaced_template", ".", "append", "(", "possible_words", ")", "\n", "", "", "else", ":", "\n", "                ", "lexicon", "[", "symbol", ".", "name", "]", "=", "symbol", "\n", "replaced_template", ".", "append", "(", "[", "symbol", ".", "name", "]", ")", "\n", "", "previous_symbol", "=", "symbol", "\n", "\n", "# Generate all possible commands from the templates.", "\n", "", "all_commands", "=", "[", "command", "for", "command", "in", "product", "(", "*", "replaced_template", ")", "]", "\n", "all_derivations", "=", "[", "]", "\n", "for", "command", "in", "all_commands", ":", "\n", "            ", "command_lexicon", "=", "{", "}", "\n", "for", "word", ",", "symbol", "in", "zip", "(", "command", ",", "derivation_template", ")", ":", "\n", "                ", "if", "symbol", "not", "in", "command_lexicon", ":", "\n", "                    ", "command_lexicon", "[", "symbol", "]", "=", "[", "lexicon", "[", "word", "]", "]", "\n", "", "else", ":", "\n", "                    ", "command_lexicon", "[", "symbol", "]", "=", "[", "lexicon", "[", "word", "]", "]", "+", "command_lexicon", "[", "symbol", "]", "\n", "", "if", "isinstance", "(", "symbol", ",", "Nonterminal", ")", ":", "\n", "                    ", "if", "word", "not", "in", "self", ".", "command_statistics", "[", "symbol", "]", ".", "keys", "(", ")", ":", "\n", "                        ", "self", ".", "command_statistics", "[", "symbol", "]", "[", "word", "]", "=", "1", "\n", "", "else", ":", "\n", "                        ", "self", ".", "command_statistics", "[", "symbol", "]", "[", "word", "]", "+=", "1", "\n", "", "", "", "derivation", "=", "Derivation", ".", "from_rules", "(", "derivation_rules", ".", "copy", "(", ")", ",", "symbol", "=", "ROOT", ",", "lexicon", "=", "command_lexicon", ")", "\n", "assert", "' '", ".", "join", "(", "derivation", ".", "words", "(", ")", ")", "==", "' '", ".", "join", "(", "command", ")", ",", "\"Derivation and command not the same.\"", "\n", "all_derivations", ".", "append", "(", "derivation", ")", "\n", "", "return", "all_derivations", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.generate_all_commands": [[609, 628], ["grammar.Template", "grammar.Template.add_value", "grammar.Grammar.generate_all", "enumerate", "enumerate", "grammar.Grammar.form_commands_from_template", "keep_templates.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Template.add_value", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.generate_all", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.form_commands_from_template", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "generate_all_commands", "(", "self", ",", "with_nonterminal", "=", "None", ")", ":", "\n", "\n", "# Generate all possible templates from the grammar.", "\n", "        ", "initial_template", "=", "Template", "(", ")", "\n", "initial_template", ".", "add_value", "(", "value", "=", "ROOT", ",", "expandable", "=", "True", ")", "\n", "self", ".", "generate_all", "(", "current_template", "=", "initial_template", ",", "all_templates", "=", "self", ".", "all_templates", ",", "\n", "rule_use_counter", "=", "{", "}", ")", "\n", "if", "with_nonterminal", ":", "\n", "            ", "assert", "with_nonterminal", "in", "self", ".", "nonterminals", ",", "\"Wrong nonterminal specified in generate_all_commands\"", "\n", "keep_templates", "=", "[", "]", "\n", "for", "i", ",", "template", "in", "enumerate", "(", "self", ".", "all_templates", ")", ":", "\n", "                ", "if", "self", ".", "nonterminals", "[", "with_nonterminal", "]", "in", "template", "[", "0", "]", ":", "\n", "                    ", "keep_templates", ".", "append", "(", "template", ")", "\n", "", "", "self", ".", "all_templates", "=", "keep_templates", "\n", "\n", "# For each template, form all possible commands by combining it with the lexicon.", "\n", "", "for", "i", ",", "(", "derivation_template", ",", "derivation_rules", ")", "in", "enumerate", "(", "self", ".", "all_templates", ")", ":", "\n", "            ", "derivations", "=", "self", ".", "form_commands_from_template", "(", "derivation_template", ",", "derivation_rules", ")", "\n", "self", ".", "all_derivations", "[", "i", "]", "=", "derivations", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.split_on_category": [[629, 639], ["grammar.Grammar.category", "grammar.Grammar.category", "first_category_words.append", "second_category_words.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.category", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.category", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "", "def", "split_on_category", "(", "self", ",", "words_list", ")", ":", "\n", "        ", "first_category_words", "=", "[", "words_list", "[", "0", "]", "]", "\n", "second_category_words", "=", "[", "]", "\n", "first_category", "=", "self", ".", "category", "(", "words_list", "[", "0", "]", ")", "\n", "for", "word", "in", "words_list", "[", "1", ":", "]", ":", "\n", "            ", "if", "self", ".", "category", "(", "word", ")", "==", "first_category", ":", "\n", "                ", "first_category_words", ".", "append", "(", "word", ")", "\n", "", "else", ":", "\n", "                ", "second_category_words", ".", "append", "(", "word", ")", "\n", "", "", "return", "first_category_words", ",", "second_category_words", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.category": [[640, 642], ["grammar.Grammar.word_to_category.get"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "def", "category", "(", "self", ",", "function", ")", ":", "\n", "        ", "return", "self", ".", "word_to_category", ".", "get", "(", "function", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.is_coherent": [[643, 655], ["grammar.Grammar.category", "len", "len", "set"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.category", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set"], ["", "def", "is_coherent", "(", "self", ",", "logical_form", ")", ":", "\n", "        ", "\"\"\"\n        Returns true for coherent logical forms, false otherwise. A command's logical form is coherent the\n        arguments of a variable have all unique categories. E.g. in coherent would be: 'the red blue circle'.\n        \"\"\"", "\n", "for", "variable", "in", "logical_form", ".", "variables", ":", "\n", "            ", "functions", "=", "[", "term", ".", "function", "for", "term", "in", "logical_form", ".", "terms", "if", "variable", "in", "term", ".", "arguments", "]", "\n", "categories", "=", "[", "self", ".", "category", "(", "function", ")", "for", "function", "in", "functions", "]", "\n", "categories", "=", "[", "c", "for", "c", "in", "categories", "if", "c", "is", "not", "None", "]", "\n", "if", "len", "(", "categories", ")", "!=", "len", "(", "set", "(", "categories", ")", ")", ":", "\n", "                ", "return", "False", "\n", "", "", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.__str__": [[656, 661], ["rule.__str__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.__str__"], ["", "def", "__str__", "(", "self", ")", ":", "\n", "        ", "output_str", "=", "\"\"", "\n", "for", "rule", "in", "self", ".", "rule_list", ":", "\n", "            ", "output_str", "+=", "rule", ".", "__str__", "(", ")", "+", "';'", "\n", "", "return", "output_str", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.free_var": [[36, 40], ["GroundedScan.world.Variable"], "function", ["None"], ["def", "free_var", "(", "sem_type", ")", ":", "\n", "    ", "name", "=", "\"x{}\"", ".", "format", "(", "VAR_COUNTER", "[", "0", "]", ")", "\n", "VAR_COUNTER", "[", "0", "]", "+=", "1", "\n", "return", "Variable", "(", "name", ",", "sem_type", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.__init__": [[27, 117], ["os.getcwd", "GroundedScan.world.ObjectVocabulary", "GroundedScan.world.World", "GroundedScan.grammar.Grammar", "dataset.GroundedScan.get_empty_split_dict", "dataset.GroundedScan.get_empty_split_dict", "dataset.GroundedScan._data_pairs_for_equivalence.keys", "dataset.GroundedScan.get_empty_split_dict", "collections.Counter", "isinstance", "isinstance", "isinstance", "isinstance", "isinstance", "isinstance", "GroundedScan.vocabulary.Vocabulary.initialize", "dataset.GroundedScan.get_empty_data_statistics", "GroundedScan.vocabulary.Vocabulary.sample", "dataset.GroundedScan._vocabulary.get_semantic_shapes", "dataset.GroundedScan._vocabulary.get_semantic_colors", "dataset.GroundedScan._vocabulary.get_semantic_colors", "dataset.GroundedScan._vocabulary.get_semantic_shapes", "dataset.GroundedScan._vocabulary.get_semantic_manners", "ValueError", "GroundedScan.vocabulary.Vocabulary", "ValueError"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_empty_split_dict", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_empty_split_dict", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_empty_split_dict", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.initialize", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_empty_data_statistics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_semantic_shapes", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_semantic_colors", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_semantic_colors", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_semantic_shapes", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_semantic_manners"], ["        ", "return", "self", ".", "_word_to_idx", "[", "word", "]", "\n", "\n", "", "def", "idx_to_word", "(", "self", ",", "idx", ":", "int", ")", "->", "str", ":", "\n", "        ", "return", "self", ".", "_idx_to_word", "[", "idx", "]", "\n", "\n", "", "def", "add_word", "(", "self", ",", "word", ":", "List", "[", "str", "]", ")", ":", "\n", "        ", "if", "word", "not", "in", "self", ".", "_word_to_idx", ":", "\n", "            ", "self", ".", "_word_to_idx", "[", "word", "]", "=", "self", ".", "size", "\n", "self", ".", "_idx_to_word", ".", "append", "(", "word", ")", "\n", "", "self", ".", "_word_frequencies", "[", "word", "]", "+=", "1", "\n", "\n", "", "def", "most_common", "(", "self", ",", "n", "=", "10", ")", ":", "\n", "        ", "return", "self", ".", "_word_frequencies", ".", "most_common", "(", "n", "=", "n", ")", "\n", "\n", "", "def", "contains_word", "(", "self", ",", "word", ":", "str", ")", "->", "bool", ":", "\n", "        ", "if", "word", "in", "self", ".", "_word_to_idx", ":", "\n", "            ", "return", "True", "\n", "", "else", ":", "\n", "            ", "return", "False", "\n", "\n", "", "", "@", "property", "\n", "def", "size", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "_idx_to_word", ")", "\n", "\n", "", "@", "classmethod", "\n", "def", "load", "(", "cls", ",", "path", ":", "str", ")", ":", "\n", "        ", "assert", "os", ".", "path", ".", "exists", "(", "path", ")", ",", "\"Trying to load a vocabulary from a non-existing file {}\"", ".", "format", "(", "path", ")", "\n", "with", "open", "(", "path", ",", "'r'", ")", "as", "infile", ":", "\n", "            ", "all_data", "=", "json", ".", "load", "(", "infile", ")", "\n", "vocab", "=", "cls", "(", ")", "\n", "vocab", ".", "_idx_to_word", "=", "all_data", "[", "\"idx_to_word\"", "]", "\n", "vocab", ".", "_word_to_idx", "=", "defaultdict", "(", "int", ")", "\n", "for", "word", ",", "idx", "in", "all_data", "[", "\"word_to_idx\"", "]", ".", "items", "(", ")", ":", "\n", "                ", "vocab", ".", "_word_to_idx", "[", "word", "]", "=", "idx", "\n", "", "vocab", ".", "_word_frequencies", "=", "Counter", "(", "all_data", "[", "\"word_frequencies\"", "]", ")", "\n", "", "return", "vocab", "\n", "\n", "", "def", "to_dict", "(", "self", ")", "->", "dict", ":", "\n", "        ", "return", "{", "\n", "\"idx_to_word\"", ":", "self", ".", "_idx_to_word", ",", "\n", "\"word_to_idx\"", ":", "self", ".", "_word_to_idx", ",", "\n", "\"word_frequencies\"", ":", "self", ".", "_word_frequencies", "\n", "}", "\n", "\n", "", "def", "save", "(", "self", ",", "path", ":", "str", ")", "->", "str", ":", "\n", "        ", "with", "open", "(", "path", ",", "'w'", ")", "as", "outfile", ":", "\n", "            ", "json", ".", "dump", "(", "self", ".", "to_dict", "(", ")", ",", "outfile", ",", "indent", "=", "4", ")", "\n", "", "return", "path", "\n", "\n", "\n", "", "", "class", "ModularDataset", "(", "GroundedScanDataset", ")", ":", "\n", "\n", "    ", "def", "__init__", "(", "self", ",", "path_to_data", ":", "str", ",", "save_directory", ":", "str", ",", "k", ":", "int", ",", "split", "=", "\"train\"", ",", "input_vocabulary_file", "=", "\"\"", ",", "\n", "adverb_input_vocabulary_file", "=", "\"\"", ",", "adverb_target_vocabulary_file", "=", "\"\"", ",", "planner_target_vocabulary_file", "=", "\"\"", ",", "\n", "target_vocabulary_file", "=", "\"\"", ",", "adverb_vocabulary_file", "=", "\"\"", ",", "transitive_target_vocabulary_file", "=", "\"\"", ",", "\n", "generate_vocabulary", "=", "False", ",", "upsample_isolated", "=", "1", ",", "isolate_adverb_types", "=", "None", ",", "only_keep_adverbs", "=", "None", ",", "\n", "seed", "=", "1", ",", "isolate_examples_with", "=", "\"cautiously\"", ",", "module", "=", "\"\"", ",", "output_folder_pattern", "=", "\"\"", ",", "collapse_alo", "=", "False", ")", ":", "\n", "        ", "if", "generate_vocabulary", ":", "\n", "            ", "self", ".", "adverb_vocabulary", "=", "AdverbVocabulary", "(", ")", "\n", "self", ".", "adverb_input_vocabulary", "=", "Vocabulary", "(", ")", "\n", "self", ".", "adverb_target_vocabulary", "=", "Vocabulary", "(", ")", "\n", "self", ".", "planner_target_vocabulary", "=", "Vocabulary", "(", ")", "\n", "self", ".", "transitive_target_vocabulary", "=", "Vocabulary", "(", ")", "\n", "", "self", ".", "collapse_alo", "=", "collapse_alo", "\n", "if", "module", "==", "\"full\"", ":", "\n", "            ", "assert", "output_folder_pattern", ",", "\"Please provide the pattern of the output folders for all the modules.\"", "\n", "", "self", ".", "all_modules", "=", "[", "\"position\"", ",", "\"planner\"", ",", "\"dummy_planner\"", ",", "\"dummy_sequence_planner\"", ",", "\"interaction\"", ",", "\n", "\"dummy_interaction\"", ",", "\"adverb_transform\"", ",", "\"alo_transform\"", "]", "\n", "if", "isolate_adverb_types", ":", "\n", "            ", "assert", "isinstance", "(", "isolate_adverb_types", ",", "list", ")", ",", "\"Please provide list of strings to isolate_adverb_types.\"", "\n", "logger", ".", "info", "(", "\"Isolating adverb types: %s\"", "%", "','", ".", "join", "(", "isolate_adverb_types", ")", ")", "\n", "", "if", "only_keep_adverbs", ":", "\n", "            ", "assert", "isinstance", "(", "only_keep_adverbs", ",", "list", ")", ",", "\"Please provide list of strings to only_keep_adverbs.\"", "\n", "logger", ".", "info", "(", "\"Only keeping adverbs: %s\"", "%", "','", ".", "join", "(", "only_keep_adverbs", ")", ")", "\n", "", "if", "module", "==", "\"full\"", ":", "\n", "            ", "old_save_directory", "=", "save_directory", "\n", "save_directory", "=", "output_folder_pattern", "%", "\"position\"", "\n", "module_path_pattern_split", "=", "save_directory", ".", "split", "(", "\"seed_\"", ")", "\n", "module_path_pattern_seed", "=", "int", "(", "module_path_pattern_split", "[", "-", "1", "]", ")", "%", "5", "\n", "if", "not", "module_path_pattern_seed", ":", "\n", "                ", "module_path_pattern_seed", "=", "5", "\n", "", "save_directory", "=", "module_path_pattern_split", "[", "0", "]", "+", "\"seed_\"", "+", "str", "(", "module_path_pattern_seed", ")", "\n", "", "super", "(", ")", ".", "__init__", "(", "path_to_data", ",", "save_directory", ",", "k", ",", "split", ",", "input_vocabulary_file", ",", "\n", "target_vocabulary_file", ",", "generate_vocabulary", ",", "upsample_isolated", "=", "upsample_isolated", ",", "\n", "isolate_adverb_types", "=", "isolate_adverb_types", ",", "only_keep_adverbs", "=", "only_keep_adverbs", ",", "\n", "isolate_examples_with", "=", "isolate_examples_with", ",", "seed", "=", "seed", ")", "\n", "if", "not", "generate_vocabulary", ":", "\n", "            ", "self", ".", "adverb_vocabulary", "=", "AdverbVocabulary", ".", "load", "(", "os", ".", "path", ".", "join", "(", "save_directory", ",", "\n", "adverb_vocabulary_file", ")", ")", "\n", "self", ".", "adverb_input_vocabulary", "=", "Vocabulary", ".", "load", "(", "os", ".", "path", ".", "join", "(", "save_directory", ",", "\n", "adverb_input_vocabulary_file", ")", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.change_seed": [[118, 123], ["NotImplementedError"], "methods", ["None"], ["self", ".", "adverb_target_vocabulary", "=", "Vocabulary", ".", "load", "(", "os", ".", "path", ".", "join", "(", "save_directory", ",", "\n", "adverb_target_vocabulary_file", ")", ")", "\n", "self", ".", "planner_target_vocabulary", "=", "Vocabulary", ".", "load", "(", "os", ".", "path", ".", "join", "(", "save_directory", ",", "\n", "planner_target_vocabulary_file", ")", ")", "\n", "self", ".", "transitive_target_vocabulary", "=", "Vocabulary", ".", "load", "(", "os", ".", "path", ".", "join", "(", "save_directory", ",", "\n", "transitive_target_vocabulary_file", ")", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.reset_dataset": [[124, 130], ["dataset.GroundedScan._grammar.reset_grammar", "dataset.GroundedScan.get_empty_split_dict", "dataset.GroundedScan.get_empty_split_dict", "dataset.GroundedScan._examples_to_visualize.clear", "dataset.GroundedScan.get_empty_data_statistics"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.reset_grammar", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_empty_split_dict", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_empty_split_dict", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.clear", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_empty_data_statistics"], ["if", "module", "==", "\"full\"", ":", "\n", "                ", "self", ".", "vocabulary_dict", "=", "{", "\n", "\"position\"", ":", "[", "(", "input_vocabulary_file", ",", "\"input_tensor\"", ")", "]", ",", "\n", "\"planner\"", ":", "[", "(", "input_vocabulary_file", ",", "\"input_tensor\"", ")", ",", "\n", "(", "planner_target_vocabulary_file", ",", "\"planner_target_tensor\"", ")", "]", ",", "\n", "\"interaction\"", ":", "[", "(", "input_vocabulary_file", ",", "\"input_tensor\"", ")", ",", "\n", "(", "transitive_target_vocabulary_file", ",", "\"transitive_target_tensor\"", ")", "]", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_empty_split_dict": [[131, 133], ["None"], "methods", ["None"], ["\"adverb_transform\"", ":", "[", "(", "input_vocabulary_file", ",", "\"input_tensor\"", ")", ",", "\n", "(", "adverb_input_vocabulary_file", ",", "\"adverb_input_tensor\"", ")", ",", "\n", "(", "adverb_target_vocabulary_file", ",", "\"adverb_target_tensor\"", ")", "]", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.make_test_set": [[134, 165], ["int", "random.sample", "sorted", "logger.info", "range", "copy.deepcopy", "dataset.GroundedScan._data_pairs[].append", "dataset.GroundedScan._template_identifiers[].append", "copy.deepcopy", "len", "len", "len", "str", "str", "len", "str"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["\"alo_transform\"", ":", "[", "(", "adverb_target_vocabulary_file", ",", "\"adverb_target_tensor\"", ")", ",", "\n", "(", "target_vocabulary_file", ",", "\"target_tensor\"", ")", "]", "\n", "}", "\n", "self", ".", "full_vocabularies", "=", "self", ".", "load_full_vocabularies", "(", "\n", "output_folder_pattern", ")", "\n", "", "logger", ".", "info", "(", "\"Also done loading adverb vocabulary.\"", ")", "\n", "", "if", "module", "==", "\"full\"", ":", "\n", "            ", "save_directory", "=", "old_save_directory", "\n", "", "self", ".", "transitive_verbs", "=", "self", ".", "dataset", ".", "_vocabulary", ".", "get_transitive_verbs", "(", ")", "\n", "if", "isolate_adverb_types", ":", "\n", "            ", "logger", ".", "info", "(", "\"Isolated %d examples for adverb types.\"", "%", "len", "(", "self", ".", "dataset", ".", "_data_pairs", "[", "\"isolated_adverb_types\"", "]", ")", ")", "\n", "", "logger", ".", "info", "(", "\"Occurrences of adverb types:\"", ")", "\n", "for", "adverb_type", ",", "count", "in", "self", ".", "dataset", ".", "_data_statistics", "[", "\"train\"", "]", "[", "\"type_adverbs\"", "]", ".", "items", "(", ")", ":", "\n", "            ", "logger", ".", "info", "(", "\"{}: {} occurrences.\"", ".", "format", "(", "adverb_type", ",", "count", ")", ")", "\n", "", "actual_k", "=", "self", ".", "dataset", ".", "_data_statistics", "[", "\"train\"", "]", "[", "\"manners_in_command\"", "]", "[", "isolate_examples_with", "]", "\n", "expected_k", "=", "k", "*", "upsample_isolated", "\n", "if", "split", "in", "[", "\"train\"", ",", "\"dev\"", "]", ":", "\n", "            ", "assert", "actual_k", "==", "expected_k", ",", "\"Chose k=%d and upsample=%d (expected k=%d) but actual number of examples with %s in training set is %d.\"", "%", "(", "\n", "k", ",", "upsample_isolated", ",", "expected_k", ",", "isolate_examples_with", ",", "actual_k", "\n", ")", "\n", "", "self", ".", "adverb_vocabulary_size", "=", "self", ".", "adverb_vocabulary", ".", "size", "\n", "self", ".", "_percentage_not_unk", "=", "{", "\n", "\"input\"", ":", "{", "\"total\"", ":", "0", ",", "\"not_unk\"", ":", "0", "}", ",", "\n", "\"target\"", ":", "{", "\"total\"", ":", "0", ",", "\"not_unk\"", ":", "0", "}", ",", "\n", "\"adverb\"", ":", "{", "\"total\"", ":", "0", ",", "\"not_unk\"", ":", "0", "}", ",", "\n", "}", "\n", "\n", "", "def", "sentence_to_array", "(", "self", ",", "sentence", ":", "List", "[", "str", "]", ",", "vocabulary", ":", "str", ",", "module", "=", "\"\"", ")", "->", "List", "[", "int", "]", ":", "\n", "        "]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.move_k_examples_to_train": [[166, 182], ["random.sample", "sorted", "len", "logger.info", "range", "copy.deepcopy", "dataset.GroundedScan._data_pairs[].append", "dataset.GroundedScan._template_identifiers[].append", "dataset.GroundedScan._data_pairs[].append", "dataset.GroundedScan._template_identifiers[].append", "len"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["\n", "vocab", "=", "self", ".", "get_vocabulary", "(", "vocabulary", ",", "module", ")", "\n", "sentence_array", "=", "[", "vocab", ".", "sos_idx", "]", "\n", "for", "word", "in", "sentence", ":", "\n", "            ", "sentence_array", ".", "append", "(", "vocab", ".", "word_to_idx", "(", "word", ")", ")", "\n", "", "sentence_array", ".", "append", "(", "vocab", ".", "eos_idx", ")", "\n", "return", "sentence_array", "\n", "\n", "", "def", "array_to_sentence", "(", "self", ",", "sentence_array", ":", "List", "[", "int", "]", ",", "vocabulary", ":", "str", ",", "module", "=", "\"\"", ")", "->", "List", "[", "str", "]", ":", "\n", "        "]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_examples_with_image": [[183, 228], ["list", "range", "random.shuffle", "dataset.GroundedScan.parse_command_repr", "example.get", "dataset.GroundedScan.parse_command_repr", "GroundedScan.world.Situation.from_representation", "dataset.GroundedScan._world.clear_situation", "dataset.GroundedScan.initialize_world", "dataset.GroundedScan.parse_command_repr", "len", "dataset.GroundedScan._world.get_current_situation_grid_repr", "dataset.GroundedScan._world.get_current_situation_image", "dataset.GroundedScan.parse_command_repr", "dataset.GroundedScan.parse_command_repr", "example.get", "example.get"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.from_representation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation_grid_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation_image", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["\n", "vocab", "=", "self", ".", "get_vocabulary", "(", "vocabulary", ",", "module", ")", "\n", "return", "[", "vocab", ".", "idx_to_word", "(", "word_idx", ")", "for", "word_idx", "in", "sentence_array", "]", "\n", "\n", "", "def", "load_full_vocabularies", "(", "self", ",", "output_folder_pattern", ":", "str", ")", ":", "\n", "        ", "full_vocabularies", "=", "{", "}", "\n", "for", "module", ",", "vocabs", "in", "self", ".", "vocabulary_dict", ".", "items", "(", ")", ":", "\n", "            ", "if", "module", "!=", "\"adverb_transform\"", ":", "\n", "                ", "module_path_pattern_split", "=", "output_folder_pattern", ".", "split", "(", "\"seed_\"", ")", "\n", "module_path_pattern_seed", "=", "int", "(", "module_path_pattern_split", "[", "-", "1", "]", ")", "%", "5", "\n", "if", "not", "module_path_pattern_seed", ":", "\n", "                    ", "module_path_pattern_seed", "=", "5", "\n", "", "adjusted_output_folder_pattern", "=", "module_path_pattern_split", "[", "0", "]", "+", "\"seed_\"", "+", "str", "(", "module_path_pattern_seed", ")", "\n", "module_folder_path", "=", "adjusted_output_folder_pattern", "%", "module", "\n", "", "else", ":", "\n", "                ", "module_folder_path", "=", "output_folder_pattern", "%", "module", "\n", "", "full_vocabularies", "[", "module", "]", "=", "{", "}", "\n", "for", "vocab", ",", "tensor_name", "in", "vocabs", ":", "\n", "                ", "vocab_file", "=", "os", ".", "path", ".", "join", "(", "module_folder_path", ",", "vocab", ")", "\n", "vocabulary", "=", "Vocabulary", ".", "load", "(", "vocab_file", ")", "\n", "full_vocabularies", "[", "module", "]", "[", "tensor_name", "]", "=", "vocabulary", "\n", "vocab_attribute", "=", "tensor_name", ".", "split", "(", "\"_tensor\"", ")", "[", "0", "]", "+", "\"_vocabulary\"", "\n", "modular_vocab_attribute", "=", "module", "+", "\"_\"", "+", "vocab_attribute", "\n", "setattr", "(", "self", ",", "vocab_attribute", ",", "vocabulary", ")", "\n", "setattr", "(", "self", ",", "modular_vocab_attribute", ",", "vocabulary", ")", "\n", "", "", "return", "full_vocabularies", "\n", "\n", "", "def", "read_vocabularies", "(", "self", ")", "->", "{", "}", ":", "\n", "        ", "\"\"\"\n        Loop over all examples in the dataset and add the words in them to the vocabularies.\n        \"\"\"", "\n", "logger", ".", "info", "(", "\"Populating vocabulary...\"", ")", "\n", "for", "i", ",", "example", "in", "enumerate", "(", "self", ".", "dataset", ".", "get_examples_with_image", "(", "self", ".", "split", ",", "\n", "simple_situation_representation", "=", "True", ",", "\n", "adverb_inputs", "=", "True", ")", ")", ":", "\n", "            ", "self", ".", "adverb_input_vocabulary", ".", "add_sentence", "(", "example", "[", "\"adverb_input\"", "]", ")", "\n", "if", "example", "[", "\"verb_in_command\"", "]", "==", "\"push\"", "or", "example", "[", "\"verb_in_command\"", "]", "==", "\"pull\"", ":", "\n", "                ", "planner_target", "=", "[", "command", "for", "command", "in", "example", "[", "\"adverb_input\"", "]", "if", "command", "!=", "example", "[", "\"verb_in_command\"", "]", "]", "\n", "interactions", "=", "[", "command", "for", "command", "in", "example", "[", "\"adverb_input\"", "]", "if", "command", "==", "example", "[", "\"verb_in_command\"", "]", "]", "\n", "", "else", ":", "\n", "                ", "interactions", "=", "[", "]", "\n", "planner_target", "=", "example", "[", "\"adverb_input\"", "]", "\n", "", "self", ".", "planner_target_vocabulary", ".", "add_sentence", "(", "planner_target", ")", "\n", "self", ".", "adverb_vocabulary", ".", "add_word", "(", "example", "[", "\"adverb\"", "]", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.situation_image_dimension": [[229, 232], ["dataset.GroundedScan._world.get_current_situation_image"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation_image"], ["self", ".", "transitive_target_vocabulary", ".", "add_sentence", "(", "interactions", ")", "\n", "if", "self", ".", "collapse_alo", ":", "\n", "                ", "self", ".", "adverb_target_vocabulary", ".", "add_sentence", "(", "example", "[", "\"target_command\"", "]", ")", "\n", "", "else", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.num_examples": [[233, 235], ["len"], "methods", ["None"], ["                ", "self", ".", "adverb_target_vocabulary", ".", "add_sentence", "(", "example", "[", "\"adverb_target\"", "]", ")", "\n", "", "self", ".", "input_vocabulary", ".", "add_sentence", "(", "example", "[", "\"input_command\"", "]", ")", "\n", "self", ".", "target_vocabulary", ".", "add_sentence", "(", "example", "[", "\"target_command\"", "]", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.count_equivalent_examples": [[236, 249], ["logger.info", "enumerate", "enumerate", "len", "len", "dataset.GroundedScan.compare_examples"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.compare_examples"], ["\n", "", "", "def", "get_vocabulary", "(", "self", ",", "vocabulary", ":", "str", ",", "module", "=", "\"\"", ")", "->", "Vocabulary", ":", "\n", "        ", "vocabulary_attribute", "=", "vocabulary", "+", "\"_vocabulary\"", "\n", "if", "vocabulary_attribute", "==", "\"final_input_vocabulary\"", ":", "\n", "            ", "vocabulary_attribute", "=", "\"adverb_target_vocabulary\"", "\n", "", "if", "module", ":", "\n", "            ", "vocabulary_attribute", "=", "module", "+", "\"_\"", "+", "vocabulary_attribute", "\n", "", "if", "hasattr", "(", "self", ",", "vocabulary_attribute", ")", ":", "\n", "            ", "return", "getattr", "(", "self", ",", "vocabulary_attribute", ")", "\n", "", "else", ":", "\n", "            ", "raise", "ValueError", "(", "\"Specified unknown vocabulary in sentence_to_array: {}\"", ".", "format", "(", "vocabulary", ")", ")", "\n", "\n", "", "", "def", "save_vocabularies", "(", "self", ",", "input_vocabulary_file", ":", "str", ",", "target_vocabulary_file", ":", "str", ",", "\n", "adverb_input_vocabulary_file", "=", "\"\"", ",", "adverb_target_vocabulary_file", "=", "\"\"", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.discard_equivalent_examples": [[250, 263], ["enumerate", "sorted", "dataset.GroundedScan.has_equivalent_example", "to_delete.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.has_equivalent_example", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["adverb_vocabulary_file", "=", "\"\"", ",", "planner_target_vocabulary_file", "=", "\"\"", ",", "\n", "transitive_target_vocabulary_file", "=", "\"\"", ")", ":", "\n", "        ", "self", ".", "adverb_input_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "adverb_input_vocabulary_file", ")", ")", "\n", "self", ".", "adverb_target_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "adverb_target_vocabulary_file", ")", ")", "\n", "self", ".", "input_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "input_vocabulary_file", ")", ")", "\n", "self", ".", "target_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "target_vocabulary_file", ")", ")", "\n", "self", ".", "adverb_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "adverb_vocabulary_file", ")", ")", "\n", "self", ".", "planner_target_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "planner_target_vocabulary_file", ")", ")", "\n", "self", ".", "transitive_target_vocabulary", ".", "save", "(", "os", ".", "path", ".", "join", "(", "self", ".", "directory", ",", "transitive_target_vocabulary_file", ")", ")", "\n", "\n", "", "def", "get_percentage_unk", "(", "self", ",", "vocabulary", ":", "str", ")", ":", "\n", "        ", "if", "vocabulary", "not", "in", "self", ".", "_percentage_not_unk", ":", "\n", "            ", "raise", "ValueError", "(", "\"Unknown vocabulary %s passed to get_percentage_unk(). \"", "\n", "\"Options are 'input', 'target', 'adverb'.\"", "%", "vocabulary", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.discard_equivalent_examples_v2": [[264, 282], ["sorted", "len", "list", "len", "to_delete.extend", "[].values"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend"], ["", "return", "-", "1.", "\n", "#return 1. - (self._percentage_not_unk[vocabulary][\"not_unk\"] / self._percentage_not_unk[vocabulary][\"total\"])", "\n", "\n", "", "def", "remove_transitive_verbs", "(", "self", ",", "input_sequence", ":", "List", "[", "str", "]", ")", "->", "List", "[", "str", "]", ":", "\n", "        ", "removed_transitive", "=", "[", "word", "for", "word", "in", "input_sequence", "if", "word", "not", "in", "self", ".", "transitive_verbs", "]", "\n", "return", "removed_transitive", "\n", "\n", "", "def", "convert_example_for_modularity", "(", "self", ",", "example", ")", ":", "\n", "        ", "original_adverb_input", "=", "example", "[", "\"adverb_input\"", "]", "\n", "original_adverb_target", "=", "example", "[", "\"adverb_target\"", "]", "\n", "verb_in_command", "=", "example", "[", "\"verb_in_command\"", "]", "\n", "planner_target", "=", "original_adverb_input", ".", "copy", "(", ")", "\n", "adverb_target", "=", "original_adverb_target", ".", "copy", "(", ")", "\n", "if", "example", "[", "\"type_adverb\"", "]", "==", "\"nonmovement_direction\"", ":", "\n", "            ", "start_position", "=", "example", "[", "\"situation_representation\"", "]", "[", "\"agent_position\"", "]", "\n", "start_position", "=", "Position", "(", "column", "=", "int", "(", "start_position", "[", "\"column\"", "]", ")", ",", "row", "=", "int", "(", "start_position", "[", "\"row\"", "]", ")", ")", "\n", "end_position", "=", "example", "[", "\"situation_representation\"", "]", "[", "\"target_object\"", "]", "[", "\"position\"", "]", "\n", "end_position", "=", "Position", "(", "column", "=", "int", "(", "end_position", "[", "\"column\"", "]", ")", ",", "row", "=", "int", "(", "end_position", "[", "\"row\"", "]", ")", ")", "\n", "alocentric_plan", "=", "simulate_planner", "(", "start_position", ",", "end_position", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.discard_excess_examples_train": [[283, 296], ["enumerate", "sorted", "to_delete.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["egocentric_plan", "=", "convert_sequence_to_actions", "(", "alocentric_plan", ",", "agent_start_dir", "=", "EAST", ")", "\n", "egocentric_plan", "=", "egocentric_plan", ".", "get_gscan_actions", "(", ")", "\n", "", "if", "verb_in_command", "==", "\"push\"", "or", "verb_in_command", "==", "\"pull\"", ":", "\n", "            ", "planner_target", "=", "[", "command", "for", "command", "in", "planner_target", "if", "command", "!=", "verb_in_command", "]", "\n", "interactions", "=", "[", "command", "for", "command", "in", "example", "[", "\"target_command\"", "]", "if", "command", "==", "verb_in_command", "]", "\n", "", "else", ":", "\n", "            ", "interactions", "=", "[", "]", "\n", "", "interaction_target", "=", "[", "]", "\n", "adverb_input", "=", "original_adverb_input", ".", "copy", "(", ")", "\n", "if", "verb_in_command", "not", "in", "interaction_target", ":", "\n", "            ", "interaction_target", "+=", "interactions", "\n", "", "if", "verb_in_command", "not", "in", "adverb_input", ":", "\n", "            ", "adverb_input", "+=", "interactions", "\n", "", "if", "example", "[", "\"type_adverb\"", "]", "==", "\"movement_rewrite\"", "or", "example", "[", "\"type_adverb\"", "]", "==", "\"movement\"", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.has_equivalent_example": [[297, 305], ["enumerate", "dataset.GroundedScan.compare_examples"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.compare_examples"], ["# planner_target = [command for command in original_adverb_target if command != verb_in_command]  # TODO: change back for getting back alo", "\n", "            ", "planner_target", "=", "[", "command", "for", "command", "in", "example", "[", "\"target_command\"", "]", "if", "command", "not", "in", "[", "\"push\"", ",", "\"pull\"", "]", "]", "\n", "interaction_target", "=", "interactions", "\n", "# adverb_input = original_adverb_target.copy() + interactions", "\n", "adverb_input", "=", "planner_target", "+", "interactions", "\n", "adverb_target", "=", "original_adverb_target", ".", "copy", "(", ")", "+", "interactions", "\n", "", "elif", "example", "[", "\"type_adverb\"", "]", "==", "\"nonmovement_direction\"", ":", "\n", "            ", "planner_target", "=", "egocentric_plan", "\n", "adverb_input", "=", "planner_target", "+", "interactions", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.meaning_command": [[306, 308], ["dataset.GroundedScan._vocabulary.translate_word"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word"], ["", "if", "not", "example", "[", "\"adverb\"", "]", ":", "\n", "            ", "planner_target", "=", "[", "command", "for", "command", "in", "original_adverb_target", "if", "command", "not", "in", "[", "\"push\"", ",", "\"pull\"", "]", "]", "\n", "adverb_input", "=", "original_adverb_target", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.fill_example": [[309, 341], ["str", "dataset.GroundedScan.command_repr", "dataset.GroundedScan.command_repr", "dataset.GroundedScan.derivation_repr", "situation.to_representation", "dataset.GroundedScan.command_repr", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "situation.to_representation", "dataset.GroundedScan._data_pairs[].append", "dataset.GroundedScan._examples_to_visualize.append", "dataset.GroundedScan.meaning_command", "dataset.GroundedScan.command_repr", "dataset.GroundedScan.command_repr", "str", "str", "len", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "str", "situation.to_representation"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.derivation_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.to_representation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.to_representation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.meaning_command", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.to_representation"], ["", "example", "[", "\"adverb_input\"", "]", "=", "adverb_input", "\n", "if", "self", ".", "collapse_alo", ":", "\n", "            ", "example", "[", "\"adverb_target\"", "]", "=", "example", "[", "\"target_command\"", "]", "\n", "", "else", ":", "\n", "            ", "example", "[", "\"adverb_target\"", "]", "=", "adverb_target", "\n", "", "example", "[", "\"planner_target\"", "]", "=", "planner_target", "\n", "example", "[", "\"interaction_target\"", "]", "=", "interaction_target", "\n", "return", "example", "\n", "\n", "", "def", "convert_example_for_modularity_alo", "(", "self", ",", "example", ")", ":", "\n", "        ", "original_adverb_input", "=", "example", "[", "\"adverb_input\"", "]", "\n", "original_adverb_target", "=", "example", "[", "\"adverb_target\"", "]", "\n", "verb_in_command", "=", "example", "[", "\"verb_in_command\"", "]", "\n", "planner_target", "=", "original_adverb_input", ".", "copy", "(", ")", "\n", "adverb_target", "=", "original_adverb_target", ".", "copy", "(", ")", "\n", "if", "verb_in_command", "==", "\"push\"", "or", "verb_in_command", "==", "\"pull\"", ":", "\n", "            ", "planner_target", "=", "[", "command", "for", "command", "in", "planner_target", "if", "command", "!=", "verb_in_command", "]", "\n", "interactions", "=", "[", "command", "for", "command", "in", "example", "[", "\"target_command\"", "]", "if", "command", "==", "verb_in_command", "]", "\n", "", "else", ":", "\n", "            ", "interactions", "=", "[", "]", "\n", "", "interaction_target", "=", "[", "]", "\n", "adverb_input", "=", "original_adverb_input", ".", "copy", "(", ")", "\n", "if", "verb_in_command", "not", "in", "interaction_target", ":", "\n", "            ", "interaction_target", "+=", "interactions", "\n", "", "if", "verb_in_command", "not", "in", "adverb_input", ":", "\n", "            ", "adverb_input", "+=", "interactions", "\n", "", "if", "example", "[", "\"type_adverb\"", "]", "==", "\"movement_rewrite\"", "or", "example", "[", "\"type_adverb\"", "]", "==", "\"movement\"", ":", "\n", "            ", "planner_target", "=", "[", "command", "for", "command", "in", "original_adverb_target", "if", "command", "!=", "verb_in_command", "]", "\n", "interaction_target", "=", "interactions", "\n", "adverb_input", "=", "original_adverb_target", ".", "copy", "(", ")", "+", "interactions", "\n", "adverb_target", "=", "original_adverb_target", ".", "copy", "(", ")", "+", "interactions", "\n", "", "if", "not", "example", "[", "\"adverb\"", "]", ":", "\n", "            ", "planner_target", "=", "[", "command", "for", "command", "in", "example", "[", "\"target_command\"", "]", "if", "command", "not", "in", "[", "\"push\"", ",", "\"pull\"", "]", "]", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.fill_adverb_example": [[342, 379], ["str", "dataset.GroundedScan.command_repr", "dataset.GroundedScan.command_repr", "dataset.GroundedScan.derivation_repr", "situation.to_representation", "dataset.GroundedScan.command_repr", "dataset.GroundedScan.command_repr", "dataset.GroundedScan.command_repr", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "situation.to_representation", "dataset.GroundedScan._data_pairs[].append", "dataset.GroundedScan._examples_to_visualize.append", "dataset.GroundedScan.meaning_command", "dataset.GroundedScan.command_repr", "dataset.GroundedScan.command_repr", "str", "str", "len", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "str", "situation.to_representation"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.derivation_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.to_representation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.to_representation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.meaning_command", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.to_representation"], ["adverb_input", "=", "original_adverb_target", "\n", "", "example", "[", "\"adverb_input\"", "]", "=", "adverb_input", "\n", "if", "self", ".", "collapse_alo", ":", "\n", "            ", "example", "[", "\"adverb_target\"", "]", "=", "example", "[", "\"target_command\"", "]", "\n", "", "else", ":", "\n", "            ", "example", "[", "\"adverb_target\"", "]", "=", "adverb_target", "\n", "", "example", "[", "\"planner_target\"", "]", "=", "planner_target", "\n", "example", "[", "\"interaction_target\"", "]", "=", "interaction_target", "\n", "return", "example", "\n", "\n", "", "def", "make_dummy_sequence_planner_target", "(", "self", ",", "example", ",", "sequence", "=", "True", ")", ":", "\n", "        ", "direction_to_target", "=", "example", "[", "\"situation_representation\"", "]", "[", "'direction_to_target'", "]", "\n", "if", "direction_to_target", "in", "[", "'n'", ",", "'e'", ",", "'s'", ",", "'w'", "]", ":", "\n", "            ", "if", "example", "[", "\"adverb\"", "]", "in", "[", "\"hesitantly\"", ",", "\"cautiously\"", "]", ":", "\n", "                ", "direction_translation", "=", "{", "\n", "\"n\"", ":", "\"turn left\"", ",", "\n", "\"e\"", ":", "\"walk\"", ",", "\n", "\"s\"", ":", "\"turn right\"", ",", "\n", "\"w\"", ":", "\"turn left\"", "\n", "}", "\n", "", "else", ":", "\n", "                ", "direction_translation", "=", "{", "\n", "\"n\"", ":", "\"north\"", ",", "\n", "\"e\"", ":", "\"east\"", ",", "\n", "\"s\"", ":", "\"south\"", ",", "\n", "\"w\"", ":", "\"west\"", "\n", "}", "\n", "", "dummy_planner_target", "=", "direction_translation", "[", "direction_to_target", "]", "\n", "", "elif", "example", "[", "\"adverb\"", "]", "==", "\"while zigzagging\"", ":", "\n", "            ", "direction_translation", "=", "{", "\n", "\"ne\"", ":", "\"east\"", ",", "\n", "\"sw\"", ":", "\"west\"", ",", "\n", "\"se\"", ":", "\"east\"", ",", "\n", "\"nw\"", ":", "\"west\"", "\n", "}", "\n", "dummy_planner_target", "=", "direction_translation", "[", "direction_to_target", "]", "\n", "", "else", ":", "\n", "            ", "if", "example", "[", "\"adverb\"", "]", "in", "[", "\"hesitantly\"", ",", "\"cautiously\"", "]", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.compare_examples": [[380, 393], ["None"], "methods", ["None"], ["                ", "direction_translation", "=", "{", "\n", "\"ne\"", ":", "\"walk\"", ",", "\n", "\"sw\"", ":", "\"turn right\"", ",", "\n", "\"se\"", ":", "\"turn right\"", ",", "\n", "\"nw\"", ":", "\"turn left\"", "\n", "}", "\n", "", "else", ":", "\n", "                ", "direction_translation", "=", "{", "\n", "\"ne\"", ":", "\"north\"", ",", "\n", "\"sw\"", ":", "\"south\"", ",", "\n", "\"se\"", ":", "\"south\"", ",", "\n", "\"nw\"", ":", "\"north\"", "\n", "}", "\n", "", "dummy_planner_target", "=", "direction_translation", "[", "direction_to_target", "]", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_example": [[394, 407], ["dataset.GroundedScan.parse_command_repr", "dataset.GroundedScan.parse_command_repr", "GroundedScan.world.Situation.from_representation", "dataset.GroundedScan.parse_command_repr", "dataset.GroundedScan.parse_derivation_repr", "dataset.GroundedScan.demonstrate_command", "dataset.GroundedScan.derivation_repr", "dataset.GroundedScan.command_repr", "dataset.GroundedScan.command_repr"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.from_representation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_derivation_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.derivation_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr"], ["", "if", "sequence", ":", "\n", "            ", "dummy_planner_target", "=", "[", "dummy_planner_target", "]", "\n", "", "else", ":", "\n", "            ", "int_translate", "=", "{", "\n", "\"north\"", ":", "0", ",", "\n", "\"east\"", ":", "1", ",", "\n", "\"south\"", ":", "2", ",", "\n", "\"west\"", ":", "3", ",", "\n", "\"turn left\"", ":", "4", ",", "\n", "\"turn right\"", ":", "5", ",", "\n", "\"walk\"", ":", "6", "\n", "}", "\n", "dummy_planner_target", "=", "int_translate", "[", "dummy_planner_target", "]", "\n", "", "return", "dummy_planner_target", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_adverb_example": [[408, 420], ["dataset.GroundedScan.parse_command_repr", "dataset.GroundedScan.parse_command_repr", "GroundedScan.world.Situation.from_representation", "dataset.GroundedScan.parse_command_repr", "dataset.GroundedScan.parse_derivation_repr", "dataset.GroundedScan.demonstrate_command", "dataset.GroundedScan.derivation_repr"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.from_representation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_derivation_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.derivation_repr"], ["\n", "", "def", "get_data_iterator", "(", "self", ",", "input_keys", "=", "None", ",", "input_keys_to_pad", "=", "None", ",", "target_keys", "=", "None", ",", "target_keys_to_pad", "=", "None", ",", "\n", "batch_size", "=", "None", ",", "max_examples", "=", "None", ",", "simple_situation_representation", "=", "True", ",", "shuffle", "=", "False", ",", "\n", "model_to_yield", "=", "\"full\"", ",", "modular", "=", "True", ")", "->", "{", "}", ":", "\n", "        "]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_empty_situation": [[421, 431], ["None"], "methods", ["None"], ["\n", "assert", "isinstance", "(", "batch_size", ",", "int", ")", ",", "\"Provide a batch size.\"", "\n", "assert", "model_to_yield", "in", "[", "\"full\"", "]", "+", "self", ".", "all_modules", "\n", "\n", "logger", ".", "info", "(", "\"Converting dataset to tensors...\"", ")", "\n", "current_examples_batch", "=", "np", ".", "array", "(", "[", "]", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_empty_data_statistics": [[433, 465], ["collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.Counter", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "empty_dict[].keys", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "collections.Counter", "collections.defaultdict", "collections.Counter", "collections.defaultdict", "collections.Counter", "collections.defaultdict", "collections.Counter", "collections.defaultdict", "collections.Counter", "str"], "methods", ["None"], ["\"adverb_input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"adverb_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"transitive_input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"transitive_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"planner_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"dummy_planner_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"final_input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", "\n", "}", "\n", "for", "i", ",", "example", "in", "enumerate", "(", "self", ".", "dataset", ".", "get_examples_with_image", "(", "\n", "self", ".", "split", ",", "shuffle", "=", "shuffle", ",", "simple_situation_representation", "=", "simple_situation_representation", ",", "\n", "adverb_inputs", "=", "modular", ")", ")", ":", "\n", "            ", "if", "max_examples", ":", "\n", "                ", "if", "len", "(", "self", ".", "_examples", ")", ">", "max_examples", ":", "\n", "                    ", "return", "\n", "", "", "empty_example", "=", "{", "}", "\n", "\n", "if", "modular", ":", "\n", "                ", "example", "=", "self", ".", "convert_example_for_modularity_alo", "(", "example", ")", "\n", "#  Adverb model input and target TODO: if no adverb?", "\n", "adverb_input", "=", "example", "[", "\"adverb_input\"", "]", "\n", "if", "(", "example", "[", "\"type_adverb\"", "]", "==", "\"movement_rewrite\"", "or", "example", "[", "\"type_adverb\"", "]", "==", "\"movement\"", ")", "and", "not", "self", ".", "collapse_alo", ":", "\n", "# if example[\"type_adverb\"] == \"movement_rewrite\" or example[\"type_adverb\"] == \"movement\":  # TODO: change back for getting back alo", "\n", "                    ", "adverb_target", "=", "[", "]", "\n", "", "else", ":", "\n", "                    ", "adverb_target", "=", "example", "[", "\"adverb_target\"", "]", "\n", "", "if", "not", "example", "[", "\"adverb\"", "]", ":", "\n", "                    ", "adverb_target", "=", "[", "]", "\n", "\n", "", "final_input", "=", "example", "[", "\"adverb_target\"", "]", "\n", "\n", "# Position model input and target", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.update_data_statistics": [[466, 555], ["data_example.get", "data_example.get", "len", "[].values", "dataset.GroundedScan._vocabulary.get_adverbs", "referred_target.split.split.split", "dataset.GroundedScan._vocabulary.get_size_adjectives", "dataset.GroundedScan._vocabulary.get_color_adjectives", "dataset.GroundedScan._vocabulary.get_nouns", "len", "[].keys", "dataset.GroundedScan._coverage_commands[].get", "dataset.GroundedScan._coverage_worlds[].get", "dataset.GroundedScan._coverage_full[].get", "[].get", "int", "str", "len", "len", "len", "str", "str", "data_example[].split", "data_example[].split"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_size_adjectives", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_color_adjectives", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_nouns", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "input_commands", "=", "example", "[", "\"input_command\"", "]", "\n", "situation_image", "=", "example", "[", "\"situation_image\"", "]", "\n", "grid_size", "=", "example", "[", "\"situation_representation\"", "]", "[", "\"grid_size\"", "]", "\n", "agent_position", "=", "example", "[", "\"situation_representation\"", "]", "[", "\"agent_position\"", "]", "\n", "agent_direction", "=", "example", "[", "\"situation_representation\"", "]", "[", "\"agent_direction\"", "]", "\n", "agent_position_representation", "=", "(", "int", "(", "agent_position", "[", "\"row\"", "]", ")", "*", "grid_size", ")", "+", "int", "(", "agent_position", "[", "\"column\"", "]", ")", "\n", "target_position", "=", "example", "[", "\"situation_representation\"", "]", "[", "\"target_object\"", "]", "[", "\"position\"", "]", "\n", "target_position_representation", "=", "(", "int", "(", "target_position", "[", "\"row\"", "]", ")", "*", "grid_size", ")", "+", "int", "(", "target_position", "[", "\"column\"", "]", ")", "\n", "\n", "if", "modular", ":", "\n", "# Planner model input=positions/direction and target", "\n", "# planner_target = self.remove_transitive_verbs(adverb_input)", "\n", "                ", "planner_target", "=", "example", "[", "\"planner_target\"", "]", "\n", "# Transitive model input=planner_target and target", "\n", "transitive_target", "=", "example", "[", "\"interaction_target\"", "]", "if", "example", "[", "\"verb_in_command\"", "]", "in", "self", ".", "transitive_verbs", "else", "[", "]", "\n", "dummy_planner_target", "=", "self", ".", "make_dummy_sequence_planner_target", "(", "example", ",", "sequence", "=", "False", ")", "\n", "dummy_sequence_planner_target", "=", "self", ".", "make_dummy_sequence_planner_target", "(", "example", ",", "sequence", "=", "True", ")", "\n", "# dummy_sequence_planner_target = example[\"planner_target\"][0:1]", "\n", "if", "example", "[", "\"verb_in_command\"", "]", "==", "\"pull\"", ":", "\n", "                    ", "dummy_interaction_target", "=", "transitive_target", "\n", "", "elif", "example", "[", "\"verb_in_command\"", "]", "==", "\"push\"", ":", "\n", "                    ", "dummy_interaction_target", "=", "transitive_target", "\n", "", "else", ":", "\n", "                    ", "dummy_interaction_target", "=", "transitive_target", "\n", "\n", "# Final input=adverb_target and target", "\n", "", "", "target_commands", "=", "example", "[", "\"target_command\"", "]", "\n", "# if example[\"adverb\"] == \"cautiously\" or example[\"adverb\"] == \"hesitantly\" or example[\"type_adverb\"] == \"nonmovement_first_person\":", "\n", "if", "example", "[", "\"type_adverb\"", "]", "==", "\"nonmovement_first_person\"", "and", "not", "self", ".", "collapse_alo", ":", "\n", "                ", "target_commands", "=", "[", "]", "\n", "", "if", "not", "example", "[", "\"adverb\"", "]", ":", "\n", "                ", "target_commands", "=", "[", "]", "\n", "", "adverb_embedding", "=", "self", ".", "adverb_vocabulary", ".", "word_to_idx", "(", "example", "[", "\"adverb\"", "]", ")", "\n", "\n", "example_information", "=", "{", "\n", "\"command\"", ":", "example", "[", "\"input_command\"", "]", ",", "\n", "\"adverb\"", ":", "example", "[", "\"adverb\"", "]", ",", "\n", "\"type_adverb\"", ":", "example", "[", "\"type_adverb\"", "]", "if", "modular", "else", "None", ",", "\n", "\"adverb_input\"", ":", "adverb_input", "if", "modular", "else", "None", ",", "\n", "\"adverb_target\"", ":", "adverb_target", "if", "modular", "else", "None", ",", "\n", "\"final_input\"", ":", "final_input", "if", "modular", "else", "None", ",", "\n", "\"target_command\"", ":", "example", "[", "\"target_command\"", "]", ",", "\n", "\"verb_in_command\"", ":", "example", "[", "\"verb_in_command\"", "]", "if", "modular", "else", "None", ",", "\n", "\"derivation_representation\"", ":", "example", "[", "\"derivation_representation\"", "]", ",", "\n", "\"situation_representation\"", ":", "example", "[", "\"situation_representation\"", "]", "\n", "}", "\n", "\n", "# Position model sequence", "\n", "input_array", "=", "self", ".", "sentence_to_array", "(", "input_commands", ",", "vocabulary", "=", "\"input\"", ")", "\n", "\n", "# Final model sequence", "\n", "target_array", "=", "self", ".", "sentence_to_array", "(", "target_commands", ",", "vocabulary", "=", "\"target\"", ")", "\n", "\n", "if", "modular", ":", "\n", "# Planner model sequence", "\n", "                ", "planner_target_array", "=", "self", ".", "sentence_to_array", "(", "planner_target", ",", "vocabulary", "=", "\"planner_target\"", ")", "\n", "dummy_planner_target_array", "=", "self", ".", "sentence_to_array", "(", "dummy_sequence_planner_target", ",", "\n", "vocabulary", "=", "\"planner_target\"", ")", "\n", "\n", "transitive_input_array", "=", "self", ".", "sentence_to_array", "(", "planner_target", ",", "vocabulary", "=", "\"planner_target\"", ")", "\n", "\n", "# Transitive model sequence", "\n", "transitive_target_array", "=", "self", ".", "sentence_to_array", "(", "transitive_target", ",", "vocabulary", "=", "\"transitive_target\"", ")", "\n", "dummy_interaction_target_array", "=", "self", ".", "sentence_to_array", "(", "dummy_interaction_target", ",", "\n", "vocabulary", "=", "\"transitive_target\"", ")", "\n", "\n", "# Adverb model sequences", "\n", "adverb_state", "=", "self", ".", "adverb_vocabulary", ".", "word_to_idx", "(", "example", "[", "\"adverb\"", "]", ")", "\n", "adverb_input_array", "=", "self", ".", "sentence_to_array", "(", "adverb_input", ",", "vocabulary", "=", "\"adverb_input\"", ")", "\n", "adverb_target_array", "=", "self", ".", "sentence_to_array", "(", "adverb_target", ",", "vocabulary", "=", "\"adverb_target\"", ")", "\n", "\n", "final_input_array", "=", "self", ".", "sentence_to_array", "(", "final_input", ",", "vocabulary", "=", "\"adverb_target\"", ")", "\n", "\n", "num_not_unk_input", "=", "sum", "(", "[", "int", "(", "self", ".", "get_vocabulary", "(", "\"input\"", ")", ".", "contains_word", "(", "word", ")", ")", "\n", "for", "word", "in", "adverb_input", "]", ")", "\n", "self", ".", "_percentage_not_unk", "[", "\"input\"", "]", "[", "\"total\"", "]", "+=", "len", "(", "adverb_input", ")", "\n", "self", ".", "_percentage_not_unk", "[", "\"input\"", "]", "[", "\"not_unk\"", "]", "+=", "num_not_unk_input", "\n", "num_not_unk_adverb", "=", "int", "(", "self", ".", "get_vocabulary", "(", "\"adverb\"", ")", ".", "contains_word", "(", "\n", "example", "[", "\"adverb\"", "]", ")", ")", "\n", "self", ".", "_percentage_not_unk", "[", "\"adverb\"", "]", "[", "\"total\"", "]", "+=", "1", "\n", "self", ".", "_percentage_not_unk", "[", "\"adverb\"", "]", "[", "\"not_unk\"", "]", "+=", "num_not_unk_adverb", "\n", "num_not_unk_target", "=", "sum", "(", "[", "int", "(", "self", ".", "get_vocabulary", "(", "\"adverb_target\"", ")", ".", "contains_word", "(", "word", ")", ")", "\n", "for", "word", "in", "adverb_target", "]", ")", "\n", "self", ".", "_percentage_not_unk", "[", "\"target\"", "]", "[", "\"total\"", "]", "+=", "len", "(", "adverb_target", ")", "\n", "self", ".", "_percentage_not_unk", "[", "\"target\"", "]", "[", "\"not_unk\"", "]", "+=", "num_not_unk_target", "\n", "# Planner model tensor", "\n", "empty_example", "[", "\"planner_target_tensor\"", "]", "=", "torch", ".", "tensor", "(", "planner_target_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_position_counts": [[556, 576], ["file.write", "range", "file.write", "file.write", "range", "file.write", "file.write", "file.write", "len", "len", "str", "str", "str", "str"], "methods", ["None"], ["empty_example", "[", "\"dummy_planner_target_tensor\"", "]", "=", "torch", ".", "tensor", "(", "dummy_planner_target_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "\n", "# Transitive model tensor", "\n", "empty_example", "[", "\"transitive_input_tensor\"", "]", "=", "torch", ".", "tensor", "(", "transitive_input_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"transitive_target_tensor\"", "]", "=", "torch", ".", "tensor", "(", "transitive_target_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "\n", "# Adverb model tensors", "\n", "empty_example", "[", "\"adverb_input_tensor\"", "]", "=", "torch", ".", "tensor", "(", "adverb_input_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"adverb_state\"", "]", "=", "torch", ".", "tensor", "(", "adverb_state", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"adverb_target_tensor\"", "]", "=", "torch", ".", "tensor", "(", "adverb_target_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"final_input_tensor\"", "]", "=", "torch", ".", "tensor", "(", "final_input_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.write_counter_sheet": [[577, 590], ["sheet.write", "sheet.write", "enumerate", "train_counter.items", "sheet.write", "sheet.write", "sheet.write", "isinstance", "sum", "sum", "sum.values", "sum.values"], "methods", ["None"], ["current_lengths_batch", "[", "\"adverb_input_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "current_lengths_batch", "[", "\"adverb_input_tensor_lengths\"", "]", ",", "\n", "[", "len", "(", "adverb_input_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"adverb_target_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"adverb_target_tensor_lengths\"", "]", ",", "[", "len", "(", "adverb_target_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"planner_target_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"planner_target_tensor_lengths\"", "]", ",", "[", "len", "(", "planner_target_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"dummy_planner_target_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"dummy_planner_target_tensor_lengths\"", "]", ",", "[", "len", "(", "dummy_planner_target_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"transitive_input_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"transitive_input_tensor_lengths\"", "]", ",", "[", "len", "(", "transitive_input_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"transitive_target_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"transitive_target_tensor_lengths\"", "]", ",", "[", "len", "(", "transitive_target_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"final_input_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"final_input_tensor_lengths\"", "]", ",", "[", "len", "(", "final_input_array", ")", "]", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.write_nested_counter_sheet": [[591, 606], ["sheet.write", "sheet.write", "enumerate", "train_counter.items", "train_counter.items", "sheet.write", "sheet.write", "sheet.write"], "methods", ["None"], ["empty_example", "[", "\"dummy_planner_target\"", "]", "=", "torch", ".", "tensor", "(", "dummy_planner_target", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"dummy_interaction_target\"", "]", "=", "torch", ".", "tensor", "(", "dummy_interaction_target_array", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "\n", "# Position model tensors", "\n", "", "empty_example", "[", "\"input_tensor\"", "]", "=", "torch", ".", "tensor", "(", "input_array", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"world_state_tensor\"", "]", "=", "torch", ".", "tensor", "(", "situation_image", ",", "dtype", "=", "torch", ".", "float", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"agent_position\"", "]", "=", "torch", ".", "tensor", "(", "agent_position_representation", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"target_position\"", "]", "=", "torch", ".", "tensor", "(", "target_position_representation", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "empty_example", "[", "\"agent_direction\"", "]", "=", "torch", ".", "tensor", "(", "agent_direction", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_dataset_statistics": [[607, 730], ["len", "xlwt.Workbook", "xlwt.Workbook.add_sheet", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "enumerate", "xlwt.Workbook.add_sheet", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "enumerate", "xlwt.Workbook.add_sheet", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "enumerate", "os.path.join", "xlwt.Workbook.save", "[].items", "dataset.GroundedScan.get_empty_situation().keys", "GroundedScan.helpers.bar_plot", "GroundedScan.helpers.bar_plot", "GroundedScan.helpers.bar_plot", "GroundedScan.helpers.bar_plot", "dataset.GroundedScan.update_data_statistics", "logger.info", "open", "infile.write", "infile.write", "[].items", "sum", "infile.write", "infile.write", "dataset.GroundedScan.save_position_counts", "infile.write", "dataset.GroundedScan.save_position_counts", "infile.write", "infile.write", "verb_target_combinations.items", "infile.write", "infile.write", "infile.write", "GroundedScan.helpers.save_counter", "infile.write", "infile.write", "verb_adverb_combinations.items", "infile.write", "infile.write", "referred_targets.items", "infile.write", "GroundedScan.helpers.save_counter", "infile.write", "situation_stats.items", "dataset.GroundedScan._coverage_commands[].items", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "dataset.GroundedScan._coverage_worlds[].items", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "dataset.GroundedScan._coverage_full[].items", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet", "xlwt.Workbook.add_sheet.write", "dataset.GroundedScan.write_nested_counter_sheet", "len", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "os.path.join", "[].values", "GroundedScan.helpers.save_counter", "GroundedScan.helpers.save_counter", "GroundedScan.helpers.save_counter", "GroundedScan.helpers.save_counter", "GroundedScan.helpers.save_counter", "len", "sum", "xlwt.Workbook.add_sheet", "xlwt.Workbook.add_sheet.write", "dataset.GroundedScan.write_counter_sheet", "GroundedScan.helpers.bar_plot", "dataset.GroundedScan.get_empty_situation", "GroundedScan.helpers.bar_plot", "str", "world_states.values", "key.replace", "os.path.join", "os.path.join"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.bar_plot", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.bar_plot", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.bar_plot", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.bar_plot", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.update_data_statistics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_position_counts", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_position_counts", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.save_counter", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.save_counter", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.write_nested_counter_sheet", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.save_counter", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.save_counter", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.save_counter", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.save_counter", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.save_counter", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.write_counter_sheet", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.bar_plot", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_empty_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.bar_plot", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.replace"], ["empty_example", "[", "\"adverb_embedding\"", "]", "=", "torch", ".", "tensor", "(", "adverb_embedding", ",", "dtype", "=", "torch", ".", "long", ",", "\n", "device", "=", "device", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "\n", "# Final model tensor", "\n", "empty_example", "[", "\"target_tensor\"", "]", "=", "torch", ".", "tensor", "(", "target_array", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "\n", "dim", "=", "0", ")", "\n", "\n", "empty_example", "[", "\"example_information\"", "]", "=", "example_information", "\n", "\n", "current_lengths_batch", "[", "\"input_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"input_tensor_lengths\"", "]", ",", "[", "len", "(", "input_array", ")", "]", ")", "\n", "current_lengths_batch", "[", "\"target_tensor_lengths\"", "]", "=", "np", ".", "append", "(", "\n", "current_lengths_batch", "[", "\"target_tensor_lengths\"", "]", ",", "[", "len", "(", "target_array", ")", "]", ")", "\n", "\n", "current_examples_batch", "=", "np", ".", "append", "(", "current_examples_batch", ",", "[", "empty_example", "]", ")", "\n", "if", "len", "(", "current_examples_batch", ")", "==", "batch_size", ":", "\n", "                ", "if", "modular", ":", "\n", "                    ", "if", "model_to_yield", "!=", "\"full\"", ":", "\n", "                        ", "input_keys_to_pad_d", "=", "{", "input_key_to_pad", ":", "current_lengths_batch", "[", "input_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "input_key_to_pad", "in", "input_keys_to_pad", "}", "\n", "target_keys_to_pad_d", "=", "{", "target_key_to_pad", ":", "current_lengths_batch", "[", "target_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "target_key_to_pad", "in", "target_keys_to_pad", "}", "\n", "yield", "self", ".", "make_modular_batch", "(", "current_examples_batch", ",", "input_keys", ",", "input_keys_to_pad_d", ",", "\n", "target_keys", ",", "target_keys_to_pad_d", ")", "\n", "", "else", ":", "\n", "                        ", "batches", "=", "{", "}", "\n", "for", "model_name", "in", "input_keys_to_pad", ".", "keys", "(", ")", ":", "\n", "                            ", "input_keys_to_pad_d", "=", "{", "\n", "input_key_to_pad", ":", "current_lengths_batch", "[", "input_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "input_key_to_pad", "in", "input_keys_to_pad", "[", "model_name", "]", "}", "\n", "target_keys_to_pad_d", "=", "{", "\n", "target_key_to_pad", ":", "current_lengths_batch", "[", "target_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "target_key_to_pad", "in", "target_keys_to_pad", "[", "model_name", "]", "}", "\n", "batch", "=", "self", ".", "make_modular_batch", "(", "current_examples_batch", ",", "input_keys", "[", "model_name", "]", ",", "\n", "input_keys_to_pad_d", ",", "target_keys", "[", "model_name", "]", ",", "\n", "target_keys_to_pad_d", ")", "\n", "batches", "[", "model_name", "]", "=", "batch", "\n", "", "yield", "batches", "\n", "", "", "else", ":", "\n", "                    ", "if", "model_to_yield", "==", "\"full\"", ":", "\n", "                        ", "batches", "=", "{", "}", "\n", "for", "model_name", "in", "input_keys_to_pad", ".", "keys", "(", ")", ":", "\n", "                            ", "input_keys_to_pad_d", "=", "{", "\n", "input_key_to_pad", ":", "current_lengths_batch", "[", "input_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "input_key_to_pad", "in", "input_keys_to_pad", "[", "model_name", "]", "}", "\n", "target_keys_to_pad_d", "=", "{", "\n", "target_key_to_pad", ":", "current_lengths_batch", "[", "target_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "target_key_to_pad", "in", "target_keys_to_pad", "[", "model_name", "]", "}", "\n", "batch", "=", "self", ".", "make_batch", "(", "current_examples_batch", ",", "input_keys", "[", "model_name", "]", ",", "\n", "input_keys_to_pad_d", ",", "target_keys", "[", "model_name", "]", ",", "\n", "target_keys_to_pad_d", ")", "\n", "batches", "[", "model_name", "]", "=", "batch", "\n", "", "yield", "batches", "\n", "", "else", ":", "\n", "                        ", "input_keys_to_pad_d", "=", "{", "input_key_to_pad", ":", "current_lengths_batch", "[", "input_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "input_key_to_pad", "in", "input_keys_to_pad", "}", "\n", "target_keys_to_pad_d", "=", "{", "target_key_to_pad", ":", "current_lengths_batch", "[", "target_key_to_pad", "+", "\"_lengths\"", "]", "\n", "for", "target_key_to_pad", "in", "target_keys_to_pad", "}", "\n", "yield", "self", ".", "make_modular_batch", "(", "current_examples_batch", ",", "input_keys", ",", "input_keys_to_pad_d", ",", "\n", "target_keys", ",", "target_keys_to_pad_d", ")", "\n", "", "", "current_examples_batch", "=", "np", ".", "array", "(", "[", "]", ")", "\n", "current_lengths_batch", "=", "{", "\n", "\"adverb_input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"adverb_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"transitive_input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"transitive_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"planner_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"dummy_planner_target_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", ",", "\n", "\"final_input_tensor_lengths\"", ":", "np", ".", "array", "(", "[", "]", ")", "\n", "}", "\n", "\n", "", "", "", "def", "make_modular_batch", "(", "self", ",", "examples", ":", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ",", "input_keys", ":", "List", "[", "str", "]", ",", "\n", "input_keys_to_pad", ":", "Dict", "[", "str", ",", "np", ".", "ndarray", "]", ",", "target_keys", ":", "List", "[", "str", "]", ",", "\n", "target_keys_to_pad", ":", "Dict", "[", "str", ",", "np", ".", "ndarray", "]", ")", ":", "\n", "        ", "\"\"\"\n        Prepare a batch of inputs and targets for module=position.\n        :param examples: a dict with inputs in tensor form and other information about the examples\n        :param input_keys:\n        :param input_keys_to_pad:\n        :param target_keys:\n        :param target_keys_to_pad:\n        :return: a batch with inputs, targets, and extra information about the examples (needed for writing predictions)\n        \"\"\"", "\n", "all_input_keys", "=", "input_keys", "+", "list", "(", "input_keys_to_pad", ".", "keys", "(", ")", ")", "\n", "all_target_keys", "=", "target_keys", "+", "list", "(", "target_keys_to_pad", ".", "keys", "(", ")", ")", "\n", "inputs", "=", "{", "key", ":", "[", "]", "for", "key", "in", "all_input_keys", "}", "\n", "targets", "=", "{", "key", "+", "\"_targets\"", ":", "[", "]", "for", "key", "in", "all_target_keys", "}", "\n", "extra_information_batch", "=", "[", "]", "\n", "for", "example", "in", "examples", ":", "\n", "            ", "for", "key", "in", "input_keys_to_pad", ":", "\n", "                ", "max_input_length", "=", "np", ".", "max", "(", "input_keys_to_pad", "[", "key", "]", ")", "\n", "to_pad_input", "=", "max_input_length", "-", "example", "[", "key", "]", ".", "size", "(", "1", ")", "\n", "padded_input", "=", "torch", ".", "cat", "(", "[", "\n", "example", "[", "key", "]", ",", "\n", "torch", ".", "zeros", "(", "int", "(", "to_pad_input", ")", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "0", ")", "]", ",", "dim", "=", "1", ")", "\n", "inputs", "[", "key", "]", ".", "append", "(", "padded_input", ")", "\n", "", "for", "key", "in", "input_keys", ":", "\n", "                ", "inputs", "[", "key", "]", ".", "append", "(", "example", "[", "key", "]", ")", "\n", "", "for", "key", "in", "target_keys_to_pad", ":", "\n", "                ", "max_target_length", "=", "np", ".", "max", "(", "target_keys_to_pad", "[", "key", "]", ")", "\n", "to_pad_target", "=", "max_target_length", "-", "example", "[", "key", "]", ".", "size", "(", "1", ")", "\n", "padded_target", "=", "torch", ".", "cat", "(", "[", "\n", "example", "[", "key", "]", ",", "\n", "torch", ".", "zeros", "(", "int", "(", "to_pad_target", ")", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "0", ")", "]", ",", "dim", "=", "1", ")", "\n", "targets", "[", "key", "+", "\"_targets\"", "]", ".", "append", "(", "padded_target", ")", "\n", "", "for", "key", "in", "target_keys", ":", "\n", "                ", "targets", "[", "key", "+", "\"_targets\"", "]", ".", "append", "(", "example", "[", "key", "]", ")", "\n", "", "extra_information_batch", ".", "append", "(", "example", ")", "\n", "\n", "", "for", "input_key", ",", "input_values", "in", "inputs", ".", "items", "(", ")", ":", "\n", "            ", "input_batch", "=", "torch", ".", "cat", "(", "input_values", ",", "dim", "=", "0", ")", "\n", "inputs", "[", "input_key", "]", "=", "input_batch", "\n", "", "for", "input_key", ",", "input_lengths", "in", "input_keys_to_pad", ".", "items", "(", ")", ":", "\n", "            ", "inputs", "[", "input_key", "+", "\"_lengths\"", "]", "=", "input_lengths", "\n", "", "for", "target_key", ",", "target_values", "in", "targets", ".", "items", "(", ")", ":", "\n", "            ", "target_batch", "=", "torch", ".", "cat", "(", "target_values", ",", "dim", "=", "0", ")", "\n", "targets", "[", "target_key", "]", "=", "target_batch", "\n", "", "for", "target_key", ",", "target_lengths", "in", "target_keys_to_pad", ".", "items", "(", ")", ":", "\n", "            ", "targets", "[", "target_key", "+", "\"_lengths\"", "]", "=", "target_keys_to_pad", "[", "target_key", "]", "\n", "", "return", "{", "\n", "\"inputs\"", ":", "inputs", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_dataset": [[731, 761], ["os.path.join", "len", "open", "dataset_representation.update", "json.dump", "dataset.GroundedScan._grammar.__str__", "dataset.GroundedScan._vocabulary.to_representation", "dataset.GroundedScan._data_pairs.items"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.__str__", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.to_representation"], ["\"targets\"", ":", "targets", ",", "\n", "\"batch_size\"", ":", "len", "(", "examples", ")", ",", "\n", "\"extra_information\"", ":", "extra_information_batch", "\n", "}", "\n", "\n", "", "def", "make_batch", "(", "self", ",", "examples", ":", "Dict", "[", "str", ",", "torch", ".", "Tensor", "]", ",", "input_keys", ":", "List", "[", "str", "]", ",", "\n", "input_keys_to_pad", ":", "Dict", "[", "str", ",", "np", ".", "ndarray", "]", ",", "target_keys", ":", "List", "[", "str", "]", ",", "\n", "target_keys_to_pad", ":", "Dict", "[", "str", ",", "np", ".", "ndarray", "]", ")", ":", "\n", "        ", "\"\"\"\n        Prepare a batch of inputs and targets for module=position.\n        :param examples: a dict with inputs in tensor form and other information about the examples\n        :param input_keys:\n        :param input_keys_to_pad:\n        :param target_keys:\n        :param target_keys_to_pad:\n        :return: a batch with inputs, targets, and extra information about the examples (needed for writing predictions)\n        \"\"\"", "\n", "all_input_keys", "=", "input_keys", "+", "list", "(", "input_keys_to_pad", ".", "keys", "(", ")", ")", "\n", "all_target_keys", "=", "target_keys", "+", "list", "(", "target_keys_to_pad", ".", "keys", "(", ")", ")", "\n", "inputs", "=", "{", "key", ":", "[", "]", "for", "key", "in", "all_input_keys", "}", "\n", "targets", "=", "{", "key", "+", "\"_targets\"", ":", "[", "]", "for", "key", "in", "all_target_keys", "}", "\n", "extra_information_batch", "=", "[", "]", "\n", "for", "example", "in", "examples", ":", "\n", "            ", "for", "key", "in", "input_keys_to_pad", ":", "\n", "                ", "if", "key", "==", "\"input_tensor\"", ":", "\n", "                    ", "max_input_length", "=", "np", ".", "max", "(", "input_keys_to_pad", "[", "key", "]", ")", "\n", "to_pad_input", "=", "max_input_length", "-", "example", "[", "key", "]", ".", "size", "(", "1", ")", "\n", "padded_input", "=", "torch", ".", "cat", "(", "[", "\n", "example", "[", "key", "]", ",", "\n", "torch", ".", "zeros", "(", "int", "(", "to_pad_input", ")", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "0", ")", "]", ",", "dim", "=", "1", ")", "\n", "inputs", "[", "key", "]", ".", "append", "(", "padded_input", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.load_dataset_from_file": [[762, 801], ["open", "json.load", "json.load.get", "cls", "all_data[].items", "copy.deepcopy", "random.shuffle", "enumerate", "json.load.keys", "all_data[].split", "enumerate", "cls._data_pairs[].append", "cls.update_data_statistics", "cls._data_pairs[].append", "cls._data_pairs[].append", "cls.update_data_statistics"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.update_data_statistics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.update_data_statistics"], ["", "", "for", "key", "in", "input_keys", ":", "\n", "                ", "if", "key", "in", "[", "\"world_state_tensor\"", ",", "'agent_position'", ",", "'target_position'", ",", "'agent_direction'", "]", ":", "\n", "                    ", "inputs", "[", "key", "]", ".", "append", "(", "example", "[", "key", "]", ")", "\n", "", "", "for", "key", "in", "target_keys_to_pad", ":", "\n", "                ", "if", "key", "==", "\"target_tensor\"", ":", "\n", "                    ", "max_target_length", "=", "np", ".", "max", "(", "target_keys_to_pad", "[", "key", "]", ")", "\n", "to_pad_target", "=", "max_target_length", "-", "example", "[", "key", "]", ".", "size", "(", "1", ")", "\n", "padded_target", "=", "torch", ".", "cat", "(", "[", "\n", "example", "[", "key", "]", ",", "\n", "torch", ".", "zeros", "(", "int", "(", "to_pad_target", ")", ",", "dtype", "=", "torch", ".", "long", ",", "device", "=", "device", ")", ".", "unsqueeze", "(", "0", ")", "]", ",", "dim", "=", "1", ")", "\n", "targets", "[", "key", "+", "\"_targets\"", "]", ".", "append", "(", "padded_target", ")", "\n", "", "", "for", "key", "in", "target_keys", ":", "\n", "                ", "if", "key", "in", "[", "'agent_position'", ",", "'target_position'", ",", "'agent_direction'", "]", ":", "\n", "                    ", "targets", "[", "key", "+", "\"_targets\"", "]", ".", "append", "(", "example", "[", "key", "]", ")", "\n", "", "", "extra_information_batch", ".", "append", "(", "example", ")", "\n", "\n", "", "for", "input_key", ",", "input_values", "in", "inputs", ".", "items", "(", ")", ":", "\n", "            ", "if", "len", "(", "input_values", ")", ":", "\n", "                ", "input_batch", "=", "torch", ".", "cat", "(", "input_values", ",", "dim", "=", "0", ")", "\n", "", "else", ":", "\n", "                ", "input_batch", "=", "[", "]", "\n", "", "inputs", "[", "input_key", "]", "=", "input_batch", "\n", "", "for", "input_key", ",", "input_lengths", "in", "input_keys_to_pad", ".", "items", "(", ")", ":", "\n", "            ", "inputs", "[", "input_key", "+", "\"_lengths\"", "]", "=", "input_lengths", "\n", "", "for", "target_key", ",", "target_values", "in", "targets", ".", "items", "(", ")", ":", "\n", "            ", "if", "len", "(", "target_values", ")", ":", "\n", "                ", "target_batch", "=", "torch", ".", "cat", "(", "target_values", ",", "dim", "=", "0", ")", "\n", "", "else", ":", "\n", "                ", "target_batch", "=", "[", "]", "\n", "", "targets", "[", "target_key", "]", "=", "target_batch", "\n", "", "for", "target_key", ",", "target_lengths", "in", "target_keys_to_pad", ".", "items", "(", ")", ":", "\n", "            ", "targets", "[", "target_key", "+", "\"_lengths\"", "]", "=", "target_keys_to_pad", "[", "target_key", "]", "\n", "", "return", "{", "\n", "\"inputs\"", ":", "inputs", ",", "\n", "\"targets\"", ":", "targets", ",", "\n", "\"batch_size\"", ":", "len", "(", "examples", ")", ",", "\n", "\"extra_information\"", ":", "extra_information_batch", "\n", "}", "\n", "", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_all_commands": [[802, 804], ["dataset.GroundedScan._grammar.generate_all_commands"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_all_commands"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.sample_command": [[805, 815], ["dataset.GroundedScan._grammar.sample", "dataset.GroundedScan.meaning", "dataset.GroundedScan._grammar.is_coherent"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.is_coherent"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_target_commands": [[816, 835], ["dataset.GroundedScan._world.get_current_situation", "dataset.GroundedScan.initialize_world", "dataset.GroundedScan._world.get_current_observations", "dataset.GroundedScan._world.clear_situation", "dataset.GroundedScan.initialize_world", "dataset.GroundedScan._world.execute_command"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_observations", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.execute_command"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command": [[836, 923], ["derivation.meaning", "dataset.GroundedScan._world.get_current_situation", "dataset.GroundedScan.initialize_world", "GroundedScan.helpers.topo_sort", "dataset.GroundedScan._world.get_current_observations", "dataset.GroundedScan._world.clear_situation", "dataset.GroundedScan.initialize_world", "derivation.words", "derivation.meaning.select", "derivation.meaning.select.select", "manner.pop", "len", "len", "derivation.meaning.select.select", "logical_form.select.select.to_predicate", "random.sample().pop", "dataset.GroundedScan._world.go_to_position", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._world.has_object", "len", "logger.info", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._world.move_object_to_wall", "dataset.GroundedScan._world.object_positions", "random.sample", "dataset.GroundedScan._vocabulary.translate_word", "len", "object_str.split"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.topo_sort", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_observations", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.select", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.select", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.select", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.to_predicate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.go_to_position", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.has_object", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.move_object_to_wall", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.object_positions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world": [[924, 938], ["dataset.GroundedScan._world.initialize", "objects.append", "dataset.GroundedScan._world.set_mission"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.initialize", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.set_mission"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.visualize_attention": [[939, 942], ["NotImplementedError"], "methods", ["None"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.error_analysis": [[943, 1069], ["os.path.exists", "xlwt.Workbook", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "collections.defaultdict", "open", "json.load", "logger.info", "open", "outfile.write", "outfile.write", "collections.Counter", "outfile.write", "outfile.write", "outfile.write", "error_analysis.items", "xlwt.Workbook.save", "all_accuracies.append", "exact_matches.append", "dataset.GroundedScan.parse_derivation_repr", "dataset.GroundedScan.meaning", "arguments.pop().to_predicate", "dataset.GroundedScan.words", "dataset.GroundedScan._vocabulary.translate_word", "len", "GroundedScan.world.Situation.from_representation", "error_analysis.keys", "xlwt.Workbook.add_sheet", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "outfile.write", "enumerate", "outfile.write", "GroundedScan.helpers.bar_plot", "GroundedScan.helpers.bar_plot", "GroundedScan.helpers.grouped_bar_plot", "len", "len", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "[].append", "[].append", "numpy.mean", "values.items", "outfile.write", "numpy.array", "numpy.mean", "len", "numpy.std", "collections.Counter", "outfile.write", "outfile.write", "outfile.write", "outfile.write", "outfile.write", "outfile.write", "outfile.write", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "xlwt.Workbook.add_sheet.write", "output_file.split", "arguments.pop", "dataset.GroundedScan._vocabulary.get_adverbs", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "str", "numpy.array", "len", "os.path.join", "os.path.join", "os.path.join", "len", "numpy.min", "numpy.max"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_derivation_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.to_predicate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.from_representation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.bar_plot", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.bar_plot", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.grouped_bar_plot", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.min", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.position_analysis": [[1070, 1132], ["os.path.exists", "open", "json.load", "workbook.add_sheet", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "enumerate", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "GroundedScan.world.Situation.from_representation", "dataset.GroundedScan.demonstrate_target_commands", "dataset.GroundedScan.demonstrate_target_commands", "[].split", "dataset.GroundedScan._vocabulary.translate_word", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "workbook.add_sheet.write", "int", "int", "int", "int", "int", "int", "int", "int", "[].split", "predictions_file.split"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.from_representation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_target_commands", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_target_commands", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.visualize_prediction": [[1133, 1167], ["os.path.exists", "open", "json.load", "enumerate", "GroundedScan.world.Situation.from_representation", "dataset.GroundedScan.demonstrate_target_commands", "dataset.GroundedScan.demonstrate_target_commands", "dataset.GroundedScan.visualize_command", "save_dirs.append", "dataset.GroundedScan._vocabulary.translate_word"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.from_representation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_target_commands", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_target_commands", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.visualize_command", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.visualize_data_example": [[1168, 1180], ["dataset.GroundedScan.parse_example", "dataset.GroundedScan.visualize_command"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.parse_example", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.visualize_command"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.visualize_adverb_example": [[1181, 1197], ["dataset.GroundedScan.parse_adverb_example", "dataset.GroundedScan.demonstrate_target_commands", "dataset.GroundedScan.visualize_command"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_adverb_example", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_target_commands", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.visualize_command"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.visualize_data_examples": [[1198, 1206], ["len", "logger.info", "dataset.GroundedScan.visualize_data_example", "save_dirs.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.visualize_data_example", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.visualize_adverb_examples": [[1207, 1215], ["len", "logger.info", "dataset.GroundedScan.visualize_adverb_example", "save_dirs.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.visualize_adverb_example", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.visualize_command": [[1216, 1282], ["dataset.GroundedScan._world.get_current_situation", "os.path.join", "os.path.join", "os.path.join", "dataset.GroundedScan.initialize_world", "dataset.GroundedScan._world.save_situation", "enumerate", "os.path.join", "imageio.mimsave", "dataset.GroundedScan.initialize_world", "os.path.join", "os.path.exists", "os.mkdir", "os.listdir", "len", "os.path.exists", "os.mkdir", "numpy.array", "os.path.join", "dataset.GroundedScan.initialize_world", "dataset.GroundedScan._world.save_situation", "filenames.append", "images.append", "os.path.join", "dataset.GroundedScan._vocabulary.translate_word", "os.path.exists", "os.mkdir", "numpy.array", "os.path.join", "imageio.imread", "os.path.join", "os.path.join", "len", "len", "str"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.save_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.save_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_possible_targets": [[1283, 1305], ["list", "itertools.product", "ValueError"], "methods", ["None"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.all_objects_except_shape": [[1306, 1312], ["all_shapes.remove", "list", "itertools.product"], "methods", ["None"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_larger_sizes": [[1313, 1315], ["list", "range"], "methods", ["None"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_smaller_sizes": [[1316, 1318], ["list", "range"], "methods", ["None"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_distinct_objects": [[1319, 1391], ["all_shapes.remove", "objects.append", "all_other_shapes.remove", "dataset.GroundedScan.get_larger_sizes", "dataset.GroundedScan.get_smaller_sizes", "ValueError", "dataset.GroundedScan._object_vocabulary.sample_size", "dataset.GroundedScan._object_vocabulary.sample_color", "objects.append", "range", "objects.append", "range", "objects.append", "obligatory_objects.append", "colored_shapes.append", "range", "objects.append", "obligatory_objects.append", "colored_shapes.append", "dataset.GroundedScan._object_vocabulary.sample_size", "colored_shapes.append", "random.choice", "dataset.GroundedScan._object_vocabulary.sample_size", "random.choice", "dataset.GroundedScan._object_vocabulary.sample_size", "random.choice"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_larger_sizes", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_smaller_sizes", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.sample_size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.sample_color", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.sample_size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.sample_size", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.ObjectVocabulary.sample_size"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_situations": [[1392, 1491], ["itertools.product", "situation_specifications.keys", "situation_specifications[].keys", "[].keys", "range", "range", "range", "dataset.GroundedScan.get_empty_situation", "GroundedScan.world.Position", "[].append", "range", "dataset.GroundedScan._world.within_grid", "dataset.GroundedScan._world.sample_position_conditioned", "dataset.GroundedScan._world.get_position_at", "dataset.GroundedScan._world.within_grid", "dataset.GroundedScan._world.within_grid", "dataset.GroundedScan.get_empty_situation", "random.randint", "list", "GroundedScan.world.Position", "[].append", "max", "min", "dataset.GroundedScan._world.within_grid", "dataset.GroundedScan._world.sample_position_conditioned", "dataset.GroundedScan._world.get_position_at", "dataset.GroundedScan._world.get_position_at", "dataset.GroundedScan._world.within_grid", "dataset.GroundedScan._world.within_grid", "condition.values", "condition.values"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_empty_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.within_grid", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.sample_position_conditioned", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_position_at", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.within_grid", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.within_grid", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_empty_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.min", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.within_grid", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.sample_position_conditioned", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_position_at", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_position_at", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.within_grid", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.within_grid"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world_from_spec": [[1492, 1516], ["dataset.GroundedScan._world.clear_situation", "dataset.GroundedScan._world.place_agent_at", "dataset.GroundedScan._world.place_object", "dataset.GroundedScan.generate_distinct_objects", "int", "max", "random.sample", "GroundedScan.world.Object", "objects_to_place.extend", "dataset.GroundedScan._world.sample_position", "dataset.GroundedScan._world.place_object", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "len", "GroundedScan.world.Object"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.place_agent_at", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.place_object", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_distinct_objects", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.sample_position", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.place_object", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr": [[1517, 1520], ["None"], "methods", ["None"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_command_repr": [[1521, 1524], ["command_repr.split"], "methods", ["None"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.derivation_repr": [[1525, 1528], ["str"], "methods", ["None"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_derivation_repr": [[1529, 1532], ["derivation_repr.split", "GroundedScan.grammar.Derivation.from_str"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.from_str"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.position_repr": [[1533, 1536], ["str", "str"], "methods", ["None"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_position_repr": [[1537, 1541], ["position_repr.split", "GroundedScan.world.Position", "int", "int"], "methods", ["None"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_data_pairs": [[1542, 1672], ["dataset.GroundedScan._world.get_current_situation", "dataset.GroundedScan.reset_dataset", "dataset.GroundedScan.generate_situations", "dataset.GroundedScan.generate_all_commands", "dataset.GroundedScan._grammar.all_derivations.items", "logger.info", "logger.info", "dataset.GroundedScan.discard_equivalent_examples", "logger.info", "dataset.GroundedScan.initialize_world", "logger.info", "dataset.GroundedScan.make_test_set", "dataset.GroundedScan.make_test_set", "dataset.GroundedScan.move_k_examples_to_train", "derivation.meaning", "derivation.words", "arguments.pop().to_predicate", "dataset.GroundedScan.generate_possible_targets", "len", "len", "random.sample().pop", "enumerate", "dataset.GroundedScan._vocabulary.get_adverbs", "arguments.pop", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "random.sample", "set", "dataset.GroundedScan.initialize_world_from_spec", "dataset.GroundedScan._world.get_current_situation", "dataset.GroundedScan.demonstrate_command", "dataset.GroundedScan.fill_example", "dataset.GroundedScan._world.clear_situation", "random.sample", "logger.info", "dataset.GroundedScan._template_identifiers[].append", "int", "derivation.words", "derivation.words", "dataset.GroundedScan.assign_splits", "derivation.words", "range", "derivation.words", "dataset.GroundedScan._vocabulary.translate_word", "len", "ValueError", "range", "len", "dataset.GroundedScan._world.clear_situation", "len"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.reset_dataset", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_situations", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_all_commands", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.discard_equivalent_examples", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.make_test_set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.make_test_set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.move_k_examples_to_train", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.to_predicate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_possible_targets", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world_from_spec", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.fill_example", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.assign_splits", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_adverb_world_states": [[1673, 1879], ["dataset.GroundedScan._world.get_current_situation", "dataset.GroundedScan.reset_dataset", "dataset.GroundedScan.generate_situations", "dataset.GroundedScan.generate_all_commands", "all_derivations.items", "all_derivations_list.items", "logger.info", "dataset.GroundedScan.make_test_set", "logger.info", "dataset.GroundedScan.discard_equivalent_examples_v2", "logger.info", "dataset.GroundedScan.initialize_world", "int", "random.shuffle", "random.sample().pop", "dataset.GroundedScan.parse_derivation_repr", "dataset.GroundedScan.meaning", "arguments.pop().to_predicate", "dataset.GroundedScan.generate_possible_targets", "random.sample().pop", "dataset.GroundedScan.words", "random.sample().pop", "dataset.GroundedScan.initialize_world_from_spec", "dataset.GroundedScan._world.get_current_situation", "example_parser", "dataset.GroundedScan.demonstrate_command", "input_output_keys", "dataset.GroundedScan.fill_adverb_example", "dataset.GroundedScan._world.clear_situation", "dataset.GroundedScan.make_test_set", "dataset.GroundedScan.discard_excess_examples_train", "dataset.GroundedScan.move_k_examples_to_train", "dataset.GroundedScan._vocabulary.get_adverbs", "all_derivations_list[].append", "all_derivations_list.keys", "random.sample().pop", "random.sample().pop", "len", "logger.info", "dataset.GroundedScan.assign_adverb_splits", "dataset.GroundedScan.assign_splits", "adverb_types", "adverb_types", "len", "dataset.GroundedScan._template_identifiers[].append", "dataset.GroundedScan.move_k_examples_to_train", "template_derivation.words", "dataset.GroundedScan._vocabulary.get_adverbs", "random.sample", "arguments.pop", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "random.sample", "dataset.GroundedScan._vocabulary.get_adverbs", "random.sample", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "abs", "adverb_programs", "adverb_types", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "len", "dataset.GroundedScan._world.clear_situation", "dataset.GroundedScan.words", "adverb_types", "dataset.GroundedScan.derivation_repr", "random.sample", "all_derivations_list.keys", "random.sample", "dataset.GroundedScan._vocabulary.get_transitive_verbs", "dataset.GroundedScan._vocabulary.get_intransitive_verbs", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "all_derivations_list.keys"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.reset_dataset", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_situations", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_all_commands", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.make_test_set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.discard_equivalent_examples_v2", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.parse_derivation_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.to_predicate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_possible_targets", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world_from_spec", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.fill_adverb_example", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.make_test_set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.discard_excess_examples_train", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.move_k_examples_to_train", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.assign_adverb_splits", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.assign_splits", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.move_k_examples_to_train", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.abs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.derivation_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_transitive_verbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_intransitive_verbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_all_adverb_world_states": [[1880, 2044], ["dataset.GroundedScan._world.get_current_situation", "dataset.GroundedScan.reset_dataset", "dataset.GroundedScan.generate_situations", "dataset.GroundedScan.generate_situations", "dataset.GroundedScan.generate_all_commands", "dataset.GroundedScan._grammar.all_derivations.items", "logger.info", "dataset.GroundedScan.make_test_set", "logger.info", "dataset.GroundedScan.discard_equivalent_examples_v2", "logger.info", "dataset.GroundedScan.initialize_world", "dataset.GroundedScan.make_test_set", "dataset.GroundedScan.move_k_examples_to_train", "dataset.GroundedScan._vocabulary.get_adverbs", "derivation.meaning", "arguments.pop().to_predicate", "derivation.words", "dataset.GroundedScan.generate_possible_targets", "dataset.GroundedScan.move_k_examples_to_train", "len", "len", "enumerate", "arguments.pop", "dataset.GroundedScan._vocabulary.get_adverbs", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan.initialize_world_from_spec", "dataset.GroundedScan._world.get_current_situation", "example_parser", "input_output_keys", "dataset.GroundedScan.demonstrate_command", "dataset.GroundedScan.fill_adverb_example", "dataset.GroundedScan._world.clear_situation", "dataset.GroundedScan._vocabulary.get_transitive_verbs", "dataset.GroundedScan._vocabulary.get_intransitive_verbs", "dataset.GroundedScan._vocabulary.translate_word", "logger.info", "dataset.GroundedScan.assign_adverb_splits", "dataset.GroundedScan.assign_splits", "adverb_types", "adverb_types", "len", "dataset.GroundedScan._template_identifiers[].append", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "abs", "adverb_programs", "adverb_types", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "len", "dataset.GroundedScan._world.clear_situation", "derivation.words", "adverb_types", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.reset_dataset", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_situations", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_situations", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_all_commands", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.make_test_set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.discard_equivalent_examples_v2", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.make_test_set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.move_k_examples_to_train", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.to_predicate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_possible_targets", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.move_k_examples_to_train", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world_from_spec", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.demonstrate_command", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.fill_adverb_example", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_transitive_verbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_intransitive_verbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.assign_adverb_splits", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.assign_splits", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.abs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.assign_adverb_splits": [[2045, 2059], ["dataset.GroundedScan._vocabulary.translate_meaning", "splits.append", "splits.append", "splits.append", "dataset.GroundedScan._vocabulary.translate_meaning"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.assign_splits": [[2060, 2094], ["dataset.GroundedScan._vocabulary.translate_meaning", "splits.append", "splits.append", "splits.append", "splits.append", "splits.append", "splits.append", "splits.append", "splits.append", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_meaning", "dataset.GroundedScan._vocabulary.translate_meaning"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_meaning"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.__main__.main": [[18, 272], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "vars", "vars.items", "argparse.ArgumentParser.parse_args", "int", "logger.info", "NotImplementedError", "os.path.exists", "os.path.join", "GroundedScan.dataset.GroundedScan", "GroundedScan.load_dataset_from_file.get_data_pairs", "logger.info", "GroundedScan.load_dataset_from_file.save_dataset_statistics", "GroundedScan.load_dataset_from_file.save_dataset", "GroundedScan.load_dataset_from_file.visualize_data_examples", "logger.info", "os.getcwd", "os.path.exists", "os.mkdir", "flags[].split", "flags[].split", "flags[].split", "flags[].split", "GroundedScan.load_dataset_from_file.save_dataset_statistics", "flags[].split", "flags[].split", "flags[].split", "GroundedScan.load_dataset_from_file.save_dataset_statistics", "GroundedScan.load_dataset_from_file.save_dataset_statistics", "logger.info", "logger.info", "GroundedScan.dataset.GroundedScan.load_dataset_from_file", "GroundedScan.load_dataset_from_file.visualize_prediction", "logger.info", "flags[].split", "xlwt.Workbook", "os.path.join", "xlwt.Workbook.save", "logger.info", "GroundedScan.load_dataset_from_file.save_dataset_statistics", "ValueError", "os.path.join", "logger.info", "GroundedScan.dataset.GroundedScan.load_dataset_from_file", "GroundedScan.load_dataset_from_file.position_analysis", "logger.info", "logger.info", "GroundedScan.dataset_test.run_all_tests", "GroundedScan.load_dataset_from_file.count_equivalent_examples", "os.path.join", "flags[].split", "logger.info", "GroundedScan.dataset.GroundedScan.load_dataset_from_file", "os.path.join", "GroundedScan.load_dataset_from_file.error_analysis", "logger.info", "logger.info", "GroundedScan.dataset.GroundedScan.load_dataset_from_file", "logger.info", "file.split", "os.path.exists", "os.mkdir", "GroundedScan.load_dataset_from_file.save_dataset_statistics", "GroundedScan.dsl.AdverbWorld", "GroundedScan.dsl.AdverbWorld.generate_adverb_challenge", "GroundedScan.dsl.AdverbWorld.save_adverb_challenge", "logger.info", "GroundedScan.dsl.AdverbWorld.save_gscan_statistics", "GroundedScan.dsl.AdverbWorld.visualize_gscan_examples", "ValueError", "os.path.join", "os.path.join", "os.path.join"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_data_pairs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_dataset_statistics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_dataset", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.visualize_data_examples", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_dataset_statistics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_dataset_statistics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_dataset_statistics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.load_dataset_from_file", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.visualize_prediction", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_dataset_statistics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.load_dataset_from_file", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.position_analysis", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.run_all_tests", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.count_equivalent_examples", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.load_dataset_from_file", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.error_analysis", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.load_dataset_from_file", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_dataset_statistics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.generate_adverb_challenge", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.save_adverb_challenge", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.save_gscan_statistics", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.visualize_gscan_examples"], ["    ", "logger", ".", "info", "(", "\"Using CUDA.\"", ")", "\n", "logger", ".", "info", "(", "\"Cuda version: {}\"", ".", "format", "(", "torch", ".", "version", ".", "cuda", ")", ")", "\n", "\n", "", "parser", "=", "argparse", ".", "ArgumentParser", "(", "description", "=", "\"Sequence to sequence models for Grounded SCAN\"", ")", "\n", "\n", "# General arguments", "\n", "parser", ".", "add_argument", "(", "\"--mode\"", ",", "type", "=", "str", ",", "default", "=", "\"run_tests\"", ",", "help", "=", "\"train, test or predict\"", ",", "required", "=", "True", ")", "\n", "parser", ".", "add_argument", "(", "\"--output_directory\"", ",", "type", "=", "str", ",", "default", "=", "\"output\"", ",", "help", "=", "\"In this directory the models will be \"", "\n", "\"saved. Will be created if doesn't exist.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--resume_from_file\"", ",", "type", "=", "str", ",", "default", "=", "\"\"", ",", "help", "=", "\"Full path to previously saved model to load.\"", ")", "\n", "\n", "# Data arguments", "\n", "parser", ".", "add_argument", "(", "\"--split\"", ",", "type", "=", "str", ",", "default", "=", "\"test\"", ",", "help", "=", "\"Which split to get from Grounded Scan.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--data_directory\"", ",", "type", "=", "str", ",", "default", "=", "\"data/uniform_dataset\"", ",", "help", "=", "\"Path to folder with data.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--input_vocab_path\"", ",", "type", "=", "str", ",", "default", "=", "\"training_input_vocab.txt\"", ",", "\n", "help", "=", "\"Path to file with input vocabulary as saved by Vocabulary class in gSCAN_dataset.py\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--target_vocab_path\"", ",", "type", "=", "str", ",", "default", "=", "\"training_target_vocab.txt\"", ",", "\n", "help", "=", "\"Path to file with target vocabulary as saved by Vocabulary class in gSCAN_dataset.py\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--generate_vocabularies\"", ",", "dest", "=", "\"generate_vocabularies\"", ",", "default", "=", "False", ",", "action", "=", "\"store_true\"", ",", "\n", "help", "=", "\"Whether to generate vocabularies based on the data.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--load_vocabularies\"", ",", "dest", "=", "\"generate_vocabularies\"", ",", "default", "=", "True", ",", "action", "=", "\"store_false\"", ",", "\n", "help", "=", "\"Whether to use previously saved vocabularies.\"", ")", "\n", "\n", "# Training and learning arguments", "\n", "parser", ".", "add_argument", "(", "\"--training_batch_size\"", ",", "type", "=", "int", ",", "default", "=", "50", ")", "\n", "parser", ".", "add_argument", "(", "\"--k\"", ",", "type", "=", "int", ",", "default", "=", "0", ",", "help", "=", "\"How many examples from the adverb_1 split to move to train.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--test_batch_size\"", ",", "type", "=", "int", ",", "default", "=", "1", ",", "help", "=", "\"Currently only 1 supported due to decoder.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--max_training_examples\"", ",", "type", "=", "int", ",", "default", "=", "None", ",", "help", "=", "\"If None all are used.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--learning_rate\"", ",", "type", "=", "float", ",", "default", "=", "0.001", ")", "\n", "parser", ".", "add_argument", "(", "'--lr_decay'", ",", "type", "=", "float", ",", "default", "=", "0.9", ")", "\n", "parser", ".", "add_argument", "(", "'--lr_decay_steps'", ",", "type", "=", "float", ",", "default", "=", "20000", ")", "\n", "parser", ".", "add_argument", "(", "\"--adam_beta_1\"", ",", "type", "=", "float", ",", "default", "=", "0.9", ")", "\n", "parser", ".", "add_argument", "(", "\"--adam_beta_2\"", ",", "type", "=", "float", ",", "default", "=", "0.999", ")", "\n", "parser", ".", "add_argument", "(", "\"--print_every\"", ",", "type", "=", "int", ",", "default", "=", "100", ")", "\n", "parser", ".", "add_argument", "(", "\"--evaluate_every\"", ",", "type", "=", "int", ",", "default", "=", "1000", ",", "help", "=", "\"How often to evaluate the model by decoding the \"", "\n", "\"test set (without teacher forcing).\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--max_training_iterations\"", ",", "type", "=", "int", ",", "default", "=", "100000", ")", "\n", "parser", ".", "add_argument", "(", "\"--weight_target_loss\"", ",", "type", "=", "float", ",", "default", "=", "0.3", ",", "help", "=", "\"Only used if --auxiliary_task set.\"", ")", "\n", "\n", "# Testing and predicting arguments", "\n", "parser", ".", "add_argument", "(", "\"--max_testing_examples\"", ",", "type", "=", "int", ",", "default", "=", "None", ")", "\n", "parser", ".", "add_argument", "(", "\"--splits\"", ",", "type", "=", "str", ",", "default", "=", "\"test\"", ",", "help", "=", "\"comma-separated list of splits to predict for.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--max_decoding_steps\"", ",", "type", "=", "int", ",", "default", "=", "30", ",", "help", "=", "\"After 30 decoding steps, the decoding process \"", "\n", "\"is stopped regardless of whether an EOS token \"", "\n", "\"was generated.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--output_file_name\"", ",", "type", "=", "str", ",", "default", "=", "\"predict.json\"", ")", "\n", "\n", "# Situation Encoder arguments", "\n", "parser", ".", "add_argument", "(", "\"--simple_situation_representation\"", ",", "dest", "=", "\"simple_situation_representation\"", ",", "default", "=", "True", ",", "\n", "action", "=", "\"store_true\"", ",", "help", "=", "\"Represent the situation with 1 vector per grid cell. \"", "\n", "\"For more information, read grounded SCAN documentation.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--image_situation_representation\"", ",", "dest", "=", "\"simple_situation_representation\"", ",", "default", "=", "False", ",", "\n", "action", "=", "\"store_false\"", ",", "help", "=", "\"Represent the situation with the full gridworld RGB image. \"", "\n", "\"For more information, read grounded SCAN documentation.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--cnn_hidden_num_channels\"", ",", "type", "=", "int", ",", "default", "=", "50", ")", "\n", "parser", ".", "add_argument", "(", "\"--cnn_kernel_size\"", ",", "type", "=", "int", ",", "default", "=", "7", ",", "help", "=", "\"Size of the largest filter in the world state \"", "\n", "\"model.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--cnn_dropout_p\"", ",", "type", "=", "float", ",", "default", "=", "0.1", ",", "help", "=", "\"Dropout applied to the output features of the \"", "\n", "\"world state model.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--auxiliary_task\"", ",", "dest", "=", "\"auxiliary_task\"", ",", "default", "=", "False", ",", "action", "=", "\"store_true\"", ",", "\n", "help", "=", "\"If set to true, the model predicts the target location from the joint attention over the \"", "\n", "\"input instruction and world state.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--no_auxiliary_task\"", ",", "dest", "=", "\"auxiliary_task\"", ",", "default", "=", "True", ",", "action", "=", "\"store_false\"", ")", "\n", "\n", "# Command Encoder arguments", "\n", "parser", ".", "add_argument", "(", "\"--embedding_dimension\"", ",", "type", "=", "int", ",", "default", "=", "25", ")", "\n", "parser", ".", "add_argument", "(", "\"--num_encoder_layers\"", ",", "type", "=", "int", ",", "default", "=", "1", ")", "\n", "parser", ".", "add_argument", "(", "\"--encoder_hidden_size\"", ",", "type", "=", "int", ",", "default", "=", "100", ")", "\n", "parser", ".", "add_argument", "(", "\"--encoder_dropout_p\"", ",", "type", "=", "float", ",", "default", "=", "0.3", ",", "help", "=", "\"Dropout on instruction embeddings and LSTM.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--encoder_bidirectional\"", ",", "dest", "=", "\"encoder_bidirectional\"", ",", "default", "=", "True", ",", "action", "=", "\"store_true\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--encoder_unidirectional\"", ",", "dest", "=", "\"encoder_bidirectional\"", ",", "default", "=", "False", ",", "action", "=", "\"store_false\"", ")", "\n", "\n", "# Decoder arguments", "\n", "parser", ".", "add_argument", "(", "\"--num_decoder_layers\"", ",", "type", "=", "int", ",", "default", "=", "1", ")", "\n", "parser", ".", "add_argument", "(", "\"--attention_type\"", ",", "type", "=", "str", ",", "default", "=", "'bahdanau'", ",", "choices", "=", "[", "'bahdanau'", ",", "'luong'", "]", ",", "\n", "help", "=", "\"Luong not properly implemented.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--decoder_dropout_p\"", ",", "type", "=", "float", ",", "default", "=", "0.3", ",", "help", "=", "\"Dropout on decoder embedding and LSTM.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--decoder_hidden_size\"", ",", "type", "=", "int", ",", "default", "=", "100", ")", "\n", "parser", ".", "add_argument", "(", "\"--conditional_attention\"", ",", "dest", "=", "\"conditional_attention\"", ",", "default", "=", "True", ",", "action", "=", "\"store_true\"", ",", "\n", "help", "=", "\"If set to true joint attention over the world state conditioned on the input instruction is\"", "\n", "\" used.\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--no_conditional_attention\"", ",", "dest", "=", "\"conditional_attention\"", ",", "default", "=", "False", ",", "action", "=", "\"store_false\"", ")", "\n", "\n", "# Other arguments", "\n", "parser", ".", "add_argument", "(", "\"--seed\"", ",", "type", "=", "int", ",", "default", "=", "42", ")", "\n", "\n", "\n", "def", "main", "(", "flags", ")", ":", "\n", "    ", "for", "argument", ",", "value", "in", "flags", ".", "items", "(", ")", ":", "\n", "        ", "logger", ".", "info", "(", "\"{}: {}\"", ".", "format", "(", "argument", ",", "value", ")", ")", "\n", "\n", "", "if", "not", "os", ".", "path", ".", "exists", "(", "flags", "[", "\"output_directory\"", "]", ")", ":", "\n", "        ", "os", ".", "mkdir", "(", "os", ".", "path", ".", "join", "(", "os", ".", "getcwd", "(", ")", ",", "flags", "[", "\"output_directory\"", "]", ")", ")", "\n", "\n", "", "if", "not", "flags", "[", "\"simple_situation_representation\"", "]", ":", "\n", "        ", "raise", "NotImplementedError", "(", "\"Full RGB input image not implemented. Implement or set \"", "\n", "\"--simple_situation_representation\"", ")", "\n", "# Some checks on the flags", "\n", "", "if", "flags", "[", "\"generate_vocabularies\"", "]", ":", "\n", "        ", "assert", "flags", "[", "\"input_vocab_path\"", "]", "and", "flags", "[", "\"target_vocab_path\"", "]", ",", "\"Please specify paths to vocabularies to save.\"", "\n", "\n", "", "if", "flags", "[", "\"test_batch_size\"", "]", ">", "1", ":", "\n", "        ", "raise", "NotImplementedError", "(", "\"Test batch size larger than 1 not implemented.\"", ")", "\n", "\n", "", "data_path", "=", "os", ".", "path", ".", "join", "(", "flags", "[", "\"data_directory\"", "]", ",", "\"dataset.txt\"", ")", "\n", "if", "flags", "[", "\"mode\"", "]", "==", "\"train\"", ":", "\n", "        ", "train", "(", "data_path", "=", "data_path", ",", "**", "flags", ")", "\n", "", "elif", "flags", "[", "\"mode\"", "]", "==", "\"test\"", ":", "\n", "        ", "assert", "os", ".", "path", ".", "exists", "(", "os", ".", "path", ".", "join", "(", "flags", "[", "\"data_directory\"", "]", ",", "flags", "[", "\"input_vocab_path\"", "]", ")", ")", "and", "os", ".", "path", ".", "exists", "(", "\n", "os", ".", "path", ".", "join", "(", "flags", "[", "\"data_directory\"", "]", ",", "flags", "[", "\"target_vocab_path\"", "]", ")", ")", ",", "\"No vocabs found at {} and {}\"", ".", "format", "(", "flags", "[", "\"input_vocab_path\"", "]", ",", "flags", "[", "\"target_vocab_path\"", "]", ")", "\n", "splits", "=", "flags", "[", "\"splits\"", "]", ".", "split", "(", "\",\"", ")", "\n", "for", "split", "in", "splits", ":", "\n", "            ", "logger", ".", "info", "(", "\"Loading {} dataset split...\"", ".", "format", "(", "split", ")", ")", "\n", "test_set", "=", "GroundedScanDataset", "(", "data_path", ",", "flags", "[", "\"data_directory\"", "]", ",", "split", "=", "split", ",", "\n", "input_vocabulary_file", "=", "flags", "[", "\"input_vocab_path\"", "]", ",", "\n", "target_vocabulary_file", "=", "flags", "[", "\"target_vocab_path\"", "]", ",", "generate_vocabulary", "=", "False", ",", "\n", "k", "=", "flags", "[", "\"k\"", "]", ")", "\n", "test_set", ".", "read_dataset", "(", "max_examples", "=", "None", ",", "\n", "simple_situation_representation", "=", "flags", "[", "\"simple_situation_representation\"", "]", ")", "\n", "logger", ".", "info", "(", "\"Done Loading {} dataset split.\"", ".", "format", "(", "flags", "[", "\"split\"", "]", ")", ")", "\n", "logger", ".", "info", "(", "\"  Loaded {} examples.\"", ".", "format", "(", "test_set", ".", "num_examples", ")", ")", "\n", "logger", ".", "info", "(", "\"  Input vocabulary size: {}\"", ".", "format", "(", "test_set", ".", "input_vocabulary_size", ")", ")", "\n", "logger", ".", "info", "(", "\"  Most common input words: {}\"", ".", "format", "(", "test_set", ".", "input_vocabulary", ".", "most_common", "(", "5", ")", ")", ")", "\n", "logger", ".", "info", "(", "\"  Output vocabulary size: {}\"", ".", "format", "(", "test_set", ".", "target_vocabulary_size", ")", ")", "\n", "logger", ".", "info", "(", "\"  Most common target words: {}\"", ".", "format", "(", "test_set", ".", "target_vocabulary", ".", "most_common", "(", "5", ")", ")", ")", "\n", "\n", "model", "=", "Model", "(", "input_vocabulary_size", "=", "test_set", ".", "input_vocabulary_size", ",", "\n", "target_vocabulary_size", "=", "test_set", ".", "target_vocabulary_size", ",", "\n", "num_cnn_channels", "=", "test_set", ".", "image_channels", ",", "\n", "input_padding_idx", "=", "test_set", ".", "input_vocabulary", ".", "pad_idx", ",", "\n", "target_pad_idx", "=", "test_set", ".", "target_vocabulary", ".", "pad_idx", ",", "\n", "target_eos_idx", "=", "test_set", ".", "target_vocabulary", ".", "eos_idx", ",", "\n", "**", "flags", ")", "\n", "model", "=", "model", ".", "cuda", "(", ")", "if", "use_cuda", "else", "model", "\n", "\n", "# Load model and vocabularies if resuming.", "\n", "assert", "os", ".", "path", ".", "isfile", "(", "flags", "[", "\"resume_from_file\"", "]", ")", ",", "\"No checkpoint found at {}\"", ".", "format", "(", "flags", "[", "\"resume_from_file\"", "]", ")", "\n", "logger", ".", "info", "(", "\"Loading checkpoint from file at '{}'\"", ".", "format", "(", "flags", "[", "\"resume_from_file\"", "]", ")", ")", "\n", "model", ".", "load_model", "(", "flags", "[", "\"resume_from_file\"", "]", ")", "\n", "start_iteration", "=", "model", ".", "trained_iterations", "\n", "logger", ".", "info", "(", "\"Loaded checkpoint '{}' (iter {})\"", ".", "format", "(", "flags", "[", "\"resume_from_file\"", "]", ",", "start_iteration", ")", ")", "\n", "output_file_name", "=", "\"_\"", ".", "join", "(", "[", "split", ",", "flags", "[", "\"output_file_name\"", "]", "]", ")", "\n", "output_file_path", "=", "os", ".", "path", ".", "join", "(", "flags", "[", "\"output_directory\"", "]", ",", "output_file_name", ")", "\n", "output_file", "=", "predict_and_save", "(", "dataset", "=", "test_set", ",", "model", "=", "model", ",", "output_file_path", "=", "output_file_path", ",", "**", "flags", ")", "\n", "logger", ".", "info", "(", "\"Saved predictions to {}\"", ".", "format", "(", "output_file", ")", ")", "\n", "", "", "elif", "flags", "[", "\"mode\"", "]", "==", "\"predict\"", ":", "\n", "        ", "raise", "NotImplementedError", "(", ")", "\n", "", "else", ":", "\n", "        ", "raise", "ValueError", "(", "\"Wrong value for parameters --mode ({}).\"", ".", "format", "(", "flags", "[", "\"mode\"", "]", ")", ")", "\n", "\n", "\n", "", "", "if", "__name__", "==", "\"__main__\"", ":", "\n", "    ", "input_flags", "=", "vars", "(", "parser", ".", "parse_args", "(", ")", ")", "\n", "main", "(", "flags", "=", "input_flags", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.topo_sort": [[12, 29], ["list", "list", "len", "list.remove", "out.append", "len", "any"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["    ", "\"\"\"\n    Create a sequence mask that masks out all indices larger than some sequence length as defined by\n    sequence_lengths entries.\n\n    :param sequence_lengths: [batch_size] sequence lengths per example in batch\n    :param max_len: int defining the maximum sequence length in the batch\n    :return: [batch_size, max_len] boolean mask\n    \"\"\"", "\n", "if", "max_len", "is", "None", ":", "\n", "        ", "max_len", "=", "sequence_lengths", ".", "data", ".", "max", "(", ")", "\n", "", "batch_size", "=", "sequence_lengths", ".", "size", "(", "0", ")", "\n", "sequence_range", "=", "torch", ".", "arange", "(", "0", ",", "max_len", ")", ".", "long", "(", ")", ".", "to", "(", "device", "=", "device", ")", "\n", "\n", "# [batch_size, max_len]", "\n", "sequence_range_expand", "=", "sequence_range", ".", "unsqueeze", "(", "0", ")", ".", "expand", "(", "batch_size", ",", "max_len", ")", "\n", "\n", "# [batch_size, max_len]", "\n", "seq_length_expand", "=", "(", "sequence_lengths", ".", "unsqueeze", "(", "1", ")", ".", "expand_as", "(", "sequence_range_expand", ")", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.random_weights": [[31, 33], ["numpy.random.random"], "function", ["None"], ["# [batch_size, max_len](boolean array of which elements to include)", "\n", "return", "sequence_range_expand", "<", "seq_length_expand", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.accept_weights": [[35, 37], ["numpy.ones"], "function", ["None"], ["", "def", "log_parameters", "(", "model", ":", "torch", ".", "nn", ".", "Module", ")", "->", "{", "}", ":", "\n", "    ", "model_parameters", "=", "filter", "(", "lambda", "p", ":", "p", ".", "requires_grad", ",", "model", ".", "parameters", "(", ")", ")", "\n", "n_params", "=", "sum", "(", "[", "np", ".", "prod", "(", "p", ".", "size", "(", ")", ")", "for", "p", "in", "model_parameters", "]", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.plan_step": [[39, 49], ["None"], "function", ["None"], ["for", "name", ",", "p", "in", "model", ".", "named_parameters", "(", ")", ":", "\n", "        ", "if", "p", ".", "requires_grad", ":", "\n", "            ", "logger", ".", "info", "(", "\"%s : %s\"", "%", "(", "name", ",", "list", "(", "p", ".", "size", "(", ")", ")", ")", ")", "\n", "\n", "\n", "", "", "", "def", "sequence_accuracy", "(", "prediction", ":", "List", "[", "int", "]", ",", "target", ":", "List", "[", "int", "]", ")", "->", "float", ":", "\n", "    ", "correct", "=", "0", "\n", "total", "=", "0", "\n", "prediction", "=", "prediction", ".", "copy", "(", ")", "\n", "target", "=", "target", ".", "copy", "(", ")", "\n", "if", "len", "(", "prediction", ")", "<", "len", "(", "target", ")", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.one_hot": [[51, 55], ["numpy.zeros"], "function", ["None"], ["prediction", ".", "extend", "(", "[", "0", "]", "*", "difference", ")", "\n", "", "if", "len", "(", "target", ")", "<", "len", "(", "prediction", ")", ":", "\n", "        ", "difference", "=", "len", "(", "prediction", ")", "-", "len", "(", "target", ")", "\n", "target", ".", "extend", "(", "[", "-", "1", "]", "*", "difference", ")", "\n", "", "for", "i", ",", "target_int", "in", "enumerate", "(", "target", ")", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.generate_possible_object_names": [[57, 61], ["None"], "function", ["None"], ["            ", "break", "\n", "", "prediction_int", "=", "prediction", "[", "i", "]", "\n", "if", "prediction_int", "==", "target_int", ":", "\n", "            ", "correct", "+=", "1", "\n", "", "total", "+=", "1", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.save_counter": [[63, 67], ["file.write", "counter.items", "file.write"], "function", ["None"], ["        ", "return", "0.", "\n", "", "return", "(", "correct", "/", "total", ")", "*", "100", "\n", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.bar_plot": [[69, 90], ["list", "list.sort", "numpy.arange", "matplotlib.bar", "matplotlib.gcf().subplots_adjust", "matplotlib.xticks", "matplotlib.ylabel", "matplotlib.title", "matplotlib.savefig", "matplotlib.close", "values.items", "len", "len", "len", "len", "matplotlib.gcf"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.close"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.grouped_bar_plot": [[92, 122], ["list", "numpy.arange", "matplotlib.subplots", "ax.bar", "ax.bar", "matplotlib.gcf().subplots_adjust", "matplotlib.xticks", "matplotlib.ylabel", "matplotlib.title", "ax.legend", "matplotlib.savefig", "matplotlib.close", "values.items", "list.sort", "len", "len", "len", "len", "len", "len", "matplotlib.gcf"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.close"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.numpy_array_to_image": [[124, 126], ["matplotlib.imsave"], "function", ["None"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.helpers.image_to_numpy_array": [[128, 131], ["cv2.imread", "numpy.flip"], "function", ["None"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.__init__": [[65, 73], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "value", ":", "Symbol", ")", ":", "\n", "        ", "self", ".", "_value", "=", "value", "\n", "self", ".", "_next", "=", "None", "\n", "self", ".", "_previous", "=", "None", "\n", "\n", "# The replaced property keeps track of whether a node", "\n", "# has just been replaced or added by a rule.", "\n", "self", ".", "_replaced", "=", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set": [[74, 76], ["None"], "methods", ["None"], ["", "def", "set", "(", "self", ",", "value", ":", "Symbol", ")", ":", "\n", "        ", "self", ".", "_value", "=", "value", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_replaced": [[77, 79], ["None"], "methods", ["None"], ["", "def", "set_replaced", "(", "self", ")", ":", "\n", "        ", "self", ".", "_replaced", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.unset_replaced": [[80, 82], ["None"], "methods", ["None"], ["", "def", "unset_replaced", "(", "self", ")", ":", "\n", "        ", "self", ".", "_replaced", "=", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.is_replaced": [[83, 85], ["None"], "methods", ["None"], ["", "def", "is_replaced", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_replaced", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get": [[86, 88], ["None"], "methods", ["None"], ["", "def", "get", "(", "self", ")", "->", "Symbol", ":", "\n", "        ", "return", "self", ".", "_value", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.is_none": [[89, 91], ["None"], "methods", ["None"], ["", "def", "is_none", "(", "self", ")", "->", "bool", ":", "\n", "        ", "return", "not", "self", ".", "_value", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_next": [[92, 94], ["None"], "methods", ["None"], ["", "def", "set_next", "(", "self", ",", "next_node", ":", "\"Node\"", ")", ":", "\n", "        ", "self", ".", "_next", "=", "next_node", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_previous": [[95, 97], ["None"], "methods", ["None"], ["", "def", "set_previous", "(", "self", ",", "previous_node", ":", "\"Node\"", ")", ":", "\n", "        ", "self", ".", "_previous", "=", "previous_node", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_next": [[98, 100], ["None"], "methods", ["None"], ["", "def", "get_next", "(", "self", ")", "->", "\"Node\"", ":", "\n", "        ", "return", "self", ".", "_next", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_previous": [[101, 103], ["None"], "methods", ["None"], ["", "def", "get_previous", "(", "self", ")", "->", "\"Node\"", ":", "\n", "        ", "return", "self", ".", "_previous", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.__init__": [[108, 113], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "_sequence_start", "=", "None", "\n", "self", ".", "_sequence_end", "=", "None", "\n", "self", ".", "_sequence_size", "=", "0", "\n", "self", ".", "_current_node_ptr", "=", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append": [[114, 124], ["len", "dsl.Node", "dsl.Node", "dsl.Node.set_previous", "dsl.Sequence._sequence_end.set_next"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_previous", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_next"], ["", "def", "append", "(", "self", ",", "symbol", ":", "Union", "[", "Nonterminal", ",", "Terminal", "]", ")", ":", "\n", "        ", "if", "len", "(", "self", ")", "==", "0", ":", "\n", "            ", "self", ".", "_sequence_start", "=", "Node", "(", "value", "=", "symbol", ")", "\n", "self", ".", "_sequence_end", "=", "self", ".", "_sequence_start", "\n", "", "else", ":", "\n", "            ", "next_node", "=", "Node", "(", "value", "=", "symbol", ")", "\n", "next_node", ".", "set_previous", "(", "self", ".", "_sequence_end", ")", "\n", "self", ".", "_sequence_end", ".", "set_next", "(", "next_node", ")", "\n", "self", ".", "_sequence_end", "=", "next_node", "\n", "", "self", ".", "_sequence_size", "+=", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend": [[125, 128], ["dsl.Sequence.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "extend", "(", "self", ",", "symbols", ":", "List", "[", "Union", "[", "Nonterminal", ",", "Terminal", "]", "]", ")", ":", "\n", "        ", "for", "symbol", "in", "symbols", ":", "\n", "            ", "self", ".", "append", "(", "symbol", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.unset_replaced": [[129, 135], ["current_node.get_next.get_next.unset_replaced", "current_node.get_next.get_next.get_next"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.unset_replaced", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_next"], ["", "", "def", "unset_replaced", "(", "self", ")", ":", "\n", "        ", "\"\"\"Loop over the entire sequence and set every node to .is_replaced = False\"\"\"", "\n", "current_node", "=", "self", ".", "_sequence_start", "\n", "while", "current_node", ":", "\n", "            ", "current_node", ".", "unset_replaced", "(", ")", "\n", "current_node", "=", "current_node", ".", "get_next", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate": [[136, 143], ["current_node.get_next.get_next.get_next"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_next"], ["", "", "def", "iterate", "(", "self", ")", ":", "\n", "        ", "\"\"\"Loop over the linked list from start to finish.\"\"\"", "\n", "current_node", "=", "self", ".", "_sequence_start", "\n", "while", "current_node", ":", "\n", "            ", "node", "=", "current_node", "\n", "current_node", "=", "current_node", ".", "get_next", "(", ")", "\n", "yield", "node", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.replace_node": [[144, 163], ["dsl.Node", "dsl.Node.set_replaced", "current_node.get_previous", "current_node.get_next", "dsl.Node.set_previous", "dsl.Node.set_next", "current_node.get_previous.set_next", "current_node.get_next.set_previous"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_replaced", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_previous", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_next", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_previous", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_next", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_next", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_previous"], ["", "", "def", "replace_node", "(", "self", ",", "current_node", ":", "Node", ",", "\n", "replace_with", ":", "Symbol", ")", "->", "Node", ":", "\n", "        ", "\"\"\"Replaces the `current_node` with `replace_with` in the LL\n        returns the one that follows it.\"\"\"", "\n", "new_node", "=", "Node", "(", "value", "=", "replace_with", ")", "\n", "new_node", ".", "set_replaced", "(", ")", "\n", "previous_node", "=", "current_node", ".", "get_previous", "(", ")", "\n", "next_node", "=", "current_node", ".", "get_next", "(", ")", "\n", "new_node", ".", "set_previous", "(", "previous_node", ")", "\n", "new_node", ".", "set_next", "(", "next_node", ")", "\n", "if", "current_node", "==", "self", ".", "_sequence_start", ":", "\n", "            ", "self", ".", "_sequence_start", "=", "new_node", "\n", "", "if", "current_node", "==", "self", ".", "_sequence_end", ":", "\n", "            ", "self", ".", "_sequence_end", "=", "new_node", "\n", "", "if", "previous_node", ":", "\n", "            ", "previous_node", ".", "set_next", "(", "new_node", ")", "\n", "", "if", "next_node", ":", "\n", "            ", "next_node", ".", "set_previous", "(", "new_node", ")", "\n", "", "return", "next_node", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.delete_node": [[164, 184], ["current_node.get_previous", "current_node.get_next", "current_node.get_next.set_previous", "current_node.get_previous.set_next", "current_node.get_previous.set_next", "current_node.get_next.set_previous"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_previous", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_next", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_previous", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_next", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_next", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_previous"], ["", "def", "delete_node", "(", "self", ",", "current_node", ":", "Node", ")", ":", "\n", "        ", "\"\"\"Deletes the current node and returns the one that follows it in the LL.\"\"\"", "\n", "previous_node", "=", "current_node", ".", "get_previous", "(", ")", "\n", "next_node", "=", "current_node", ".", "get_next", "(", ")", "\n", "if", "current_node", "==", "self", ".", "_sequence_start", ":", "\n", "# Current node is sequence start", "\n", "            ", "if", "next_node", ":", "\n", "                ", "self", ".", "_sequence_start", "=", "next_node", "\n", "next_node", ".", "set_previous", "(", "None", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "_sequence_start", "=", "None", "\n", "self", ".", "_sequence_end", "=", "None", "\n", "self", ".", "_sequence_size", "=", "0", "\n", "", "", "elif", "current_node", "==", "self", ".", "_sequence_end", ":", "\n", "            ", "previous_node", ".", "set_next", "(", "None", ")", "\n", "self", ".", "_sequence_end", "=", "previous_node", "\n", "", "else", ":", "\n", "            ", "previous_node", ".", "set_next", "(", "next_node", ")", "\n", "next_node", ".", "set_previous", "(", "previous_node", ")", "\n", "", "return", "next_node", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.insert_node": [[185, 210], ["dsl.Node", "dsl.Node.set_replaced", "dsl.Node.set_next", "dsl.Node.set_previous", "current_node.get_previous", "current_node.get_previous.set_next", "current_node.set_previous"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_replaced", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_next", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_previous", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_previous", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_next", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.set_previous"], ["", "def", "insert_node", "(", "self", ",", "current_node", ":", "Node", ",", "\n", "insert_node", ":", "Symbol", ")", ":", "\n", "        ", "\"\"\"Inserts `insert_node` before `current_node` in the LL, returns\n        current_node.\"\"\"", "\n", "new_node", "=", "Node", "(", "value", "=", "insert_node", ")", "\n", "new_node", ".", "set_replaced", "(", ")", "\n", "\n", "# If current_node is None, the previous node is the last.", "\n", "if", "not", "current_node", ":", "\n", "            ", "previous_node", "=", "self", ".", "_sequence_end", "\n", "", "else", ":", "\n", "            ", "previous_node", "=", "current_node", ".", "get_previous", "(", ")", "\n", "\n", "", "if", "current_node", "!=", "self", ".", "_sequence_start", ":", "\n", "            ", "previous_node", ".", "set_next", "(", "new_node", ")", "\n", "", "new_node", ".", "set_next", "(", "current_node", ")", "\n", "new_node", ".", "set_previous", "(", "previous_node", ")", "\n", "if", "not", "current_node", ":", "\n", "            ", "self", ".", "_sequence_end", "=", "new_node", "\n", "", "else", ":", "\n", "            ", "current_node", ".", "set_previous", "(", "new_node", ")", "\n", "", "if", "current_node", "==", "self", ".", "_sequence_start", ":", "\n", "            ", "self", ".", "_sequence_start", "=", "new_node", "\n", "", "self", ".", "_sequence_size", "+=", "1", "\n", "return", "current_node", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.replace": [[211, 232], ["enumerate", "rhs.iterate", "dsl.Sequence.replace_node", "dsl.Sequence.insert_node", "symbol_node.get", "symbol_node.get"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.replace_node", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.insert_node", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "def", "replace", "(", "self", ",", "current_symbol_ptr", ":", "Node", ",", "lhs_length", ":", "int", ",", "rhs", ":", "\"Sequence\"", ")", ":", "\n", "        ", "\"\"\"\n        Replace a part of the LL starting at `current_symbol_ptr`\n        with `replace_with`. If the lhs was equally long as the\n        values to replace it with, replace everything, if the RHS\n        is longer, also insert.\n\n        :return: the next node in the LL\n        e.g., if the sequence is W W A TL, we call replace with\n        `current_symbol_ptr` A and `rhs` A W, we return the final\n        node TL and the sequence is now W W A W TL.\n        TODO: what if rhs < lhs.\n        \"\"\"", "\n", "for", "i", ",", "symbol_node", "in", "enumerate", "(", "rhs", ".", "iterate", "(", ")", ")", ":", "\n", "            ", "if", "i", "<", "lhs_length", ":", "\n", "                ", "current_symbol_ptr", "=", "self", ".", "replace_node", "(", "current_symbol_ptr", ",", "\n", "symbol_node", ".", "get", "(", ")", ")", "\n", "", "else", ":", "\n", "                ", "current_symbol_ptr", "=", "self", ".", "insert_node", "(", "current_symbol_ptr", ",", "\n", "symbol_node", ".", "get", "(", ")", ")", "\n", "", "", "return", "current_symbol_ptr", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_start": [[233, 235], ["None"], "methods", ["None"], ["", "def", "get_start", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_sequence_start", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_end": [[236, 238], ["None"], "methods", ["None"], ["", "def", "get_end", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_sequence_end", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_actions": [[239, 246], ["enumerate", "dsl.Sequence.iterate", "actions.append", "node.get"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "def", "get_actions", "(", "self", ")", "->", "List", "[", "str", "]", ":", "\n", "        ", "\"\"\"Convert the sequence to a list of actions.\"\"\"", "\n", "actions", "=", "[", "]", "\n", "for", "i", ",", "node", "in", "enumerate", "(", "self", ".", "iterate", "(", ")", ")", ":", "\n", "            ", "action", "=", "node", ".", "get", "(", ")", ".", "name", "\n", "actions", ".", "append", "(", "action", ")", "\n", "", "return", "actions", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_gscan_actions": [[247, 258], ["enumerate", "dsl.Sequence.iterate", "node.get().name.lower", "gscan_actions.append", "node.get"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "def", "get_gscan_actions", "(", "self", ")", "->", "List", "[", "str", "]", ":", "\n", "        ", "\"\"\"Convert the symbol names to the commands in gSCAN.\"\"\"", "\n", "gscan_actions", "=", "[", "]", "\n", "for", "i", ",", "node", "in", "enumerate", "(", "self", ".", "iterate", "(", ")", ")", ":", "\n", "            ", "action", "=", "node", ".", "get", "(", ")", ".", "name", ".", "lower", "(", ")", "\n", "if", "action", "==", "\"tl\"", ":", "\n", "                ", "action", "=", "\"turn left\"", "\n", "", "elif", "action", "==", "\"tr\"", ":", "\n", "                ", "action", "=", "\"turn right\"", "\n", "", "gscan_actions", ".", "append", "(", "action", ")", "\n", "", "return", "gscan_actions", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.__len__": [[259, 261], ["None"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_sequence_size", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.__eq__": [[262, 270], ["zip", "len", "len", "dsl.Sequence.iterate", "sequence.iterate"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate"], ["", "def", "__eq__", "(", "self", ",", "sequence", ":", "\"Sequence\"", ")", ":", "\n", "        ", "\"\"\"Check whether the `sequence` passed is equivalent.\"\"\"", "\n", "if", "len", "(", "self", ")", "!=", "len", "(", "sequence", ")", ":", "\n", "            ", "return", "False", "\n", "", "for", "symbol_1", ",", "symbol_2", "in", "zip", "(", "self", ".", "iterate", "(", ")", ",", "sequence", ".", "iterate", "(", ")", ")", ":", "\n", "            ", "if", "symbol_1", "!=", "symbol_2", ":", "\n", "                ", "return", "False", "\n", "", "", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.__repr__": [[271, 275], ["s.get", "dsl.Sequence.iterate", "s.get"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "output_str", "=", "\" \"", ".", "join", "(", "s", ".", "get", "(", ")", ".", "name", "for", "s", "in", "self", ".", "iterate", "(", ")", "\n", "if", "s", ".", "get", "(", ")", ".", "name", "!=", "\"EMPTY\"", ")", "\n", "return", "output_str", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Lhs.__init__": [[285, 293], ["dsl.Sequence.__init__", "dsl.Lhs.extend", "dsl.Sequence", "dsl.Lhs._lhs_no_conditional.extend"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend"], ["def", "__init__", "(", "self", ",", "symbols", ":", "List", "[", "Symbol", "]", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "extend", "(", "symbols", ")", "\n", "self", ".", "_lhs_no_conditional", "=", "Sequence", "(", ")", "\n", "self", ".", "_lhs_no_conditional", ".", "extend", "(", "symbols", ")", "\n", "self", ".", "_left_conditional", "=", "None", "\n", "self", ".", "_right_conditional", "=", "None", "\n", "self", ".", "_full_lhs", "=", "self", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Lhs.set_conditional": [[294, 306], ["dsl.Sequence", "dsl.Lhs._left_conditional.extend", "dsl.Sequence", "dsl.Lhs._right_conditional.extend", "dsl.Lhs.get_start", "dsl.Lhs.insert_node", "dsl.Lhs.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_start", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.insert_node", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "set_conditional", "(", "self", ",", "left_conditional", ":", "List", "[", "Symbol", "]", ",", "\n", "right_conditional", ":", "List", "[", "Symbol", "]", ")", ":", "\n", "        ", "\"\"\"Initializes the conditionals.\"\"\"", "\n", "self", ".", "_left_conditional", "=", "Sequence", "(", ")", "\n", "self", ".", "_left_conditional", ".", "extend", "(", "left_conditional", ")", "\n", "self", ".", "_right_conditional", "=", "Sequence", "(", ")", "\n", "self", ".", "_right_conditional", ".", "extend", "(", "right_conditional", ")", "\n", "sequence_start", "=", "self", ".", "get_start", "(", ")", "\n", "for", "symbol", "in", "left_conditional", ":", "\n", "            ", "self", ".", "insert_node", "(", "sequence_start", ",", "symbol", ")", "\n", "", "for", "symbol", "in", "right_conditional", ":", "\n", "            ", "self", ".", "append", "(", "symbol", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Lhs.num_left_conditional": [[307, 313], ["len"], "methods", ["None"], ["", "", "def", "num_left_conditional", "(", "self", ")", ":", "\n", "        ", "\"\"\"Number of symbols in the left conditional.\"\"\"", "\n", "if", "self", ".", "_left_conditional", ":", "\n", "            ", "return", "len", "(", "self", ".", "_left_conditional", ")", "\n", "", "else", ":", "\n", "            ", "return", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Lhs.num_right_conditional": [[314, 320], ["len"], "methods", ["None"], ["", "", "def", "num_right_conditional", "(", "self", ")", ":", "\n", "        ", "\"\"\"Number of symbols in the right conditional.\"\"\"", "\n", "if", "self", ".", "_right_conditional", ":", "\n", "            ", "return", "len", "(", "self", ".", "_right_conditional", ")", "\n", "", "else", ":", "\n", "            ", "return", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Lhs.__repr__": [[321, 335], ["s.get", "dsl.Lhs._lhs_no_conditional.iterate", "s.get", "dsl.Lhs._left_conditional.iterate", "s.get", "dsl.Lhs._right_conditional.iterate"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate"], ["", "", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "left_conditional_str", "=", "\"\"", "\n", "if", "self", ".", "_left_conditional", ":", "\n", "            ", "left_conditional", "=", "[", "s", ".", "get", "(", ")", ".", "name", "for", "s", "in", "self", ".", "_left_conditional", ".", "iterate", "(", ")", "]", "\n", "left_conditional_str", "=", "\"{%s}\"", "%", "\" \"", ".", "join", "(", "left_conditional", ")", "\n", "", "right_conditional_str", "=", "\"\"", "\n", "if", "self", ".", "_right_conditional", ":", "\n", "            ", "right_conditional", "=", "[", "s", ".", "get", "(", ")", ".", "name", "for", "s", "in", "self", ".", "_right_conditional", ".", "iterate", "(", ")", "]", "\n", "right_conditional_str", "=", "\"{%s}\"", "%", "\" \"", ".", "join", "(", "right_conditional", ")", "\n", "", "middle_lhs", "=", "[", "s", ".", "get", "(", ")", ".", "name", "for", "s", "in", "self", ".", "_lhs_no_conditional", ".", "iterate", "(", ")", "]", "\n", "lhs_str", "=", "\"%s%s%s\"", "%", "(", "left_conditional_str", ",", "\n", "\" \"", ".", "join", "(", "middle_lhs", ")", ",", "\n", "right_conditional_str", ")", "\n", "return", "lhs_str", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Rhs.__init__": [[343, 347], ["dsl.Sequence.__init__", "dsl.Rhs.extend"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend"], ["def", "__init__", "(", "self", ",", "symbols", ":", "List", "[", "Union", "[", "Nonterminal", ",", "Terminal", "]", "]", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "extend", "(", "symbols", ")", "\n", "self", ".", "_rhs_list", "=", "symbols", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Rhs.__repr__": [[348, 350], ["s.get", "dsl.Rhs.iterate"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "\" \"", ".", "join", "(", "s", ".", "get", "(", ")", ".", "name", "for", "s", "in", "self", ".", "iterate", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.__init__": [[360, 364], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "lhs", ":", "Lhs", ",", "rhs", ":", "Rhs", ")", ":", "\n", "        ", "self", ".", "lhs", "=", "lhs", "\n", "self", ".", "rhs", "=", "rhs", "\n", "self", ".", "recursive", "=", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive": [[365, 367], ["None"], "methods", ["None"], ["", "def", "set_recursive", "(", "self", ")", ":", "\n", "        ", "self", ".", "recursive", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LRule.__init__": [[375, 377], ["dsl.LSystemRule.__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "lhs", ":", "Lhs", ",", "rhs", ":", "Rhs", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "lhs", "=", "lhs", ",", "rhs", "=", "rhs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LRule.__repr__": [[378, 382], ["s.get", "dsl.LRule.lhs.iterate", "s.get", "dsl.LRule.rhs.iterate"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "lhs_str", "=", "\" \"", ".", "join", "(", "s", ".", "get", "(", ")", ".", "name", "for", "s", "in", "self", ".", "lhs", ".", "iterate", "(", ")", ")", "\n", "rhs_str", "=", "\" \"", ".", "join", "(", "s", ".", "get", "(", ")", ".", "name", "for", "s", "in", "self", ".", "rhs", ".", "iterate", "(", ")", ")", "\n", "return", "\"%s -> %s\"", "%", "(", "lhs_str", ",", "rhs_str", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.CLRule.__init__": [[394, 401], ["dsl.LSystemRule.__init__", "dsl.CLRule.lhs.set_conditional"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Lhs.set_conditional"], ["def", "__init__", "(", "self", ",", "lhs", ":", "Lhs", ",", "rhs", ":", "Rhs", ",", "\n", "left_condition", ":", "List", "[", "Symbol", "]", ",", "\n", "right_condition", ":", "List", "[", "Symbol", "]", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "lhs", "=", "lhs", ",", "rhs", "=", "rhs", ")", "\n", "self", ".", "lhs", ".", "set_conditional", "(", "left_condition", ",", "right_condition", ")", "\n", "self", ".", "_left_conditional", "=", "left_condition", "\n", "self", ".", "_right_conditional", "=", "right_condition", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.CLRule.__repr__": [[402, 406], ["str", "str"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "lhs_str", "=", "str", "(", "self", ".", "lhs", ")", "\n", "rhs_str", "=", "str", "(", "self", ".", "rhs", ")", "\n", "return", "\"%s -> %s\"", "%", "(", "lhs_str", ",", "rhs_str", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.__init__": [[415, 461], ["dsl.MetaGrammar.add_rules"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.add_rules"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "rules", "=", "{", "\n", "\"ACTION\"", ":", "{", "}", ",", "\n", "\"Walk\"", ":", "{", "}", ",", "\n", "\"{ACTION}ACTION ACTION{ACTION}\"", ":", "{", "}", ",", "\n", "\"Push\"", ":", "{", "}", ",", "\n", "\"Pull\"", ":", "{", "}", ",", "\n", "\"East\"", ":", "{", "}", ",", "\n", "\"North\"", ":", "{", "}", ",", "\n", "\"South\"", ":", "{", "}", ",", "\n", "\"West\"", ":", "{", "}", ",", "\n", "\"East South\"", ":", "{", "}", ",", "\n", "\"East North\"", ":", "{", "}", ",", "\n", "\"West South\"", ":", "{", "}", ",", "\n", "\"West North\"", ":", "{", "}", ",", "\n", "\"South East\"", ":", "{", "}", ",", "\n", "\"North East\"", ":", "{", "}", ",", "\n", "\"South West\"", ":", "{", "}", ",", "\n", "\"North West\"", ":", "{", "}", "\n", "}", "\n", "# LHS of rules like while zigzagging", "\n", "self", ".", "_movement_rewrite_rules", "=", "{", "}", "\n", "\n", "# LHS of rules like while zigzagging", "\n", "self", ".", "_movement_rules", "=", "{", "}", "\n", "\n", "# LHS of rules like while spinning", "\n", "self", ".", "_nonmovement_direction_rules", "=", "{", "}", "\n", "\n", "# LHS of rules like cautiously, hesitantly", "\n", "self", ".", "_nonmovement_first_person_rules", "=", "{", "}", "\n", "\n", "self", ".", "add_rules", "(", ")", "\n", "\n", "self", ".", "_symbols_dict", "=", "{", "\n", "\"Walk\"", ":", "Walk", ",", "\n", "\"Tl\"", ":", "Tl", ",", "\n", "\"Tr\"", ":", "Tr", ",", "\n", "\"ACTION\"", ":", "ACTION", ",", "\n", "\"Push\"", ":", "Push", ",", "\n", "\"Pull\"", ":", "Pull", ",", "\n", "\"Stay\"", ":", "Stay", ",", "\n", "\"East\"", ":", "East", ",", "\n", "\"South\"", ":", "South", ",", "\n", "\"West\"", ":", "West", ",", "\n", "\"North\"", ":", "North", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_symbols": [[463, 468], ["dsl.MetaGrammar._symbols_dict.get"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "def", "get_symbols", "(", "self", ",", "symbol_str", ":", "str", ")", ":", "\n", "        ", "if", "not", "self", ".", "_symbols_dict", ".", "get", "(", "symbol_str", ")", ":", "\n", "            ", "return", "None", "\n", "", "else", ":", "\n", "            ", "return", "self", ".", "_symbols_dict", "[", "symbol_str", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_movement_rewrite_rules": [[469, 471], ["dsl.MetaGrammar._movement_rewrite_rules.copy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "", "def", "get_movement_rewrite_rules", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_movement_rewrite_rules", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_movement_rules": [[472, 474], ["dsl.MetaGrammar._movement_rules.copy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "get_movement_rules", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_movement_rules", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_nonmovement_direction_rules": [[475, 477], ["dsl.MetaGrammar._nonmovement_direction_rules.copy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "get_nonmovement_direction_rules", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_nonmovement_direction_rules", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_nonmovement_first_person_rules": [[478, 480], ["dsl.MetaGrammar._nonmovement_first_person_rules.copy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "get_nonmovement_first_person_rules", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_nonmovement_first_person_rules", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.has_rule": [[481, 486], ["dsl.MetaGrammar.rules.get", "dsl.MetaGrammar.rules[].get"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "def", "has_rule", "(", "self", ",", "lhs_str", ":", "str", ",", "rhs_str", ":", "str", ")", ":", "\n", "        ", "if", "self", ".", "rules", ".", "get", "(", "lhs_str", ")", ":", "\n", "            ", "if", "self", ".", "rules", "[", "lhs_str", "]", ".", "get", "(", "rhs_str", ")", ":", "\n", "                ", "return", "True", "\n", "", "", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule": [[487, 492], ["dsl.MetaGrammar.rules.get", "ValueError", "dsl.MetaGrammar.rules[].get", "copy.deepcopy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "def", "get_rule", "(", "self", ",", "lhs_str", ":", "str", ",", "rhs_str", ":", "str", ")", ":", "\n", "        ", "if", "self", ".", "rules", ".", "get", "(", "lhs_str", ")", ":", "\n", "            ", "if", "self", ".", "rules", "[", "lhs_str", "]", ".", "get", "(", "rhs_str", ")", ":", "\n", "                ", "return", "deepcopy", "(", "self", ".", "rules", "[", "lhs_str", "]", "[", "rhs_str", "]", ")", "\n", "", "", "raise", "ValueError", "(", "\"Rule doesn't exist.\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.add_rule": [[493, 512], ["dsl.MetaGrammar._movement_rewrite_rules[].append", "dsl.MetaGrammar._movement_rules[].append", "dsl.MetaGrammar._nonmovement_direction_rules[].append", "dsl.MetaGrammar._nonmovement_first_person_rules[].append", "str", "str", "str", "str", "str", "str", "str", "str", "str", "str", "str", "str", "str", "str"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "add_rule", "(", "self", ",", "rule", ",", "movement_rule", "=", "False", ",", "nonmovement_dir_rule", "=", "False", ",", "\n", "nonmovement_fp_rule", "=", "False", ",", "movement_rewrite", "=", "False", ")", ":", "\n", "        ", "self", ".", "rules", "[", "str", "(", "rule", ".", "lhs", ")", "]", "[", "str", "(", "rule", ".", "rhs", ")", "]", "=", "rule", "\n", "if", "movement_rewrite", ":", "\n", "            ", "if", "str", "(", "rule", ".", "lhs", ")", "not", "in", "self", ".", "_movement_rewrite_rules", ":", "\n", "                ", "self", ".", "_movement_rewrite_rules", "[", "(", "str", "(", "rule", ".", "lhs", ")", ")", "]", "=", "[", "]", "\n", "", "self", ".", "_movement_rewrite_rules", "[", "(", "str", "(", "rule", ".", "lhs", ")", ")", "]", ".", "append", "(", "rule", ")", "\n", "", "if", "movement_rule", ":", "\n", "            ", "if", "str", "(", "rule", ".", "lhs", ")", "not", "in", "self", ".", "_movement_rules", ":", "\n", "                ", "self", ".", "_movement_rules", "[", "(", "str", "(", "rule", ".", "lhs", ")", ")", "]", "=", "[", "]", "\n", "", "self", ".", "_movement_rules", "[", "(", "str", "(", "rule", ".", "lhs", ")", ")", "]", ".", "append", "(", "rule", ")", "\n", "", "if", "nonmovement_dir_rule", ":", "\n", "            ", "if", "str", "(", "rule", ".", "lhs", ")", "not", "in", "self", ".", "_nonmovement_direction_rules", ":", "\n", "                ", "self", ".", "_nonmovement_direction_rules", "[", "(", "str", "(", "rule", ".", "lhs", ")", ")", "]", "=", "[", "]", "\n", "", "self", ".", "_nonmovement_direction_rules", "[", "(", "str", "(", "rule", ".", "lhs", ")", ")", "]", ".", "append", "(", "rule", ")", "\n", "", "if", "nonmovement_fp_rule", ":", "\n", "            ", "if", "str", "(", "rule", ".", "lhs", ")", "not", "in", "self", ".", "_nonmovement_first_person_rules", ":", "\n", "                ", "self", ".", "_nonmovement_first_person_rules", "[", "(", "str", "(", "rule", ".", "lhs", ")", ")", "]", "=", "[", "]", "\n", "", "self", ".", "_nonmovement_first_person_rules", "[", "(", "str", "(", "rule", ".", "lhs", ")", ")", "]", ".", "append", "(", "rule", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.add_rules": [[513, 649], ["dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.MetaGrammar.add_rule", "dsl.CLRule", "dsl.MetaGrammar.add_rule", "dsl.CLRule", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.LSystemRule.set_recursive", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.MetaGrammar.add_rule", "dsl.LRule", "dsl.MetaGrammar.add_rule", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs", "dsl.Lhs", "dsl.Rhs"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule"], ["", "", "def", "add_rules", "(", "self", ")", ":", "\n", "        ", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "Walk", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "ACTION", ",", "Walk", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "nonmovement_fp_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "Walk", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "Walk", ",", "ACTION", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "nonmovement_fp_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "ACTION", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "Tl", "]", ")", ")", "\n", "self", ".", "add_rule", "(", "rule", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "ACTION", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "Tr", "]", ")", ")", "\n", "self", ".", "add_rule", "(", "rule", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "ACTION", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "Stay", "]", ")", ")", "\n", "self", ".", "add_rule", "(", "rule", ")", "\n", "rule", "=", "CLRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "ACTION", ",", "ACTION", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "Tl", ",", "Tl", "]", ")", ",", "\n", "left_condition", "=", "[", "ACTION", "]", ",", "\n", "right_condition", "=", "[", "ACTION", "]", ")", "\n", "self", ".", "add_rule", "(", "rule", ")", "\n", "rule", "=", "CLRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "ACTION", ",", "ACTION", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "Tr", ",", "Tr", "]", ")", ",", "\n", "left_condition", "=", "[", "ACTION", "]", ",", "\n", "right_condition", "=", "[", "ACTION", "]", ")", "\n", "self", ".", "add_rule", "(", "rule", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "Push", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "ACTION", ",", "Push", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "nonmovement_dir_rule", "=", "True", ",", "\n", "nonmovement_fp_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "Pull", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "ACTION", ",", "Pull", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "nonmovement_dir_rule", "=", "True", ",", "\n", "nonmovement_fp_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "East", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "ACTION", ",", "East", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "nonmovement_dir_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "North", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "ACTION", ",", "North", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "nonmovement_dir_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "South", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "ACTION", ",", "South", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "nonmovement_dir_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "West", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "ACTION", ",", "West", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "nonmovement_dir_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "East", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "East", ",", "ACTION", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "nonmovement_dir_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "North", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "North", ",", "ACTION", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "nonmovement_dir_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "South", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "South", ",", "ACTION", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "nonmovement_dir_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "West", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "West", ",", "ACTION", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "nonmovement_dir_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "Push", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "Push", ",", "ACTION", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "nonmovement_dir_rule", "=", "True", ",", "\n", "nonmovement_fp_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "Pull", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "Pull", ",", "ACTION", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "nonmovement_dir_rule", "=", "True", ",", "\n", "nonmovement_fp_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "East", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "North", ",", "East", ",", "South", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "movement_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "East", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "South", ",", "East", ",", "North", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "movement_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "North", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "East", ",", "North", ",", "West", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "movement_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "North", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "West", ",", "North", ",", "East", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "movement_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "South", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "East", ",", "South", ",", "West", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "movement_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "South", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "West", ",", "South", ",", "East", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "movement_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "West", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "North", ",", "West", ",", "South", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "movement_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "West", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "South", ",", "West", ",", "North", "]", ")", ")", "\n", "rule", ".", "set_recursive", "(", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "movement_rule", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "East", ",", "South", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "South", ",", "East", "]", ")", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "movement_rewrite", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "East", ",", "North", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "North", ",", "East", "]", ")", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "movement_rewrite", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "West", ",", "North", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "North", ",", "West", "]", ")", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "movement_rewrite", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "West", ",", "South", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "South", ",", "West", "]", ")", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "movement_rewrite", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "North", ",", "East", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "East", ",", "North", "]", ")", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "movement_rewrite", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "North", ",", "West", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "West", ",", "North", "]", ")", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "movement_rewrite", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "South", ",", "East", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "East", ",", "South", "]", ")", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "movement_rewrite", "=", "True", ")", "\n", "rule", "=", "LRule", "(", "lhs", "=", "Lhs", "(", "symbols", "=", "[", "South", ",", "West", "]", ")", ",", "\n", "rhs", "=", "Rhs", "(", "symbols", "=", "[", "West", ",", "South", "]", ")", ")", "\n", "self", ".", "add_rule", "(", "rule", ",", "movement_rewrite", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.__repr__": [[650, 658], ["dsl.MetaGrammar.rules.items", "values.items", "values.values", "str"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "output_str", "=", "\"\"", "\n", "for", "key", ",", "values", "in", "self", ".", "rules", ".", "items", "(", ")", ":", "\n", "            ", "for", "k", ",", "value", "in", "values", ".", "items", "(", ")", ":", "\n", "                ", "output_str", "+=", "str", "(", "value", ")", "+", "'\\n'", "\n", "", "if", "values", ".", "values", "(", ")", ":", "\n", "                ", "output_str", "+=", "'\\n'", "\n", "", "", "return", "output_str", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.__init__": [[673, 682], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "_rewrite_rules", "=", "{", "}", "\n", "self", ".", "_lhs_rule_lengths", "=", "[", "]", "\n", "self", ".", "_terminal_rules", "=", "{", "}", "\n", "self", ".", "_lhs_terminal_lengths", "=", "[", "]", "\n", "self", ".", "_rules_in_order", "=", "[", "]", "\n", "self", ".", "_terminal_rules_in_order", "=", "[", "]", "\n", "self", ".", "_num_total_rules", "=", "0", "\n", "self", ".", "_finished", "=", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.is_empty": [[683, 685], ["None"], "methods", ["None"], ["", "def", "is_empty", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_num_total_rules", "==", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule": [[686, 702], ["str", "len", "ValueError", "lhs_lengths.append", "lhs_lengths.sort", "str"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "add_rule", "(", "self", ",", "rule", ":", "LSystemRule", ",", "terminal_rule", "=", "False", ")", ":", "\n", "        ", "lhs", "=", "str", "(", "rule", ".", "lhs", ")", "\n", "if", "lhs", "in", "self", ".", "_rewrite_rules", "or", "lhs", "in", "self", ".", "_terminal_rules", ":", "\n", "            ", "raise", "ValueError", "(", "\"LHS {} already in L-System.\"", ".", "format", "(", "lhs", ")", ")", "\n", "", "self", ".", "_num_total_rules", "+=", "1", "\n", "lhs_length", "=", "len", "(", "lhs", ")", "\n", "lhs_lengths", "=", "self", ".", "_lhs_rule_lengths", "\n", "rules", "=", "self", ".", "_rewrite_rules", "\n", "if", "terminal_rule", ":", "\n", "            ", "rules", "=", "self", ".", "_terminal_rules", "\n", "lhs_lengths", "=", "self", ".", "_lhs_terminal_lengths", "\n", "", "if", "lhs_length", "not", "in", "rules", ":", "\n", "            ", "rules", "[", "lhs_length", "]", "=", "{", "}", "\n", "lhs_lengths", ".", "append", "(", "lhs_length", ")", "\n", "lhs_lengths", ".", "sort", "(", "reverse", "=", "True", ")", "\n", "", "rules", "[", "lhs_length", "]", "[", "str", "(", "rule", ".", "lhs", ")", "]", "=", "rule", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.nonterminal_rules": [[703, 705], ["dsl.LSystem._rules_in_order.copy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "nonterminal_rules", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_rules_in_order", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.terminal_rules": [[706, 708], ["dsl.LSystem._terminal_rules_in_order.copy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "terminal_rules", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_terminal_rules_in_order", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system": [[709, 717], ["dsl.LSystem._rewrite_rules[].items", "dsl.LSystem._terminal_rules[].items", "dsl.LSystem._rules_in_order.append", "dsl.LSystem._terminal_rules_in_order.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "finish_l_system", "(", "self", ")", ":", "\n", "        ", "for", "lhs_length", "in", "self", ".", "_lhs_rule_lengths", ":", "\n", "            ", "for", "lhs", ",", "rule", "in", "self", ".", "_rewrite_rules", "[", "lhs_length", "]", ".", "items", "(", ")", ":", "\n", "                ", "self", ".", "_rules_in_order", ".", "append", "(", "rule", ")", "\n", "", "", "for", "lhs_length", "in", "self", ".", "_lhs_terminal_lengths", ":", "\n", "            ", "for", "lhs", ",", "rule", "in", "self", ".", "_terminal_rules", "[", "lhs_length", "]", ".", "items", "(", ")", ":", "\n", "                ", "self", ".", "_terminal_rules_in_order", ".", "append", "(", "rule", ")", "\n", "", "", "self", ".", "_finished", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.is_finished": [[718, 724], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "is_finished", "(", "self", ")", ":", "\n", "        ", "if", "self", ".", "_finished", ":", "\n", "            ", "return", "True", "\n", "", "else", ":", "\n", "            ", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.get_rule_repr": [[725, 736], ["str", "isinstance"], "methods", ["None"], ["", "", "def", "get_rule_repr", "(", "self", ",", "rule", ")", ":", "\n", "        ", "rule_repr", "=", "str", "(", "rule", ")", "\n", "if", "isinstance", "(", "rule", ",", "CLRule", ")", ":", "\n", "            ", "rule_repr", "+=", "\",True\"", "\n", "", "else", ":", "\n", "            ", "rule_repr", "+=", "\",False\"", "\n", "", "if", "rule", ".", "recursive", ":", "\n", "            ", "rule_repr", "+=", "\",True\"", "\n", "", "else", ":", "\n", "            ", "rule_repr", "+=", "\",False\"", "\n", "", "return", "rule_repr", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.to_representation": [[737, 750], ["dsl.LSystem.get_rule_repr", "nonterminal_rules_list_str.append", "dsl.LSystem.get_rule_repr", "terminal_rules_list_str.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.get_rule_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.get_rule_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "to_representation", "(", "self", ")", ":", "\n", "        ", "nonterminal_rules_list_str", "=", "[", "]", "\n", "terminal_rules_list_str", "=", "[", "]", "\n", "for", "rule", "in", "self", ".", "_rules_in_order", ":", "\n", "            ", "rule_repr", "=", "self", ".", "get_rule_repr", "(", "rule", ")", "\n", "nonterminal_rules_list_str", ".", "append", "(", "rule_repr", ")", "\n", "", "for", "rule", "in", "self", ".", "_terminal_rules_in_order", ":", "\n", "            ", "rule_repr", "=", "self", ".", "get_rule_repr", "(", "rule", ")", "\n", "terminal_rules_list_str", ".", "append", "(", "rule_repr", ")", "\n", "\n", "", "return", "{", "\n", "\"nonterminal_rules\"", ":", "';'", ".", "join", "(", "nonterminal_rules_list_str", ")", ",", "\n", "\"terminal_rules\"", ":", "';'", ".", "join", "(", "terminal_rules_list_str", ")", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.convert_rule_side": [[752, 760], ["rule_str.split", "enumerate", "meta_grammar.get_symbols", "ValueError"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_symbols"], ["", "def", "convert_rule_side", "(", "self", ",", "rule_str", ":", "str", ",", "meta_grammar", ":", "MetaGrammar", ")", "->", "List", "[", "Symbol", "]", ":", "\n", "        ", "symbols", "=", "rule_str", ".", "split", "(", ")", "\n", "for", "i", ",", "symbol_str", "in", "enumerate", "(", "symbols", ")", ":", "\n", "            ", "symbol", "=", "meta_grammar", ".", "get_symbols", "(", "symbol_str", ")", "\n", "if", "symbol", "==", "None", ":", "\n", "                ", "raise", "ValueError", "(", "\"Unknown symbol in LSystem.from_representation: %s\"", "%", "symbol_str", ")", "\n", "", "symbols", "[", "i", "]", "=", "symbol", "\n", "", "return", "symbols", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule_repr": [[761, 778], ["rule_repr.split", "rule_str.split", "dsl.LSystem.add_rule", "meta_grammar.has_rule", "rule_class", "meta_grammar.get_rule", "meta_grammar.get_rule.set_recursive", "dsl.Lhs", "dsl.Rhs", "dsl.LSystem.convert_rule_side", "dsl.LSystem.convert_rule_side"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.has_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystemRule.set_recursive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.convert_rule_side", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.convert_rule_side"], ["", "def", "add_rule_repr", "(", "self", ",", "rule_repr", ":", "str", ",", "meta_grammar", ":", "MetaGrammar", ",", "\n", "terminal_rule", ":", "bool", ")", ":", "\n", "        ", "rule_str", ",", "is_conditional", ",", "is_recursive", "=", "rule_repr", ".", "split", "(", "\",\"", ")", "\n", "lhs_str", ",", "rhs_str", "=", "rule_str", ".", "split", "(", "\" -> \"", ")", "\n", "if", "not", "meta_grammar", ".", "has_rule", "(", "lhs_str", ",", "rhs_str", ")", ":", "\n", "            ", "if", "is_conditional", "==", "\"True\"", ":", "\n", "                ", "rule_class", "=", "CLRule", "\n", "", "else", ":", "\n", "                ", "rule_class", "=", "LRule", "\n", "", "rule", "=", "rule_class", "(", "lhs", "=", "Lhs", "(", "self", ".", "convert_rule_side", "(", "lhs_str", ",", "meta_grammar", ")", ")", ",", "\n", "rhs", "=", "Rhs", "(", "self", ".", "convert_rule_side", "(", "rhs_str", ",", "meta_grammar", ")", ")", ")", "\n", "if", "is_recursive", "==", "\"True\"", ":", "\n", "                ", "rule", ".", "set_recursive", "(", ")", "\n", "", "", "else", ":", "\n", "            ", "rule", "=", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "lhs_str", ",", "\n", "rhs_str", "=", "rhs_str", ")", "\n", "", "self", ".", "add_rule", "(", "rule", ",", "terminal_rule", "=", "terminal_rule", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.from_representation": [[779, 792], ["representation[].split", "representation[].split", "cls", "cls.finish_l_system", "cls.add_rule_repr", "cls.add_rule_repr"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule_repr"], ["", "@", "classmethod", "\n", "def", "from_representation", "(", "cls", ",", "representation", ":", "Dict", "[", "str", ",", "str", "]", ",", "meta_grammar", ":", "MetaGrammar", ")", ":", "\n", "        ", "nonterminal_rules", "=", "representation", "[", "\"nonterminal_rules\"", "]", ".", "split", "(", "\";\"", ")", "\n", "terminal_rules", "=", "representation", "[", "\"terminal_rules\"", "]", ".", "split", "(", "\";\"", ")", "\n", "self", "=", "cls", "(", ")", "\n", "for", "rule_repr", "in", "nonterminal_rules", ":", "\n", "            ", "if", "rule_repr", ":", "\n", "                ", "self", ".", "add_rule_repr", "(", "rule_repr", ",", "meta_grammar", ",", "terminal_rule", "=", "False", ")", "\n", "", "", "for", "rule_repr", "in", "terminal_rules", ":", "\n", "            ", "if", "rule_repr", ":", "\n", "                ", "self", ".", "add_rule_repr", "(", "rule_repr", ",", "meta_grammar", ",", "terminal_rule", "=", "True", ")", "\n", "", "", "self", ".", "finish_l_system", "(", ")", "\n", "return", "self", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.__repr__": [[793, 805], ["reversed", "reversed", "ValueError", "str", "str"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "if", "not", "self", ".", "_finished", ":", "\n", "            ", "raise", "ValueError", "(", "\n", "\"Trying to iterate over an unfinished L-System.\"", "\n", "\" Call .finish_l_system()\"", ")", "\n", "", "output_str", "=", "\"\"", "\n", "for", "rule", "in", "reversed", "(", "self", ".", "_rules_in_order", ")", ":", "\n", "            ", "output_str", "+=", "str", "(", "rule", ")", "+", "'\\n'", "\n", "", "output_str", "+=", "'\\n'", "\n", "for", "rule", "in", "reversed", "(", "self", ".", "_terminal_rules_in_order", ")", ":", "\n", "            ", "output_str", "+=", "str", "(", "rule", ")", "+", "'\\n'", "\n", "", "return", "output_str", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.__eq__": [[818, 836], ["dsl.LSystem.are_the_same_rules", "dsl.LSystem.are_the_same_rules", "dsl.LSystem.are_the_same_rules", "dsl.LSystem.are_the_same_rules"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.are_the_same_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.are_the_same_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.are_the_same_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.are_the_same_rules"], ["", "that_value", "=", "this_representation", "[", "key", "]", "\n", "if", "value", "!=", "that_value", ":", "\n", "                ", "return", "False", "\n", "", "", "return", "True", "\n", "\n", "", "", "def", "apply_rule", "(", "sequence", ":", "Sequence", ",", "rule", ":", "LSystemRule", ")", ":", "\n", "    ", "\"\"\"\n    Apply an L-system rule to a sequence by looping over the\n    sequence symbol by symbol and finding a match with the LHS\n    of the rule, if found, replace with rhs.\n    :param sequence: The sequence to apply the rule on, e.g., W Tl W Tl.\n    :param rule: The rule to apply to the sequence, e.g. W -> A W.\n    \"\"\"", "\n", "# Copy the LHS into a sequence so we can compare it to the", "\n", "# current sequence.", "\n", "lhs_matching_sequence", "=", "rule", ".", "lhs", "\n", "lhs_matching_length", "=", "len", "(", "lhs_matching_sequence", ")", "\n", "if", "lhs_matching_length", ">", "len", "(", "sequence", ")", ":", "\n", "        ", "return", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.__init__": [[1004, 1007], ["None"], "methods", ["None"], ["        ", "new_sequence", "=", "Sequence", "(", ")", "\n", "for", "symbol", "in", "sequence_1", ".", "iterate", "(", ")", ":", "\n", "            ", "new_sequence", ".", "append", "(", "symbol", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.min": [[1008, 1010], ["dsl.MetaGrammarFunctions.min"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.min"], ["", "for", "symbol", "in", "sequence_2", ".", "iterate", "(", ")", ":", "\n", "            ", "new_sequence", ".", "append", "(", "symbol", ")", "\n", "", "return", "new_sequence", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.abs": [[1011, 1013], ["dsl.MetaGrammarFunctions.abs"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.abs"], ["\n", "", "def", "is_empty", "(", "self", ",", "sequence", ":", "Sequence", ")", "->", "bool", ":", "\n", "        ", "return", "len", "(", "sequence", ")", "==", "0", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max": [[1014, 1016], ["dsl.MetaGrammarFunctions.max"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max"], ["\n", "", "def", "set", "(", "self", ",", "directions", ":", "List", "[", "Direction", "]", ")", "->", "Set", "[", "Direction", "]", ":", "\n", "        ", "return", "set", "(", "directions", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.concat": [[1017, 1026], ["dsl.Sequence", "sequence_1.iterate", "sequence_2.iterate", "dsl.Sequence.append", "dsl.Sequence.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["\n", "", "def", "is_left", "(", "self", ",", "direction_1", ":", "Direction", ",", "direction_2", ":", "Direction", ")", ":", "\n", "        ", "\"\"\"Returns whether direction_1 is to the left of direction_2\"\"\"", "\n", "int_dir_1", "=", "DIR_TO_INT", "[", "direction_1", "]", "\n", "int_dir_2", "=", "DIR_TO_INT", "[", "direction_2", "]", "\n", "if", "int_dir_1", "-", "int_dir_2", "==", "1", "or", "int_dir_1", "-", "int_dir_2", "==", "-", "3", ":", "\n", "            ", "return", "True", "\n", "", "else", ":", "\n", "            ", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.is_empty": [[1027, 1029], ["len"], "methods", ["None"], ["", "", "def", "turn_to_dir", "(", "self", ",", "current_dir", ":", "Direction", ",", "desired_dir", ":", "Direction", ",", "\n", "left_first", "=", "True", ")", "->", "List", "[", "Symbol", "]", ":", "\n", "        ", "if", "current_dir", "==", "desired_dir", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.set": [[1030, 1032], ["dsl.MetaGrammarFunctions.set"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set"], ["            ", "return", "[", "]", "\n", "", "sequence", "=", "[", "]", "\n", "given_dirs", "=", "self", ".", "set", "(", "[", "current_dir", ",", "desired_dir", "]", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.is_left": [[1033, 1041], ["None"], "methods", ["None"], ["if", "given_dirs", "==", "self", ".", "set", "(", "[", "NORTH", ",", "SOUTH", "]", ")", "or", "given_dirs", "==", "self", ".", "set", "(", "[", "WEST", ",", "EAST", "]", ")", ":", "\n", "            ", "if", "left_first", ":", "\n", "                ", "sequence", ".", "extend", "(", "[", "Tl", ",", "Tl", "]", ")", "\n", "", "else", ":", "\n", "                ", "sequence", ".", "extend", "(", "[", "Tr", ",", "Tr", "]", ")", "\n", "", "return", "sequence", "\n", "", "else", ":", "\n", "            ", "if", "self", ".", "is_left", "(", "current_dir", ",", "desired_dir", ")", ":", "\n", "                ", "sequence", ".", "append", "(", "Tl", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.turn_to_dir": [[1042, 1061], ["dsl.MetaGrammarFunctions.set", "dsl.MetaGrammarFunctions.is_left", "dsl.MetaGrammarFunctions.set", "dsl.MetaGrammarFunctions.set", "sequence.extend", "sequence.extend", "sequence.append", "sequence.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.is_left", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["return", "sequence", "\n", "", "else", ":", "\n", "                ", "sequence", ".", "append", "(", "Tr", ")", "\n", "return", "sequence", "\n", "\n", "", "", "", "def", "new_dir", "(", "self", ",", "direction", ":", "Direction", ",", "action", ":", "str", ")", ":", "\n", "        ", "if", "direction", "==", "EAST", "and", "action", "==", "\"Tl\"", ":", "\n", "            ", "return", "NORTH", "\n", "", "if", "direction", "==", "EAST", "and", "action", "==", "\"Tr\"", ":", "\n", "            ", "return", "SOUTH", "\n", "", "if", "direction", "==", "SOUTH", "and", "action", "==", "\"Tl\"", ":", "\n", "            ", "return", "EAST", "\n", "", "if", "direction", "==", "SOUTH", "and", "action", "==", "\"Tr\"", ":", "\n", "            ", "return", "WEST", "\n", "", "if", "direction", "==", "WEST", "and", "action", "==", "\"Tl\"", ":", "\n", "            ", "return", "SOUTH", "\n", "", "if", "direction", "==", "WEST", "and", "action", "==", "\"Tr\"", ":", "\n", "            ", "return", "NORTH", "\n", "", "if", "direction", "==", "NORTH", "and", "action", "==", "\"Tl\"", ":", "\n", "            ", "return", "WEST", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.new_dir": [[1062, 1079], ["None"], "methods", ["None"], ["", "if", "direction", "==", "NORTH", "and", "action", "==", "\"Tr\"", ":", "\n", "            ", "return", "EAST", "\n", "\n", "", "", "def", "is_turn", "(", "self", ",", "action", ":", "str", ")", ":", "\n", "        ", "if", "action", "==", "\"Tr\"", "or", "action", "==", "\"Tl\"", ":", "\n", "            ", "return", "True", "\n", "", "else", ":", "\n", "            ", "return", "False", "\n", "\n", "", "", "def", "is_transitive", "(", "self", ",", "action", ":", "str", ")", ":", "\n", "        ", "if", "action", "==", "\"Push\"", "or", "action", "==", "\"Pull\"", ":", "\n", "            ", "return", "True", "\n", "", "else", ":", "\n", "            ", "return", "False", "\n", "\n", "", "", "def", "step", "(", "self", ",", "direction", ":", "Direction", ",", "position", ":", "Position", ")", ":", "\n", "        ", "if", "direction", "==", "EAST", ":", "\n", "            ", "position", "=", "Position", "(", "column", "=", "position", ".", "column", "+", "1", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.is_turn": [[1080, 1085], ["None"], "methods", ["None"], ["row", "=", "position", ".", "row", ")", "\n", "return", "position", "\n", "", "if", "direction", "==", "NORTH", ":", "\n", "            ", "position", "=", "Position", "(", "column", "=", "position", ".", "column", ",", "\n", "row", "=", "position", ".", "row", "-", "1", ")", "\n", "return", "position", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.is_transitive": [[1086, 1091], ["None"], "methods", ["None"], ["", "if", "direction", "==", "SOUTH", ":", "\n", "            ", "position", "=", "Position", "(", "column", "=", "position", ".", "column", ",", "\n", "row", "=", "position", ".", "row", "+", "1", ")", "\n", "return", "position", "\n", "", "if", "direction", "==", "WEST", ":", "\n", "            ", "position", "=", "Position", "(", "column", "=", "position", ".", "column", "-", "1", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.step": [[1092, 1109], ["GroundedScan.dataset.GroundedScan.world.Position", "GroundedScan.dataset.GroundedScan.world.Position", "GroundedScan.dataset.GroundedScan.world.Position", "GroundedScan.dataset.GroundedScan.world.Position"], "methods", ["None"], ["row", "=", "position", ".", "row", ")", "\n", "return", "position", "\n", "\n", "\n", "", "", "", "def", "convert_sequence_to_actions", "(", "sequence", ":", "Sequence", ",", "\n", "agent_start_dir", ":", "Direction", ")", "->", "Sequence", ":", "\n", "    ", "\"\"\"\n    Converts a sequence containing East, West, North, South\n    to a sequence of actions from an agents perspective\n    :param sequence: a sequence of steps in the form of East, South, North, West symbols.\n    :param agent_start_dir: direction that the agent starts facing.\n    :return: a sequence of actions in the form of Tl, Walk, Tr symbols.\n    \"\"\"", "\n", "meta_functions", "=", "MetaGrammarFunctions", "(", ")", "\n", "new_sequence", "=", "Sequence", "(", ")", "\n", "current_agent_dir", "=", "agent_start_dir", "\n", "previous_walking_direction", "=", "None", "\n", "for", "symbol_node", "in", "sequence", ".", "iterate", "(", ")", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.__init__": [[1231, 1291], ["dsl.MetaGrammar", "dsl.LSystem", "dsl.Gscan._hesitantly.add_rule", "dsl.Gscan._hesitantly.add_rule", "dsl.Gscan._hesitantly.add_rule", "dsl.Gscan._hesitantly.add_rule", "dsl.Gscan._hesitantly.finish_l_system", "dsl.apply_recursion", "dsl.LSystem", "dsl.Gscan._cautiously.add_rule", "dsl.Gscan._cautiously.add_rule", "dsl.Gscan._cautiously.add_rule", "dsl.Gscan._cautiously.add_rule", "dsl.Gscan._cautiously.add_rule", "dsl.Gscan._cautiously.finish_l_system", "dsl.apply_recursion", "dsl.LSystem", "dsl.Gscan._while_spinning.add_rule", "dsl.Gscan._while_spinning.add_rule", "dsl.Gscan._while_spinning.add_rule", "dsl.Gscan._while_spinning.add_rule", "dsl.Gscan._while_spinning.add_rule", "dsl.Gscan._while_spinning.add_rule", "dsl.Gscan._while_spinning.add_rule", "dsl.Gscan._while_spinning.finish_l_system", "dsl.apply_recursion", "dsl.LSystem", "dsl.Gscan._while_zigzagging.add_rule", "dsl.Gscan._while_zigzagging.add_rule", "dsl.Gscan._while_zigzagging.add_rule", "dsl.Gscan._while_zigzagging.add_rule", "dsl.Gscan._while_zigzagging.finish_l_system", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_recursion", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_recursion", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_recursion", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule"], ["self", ".", "_cautiously", "=", "LSystem", "(", ")", "\n", "self", ".", "_cautiously", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"Walk\"", ",", "\n", "rhs_str", "=", "\"ACTION Walk\"", ")", ")", "\n", "self", ".", "_cautiously", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"Push\"", ",", "\n", "rhs_str", "=", "\"ACTION Push\"", ")", ")", "\n", "self", ".", "_cautiously", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"Pull\"", ",", "\n", "rhs_str", "=", "\"ACTION Pull\"", ")", ")", "\n", "self", ".", "_cautiously", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"{ACTION}ACTION ACTION{ACTION}\"", ",", "\n", "rhs_str", "=", "\"Tr Tr\"", ")", ",", "\n", "terminal_rule", "=", "True", ")", "\n", "self", ".", "_cautiously", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"ACTION\"", ",", "\n", "rhs_str", "=", "\"Tl\"", ")", ",", "\n", "terminal_rule", "=", "True", ")", "\n", "self", ".", "_cautiously", ".", "finish_l_system", "(", ")", "\n", "self", ".", "_cautiously", "=", "apply_recursion", "(", "self", ".", "_cautiously", ",", "max_recursion", "=", "4", ")", "\n", "\n", "self", ".", "_while_spinning", "=", "LSystem", "(", ")", "\n", "self", ".", "_while_spinning", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"East\"", ",", "\n", "rhs_str", "=", "\"ACTION East\"", ")", ")", "\n", "self", ".", "_while_spinning", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"North\"", ",", "\n", "rhs_str", "=", "\"ACTION North\"", ")", ")", "\n", "self", ".", "_while_spinning", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"South\"", ",", "\n", "rhs_str", "=", "\"ACTION South\"", ")", ")", "\n", "self", ".", "_while_spinning", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"West\"", ",", "\n", "rhs_str", "=", "\"ACTION West\"", ")", ")", "\n", "self", ".", "_while_spinning", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"Pull\"", ",", "\n", "rhs_str", "=", "\"ACTION Pull\"", ")", ")", "\n", "self", ".", "_while_spinning", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"ACTION\"", ",", "\n", "rhs_str", "=", "\"Tl\"", ")", ",", "\n", "terminal_rule", "=", "True", ")", "\n", "self", ".", "_while_spinning", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"Push\"", ",", "\n", "rhs_str", "=", "\"ACTION Push\"", ")", ")", "\n", "self", ".", "_while_spinning", ".", "finish_l_system", "(", ")", "\n", "self", ".", "_while_spinning", "=", "apply_recursion", "(", "self", ".", "_while_spinning", ",", "max_recursion", "=", "4", ")", "\n", "\n", "self", ".", "_while_zigzagging", "=", "LSystem", "(", ")", "\n", "self", ".", "_while_zigzagging", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"East South\"", ",", "\n", "rhs_str", "=", "\"South East\"", ")", ")", "\n", "self", ".", "_while_zigzagging", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"East North\"", ",", "\n", "rhs_str", "=", "\"North East\"", ")", ")", "\n", "self", ".", "_while_zigzagging", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"West North\"", ",", "\n", "rhs_str", "=", "\"North West\"", ")", ")", "\n", "self", ".", "_while_zigzagging", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"West South\"", ",", "\n", "rhs_str", "=", "\"South West\"", ")", ")", "\n", "self", ".", "_while_zigzagging", ".", "finish_l_system", "(", ")", "\n", "\n", "", "def", "get_gscan_adverb", "(", "self", ",", "adverb_str", ":", "str", ")", ":", "\n", "        ", "if", "adverb_str", "==", "\"while zigzagging\"", ":", "\n", "            ", "return", "self", ".", "_while_zigzagging", "\n", "", "elif", "adverb_str", "==", "\"while spinning\"", ":", "\n", "            ", "return", "self", ".", "_while_spinning", "\n", "", "elif", "adverb_str", "==", "\"cautiously\"", ":", "\n", "            ", "return", "self", ".", "_cautiously", "\n", "", "elif", "adverb_str", "==", "\"hesitantly\"", ":", "\n", "            ", "return", "self", ".", "_hesitantly", "\n", "", "else", ":", "\n", "            ", "raise", "ValueError", "(", "\"Unknown gSCAN adverb: %s\"", "%", "adverb_str", ")", "\n", "\n", "", "", "def", "parse_example", "(", "self", ",", "verb_in_command", ":", "str", ",", "start_position", ":", "Position", ",", "\n", "start_direction", ":", "Union", "[", "int", ",", "Direction", "]", ",", "adverb", ":", "LSystem", ",", "recursion", ":", "int", ",", "\n", "end_position", ":", "Position", ",", "adverb_type", ":", "str", ",", "grid", ":", "Grid", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.get_gscan_adverb": [[1292, 1303], ["ValueError"], "methods", ["None"], ["heavy", ":", "bool", ")", "->", "Dict", "[", "str", ",", "List", "[", "str", "]", "]", ":", "\n", "        ", "output", "=", "{", "}", "\n", "start_to_end_sequence", "=", "self", ".", "walk", "(", "start_position", ",", "end_position", ")", "\n", "output", "[", "\"planner\"", "]", "=", "start_to_end_sequence", ".", "get_gscan_actions", "(", ")", "\n", "if", "isinstance", "(", "start_direction", ",", "int", ")", ":", "\n", "            ", "start_direction", "=", "INT_TO_DIR", "[", "start_direction", "]", "\n", "", "if", "adverb_type", "==", "\"movement_rewrite\"", "or", "adverb_type", "==", "\"movement\"", ":", "\n", "            ", "apply_lsystem", "(", "start_to_end_sequence", ",", "adverb", ",", "0", ",", "recursion", ")", "\n", "", "remove_out_of_grid", "(", "start_to_end_sequence", ",", "grid", ".", "height", ",", "start_position", ")", "\n", "output", "[", "\"allocentric_movement_adverb_output\"", "]", "=", "start_to_end_sequence", ".", "get_gscan_actions", "(", ")", "\n", "if", "verb_in_command", "==", "\"push\"", ":", "\n", "            ", "self", ".", "push", "(", "start_to_end_sequence", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.parse_example": [[1304, 1336], ["dsl.Gscan.walk", "dsl.Gscan.get_gscan_actions", "isinstance", "dsl.remove_out_of_grid", "dsl.Gscan.get_gscan_actions", "dsl.Gscan.get_gscan_actions", "dsl.Gscan.get_gscan_actions", "dsl.convert_sequence_to_actions", "convert_sequence_to_actions.get_gscan_actions", "convert_sequence_to_actions.get_gscan_actions", "dsl.apply_lsystem", "dsl.Gscan.push", "dsl.apply_lsystem", "dsl.apply_lsystem", "dsl.Gscan.pull"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.walk", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_gscan_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.remove_out_of_grid", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_gscan_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_gscan_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_gscan_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.convert_sequence_to_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_gscan_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_gscan_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.push", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.pull"], ["grid", ",", "\n", "end_position", ",", "heavy", ")", "\n", "", "elif", "verb_in_command", "==", "\"pull\"", ":", "\n", "            ", "self", ".", "pull", "(", "start_to_end_sequence", ",", "\n", "grid", ",", "\n", "end_position", ",", "heavy", ")", "\n", "", "output", "[", "\"allocentric_transitive_output\"", "]", "=", "start_to_end_sequence", ".", "get_gscan_actions", "(", ")", "\n", "if", "adverb_type", "==", "\"nonmovement_direction\"", ":", "\n", "            ", "apply_lsystem", "(", "start_to_end_sequence", ",", "adverb", ",", "0", ",", "recursion", ")", "\n", "", "output", "[", "\"allocentric_nonmovement_adverb_output\"", "]", "=", "start_to_end_sequence", ".", "get_gscan_actions", "(", ")", "\n", "action_sequence", "=", "convert_sequence_to_actions", "(", "start_to_end_sequence", ",", "\n", "start_direction", ")", "\n", "output", "[", "\"egocentric_output\"", "]", "=", "action_sequence", ".", "get_gscan_actions", "(", ")", "\n", "if", "adverb_type", "==", "\"nonmovement_first_person\"", ":", "\n", "            ", "apply_lsystem", "(", "action_sequence", ",", "adverb", ",", "0", ",", "recursion", ")", "\n", "", "output", "[", "\"target_commands\"", "]", "=", "action_sequence", ".", "get_gscan_actions", "(", ")", "\n", "return", "output", "\n", "\n", "", "def", "parse_predicted_example", "(", "self", ",", "verb_in_command", ":", "str", ",", "start_position", ":", "Position", ",", "\n", "start_direction", ":", "Union", "[", "int", ",", "Direction", "]", ",", "\n", "end_position", ":", "Position", ",", "adverb_type", ":", "str", ",", "\n", "predicted_adverb_sequence", ":", "List", "[", "str", "]", ",", "grid", ":", "Grid", ",", "\n", "heavy", ":", "bool", ")", "->", "List", "[", "str", "]", ":", "\n", "        ", "predicted_adverb_sequence_symbols", "=", "Sequence", "(", ")", "\n", "for", "predicted_str", "in", "predicted_adverb_sequence", ":", "\n", "            ", "if", "predicted_str", "not", "in", "STR_TO_SYMBOL", ":", "\n", "                ", "raise", "ValueError", "(", "\"Unknown action str %s\"", "%", "predicted_str", ")", "\n", "", "predicted_adverb_sequence_symbols", ".", "append", "(", "STR_TO_SYMBOL", "[", "predicted_str", "]", ")", "\n", "", "if", "adverb_type", "==", "\"movement_rewrite\"", "or", "adverb_type", "==", "\"movement\"", ":", "\n", "            ", "start_to_end_sequence", "=", "predicted_adverb_sequence_symbols", "\n", "remove_out_of_grid", "(", "start_to_end_sequence", ",", "grid", ".", "height", ",", "start_position", ")", "\n", "if", "verb_in_command", "==", "\"push\"", ":", "\n", "                ", "self", ".", "push", "(", "start_to_end_sequence", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.parse_predicted_example": [[1337, 1369], ["dsl.Sequence", "convert_sequence_to_actions.get_gscan_actions", "dsl.Sequence.append", "dsl.remove_out_of_grid", "dsl.convert_sequence_to_actions", "ValueError", "dsl.Gscan.push", "dsl.convert_sequence_to_actions", "dsl.Gscan.pull", "ValueError"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_gscan_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.remove_out_of_grid", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.convert_sequence_to_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.push", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.convert_sequence_to_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.pull"], ["grid", ",", "\n", "end_position", ",", "heavy", ")", "\n", "", "elif", "verb_in_command", "==", "\"pull\"", ":", "\n", "                ", "self", ".", "pull", "(", "start_to_end_sequence", ",", "\n", "grid", ",", "\n", "end_position", ",", "heavy", ")", "\n", "", "action_sequence", "=", "convert_sequence_to_actions", "(", "start_to_end_sequence", ",", "\n", "start_direction", ")", "\n", "", "elif", "adverb_type", "==", "\"nonmovement_direction\"", ":", "\n", "            ", "start_to_end_sequence", "=", "predicted_adverb_sequence_symbols", "\n", "action_sequence", "=", "convert_sequence_to_actions", "(", "start_to_end_sequence", ",", "\n", "start_direction", ")", "\n", "", "elif", "adverb_type", "==", "\"nonmovement_first_person\"", ":", "\n", "            ", "action_sequence", "=", "predicted_adverb_sequence_symbols", "\n", "", "else", ":", "\n", "            ", "raise", "ValueError", "(", "\"unknown adverb type %s\"", "%", "adverb_type", ")", "\n", "", "return", "action_sequence", ".", "get_gscan_actions", "(", ")", "\n", "\n", "", "def", "walk", "(", "self", ",", "start_position", ":", "Position", ",", "end_position", ":", "Position", ")", "->", "Sequence", ":", "\n", "        ", "planned_sequence", "=", "simulate_planner", "(", "start_position", ",", "end_position", ")", "\n", "return", "planned_sequence", "\n", "\n", "", "def", "spin", "(", "self", ",", "sequence", ":", "Sequence", ",", "recursion_depth", ":", "int", ")", "->", "Sequence", ":", "\n", "        ", "apply_lsystem", "(", "sequence", ",", "self", ".", "_while_spinning", ",", "\n", "recursion", "=", "0", ",", "max_recursion", "=", "recursion_depth", ")", "\n", "return", "sequence", "\n", "\n", "", "def", "zigzag", "(", "self", ",", "sequence", ":", "Sequence", ",", "recursion_depth", ":", "int", ")", "->", "Sequence", ":", "\n", "        ", "apply_lsystem", "(", "sequence", ",", "self", ".", "_while_zigzagging", ",", "\n", "recursion", "=", "0", ",", "max_recursion", "=", "recursion_depth", ")", "\n", "return", "sequence", "\n", "\n", "", "def", "cautiously", "(", "self", ",", "sequence", ":", "Sequence", ",", "recursion_depth", ":", "int", ")", "->", "Sequence", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.walk": [[1370, 1373], ["dsl.simulate_planner"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.simulate_planner"], ["        ", "apply_lsystem", "(", "sequence", ",", "self", ".", "_cautiously", ",", "\n", "recursion", "=", "0", ",", "max_recursion", "=", "recursion_depth", ")", "\n", "return", "sequence", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.spin": [[1374, 1378], ["dsl.apply_lsystem"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem"], ["", "def", "hesitantly", "(", "self", ",", "sequence", ":", "Sequence", ",", "recursion_depth", ":", "int", ")", "->", "Sequence", ":", "\n", "        ", "apply_lsystem", "(", "sequence", ",", "self", ".", "_hesitantly", ",", "\n", "recursion", "=", "0", ",", "max_recursion", "=", "recursion_depth", ")", "\n", "return", "sequence", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.zigzag": [[1379, 1383], ["dsl.apply_lsystem"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem"], ["", "def", "push", "(", "self", ",", "sequence", ":", "Sequence", ",", "grid", ":", "Grid", ",", "\n", "target_position", ":", "Position", ",", "heavy", ":", "bool", ")", "->", "Sequence", ":", "\n", "# TODO: here or outside of this class and just use num_actions?", "\n", "        ", "last_direction", "=", "sequence", ".", "get_end", "(", ")", ".", "get", "(", ")", "\n", "last_direction", "=", "SYMBOL_CONVERT", "[", "last_direction", "]", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.cautiously": [[1384, 1388], ["dsl.apply_lsystem"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem"], ["num_push", "=", "get_num_push_actions", "(", "last_direction", ",", "target_position", ",", "grid", ")", "\n", "if", "heavy", ":", "\n", "            ", "num_push", "*=", "2", "\n", "", "for", "_", "in", "range", "(", "num_push", ")", ":", "\n", "            ", "sequence", ".", "append", "(", "Push", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.hesitantly": [[1389, 1393], ["dsl.apply_lsystem"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem"], ["", "return", "sequence", "\n", "\n", "", "def", "pull", "(", "self", ",", "sequence", ":", "Sequence", ",", "grid", ":", "Grid", ",", "\n", "target_position", ":", "Position", ",", "heavy", ":", "bool", ")", "->", "Sequence", ":", "\n", "# TODO: here or outside of this class and just use num_actions?", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.push": [[1394, 1405], ["sequence.get_end().get", "dsl.get_num_push_actions", "range", "sequence.append", "sequence.get_end"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_num_push_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_end"], ["        ", "last_direction", "=", "sequence", ".", "get_end", "(", ")", ".", "get", "(", ")", "\n", "last_direction", "=", "SYMBOL_CONVERT", "[", "last_direction", "]", "\n", "num_pull", "=", "get_num_pull_actions", "(", "last_direction", ",", "target_position", ",", "grid", ")", "\n", "if", "heavy", ":", "\n", "            ", "num_pull", "*=", "2", "\n", "", "for", "_", "in", "range", "(", "num_pull", ")", ":", "\n", "            ", "sequence", ".", "append", "(", "Pull", ")", "\n", "", "return", "sequence", "\n", "\n", "\n", "", "", "class", "AdverbWorld", "(", "object", ")", ":", "\n", "    "]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.pull": [[1406, 1417], ["sequence.get_end().get", "dsl.get_num_pull_actions", "range", "sequence.append", "sequence.get_end"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_num_pull_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_end"], ["\n", "\n", "def", "__init__", "(", "self", ",", "seed", ":", "int", ")", ":", "\n", "        ", "random", ".", "seed", "(", "seed", ")", "\n", "self", ".", "seed", "=", "seed", "\n", "self", ".", "_meta_grammar", "=", "MetaGrammar", "(", ")", "\n", "self", ".", "_functions", "=", "MetaGrammarFunctions", "(", ")", "\n", "self", ".", "_all_adverbs", "=", "{", "\n", "\"movement_rewrite\"", ":", "[", "]", ",", "\n", "\"movement\"", ":", "[", "]", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.__init__": [[1425, 1453], ["random.seed", "dsl.MetaGrammar", "dsl.MetaGrammarFunctions", "dsl.Gscan"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.seed"], ["\"nonmovement_first_person\"", ":", "[", "]", "\n", "}", "\n", "self", ".", "_gscan_programs", "=", "Gscan", "(", ")", "\n", "self", ".", "_gscan_dataset", "=", "None", "\n", "self", ".", "_intransitive_verbs", "=", "[", "\"walk\"", "]", "\n", "self", ".", "_transitive_verbs", "=", "[", "\"push\"", ",", "\"pull\"", "]", "\n", "self", ".", "_nouns", "=", "[", "\"circle\"", ",", "\"cylinder\"", ",", "\"square\"", "]", "\n", "self", ".", "_color_adjectives", "=", "[", "\"red\"", ",", "\"blue\"", ",", "\"green\"", ",", "\"yellow\"", "]", "\n", "self", ".", "_size_adjectives", "=", "[", "\"big\"", ",", "\"small\"", "]", "\n", "self", ".", "_possible_splits", "=", "[", "\"train\"", ",", "\"dev\"", ",", "\"test\"", ",", "\"adverb_gen\"", "]", "\n", "self", ".", "_adverbs", "=", "[", "\"cautiously\"", ",", "\"while zigzagging\"", ",", "\"while spinning\"", ",", "\n", "\"hesitantly\"", "]", "\n", "self", ".", "_possible_adverb_types", "=", "[", "\"movement_rewrite\"", ",", "\"movement\"", ",", "\n", "\"nonmovement_direction\"", ",", "\"nonmovement_first_person\"", "]", "\n", "self", ".", "_extra_adverbs", "=", "{", "}", "\n", "self", ".", "_extra_adverbs_str", "=", "None", "\n", "self", ".", "_heldout_adverbs_str", "=", "None", "\n", "self", ".", "_gscan_save_path", "=", "None", "\n", "self", ".", "save_directory", "=", "None", "\n", "self", ".", "_populated_adverbs", "=", "False", "\n", "\n", "", "def", "get_adverb_program", "(", "self", ",", "adverb_str", ":", "str", ")", ":", "\n", "        ", "if", "adverb_str", "in", "self", ".", "_adverbs", ":", "\n", "            ", "adverb_program", "=", "self", ".", "_gscan_programs", ".", "get_gscan_adverb", "(", "adverb_str", ")", "\n", "", "else", ":", "\n", "            ", "if", "adverb_str", "not", "in", "self", ".", "_extra_adverbs", ":", "\n", "                ", "raise", "ValueError", "(", "\"No assigned program for adverb: %s\"", "%", "adverb_str", ")", "\n", "", "adverb_program", "=", "self", ".", "_extra_adverbs", "[", "adverb_str", "]", "[", "\"program\"", "]", "\n", "", "return", "adverb_program", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.get_adverb_program": [[1454, 1464], ["dsl.AdverbWorld._gscan_programs.get_gscan_adverb", "ValueError"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.get_gscan_adverb"], ["\n", "", "def", "populate_adverbs", "(", "self", ",", "max_per_type", "=", "None", ")", ":", "\n", "# TODO: think about how to assign adverbs to programs etc.", "\n", "        ", "self", ".", "_all_adverbs", "=", "{", "\n", "\"movement_rewrite\"", ":", "self", ".", "generate_all_adverbs", "(", "\"movement_rewrite\"", ",", "\n", "recursions", "=", "[", "1", "]", ",", "\n", "max_adverbs", "=", "max_per_type", ")", ",", "\n", "\"movement\"", ":", "self", ".", "generate_all_adverbs", "(", "\"movement\"", ",", "\n", "recursions", "=", "[", "1", ",", "2", ",", "3", "]", ",", "\n", "max_adverbs", "=", "max_per_type", ")", ",", "\n", "\"nonmovement_direction\"", ":", "self", ".", "generate_all_adverbs", "(", "\"nonmovement_direction\"", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.populate_adverbs": [[1465, 1480], ["dsl.AdverbWorld.generate_all_adverbs", "dsl.AdverbWorld.generate_all_adverbs", "dsl.AdverbWorld.generate_all_adverbs", "dsl.AdverbWorld.generate_all_adverbs"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.generate_all_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.generate_all_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.generate_all_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.generate_all_adverbs"], ["recursions", "=", "[", "1", ",", "2", ",", "3", ",", "4", "]", ",", "\n", "max_adverbs", "=", "max_per_type", ")", ",", "\n", "\"nonmovement_first_person\"", ":", "self", ".", "generate_all_adverbs", "(", "\n", "\"nonmovement_first_person\"", ",", "recursions", "=", "[", "1", ",", "2", ",", "3", ",", "4", "]", ",", "\n", "max_adverbs", "=", "max_per_type", ")", "\n", "}", "\n", "self", ".", "_indices_not_assigned", "=", "{", "type_adverb", ":", "list", "(", "range", "(", "len", "(", "programs", ")", ")", ")", "for", "type_adverb", ",", "programs", "in", "self", ".", "_all_adverbs", ".", "items", "(", ")", "}", "\n", "self", ".", "_populated_adverbs", "=", "True", "\n", "\n", "", "def", "assign_adverb_programs", "(", "self", ",", "adverbs", ":", "List", "[", "str", "]", ")", ":", "\n", "        ", "num_adverbs", "=", "len", "(", "adverbs", ")", "\n", "num_available_per_type", "=", "{", "\n", "\"movement_rewrite\"", ":", "len", "(", "self", ".", "_all_adverbs", "[", "\"movement_rewrite\"", "]", ")", ",", "\n", "\"movement\"", ":", "len", "(", "self", ".", "_all_adverbs", "[", "\"movement\"", "]", ")", ",", "\n", "\"nonmovement_direction\"", ":", "len", "(", "self", ".", "_all_adverbs", "[", "\"nonmovement_direction\"", "]", ")", ",", "\n", "\"nonmovement_first_person\"", ":", "len", "(", "self", ".", "_all_adverbs", "[", "\"nonmovement_first_person\"", "]", ")", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.assign_adverb_programs": [[1482, 1527], ["len", "random.sample", "zip", "adverbs.copy", "chosen_per_type.items", "len", "len", "len", "len", "random.sample", "adverbs_left.extend", "types_left.extend", "len", "ValueError", "range", "chosen_per_type[].append", "range", "len", "adverbs.copy.pop", "range", "range", "len"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop"], ["num_adverbs_per_type", "=", "num_adverbs", "//", "4", "\n", "chosen_per_type", "=", "{", "}", "\n", "num_residual", "=", "num_adverbs", "%", "4", "\n", "adverbs_left", "=", "[", "]", "\n", "types_left", "=", "[", "]", "\n", "random", ".", "shuffle", "(", "self", ".", "_possible_adverb_types", ")", "\n", "for", "possible_type", "in", "self", ".", "_possible_adverb_types", ":", "\n", "            ", "num_available", "=", "num_available_per_type", "[", "possible_type", "]", "\n", "num_chosen", "=", "num_adverbs_per_type", "\n", "if", "num_adverbs_per_type", ">", "num_available", ":", "\n", "                ", "num_residual", "+=", "num_adverbs_per_type", "-", "num_available", "\n", "num_chosen", "=", "num_available", "\n", "", "elif", "num_adverbs_per_type", "<", "num_available", ":", "\n", "                ", "...", "\n", "", "available_indices", "=", "self", ".", "_indices_not_assigned", "[", "possible_type", "]", "\n", "sample_idxs", "=", "random", ".", "sample", "(", "available_indices", ",", "k", "=", "num_chosen", ")", "\n", "chosen_adverbs", "=", "[", "self", ".", "_all_adverbs", "[", "possible_type", "]", "[", "i", "]", "for", "i", "in", "sample_idxs", "]", "\n", "for", "idx", "in", "sample_idxs", ":", "\n", "                ", "self", ".", "_indices_not_assigned", "[", "possible_type", "]", ".", "remove", "(", "idx", ")", "\n", "", "other_idxs", "=", "[", "i", "for", "i", "in", "range", "(", "num_available", ")", "if", "i", "not", "in", "sample_idxs", "]", "\n", "adverbs_left", ".", "extend", "(", "[", "self", ".", "_all_adverbs", "[", "possible_type", "]", "[", "i", "]", "for", "i", "in", "other_idxs", "]", ")", "\n", "types_left", ".", "extend", "(", "[", "possible_type", "for", "_", "in", "range", "(", "len", "(", "other_idxs", ")", ")", "]", ")", "\n", "chosen_per_type", "[", "possible_type", "]", "=", "chosen_adverbs", "\n", "num_available_per_type", "[", "possible_type", "]", "-=", "num_chosen", "\n", "\n", "", "if", "num_residual", ">", "len", "(", "types_left", ")", ":", "\n", "            ", "raise", "ValueError", "(", "\"Cannot assign %d adverbs, because not enough available.\"", "%", "num_adverbs", ")", "\n", "", "residual_idx_chosen", "=", "random", ".", "sample", "(", "range", "(", "len", "(", "adverbs_left", ")", ")", ",", "k", "=", "num_residual", ")", "\n", "adverbs_chosen", "=", "[", "adverbs_left", "[", "i", "]", "for", "i", "in", "residual_idx_chosen", "]", "\n", "types_chosen", "=", "[", "types_left", "[", "i", "]", "for", "i", "in", "residual_idx_chosen", "]", "\n", "for", "type_adverb", ",", "adverb", "in", "zip", "(", "types_chosen", ",", "adverbs_chosen", ")", ":", "\n", "            ", "chosen_per_type", "[", "type_adverb", "]", ".", "append", "(", "adverb", ")", "\n", "\n", "", "adverbs_copy", "=", "adverbs", ".", "copy", "(", ")", "\n", "for", "type_adverb", ",", "adverb_programs", "in", "chosen_per_type", ".", "items", "(", ")", ":", "\n", "            ", "for", "adverb_program", "in", "adverb_programs", ":", "\n", "                ", "adverb_str", "=", "adverbs_copy", ".", "pop", "(", ")", "\n", "assert", "adverb_str", "not", "in", "self", ".", "_extra_adverbs", ",", "\"Double adverb str %s\"", "%", "adverb_str", "\n", "self", ".", "_extra_adverbs", "[", "adverb_str", "]", "=", "{", "}", "\n", "self", ".", "_extra_adverbs", "[", "adverb_str", "]", "[", "\"program\"", "]", "=", "adverb_program", "\n", "self", ".", "_extra_adverbs", "[", "adverb_str", "]", "[", "\"type\"", "]", "=", "type_adverb", "\n", "\n", "", "", "", "def", "assign_heldout_adverbs", "(", "self", ",", "adverbs", ":", "List", "[", "str", "]", ",", "type_adverb", ":", "str", ")", ":", "\n", "\n", "        ", "available_indices", "=", "self", ".", "_indices_not_assigned", "[", "type_adverb", "]", "\n", "sample_idxs", "=", "random", ".", "sample", "(", "available_indices", ",", "k", "=", "len", "(", "adverbs", ")", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.assign_heldout_adverbs": [[1524, 1539], ["random.sample", "adverbs.copy", "dsl.AdverbWorld._indices_not_assigned[].remove", "adverbs.copy.pop", "len"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop"], ["", "", "", "def", "assign_heldout_adverbs", "(", "self", ",", "adverbs", ":", "List", "[", "str", "]", ",", "type_adverb", ":", "str", ")", ":", "\n", "\n", "        ", "available_indices", "=", "self", ".", "_indices_not_assigned", "[", "type_adverb", "]", "\n", "sample_idxs", "=", "random", ".", "sample", "(", "available_indices", ",", "k", "=", "len", "(", "adverbs", ")", ")", "\n", "chosen_adverbs", "=", "[", "self", ".", "_all_adverbs", "[", "type_adverb", "]", "[", "i", "]", "for", "i", "in", "sample_idxs", "]", "\n", "for", "idx", "in", "sample_idxs", ":", "\n", "            ", "self", ".", "_indices_not_assigned", "[", "type_adverb", "]", ".", "remove", "(", "idx", ")", "\n", "", "adverbs_copy", "=", "adverbs", ".", "copy", "(", ")", "\n", "for", "adverb_program", "in", "chosen_adverbs", ":", "\n", "            ", "adverb_str", "=", "adverbs_copy", ".", "pop", "(", ")", "\n", "assert", "adverb_str", "not", "in", "self", ".", "_extra_adverbs", ",", "\"Double adverb str %s\"", "%", "adverb_str", "\n", "self", ".", "_extra_adverbs", "[", "adverb_str", "]", "=", "{", "}", "\n", "self", ".", "_extra_adverbs", "[", "adverb_str", "]", "[", "\"program\"", "]", "=", "adverb_program", "\n", "self", ".", "_extra_adverbs", "[", "adverb_str", "]", "[", "\"type\"", "]", "=", "type_adverb", "\n", "", "return", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.initialize_gscan": [[1528, 1549], ["GroundedScan.dataset.GroundedScan.dataset.GroundedScan"], "methods", ["None"], ["chosen_adverbs", "=", "[", "self", ".", "_all_adverbs", "[", "type_adverb", "]", "[", "i", "]", "for", "i", "in", "sample_idxs", "]", "\n", "for", "idx", "in", "sample_idxs", ":", "\n", "            ", "self", ".", "_indices_not_assigned", "[", "type_adverb", "]", ".", "remove", "(", "idx", ")", "\n", "", "adverbs_copy", "=", "adverbs", ".", "copy", "(", ")", "\n", "for", "adverb_program", "in", "chosen_adverbs", ":", "\n", "            ", "adverb_str", "=", "adverbs_copy", ".", "pop", "(", ")", "\n", "assert", "adverb_str", "not", "in", "self", ".", "_extra_adverbs", ",", "\"Double adverb str %s\"", "%", "adverb_str", "\n", "self", ".", "_extra_adverbs", "[", "adverb_str", "]", "=", "{", "}", "\n", "self", ".", "_extra_adverbs", "[", "adverb_str", "]", "[", "\"program\"", "]", "=", "adverb_program", "\n", "self", ".", "_extra_adverbs", "[", "adverb_str", "]", "[", "\"type\"", "]", "=", "type_adverb", "\n", "", "return", "\n", "\n", "", "def", "initialize_gscan", "(", "self", ",", "adverbs", ":", "List", "[", "str", "]", ",", "grid_size", ":", "int", ",", "\n", "held_out_adverbs", ":", "List", "[", "str", "]", ",", "use_gscan_adverbs", "=", "True", ")", ":", "\n", "        ", "if", "use_gscan_adverbs", ":", "\n", "            ", "all_adverbs", "=", "adverbs", "+", "self", ".", "_adverbs", "\n", "", "else", ":", "\n", "            ", "all_adverbs", "=", "adverbs", "\n", "", "self", ".", "_gscan_dataset", "=", "GroundedScan", "(", "\n", "intransitive_verbs", "=", "self", ".", "_intransitive_verbs", ",", "\n", "transitive_verbs", "=", "self", ".", "_transitive_verbs", ",", "\n", "nouns", "=", "self", ".", "_nouns", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.get_input_output_key": [[1550, 1567], ["ValueError"], "methods", ["None"], ["color_adjectives", "=", "self", ".", "_color_adjectives", ",", "\n", "size_adjectives", "=", "self", ".", "_size_adjectives", ",", "\n", "adverbs", "=", "all_adverbs", ",", "\n", "type_grammar", "=", "\"adverb\"", ",", "\n", "sample_vocabulary", "=", "\"default\"", ",", "\n", "percentage_train", "=", "0.8", ",", "\n", "adverb_splits", "=", "held_out_adverbs", ",", "\n", "min_object_size", "=", "1", ",", "max_object_size", "=", "4", ",", "\n", "grid_size", "=", "grid_size", ",", "save_directory", "=", "self", ".", "save_directory", ",", "\n", "use_gscan_adverbs", "=", "use_gscan_adverbs", ",", "\n", "seed", "=", "self", ".", "seed", ")", "\n", "\n", "", "@", "staticmethod", "\n", "def", "get_input_output_key", "(", "adverb_type", ":", "str", ")", "->", "Tuple", "[", "str", ",", "str", "]", ":", "\n", "        ", "if", "adverb_type", "==", "\"movement_rewrite\"", "or", "adverb_type", "==", "\"movement\"", ":", "\n", "            ", "input_key", "=", "\"planner\"", "\n", "output_key", "=", "\"allocentric_movement_adverb_output\"", "\n", "", "elif", "adverb_type", "==", "\"nonmovement_direction\"", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.get_possible_types": [[1577, 1579], ["dsl.AdverbWorld._possible_adverb_types.copy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "def", "get_possible_types", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_possible_adverb_types", ".", "copy", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.get_adverb_type": [[1568, 1580], ["None"], "methods", ["None"], ["            ", "input_key", "=", "\"allocentric_transitive_output\"", "\n", "output_key", "=", "\"allocentric_nonmovement_adverb_output\"", "\n", "", "elif", "adverb_type", "==", "\"nonmovement_first_person\"", ":", "\n", "            ", "input_key", "=", "\"egocentric_output\"", "\n", "output_key", "=", "\"target_commands\"", "\n", "", "else", ":", "\n", "            ", "raise", "ValueError", "(", "\"Unknown adverb type: %s\"", "%", "adverb_type", ")", "\n", "", "return", "input_key", ",", "output_key", "\n", "\n", "", "def", "get_possible_types", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_possible_adverb_types", ".", "copy", "(", ")", "\n", "\n", "", "def", "get_adverb_type", "(", "self", ",", "gscan_adverb", ":", "str", ")", "->", "str", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.save_adverb_challenge": [[1582, 1610], ["dsl.AdverbWorld._gscan_dataset.save_dataset", "logger.info", "os.path.join", "ValueError", "open", "dsl.AdverbWorld._extra_adverbs.items", "json.dump", "adverb_program[].to_representation", "str", "ValueError"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_dataset", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.to_representation"], ["            ", "return", "\"movement_rewrite\"", "\n", "", "elif", "gscan_adverb", "==", "\"while spinning\"", ":", "\n", "            ", "return", "\"nonmovement_direction\"", "\n", "", "elif", "gscan_adverb", "==", "\"cautiously\"", "or", "gscan_adverb", "==", "\"hesitantly\"", ":", "\n", "            ", "return", "\"nonmovement_first_person\"", "\n", "", "else", ":", "\n", "            ", "adverb_type", "=", "self", ".", "_extra_adverbs", "[", "gscan_adverb", "]", "[", "\"type\"", "]", "\n", "return", "adverb_type", "\n", "# raise ValueError(\"Adverb %s not in gSCAN adverbs.\" % gscan_adverb)", "\n", "\n", "", "", "def", "save_adverb_challenge", "(", "self", ",", "file_name", ":", "str", ")", ":", "\n", "        ", "if", "not", "self", ".", "_gscan_dataset", ":", "\n", "            ", "raise", "ValueError", "(", "\"Cannot save adverb challenge when gSCAN dataset\"", "\n", "\" is not initialized. Call .generate_adverb_challenge()\"", "\n", "\" first.\"", ")", "\n", "", "dataset_path", "=", "self", ".", "_gscan_dataset", ".", "save_dataset", "(", "\"dataset.txt\"", ")", "\n", "self", ".", "_gscan_save_path", "=", "dataset_path", "\n", "logger", ".", "info", "(", "\"Saved gSCAN dataset to {}\"", ".", "format", "(", "dataset_path", ")", ")", "\n", "\n", "output_path", "=", "os", ".", "path", ".", "join", "(", "self", ".", "save_directory", ",", "file_name", ")", "\n", "with", "open", "(", "output_path", ",", "'w'", ")", "as", "outfile", ":", "\n", "            ", "adverb_programs", "=", "{", "}", "\n", "for", "extra_adverb", ",", "adverb_program", "in", "self", ".", "_extra_adverbs", ".", "items", "(", ")", ":", "\n", "                ", "if", "extra_adverb", "not", "in", "adverb_programs", ":", "\n", "                    ", "adverb_programs", "[", "extra_adverb", "]", "=", "{", "}", "\n", "", "else", ":", "\n", "                    ", "raise", "ValueError", "(", "\"Twice the same adverb encountered in save_adverb_challenge: %s.\"", "%", "extra_adverb", ")", "\n", "", "adverb_programs", "[", "extra_adverb", "]", "[", "\"program\"", "]", "=", "adverb_program", "[", "\"program\"", "]", ".", "to_representation", "(", ")", "\n", "adverb_programs", "[", "extra_adverb", "]", "[", "\"type\"", "]", "=", "adverb_program", "[", "\"type\"", "]", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.save_gscan_statistics": [[1611, 1628], ["logger.info", "dsl.AdverbWorld._heldout_adverbs_str.split", "ValueError", "dsl.AdverbWorld._gscan_dataset.save_dataset_statistics"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.save_dataset_statistics"], ["", "adverb_representation", "=", "{", "\n", "\"adverb_programs\"", ":", "adverb_programs", ",", "\n", "\"held_out_adverbs\"", ":", "self", ".", "_heldout_adverbs_str", ",", "\n", "\"extra_adverbs_str\"", ":", "self", ".", "_extra_adverbs_str", ",", "\n", "\"gscan_save_path\"", ":", "self", ".", "_gscan_save_path", ",", "\n", "\"seed\"", ":", "str", "(", "self", ".", "seed", ")", "\n", "}", "\n", "json", ".", "dump", "(", "adverb_representation", ",", "outfile", ",", "indent", "=", "4", ")", "\n", "", "return", "output_path", "\n", "\n", "", "def", "save_gscan_statistics", "(", "self", ",", "dev_set", ":", "bool", ")", ":", "\n", "        ", "if", "not", "self", ".", "_gscan_dataset", ":", "\n", "            ", "raise", "ValueError", "(", "\"Cannot generate statistics when gSCAN dataset\"", "\n", "\" is not initialized. Call .generate_adverb_challenge()\"", "\n", "\" first.\"", ")", "\n", "", "logger", ".", "info", "(", "\"Gathering dataset statistics...\"", ")", "\n", "held_out_adverbs", "=", "self", ".", "_heldout_adverbs_str", ".", "split", "(", "\",\"", ")", "\n", "if", "not", "held_out_adverbs", "[", "0", "]", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.visualize_gscan_examples": [[1629, 1635], ["dsl.AdverbWorld._gscan_dataset.visualize_adverb_examples", "ValueError"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.visualize_adverb_examples"], ["            ", "held_out_splits", "=", "[", "]", "\n", "", "else", ":", "\n", "            ", "held_out_splits", "=", "[", "\"extra_\"", "+", "split", "for", "split", "in", "held_out_adverbs", "]", "\n", "", "splits", "=", "[", "\"train\"", ",", "\"test\"", ",", "\"adverb_1\"", ",", "\"adverb_2\"", "]", "+", "held_out_splits", "\n", "if", "dev_set", ":", "\n", "            ", "splits", "+=", "[", "\"dev\"", "]", "\n", "", "for", "split", "in", "splits", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.load_adverb_challenge": [[1636, 1656], ["open", "json.load", "cls", "all_data[].items", "GroundedScan.dataset.GroundedScan.dataset.GroundedScan.load_dataset_from_file", "dsl.LSystem.from_representation", "int"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.load", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.load_dataset_from_file", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.from_representation"], ["            ", "self", ".", "_gscan_dataset", ".", "save_dataset_statistics", "(", "split", "=", "split", ")", "\n", "\n", "", "", "def", "visualize_gscan_examples", "(", "self", ")", ":", "\n", "        ", "if", "not", "self", ".", "_gscan_dataset", ":", "\n", "            ", "raise", "ValueError", "(", "\"Cannot visualize examples when gSCAN dataset\"", "\n", "\" is not initialized. Call .generate_adverb_challenge()\"", "\n", "\" first.\"", ")", "\n", "", "self", ".", "_gscan_dataset", ".", "visualize_adverb_examples", "(", ")", "\n", "\n", "", "@", "classmethod", "\n", "def", "load_adverb_challenge", "(", "cls", ",", "file_path", ":", "str", ",", "save_directory", ":", "str", ")", ":", "\n", "        ", "with", "open", "(", "file_path", ",", "'r'", ")", "as", "infile", ":", "\n", "            ", "all_data", "=", "json", ".", "load", "(", "infile", ")", "\n", "self", "=", "cls", "(", "seed", "=", "int", "(", "all_data", "[", "\"seed\"", "]", ")", ")", "\n", "adverb_programs", "=", "{", "}", "\n", "for", "extra_adverb_str", ",", "adverb_program_spec", "in", "all_data", "[", "\"adverb_programs\"", "]", ".", "items", "(", ")", ":", "\n", "                ", "adverb_program_repr", "=", "adverb_program_spec", "[", "\"program\"", "]", "\n", "adverb_type", "=", "adverb_program_spec", "[", "\"type\"", "]", "\n", "adverb_programs", "[", "extra_adverb_str", "]", "=", "{", "}", "\n", "adverb_programs", "[", "extra_adverb_str", "]", "[", "\"program\"", "]", "=", "LSystem", ".", "from_representation", "(", "representation", "=", "adverb_program_repr", ",", "\n", "meta_grammar", "=", "self", ".", "_meta_grammar", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.generate_adverb_challenge": [[1657, 1731], ["dsl.AdverbWorld.assign_adverb_programs", "random.sample", "dsl.AdverbWorld.initialize_gscan", "dsl.AdverbWorld.populate_adverbs", "dsl.AdverbWorld._gscan_dataset.generate_all_adverb_world_states", "dsl.AdverbWorld._gscan_dataset.generate_adverb_world_states", "dsl.AdverbWorld.populate_adverbs", "range"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.assign_adverb_programs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Grammar.sample", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.initialize_gscan", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.populate_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_all_adverb_world_states", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_adverb_world_states", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.populate_adverbs"], ["adverb_programs", "[", "extra_adverb_str", "]", "[", "\"type\"", "]", "=", "adverb_type", "\n", "", "self", ".", "_heldout_adverbs_str", "=", "all_data", "[", "\"held_out_adverbs\"", "]", "\n", "self", ".", "_extra_adverbs_str", "=", "all_data", "[", "\"extra_adverbs_str\"", "]", "\n", "self", ".", "_extra_adverbs", "=", "adverb_programs", "\n", "self", ".", "_gscan_dataset", "=", "GroundedScan", ".", "load_dataset_from_file", "(", "file_path", "=", "all_data", "[", "\"gscan_save_path\"", "]", ",", "\n", "save_directory", "=", "save_directory", ")", "\n", "", "return", "self", "\n", "\n", "", "def", "generate_adverb_challenge", "(", "self", ",", "num_extra_training_adverbs", ":", "int", ",", "\n", "num_train_examples_per_train_adverb", ":", "int", ",", "\n", "num_extra_testing_adverbs", ":", "int", ",", "\n", "num_train_examples_per_test_adverb", ":", "int", ",", "\n", "grid_size", ":", "int", ",", "\n", "make_dev_set", ":", "bool", ",", "\n", "use_gscan_adverbs", ":", "bool", ",", "\n", "save_directory", ":", "str", ",", "\n", "num_resampling", "=", "1", ",", "\n", "visualize_per_split", "=", "0", ",", "\n", "held_out_type", "=", "None", "\n", ")", ":", "\n", "        ", "\"\"\"\n        Generates data for an adverb challenge, meaning training examples from gSCAN broken down in sequences\n        that execute the command without adverb (the input), and with the adverb (the target).\n        :param num_extra_training_adverbs: how many adverbs to generate (extra because the\n        dataset will already contain the 4 gSCAN adverbs)\n        :param num_train_examples_per_train_adverb: how many examples to generate for each adverb.\n        :param num_extra_testing_adverbs: how many extra testing adverbs to generate (extra because the\n        dataset will already contain the 2 gSCAN adverb splits)\n        :param num_train_examples_per_test_adverb: how many examples to move to train from these\n        extra held-out adverbs (this is the k in k-shot learning)\n        :param grid_size: which grid size to use (original gSCAN is 6)\n        :param make_dev_set: whether the make a dev set that is i.i.d. as the training set\n        :param use_gscan_adverbs: whether or not to add gSCAN adverbs to the training set\n        :param num_resampling: how many times to resample an example with the same grid specifications\n        :param visualize_per_split: how many examples per split to visualize\n        \"\"\"", "\n", "assert", "self", ".", "_populated_adverbs", ",", "\"Call .populate_adverbs() before generating challenge.\"", "\n", "self", ".", "save_directory", "=", "save_directory", "\n", "total_num_adverbs", "=", "num_extra_training_adverbs", "+", "num_extra_testing_adverbs", "\n", "adverbs_str", "=", "[", "\"adverb_%d\"", "%", "i", "for", "i", "in", "range", "(", "total_num_adverbs", ")", "]", "\n", "self", ".", "_extra_adverbs_str", "=", "adverbs_str", "\n", "held_out_adverbs", "=", "random", ".", "sample", "(", "adverbs_str", ",", "k", "=", "num_extra_testing_adverbs", ")", "\n", "if", "held_out_type", ":", "\n", "            ", "self", ".", "assign_heldout_adverbs", "(", "held_out_adverbs", ",", "held_out_type", ")", "\n", "to_assign", "=", "[", "a", "for", "a", "in", "adverbs_str", ".", "copy", "(", ")", "if", "a", "not", "in", "held_out_adverbs", "]", "\n", "", "else", ":", "\n", "            ", "to_assign", "=", "adverbs_str", ".", "copy", "(", ")", "\n", "", "self", ".", "assign_adverb_programs", "(", "to_assign", ")", "\n", "self", ".", "_heldout_adverbs_str", "=", "\",\"", ".", "join", "(", "held_out_adverbs", ")", "\n", "self", ".", "initialize_gscan", "(", "adverbs_str", ",", "grid_size", ",", "use_gscan_adverbs", "=", "use_gscan_adverbs", ",", "\n", "held_out_adverbs", "=", "held_out_adverbs", ")", "\n", "if", "held_out_type", ":", "\n", "            ", "for", "a", "in", "held_out_adverbs", ":", "\n", "                ", "assert", "self", ".", "get_adverb_type", "(", "a", ")", "==", "held_out_type", ",", "\"Wrong held out type %s for adverb %s. Should be %s\"", "%", "(", "\n", "self", ".", "get_adverb_type", "(", "a", ")", ",", "a", ",", "held_out_type", "\n", ")", "\n", "", "", "if", "not", "num_train_examples_per_train_adverb", ":", "\n", "            ", "self", ".", "_gscan_dataset", ".", "generate_all_adverb_world_states", "(", "\n", "num_resampling", "=", "num_resampling", ",", "\n", "other_objects_sample_percentage", "=", "0.5", ",", "\n", "min_other_objects", "=", "0", ",", "\n", "example_parser", "=", "self", ".", "_gscan_programs", ".", "parse_example", ",", "\n", "adverb_programs", "=", "self", ".", "get_adverb_program", ",", "\n", "visualize_per_split", "=", "visualize_per_split", ",", "\n", "make_dev_set", "=", "make_dev_set", ",", "\n", "k_per_adverb", "=", "num_train_examples_per_test_adverb", ",", "\n", "adverb_types", "=", "self", ".", "get_adverb_type", ",", "\n", "input_output_keys", "=", "self", ".", "get_input_output_key", ",", "\n", "held_out_adverbs", "=", "held_out_adverbs", "\n", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "_gscan_dataset", ".", "generate_adverb_world_states", "(", "\n", "max_examples_per_adverb", "=", "num_train_examples_per_train_adverb", ",", "\n", "num_resampling", "=", "num_resampling", ",", "\n", "other_objects_sample_percentage", "=", "0.5", ",", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.clear": [[1744, 1751], ["None"], "methods", ["None"], ["", "", "def", "clear", "(", "self", ")", ":", "\n", "        ", "self", ".", "_gscan_dataset", "=", "None", "\n", "self", ".", "_extra_adverbs", "=", "{", "}", "\n", "self", ".", "_extra_adverbs_str", "=", "None", "\n", "self", ".", "_heldout_adverbs_str", "=", "None", "\n", "self", ".", "_gscan_save_path", "=", "None", "\n", "self", ".", "save_directory", "=", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.get_rules": [[1733, 1744], ["dsl.AdverbWorld._meta_grammar.get_movement_rewrite_rules", "dsl.AdverbWorld._meta_grammar.get_movement_rules", "dsl.AdverbWorld._meta_grammar.get_nonmovement_direction_rules", "dsl.AdverbWorld._meta_grammar.get_nonmovement_first_person_rules", "ValueError"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_movement_rewrite_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_movement_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_nonmovement_direction_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_nonmovement_first_person_rules"], ["example_parser", "=", "self", ".", "_gscan_programs", ".", "parse_example", ",", "\n", "adverb_programs", "=", "self", ".", "get_adverb_program", ",", "\n", "visualize_per_split", "=", "visualize_per_split", ",", "\n", "make_dev_set", "=", "make_dev_set", ",", "\n", "k_per_adverb", "=", "num_train_examples_per_test_adverb", ",", "\n", "adverb_types", "=", "self", ".", "get_adverb_type", ",", "\n", "input_output_keys", "=", "self", ".", "get_input_output_key", ",", "\n", "held_out_adverbs", "=", "held_out_adverbs", ",", "\n", "max_examples_per_derivation", "=", "None", "\n", ")", "\n", "\n", "", "", "def", "clear", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.construct_lsystem": [[1745, 1754], ["dsl.LSystem", "dsl.LSystem.finish_l_system", "dsl.AdverbWorld._meta_grammar.get_rule", "dsl.LSystem.add_rule", "str", "str"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule"], ["        ", "self", ".", "_gscan_dataset", "=", "None", "\n", "self", ".", "_extra_adverbs", "=", "{", "}", "\n", "self", ".", "_extra_adverbs_str", "=", "None", "\n", "self", ".", "_heldout_adverbs_str", "=", "None", "\n", "self", ".", "_gscan_save_path", "=", "None", "\n", "self", ".", "save_directory", "=", "None", "\n", "\n", "", "def", "get_rules", "(", "self", ",", "type_adverb", ":", "str", ")", ":", "\n", "        ", "if", "type_adverb", "==", "\"movement_rewrite\"", ":", "\n", "            ", "return", "self", ".", "_meta_grammar", ".", "get_movement_rewrite_rules", "(", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.is_gscan_lsystem": [[1755, 1761], ["dsl.AdverbWorld.get_adverb_program"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.get_adverb_program"], ["", "elif", "type_adverb", "==", "\"movement\"", ":", "\n", "            ", "return", "self", ".", "_meta_grammar", ".", "get_movement_rules", "(", ")", "\n", "", "elif", "type_adverb", "==", "\"nonmovement_direction\"", ":", "\n", "            ", "return", "self", ".", "_meta_grammar", ".", "get_nonmovement_direction_rules", "(", ")", "\n", "", "elif", "type_adverb", "==", "\"nonmovement_first_person\"", ":", "\n", "            ", "return", "self", ".", "_meta_grammar", ".", "get_nonmovement_first_person_rules", "(", ")", "\n", "", "else", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.generate_all_adverbs": [[1762, 1844], ["dsl.AdverbWorld.get_rules", "list", "itertools.product", "len", "dsl.AdverbWorld.values", "all_rules_lhs.append", "all_rules_per_lhs.append", "dsl.AdverbWorld.construct_lsystem", "rule.rhs.iterate", "all_rules_lhs.append", "set", "dsl.apply_recursion", "symbol_node.get", "isinstance", "dsl.AdverbWorld.fill_nonterminals", "set", "apply_recursion.is_empty", "list", "dsl.Sequence", "dsl.Sequence.extend", "dsl.replace_nonterminal", "new_l_systems.append", "len", "dsl.AdverbWorld.is_gscan_lsystem", "all_l_systems.append", "itertools.permutations", "lhs_options[].rhs.get_start().get", "lhs_options[].rhs.get_start"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.get_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.construct_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_recursion", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.fill_nonterminals", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.is_empty", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.replace_nonterminal", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.is_gscan_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_start"], ["            ", "raise", "ValueError", "(", "\"Unknown type {}\"", ".", "format", "(", "type_adverb", ")", ")", "\n", "\n", "", "", "def", "construct_lsystem", "(", "self", ",", "rule_combinations", ")", "->", "LSystem", ":", "\n", "        ", "adverb_l_system", "=", "LSystem", "(", ")", "\n", "for", "rule_repr", ",", "has_nonterminal", ",", "nt", "in", "rule_combinations", ":", "\n", "            ", "if", "rule_repr", ":", "\n", "                ", "rule", "=", "self", ".", "_meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "str", "(", "rule_repr", ".", "lhs", ")", ",", "\n", "rhs_str", "=", "str", "(", "rule_repr", ".", "rhs", ")", ")", "\n", "adverb_l_system", ".", "add_rule", "(", "rule", ",", "terminal_rule", "=", "False", ")", "\n", "", "", "adverb_l_system", ".", "finish_l_system", "(", ")", "\n", "return", "adverb_l_system", "\n", "\n", "", "def", "is_gscan_lsystem", "(", "self", ",", "l_system", ":", "LSystem", ")", ":", "\n", "        ", "gscan_l_systems", "=", "[", "self", ".", "get_adverb_program", "(", "adverb", ")", "for", "adverb", "in", "self", ".", "_adverbs", "]", "\n", "for", "gscan_system", "in", "gscan_l_systems", ":", "\n", "            ", "if", "l_system", "==", "gscan_system", ":", "\n", "                ", "return", "True", "\n", "", "", "return", "False", "\n", "\n", "", "def", "generate_all_adverbs", "(", "self", ",", "type_adverb", ":", "str", ",", "recursions", ":", "List", "[", "int", "]", ",", "\n", "max_adverbs", "=", "None", ")", "->", "List", "[", "LSystem", "]", ":", "\n", "        ", "\"\"\"\n        Takes all rules of the type of adverb to generate, makes all possible combinations\n        of L-systems that can be made with them: for every unique LHS, pick a rule (with\n        the option of *not* adding a rule with that LHS).  Additionally, if a chosen rule\n        has a nonterminal in the RHS, this gives extra potential L-systems to be generated.\n        :param type_adverb: the string determining the type of adverb to generate\n                     (see get_rules() for options and docstring for explanation)\n        :return: A list of all generated L-systems.\n        \"\"\"", "\n", "assert", "len", "(", "recursions", ")", ">", "0", ",", "\"Empty recursions will not generate any adverbs, choose \"", "\"recursions=[1] minimally.\"", "\n", "# Get rules from meta-grammar that can be used to generate adverbs of this type.", "\n", "rules", "=", "self", ".", "get_rules", "(", "type_adverb", ")", "\n", "rule_list", "=", "list", "(", "rules", ".", "values", "(", ")", ")", "\n", "\n", "# Make lists with rules grouped together with the same LHS", "\n", "all_rules_per_lhs", "=", "[", "]", "\n", "for", "rules", "in", "rule_list", ":", "\n", "            ", "all_rules_lhs", "=", "[", "]", "\n", "for", "rule", "in", "rules", ":", "\n", "# Keep track of which rules have a nonterminal in the RHS", "\n", "                ", "has_nonterminal", ",", "non_terminal", "=", "False", ",", "None", "\n", "for", "symbol_node", "in", "rule", ".", "rhs", ".", "iterate", "(", ")", ":", "\n", "                    ", "symbol", "=", "symbol_node", ".", "get", "(", ")", "\n", "if", "isinstance", "(", "symbol", ",", "Nonterminal", ")", ":", "\n", "                        ", "has_nonterminal", "=", "True", "\n", "non_terminal", "=", "symbol", "\n", "", "", "all_rules_lhs", ".", "append", "(", "[", "rule", ",", "has_nonterminal", ",", "non_terminal", "]", ")", "\n", "\n", "# Make sure *not* adding the rule is represented in the choices.", "\n", "", "all_rules_lhs", ".", "append", "(", "[", "None", ",", "False", ",", "None", "]", ")", "\n", "all_rules_per_lhs", ".", "append", "(", "all_rules_lhs", ")", "\n", "\n", "# Generate all possible combinations rules.", "\n", "", "all_l_systems_combinations", "=", "itertools", ".", "product", "(", "*", "all_rules_per_lhs", ")", "\n", "all_l_systems", "=", "[", "]", "\n", "\n", "# Restricted means nonterminals can only be replaced by sequences that do", "\n", "# not end up changing the agent direction (e.g., stay, or turn right turn left).", "\n", "restricted", "=", "True", "if", "type_adverb", "==", "\"nonmovement_first_person\"", "else", "False", "\n", "for", "combinations", "in", "all_l_systems_combinations", ":", "\n", "            ", "adverb_l_system", "=", "self", ".", "construct_lsystem", "(", "combinations", ")", "\n", "has_nonterminal", "=", "True", "in", "set", "(", "[", "has_nt", "for", "_", ",", "has_nt", ",", "_", "in", "combinations", "]", ")", "\n", "nonterminal", "=", "ACTION", "# The only nonterminal in the DSL is ACTION.", "\n", "\n", "# Apply all recursions to the L-system to get new L-systems.", "\n", "for", "recursion", "in", "recursions", ":", "\n", "                ", "l_system", "=", "apply_recursion", "(", "adverb_l_system", ",", "recursion", ")", "\n", "\n", "# If there are nonterminals, replace them with all possible combinations", "\n", "# to generate even more L-systems.", "\n", "if", "has_nonterminal", ":", "\n", "\n", "# Generate all possible combinations of replacements.", "\n", "                    ", "lhs_options", "=", "self", ".", "_meta_grammar", ".", "rules", "[", "nonterminal", ".", "name", "]", "\n", "options", "=", "self", ".", "fill_nonterminals", "(", "recursion", ",", "restricted", "=", "restricted", ")", "\n", "new_l_systems", "=", "[", "]", "\n", "\n", "# Each unordered option (e.g., turn right, turn left) can be made into", "\n", "# several ordered options (order matters).", "\n", "for", "unordered_option", "in", "options", ":", "\n", "                        ", "ordered_options", "=", "set", "(", "list", "(", "itertools", ".", "permutations", "(", "unordered_option", ",", "recursion", ")", ")", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.partition": [[1845, 1854], ["set", "set.add", "range", "dsl.AdverbWorld.partition", "set.add", "tuple", "sorted"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.partition"], ["for", "ordered_option", "in", "ordered_options", ":", "\n", "                            ", "option_symbols", "=", "[", "lhs_options", "[", "lhs", "]", ".", "rhs", ".", "get_start", "(", ")", ".", "get", "(", ")", "for", "lhs", "in", "ordered_option", "]", "\n", "sequence", "=", "Sequence", "(", ")", "\n", "sequence", ".", "extend", "(", "option_symbols", ")", "\n", "new_l_system", "=", "replace_nonterminal", "(", "l_system", ",", "sequence", ")", "\n", "new_l_systems", ".", "append", "(", "new_l_system", ")", "\n", "", "", "", "else", ":", "\n", "                    ", "new_l_systems", "=", "[", "l_system", "]", "\n", "\n", "# Save all the generated L-systems.", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.fill_nonterminals_restricted": [[1855, 1908], ["dsl.AdverbWorld.partition", "cancelling_options_d[].append", "len", "all_combinations.extend", "len", "len", "new_partition_combinations.append", "current_partition_combination.copy"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.partition", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy"], ["", "for", "l_system", "in", "new_l_systems", ":", "\n", "                    ", "if", "max_adverbs", ":", "\n", "                        ", "if", "len", "(", "all_l_systems", ")", ">=", "max_adverbs", ":", "\n", "                            ", "return", "all_l_systems", "\n", "", "", "if", "not", "l_system", ".", "is_empty", "(", ")", ":", "\n", "                        ", "if", "not", "self", ".", "is_gscan_lsystem", "(", "l_system", ")", ":", "\n", "                            ", "all_l_systems", ".", "append", "(", "l_system", ")", "\n", "", "", "", "", "", "return", "all_l_systems", "\n", "\n", "", "def", "partition", "(", "self", ",", "number", ":", "int", ")", ":", "\n", "        ", "\"\"\"Returns all ways a number can be partitioned.\n         E.g., if number is 4, (1, 1, 1, 1), (4), (1, 3), and (2, 2).\"\"\"", "\n", "answer", "=", "set", "(", ")", "\n", "answer", ".", "add", "(", "(", "number", ",", ")", ")", "\n", "for", "x", "in", "range", "(", "1", ",", "number", ")", ":", "\n", "            ", "for", "y", "in", "self", ".", "partition", "(", "number", "-", "x", ")", ":", "\n", "                ", "answer", ".", "add", "(", "tuple", "(", "sorted", "(", "(", "x", ",", ")", "+", "y", ")", ")", ")", "\n", "", "", "return", "answer", "\n", "\n", "", "def", "fill_nonterminals_restricted", "(", "self", ",", "num_nonterminals", ":", "int", ")", ":", "\n", "        ", "\"\"\"\n        Makes a sequence of actions that does not change the initial direction of an agent.\n        E.g., turn_left turn_right, or stay stay\n        :param num_nonterminals: the number of actions needed in the sequence\n        :return: all possible combinations of actions to make a sequence of length num_nonterminals\n        \"\"\"", "\n", "# Options that do not change direction", "\n", "cancelling_options", "=", "[", "\n", "[", "\"Tl\"", ",", "\"Tr\"", "]", ",", "\n", "[", "\"Stay\"", "]", ",", "\n", "[", "\"Tl\"", ",", "\"Tl\"", ",", "\"Tl\"", ",", "\"Tl\"", "]", ",", "\n", "[", "\"Tr\"", ",", "\"Tr\"", ",", "\"Tr\"", ",", "\"Tr\"", "]", "\n", "]", "\n", "\n", "# Transform into a dict with as key the length of the sequence", "\n", "cancelling_options_d", "=", "{", "}", "\n", "for", "options", "in", "cancelling_options", ":", "\n", "            ", "if", "len", "(", "options", ")", "not", "in", "cancelling_options_d", ":", "\n", "                ", "cancelling_options_d", "[", "len", "(", "options", ")", "]", "=", "[", "]", "\n", "", "cancelling_options_d", "[", "len", "(", "options", ")", "]", ".", "append", "(", "options", ")", "\n", "\n", "# All partitions of a number tell us how we can partition it into smaller (or equal) numbers)", "\n", "# E,g. 3 is (1, 1, 1), (1, 2), and (3), meaning we can make a sequence of num_nonterminals=3", "\n", "# in 3 different ways.", "\n", "", "all_combinations", "=", "[", "]", "\n", "all_partitions", "=", "self", ".", "partition", "(", "num_nonterminals", ")", "\n", "for", "partition", "in", "all_partitions", ":", "# E.g., partition: (1, 2, 1)", "\n", "            ", "partition_combinations", "=", "[", "[", "]", "]", "\n", "valid_partition", "=", "True", "\n", "\n", "# For each number of actions in the partition, add to the potential", "\n", "# sequences each cancelling option", "\n", "for", "num_actions", "in", "partition", ":", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.fill_nonterminals": [[1909, 1922], ["dsl.AdverbWorld.fill_nonterminals_restricted", "list", "itertools.combinations_with_replacement"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.fill_nonterminals_restricted"], ["# For example num_actions = 3 is invalid because we don't have a cancelling sequence for it.", "\n", "                ", "if", "num_actions", "not", "in", "cancelling_options_d", ":", "\n", "                    ", "valid_partition", "=", "False", "\n", "", "else", ":", "\n", "\n", "# For each cancelling option, make a copy of the sequences in partition_combinations so far", "\n", "# because we want to extend each with the options.", "\n", "                    ", "current_options", "=", "cancelling_options_d", "[", "num_actions", "]", "\n", "new_partition_combinations", "=", "[", "]", "\n", "for", "current_partition_combination", "in", "partition_combinations", ":", "\n", "                        ", "for", "option", "in", "current_options", ":", "\n", "                            ", "new_current_partition_combinations", "=", "current_partition_combination", ".", "copy", "(", ")", "+", "option", "\n", "new_partition_combinations", ".", "append", "(", "new_current_partition_combinations", ")", "\n", "", "", "partition_combinations", "=", "new_partition_combinations", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.planner": [[1923, 1934], ["dsl.simulate_planner"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.simulate_planner"], ["", "", "if", "valid_partition", ":", "\n", "                ", "all_combinations", ".", "extend", "(", "partition_combinations", ")", "\n", "\n", "", "", "return", "all_combinations", "\n", "\n", "", "def", "fill_nonterminals", "(", "self", ",", "num_nonterminals", ":", "int", ",", "restricted", ":", "bool", ")", ":", "\n", "        "]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.apply_adverb": [[1935, 1940], ["dsl.apply_lsystem"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem"], ["\n", "if", "restricted", ":", "\n", "            ", "return", "self", ".", "fill_nonterminals_restricted", "(", "num_nonterminals", ")", "\n", "", "else", ":", "\n", "            ", "choices", "=", "[", "\"Tl\"", ",", "\"Tr\"", ",", "\"Stay\"", "]", "\n", "return", "[", "list", "(", "comb", ")", "for", "comb", "in", "itertools", ".", "combinations_with_replacement", "(", "choices", ",", "num_nonterminals", ")", "]", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.remove_out_of_grid": [[1941, 1966], ["direction_sequence.get_start", "direction_node.get_next.get_next.get", "SYMBOL_CONVERT.keys", "direction_node.get_next.get_next.get_next", "direction_sequence.delete_node", "to_delete.remove", "to_delete.append", "direction_sequence.delete_node", "direction_node.get_next.get_next.get_next"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_start", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_next", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.delete_node", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.delete_node", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_next"], ["\n", "", "", "def", "planner", "(", "self", ",", "start_position", ":", "Position", ",", "end_position", ":", "Position", ")", "->", "Sequence", ":", "\n", "        ", "\"\"\"\n        Returns a plan in terms of directions to go from start_position to end_position.\n        E.g., if start is (row=0, column=0) and end is (row=3, col=2), the plan is\n        EAST EAST SOUTH SOUTH SOUTH\n        :param start_position: the starting row and column.\n        :param end_position: the ending row and column.\n        :return: A sequence of allocentric directions.\n        \"\"\"", "\n", "planned_sequence", "=", "simulate_planner", "(", "start_position", ",", "end_position", ")", "\n", "return", "planned_sequence", "\n", "\n", "", "def", "apply_adverb", "(", "self", ",", "adverb", ":", "LSystem", ",", "sequence", ":", "Sequence", ",", "\n", "recursion_depth", ":", "int", ")", "->", "Sequence", ":", "\n", "        ", "apply_lsystem", "(", "sequence", ",", "adverb", ",", "\n", "recursion", "=", "0", ",", "max_recursion", "=", "recursion_depth", ")", "\n", "return", "sequence", "\n", "\n", "", "def", "remove_out_of_grid", "(", "self", ",", "direction_sequence", ":", "Sequence", ",", "\n", "grid_size", ":", "int", ",", "start_position", ":", "Position", ")", ":", "\n", "        ", "start_pos", "=", "(", "start_position", ".", "column", ",", "start_position", ".", "row", ")", "\n", "current_pos", "=", "start_pos", "\n", "to_delete", "=", "[", "]", "\n", "direction_node", "=", "direction_sequence", ".", "get_start", "(", ")", "\n", "while", "direction_node", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.reject_first_person_adverb": [[1967, 1987], ["set", "l_system.nonterminal_rules", "rhs.iterate", "set.add", "len", "symbol_node.get", "dsl.AdverbWorld._functions.is_turn", "len", "dsl.AdverbWorld._functions.new_dir", "set.pop"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.nonterminal_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.is_turn", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.new_dir", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop"], ["            ", "symbol", "=", "direction_node", ".", "get", "(", ")", "\n", "if", "symbol", "in", "SYMBOL_CONVERT", ".", "keys", "(", ")", ":", "\n", "                ", "direction", "=", "SYMBOL_CONVERT", "[", "symbol", "]", "\n", "if", "direction", "in", "to_delete", ":", "\n", "                    ", "direction_node", "=", "direction_sequence", ".", "delete_node", "(", "direction_node", ")", "\n", "to_delete", ".", "remove", "(", "direction", ")", "\n", "", "else", ":", "\n", "                    ", "next_pos", "=", "current_pos", "+", "DIR_TO_VEC", "[", "DIR_TO_INT", "[", "direction", "]", "]", "\n", "next_col", ",", "next_row", "=", "next_pos", "\n", "if", "not", "0", "<=", "next_col", "<=", "grid_size", "-", "1", "or", "not", "0", "<=", "next_row", "<=", "grid_size", "-", "1", ":", "\n", "                        ", "opposite_direction", "=", "GET_OPPOSITE_DIR", "[", "direction", "]", "\n", "to_delete", ".", "append", "(", "opposite_direction", ")", "\n", "direction_node", "=", "direction_sequence", ".", "delete_node", "(", "direction_node", ")", "\n", "", "else", ":", "\n", "                        ", "current_pos", "=", "next_pos", "\n", "direction_node", "=", "direction_node", ".", "get_next", "(", ")", "\n", "", "", "", "else", ":", "\n", "                ", "direction_node", "=", "direction_node", ".", "get_next", "(", ")", "\n", "\n", "", "", "", "def", "reject_first_person_adverb", "(", "self", ",", "l_system", ":", "LSystem", ")", "->", "bool", ":", "\n", "        ", "start_direction", "=", "EAST", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.generate_example": [[1988, 2015], ["dsl.AdverbWorld.planner", "dsl.AdverbWorld.remove_out_of_grid"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.planner", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.remove_out_of_grid"], ["end_directions", "=", "set", "(", ")", "\n", "for", "rule", "in", "l_system", ".", "nonterminal_rules", "(", ")", ":", "\n", "            ", "rhs", "=", "rule", ".", "rhs", "\n", "current_direction", "=", "start_direction", "\n", "for", "symbol_node", "in", "rhs", ".", "iterate", "(", ")", ":", "\n", "                ", "symbol", "=", "symbol_node", ".", "get", "(", ")", "\n", "if", "self", ".", "_functions", ".", "is_turn", "(", "symbol", ".", "name", ")", ":", "\n", "                    ", "current_direction", "=", "self", ".", "_functions", ".", "new_dir", "(", "current_direction", ",", "\n", "symbol", ".", "name", ")", "\n", "", "", "end_directions", ".", "add", "(", "current_direction", ")", "\n", "", "if", "len", "(", "end_directions", ")", "==", "0", ":", "\n", "            ", "return", "False", "\n", "", "elif", "len", "(", "end_directions", ")", ">", "1", ":", "\n", "            ", "return", "True", "\n", "", "elif", "start_direction", "==", "end_directions", ".", "pop", "(", ")", ":", "\n", "            ", "return", "False", "\n", "", "else", ":", "\n", "            ", "return", "True", "\n", "\n", "", "", "def", "generate_example", "(", "self", ",", "start_position", ":", "Position", ",", "\n", "start_direction", ":", "int", ",", "end_position", ":", "Position", ",", "\n", "manner", ":", "LSystem", ",", "recursion_depth_system", ":", "int", ",", "\n", "recursion_depth_sequence", ":", "int", ",", "\n", "grid_size", ":", "int", ",", "type_adverb", ":", "str", ")", "->", "Tuple", "[", "List", "[", "str", "]", ",", "bool", "]", ":", "\n", "        ", "start_to_end_sequence", "=", "self", ".", "planner", "(", "start_position", ",", "end_position", ")", "\n", "start_direction", "=", "INT_TO_DIR", "[", "start_direction", "]", "\n", "if", "recursion_depth_system", ">=", "0", ":", "\n", "            ", "manner", "=", "apply_recursion", "(", "manner", ",", "recursion_depth_system", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_rule": [[838, 893], ["len", "len", "sequence.get_start", "current_sequence_ptr.get_next.is_replaced", "current_sequence_ptr.get_next.get_next", "lhs_matching_sequence.iterate", "copy.deepcopy", "next", "current_ptr.get_next.get_next", "range", "sequence.replace", "range", "current_sequence_ptr.get_next.get_next", "current_ptr.get_next.is_replaced", "rule.lhs.num_right_conditional", "rule.lhs.num_left_conditional", "current_sequence_ptr.get_next.get_next", "rule.lhs.num_right_conditional", "current_sequence_ptr.get_next.get_next", "current_ptr.get_next.get", "next.get", "rule.lhs.num_left_conditional"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_start", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.is_replaced", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_next", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_next", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.replace", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_next", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.is_replaced", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Lhs.num_right_conditional", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Lhs.num_left_conditional", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_next", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Lhs.num_right_conditional", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_next", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Lhs.num_left_conditional"], ["# Loop over the current sequence.", "\n", "        ", "current_sequence_ptr", "=", "sequence", ".", "get_start", "(", ")", "\n", "\n", "# If a symbol has been replaced by another rule in the same", "\n", "# iteration, it should not be used for LHS checking again.", "\n", "while", "current_sequence_ptr", ".", "is_replaced", "(", ")", ":", "\n", "            ", "current_sequence_ptr", "=", "current_sequence_ptr", ".", "get_next", "(", ")", "\n", "if", "not", "current_sequence_ptr", ":", "\n", "                ", "break", "\n", "", "", "while", "current_sequence_ptr", ":", "\n", "\n", "            ", "lhs_iterator", "=", "lhs_matching_sequence", ".", "iterate", "(", ")", "\n", "\n", "# Get a part of the sequence to compare to the LHS.", "\n", "current_ptr", "=", "deepcopy", "(", "current_sequence_ptr", ")", "\n", "num_compared", "=", "0", "\n", "match", "=", "True", "\n", "while", "num_compared", "<", "lhs_matching_length", "and", "current_ptr", "and", "match", ":", "\n", "                ", "next_lhs_symbol", "=", "next", "(", "lhs_iterator", ")", "\n", "if", "current_ptr", ".", "get", "(", ")", "!=", "next_lhs_symbol", ".", "get", "(", ")", "or", "current_ptr", ".", "is_replaced", "(", ")", ":", "\n", "                    ", "match", "=", "False", "\n", "", "current_ptr", "=", "current_ptr", ".", "get_next", "(", ")", "\n", "num_compared", "+=", "1", "\n", "", "if", "match", "and", "num_compared", "==", "lhs_matching_length", ":", "\n", "                ", "lhs_replace_length", "=", "lhs_matching_length", "-", "rule", ".", "lhs", ".", "num_left_conditional", "(", ")", "-", "rule", ".", "lhs", ".", "num_right_conditional", "(", ")", "\n", "# Advance the ptr past the conditional part of the LHS.", "\n", "# We don't want to replace that part.", "\n", "for", "_", "in", "range", "(", "rule", ".", "lhs", ".", "num_left_conditional", "(", ")", ")", ":", "\n", "                    ", "current_sequence_ptr", "=", "current_sequence_ptr", ".", "get_next", "(", ")", "\n", "", "current_sequence_ptr", "=", "sequence", ".", "replace", "(", "current_sequence_ptr", ",", "\n", "lhs_replace_length", ",", "\n", "rule", ".", "rhs", ")", "\n", "# Advance the ptr past the conditional part of the RHS.", "\n", "# TODO: couldn't the right part of the conditional still be matched?", "\n", "for", "_", "in", "range", "(", "rule", ".", "lhs", ".", "num_right_conditional", "(", ")", ")", ":", "\n", "                    ", "current_sequence_ptr", "=", "current_sequence_ptr", ".", "get_next", "(", ")", "\n", "", "", "else", ":", "\n", "                ", "current_sequence_ptr", "=", "current_sequence_ptr", ".", "get_next", "(", ")", "\n", "\n", "\n", "", "", "", "", "def", "simulate_planner", "(", "start_position", ":", "Position", ",", "\n", "end_position", ":", "Position", ")", "->", "Sequence", ":", "\n", "    ", "\"\"\"Returns a sequence of East, West, North, South actions that takes\n    you from start_position to end_position on a grid.\"\"\"", "\n", "\n", "sequence", "=", "Sequence", "(", ")", "\n", "\n", "cols_diff", "=", "end_position", ".", "column", "-", "start_position", ".", "column", "\n", "# If positive, go to the right, if negative, left", "\n", "if", "cols_diff", ">", "0", ":", "\n", "        ", "col_dir", "=", "East", "\n", "", "elif", "cols_diff", "<", "0", ":", "\n", "        ", "col_dir", "=", "West", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.simulate_planner": [[895, 922], ["dsl.Sequence", "range", "range", "abs", "dsl.Sequence.append", "abs", "dsl.Sequence.append"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.abs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.abs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["# If positive, go down, if negative, up", "\n", "if", "rows_diff", ">", "0", ":", "\n", "        ", "row_dir", "=", "South", "\n", "", "elif", "rows_diff", "<", "0", ":", "\n", "        ", "row_dir", "=", "North", "\n", "\n", "", "for", "col", "in", "range", "(", "abs", "(", "cols_diff", ")", ")", ":", "\n", "        ", "sequence", ".", "append", "(", "col_dir", ")", "\n", "", "for", "row", "in", "range", "(", "abs", "(", "rows_diff", ")", ")", ":", "\n", "        ", "sequence", ".", "append", "(", "row_dir", ")", "\n", "\n", "", "return", "sequence", "\n", "\n", "\n", "", "def", "apply_lsystem", "(", "sequence", ":", "Sequence", ",", "\n", "l_system", ":", "LSystem", ",", "recursion", ":", "int", ",", "max_recursion", ":", "int", ")", ":", "\n", "    ", "\"\"\"\n    Apply's an L-system to the passed sequence for `max_recursion` times.\n    :param sequence: The sequence to apply the LSystem on.\n    :param l_system: a finished L-system with a set of rules and terminal rules.\n    :param recursion: the current recursion.\n    :param max_recursion: the maximum recursion.\n    \"\"\"", "\n", "if", "not", "l_system", ".", "is_finished", ":", "\n", "        ", "raise", "ValueError", "(", "\"Cannot apply an unfinished L-system.\"", ")", "\n", "", "if", "max_recursion", "<", "0", ":", "\n", "        ", "return", "\n", "# Apply the non-terminal rules, from longest to shortest.", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem": [[924, 949], ["ValueError", "l_system.nonterminal_rules", "sequence.unset_replaced", "dsl.apply_lsystem", "l_system.terminal_rules", "dsl.apply_rule", "dsl.apply_rule"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.nonterminal_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.unset_replaced", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.terminal_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_rule"], ["        ", "for", "rule", "in", "l_system", ".", "nonterminal_rules", "(", ")", ":", "\n", "            ", "apply_rule", "(", "sequence", ",", "rule", ")", "\n", "# The next iteration, all symbols can be replaced again.", "\n", "", "sequence", ".", "unset_replaced", "(", ")", "\n", "return", "apply_lsystem", "(", "sequence", ",", "l_system", ",", "recursion", "+", "1", ",", "max_recursion", ")", "\n", "# If all non-terminal rules are applied max-recursion times,", "\n", "# apply terminal rules, longest to shortest.", "\n", "", "else", ":", "\n", "        ", "for", "rule", "in", "l_system", ".", "terminal_rules", "(", ")", ":", "\n", "            ", "apply_rule", "(", "sequence", ",", "rule", ")", "\n", "\n", "\n", "", "", "", "def", "replace_nonterminal", "(", "l_system", ":", "LSystem", ",", "replace_with", ":", "Sequence", ")", ":", "\n", "    ", "if", "not", "l_system", ".", "is_finished", ":", "\n", "        ", "raise", "ValueError", "(", "\"Cannot replace NTs for an unfinished LSystem. Call .finish_l_system() first.\"", ")", "\n", "\n", "", "nonterminal_rules", "=", "deepcopy", "(", "l_system", ".", "nonterminal_rules", "(", ")", ")", "\n", "new_l_system", "=", "LSystem", "(", ")", "\n", "for", "rule", "in", "nonterminal_rules", ":", "\n", "        ", "first_nonterminal", "=", "rule", ".", "rhs", ".", "get_start", "(", ")", "\n", "while", "first_nonterminal", ".", "get", "(", ")", "!=", "ACTION", ":", "\n", "            ", "first_nonterminal", "=", "first_nonterminal", ".", "get_next", "(", ")", "\n", "", "rule", ".", "rhs", ".", "replace", "(", "first_nonterminal", ",", "lhs_length", "=", "len", "(", "rule", ".", "rhs", ")", ",", "rhs", "=", "replace_with", ")", "\n", "new_l_system", ".", "add_rule", "(", "rule", ",", "terminal_rule", "=", "False", ")", "\n", "", "new_l_system", ".", "finish_l_system", "(", ")", "\n", "return", "new_l_system", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.replace_nonterminal": [[951, 965], ["copy.deepcopy", "dsl.LSystem", "dsl.LSystem.finish_l_system", "ValueError", "l_system.nonterminal_rules", "rule.rhs.get_start", "rule.rhs.replace", "dsl.LSystem.add_rule", "first_nonterminal.get_next.get", "first_nonterminal.get_next.get_next", "len"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.nonterminal_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_start", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.replace", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_next"], ["\n", "", "def", "apply_recursion", "(", "l_system", ":", "LSystem", ",", "max_recursion", ":", "int", ")", "->", "LSystem", ":", "\n", "    ", "\"\"\"\n    Apply's a recursion to each rule in the L-system, for `max_recursion` times.\n    :param sequence: The sequence to apply the LSystem on.\n    :param l_system: a finished L-system with a set of rules and terminal rules.\n    :param recursion: the current recursion.\n    :param max_recursion: the maximum recursion.\n\n    Returns: a new L-system with the rules replaced with the recursively changed ones.\n    \"\"\"", "\n", "if", "not", "l_system", ".", "is_finished", ":", "\n", "        ", "raise", "ValueError", "(", "\"Cannot apply an unfinished L-system.\"", ")", "\n", "", "if", "max_recursion", "<=", "0", ":", "\n", "        ", "return", "l_system", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_recursion": [[967, 1000], ["copy.deepcopy", "range", "enumerate", "dsl.LSystem", "dsl.LSystem.finish_l_system", "ValueError", "l_system.nonterminal_rules", "enumerate", "l_system.terminal_rules", "dsl.LSystem.add_rule", "l_system.nonterminal_rules", "dsl.apply_rule", "nt_rule.rhs.unset_replaced", "dsl.apply_rule", "nt_rule.lhs.unset_replaced", "dsl.apply_rule", "nonterminal_rules[].rhs.unset_replaced"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.nonterminal_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.terminal_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.nonterminal_rules", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.unset_replaced", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.unset_replaced", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.unset_replaced"], ["", "nonterminal_rules", "=", "deepcopy", "(", "l_system", ".", "nonterminal_rules", "(", ")", ")", "\n", "# Apply the non-terminal rules, from longest to shortest.", "\n", "for", "recursion", "in", "range", "(", "max_recursion", "-", "1", ")", ":", "\n", "        ", "for", "i", ",", "rule", "in", "enumerate", "(", "l_system", ".", "nonterminal_rules", "(", ")", ")", ":", "\n", "            ", "if", "rule", ".", "recursive", ":", "\n", "                ", "apply_rule", "(", "nonterminal_rules", "[", "i", "]", ".", "rhs", ",", "rule", ")", "\n", "nonterminal_rules", "[", "i", "]", ".", "rhs", ".", "unset_replaced", "(", ")", "\n", "", "", "", "for", "i", ",", "rule", "in", "enumerate", "(", "l_system", ".", "terminal_rules", "(", ")", ")", ":", "\n", "        ", "for", "nt_rule", "in", "nonterminal_rules", ":", "\n", "            ", "apply_rule", "(", "nt_rule", ".", "rhs", ",", "rule", ")", "\n", "nt_rule", ".", "rhs", ".", "unset_replaced", "(", ")", "\n", "apply_rule", "(", "nt_rule", ".", "lhs", ",", "rule", ")", "\n", "nt_rule", ".", "lhs", ".", "unset_replaced", "(", ")", "\n", "", "", "new_l_system", "=", "LSystem", "(", ")", "\n", "for", "rule", "in", "nonterminal_rules", ":", "\n", "        ", "new_l_system", ".", "add_rule", "(", "rule", ")", "\n", "", "new_l_system", ".", "finish_l_system", "(", ")", "\n", "return", "new_l_system", "\n", "\n", "\n", "", "class", "MetaGrammarFunctions", "(", "object", ")", ":", "\n", "\n", "    ", "def", "__init__", "(", "self", ")", ":", "\n", "\n", "        ", "pass", "\n", "\n", "", "def", "min", "(", "self", ",", "x", ":", "int", ",", "y", ":", "int", ")", "->", "int", ":", "\n", "        ", "return", "min", "(", "x", ",", "y", ")", "\n", "\n", "", "def", "abs", "(", "self", ",", "x", ":", "int", ")", "->", "int", ":", "\n", "        ", "return", "abs", "(", "x", ")", "\n", "\n", "", "def", "max", "(", "self", ",", "x", ":", "int", ",", "y", ":", "int", ")", "->", "int", ":", "\n", "        ", "return", "max", "(", "x", ",", "y", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.convert_sequence_to_actions": [[1111, 1144], ["dsl.MetaGrammarFunctions", "dsl.Sequence", "sequence.iterate", "symbol_node.get", "SYMBOL_CONVERT.keys", "dsl.MetaGrammarFunctions.turn_to_dir", "dsl.Sequence.extend", "dsl.Sequence.append", "dsl.MetaGrammarFunctions.is_transitive", "dsl.MetaGrammarFunctions.turn_to_dir", "dsl.Sequence.extend", "dsl.Sequence.append", "dsl.MetaGrammarFunctions.is_turn", "dsl.Sequence.append", "dsl.MetaGrammarFunctions.new_dir"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.iterate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.turn_to_dir", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.is_transitive", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.turn_to_dir", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.extend", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.is_turn", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.new_dir"], ["if", "symbol", "in", "SYMBOL_CONVERT", ".", "keys", "(", ")", ":", "\n", "            ", "turn_actions", "=", "meta_functions", ".", "turn_to_dir", "(", "current_agent_dir", ",", "\n", "SYMBOL_CONVERT", "[", "symbol", "]", ")", "\n", "new_sequence", ".", "extend", "(", "turn_actions", ")", "\n", "new_sequence", ".", "append", "(", "Walk", ")", "\n", "current_agent_dir", "=", "SYMBOL_CONVERT", "[", "symbol", "]", "\n", "previous_walking_direction", "=", "current_agent_dir", "\n", "", "elif", "meta_functions", ".", "is_transitive", "(", "symbol", ".", "name", ")", ":", "\n", "            ", "turn_actions", "=", "meta_functions", ".", "turn_to_dir", "(", "current_agent_dir", ",", "\n", "previous_walking_direction", ")", "\n", "new_sequence", ".", "extend", "(", "turn_actions", ")", "\n", "new_sequence", ".", "append", "(", "symbol", ")", "\n", "current_agent_dir", "=", "previous_walking_direction", "\n", "", "else", ":", "\n", "            ", "if", "meta_functions", ".", "is_turn", "(", "symbol", ".", "name", ")", ":", "\n", "                ", "current_agent_dir", "=", "meta_functions", ".", "new_dir", "(", "current_agent_dir", ",", "symbol", ".", "name", ")", "\n", "", "new_sequence", ".", "append", "(", "symbol", ")", "\n", "", "", "return", "new_sequence", "\n", "\n", "\n", "", "def", "get_free_cells_in_direction", "(", "from_position", ":", "Position", ",", "direction", ":", "Direction", ",", "\n", "grid", ":", "Grid", ")", "->", "int", ":", "\n", "    ", "\"\"\"\n\n    :param from_position: the position in the grid to start from\n    :param direction: the direction to look for free cells\n    :param grid: the class with the initialized grid with objects\n    :return: an integer with the numnber of free cells\n    \"\"\"", "\n", "num_actions", "=", "0", "\n", "grid_size", "=", "grid", ".", "width", "\n", "target_pos", "=", "(", "from_position", ".", "column", ",", "from_position", ".", "row", ")", "\n", "current_pos", "=", "target_pos", "\n", "object_at_next_cell", "=", "False", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_free_cells_in_direction": [[1146, 1169], ["grid.get"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["        ", "current_pos", "=", "current_pos", "+", "DIR_TO_VEC", "[", "DIR_TO_INT", "[", "direction", "]", "]", "\n", "if", "0", "<=", "current_pos", "[", "1", "]", "<", "grid_size", "and", "0", "<=", "current_pos", "[", "0", "]", "<", "grid_size", ":", "\n", "            ", "object_at_next_cell", "=", "grid", ".", "get", "(", "*", "current_pos", ")", "\n", "if", "not", "object_at_next_cell", ":", "\n", "                ", "num_actions", "+=", "1", "\n", "", "", "else", ":", "\n", "            ", "object_at_next_cell", "=", "True", "\n", "", "", "return", "num_actions", "\n", "\n", "\n", "", "def", "get_num_push_actions", "(", "last_move_direction", ":", "Direction", ",", "target_position", ":", "Position", ",", "\n", "grid", ":", "Grid", ")", "->", "int", ":", "\n", "    ", "\"\"\"\n\n    :param last_move_direction: last direction the agent moved in\n    :param target_position: the column and row of the target\n    :param grid: the class with the initialized grid with objects\n    :return: an integer denoting how many free space there is between\n    the target and the direction it can move in.\n    \"\"\"", "\n", "num_actions", "=", "get_free_cells_in_direction", "(", "target_position", ",", "last_move_direction", ",", "\n", "grid", ")", "\n", "return", "num_actions", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_num_push_actions": [[1171, 1184], ["dsl.get_free_cells_in_direction"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_free_cells_in_direction"], ["", "def", "get_num_pull_actions", "(", "last_move_direction", ":", "Direction", ",", "target_position", ":", "Position", ",", "\n", "grid", ":", "Grid", ")", "->", "int", ":", "\n", "    ", "\"\"\"\n\n    :param last_move_direction: last direction the agent moved in\n    :param target_position: the column and row of the target\n    :param grid: the class with the initialized grid with objects\n    :return: an integer denoting how many free space there is between\n    the target and the direction it can move in.\n    \"\"\"", "\n", "opposite_direction", "=", "INT_TO_DIR", "[", "(", "DIR_TO_INT", "[", "last_move_direction", "]", "+", "2", ")", "%", "4", "]", "\n", "num_actions", "=", "get_free_cells_in_direction", "(", "target_position", ",", "opposite_direction", ",", "\n", "grid", ")", "\n", "return", "num_actions", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_num_pull_actions": [[1186, 1200], ["dsl.get_free_cells_in_direction"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.get_free_cells_in_direction"], ["\n", "", "def", "remove_out_of_grid", "(", "direction_sequence", ":", "Sequence", ",", "\n", "grid_size", ":", "int", ",", "start_position", ":", "Position", ")", ":", "\n", "    ", "start_pos", "=", "(", "start_position", ".", "column", ",", "start_position", ".", "row", ")", "\n", "current_pos", "=", "start_pos", "\n", "to_delete", "=", "[", "]", "\n", "direction_node", "=", "direction_sequence", ".", "get_start", "(", ")", "\n", "while", "direction_node", ":", "\n", "        ", "symbol", "=", "direction_node", ".", "get", "(", ")", "\n", "if", "symbol", "in", "SYMBOL_CONVERT", ".", "keys", "(", ")", ":", "\n", "            ", "direction", "=", "SYMBOL_CONVERT", "[", "symbol", "]", "\n", "if", "direction", "in", "to_delete", ":", "\n", "                ", "direction_node", "=", "direction_sequence", ".", "delete_node", "(", "direction_node", ")", "\n", "to_delete", ".", "remove", "(", "direction", ")", "\n", "", "else", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.remove_out_of_grid": [[1202, 1227], ["direction_sequence.get_start", "direction_node.get_next.get", "SYMBOL_CONVERT.keys", "direction_node.get_next.get_next", "direction_sequence.delete_node", "to_delete.remove", "to_delete.append", "direction_sequence.delete_node", "direction_node.get_next.get_next"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_start", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_next", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.delete_node", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.delete_node", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Node.get_next"], ["next_col", ",", "next_row", "=", "next_pos", "\n", "if", "not", "0", "<=", "next_col", "<=", "grid_size", "-", "1", "or", "not", "0", "<=", "next_row", "<=", "grid_size", "-", "1", ":", "\n", "                    ", "opposite_direction", "=", "GET_OPPOSITE_DIR", "[", "direction", "]", "\n", "to_delete", ".", "append", "(", "opposite_direction", ")", "\n", "direction_node", "=", "direction_sequence", ".", "delete_node", "(", "direction_node", ")", "\n", "", "else", ":", "\n", "                    ", "current_pos", "=", "next_pos", "\n", "direction_node", "=", "direction_node", ".", "get_next", "(", ")", "\n", "", "", "", "else", ":", "\n", "            ", "direction_node", "=", "direction_node", ".", "get_next", "(", ")", "\n", "\n", "\n", "", "", "", "class", "Gscan", "(", "object", ")", ":", "\n", "\n", "    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "meta_grammar", "=", "MetaGrammar", "(", ")", "\n", "self", ".", "_hesitantly", "=", "LSystem", "(", ")", "\n", "self", ".", "_hesitantly", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"Walk\"", ",", "\n", "rhs_str", "=", "\"Walk ACTION\"", ")", ")", "\n", "self", ".", "_hesitantly", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"Push\"", ",", "\n", "rhs_str", "=", "\"Push ACTION\"", ")", ")", "\n", "self", ".", "_hesitantly", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"Pull\"", ",", "\n", "rhs_str", "=", "\"Pull ACTION\"", ")", ")", "\n", "self", ".", "_hesitantly", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"ACTION\"", ",", "\n", "rhs_str", "=", "\"Stay\"", ")", ",", "\n", "terminal_rule", "=", "True", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.get_adverb_world_states": [[1513, 1580], ["dataset.GroundedScan._world.get_current_situation", "dataset.GroundedScan.reset_dataset", "dataset.GroundedScan.generate_situations", "dataset.GroundedScan.generate_all_commands", "dataset.GroundedScan._grammar.all_derivations.items", "dataset.GroundedScan.initialize_world", "derivation.meaning", "arguments.pop().to_predicate", "dataset.GroundedScan.generate_possible_targets", "derivation.words", "len", "enumerate", "arguments.pop", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.get_adverbs", "dataset.GroundedScan.initialize_world_from_spec", "dataset.GroundedScan._world.get_current_situation", "all_data.append", "dataset.GroundedScan._world.clear_situation", "logger.info", "dataset.GroundedScan.command_repr", "dataset.GroundedScan.command_repr", "dataset.GroundedScan.derivation_repr", "dataset.GroundedScan.to_representation", "dataset.GroundedScan._vocabulary.translate_word", "derivation.words", "dataset.GroundedScan.meaning_command", "derivation.words", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word", "dataset.GroundedScan._vocabulary.translate_word"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.reset_dataset", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_situations", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_all_commands", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.meaning", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.LogicalForm.to_predicate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.generate_possible_targets", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.get_adverbs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.initialize_world_from_spec", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.get_current_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.world.World.clear_situation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.command_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.derivation_repr", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.to_representation", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset.GroundedScan.meaning_command", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.grammar.Derivation.words", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.vocabulary.Vocabulary.translate_word"], []], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.parse_gscan_example": [[1085, 1111], ["dsl.Gscan.walk", "dsl.convert_sequence_to_actions", "convert_sequence_to_actions.get_gscan_actions", "dsl.Gscan.zigzag", "dsl.Gscan.push", "dsl.Gscan.spin", "dsl.Gscan.cautiously", "dsl.Gscan.hesitantly", "abs", "dsl.Gscan.pull"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.walk", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.convert_sequence_to_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.get_gscan_actions", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.zigzag", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.push", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.spin", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.cautiously", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.hesitantly", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.abs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Gscan.pull"], ["return", "position", "\n", "", "if", "direction", "==", "SOUTH", ":", "\n", "            ", "position", "=", "Position", "(", "column", "=", "position", ".", "column", ",", "\n", "row", "=", "position", ".", "row", "+", "1", ")", "\n", "return", "position", "\n", "", "if", "direction", "==", "WEST", ":", "\n", "            ", "position", "=", "Position", "(", "column", "=", "position", ".", "column", "-", "1", ",", "\n", "row", "=", "position", ".", "row", ")", "\n", "return", "position", "\n", "\n", "\n", "", "", "", "def", "convert_sequence_to_actions", "(", "sequence", ":", "Sequence", ",", "\n", "agent_start_dir", ":", "Direction", ")", "->", "Sequence", ":", "\n", "    ", "\"\"\"\n    Converts a sequence containing East, West, North, South\n    to a sequence of actions from an agents perspective\n    :param sequence: a sequence of steps in the form of East, South, North, West symbols.\n    :param agent_start_dir: direction that the agent starts facing.\n    :return: a sequence of actions in the form of Tl, Walk, Tr symbols.\n    \"\"\"", "\n", "meta_functions", "=", "MetaGrammarFunctions", "(", ")", "\n", "new_sequence", "=", "Sequence", "(", ")", "\n", "current_agent_dir", "=", "agent_start_dir", "\n", "previous_walking_direction", "=", "None", "\n", "for", "symbol_node", "in", "sequence", ".", "iterate", "(", ")", ":", "\n", "        ", "symbol", "=", "symbol_node", ".", "get", "(", ")", "\n", "if", "symbol", "in", "SYMBOL_CONVERT", ".", "keys", "(", ")", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.sample_adverb": [[1241, 1243], ["NotImplementedError"], "methods", ["None"], ["self", ".", "_cautiously", ".", "add_rule", "(", "meta_grammar", ".", "get_rule", "(", "lhs_str", "=", "\"ACTION\"", ",", "\n", "rhs_str", "=", "\"Tl\"", ")", ",", "\n", "terminal_rule", "=", "True", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.sample_l_system": [[1396, 1398], ["None"], "methods", ["None"], ["num_pull", "=", "get_num_pull_actions", "(", "last_direction", ",", "target_position", ",", "grid", ")", "\n", "if", "heavy", ":", "\n", "            ", "num_pull", "*=", "2", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.ReseedWrapper.__init__": [[18, 22], ["list", "super().__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "env", ",", "seeds", "=", "[", "0", "]", ",", "seed_idx", "=", "0", ")", ":", "\n", "        ", "self", ".", "seeds", "=", "list", "(", "seeds", ")", "\n", "self", ".", "seed_idx", "=", "seed_idx", "\n", "super", "(", ")", ".", "__init__", "(", "env", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.ReseedWrapper.reset": [[23, 28], ["wrappers.ReseedWrapper.env.seed", "wrappers.ReseedWrapper.env.reset", "len"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.seed", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.reset"], ["", "def", "reset", "(", "self", ",", "**", "kwargs", ")", ":", "\n", "        ", "seed", "=", "self", ".", "seeds", "[", "self", ".", "seed_idx", "]", "\n", "self", ".", "seed_idx", "=", "(", "self", ".", "seed_idx", "+", "1", ")", "%", "len", "(", "self", ".", "seeds", ")", "\n", "self", ".", "env", ".", "seed", "(", "seed", ")", "\n", "return", "self", ".", "env", ".", "reset", "(", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.ReseedWrapper.step": [[29, 32], ["wrappers.ReseedWrapper.env.step"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.step"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "obs", ",", "reward", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "return", "obs", ",", "reward", ",", "done", ",", "info", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.ActionBonus.__init__": [[40, 43], ["super().__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "env", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "env", ")", "\n", "self", ".", "counts", "=", "{", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.ActionBonus.step": [[44, 63], ["wrappers.ActionBonus.env.step", "tuple", "math.sqrt"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.step"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "obs", ",", "reward", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "\n", "env", "=", "self", ".", "unwrapped", "\n", "tup", "=", "(", "tuple", "(", "env", ".", "agent_pos", ")", ",", "env", ".", "agent_dir", ",", "action", ")", "\n", "\n", "# Get the count for this (s,a) pair", "\n", "pre_count", "=", "0", "\n", "if", "tup", "in", "self", ".", "counts", ":", "\n", "            ", "pre_count", "=", "self", ".", "counts", "[", "tup", "]", "\n", "\n", "# Update the count for this (s,a) pair", "\n", "", "new_count", "=", "pre_count", "+", "1", "\n", "self", ".", "counts", "[", "tup", "]", "=", "new_count", "\n", "\n", "bonus", "=", "1", "/", "math", ".", "sqrt", "(", "new_count", ")", "\n", "reward", "+=", "bonus", "\n", "\n", "return", "obs", ",", "reward", ",", "done", ",", "info", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.ActionBonus.reset": [[64, 66], ["wrappers.ActionBonus.env.reset"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.reset"], ["", "def", "reset", "(", "self", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "env", ".", "reset", "(", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.StateBonus.__init__": [[73, 76], ["super().__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "env", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "env", ")", "\n", "self", ".", "counts", "=", "{", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.StateBonus.step": [[77, 98], ["wrappers.StateBonus.env.step", "tuple", "math.sqrt"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.step"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "obs", ",", "reward", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "\n", "# Tuple based on which we index the counts", "\n", "# We use the position after an update", "\n", "env", "=", "self", ".", "unwrapped", "\n", "tup", "=", "(", "tuple", "(", "env", ".", "agent_pos", ")", ")", "\n", "\n", "# Get the count for this key", "\n", "pre_count", "=", "0", "\n", "if", "tup", "in", "self", ".", "counts", ":", "\n", "            ", "pre_count", "=", "self", ".", "counts", "[", "tup", "]", "\n", "\n", "# Update the count for this key", "\n", "", "new_count", "=", "pre_count", "+", "1", "\n", "self", ".", "counts", "[", "tup", "]", "=", "new_count", "\n", "\n", "bonus", "=", "1", "/", "math", ".", "sqrt", "(", "new_count", ")", "\n", "reward", "+=", "bonus", "\n", "\n", "return", "obs", ",", "reward", ",", "done", ",", "info", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.StateBonus.reset": [[99, 101], ["wrappers.StateBonus.env.reset"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.reset"], ["", "def", "reset", "(", "self", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "env", ".", "reset", "(", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.ImgObsWrapper.__init__": [[107, 111], ["super().__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "env", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "env", ")", "\n", "\n", "self", ".", "observation_space", "=", "env", ".", "observation_space", ".", "spaces", "[", "'image'", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.ImgObsWrapper.observation": [[112, 114], ["None"], "methods", ["None"], ["", "def", "observation", "(", "self", ",", "obs", ")", ":", "\n", "        ", "return", "obs", "[", "'image'", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.RGBImgObsWrapper.__init__": [[122, 132], ["super().__init__", "gym.spaces.Box"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "env", ",", "tile_size", "=", "8", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "env", ")", "\n", "\n", "self", ".", "tile_size", "=", "tile_size", "\n", "\n", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "\n", "low", "=", "0", ",", "\n", "high", "=", "255", ",", "\n", "shape", "=", "(", "self", ".", "env", ".", "width", "*", "tile_size", ",", "self", ".", "env", ".", "height", "*", "tile_size", ",", "3", ")", ",", "\n", "dtype", "=", "'uint8'", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.RGBImgObsWrapper.observation": [[134, 140], ["env.render"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.render"], ["", "def", "observation", "(", "self", ",", "obs", ")", ":", "\n", "        ", "env", "=", "self", ".", "unwrapped", "\n", "return", "env", ".", "render", "(", "\n", "mode", "=", "'rgb_array'", ",", "\n", "highlight", "=", "False", ",", "\n", "tile_size", "=", "self", ".", "tile_size", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.FullyObsWrapper.__init__": [[147, 155], ["super().__init__", "gym.spaces.Box"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "env", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "env", ")", "\n", "\n", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "\n", "low", "=", "0", ",", "\n", "high", "=", "255", ",", "\n", "shape", "=", "(", "self", ".", "env", ".", "width", ",", "self", ".", "env", ".", "height", ",", "3", ")", ",", "# number of cells", "\n", "dtype", "=", "'uint8'", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.FullyObsWrapper.observation": [[157, 167], ["env.grid.encode", "numpy.array"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.encode"], ["", "def", "observation", "(", "self", ",", "obs", ")", ":", "\n", "        ", "env", "=", "self", ".", "unwrapped", "\n", "full_grid", "=", "env", ".", "grid", ".", "encode", "(", ")", "\n", "full_grid", "[", "env", ".", "agent_pos", "[", "0", "]", "]", "[", "env", ".", "agent_pos", "[", "1", "]", "]", "=", "np", ".", "array", "(", "[", "\n", "OBJECT_TO_IDX", "[", "'agent'", "]", ",", "\n", "COLOR_TO_IDX", "[", "'red'", "]", ",", "\n", "env", ".", "agent_dir", "\n", "]", ")", "\n", "\n", "return", "full_grid", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.FlatObsWrapper.__init__": [[174, 192], ["super().__init__", "functools.reduce", "gym.spaces.Box"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "env", ",", "maxStrLen", "=", "96", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "env", ")", "\n", "\n", "self", ".", "maxStrLen", "=", "maxStrLen", "\n", "self", ".", "numCharCodes", "=", "27", "\n", "\n", "imgSpace", "=", "env", ".", "observation_space", ".", "spaces", "[", "'image'", "]", "\n", "imgSize", "=", "reduce", "(", "operator", ".", "mul", ",", "imgSpace", ".", "shape", ",", "1", ")", "\n", "\n", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "\n", "low", "=", "0", ",", "\n", "high", "=", "255", ",", "\n", "shape", "=", "(", "1", ",", "imgSize", "+", "self", ".", "numCharCodes", "*", "self", ".", "maxStrLen", ")", ",", "\n", "dtype", "=", "'uint8'", "\n", ")", "\n", "\n", "self", ".", "cachedStr", "=", "None", "\n", "self", ".", "cachedArray", "=", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.FlatObsWrapper.observation": [[193, 218], ["numpy.concatenate", "mission.lower.lower.lower", "numpy.zeros", "enumerate", "len", "len", "image.flatten", "wrappers.FlatObsWrapper.cachedArray.flatten", "ord", "ord", "ord", "ord"], "methods", ["None"], ["", "def", "observation", "(", "self", ",", "obs", ")", ":", "\n", "        ", "image", "=", "obs", "[", "'image'", "]", "\n", "mission", "=", "obs", "[", "'mission'", "]", "\n", "\n", "# Cache the last-encoded mission string", "\n", "if", "mission", "!=", "self", ".", "cachedStr", ":", "\n", "            ", "assert", "len", "(", "mission", ")", "<=", "self", ".", "maxStrLen", ",", "'mission string too long ({} chars)'", ".", "format", "(", "len", "(", "mission", ")", ")", "\n", "mission", "=", "mission", ".", "lower", "(", ")", "\n", "\n", "strArray", "=", "np", ".", "zeros", "(", "shape", "=", "(", "self", ".", "maxStrLen", ",", "self", ".", "numCharCodes", ")", ",", "dtype", "=", "'float32'", ")", "\n", "\n", "for", "idx", ",", "ch", "in", "enumerate", "(", "mission", ")", ":", "\n", "                ", "if", "ch", ">=", "'a'", "and", "ch", "<=", "'z'", ":", "\n", "                    ", "chNo", "=", "ord", "(", "ch", ")", "-", "ord", "(", "'a'", ")", "\n", "", "elif", "ch", "==", "' '", ":", "\n", "                    ", "chNo", "=", "ord", "(", "'z'", ")", "-", "ord", "(", "'a'", ")", "+", "1", "\n", "", "assert", "chNo", "<", "self", ".", "numCharCodes", ",", "'%s : %d'", "%", "(", "ch", ",", "chNo", ")", "\n", "strArray", "[", "idx", ",", "chNo", "]", "=", "1", "\n", "\n", "", "self", ".", "cachedStr", "=", "mission", "\n", "self", ".", "cachedArray", "=", "strArray", "\n", "\n", "", "obs", "=", "np", ".", "concatenate", "(", "(", "image", ".", "flatten", "(", ")", ",", "self", ".", "cachedArray", ".", "flatten", "(", ")", ")", ")", "\n", "\n", "return", "obs", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.AgentViewWrapper.__init__": [[224, 241], ["super().__init__", "gym.spaces.Box", "gym.spaces.Dict"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "env", ",", "agent_view_size", "=", "7", ")", ":", "\n", "        ", "super", "(", "AgentViewWrapper", ",", "self", ")", ".", "__init__", "(", "env", ")", "\n", "\n", "# Override default view size", "\n", "env", ".", "unwrapped", ".", "agent_view_size", "=", "agent_view_size", "\n", "\n", "# Compute observation space with specified view size", "\n", "observation_space", "=", "gym", ".", "spaces", ".", "Box", "(", "\n", "low", "=", "0", ",", "\n", "high", "=", "255", ",", "\n", "shape", "=", "(", "agent_view_size", ",", "agent_view_size", ",", "3", ")", ",", "\n", "dtype", "=", "'uint8'", "\n", ")", "\n", "\n", "# Override the environment's observation space", "\n", "self", ".", "observation_space", "=", "spaces", ".", "Dict", "(", "{", "\n", "'image'", ":", "observation_space", "\n", "}", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.AgentViewWrapper.reset": [[243, 245], ["wrappers.AgentViewWrapper.env.reset"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.reset"], ["", "def", "reset", "(", "self", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "env", ".", "reset", "(", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.wrappers.AgentViewWrapper.step": [[246, 248], ["wrappers.AgentViewWrapper.env.step"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.step"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "return", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dataset_test.test_compare_gscan_lsystems": [[1636, 1732], ["time.time", "GroundedScan.AdverbWorld", "GroundedScan.LSystem", "GroundedScan.MetaGrammar", "dsl.apply_recursion.add_rule", "dsl.apply_recursion.add_rule", "dsl.apply_recursion.add_rule", "dsl.apply_recursion.add_rule", "dsl.apply_recursion.finish_l_system", "GroundedScan.apply_recursion", "GroundedScan.LSystem", "dsl.apply_recursion.add_rule", "dsl.apply_recursion.add_rule", "dsl.apply_recursion.add_rule", "dsl.apply_recursion.add_rule", "dsl.apply_recursion.add_rule", "dsl.apply_recursion.finish_l_system", "GroundedScan.apply_recursion", "GroundedScan.LRule", "GroundedScan.LRule", "GroundedScan.LRule", "GroundedScan.LSystem", "dsl.LSystem.add_rule", "dsl.LSystem.add_rule", "dsl.LSystem.add_rule", "dsl.LSystem.finish_l_system", "GroundedScan.LSystem", "dsl.apply_recursion.add_rule", "dsl.apply_recursion.add_rule", "dsl.apply_recursion.add_rule", "dsl.apply_recursion.add_rule", "dsl.apply_recursion.add_rule", "dsl.apply_recursion.add_rule", "dsl.apply_recursion.add_rule", "dsl.apply_recursion.finish_l_system", "GroundedScan.apply_recursion", "GroundedScan.LSystem", "dsl.LSystem.add_rule", "dsl.LSystem.add_rule", "dsl.LSystem.add_rule", "dsl.LSystem.add_rule", "dsl.LSystem.finish_l_system", "time.time", "logger.info", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.MetaGrammar.get_rule", "dsl.AdverbWorld.get_adverb_program", "dsl.AdverbWorld.is_gscan_lsystem", "dsl.AdverbWorld.is_gscan_lsystem", "GroundedScan.Lhs", "GroundedScan.Rhs", "GroundedScan.Lhs", "GroundedScan.Rhs", "GroundedScan.Lhs", "GroundedScan.Rhs", "dsl.apply_recursion.convert_rule_side", "dsl.apply_recursion.convert_rule_side", "dsl.apply_recursion.convert_rule_side", "dsl.apply_recursion.convert_rule_side", "dsl.apply_recursion.convert_rule_side", "dsl.apply_recursion.convert_rule_side"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_recursion", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_recursion", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.apply_recursion", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.add_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.finish_l_system", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammar.get_rule", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.get_adverb_program", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.is_gscan_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.AdverbWorld.is_gscan_lsystem", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.convert_rule_side", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.convert_rule_side", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.convert_rule_side", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.convert_rule_side", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.convert_rule_side", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.convert_rule_side"], ["num_train_examples_per_test_adverb", "=", "50", ",", "\n", "grid_size", "=", "6", ",", "\n", "make_dev_set", "=", "True", ",", "\n", "use_gscan_adverbs", "=", "True", ")", "\n", "\n", "save_path", "=", "adverb_world", ".", "save_adverb_challenge", "(", "\"adverb_challenge.txt\"", ")", "\n", "logger", ".", "info", "(", "\"Saved adverb challenge at %s\"", "%", "save_path", ")", "\n", "adverb_world", ".", "save_gscan_statistics", "(", "dev_set", "=", "True", ")", "\n", "\n", "adverb_world_reloaded", "=", "dsl", ".", "AdverbWorld", ".", "load_adverb_challenge", "(", "save_path", ",", "\n", "save_directory", "=", "TEST_DIRECTORY", ")", "\n", "\n", "assert", "adverb_world", ".", "_heldout_adverbs_str", "==", "adverb_world_reloaded", ".", "_heldout_adverbs_str", ",", "\"test_save_and_load_adverb_challenge FAILED. Reloaded heldout adverbs are different: %s before saving, %s after\"", "%", "(", "adverb_world", ".", "_heldout_adverbs_str", ",", "\n", "adverb_world_reloaded", ".", "_heldout_adverbs_str", ")", "\n", "assert", "adverb_world", ".", "_extra_adverbs_str", "==", "adverb_world_reloaded", ".", "_extra_adverbs_str", ",", "\"test_save_and_load_adverb_challenge FAILED. Reloaded extra adverbs are different: %s before saving, %s after\"", "%", "(", "adverb_world", ".", "_extra_adverbs_str", ",", "\n", "adverb_world_reloaded", ".", "_extra_adverbs_str", ")", "\n", "assert", "adverb_world", ".", "seed", "==", "adverb_world_reloaded", ".", "seed", ",", "\"test_save_and_load_adverb_challenge FAILED. Reloaded seed \"", "\"differs from old seed: old seed %d, new seed %d\"", "%", "(", "\n", "adverb_world", ".", "seed", ",", "adverb_world_reloaded", ".", "seed", "\n", ")", "\n", "for", "extra_adverb_str", ",", "extra_adverb_lsystem_spec", "in", "adverb_world", ".", "_extra_adverbs", ".", "items", "(", ")", ":", "\n", "        ", "assert", "extra_adverb_str", "in", "adverb_world_reloaded", ".", "_extra_adverbs", ",", "\"test_save_and_load_adverb_challenge FAILED.\"", "\"did not find adverb %s in reloaded dataset.\"", "%", "extra_adverb_str", "\n", "extra_adverb_lsystem", "=", "extra_adverb_lsystem_spec", "[", "\"program\"", "]", "\n", "old_program", "=", "extra_adverb_lsystem", ".", "to_representation", "(", ")", "\n", "new_program", "=", "adverb_world_reloaded", ".", "_extra_adverbs", "[", "extra_adverb_str", "]", "[", "\"program\"", "]", ".", "to_representation", "(", ")", "\n", "assert", "old_program", "==", "new_program", ",", "\"test_save_and_load_adverb_challenge FAILED. L-System differs for adverb %s\"", "%", "extra_adverb_str", "\n", "\n", "# Compare gSCAN stats", "\n", "", "for", "split", ",", "stats", "in", "adverb_world", ".", "_gscan_dataset", ".", "_data_statistics", ".", "items", "(", ")", ":", "\n", "        ", "other_stats", "=", "adverb_world_reloaded", ".", "_gscan_dataset", ".", "_data_statistics", "[", "split", "]", "\n", "for", "type_stats", ",", "stats", "in", "stats", ".", "items", "(", ")", ":", "\n", "            ", "other_stats_type", "=", "other_stats", "[", "type_stats", "]", "\n", "assert", "stats", "==", "other_stats_type", ",", "\"test_save_and_load_adverb_challenge FAILED. Compare data stats FAILED.\"", "\n", "\n", "# Compare gSCAN examples", "\n", "", "", "for", "split", ",", "examples", "in", "adverb_world", ".", "_gscan_dataset", ".", "_data_pairs", ".", "items", "(", ")", ":", "\n", "        ", "other_examples", "=", "adverb_world_reloaded", ".", "_gscan_dataset", ".", "_data_pairs", "[", "split", "]", "\n", "for", "example_1", ",", "example_2", "in", "zip", "(", "examples", ",", "other_examples", ")", ":", "\n", "            ", "assert", "example_1", "==", "example_2", ",", "\"test_save_and_load_adverb_challenge FAILED. Different examples \"", "\" in split %s\"", "%", "split", "\n", "\n", "# os.remove(os.path.join(TEST_DIRECTORY, \"adverb_challenge.txt\"))", "\n", "# os.remove(os.path.join(TEST_DIRECTORY, \"dataset.txt\"))", "\n", "\n", "", "", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_save_and_load_adverb_challenge PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n", "\n", "", "def", "test_write_and_load_l_systems", "(", ")", ":", "\n", "    ", "start", "=", "time", ".", "time", "(", ")", "\n", "\n", "adverb_world", "=", "dsl", ".", "AdverbWorld", "(", "seed", "=", "1", ",", "save_directory", "=", "TEST_DIRECTORY", ")", "\n", "adverb_world", ".", "populate_adverbs", "(", "max_per_type", "=", "1000", ")", "\n", "\n", "meta_grammar", "=", "dsl", ".", "MetaGrammar", "(", ")", "\n", "\n", "for", "adverb_type", ",", "adverbs", "in", "adverb_world", ".", "_all_adverbs", ".", "items", "(", ")", ":", "\n", "        ", "for", "adverb", "in", "adverbs", ":", "\n", "            ", "start_direction", "=", "random", ".", "randint", "(", "0", ",", "3", ")", "\n", "start_row", "=", "random", ".", "randint", "(", "0", ",", "10", ")", "\n", "start_col", "=", "random", ".", "randint", "(", "0", ",", "10", ")", "\n", "end_row", "=", "random", ".", "randint", "(", "0", ",", "10", ")", "\n", "end_col", "=", "random", ".", "randint", "(", "0", ",", "10", ")", "\n", "start_position", "=", "dsl", ".", "Position", "(", "row", "=", "start_row", ",", "column", "=", "start_col", ")", "\n", "end_position", "=", "dsl", ".", "Position", "(", "row", "=", "end_row", ",", "column", "=", "end_col", ")", "\n", "if", "adverb_type", "==", "\"movement_rewrite\"", ":", "\n", "                ", "recursion_depth", "=", "max", "(", "0", ",", "abs", "(", "end_position", ".", "column", "-", "start_position", ".", "column", ")", "-", "1", ")", "\n", "", "else", ":", "\n", "                ", "recursion_depth", "=", "1", "\n", "", "before_sequence", ",", "_", "=", "adverb_world", ".", "generate_example", "(", "start_position", ",", "\n", "start_direction", ",", "\n", "end_position", ",", "\n", "adverb", ",", "\n", "recursion_depth_system", "=", "0", ",", "\n", "recursion_depth_sequence", "=", "recursion_depth", ",", "\n", "grid_size", "=", "11", ",", "\n", "type_adverb", "=", "adverb_type", ")", "\n", "adverb_repr", "=", "adverb", ".", "to_representation", "(", ")", "\n", "adverb_after", "=", "dsl", ".", "LSystem", ".", "from_representation", "(", "adverb_repr", ",", "meta_grammar", ")", "\n", "after_sequence", ",", "_", "=", "adverb_world", ".", "generate_example", "(", "start_position", ",", "\n", "start_direction", ",", "\n", "end_position", ",", "\n", "adverb_after", ",", "\n", "recursion_depth_system", "=", "0", ",", "\n", "recursion_depth_sequence", "=", "recursion_depth", ",", "\n", "grid_size", "=", "11", ",", "\n", "type_adverb", "=", "adverb_type", ")", "\n", "assert", "\";\"", ".", "join", "(", "before_sequence", ")", "==", "\";\"", ".", "join", "(", "after_sequence", ")", ",", "\"test_write_and_load_l_systems FAILED \"", "\"for adverb type %s\"", "%", "adverb_type", "\n", "", "", "end", "=", "time", ".", "time", "(", ")", "\n", "logger", ".", "info", "(", "\"test_write_and_load_l_systems PASSED in {} seconds\"", ".", "format", "(", "end", "-", "start", ")", ")", "\n", "\n", "\n", "", "def", "test_assign_adverbs", "(", ")", ":", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Window.__init__": [[14, 52], ["PyQt5.QtWidgets.QMainWindow.__init__", "rendering.Window.setWindowTitle", "PyQt5.QtWidgets.QLabel", "rendering.Window.imgLabel.setFrameStyle", "PyQt5.QtWidgets.QTextEdit", "rendering.Window.missionBox.setReadOnly", "rendering.Window.missionBox.setMinimumSize", "PyQt5.QtWidgets.QHBoxLayout", "PyQt5.QtWidgets.QHBoxLayout.addStretch", "PyQt5.QtWidgets.QHBoxLayout.addWidget", "PyQt5.QtWidgets.QHBoxLayout.addStretch", "PyQt5.QtWidgets.QVBoxLayout", "PyQt5.QtWidgets.QVBoxLayout.addLayout", "PyQt5.QtWidgets.QVBoxLayout.addWidget", "PyQt5.QtWidgets.QWidget", "rendering.Window.setCentralWidget", "rendering.Window.mainWidget.setLayout", "rendering.Window.show", "rendering.Window.setFocus"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "setWindowTitle", "(", "'MiniGrid Gym Environment'", ")", "\n", "\n", "# Image label to display the rendering", "\n", "self", ".", "imgLabel", "=", "QLabel", "(", ")", "\n", "self", ".", "imgLabel", ".", "setFrameStyle", "(", "QFrame", ".", "Panel", "|", "QFrame", ".", "Sunken", ")", "\n", "\n", "# Text box for the mission", "\n", "self", ".", "missionBox", "=", "QTextEdit", "(", ")", "\n", "self", ".", "missionBox", ".", "setReadOnly", "(", "True", ")", "\n", "self", ".", "missionBox", ".", "setMinimumSize", "(", "400", ",", "100", ")", "\n", "\n", "# Center the image", "\n", "hbox", "=", "QHBoxLayout", "(", ")", "\n", "hbox", ".", "addStretch", "(", "1", ")", "\n", "hbox", ".", "addWidget", "(", "self", ".", "imgLabel", ")", "\n", "hbox", ".", "addStretch", "(", "1", ")", "\n", "\n", "# Arrange widgets vertically", "\n", "vbox", "=", "QVBoxLayout", "(", ")", "\n", "vbox", ".", "addLayout", "(", "hbox", ")", "\n", "vbox", ".", "addWidget", "(", "self", ".", "missionBox", ")", "\n", "\n", "# Create a main widget for the window", "\n", "self", ".", "mainWidget", "=", "QWidget", "(", "self", ")", "\n", "self", ".", "setCentralWidget", "(", "self", ".", "mainWidget", ")", "\n", "self", ".", "mainWidget", ".", "setLayout", "(", "vbox", ")", "\n", "\n", "# Show the application window", "\n", "self", ".", "show", "(", ")", "\n", "self", ".", "setFocus", "(", ")", "\n", "\n", "self", ".", "closed", "=", "False", "\n", "\n", "# Callback for keyboard events", "\n", "self", ".", "keyDownCb", "=", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Window.closeEvent": [[53, 55], ["None"], "methods", ["None"], ["", "def", "closeEvent", "(", "self", ",", "event", ")", ":", "\n", "        ", "self", ".", "closed", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Window.setPixmap": [[56, 58], ["rendering.Window.imgLabel.setPixmap"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Window.setPixmap"], ["", "def", "setPixmap", "(", "self", ",", "pixmap", ")", ":", "\n", "        ", "self", ".", "imgLabel", ".", "setPixmap", "(", "pixmap", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Window.setText": [[59, 61], ["rendering.Window.missionBox.setPlainText"], "methods", ["None"], ["", "def", "setText", "(", "self", ",", "text", ")", ":", "\n", "        ", "self", ".", "missionBox", ".", "setPlainText", "(", "text", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Window.setKeyDownCb": [[62, 64], ["None"], "methods", ["None"], ["", "def", "setKeyDownCb", "(", "self", ",", "callback", ")", ":", "\n", "        ", "self", ".", "keyDownCb", "=", "callback", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Window.keyPressEvent": [[65, 98], ["rendering.Window.keyDownCb", "e.key", "e.key", "e.key", "e.key", "e.key", "e.key", "e.key", "e.key", "e.key", "e.key", "e.key", "e.key"], "methods", ["None"], ["", "def", "keyPressEvent", "(", "self", ",", "e", ")", ":", "\n", "        ", "if", "self", ".", "keyDownCb", "==", "None", ":", "\n", "            ", "return", "\n", "\n", "", "keyName", "=", "None", "\n", "if", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Left", ":", "\n", "            ", "keyName", "=", "'LEFT'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Right", ":", "\n", "            ", "keyName", "=", "'RIGHT'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Up", ":", "\n", "            ", "keyName", "=", "'UP'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Down", ":", "\n", "            ", "keyName", "=", "'DOWN'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Space", ":", "\n", "            ", "keyName", "=", "'SPACE'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Return", ":", "\n", "            ", "keyName", "=", "'RETURN'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Alt", ":", "\n", "            ", "keyName", "=", "'ALT'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Control", ":", "\n", "            ", "keyName", "=", "'CTRL'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_PageUp", ":", "\n", "            ", "keyName", "=", "'PAGE_UP'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_PageDown", ":", "\n", "            ", "keyName", "=", "'PAGE_DOWN'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Backspace", ":", "\n", "            ", "keyName", "=", "'BACKSPACE'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Escape", ":", "\n", "            ", "keyName", "=", "'ESCAPE'", "\n", "\n", "", "if", "keyName", "==", "None", ":", "\n", "            ", "return", "\n", "", "self", ".", "keyDownCb", "(", "keyName", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.__init__": [[101, 112], ["PyQt5.QtGui.QImage", "PyQt5.QtGui.QPainter", "PyQt5.QtWidgets.QApplication", "rendering.Window"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "width", ",", "height", ",", "ownWindow", "=", "False", ")", ":", "\n", "        ", "self", ".", "width", "=", "width", "\n", "self", ".", "height", "=", "height", "\n", "\n", "self", ".", "img", "=", "QImage", "(", "width", ",", "height", ",", "QImage", ".", "Format_RGB888", ")", "\n", "self", ".", "painter", "=", "QPainter", "(", ")", "\n", "\n", "self", ".", "window", "=", "None", "\n", "if", "ownWindow", ":", "\n", "            ", "self", ".", "app", "=", "QApplication", "(", "[", "]", ")", "\n", "self", ".", "window", "=", "Window", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.close": [[113, 118], ["None"], "methods", ["None"], ["", "", "def", "close", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Deallocate resources used\n        \"\"\"", "\n", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.beginFrame": [[119, 126], ["rendering.Renderer.painter.begin", "rendering.Renderer.painter.setRenderHint", "rendering.Renderer.painter.setBrush", "rendering.Renderer.painter.drawRect", "PyQt5.QtGui.QColor"], "methods", ["None"], ["", "def", "beginFrame", "(", "self", ")", ":", "\n", "        ", "self", ".", "painter", ".", "begin", "(", "self", ".", "img", ")", "\n", "self", ".", "painter", ".", "setRenderHint", "(", "QPainter", ".", "Antialiasing", ",", "False", ")", "\n", "\n", "# Clear the background", "\n", "self", ".", "painter", ".", "setBrush", "(", "QColor", "(", "0", ",", "0", ",", "0", ")", ")", "\n", "self", ".", "painter", ".", "drawRect", "(", "0", ",", "0", ",", "self", ".", "width", "-", "1", ",", "self", ".", "height", "-", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.endFrame": [[127, 136], ["rendering.Renderer.painter.end", "rendering.Renderer.window.setPixmap", "rendering.Renderer.app.processEvents", "rendering.Renderer.getPixmap"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Window.setPixmap", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.getPixmap"], ["", "def", "endFrame", "(", "self", ")", ":", "\n", "        ", "self", ".", "painter", ".", "end", "(", ")", "\n", "\n", "if", "self", ".", "window", ":", "\n", "            ", "if", "self", ".", "window", ".", "closed", ":", "\n", "                ", "self", ".", "window", "=", "None", "\n", "", "else", ":", "\n", "                ", "self", ".", "window", ".", "setPixmap", "(", "self", ".", "getPixmap", "(", ")", ")", "\n", "self", ".", "app", ".", "processEvents", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.getPixmap": [[137, 139], ["PyQt5.QtGui.QPixmap.fromImage"], "methods", ["None"], ["", "", "", "def", "getPixmap", "(", "self", ")", ":", "\n", "        ", "return", "QPixmap", ".", "fromImage", "(", "self", ".", "img", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.save": [[140, 147], ["rendering.Renderer.app.processEvents", "rendering.Renderer.window.show", "PyQt5.QtGui.QPixmap", "rendering.Renderer.window.mainWidget.render", "PyQt5.QtGui.QPixmap.save", "rendering.Renderer.window.mainWidget.size"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.render", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "save", "(", "self", ",", "save_location", ")", ":", "\n", "        ", "self", ".", "app", ".", "processEvents", "(", ")", "\n", "self", ".", "window", ".", "show", "(", ")", "\n", "pix", "=", "QPixmap", "(", "self", ".", "window", ".", "mainWidget", ".", "size", "(", ")", ")", "\n", "self", ".", "window", ".", "mainWidget", ".", "render", "(", "pix", ")", "\n", "success", "=", "pix", ".", "save", "(", "save_location", ")", "\n", "return", "success", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.getArray": [[148, 159], ["rendering.Renderer.img.bits().asstring", "numpy.frombuffer", "output.reshape.reshape.reshape", "rendering.Renderer.img.bits"], "methods", ["None"], ["", "def", "getArray", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Get a numpy array of RGB pixel values.\n        The array will have shape (height, width, 3)\n        \"\"\"", "\n", "\n", "numBytes", "=", "self", ".", "width", "*", "self", ".", "height", "*", "3", "\n", "buf", "=", "self", ".", "img", ".", "bits", "(", ")", ".", "asstring", "(", "numBytes", ")", "\n", "output", "=", "np", ".", "frombuffer", "(", "buf", ",", "dtype", "=", "'uint8'", ")", "\n", "output", "=", "output", ".", "reshape", "(", "(", "self", ".", "height", ",", "self", ".", "width", ",", "3", ")", ")", "\n", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.getFullScreen": [[160, 168], ["PyQt5.QtGui.QPixmap", "rendering.Renderer.window.mainWidget.render", "PyQt5.QtGui.QPixmap.toImage", "PyQt5.QtGui.QPixmap.toImage.bits().asstring", "numpy.fromstring().reshape", "PyQt5.QtGui.QPixmap.save", "rendering.Renderer.window.mainWidget.size", "PyQt5.QtGui.QPixmap.toImage.bits", "numpy.fromstring", "PyQt5.QtGui.QPixmap.toImage.width", "PyQt5.QtGui.QPixmap.toImage.height", "PyQt5.QtGui.QPixmap.toImage.width", "PyQt5.QtGui.QPixmap.toImage.height"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.render", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "getFullScreen", "(", "self", ",", "temp", ")", ":", "\n", "        ", "pix", "=", "QPixmap", "(", "self", ".", "window", ".", "mainWidget", ".", "size", "(", ")", ")", "\n", "self", ".", "window", ".", "mainWidget", ".", "render", "(", "pix", ")", "\n", "image", "=", "pix", ".", "toImage", "(", ")", "\n", "s", "=", "image", ".", "bits", "(", ")", ".", "asstring", "(", "image", ".", "width", "(", ")", "*", "image", ".", "height", "(", ")", "*", "3", ")", "\n", "arr", "=", "np", ".", "fromstring", "(", "s", ",", "dtype", "=", "'uint8'", ")", ".", "reshape", "(", "(", "image", ".", "width", "(", ")", ",", "image", ".", "height", "(", ")", ",", "3", ")", ")", "\n", "pix", ".", "save", "(", "temp", ")", "\n", "return", "arr", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.push": [[169, 171], ["rendering.Renderer.painter.save"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save"], ["", "def", "push", "(", "self", ")", ":", "\n", "        ", "self", ".", "painter", ".", "save", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.pop": [[172, 174], ["rendering.Renderer.painter.restore"], "methods", ["None"], ["", "def", "pop", "(", "self", ")", ":", "\n", "        ", "self", ".", "painter", ".", "restore", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.rotate": [[175, 177], ["rendering.Renderer.painter.rotate"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.rotate"], ["", "def", "rotate", "(", "self", ",", "degrees", ")", ":", "\n", "        ", "self", ".", "painter", ".", "rotate", "(", "degrees", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.translate": [[178, 180], ["rendering.Renderer.painter.translate"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.translate"], ["", "def", "translate", "(", "self", ",", "x", ",", "y", ")", ":", "\n", "        ", "self", ".", "painter", ".", "translate", "(", "x", ",", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.scale": [[181, 183], ["rendering.Renderer.painter.scale"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.scale"], ["", "def", "scale", "(", "self", ",", "x", ",", "y", ")", ":", "\n", "        ", "self", ".", "painter", ".", "scale", "(", "x", ",", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.setLineColor": [[184, 186], ["rendering.Renderer.painter.setPen", "PyQt5.QtGui.QColor"], "methods", ["None"], ["", "def", "setLineColor", "(", "self", ",", "r", ",", "g", ",", "b", ",", "a", "=", "255", ")", ":", "\n", "        ", "self", ".", "painter", ".", "setPen", "(", "QColor", "(", "r", ",", "g", ",", "b", ",", "a", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.setColor": [[187, 189], ["rendering.Renderer.painter.setBrush", "PyQt5.QtGui.QColor"], "methods", ["None"], ["", "def", "setColor", "(", "self", ",", "r", ",", "g", ",", "b", ",", "a", "=", "255", ")", ":", "\n", "        ", "self", ".", "painter", ".", "setBrush", "(", "QColor", "(", "r", ",", "g", ",", "b", ",", "a", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.setLineWidth": [[190, 194], ["rendering.Renderer.painter.pen", "rendering.Renderer.setWidthF", "rendering.Renderer.painter.setPen"], "methods", ["None"], ["", "def", "setLineWidth", "(", "self", ",", "width", ")", ":", "\n", "        ", "pen", "=", "self", ".", "painter", ".", "pen", "(", ")", "\n", "pen", ".", "setWidthF", "(", "width", ")", "\n", "self", ".", "painter", ".", "setPen", "(", "pen", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.drawLine": [[195, 197], ["rendering.Renderer.painter.drawLine"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawLine"], ["", "def", "drawLine", "(", "self", ",", "x0", ",", "y0", ",", "x1", ",", "y1", ")", ":", "\n", "        ", "self", ".", "painter", ".", "drawLine", "(", "x0", ",", "y0", ",", "x1", ",", "y1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.drawCircle": [[198, 201], ["PyQt5.QtCore.QPoint", "rendering.Renderer.painter.drawEllipse"], "methods", ["None"], ["", "def", "drawCircle", "(", "self", ",", "x", ",", "y", ",", "r", ")", ":", "\n", "        ", "center", "=", "QPoint", "(", "x", ",", "y", ")", "\n", "self", ".", "painter", ".", "drawEllipse", "(", "center", ",", "r", ",", "r", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.drawPolygon": [[202, 206], ["map", "rendering.Renderer.painter.drawPolygon", "PyQt5.QtGui.QPolygon", "PyQt5.QtCore.QPoint"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawPolygon"], ["", "def", "drawPolygon", "(", "self", ",", "points", ")", ":", "\n", "        ", "\"\"\"Takes a list of points (tuples) as input\"\"\"", "\n", "points", "=", "map", "(", "lambda", "p", ":", "QPoint", "(", "p", "[", "0", "]", ",", "p", "[", "1", "]", ")", ",", "points", ")", "\n", "self", ".", "painter", ".", "drawPolygon", "(", "QPolygon", "(", "points", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.drawPolyline": [[207, 211], ["map", "rendering.Renderer.painter.drawPolyline", "PyQt5.QtGui.QPolygon", "PyQt5.QtCore.QPoint"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawPolyline"], ["", "def", "drawPolyline", "(", "self", ",", "points", ")", ":", "\n", "        ", "\"\"\"Takes a list of points (tuples) as input\"\"\"", "\n", "points", "=", "map", "(", "lambda", "p", ":", "QPoint", "(", "p", "[", "0", "]", ",", "p", "[", "1", "]", ")", ",", "points", ")", "\n", "self", ".", "painter", ".", "drawPolyline", "(", "QPolygon", "(", "points", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.rendering.Renderer.fillRect": [[212, 214], ["rendering.Renderer.painter.fillRect", "PyQt5.QtCore.QRect", "PyQt5.QtGui.QColor"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.fillRect"], ["", "def", "fillRect", "(", "self", ",", "x", ",", "y", ",", "width", ",", "height", ",", "r", ",", "g", ",", "b", ",", "a", "=", "255", ")", ":", "\n", "        ", "self", ".", "painter", ".", "fillRect", "(", "QRect", "(", "x", ",", "y", ",", "width", ",", "height", ")", ",", "QColor", "(", "r", ",", "g", ",", "b", ",", "a", ")", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.WorldObj.__init__": [[73, 101], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "type", ",", "color", ",", "size", "=", "1", ",", "vector_representation", "=", "None", ",", "object_representation", "=", "None", ",", "target", "=", "False", ",", "\n", "weight", "=", "\"light\"", ")", ":", "\n", "        ", "assert", "type", "in", "OBJECT_TO_IDX", ",", "type", "\n", "assert", "color", "in", "COLOR_TO_IDX", ",", "color", "\n", "assert", "1", "<=", "size", "<=", "4", ",", "\"Sizes outside of range [1,4] not supported.\"", "\n", "self", ".", "type", "=", "type", "\n", "self", ".", "color", "=", "color", "\n", "self", ".", "border_color", "=", "color", "\n", "self", ".", "contains", "=", "None", "\n", "self", ".", "size", "=", "size", "\n", "\n", "# Initial position of the object", "\n", "self", ".", "init_pos", "=", "None", "\n", "\n", "# Current position of the object", "\n", "self", ".", "cur_pos", "=", "None", "\n", "\n", "# Representations", "\n", "self", ".", "vector_representation", "=", "vector_representation", "\n", "self", ".", "object_representation", "=", "object_representation", "\n", "\n", "# Boolean whether an object is a target", "\n", "self", ".", "target", "=", "target", "\n", "\n", "# Determining whether a heavy object can be moved in the next step or not", "\n", "self", ".", "momentum", "=", "0", "\n", "self", ".", "weight", "=", "weight", "\n", "self", ".", "momentum_threshold", "=", "WEIGHT_TO_MOMENTUM", "[", "self", ".", "weight", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.WorldObj.can_overlap": [[102, 105], ["None"], "methods", ["None"], ["", "def", "can_overlap", "(", "self", ")", ":", "\n", "        ", "\"\"\"Can the agent overlap with this?\"\"\"", "\n", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.WorldObj.can_pickup": [[106, 109], ["None"], "methods", ["None"], ["", "def", "can_pickup", "(", "self", ")", ":", "\n", "        ", "\"\"\"Can the agent pick this up?\"\"\"", "\n", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.WorldObj.can_push": [[110, 113], ["None"], "methods", ["None"], ["", "def", "can_push", "(", "self", ")", ":", "\n", "        ", "\"\"\"Can the agent push this?\"\"\"", "\n", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.WorldObj.render": [[114, 117], ["None"], "methods", ["None"], ["", "def", "render", "(", "self", ",", "r", ")", ":", "\n", "        ", "\"\"\"Draw this object with the given renderer\"\"\"", "\n", "raise", "NotImplementedError", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.WorldObj._set_color": [[118, 124], ["r.setLineColor", "r.setColor"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.setLineColor", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.setColor"], ["", "def", "_set_color", "(", "self", ",", "r", ")", ":", "\n", "        ", "\"\"\"Set the color of this object as the active drawing color\"\"\"", "\n", "c", "=", "COLORS", "[", "self", ".", "color", "]", "\n", "border_color", "=", "COLORS", "[", "self", ".", "border_color", "]", "\n", "r", ".", "setLineColor", "(", "border_color", "[", "0", "]", ",", "border_color", "[", "1", "]", ",", "border_color", "[", "2", "]", ")", "\n", "r", ".", "setColor", "(", "c", "[", "0", "]", ",", "c", "[", "1", "]", ",", "c", "[", "2", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Square.__init__": [[127, 131], ["minigrid.WorldObj.__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "color", "=", "'grey'", ",", "size", "=", "1", ",", "vector_representation", "=", "None", ",", "object_representation", "=", "None", ",", "target", "=", "False", ",", "\n", "weight", "=", "\"light\"", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "'square'", ",", "color", ",", "size", ",", "vector_representation", "=", "vector_representation", ",", "\n", "object_representation", "=", "object_representation", ",", "target", "=", "target", ",", "weight", "=", "weight", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Square.render": [[132, 141], ["minigrid.Square._set_color", "r.drawPolygon"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.WorldObj._set_color", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawPolygon"], ["", "def", "render", "(", "self", ",", "r", ")", ":", "\n", "        ", "self", ".", "_set_color", "(", "r", ")", "\n", "\n", "# TODO: max_size is 4 here hardcoded", "\n", "r", ".", "drawPolygon", "(", "[", "\n", "(", "0", ",", "CELL_PIXELS", "*", "(", "self", ".", "size", "/", "4", ")", ")", ",", "\n", "(", "CELL_PIXELS", "*", "(", "self", ".", "size", "/", "4", ")", ",", "CELL_PIXELS", "*", "(", "self", ".", "size", "/", "4", ")", ")", ",", "\n", "(", "CELL_PIXELS", "*", "(", "self", ".", "size", "/", "4", ")", ",", "0", ")", ",", "\n", "(", "0", ",", "0", ")", "\n", "]", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Square.can_pickup": [[143, 145], ["None"], "methods", ["None"], ["", "def", "can_pickup", "(", "self", ")", ":", "\n", "        ", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Square.can_push": [[146, 148], ["None"], "methods", ["None"], ["", "def", "can_push", "(", "self", ")", ":", "\n", "        ", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Square.push": [[149, 156], ["None"], "methods", ["None"], ["", "def", "push", "(", "self", ")", ":", "\n", "        ", "self", ".", "momentum", "+=", "1", "\n", "if", "self", ".", "momentum", ">=", "self", ".", "momentum_threshold", ":", "\n", "            ", "self", ".", "momentum", "=", "0", "\n", "return", "True", "\n", "", "else", ":", "\n", "            ", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Cylinder.__init__": [[159, 162], ["minigrid.WorldObj.__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "color", "=", "'blue'", ",", "size", "=", "1", ",", "vector_representation", "=", "None", ",", "object_representation", "=", "None", ",", "weight", "=", "\"light\"", ")", ":", "\n", "        ", "super", "(", "Cylinder", ",", "self", ")", ".", "__init__", "(", "'cylinder'", ",", "color", ",", "size", ",", "vector_representation", ",", "\n", "object_representation", "=", "object_representation", ",", "weight", "=", "weight", ")", "\n", "# TODO: generalize sizes", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Cylinder.can_pickup": [[164, 166], ["None"], "methods", ["None"], ["", "def", "can_pickup", "(", "self", ")", ":", "\n", "        ", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Cylinder.render": [[167, 178], ["minigrid.Cylinder._set_color", "r.drawPolygon"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.WorldObj._set_color", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawPolygon"], ["", "def", "render", "(", "self", ",", "r", ")", ":", "\n", "        ", "self", ".", "_set_color", "(", "r", ")", "\n", "\n", "# Vertical quad", "\n", "parallelogram_width", "=", "(", "CELL_PIXELS", "/", "2", ")", "*", "(", "self", ".", "size", "/", "4", ")", "\n", "parallelogram_height", "=", "CELL_PIXELS", "*", "(", "self", ".", "size", "/", "4", ")", "\n", "r", ".", "drawPolygon", "(", "[", "\n", "(", "CELL_PIXELS", "/", "2", ",", "0", ")", ",", "\n", "(", "CELL_PIXELS", "/", "2", "+", "parallelogram_width", ",", "0", ")", ",", "\n", "(", "CELL_PIXELS", "/", "2", ",", "parallelogram_height", ")", ",", "\n", "(", "CELL_PIXELS", "/", "2", "-", "parallelogram_width", ",", "parallelogram_height", ")", "\n", "]", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Cylinder.can_push": [[180, 182], ["None"], "methods", ["None"], ["", "def", "can_push", "(", "self", ")", ":", "\n", "        ", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Cylinder.push": [[183, 190], ["None"], "methods", ["None"], ["", "def", "push", "(", "self", ")", ":", "\n", "        ", "self", ".", "momentum", "+=", "1", "\n", "if", "self", ".", "momentum", ">=", "self", ".", "momentum_threshold", ":", "\n", "            ", "self", ".", "momentum", "=", "0", "\n", "return", "True", "\n", "", "else", ":", "\n", "            ", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Circle.__init__": [[193, 197], ["minigrid.WorldObj.__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "color", "=", "'blue'", ",", "size", "=", "1", ",", "vector_representation", "=", "None", ",", "object_representation", "=", "None", ",", "target", "=", "False", ",", "\n", "weight", "=", "\"light\"", ")", ":", "\n", "        ", "super", "(", "Circle", ",", "self", ")", ".", "__init__", "(", "'circle'", ",", "color", ",", "size", ",", "vector_representation", ",", "\n", "object_representation", "=", "object_representation", ",", "target", "=", "target", ",", "weight", "=", "weight", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Circle.can_pickup": [[198, 200], ["None"], "methods", ["None"], ["", "def", "can_pickup", "(", "self", ")", ":", "\n", "        ", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Circle.can_push": [[201, 203], ["None"], "methods", ["None"], ["", "def", "can_push", "(", "self", ")", ":", "\n", "        ", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Circle.render": [[204, 207], ["minigrid.Circle._set_color", "r.drawCircle"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.WorldObj._set_color", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawCircle"], ["", "def", "render", "(", "self", ",", "r", ")", ":", "\n", "        ", "self", ".", "_set_color", "(", "r", ")", "\n", "r", ".", "drawCircle", "(", "CELL_PIXELS", "*", "0.5", ",", "CELL_PIXELS", "*", "0.5", ",", "CELL_PIXELS", "//", "10", "*", "self", ".", "size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Circle.push": [[208, 215], ["None"], "methods", ["None"], ["", "def", "push", "(", "self", ")", ":", "\n", "        ", "self", ".", "momentum", "+=", "1", "\n", "if", "self", ".", "momentum", ">=", "self", ".", "momentum_threshold", ":", "\n", "            ", "self", ".", "momentum", "=", "0", "\n", "return", "True", "\n", "", "else", ":", "\n", "            ", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Grid.__init__": [[222, 230], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "width", ",", "height", ",", "depth", ")", ":", "\n", "        ", "assert", "width", ">=", "3", "\n", "assert", "height", ">=", "3", "\n", "\n", "self", ".", "width", "=", "width", "\n", "self", ".", "height", "=", "height", "\n", "self", ".", "_num_attributes_object", "=", "depth", "\n", "self", ".", "grid", "=", "[", "None", "]", "*", "width", "*", "height", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Grid.__contains__": [[231, 245], ["isinstance", "isinstance"], "methods", ["None"], ["", "def", "__contains__", "(", "self", ",", "key", ")", ":", "\n", "        ", "if", "isinstance", "(", "key", ",", "WorldObj", ")", ":", "\n", "            ", "for", "e", "in", "self", ".", "grid", ":", "\n", "                ", "if", "e", "is", "key", ":", "\n", "                    ", "return", "True", "\n", "", "", "", "elif", "isinstance", "(", "key", ",", "tuple", ")", ":", "\n", "            ", "for", "e", "in", "self", ".", "grid", ":", "\n", "                ", "if", "e", "is", "None", ":", "\n", "                    ", "continue", "\n", "", "if", "(", "e", ".", "color", ",", "e", ".", "type", ")", "==", "key", ":", "\n", "                    ", "return", "True", "\n", "", "if", "key", "[", "0", "]", "is", "None", "and", "key", "[", "1", "]", "==", "e", ".", "type", ":", "\n", "                    ", "return", "True", "\n", "", "", "", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Grid.__eq__": [[246, 250], ["minigrid.Grid.encode", "other.encode", "numpy.array_equal"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.encode", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.encode"], ["", "def", "__eq__", "(", "self", ",", "other", ")", ":", "\n", "        ", "grid1", "=", "self", ".", "encode", "(", ")", "\n", "grid2", "=", "other", ".", "encode", "(", ")", "\n", "return", "np", ".", "array_equal", "(", "grid2", ",", "grid1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Grid.__ne__": [[251, 253], ["None"], "methods", ["None"], ["", "def", "__ne__", "(", "self", ",", "other", ")", ":", "\n", "        ", "return", "not", "self", "==", "other", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Grid.copy": [[254, 257], ["deepcopy"], "methods", ["None"], ["", "def", "copy", "(", "self", ")", ":", "\n", "        ", "from", "copy", "import", "deepcopy", "\n", "return", "deepcopy", "(", "self", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Grid.set": [[258, 262], ["None"], "methods", ["None"], ["", "def", "set", "(", "self", ",", "i", ",", "j", ",", "v", ")", ":", "\n", "        ", "assert", "i", ">=", "0", "and", "i", "<", "self", ".", "width", "\n", "assert", "j", ">=", "0", "and", "j", "<", "self", ".", "height", "\n", "self", ".", "grid", "[", "j", "*", "self", ".", "width", "+", "i", "]", "=", "v", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Grid.get": [[263, 267], ["None"], "methods", ["None"], ["", "def", "get", "(", "self", ",", "i", ",", "j", ")", ":", "\n", "        ", "assert", "i", ">=", "0", "and", "i", "<", "self", ".", "width", "\n", "assert", "j", ">=", "0", "and", "j", "<", "self", ".", "height", "\n", "return", "self", ".", "grid", "[", "j", "*", "self", ".", "width", "+", "i", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Grid.rotate_left": [[268, 281], ["minigrid.Grid", "range", "range", "minigrid.Grid.get", "minigrid.Grid.set"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set"], ["", "def", "rotate_left", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Rotate the grid to the left (counter-clockwise)\n        \"\"\"", "\n", "\n", "grid", "=", "Grid", "(", "self", ".", "height", ",", "self", ".", "width", ")", "\n", "\n", "for", "i", "in", "range", "(", "self", ".", "width", ")", ":", "\n", "            ", "for", "j", "in", "range", "(", "self", ".", "height", ")", ":", "\n", "                ", "v", "=", "self", ".", "get", "(", "i", ",", "j", ")", "\n", "grid", ".", "set", "(", "j", ",", "grid", ".", "height", "-", "1", "-", "i", ",", "v", ")", "\n", "\n", "", "", "return", "grid", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Grid.slice": [[282, 303], ["minigrid.Grid", "range", "range", "minigrid.Grid.set", "minigrid.Grid.get", "minigrid.Square"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "def", "slice", "(", "self", ",", "topX", ",", "topY", ",", "width", ",", "height", ")", ":", "\n", "        ", "\"\"\"\n        Get a subset of the grid\n        \"\"\"", "\n", "\n", "grid", "=", "Grid", "(", "width", ",", "height", ")", "\n", "\n", "for", "j", "in", "range", "(", "0", ",", "height", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "0", ",", "width", ")", ":", "\n", "                ", "x", "=", "topX", "+", "i", "\n", "y", "=", "topY", "+", "j", "\n", "\n", "if", "x", ">=", "0", "and", "x", "<", "self", ".", "width", "and", "y", ">=", "0", "and", "y", "<", "self", ".", "height", ":", "\n", "                    ", "v", "=", "self", ".", "get", "(", "x", ",", "y", ")", "\n", "", "else", ":", "\n", "                    ", "v", "=", "Square", "(", ")", "\n", "\n", "", "grid", ".", "set", "(", "i", ",", "j", ",", "v", ")", "\n", "\n", "", "", "return", "grid", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Grid.render": [[304, 379], ["r.push", "r.scale", "r.setLineColor", "range", "range", "range", "r.pop", "len", "r.fillRect", "range", "r.drawLine", "r.drawLine", "range", "len", "attention_weights.reshape.reshape.reshape", "range", "minigrid.Grid.get", "r.push", "r.translate", "minigrid.Grid.render", "r.pop", "len", "attention_weights.reshape.reshape.reshape", "int", "r.push", "r.fillRect", "r.pop", "int", "r.push", "r.fillRect", "len"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.push", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.scale", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.setLineColor", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.fillRect", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawLine", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawLine", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.push", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.translate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.render", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.push", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.fillRect", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.push", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.fillRect"], ["", "def", "render", "(", "self", ",", "r", ",", "tile_size", ",", "attention_weights", "=", "[", "]", ")", ":", "\n", "        ", "\"\"\"\n        Render this grid at a given scale\n        :param r: target renderer object\n        :param tile_size: tile size in pixels\n        \"\"\"", "\n", "\n", "assert", "r", ".", "width", "==", "self", ".", "width", "*", "tile_size", "\n", "assert", "r", ".", "height", "==", "self", ".", "height", "*", "tile_size", "\n", "\n", "# Total grid size at native scale", "\n", "widthPx", "=", "self", ".", "width", "*", "CELL_PIXELS", "\n", "heightPx", "=", "self", ".", "height", "*", "CELL_PIXELS", "\n", "\n", "r", ".", "push", "(", ")", "\n", "\n", "# Internally, we draw at the \"large\" full-grid resolution, but we", "\n", "# use the renderer to scale back to the desired size", "\n", "r", ".", "scale", "(", "tile_size", "/", "CELL_PIXELS", ",", "tile_size", "/", "CELL_PIXELS", ")", "\n", "\n", "if", "len", "(", "attention_weights", ")", ">", "0", ":", "\n", "            ", "if", "len", "(", "attention_weights", ")", "==", "self", ".", "width", "*", "self", ".", "height", ":", "\n", "                ", "pixel_attention", "=", "False", "\n", "attention_weights", "=", "attention_weights", ".", "reshape", "(", "self", ".", "width", ",", "self", ".", "height", ")", "\n", "", "elif", "len", "(", "attention_weights", ")", "==", "self", ".", "width", "*", "CELL_PIXELS", "*", "self", ".", "height", "*", "CELL_PIXELS", ":", "\n", "                ", "pixel_attention", "=", "True", "\n", "attention_weights", "=", "attention_weights", ".", "reshape", "(", "self", ".", "width", "*", "CELL_PIXELS", ",", "self", ".", "height", "*", "CELL_PIXELS", ")", "\n", "", "start_range", "=", "0", "\n", "end_range", "=", "150", "\n", "", "else", ":", "\n", "            ", "pixel_attention", "=", "False", "\n", "# Draw the background of the in-world cells black", "\n", "", "if", "not", "pixel_attention", ":", "\n", "            ", "r", ".", "fillRect", "(", "\n", "0", ",", "\n", "0", ",", "\n", "widthPx", ",", "\n", "heightPx", ",", "\n", "255", ",", "255", ",", "255", "\n", ")", "\n", "", "else", ":", "\n", "            ", "for", "j", "in", "range", "(", "0", ",", "heightPx", ")", ":", "\n", "                ", "for", "i", "in", "range", "(", "0", ",", "widthPx", ")", ":", "\n", "                    ", "current_weight", "=", "attention_weights", "[", "j", ",", "i", "]", "\n", "color", "=", "int", "(", "(", "end_range", "-", "start_range", ")", "*", "(", "1", "-", "current_weight", ")", ")", "\n", "r", ".", "push", "(", ")", "\n", "r", ".", "fillRect", "(", "i", ",", "j", ",", "1", ",", "1", ",", "r", "=", "color", ",", "g", "=", "color", ",", "b", "=", "color", ")", "\n", "r", ".", "pop", "(", ")", "\n", "\n", "# Draw grid lines", "\n", "", "", "", "r", ".", "setLineColor", "(", "100", ",", "100", ",", "100", ")", "\n", "for", "rowIdx", "in", "range", "(", "0", ",", "self", ".", "height", ")", ":", "\n", "            ", "y", "=", "CELL_PIXELS", "*", "rowIdx", "\n", "r", ".", "drawLine", "(", "0", ",", "y", ",", "widthPx", ",", "y", ")", "\n", "", "for", "colIdx", "in", "range", "(", "0", ",", "self", ".", "width", ")", ":", "\n", "            ", "x", "=", "CELL_PIXELS", "*", "colIdx", "\n", "r", ".", "drawLine", "(", "x", ",", "0", ",", "x", ",", "heightPx", ")", "\n", "\n", "# Render the grid", "\n", "", "for", "j", "in", "range", "(", "0", ",", "self", ".", "height", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "0", ",", "self", ".", "width", ")", ":", "\n", "                ", "cell", "=", "self", ".", "get", "(", "i", ",", "j", ")", "\n", "if", "len", "(", "attention_weights", ")", ">", "0", "and", "not", "pixel_attention", ":", "\n", "                    ", "current_weight", "=", "attention_weights", "[", "j", ",", "i", "]", "\n", "color", "=", "int", "(", "(", "end_range", "-", "start_range", ")", "*", "(", "1", "-", "current_weight", ")", ")", "\n", "r", ".", "push", "(", ")", "\n", "r", ".", "fillRect", "(", "i", "*", "CELL_PIXELS", ",", "j", "*", "CELL_PIXELS", ",", "CELL_PIXELS", ",", "CELL_PIXELS", ",", "r", "=", "color", ",", "g", "=", "color", ",", "b", "=", "color", ")", "\n", "", "if", "cell", "==", "None", ":", "\n", "                    ", "continue", "\n", "", "r", ".", "push", "(", ")", "\n", "r", ".", "translate", "(", "i", "*", "CELL_PIXELS", ",", "j", "*", "CELL_PIXELS", ")", "\n", "cell", ".", "render", "(", "r", ")", "\n", "r", ".", "pop", "(", ")", "\n", "\n", "", "", "r", ".", "pop", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.Grid.encode": [[380, 400], ["numpy.zeros", "range", "range", "minigrid.Grid.get", "numpy.zeros", "numpy.zeros"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "def", "encode", "(", "self", ",", "agent_row", ":", "int", ",", "agent_column", ":", "int", ",", "agent_direction", ":", "int", ")", ":", "\n", "        ", "\"\"\"\n        Produce a compact numpy encoding of the grid.\n        \"\"\"", "\n", "array", "=", "np", ".", "zeros", "(", "(", "self", ".", "width", ",", "self", ".", "height", ",", "self", ".", "_num_attributes_object", "+", "1", "+", "4", ")", ",", "dtype", "=", "'uint8'", ")", "\n", "for", "col", "in", "range", "(", "self", ".", "width", ")", ":", "\n", "            ", "for", "row", "in", "range", "(", "self", ".", "height", ")", ":", "\n", "                ", "grid_cell", "=", "self", ".", "get", "(", "col", ",", "row", ")", "\n", "empty_representation", "=", "np", ".", "zeros", "(", "self", ".", "_num_attributes_object", "+", "1", "+", "4", ")", "\n", "if", "grid_cell", ":", "\n", "                    ", "empty_representation", "[", ":", "-", "5", "]", "=", "grid_cell", ".", "vector_representation", "\n", "\n", "# Set agent feature to 1 for the grid cell with the agent and add it's direction in one-hot form.", "\n", "", "if", "col", "==", "agent_column", "and", "row", "==", "agent_row", ":", "\n", "                    ", "empty_representation", "[", "-", "5", "]", "=", "1", "\n", "one_hot_direction", "=", "np", ".", "zeros", "(", "4", ")", "\n", "one_hot_direction", "[", "agent_direction", "]", "=", "1", "\n", "empty_representation", "[", "-", "4", ":", "]", "=", "one_hot_direction", "\n", "", "array", "[", "row", ",", "col", ",", ":", "]", "=", "empty_representation", "\n", "", "", "return", "array", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.MiniGridEnv.__init__": [[427, 463], ["gym.spaces.Discrete", "minigrid.MiniGridEnv.seed", "minigrid.MiniGridEnv.reset", "len"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.seed", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.reset"], ["", "def", "__init__", "(", "self", ",", "grid_size", "=", "None", ",", "width", "=", "None", ",", "height", "=", "None", ",", "max_steps", "=", "100", ",", "seed", "=", "1337", ")", ":", "\n", "# Can't set both grid_size and width/height", "\n", "        ", "if", "grid_size", ":", "\n", "            ", "assert", "width", "==", "None", "and", "height", "==", "None", "\n", "width", "=", "grid_size", "\n", "height", "=", "grid_size", "\n", "\n", "# Action enumeration for this environment", "\n", "", "self", ".", "actions", "=", "MiniGridEnv", ".", "Actions", "\n", "\n", "# Actions are discrete integer values", "\n", "self", ".", "action_space", "=", "spaces", ".", "Discrete", "(", "len", "(", "self", ".", "actions", ")", ")", "\n", "\n", "# Range of possible rewards", "\n", "self", ".", "reward_range", "=", "(", "0", ",", "1", ")", "\n", "\n", "# Renderer object used to render the whole grid (full-scale)", "\n", "self", ".", "grid_render", "=", "None", "\n", "\n", "# Renderer used to render observations (small-scale agent view)", "\n", "self", ".", "obs_render", "=", "None", "\n", "\n", "# Environment configuration", "\n", "self", ".", "width", "=", "width", "\n", "self", ".", "height", "=", "height", "\n", "self", ".", "max_steps", "=", "max_steps", "\n", "\n", "# Current position and direction of the agent", "\n", "self", ".", "agent_pos", "=", "None", "\n", "self", ".", "agent_dir", "=", "None", "\n", "\n", "# Initialize the RNG", "\n", "self", ".", "seed", "(", "seed", "=", "seed", ")", "\n", "\n", "# Initialize the state", "\n", "self", ".", "reset", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.MiniGridEnv.reset": [[464, 489], ["minigrid.MiniGridEnv._gen_grid", "minigrid.MiniGridEnv.grid.get", "minigrid.MiniGridEnv.can_overlap"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid._gen_grid", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.WorldObj.can_overlap"], ["", "def", "reset", "(", "self", ")", ":", "\n", "# Current position and direction of the agent", "\n", "        ", "self", ".", "agent_pos", "=", "None", "\n", "self", ".", "agent_dir", "=", "None", "\n", "\n", "# Generate a new random grid at the start of each episode", "\n", "# To keep the same grid for each episode, call env.seed() with", "\n", "# the same seed before calling env.reset()", "\n", "self", ".", "_gen_grid", "(", "self", ".", "width", ",", "self", ".", "height", ")", "\n", "\n", "# These fields should be defined by _gen_grid", "\n", "assert", "self", ".", "agent_pos", "is", "not", "None", "\n", "assert", "self", ".", "agent_dir", "is", "not", "None", "\n", "\n", "# Check that the agent doesn't overlap with an object", "\n", "start_cell", "=", "self", ".", "grid", ".", "get", "(", "*", "self", ".", "agent_pos", ")", "\n", "assert", "start_cell", "is", "None", "or", "start_cell", ".", "can_overlap", "(", ")", "\n", "\n", "# Item picked up, being carried, initially nothing", "\n", "self", ".", "carrying", "=", "None", "\n", "\n", "# Step count since episode start", "\n", "self", ".", "step_count", "=", "0", "\n", "\n", "return", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.MiniGridEnv.seed": [[490, 494], ["gym.utils.seeding.np_random"], "methods", ["None"], ["", "def", "seed", "(", "self", ",", "seed", "=", "1337", ")", ":", "\n", "# Seed the random number generator", "\n", "        ", "self", ".", "np_random", ",", "_", "=", "seeding", ".", "np_random", "(", "seed", ")", "\n", "return", "[", "seed", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.MiniGridEnv.steps_remaining": [[495, 498], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "steps_remaining", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "max_steps", "-", "self", ".", "step_count", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.MiniGridEnv.__str__": [[499, 535], ["range", "range", "minigrid.MiniGridEnv.grid.get", "minigrid.MiniGridEnv.color[].upper"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "def", "__str__", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Produce a pretty string of the environment's grid along with the agent.\n        A grid cell is represented by 2-character string, the first one for\n        the object and the second one for the color.\n        \"\"\"", "\n", "\n", "# Map of object types to short string", "\n", "OBJECT_TO_STR", "=", "{", "\n", "'circle'", ":", "'A'", ",", "\n", "'square'", ":", "'B'", ",", "\n", "'cylinder'", ":", "'C'", ",", "\n", "}", "\n", "\n", "# Map agent's direction to short string", "\n", "AGENT_DIR_TO_STR", "=", "{", "\n", "0", ":", "'>'", ",", "\n", "1", ":", "'V'", ",", "\n", "2", ":", "'<'", ",", "\n", "3", ":", "'^'", "\n", "}", "\n", "\n", "str", "=", "''", "\n", "for", "j", "in", "range", "(", "self", ".", "grid", ".", "height", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "self", ".", "grid", ".", "width", ")", ":", "\n", "                ", "if", "i", "==", "self", ".", "agent_pos", "[", "0", "]", "and", "j", "==", "self", ".", "agent_pos", "[", "1", "]", ":", "\n", "                    ", "str", "+=", "2", "*", "AGENT_DIR_TO_STR", "[", "self", ".", "agent_dir", "]", "\n", "continue", "\n", "", "c", "=", "self", ".", "grid", ".", "get", "(", "i", ",", "j", ")", "\n", "if", "not", "c", ":", "\n", "                    ", "str", "+=", "'  '", "\n", "continue", "\n", "", "str", "+=", "OBJECT_TO_STR", "[", "c", ".", "type", "]", "+", "c", ".", "color", "[", "0", "]", ".", "upper", "(", ")", "\n", "", "if", "j", "<", "self", ".", "grid", ".", "height", "-", "1", ":", "\n", "                ", "str", "+=", "'\\n'", "\n", "", "", "return", "str", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.MiniGridEnv._gen_grid": [[536, 538], ["None"], "methods", ["None"], ["", "def", "_gen_grid", "(", "self", ",", "width", ",", "height", ")", ":", "\n", "        ", "assert", "False", ",", "\"_gen_grid needs to be implemented by each environment\"", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.MiniGridEnv._rand_int": [[539, 545], ["minigrid.MiniGridEnv.np_random.randint"], "methods", ["None"], ["", "def", "_rand_int", "(", "self", ",", "low", ",", "high", ")", ":", "\n", "        ", "\"\"\"\n        Generate random integer in [low,high[\n        \"\"\"", "\n", "\n", "return", "self", ".", "np_random", ".", "randint", "(", "low", ",", "high", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.MiniGridEnv.place_obj": [[546, 597], ["minigrid.MiniGridEnv.grid.set", "numpy.array", "max", "max", "RecursionError", "minigrid.MiniGridEnv.grid.get", "reject_fn", "minigrid.MiniGridEnv._rand_int", "minigrid.MiniGridEnv._rand_int", "min", "min"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.min", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.min"], ["", "def", "place_obj", "(", "self", ",", "obj", ",", "top", "=", "None", ",", "size", "=", "None", ",", "reject_fn", "=", "None", ",", "max_tries", "=", "math", ".", "inf", ")", ":", "\n", "        ", "\"\"\"\n        Place an object at an empty position in the grid\n\n        :param obj:\n        :param top: top-left position of the rectangle where to place\n        :param size: size of the rectangle where to place\n        :param reject_fn: function to filter out potential positions\n        :param max_tries:\n        \"\"\"", "\n", "\n", "if", "top", "is", "None", ":", "\n", "            ", "top", "=", "(", "0", ",", "0", ")", "\n", "", "else", ":", "\n", "            ", "top", "=", "(", "max", "(", "top", "[", "0", "]", ",", "0", ")", ",", "max", "(", "top", "[", "1", "]", ",", "0", ")", ")", "\n", "\n", "", "if", "size", "is", "None", ":", "\n", "            ", "size", "=", "(", "self", ".", "grid", ".", "width", ",", "self", ".", "grid", ".", "height", ")", "\n", "\n", "", "num_tries", "=", "0", "\n", "\n", "while", "True", ":", "\n", "# This is to handle with rare cases where rejection sampling", "\n", "# gets stuck in an infinite loop", "\n", "            ", "if", "num_tries", ">", "max_tries", ":", "\n", "                ", "raise", "RecursionError", "(", "'rejection sampling failed in place_obj'", ")", "\n", "\n", "", "num_tries", "+=", "1", "\n", "\n", "pos", "=", "np", ".", "array", "(", "(", "\n", "self", ".", "_rand_int", "(", "top", "[", "0", "]", ",", "min", "(", "top", "[", "0", "]", "+", "size", "[", "0", "]", ",", "self", ".", "grid", ".", "width", ")", ")", ",", "\n", "self", ".", "_rand_int", "(", "top", "[", "1", "]", ",", "min", "(", "top", "[", "1", "]", "+", "size", "[", "1", "]", ",", "self", ".", "grid", ".", "height", ")", ")", "\n", ")", ")", "\n", "\n", "# Don't place the object on top of another object", "\n", "if", "self", ".", "grid", ".", "get", "(", "*", "pos", ")", "!=", "None", ":", "\n", "                ", "continue", "\n", "\n", "# Check if there is a filtering criterion", "\n", "", "if", "reject_fn", "and", "reject_fn", "(", "self", ",", "pos", ")", ":", "\n", "                ", "continue", "\n", "\n", "", "break", "\n", "\n", "", "self", ".", "grid", ".", "set", "(", "*", "pos", ",", "obj", ")", "\n", "\n", "if", "obj", "is", "not", "None", ":", "\n", "            ", "obj", ".", "init_pos", "=", "pos", "\n", "obj", ".", "cur_pos", "=", "pos", "\n", "\n", "", "return", "pos", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.MiniGridEnv.place_agent": [[598, 617], ["minigrid.MiniGridEnv.place_obj", "minigrid.MiniGridEnv._rand_int"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.place_obj", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int"], ["", "def", "place_agent", "(", "\n", "self", ",", "\n", "top", "=", "None", ",", "\n", "size", "=", "None", ",", "\n", "rand_dir", "=", "True", ",", "\n", "max_tries", "=", "math", ".", "inf", "\n", ")", ":", "\n", "        ", "\"\"\"\n        Set the agent's starting point at an empty position in the grid\n        \"\"\"", "\n", "\n", "self", ".", "agent_pos", "=", "None", "\n", "pos", "=", "self", ".", "place_obj", "(", "None", ",", "top", ",", "size", ",", "max_tries", "=", "max_tries", ")", "\n", "self", ".", "agent_pos", "=", "pos", "\n", "\n", "if", "rand_dir", ":", "\n", "            ", "self", ".", "agent_dir", "=", "self", ".", "_rand_int", "(", "0", ",", "4", ")", "\n", "\n", "", "return", "pos", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.MiniGridEnv.dir_vec": [[618, 627], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "dir_vec", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Get the direction vector for the agent, pointing in the direction\n        of forward movement.\n        \"\"\"", "\n", "\n", "assert", "self", ".", "agent_dir", ">=", "0", "and", "self", ".", "agent_dir", "<", "4", "\n", "return", "DIR_TO_VEC", "[", "self", ".", "agent_dir", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.MiniGridEnv.right_vec": [[628, 636], ["numpy.array"], "methods", ["None"], ["", "@", "property", "\n", "def", "right_vec", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Get the vector pointing to the right of the agent.\n        \"\"\"", "\n", "\n", "dx", ",", "dy", "=", "self", ".", "dir_vec", "\n", "return", "np", ".", "array", "(", "(", "-", "dy", ",", "dx", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.MiniGridEnv.front_pos": [[637, 644], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "front_pos", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Get the position of the cell that is right in front of the agent\n        \"\"\"", "\n", "\n", "return", "self", ".", "agent_pos", "+", "self", ".", "dir_vec", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.MiniGridEnv.step": [[645, 704], ["minigrid.MiniGridEnv.grid.get", "minigrid.MiniGridEnv.grid.get", "minigrid.MiniGridEnv.can_overlap", "minigrid.MiniGridEnv._reward", "minigrid.MiniGridEnv.can_pickup", "numpy.array", "minigrid.MiniGridEnv.grid.set", "minigrid.MiniGridEnv.grid.set"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.WorldObj.can_overlap", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.can_pickup", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "self", ".", "step_count", "+=", "1", "\n", "\n", "reward", "=", "0", "\n", "done", "=", "False", "\n", "\n", "current_cell", "=", "self", ".", "grid", ".", "get", "(", "*", "self", ".", "agent_pos", ")", "\n", "\n", "# Rotate left", "\n", "if", "action", "==", "self", ".", "actions", ".", "left", ":", "\n", "            ", "self", ".", "agent_dir", "-=", "1", "\n", "if", "self", ".", "agent_dir", "<", "0", ":", "\n", "                ", "self", ".", "agent_dir", "+=", "4", "\n", "\n", "# Rotate right", "\n", "", "", "elif", "action", "==", "self", ".", "actions", ".", "right", ":", "\n", "            ", "self", ".", "agent_dir", "=", "(", "self", ".", "agent_dir", "+", "1", ")", "%", "4", "\n", "\n", "# Move forward", "\n", "", "elif", "action", "==", "self", ".", "actions", ".", "forward", ":", "\n", "# Get the position in front of the agent", "\n", "            ", "fwd_pos", "=", "self", ".", "front_pos", "\n", "\n", "# Get the contents of the cell in front of the agent", "\n", "fwd_cell", "=", "self", ".", "grid", ".", "get", "(", "*", "fwd_pos", ")", "\n", "if", "fwd_cell", "==", "None", "or", "fwd_cell", ".", "can_overlap", "(", ")", ":", "\n", "                ", "self", ".", "agent_pos", "=", "fwd_pos", "\n", "", "if", "fwd_cell", "!=", "None", "and", "fwd_cell", ".", "type", "==", "'goal'", ":", "\n", "                ", "done", "=", "True", "\n", "reward", "=", "self", ".", "_reward", "(", ")", "\n", "", "if", "fwd_cell", "!=", "None", "and", "fwd_cell", ".", "type", "==", "'lava'", ":", "\n", "                ", "done", "=", "True", "\n", "\n", "# Pick up an object", "\n", "", "", "elif", "action", "==", "self", ".", "actions", ".", "pickup", ":", "\n", "            ", "if", "current_cell", ".", "can_pickup", "(", ")", ":", "\n", "                ", "if", "self", ".", "carrying", "is", "None", ":", "\n", "                    ", "self", ".", "carrying", "=", "current_cell", "\n", "self", ".", "carrying", ".", "cur_pos", "=", "np", ".", "array", "(", "[", "-", "1", ",", "-", "1", "]", ")", "\n", "self", ".", "grid", ".", "set", "(", "*", "self", ".", "agent_pos", ",", "None", ")", "\n", "\n", "# Drop an object", "\n", "", "", "", "elif", "action", "==", "self", ".", "actions", ".", "drop", ":", "\n", "            ", "if", "not", "current_cell", "and", "self", ".", "carrying", ":", "\n", "                ", "self", ".", "grid", ".", "set", "(", "*", "self", ".", "agent_pos", ",", "self", ".", "carrying", ")", "\n", "self", ".", "carrying", ".", "cur_pos", "=", "self", ".", "agent_pos", "\n", "self", ".", "carrying", "=", "None", "\n", "\n", "# Done action (not used by default)", "\n", "", "", "elif", "action", "==", "self", ".", "actions", ".", "done", ":", "\n", "            ", "pass", "\n", "\n", "", "else", ":", "\n", "            ", "assert", "False", ",", "\"unknown action\"", "\n", "\n", "", "if", "self", ".", "step_count", ">=", "self", ".", "max_steps", ":", "\n", "            ", "done", "=", "True", "\n", "\n", "", "return", "reward", ",", "done", ",", "{", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.minigrid.MiniGridEnv.render": [[705, 761], ["r.beginFrame", "minigrid.MiniGridEnv.grid.render", "r.push", "r.scale", "r.translate", "r.rotate", "r.setLineColor", "r.setColor", "r.drawPolygon", "r.pop", "r.endFrame", "Renderer", "r.window.setText", "len", "r.getArray", "minigrid.MiniGridEnv.grid_render.close", "r.getPixmap"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.beginFrame", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.render", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.push", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.scale", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.translate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.rotate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.setLineColor", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.setColor", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawPolygon", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.endFrame", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Window.setText", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.getArray", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.close", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.getPixmap"], ["", "def", "render", "(", "self", ",", "mode", "=", "''", ",", "close", "=", "False", ",", "highlight", "=", "True", ",", "tile_size", "=", "CELL_PIXELS", ",", "attention_weights", "=", "[", "]", ")", ":", "\n", "        ", "\"\"\"\n        Render the whole-grid human view\n        \"\"\"", "\n", "\n", "if", "close", ":", "\n", "            ", "if", "self", ".", "grid_render", ":", "\n", "                ", "self", ".", "grid_render", ".", "close", "(", ")", "\n", "", "return", "\n", "\n", "", "if", "self", ".", "grid_render", "is", "None", "or", "self", ".", "grid_render", ".", "window", "is", "None", "or", "(", "self", ".", "grid_render", ".", "width", "!=", "self", ".", "width", "*", "tile_size", ")", ":", "\n", "            ", "from", "GroundedScan", ".", "gym_minigrid", ".", "rendering", "import", "Renderer", "\n", "self", ".", "grid_render", "=", "Renderer", "(", "\n", "self", ".", "width", "*", "tile_size", ",", "\n", "self", ".", "height", "*", "tile_size", ",", "\n", "True", "if", "mode", "==", "'human'", "else", "False", "\n", ")", "\n", "\n", "", "r", "=", "self", ".", "grid_render", "\n", "\n", "if", "r", ".", "window", ":", "\n", "            ", "r", ".", "window", ".", "setText", "(", "self", ".", "mission", ")", "\n", "\n", "", "r", ".", "beginFrame", "(", ")", "\n", "\n", "# Render the whole grid", "\n", "if", "len", "(", "attention_weights", ")", ">", "0", ":", "\n", "            ", "flat_attention_weights", "=", "attention_weights", "[", "0", "]", "\n", "", "else", ":", "\n", "            ", "flat_attention_weights", "=", "attention_weights", "\n", "", "self", ".", "grid", ".", "render", "(", "r", ",", "tile_size", ",", "attention_weights", "=", "flat_attention_weights", ")", "\n", "\n", "# Draw the agent", "\n", "ratio", "=", "tile_size", "/", "CELL_PIXELS", "\n", "r", ".", "push", "(", ")", "\n", "r", ".", "scale", "(", "ratio", ",", "ratio", ")", "\n", "r", ".", "translate", "(", "\n", "CELL_PIXELS", "*", "(", "self", ".", "agent_pos", "[", "0", "]", "+", "0.5", ")", ",", "\n", "CELL_PIXELS", "*", "(", "self", ".", "agent_pos", "[", "1", "]", "+", "0.5", ")", "\n", ")", "\n", "r", ".", "rotate", "(", "self", ".", "agent_dir", "*", "90", ")", "\n", "r", ".", "setLineColor", "(", "255", ",", "192", ",", "203", ")", "\n", "r", ".", "setColor", "(", "255", ",", "192", ",", "203", ")", "\n", "r", ".", "drawPolygon", "(", "[", "\n", "(", "-", "12", ",", "10", ")", ",", "\n", "(", "12", ",", "0", ")", ",", "\n", "(", "-", "12", ",", "-", "10", ")", "\n", "]", ")", "\n", "r", ".", "pop", "(", ")", "\n", "r", ".", "endFrame", "(", ")", "\n", "\n", "if", "mode", "==", "'rgb_array'", ":", "\n", "            ", "return", "r", ".", "getArray", "(", ")", "\n", "", "elif", "mode", "==", "'pixmap'", ":", "\n", "            ", "return", "r", ".", "getPixmap", "(", ")", "\n", "", "return", "r", "\n", "", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.roomgrid.Room.__init__": [[15, 38], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "\n", "self", ",", "\n", "top", ",", "\n", "size", "\n", ")", ":", "\n", "# Top-left corner and size (tuples)", "\n", "        ", "self", ".", "top", "=", "top", "\n", "self", ".", "size", "=", "size", "\n", "\n", "# List of door objects and door positions", "\n", "# Order of the doors is right, down, left, up", "\n", "self", ".", "doors", "=", "[", "None", "]", "*", "4", "\n", "self", ".", "door_pos", "=", "[", "None", "]", "*", "4", "\n", "\n", "# List of rooms adjacent to this one", "\n", "# Order of the neighbors is right, down, left, up", "\n", "self", ".", "neighbors", "=", "[", "None", "]", "*", "4", "\n", "\n", "# Indicates if this room is behind a locked door", "\n", "self", ".", "locked", "=", "False", "\n", "\n", "# List of objects contained", "\n", "self", ".", "objs", "=", "[", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.roomgrid.Room.rand_pos": [[39, 45], ["env._randPos"], "methods", ["None"], ["", "def", "rand_pos", "(", "self", ",", "env", ")", ":", "\n", "        ", "topX", ",", "topY", "=", "self", ".", "top", "\n", "sizeX", ",", "sizeY", "=", "self", ".", "size", "\n", "return", "env", ".", "_randPos", "(", "\n", "topX", "+", "1", ",", "topX", "+", "sizeX", "-", "1", ",", "\n", "topY", "+", "1", ",", "topY", "+", "sizeY", "-", "1", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.roomgrid.Room.pos_inside": [[47, 62], ["None"], "methods", ["None"], ["", "def", "pos_inside", "(", "self", ",", "x", ",", "y", ")", ":", "\n", "        ", "\"\"\"\n        Check if a position is within the bounds of this room\n        \"\"\"", "\n", "\n", "topX", ",", "topY", "=", "self", ".", "top", "\n", "sizeX", ",", "sizeY", "=", "self", ".", "size", "\n", "\n", "if", "x", "<", "topX", "or", "y", "<", "topY", ":", "\n", "            ", "return", "False", "\n", "\n", "", "if", "x", ">=", "topX", "+", "sizeX", "or", "y", ">=", "topY", "+", "sizeY", ":", "\n", "            ", "return", "False", "\n", "\n", "", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.roomgrid.RoomGrid.__init__": [[69, 97], ["minigrid.MiniGridEnv.__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "\n", "self", ",", "\n", "room_size", "=", "7", ",", "\n", "num_rows", "=", "3", ",", "\n", "num_cols", "=", "3", ",", "\n", "max_steps", "=", "100", ",", "\n", "seed", "=", "0", "\n", ")", ":", "\n", "        ", "assert", "room_size", ">", "0", "\n", "assert", "room_size", ">=", "3", "\n", "assert", "num_rows", ">", "0", "\n", "assert", "num_cols", ">", "0", "\n", "self", ".", "room_size", "=", "room_size", "\n", "self", ".", "num_rows", "=", "num_rows", "\n", "self", ".", "num_cols", "=", "num_cols", "\n", "\n", "height", "=", "(", "room_size", "-", "1", ")", "*", "num_rows", "+", "1", "\n", "width", "=", "(", "room_size", "-", "1", ")", "*", "num_cols", "+", "1", "\n", "\n", "# By default, this environment has no mission", "\n", "self", ".", "mission", "=", "''", "\n", "\n", "super", "(", ")", ".", "__init__", "(", "\n", "width", "=", "width", ",", "\n", "height", "=", "height", ",", "\n", "max_steps", "=", "max_steps", ",", "\n", "see_through_walls", "=", "False", ",", "\n", "seed", "=", "seed", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.roomgrid.RoomGrid.room_from_pos": [[99, 112], ["None"], "methods", ["None"], ["", "def", "room_from_pos", "(", "self", ",", "x", ",", "y", ")", ":", "\n", "        ", "\"\"\"Get the room a given position maps to\"\"\"", "\n", "\n", "assert", "x", ">=", "0", "\n", "assert", "y", ">=", "0", "\n", "\n", "i", "=", "x", "//", "(", "self", ".", "room_size", "-", "1", ")", "\n", "j", "=", "y", "//", "(", "self", ".", "room_size", "-", "1", ")", "\n", "\n", "assert", "i", "<", "self", ".", "num_cols", "\n", "assert", "j", "<", "self", ".", "num_rows", "\n", "\n", "return", "self", ".", "room_grid", "[", "j", "]", "[", "i", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.roomgrid.RoomGrid.get_room": [[113, 117], ["None"], "methods", ["None"], ["", "def", "get_room", "(", "self", ",", "i", ",", "j", ")", ":", "\n", "        ", "assert", "i", "<", "self", ".", "num_cols", "\n", "assert", "j", "<", "self", ".", "num_rows", "\n", "return", "self", ".", "room_grid", "[", "j", "]", "[", "i", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.roomgrid.RoomGrid._gen_grid": [[118, 170], ["minigrid.Grid", "range", "range", "range", "roomgrid.RoomGrid.room_grid.append", "range", "roomgrid.Room", "row.append", "roomgrid.RoomGrid.grid.wall_rect", "roomgrid.RoomGrid._rand_int", "roomgrid.RoomGrid._rand_int"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int"], ["", "def", "_gen_grid", "(", "self", ",", "width", ",", "height", ")", ":", "\n", "# Create the grid", "\n", "        ", "self", ".", "grid", "=", "Grid", "(", "width", ",", "height", ")", "\n", "\n", "self", ".", "room_grid", "=", "[", "]", "\n", "\n", "# For each row of rooms", "\n", "for", "j", "in", "range", "(", "0", ",", "self", ".", "num_rows", ")", ":", "\n", "            ", "row", "=", "[", "]", "\n", "\n", "# For each column of rooms", "\n", "for", "i", "in", "range", "(", "0", ",", "self", ".", "num_cols", ")", ":", "\n", "                ", "room", "=", "Room", "(", "\n", "(", "i", "*", "(", "self", ".", "room_size", "-", "1", ")", ",", "j", "*", "(", "self", ".", "room_size", "-", "1", ")", ")", ",", "\n", "(", "self", ".", "room_size", ",", "self", ".", "room_size", ")", "\n", ")", "\n", "row", ".", "append", "(", "room", ")", "\n", "\n", "# Generate the walls for this room", "\n", "self", ".", "grid", ".", "wall_rect", "(", "*", "room", ".", "top", ",", "*", "room", ".", "size", ")", "\n", "\n", "", "self", ".", "room_grid", ".", "append", "(", "row", ")", "\n", "\n", "# For each row of rooms", "\n", "", "for", "j", "in", "range", "(", "0", ",", "self", ".", "num_rows", ")", ":", "\n", "# For each column of rooms", "\n", "            ", "for", "i", "in", "range", "(", "0", ",", "self", ".", "num_cols", ")", ":", "\n", "                ", "room", "=", "self", ".", "room_grid", "[", "j", "]", "[", "i", "]", "\n", "\n", "x_l", ",", "y_l", "=", "(", "room", ".", "top", "[", "0", "]", "+", "1", ",", "room", ".", "top", "[", "1", "]", "+", "1", ")", "\n", "x_m", ",", "y_m", "=", "(", "room", ".", "top", "[", "0", "]", "+", "room", ".", "size", "[", "0", "]", "-", "1", ",", "room", ".", "top", "[", "1", "]", "+", "room", ".", "size", "[", "1", "]", "-", "1", ")", "\n", "\n", "# Door positions, order is right, down, left, up", "\n", "if", "i", "<", "self", ".", "num_cols", "-", "1", ":", "\n", "                    ", "room", ".", "neighbors", "[", "0", "]", "=", "self", ".", "room_grid", "[", "j", "]", "[", "i", "+", "1", "]", "\n", "room", ".", "door_pos", "[", "0", "]", "=", "(", "x_m", ",", "self", ".", "_rand_int", "(", "y_l", ",", "y_m", ")", ")", "\n", "", "if", "j", "<", "self", ".", "num_rows", "-", "1", ":", "\n", "                    ", "room", ".", "neighbors", "[", "1", "]", "=", "self", ".", "room_grid", "[", "j", "+", "1", "]", "[", "i", "]", "\n", "room", ".", "door_pos", "[", "1", "]", "=", "(", "self", ".", "_rand_int", "(", "x_l", ",", "x_m", ")", ",", "y_m", ")", "\n", "", "if", "i", ">", "0", ":", "\n", "                    ", "room", ".", "neighbors", "[", "2", "]", "=", "self", ".", "room_grid", "[", "j", "]", "[", "i", "-", "1", "]", "\n", "room", ".", "door_pos", "[", "2", "]", "=", "room", ".", "neighbors", "[", "2", "]", ".", "door_pos", "[", "0", "]", "\n", "", "if", "j", ">", "0", ":", "\n", "                    ", "room", ".", "neighbors", "[", "3", "]", "=", "self", ".", "room_grid", "[", "j", "-", "1", "]", "[", "i", "]", "\n", "room", ".", "door_pos", "[", "3", "]", "=", "room", ".", "neighbors", "[", "3", "]", ".", "door_pos", "[", "1", "]", "\n", "\n", "# The agent starts in the middle, facing right", "\n", "", "", "", "self", ".", "agent_pos", "=", "(", "\n", "(", "self", ".", "num_cols", "//", "2", ")", "*", "(", "self", ".", "room_size", "-", "1", ")", "+", "(", "self", ".", "room_size", "//", "2", ")", ",", "\n", "(", "self", ".", "num_rows", "//", "2", ")", "*", "(", "self", ".", "room_size", "-", "1", ")", "+", "(", "self", ".", "room_size", "//", "2", ")", "\n", ")", "\n", "self", ".", "agent_dir", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.roomgrid.RoomGrid.place_in_room": [[171, 189], ["roomgrid.RoomGrid.get_room", "roomgrid.RoomGrid.place_obj", "roomgrid.RoomGrid.objs.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.get_room", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.place_obj", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "place_in_room", "(", "self", ",", "i", ",", "j", ",", "obj", ")", ":", "\n", "        ", "\"\"\"\n        Add an existing object to room (i, j)\n        \"\"\"", "\n", "\n", "room", "=", "self", ".", "get_room", "(", "i", ",", "j", ")", "\n", "\n", "pos", "=", "self", ".", "place_obj", "(", "\n", "obj", ",", "\n", "room", ".", "top", ",", "\n", "room", ".", "size", ",", "\n", "reject_fn", "=", "reject_next_to", ",", "\n", "max_tries", "=", "1000", "\n", ")", "\n", "\n", "room", ".", "objs", ".", "append", "(", "obj", ")", "\n", "\n", "return", "obj", ",", "pos", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.roomgrid.RoomGrid.add_object": [[190, 211], ["roomgrid.RoomGrid.place_in_room", "roomgrid.RoomGrid._rand_elem", "roomgrid.RoomGrid._rand_color", "Key", "Ball", "Box"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.place_in_room"], ["", "def", "add_object", "(", "self", ",", "i", ",", "j", ",", "kind", "=", "None", ",", "color", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n        Add a new object to room (i, j)\n        \"\"\"", "\n", "\n", "if", "kind", "==", "None", ":", "\n", "            ", "kind", "=", "self", ".", "_rand_elem", "(", "[", "'key'", ",", "'ball'", ",", "'box'", "]", ")", "\n", "\n", "", "if", "color", "==", "None", ":", "\n", "            ", "color", "=", "self", ".", "_rand_color", "(", ")", "\n", "\n", "# TODO: we probably want to add an Object.make helper function", "\n", "", "assert", "kind", "in", "[", "'key'", ",", "'ball'", ",", "'box'", "]", "\n", "if", "kind", "==", "'key'", ":", "\n", "            ", "obj", "=", "Key", "(", "color", ")", "\n", "", "elif", "kind", "==", "'ball'", ":", "\n", "            ", "obj", "=", "Ball", "(", "color", ")", "\n", "", "elif", "kind", "==", "'box'", ":", "\n", "            ", "obj", "=", "Box", "(", "color", ")", "\n", "\n", "", "return", "self", ".", "place_in_room", "(", "i", ",", "j", ",", "obj", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.roomgrid.RoomGrid.add_door": [[212, 247], ["roomgrid.RoomGrid.get_room", "Door", "roomgrid.RoomGrid.grid.set", "roomgrid.RoomGrid._rand_color", "roomgrid.RoomGrid._rand_bool", "roomgrid.RoomGrid._rand_int"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.get_room", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int"], ["", "def", "add_door", "(", "self", ",", "i", ",", "j", ",", "door_idx", "=", "None", ",", "color", "=", "None", ",", "locked", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n        Add a door to a room, connecting it to a neighbor\n        \"\"\"", "\n", "\n", "room", "=", "self", ".", "get_room", "(", "i", ",", "j", ")", "\n", "\n", "if", "door_idx", "==", "None", ":", "\n", "# Need to make sure that there is a neighbor along this wall", "\n", "# and that there is not already a door", "\n", "            ", "while", "True", ":", "\n", "                ", "door_idx", "=", "self", ".", "_rand_int", "(", "0", ",", "4", ")", "\n", "if", "room", ".", "neighbors", "[", "door_idx", "]", "and", "room", ".", "doors", "[", "door_idx", "]", "is", "None", ":", "\n", "                    ", "break", "\n", "\n", "", "", "", "if", "color", "==", "None", ":", "\n", "            ", "color", "=", "self", ".", "_rand_color", "(", ")", "\n", "\n", "", "if", "locked", "is", "None", ":", "\n", "            ", "locked", "=", "self", ".", "_rand_bool", "(", ")", "\n", "\n", "", "assert", "room", ".", "doors", "[", "door_idx", "]", "is", "None", ",", "\"door already exists\"", "\n", "\n", "room", ".", "locked", "=", "locked", "\n", "door", "=", "Door", "(", "color", ",", "is_locked", "=", "locked", ")", "\n", "\n", "pos", "=", "room", ".", "door_pos", "[", "door_idx", "]", "\n", "self", ".", "grid", ".", "set", "(", "*", "pos", ",", "door", ")", "\n", "door", ".", "cur_pos", "=", "pos", "\n", "\n", "neighbor", "=", "room", ".", "neighbors", "[", "door_idx", "]", "\n", "room", ".", "doors", "[", "door_idx", "]", "=", "door", "\n", "neighbor", ".", "doors", "[", "(", "door_idx", "+", "2", ")", "%", "4", "]", "=", "door", "\n", "\n", "return", "door", ",", "pos", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.roomgrid.RoomGrid.remove_wall": [[248, 283], ["roomgrid.RoomGrid.get_room", "range", "roomgrid.RoomGrid.grid.set", "range", "roomgrid.RoomGrid.grid.set", "range", "roomgrid.RoomGrid.grid.set", "range", "roomgrid.RoomGrid.grid.set"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.get_room", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set"], ["", "def", "remove_wall", "(", "self", ",", "i", ",", "j", ",", "wall_idx", ")", ":", "\n", "        ", "\"\"\"\n        Remove a wall between two rooms\n        \"\"\"", "\n", "\n", "room", "=", "self", ".", "get_room", "(", "i", ",", "j", ")", "\n", "\n", "assert", "wall_idx", ">=", "0", "and", "wall_idx", "<", "4", "\n", "assert", "room", ".", "doors", "[", "wall_idx", "]", "is", "None", ",", "\"door exists on this wall\"", "\n", "assert", "room", ".", "neighbors", "[", "wall_idx", "]", ",", "\"invalid wall\"", "\n", "\n", "neighbor", "=", "room", ".", "neighbors", "[", "wall_idx", "]", "\n", "\n", "tx", ",", "ty", "=", "room", ".", "top", "\n", "w", ",", "h", "=", "room", ".", "size", "\n", "\n", "# Ordering of walls is right, down, left, up", "\n", "if", "wall_idx", "==", "0", ":", "\n", "            ", "for", "i", "in", "range", "(", "1", ",", "h", "-", "1", ")", ":", "\n", "                ", "self", ".", "grid", ".", "set", "(", "tx", "+", "w", "-", "1", ",", "ty", "+", "i", ",", "None", ")", "\n", "", "", "elif", "wall_idx", "==", "1", ":", "\n", "            ", "for", "i", "in", "range", "(", "1", ",", "w", "-", "1", ")", ":", "\n", "                ", "self", ".", "grid", ".", "set", "(", "tx", "+", "i", ",", "ty", "+", "h", "-", "1", ",", "None", ")", "\n", "", "", "elif", "wall_idx", "==", "2", ":", "\n", "            ", "for", "i", "in", "range", "(", "1", ",", "h", "-", "1", ")", ":", "\n", "                ", "self", ".", "grid", ".", "set", "(", "tx", ",", "ty", "+", "i", ",", "None", ")", "\n", "", "", "elif", "wall_idx", "==", "3", ":", "\n", "            ", "for", "i", "in", "range", "(", "1", ",", "w", "-", "1", ")", ":", "\n", "                ", "self", ".", "grid", ".", "set", "(", "tx", "+", "i", ",", "ty", ",", "None", ")", "\n", "", "", "else", ":", "\n", "            ", "assert", "False", ",", "\"invalid wall index\"", "\n", "\n", "# Mark the rooms as connected", "\n", "", "room", ".", "doors", "[", "wall_idx", "]", "=", "True", "\n", "neighbor", ".", "doors", "[", "(", "wall_idx", "+", "2", ")", "%", "4", "]", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.roomgrid.RoomGrid.place_agent": [[284, 304], ["roomgrid.RoomGrid._rand_int", "roomgrid.RoomGrid._rand_int", "super().place_agent", "roomgrid.RoomGrid.grid.get"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.place_agent", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "def", "place_agent", "(", "self", ",", "i", "=", "None", ",", "j", "=", "None", ",", "rand_dir", "=", "True", ")", ":", "\n", "        ", "\"\"\"\n        Place the agent in a room\n        \"\"\"", "\n", "\n", "if", "i", "==", "None", ":", "\n", "            ", "i", "=", "self", ".", "_rand_int", "(", "0", ",", "self", ".", "num_cols", ")", "\n", "", "if", "j", "==", "None", ":", "\n", "            ", "j", "=", "self", ".", "_rand_int", "(", "0", ",", "self", ".", "num_rows", ")", "\n", "\n", "", "room", "=", "self", ".", "room_grid", "[", "j", "]", "[", "i", "]", "\n", "\n", "# Find a position that is not right in front of an object", "\n", "while", "True", ":", "\n", "            ", "super", "(", ")", ".", "place_agent", "(", "room", ".", "top", ",", "room", ".", "size", ",", "rand_dir", ",", "max_tries", "=", "1000", ")", "\n", "front_cell", "=", "self", ".", "grid", ".", "get", "(", "*", "self", ".", "front_pos", ")", "\n", "if", "front_cell", "is", "None", "or", "front_cell", ".", "type", "is", "'wall'", ":", "\n", "                ", "break", "\n", "\n", "", "", "return", "self", ".", "agent_pos", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.roomgrid.RoomGrid.connect_all": [[305, 360], ["roomgrid.RoomGrid.room_from_pos", "set", "roomgrid.RoomGrid.connect_all.find_reach"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.room_from_pos", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set"], ["", "def", "connect_all", "(", "self", ",", "door_colors", "=", "COLOR_NAMES", ",", "max_itrs", "=", "5000", ")", ":", "\n", "        ", "\"\"\"\n        Make sure that all rooms are reachable by the agent from its\n        starting position\n        \"\"\"", "\n", "\n", "start_room", "=", "self", ".", "room_from_pos", "(", "*", "self", ".", "agent_pos", ")", "\n", "\n", "added_doors", "=", "[", "]", "\n", "\n", "def", "find_reach", "(", ")", ":", "\n", "            ", "reach", "=", "set", "(", ")", "\n", "stack", "=", "[", "start_room", "]", "\n", "while", "len", "(", "stack", ")", ">", "0", ":", "\n", "                ", "room", "=", "stack", ".", "pop", "(", ")", "\n", "if", "room", "in", "reach", ":", "\n", "                    ", "continue", "\n", "", "reach", ".", "add", "(", "room", ")", "\n", "for", "i", "in", "range", "(", "0", ",", "4", ")", ":", "\n", "                    ", "if", "room", ".", "doors", "[", "i", "]", ":", "\n", "                        ", "stack", ".", "append", "(", "room", ".", "neighbors", "[", "i", "]", ")", "\n", "", "", "", "return", "reach", "\n", "\n", "", "num_itrs", "=", "0", "\n", "\n", "while", "True", ":", "\n", "# This is to handle rare situations where random sampling produces", "\n", "# a level that cannot be connected, producing in an infinite loop", "\n", "            ", "if", "num_itrs", ">", "max_itrs", ":", "\n", "                ", "raise", "RecursionError", "(", "'connect_all failed'", ")", "\n", "", "num_itrs", "+=", "1", "\n", "\n", "# If all rooms are reachable, stop", "\n", "reach", "=", "find_reach", "(", ")", "\n", "if", "len", "(", "reach", ")", "==", "self", ".", "num_rows", "*", "self", ".", "num_cols", ":", "\n", "                ", "break", "\n", "\n", "# Pick a random room and door position", "\n", "", "i", "=", "self", ".", "_rand_int", "(", "0", ",", "self", ".", "num_cols", ")", "\n", "j", "=", "self", ".", "_rand_int", "(", "0", ",", "self", ".", "num_rows", ")", "\n", "k", "=", "self", ".", "_rand_int", "(", "0", ",", "4", ")", "\n", "room", "=", "self", ".", "get_room", "(", "i", ",", "j", ")", "\n", "\n", "# If there is already a door there, skip", "\n", "if", "not", "room", ".", "door_pos", "[", "k", "]", "or", "room", ".", "doors", "[", "k", "]", ":", "\n", "                ", "continue", "\n", "\n", "", "if", "room", ".", "locked", "or", "room", ".", "neighbors", "[", "k", "]", ".", "locked", ":", "\n", "                ", "continue", "\n", "\n", "", "color", "=", "self", ".", "_rand_elem", "(", "door_colors", ")", "\n", "door", ",", "_", "=", "self", ".", "add_door", "(", "i", ",", "j", ",", "k", ",", "color", ",", "False", ")", "\n", "added_doors", ".", "append", "(", "door", ")", "\n", "\n", "", "return", "added_doors", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.roomgrid.RoomGrid.add_distractors": [[361, 398], ["len", "roomgrid.RoomGrid._rand_elem", "roomgrid.RoomGrid._rand_elem", "roomgrid.RoomGrid.add_object", "objs.append", "dists.append", "roomgrid.RoomGrid._rand_int", "roomgrid.RoomGrid._rand_int", "objs.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.add_object", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "add_distractors", "(", "self", ",", "i", "=", "None", ",", "j", "=", "None", ",", "num_distractors", "=", "10", ",", "all_unique", "=", "True", ")", ":", "\n", "        ", "\"\"\"\n        Add random objects that can potentially distract/confuse the agent.\n        \"\"\"", "\n", "\n", "# Collect a list of existing objects", "\n", "objs", "=", "[", "]", "\n", "for", "row", "in", "self", ".", "room_grid", ":", "\n", "            ", "for", "room", "in", "row", ":", "\n", "                ", "for", "obj", "in", "room", ".", "objs", ":", "\n", "                    ", "objs", ".", "append", "(", "(", "obj", ".", "type", ",", "obj", ".", "color", ")", ")", "\n", "\n", "# List of distractors added", "\n", "", "", "", "dists", "=", "[", "]", "\n", "\n", "while", "len", "(", "dists", ")", "<", "num_distractors", ":", "\n", "            ", "color", "=", "self", ".", "_rand_elem", "(", "COLOR_NAMES", ")", "\n", "type", "=", "self", ".", "_rand_elem", "(", "[", "'key'", ",", "'ball'", ",", "'box'", "]", ")", "\n", "obj", "=", "(", "type", ",", "color", ")", "\n", "\n", "if", "all_unique", "and", "obj", "in", "objs", ":", "\n", "                ", "continue", "\n", "\n", "# Add the object to a random room if no room specified", "\n", "", "room_i", "=", "i", "\n", "room_j", "=", "j", "\n", "if", "room_i", "==", "None", ":", "\n", "                ", "room_i", "=", "self", ".", "_rand_int", "(", "0", ",", "self", ".", "num_cols", ")", "\n", "", "if", "room_j", "==", "None", ":", "\n", "                ", "room_j", "=", "self", ".", "_rand_int", "(", "0", ",", "self", ".", "num_rows", ")", "\n", "\n", "", "dist", ",", "pos", "=", "self", ".", "add_object", "(", "room_i", ",", "room_j", ",", "*", "obj", ")", "\n", "\n", "objs", ".", "append", "(", "obj", ")", "\n", "dists", ".", "append", "(", "dist", ")", "\n", "\n", "", "return", "dists", "\n", "", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.roomgrid.reject_next_to": [[3, 13], ["abs", "abs"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.abs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.abs"], ["def", "reject_next_to", "(", "env", ",", "pos", ")", ":", "\n", "    ", "\"\"\"\n    Function to filter out object positions that are right next to\n    the agent's starting point\n    \"\"\"", "\n", "\n", "sx", ",", "sy", "=", "env", ".", "agent_pos", "\n", "x", ",", "y", "=", "pos", "\n", "d", "=", "abs", "(", "sx", "-", "x", ")", "+", "abs", "(", "sy", "-", "y", ")", "\n", "return", "d", "<", "2", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.LSystem.are_the_same_rules": [[806, 817], ["rule_dict_one.items", "rules.items", "str", "str"], "methods", ["None"], ["", "def", "__eq__", "(", "self", ",", "l_system", ":", "\"LSystem\"", ")", ":", "\n", "        ", "this_representation", "=", "self", ".", "to_representation", "(", ")", "\n", "that_representation", "=", "l_system", ".", "to_representation", "(", ")", "\n", "for", "key", ",", "value", "in", "this_representation", ".", "items", "(", ")", ":", "\n", "            ", "if", "key", "not", "in", "that_representation", ":", "\n", "                ", "return", "False", "\n", "", "that_value", "=", "that_representation", "[", "key", "]", "\n", "if", "value", "!=", "that_value", ":", "\n", "                ", "return", "False", "\n", "", "", "for", "key", ",", "value", "in", "that_representation", ".", "items", "(", ")", ":", "\n", "            ", "if", "key", "not", "in", "this_representation", ":", "\n", "                ", "return", "False", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.register.register": [[5, 22], ["id.startswith", "gym.envs.registration.register", "env_list.append"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.register.register", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["def", "register", "(", "\n", "id", ",", "\n", "entry_point", ",", "\n", "reward_threshold", "=", "0.95", "\n", ")", ":", "\n", "    ", "assert", "id", ".", "startswith", "(", "\"MiniGrid-\"", ")", "\n", "assert", "id", "not", "in", "env_list", "\n", "\n", "# Register the environment with OpenAI gym", "\n", "gym_register", "(", "\n", "id", "=", "id", ",", "\n", "entry_point", "=", "entry_point", ",", "\n", "reward_threshold", "=", "reward_threshold", "\n", ")", "\n", "\n", "# Add the environment to the set", "\n", "env_list", ".", "append", "(", "id", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.ReseedWrapper.__init__": [[18, 22], ["list", "super().__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "env", ",", "seeds", "=", "[", "0", "]", ",", "seed_idx", "=", "0", ")", ":", "\n", "        ", "self", ".", "seeds", "=", "list", "(", "seeds", ")", "\n", "self", ".", "seed_idx", "=", "seed_idx", "\n", "super", "(", ")", ".", "__init__", "(", "env", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.ReseedWrapper.reset": [[23, 28], ["wrappers.ReseedWrapper.env.seed", "wrappers.ReseedWrapper.env.reset", "len"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.seed", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.reset"], ["", "def", "reset", "(", "self", ",", "**", "kwargs", ")", ":", "\n", "        ", "seed", "=", "self", ".", "seeds", "[", "self", ".", "seed_idx", "]", "\n", "self", ".", "seed_idx", "=", "(", "self", ".", "seed_idx", "+", "1", ")", "%", "len", "(", "self", ".", "seeds", ")", "\n", "self", ".", "env", ".", "seed", "(", "seed", ")", "\n", "return", "self", ".", "env", ".", "reset", "(", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.ReseedWrapper.step": [[29, 32], ["wrappers.ReseedWrapper.env.step"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.step"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "obs", ",", "reward", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "return", "obs", ",", "reward", ",", "done", ",", "info", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.ActionBonus.__init__": [[40, 43], ["super().__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "env", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "env", ")", "\n", "self", ".", "counts", "=", "{", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.ActionBonus.step": [[44, 63], ["wrappers.ActionBonus.env.step", "tuple", "math.sqrt"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.step"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "obs", ",", "reward", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "\n", "env", "=", "self", ".", "unwrapped", "\n", "tup", "=", "(", "tuple", "(", "env", ".", "agent_pos", ")", ",", "env", ".", "agent_dir", ",", "action", ")", "\n", "\n", "# Get the count for this (s,a) pair", "\n", "pre_count", "=", "0", "\n", "if", "tup", "in", "self", ".", "counts", ":", "\n", "            ", "pre_count", "=", "self", ".", "counts", "[", "tup", "]", "\n", "\n", "# Update the count for this (s,a) pair", "\n", "", "new_count", "=", "pre_count", "+", "1", "\n", "self", ".", "counts", "[", "tup", "]", "=", "new_count", "\n", "\n", "bonus", "=", "1", "/", "math", ".", "sqrt", "(", "new_count", ")", "\n", "reward", "+=", "bonus", "\n", "\n", "return", "obs", ",", "reward", ",", "done", ",", "info", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.ActionBonus.reset": [[64, 66], ["wrappers.ActionBonus.env.reset"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.reset"], ["", "def", "reset", "(", "self", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "env", ".", "reset", "(", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.StateBonus.__init__": [[73, 76], ["super().__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "env", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "env", ")", "\n", "self", ".", "counts", "=", "{", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.StateBonus.step": [[77, 98], ["wrappers.StateBonus.env.step", "tuple", "math.sqrt"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.step"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "obs", ",", "reward", ",", "done", ",", "info", "=", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "\n", "# Tuple based on which we index the counts", "\n", "# We use the position after an update", "\n", "env", "=", "self", ".", "unwrapped", "\n", "tup", "=", "(", "tuple", "(", "env", ".", "agent_pos", ")", ")", "\n", "\n", "# Get the count for this key", "\n", "pre_count", "=", "0", "\n", "if", "tup", "in", "self", ".", "counts", ":", "\n", "            ", "pre_count", "=", "self", ".", "counts", "[", "tup", "]", "\n", "\n", "# Update the count for this key", "\n", "", "new_count", "=", "pre_count", "+", "1", "\n", "self", ".", "counts", "[", "tup", "]", "=", "new_count", "\n", "\n", "bonus", "=", "1", "/", "math", ".", "sqrt", "(", "new_count", ")", "\n", "reward", "+=", "bonus", "\n", "\n", "return", "obs", ",", "reward", ",", "done", ",", "info", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.StateBonus.reset": [[99, 101], ["wrappers.StateBonus.env.reset"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.reset"], ["", "def", "reset", "(", "self", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "env", ".", "reset", "(", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.ImgObsWrapper.__init__": [[107, 111], ["super().__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "env", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "env", ")", "\n", "\n", "self", ".", "observation_space", "=", "env", ".", "observation_space", ".", "spaces", "[", "'image'", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.ImgObsWrapper.observation": [[112, 114], ["None"], "methods", ["None"], ["", "def", "observation", "(", "self", ",", "obs", ")", ":", "\n", "        ", "return", "obs", "[", "'image'", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.RGBImgObsWrapper.__init__": [[122, 132], ["super().__init__", "gym.spaces.Box"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "env", ",", "tile_size", "=", "8", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "env", ")", "\n", "\n", "self", ".", "tile_size", "=", "tile_size", "\n", "\n", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "\n", "low", "=", "0", ",", "\n", "high", "=", "255", ",", "\n", "shape", "=", "(", "self", ".", "env", ".", "width", "*", "tile_size", ",", "self", ".", "env", ".", "height", "*", "tile_size", ",", "3", ")", ",", "\n", "dtype", "=", "'uint8'", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.RGBImgObsWrapper.observation": [[134, 140], ["env.render"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.render"], ["", "def", "observation", "(", "self", ",", "obs", ")", ":", "\n", "        ", "env", "=", "self", ".", "unwrapped", "\n", "return", "env", ".", "render", "(", "\n", "mode", "=", "'rgb_array'", ",", "\n", "highlight", "=", "False", ",", "\n", "tile_size", "=", "self", ".", "tile_size", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.FullyObsWrapper.__init__": [[147, 155], ["super().__init__", "gym.spaces.Box"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "env", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "env", ")", "\n", "\n", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "\n", "low", "=", "0", ",", "\n", "high", "=", "255", ",", "\n", "shape", "=", "(", "self", ".", "env", ".", "width", ",", "self", ".", "env", ".", "height", ",", "3", ")", ",", "# number of cells", "\n", "dtype", "=", "'uint8'", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.FullyObsWrapper.observation": [[157, 167], ["env.grid.encode", "numpy.array"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.encode"], ["", "def", "observation", "(", "self", ",", "obs", ")", ":", "\n", "        ", "env", "=", "self", ".", "unwrapped", "\n", "full_grid", "=", "env", ".", "grid", ".", "encode", "(", ")", "\n", "full_grid", "[", "env", ".", "agent_pos", "[", "0", "]", "]", "[", "env", ".", "agent_pos", "[", "1", "]", "]", "=", "np", ".", "array", "(", "[", "\n", "OBJECT_TO_IDX", "[", "'agent'", "]", ",", "\n", "COLOR_TO_IDX", "[", "'red'", "]", ",", "\n", "env", ".", "agent_dir", "\n", "]", ")", "\n", "\n", "return", "full_grid", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.FlatObsWrapper.__init__": [[174, 192], ["super().__init__", "functools.reduce", "gym.spaces.Box"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "env", ",", "maxStrLen", "=", "96", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "env", ")", "\n", "\n", "self", ".", "maxStrLen", "=", "maxStrLen", "\n", "self", ".", "numCharCodes", "=", "27", "\n", "\n", "imgSpace", "=", "env", ".", "observation_space", ".", "spaces", "[", "'image'", "]", "\n", "imgSize", "=", "reduce", "(", "operator", ".", "mul", ",", "imgSpace", ".", "shape", ",", "1", ")", "\n", "\n", "self", ".", "observation_space", "=", "spaces", ".", "Box", "(", "\n", "low", "=", "0", ",", "\n", "high", "=", "255", ",", "\n", "shape", "=", "(", "1", ",", "imgSize", "+", "self", ".", "numCharCodes", "*", "self", ".", "maxStrLen", ")", ",", "\n", "dtype", "=", "'uint8'", "\n", ")", "\n", "\n", "self", ".", "cachedStr", "=", "None", "\n", "self", ".", "cachedArray", "=", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.FlatObsWrapper.observation": [[193, 218], ["numpy.concatenate", "mission.lower.lower.lower", "numpy.zeros", "enumerate", "len", "len", "image.flatten", "wrappers.FlatObsWrapper.cachedArray.flatten", "ord", "ord", "ord", "ord"], "methods", ["None"], ["", "def", "observation", "(", "self", ",", "obs", ")", ":", "\n", "        ", "image", "=", "obs", "[", "'image'", "]", "\n", "mission", "=", "obs", "[", "'mission'", "]", "\n", "\n", "# Cache the last-encoded mission string", "\n", "if", "mission", "!=", "self", ".", "cachedStr", ":", "\n", "            ", "assert", "len", "(", "mission", ")", "<=", "self", ".", "maxStrLen", ",", "'mission string too long ({} chars)'", ".", "format", "(", "len", "(", "mission", ")", ")", "\n", "mission", "=", "mission", ".", "lower", "(", ")", "\n", "\n", "strArray", "=", "np", ".", "zeros", "(", "shape", "=", "(", "self", ".", "maxStrLen", ",", "self", ".", "numCharCodes", ")", ",", "dtype", "=", "'float32'", ")", "\n", "\n", "for", "idx", ",", "ch", "in", "enumerate", "(", "mission", ")", ":", "\n", "                ", "if", "ch", ">=", "'a'", "and", "ch", "<=", "'z'", ":", "\n", "                    ", "chNo", "=", "ord", "(", "ch", ")", "-", "ord", "(", "'a'", ")", "\n", "", "elif", "ch", "==", "' '", ":", "\n", "                    ", "chNo", "=", "ord", "(", "'z'", ")", "-", "ord", "(", "'a'", ")", "+", "1", "\n", "", "assert", "chNo", "<", "self", ".", "numCharCodes", ",", "'%s : %d'", "%", "(", "ch", ",", "chNo", ")", "\n", "strArray", "[", "idx", ",", "chNo", "]", "=", "1", "\n", "\n", "", "self", ".", "cachedStr", "=", "mission", "\n", "self", ".", "cachedArray", "=", "strArray", "\n", "\n", "", "obs", "=", "np", ".", "concatenate", "(", "(", "image", ".", "flatten", "(", ")", ",", "self", ".", "cachedArray", ".", "flatten", "(", ")", ")", ")", "\n", "\n", "return", "obs", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.AgentViewWrapper.__init__": [[224, 241], ["super().__init__", "gym.spaces.Box", "gym.spaces.Dict"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ",", "env", ",", "agent_view_size", "=", "7", ")", ":", "\n", "        ", "super", "(", "AgentViewWrapper", ",", "self", ")", ".", "__init__", "(", "env", ")", "\n", "\n", "# Override default view size", "\n", "env", ".", "unwrapped", ".", "agent_view_size", "=", "agent_view_size", "\n", "\n", "# Compute observation space with specified view size", "\n", "observation_space", "=", "gym", ".", "spaces", ".", "Box", "(", "\n", "low", "=", "0", ",", "\n", "high", "=", "255", ",", "\n", "shape", "=", "(", "agent_view_size", ",", "agent_view_size", ",", "3", ")", ",", "\n", "dtype", "=", "'uint8'", "\n", ")", "\n", "\n", "# Override the environment's observation space", "\n", "self", ".", "observation_space", "=", "spaces", ".", "Dict", "(", "{", "\n", "'image'", ":", "observation_space", "\n", "}", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.AgentViewWrapper.reset": [[243, 245], ["wrappers.AgentViewWrapper.env.reset"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.reset"], ["", "def", "reset", "(", "self", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "self", ".", "env", ".", "reset", "(", "**", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.wrappers.AgentViewWrapper.step": [[246, 248], ["wrappers.AgentViewWrapper.env.step"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.step"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "return", "self", ".", "env", ".", "step", "(", "action", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Window.__init__": [[14, 52], ["PyQt5.QtWidgets.QMainWindow.__init__", "rendering.Window.setWindowTitle", "PyQt5.QtWidgets.QLabel", "rendering.Window.imgLabel.setFrameStyle", "PyQt5.QtWidgets.QTextEdit", "rendering.Window.missionBox.setReadOnly", "rendering.Window.missionBox.setMinimumSize", "PyQt5.QtWidgets.QHBoxLayout", "PyQt5.QtWidgets.QHBoxLayout.addStretch", "PyQt5.QtWidgets.QHBoxLayout.addWidget", "PyQt5.QtWidgets.QHBoxLayout.addStretch", "PyQt5.QtWidgets.QVBoxLayout", "PyQt5.QtWidgets.QVBoxLayout.addLayout", "PyQt5.QtWidgets.QVBoxLayout.addWidget", "PyQt5.QtWidgets.QWidget", "rendering.Window.setCentralWidget", "rendering.Window.mainWidget.setLayout", "rendering.Window.show", "rendering.Window.setFocus"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "setWindowTitle", "(", "'MiniGrid Gym Environment'", ")", "\n", "\n", "# Image label to display the rendering", "\n", "self", ".", "imgLabel", "=", "QLabel", "(", ")", "\n", "self", ".", "imgLabel", ".", "setFrameStyle", "(", "QFrame", ".", "Panel", "|", "QFrame", ".", "Sunken", ")", "\n", "\n", "# Text box for the mission", "\n", "self", ".", "missionBox", "=", "QTextEdit", "(", ")", "\n", "self", ".", "missionBox", ".", "setReadOnly", "(", "True", ")", "\n", "self", ".", "missionBox", ".", "setMinimumSize", "(", "400", ",", "100", ")", "\n", "\n", "# Center the image", "\n", "hbox", "=", "QHBoxLayout", "(", ")", "\n", "hbox", ".", "addStretch", "(", "1", ")", "\n", "hbox", ".", "addWidget", "(", "self", ".", "imgLabel", ")", "\n", "hbox", ".", "addStretch", "(", "1", ")", "\n", "\n", "# Arrange widgets vertically", "\n", "vbox", "=", "QVBoxLayout", "(", ")", "\n", "vbox", ".", "addLayout", "(", "hbox", ")", "\n", "vbox", ".", "addWidget", "(", "self", ".", "missionBox", ")", "\n", "\n", "# Create a main widget for the window", "\n", "self", ".", "mainWidget", "=", "QWidget", "(", "self", ")", "\n", "self", ".", "setCentralWidget", "(", "self", ".", "mainWidget", ")", "\n", "self", ".", "mainWidget", ".", "setLayout", "(", "vbox", ")", "\n", "\n", "# Show the application window", "\n", "self", ".", "show", "(", ")", "\n", "self", ".", "setFocus", "(", ")", "\n", "\n", "self", ".", "closed", "=", "False", "\n", "\n", "# Callback for keyboard events", "\n", "self", ".", "keyDownCb", "=", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Window.closeEvent": [[53, 55], ["None"], "methods", ["None"], ["", "def", "closeEvent", "(", "self", ",", "event", ")", ":", "\n", "        ", "self", ".", "closed", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Window.setPixmap": [[56, 58], ["rendering.Window.imgLabel.setPixmap"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Window.setPixmap"], ["", "def", "setPixmap", "(", "self", ",", "pixmap", ")", ":", "\n", "        ", "self", ".", "imgLabel", ".", "setPixmap", "(", "pixmap", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Window.setText": [[59, 61], ["rendering.Window.missionBox.setPlainText"], "methods", ["None"], ["", "def", "setText", "(", "self", ",", "text", ")", ":", "\n", "        ", "self", ".", "missionBox", ".", "setPlainText", "(", "text", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Window.setKeyDownCb": [[62, 64], ["None"], "methods", ["None"], ["", "def", "setKeyDownCb", "(", "self", ",", "callback", ")", ":", "\n", "        ", "self", ".", "keyDownCb", "=", "callback", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Window.keyPressEvent": [[65, 98], ["rendering.Window.keyDownCb", "e.key", "e.key", "e.key", "e.key", "e.key", "e.key", "e.key", "e.key", "e.key", "e.key", "e.key", "e.key"], "methods", ["None"], ["", "def", "keyPressEvent", "(", "self", ",", "e", ")", ":", "\n", "        ", "if", "self", ".", "keyDownCb", "==", "None", ":", "\n", "            ", "return", "\n", "\n", "", "keyName", "=", "None", "\n", "if", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Left", ":", "\n", "            ", "keyName", "=", "'LEFT'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Right", ":", "\n", "            ", "keyName", "=", "'RIGHT'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Up", ":", "\n", "            ", "keyName", "=", "'UP'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Down", ":", "\n", "            ", "keyName", "=", "'DOWN'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Space", ":", "\n", "            ", "keyName", "=", "'SPACE'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Return", ":", "\n", "            ", "keyName", "=", "'RETURN'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Alt", ":", "\n", "            ", "keyName", "=", "'ALT'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Control", ":", "\n", "            ", "keyName", "=", "'CTRL'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_PageUp", ":", "\n", "            ", "keyName", "=", "'PAGE_UP'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_PageDown", ":", "\n", "            ", "keyName", "=", "'PAGE_DOWN'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Backspace", ":", "\n", "            ", "keyName", "=", "'BACKSPACE'", "\n", "", "elif", "e", ".", "key", "(", ")", "==", "Qt", ".", "Key_Escape", ":", "\n", "            ", "keyName", "=", "'ESCAPE'", "\n", "\n", "", "if", "keyName", "==", "None", ":", "\n", "            ", "return", "\n", "", "self", ".", "keyDownCb", "(", "keyName", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.__init__": [[101, 112], ["PyQt5.QtGui.QImage", "PyQt5.QtGui.QPainter", "PyQt5.QtWidgets.QApplication", "rendering.Window"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "width", ",", "height", ",", "ownWindow", "=", "False", ")", ":", "\n", "        ", "self", ".", "width", "=", "width", "\n", "self", ".", "height", "=", "height", "\n", "\n", "self", ".", "img", "=", "QImage", "(", "width", ",", "height", ",", "QImage", ".", "Format_RGB888", ")", "\n", "self", ".", "painter", "=", "QPainter", "(", ")", "\n", "\n", "self", ".", "window", "=", "None", "\n", "if", "ownWindow", ":", "\n", "            ", "self", ".", "app", "=", "QApplication", "(", "[", "]", ")", "\n", "self", ".", "window", "=", "Window", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.close": [[113, 118], ["None"], "methods", ["None"], ["", "", "def", "close", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Deallocate resources used\n        \"\"\"", "\n", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.beginFrame": [[119, 126], ["rendering.Renderer.painter.begin", "rendering.Renderer.painter.setRenderHint", "rendering.Renderer.painter.setBrush", "rendering.Renderer.painter.drawRect", "PyQt5.QtGui.QColor"], "methods", ["None"], ["", "def", "beginFrame", "(", "self", ")", ":", "\n", "        ", "self", ".", "painter", ".", "begin", "(", "self", ".", "img", ")", "\n", "self", ".", "painter", ".", "setRenderHint", "(", "QPainter", ".", "Antialiasing", ",", "False", ")", "\n", "\n", "# Clear the background", "\n", "self", ".", "painter", ".", "setBrush", "(", "QColor", "(", "0", ",", "0", ",", "0", ")", ")", "\n", "self", ".", "painter", ".", "drawRect", "(", "0", ",", "0", ",", "self", ".", "width", "-", "1", ",", "self", ".", "height", "-", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.endFrame": [[127, 136], ["rendering.Renderer.painter.end", "rendering.Renderer.window.setPixmap", "rendering.Renderer.app.processEvents", "rendering.Renderer.getPixmap"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Window.setPixmap", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.getPixmap"], ["", "def", "endFrame", "(", "self", ")", ":", "\n", "        ", "self", ".", "painter", ".", "end", "(", ")", "\n", "\n", "if", "self", ".", "window", ":", "\n", "            ", "if", "self", ".", "window", ".", "closed", ":", "\n", "                ", "self", ".", "window", "=", "None", "\n", "", "else", ":", "\n", "                ", "self", ".", "window", ".", "setPixmap", "(", "self", ".", "getPixmap", "(", ")", ")", "\n", "self", ".", "app", ".", "processEvents", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.getPixmap": [[137, 139], ["PyQt5.QtGui.QPixmap.fromImage"], "methods", ["None"], ["", "", "", "def", "getPixmap", "(", "self", ")", ":", "\n", "        ", "return", "QPixmap", ".", "fromImage", "(", "self", ".", "img", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save": [[140, 147], ["rendering.Renderer.app.processEvents", "rendering.Renderer.window.show", "PyQt5.QtGui.QPixmap", "rendering.Renderer.window.mainWidget.render", "PyQt5.QtGui.QPixmap.save", "rendering.Renderer.window.mainWidget.size"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.render", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "save", "(", "self", ",", "save_location", ")", ":", "\n", "        ", "self", ".", "app", ".", "processEvents", "(", ")", "\n", "self", ".", "window", ".", "show", "(", ")", "\n", "pix", "=", "QPixmap", "(", "self", ".", "window", ".", "mainWidget", ".", "size", "(", ")", ")", "\n", "self", ".", "window", ".", "mainWidget", ".", "render", "(", "pix", ")", "\n", "success", "=", "pix", ".", "save", "(", "save_location", ")", "\n", "return", "success", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.getArray": [[148, 159], ["rendering.Renderer.img.bits().asstring", "numpy.frombuffer", "output.reshape.reshape.reshape", "rendering.Renderer.img.bits"], "methods", ["None"], ["", "def", "getArray", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Get a numpy array of RGB pixel values.\n        The array will have shape (height, width, 3)\n        \"\"\"", "\n", "\n", "numBytes", "=", "self", ".", "width", "*", "self", ".", "height", "*", "3", "\n", "buf", "=", "self", ".", "img", ".", "bits", "(", ")", ".", "asstring", "(", "numBytes", ")", "\n", "output", "=", "np", ".", "frombuffer", "(", "buf", ",", "dtype", "=", "'uint8'", ")", "\n", "output", "=", "output", ".", "reshape", "(", "(", "self", ".", "height", ",", "self", ".", "width", ",", "3", ")", ")", "\n", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.getFullScreen": [[160, 168], ["PyQt5.QtGui.QPixmap", "rendering.Renderer.window.mainWidget.render", "PyQt5.QtGui.QPixmap.toImage", "PyQt5.QtGui.QPixmap.toImage.bits().asstring", "numpy.fromstring().reshape", "PyQt5.QtGui.QPixmap.save", "rendering.Renderer.window.mainWidget.size", "PyQt5.QtGui.QPixmap.toImage.bits", "numpy.fromstring", "PyQt5.QtGui.QPixmap.toImage.width", "PyQt5.QtGui.QPixmap.toImage.height", "PyQt5.QtGui.QPixmap.toImage.width", "PyQt5.QtGui.QPixmap.toImage.height"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.render", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save", "home.repos.pwc.inspect_result.modularcogsci2022_msa.Modularity.dataset_backup_alo.AdverbVocabulary.size"], ["", "def", "getFullScreen", "(", "self", ",", "temp", ")", ":", "\n", "        ", "pix", "=", "QPixmap", "(", "self", ".", "window", ".", "mainWidget", ".", "size", "(", ")", ")", "\n", "self", ".", "window", ".", "mainWidget", ".", "render", "(", "pix", ")", "\n", "image", "=", "pix", ".", "toImage", "(", ")", "\n", "s", "=", "image", ".", "bits", "(", ")", ".", "asstring", "(", "image", ".", "width", "(", ")", "*", "image", ".", "height", "(", ")", "*", "3", ")", "\n", "arr", "=", "np", ".", "fromstring", "(", "s", ",", "dtype", "=", "'uint8'", ")", ".", "reshape", "(", "(", "image", ".", "width", "(", ")", ",", "image", ".", "height", "(", ")", ",", "3", ")", ")", "\n", "pix", ".", "save", "(", "temp", ")", "\n", "return", "arr", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.push": [[169, 171], ["rendering.Renderer.painter.save"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.save"], ["", "def", "push", "(", "self", ")", ":", "\n", "        ", "self", ".", "painter", ".", "save", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop": [[172, 174], ["rendering.Renderer.painter.restore"], "methods", ["None"], ["", "def", "pop", "(", "self", ")", ":", "\n", "        ", "self", ".", "painter", ".", "restore", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.rotate": [[175, 177], ["rendering.Renderer.painter.rotate"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.rotate"], ["", "def", "rotate", "(", "self", ",", "degrees", ")", ":", "\n", "        ", "self", ".", "painter", ".", "rotate", "(", "degrees", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.translate": [[178, 180], ["rendering.Renderer.painter.translate"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.translate"], ["", "def", "translate", "(", "self", ",", "x", ",", "y", ")", ":", "\n", "        ", "self", ".", "painter", ".", "translate", "(", "x", ",", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.scale": [[181, 183], ["rendering.Renderer.painter.scale"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.scale"], ["", "def", "scale", "(", "self", ",", "x", ",", "y", ")", ":", "\n", "        ", "self", ".", "painter", ".", "scale", "(", "x", ",", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.setLineColor": [[184, 186], ["rendering.Renderer.painter.setPen", "PyQt5.QtGui.QColor"], "methods", ["None"], ["", "def", "setLineColor", "(", "self", ",", "r", ",", "g", ",", "b", ",", "a", "=", "255", ")", ":", "\n", "        ", "self", ".", "painter", ".", "setPen", "(", "QColor", "(", "r", ",", "g", ",", "b", ",", "a", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.setColor": [[187, 189], ["rendering.Renderer.painter.setBrush", "PyQt5.QtGui.QColor"], "methods", ["None"], ["", "def", "setColor", "(", "self", ",", "r", ",", "g", ",", "b", ",", "a", "=", "255", ")", ":", "\n", "        ", "self", ".", "painter", ".", "setBrush", "(", "QColor", "(", "r", ",", "g", ",", "b", ",", "a", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.setLineWidth": [[190, 194], ["rendering.Renderer.painter.pen", "rendering.Renderer.setWidthF", "rendering.Renderer.painter.setPen"], "methods", ["None"], ["", "def", "setLineWidth", "(", "self", ",", "width", ")", ":", "\n", "        ", "pen", "=", "self", ".", "painter", ".", "pen", "(", ")", "\n", "pen", ".", "setWidthF", "(", "width", ")", "\n", "self", ".", "painter", ".", "setPen", "(", "pen", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawLine": [[195, 197], ["rendering.Renderer.painter.drawLine"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawLine"], ["", "def", "drawLine", "(", "self", ",", "x0", ",", "y0", ",", "x1", ",", "y1", ")", ":", "\n", "        ", "self", ".", "painter", ".", "drawLine", "(", "x0", ",", "y0", ",", "x1", ",", "y1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawCircle": [[198, 201], ["PyQt5.QtCore.QPoint", "rendering.Renderer.painter.drawEllipse"], "methods", ["None"], ["", "def", "drawCircle", "(", "self", ",", "x", ",", "y", ",", "r", ")", ":", "\n", "        ", "center", "=", "QPoint", "(", "x", ",", "y", ")", "\n", "self", ".", "painter", ".", "drawEllipse", "(", "center", ",", "r", ",", "r", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawPolygon": [[202, 206], ["map", "rendering.Renderer.painter.drawPolygon", "PyQt5.QtGui.QPolygon", "PyQt5.QtCore.QPoint"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawPolygon"], ["", "def", "drawPolygon", "(", "self", ",", "points", ")", ":", "\n", "        ", "\"\"\"Takes a list of points (tuples) as input\"\"\"", "\n", "points", "=", "map", "(", "lambda", "p", ":", "QPoint", "(", "p", "[", "0", "]", ",", "p", "[", "1", "]", ")", ",", "points", ")", "\n", "self", ".", "painter", ".", "drawPolygon", "(", "QPolygon", "(", "points", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawPolyline": [[207, 211], ["map", "rendering.Renderer.painter.drawPolyline", "PyQt5.QtGui.QPolygon", "PyQt5.QtCore.QPoint"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawPolyline"], ["", "def", "drawPolyline", "(", "self", ",", "points", ")", ":", "\n", "        ", "\"\"\"Takes a list of points (tuples) as input\"\"\"", "\n", "points", "=", "map", "(", "lambda", "p", ":", "QPoint", "(", "p", "[", "0", "]", ",", "p", "[", "1", "]", ")", ",", "points", ")", "\n", "self", ".", "painter", ".", "drawPolyline", "(", "QPolygon", "(", "points", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.fillRect": [[212, 214], ["rendering.Renderer.painter.fillRect", "PyQt5.QtCore.QRect", "PyQt5.QtGui.QColor"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.fillRect"], ["", "def", "fillRect", "(", "self", ",", "x", ",", "y", ",", "width", ",", "height", ",", "r", ",", "g", ",", "b", ",", "a", "=", "255", ")", ":", "\n", "        ", "self", ".", "painter", ".", "fillRect", "(", "QRect", "(", "x", ",", "y", ",", "width", ",", "height", ")", ",", "QColor", "(", "r", ",", "g", ",", "b", ",", "a", ")", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.WorldObj.__init__": [[73, 101], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "type", ",", "color", ",", "size", "=", "1", ",", "vector_representation", "=", "None", ",", "object_representation", "=", "None", ",", "target", "=", "False", ",", "\n", "weight", "=", "\"light\"", ")", ":", "\n", "        ", "assert", "type", "in", "OBJECT_TO_IDX", ",", "type", "\n", "assert", "color", "in", "COLOR_TO_IDX", ",", "color", "\n", "assert", "1", "<=", "size", "<=", "4", ",", "\"Sizes outside of range [1,4] not supported.\"", "\n", "self", ".", "type", "=", "type", "\n", "self", ".", "color", "=", "color", "\n", "self", ".", "border_color", "=", "color", "\n", "self", ".", "contains", "=", "None", "\n", "self", ".", "size", "=", "size", "\n", "\n", "# Initial position of the object", "\n", "self", ".", "init_pos", "=", "None", "\n", "\n", "# Current position of the object", "\n", "self", ".", "cur_pos", "=", "None", "\n", "\n", "# Representations", "\n", "self", ".", "vector_representation", "=", "vector_representation", "\n", "self", ".", "object_representation", "=", "object_representation", "\n", "\n", "# Boolean whether an object is a target", "\n", "self", ".", "target", "=", "target", "\n", "\n", "# Determining whether a heavy object can be moved in the next step or not", "\n", "self", ".", "momentum", "=", "0", "\n", "self", ".", "weight", "=", "weight", "\n", "self", ".", "momentum_threshold", "=", "WEIGHT_TO_MOMENTUM", "[", "self", ".", "weight", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.WorldObj.can_overlap": [[102, 105], ["None"], "methods", ["None"], ["", "def", "can_overlap", "(", "self", ")", ":", "\n", "        ", "\"\"\"Can the agent overlap with this?\"\"\"", "\n", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.WorldObj.can_pickup": [[106, 109], ["None"], "methods", ["None"], ["", "def", "can_pickup", "(", "self", ")", ":", "\n", "        ", "\"\"\"Can the agent pick this up?\"\"\"", "\n", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.WorldObj.can_push": [[110, 113], ["None"], "methods", ["None"], ["", "def", "can_push", "(", "self", ")", ":", "\n", "        ", "\"\"\"Can the agent push this?\"\"\"", "\n", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.WorldObj.render": [[114, 117], ["None"], "methods", ["None"], ["", "def", "render", "(", "self", ",", "r", ")", ":", "\n", "        ", "\"\"\"Draw this object with the given renderer\"\"\"", "\n", "raise", "NotImplementedError", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.WorldObj._set_color": [[118, 124], ["r.setLineColor", "r.setColor"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.setLineColor", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.setColor"], ["", "def", "_set_color", "(", "self", ",", "r", ")", ":", "\n", "        ", "\"\"\"Set the color of this object as the active drawing color\"\"\"", "\n", "c", "=", "COLORS", "[", "self", ".", "color", "]", "\n", "border_color", "=", "COLORS", "[", "self", ".", "border_color", "]", "\n", "r", ".", "setLineColor", "(", "border_color", "[", "0", "]", ",", "border_color", "[", "1", "]", ",", "border_color", "[", "2", "]", ")", "\n", "r", ".", "setColor", "(", "c", "[", "0", "]", ",", "c", "[", "1", "]", ",", "c", "[", "2", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Square.__init__": [[127, 131], ["minigrid.WorldObj.__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "color", "=", "'grey'", ",", "size", "=", "1", ",", "vector_representation", "=", "None", ",", "object_representation", "=", "None", ",", "target", "=", "False", ",", "\n", "weight", "=", "\"light\"", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "'square'", ",", "color", ",", "size", ",", "vector_representation", "=", "vector_representation", ",", "\n", "object_representation", "=", "object_representation", ",", "target", "=", "target", ",", "weight", "=", "weight", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Square.render": [[132, 141], ["minigrid.Square._set_color", "r.drawPolygon"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.WorldObj._set_color", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawPolygon"], ["", "def", "render", "(", "self", ",", "r", ")", ":", "\n", "        ", "self", ".", "_set_color", "(", "r", ")", "\n", "\n", "# TODO: max_size is 4 here hardcoded", "\n", "r", ".", "drawPolygon", "(", "[", "\n", "(", "0", ",", "CELL_PIXELS", "*", "(", "self", ".", "size", "/", "4", ")", ")", ",", "\n", "(", "CELL_PIXELS", "*", "(", "self", ".", "size", "/", "4", ")", ",", "CELL_PIXELS", "*", "(", "self", ".", "size", "/", "4", ")", ")", ",", "\n", "(", "CELL_PIXELS", "*", "(", "self", ".", "size", "/", "4", ")", ",", "0", ")", ",", "\n", "(", "0", ",", "0", ")", "\n", "]", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Square.can_pickup": [[143, 145], ["None"], "methods", ["None"], ["", "def", "can_pickup", "(", "self", ")", ":", "\n", "        ", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Square.can_push": [[146, 148], ["None"], "methods", ["None"], ["", "def", "can_push", "(", "self", ")", ":", "\n", "        ", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Square.push": [[149, 156], ["None"], "methods", ["None"], ["", "def", "push", "(", "self", ")", ":", "\n", "        ", "self", ".", "momentum", "+=", "1", "\n", "if", "self", ".", "momentum", ">=", "self", ".", "momentum_threshold", ":", "\n", "            ", "self", ".", "momentum", "=", "0", "\n", "return", "True", "\n", "", "else", ":", "\n", "            ", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Cylinder.__init__": [[159, 162], ["minigrid.WorldObj.__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "color", "=", "'blue'", ",", "size", "=", "1", ",", "vector_representation", "=", "None", ",", "object_representation", "=", "None", ",", "weight", "=", "\"light\"", ")", ":", "\n", "        ", "super", "(", "Cylinder", ",", "self", ")", ".", "__init__", "(", "'cylinder'", ",", "color", ",", "size", ",", "vector_representation", ",", "\n", "object_representation", "=", "object_representation", ",", "weight", "=", "weight", ")", "\n", "# TODO: generalize sizes", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Cylinder.can_pickup": [[164, 166], ["None"], "methods", ["None"], ["", "def", "can_pickup", "(", "self", ")", ":", "\n", "        ", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Cylinder.render": [[167, 178], ["minigrid.Cylinder._set_color", "r.drawPolygon"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.WorldObj._set_color", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawPolygon"], ["", "def", "render", "(", "self", ",", "r", ")", ":", "\n", "        ", "self", ".", "_set_color", "(", "r", ")", "\n", "\n", "# Vertical quad", "\n", "parallelogram_width", "=", "(", "CELL_PIXELS", "/", "2", ")", "*", "(", "self", ".", "size", "/", "4", ")", "\n", "parallelogram_height", "=", "CELL_PIXELS", "*", "(", "self", ".", "size", "/", "4", ")", "\n", "r", ".", "drawPolygon", "(", "[", "\n", "(", "CELL_PIXELS", "/", "2", ",", "0", ")", ",", "\n", "(", "CELL_PIXELS", "/", "2", "+", "parallelogram_width", ",", "0", ")", ",", "\n", "(", "CELL_PIXELS", "/", "2", ",", "parallelogram_height", ")", ",", "\n", "(", "CELL_PIXELS", "/", "2", "-", "parallelogram_width", ",", "parallelogram_height", ")", "\n", "]", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Cylinder.can_push": [[180, 182], ["None"], "methods", ["None"], ["", "def", "can_push", "(", "self", ")", ":", "\n", "        ", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Cylinder.push": [[183, 190], ["None"], "methods", ["None"], ["", "def", "push", "(", "self", ")", ":", "\n", "        ", "self", ".", "momentum", "+=", "1", "\n", "if", "self", ".", "momentum", ">=", "self", ".", "momentum_threshold", ":", "\n", "            ", "self", ".", "momentum", "=", "0", "\n", "return", "True", "\n", "", "else", ":", "\n", "            ", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.__init__": [[193, 197], ["minigrid.WorldObj.__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["    ", "def", "__init__", "(", "self", ",", "color", "=", "'blue'", ",", "size", "=", "1", ",", "vector_representation", "=", "None", ",", "object_representation", "=", "None", ",", "target", "=", "False", ",", "\n", "weight", "=", "\"light\"", ")", ":", "\n", "        ", "super", "(", "Circle", ",", "self", ")", ".", "__init__", "(", "'circle'", ",", "color", ",", "size", ",", "vector_representation", ",", "\n", "object_representation", "=", "object_representation", ",", "target", "=", "target", ",", "weight", "=", "weight", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.can_pickup": [[198, 200], ["None"], "methods", ["None"], ["", "def", "can_pickup", "(", "self", ")", ":", "\n", "        ", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.can_push": [[201, 203], ["None"], "methods", ["None"], ["", "def", "can_push", "(", "self", ")", ":", "\n", "        ", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.render": [[204, 207], ["minigrid.Circle._set_color", "r.drawCircle"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.WorldObj._set_color", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawCircle"], ["", "def", "render", "(", "self", ",", "r", ")", ":", "\n", "        ", "self", ".", "_set_color", "(", "r", ")", "\n", "r", ".", "drawCircle", "(", "CELL_PIXELS", "*", "0.5", ",", "CELL_PIXELS", "*", "0.5", ",", "CELL_PIXELS", "//", "10", "*", "self", ".", "size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.push": [[208, 215], ["None"], "methods", ["None"], ["", "def", "push", "(", "self", ")", ":", "\n", "        ", "self", ".", "momentum", "+=", "1", "\n", "if", "self", ".", "momentum", ">=", "self", ".", "momentum_threshold", ":", "\n", "            ", "self", ".", "momentum", "=", "0", "\n", "return", "True", "\n", "", "else", ":", "\n", "            ", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.__init__": [[222, 230], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "width", ",", "height", ",", "depth", ")", ":", "\n", "        ", "assert", "width", ">=", "3", "\n", "assert", "height", ">=", "3", "\n", "\n", "self", ".", "width", "=", "width", "\n", "self", ".", "height", "=", "height", "\n", "self", ".", "_num_attributes_object", "=", "depth", "\n", "self", ".", "grid", "=", "[", "None", "]", "*", "width", "*", "height", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.__contains__": [[231, 245], ["isinstance", "isinstance"], "methods", ["None"], ["", "def", "__contains__", "(", "self", ",", "key", ")", ":", "\n", "        ", "if", "isinstance", "(", "key", ",", "WorldObj", ")", ":", "\n", "            ", "for", "e", "in", "self", ".", "grid", ":", "\n", "                ", "if", "e", "is", "key", ":", "\n", "                    ", "return", "True", "\n", "", "", "", "elif", "isinstance", "(", "key", ",", "tuple", ")", ":", "\n", "            ", "for", "e", "in", "self", ".", "grid", ":", "\n", "                ", "if", "e", "is", "None", ":", "\n", "                    ", "continue", "\n", "", "if", "(", "e", ".", "color", ",", "e", ".", "type", ")", "==", "key", ":", "\n", "                    ", "return", "True", "\n", "", "if", "key", "[", "0", "]", "is", "None", "and", "key", "[", "1", "]", "==", "e", ".", "type", ":", "\n", "                    ", "return", "True", "\n", "", "", "", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.__eq__": [[246, 250], ["minigrid.Grid.encode", "other.encode", "numpy.array_equal"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.encode", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.encode"], ["", "def", "__eq__", "(", "self", ",", "other", ")", ":", "\n", "        ", "grid1", "=", "self", ".", "encode", "(", ")", "\n", "grid2", "=", "other", ".", "encode", "(", ")", "\n", "return", "np", ".", "array_equal", "(", "grid2", ",", "grid1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.__ne__": [[251, 253], ["None"], "methods", ["None"], ["", "def", "__ne__", "(", "self", ",", "other", ")", ":", "\n", "        ", "return", "not", "self", "==", "other", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.copy": [[254, 257], ["deepcopy"], "methods", ["None"], ["", "def", "copy", "(", "self", ")", ":", "\n", "        ", "from", "copy", "import", "deepcopy", "\n", "return", "deepcopy", "(", "self", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set": [[258, 262], ["None"], "methods", ["None"], ["", "def", "set", "(", "self", ",", "i", ",", "j", ",", "v", ")", ":", "\n", "        ", "assert", "i", ">=", "0", "and", "i", "<", "self", ".", "width", "\n", "assert", "j", ">=", "0", "and", "j", "<", "self", ".", "height", "\n", "self", ".", "grid", "[", "j", "*", "self", ".", "width", "+", "i", "]", "=", "v", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get": [[263, 267], ["None"], "methods", ["None"], ["", "def", "get", "(", "self", ",", "i", ",", "j", ")", ":", "\n", "        ", "assert", "i", ">=", "0", "and", "i", "<", "self", ".", "width", "\n", "assert", "j", ">=", "0", "and", "j", "<", "self", ".", "height", "\n", "return", "self", ".", "grid", "[", "j", "*", "self", ".", "width", "+", "i", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.rotate_left": [[268, 281], ["minigrid.Grid", "range", "range", "minigrid.Grid.get", "minigrid.Grid.set"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set"], ["", "def", "rotate_left", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Rotate the grid to the left (counter-clockwise)\n        \"\"\"", "\n", "\n", "grid", "=", "Grid", "(", "self", ".", "height", ",", "self", ".", "width", ")", "\n", "\n", "for", "i", "in", "range", "(", "self", ".", "width", ")", ":", "\n", "            ", "for", "j", "in", "range", "(", "self", ".", "height", ")", ":", "\n", "                ", "v", "=", "self", ".", "get", "(", "i", ",", "j", ")", "\n", "grid", ".", "set", "(", "j", ",", "grid", ".", "height", "-", "1", "-", "i", ",", "v", ")", "\n", "\n", "", "", "return", "grid", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.slice": [[282, 303], ["minigrid.Grid", "range", "range", "minigrid.Grid.set", "minigrid.Grid.get", "minigrid.Square"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "def", "slice", "(", "self", ",", "topX", ",", "topY", ",", "width", ",", "height", ")", ":", "\n", "        ", "\"\"\"\n        Get a subset of the grid\n        \"\"\"", "\n", "\n", "grid", "=", "Grid", "(", "width", ",", "height", ")", "\n", "\n", "for", "j", "in", "range", "(", "0", ",", "height", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "0", ",", "width", ")", ":", "\n", "                ", "x", "=", "topX", "+", "i", "\n", "y", "=", "topY", "+", "j", "\n", "\n", "if", "x", ">=", "0", "and", "x", "<", "self", ".", "width", "and", "y", ">=", "0", "and", "y", "<", "self", ".", "height", ":", "\n", "                    ", "v", "=", "self", ".", "get", "(", "x", ",", "y", ")", "\n", "", "else", ":", "\n", "                    ", "v", "=", "Square", "(", ")", "\n", "\n", "", "grid", ".", "set", "(", "i", ",", "j", ",", "v", ")", "\n", "\n", "", "", "return", "grid", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.render": [[304, 379], ["r.push", "r.scale", "r.setLineColor", "range", "range", "range", "r.pop", "len", "r.fillRect", "range", "r.drawLine", "r.drawLine", "range", "len", "attention_weights.reshape.reshape.reshape", "range", "minigrid.Grid.get", "r.push", "r.translate", "minigrid.Grid.render", "r.pop", "len", "attention_weights.reshape.reshape.reshape", "int", "r.push", "r.fillRect", "r.pop", "int", "r.push", "r.fillRect", "len"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.push", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.scale", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.setLineColor", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.fillRect", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawLine", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawLine", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.push", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.translate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.render", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.push", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.fillRect", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.push", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.fillRect"], ["", "def", "render", "(", "self", ",", "r", ",", "tile_size", ",", "attention_weights", "=", "[", "]", ")", ":", "\n", "        ", "\"\"\"\n        Render this grid at a given scale\n        :param r: target renderer object\n        :param tile_size: tile size in pixels\n        \"\"\"", "\n", "\n", "assert", "r", ".", "width", "==", "self", ".", "width", "*", "tile_size", "\n", "assert", "r", ".", "height", "==", "self", ".", "height", "*", "tile_size", "\n", "\n", "# Total grid size at native scale", "\n", "widthPx", "=", "self", ".", "width", "*", "CELL_PIXELS", "\n", "heightPx", "=", "self", ".", "height", "*", "CELL_PIXELS", "\n", "\n", "r", ".", "push", "(", ")", "\n", "\n", "# Internally, we draw at the \"large\" full-grid resolution, but we", "\n", "# use the renderer to scale back to the desired size", "\n", "r", ".", "scale", "(", "tile_size", "/", "CELL_PIXELS", ",", "tile_size", "/", "CELL_PIXELS", ")", "\n", "\n", "if", "len", "(", "attention_weights", ")", ">", "0", ":", "\n", "            ", "if", "len", "(", "attention_weights", ")", "==", "self", ".", "width", "*", "self", ".", "height", ":", "\n", "                ", "pixel_attention", "=", "False", "\n", "attention_weights", "=", "attention_weights", ".", "reshape", "(", "self", ".", "width", ",", "self", ".", "height", ")", "\n", "", "elif", "len", "(", "attention_weights", ")", "==", "self", ".", "width", "*", "CELL_PIXELS", "*", "self", ".", "height", "*", "CELL_PIXELS", ":", "\n", "                ", "pixel_attention", "=", "True", "\n", "attention_weights", "=", "attention_weights", ".", "reshape", "(", "self", ".", "width", "*", "CELL_PIXELS", ",", "self", ".", "height", "*", "CELL_PIXELS", ")", "\n", "", "start_range", "=", "0", "\n", "end_range", "=", "150", "\n", "", "else", ":", "\n", "            ", "pixel_attention", "=", "False", "\n", "# Draw the background of the in-world cells black", "\n", "", "if", "not", "pixel_attention", ":", "\n", "            ", "r", ".", "fillRect", "(", "\n", "0", ",", "\n", "0", ",", "\n", "widthPx", ",", "\n", "heightPx", ",", "\n", "255", ",", "255", ",", "255", "\n", ")", "\n", "", "else", ":", "\n", "            ", "for", "j", "in", "range", "(", "0", ",", "heightPx", ")", ":", "\n", "                ", "for", "i", "in", "range", "(", "0", ",", "widthPx", ")", ":", "\n", "                    ", "current_weight", "=", "attention_weights", "[", "j", ",", "i", "]", "\n", "color", "=", "int", "(", "(", "end_range", "-", "start_range", ")", "*", "(", "1", "-", "current_weight", ")", ")", "\n", "r", ".", "push", "(", ")", "\n", "r", ".", "fillRect", "(", "i", ",", "j", ",", "1", ",", "1", ",", "r", "=", "color", ",", "g", "=", "color", ",", "b", "=", "color", ")", "\n", "r", ".", "pop", "(", ")", "\n", "\n", "# Draw grid lines", "\n", "", "", "", "r", ".", "setLineColor", "(", "100", ",", "100", ",", "100", ")", "\n", "for", "rowIdx", "in", "range", "(", "0", ",", "self", ".", "height", ")", ":", "\n", "            ", "y", "=", "CELL_PIXELS", "*", "rowIdx", "\n", "r", ".", "drawLine", "(", "0", ",", "y", ",", "widthPx", ",", "y", ")", "\n", "", "for", "colIdx", "in", "range", "(", "0", ",", "self", ".", "width", ")", ":", "\n", "            ", "x", "=", "CELL_PIXELS", "*", "colIdx", "\n", "r", ".", "drawLine", "(", "x", ",", "0", ",", "x", ",", "heightPx", ")", "\n", "\n", "# Render the grid", "\n", "", "for", "j", "in", "range", "(", "0", ",", "self", ".", "height", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "0", ",", "self", ".", "width", ")", ":", "\n", "                ", "cell", "=", "self", ".", "get", "(", "i", ",", "j", ")", "\n", "if", "len", "(", "attention_weights", ")", ">", "0", "and", "not", "pixel_attention", ":", "\n", "                    ", "current_weight", "=", "attention_weights", "[", "j", ",", "i", "]", "\n", "color", "=", "int", "(", "(", "end_range", "-", "start_range", ")", "*", "(", "1", "-", "current_weight", ")", ")", "\n", "r", ".", "push", "(", ")", "\n", "r", ".", "fillRect", "(", "i", "*", "CELL_PIXELS", ",", "j", "*", "CELL_PIXELS", ",", "CELL_PIXELS", ",", "CELL_PIXELS", ",", "r", "=", "color", ",", "g", "=", "color", ",", "b", "=", "color", ")", "\n", "", "if", "cell", "==", "None", ":", "\n", "                    ", "continue", "\n", "", "r", ".", "push", "(", ")", "\n", "r", ".", "translate", "(", "i", "*", "CELL_PIXELS", ",", "j", "*", "CELL_PIXELS", ")", "\n", "cell", ".", "render", "(", "r", ")", "\n", "r", ".", "pop", "(", ")", "\n", "\n", "", "", "r", ".", "pop", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.encode": [[380, 400], ["numpy.zeros", "range", "range", "minigrid.Grid.get", "numpy.zeros", "numpy.zeros"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "def", "encode", "(", "self", ",", "agent_row", ":", "int", ",", "agent_column", ":", "int", ",", "agent_direction", ":", "int", ")", ":", "\n", "        ", "\"\"\"\n        Produce a compact numpy encoding of the grid.\n        \"\"\"", "\n", "array", "=", "np", ".", "zeros", "(", "(", "self", ".", "width", ",", "self", ".", "height", ",", "self", ".", "_num_attributes_object", "+", "1", "+", "4", ")", ",", "dtype", "=", "'uint8'", ")", "\n", "for", "col", "in", "range", "(", "self", ".", "width", ")", ":", "\n", "            ", "for", "row", "in", "range", "(", "self", ".", "height", ")", ":", "\n", "                ", "grid_cell", "=", "self", ".", "get", "(", "col", ",", "row", ")", "\n", "empty_representation", "=", "np", ".", "zeros", "(", "self", ".", "_num_attributes_object", "+", "1", "+", "4", ")", "\n", "if", "grid_cell", ":", "\n", "                    ", "empty_representation", "[", ":", "-", "5", "]", "=", "grid_cell", ".", "vector_representation", "\n", "\n", "# Set agent feature to 1 for the grid cell with the agent and add it's direction in one-hot form.", "\n", "", "if", "col", "==", "agent_column", "and", "row", "==", "agent_row", ":", "\n", "                    ", "empty_representation", "[", "-", "5", "]", "=", "1", "\n", "one_hot_direction", "=", "np", ".", "zeros", "(", "4", ")", "\n", "one_hot_direction", "[", "agent_direction", "]", "=", "1", "\n", "empty_representation", "[", "-", "4", ":", "]", "=", "one_hot_direction", "\n", "", "array", "[", "row", ",", "col", ",", ":", "]", "=", "empty_representation", "\n", "", "", "return", "array", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.__init__": [[427, 463], ["gym.spaces.Discrete", "minigrid.MiniGridEnv.seed", "minigrid.MiniGridEnv.reset", "len"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.seed", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.reset"], ["", "def", "__init__", "(", "self", ",", "grid_size", "=", "None", ",", "width", "=", "None", ",", "height", "=", "None", ",", "max_steps", "=", "100", ",", "seed", "=", "1337", ")", ":", "\n", "# Can't set both grid_size and width/height", "\n", "        ", "if", "grid_size", ":", "\n", "            ", "assert", "width", "==", "None", "and", "height", "==", "None", "\n", "width", "=", "grid_size", "\n", "height", "=", "grid_size", "\n", "\n", "# Action enumeration for this environment", "\n", "", "self", ".", "actions", "=", "MiniGridEnv", ".", "Actions", "\n", "\n", "# Actions are discrete integer values", "\n", "self", ".", "action_space", "=", "spaces", ".", "Discrete", "(", "len", "(", "self", ".", "actions", ")", ")", "\n", "\n", "# Range of possible rewards", "\n", "self", ".", "reward_range", "=", "(", "0", ",", "1", ")", "\n", "\n", "# Renderer object used to render the whole grid (full-scale)", "\n", "self", ".", "grid_render", "=", "None", "\n", "\n", "# Renderer used to render observations (small-scale agent view)", "\n", "self", ".", "obs_render", "=", "None", "\n", "\n", "# Environment configuration", "\n", "self", ".", "width", "=", "width", "\n", "self", ".", "height", "=", "height", "\n", "self", ".", "max_steps", "=", "max_steps", "\n", "\n", "# Current position and direction of the agent", "\n", "self", ".", "agent_pos", "=", "None", "\n", "self", ".", "agent_dir", "=", "None", "\n", "\n", "# Initialize the RNG", "\n", "self", ".", "seed", "(", "seed", "=", "seed", ")", "\n", "\n", "# Initialize the state", "\n", "self", ".", "reset", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.reset": [[464, 489], ["minigrid.MiniGridEnv._gen_grid", "minigrid.MiniGridEnv.grid.get", "minigrid.MiniGridEnv.can_overlap"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid._gen_grid", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.WorldObj.can_overlap"], ["", "def", "reset", "(", "self", ")", ":", "\n", "# Current position and direction of the agent", "\n", "        ", "self", ".", "agent_pos", "=", "None", "\n", "self", ".", "agent_dir", "=", "None", "\n", "\n", "# Generate a new random grid at the start of each episode", "\n", "# To keep the same grid for each episode, call env.seed() with", "\n", "# the same seed before calling env.reset()", "\n", "self", ".", "_gen_grid", "(", "self", ".", "width", ",", "self", ".", "height", ")", "\n", "\n", "# These fields should be defined by _gen_grid", "\n", "assert", "self", ".", "agent_pos", "is", "not", "None", "\n", "assert", "self", ".", "agent_dir", "is", "not", "None", "\n", "\n", "# Check that the agent doesn't overlap with an object", "\n", "start_cell", "=", "self", ".", "grid", ".", "get", "(", "*", "self", ".", "agent_pos", ")", "\n", "assert", "start_cell", "is", "None", "or", "start_cell", ".", "can_overlap", "(", ")", "\n", "\n", "# Item picked up, being carried, initially nothing", "\n", "self", ".", "carrying", "=", "None", "\n", "\n", "# Step count since episode start", "\n", "self", ".", "step_count", "=", "0", "\n", "\n", "return", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.seed": [[490, 494], ["gym.utils.seeding.np_random"], "methods", ["None"], ["", "def", "seed", "(", "self", ",", "seed", "=", "1337", ")", ":", "\n", "# Seed the random number generator", "\n", "        ", "self", ".", "np_random", ",", "_", "=", "seeding", ".", "np_random", "(", "seed", ")", "\n", "return", "[", "seed", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.steps_remaining": [[495, 498], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "steps_remaining", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "max_steps", "-", "self", ".", "step_count", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.__str__": [[499, 535], ["range", "range", "minigrid.MiniGridEnv.grid.get", "minigrid.MiniGridEnv.color[].upper"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "def", "__str__", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Produce a pretty string of the environment's grid along with the agent.\n        A grid cell is represented by 2-character string, the first one for\n        the object and the second one for the color.\n        \"\"\"", "\n", "\n", "# Map of object types to short string", "\n", "OBJECT_TO_STR", "=", "{", "\n", "'circle'", ":", "'A'", ",", "\n", "'square'", ":", "'B'", ",", "\n", "'cylinder'", ":", "'C'", ",", "\n", "}", "\n", "\n", "# Map agent's direction to short string", "\n", "AGENT_DIR_TO_STR", "=", "{", "\n", "0", ":", "'>'", ",", "\n", "1", ":", "'V'", ",", "\n", "2", ":", "'<'", ",", "\n", "3", ":", "'^'", "\n", "}", "\n", "\n", "str", "=", "''", "\n", "for", "j", "in", "range", "(", "self", ".", "grid", ".", "height", ")", ":", "\n", "            ", "for", "i", "in", "range", "(", "self", ".", "grid", ".", "width", ")", ":", "\n", "                ", "if", "i", "==", "self", ".", "agent_pos", "[", "0", "]", "and", "j", "==", "self", ".", "agent_pos", "[", "1", "]", ":", "\n", "                    ", "str", "+=", "2", "*", "AGENT_DIR_TO_STR", "[", "self", ".", "agent_dir", "]", "\n", "continue", "\n", "", "c", "=", "self", ".", "grid", ".", "get", "(", "i", ",", "j", ")", "\n", "if", "not", "c", ":", "\n", "                    ", "str", "+=", "'  '", "\n", "continue", "\n", "", "str", "+=", "OBJECT_TO_STR", "[", "c", ".", "type", "]", "+", "c", ".", "color", "[", "0", "]", ".", "upper", "(", ")", "\n", "", "if", "j", "<", "self", ".", "grid", ".", "height", "-", "1", ":", "\n", "                ", "str", "+=", "'\\n'", "\n", "", "", "return", "str", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._gen_grid": [[536, 538], ["None"], "methods", ["None"], ["", "def", "_gen_grid", "(", "self", ",", "width", ",", "height", ")", ":", "\n", "        ", "assert", "False", ",", "\"_gen_grid needs to be implemented by each environment\"", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int": [[539, 545], ["minigrid.MiniGridEnv.np_random.randint"], "methods", ["None"], ["", "def", "_rand_int", "(", "self", ",", "low", ",", "high", ")", ":", "\n", "        ", "\"\"\"\n        Generate random integer in [low,high[\n        \"\"\"", "\n", "\n", "return", "self", ".", "np_random", ".", "randint", "(", "low", ",", "high", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.place_obj": [[546, 597], ["minigrid.MiniGridEnv.grid.set", "numpy.array", "max", "max", "RecursionError", "minigrid.MiniGridEnv.grid.get", "reject_fn", "minigrid.MiniGridEnv._rand_int", "minigrid.MiniGridEnv._rand_int", "min", "min"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.max", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.min", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.min"], ["", "def", "place_obj", "(", "self", ",", "obj", ",", "top", "=", "None", ",", "size", "=", "None", ",", "reject_fn", "=", "None", ",", "max_tries", "=", "math", ".", "inf", ")", ":", "\n", "        ", "\"\"\"\n        Place an object at an empty position in the grid\n\n        :param obj:\n        :param top: top-left position of the rectangle where to place\n        :param size: size of the rectangle where to place\n        :param reject_fn: function to filter out potential positions\n        :param max_tries:\n        \"\"\"", "\n", "\n", "if", "top", "is", "None", ":", "\n", "            ", "top", "=", "(", "0", ",", "0", ")", "\n", "", "else", ":", "\n", "            ", "top", "=", "(", "max", "(", "top", "[", "0", "]", ",", "0", ")", ",", "max", "(", "top", "[", "1", "]", ",", "0", ")", ")", "\n", "\n", "", "if", "size", "is", "None", ":", "\n", "            ", "size", "=", "(", "self", ".", "grid", ".", "width", ",", "self", ".", "grid", ".", "height", ")", "\n", "\n", "", "num_tries", "=", "0", "\n", "\n", "while", "True", ":", "\n", "# This is to handle with rare cases where rejection sampling", "\n", "# gets stuck in an infinite loop", "\n", "            ", "if", "num_tries", ">", "max_tries", ":", "\n", "                ", "raise", "RecursionError", "(", "'rejection sampling failed in place_obj'", ")", "\n", "\n", "", "num_tries", "+=", "1", "\n", "\n", "pos", "=", "np", ".", "array", "(", "(", "\n", "self", ".", "_rand_int", "(", "top", "[", "0", "]", ",", "min", "(", "top", "[", "0", "]", "+", "size", "[", "0", "]", ",", "self", ".", "grid", ".", "width", ")", ")", ",", "\n", "self", ".", "_rand_int", "(", "top", "[", "1", "]", ",", "min", "(", "top", "[", "1", "]", "+", "size", "[", "1", "]", ",", "self", ".", "grid", ".", "height", ")", ")", "\n", ")", ")", "\n", "\n", "# Don't place the object on top of another object", "\n", "if", "self", ".", "grid", ".", "get", "(", "*", "pos", ")", "!=", "None", ":", "\n", "                ", "continue", "\n", "\n", "# Check if there is a filtering criterion", "\n", "", "if", "reject_fn", "and", "reject_fn", "(", "self", ",", "pos", ")", ":", "\n", "                ", "continue", "\n", "\n", "", "break", "\n", "\n", "", "self", ".", "grid", ".", "set", "(", "*", "pos", ",", "obj", ")", "\n", "\n", "if", "obj", "is", "not", "None", ":", "\n", "            ", "obj", ".", "init_pos", "=", "pos", "\n", "obj", ".", "cur_pos", "=", "pos", "\n", "\n", "", "return", "pos", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.place_agent": [[598, 617], ["minigrid.MiniGridEnv.place_obj", "minigrid.MiniGridEnv._rand_int"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.place_obj", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int"], ["", "def", "place_agent", "(", "\n", "self", ",", "\n", "top", "=", "None", ",", "\n", "size", "=", "None", ",", "\n", "rand_dir", "=", "True", ",", "\n", "max_tries", "=", "math", ".", "inf", "\n", ")", ":", "\n", "        ", "\"\"\"\n        Set the agent's starting point at an empty position in the grid\n        \"\"\"", "\n", "\n", "self", ".", "agent_pos", "=", "None", "\n", "pos", "=", "self", ".", "place_obj", "(", "None", ",", "top", ",", "size", ",", "max_tries", "=", "max_tries", ")", "\n", "self", ".", "agent_pos", "=", "pos", "\n", "\n", "if", "rand_dir", ":", "\n", "            ", "self", ".", "agent_dir", "=", "self", ".", "_rand_int", "(", "0", ",", "4", ")", "\n", "\n", "", "return", "pos", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.dir_vec": [[618, 627], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "dir_vec", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Get the direction vector for the agent, pointing in the direction\n        of forward movement.\n        \"\"\"", "\n", "\n", "assert", "self", ".", "agent_dir", ">=", "0", "and", "self", ".", "agent_dir", "<", "4", "\n", "return", "DIR_TO_VEC", "[", "self", ".", "agent_dir", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.right_vec": [[628, 636], ["numpy.array"], "methods", ["None"], ["", "@", "property", "\n", "def", "right_vec", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Get the vector pointing to the right of the agent.\n        \"\"\"", "\n", "\n", "dx", ",", "dy", "=", "self", ".", "dir_vec", "\n", "return", "np", ".", "array", "(", "(", "-", "dy", ",", "dx", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.front_pos": [[637, 644], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "front_pos", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Get the position of the cell that is right in front of the agent\n        \"\"\"", "\n", "\n", "return", "self", ".", "agent_pos", "+", "self", ".", "dir_vec", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.step": [[645, 704], ["minigrid.MiniGridEnv.grid.get", "minigrid.MiniGridEnv.grid.get", "minigrid.MiniGridEnv.can_overlap", "minigrid.MiniGridEnv._reward", "minigrid.MiniGridEnv.can_pickup", "numpy.array", "minigrid.MiniGridEnv.grid.set", "minigrid.MiniGridEnv.grid.set"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.WorldObj.can_overlap", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.can_pickup", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "        ", "self", ".", "step_count", "+=", "1", "\n", "\n", "reward", "=", "0", "\n", "done", "=", "False", "\n", "\n", "current_cell", "=", "self", ".", "grid", ".", "get", "(", "*", "self", ".", "agent_pos", ")", "\n", "\n", "# Rotate left", "\n", "if", "action", "==", "self", ".", "actions", ".", "left", ":", "\n", "            ", "self", ".", "agent_dir", "-=", "1", "\n", "if", "self", ".", "agent_dir", "<", "0", ":", "\n", "                ", "self", ".", "agent_dir", "+=", "4", "\n", "\n", "# Rotate right", "\n", "", "", "elif", "action", "==", "self", ".", "actions", ".", "right", ":", "\n", "            ", "self", ".", "agent_dir", "=", "(", "self", ".", "agent_dir", "+", "1", ")", "%", "4", "\n", "\n", "# Move forward", "\n", "", "elif", "action", "==", "self", ".", "actions", ".", "forward", ":", "\n", "# Get the position in front of the agent", "\n", "            ", "fwd_pos", "=", "self", ".", "front_pos", "\n", "\n", "# Get the contents of the cell in front of the agent", "\n", "fwd_cell", "=", "self", ".", "grid", ".", "get", "(", "*", "fwd_pos", ")", "\n", "if", "fwd_cell", "==", "None", "or", "fwd_cell", ".", "can_overlap", "(", ")", ":", "\n", "                ", "self", ".", "agent_pos", "=", "fwd_pos", "\n", "", "if", "fwd_cell", "!=", "None", "and", "fwd_cell", ".", "type", "==", "'goal'", ":", "\n", "                ", "done", "=", "True", "\n", "reward", "=", "self", ".", "_reward", "(", ")", "\n", "", "if", "fwd_cell", "!=", "None", "and", "fwd_cell", ".", "type", "==", "'lava'", ":", "\n", "                ", "done", "=", "True", "\n", "\n", "# Pick up an object", "\n", "", "", "elif", "action", "==", "self", ".", "actions", ".", "pickup", ":", "\n", "            ", "if", "current_cell", ".", "can_pickup", "(", ")", ":", "\n", "                ", "if", "self", ".", "carrying", "is", "None", ":", "\n", "                    ", "self", ".", "carrying", "=", "current_cell", "\n", "self", ".", "carrying", ".", "cur_pos", "=", "np", ".", "array", "(", "[", "-", "1", ",", "-", "1", "]", ")", "\n", "self", ".", "grid", ".", "set", "(", "*", "self", ".", "agent_pos", ",", "None", ")", "\n", "\n", "# Drop an object", "\n", "", "", "", "elif", "action", "==", "self", ".", "actions", ".", "drop", ":", "\n", "            ", "if", "not", "current_cell", "and", "self", ".", "carrying", ":", "\n", "                ", "self", ".", "grid", ".", "set", "(", "*", "self", ".", "agent_pos", ",", "self", ".", "carrying", ")", "\n", "self", ".", "carrying", ".", "cur_pos", "=", "self", ".", "agent_pos", "\n", "self", ".", "carrying", "=", "None", "\n", "\n", "# Done action (not used by default)", "\n", "", "", "elif", "action", "==", "self", ".", "actions", ".", "done", ":", "\n", "            ", "pass", "\n", "\n", "", "else", ":", "\n", "            ", "assert", "False", ",", "\"unknown action\"", "\n", "\n", "", "if", "self", ".", "step_count", ">=", "self", ".", "max_steps", ":", "\n", "            ", "done", "=", "True", "\n", "\n", "", "return", "reward", ",", "done", ",", "{", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.render": [[705, 761], ["r.beginFrame", "minigrid.MiniGridEnv.grid.render", "r.push", "r.scale", "r.translate", "r.rotate", "r.setLineColor", "r.setColor", "r.drawPolygon", "r.pop", "r.endFrame", "Renderer", "r.window.setText", "len", "r.getArray", "minigrid.MiniGridEnv.grid_render.close", "r.getPixmap"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.beginFrame", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.render", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Circle.push", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.scale", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.translate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.rotate", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.setLineColor", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.setColor", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.drawPolygon", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.pop", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.endFrame", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Window.setText", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.getArray", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.close", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.rendering.Renderer.getPixmap"], ["", "def", "render", "(", "self", ",", "mode", "=", "''", ",", "close", "=", "False", ",", "highlight", "=", "True", ",", "tile_size", "=", "CELL_PIXELS", ",", "attention_weights", "=", "[", "]", ")", ":", "\n", "        ", "\"\"\"\n        Render the whole-grid human view\n        \"\"\"", "\n", "\n", "if", "close", ":", "\n", "            ", "if", "self", ".", "grid_render", ":", "\n", "                ", "self", ".", "grid_render", ".", "close", "(", ")", "\n", "", "return", "\n", "\n", "", "if", "self", ".", "grid_render", "is", "None", "or", "self", ".", "grid_render", ".", "window", "is", "None", "or", "(", "self", ".", "grid_render", ".", "width", "!=", "self", ".", "width", "*", "tile_size", ")", ":", "\n", "            ", "from", "GroundedScan", ".", "gym_minigrid", ".", "rendering", "import", "Renderer", "\n", "self", ".", "grid_render", "=", "Renderer", "(", "\n", "self", ".", "width", "*", "tile_size", ",", "\n", "self", ".", "height", "*", "tile_size", ",", "\n", "True", "if", "mode", "==", "'human'", "else", "False", "\n", ")", "\n", "\n", "", "r", "=", "self", ".", "grid_render", "\n", "\n", "if", "r", ".", "window", ":", "\n", "            ", "r", ".", "window", ".", "setText", "(", "self", ".", "mission", ")", "\n", "\n", "", "r", ".", "beginFrame", "(", ")", "\n", "\n", "# Render the whole grid", "\n", "if", "len", "(", "attention_weights", ")", ">", "0", ":", "\n", "            ", "flat_attention_weights", "=", "attention_weights", "[", "0", "]", "\n", "", "else", ":", "\n", "            ", "flat_attention_weights", "=", "attention_weights", "\n", "", "self", ".", "grid", ".", "render", "(", "r", ",", "tile_size", ",", "attention_weights", "=", "flat_attention_weights", ")", "\n", "\n", "# Draw the agent", "\n", "ratio", "=", "tile_size", "/", "CELL_PIXELS", "\n", "r", ".", "push", "(", ")", "\n", "r", ".", "scale", "(", "ratio", ",", "ratio", ")", "\n", "r", ".", "translate", "(", "\n", "CELL_PIXELS", "*", "(", "self", ".", "agent_pos", "[", "0", "]", "+", "0.5", ")", ",", "\n", "CELL_PIXELS", "*", "(", "self", ".", "agent_pos", "[", "1", "]", "+", "0.5", ")", "\n", ")", "\n", "r", ".", "rotate", "(", "self", ".", "agent_dir", "*", "90", ")", "\n", "r", ".", "setLineColor", "(", "255", ",", "192", ",", "203", ")", "\n", "r", ".", "setColor", "(", "255", ",", "192", ",", "203", ")", "\n", "r", ".", "drawPolygon", "(", "[", "\n", "(", "-", "12", ",", "10", ")", ",", "\n", "(", "12", ",", "0", ")", ",", "\n", "(", "-", "12", ",", "-", "10", ")", "\n", "]", ")", "\n", "r", ".", "pop", "(", ")", "\n", "r", ".", "endFrame", "(", ")", "\n", "\n", "if", "mode", "==", "'rgb_array'", ":", "\n", "            ", "return", "r", ".", "getArray", "(", ")", "\n", "", "elif", "mode", "==", "'pixmap'", ":", "\n", "            ", "return", "r", ".", "getPixmap", "(", ")", "\n", "", "return", "r", "\n", "", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.Room.__init__": [[15, 38], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "\n", "self", ",", "\n", "top", ",", "\n", "size", "\n", ")", ":", "\n", "# Top-left corner and size (tuples)", "\n", "        ", "self", ".", "top", "=", "top", "\n", "self", ".", "size", "=", "size", "\n", "\n", "# List of door objects and door positions", "\n", "# Order of the doors is right, down, left, up", "\n", "self", ".", "doors", "=", "[", "None", "]", "*", "4", "\n", "self", ".", "door_pos", "=", "[", "None", "]", "*", "4", "\n", "\n", "# List of rooms adjacent to this one", "\n", "# Order of the neighbors is right, down, left, up", "\n", "self", ".", "neighbors", "=", "[", "None", "]", "*", "4", "\n", "\n", "# Indicates if this room is behind a locked door", "\n", "self", ".", "locked", "=", "False", "\n", "\n", "# List of objects contained", "\n", "self", ".", "objs", "=", "[", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.Room.rand_pos": [[39, 45], ["env._randPos"], "methods", ["None"], ["", "def", "rand_pos", "(", "self", ",", "env", ")", ":", "\n", "        ", "topX", ",", "topY", "=", "self", ".", "top", "\n", "sizeX", ",", "sizeY", "=", "self", ".", "size", "\n", "return", "env", ".", "_randPos", "(", "\n", "topX", "+", "1", ",", "topX", "+", "sizeX", "-", "1", ",", "\n", "topY", "+", "1", ",", "topY", "+", "sizeY", "-", "1", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.Room.pos_inside": [[47, 62], ["None"], "methods", ["None"], ["", "def", "pos_inside", "(", "self", ",", "x", ",", "y", ")", ":", "\n", "        ", "\"\"\"\n        Check if a position is within the bounds of this room\n        \"\"\"", "\n", "\n", "topX", ",", "topY", "=", "self", ".", "top", "\n", "sizeX", ",", "sizeY", "=", "self", ".", "size", "\n", "\n", "if", "x", "<", "topX", "or", "y", "<", "topY", ":", "\n", "            ", "return", "False", "\n", "\n", "", "if", "x", ">=", "topX", "+", "sizeX", "or", "y", ">=", "topY", "+", "sizeY", ":", "\n", "            ", "return", "False", "\n", "\n", "", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__": [[69, 97], ["minigrid.MiniGridEnv.__init__"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.__init__"], ["def", "__init__", "(", "\n", "self", ",", "\n", "room_size", "=", "7", ",", "\n", "num_rows", "=", "3", ",", "\n", "num_cols", "=", "3", ",", "\n", "max_steps", "=", "100", ",", "\n", "seed", "=", "0", "\n", ")", ":", "\n", "        ", "assert", "room_size", ">", "0", "\n", "assert", "room_size", ">=", "3", "\n", "assert", "num_rows", ">", "0", "\n", "assert", "num_cols", ">", "0", "\n", "self", ".", "room_size", "=", "room_size", "\n", "self", ".", "num_rows", "=", "num_rows", "\n", "self", ".", "num_cols", "=", "num_cols", "\n", "\n", "height", "=", "(", "room_size", "-", "1", ")", "*", "num_rows", "+", "1", "\n", "width", "=", "(", "room_size", "-", "1", ")", "*", "num_cols", "+", "1", "\n", "\n", "# By default, this environment has no mission", "\n", "self", ".", "mission", "=", "''", "\n", "\n", "super", "(", ")", ".", "__init__", "(", "\n", "width", "=", "width", ",", "\n", "height", "=", "height", ",", "\n", "max_steps", "=", "max_steps", ",", "\n", "see_through_walls", "=", "False", ",", "\n", "seed", "=", "seed", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.room_from_pos": [[99, 112], ["None"], "methods", ["None"], ["", "def", "room_from_pos", "(", "self", ",", "x", ",", "y", ")", ":", "\n", "        ", "\"\"\"Get the room a given position maps to\"\"\"", "\n", "\n", "assert", "x", ">=", "0", "\n", "assert", "y", ">=", "0", "\n", "\n", "i", "=", "x", "//", "(", "self", ".", "room_size", "-", "1", ")", "\n", "j", "=", "y", "//", "(", "self", ".", "room_size", "-", "1", ")", "\n", "\n", "assert", "i", "<", "self", ".", "num_cols", "\n", "assert", "j", "<", "self", ".", "num_rows", "\n", "\n", "return", "self", ".", "room_grid", "[", "j", "]", "[", "i", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.get_room": [[113, 117], ["None"], "methods", ["None"], ["", "def", "get_room", "(", "self", ",", "i", ",", "j", ")", ":", "\n", "        ", "assert", "i", "<", "self", ".", "num_cols", "\n", "assert", "j", "<", "self", ".", "num_rows", "\n", "return", "self", ".", "room_grid", "[", "j", "]", "[", "i", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid._gen_grid": [[118, 170], ["minigrid.Grid", "range", "range", "range", "roomgrid.RoomGrid.room_grid.append", "range", "roomgrid.Room", "row.append", "roomgrid.RoomGrid.grid.wall_rect", "roomgrid.RoomGrid._rand_int", "roomgrid.RoomGrid._rand_int"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int"], ["", "def", "_gen_grid", "(", "self", ",", "width", ",", "height", ")", ":", "\n", "# Create the grid", "\n", "        ", "self", ".", "grid", "=", "Grid", "(", "width", ",", "height", ")", "\n", "\n", "self", ".", "room_grid", "=", "[", "]", "\n", "\n", "# For each row of rooms", "\n", "for", "j", "in", "range", "(", "0", ",", "self", ".", "num_rows", ")", ":", "\n", "            ", "row", "=", "[", "]", "\n", "\n", "# For each column of rooms", "\n", "for", "i", "in", "range", "(", "0", ",", "self", ".", "num_cols", ")", ":", "\n", "                ", "room", "=", "Room", "(", "\n", "(", "i", "*", "(", "self", ".", "room_size", "-", "1", ")", ",", "j", "*", "(", "self", ".", "room_size", "-", "1", ")", ")", ",", "\n", "(", "self", ".", "room_size", ",", "self", ".", "room_size", ")", "\n", ")", "\n", "row", ".", "append", "(", "room", ")", "\n", "\n", "# Generate the walls for this room", "\n", "self", ".", "grid", ".", "wall_rect", "(", "*", "room", ".", "top", ",", "*", "room", ".", "size", ")", "\n", "\n", "", "self", ".", "room_grid", ".", "append", "(", "row", ")", "\n", "\n", "# For each row of rooms", "\n", "", "for", "j", "in", "range", "(", "0", ",", "self", ".", "num_rows", ")", ":", "\n", "# For each column of rooms", "\n", "            ", "for", "i", "in", "range", "(", "0", ",", "self", ".", "num_cols", ")", ":", "\n", "                ", "room", "=", "self", ".", "room_grid", "[", "j", "]", "[", "i", "]", "\n", "\n", "x_l", ",", "y_l", "=", "(", "room", ".", "top", "[", "0", "]", "+", "1", ",", "room", ".", "top", "[", "1", "]", "+", "1", ")", "\n", "x_m", ",", "y_m", "=", "(", "room", ".", "top", "[", "0", "]", "+", "room", ".", "size", "[", "0", "]", "-", "1", ",", "room", ".", "top", "[", "1", "]", "+", "room", ".", "size", "[", "1", "]", "-", "1", ")", "\n", "\n", "# Door positions, order is right, down, left, up", "\n", "if", "i", "<", "self", ".", "num_cols", "-", "1", ":", "\n", "                    ", "room", ".", "neighbors", "[", "0", "]", "=", "self", ".", "room_grid", "[", "j", "]", "[", "i", "+", "1", "]", "\n", "room", ".", "door_pos", "[", "0", "]", "=", "(", "x_m", ",", "self", ".", "_rand_int", "(", "y_l", ",", "y_m", ")", ")", "\n", "", "if", "j", "<", "self", ".", "num_rows", "-", "1", ":", "\n", "                    ", "room", ".", "neighbors", "[", "1", "]", "=", "self", ".", "room_grid", "[", "j", "+", "1", "]", "[", "i", "]", "\n", "room", ".", "door_pos", "[", "1", "]", "=", "(", "self", ".", "_rand_int", "(", "x_l", ",", "x_m", ")", ",", "y_m", ")", "\n", "", "if", "i", ">", "0", ":", "\n", "                    ", "room", ".", "neighbors", "[", "2", "]", "=", "self", ".", "room_grid", "[", "j", "]", "[", "i", "-", "1", "]", "\n", "room", ".", "door_pos", "[", "2", "]", "=", "room", ".", "neighbors", "[", "2", "]", ".", "door_pos", "[", "0", "]", "\n", "", "if", "j", ">", "0", ":", "\n", "                    ", "room", ".", "neighbors", "[", "3", "]", "=", "self", ".", "room_grid", "[", "j", "-", "1", "]", "[", "i", "]", "\n", "room", ".", "door_pos", "[", "3", "]", "=", "room", ".", "neighbors", "[", "3", "]", ".", "door_pos", "[", "1", "]", "\n", "\n", "# The agent starts in the middle, facing right", "\n", "", "", "", "self", ".", "agent_pos", "=", "(", "\n", "(", "self", ".", "num_cols", "//", "2", ")", "*", "(", "self", ".", "room_size", "-", "1", ")", "+", "(", "self", ".", "room_size", "//", "2", ")", ",", "\n", "(", "self", ".", "num_rows", "//", "2", ")", "*", "(", "self", ".", "room_size", "-", "1", ")", "+", "(", "self", ".", "room_size", "//", "2", ")", "\n", ")", "\n", "self", ".", "agent_dir", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.place_in_room": [[171, 189], ["roomgrid.RoomGrid.get_room", "roomgrid.RoomGrid.place_obj", "roomgrid.RoomGrid.objs.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.get_room", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv.place_obj", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "place_in_room", "(", "self", ",", "i", ",", "j", ",", "obj", ")", ":", "\n", "        ", "\"\"\"\n        Add an existing object to room (i, j)\n        \"\"\"", "\n", "\n", "room", "=", "self", ".", "get_room", "(", "i", ",", "j", ")", "\n", "\n", "pos", "=", "self", ".", "place_obj", "(", "\n", "obj", ",", "\n", "room", ".", "top", ",", "\n", "room", ".", "size", ",", "\n", "reject_fn", "=", "reject_next_to", ",", "\n", "max_tries", "=", "1000", "\n", ")", "\n", "\n", "room", ".", "objs", ".", "append", "(", "obj", ")", "\n", "\n", "return", "obj", ",", "pos", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.add_object": [[190, 211], ["roomgrid.RoomGrid.place_in_room", "roomgrid.RoomGrid._rand_elem", "roomgrid.RoomGrid._rand_color", "Key", "Ball", "Box"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.place_in_room"], ["", "def", "add_object", "(", "self", ",", "i", ",", "j", ",", "kind", "=", "None", ",", "color", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n        Add a new object to room (i, j)\n        \"\"\"", "\n", "\n", "if", "kind", "==", "None", ":", "\n", "            ", "kind", "=", "self", ".", "_rand_elem", "(", "[", "'key'", ",", "'ball'", ",", "'box'", "]", ")", "\n", "\n", "", "if", "color", "==", "None", ":", "\n", "            ", "color", "=", "self", ".", "_rand_color", "(", ")", "\n", "\n", "# TODO: we probably want to add an Object.make helper function", "\n", "", "assert", "kind", "in", "[", "'key'", ",", "'ball'", ",", "'box'", "]", "\n", "if", "kind", "==", "'key'", ":", "\n", "            ", "obj", "=", "Key", "(", "color", ")", "\n", "", "elif", "kind", "==", "'ball'", ":", "\n", "            ", "obj", "=", "Ball", "(", "color", ")", "\n", "", "elif", "kind", "==", "'box'", ":", "\n", "            ", "obj", "=", "Box", "(", "color", ")", "\n", "\n", "", "return", "self", ".", "place_in_room", "(", "i", ",", "j", ",", "obj", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.add_door": [[212, 247], ["roomgrid.RoomGrid.get_room", "Door", "roomgrid.RoomGrid.grid.set", "roomgrid.RoomGrid._rand_color", "roomgrid.RoomGrid._rand_bool", "roomgrid.RoomGrid._rand_int"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.get_room", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int"], ["", "def", "add_door", "(", "self", ",", "i", ",", "j", ",", "door_idx", "=", "None", ",", "color", "=", "None", ",", "locked", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n        Add a door to a room, connecting it to a neighbor\n        \"\"\"", "\n", "\n", "room", "=", "self", ".", "get_room", "(", "i", ",", "j", ")", "\n", "\n", "if", "door_idx", "==", "None", ":", "\n", "# Need to make sure that there is a neighbor along this wall", "\n", "# and that there is not already a door", "\n", "            ", "while", "True", ":", "\n", "                ", "door_idx", "=", "self", ".", "_rand_int", "(", "0", ",", "4", ")", "\n", "if", "room", ".", "neighbors", "[", "door_idx", "]", "and", "room", ".", "doors", "[", "door_idx", "]", "is", "None", ":", "\n", "                    ", "break", "\n", "\n", "", "", "", "if", "color", "==", "None", ":", "\n", "            ", "color", "=", "self", ".", "_rand_color", "(", ")", "\n", "\n", "", "if", "locked", "is", "None", ":", "\n", "            ", "locked", "=", "self", ".", "_rand_bool", "(", ")", "\n", "\n", "", "assert", "room", ".", "doors", "[", "door_idx", "]", "is", "None", ",", "\"door already exists\"", "\n", "\n", "room", ".", "locked", "=", "locked", "\n", "door", "=", "Door", "(", "color", ",", "is_locked", "=", "locked", ")", "\n", "\n", "pos", "=", "room", ".", "door_pos", "[", "door_idx", "]", "\n", "self", ".", "grid", ".", "set", "(", "*", "pos", ",", "door", ")", "\n", "door", ".", "cur_pos", "=", "pos", "\n", "\n", "neighbor", "=", "room", ".", "neighbors", "[", "door_idx", "]", "\n", "room", ".", "doors", "[", "door_idx", "]", "=", "door", "\n", "neighbor", ".", "doors", "[", "(", "door_idx", "+", "2", ")", "%", "4", "]", "=", "door", "\n", "\n", "return", "door", ",", "pos", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.remove_wall": [[248, 283], ["roomgrid.RoomGrid.get_room", "range", "roomgrid.RoomGrid.grid.set", "range", "roomgrid.RoomGrid.grid.set", "range", "roomgrid.RoomGrid.grid.set", "range", "roomgrid.RoomGrid.grid.set"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.get_room", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set"], ["", "def", "remove_wall", "(", "self", ",", "i", ",", "j", ",", "wall_idx", ")", ":", "\n", "        ", "\"\"\"\n        Remove a wall between two rooms\n        \"\"\"", "\n", "\n", "room", "=", "self", ".", "get_room", "(", "i", ",", "j", ")", "\n", "\n", "assert", "wall_idx", ">=", "0", "and", "wall_idx", "<", "4", "\n", "assert", "room", ".", "doors", "[", "wall_idx", "]", "is", "None", ",", "\"door exists on this wall\"", "\n", "assert", "room", ".", "neighbors", "[", "wall_idx", "]", ",", "\"invalid wall\"", "\n", "\n", "neighbor", "=", "room", ".", "neighbors", "[", "wall_idx", "]", "\n", "\n", "tx", ",", "ty", "=", "room", ".", "top", "\n", "w", ",", "h", "=", "room", ".", "size", "\n", "\n", "# Ordering of walls is right, down, left, up", "\n", "if", "wall_idx", "==", "0", ":", "\n", "            ", "for", "i", "in", "range", "(", "1", ",", "h", "-", "1", ")", ":", "\n", "                ", "self", ".", "grid", ".", "set", "(", "tx", "+", "w", "-", "1", ",", "ty", "+", "i", ",", "None", ")", "\n", "", "", "elif", "wall_idx", "==", "1", ":", "\n", "            ", "for", "i", "in", "range", "(", "1", ",", "w", "-", "1", ")", ":", "\n", "                ", "self", ".", "grid", ".", "set", "(", "tx", "+", "i", ",", "ty", "+", "h", "-", "1", ",", "None", ")", "\n", "", "", "elif", "wall_idx", "==", "2", ":", "\n", "            ", "for", "i", "in", "range", "(", "1", ",", "h", "-", "1", ")", ":", "\n", "                ", "self", ".", "grid", ".", "set", "(", "tx", ",", "ty", "+", "i", ",", "None", ")", "\n", "", "", "elif", "wall_idx", "==", "3", ":", "\n", "            ", "for", "i", "in", "range", "(", "1", ",", "w", "-", "1", ")", ":", "\n", "                ", "self", ".", "grid", ".", "set", "(", "tx", "+", "i", ",", "ty", ",", "None", ")", "\n", "", "", "else", ":", "\n", "            ", "assert", "False", ",", "\"invalid wall index\"", "\n", "\n", "# Mark the rooms as connected", "\n", "", "room", ".", "doors", "[", "wall_idx", "]", "=", "True", "\n", "neighbor", ".", "doors", "[", "(", "wall_idx", "+", "2", ")", "%", "4", "]", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.place_agent": [[284, 304], ["roomgrid.RoomGrid._rand_int", "roomgrid.RoomGrid._rand_int", "super().place_agent", "roomgrid.RoomGrid.grid.get"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.place_agent", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.get"], ["", "def", "place_agent", "(", "self", ",", "i", "=", "None", ",", "j", "=", "None", ",", "rand_dir", "=", "True", ")", ":", "\n", "        ", "\"\"\"\n        Place the agent in a room\n        \"\"\"", "\n", "\n", "if", "i", "==", "None", ":", "\n", "            ", "i", "=", "self", ".", "_rand_int", "(", "0", ",", "self", ".", "num_cols", ")", "\n", "", "if", "j", "==", "None", ":", "\n", "            ", "j", "=", "self", ".", "_rand_int", "(", "0", ",", "self", ".", "num_rows", ")", "\n", "\n", "", "room", "=", "self", ".", "room_grid", "[", "j", "]", "[", "i", "]", "\n", "\n", "# Find a position that is not right in front of an object", "\n", "while", "True", ":", "\n", "            ", "super", "(", ")", ".", "place_agent", "(", "room", ".", "top", ",", "room", ".", "size", ",", "rand_dir", ",", "max_tries", "=", "1000", ")", "\n", "front_cell", "=", "self", ".", "grid", ".", "get", "(", "*", "self", ".", "front_pos", ")", "\n", "if", "front_cell", "is", "None", "or", "front_cell", ".", "type", "is", "'wall'", ":", "\n", "                ", "break", "\n", "\n", "", "", "return", "self", ".", "agent_pos", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.connect_all": [[305, 360], ["roomgrid.RoomGrid.room_from_pos", "set", "roomgrid.RoomGrid.connect_all.find_reach"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.room_from_pos", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.Grid.set"], ["", "def", "connect_all", "(", "self", ",", "door_colors", "=", "COLOR_NAMES", ",", "max_itrs", "=", "5000", ")", ":", "\n", "        ", "\"\"\"\n        Make sure that all rooms are reachable by the agent from its\n        starting position\n        \"\"\"", "\n", "\n", "start_room", "=", "self", ".", "room_from_pos", "(", "*", "self", ".", "agent_pos", ")", "\n", "\n", "added_doors", "=", "[", "]", "\n", "\n", "def", "find_reach", "(", ")", ":", "\n", "            ", "reach", "=", "set", "(", ")", "\n", "stack", "=", "[", "start_room", "]", "\n", "while", "len", "(", "stack", ")", ">", "0", ":", "\n", "                ", "room", "=", "stack", ".", "pop", "(", ")", "\n", "if", "room", "in", "reach", ":", "\n", "                    ", "continue", "\n", "", "reach", ".", "add", "(", "room", ")", "\n", "for", "i", "in", "range", "(", "0", ",", "4", ")", ":", "\n", "                    ", "if", "room", ".", "doors", "[", "i", "]", ":", "\n", "                        ", "stack", ".", "append", "(", "room", ".", "neighbors", "[", "i", "]", ")", "\n", "", "", "", "return", "reach", "\n", "\n", "", "num_itrs", "=", "0", "\n", "\n", "while", "True", ":", "\n", "# This is to handle rare situations where random sampling produces", "\n", "# a level that cannot be connected, producing in an infinite loop", "\n", "            ", "if", "num_itrs", ">", "max_itrs", ":", "\n", "                ", "raise", "RecursionError", "(", "'connect_all failed'", ")", "\n", "", "num_itrs", "+=", "1", "\n", "\n", "# If all rooms are reachable, stop", "\n", "reach", "=", "find_reach", "(", ")", "\n", "if", "len", "(", "reach", ")", "==", "self", ".", "num_rows", "*", "self", ".", "num_cols", ":", "\n", "                ", "break", "\n", "\n", "# Pick a random room and door position", "\n", "", "i", "=", "self", ".", "_rand_int", "(", "0", ",", "self", ".", "num_cols", ")", "\n", "j", "=", "self", ".", "_rand_int", "(", "0", ",", "self", ".", "num_rows", ")", "\n", "k", "=", "self", ".", "_rand_int", "(", "0", ",", "4", ")", "\n", "room", "=", "self", ".", "get_room", "(", "i", ",", "j", ")", "\n", "\n", "# If there is already a door there, skip", "\n", "if", "not", "room", ".", "door_pos", "[", "k", "]", "or", "room", ".", "doors", "[", "k", "]", ":", "\n", "                ", "continue", "\n", "\n", "", "if", "room", ".", "locked", "or", "room", ".", "neighbors", "[", "k", "]", ".", "locked", ":", "\n", "                ", "continue", "\n", "\n", "", "color", "=", "self", ".", "_rand_elem", "(", "door_colors", ")", "\n", "door", ",", "_", "=", "self", ".", "add_door", "(", "i", ",", "j", ",", "k", ",", "color", ",", "False", ")", "\n", "added_doors", ".", "append", "(", "door", ")", "\n", "\n", "", "return", "added_doors", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.add_distractors": [[361, 398], ["len", "roomgrid.RoomGrid._rand_elem", "roomgrid.RoomGrid._rand_elem", "roomgrid.RoomGrid.add_object", "objs.append", "dists.append", "roomgrid.RoomGrid._rand_int", "roomgrid.RoomGrid._rand_int", "objs.append"], "methods", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.RoomGrid.add_object", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int", "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.minigrid.MiniGridEnv._rand_int", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["", "def", "add_distractors", "(", "self", ",", "i", "=", "None", ",", "j", "=", "None", ",", "num_distractors", "=", "10", ",", "all_unique", "=", "True", ")", ":", "\n", "        ", "\"\"\"\n        Add random objects that can potentially distract/confuse the agent.\n        \"\"\"", "\n", "\n", "# Collect a list of existing objects", "\n", "objs", "=", "[", "]", "\n", "for", "row", "in", "self", ".", "room_grid", ":", "\n", "            ", "for", "room", "in", "row", ":", "\n", "                ", "for", "obj", "in", "room", ".", "objs", ":", "\n", "                    ", "objs", ".", "append", "(", "(", "obj", ".", "type", ",", "obj", ".", "color", ")", ")", "\n", "\n", "# List of distractors added", "\n", "", "", "", "dists", "=", "[", "]", "\n", "\n", "while", "len", "(", "dists", ")", "<", "num_distractors", ":", "\n", "            ", "color", "=", "self", ".", "_rand_elem", "(", "COLOR_NAMES", ")", "\n", "type", "=", "self", ".", "_rand_elem", "(", "[", "'key'", ",", "'ball'", ",", "'box'", "]", ")", "\n", "obj", "=", "(", "type", ",", "color", ")", "\n", "\n", "if", "all_unique", "and", "obj", "in", "objs", ":", "\n", "                ", "continue", "\n", "\n", "# Add the object to a random room if no room specified", "\n", "", "room_i", "=", "i", "\n", "room_j", "=", "j", "\n", "if", "room_i", "==", "None", ":", "\n", "                ", "room_i", "=", "self", ".", "_rand_int", "(", "0", ",", "self", ".", "num_cols", ")", "\n", "", "if", "room_j", "==", "None", ":", "\n", "                ", "room_j", "=", "self", ".", "_rand_int", "(", "0", ",", "self", ".", "num_rows", ")", "\n", "\n", "", "dist", ",", "pos", "=", "self", ".", "add_object", "(", "room_i", ",", "room_j", ",", "*", "obj", ")", "\n", "\n", "objs", ".", "append", "(", "obj", ")", "\n", "dists", ".", "append", "(", "dist", ")", "\n", "\n", "", "return", "dists", "\n", "", "", ""]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.roomgrid.reject_next_to": [[3, 13], ["abs", "abs"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.abs", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.MetaGrammarFunctions.abs"], ["def", "reject_next_to", "(", "env", ",", "pos", ")", ":", "\n", "    ", "\"\"\"\n    Function to filter out object positions that are right next to\n    the agent's starting point\n    \"\"\"", "\n", "\n", "sx", ",", "sy", "=", "env", ".", "agent_pos", "\n", "x", ",", "y", "=", "pos", "\n", "d", "=", "abs", "(", "sx", "-", "x", ")", "+", "abs", "(", "sy", "-", "y", ")", "\n", "return", "d", "<", "2", "\n", "\n"]], "home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.register.register": [[5, 22], ["id.startswith", "gym.envs.registration.register", "env_list.append"], "function", ["home.repos.pwc.inspect_result.modularcogsci2022_msa.gym_minigrid.register.register", "home.repos.pwc.inspect_result.modularcogsci2022_msa.GroundedScan.dsl.Sequence.append"], ["def", "register", "(", "\n", "id", ",", "\n", "entry_point", ",", "\n", "reward_threshold", "=", "0.95", "\n", ")", ":", "\n", "    ", "assert", "id", ".", "startswith", "(", "\"MiniGrid-\"", ")", "\n", "assert", "id", "not", "in", "env_list", "\n", "\n", "# Register the environment with OpenAI gym", "\n", "gym_register", "(", "\n", "id", "=", "id", ",", "\n", "entry_point", "=", "entry_point", ",", "\n", "reward_threshold", "=", "reward_threshold", "\n", ")", "\n", "\n", "# Add the environment to the set", "\n", "env_list", ".", "append", "(", "id", ")", "\n", "", ""]]}