{"home.repos.pwc.inspect_result.rozumden_motionfromblur.None.mfb.MotionFromBlur.__init__": [[18, 23], ["kornia.feature.DeFMO().to", "mfb.MotionFromBlur.defmo.train", "kornia.feature.DeFMO"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "config", ",", "device", ")", ":", "\n", "        ", "self", ".", "config", "=", "config", "\n", "self", ".", "device", "=", "device", "\n", "self", ".", "defmo", "=", "DeFMO", "(", "pretrained", "=", "True", ")", ".", "to", "(", "device", ")", "\n", "self", ".", "defmo", ".", "train", "(", "False", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.mfb.MotionFromBlur.apply": [[24, 60], ["int", "int", "torch.linspace", "len", "bboxs_tight[].copy", "torch.Tensor", "torch.Tensor", "zip", "mfb.sync_directions_rgba", "mfb.MotionFromBlur.apply_mfb", "best_model[].reshape().mean", "utils.extend_bbox", "numpy.c_[].min", "numpy.c_[].max", "utils.extend_bbox", "utils.crop_resize", "utils.crop_resize", "torch.cat().unsqueeze().float", "renders[].data.cpu().detach().numpy().transpose", "utils.rev_crop_resize", "utils.crop_resize", "utils.crop_resize", "torch.cat().unsqueeze().float", "utils.crop_resize", "torch.zeros", "range", "torch.cat", "torch.cat", "bbox_tight.copy", "bbox_tight.copy", "torch.no_grad", "mfb.MotionFromBlur.defmo", "numpy.zeros", "best_model[].reshape", "numpy.max", "numpy.max", "torch.cat().unsqueeze", "torch.cat().unsqueeze().float.to", "renders[].data.cpu().detach().numpy", "torch.cat().unsqueeze", "torchvision.transforms.ToTensor", "torch.cat", "renders[].data.cpu().detach", "torch.cat", "renders[].data.cpu", "torchvision.transforms.ToTensor", "torchvision.transforms.ToTensor", "torchvision.transforms.ToTensor", "torchvision.transforms.ToTensor"], "methods", ["home.repos.pwc.inspect_result.rozumden_motionfromblur.None.mfb.sync_directions_rgba", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.mfb.MotionFromBlur.apply_mfb", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.extend_bbox", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.extend_bbox", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.crop_resize", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.crop_resize", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.rev_crop_resize", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.crop_resize", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.crop_resize", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.crop_resize"], ["", "def", "apply", "(", "self", ",", "Is", ",", "Bs", ",", "bboxs_tight", ",", "nsplits", ",", "radius", ",", "obj_dim", ")", ":", "\n", "        ", "g_resolution_x", "=", "int", "(", "640", "/", "2", ")", "\n", "g_resolution_y", "=", "int", "(", "480", "/", "2", ")", "\n", "self", ".", "defmo", ".", "rendering", ".", "tsr_steps", "=", "nsplits", "*", "self", ".", "config", "[", "\"factor\"", "]", "\n", "self", ".", "defmo", ".", "rendering", ".", "times", "=", "torch", ".", "linspace", "(", "0.01", ",", "0.99", ",", "nsplits", "*", "self", ".", "config", "[", "\"factor\"", "]", ")", "\n", "self", ".", "config", "[", "\"input_frames\"", "]", "=", "len", "(", "Is", ")", "\n", "self", ".", "bbox", "=", "bboxs_tight", "[", "0", "]", ".", "copy", "(", ")", "\n", "for", "bbox_tight", "in", "bboxs_tight", ":", "\n", "            ", "bbox", "=", "extend_bbox", "(", "bbox_tight", ".", "copy", "(", ")", ",", "1.0", "*", "np", ".", "max", "(", "radius", ")", ",", "g_resolution_y", "/", "g_resolution_x", ",", "Is", "[", "0", "]", ".", "shape", ")", "\n", "self", ".", "bbox", "[", ":", "2", "]", "=", "np", ".", "c_", "[", "self", ".", "bbox", "[", ":", "2", "]", ",", "bbox", "[", ":", "2", "]", "]", ".", "min", "(", "1", ")", "\n", "self", ".", "bbox", "[", "2", ":", "]", "=", "np", ".", "c_", "[", "self", ".", "bbox", "[", "2", ":", "]", ",", "bbox", "[", "2", ":", "]", "]", ".", "max", "(", "1", ")", "\n", "", "input_batch_sfb", "=", "torch", ".", "Tensor", "(", "[", "]", ")", "\n", "hs_frames_sfb", "=", "torch", ".", "Tensor", "(", "[", "]", ")", "\n", "new_res", "=", "(", "(", "self", ".", "bbox", "[", "3", "]", "-", "self", ".", "bbox", "[", "1", "]", ")", ",", "(", "self", ".", "bbox", "[", "2", "]", "-", "self", ".", "bbox", "[", "0", "]", ")", ")", "\n", "for", "I", ",", "B", ",", "bbox_tight", "in", "zip", "(", "Is", ",", "Bs", ",", "bboxs_tight", ")", ":", "\n", "            ", "bbox", "=", "extend_bbox", "(", "bbox_tight", ".", "copy", "(", ")", ",", "4.0", "*", "np", ".", "max", "(", "radius", ")", ",", "g_resolution_y", "/", "g_resolution_x", ",", "I", ".", "shape", ")", "\n", "im_crop", "=", "crop_resize", "(", "I", ",", "bbox", ",", "(", "g_resolution_x", ",", "g_resolution_y", ")", ")", "\n", "bgr_crop", "=", "crop_resize", "(", "B", ",", "bbox", ",", "(", "g_resolution_x", ",", "g_resolution_y", ")", ")", "\n", "input_batch", "=", "torch", ".", "cat", "(", "(", "transforms", ".", "ToTensor", "(", ")", "(", "im_crop", ")", ",", "transforms", ".", "ToTensor", "(", ")", "(", "bgr_crop", ")", ")", ",", "0", ")", ".", "unsqueeze", "(", "0", ")", ".", "float", "(", ")", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "                ", "renders", "=", "self", ".", "defmo", "(", "input_batch", ".", "to", "(", "self", ".", "device", ")", ")", "\n", "", "renders_rgba", "=", "renders", "[", "0", "]", ".", "data", ".", "cpu", "(", ")", ".", "detach", "(", ")", ".", "numpy", "(", ")", ".", "transpose", "(", "2", ",", "3", ",", "1", ",", "0", ")", "\n", "est_hs", "=", "rev_crop_resize", "(", "renders_rgba", ",", "bbox", ",", "np", ".", "zeros", "(", "(", "I", ".", "shape", "[", "0", "]", ",", "I", ".", "shape", "[", "1", "]", ",", "4", ")", ")", ")", "\n", "im_crop", "=", "crop_resize", "(", "I", ",", "self", ".", "bbox", ",", "new_res", ")", "\n", "self", ".", "bgr_crop", "=", "crop_resize", "(", "B", ",", "self", ".", "bbox", ",", "new_res", ")", "\n", "input_batch", "=", "torch", ".", "cat", "(", "(", "transforms", ".", "ToTensor", "(", ")", "(", "im_crop", ")", ",", "transforms", ".", "ToTensor", "(", ")", "(", "self", ".", "bgr_crop", ")", ")", ",", "0", ")", ".", "unsqueeze", "(", "0", ")", ".", "float", "(", ")", "\n", "defmo_masks", "=", "crop_resize", "(", "est_hs", ",", "self", ".", "bbox", ",", "new_res", ")", "\n", "hs_frames", "=", "torch", ".", "zeros", "(", "(", "1", ",", "nsplits", "*", "self", ".", "config", "[", "\"factor\"", "]", ",", "4", ",", "input_batch", ".", "shape", "[", "-", "2", "]", ",", "input_batch", ".", "shape", "[", "-", "1", "]", ")", ")", "\n", "for", "tti", "in", "range", "(", "nsplits", "*", "self", ".", "config", "[", "\"factor\"", "]", ")", ":", "\n", "                ", "hs_frames", "[", "0", ",", "tti", "]", "=", "transforms", ".", "ToTensor", "(", ")", "(", "defmo_masks", "[", ":", ",", ":", ",", ":", ",", "tti", "]", ")", "\n", "", "input_batch_sfb", "=", "torch", ".", "cat", "(", "(", "input_batch_sfb", ",", "input_batch", ")", ",", "0", ")", "\n", "hs_frames_sfb", "=", "torch", ".", "cat", "(", "(", "hs_frames_sfb", ",", "hs_frames", ")", ",", "0", ")", "\n", "", "hs_frames_sfb", "=", "sync_directions_rgba", "(", "hs_frames_sfb", ")", "\n", "best_model", "=", "self", ".", "apply_mfb", "(", "input_batch_sfb", ",", "hs_frames_sfb", ")", "\n", "best_model", "[", "\"renders\"", "]", "=", "best_model", "[", "\"renders\"", "]", ".", "reshape", "(", "1", ",", "self", ".", "config", "[", "\"input_frames\"", "]", ",", "nsplits", ",", "self", ".", "config", "[", "\"factor\"", "]", ",", "4", ",", "best_model", "[", "\"renders\"", "]", ".", "shape", "[", "-", "2", "]", ",", "-", "1", ")", ".", "mean", "(", "3", ")", "\n", "return", "best_model", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.mfb.MotionFromBlur.apply_mfb": [[61, 139], ["mfb.MotionFromBlur.config.copy", "input_batch[].to", "hs_frames[].to", "hs_frames[].max", "torch.ones", "models.loss.FMOLoss().to", "models.initial_mesh.generate_initial_mesh", "models.kaolin_wrapper.load_obj", "models.kaolin_wrapper.load_obj.vertices.numpy", "models.kaolin_wrapper.load_obj.faces.numpy().copy", "models.kaolin_wrapper.load_obj.uvs[].numpy", "models.rendering.RenderingKaolinMulti().to", "models.encoder.EncoderMulti().to", "list", "torch.optim.Adam", "models.encoder.EncoderMulti().to.train", "range", "os.path.join", "models.loss.FMOLoss", "models.encoder.EncoderMulti().to.parameters", "models.encoder.EncoderMulti().to.", "models.rendering.RenderingKaolinMulti().to.", "models.loss.FMOLoss().to.", "jloss.mean.mean.mean", "torch.optim.Adam.zero_grad", "jloss.mean.mean.backward", "torch.optim.Adam.step", "mloss.mean().item", "models.kaolin_wrapper.load_obj.faces.numpy", "models.rendering.RenderingKaolinMulti", "models.encoder.EncoderMulti", "print", "print", "RenderingKaolinMulti().to.detach().cpu().numpy", "obj[].detach().clone", "obj[].detach().clone", "obj[].detach().clone", "obj[].detach().clone", "obj[].detach().clone", "obj[].detach().clone", "mloss.mean", "print", "print", "print", "print", "jloss.mean.mean.item", "RenderingKaolinMulti().to.detach().cpu", "obj[].detach", "obj[].detach", "obj[].detach", "obj[].detach", "obj[].detach", "obj[].detach", "sloss.mean().item", "lap_loss.mean().item", "loss_tv.mean().item", "RenderingKaolinMulti().to.detach", "sloss.mean", "lap_loss.mean", "loss_tv.mean"], "methods", ["home.repos.pwc.inspect_result.rozumden_motionfromblur.models.initial_mesh.generate_initial_mesh", "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.kaolin_wrapper.load_obj"], ["", "def", "apply_mfb", "(", "self", ",", "input_batch", ",", "hs_frames", ")", ":", "\n", "        ", "input_batch", ",", "hs_frames", "=", "input_batch", "[", "None", "]", ".", "to", "(", "self", ".", "device", ")", ",", "hs_frames", "[", "None", "]", ".", "to", "(", "self", ".", "device", ")", "\n", "config", "=", "self", ".", "config", ".", "copy", "(", ")", "\n", "if", "hs_frames", "[", ":", ",", ":", ",", ":", ",", "3", ":", "4", "]", ".", "max", "(", ")", "<", "0.1", ":", "\n", "            ", "hs_frames", "[", ":", ",", ":", ",", ":", ",", "3", ":", "4", "]", "=", "torch", ".", "ones", "(", "hs_frames", "[", ":", ",", ":", ",", ":", ",", "3", ":", "4", "]", ".", "shape", ")", "\n", "", "width", "=", "hs_frames", ".", "shape", "[", "-", "1", "]", "\n", "height", "=", "hs_frames", ".", "shape", "[", "-", "2", "]", "\n", "best_model", "=", "{", "}", "\n", "best_model", "[", "\"value\"", "]", "=", "100", "\n", "for", "prot", "in", "config", "[", "\"shapes\"", "]", ":", "\n", "            ", "if", "prot", "==", "'sphere'", ":", "\n", "                ", "ivertices", ",", "faces", ",", "iface_features", "=", "generate_initial_mesh", "(", "config", "[", "\"mesh_size\"", "]", ")", "\n", "", "else", ":", "\n", "                ", "mesh", "=", "load_obj", "(", "os", ".", "path", ".", "join", "(", "'.'", ",", "'prototypes'", ",", "prot", "+", "'.obj'", ")", ")", "\n", "ivertices", "=", "mesh", ".", "vertices", ".", "numpy", "(", ")", "\n", "faces", "=", "mesh", ".", "faces", ".", "numpy", "(", ")", ".", "copy", "(", ")", "\n", "iface_features", "=", "mesh", ".", "uvs", "[", "mesh", ".", "face_uvs_idx", "]", ".", "numpy", "(", ")", "\n", "\n", "", "torch", ".", "backends", ".", "cudnn", ".", "benchmark", "=", "True", "\n", "loss_function", "=", "FMOLoss", "(", "config", ",", "ivertices", ",", "faces", ")", ".", "to", "(", "self", ".", "device", ")", "\n", "\n", "for", "predict_vertices", "in", "config", "[", "\"predict_vertices_list\"", "]", ":", "\n", "                ", "preoptimization", "=", "True", "\n", "config", "[", "\"loss_use_model\"", "]", "=", "self", ".", "config", "[", "\"loss_use_model\"", "]", "\n", "config", "[", "\"erode_renderer_mask\"", "]", "=", "self", ".", "config", "[", "\"erode_renderer_mask\"", "]", "\n", "config", "[", "\"predict_vertices\"", "]", "=", "predict_vertices", "\n", "config", "[", "\"loss_laplacian_weight\"", "]", "=", "10", "*", "self", ".", "config", "[", "\"loss_laplacian_weight\"", "]", "# for pre-optimization", "\n", "\n", "rendering", "=", "RenderingKaolinMulti", "(", "config", ",", "faces", ",", "width", ",", "height", ")", ".", "to", "(", "self", ".", "device", ")", "\n", "encoder", "=", "EncoderMulti", "(", "config", ",", "ivertices", ",", "faces", ",", "iface_features", ",", "width", ",", "height", ")", ".", "to", "(", "self", ".", "device", ")", "\n", "all_parameters", "=", "list", "(", "encoder", ".", "parameters", "(", ")", ")", "\n", "optimizer", "=", "torch", ".", "optim", ".", "Adam", "(", "all_parameters", ",", "lr", "=", "config", "[", "\"learning_rate\"", "]", ")", "\n", "encoder", ".", "train", "(", ")", "\n", "for", "epoch", "in", "range", "(", "config", "[", "\"iterations\"", "]", ")", ":", "\n", "                    ", "obj", "=", "encoder", "(", ")", "\n", "renders", "=", "rendering", "(", "obj", ")", "\n", "sloss", ",", "mloss", ",", "lap_loss", ",", "loss_tv", ",", "jloss", ",", "model_loss_perframe", "=", "loss_function", "(", "renders", ",", "hs_frames", ",", "input_batch", ",", "obj", "[", "\"translation\"", "]", ",", "obj", "[", "\"quaternion\"", "]", ",", "obj", "[", "\"vertices\"", "]", ",", "obj", "[", "\"texture_maps\"", "]", ",", "rendering", ".", "faces", ")", "\n", "\n", "jloss", "=", "jloss", ".", "mean", "(", ")", "\n", "optimizer", ".", "zero_grad", "(", ")", "\n", "jloss", ".", "backward", "(", ")", "\n", "optimizer", ".", "step", "(", ")", "\n", "model_loss", "=", "mloss", ".", "mean", "(", ")", ".", "item", "(", ")", "\n", "if", "config", "[", "\"verbose\"", "]", "and", "epoch", "%", "20", "==", "0", ":", "\n", "                        ", "print", "(", "\"Epoch {:4d}\"", ".", "format", "(", "epoch", "+", "1", ")", ",", "end", "=", "\" \"", ")", "\n", "if", "config", "[", "\"loss_use_supervised\"", "]", ":", "\n", "                            ", "print", "(", "\", loss {:.3f}\"", ".", "format", "(", "sloss", ".", "mean", "(", ")", ".", "item", "(", ")", ")", ",", "end", "=", "\" \"", ")", "\n", "", "if", "config", "[", "\"loss_use_model\"", "]", ":", "\n", "                            ", "print", "(", "\", model {:.3f}\"", ".", "format", "(", "model_loss", ")", ",", "end", "=", "\" \"", ")", "\n", "", "if", "config", "[", "\"loss_laplacian_weight\"", "]", ">", "0", ":", "\n", "                            ", "print", "(", "\", lap {:.3f}\"", ".", "format", "(", "lap_loss", ".", "mean", "(", ")", ".", "item", "(", ")", ")", ",", "end", "=", "\" \"", ")", "\n", "", "if", "config", "[", "\"loss_total_variation\"", "]", ">", "0", ":", "\n", "                            ", "print", "(", "\", TV {:.3f}\"", ".", "format", "(", "(", "loss_tv", ".", "mean", "(", ")", ".", "item", "(", ")", ")", ")", ",", "end", "=", "\" \"", ")", "\n", "", "print", "(", "\", joint {:.3f}\"", ".", "format", "(", "jloss", ".", "item", "(", ")", ")", ")", "\n", "\n", "", "if", "preoptimization", "and", "(", "epoch", ">=", "100", "or", "model_loss", "<", "0.3", ")", ":", "\n", "                        ", "preoptimization", "=", "False", "\n", "config", "[", "\"loss_use_model\"", "]", "=", "True", "\n", "config", "[", "\"erode_renderer_mask\"", "]", "=", "3", "\n", "", "if", "epoch", ">=", "300", ":", "# for finer convergence", "\n", "                        ", "config", "[", "\"erode_renderer_mask\"", "]", "=", "5", "\n", "config", "[", "\"loss_laplacian_weight\"", "]", "=", "3", "*", "self", ".", "config", "[", "\"loss_laplacian_weight\"", "]", "\n", "if", "model_loss", "<", "0.05", ":", "\n", "                            ", "config", "[", "\"loss_laplacian_weight\"", "]", "=", "self", ".", "config", "[", "\"loss_laplacian_weight\"", "]", "\n", "", "", "if", "model_loss", "<", "best_model", "[", "\"value\"", "]", ":", "\n", "                        ", "best_model", "[", "\"value\"", "]", "=", "model_loss", "\n", "best_model", "[", "\"value_joint\"", "]", "=", "model_loss_perframe", "\n", "best_model", "[", "\"renders\"", "]", "=", "renders", ".", "detach", "(", ")", ".", "cpu", "(", ")", ".", "numpy", "(", ")", "\n", "best_model", "[", "\"vertices\"", "]", "=", "obj", "[", "\"vertices\"", "]", ".", "detach", "(", ")", ".", "clone", "(", ")", "\n", "best_model", "[", "\"texture_maps\"", "]", "=", "obj", "[", "\"texture_maps\"", "]", ".", "detach", "(", ")", ".", "clone", "(", ")", "\n", "best_model", "[", "\"translation\"", "]", "=", "obj", "[", "\"translation\"", "]", ".", "detach", "(", ")", ".", "clone", "(", ")", "\n", "best_model", "[", "\"quaternion\"", "]", "=", "obj", "[", "\"quaternion\"", "]", ".", "detach", "(", ")", ".", "clone", "(", ")", "\n", "best_model", "[", "\"face_features\"", "]", "=", "obj", "[", "\"face_features\"", "]", ".", "detach", "(", ")", ".", "clone", "(", ")", "\n", "best_model", "[", "\"exp\"", "]", "=", "obj", "[", "\"exp\"", "]", ".", "detach", "(", ")", ".", "clone", "(", ")", "\n", "best_model", "[", "\"faces\"", "]", "=", "faces", "\n", "best_model", "[", "\"prototype\"", "]", "=", "prot", "\n", "best_model", "[", "\"predict_vertices\"", "]", "=", "predict_vertices", "\n", "", "", "", "", "return", "best_model", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.mfb.sync_directions_rgba": [[141, 156], ["range", "numpy.min", "numpy.min", "torch.mean", "torch.mean", "torch.flip", "torch.flip", "torch.mean", "torch.mean", "torch.mean", "torch.mean"], "function", ["None"], ["", "", "def", "sync_directions_rgba", "(", "est_hs", ")", ":", "\n", "    ", "for", "frmi", "in", "range", "(", "1", ",", "est_hs", ".", "shape", "[", "0", "]", ")", ":", "\n", "        ", "tsr0", "=", "est_hs", "[", "frmi", "-", "1", "]", "\n", "tsr", "=", "est_hs", "[", "frmi", "]", "\n", "if", "frmi", "==", "1", ":", "\n", "            ", "forward", "=", "np", ".", "min", "(", "[", "torch", ".", "mean", "(", "(", "tsr0", "[", "-", "1", "]", "-", "tsr", "[", "-", "1", "]", ")", "**", "2", ")", ",", "torch", ".", "mean", "(", "(", "tsr0", "[", "-", "1", "]", "-", "tsr", "[", "0", "]", ")", "**", "2", ")", "]", ")", "\n", "backward", "=", "np", ".", "min", "(", "[", "torch", ".", "mean", "(", "(", "tsr0", "[", "0", "]", "-", "tsr", "[", "-", "1", "]", ")", "**", "2", ")", ",", "torch", ".", "mean", "(", "(", "tsr0", "[", "0", "]", "-", "tsr", "[", "0", "]", ")", "**", "2", ")", "]", ")", "\n", "if", "backward", "<", "forward", ":", "\n", "                ", "est_hs", "[", "frmi", "-", "1", "]", "=", "torch", ".", "flip", "(", "est_hs", "[", "frmi", "-", "1", "]", ",", "[", "0", "]", ")", "\n", "tsr0", "=", "est_hs", "[", "frmi", "-", "1", "]", "\n", "\n", "", "", "if", "torch", ".", "mean", "(", "(", "tsr0", "[", "-", "1", "]", "-", "tsr", "[", "-", "1", "]", ")", "**", "2", ")", "<", "torch", ".", "mean", "(", "(", "tsr0", "[", "-", "1", "]", "-", "tsr", "[", "0", "]", ")", "**", "2", ")", ":", "\n", "## reverse time direction for better alignment", "\n", "            ", "est_hs", "[", "frmi", "]", "=", "torch", ".", "flip", "(", "est_hs", "[", "frmi", "]", ",", "[", "0", "]", ")", "\n", "", "", "return", "est_hs", "", "", ""]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.run.parse_args": [[10, 18], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args"], "function", ["home.repos.pwc.inspect_result.rozumden_motionfromblur.None.run.parse_args"], ["def", "parse_args", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n", "parser", ".", "add_argument", "(", "\"--input\"", ",", "required", "=", "False", ",", "default", "=", "\"./input/volleyball_bounce.avi\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--max_frames\"", ",", "type", "=", "int", ",", "required", "=", "False", ",", "default", "=", "3", ")", "\n", "parser", ".", "add_argument", "(", "\"--configs\"", ",", "required", "=", "False", ",", "default", "=", "\"configs.yaml\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--subframes\"", ",", "type", "=", "int", ",", "required", "=", "False", ",", "default", "=", "8", ")", "\n", "parser", ".", "add_argument", "(", "\"--output\"", ",", "required", "=", "False", ",", "default", "=", "\"./output\"", ")", "\n", "return", "parser", ".", "parse_args", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.run.main": [[19, 95], ["run.parse_args", "utils.load_config", "torch.device", "cv2.VideoCapture", "cv2.VideoCapture.isOpened", "np.median", "len", "range", "bboxs[].copy", "utils.extend_bbox_uniform", "print", "time.time", "mfb.MotionFromBlur", "mfb.MotionFromBlur.apply", "print", "utils.crop_only", "range", "utils.write_video", "utils.write_video", "utils.imwrite", "utils.imwrite", "write_obj_mesh", "torchvision.utils.save_image", "get_3dtraj", "write_obj_traj_exp", "write_obj_traj_exp", "do_write_mesh", "do_write_mesh", "open", "open.write", "open.write", "open.close", "os.path.exists", "os.makedirs", "cv2.VideoCapture.read", "Is.append", "np.asarray", "len", "utils.fmo_detect_maxarea", "bboxs.append", "Bs.append", "utils.extend_bbox", "np.c_[].min", "np.c_[].max", "utils.extend_bbox_uniform.copy", "Bs[].copy", "len", "in_long.append", "utils.rev_crop_resize", "utils.rgba2hs", "utils.crop_only", "est_long.append", "utils.write_trajectory", "np.concatenate", "os.path.join", "np.concatenate", "os.path.join", "os.path.join", "utils.crop_only", "os.path.join", "[].cpu().numpy", "[].cpu().numpy", "os.path.join", "os.path.join", "write_obj_mesh", "os.path.join", "os.path.join", "os.path.join", "torch.cuda.is_available", "utils.extend_bbox.copy", "np.max", "[].transpose", "np.zeros", "utils.write_trajectory", "[].cpu().numpy", "[].cpu().numpy", "os.path.join", "len", "np.max", "utils.crop_only", "renders2traj", "[].cpu", "[].cpu", "time.time", "torch.from_numpy", "[].cpu", "[].cpu", "[].copy", "mesh_rotate", "utils.crop_only().transpose", "utils.crop_only"], "function", ["home.repos.pwc.inspect_result.rozumden_motionfromblur.None.run.parse_args", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.load_config", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.extend_bbox_uniform", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.mfb.MotionFromBlur.apply", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.crop_only", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.write_video", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.write_video", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.imwrite", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.imwrite", "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.kaolin_wrapper.write_obj_mesh", "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.rendering.get_3dtraj", "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.kaolin_wrapper.write_obj_traj_exp", "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.kaolin_wrapper.write_obj_traj_exp", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.fmo_detect_maxarea", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.extend_bbox", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.rev_crop_resize", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.rgba2hs", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.crop_only", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.write_trajectory", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.crop_only", "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.kaolin_wrapper.write_obj_mesh", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.write_trajectory", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.crop_only", "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.rendering.renders2traj", "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.rendering.mesh_rotate", "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.crop_only"], ["", "def", "main", "(", ")", ":", "\n", "    ", "args", "=", "parse_args", "(", ")", "\n", "config", "=", "load_config", "(", "args", ".", "configs", ")", "\n", "config", "[", "\"fmo_steps\"", "]", "=", "args", ".", "subframes", "\n", "device", "=", "torch", ".", "device", "(", "\"cuda\"", "if", "torch", ".", "cuda", ".", "is_available", "(", ")", "else", "\"cpu\"", ")", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "args", ".", "output", ")", ":", "\n", "        ", "os", ".", "makedirs", "(", "args", ".", "output", ")", "\n", "\n", "# Start data loading", "\n", "", "Is", "=", "[", "]", "\n", "Bs", "=", "[", "]", "\n", "bboxs", "=", "[", "]", "\n", "cap", "=", "cv2", ".", "VideoCapture", "(", "args", ".", "input", ")", "\n", "while", "cap", ".", "isOpened", "(", ")", ":", "\n", "        ", "ret", ",", "frame", "=", "cap", ".", "read", "(", ")", "\n", "if", "not", "ret", ":", "\n", "            ", "break", "\n", "", "Is", ".", "append", "(", "frame", "[", ":", ",", ":", ",", "[", "2", ",", "1", ",", "0", "]", "]", "/", "255", ")", "\n", "", "B", "=", "np", ".", "median", "(", "np", ".", "asarray", "(", "Is", ")", ",", "0", ")", "\n", "Is", "=", "Is", "[", ":", "args", ".", "max_frames", "]", "\n", "config", "[", "\"input_frames\"", "]", "=", "len", "(", "Is", ")", "\n", "radius", "=", "0", "\n", "for", "ki", "in", "range", "(", "len", "(", "Is", ")", ")", ":", "\n", "        ", "bbox", ",", "radius_temp", "=", "fmo_detect_maxarea", "(", "Is", "[", "ki", "]", ",", "B", ",", "th", "=", "0.03", ")", "\n", "bboxs", ".", "append", "(", "bbox", ")", "\n", "Bs", ".", "append", "(", "B", ")", "\n", "if", "radius_temp", ">", "radius", ":", "\n", "            ", "radius", "=", "radius_temp", "\n", "", "", "bbox_use", "=", "bboxs", "[", "0", "]", ".", "copy", "(", ")", "\n", "for", "bbox_one", "in", "bboxs", ":", "\n", "        ", "bbox_one", "=", "extend_bbox", "(", "bbox_one", ".", "copy", "(", ")", ",", "1.0", "*", "np", ".", "max", "(", "radius", ")", ",", "0.75", ",", "Is", "[", "0", "]", ".", "shape", ")", "\n", "bbox_use", "[", ":", "2", "]", "=", "np", ".", "c_", "[", "bbox_use", "[", ":", "2", "]", ",", "bbox_one", "[", ":", "2", "]", "]", ".", "min", "(", "1", ")", "\n", "bbox_use", "[", "2", ":", "]", "=", "np", ".", "c_", "[", "bbox_use", "[", "2", ":", "]", ",", "bbox_one", "[", "2", ":", "]", "]", ".", "max", "(", "1", ")", "\n", "", "bbox_use", "=", "extend_bbox_uniform", "(", "bbox_use", ".", "copy", "(", ")", ",", "0.5", "*", "np", ".", "max", "(", "radius", ")", ",", "Is", "[", "0", "]", ".", "shape", ")", "\n", "# End data loading", "\n", "print", "(", "config", ")", "\n", "\n", "t0", "=", "time", ".", "time", "(", ")", "\n", "mfb", "=", "MotionFromBlur", "(", "config", ",", "device", ")", "\n", "best_model", "=", "mfb", ".", "apply", "(", "Is", ",", "Bs", ",", "bboxs", ",", "args", ".", "subframes", ",", "radius", ",", "None", ")", "\n", "print", "(", "'{:4d} epochs took {:.2f} seconds, best model loss {:.4f}'", ".", "format", "(", "config", "[", "\"iterations\"", "]", ",", "(", "time", ".", "time", "(", ")", "-", "t0", ")", "/", "1", ",", "best_model", "[", "\"value\"", "]", ")", ")", "\n", "\n", "in_long", "=", "[", "]", "\n", "est_long", "=", "[", "]", "\n", "traj_prev", "=", "[", "]", "\n", "traj_final", "=", "crop_only", "(", "Bs", "[", "0", "]", ".", "copy", "(", ")", ",", "bbox_use", ")", "\n", "for", "fi", "in", "range", "(", "len", "(", "Is", ")", ")", ":", "\n", "        ", "in_long", ".", "append", "(", "crop_only", "(", "Is", "[", "fi", "]", ",", "bbox_use", ")", "[", "...", ",", "None", "]", ")", "\n", "est", "=", "rev_crop_resize", "(", "best_model", "[", "\"renders\"", "]", "[", "0", ",", "fi", "]", ".", "transpose", "(", "2", ",", "3", ",", "1", ",", "0", ")", ",", "mfb", ".", "bbox", ",", "np", ".", "zeros", "(", "(", "Is", "[", "fi", "]", ".", "shape", "[", "0", "]", ",", "Is", "[", "fi", "]", ".", "shape", "[", "1", "]", ",", "4", ")", ")", ")", "\n", "est_hs", "=", "rgba2hs", "(", "est", ",", "Bs", "[", "fi", "]", ")", "\n", "est_hs_tight", "=", "crop_only", "(", "est_hs", ",", "bbox_use", ")", "\n", "est_long", ".", "append", "(", "est_hs_tight", ")", "\n", "traj", "=", "renders2traj", "(", "torch", ".", "from_numpy", "(", "crop_only", "(", "est", ",", "bbox_use", ")", ".", "transpose", "(", "3", ",", "2", ",", "0", ",", "1", ")", "[", "None", "]", ".", "copy", "(", ")", ")", ",", "'cpu'", ")", "[", "0", "]", ".", "T", "\n", "if", "traj_prev", "!=", "[", "]", ":", "\n", "            ", "traj_noexp", "=", "np", ".", "c_", "[", "traj_prev", "[", ":", ",", "-", "1", "]", ",", "traj", "[", ":", ",", "0", "]", "]", "\n", "traj_final", "=", "write_trajectory", "(", "traj_final", ",", "traj_noexp", "[", "[", "1", ",", "0", "]", "]", ",", "[", "1", ",", "1", ",", "0", "]", ")", "\n", "", "traj_final", "=", "write_trajectory", "(", "traj_final", ",", "traj", "[", "[", "1", ",", "0", "]", "]", ",", "[", "0", ",", "0", ",", "1", "]", ")", "\n", "traj_prev", "=", "traj", "\n", "\n", "", "write_video", "(", "np", ".", "concatenate", "(", "in_long", ",", "-", "1", ")", ",", "os", ".", "path", ".", "join", "(", "args", ".", "output", ",", "'input.avi'", ")", ",", "fps", "=", "1", ")", "\n", "write_video", "(", "np", ".", "concatenate", "(", "est_long", ",", "-", "1", ")", ",", "os", ".", "path", ".", "join", "(", "args", ".", "output", ",", "'mfb.avi'", ")", ",", "fps", "=", "args", ".", "subframes", ")", "\n", "imwrite", "(", "traj_final", ",", "os", ".", "path", ".", "join", "(", "args", ".", "output", ",", "'traj.png'", ")", ")", "\n", "imwrite", "(", "crop_only", "(", "Bs", "[", "0", "]", ",", "bbox_use", ")", ",", "os", ".", "path", ".", "join", "(", "args", ".", "output", ",", "'bgr.png'", ")", ")", "\n", "write_obj_mesh", "(", "best_model", "[", "\"vertices\"", "]", "[", "0", "]", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ",", "best_model", "[", "\"faces\"", "]", ",", "best_model", "[", "\"face_features\"", "]", "[", "0", "]", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ",", "os", ".", "path", ".", "join", "(", "args", ".", "output", ",", "'mesh.obj'", ")", ")", "\n", "save_image", "(", "best_model", "[", "\"texture_maps\"", "]", ",", "os", ".", "path", ".", "join", "(", "args", ".", "output", ",", "'tex.png'", ")", ")", "\n", "do_write_mesh", "=", "lambda", "fi0", ",", "ti0", ",", "best_model", ",", "config", ":", "write_obj_mesh", "(", "mesh_rotate", "(", "best_model", ",", "config", ",", "fi0", ",", "ti0", ")", "[", "0", "]", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ",", "best_model", "[", "\"faces\"", "]", ",", "best_model", "[", "\"face_features\"", "]", "[", "0", "]", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ",", "os", ".", "path", ".", "join", "(", "args", ".", "output", ",", "'mesh_{:02d}_{:02d}.obj'", ".", "format", "(", "fi0", ",", "ti0", ")", ")", ")", "\n", "points_exp", "=", "get_3dtraj", "(", "best_model", ",", "config", ")", "\n", "write_obj_traj_exp", "(", "points_exp", ",", "os", ".", "path", ".", "join", "(", "args", ".", "output", ",", "'traj_exp.obj'", ")", ")", "\n", "write_obj_traj_exp", "(", "points_exp", "[", "1", ":", "-", "1", "]", ",", "os", ".", "path", ".", "join", "(", "args", ".", "output", ",", "'traj_noexp.obj'", ")", ")", "\n", "do_write_mesh", "(", "0", ",", "0", ",", "best_model", ",", "config", ")", "\n", "do_write_mesh", "(", "len", "(", "Is", ")", "-", "1", ",", "args", ".", "subframes", "-", "1", ",", "best_model", ",", "config", ")", "\n", "\n", "file", "=", "open", "(", "os", ".", "path", ".", "join", "(", "args", ".", "output", ",", "'model.mtl'", ")", ",", "\"w\"", ")", "\n", "file", ".", "write", "(", "\"newmtl Material.002\\n\"", ")", "\n", "file", ".", "write", "(", "\"map_Kd tex.png\\n\"", ")", "\n", "file", ".", "close", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.write_video": [[7, 14], ["cv2.VideoWriter", "range", "cv2.VideoWriter.release", "cv2.VideoWriter_fourcc", "cv2.VideoWriter.write"], "function", ["None"], ["def", "write_video", "(", "array4d", ",", "path", ",", "fps", "=", "6", ")", ":", "\n", "\t", "array4d", "[", "array4d", "<", "0", "]", "=", "0", "\n", "array4d", "[", "array4d", ">", "1", "]", "=", "1", "\n", "out", "=", "cv2", ".", "VideoWriter", "(", "path", ",", "cv2", ".", "VideoWriter_fourcc", "(", "*", "\"MJPG\"", ")", ",", "fps", ",", "(", "array4d", ".", "shape", "[", "1", "]", ",", "array4d", ".", "shape", "[", "0", "]", ")", ",", "True", ")", "\n", "for", "ki", "in", "range", "(", "array4d", ".", "shape", "[", "3", "]", ")", ":", "\n", "\t\t", "out", ".", "write", "(", "(", "array4d", "[", ":", ",", ":", ",", "[", "2", ",", "1", ",", "0", "]", ",", "ki", "]", "*", "255", ")", ".", "astype", "(", "np", ".", "uint8", ")", ")", "\n", "", "out", ".", "release", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.load_config": [[15, 19], ["open", "yaml.safe_load"], "function", ["None"], ["", "def", "load_config", "(", "config_name", ")", ":", "\n", "    ", "with", "open", "(", "config_name", ")", "as", "file", ":", "\n", "        ", "config", "=", "yaml", ".", "safe_load", "(", "file", ")", "\n", "", "return", "config", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.imread": [[20, 26], ["cv2.imread"], "function", ["home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.imread"], ["", "def", "imread", "(", "name", ")", ":", "\n", "\t", "img", "=", "cv2", ".", "imread", "(", "name", ",", "cv2", ".", "IMREAD_UNCHANGED", ")", "\n", "if", "img", ".", "shape", "[", "2", "]", "==", "3", ":", "\n", "\t\t", "return", "img", "[", ":", ",", ":", ",", "[", "2", ",", "1", ",", "0", "]", "]", "/", "255", "\n", "", "else", ":", "\n", "\t\t", "return", "img", "[", ":", ",", ":", ",", "[", "2", ",", "1", ",", "0", ",", "3", "]", "]", "/", "65535", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.imwrite": [[27, 31], ["cv2.imwrite"], "function", ["home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.imwrite"], ["", "", "def", "imwrite", "(", "im", ",", "name", "=", "'./tmp.png'", ")", ":", "\n", "\t", "im", "[", "im", "<", "0", "]", "=", "0", "\n", "im", "[", "im", ">", "1", "]", "=", "1", "\n", "cv2", ".", "imwrite", "(", "name", ",", "im", "[", ":", ",", ":", ",", "[", "2", ",", "1", ",", "0", "]", "]", "*", "255", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.fmo_detect_maxarea": [[32, 47], ["skimage.measure.label", "skimage.measure.regionprops", "range", "numpy.array().astype", "len", "numpy.array", "numpy.sum", "numpy.abs"], "function", ["None"], ["", "def", "fmo_detect_maxarea", "(", "I", ",", "B", ",", "th", "=", "0.1", ")", ":", "\n", "## simulate FMO detector -> find approximate location of FMO", "\n", "\t", "dI", "=", "(", "np", ".", "sum", "(", "np", ".", "abs", "(", "I", "-", "B", ")", ",", "2", ")", ">", "th", ")", ".", "astype", "(", "float", ")", "\n", "labeled", "=", "label", "(", "dI", ")", "\n", "regions", "=", "regionprops", "(", "labeled", ")", "\n", "ind", "=", "-", "1", "\n", "maxarea", "=", "0", "\n", "for", "ki", "in", "range", "(", "len", "(", "regions", ")", ")", ":", "\n", "\t\t", "if", "regions", "[", "ki", "]", ".", "area", ">", "maxarea", ":", "\n", "\t\t\t", "ind", "=", "ki", "\n", "maxarea", "=", "regions", "[", "ki", "]", ".", "area", "\n", "", "", "if", "ind", "==", "-", "1", ":", "\n", "\t\t", "return", "[", "]", ",", "0", "\n", "", "bbox", "=", "np", ".", "array", "(", "regions", "[", "ind", "]", ".", "bbox", ")", ".", "astype", "(", "int", ")", "\n", "return", "bbox", ",", "regions", "[", "ind", "]", ".", "minor_axis_length", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.write_trajectory": [[48, 52], ["range", "utils.renderTraj"], "function", ["home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.renderTraj"], ["", "def", "write_trajectory", "(", "Img", ",", "traj", ",", "vals", "=", "[", "0", ",", "0", ",", "1", "]", ")", ":", "\n", "\t", "for", "kk", "in", "range", "(", "traj", ".", "shape", "[", "1", "]", "-", "1", ")", ":", "\n", "\t\t", "Img", "=", "renderTraj", "(", "np", ".", "c_", "[", "traj", "[", ":", ",", "kk", "]", ",", "traj", "[", ":", ",", "kk", "+", "1", "]", "-", "traj", "[", ":", ",", "kk", "]", "]", "[", ":", ":", "-", "1", "]", ",", "Img", ",", "vals", ")", "\n", "", "return", "Img", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.renderTraj": [[53, 83], ["numpy.max", "numpy.linspace", "range", "numpy.concatenate", "numpy.round().astype", "numpy.round().astype", "skimage.draw.line_aa", "numpy.logical_and", "numpy.logical_and", "numpy.logical_and", "len", "numpy.zeros", "numpy.round", "numpy.round"], "function", ["None"], ["", "def", "renderTraj", "(", "pars", ",", "H", ",", "vals", "=", "[", "0", ",", "0", ",", "1", "]", ")", ":", "\n", "## Input: pars is either 2x2 (line) or 2x3 (parabola)", "\n", "\t", "if", "pars", ".", "shape", "[", "1", "]", "==", "2", ":", "\n", "\t\t", "pars", "=", "np", ".", "concatenate", "(", "(", "pars", ",", "np", ".", "zeros", "(", "(", "2", ",", "1", ")", ")", ")", ",", "1", ")", "\n", "ns", "=", "2", "\n", "", "else", ":", "\n", "\t\t", "ns", "=", "5", "\n", "\n", "", "ns", "=", "np", ".", "max", "(", "[", "2", ",", "ns", "]", ")", "\n", "\n", "rangeint", "=", "np", ".", "linspace", "(", "0", ",", "1", ",", "ns", ")", "\n", "for", "timeinst", "in", "range", "(", "rangeint", ".", "shape", "[", "0", "]", "-", "1", ")", ":", "\n", "\t\t", "ti0", "=", "rangeint", "[", "timeinst", "]", "\n", "ti1", "=", "rangeint", "[", "timeinst", "+", "1", "]", "\n", "start", "=", "pars", "[", ":", ",", "0", "]", "+", "pars", "[", ":", ",", "1", "]", "*", "ti0", "+", "pars", "[", ":", ",", "2", "]", "*", "(", "ti0", "*", "ti0", ")", "\n", "end", "=", "pars", "[", ":", ",", "0", "]", "+", "pars", "[", ":", ",", "1", "]", "*", "ti1", "+", "pars", "[", ":", ",", "2", "]", "*", "(", "ti1", "*", "ti1", ")", "\n", "start", "=", "np", ".", "round", "(", "start", ")", ".", "astype", "(", "np", ".", "int32", ")", "\n", "end", "=", "np", ".", "round", "(", "end", ")", ".", "astype", "(", "np", ".", "int32", ")", "\n", "rr", ",", "cc", ",", "val", "=", "line_aa", "(", "start", "[", "0", "]", ",", "start", "[", "1", "]", ",", "end", "[", "0", "]", ",", "end", "[", "1", "]", ")", "\n", "valid", "=", "np", ".", "logical_and", "(", "np", ".", "logical_and", "(", "rr", "<", "H", ".", "shape", "[", "0", "]", ",", "cc", "<", "H", ".", "shape", "[", "1", "]", ")", ",", "np", ".", "logical_and", "(", "rr", ">", "0", ",", "cc", ">", "0", ")", ")", "\n", "rr", "=", "rr", "[", "valid", "]", "\n", "cc", "=", "cc", "[", "valid", "]", "\n", "val", "=", "val", "[", "valid", "]", "\n", "if", "len", "(", "H", ".", "shape", ")", ">", "2", ":", "\n", "\t\t\t", "H", "[", "rr", ",", "cc", ",", "0", "]", "=", "vals", "[", "0", "]", "*", "val", "\n", "H", "[", "rr", ",", "cc", ",", "1", "]", "=", "vals", "[", "1", "]", "*", "val", "\n", "H", "[", "rr", ",", "cc", ",", "2", "]", "=", "vals", "[", "2", "]", "*", "val", "\n", "", "else", ":", "\n", "\t\t\t", "H", "[", "rr", ",", "cc", "]", "=", "val", "\n", "", "", "return", "H", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.extend_bbox": [[84, 105], ["int", "int", "int", "int", "numpy.min", "numpy.min", "numpy.ceil", "numpy.round", "numpy.round", "numpy.ceil"], "function", ["None"], ["", "def", "extend_bbox", "(", "bbox", ",", "ext", ",", "aspect_ratio", ",", "shp", ")", ":", "\n", "\t", "height", ",", "width", "=", "bbox", "[", "2", "]", "-", "bbox", "[", "0", "]", ",", "bbox", "[", "3", "]", "-", "bbox", "[", "1", "]", "\n", "\n", "h2", "=", "height", "+", "ext", "\n", "\n", "h2", "=", "int", "(", "np", ".", "ceil", "(", "np", ".", "ceil", "(", "h2", "/", "aspect_ratio", ")", "*", "aspect_ratio", ")", ")", "\n", "w2", "=", "int", "(", "h2", "/", "aspect_ratio", ")", "\n", "\n", "wdiff", "=", "w2", "-", "width", "\n", "wdiff2", "=", "int", "(", "np", ".", "round", "(", "wdiff", "/", "2", ")", ")", "\n", "hdiff", "=", "h2", "-", "height", "\n", "hdiff2", "=", "int", "(", "np", ".", "round", "(", "hdiff", "/", "2", ")", ")", "\n", "\n", "bbox", "[", "0", "]", "-=", "hdiff2", "\n", "bbox", "[", "2", "]", "+=", "hdiff", "-", "hdiff2", "\n", "bbox", "[", "1", "]", "-=", "wdiff2", "\n", "bbox", "[", "3", "]", "+=", "wdiff", "-", "wdiff2", "\n", "bbox", "[", "bbox", "<", "0", "]", "=", "0", "\n", "bbox", "[", "2", "]", "=", "np", ".", "min", "(", "[", "bbox", "[", "2", "]", ",", "shp", "[", "0", "]", "-", "1", "]", ")", "\n", "bbox", "[", "3", "]", "=", "np", ".", "min", "(", "[", "bbox", "[", "3", "]", ",", "shp", "[", "1", "]", "-", "1", "]", ")", "\n", "return", "bbox", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.extend_bbox_uniform": [[106, 115], ["numpy.min", "numpy.min"], "function", ["None"], ["", "def", "extend_bbox_uniform", "(", "bbox", ",", "ext", ",", "shp", ")", ":", "\n", "\t", "bbox", "[", "0", "]", "-=", "ext", "\n", "bbox", "[", "2", "]", "+=", "ext", "\n", "bbox", "[", "1", "]", "-=", "ext", "\n", "bbox", "[", "3", "]", "+=", "ext", "\n", "bbox", "[", "bbox", "<", "0", "]", "=", "0", "\n", "bbox", "[", "2", "]", "=", "np", ".", "min", "(", "[", "bbox", "[", "2", "]", ",", "shp", "[", "0", "]", "-", "1", "]", ")", "\n", "bbox", "[", "3", "]", "=", "np", ".", "min", "(", "[", "bbox", "[", "3", "]", ",", "shp", "[", "1", "]", "-", "1", "]", ")", "\n", "return", "bbox", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.rgba2hs": [[116, 118], ["None"], "function", ["None"], ["", "def", "rgba2hs", "(", "rgba", ",", "bgr", ")", ":", "\n", "\t", "return", "rgba", "[", ":", ",", ":", ",", ":", "3", "]", "*", "rgba", "[", ":", ",", ":", ",", "3", ":", "]", "+", "bgr", "[", ":", ",", ":", ",", ":", ",", "None", "]", "*", "(", "1", "-", "rgba", "[", ":", ",", ":", ",", "3", ":", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.crop_resize": [[119, 133], ["numpy.zeros", "range", "len", "cv2.resize"], "function", ["None"], ["", "def", "crop_resize", "(", "Is", ",", "bbox", ",", "res", ")", ":", "\n", "\t", "if", "Is", "is", "None", ":", "\n", "\t\t", "return", "None", "\n", "", "rev_axis", "=", "False", "\n", "if", "len", "(", "Is", ".", "shape", ")", "==", "3", ":", "\n", "\t\t", "rev_axis", "=", "True", "\n", "Is", "=", "Is", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", "\n", "", "imr", "=", "np", ".", "zeros", "(", "(", "res", "[", "1", "]", ",", "res", "[", "0", "]", ",", "Is", ".", "shape", "[", "2", "]", ",", "Is", ".", "shape", "[", "3", "]", ")", ")", "\n", "for", "kk", "in", "range", "(", "Is", ".", "shape", "[", "3", "]", ")", ":", "\n", "\t\t", "im", "=", "Is", "[", "bbox", "[", "0", "]", ":", "bbox", "[", "2", "]", ",", "bbox", "[", "1", "]", ":", "bbox", "[", "3", "]", ",", ":", ",", "kk", "]", "\n", "imr", "[", ":", ",", ":", ",", ":", ",", "kk", "]", "=", "cv2", ".", "resize", "(", "im", ",", "res", ",", "interpolation", "=", "cv2", ".", "INTER_CUBIC", ")", "\n", "", "if", "rev_axis", ":", "\n", "\t\t", "imr", "=", "imr", "[", ":", ",", ":", ",", ":", ",", "0", "]", "\n", "", "return", "imr", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.rev_crop_resize": [[134, 139], ["numpy.tile", "range", "cv2.resize", "I.copy"], "function", ["None"], ["", "def", "rev_crop_resize", "(", "inp", ",", "bbox", ",", "I", ")", ":", "\n", "\t", "est_hs", "=", "np", ".", "tile", "(", "I", ".", "copy", "(", ")", "[", ":", ",", ":", ",", ":", ",", "np", ".", "newaxis", "]", ",", "(", "1", ",", "1", ",", "1", ",", "inp", ".", "shape", "[", "3", "]", ")", ")", "\n", "for", "hsk", "in", "range", "(", "inp", ".", "shape", "[", "3", "]", ")", ":", "\n", "\t\t", "est_hs", "[", "bbox", "[", "0", "]", ":", "bbox", "[", "2", "]", ",", "bbox", "[", "1", "]", ":", "bbox", "[", "3", "]", ",", ":", ",", "hsk", "]", "=", "cv2", ".", "resize", "(", "inp", "[", ":", ",", ":", ",", ":", ",", "hsk", "]", ",", "(", "bbox", "[", "3", "]", "-", "bbox", "[", "1", "]", ",", "bbox", "[", "2", "]", "-", "bbox", "[", "0", "]", ")", ",", "interpolation", "=", "cv2", ".", "INTER_CUBIC", ")", "\n", "", "return", "est_hs", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.None.utils.crop_only": [[140, 144], ["None"], "function", ["None"], ["", "def", "crop_only", "(", "Is", ",", "bbox", ")", ":", "\n", "\t", "if", "Is", "is", "None", ":", "\n", "\t\t", "return", "None", "\n", "", "return", "Is", "[", "bbox", "[", "0", "]", ":", "bbox", "[", "2", "]", ",", "bbox", "[", "1", "]", ":", "bbox", "[", "3", "]", "]", "", "", ""]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.encoder.EncoderMulti.__init__": [[17, 31], ["torch.Module.__init__", "torch.Parameter", "torch.Parameter", "torch.Parameter", "torch.Parameter", "encoder.EncoderMulti.register_buffer", "torch.Parameter", "torch.Parameter", "torch.from_numpy().unsqueeze().type", "torch.from_numpy().unsqueeze().type", "torch.from_numpy().unsqueeze().type", "torch.from_numpy().unsqueeze().type", "encoder.mesh_normalize", "encoder.EncoderMulti.register_buffer", "torch.Parameter", "torch.Parameter", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.Parameter", "torch.Parameter", "torch.from_numpy().unsqueeze().type", "torch.from_numpy().unsqueeze().type", "torch.from_numpy().unsqueeze().type", "torch.from_numpy().unsqueeze().type", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.from_numpy().unsqueeze", "torch.from_numpy().unsqueeze", "torch.from_numpy().unsqueeze", "torch.from_numpy().unsqueeze", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.from_numpy().unsqueeze", "torch.from_numpy().unsqueeze", "torch.from_numpy().unsqueeze", "torch.from_numpy().unsqueeze", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy"], "methods", ["home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.LaplacianLoss.__init__", "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.encoder.mesh_normalize"], ["    ", "def", "__init__", "(", "self", ",", "config", ",", "ivertices", ",", "faces", ",", "face_features", ",", "width", ",", "height", ")", ":", "\n", "        ", "super", "(", "EncoderMulti", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "config", "=", "config", "\n", "self", ".", "translation", "=", "nn", ".", "Parameter", "(", "torch", ".", "zeros", "(", "1", ",", "config", "[", "\"number_of_pieces\"", "]", ",", "1", ",", "config", "[", "\"number_of_terms\"", "]", ",", "3", ")", ")", "\n", "self", ".", "quaternion", "=", "nn", ".", "Parameter", "(", "torch", ".", "ones", "(", "1", ",", "config", "[", "\"number_of_pieces\"", "]", ",", "1", ",", "2", ",", "4", ")", ")", "\n", "if", "self", ".", "config", "[", "\"predict_vertices\"", "]", ":", "\n", "            ", "self", ".", "vertices", "=", "nn", ".", "Parameter", "(", "torch", ".", "zeros", "(", "1", ",", "ivertices", ".", "shape", "[", "0", "]", ",", "3", ")", ")", "\n", "", "self", ".", "register_buffer", "(", "'face_features'", ",", "torch", ".", "from_numpy", "(", "face_features", ")", ".", "unsqueeze", "(", "0", ")", ".", "type", "(", "self", ".", "translation", ".", "dtype", ")", ")", "\n", "self", ".", "texture_map", "=", "nn", ".", "Parameter", "(", "torch", ".", "ones", "(", "1", ",", "3", ",", "self", ".", "config", "[", "\"texture_size\"", "]", ",", "self", ".", "config", "[", "\"texture_size\"", "]", ")", ")", "\n", "ivertices", "=", "torch", ".", "from_numpy", "(", "ivertices", ")", ".", "unsqueeze", "(", "0", ")", ".", "type", "(", "self", ".", "translation", ".", "dtype", ")", "\n", "ivertices", "=", "mesh_normalize", "(", "ivertices", ")", "\n", "self", ".", "register_buffer", "(", "'ivertices'", ",", "ivertices", ")", "\n", "self", ".", "aspect_ratio", "=", "height", "/", "width", "\n", "self", ".", "exposure_fraction", "=", "nn", ".", "Parameter", "(", "5", "*", "torch", ".", "ones", "(", "1", ",", "1", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.encoder.EncoderMulti.forward": [[32, 54], ["range", "torch.Sigmoid", "torch.Sigmoid", "translation_all.append", "quaternion_all.append", "torch.stack().contiguous", "torch.stack().contiguous", "torch.stack().contiguous", "torch.stack().contiguous", "torch.stack().contiguous", "torch.stack().contiguous", "torch.stack().contiguous", "torch.stack().contiguous", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "vertices.mean"], "methods", ["None"], ["", "def", "forward", "(", "self", ")", ":", "\n", "        ", "output", "=", "{", "}", "\n", "output", "[", "\"exp\"", "]", "=", "nn", ".", "Sigmoid", "(", ")", "(", "self", ".", "exposure_fraction", ")", "\n", "translation_all", "=", "[", "]", "\n", "quaternion_all", "=", "[", "]", "\n", "for", "frmi", "in", "range", "(", "self", ".", "translation", ".", "shape", "[", "1", "]", ")", ":", "\n", "            ", "translation", "=", "self", ".", "translation", "[", ":", ",", "frmi", ",", "None", "]", "\n", "quaternion", "=", "self", ".", "quaternion", "[", ":", ",", "frmi", "]", "\n", "translation_all", ".", "append", "(", "translation", ")", "\n", "quaternion_all", ".", "append", "(", "quaternion", ")", "\n", "\n", "", "output", "[", "\"translation\"", "]", "=", "torch", ".", "stack", "(", "translation_all", ",", "2", ")", ".", "contiguous", "(", ")", "[", ":", ",", ":", ",", ":", ",", "0", "]", "\n", "output", "[", "\"quaternion\"", "]", "=", "torch", ".", "stack", "(", "quaternion_all", ",", "1", ")", ".", "contiguous", "(", ")", "[", ":", ",", ":", ",", "0", "]", "\n", "if", "self", ".", "config", "[", "\"predict_vertices\"", "]", ":", "\n", "            ", "vertices", "=", "self", ".", "ivertices", "+", "self", ".", "vertices", "\n", "output", "[", "\"vertices\"", "]", "=", "vertices", "-", "vertices", ".", "mean", "(", "1", ")", "[", ":", ",", "None", ",", ":", "]", "\n", "", "else", ":", "\n", "            ", "output", "[", "\"vertices\"", "]", "=", "self", ".", "ivertices", "\n", "\n", "", "output", "[", "\"face_features\"", "]", "=", "self", ".", "face_features", "\n", "output", "[", "\"texture_maps\"", "]", "=", "self", ".", "texture_map", "\n", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.encoder.mesh_normalize": [[6, 15], ["torch.max", "torch.max", "torch.min", "torch.min", "torch.max", "torch.max", "mesh_biggest.view", "vertices.view"], "function", ["None"], ["def", "mesh_normalize", "(", "vertices", ")", ":", "\n", "    ", "mesh_max", "=", "torch", ".", "max", "(", "vertices", ",", "dim", "=", "1", ",", "keepdim", "=", "True", ")", "[", "0", "]", "\n", "mesh_min", "=", "torch", ".", "min", "(", "vertices", ",", "dim", "=", "1", ",", "keepdim", "=", "True", ")", "[", "0", "]", "\n", "mesh_middle", "=", "(", "mesh_min", "+", "mesh_max", ")", "/", "2", "\n", "vertices", "=", "vertices", "-", "mesh_middle", "\n", "bs", "=", "vertices", ".", "shape", "[", "0", "]", "\n", "mesh_biggest", "=", "torch", ".", "max", "(", "vertices", ".", "view", "(", "bs", ",", "-", "1", ")", ",", "dim", "=", "1", ")", "[", "0", "]", "\n", "vertices", "=", "vertices", "/", "mesh_biggest", ".", "view", "(", "bs", ",", "1", ",", "1", ")", "\n", "return", "vertices", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.rendering.RenderingKaolinMulti.__init__": [[10, 23], ["super().__init__", "kaolin.render.camera.generate_perspective_projection", "rendering.RenderingKaolinMulti.register_buffer", "rendering.RenderingKaolinMulti.register_buffer", "rendering.RenderingKaolinMulti.register_buffer", "kaolin.render.camera.generate_rotate_translate_matrices", "rendering.RenderingKaolinMulti.register_buffer", "rendering.RenderingKaolinMulti.set_faces", "torch.zeros", "torch.Tensor", "torch.Tensor"], "methods", ["home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.LaplacianLoss.__init__", "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.rendering.RenderingKaolinMulti.set_faces"], ["    ", "def", "__init__", "(", "self", ",", "config", ",", "faces", ",", "width", ",", "height", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "config", "=", "config", "\n", "self", ".", "height", "=", "height", "\n", "self", ".", "width", "=", "width", "\n", "camera_proj", "=", "kaolin", ".", "render", ".", "camera", ".", "generate_perspective_projection", "(", "1.57", "/", "2", ",", "self", ".", "width", "/", "self", ".", "height", ")", "# 45 degrees", "\n", "self", ".", "register_buffer", "(", "'camera_proj'", ",", "camera_proj", ")", "\n", "self", ".", "register_buffer", "(", "'camera_trans'", ",", "torch", ".", "Tensor", "(", "[", "0", ",", "0", ",", "self", ".", "config", "[", "\"camera_distance\"", "]", "]", ")", "[", "None", "]", ")", "\n", "self", ".", "register_buffer", "(", "'obj_center'", ",", "torch", ".", "zeros", "(", "(", "1", ",", "3", ")", ")", ")", "\n", "camera_up_direction", "=", "torch", ".", "Tensor", "(", "(", "0", ",", "1", ",", "0", ")", ")", "[", "None", "]", "\n", "camera_rot", ",", "_", "=", "kaolin", ".", "render", ".", "camera", ".", "generate_rotate_translate_matrices", "(", "self", ".", "camera_trans", ",", "self", ".", "obj_center", ",", "camera_up_direction", ")", "\n", "self", ".", "register_buffer", "(", "'camera_rot'", ",", "camera_rot", ")", "\n", "self", ".", "set_faces", "(", "faces", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.rendering.RenderingKaolinMulti.set_faces": [[24, 26], ["rendering.RenderingKaolinMulti.register_buffer", "torch.LongTensor"], "methods", ["None"], ["", "def", "set_faces", "(", "self", ",", "faces", ")", ":", "\n", "        ", "self", ".", "register_buffer", "(", "'faces'", ",", "torch", ".", "LongTensor", "(", "faces", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.rendering.RenderingKaolinMulti.forward": [[27, 83], ["torch.ones().to", "kornia.geometry.conversions.angle_axis_to_rotation_matrix", "range", "torch.stack().contiguous", "sizes.sum", "prop[].sum", "kornia.geometry.conversions.quaternion_to_angle_axis", "kornia.geometry.conversions.angle_axis_to_rotation_matrix", "kornia.geometry.conversions.angle_axis_to_rotation_matrix", "torch.linspace", "range", "torch.ones", "kornia.geometry.conversions.quaternion_to_angle_axis", "range", "prepare_vertices", "kaolin.render.mesh.dibr_rasterization", "kaolin.render.mesh.texture_mapping.permute", "torch.cat", "torch.stack().contiguous.append", "torch.stack", "kaolin.render.camera.rotate_translate_points", "kaolin.render.mesh.texture_mapping", "torch.stack().contiguous", "torch.stack().contiguous.append", "torch.matmul", "torch.matmul", "kornia.morphology.erosion", "torch.stack"], "methods", ["home.repos.pwc.inspect_result.rozumden_motionfromblur.models.kaolin_wrapper.prepare_vertices"], ["", "def", "forward", "(", "self", ",", "obj", ")", ":", "\n", "        ", "sizes", "=", "(", "obj", "[", "\"translation\"", "]", "[", ":", ",", ":", ",", ":", ",", "1", "]", "**", "2", ")", ".", "sum", "(", "(", "0", ",", "1", ",", "3", ")", ")", ".", "sqrt", "(", ")", "+", "1e-10", "\n", "prop", "=", "sizes", "/", "sizes", ".", "sum", "(", ")", "\n", "prop", "=", "(", "prop", "*", "self", ".", "config", "[", "\"fmo_steps\"", "]", "*", "self", ".", "config", "[", "\"input_frames\"", "]", ")", ".", "round", "(", ")", ".", "to", "(", "int", ")", "\n", "prop", "[", "0", "]", "=", "self", ".", "config", "[", "\"fmo_steps\"", "]", "*", "self", ".", "config", "[", "\"input_frames\"", "]", "-", "prop", "[", "1", ":", "]", ".", "sum", "(", ")", "\n", "\n", "unit_vertices", "=", "obj", "[", "\"vertices\"", "]", "\n", "kernel", "=", "torch", ".", "ones", "(", "self", ".", "config", "[", "\"erode_renderer_mask\"", "]", ",", "self", ".", "config", "[", "\"erode_renderer_mask\"", "]", ")", ".", "to", "(", "obj", "[", "\"translation\"", "]", ".", "device", ")", "\n", "all_renders", "=", "[", "]", "\n", "renders", "=", "[", "]", "\n", "frames_in_piece", "=", "0", "\n", "time_before", "=", "0", "\n", "rotation_matrix", "=", "angle_axis_to_rotation_matrix", "(", "quaternion_to_angle_axis", "(", "obj", "[", "\"quaternion\"", "]", "[", ":", ",", "0", ",", "0", "]", ")", ")", "\n", "translation_start", "=", "obj", "[", "\"translation\"", "]", "[", ":", ",", ":", ",", "0", ",", "0", "]", "\n", "for", "pind", "in", "range", "(", "self", ".", "config", "[", "\"number_of_pieces\"", "]", ")", ":", "\n", "            ", "angles_per_frame", "=", "quaternion_to_angle_axis", "(", "obj", "[", "\"quaternion\"", "]", "[", ":", ",", "pind", ",", "1", "]", ")", "/", "self", ".", "config", "[", "\"rotation_divide\"", "]", "\n", "rotation_matrix_step", "=", "angle_axis_to_rotation_matrix", "(", "obj", "[", "\"exp\"", "]", "*", "angles_per_frame", "/", "self", ".", "config", "[", "\"fmo_steps\"", "]", ")", "\n", "rotation_matrix_noexp", "=", "angle_axis_to_rotation_matrix", "(", "angles_per_frame", "*", "(", "1", "-", "obj", "[", "\"exp\"", "]", ")", ")", "\n", "\n", "for", "ti", "in", "torch", ".", "linspace", "(", "0", ",", "1", ",", "prop", "[", "pind", "]", ")", ":", "\n", "                ", "if", "frames_in_piece", "==", "0", ":", "\n", "                    ", "time_before", "=", "ti", "\n", "", "time_exp", "=", "time_before", "+", "(", "ti", "-", "time_before", ")", "*", "obj", "[", "\"exp\"", "]", "\n", "\n", "vertices", "=", "kaolin", ".", "render", ".", "camera", ".", "rotate_translate_points", "(", "unit_vertices", ",", "rotation_matrix", ",", "self", ".", "obj_center", ")", "+", "translation_start", "\n", "for", "power_ind", "in", "range", "(", "1", ",", "self", ".", "config", "[", "\"number_of_terms\"", "]", ")", ":", "\n", "                    ", "vertices", "=", "vertices", "+", "(", "time_exp", "**", "power_ind", ")", "*", "obj", "[", "\"translation\"", "]", "[", ":", ",", ":", ",", "pind", ",", "power_ind", "]", "\n", "\n", "", "face_vertices_cam", ",", "face_vertices_image", ",", "face_normals", "=", "prepare_vertices", "(", "vertices", ",", "self", ".", "faces", ",", "self", ".", "camera_rot", ",", "self", ".", "camera_trans", ",", "self", ".", "camera_proj", ")", "\n", "face_vertices_z", "=", "face_vertices_cam", "[", ":", ",", ":", ",", ":", ",", "-", "1", "]", "\n", "face_normals_z", "=", "face_normals", "[", ":", ",", ":", ",", "-", "1", "]", "\n", "\n", "ren_features", ",", "ren_mask", ",", "red_index", "=", "kaolin", ".", "render", ".", "mesh", ".", "dibr_rasterization", "(", "self", ".", "height", ",", "self", ".", "width", ",", "face_vertices_z", ",", "face_vertices_image", ",", "obj", "[", "\"face_features\"", "]", ",", "face_normals_z", ",", "sigmainv", "=", "self", ".", "config", "[", "\"sigmainv\"", "]", ",", "boxlen", "=", "0.02", ",", "knum", "=", "30", ",", "multiplier", "=", "1000", ")", "\n", "if", "not", "obj", "[", "\"texture_maps\"", "]", "is", "None", ":", "\n", "                    ", "ren_features", "=", "kaolin", ".", "render", ".", "mesh", ".", "texture_mapping", "(", "ren_features", ",", "obj", "[", "\"texture_maps\"", "]", ",", "mode", "=", "'bilinear'", ")", "\n", "", "result", "=", "ren_features", ".", "permute", "(", "0", ",", "3", ",", "1", ",", "2", ")", "\n", "if", "self", ".", "config", "[", "\"erode_renderer_mask\"", "]", ">", "0", ":", "\n", "                    ", "ren_mask", "=", "erosion", "(", "ren_mask", "[", ":", ",", "None", "]", ",", "kernel", ")", "[", ":", ",", "0", "]", "\n", "", "result_rgba", "=", "torch", ".", "cat", "(", "(", "result", ",", "ren_mask", "[", ":", ",", "None", "]", ")", ",", "1", ")", "\n", "renders", ".", "append", "(", "result_rgba", ")", "\n", "\n", "frames_in_piece", "+=", "1", "\n", "if", "frames_in_piece", "==", "self", ".", "config", "[", "\"fmo_steps\"", "]", ":", "\n", "                    ", "frames_in_piece", "=", "0", "\n", "renders", "=", "torch", ".", "stack", "(", "renders", ",", "1", ")", ".", "contiguous", "(", ")", "\n", "all_renders", ".", "append", "(", "renders", ")", "\n", "renders", "=", "[", "]", "\n", "rotation_matrix", "=", "torch", ".", "matmul", "(", "rotation_matrix", ",", "rotation_matrix_noexp", ")", "\n", "", "else", ":", "\n", "                    ", "rotation_matrix", "=", "torch", ".", "matmul", "(", "rotation_matrix", ",", "rotation_matrix_step", ")", "\n", "\n", "", "", "for", "power_ind", "in", "range", "(", "1", ",", "self", ".", "config", "[", "\"number_of_terms\"", "]", ")", ":", "\n", "                ", "translation_start", "=", "translation_start", "+", "obj", "[", "\"translation\"", "]", "[", ":", ",", ":", ",", "pind", ",", "power_ind", "]", "\n", "\n", "", "", "all_renders", "=", "torch", ".", "stack", "(", "all_renders", ",", "1", ")", ".", "contiguous", "(", ")", "\n", "return", "all_renders", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.rendering.get_3dtraj": [[85, 117], ["range", "sizes.sum", "prop[].sum", "torch.linspace", "range", "translation_start.clone", "range", "points.append", "trans[].cpu().numpy", "trans[].cpu"], "function", ["None"], ["", "", "def", "get_3dtraj", "(", "best_model", ",", "config", ")", ":", "\n", "    ", "sizes", "=", "(", "best_model", "[", "\"translation\"", "]", "[", ":", ",", ":", ",", ":", ",", "1", "]", "**", "2", ")", ".", "sum", "(", "(", "0", ",", "1", ",", "3", ")", ")", ".", "sqrt", "(", ")", "+", "1e-10", "\n", "prop", "=", "sizes", "/", "sizes", ".", "sum", "(", ")", "\n", "prop", "=", "(", "prop", "*", "config", "[", "\"fmo_steps\"", "]", "*", "config", "[", "\"input_frames\"", "]", ")", ".", "round", "(", ")", ".", "to", "(", "int", ")", "\n", "prop", "[", "0", "]", "=", "config", "[", "\"fmo_steps\"", "]", "*", "config", "[", "\"input_frames\"", "]", "-", "prop", "[", "1", ":", "]", ".", "sum", "(", ")", "\n", "unit_vertices", "=", "best_model", "[", "\"vertices\"", "]", "\n", "translation_start", "=", "best_model", "[", "\"translation\"", "]", "[", ":", ",", ":", ",", "0", ",", "0", "]", "\n", "frames_in_piece", "=", "0", "\n", "time_before", "=", "0", "\n", "current_frmi", "=", "0", "\n", "points", "=", "[", "]", "\n", "for", "pind", "in", "range", "(", "config", "[", "\"number_of_pieces\"", "]", ")", ":", "\n", "        ", "for", "ti", "in", "torch", ".", "linspace", "(", "0", ",", "1", ",", "prop", "[", "pind", "]", ")", ":", "\n", "            ", "if", "frames_in_piece", "==", "0", ":", "\n", "                ", "time_before", "=", "ti", "\n", "", "time_exp", "=", "time_before", "+", "(", "ti", "-", "time_before", ")", "*", "best_model", "[", "\"exp\"", "]", "\n", "\n", "if", "frames_in_piece", "==", "config", "[", "\"fmo_steps\"", "]", "-", "1", "or", "frames_in_piece", "==", "0", ":", "\n", "                ", "trans", "=", "translation_start", ".", "clone", "(", ")", "\n", "for", "power_ind", "in", "range", "(", "1", ",", "config", "[", "\"number_of_terms\"", "]", ")", ":", "\n", "                    ", "trans", "=", "trans", "+", "(", "time_exp", "**", "power_ind", ")", "*", "best_model", "[", "\"translation\"", "]", "[", ":", ",", ":", ",", "pind", ",", "power_ind", "]", "\n", "", "points", ".", "append", "(", "trans", "[", "0", ",", "0", "]", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ")", "\n", "\n", "", "frames_in_piece", "+=", "1", "\n", "if", "frames_in_piece", "==", "config", "[", "\"fmo_steps\"", "]", ":", "\n", "                ", "current_frmi", "+=", "1", "\n", "frames_in_piece", "=", "0", "\n", "\n", "", "", "for", "power_ind", "in", "range", "(", "1", ",", "config", "[", "\"number_of_terms\"", "]", ")", ":", "\n", "            ", "translation_start", "=", "translation_start", "+", "best_model", "[", "\"translation\"", "]", "[", ":", ",", ":", ",", "pind", ",", "power_ind", "]", "\n", "\n", "", "", "return", "points", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.rendering.mesh_rotate": [[118, 158], ["kornia.geometry.conversions.angle_axis_to_rotation_matrix", "range", "range", "sizes.sum", "prop[].sum", "kornia.geometry.conversions.quaternion_to_angle_axis", "kornia.geometry.conversions.angle_axis_to_rotation_matrix", "kornia.geometry.conversions.angle_axis_to_rotation_matrix", "torch.linspace", "range", "kaolin.render.camera.rotate_translate_points", "kornia.geometry.conversions.quaternion_to_angle_axis", "torch.zeros().to", "torch.matmul", "torch.matmul", "torch.zeros"], "function", ["None"], ["", "def", "mesh_rotate", "(", "best_model", ",", "config", ",", "frmi_needed", ",", "ti_needed", ")", ":", "\n", "    ", "sizes", "=", "(", "best_model", "[", "\"translation\"", "]", "[", ":", ",", ":", ",", ":", ",", "1", "]", "**", "2", ")", ".", "sum", "(", "(", "0", ",", "1", ",", "3", ")", ")", ".", "sqrt", "(", ")", "+", "1e-10", "\n", "prop", "=", "sizes", "/", "sizes", ".", "sum", "(", ")", "\n", "prop", "=", "(", "prop", "*", "config", "[", "\"fmo_steps\"", "]", "*", "config", "[", "\"input_frames\"", "]", ")", ".", "round", "(", ")", ".", "to", "(", "int", ")", "\n", "prop", "[", "0", "]", "=", "config", "[", "\"fmo_steps\"", "]", "*", "config", "[", "\"input_frames\"", "]", "-", "prop", "[", "1", ":", "]", ".", "sum", "(", ")", "\n", "unit_vertices", "=", "best_model", "[", "\"vertices\"", "]", "\n", "rotation_matrix", "=", "angle_axis_to_rotation_matrix", "(", "quaternion_to_angle_axis", "(", "best_model", "[", "\"quaternion\"", "]", "[", ":", ",", "0", ",", "0", "]", ")", ")", "\n", "translation_start", "=", "best_model", "[", "\"translation\"", "]", "[", ":", ",", ":", ",", "0", ",", "0", "]", "\n", "frames_in_piece", "=", "0", "\n", "time_before", "=", "0", "\n", "current_frmi", "=", "0", "\n", "for", "pind", "in", "range", "(", "config", "[", "\"number_of_pieces\"", "]", ")", ":", "\n", "        ", "angles_per_frame", "=", "quaternion_to_angle_axis", "(", "best_model", "[", "\"quaternion\"", "]", "[", ":", ",", "pind", ",", "1", "]", ")", "/", "config", "[", "\"rotation_divide\"", "]", "\n", "rotation_matrix_step", "=", "angle_axis_to_rotation_matrix", "(", "best_model", "[", "\"exp\"", "]", "*", "angles_per_frame", "/", "config", "[", "\"fmo_steps\"", "]", ")", "\n", "rotation_matrix_noexp", "=", "angle_axis_to_rotation_matrix", "(", "angles_per_frame", "*", "(", "1", "-", "best_model", "[", "\"exp\"", "]", ")", ")", "\n", "\n", "for", "ti", "in", "torch", ".", "linspace", "(", "0", ",", "1", ",", "prop", "[", "pind", "]", ")", ":", "\n", "            ", "if", "frames_in_piece", "==", "0", ":", "\n", "                ", "time_before", "=", "ti", "\n", "", "time_exp", "=", "time_before", "+", "(", "ti", "-", "time_before", ")", "*", "best_model", "[", "\"exp\"", "]", "\n", "\n", "if", "current_frmi", "==", "frmi_needed", "and", "ti_needed", "==", "frames_in_piece", ":", "\n", "                ", "break", "\n", "\n", "", "frames_in_piece", "+=", "1", "\n", "if", "frames_in_piece", "==", "config", "[", "\"fmo_steps\"", "]", ":", "\n", "                ", "current_frmi", "+=", "1", "\n", "frames_in_piece", "=", "0", "\n", "rotation_matrix", "=", "torch", ".", "matmul", "(", "rotation_matrix", ",", "rotation_matrix_noexp", ")", "\n", "", "else", ":", "\n", "                ", "rotation_matrix", "=", "torch", ".", "matmul", "(", "rotation_matrix", ",", "rotation_matrix_step", ")", "\n", "", "", "if", "current_frmi", "==", "frmi_needed", "and", "ti_needed", "==", "frames_in_piece", ":", "\n", "            ", "break", "\n", "", "for", "power_ind", "in", "range", "(", "1", ",", "config", "[", "\"number_of_terms\"", "]", ")", ":", "\n", "            ", "translation_start", "=", "translation_start", "+", "best_model", "[", "\"translation\"", "]", "[", ":", ",", ":", ",", "pind", ",", "power_ind", "]", "\n", "\n", "", "", "vertices", "=", "kaolin", ".", "render", ".", "camera", ".", "rotate_translate_points", "(", "unit_vertices", ",", "rotation_matrix", ",", "torch", ".", "zeros", "(", "(", "1", ",", "3", ")", ")", ".", "to", "(", "unit_vertices", ".", "device", ")", ")", "+", "translation_start", "\n", "for", "power_ind", "in", "range", "(", "1", ",", "config", "[", "\"number_of_terms\"", "]", ")", ":", "\n", "        ", "vertices", "=", "vertices", "+", "(", "time_exp", "**", "power_ind", ")", "*", "best_model", "[", "\"translation\"", "]", "[", ":", ",", ":", ",", "pind", ",", "power_ind", "]", "\n", "", "return", "vertices", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.rendering.renders2traj": [[159, 167], ["torch.sum", "torch.sum", "torch.cat", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "cenx.unsqueeze", "ceny.unsqueeze", "[].float().to", "[].float().to", "[].float", "[].float", "torch.arange", "torch.arange"], "function", ["None"], ["", "def", "renders2traj", "(", "renders", ",", "device", ")", ":", "\n", "    ", "masks", "=", "renders", "[", ":", ",", ":", ",", "-", "1", "]", "\n", "sumx", "=", "torch", ".", "sum", "(", "masks", ",", "-", "2", ")", "\n", "sumy", "=", "torch", ".", "sum", "(", "masks", ",", "-", "1", ")", "\n", "cenx", "=", "torch", ".", "sum", "(", "sumy", "*", "torch", ".", "arange", "(", "1", ",", "sumy", ".", "shape", "[", "-", "1", "]", "+", "1", ")", "[", "None", ",", "None", "]", ".", "float", "(", ")", ".", "to", "(", "device", ")", ",", "-", "1", ")", "/", "torch", ".", "sum", "(", "sumy", ",", "-", "1", ")", "\n", "ceny", "=", "torch", ".", "sum", "(", "sumx", "*", "torch", ".", "arange", "(", "1", ",", "sumx", ".", "shape", "[", "-", "1", "]", "+", "1", ")", "[", "None", ",", "None", "]", ".", "float", "(", ")", ".", "to", "(", "device", ")", ",", "-", "1", ")", "/", "torch", ".", "sum", "(", "sumx", ",", "-", "1", ")", "\n", "est_traj", "=", "torch", ".", "cat", "(", "(", "cenx", ".", "unsqueeze", "(", "-", "1", ")", ",", "ceny", ".", "unsqueeze", "(", "-", "1", ")", ")", ",", "-", "1", ")", "\n", "return", "est_traj", "", "", ""]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.initial_mesh.generate_initial_mesh": [[4, 8], ["meshzoo.icosa_sphere", "initial_mesh.generate_face_features"], "function", ["home.repos.pwc.inspect_result.rozumden_motionfromblur.models.initial_mesh.generate_face_features"], ["def", "generate_initial_mesh", "(", "meshsize", ")", ":", "\n", "\t", "vertices", ",", "faces", "=", "meshzoo", ".", "icosa_sphere", "(", "meshsize", ")", "\n", "face_features", "=", "generate_face_features", "(", "vertices", ",", "faces", ")", "\n", "return", "vertices", ",", "faces", ",", "face_features", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.initial_mesh.generate_face_features": [[9, 19], ["numpy.zeros", "range", "range", "face_features[].min", "face_features[].max", "numpy.arctan2", "numpy.arcsin"], "function", ["None"], ["", "def", "generate_face_features", "(", "vertices", ",", "faces", ")", ":", "\n", "\t", "face_features", "=", "np", ".", "zeros", "(", "[", "faces", ".", "shape", "[", "0", "]", ",", "3", ",", "2", "]", ")", "\n", "for", "ki", "in", "range", "(", "faces", ".", "shape", "[", "0", "]", ")", ":", "\n", "\t\t", "for", "pi", "in", "range", "(", "3", ")", ":", "\n", "\t\t\t", "ind", "=", "faces", "[", "ki", ",", "pi", "]", "\n", "face_features", "[", "ki", ",", "pi", "]", "=", "[", "np", ".", "arctan2", "(", "-", "vertices", "[", "ind", ",", "0", "]", ",", "vertices", "[", "ind", ",", "1", "]", ")", "/", "(", "2", "*", "np", ".", "pi", ")", ",", "np", ".", "arcsin", "(", "vertices", "[", "ind", ",", "2", "]", ")", "/", "np", ".", "pi", "]", "\n", "", "if", "face_features", "[", "ki", ",", ":", ",", "0", "]", ".", "min", "(", ")", "<", "-", "0.25", "and", "face_features", "[", "ki", ",", ":", ",", "0", "]", ".", "max", "(", ")", ">", "0.25", ":", "\n", "\t\t\t", "face_features", "[", "ki", ",", ":", ",", "0", "]", "[", "face_features", "[", "ki", ",", ":", ",", "0", "]", "<", "0", "]", "=", "face_features", "[", "ki", ",", ":", ",", "0", "]", "[", "face_features", "[", "ki", ",", ":", ",", "0", "]", "<", "0", "]", "+", "1", "\n", "", "", "face_features", "=", "(", "0.5", "+", "face_features", ")", "#*0.98 + 0.01", "\n", "return", "face_features", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.FMOLoss.__init__": [[7, 12], ["torch.Module.__init__", "loss.LaplacianLoss"], "methods", ["home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.LaplacianLoss.__init__"], ["    ", "def", "__init__", "(", "self", ",", "config", ",", "ivertices", ",", "faces", ")", ":", "\n", "        ", "super", "(", "FMOLoss", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "config", "=", "config", "\n", "if", "self", ".", "config", "[", "\"loss_laplacian_weight\"", "]", ">", "0", ":", "\n", "            ", "self", ".", "lapl_loss", "=", "LaplacianLoss", "(", "ivertices", ",", "faces", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.FMOLoss.forward": [[13, 51], ["torch.cat().mean", "torch.cat().mean", "torch.cat().mean", "torch.cat().mean", "loss.fmo_model_loss", "range", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "hs_frames[].min", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "loss.fmo_loss", "loss.FMOLoss.lapl_loss", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "hs_frames[].mean", "kornia.total_variation"], "methods", ["home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.fmo_model_loss", "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.fmo_loss"], ["", "", "def", "forward", "(", "self", ",", "renders", ",", "hs_frames", ",", "input_batch", ",", "translation", ",", "quaternion", ",", "vertices", ",", "texture_maps", ",", "faces", ")", ":", "\n", "        ", "model_loss", "=", "0", "\n", "model_loss_perframe", "=", "[", "]", "\n", "if", "self", ".", "config", "[", "\"loss_use_model\"", "]", ":", "\n", "            ", "modelled_renders", "=", "torch", ".", "cat", "(", "(", "renders", "[", ":", ",", ":", ",", ":", ",", ":", "3", "]", "*", "renders", "[", ":", ",", ":", ",", ":", ",", "3", ":", "]", ",", "renders", "[", ":", ",", ":", ",", ":", ",", "3", ":", "4", "]", ")", ",", "3", ")", ".", "mean", "(", "2", ")", "\n", "\n", "region_of_interest", "=", "None", "\n", "if", "self", ".", "config", "[", "\"loss_use_supervised\"", "]", ":", "\n", "                ", "region_of_interest", "=", "hs_frames", "[", ":", ",", ":", ",", ":", ",", "3", ":", "]", ".", "mean", "(", "2", ")", ">", "0.05", "\n", "\n", "", "model_loss", ",", "model_loss_perframe", "=", "fmo_model_loss", "(", "input_batch", ",", "modelled_renders", ",", "Mask", "=", "region_of_interest", ")", "\n", "\n", "", "supervised_loss", "=", "0", "*", "model_loss", "\n", "if", "self", ".", "config", "[", "\"loss_use_supervised\"", "]", ":", "\n", "            ", "if", "hs_frames", "[", ":", ",", ":", ",", ":", ",", "3", "]", ".", "min", "(", ")", "==", "1.0", ":", "\n", "                ", "hs_frames_renderer", "=", "torch", ".", "cat", "(", "(", "input_batch", "[", ":", ",", ":", ",", "None", ",", "3", ":", "]", "*", "(", "1", "-", "renders", "[", ":", ",", ":", ",", ":", ",", "3", ":", "]", ")", "+", "renders", "[", ":", ",", ":", ",", ":", ",", ":", "3", "]", ",", "renders", "[", ":", ",", ":", ",", ":", ",", "3", ":", "]", ")", ",", "3", ")", "\n", "hs_frames_gt", "=", "torch", ".", "cat", "(", "(", "hs_frames", "[", ":", ",", ":", ",", ":", ",", ":", "3", "]", ",", "hs_frames", "[", ":", ",", ":", ",", ":", ",", "3", ":", "]", ")", ",", "3", ")", "\n", "", "else", ":", "\n", "                ", "hs_frames_renderer", "=", "renders", "\n", "hs_frames_gt", "=", "hs_frames", "\n", "", "for", "frmi", "in", "range", "(", "hs_frames_renderer", ".", "shape", "[", "1", "]", ")", ":", "\n", "                ", "loss1", "=", "fmo_loss", "(", "hs_frames_renderer", "[", ":", ",", "frmi", "]", ",", "hs_frames_gt", "[", ":", ",", "frmi", "]", ",", "self", ".", "config", ")", "\n", "supervised_loss", "=", "supervised_loss", "+", "loss1", "/", "hs_frames_renderer", ".", "shape", "[", "1", "]", "\n", "", "", "if", "not", "self", ".", "config", "[", "\"loss_use_model\"", "]", ":", "\n", "            ", "model_loss", "=", "supervised_loss", "\n", "\n", "", "loss_lap", "=", "0", "*", "supervised_loss", "\n", "if", "self", ".", "config", "[", "\"predict_vertices\"", "]", "and", "self", ".", "config", "[", "\"loss_laplacian_weight\"", "]", ">", "0", ":", "\n", "            ", "loss_lap", "=", "self", ".", "config", "[", "\"loss_laplacian_weight\"", "]", "*", "self", ".", "lapl_loss", "(", "vertices", ")", "\n", "\n", "", "loss_tv", "=", "0", "*", "supervised_loss", "\n", "if", "self", ".", "config", "[", "\"loss_total_variation\"", "]", ">", "0", ":", "\n", "            ", "texture_maps_ext", "=", "torch", ".", "cat", "(", "(", "texture_maps", ",", "texture_maps", "[", ":", ",", ":", ",", ":", "1", "]", ")", ",", "2", ")", "\n", "texture_maps_ext2", "=", "torch", ".", "cat", "(", "(", "texture_maps_ext", ",", "texture_maps_ext", "[", ":", ",", ":", ",", ":", ",", ":", "1", "]", ")", ",", "3", ")", "\n", "loss_tv", "=", "self", ".", "config", "[", "\"loss_total_variation\"", "]", "*", "total_variation", "(", "texture_maps_ext2", ")", "/", "(", "3", "*", "(", "self", ".", "config", "[", "\"texture_size\"", "]", "+", "1", ")", "**", "2", ")", "\n", "\n", "", "loss", "=", "supervised_loss", "+", "loss_lap", "+", "model_loss", "+", "loss_tv", "\n", "return", "supervised_loss", ",", "model_loss", ",", "loss_lap", ",", "loss_tv", ",", "loss", ",", "model_loss_perframe", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.LaplacianLoss.__init__": [[108, 129], ["torch.Module.__init__", "numpy.zeros().astype", "numpy.diag_indices", "range", "loss.LaplacianLoss.register_buffer", "numpy.zeros().astype.sum", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "numpy.zeros"], "methods", ["home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.LaplacianLoss.__init__"], ["    ", "def", "__init__", "(", "self", ",", "vertex", ",", "faces", ",", "average", "=", "False", ")", ":", "\n", "        ", "super", "(", "LaplacianLoss", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "nv", "=", "vertex", ".", "shape", "[", "0", "]", "\n", "self", ".", "nf", "=", "faces", ".", "shape", "[", "0", "]", "\n", "self", ".", "average", "=", "average", "\n", "laplacian", "=", "np", ".", "zeros", "(", "[", "self", ".", "nv", ",", "self", ".", "nv", "]", ")", ".", "astype", "(", "np", ".", "float32", ")", "\n", "\n", "laplacian", "[", "faces", "[", ":", ",", "0", "]", ",", "faces", "[", ":", ",", "1", "]", "]", "=", "-", "1", "\n", "laplacian", "[", "faces", "[", ":", ",", "1", "]", ",", "faces", "[", ":", ",", "0", "]", "]", "=", "-", "1", "\n", "laplacian", "[", "faces", "[", ":", ",", "1", "]", ",", "faces", "[", ":", ",", "2", "]", "]", "=", "-", "1", "\n", "laplacian", "[", "faces", "[", ":", ",", "2", "]", ",", "faces", "[", ":", ",", "1", "]", "]", "=", "-", "1", "\n", "laplacian", "[", "faces", "[", ":", ",", "2", "]", ",", "faces", "[", ":", ",", "0", "]", "]", "=", "-", "1", "\n", "laplacian", "[", "faces", "[", ":", ",", "0", "]", ",", "faces", "[", ":", ",", "2", "]", "]", "=", "-", "1", "\n", "\n", "r", ",", "c", "=", "np", ".", "diag_indices", "(", "laplacian", ".", "shape", "[", "0", "]", ")", "\n", "laplacian", "[", "r", ",", "c", "]", "=", "-", "laplacian", ".", "sum", "(", "1", ")", "\n", "\n", "for", "i", "in", "range", "(", "self", ".", "nv", ")", ":", "\n", "            ", "laplacian", "[", "i", ",", ":", "]", "/=", "laplacian", "[", "i", ",", "i", "]", "\n", "\n", "", "self", ".", "register_buffer", "(", "'laplacian'", ",", "torch", ".", "from_numpy", "(", "laplacian", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.LaplacianLoss.forward": [[130, 139], ["x.pow().mean.pow().mean.size", "torch.matmul", "torch.matmul", "torch.matmul", "torch.matmul", "tuple", "x.pow().mean.pow().mean.pow().mean", "range", "x.pow().mean.pow().mean.pow", "x.pow().mean.pow().mean.sum", "x.pow().mean.pow().mean.ndimension"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "batch_size", "=", "x", ".", "size", "(", "0", ")", "\n", "x", "=", "torch", ".", "matmul", "(", "self", ".", "laplacian", ",", "x", ")", "\n", "dims", "=", "tuple", "(", "range", "(", "x", ".", "ndimension", "(", ")", ")", "[", "1", ":", "]", ")", "\n", "x", "=", "x", ".", "pow", "(", "2", ")", ".", "mean", "(", "dims", ")", "\n", "if", "self", ".", "average", ":", "\n", "            ", "return", "x", ".", "sum", "(", ")", "/", "batch_size", "\n", "", "else", ":", "\n", "            ", "return", "x", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.fmo_loss": [[52, 73], ["torch.zeros().to", "torch.zeros().to", "torch.zeros", "torch.zeros", "loss.batch_loss", "loss.iou_loss", "loss.batch_loss", "loss.iou_loss", "YM.max", "YpM.max"], "function", ["home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.batch_loss", "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.iou_loss", "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.batch_loss", "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.iou_loss"], ["", "", "def", "fmo_loss", "(", "Yp", ",", "Y", ",", "config", ")", ":", "\n", "    ", "YM", "=", "Y", "[", ":", ",", ":", ",", "-", "1", ":", ",", ":", ",", ":", "]", "\n", "YpM", "=", "Yp", "[", ":", ",", ":", ",", "-", "1", ":", ",", ":", ",", ":", "]", "\n", "YF", "=", "Y", "[", ":", ",", ":", ",", ":", "3", "]", "\n", "YpF", "=", "Yp", "[", ":", ",", ":", ",", ":", "3", "]", "\n", "YMb", "=", "(", "(", "YM", "+", "YpM", ")", ">", "0", ")", ".", "type", "(", "YpM", ".", "dtype", ")", "\n", "\n", "loss", "=", "torch", ".", "zeros", "(", "(", "YM", ".", "shape", "[", "0", "]", ",", "1", ")", ")", ".", "to", "(", "Y", ".", "device", ")", "\n", "if", "config", "[", "\"loss_mask_weight\"", "]", ">", "0", ":", "\n", "        ", "loss", "=", "loss", "+", "config", "[", "\"loss_mask_weight\"", "]", "*", "batch_loss", "(", "YpM", ",", "YM", ",", "YMb", ",", "do_mult", "=", "False", ")", "\n", "\n", "", "if", "config", "[", "\"loss_jointm_iou_weight\"", "]", ">", "0", ":", "\n", "        ", "loss", "=", "loss", "+", "config", "[", "\"loss_jointm_iou_weight\"", "]", "*", "iou_loss", "(", "YM", ".", "max", "(", "1", ")", "[", "0", "]", "[", ":", ",", "None", "]", ",", "YpM", ".", "max", "(", "1", ")", "[", "0", "]", "[", ":", ",", "None", "]", ")", "\n", "\n", "", "if", "config", "[", "\"loss_rgb_weight\"", "]", ">", "0", ":", "\n", "        ", "loss", "=", "loss", "+", "config", "[", "\"loss_rgb_weight\"", "]", "*", "batch_loss", "(", "YpF", ",", "YF", "*", "YM", ",", "YMb", "[", ":", ",", ":", ",", "[", "0", ",", "0", ",", "0", "]", "]", ",", "do_mult", "=", "False", ")", "\n", "\n", "", "if", "config", "[", "\"loss_iou_weight\"", "]", ">", "0", ":", "\n", "        ", "loss", "=", "loss", "+", "config", "[", "\"loss_iou_weight\"", "]", "*", "iou_loss", "(", "YM", ",", "YpM", ")", "\n", "\n", "", "return", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.iou_loss": [[74, 79], ["torch.sum", "torch.sum", "torch.sum", "torch.sum"], "function", ["None"], ["", "def", "iou_loss", "(", "YM", ",", "YpM", ")", ":", "\n", "    ", "A_inter_B", "=", "YM", "*", "YpM", "\n", "A_union_B", "=", "(", "YM", "+", "YpM", "-", "A_inter_B", ")", "\n", "iou", "=", "1", "-", "(", "torch", ".", "sum", "(", "A_inter_B", ",", "[", "2", ",", "3", ",", "4", "]", ")", "/", "torch", ".", "sum", "(", "A_union_B", ",", "[", "2", ",", "3", ",", "4", "]", ")", ")", ".", "mean", "(", "1", ")", "\n", "return", "iou", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.batch_loss": [[80, 90], ["len", "torch.L1Loss", "torch.L1Loss", "losses.sum", "YMb.sum", "losses.sum", "YMb.sum"], "function", ["None"], ["", "def", "batch_loss", "(", "YpM", ",", "YM", ",", "YMb", ",", "do_mult", "=", "True", ")", ":", "\n", "    ", "if", "do_mult", ":", "\n", "        ", "losses", "=", "nn", ".", "L1Loss", "(", "reduction", "=", "'none'", ")", "(", "YpM", "*", "YMb", ",", "YM", "*", "YMb", ")", "\n", "", "else", ":", "\n", "        ", "losses", "=", "nn", ".", "L1Loss", "(", "reduction", "=", "'none'", ")", "(", "YpM", ",", "YM", ")", "\n", "", "if", "len", "(", "losses", ".", "shape", ")", ">", "4", ":", "\n", "        ", "bloss", "=", "losses", ".", "sum", "(", "[", "1", ",", "2", ",", "3", ",", "4", "]", ")", "/", "YMb", ".", "sum", "(", "[", "1", ",", "2", ",", "3", ",", "4", "]", ")", "\n", "", "else", ":", "\n", "        ", "bloss", "=", "losses", ".", "sum", "(", "[", "1", ",", "2", ",", "3", "]", ")", "/", "(", "YMb", ".", "sum", "(", "[", "1", ",", "2", ",", "3", "]", ")", "+", "0.01", ")", "\n", "", "return", "bloss", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.fmo_model_loss": [[92, 104], ["Mask.type.type", "range", "loss.batch_loss", "model_loss_perframe.append", "batch_loss.item"], "function", ["home.repos.pwc.inspect_result.rozumden_motionfromblur.models.loss.batch_loss"], ["", "def", "fmo_model_loss", "(", "input_batch", ",", "renders", ",", "Mask", "=", "None", ")", ":", "\n", "    ", "expected", "=", "input_batch", "[", ":", ",", ":", ",", "3", ":", "]", "*", "(", "1", "-", "renders", "[", ":", ",", ":", ",", "3", ":", "]", ")", "+", "renders", "[", ":", ",", ":", ",", ":", "3", "]", "\n", "if", "Mask", "is", "None", ":", "\n", "        ", "Mask", "=", "renders", "[", ":", ",", ":", ",", "3", ":", "]", ">", "0.05", "\n", "", "Mask", "=", "Mask", ".", "type", "(", "renders", ".", "dtype", ")", "\n", "model_loss", "=", "0", "\n", "model_loss_perframe", "=", "[", "]", "\n", "for", "frmi", "in", "range", "(", "input_batch", ".", "shape", "[", "1", "]", ")", ":", "\n", "        ", "temp_loss", "=", "batch_loss", "(", "expected", "[", ":", ",", "frmi", "]", ",", "input_batch", "[", ":", ",", "frmi", ",", ":", "3", "]", ",", "Mask", "[", ":", ",", "frmi", "]", ")", "\n", "model_loss_perframe", ".", "append", "(", "temp_loss", ".", "item", "(", ")", ")", "\n", "model_loss", "=", "model_loss", "+", "temp_loss", "/", "input_batch", ".", "shape", "[", "1", "]", "\n", "", "return", "model_loss", ",", "model_loss_perframe", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.kaolin_wrapper.load_obj": [[4, 6], ["kaolin.io.obj.import_mesh"], "function", ["None"], ["def", "load_obj", "(", "path", ")", ":", "\n", "    ", "return", "kaolin", ".", "io", ".", "obj", ".", "import_mesh", "(", "path", ",", "with_materials", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.kaolin_wrapper.prepare_vertices": [[7, 14], ["kaolin.render.camera.rotate_translate_points", "kaolin.render.camera.perspective_camera", "kaolin.ops.mesh.index_vertices_by_faces", "kaolin.ops.mesh.index_vertices_by_faces", "kaolin.ops.mesh.face_normals"], "function", ["None"], ["", "def", "prepare_vertices", "(", "vertices", ",", "faces", ",", "camera_rot", ",", "camera_trans", ",", "camera_proj", ")", ":", "\n", "    ", "vertices_camera", "=", "kaolin", ".", "render", ".", "camera", ".", "rotate_translate_points", "(", "vertices", ",", "camera_rot", ",", "camera_trans", ")", "\n", "vertices_image", "=", "kaolin", ".", "render", ".", "camera", ".", "perspective_camera", "(", "vertices_camera", ",", "camera_proj", ")", "\n", "face_vertices_camera", "=", "kaolin", ".", "ops", ".", "mesh", ".", "index_vertices_by_faces", "(", "vertices_camera", ",", "faces", ")", "\n", "face_vertices_image", "=", "kaolin", ".", "ops", ".", "mesh", ".", "index_vertices_by_faces", "(", "vertices_image", ",", "faces", ")", "\n", "face_normals", "=", "kaolin", ".", "ops", ".", "mesh", ".", "face_normals", "(", "face_vertices_camera", ",", "unit", "=", "True", ")", "\n", "return", "face_vertices_camera", ",", "face_vertices_image", ",", "face_normals", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.kaolin_wrapper.write_obj_traj": [[15, 25], ["open", "open.write", "open.write", "range", "open.write", "open.close", "open.write", "len", "open.write"], "function", ["None"], ["", "def", "write_obj_traj", "(", "points", ",", "name", ")", ":", "\n", "\t", "file", "=", "open", "(", "name", ",", "\"w\"", ")", "\n", "file", ".", "write", "(", "\"o FMO\\n\"", ")", "\n", "for", "ver", "in", "points", ":", "\n", "\t\t", "file", ".", "write", "(", "\"v {:.6f} {:.6f} {:.6f} \\n\"", ".", "format", "(", "ver", "[", "0", "]", ",", "ver", "[", "1", "]", ",", "ver", "[", "2", "]", ")", ")", "\n", "", "file", ".", "write", "(", "\"l \"", ")", "\n", "for", "pi", "in", "range", "(", "len", "(", "points", ")", ")", ":", "\n", "\t\t", "file", ".", "write", "(", "\"{} \"", ".", "format", "(", "pi", "+", "1", ")", ")", "\n", "", "file", ".", "write", "(", "\"\\n\"", ")", "\n", "file", ".", "close", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.kaolin_wrapper.write_obj_traj_exp": [[26, 36], ["open", "open.write", "open.close", "open.write", "len", "open.write"], "function", ["None"], ["", "def", "write_obj_traj_exp", "(", "points", ",", "name", ")", ":", "\n", "\t", "file", "=", "open", "(", "name", ",", "\"w\"", ")", "\n", "file", ".", "write", "(", "\"o FMO\\n\"", ")", "\n", "for", "ver", "in", "points", ":", "\n", "\t\t", "file", ".", "write", "(", "\"v {:.6f} {:.6f} {:.6f} \\n\"", ".", "format", "(", "ver", "[", "0", "]", ",", "ver", "[", "1", "]", ",", "ver", "[", "2", "]", ")", ")", "\n", "", "pi", "=", "1", "\n", "while", "pi", "<=", "len", "(", "points", ")", ":", "\n", "\t\t", "file", ".", "write", "(", "\"l {} {}\\n\"", ".", "format", "(", "pi", ",", "pi", "+", "1", ")", ")", "\n", "pi", "+=", "2", "\n", "", "file", ".", "close", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rozumden_motionfromblur.models.kaolin_wrapper.write_obj_mesh": [[37, 56], ["open", "open.write", "open.write", "open.write", "open.write", "range", "open.close", "open.write", "open.write", "len", "open.write", "open.write"], "function", ["None"], ["", "def", "write_obj_mesh", "(", "vertices", ",", "faces", ",", "face_features", ",", "name", ")", ":", "\n", "\t", "file", "=", "open", "(", "name", ",", "\"w\"", ")", "\n", "file", ".", "write", "(", "\"mtllib model.mtl\\n\"", ")", "\n", "file", ".", "write", "(", "\"o FMO\\n\"", ")", "\n", "for", "ver", "in", "vertices", ":", "\n", "\t\t", "file", ".", "write", "(", "\"v {:.6f} {:.6f} {:.6f} \\n\"", ".", "format", "(", "ver", "[", "0", "]", ",", "ver", "[", "1", "]", ",", "ver", "[", "2", "]", ")", ")", "\n", "", "for", "ffeat", "in", "face_features", ":", "\n", "\t\t", "for", "feat", "in", "ffeat", ":", "\n", "\t\t\t", "if", "len", "(", "feat", ")", "==", "3", ":", "\n", "\t\t\t\t", "file", ".", "write", "(", "\"vt {:.6f} {:.6f} {:.6f} \\n\"", ".", "format", "(", "feat", "[", "0", "]", ",", "feat", "[", "1", "]", ",", "feat", "[", "2", "]", ")", ")", "\n", "", "else", ":", "\n", "\t\t\t\t", "file", ".", "write", "(", "\"vt {:.6f} {:.6f} \\n\"", ".", "format", "(", "feat", "[", "0", "]", ",", "feat", "[", "1", "]", ")", ")", "\n", "", "", "", "file", ".", "write", "(", "\"usemtl Material.002\\n\"", ")", "\n", "file", ".", "write", "(", "\"s 1\\n\"", ")", "\n", "for", "fi", "in", "range", "(", "faces", ".", "shape", "[", "0", "]", ")", ":", "\n", "\t\t", "fc", "=", "faces", "[", "fi", "]", "+", "1", "\n", "ti", "=", "3", "*", "fi", "+", "1", "\n", "file", ".", "write", "(", "\"f {}/{} {}/{} {}/{}\\n\"", ".", "format", "(", "fc", "[", "0", "]", ",", "ti", ",", "fc", "[", "1", "]", ",", "ti", "+", "1", ",", "fc", "[", "2", "]", ",", "ti", "+", "2", ")", ")", "\n", "", "file", ".", "close", "(", ")", "\n", "\n"]]}