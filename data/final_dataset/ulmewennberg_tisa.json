{"home.repos.pwc.inspect_result.ulmewennberg_tisa.model.tisa.Tisa.__init__": [[7, 22], ["torch.nn.Module.__init__", "torch.nn.Parameter", "torch.nn.Parameter", "torch.nn.Parameter", "tisa.Tisa._init_weights", "torch.Tensor", "torch.Tensor", "torch.Tensor"], "methods", ["home.repos.pwc.inspect_result.ulmewennberg_tisa.model.tisa.Tisa.__init__", "home.repos.pwc.inspect_result.ulmewennberg_tisa.model.tisa.Tisa._init_weights"], ["    ", "def", "__init__", "(", "self", ",", "num_attention_heads", ":", "int", "=", "12", ",", "num_kernels", ":", "int", "=", "5", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "num_attention_heads", "=", "num_attention_heads", "\n", "self", ".", "num_kernels", "=", "num_kernels", "\n", "\n", "self", ".", "kernel_offsets", "=", "nn", ".", "Parameter", "(", "\n", "torch", ".", "Tensor", "(", "self", ".", "num_kernels", ",", "self", ".", "num_attention_heads", ")", "\n", ")", "\n", "self", ".", "kernel_amplitudes", "=", "nn", ".", "Parameter", "(", "\n", "torch", ".", "Tensor", "(", "self", ".", "num_kernels", ",", "self", ".", "num_attention_heads", ")", "\n", ")", "\n", "self", ".", "kernel_sharpness", "=", "nn", ".", "Parameter", "(", "\n", "torch", ".", "Tensor", "(", "self", ".", "num_kernels", ",", "self", ".", "num_attention_heads", ")", "\n", ")", "\n", "self", ".", "_init_weights", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ulmewennberg_tisa.model.tisa.Tisa.create_relative_offsets": [[23, 27], ["torch.arange"], "methods", ["None"], ["", "def", "create_relative_offsets", "(", "self", ",", "seq_len", ":", "int", ")", ":", "\n", "        ", "\"\"\"Creates offsets for all the relative distances between\n        -seq_len + 1 to seq_len - 1.\"\"\"", "\n", "return", "torch", ".", "arange", "(", "-", "seq_len", ",", "seq_len", "+", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ulmewennberg_tisa.model.tisa.Tisa.compute_positional_scores": [[28, 40], ["tisa.Tisa.kernel_amplitudes.unsqueeze", "torch.exp", "torch.abs", "tisa.Tisa.kernel_sharpness.unsqueeze", "tisa.Tisa.kernel_offsets.unsqueeze"], "methods", ["None"], ["", "def", "compute_positional_scores", "(", "self", ",", "relative_offsets", ")", ":", "\n", "        ", "\"\"\"Takes seq_len and outputs position scores for each relative distance.\n        This implementation uses radial basis functions. Override this function to\n        use other scoring functions than the example in the paper.\"\"\"", "\n", "rbf_scores", "=", "(", "\n", "self", ".", "kernel_amplitudes", ".", "unsqueeze", "(", "-", "1", ")", "\n", "*", "torch", ".", "exp", "(", "\n", "-", "torch", ".", "abs", "(", "self", ".", "kernel_sharpness", ".", "unsqueeze", "(", "-", "1", ")", ")", "\n", "*", "(", "(", "self", ".", "kernel_offsets", ".", "unsqueeze", "(", "-", "1", ")", "-", "relative_offsets", ")", "**", "2", ")", "\n", ")", "\n", ")", ".", "sum", "(", "axis", "=", "0", ")", "\n", "return", "rbf_scores", "\n", "\n"]], "home.repos.pwc.inspect_result.ulmewennberg_tisa.model.tisa.Tisa.scores_to_toeplitz_matrix": [[41, 60], ["torch.take_along_dim().view", "torch.take_along_dim", "deformed_toeplitz.view", "torch.arange().view", "torch.arange", "torch.arange"], "methods", ["None"], ["", "def", "scores_to_toeplitz_matrix", "(", "self", ",", "positional_scores", ",", "seq_len", ":", "int", ")", ":", "\n", "        ", "\"\"\"Converts the TISA positional scores into the final matrix for the\n        self-attention equation. PRs with memory and/or speed optimizations are\n        welcome.\"\"\"", "\n", "deformed_toeplitz", "=", "(", "\n", "(", "\n", "(", "torch", ".", "arange", "(", "0", ",", "-", "(", "seq_len", "**", "2", ")", ",", "step", "=", "-", "1", ")", "+", "(", "seq_len", "-", "1", ")", ")", ".", "view", "(", "\n", "seq_len", ",", "seq_len", "\n", ")", "\n", "+", "(", "seq_len", "+", "1", ")", "*", "torch", ".", "arange", "(", "seq_len", ")", ".", "view", "(", "-", "1", ",", "1", ")", "\n", ")", "\n", ".", "view", "(", "-", "1", ")", "\n", ".", "long", "(", ")", "\n", ".", "to", "(", "device", "=", "positional_scores", ".", "device", ")", "\n", ")", "\n", "expanded_positional_scores", "=", "torch", ".", "take_along_dim", "(", "\n", "positional_scores", ",", "deformed_toeplitz", ".", "view", "(", "1", ",", "-", "1", ")", ",", "1", "\n", ")", ".", "view", "(", "self", ".", "num_attention_heads", ",", "seq_len", ",", "seq_len", ")", "\n", "return", "expanded_positional_scores", "\n", "\n"]], "home.repos.pwc.inspect_result.ulmewennberg_tisa.model.tisa.Tisa.forward": [[61, 73], ["tisa.Tisa.compute_positional_scores", "tisa.Tisa.scores_to_toeplitz_matrix", "torch.zeros", "tisa.Tisa.create_relative_offsets"], "methods", ["home.repos.pwc.inspect_result.ulmewennberg_tisa.model.tisa.Tisa.compute_positional_scores", "home.repos.pwc.inspect_result.ulmewennberg_tisa.model.tisa.Tisa.scores_to_toeplitz_matrix", "home.repos.pwc.inspect_result.ulmewennberg_tisa.model.tisa.Tisa.create_relative_offsets"], ["", "def", "forward", "(", "self", ",", "seq_len", ":", "int", ")", ":", "\n", "        ", "\"\"\"Computes the translation-invariant positional contribution to the\n        attention matrix in the self-attention module of transformer models.\"\"\"", "\n", "if", "not", "self", ".", "num_kernels", ":", "\n", "            ", "return", "torch", ".", "zeros", "(", "(", "self", ".", "num_attention_heads", ",", "seq_len", ",", "seq_len", ")", ")", "\n", "", "positional_scores_vector", "=", "self", ".", "compute_positional_scores", "(", "\n", "self", ".", "create_relative_offsets", "(", "seq_len", ")", "\n", ")", "\n", "positional_scores_matrix", "=", "self", ".", "scores_to_toeplitz_matrix", "(", "\n", "positional_scores_vector", ",", "seq_len", "\n", ")", "\n", "return", "positional_scores_matrix", "\n", "\n"]], "home.repos.pwc.inspect_result.ulmewennberg_tisa.model.tisa.Tisa.visualize": [[74, 90], ["tisa.Tisa.create_relative_offsets().detach().numpy", "tisa.Tisa.compute_positional_scores().detach().numpy", "plt.show", "list", "plt.plot", "range", "tisa.Tisa.create_relative_offsets().detach", "tisa.Tisa.compute_positional_scores().detach", "tisa.Tisa.create_relative_offsets", "tisa.Tisa.compute_positional_scores", "tisa.Tisa.create_relative_offsets"], "methods", ["home.repos.pwc.inspect_result.ulmewennberg_tisa.model.tisa.Tisa.create_relative_offsets", "home.repos.pwc.inspect_result.ulmewennberg_tisa.model.tisa.Tisa.compute_positional_scores", "home.repos.pwc.inspect_result.ulmewennberg_tisa.model.tisa.Tisa.create_relative_offsets"], ["", "def", "visualize", "(", "self", ",", "seq_len", ":", "int", "=", "10", ",", "attention_heads", "=", "None", ")", ":", "\n", "        ", "\"\"\"Visualizes the TISA interpretability by plotting position scores as\n        a function of relative distance for each attention head.\"\"\"", "\n", "if", "attention_heads", "is", "None", ":", "\n", "            ", "attention_heads", "=", "list", "(", "range", "(", "self", ".", "num_attention_heads", ")", ")", "\n", "", "import", "matplotlib", ".", "pyplot", "as", "plt", "\n", "\n", "x", "=", "self", ".", "create_relative_offsets", "(", "seq_len", ")", ".", "detach", "(", ")", ".", "numpy", "(", ")", "\n", "y", "=", "(", "\n", "self", ".", "compute_positional_scores", "(", "self", ".", "create_relative_offsets", "(", "seq_len", ")", ")", "\n", ".", "detach", "(", ")", "\n", ".", "numpy", "(", ")", "\n", ")", "\n", "for", "i", "in", "attention_heads", ":", "\n", "            ", "plt", ".", "plot", "(", "x", ",", "y", "[", "i", "]", ")", "\n", "", "plt", ".", "show", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.ulmewennberg_tisa.model.tisa.Tisa._init_weights": [[91, 103], ["torch.nn.init.normal_", "torch.nn.init.normal_", "torch.nn.init.normal_"], "methods", ["None"], ["", "def", "_init_weights", "(", "self", ")", ":", "\n", "        ", "\"\"\"Initialize the weights\"\"\"", "\n", "ampl_init_mean", "=", "0.1", "\n", "sharpness_init_mean", "=", "0.1", "\n", "torch", ".", "nn", ".", "init", ".", "normal_", "(", "self", ".", "kernel_offsets", ",", "mean", "=", "0.0", ",", "std", "=", "5.0", ")", "\n", "torch", ".", "nn", ".", "init", ".", "normal_", "(", "\n", "self", ".", "kernel_amplitudes", ",", "mean", "=", "ampl_init_mean", ",", "std", "=", "0.1", "*", "ampl_init_mean", "\n", ")", "\n", "torch", ".", "nn", ".", "init", ".", "normal_", "(", "\n", "self", ".", "kernel_sharpness", ",", "\n", "mean", "=", "sharpness_init_mean", ",", "\n", "std", "=", "0.1", "*", "sharpness_init_mean", ",", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.ulmewennberg_tisa.model.tisa.main": [[106, 110], ["tisa.Tisa", "Tisa.", "tisa.Tisa.visualize"], "function", ["home.repos.pwc.inspect_result.ulmewennberg_tisa.model.tisa.Tisa.visualize"], ["", "", "def", "main", "(", ")", ":", "\n", "    ", "tisa", "=", "Tisa", "(", ")", "\n", "tisa", "(", "20", ")", "\n", "tisa", ".", "visualize", "(", "seq_len", "=", "20", ")", "\n", "\n"]]}