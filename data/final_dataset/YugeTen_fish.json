{"home.repos.pwc.inspect_result.YugeTen_fish.src.main.pretrain": [[88, 123], ["collections.defaultdict", "int", "tqdm.tqdm", "range", "tqdm.tqdm.close", "model.load_state_dict", "print", "numpy.ceil", "enumerate", "torch.load", "torch.load", "model.train", "utils.unpack_data", "optimiserC.zero_grad", "model", "criterion", "criterion.backward", "optimiserC.step", "tqdm.tqdm.set_description", "tqdm.tqdm.update", "len", "main.test", "main.test", "utils.save_best_model", "main.test", "main.test", "utils.save_best_model"], "function", ["home.repos.pwc.inspect_result.YugeTen_fish.src.utils.unpack_data", "home.repos.pwc.inspect_result.YugeTen_fish.src.main.test", "home.repos.pwc.inspect_result.YugeTen_fish.src.main.test", "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.save_best_model", "home.repos.pwc.inspect_result.YugeTen_fish.src.main.test", "home.repos.pwc.inspect_result.YugeTen_fish.src.main.test", "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.save_best_model"], ["def", "pretrain", "(", "train_loader", ",", "pretrain_iters", ")", ":", "\n", "    ", "aggP", "=", "defaultdict", "(", "list", ")", "\n", "aggP", "[", "'val_stat'", "]", "=", "[", "0.", "]", "\n", "\n", "n_iters", "=", "0", "\n", "pretrain_epochs", "=", "int", "(", "np", ".", "ceil", "(", "pretrain_iters", "/", "len", "(", "train_loader", ")", ")", ")", "\n", "pbar", "=", "tqdm", ".", "tqdm", "(", "total", "=", "pretrain_iters", ")", "\n", "for", "epoch", "in", "range", "(", "pretrain_epochs", ")", ":", "\n", "        ", "for", "i", ",", "data", "in", "enumerate", "(", "train_loader", ")", ":", "\n", "            ", "model", ".", "train", "(", ")", "\n", "# get the inputs", "\n", "x", ",", "y", "=", "unpack_data", "(", "data", ",", "device", ")", "\n", "optimiserC", ".", "zero_grad", "(", ")", "\n", "y_hat", "=", "model", "(", "x", ")", "\n", "loss", "=", "criterion", "(", "y_hat", ",", "y", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "optimiserC", ".", "step", "(", ")", "\n", "n_iters", "+=", "1", "\n", "# display progress", "\n", "pbar", ".", "set_description", "(", "f\"Pretrain {n_iters}/{pretrain_iters} iters\"", ")", "\n", "pbar", ".", "update", "(", "1", ")", "\n", "if", "(", "i", "+", "1", ")", "%", "args", ".", "print_iters", "==", "0", "and", "args", ".", "print_iters", "!=", "-", "1", ":", "\n", "                ", "test", "(", "val_loader", ",", "aggP", ",", "loader_type", "=", "'val'", ",", "verbose", "=", "False", ")", "\n", "test", "(", "test_loader", ",", "aggP", ",", "loader_type", "=", "'test'", ",", "verbose", "=", "False", ")", "\n", "save_best_model", "(", "model", ",", "runPath", ",", "aggP", ",", "args", ")", "\n", "\n", "", "if", "n_iters", "==", "pretrain_iters", ":", "\n", "                ", "test", "(", "val_loader", ",", "aggP", ",", "loader_type", "=", "'val'", ",", "verbose", "=", "False", ")", "\n", "test", "(", "test_loader", ",", "aggP", ",", "loader_type", "=", "'test'", ",", "verbose", "=", "False", ")", "\n", "save_best_model", "(", "model", ",", "runPath", ",", "aggP", ",", "args", ")", "\n", "break", "\n", "", "", "", "pbar", ".", "close", "(", ")", "\n", "\n", "model", ".", "load_state_dict", "(", "torch", ".", "load", "(", "runPath", "+", "'/model.rar'", ")", ")", "\n", "print", "(", "'Finished ERM pre-training!'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.main.train_erm": [[124, 147], ["len", "print", "enumerate", "model.train", "utils.unpack_data", "optimiserC.zero_grad", "model", "criterion", "criterion.backward", "optimiserC.step", "criterion.item", "agg[].append", "agg[].append", "print", "main.test", "main.test", "utils.save_best_model"], "function", ["home.repos.pwc.inspect_result.YugeTen_fish.src.utils.unpack_data", "home.repos.pwc.inspect_result.YugeTen_fish.src.main.test", "home.repos.pwc.inspect_result.YugeTen_fish.src.main.test", "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.save_best_model"], ["", "def", "train_erm", "(", "train_loader", ",", "epoch", ",", "agg", ")", ":", "\n", "    ", "running_loss", "=", "0", "\n", "total_iters", "=", "len", "(", "train_loader", ")", "\n", "print", "(", "'\\n====> Epoch: {:03d} '", ".", "format", "(", "epoch", ")", ")", "\n", "for", "i", ",", "data", "in", "enumerate", "(", "train_loader", ")", ":", "\n", "        ", "model", ".", "train", "(", ")", "\n", "# get the inputs", "\n", "x", ",", "y", "=", "unpack_data", "(", "data", ",", "device", ")", "\n", "optimiserC", ".", "zero_grad", "(", ")", "\n", "y_hat", "=", "model", "(", "x", ")", "\n", "loss", "=", "criterion", "(", "y_hat", ",", "y", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "optimiserC", ".", "step", "(", ")", "\n", "running_loss", "+=", "loss", ".", "item", "(", ")", "\n", "# print statistics", "\n", "if", "(", "i", "+", "1", ")", "%", "args", ".", "print_iters", "==", "0", "and", "args", ".", "print_iters", "!=", "-", "1", "and", "args", ".", "algorithm", "!=", "'fish'", ":", "\n", "            ", "agg", "[", "'train_loss'", "]", ".", "append", "(", "running_loss", "/", "args", ".", "print_iters", ")", "\n", "agg", "[", "'train_iters'", "]", ".", "append", "(", "i", "+", "1", "+", "epoch", "*", "total_iters", ")", "\n", "print", "(", "'iteration {:05d}/{:d}: loss: {:6.3f}'", ".", "format", "(", "i", "+", "1", ",", "total_iters", ",", "running_loss", "/", "args", ".", "print_iters", ")", ")", "\n", "test", "(", "val_loader", ",", "agg", ",", "loader_type", "=", "'val'", ")", "\n", "test", "(", "test_loader", ",", "agg", ",", "loader_type", "=", "'test'", ")", "\n", "running_loss", "=", "0.0", "\n", "save_best_model", "(", "model", ",", "runPath", ",", "agg", ",", "args", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.main.train_fish": [[149, 193], ["model.train", "train_loader.dataset.reset_batch", "print", "sum", "utils.sample_domains().tolist", "copy.deepcopy", "copy.deepcopy.train", "opt", "opt.state_dict", "utils.fish_step", "model.reset_weights", "copy.deepcopy.parameters", "opt.load_state_dict", "train_loader.dataset.get_batch", "utils.unpack_data", "opt.zero_grad", "copy.deepcopy.", "criterion", "criterion.backward", "opt.step", "print", "main.test", "main.test", "model.train", "utils.save_best_model", "utils.sample_domains", "model.state_dict", "copy.deepcopy.state_dict", "train_loader.dataset.batches_left.values"], "function", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.reset_batch", "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.fish_step", "home.repos.pwc.inspect_result.YugeTen_fish.models.amazon.Model.reset_weights", "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.get_batch", "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.unpack_data", "home.repos.pwc.inspect_result.YugeTen_fish.src.main.test", "home.repos.pwc.inspect_result.YugeTen_fish.src.main.test", "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.save_best_model", "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.sample_domains"], ["", "", "", "def", "train_fish", "(", "train_loader", ",", "epoch", ",", "agg", ")", ":", "\n", "    ", "model", ".", "train", "(", ")", "\n", "train_loader", ".", "dataset", ".", "reset_batch", "(", ")", "\n", "i", "=", "0", "\n", "print", "(", "'\\n====> Epoch: {:03d} '", ".", "format", "(", "epoch", ")", ")", "\n", "opt_inner_pre", "=", "None", "\n", "\n", "while", "sum", "(", "[", "l", ">", "1", "for", "l", "in", "train_loader", ".", "dataset", ".", "batches_left", ".", "values", "(", ")", "]", ")", ">=", "args", ".", "meta_steps", ":", "\n", "        ", "i", "+=", "1", "\n", "# sample `meta_steps` number of domains to use for the inner loop", "\n", "domains", "=", "sample_domains", "(", "train_loader", ",", "args", ".", "meta_steps", ",", "args", ".", "stratified", ")", ".", "tolist", "(", ")", "\n", "# prepare model for inner loop update", "\n", "model_inner", "=", "copy", ".", "deepcopy", "(", "model", ")", "\n", "model_inner", ".", "train", "(", ")", "\n", "opt_inner", "=", "opt", "(", "model_inner", ".", "parameters", "(", ")", ",", "**", "args", ".", "optimiser_args", ")", "\n", "if", "opt_inner_pre", "is", "not", "None", "and", "args", ".", "reload_inner_optim", ":", "\n", "            ", "opt_inner", ".", "load_state_dict", "(", "opt_inner_pre", ")", "\n", "# inner loop update", "\n", "", "for", "domain", "in", "domains", ":", "\n", "            ", "data", "=", "train_loader", ".", "dataset", ".", "get_batch", "(", "domain", ")", "\n", "x", ",", "y", "=", "unpack_data", "(", "data", ",", "device", ")", "\n", "opt_inner", ".", "zero_grad", "(", ")", "\n", "y_hat", "=", "model_inner", "(", "x", ")", "\n", "loss", "=", "criterion", "(", "y_hat", ",", "y", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "opt_inner", ".", "step", "(", ")", "\n", "", "opt_inner_pre", "=", "opt_inner", ".", "state_dict", "(", ")", "\n", "# fish update", "\n", "meta_weights", "=", "fish_step", "(", "meta_weights", "=", "model", ".", "state_dict", "(", ")", ",", "\n", "inner_weights", "=", "model_inner", ".", "state_dict", "(", ")", ",", "\n", "meta_lr", "=", "args", ".", "meta_lr", "/", "args", ".", "meta_steps", ")", "\n", "model", ".", "reset_weights", "(", "meta_weights", ")", "\n", "# log the number of batches left for each domain", "\n", "for", "domain", "in", "domains", ":", "\n", "            ", "train_loader", ".", "dataset", ".", "batches_left", "[", "domain", "]", "=", "train_loader", ".", "dataset", ".", "batches_left", "[", "domain", "]", "-", "1", "if", "train_loader", ".", "dataset", ".", "batches_left", "[", "domain", "]", ">", "1", "else", "1", "\n", "\n", "", "if", "(", "i", "+", "1", ")", "%", "args", ".", "print_iters", "==", "0", "and", "args", ".", "print_iters", "!=", "-", "1", ":", "\n", "            ", "print", "(", "f'iteration {(i + 1):05d}: '", ")", "\n", "test", "(", "val_loader", ",", "agg", ",", "loader_type", "=", "'val'", ")", "\n", "test", "(", "test_loader", ",", "agg", ",", "loader_type", "=", "'test'", ")", "\n", "model", ".", "train", "(", ")", "\n", "save_best_model", "(", "model", ",", "runPath", ",", "agg", ",", "args", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.main.test": [[195, 223], ["model.eval", "torch.no_grad", "torch.no_grad", "enumerate", "test_loader.dataset.eval", "agg[].append", "model", "ys.append", "yhats.append", "metas.append", "predict_fn", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "ypreds.cpu", "ys.cpu", "print", "x.to", "y.to", "torch.cat", "torch.cat", "open", "csv.writer", "csv.writer.writerows", "ypreds.unsqueeze().cpu().tolist", "ypreds.unsqueeze().cpu", "ypreds.unsqueeze"], "function", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.eval", "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.eval"], ["", "", "", "def", "test", "(", "test_loader", ",", "agg", ",", "loader_type", "=", "'test'", ",", "verbose", "=", "True", ",", "save_ypred", "=", "False", ")", ":", "\n", "    ", "model", ".", "eval", "(", ")", "\n", "yhats", ",", "ys", ",", "metas", "=", "[", "]", ",", "[", "]", ",", "[", "]", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "        ", "for", "i", ",", "(", "x", ",", "y", ",", "meta", ")", "in", "enumerate", "(", "test_loader", ")", ":", "\n", "# get the inputs", "\n", "            ", "x", ",", "y", "=", "x", ".", "to", "(", "device", ")", ",", "y", ".", "to", "(", "device", ")", "\n", "y_hat", "=", "model", "(", "x", ")", "\n", "ys", ".", "append", "(", "y", ")", "\n", "yhats", ".", "append", "(", "y_hat", ")", "\n", "metas", ".", "append", "(", "meta", ")", "\n", "\n", "", "ypreds", ",", "ys", ",", "metas", "=", "predict_fn", "(", "torch", ".", "cat", "(", "yhats", ")", ")", ",", "torch", ".", "cat", "(", "ys", ")", ",", "torch", ".", "cat", "(", "metas", ")", "\n", "if", "save_ypred", ":", "\n", "            ", "if", "args", ".", "dataset", "==", "'poverty'", ":", "\n", "                ", "save_name", "=", "f\"{args.dataset}_split:{loader_type}_fold:\"", "f\"{['A', 'B', 'C', 'D', 'E'][args.seed]}\"", "f\"_epoch:best_pred.csv\"", "\n", "", "else", ":", "\n", "                ", "save_name", "=", "f\"{args.dataset}_split:{loader_type}_seed:\"", "f\"{args.seed}_epoch:best_pred.csv\"", "\n", "", "with", "open", "(", "f\"{runPath}/{save_name}\"", ",", "'w'", ")", "as", "f", ":", "\n", "                ", "writer", "=", "csv", ".", "writer", "(", "f", ")", "\n", "writer", ".", "writerows", "(", "ypreds", ".", "unsqueeze", "(", "1", ")", ".", "cpu", "(", ")", ".", "tolist", "(", ")", ")", "\n", "", "", "test_val", "=", "test_loader", ".", "dataset", ".", "eval", "(", "ypreds", ".", "cpu", "(", ")", ",", "ys", ".", "cpu", "(", ")", ",", "metas", ")", "\n", "agg", "[", "f'{loader_type}_stat'", "]", ".", "append", "(", "test_val", "[", "0", "]", "[", "args", ".", "selection_metric", "]", ")", "\n", "if", "verbose", ":", "\n", "            ", "print", "(", "f\"=============== {loader_type} ===============\\n{test_val[-1]}\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.Logger.__init__": [[16, 19], ["open"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "filename", ")", ":", "\n", "        ", "self", ".", "terminal", "=", "sys", ".", "stdout", "\n", "self", ".", "log", "=", "open", "(", "filename", ",", "\"a\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.Logger.write": [[20, 24], ["utils.Logger.terminal.write", "utils.Logger.log.write", "utils.Logger.log.flush"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.src.utils.Logger.write", "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.Logger.write", "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.Logger.flush"], ["", "def", "write", "(", "self", ",", "message", ")", ":", "\n", "        ", "self", ".", "terminal", ".", "write", "(", "message", ")", "\n", "self", ".", "log", ".", "write", "(", "message", ")", "\n", "self", ".", "log", ".", "flush", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.Logger.flush": [[25, 30], ["None"], "methods", ["None"], ["", "def", "flush", "(", "self", ")", ":", "\n", "# this flush method is needed for python 3 compatibility.", "\n", "# this handles the flush command by doing nothing.", "\n", "# you might want to specify some extra behavior here.", "\n", "        ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.Subset.__init__": [[63, 73], ["hasattr"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "dataset", ",", "indices", ")", ":", "\n", "        ", "self", ".", "dataset", "=", "dataset", "\n", "self", ".", "indices", "=", "indices", "\n", "if", "hasattr", "(", "dataset", ",", "'images'", ")", ":", "\n", "            ", "self", ".", "images", "=", "dataset", ".", "images", "[", "indices", "]", "\n", "self", ".", "latents", "=", "dataset", ".", "latents", "[", "indices", ",", ":", "]", "\n", "", "else", ":", "\n", "            ", "self", ".", "targets", "=", "dataset", ".", "targets", "[", "indices", "]", "\n", "self", ".", "writers", "=", "dataset", ".", "domains", "[", "indices", "]", "\n", "self", ".", "data", "=", "[", "dataset", ".", "data", "[", "i", "]", "for", "i", "in", "indices", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.Subset.__getitem__": [[74, 76], ["None"], "methods", ["None"], ["", "", "def", "__getitem__", "(", "self", ",", "idx", ")", ":", "\n", "        ", "return", "self", ".", "dataset", "[", "self", ".", "indices", "[", "idx", "]", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.Subset.__len__": [[77, 79], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "indices", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.ParamDict.__init__": [[140, 142], ["collections.OrderedDict.__init__"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__"], ["def", "__init__", "(", "self", ",", "*", "args", ",", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "*", "args", ",", "*", "kwargs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.ParamDict._prototype": [[143, 150], ["isinstance", "utils.ParamDict", "isinstance", "utils.ParamDict", "op", "utils.ParamDict.items", "op"], "methods", ["None"], ["", "def", "_prototype", "(", "self", ",", "other", ",", "op", ")", ":", "\n", "        ", "if", "isinstance", "(", "other", ",", "Number", ")", ":", "\n", "            ", "return", "ParamDict", "(", "{", "k", ":", "op", "(", "v", ",", "other", ")", "for", "k", ",", "v", "in", "self", ".", "items", "(", ")", "}", ")", "\n", "", "elif", "isinstance", "(", "other", ",", "dict", ")", ":", "\n", "            ", "return", "ParamDict", "(", "{", "k", ":", "op", "(", "self", "[", "k", "]", ",", "other", "[", "k", "]", ")", "for", "k", "in", "self", "}", ")", "\n", "", "else", ":", "\n", "            ", "raise", "NotImplementedError", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.ParamDict.__add__": [[151, 153], ["utils.ParamDict._prototype"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.src.utils.ParamDict._prototype"], ["", "", "def", "__add__", "(", "self", ",", "other", ")", ":", "\n", "        ", "return", "self", ".", "_prototype", "(", "other", ",", "operator", ".", "add", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.ParamDict.__rmul__": [[154, 156], ["utils.ParamDict._prototype"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.src.utils.ParamDict._prototype"], ["", "def", "__rmul__", "(", "self", ",", "other", ")", ":", "\n", "        ", "return", "self", ".", "_prototype", "(", "other", ",", "operator", ".", "mul", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.ParamDict.__neg__": [[159, 161], ["utils.ParamDict", "utils.ParamDict.items"], "methods", ["None"], ["def", "__neg__", "(", "self", ")", ":", "\n", "        ", "return", "ParamDict", "(", "{", "k", ":", "-", "v", "for", "k", ",", "v", "in", "self", ".", "items", "(", ")", "}", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.ParamDict.__rsub__": [[162, 165], ["utils.ParamDict.__add__", "other.__neg__"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.src.utils.ParamDict.__add__", "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.ParamDict.__neg__"], ["", "def", "__rsub__", "(", "self", ",", "other", ")", ":", "\n", "# a- b := a + (-b)", "\n", "        ", "return", "self", ".", "__add__", "(", "other", ".", "__neg__", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.ParamDict.__truediv__": [[168, 170], ["utils.ParamDict._prototype"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.src.utils.ParamDict._prototype"], ["def", "__truediv__", "(", "self", ",", "other", ")", ":", "\n", "        ", "return", "self", ".", "_prototype", "(", "other", ",", "operator", ".", "truediv", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.save_vars": [[33, 41], ["os.path.exists", "torch.save", "shutil.copyfile"], "function", ["None"], ["", "", "def", "save_vars", "(", "vs", ",", "filepath", ")", ":", "\n", "    ", "\"\"\"\n    Saves variables to the given filepath in a safe manner.\n    \"\"\"", "\n", "filepath", "=", "filepath", "\n", "if", "os", ".", "path", ".", "exists", "(", "filepath", ")", ":", "\n", "        ", "shutil", ".", "copyfile", "(", "filepath", ",", "'{}.old'", ".", "format", "(", "filepath", ")", ")", "\n", "", "torch", ".", "save", "(", "vs", ",", "filepath", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.save_model": [[43, 49], ["utils.save_vars", "model.state_dict"], "function", ["home.repos.pwc.inspect_result.YugeTen_fish.src.utils.save_vars"], ["", "def", "save_model", "(", "model", ",", "filepath", ")", ":", "\n", "    ", "\"\"\"\n    To load a saved model, simply use\n    `model.load_state_dict(torch.load('path-to-saved-model'))`.\n    \"\"\"", "\n", "save_vars", "(", "model", ".", "state_dict", "(", ")", ",", "filepath", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.unpack_data": [[51, 53], ["data[].to", "data[].to"], "function", ["None"], ["", "def", "unpack_data", "(", "data", ",", "device", ")", ":", "\n", "    ", "return", "data", "[", "0", "]", ".", "to", "(", "device", ")", ",", "data", "[", "1", "]", ".", "to", "(", "device", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.sample_domains": [[81, 100], ["train_loader.dataset.batches_left.values", "range", "torch.tensor", "len", "random.choices", "Ls.append", "Ls.append", "len", "max", "min", "indices.append"], "function", ["None"], ["", "", "def", "sample_domains", "(", "train_loader", ",", "N", "=", "1", ",", "stratified", "=", "True", ")", ":", "\n", "    ", "\"\"\"\n    Sample N domains available in the train loader.\n    \"\"\"", "\n", "Ls", "=", "[", "]", "\n", "for", "tl", "in", "train_loader", ".", "dataset", ".", "batches_left", ".", "values", "(", ")", ":", "\n", "        ", "Ls", ".", "append", "(", "max", "(", "tl", ",", "0", ")", ")", "if", "stratified", "else", "Ls", ".", "append", "(", "min", "(", "tl", ",", "1", ")", ")", "\n", "\n", "", "positions", "=", "range", "(", "len", "(", "Ls", ")", ")", "\n", "indices", "=", "[", "]", "\n", "while", "True", ":", "\n", "        ", "needed", "=", "N", "-", "len", "(", "indices", ")", "\n", "if", "not", "needed", ":", "\n", "            ", "break", "\n", "", "for", "i", "in", "random", ".", "choices", "(", "positions", ",", "Ls", ",", "k", "=", "needed", ")", ":", "\n", "            ", "if", "Ls", "[", "i", "]", ":", "\n", "                ", "Ls", "[", "i", "]", "=", "0.0", "\n", "indices", ".", "append", "(", "i", ")", "\n", "", "", "", "return", "torch", ".", "tensor", "(", "indices", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.save_best_model": [[102, 106], ["utils.save_model", "utils.save_vars", "max"], "function", ["home.repos.pwc.inspect_result.YugeTen_fish.src.utils.save_model", "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.save_vars"], ["", "def", "save_best_model", "(", "model", ",", "runPath", ",", "agg", ",", "args", ")", ":", "\n", "    ", "if", "args", ".", "dataset", "==", "'fmow'", "or", "agg", "[", "'val_stat'", "]", "[", "-", "1", "]", ">", "max", "(", "agg", "[", "'val_stat'", "]", "[", ":", "-", "1", "]", ")", ":", "\n", "        ", "save_model", "(", "model", ",", "f'{runPath}/model.rar'", ")", "\n", "save_vars", "(", "agg", ",", "f'{runPath}/losses.rar'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.single_class_predict_fn": [[108, 111], ["torch.max"], "function", ["None"], ["", "", "def", "single_class_predict_fn", "(", "yhat", ")", ":", "\n", "    ", "_", ",", "predicted", "=", "torch", ".", "max", "(", "yhat", ".", "data", ",", "1", ")", "\n", "return", "predicted", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.return_predict_fn": [[113, 123], ["None"], "function", ["None"], ["", "def", "return_predict_fn", "(", "dataset", ")", ":", "\n", "    ", "return", "{", "\n", "'fmow'", ":", "single_class_predict_fn", ",", "\n", "'camelyon'", ":", "single_class_predict_fn", ",", "\n", "'poverty'", ":", "lambda", "yhat", ":", "yhat", ",", "\n", "'iwildcam'", ":", "single_class_predict_fn", ",", "\n", "'amazon'", ":", "single_class_predict_fn", ",", "\n", "'civil'", ":", "single_class_predict_fn", ",", "\n", "'cdsprites'", ":", "single_class_predict_fn", "\n", "}", "[", "dataset", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.return_criterion": [[124, 134], ["torch.nn.CrossEntropyLoss", "torch.nn.CrossEntropyLoss", "torch.nn.MSELoss", "torch.nn.CrossEntropyLoss", "torch.nn.CrossEntropyLoss", "torch.nn.CrossEntropyLoss", "torch.nn.CrossEntropyLoss"], "function", ["None"], ["", "def", "return_criterion", "(", "dataset", ")", ":", "\n", "    ", "return", "{", "\n", "'fmow'", ":", "nn", ".", "CrossEntropyLoss", "(", ")", ",", "\n", "'camelyon'", ":", "nn", ".", "CrossEntropyLoss", "(", ")", ",", "\n", "'poverty'", ":", "nn", ".", "MSELoss", "(", ")", ",", "\n", "'iwildcam'", ":", "nn", ".", "CrossEntropyLoss", "(", ")", ",", "\n", "'amazon'", ":", "nn", ".", "CrossEntropyLoss", "(", ")", ",", "\n", "'civil'", ":", "nn", ".", "CrossEntropyLoss", "(", ")", ",", "\n", "'cdsprites'", ":", "nn", ".", "CrossEntropyLoss", "(", ")", ",", "\n", "}", "[", "dataset", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.src.utils.fish_step": [[172, 176], ["utils.ParamDict", "utils.ParamDict", "sum"], "function", ["None"], ["", "", "def", "fish_step", "(", "meta_weights", ",", "inner_weights", ",", "meta_lr", ")", ":", "\n", "    ", "meta_weights", ",", "weights", "=", "ParamDict", "(", "meta_weights", ")", ",", "ParamDict", "(", "inner_weights", ")", "\n", "meta_weights", "+=", "meta_lr", "*", "sum", "(", "[", "weights", "-", "meta_weights", "]", ",", "0", "*", "meta_weights", ")", "\n", "return", "meta_weights", "", "", ""]], "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.BasicBlock.__init__": [[21, 38], ["torch.Module.__init__", "resnet_multispectral.conv3x3", "norm_layer", "torch.ReLU", "torch.ReLU", "resnet_multispectral.conv3x3", "norm_layer", "ValueError", "NotImplementedError"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__", "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.conv3x3", "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.conv3x3"], ["def", "__init__", "(", "self", ",", "inplanes", ",", "planes", ",", "stride", "=", "1", ",", "downsample", "=", "None", ",", "groups", "=", "1", ",", "\n", "base_width", "=", "64", ",", "dilation", "=", "1", ",", "norm_layer", "=", "None", ")", ":", "\n", "        ", "super", "(", "BasicBlock", ",", "self", ")", ".", "__init__", "(", ")", "\n", "if", "norm_layer", "is", "None", ":", "\n", "            ", "norm_layer", "=", "nn", ".", "BatchNorm2d", "\n", "", "if", "groups", "!=", "1", "or", "base_width", "!=", "64", ":", "\n", "            ", "raise", "ValueError", "(", "'BasicBlock only supports groups=1 and base_width=64'", ")", "\n", "", "if", "dilation", ">", "1", ":", "\n", "            ", "raise", "NotImplementedError", "(", "\"Dilation > 1 not supported in BasicBlock\"", ")", "\n", "# Both self.conv1 and self.downsample layers downsample the input when stride != 1", "\n", "", "self", ".", "conv1", "=", "conv3x3", "(", "inplanes", ",", "planes", ",", "stride", ")", "\n", "self", ".", "bn1", "=", "norm_layer", "(", "planes", ")", "\n", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "self", ".", "conv2", "=", "conv3x3", "(", "planes", ",", "planes", ")", "\n", "self", ".", "bn2", "=", "norm_layer", "(", "planes", ")", "\n", "self", ".", "downsample", "=", "downsample", "\n", "self", ".", "stride", "=", "stride", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.BasicBlock.forward": [[39, 56], ["resnet_multispectral.BasicBlock.conv1", "resnet_multispectral.BasicBlock.bn1", "resnet_multispectral.BasicBlock.relu", "resnet_multispectral.BasicBlock.conv2", "resnet_multispectral.BasicBlock.bn2", "resnet_multispectral.BasicBlock.relu", "resnet_multispectral.BasicBlock.downsample"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "identity", "=", "x", "\n", "\n", "out", "=", "self", ".", "conv1", "(", "x", ")", "\n", "out", "=", "self", ".", "bn1", "(", "out", ")", "\n", "out", "=", "self", ".", "relu", "(", "out", ")", "\n", "\n", "out", "=", "self", ".", "conv2", "(", "out", ")", "\n", "out", "=", "self", ".", "bn2", "(", "out", ")", "\n", "\n", "if", "self", ".", "downsample", "is", "not", "None", ":", "\n", "            ", "identity", "=", "self", ".", "downsample", "(", "x", ")", "\n", "\n", "", "out", "+=", "identity", "\n", "out", "=", "self", ".", "relu", "(", "out", ")", "\n", "\n", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.Bottleneck.__init__": [[62, 78], ["torch.Module.__init__", "resnet_multispectral.conv1x1", "norm_layer", "resnet_multispectral.conv3x3", "norm_layer", "resnet_multispectral.conv1x1", "norm_layer", "torch.ReLU", "torch.ReLU", "int"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__", "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.conv1x1", "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.conv3x3", "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.conv1x1"], ["def", "__init__", "(", "self", ",", "inplanes", ",", "planes", ",", "stride", "=", "1", ",", "downsample", "=", "None", ",", "groups", "=", "1", ",", "\n", "base_width", "=", "64", ",", "dilation", "=", "1", ",", "norm_layer", "=", "None", ")", ":", "\n", "        ", "super", "(", "Bottleneck", ",", "self", ")", ".", "__init__", "(", ")", "\n", "if", "norm_layer", "is", "None", ":", "\n", "            ", "norm_layer", "=", "nn", ".", "BatchNorm2d", "\n", "", "width", "=", "int", "(", "planes", "*", "(", "base_width", "/", "64.", ")", ")", "*", "groups", "\n", "# Both self.conv2 and self.downsample layers downsample the input when stride != 1", "\n", "self", ".", "conv1", "=", "conv1x1", "(", "inplanes", ",", "width", ")", "\n", "self", ".", "bn1", "=", "norm_layer", "(", "width", ")", "\n", "self", ".", "conv2", "=", "conv3x3", "(", "width", ",", "width", ",", "stride", ",", "groups", ",", "dilation", ")", "\n", "self", ".", "bn2", "=", "norm_layer", "(", "width", ")", "\n", "self", ".", "conv3", "=", "conv1x1", "(", "width", ",", "planes", "*", "self", ".", "expansion", ")", "\n", "self", ".", "bn3", "=", "norm_layer", "(", "planes", "*", "self", ".", "expansion", ")", "\n", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "self", ".", "downsample", "=", "downsample", "\n", "self", ".", "stride", "=", "stride", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.Bottleneck.forward": [[79, 100], ["resnet_multispectral.Bottleneck.conv1", "resnet_multispectral.Bottleneck.bn1", "resnet_multispectral.Bottleneck.relu", "resnet_multispectral.Bottleneck.conv2", "resnet_multispectral.Bottleneck.bn2", "resnet_multispectral.Bottleneck.relu", "resnet_multispectral.Bottleneck.conv3", "resnet_multispectral.Bottleneck.bn3", "resnet_multispectral.Bottleneck.relu", "resnet_multispectral.Bottleneck.downsample"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "identity", "=", "x", "\n", "\n", "out", "=", "self", ".", "conv1", "(", "x", ")", "\n", "out", "=", "self", ".", "bn1", "(", "out", ")", "\n", "out", "=", "self", ".", "relu", "(", "out", ")", "\n", "\n", "out", "=", "self", ".", "conv2", "(", "out", ")", "\n", "out", "=", "self", ".", "bn2", "(", "out", ")", "\n", "out", "=", "self", ".", "relu", "(", "out", ")", "\n", "\n", "out", "=", "self", ".", "conv3", "(", "out", ")", "\n", "out", "=", "self", ".", "bn3", "(", "out", ")", "\n", "\n", "if", "self", ".", "downsample", "is", "not", "None", ":", "\n", "            ", "identity", "=", "self", ".", "downsample", "(", "x", ")", "\n", "\n", "", "out", "+=", "identity", "\n", "out", "=", "self", ".", "relu", "(", "out", ")", "\n", "\n", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.ResNet.__init__": [[104, 159], ["torch.Module.__init__", "torch.Conv2d", "torch.Conv2d", "norm_layer", "torch.ReLU", "torch.ReLU", "torch.MaxPool2d", "torch.MaxPool2d", "resnet_multispectral.ResNet._make_layer", "resnet_multispectral.ResNet._make_layer", "resnet_multispectral.ResNet._make_layer", "resnet_multispectral.ResNet._make_layer", "torch.AdaptiveAvgPool2d", "torch.AdaptiveAvgPool2d", "resnet_multispectral.ResNet.modules", "len", "ValueError", "torch.Linear", "torch.Linear", "isinstance", "resnet_multispectral.ResNet.modules", "torch.init.kaiming_normal_", "torch.init.kaiming_normal_", "isinstance", "isinstance", "torch.init.constant_", "torch.init.constant_", "torch.init.constant_", "torch.init.constant_", "torch.init.constant_", "torch.init.constant_", "isinstance", "torch.init.constant_", "torch.init.constant_"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__", "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.ResNet._make_layer", "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.ResNet._make_layer", "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.ResNet._make_layer", "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.ResNet._make_layer"], ["    ", "def", "__init__", "(", "self", ",", "block", ",", "layers", ",", "num_classes", "=", "1000", ",", "zero_init_residual", "=", "False", ",", "\n", "groups", "=", "1", ",", "width_per_group", "=", "64", ",", "replace_stride_with_dilation", "=", "None", ",", "\n", "norm_layer", "=", "None", ",", "num_channels", "=", "3", ")", ":", "\n", "        ", "super", "(", "ResNet", ",", "self", ")", ".", "__init__", "(", ")", "\n", "if", "norm_layer", "is", "None", ":", "\n", "            ", "norm_layer", "=", "nn", ".", "BatchNorm2d", "\n", "", "self", ".", "_norm_layer", "=", "norm_layer", "\n", "\n", "self", ".", "inplanes", "=", "64", "\n", "self", ".", "dilation", "=", "1", "\n", "if", "replace_stride_with_dilation", "is", "None", ":", "\n", "# each element in the tuple indicates if we should replace", "\n", "# the 2x2 stride with a dilated convolution instead", "\n", "            ", "replace_stride_with_dilation", "=", "[", "False", ",", "False", ",", "False", "]", "\n", "", "if", "len", "(", "replace_stride_with_dilation", ")", "!=", "3", ":", "\n", "            ", "raise", "ValueError", "(", "\"replace_stride_with_dilation should be None \"", "\n", "\"or a 3-element tuple, got {}\"", ".", "format", "(", "replace_stride_with_dilation", ")", ")", "\n", "", "self", ".", "groups", "=", "groups", "\n", "self", ".", "base_width", "=", "width_per_group", "\n", "self", ".", "conv1", "=", "nn", ".", "Conv2d", "(", "num_channels", ",", "self", ".", "inplanes", ",", "kernel_size", "=", "7", ",", "stride", "=", "2", ",", "padding", "=", "3", ",", "\n", "bias", "=", "False", ")", "\n", "self", ".", "bn1", "=", "norm_layer", "(", "self", ".", "inplanes", ")", "\n", "self", ".", "relu", "=", "nn", ".", "ReLU", "(", "inplace", "=", "True", ")", "\n", "self", ".", "maxpool", "=", "nn", ".", "MaxPool2d", "(", "kernel_size", "=", "3", ",", "stride", "=", "2", ",", "padding", "=", "1", ")", "\n", "self", ".", "layer1", "=", "self", ".", "_make_layer", "(", "block", ",", "64", ",", "layers", "[", "0", "]", ")", "\n", "self", ".", "layer2", "=", "self", ".", "_make_layer", "(", "block", ",", "128", ",", "layers", "[", "1", "]", ",", "stride", "=", "2", ",", "\n", "dilate", "=", "replace_stride_with_dilation", "[", "0", "]", ")", "\n", "self", ".", "layer3", "=", "self", ".", "_make_layer", "(", "block", ",", "256", ",", "layers", "[", "2", "]", ",", "stride", "=", "2", ",", "\n", "dilate", "=", "replace_stride_with_dilation", "[", "1", "]", ")", "\n", "self", ".", "layer4", "=", "self", ".", "_make_layer", "(", "block", ",", "512", ",", "layers", "[", "3", "]", ",", "stride", "=", "2", ",", "\n", "dilate", "=", "replace_stride_with_dilation", "[", "2", "]", ")", "\n", "self", ".", "avgpool", "=", "nn", ".", "AdaptiveAvgPool2d", "(", "(", "1", ",", "1", ")", ")", "\n", "if", "num_classes", "is", "not", "None", ":", "\n", "            ", "self", ".", "fc", "=", "nn", ".", "Linear", "(", "512", "*", "block", ".", "expansion", ",", "num_classes", ")", "\n", "self", ".", "d_out", "=", "num_classes", "\n", "", "else", ":", "\n", "            ", "self", ".", "fc", "=", "None", "\n", "self", ".", "d_out", "=", "512", "*", "block", ".", "expansion", "\n", "\n", "", "for", "m", "in", "self", ".", "modules", "(", ")", ":", "\n", "            ", "if", "isinstance", "(", "m", ",", "nn", ".", "Conv2d", ")", ":", "\n", "                ", "nn", ".", "init", ".", "kaiming_normal_", "(", "m", ".", "weight", ",", "mode", "=", "'fan_out'", ",", "nonlinearity", "=", "'relu'", ")", "\n", "", "elif", "isinstance", "(", "m", ",", "(", "nn", ".", "BatchNorm2d", ",", "nn", ".", "GroupNorm", ")", ")", ":", "\n", "                ", "nn", ".", "init", ".", "constant_", "(", "m", ".", "weight", ",", "1", ")", "\n", "nn", ".", "init", ".", "constant_", "(", "m", ".", "bias", ",", "0", ")", "\n", "\n", "# Zero-initialize the last BN in each residual branch,", "\n", "# so that the residual branch starts with zeros, and each residual block behaves like an identity.", "\n", "# This improves the model by 0.2~0.3% according to https://arxiv.org/abs/1706.02677", "\n", "", "", "if", "zero_init_residual", ":", "\n", "            ", "for", "m", "in", "self", ".", "modules", "(", ")", ":", "\n", "                ", "if", "isinstance", "(", "m", ",", "Bottleneck", ")", ":", "\n", "                    ", "nn", ".", "init", ".", "constant_", "(", "m", ".", "bn3", ".", "weight", ",", "0", ")", "\n", "", "elif", "isinstance", "(", "m", ",", "BasicBlock", ")", ":", "\n", "                    ", "nn", ".", "init", ".", "constant_", "(", "m", ".", "bn2", ".", "weight", ",", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.ResNet._make_layer": [[160, 183], ["layers.append", "range", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Sequential", "block", "layers.append", "resnet_multispectral.conv1x1", "norm_layer", "block"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.conv1x1"], ["", "", "", "", "def", "_make_layer", "(", "self", ",", "block", ",", "planes", ",", "blocks", ",", "stride", "=", "1", ",", "dilate", "=", "False", ")", ":", "\n", "        ", "norm_layer", "=", "self", ".", "_norm_layer", "\n", "downsample", "=", "None", "\n", "previous_dilation", "=", "self", ".", "dilation", "\n", "if", "dilate", ":", "\n", "            ", "self", ".", "dilation", "*=", "stride", "\n", "stride", "=", "1", "\n", "", "if", "stride", "!=", "1", "or", "self", ".", "inplanes", "!=", "planes", "*", "block", ".", "expansion", ":", "\n", "            ", "downsample", "=", "nn", ".", "Sequential", "(", "\n", "conv1x1", "(", "self", ".", "inplanes", ",", "planes", "*", "block", ".", "expansion", ",", "stride", ")", ",", "\n", "norm_layer", "(", "planes", "*", "block", ".", "expansion", ")", ",", "\n", ")", "\n", "\n", "", "layers", "=", "[", "]", "\n", "layers", ".", "append", "(", "block", "(", "self", ".", "inplanes", ",", "planes", ",", "stride", ",", "downsample", ",", "self", ".", "groups", ",", "\n", "self", ".", "base_width", ",", "previous_dilation", ",", "norm_layer", ")", ")", "\n", "self", ".", "inplanes", "=", "planes", "*", "block", ".", "expansion", "\n", "for", "_", "in", "range", "(", "1", ",", "blocks", ")", ":", "\n", "            ", "layers", ".", "append", "(", "block", "(", "self", ".", "inplanes", ",", "planes", ",", "groups", "=", "self", ".", "groups", ",", "\n", "base_width", "=", "self", ".", "base_width", ",", "dilation", "=", "self", ".", "dilation", ",", "\n", "norm_layer", "=", "norm_layer", ")", ")", "\n", "\n", "", "return", "nn", ".", "Sequential", "(", "*", "layers", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.ResNet.get_feats": [[184, 205], ["resnet_multispectral.ResNet.conv1", "resnet_multispectral.ResNet.bn1", "resnet_multispectral.ResNet.relu", "resnet_multispectral.ResNet.maxpool", "resnet_multispectral.ResNet.layer1", "resnet_multispectral.ResNet.layer2", "resnet_multispectral.ResNet.layer3", "resnet_multispectral.ResNet.layer4", "resnet_multispectral.ResNet.avgpool", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten"], "methods", ["None"], ["", "def", "get_feats", "(", "self", ",", "x", ",", "layer", "=", "4", ")", ":", "\n", "# See note [TorchScript super()]", "\n", "        ", "x", "=", "self", ".", "conv1", "(", "x", ")", "\n", "x", "=", "self", ".", "bn1", "(", "x", ")", "\n", "x", "=", "self", ".", "relu", "(", "x", ")", "\n", "x", "=", "self", ".", "maxpool", "(", "x", ")", "\n", "\n", "x", "=", "self", ".", "layer1", "(", "x", ")", "\n", "if", "layer", "==", "1", ":", "\n", "            ", "return", "x", "\n", "", "x", "=", "self", ".", "layer2", "(", "x", ")", "\n", "if", "layer", "==", "2", ":", "\n", "            ", "return", "x", "\n", "", "x", "=", "self", ".", "layer3", "(", "x", ")", "\n", "if", "layer", "==", "3", ":", "\n", "            ", "return", "x", "\n", "", "x", "=", "self", ".", "layer4", "(", "x", ")", "\n", "\n", "x", "=", "self", ".", "avgpool", "(", "x", ")", "\n", "x", "=", "torch", ".", "flatten", "(", "x", ",", "1", ")", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.ResNet._forward_impl": [[207, 216], ["resnet_multispectral.ResNet.get_feats", "resnet_multispectral.ResNet.fc"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.ResNet.get_feats"], ["", "def", "_forward_impl", "(", "self", ",", "x", ",", "with_feats", "=", "False", ")", ":", "\n", "        ", "x", "=", "feats", "=", "self", ".", "get_feats", "(", "x", ")", "\n", "if", "self", ".", "fc", "is", "not", "None", ":", "\n", "            ", "x", "=", "self", ".", "fc", "(", "feats", ")", "\n", "\n", "", "if", "with_feats", ":", "\n", "            ", "return", "x", ",", "feats", "\n", "", "else", ":", "\n", "            ", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.ResNet.forward": [[217, 219], ["resnet_multispectral.ResNet._forward_impl"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.ResNet._forward_impl"], ["", "", "def", "forward", "(", "self", ",", "x", ",", "with_feats", "=", "False", ")", ":", "\n", "        ", "return", "self", ".", "_forward_impl", "(", "x", ",", "with_feats", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.ResNet18.__init__": [[222, 225], ["resnet_multispectral.ResNet.__init__"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "num_classes", "=", "10", ",", "num_channels", "=", "3", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "\n", "BasicBlock", ",", "[", "2", ",", "2", ",", "2", ",", "2", "]", ",", "num_classes", "=", "num_classes", ",", "num_channels", "=", "num_channels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.ResNet34.__init__": [[227, 230], ["resnet_multispectral.ResNet.__init__"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "num_classes", "=", "10", ",", "num_channels", "=", "3", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "\n", "BasicBlock", ",", "[", "3", ",", "4", ",", "6", ",", "3", "]", ",", "num_classes", "=", "num_classes", ",", "num_channels", "=", "num_channels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.ResNet50.__init__": [[232, 235], ["resnet_multispectral.ResNet.__init__"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "num_classes", "=", "10", ",", "num_channels", "=", "3", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "\n", "Bottleneck", ",", "[", "3", ",", "4", ",", "23", ",", "3", "]", ",", "num_classes", "=", "num_classes", ",", "num_channels", "=", "num_channels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.ResNet101.__init__": [[237, 240], ["resnet_multispectral.ResNet.__init__"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "num_classes", "=", "10", ",", "num_channels", "=", "3", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "\n", "Bottleneck", ",", "[", "3", ",", "4", ",", "23", ",", "3", "]", ",", "num_classes", "=", "num_classes", ",", "num_channels", "=", "num_channels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.ResNet152.__init__": [[242, 245], ["resnet_multispectral.ResNet.__init__"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "num_classes", "=", "10", ",", "num_channels", "=", "3", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "\n", "Bottleneck", ",", "[", "3", ",", "8", ",", "36", ",", "3", "]", ",", "num_classes", "=", "num_classes", ",", "num_channels", "=", "num_channels", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.conv3x3": [[6, 10], ["torch.Conv2d"], "function", ["None"], ["def", "conv3x3", "(", "in_planes", ",", "out_planes", ",", "stride", "=", "1", ",", "groups", "=", "1", ",", "dilation", "=", "1", ")", ":", "\n", "    ", "\"\"\"3x3 convolution with padding\"\"\"", "\n", "return", "nn", ".", "Conv2d", "(", "in_planes", ",", "out_planes", ",", "kernel_size", "=", "3", ",", "stride", "=", "stride", ",", "\n", "padding", "=", "dilation", ",", "groups", "=", "groups", ",", "bias", "=", "False", ",", "dilation", "=", "dilation", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.resnet_multispectral.conv1x1": [[12, 15], ["torch.Conv2d"], "function", ["None"], ["", "def", "conv1x1", "(", "in_planes", ",", "out_planes", ",", "stride", "=", "1", ")", ":", "\n", "    ", "\"\"\"1x1 convolution\"\"\"", "\n", "return", "nn", ".", "Conv2d", "(", "in_planes", ",", "out_planes", ",", "kernel_size", "=", "1", ",", "stride", "=", "stride", ",", "bias", "=", "False", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.civil.DistilBertClassifier.__init__": [[40, 42], ["transformers.DistilBertForSequenceClassification.__init__"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "config", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "config", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.civil.DistilBertClassifier.__call__": [[43, 51], ["super().__call__"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.amazon.DistilBertClassifier.__call__"], ["", "def", "__call__", "(", "self", ",", "x", ")", ":", "\n", "        ", "input_ids", "=", "x", "[", ":", ",", ":", ",", "0", "]", "\n", "attention_mask", "=", "x", "[", ":", ",", ":", ",", "1", "]", "\n", "outputs", "=", "super", "(", ")", ".", "__call__", "(", "\n", "input_ids", "=", "input_ids", ",", "\n", "attention_mask", "=", "attention_mask", ",", "\n", ")", "[", "0", "]", "\n", "return", "outputs", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.civil.Model.__init__": [[53, 62], ["torch.nn.Module.__init__", "DistilBertClassifier.from_pretrained", "civil.Model.load_state_dict", "copy.deepcopy"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "args", ",", "weights", ")", ":", "\n", "        ", "super", "(", "Model", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "num_classes", "=", "NUM_CLASSES", "\n", "self", ".", "model", "=", "DistilBertClassifier", ".", "from_pretrained", "(", "\n", "'distilbert-base-uncased'", ",", "\n", "num_labels", "=", "2", ",", "\n", ")", "\n", "if", "weights", "is", "not", "None", ":", "\n", "            ", "self", ".", "load_state_dict", "(", "deepcopy", "(", "weights", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.civil.Model.reset_weights": [[63, 65], ["civil.Model.load_state_dict", "copy.deepcopy"], "methods", ["None"], ["", "", "def", "reset_weights", "(", "self", ",", "weights", ")", ":", "\n", "        ", "self", ".", "load_state_dict", "(", "deepcopy", "(", "weights", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.civil.Model.getDataLoaders": [[66, 88], ["wilds.datasets.civilcomments_dataset.CivilCommentsDataset", "civil.initialize_bert_transform", "wilds.datasets.civilcomments_dataset.CivilCommentsDataset.get_subset", "datasets.CivilComments_Batched_Dataset", "torch.utils.data.DataLoader", "datasets.items", "wilds.common.data_loaders.get_eval_loader", "os.path.join", "wilds.datasets.civilcomments_dataset.CivilCommentsDataset.get_subset"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.amazon.initialize_bert_transform"], ["", "@", "staticmethod", "\n", "def", "getDataLoaders", "(", "args", ",", "device", ")", ":", "\n", "        ", "dataset", "=", "CivilCommentsDataset", "(", "root_dir", "=", "os", ".", "path", ".", "join", "(", "args", ".", "data_dir", ",", "'wilds'", ")", ",", "download", "=", "True", ")", "\n", "# get all train data", "\n", "transform", "=", "initialize_bert_transform", "(", ")", "\n", "train_data", "=", "dataset", ".", "get_subset", "(", "'train'", ",", "transform", "=", "transform", ")", "\n", "# separate into subsets by distribution", "\n", "train_sets", "=", "CivilComments_Batched_Dataset", "(", "train_data", ",", "batch_size", "=", "args", ".", "batch_size", ")", "\n", "# take subset of test and validation, making sure that only labels appeared in train", "\n", "# are included", "\n", "datasets", "=", "{", "}", "\n", "for", "split", "in", "dataset", ".", "split_dict", ":", "\n", "            ", "if", "split", "!=", "'train'", ":", "\n", "                ", "datasets", "[", "split", "]", "=", "dataset", ".", "get_subset", "(", "split", ",", "transform", "=", "transform", ")", "\n", "# get the loaders", "\n", "", "", "kwargs", "=", "{", "'num_workers'", ":", "4", ",", "'pin_memory'", ":", "True", ",", "'drop_last'", ":", "False", "}", "if", "device", ".", "type", "==", "\"cuda\"", "else", "{", "}", "\n", "train_loaders", "=", "DataLoader", "(", "train_sets", ",", "batch_size", "=", "args", ".", "batch_size", ",", "shuffle", "=", "True", ",", "**", "kwargs", ")", "\n", "tv_loaders", "=", "{", "}", "\n", "for", "split", ",", "dataset", "in", "datasets", ".", "items", "(", ")", ":", "\n", "            ", "tv_loaders", "[", "split", "]", "=", "get_eval_loader", "(", "'standard'", ",", "dataset", ",", "batch_size", "=", "256", ")", "\n", "", "return", "train_loaders", ",", "tv_loaders", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.civil.Model.forward": [[89, 91], ["civil.Model.model"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "self", ".", "model", "(", "x", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.YugeTen_fish.models.civil.initialize_bert_transform": [[20, 37], ["transformers.DistilBertTokenizerFast.from_pretrained", "DistilBertTokenizerFast.from_pretrained.", "torch.stack", "torch.squeeze"], "function", ["None"], ["def", "initialize_bert_transform", "(", ")", ":", "\n", "    ", "\"\"\"Adapted from the Wilds library, available at: https://github.com/p-lambda/wilds\"\"\"", "\n", "tokenizer", "=", "DistilBertTokenizerFast", ".", "from_pretrained", "(", "'distilbert-base-uncased'", ")", "\n", "def", "transform", "(", "text", ")", ":", "\n", "        ", "tokens", "=", "tokenizer", "(", "\n", "text", ",", "\n", "padding", "=", "'max_length'", ",", "\n", "truncation", "=", "True", ",", "\n", "max_length", "=", "MAX_TOKEN_LENGTH", ",", "\n", "return_tensors", "=", "'pt'", ")", "\n", "x", "=", "torch", ".", "stack", "(", "\n", "(", "tokens", "[", "'input_ids'", "]", ",", "\n", "tokens", "[", "'attention_mask'", "]", ")", ",", "\n", "dim", "=", "2", ")", "\n", "x", "=", "torch", ".", "squeeze", "(", "x", ",", "dim", "=", "0", ")", "# First shape dim is always 1", "\n", "return", "x", "\n", "", "return", "transform", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.iwildcam.Model.__init__": [[17, 25], ["torch.Module.__init__", "torchvision.models.resnet50", "torch.Sequential", "torch.Linear", "iwildcam.Model.load_state_dict", "copy.deepcopy", "list", "torchvision.models.resnet50.children"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "args", ",", "weights", ")", ":", "\n", "        ", "super", "(", "Model", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "num_classes", "=", "NUM_CLASSES", "\n", "resnet", "=", "resnet50", "(", "pretrained", "=", "True", ")", "\n", "self", ".", "enc", "=", "nn", ".", "Sequential", "(", "*", "list", "(", "resnet", ".", "children", "(", ")", ")", "[", ":", "-", "1", "]", ")", "# remove fc layer", "\n", "self", ".", "fc", "=", "nn", ".", "Linear", "(", "2048", ",", "self", ".", "num_classes", ")", "\n", "if", "weights", "is", "not", "None", ":", "\n", "            ", "self", ".", "load_state_dict", "(", "deepcopy", "(", "weights", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.iwildcam.Model.reset_weights": [[26, 28], ["iwildcam.Model.load_state_dict", "copy.deepcopy"], "methods", ["None"], ["", "", "def", "reset_weights", "(", "self", ",", "weights", ")", ":", "\n", "        ", "self", ".", "load_state_dict", "(", "deepcopy", "(", "weights", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.iwildcam.Model.getDataLoaders": [[30, 58], ["wilds.datasets.iwildcam_dataset.IWildCamDataset", "torchvision.Compose", "wilds.datasets.iwildcam_dataset.IWildCamDataset.get_subset", "datasets.GeneralWilds_Batched_Dataset", "torch.utils.data.DataLoader", "datasets.items", "wilds.common.data_loaders.get_eval_loader", "os.path.join", "torchvision.Resize", "torchvision.ToTensor", "torchvision.Normalize", "wilds.datasets.iwildcam_dataset.IWildCamDataset.get_subset"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "getDataLoaders", "(", "args", ",", "device", ")", ":", "\n", "        ", "dataset", "=", "IWildCamDataset", "(", "root_dir", "=", "os", ".", "path", ".", "join", "(", "args", ".", "data_dir", ",", "'wilds'", ")", ",", "download", "=", "True", ")", "\n", "# get all train data", "\n", "transform", "=", "transforms", ".", "Compose", "(", "[", "\n", "transforms", ".", "Resize", "(", "(", "224", ",", "224", ")", ")", ",", "\n", "transforms", ".", "ToTensor", "(", ")", ",", "\n", "transforms", ".", "Normalize", "(", "[", "0.485", ",", "0.456", ",", "0.406", "]", ",", "\n", "[", "0.229", ",", "0.224", ",", "0.225", "]", ")", "\n", "]", ")", "\n", "train_data", "=", "dataset", ".", "get_subset", "(", "'train'", ",", "transform", "=", "transform", ")", "\n", "# separate into subsets by distribution", "\n", "train_sets", "=", "GeneralWilds_Batched_Dataset", "(", "train_data", ",", "args", ".", "batch_size", ",", "domain_idx", "=", "0", ")", "\n", "# take subset of test and validation, making sure that only labels appeared in train", "\n", "# are included", "\n", "datasets", "=", "{", "}", "\n", "for", "split", "in", "dataset", ".", "split_dict", ":", "\n", "            ", "if", "split", "!=", "'train'", ":", "\n", "                ", "datasets", "[", "split", "]", "=", "dataset", ".", "get_subset", "(", "split", ",", "transform", "=", "transform", ")", "\n", "\n", "# get the loaders", "\n", "", "", "kwargs", "=", "{", "'num_workers'", ":", "4", ",", "'pin_memory'", ":", "True", ",", "'drop_last'", ":", "False", "}", "if", "device", ".", "type", "==", "\"cuda\"", "else", "{", "}", "\n", "train_loaders", "=", "DataLoader", "(", "train_sets", ",", "batch_size", "=", "args", ".", "batch_size", ",", "shuffle", "=", "True", ",", "**", "kwargs", ")", "\n", "tv_loaders", "=", "{", "}", "\n", "for", "split", ",", "dataset", "in", "datasets", ".", "items", "(", ")", ":", "\n", "            ", "tv_loaders", "[", "split", "]", "=", "get_eval_loader", "(", "'standard'", ",", "dataset", ",", "batch_size", "=", "256", ")", "\n", "", "return", "train_loaders", ",", "tv_loaders", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.iwildcam.Model.forward": [[59, 65], ["iwildcam.Model.enc", "iwildcam.Model.fc", "len", "x.unsqueeze_", "iwildcam.Model.squeeze().squeeze", "iwildcam.Model.squeeze"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "# x = x.expand(-1, 3, -1, -1)  # reshape MNIST from 1x32x32 => 3x32x32", "\n", "        ", "if", "len", "(", "x", ".", "shape", ")", "==", "3", ":", "\n", "            ", "x", ".", "unsqueeze_", "(", "0", ")", "\n", "", "e", "=", "self", ".", "enc", "(", "x", ")", "\n", "return", "self", ".", "fc", "(", "e", ".", "squeeze", "(", "-", "1", ")", ".", "squeeze", "(", "-", "1", ")", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.YugeTen_fish.models.fmow.Model.__init__": [[19, 26], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torchvision.models.densenet121", "fmow.Model.load_state_dict", "copy.deepcopy"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "args", ",", "weights", ")", ":", "\n", "        ", "super", "(", "Model", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "num_classes", "=", "NUM_CLASSES", "\n", "self", ".", "enc", "=", "densenet121", "(", "pretrained", "=", "True", ")", ".", "features", "\n", "self", ".", "classifier", "=", "nn", ".", "Linear", "(", "1024", ",", "self", ".", "num_classes", ")", "\n", "if", "weights", "is", "not", "None", ":", "\n", "            ", "self", ".", "load_state_dict", "(", "deepcopy", "(", "weights", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.fmow.Model.reset_weights": [[27, 29], ["fmow.Model.load_state_dict", "copy.deepcopy"], "methods", ["None"], ["", "", "def", "reset_weights", "(", "self", ",", "weights", ")", ":", "\n", "        ", "self", ".", "load_state_dict", "(", "deepcopy", "(", "weights", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.fmow.Model.getDataLoaders": [[30, 53], ["wilds.datasets.fmow_dataset.FMoWDataset", "torchvision.Compose", "datasets.FMoW_Batched_Dataset", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "datasets.items", "wilds.common.data_loaders.get_eval_loader", "os.path.join", "torchvision.ToTensor", "torchvision.Normalize", "wilds.datasets.fmow_dataset.FMoWDataset.get_subset"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "getDataLoaders", "(", "args", ",", "device", ")", ":", "\n", "        ", "dataset", "=", "FMoWDataset", "(", "root_dir", "=", "os", ".", "path", ".", "join", "(", "args", ".", "data_dir", ",", "'wilds'", ")", ",", "download", "=", "True", ")", "\n", "# get all train data", "\n", "transform", "=", "transforms", ".", "Compose", "(", "[", "\n", "transforms", ".", "ToTensor", "(", ")", ",", "\n", "transforms", ".", "Normalize", "(", "[", "0.485", ",", "0.456", ",", "0.406", "]", ",", "\n", "[", "0.229", ",", "0.224", ",", "0.225", "]", ")", "\n", "]", ")", "\n", "train_sets", "=", "FMoW_Batched_Dataset", "(", "dataset", ",", "'train'", ",", "args", ".", "batch_size", ",", "transform", ")", "\n", "datasets", "=", "{", "}", "\n", "for", "split", "in", "dataset", ".", "split_dict", ":", "\n", "            ", "if", "split", "!=", "'train'", ":", "\n", "                ", "datasets", "[", "split", "]", "=", "dataset", ".", "get_subset", "(", "split", ",", "transform", "=", "transform", ")", "\n", "\n", "# get the loaders", "\n", "", "", "kwargs", "=", "{", "'num_workers'", ":", "4", ",", "'pin_memory'", ":", "True", ",", "'drop_last'", ":", "False", "}", "if", "device", ".", "type", "==", "\"cuda\"", "else", "{", "}", "\n", "train_loaders", "=", "DataLoader", "(", "train_sets", ",", "batch_size", "=", "args", ".", "batch_size", ",", "shuffle", "=", "True", ",", "**", "kwargs", ")", "\n", "tv_loaders", "=", "{", "}", "\n", "for", "split", ",", "dataset", "in", "datasets", ".", "items", "(", ")", ":", "\n", "            ", "tv_loaders", "[", "split", "]", "=", "get_eval_loader", "(", "'standard'", ",", "dataset", ",", "batch_size", "=", "256", ")", "\n", "", "return", "train_loaders", ",", "tv_loaders", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.fmow.Model.forward": [[54, 61], ["fmow.Model.enc", "torch.relu", "torch.relu", "torch.relu", "torch.adaptive_avg_pool2d", "torch.adaptive_avg_pool2d", "torch.adaptive_avg_pool2d", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten", "fmow.Model.classifier"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "features", "=", "self", ".", "enc", "(", "x", ")", "\n", "out", "=", "F", ".", "relu", "(", "features", ",", "inplace", "=", "True", ")", "\n", "out", "=", "F", ".", "adaptive_avg_pool2d", "(", "out", ",", "(", "1", ",", "1", ")", ")", "\n", "out", "=", "torch", ".", "flatten", "(", "out", ",", "1", ")", "\n", "out", "=", "self", ".", "classifier", "(", "out", ")", "\n", "return", "out", "\n", "", "", ""]], "home.repos.pwc.inspect_result.YugeTen_fish.models.poverty.Model.__init__": [[35, 42], ["torch.Module.__init__", "resnet_multispectral.ResNet18", "poverty.Model.load_state_dict", "copy.deepcopy"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "args", ",", "weights", ")", ":", "\n", "        ", "super", "(", "Model", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "num_classes", "=", "NUM_CLASSES", "\n", "\n", "self", ".", "enc", "=", "ResNet18", "(", "num_classes", "=", "1", ",", "num_channels", "=", "8", ")", "\n", "if", "weights", "is", "not", "None", ":", "\n", "            ", "self", ".", "load_state_dict", "(", "deepcopy", "(", "weights", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.poverty.Model.reset_weights": [[43, 45], ["poverty.Model.load_state_dict", "copy.deepcopy"], "methods", ["None"], ["", "", "def", "reset_weights", "(", "self", ",", "weights", ")", ":", "\n", "        ", "self", ".", "load_state_dict", "(", "deepcopy", "(", "weights", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.poverty.Model.getDataLoaders": [[47, 71], ["wilds.datasets.poverty_dataset.PovertyMapDataset", "poverty.initialize_poverty_train_transform", "datasets.Poverty_Batched_Dataset", "torch.utils.data.DataLoader", "datasets.items", "wilds.common.data_loaders.get_eval_loader", "os.path.join", "wilds.datasets.poverty_dataset.PovertyMapDataset.get_subset"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.poverty.initialize_poverty_train_transform"], ["", "@", "staticmethod", "\n", "def", "getDataLoaders", "(", "args", ",", "device", ")", ":", "\n", "        ", "kwargs", "=", "{", "'no_nl'", ":", "False", ",", "\n", "'fold'", ":", "'A'", ",", "\n", "'oracle_training_set'", ":", "False", ",", "\n", "'use_ood_val'", ":", "True", "}", "\n", "dataset", "=", "PovertyMapDataset", "(", "root_dir", "=", "os", ".", "path", ".", "join", "(", "args", ".", "data_dir", ",", "'wilds'", ")", ",", "\n", "download", "=", "True", ",", "**", "kwargs", ")", "\n", "# get all train data", "\n", "transform", "=", "initialize_poverty_train_transform", "(", ")", "\n", "\n", "train_sets", "=", "Poverty_Batched_Dataset", "(", "dataset", ",", "'train'", ",", "args", ".", "batch_size", ",", "transform", ")", "\n", "datasets", "=", "{", "}", "\n", "for", "split", "in", "dataset", ".", "split_dict", ":", "\n", "            ", "if", "split", "!=", "'train'", ":", "\n", "                ", "datasets", "[", "split", "]", "=", "dataset", ".", "get_subset", "(", "split", ",", "transform", "=", "transform", ")", "\n", "\n", "", "", "kwargs", "=", "{", "'num_workers'", ":", "4", ",", "'pin_memory'", ":", "True", ",", "'drop_last'", ":", "False", "}", "if", "device", ".", "type", "==", "\"cuda\"", "else", "{", "}", "\n", "train_loaders", "=", "DataLoader", "(", "train_sets", ",", "batch_size", "=", "args", ".", "batch_size", ",", "**", "kwargs", ")", "\n", "tv_loaders", "=", "{", "}", "\n", "for", "split", ",", "dataset", "in", "datasets", ".", "items", "(", ")", ":", "\n", "            ", "tv_loaders", "[", "split", "]", "=", "get_eval_loader", "(", "'standard'", ",", "dataset", ",", "batch_size", "=", "256", ")", "\n", "", "return", "train_loaders", ",", "tv_loaders", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.poverty.Model.forward": [[72, 74], ["poverty.Model.enc"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "self", ".", "enc", "(", "x", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.YugeTen_fish.models.poverty.initialize_poverty_train_transform": [[16, 32], ["torchvision.Compose", "torchvision.Lambda", "torchvision.ToPILImage", "torchvision.RandomHorizontalFlip", "torchvision.RandomVerticalFlip", "torchvision.ColorJitter", "torchvision.ToTensor", "transforms.Compose.", "poverty.initialize_poverty_train_transform.transform_rgb"], "function", ["None"], ["def", "initialize_poverty_train_transform", "(", ")", ":", "\n", "    ", "\"\"\"Adapted from the Wilds library, available at: https://github.com/p-lambda/wilds\"\"\"", "\n", "transforms_ls", "=", "[", "\n", "transforms", ".", "ToPILImage", "(", ")", ",", "\n", "transforms", ".", "RandomHorizontalFlip", "(", ")", ",", "\n", "transforms", ".", "RandomVerticalFlip", "(", ")", ",", "\n", "transforms", ".", "ColorJitter", "(", "brightness", "=", "0.8", ",", "contrast", "=", "0.8", ",", "saturation", "=", "0.8", ",", "hue", "=", "0.1", ")", ",", "\n", "transforms", ".", "ToTensor", "(", ")", "]", "\n", "rgb_transform", "=", "transforms", ".", "Compose", "(", "transforms_ls", ")", "\n", "\n", "def", "transform_rgb", "(", "img", ")", ":", "\n", "# bgr to rgb and back to bgr", "\n", "        ", "img", "[", ":", "3", "]", "=", "rgb_transform", "(", "img", "[", ":", "3", "]", "[", "[", "2", ",", "1", ",", "0", "]", "]", ")", "[", "[", "2", ",", "1", ",", "0", "]", "]", "\n", "return", "img", "\n", "", "transform", "=", "transforms", ".", "Lambda", "(", "lambda", "x", ":", "transform_rgb", "(", "x", ")", ")", "\n", "return", "transform", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.cdsprites.Model.__init__": [[17, 38], ["torch.Module.__init__", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Conv2d", "torch.Conv2d", "torch.ReLU", "torch.ReLU", "torch.Conv2d", "torch.Conv2d", "torch.ReLU", "torch.ReLU", "torch.Conv2d", "torch.Conv2d", "torch.ReLU", "torch.ReLU", "torch.Conv2d", "torch.Conv2d", "torch.ReLU", "torch.ReLU", "torch.Conv2d", "torch.Conv2d", "torch.ReLU", "torch.ReLU", "torch.Linear", "torch.Linear", "cdsprites.Model.load_state_dict", "copy.deepcopy"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__"], ["def", "__init__", "(", "self", ",", "args", ",", "weights", "=", "None", ")", ":", "\n", "        ", "super", "(", "Model", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "enc", "=", "nn", ".", "Sequential", "(", "\n", "# input size: 1 x 64 x 64", "\n", "nn", ".", "Conv2d", "(", "CDspritesChans", ",", "32", ",", "4", ",", "2", ",", "1", ")", ",", "\n", "nn", ".", "ReLU", "(", "True", ")", ",", "\n", "nn", ".", "Conv2d", "(", "32", ",", "32", ",", "4", ",", "2", ",", "1", ")", ",", "\n", "nn", ".", "ReLU", "(", "True", ")", ",", "\n", "nn", ".", "Conv2d", "(", "32", ",", "64", ",", "4", ",", "2", ",", "1", ")", ",", "\n", "nn", ".", "ReLU", "(", "True", ")", ",", "\n", "nn", ".", "Conv2d", "(", "64", ",", "128", ",", "4", ",", "2", ",", "1", ")", ",", "\n", "nn", ".", "ReLU", "(", "True", ")", ",", "\n", "nn", ".", "Conv2d", "(", "128", ",", "128", ",", "4", ",", "2", ",", "0", ")", ",", "\n", "nn", ".", "ReLU", "(", "True", ")", ",", "\n", ")", "\n", "self", ".", "fc", "=", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Linear", "(", "128", ",", "NUM_CLASSES", ")", "\n", ")", "\n", "# c1, c2 size: latent_dim x 1 x 1", "\n", "if", "weights", "is", "not", "None", ":", "\n", "            ", "self", ".", "load_state_dict", "(", "deepcopy", "(", "weights", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.cdsprites.Model.reset_weights": [[39, 41], ["cdsprites.Model.load_state_dict", "copy.deepcopy"], "methods", ["None"], ["", "", "def", "reset_weights", "(", "self", ",", "weights", ")", ":", "\n", "        ", "self", ".", "load_state_dict", "(", "deepcopy", "(", "weights", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.cdsprites.Model.forward": [[42, 50], ["cdsprites.Model.enc", "e.view.view.view", "cdsprites.Model.fc().view", "x.size", "x.view", "cdsprites.Model.fc"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ",", "return_feature", "=", "False", ")", ":", "\n", "        ", "pre_shape", "=", "x", ".", "size", "(", ")", "[", ":", "-", "3", "]", "\n", "e", "=", "self", ".", "enc", "(", "x", ".", "view", "(", "-", "1", ",", "*", "CDspritesDatasize", ")", ")", "\n", "e", "=", "e", ".", "view", "(", "e", ".", "shape", "[", "0", "]", ",", "-", "1", ")", "\n", "if", "return_feature", ":", "\n", "            ", "return", "e", "\n", "", "out", "=", "self", ".", "fc", "(", "e", ")", ".", "view", "(", "*", "pre_shape", ",", "-", "1", ")", "\n", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.cdsprites.Model.getDataLoaders": [[51, 66], ["datasets.DspritesDataset", "datasets.CDsprites_Dataset", "datasets.CDsprites_Dataset", "datasets.CDsprites_Dataset", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "os.path.join"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "getDataLoaders", "(", "args", ",", "device", ")", ":", "\n", "        ", "num_domains", ",", "batch_size", "=", "args", ".", "num_domains", ",", "args", ".", "batch_size", "\n", "kwargs", "=", "{", "'num_workers'", ":", "4", ",", "'pin_memory'", ":", "True", ",", "'drop_last'", ":", "False", "}", "if", "device", ".", "type", "==", "\"cuda\"", "else", "{", "}", "\n", "\n", "D", "=", "DspritesDataset", "(", "os", ".", "path", ".", "join", "(", "args", ".", "data_dir", ",", "'cdsprites'", ")", ",", "split", "=", "False", ")", "\n", "train_dataset", "=", "CDsprites_Dataset", "(", "D", ",", "args", ".", "data_dir", ",", "batch_size", ",", "num_domains", ",", "'train'", ")", "\n", "val_dataset", "=", "CDsprites_Dataset", "(", "D", ",", "args", ".", "data_dir", ",", "batch_size", ",", "num_domains", ",", "'val'", ")", "\n", "test_dataset", "=", "CDsprites_Dataset", "(", "D", ",", "args", ".", "data_dir", ",", "batch_size", ",", "num_domains", ",", "'test'", ")", "\n", "\n", "train_loader", "=", "DataLoader", "(", "train_dataset", ",", "batch_size", "=", "batch_size", ",", "shuffle", "=", "True", ",", "**", "kwargs", ")", "\n", "test_loader", "=", "DataLoader", "(", "test_dataset", ",", "batch_size", "=", "batch_size", ",", "shuffle", "=", "True", ",", "**", "kwargs", ")", "\n", "val_loader", "=", "DataLoader", "(", "val_dataset", ",", "batch_size", "=", "batch_size", ",", "shuffle", "=", "True", ",", "**", "kwargs", ")", "\n", "return", "train_loader", ",", "{", "'val'", ":", "val_loader", ",", "'test'", ":", "test_loader", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.camelyon.Model.__init__": [[19, 26], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torchvision.models.densenet121", "camelyon.Model.load_state_dict", "copy.deepcopy"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "args", ",", "weights", ")", ":", "\n", "        ", "super", "(", "Model", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "num_classes", "=", "NUM_CLASSES", "\n", "self", ".", "enc", "=", "densenet121", "(", "pretrained", "=", "False", ")", ".", "features", "# remove fc layer", "\n", "self", ".", "classifier", "=", "nn", ".", "Linear", "(", "1024", ",", "self", ".", "num_classes", ")", "\n", "if", "weights", "is", "not", "None", ":", "\n", "            ", "self", ".", "load_state_dict", "(", "deepcopy", "(", "weights", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.camelyon.Model.reset_weights": [[27, 29], ["camelyon.Model.load_state_dict", "copy.deepcopy"], "methods", ["None"], ["", "", "def", "reset_weights", "(", "self", ",", "weights", ")", ":", "\n", "        ", "self", ".", "load_state_dict", "(", "deepcopy", "(", "weights", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.camelyon.Model.getDataLoaders": [[30, 58], ["wilds.datasets.camelyon17_dataset.Camelyon17Dataset", "torchvision.Compose", "wilds.datasets.camelyon17_dataset.Camelyon17Dataset.get_subset", "datasets.GeneralWilds_Batched_Dataset", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "datasets.items", "wilds.common.data_loaders.get_eval_loader", "os.path.join", "torchvision.Resize", "torchvision.ToTensor", "torchvision.Normalize", "wilds.datasets.camelyon17_dataset.Camelyon17Dataset.get_subset"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "getDataLoaders", "(", "args", ",", "device", ")", ":", "\n", "        ", "dataset", "=", "Camelyon17Dataset", "(", "root_dir", "=", "os", ".", "path", ".", "join", "(", "args", ".", "data_dir", ",", "'wilds'", ")", ",", "download", "=", "True", ")", "\n", "transform", "=", "transforms", ".", "Compose", "(", "[", "\n", "transforms", ".", "Resize", "(", "(", "224", ",", "224", ")", ")", ",", "\n", "transforms", ".", "ToTensor", "(", ")", ",", "\n", "transforms", ".", "Normalize", "(", "[", "0.485", ",", "0.456", ",", "0.406", "]", ",", "\n", "[", "0.229", ",", "0.224", ",", "0.225", "]", ")", "\n", "]", ")", "\n", "# get all train data", "\n", "train_data", "=", "dataset", ".", "get_subset", "(", "'train'", ",", "transform", "=", "transform", ")", "\n", "# separate into subsets by distribution", "\n", "train_sets", "=", "GeneralWilds_Batched_Dataset", "(", "train_data", ",", "args", ".", "batch_size", ",", "domain_idx", "=", "0", ")", "\n", "# take subset of test and validation, making sure that only labels appeared in train", "\n", "# are included", "\n", "datasets", "=", "{", "}", "\n", "for", "split", "in", "dataset", ".", "split_dict", ":", "\n", "            ", "if", "split", "!=", "'train'", ":", "\n", "                ", "datasets", "[", "split", "]", "=", "dataset", ".", "get_subset", "(", "split", ",", "transform", "=", "transform", ")", "\n", "\n", "# get the loaders", "\n", "", "", "kwargs", "=", "{", "'num_workers'", ":", "4", ",", "'pin_memory'", ":", "True", ",", "'drop_last'", ":", "False", "}", "if", "device", ".", "type", "==", "\"cuda\"", "else", "{", "}", "\n", "train_loaders", "=", "DataLoader", "(", "train_sets", ",", "batch_size", "=", "args", ".", "batch_size", ",", "shuffle", "=", "True", ",", "**", "kwargs", ")", "\n", "tv_loaders", "=", "{", "}", "\n", "for", "split", ",", "dataset", "in", "datasets", ".", "items", "(", ")", ":", "\n", "            ", "tv_loaders", "[", "split", "]", "=", "get_eval_loader", "(", "'standard'", ",", "dataset", ",", "batch_size", "=", "args", ".", "batch_size", ")", "\n", "", "return", "train_loaders", ",", "tv_loaders", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.camelyon.Model.forward": [[59, 66], ["camelyon.Model.enc", "torch.relu", "torch.relu", "torch.relu", "torch.adaptive_avg_pool2d", "torch.adaptive_avg_pool2d", "torch.adaptive_avg_pool2d", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten", "torch.flatten", "camelyon.Model.classifier"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "features", "=", "self", ".", "enc", "(", "x", ")", "\n", "out", "=", "F", ".", "relu", "(", "features", ",", "inplace", "=", "True", ")", "\n", "out", "=", "F", ".", "adaptive_avg_pool2d", "(", "out", ",", "(", "1", ",", "1", ")", ")", "\n", "out", "=", "torch", ".", "flatten", "(", "out", ",", "1", ")", "\n", "out", "=", "self", ".", "classifier", "(", "out", ")", "\n", "return", "out", "\n", "", "", ""]], "home.repos.pwc.inspect_result.YugeTen_fish.models.amazon.DistilBertClassifier.__init__": [[40, 42], ["transformers.DistilBertForSequenceClassification.__init__"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "config", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "config", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.amazon.DistilBertClassifier.__call__": [[43, 51], ["super().__call__"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.amazon.DistilBertClassifier.__call__"], ["", "def", "__call__", "(", "self", ",", "x", ")", ":", "\n", "        ", "input_ids", "=", "x", "[", ":", ",", ":", ",", "0", "]", "\n", "attention_mask", "=", "x", "[", ":", ",", ":", ",", "1", "]", "\n", "outputs", "=", "super", "(", ")", ".", "__call__", "(", "\n", "input_ids", "=", "input_ids", ",", "\n", "attention_mask", "=", "attention_mask", ",", "\n", ")", "[", "0", "]", "\n", "return", "outputs", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.amazon.Model.__init__": [[53, 62], ["torch.nn.Module.__init__", "DistilBertClassifier.from_pretrained", "amazon.Model.load_state_dict", "copy.deepcopy"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__"], ["    ", "def", "__init__", "(", "self", ",", "args", ",", "weights", ")", ":", "\n", "        ", "super", "(", "Model", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "num_classes", "=", "NUM_CLASSES", "\n", "self", ".", "model", "=", "DistilBertClassifier", ".", "from_pretrained", "(", "\n", "'distilbert-base-uncased'", ",", "\n", "num_labels", "=", "5", ",", "\n", ")", "\n", "if", "weights", "is", "not", "None", ":", "\n", "            ", "self", ".", "load_state_dict", "(", "deepcopy", "(", "weights", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.amazon.Model.reset_weights": [[63, 65], ["amazon.Model.load_state_dict", "copy.deepcopy"], "methods", ["None"], ["", "", "def", "reset_weights", "(", "self", ",", "weights", ")", ":", "\n", "        ", "self", ".", "load_state_dict", "(", "deepcopy", "(", "weights", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.amazon.Model.getDataLoaders": [[66, 89], ["wilds.datasets.amazon_dataset.AmazonDataset", "amazon.initialize_bert_transform", "wilds.datasets.amazon_dataset.AmazonDataset.get_subset", "datasets.GeneralWilds_Batched_Dataset", "torch.utils.data.DataLoader", "datasets.items", "wilds.common.data_loaders.get_eval_loader", "os.path.join", "wilds.datasets.amazon_dataset.AmazonDataset.get_subset"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.amazon.initialize_bert_transform"], ["", "@", "staticmethod", "\n", "def", "getDataLoaders", "(", "args", ",", "device", ")", ":", "\n", "        ", "dataset", "=", "AmazonDataset", "(", "root_dir", "=", "os", ".", "path", ".", "join", "(", "args", ".", "data_dir", ",", "'wilds'", ")", ",", "download", "=", "True", ")", "\n", "# get all train data", "\n", "transform", "=", "initialize_bert_transform", "(", ")", "\n", "train_data", "=", "dataset", ".", "get_subset", "(", "'train'", ",", "transform", "=", "transform", ")", "\n", "# separate into subsets by distribution", "\n", "train_sets", "=", "GeneralWilds_Batched_Dataset", "(", "train_data", ",", "args", ".", "batch_size", ",", "domain_idx", "=", "0", ")", "\n", "# take subset of test and validation, making sure that only labels appeared in train", "\n", "# are included", "\n", "datasets", "=", "{", "}", "\n", "for", "split", "in", "dataset", ".", "split_dict", ":", "\n", "            ", "if", "split", "!=", "'train'", ":", "\n", "                ", "datasets", "[", "split", "]", "=", "dataset", ".", "get_subset", "(", "split", ",", "transform", "=", "transform", ")", "\n", "\n", "# get the loaders", "\n", "", "", "kwargs", "=", "{", "'num_workers'", ":", "4", ",", "'pin_memory'", ":", "True", ",", "'drop_last'", ":", "False", "}", "if", "device", ".", "type", "==", "\"cuda\"", "else", "{", "}", "\n", "train_loaders", "=", "DataLoader", "(", "train_sets", ",", "batch_size", "=", "args", ".", "batch_size", ",", "shuffle", "=", "True", ",", "**", "kwargs", ")", "\n", "tv_loaders", "=", "{", "}", "\n", "for", "split", ",", "dataset", "in", "datasets", ".", "items", "(", ")", ":", "\n", "            ", "tv_loaders", "[", "split", "]", "=", "get_eval_loader", "(", "'standard'", ",", "dataset", ",", "batch_size", "=", "256", ")", "\n", "", "return", "train_loaders", ",", "tv_loaders", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.amazon.Model.forward": [[91, 93], ["amazon.Model.model"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "self", ".", "model", "(", "x", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.YugeTen_fish.models.amazon.initialize_bert_transform": [[20, 37], ["transformers.DistilBertTokenizerFast.from_pretrained", "DistilBertTokenizerFast.from_pretrained.", "torch.stack", "torch.squeeze"], "function", ["None"], ["def", "initialize_bert_transform", "(", ")", ":", "\n", "    ", "\"\"\"Adapted from the Wilds library, available at: https://github.com/p-lambda/wilds\"\"\"", "\n", "tokenizer", "=", "DistilBertTokenizerFast", ".", "from_pretrained", "(", "'distilbert-base-uncased'", ")", "\n", "def", "transform", "(", "text", ")", ":", "\n", "        ", "tokens", "=", "tokenizer", "(", "\n", "text", ",", "\n", "padding", "=", "'max_length'", ",", "\n", "truncation", "=", "True", ",", "\n", "max_length", "=", "MAX_TOKEN_LENGTH", ",", "\n", "return_tensors", "=", "'pt'", ")", "\n", "x", "=", "torch", ".", "stack", "(", "\n", "(", "tokens", "[", "'input_ids'", "]", ",", "\n", "tokens", "[", "'attention_mask'", "]", ")", ",", "\n", "dim", "=", "2", ")", "\n", "x", "=", "torch", ".", "squeeze", "(", "x", ",", "dim", "=", "0", ")", "# First shape dim is always 1", "\n", "return", "x", "\n", "", "return", "transform", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.Poverty_Batched_Dataset.__init__": [[15, 42], ["torch.stack", "len", "numpy.where", "torch.nonzero().squeeze", "domains.unique", "domains.unique", "torch.nonzero"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "dataset", ",", "split", ",", "batch_size", ",", "transform", "=", "None", ")", ":", "\n", "        ", "self", ".", "split_array", "=", "dataset", ".", "split_array", "\n", "self", ".", "split_dict", "=", "dataset", ".", "split_dict", "\n", "split_mask", "=", "self", ".", "split_array", "==", "self", ".", "split_dict", "[", "split", "]", "\n", "self", ".", "split_idx", "=", "np", ".", "where", "(", "split_mask", ")", "[", "0", "]", "\n", "\n", "self", ".", "root", "=", "dataset", ".", "root", "\n", "self", ".", "no_nl", "=", "dataset", ".", "no_nl", "\n", "\n", "self", ".", "metadata_array", "=", "torch", ".", "stack", "(", "[", "dataset", ".", "metadata_array", "[", "self", ".", "split_idx", ",", "i", "]", "for", "i", "in", "[", "0", ",", "2", "]", "]", ",", "-", "1", ")", "\n", "self", ".", "y_array", "=", "dataset", ".", "y_array", "[", "self", ".", "split_idx", "]", "\n", "\n", "self", ".", "eval", "=", "dataset", ".", "eval", "\n", "self", ".", "collate", "=", "dataset", ".", "collate", "\n", "self", ".", "metadata_fields", "=", "dataset", ".", "metadata_fields", "\n", "self", ".", "data_dir", "=", "dataset", ".", "data_dir", "\n", "\n", "self", ".", "transform", "=", "transform", "if", "transform", "is", "not", "None", "else", "lambda", "x", ":", "x", "\n", "\n", "domains", "=", "self", ".", "metadata_array", "[", ":", ",", "1", "]", "\n", "self", ".", "domain_indices", "=", "[", "torch", ".", "nonzero", "(", "domains", "==", "loc", ")", ".", "squeeze", "(", "-", "1", ")", "\n", "for", "loc", "in", "domains", ".", "unique", "(", ")", "]", "\n", "self", ".", "num_envs", "=", "len", "(", "domains", ".", "unique", "(", ")", ")", "\n", "\n", "self", ".", "domains", "=", "domains", "\n", "self", ".", "targets", "=", "self", ".", "y_array", "\n", "self", ".", "batch_size", "=", "batch_size", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.Poverty_Batched_Dataset.reset_batch": [[43, 49], ["enumerate", "torch.split", "len", "torch.randperm", "len"], "methods", ["None"], ["", "def", "reset_batch", "(", "self", ")", ":", "\n", "        ", "\"\"\"Reset batch indices for each domain.\"\"\"", "\n", "self", ".", "batch_indices", ",", "self", ".", "batches_left", "=", "{", "}", ",", "{", "}", "\n", "for", "loc", ",", "d_idx", "in", "enumerate", "(", "self", ".", "domain_indices", ")", ":", "\n", "            ", "self", ".", "batch_indices", "[", "loc", "]", "=", "torch", ".", "split", "(", "d_idx", "[", "torch", ".", "randperm", "(", "len", "(", "d_idx", ")", ")", "]", ",", "self", ".", "batch_size", ")", "\n", "self", ".", "batches_left", "[", "loc", "]", "=", "len", "(", "self", ".", "batch_indices", "[", "loc", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.Poverty_Batched_Dataset.get_batch": [[50, 55], ["torch.stack", "len", "datasets.Poverty_Batched_Dataset.transform", "datasets.Poverty_Batched_Dataset.get_input"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.get_input"], ["", "", "def", "get_batch", "(", "self", ",", "domain", ")", ":", "\n", "        ", "\"\"\"Return the next batch of the specified domain.\"\"\"", "\n", "batch_index", "=", "self", ".", "batch_indices", "[", "domain", "]", "[", "len", "(", "self", ".", "batch_indices", "[", "domain", "]", ")", "-", "self", ".", "batches_left", "[", "domain", "]", "]", "\n", "return", "torch", ".", "stack", "(", "[", "self", ".", "transform", "(", "self", ".", "get_input", "(", "i", ")", ")", "for", "i", "in", "batch_index", "]", ")", ",", "self", ".", "targets", "[", "batch_index", "]", ",", "self", ".", "domains", "[", "batch_index", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.Poverty_Batched_Dataset.get_input": [[56, 63], ["torch.from_numpy().float", "numpy.load", "torch.from_numpy"], "methods", ["None"], ["", "def", "get_input", "(", "self", ",", "idx", ")", ":", "\n", "        ", "\"\"\"Returns x for a given idx.\"\"\"", "\n", "img", "=", "np", ".", "load", "(", "self", ".", "root", "/", "'images'", "/", "f'landsat_poverty_img_{self.split_idx[idx]}.npz'", ")", "[", "'x'", "]", "\n", "if", "self", ".", "no_nl", ":", "\n", "            ", "img", "[", "-", "1", "]", "=", "0", "\n", "", "img", "=", "torch", ".", "from_numpy", "(", "img", ")", ".", "float", "(", ")", "\n", "return", "img", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.Poverty_Batched_Dataset.__getitem__": [[65, 68], ["datasets.Poverty_Batched_Dataset.transform", "datasets.Poverty_Batched_Dataset.get_input"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.get_input"], ["", "def", "__getitem__", "(", "self", ",", "idx", ")", ":", "\n", "        ", "return", "self", ".", "transform", "(", "self", ".", "get_input", "(", "idx", ")", ")", ",", "self", ".", "targets", "[", "idx", "]", ",", "self", ".", "domains", "[", "idx", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.Poverty_Batched_Dataset.__len__": [[69, 71], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "targets", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.FMoW_Batched_Dataset.__init__": [[79, 106], ["len", "numpy.where", "torch.nonzero().squeeze", "domains.unique", "domains.unique", "torch.nonzero"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "dataset", ",", "split", ",", "batch_size", ",", "transform", ")", ":", "\n", "        ", "self", ".", "split_array", "=", "dataset", ".", "split_array", "\n", "self", ".", "split_dict", "=", "dataset", ".", "split_dict", "\n", "split_mask", "=", "self", ".", "split_array", "==", "self", ".", "split_dict", "[", "split", "]", "\n", "split_idx", "=", "np", ".", "where", "(", "split_mask", ")", "[", "0", "]", "\n", "\n", "self", ".", "full_idxs", "=", "dataset", ".", "full_idxs", "[", "split_idx", "]", "\n", "self", ".", "chunk_size", "=", "dataset", ".", "chunk_size", "\n", "self", ".", "root", "=", "dataset", ".", "root", "\n", "\n", "self", ".", "metadata_array", "=", "dataset", ".", "metadata_array", "[", "split_idx", "]", "\n", "self", ".", "y_array", "=", "dataset", ".", "y_array", "[", "split_idx", "]", "\n", "\n", "self", ".", "eval", "=", "dataset", ".", "eval", "\n", "self", ".", "collate", "=", "dataset", ".", "collate", "\n", "self", ".", "metadata_fields", "=", "dataset", ".", "metadata_fields", "\n", "self", ".", "data_dir", "=", "dataset", ".", "data_dir", "\n", "self", ".", "transform", "=", "transform", "\n", "\n", "domains", "=", "dataset", ".", "metadata_array", "[", "split_idx", ",", ":", "2", "]", "\n", "self", ".", "domain_indices", "=", "[", "torch", ".", "nonzero", "(", "(", "domains", "==", "loc", ")", ".", "sum", "(", "-", "1", ")", "==", "2", ")", ".", "squeeze", "(", "-", "1", ")", "\n", "for", "loc", "in", "domains", ".", "unique", "(", "dim", "=", "0", ")", "]", "\n", "self", ".", "domains", "=", "self", ".", "metadata_array", "[", ":", ",", ":", "2", "]", "\n", "self", ".", "num_envs", "=", "len", "(", "domains", ".", "unique", "(", "dim", "=", "0", ")", ")", "\n", "\n", "self", ".", "targets", "=", "self", ".", "y_array", "\n", "self", ".", "batch_size", "=", "batch_size", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.FMoW_Batched_Dataset.reset_batch": [[107, 113], ["enumerate", "torch.split", "len", "torch.randperm", "len"], "methods", ["None"], ["", "def", "reset_batch", "(", "self", ")", ":", "\n", "        ", "\"\"\"Reset batch indices for each domain.\"\"\"", "\n", "self", ".", "batch_indices", ",", "self", ".", "batches_left", "=", "{", "}", ",", "{", "}", "\n", "for", "loc", ",", "d_idx", "in", "enumerate", "(", "self", ".", "domain_indices", ")", ":", "\n", "            ", "self", ".", "batch_indices", "[", "loc", "]", "=", "torch", ".", "split", "(", "d_idx", "[", "torch", ".", "randperm", "(", "len", "(", "d_idx", ")", ")", "]", ",", "self", ".", "batch_size", ")", "\n", "self", ".", "batches_left", "[", "loc", "]", "=", "len", "(", "self", ".", "batch_indices", "[", "loc", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.FMoW_Batched_Dataset.get_batch": [[114, 119], ["torch.stack", "len", "datasets.FMoW_Batched_Dataset.transform", "datasets.FMoW_Batched_Dataset.get_input"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.get_input"], ["", "", "def", "get_batch", "(", "self", ",", "domain", ")", ":", "\n", "        ", "\"\"\"Return the next batch of the specified domain.\"\"\"", "\n", "batch_index", "=", "self", ".", "batch_indices", "[", "domain", "]", "[", "len", "(", "self", ".", "batch_indices", "[", "domain", "]", ")", "-", "self", ".", "batches_left", "[", "domain", "]", "]", "\n", "return", "torch", ".", "stack", "(", "[", "self", ".", "transform", "(", "self", ".", "get_input", "(", "i", ")", ")", "for", "i", "in", "batch_index", "]", ")", ",", "self", ".", "targets", "[", "batch_index", "]", ",", "self", ".", "domains", "[", "batch_index", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.FMoW_Batched_Dataset.get_input": [[120, 125], ["PIL.Image.open().convert", "PIL.Image.open"], "methods", ["None"], ["", "def", "get_input", "(", "self", ",", "idx", ")", ":", "\n", "        ", "\"\"\"Returns x for a given idx.\"\"\"", "\n", "idx", "=", "self", ".", "full_idxs", "[", "idx", "]", "\n", "img", "=", "Image", ".", "open", "(", "self", ".", "root", "/", "'images'", "/", "f'rgb_img_{idx}.png'", ")", ".", "convert", "(", "'RGB'", ")", "\n", "return", "img", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.FMoW_Batched_Dataset.__getitem__": [[126, 129], ["datasets.FMoW_Batched_Dataset.transform", "datasets.FMoW_Batched_Dataset.get_input"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.get_input"], ["", "def", "__getitem__", "(", "self", ",", "idx", ")", ":", "\n", "        ", "return", "self", ".", "transform", "(", "self", ".", "get_input", "(", "idx", ")", ")", ",", "self", ".", "targets", "[", "idx", "]", ",", "self", ".", "domains", "[", "idx", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.FMoW_Batched_Dataset.__len__": [[130, 132], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "targets", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CivilComments_Batched_Dataset.__init__": [[139, 166], ["torch.nonzero", "torch.nonzero().squeeze", "domain_indices_by_group.append", "domain_indices_by_group.append", "torch.nonzero", "domains.unique", "train_data.metadata_array[].sum"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "train_data", ",", "batch_size", "=", "16", ")", ":", "\n", "        ", "self", ".", "num_envs", "=", "9", "# civilcomments dataset has 8 attributes, plus 1 blank (no attribute)", "\n", "meta", "=", "torch", ".", "nonzero", "(", "train_data", ".", "metadata_array", "[", ":", ",", ":", "8", "]", "==", "1", ")", "\n", "indices", ",", "domains", "=", "meta", "[", ":", ",", "0", "]", ",", "meta", "[", ":", ",", "1", "]", "\n", "blank_indices", "=", "torch", ".", "nonzero", "(", "train_data", ".", "metadata_array", "[", ":", ",", ":", "8", "]", ".", "sum", "(", "-", "1", ")", "==", "0", ")", ".", "squeeze", "(", ")", "\n", "self", ".", "domain_indices", "=", "[", "blank_indices", "]", "+", "[", "indices", "[", "domains", "==", "d", "]", "for", "d", "in", "domains", ".", "unique", "(", ")", "]", "\n", "domain_indices_by_group", "=", "[", "]", "\n", "for", "d_idx", "in", "self", ".", "domain_indices", ":", "\n", "            ", "domain_indices_by_group", ".", "append", "(", "d_idx", "[", "train_data", ".", "metadata_array", "[", "d_idx", "]", "[", ":", ",", "-", "1", "]", "==", "0", "]", ")", "\n", "domain_indices_by_group", ".", "append", "(", "d_idx", "[", "train_data", ".", "metadata_array", "[", "d_idx", "]", "[", ":", ",", "-", "1", "]", "==", "1", "]", ")", "\n", "", "self", ".", "domain_indices", "=", "domain_indices_by_group", "\n", "\n", "train_data", ".", "_text_array", "=", "[", "train_data", ".", "dataset", ".", "_text_array", "[", "i", "]", "for", "i", "in", "train_data", ".", "indices", "]", "\n", "self", ".", "metadata_array", "=", "train_data", ".", "metadata_array", "\n", "self", ".", "y_array", "=", "train_data", ".", "y_array", "\n", "self", ".", "data", "=", "train_data", ".", "_text_array", "\n", "\n", "self", ".", "eval", "=", "train_data", ".", "eval", "\n", "self", ".", "collate", "=", "train_data", ".", "collate", "\n", "self", ".", "metadata_fields", "=", "train_data", ".", "metadata_fields", "\n", "self", ".", "data_dir", "=", "train_data", ".", "data_dir", "\n", "self", ".", "transform", "=", "train_data", ".", "transform", "\n", "\n", "self", ".", "data", "=", "train_data", ".", "_text_array", "\n", "self", ".", "targets", "=", "self", ".", "y_array", "\n", "self", ".", "domains", "=", "self", ".", "metadata_array", "[", ":", ",", ":", "8", "]", "\n", "self", ".", "batch_size", "=", "batch_size", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CivilComments_Batched_Dataset.reset_batch": [[167, 173], ["enumerate", "torch.split", "len", "torch.randperm", "len"], "methods", ["None"], ["", "def", "reset_batch", "(", "self", ")", ":", "\n", "        ", "\"\"\"Reset batch indices for each domain.\"\"\"", "\n", "self", ".", "batch_indices", ",", "self", ".", "batches_left", "=", "{", "}", ",", "{", "}", "\n", "for", "loc", ",", "d_idx", "in", "enumerate", "(", "self", ".", "domain_indices", ")", ":", "\n", "            ", "self", ".", "batch_indices", "[", "loc", "]", "=", "torch", ".", "split", "(", "d_idx", "[", "torch", ".", "randperm", "(", "len", "(", "d_idx", ")", ")", "]", ",", "self", ".", "batch_size", ")", "\n", "self", ".", "batches_left", "[", "loc", "]", "=", "len", "(", "self", ".", "batch_indices", "[", "loc", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CivilComments_Batched_Dataset.get_batch": [[174, 179], ["torch.stack", "len", "datasets.CivilComments_Batched_Dataset.transform", "datasets.CivilComments_Batched_Dataset.get_input"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.get_input"], ["", "", "def", "get_batch", "(", "self", ",", "domain", ")", ":", "\n", "        ", "\"\"\"Return the next batch of the specified domain.\"\"\"", "\n", "batch_index", "=", "self", ".", "batch_indices", "[", "domain", "]", "[", "len", "(", "self", ".", "batch_indices", "[", "domain", "]", ")", "-", "self", ".", "batches_left", "[", "domain", "]", "]", "\n", "return", "torch", ".", "stack", "(", "[", "self", ".", "transform", "(", "self", ".", "get_input", "(", "i", ")", ")", "for", "i", "in", "batch_index", "]", ")", ",", "self", ".", "targets", "[", "batch_index", "]", ",", "self", ".", "domains", "[", "batch_index", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CivilComments_Batched_Dataset.get_input": [[180, 183], ["None"], "methods", ["None"], ["", "def", "get_input", "(", "self", ",", "idx", ")", ":", "\n", "        ", "\"\"\"Returns x for a given idx.\"\"\"", "\n", "return", "self", ".", "data", "[", "idx", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CivilComments_Batched_Dataset.__getitem__": [[184, 187], ["datasets.CivilComments_Batched_Dataset.transform", "datasets.CivilComments_Batched_Dataset.get_input"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.get_input"], ["", "def", "__getitem__", "(", "self", ",", "idx", ")", ":", "\n", "        ", "return", "self", ".", "transform", "(", "self", ".", "get_input", "(", "idx", ")", ")", ",", "self", ".", "targets", "[", "idx", "]", ",", "self", ".", "domains", "[", "idx", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CivilComments_Batched_Dataset.__len__": [[188, 190], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "targets", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.GeneralWilds_Batched_Dataset.__init__": [[197, 219], ["len", "torch.nonzero().squeeze", "domains.unique", "str", "domains.unique", "torch.nonzero"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "train_data", ",", "batch_size", "=", "16", ",", "domain_idx", "=", "0", ")", ":", "\n", "        ", "domains", "=", "train_data", ".", "metadata_array", "[", ":", ",", "domain_idx", "]", "\n", "self", ".", "domain_indices", "=", "[", "torch", ".", "nonzero", "(", "domains", "==", "loc", ")", ".", "squeeze", "(", "-", "1", ")", "for", "loc", "in", "domains", ".", "unique", "(", ")", "]", "\n", "train_data", ".", "_input_array", "=", "[", "train_data", ".", "dataset", ".", "_input_array", "[", "i", "]", "for", "i", "in", "train_data", ".", "indices", "]", "\n", "self", ".", "num_envs", "=", "len", "(", "domains", ".", "unique", "(", ")", ")", "\n", "\n", "self", ".", "metadata_array", "=", "train_data", ".", "metadata_array", "\n", "self", ".", "y_array", "=", "train_data", ".", "y_array", "\n", "self", ".", "data", "=", "train_data", ".", "_input_array", "\n", "\n", "self", ".", "eval", "=", "train_data", ".", "eval", "\n", "self", ".", "collate", "=", "train_data", ".", "collate", "\n", "self", ".", "metadata_fields", "=", "train_data", ".", "metadata_fields", "\n", "self", ".", "data_dir", "=", "train_data", ".", "data_dir", "\n", "if", "'iwildcam'", "in", "str", "(", "self", ".", "data_dir", ")", ":", "\n", "            ", "self", ".", "data_dir", "=", "f'{self.data_dir}/train'", "\n", "", "self", ".", "transform", "=", "train_data", ".", "transform", "\n", "\n", "self", ".", "data", "=", "train_data", ".", "_input_array", "\n", "self", ".", "targets", "=", "self", ".", "y_array", "\n", "self", ".", "domains", "=", "self", ".", "metadata_array", "[", ":", ",", "domain_idx", "]", "\n", "self", ".", "batch_size", "=", "batch_size", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.GeneralWilds_Batched_Dataset.reset_batch": [[220, 226], ["enumerate", "torch.split", "len", "torch.randperm", "len"], "methods", ["None"], ["", "def", "reset_batch", "(", "self", ")", ":", "\n", "        ", "\"\"\"Reset batch indices for each domain.\"\"\"", "\n", "self", ".", "batch_indices", ",", "self", ".", "batches_left", "=", "{", "}", ",", "{", "}", "\n", "for", "loc", ",", "d_idx", "in", "enumerate", "(", "self", ".", "domain_indices", ")", ":", "\n", "            ", "self", ".", "batch_indices", "[", "loc", "]", "=", "torch", ".", "split", "(", "d_idx", "[", "torch", ".", "randperm", "(", "len", "(", "d_idx", ")", ")", "]", ",", "self", ".", "batch_size", ")", "\n", "self", ".", "batches_left", "[", "loc", "]", "=", "len", "(", "self", ".", "batch_indices", "[", "loc", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.GeneralWilds_Batched_Dataset.get_batch": [[227, 232], ["torch.stack", "len", "datasets.GeneralWilds_Batched_Dataset.transform", "datasets.GeneralWilds_Batched_Dataset.get_input"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.get_input"], ["", "", "def", "get_batch", "(", "self", ",", "domain", ")", ":", "\n", "        ", "\"\"\"Return the next batch of the specified domain.\"\"\"", "\n", "batch_index", "=", "self", ".", "batch_indices", "[", "domain", "]", "[", "len", "(", "self", ".", "batch_indices", "[", "domain", "]", ")", "-", "self", ".", "batches_left", "[", "domain", "]", "]", "\n", "return", "torch", ".", "stack", "(", "[", "self", ".", "transform", "(", "self", ".", "get_input", "(", "i", ")", ")", "for", "i", "in", "batch_index", "]", ")", ",", "self", ".", "targets", "[", "batch_index", "]", ",", "self", ".", "domains", "[", "batch_index", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.GeneralWilds_Batched_Dataset.get_input": [[233, 242], ["PIL.Image.open().convert", "PIL.Image.open"], "methods", ["None"], ["", "def", "get_input", "(", "self", ",", "idx", ")", ":", "\n", "        ", "\"\"\"Returns x for a given idx.\"\"\"", "\n", "if", "'amazon'", "in", "self", ".", "data_dir", ":", "\n", "            ", "return", "self", ".", "data", "[", "idx", "]", "\n", "", "else", ":", "\n", "# All images are in the train folder", "\n", "            ", "img_path", "=", "f'{self.data_dir}/{self.data[idx]}'", "\n", "img", "=", "Image", ".", "open", "(", "img_path", ")", ".", "convert", "(", "'RGB'", ")", "\n", "return", "img", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.GeneralWilds_Batched_Dataset.__getitem__": [[243, 246], ["datasets.GeneralWilds_Batched_Dataset.transform", "datasets.GeneralWilds_Batched_Dataset.get_input"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.get_input"], ["", "", "def", "__getitem__", "(", "self", ",", "idx", ")", ":", "\n", "        ", "return", "self", ".", "transform", "(", "self", ".", "get_input", "(", "idx", ")", ")", ",", "self", ".", "targets", "[", "idx", "]", ",", "self", ".", "domains", "[", "idx", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.GeneralWilds_Batched_Dataset.__len__": [[247, 249], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "targets", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.__init__": [[256, 280], ["datasets.CDsprites_Dataset.compute_split", "numpy.concatenate", "datasets.CDsprites_Dataset.retrieve_colors", "numpy.where", "copy.deepcopy", "numpy.expand_dims"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.compute_split", "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.retrieve_colors"], ["def", "__init__", "(", "self", ",", "dataset", ",", "data_dir", ",", "batch_size", ",", "num_domains", ",", "split", ")", ":", "\n", "# filter out shape 3", "\n", "        ", "self", ".", "indices", "=", "np", ".", "where", "(", "dataset", ".", "latents", "[", ":", ",", "0", "]", "!=", "3", ")", "[", "0", "]", "\n", "n_splits", "=", "[", "1", "/", "(", "num_domains", "+", "2", ")", "]", "*", "(", "num_domains", "+", "2", ")", "\n", "\n", "domain_indices", "=", "self", ".", "compute_split", "(", "n_splits", ",", "data_dir", ")", "\n", "self", ".", "data_dir", "=", "data_dir", "\n", "self", ".", "latents", "=", "dataset", ".", "latents", "\n", "self", ".", "images", "=", "dataset", ".", "images", "\n", "\n", "if", "split", "==", "'val'", ":", "\n", "            ", "self", ".", "latents", "=", "self", ".", "latents", "[", "domain_indices", "[", "-", "2", "]", "]", "\n", "self", ".", "images", "=", "self", ".", "images", "[", "domain_indices", "[", "-", "2", "]", "]", "\n", "", "elif", "split", "==", "'test'", ":", "\n", "            ", "self", ".", "latents", "=", "self", ".", "latents", "[", "domain_indices", "[", "-", "1", "]", "]", "\n", "self", ".", "images", "=", "self", ".", "images", "[", "domain_indices", "[", "-", "1", "]", "]", "\n", "\n", "", "self", ".", "domain_indices", "=", "domain_indices", "[", ":", "num_domains", "]", "\n", "colors", "=", "copy", ".", "deepcopy", "(", "self", ".", "latents", "[", ":", ",", "0", "]", ")", "-", "1", "\n", "self", ".", "latents", "=", "np", ".", "concatenate", "(", "[", "self", ".", "latents", ",", "np", ".", "expand_dims", "(", "colors", ",", "-", "1", ")", "]", ",", "-", "1", ")", "\n", "self", ".", "batch_size", "=", "batch_size", "\n", "\n", "self", ".", "color_palattes", "=", "self", ".", "retrieve_colors", "(", "num_domains", ")", "\n", "self", ".", "split", "=", "split", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.reset_batch": [[281, 287], ["enumerate", "torch.split", "len", "torch.randperm", "len"], "methods", ["None"], ["", "def", "reset_batch", "(", "self", ")", ":", "\n", "        ", "\"\"\"Reset batch indices for each domain.\"\"\"", "\n", "self", ".", "batch_indices", ",", "self", ".", "batches_left", "=", "{", "}", ",", "{", "}", "\n", "for", "loc", ",", "env_idx", "in", "enumerate", "(", "self", ".", "domain_indices", ")", ":", "\n", "            ", "self", ".", "batch_indices", "[", "loc", "]", "=", "torch", ".", "split", "(", "env_idx", "[", "torch", ".", "randperm", "(", "len", "(", "env_idx", ")", ")", "]", ",", "self", ".", "batch_size", ")", "\n", "self", ".", "batches_left", "[", "loc", "]", "=", "len", "(", "self", ".", "batch_indices", "[", "loc", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.get_batch": [[288, 293], ["torch.stack", "len", "datasets.CDsprites_Dataset.get_input", "torch.Tensor"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.get_input"], ["", "", "def", "get_batch", "(", "self", ",", "domain", ")", ":", "\n", "        ", "\"\"\"Return the next batch of the specified domain.\"\"\"", "\n", "batch_index", "=", "self", ".", "batch_indices", "[", "domain", "]", "[", "len", "(", "self", ".", "batch_indices", "[", "domain", "]", ")", "-", "self", ".", "batches_left", "[", "domain", "]", "]", "\n", "return", "torch", ".", "stack", "(", "[", "self", ".", "get_input", "(", "i", ",", "domain", ")", "[", "0", "]", "for", "i", "in", "batch_index", "]", ")", ",", "(", "torch", ".", "Tensor", "(", "self", ".", "latents", "[", "batch_index", "]", ")", "[", ":", ",", "0", "]", "-", "1", ")", ".", "long", "(", ")", ",", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.compute_split": [[295, 310], ["os.makedirs", "os.path.join", "torch.load", "len", "os.path.join", "os.path.exists", "torch.save", "split_indices.append", "torch.tensor", "int", "torch.randperm", "len"], "methods", ["None"], ["", "def", "compute_split", "(", "self", ",", "n_splits", ",", "data_dir", ")", ":", "\n", "        ", "os", ".", "makedirs", "(", "os", ".", "path", ".", "join", "(", "data_dir", ",", "'cdsprites'", ")", ",", "exist_ok", "=", "True", ")", "\n", "path", "=", "os", ".", "path", ".", "join", "(", "data_dir", ",", "'cdsprites'", ",", "f'train_test_val_split.pt'", ")", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "path", ")", ":", "\n", "            ", "torch", ".", "save", "(", "torch", ".", "tensor", "(", "self", ".", "indices", "[", "torch", ".", "randperm", "(", "len", "(", "self", ".", "indices", ")", ")", "]", ")", ",", "path", ")", "\n", "", "rand_indices", "=", "torch", ".", "load", "(", "path", ")", "\n", "N", "=", "len", "(", "rand_indices", ")", "\n", "\n", "split_indices", "=", "[", "]", "\n", "start_idx", "=", "0", "\n", "for", "split", "in", "n_splits", ":", "\n", "            ", "end_idx", "=", "start_idx", "+", "int", "(", "N", "*", "split", ")", "\n", "split_indices", ".", "append", "(", "rand_indices", "[", "start_idx", ":", "end_idx", "]", ")", "\n", "start_idx", "=", "end_idx", "\n", "", "return", "split_indices", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.retrieve_colors": [[311, 314], ["os.path.join", "torch.load"], "methods", ["None"], ["", "def", "retrieve_colors", "(", "self", ",", "total_envs", "=", "10", ")", ":", "\n", "        ", "path", "=", "os", ".", "path", ".", "join", "(", "self", ".", "data_dir", ",", "'cdsprites'", ",", "f'colors_{total_envs}.pt'", ")", "\n", "return", "torch", ".", "load", "(", "path", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.get_input": [[315, 326], ["torch.Tensor", "torch.Tensor", "len", "torch.zeros_like().repeat", "enumerate", "datasets.CDsprites_Dataset.get_domain_color_palatte", "zip", "datasets.CDsprites_Dataset.get_domain_color_palatte", "torch.zeros_like"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.get_domain_color_palatte", "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.get_domain_color_palatte"], ["", "def", "get_input", "(", "self", ",", "idx", ",", "env", ")", ":", "\n", "        ", "image", "=", "torch", ".", "Tensor", "(", "self", ".", "images", "[", "idx", "]", ")", "\n", "latent", "=", "torch", ".", "Tensor", "(", "self", ".", "latents", "[", "idx", "]", ")", "\n", "\n", "if", "len", "(", "image", ".", "shape", ")", ">", "3", ":", "\n", "            ", "canvas", "=", "torch", ".", "zeros_like", "(", "image", ")", ".", "repeat", "(", "1", ",", "3", ",", "1", ",", "1", ")", "\n", "for", "c", ",", "(", "img", ",", "l", ")", "in", "enumerate", "(", "zip", "(", "image", ",", "latent", ")", ")", ":", "\n", "                ", "canvas", "[", "c", ",", "...", "]", "=", "self", ".", "get_domain_color_palatte", "(", "img", ",", "l", ",", "env", ")", "\n", "", "", "else", ":", "\n", "            ", "canvas", "=", "self", ".", "get_domain_color_palatte", "(", "image", ",", "latent", ",", "env", ")", "\n", "", "return", "(", "canvas", ",", "latent", ",", "None", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.__len__": [[328, 330], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "latents", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.__getitem__": [[331, 342], ["torch.Tensor", "torch.Tensor", "len", "torch.zeros_like().repeat", "enumerate", "datasets.CDsprites_Dataset.get_color_palatte", "zip", "datasets.CDsprites_Dataset.get_color_palatte", "latent[].long", "torch.zeros_like"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.get_color_palatte", "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.get_color_palatte"], ["", "def", "__getitem__", "(", "self", ",", "idx", ")", ":", "\n", "        ", "image", "=", "torch", ".", "Tensor", "(", "self", ".", "images", "[", "idx", "]", ")", "\n", "latent", "=", "torch", ".", "Tensor", "(", "self", ".", "latents", "[", "idx", "]", ")", "\n", "\n", "if", "len", "(", "image", ".", "shape", ")", ">", "3", ":", "\n", "            ", "canvas", "=", "torch", ".", "zeros_like", "(", "image", ")", ".", "repeat", "(", "1", ",", "3", ",", "1", ",", "1", ")", "\n", "for", "c", ",", "(", "img", ",", "l", ")", "in", "enumerate", "(", "zip", "(", "image", ",", "latent", ")", ")", ":", "\n", "                ", "canvas", "[", "c", ",", "...", "]", "=", "self", ".", "get_color_palatte", "(", "img", ",", "l", ")", "\n", "", "", "else", ":", "\n", "            ", "canvas", "=", "self", ".", "get_color_palatte", "(", "image", ",", "latent", ")", "\n", "", "return", "(", "canvas", ",", "latent", "[", "0", "]", ".", "long", "(", ")", "-", "1", ",", "latent", "[", "0", ":", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.get_color_palatte": [[343, 349], ["torch.randint().item", "int", "torch.randint().item", "torch.randint", "latent[].long", "torch.randint", "len"], "methods", ["None"], ["", "def", "get_color_palatte", "(", "self", ",", "image", ",", "latent", ")", ":", "\n", "        ", "chosen_color", "=", "torch", ".", "randint", "(", "high", "=", "len", "(", "self", ".", "color_palattes", ")", "-", "1", ",", "size", "=", "(", "1", ",", ")", ")", ".", "item", "(", ")", "\n", "cc", "=", "int", "(", "latent", "[", "-", "1", "]", ".", "long", "(", ")", ")", "if", "self", ".", "split", "==", "'train'", "else", "torch", ".", "randint", "(", "high", "=", "2", ",", "size", "=", "(", "1", ",", ")", ")", ".", "item", "(", ")", "\n", "canvas", "=", "self", ".", "color_palattes", "[", "chosen_color", "]", "[", "cc", "]", "\n", "return", "canvas", "*", "image", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.get_domain_color_palatte": [[350, 354], ["int", "latent[].long"], "methods", ["None"], ["", "def", "get_domain_color_palatte", "(", "self", ",", "image", ",", "latent", ",", "chosen_color", ")", ":", "\n", "        ", "cc", "=", "int", "(", "latent", "[", "-", "1", "]", ".", "long", "(", ")", ")", "\n", "canvas", "=", "self", ".", "color_palattes", "[", "chosen_color", "]", "[", "cc", "]", "\n", "return", "canvas", "*", "image", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.CDsprites_Dataset.eval": [[355, 363], ["ys.size"], "methods", ["None"], ["", "def", "eval", "(", "self", ",", "ypreds", ",", "ys", ",", "metas", ")", ":", "\n", "        ", "total", "=", "ys", ".", "size", "(", "0", ")", "\n", "correct", "=", "(", "ypreds", "==", "ys", ")", ".", "sum", "(", ")", ".", "item", "(", ")", "\n", "test_val", "=", "[", "\n", "{", "'acc_avg'", ":", "correct", "/", "total", "}", ",", "\n", "f\"Accuracy: {correct/total*100:6.2f}%\"", "\n", "]", "\n", "return", "test_val", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__init__": [[371, 395], ["os.path.isfile", "datasets.DspritesDataset.download_dataset", "numpy.load", "numpy.load", "datasets.DspritesDataset.split_dataset", "os.path.isfile", "os.path.isfile"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.download_dataset", "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.split_dataset"], ["def", "__init__", "(", "self", ",", "data_root", ",", "train", "=", "True", ",", "train_fract", "=", "0.8", ",", "split", "=", "True", ",", "clip", "=", "False", ")", ":", "\n", "        ", "\"\"\"\n        Args:\n            npz_file (string): Path to the npz file.\n        \"\"\"", "\n", "filename", "=", "'dsprites_ndarray_co1sh3sc6or40x32y32_64x64.npz'", "\n", "self", ".", "npz_file", "=", "data_root", "+", "'/'", "+", "filename", "\n", "self", ".", "npz_train_file", "=", "data_root", "+", "'/train_'", "+", "filename", "\n", "self", ".", "npz_test_file", "=", "data_root", "+", "'/test_'", "+", "filename", "\n", "if", "not", "os", ".", "path", ".", "isfile", "(", "self", ".", "npz_file", ")", ":", "\n", "            ", "self", ".", "download_dataset", "(", "self", ".", "npz_file", ")", "\n", "", "if", "split", ":", "\n", "            ", "if", "not", "(", "os", ".", "path", ".", "isfile", "(", "self", ".", "npz_train_file", ")", "and", "os", ".", "path", ".", "isfile", "(", "self", ".", "npz_test_file", ")", ")", ":", "\n", "                ", "self", ".", "split_dataset", "(", "data_root", ",", "self", ".", "npz_file", ",", "self", ".", "npz_train_file", ",", "\n", "self", ".", "npz_test_file", ",", "train_fract", ",", "clip", ")", "\n", "", "dataset", "=", "np", ".", "load", "(", "self", ".", "npz_train_file", "if", "train", "else", "self", ".", "npz_test_file", ",", "\n", "mmap_mode", "=", "'r'", ")", "\n", "", "else", ":", "\n", "            ", "rdataset", "=", "np", ".", "load", "(", "self", ".", "npz_file", ",", "encoding", "=", "'latin1'", ",", "mmap_mode", "=", "'r'", ")", "\n", "dataset", "=", "{", "'latents'", ":", "rdataset", "[", "'latents_values'", "]", "[", ":", ",", "1", ":", "]", ",", "# drop colour", "\n", "'images'", ":", "rdataset", "[", "'imgs'", "]", "}", "\n", "\n", "", "self", ".", "latents", "=", "dataset", "[", "'latents'", "]", "\n", "self", ".", "images", "=", "dataset", "[", "'images'", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.download_dataset": [[396, 404], ["print", "request.urlopen", "open", "f.write", "request.urlopen.read"], "methods", ["home.repos.pwc.inspect_result.YugeTen_fish.src.utils.Logger.write"], ["", "def", "download_dataset", "(", "self", ",", "npz_file", ")", ":", "\n", "        ", "from", "urllib", "import", "request", "\n", "url", "=", "'https://github.com/deepmind/dsprites-dataset/blob/master/'", "'dsprites_ndarray_co1sh3sc6or40x32y32_64x64.npz?raw=true'", "\n", "print", "(", "'Downloading '", "+", "url", ")", "\n", "data", "=", "request", ".", "urlopen", "(", "url", ")", "\n", "with", "open", "(", "npz_file", ",", "'wb'", ")", "as", "f", ":", "\n", "            ", "f", ".", "write", "(", "data", ".", "read", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.split_dataset": [[405, 421], ["print", "numpy.load", "numpy.array", "numpy.clip.reshape", "numpy.int", "numpy.random.permutation", "numpy.savez", "numpy.savez", "numpy.clip", "len", "len", "range", "range", "len"], "methods", ["None"], ["", "", "def", "split_dataset", "(", "self", ",", "data_root", ",", "npz_file", ",", "npz_train_file", ",", "npz_test_file", ",", "train_fract", ",", "clip", ")", ":", "\n", "        ", "print", "(", "'Splitting dataset'", ")", "\n", "dataset", "=", "np", ".", "load", "(", "npz_file", ",", "encoding", "=", "'latin1'", ",", "mmap_mode", "=", "'r'", ")", "\n", "latents", "=", "dataset", "[", "'latents_values'", "]", "[", ":", ",", "1", ":", "]", "\n", "images", "=", "np", ".", "array", "(", "dataset", "[", "'imgs'", "]", ",", "dtype", "=", "'float32'", ")", "\n", "images", "=", "images", ".", "reshape", "(", "-", "1", ",", "*", "DspritesDataSize", ")", "\n", "if", "clip", ":", "\n", "            ", "images", "=", "np", ".", "clip", "(", "images", ",", "1e-6", ",", "1", "-", "1e-6", ")", "\n", "\n", "", "split_idx", "=", "np", ".", "int", "(", "train_fract", "*", "len", "(", "latents", ")", ")", "\n", "shuffled_range", "=", "np", ".", "random", ".", "permutation", "(", "len", "(", "latents", ")", ")", "\n", "train_idx", "=", "shuffled_range", "[", "range", "(", "0", ",", "split_idx", ")", "]", "\n", "test_idx", "=", "shuffled_range", "[", "range", "(", "split_idx", ",", "len", "(", "latents", ")", ")", "]", "\n", "\n", "np", ".", "savez", "(", "npz_train_file", ",", "images", "=", "images", "[", "train_idx", "]", ",", "latents", "=", "latents", "[", "train_idx", "]", ")", "\n", "np", ".", "savez", "(", "npz_test_file", ",", "images", "=", "images", "[", "test_idx", "]", ",", "latents", "=", "latents", "[", "test_idx", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__len__": [[422, 424], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "latents", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.YugeTen_fish.models.datasets.DspritesDataset.__getitem__": [[425, 429], ["torch.Tensor().unsqueeze", "torch.Tensor", "torch.Tensor"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "idx", ")", ":", "\n", "        ", "image", "=", "torch", ".", "Tensor", "(", "self", ".", "images", "[", "idx", "]", ")", ".", "unsqueeze", "(", "0", ")", "\n", "latent", "=", "torch", ".", "Tensor", "(", "self", ".", "latents", "[", "idx", "]", ")", "\n", "return", "(", "image", ",", "latent", ")", "", "", "", ""]]}