{"home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.options.set": [[7, 89], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args", "int", "numpy.array", "numpy.array", "numpy.load", "print", "print", "print", "print", "print", "print", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "int", "int", "int", "numpy.floor", "print", "print", "print", "parser.parse_args.inSize.split", "parser.parse_args.outSize.split", "parser.parse_args.predSize.split", "numpy.sqrt", "util.toGreen", "util.toGreen", "util.toYellow", "util.toYellow", "util.toYellow", "util.toYellow", "util.toYellow", "util.toYellow", "util.toYellow", "util.toYellow", "util.toYellow", "util.toYellow", "util.toYellow", "util.toMagenta", "util.toYellow", "util.toYellow", "util.toYellow", "util.toYellow"], "function", ["home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toGreen", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toGreen", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toYellow", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toYellow", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toYellow", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toYellow", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toYellow", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toYellow", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toYellow", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toYellow", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toYellow", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toYellow", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toYellow", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toMagenta", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toYellow", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toYellow", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toYellow", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toYellow"], ["def", "set", "(", "training", ")", ":", "\n", "\n", "# parse input arguments", "\n", "\t", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n", "parser", ".", "add_argument", "(", "\"--category\"", ",", "default", "=", "\"03001627\"", ",", "help", "=", "\"category ID number\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--group\"", ",", "default", "=", "\"0\"", ",", "help", "=", "\"name for group\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--model\"", ",", "default", "=", "\"test\"", ",", "help", "=", "\"name for model instance\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--load\"", ",", "default", "=", "None", ",", "help", "=", "\"load trained model to fine-tune/evaluate\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--std\"", ",", "type", "=", "float", ",", "default", "=", "0.1", ",", "help", "=", "\"initialization standard deviation\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--outViewN\"", ",", "type", "=", "int", ",", "default", "=", "8", ",", "help", "=", "\"number of fixed views (output)\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--inSize\"", ",", "default", "=", "\"64x64\"", ",", "help", "=", "\"resolution of encoder input\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--outSize\"", ",", "default", "=", "\"128x128\"", ",", "help", "=", "\"resolution of decoder output\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--predSize\"", ",", "default", "=", "\"128x128\"", ",", "help", "=", "\"resolution of prediction\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--upscale\"", ",", "type", "=", "int", ",", "default", "=", "5", ",", "help", "=", "\"upscaling factor for rendering\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--novelN\"", ",", "type", "=", "int", ",", "default", "=", "5", ",", "help", "=", "\"number of novel views simultaneously\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--arch\"", ",", "default", "=", "None", ")", "\n", "if", "training", ":", "# training", "\n", "\t\t", "parser", ".", "add_argument", "(", "\"--batchSize\"", ",", "type", "=", "int", ",", "default", "=", "20", ",", "help", "=", "\"batch size for training\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--chunkSize\"", ",", "type", "=", "int", ",", "default", "=", "100", ",", "help", "=", "\"data chunk size to load\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--itPerChunk\"", ",", "type", "=", "int", ",", "default", "=", "50", ",", "help", "=", "\"training iterations per chunk\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--lr\"", ",", "type", "=", "float", ",", "default", "=", "1e-4", ",", "help", "=", "\"base learning rate (AE)\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--lrDecay\"", ",", "type", "=", "float", ",", "default", "=", "1.0", ",", "help", "=", "\"learning rate decay multiplier\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--lrStep\"", ",", "type", "=", "int", ",", "default", "=", "20000", ",", "help", "=", "\"learning rate decay step size\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--lambdaDepth\"", ",", "type", "=", "float", ",", "default", "=", "1.0", ",", "help", "=", "\"loss weight factor (depth)\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--fromIt\"", ",", "type", "=", "int", ",", "default", "=", "0", ",", "help", "=", "\"resume training from iteration number\"", ")", "\n", "parser", ".", "add_argument", "(", "\"--toIt\"", ",", "type", "=", "int", ",", "default", "=", "100000", ",", "help", "=", "\"run training to iteration number\"", ")", "\n", "", "else", ":", "# evaluation", "\n", "\t\t", "parser", ".", "add_argument", "(", "\"--batchSize\"", ",", "type", "=", "int", ",", "default", "=", "1", ",", "help", "=", "\"batch size for evaluation\"", ")", "\n", "", "opt", "=", "parser", ".", "parse_args", "(", ")", "\n", "\n", "# these stay fixed", "\n", "opt", ".", "sampleN", "=", "100", "\n", "opt", ".", "renderDepth", "=", "1.0", "\n", "opt", ".", "BNepsilon", "=", "1e-5", "\n", "opt", ".", "BNdecay", "=", "0.999", "\n", "opt", ".", "inputViewN", "=", "24", "\n", "# ------ below automatically set ------", "\n", "opt", ".", "training", "=", "training", "\n", "opt", ".", "inH", ",", "opt", ".", "inW", "=", "[", "int", "(", "x", ")", "for", "x", "in", "opt", ".", "inSize", ".", "split", "(", "\"x\"", ")", "]", "\n", "opt", ".", "outH", ",", "opt", ".", "outW", "=", "[", "int", "(", "x", ")", "for", "x", "in", "opt", ".", "outSize", ".", "split", "(", "\"x\"", ")", "]", "\n", "opt", ".", "H", ",", "opt", ".", "W", "=", "[", "int", "(", "x", ")", "for", "x", "in", "opt", ".", "predSize", ".", "split", "(", "\"x\"", ")", "]", "\n", "opt", ".", "visBlockSize", "=", "int", "(", "np", ".", "floor", "(", "np", ".", "sqrt", "(", "opt", ".", "batchSize", ")", ")", ")", "\n", "opt", ".", "Khom3Dto2D", "=", "np", ".", "array", "(", "[", "[", "opt", ".", "W", ",", "0", ",", "0", ",", "opt", ".", "W", "/", "2", "]", ",", "\n", "[", "0", ",", "-", "opt", ".", "H", ",", "0", ",", "opt", ".", "H", "/", "2", "]", ",", "\n", "[", "0", ",", "0", ",", "-", "1", ",", "0", "]", ",", "\n", "[", "0", ",", "0", ",", "0", ",", "1", "]", "]", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "opt", ".", "Khom2Dto3D", "=", "np", ".", "array", "(", "[", "[", "opt", ".", "outW", ",", "0", ",", "0", ",", "opt", ".", "outW", "/", "2", "]", ",", "\n", "[", "0", ",", "-", "opt", ".", "outH", ",", "0", ",", "opt", ".", "outH", "/", "2", "]", ",", "\n", "[", "0", ",", "0", ",", "-", "1", ",", "0", "]", ",", "\n", "[", "0", ",", "0", ",", "0", ",", "1", "]", "]", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "opt", ".", "fuseTrans", "=", "np", ".", "load", "(", "\"trans_fuse{0}.npy\"", ".", "format", "(", "opt", ".", "outViewN", ")", ")", "\n", "\n", "print", "(", "\"({0}) {1}\"", ".", "format", "(", "\n", "util", ".", "toGreen", "(", "\"{0}\"", ".", "format", "(", "opt", ".", "group", ")", ")", ",", "\n", "util", ".", "toGreen", "(", "\"{0}\"", ".", "format", "(", "opt", ".", "model", ")", ")", ")", ")", "\n", "print", "(", "\"------------------------------------------\"", ")", "\n", "print", "(", "\"batch size: {0}, category: {1}\"", ".", "format", "(", "\n", "util", ".", "toYellow", "(", "\"{0}\"", ".", "format", "(", "opt", ".", "batchSize", ")", ")", ",", "\n", "util", ".", "toYellow", "(", "\"{0}\"", ".", "format", "(", "opt", ".", "category", ")", ")", ")", ")", "\n", "print", "(", "\"size: {0}x{1}(in), {2}x{3}(out), {4}x{5}(pred)\"", ".", "format", "(", "\n", "util", ".", "toYellow", "(", "\"{0}\"", ".", "format", "(", "opt", ".", "inH", ")", ")", ",", "\n", "util", ".", "toYellow", "(", "\"{0}\"", ".", "format", "(", "opt", ".", "inW", ")", ")", ",", "\n", "util", ".", "toYellow", "(", "\"{0}\"", ".", "format", "(", "opt", ".", "outH", ")", ")", ",", "\n", "util", ".", "toYellow", "(", "\"{0}\"", ".", "format", "(", "opt", ".", "outW", ")", ")", ",", "\n", "util", ".", "toYellow", "(", "\"{0}\"", ".", "format", "(", "opt", ".", "H", ")", ")", ",", "\n", "util", ".", "toYellow", "(", "\"{0}\"", ".", "format", "(", "opt", ".", "W", ")", ")", ")", ")", "\n", "if", "training", ":", "\n", "\t\t", "print", "(", "\"learning rate: {0} (decay: {1}, step size: {2})\"", ".", "format", "(", "\n", "util", ".", "toYellow", "(", "\"{0:.2e}\"", ".", "format", "(", "opt", ".", "lr", ")", ")", ",", "\n", "util", ".", "toYellow", "(", "\"{0}\"", ".", "format", "(", "opt", ".", "lrDecay", ")", ")", ",", "\n", "util", ".", "toYellow", "(", "\"{0}\"", ".", "format", "(", "opt", ".", "lrStep", ")", ")", ")", ")", "\n", "print", "(", "\"depth loss weight: {0}\"", ".", "format", "(", "\n", "util", ".", "toYellow", "(", "\"{0}\"", ".", "format", "(", "opt", ".", "lambdaDepth", ")", ")", ")", ")", "\n", "", "print", "(", "\"viewN: {0}(out), upscale: {1}, novelN: {2}\"", ".", "format", "(", "\n", "util", ".", "toYellow", "(", "\"{0}\"", ".", "format", "(", "opt", ".", "outViewN", ")", ")", ",", "\n", "util", ".", "toYellow", "(", "\"{0}\"", ".", "format", "(", "opt", ".", "upscale", ")", ")", ",", "\n", "util", ".", "toYellow", "(", "\"{0}\"", ".", "format", "(", "opt", ".", "novelN", ")", ")", ")", ")", "\n", "print", "(", "\"------------------------------------------\"", ")", "\n", "if", "training", ":", "\n", "\t\t", "print", "(", "util", ".", "toMagenta", "(", "\"training model ({0}) {1}...\"", ".", "format", "(", "opt", ".", "group", ",", "opt", ".", "model", ")", ")", ")", "\n", "\n", "", "return", "opt", "\n", "", ""]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.encoder": [[7, 32], ["graph.createVariable", "graph.batchNormalization", "tensorflow.nn.relu", "graph.createVariable", "graph.batchNormalization", "tensorflow.nn.relu", "tensorflow.variable_scope", "tensorflow.reshape", "tensorflow.nn.conv2d", "tensorflow.matmul", "tensorflow.variable_scope", "graph.encoder.conv2Layer"], "function", ["home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.createVariable", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.batchNormalization", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.createVariable", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.batchNormalization"], ["def", "encoder", "(", "opt", ",", "image", ")", ":", "# [B,H,W,3]", "\n", "\t", "def", "conv2Layer", "(", "opt", ",", "feat", ",", "outDim", ")", ":", "\n", "\t\t", "weight", ",", "bias", "=", "createVariable", "(", "opt", ",", "[", "3", ",", "3", ",", "int", "(", "feat", ".", "shape", "[", "-", "1", "]", ")", ",", "outDim", "]", ")", "\n", "conv", "=", "tf", ".", "nn", ".", "conv2d", "(", "feat", ",", "weight", ",", "strides", "=", "[", "1", ",", "2", ",", "2", ",", "1", "]", ",", "padding", "=", "\"SAME\"", ")", "+", "bias", "\n", "batchnorm", "=", "batchNormalization", "(", "opt", ",", "conv", ",", "type", "=", "\"conv\"", ")", "\n", "relu", "=", "tf", ".", "nn", ".", "relu", "(", "batchnorm", ")", "\n", "return", "relu", "\n", "", "def", "linearLayer", "(", "opt", ",", "feat", ",", "outDim", ",", "final", "=", "False", ")", ":", "\n", "\t\t", "weight", ",", "bias", "=", "createVariable", "(", "opt", ",", "[", "int", "(", "feat", ".", "shape", "[", "-", "1", "]", ")", ",", "outDim", "]", ")", "\n", "fc", "=", "tf", ".", "matmul", "(", "feat", ",", "weight", ")", "+", "bias", "\n", "batchnorm", "=", "batchNormalization", "(", "opt", ",", "fc", ",", "type", "=", "\"fc\"", ")", "\n", "relu", "=", "tf", ".", "nn", ".", "relu", "(", "batchnorm", ")", "\n", "return", "relu", "if", "not", "final", "else", "fc", "\n", "", "with", "tf", ".", "variable_scope", "(", "\"encoder\"", ")", ":", "\n", "\t\t", "feat", "=", "image", "\n", "with", "tf", ".", "variable_scope", "(", "\"conv1\"", ")", ":", "feat", "=", "conv2Layer", "(", "opt", ",", "feat", ",", "96", ")", "# 32x32", "\n", "with", "tf", ".", "variable_scope", "(", "\"conv2\"", ")", ":", "feat", "=", "conv2Layer", "(", "opt", ",", "feat", ",", "128", ")", "# 16x16", "\n", "with", "tf", ".", "variable_scope", "(", "\"conv3\"", ")", ":", "feat", "=", "conv2Layer", "(", "opt", ",", "feat", ",", "192", ")", "# 8x8", "\n", "with", "tf", ".", "variable_scope", "(", "\"conv4\"", ")", ":", "feat", "=", "conv2Layer", "(", "opt", ",", "feat", ",", "256", ")", "# 4x4", "\n", "feat", "=", "tf", ".", "reshape", "(", "feat", ",", "[", "opt", ".", "batchSize", ",", "-", "1", "]", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"fc1\"", ")", ":", "feat", "=", "linearLayer", "(", "opt", ",", "feat", ",", "2048", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"fc2\"", ")", ":", "feat", "=", "linearLayer", "(", "opt", ",", "feat", ",", "1024", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"fc3\"", ")", ":", "feat", "=", "linearLayer", "(", "opt", ",", "feat", ",", "512", ",", "final", "=", "True", ")", "\n", "latent", "=", "feat", "\n", "", "return", "latent", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.decoder": [[34, 67], ["graph.createVariable", "graph.batchNormalization", "tensorflow.nn.relu", "tensorflow.image.resize_images", "graph.createVariable", "graph.batchNormalization", "tensorflow.nn.relu", "graph.createVariable", "tensorflow.variable_scope", "tensorflow.nn.relu", "tensorflow.reshape", "tensorflow.split", "tensorflow.matmul", "int", "int", "tensorflow.nn.conv2d", "tensorflow.nn.conv2d", "tensorflow.variable_scope", "graph.encoder.linearLayer"], "function", ["home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.createVariable", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.batchNormalization", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.createVariable", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.batchNormalization", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.createVariable"], ["", "def", "decoder", "(", "opt", ",", "latent", ")", ":", "\n", "\t", "def", "linearLayer", "(", "opt", ",", "feat", ",", "outDim", ")", ":", "\n", "\t\t", "weight", ",", "bias", "=", "createVariable", "(", "opt", ",", "[", "int", "(", "feat", ".", "shape", "[", "-", "1", "]", ")", ",", "outDim", "]", ")", "\n", "fc", "=", "tf", ".", "matmul", "(", "feat", ",", "weight", ")", "+", "bias", "\n", "batchnorm", "=", "batchNormalization", "(", "opt", ",", "fc", ",", "type", "=", "\"fc\"", ")", "\n", "relu", "=", "tf", ".", "nn", ".", "relu", "(", "batchnorm", ")", "\n", "return", "relu", "\n", "", "def", "deconv2Layer", "(", "opt", ",", "feat", ",", "outDim", ")", ":", "\n", "\t\t", "H", ",", "W", "=", "int", "(", "feat", ".", "shape", "[", "1", "]", ")", ",", "int", "(", "feat", ".", "shape", "[", "2", "]", ")", "\n", "resize", "=", "tf", ".", "image", ".", "resize_images", "(", "feat", ",", "[", "H", "*", "2", ",", "W", "*", "2", "]", ",", "method", "=", "tf", ".", "image", ".", "ResizeMethod", ".", "NEAREST_NEIGHBOR", ")", "\n", "weight", ",", "bias", "=", "createVariable", "(", "opt", ",", "[", "3", ",", "3", ",", "int", "(", "feat", ".", "shape", "[", "-", "1", "]", ")", ",", "outDim", "]", ",", "stddev", "=", "opt", ".", "std", ")", "\n", "conv", "=", "tf", ".", "nn", ".", "conv2d", "(", "resize", ",", "weight", ",", "strides", "=", "[", "1", ",", "1", ",", "1", ",", "1", "]", ",", "padding", "=", "\"SAME\"", ")", "+", "bias", "\n", "batchnorm", "=", "batchNormalization", "(", "opt", ",", "conv", ",", "type", "=", "\"conv\"", ")", "\n", "relu", "=", "tf", ".", "nn", ".", "relu", "(", "batchnorm", ")", "\n", "return", "relu", "\n", "", "def", "pixelconv2Layer", "(", "opt", ",", "feat", ",", "outDim", ")", ":", "\n", "\t\t", "weight", ",", "bias", "=", "createVariable", "(", "opt", ",", "[", "1", ",", "1", ",", "int", "(", "feat", ".", "shape", "[", "-", "1", "]", ")", ",", "outDim", "]", ",", "gridInit", "=", "True", ")", "\n", "conv", "=", "tf", ".", "nn", ".", "conv2d", "(", "feat", ",", "weight", ",", "strides", "=", "[", "1", ",", "1", ",", "1", ",", "1", "]", ",", "padding", "=", "\"SAME\"", ")", "+", "bias", "\n", "return", "conv", "\n", "", "with", "tf", ".", "variable_scope", "(", "\"decoder\"", ")", ":", "\n", "\t\t", "feat", "=", "tf", ".", "nn", ".", "relu", "(", "latent", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"fc1\"", ")", ":", "feat", "=", "linearLayer", "(", "opt", ",", "feat", ",", "1024", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"fc2\"", ")", ":", "feat", "=", "linearLayer", "(", "opt", ",", "feat", ",", "2048", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"fc3\"", ")", ":", "feat", "=", "linearLayer", "(", "opt", ",", "feat", ",", "4096", ")", "\n", "feat", "=", "tf", ".", "reshape", "(", "feat", ",", "[", "opt", ".", "batchSize", ",", "4", ",", "4", ",", "-", "1", "]", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"deconv1\"", ")", ":", "feat", "=", "deconv2Layer", "(", "opt", ",", "feat", ",", "192", ")", "# 8x8", "\n", "with", "tf", ".", "variable_scope", "(", "\"deconv2\"", ")", ":", "feat", "=", "deconv2Layer", "(", "opt", ",", "feat", ",", "128", ")", "# 16x16", "\n", "with", "tf", ".", "variable_scope", "(", "\"deconv3\"", ")", ":", "feat", "=", "deconv2Layer", "(", "opt", ",", "feat", ",", "96", ")", "# 32x32", "\n", "with", "tf", ".", "variable_scope", "(", "\"deconv4\"", ")", ":", "feat", "=", "deconv2Layer", "(", "opt", ",", "feat", ",", "64", ")", "# 64x64", "\n", "with", "tf", ".", "variable_scope", "(", "\"deconv5\"", ")", ":", "feat", "=", "deconv2Layer", "(", "opt", ",", "feat", ",", "48", ")", "# 128x128", "\n", "with", "tf", ".", "variable_scope", "(", "\"pixelconv\"", ")", ":", "feat", "=", "pixelconv2Layer", "(", "opt", ",", "feat", ",", "opt", ".", "outViewN", "*", "4", ")", "# 128x128", "\n", "XYZ", ",", "maskLogit", "=", "tf", ".", "split", "(", "feat", ",", "[", "opt", ".", "outViewN", "*", "3", ",", "opt", ".", "outViewN", "]", ",", "axis", "=", "3", ")", "# [B,H,W,3V],[B,H,W,V]", "\n", "", "return", "XYZ", ",", "maskLogit", "# [B,H,W,3V],[B,H,W,V]", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.encoder_resnet": [[69, 93], ["graph.createVariable", "graph.batchNormalization", "tensorflow.nn.relu", "graph.createVariable", "graph.batchNormalization", "tensorflow.nn.relu", "tensorflow.variable_scope", "tensorflow.reshape", "tensorflow.nn.conv2d", "tensorflow.matmul", "tensorflow.variable_scope", "graph.encoder.conv2Layer"], "function", ["home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.createVariable", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.batchNormalization", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.createVariable", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.batchNormalization"], ["", "def", "encoder_resnet", "(", "opt", ",", "image", ")", ":", "# [B,H,W,3]", "\n", "\t", "def", "conv2Layer", "(", "opt", ",", "feat", ",", "outDim", ")", ":", "\n", "\t\t", "weight", ",", "bias", "=", "createVariable", "(", "opt", ",", "[", "3", ",", "3", ",", "int", "(", "feat", ".", "shape", "[", "-", "1", "]", ")", ",", "outDim", "]", ")", "\n", "conv", "=", "tf", ".", "nn", ".", "conv2d", "(", "feat", ",", "weight", ",", "strides", "=", "[", "1", ",", "2", ",", "2", ",", "1", "]", ",", "padding", "=", "\"SAME\"", ")", "+", "bias", "\n", "batchnorm", "=", "batchNormalization", "(", "opt", ",", "conv", ",", "type", "=", "\"conv\"", ")", "\n", "relu", "=", "tf", ".", "nn", ".", "relu", "(", "batchnorm", ")", "\n", "return", "relu", "\n", "", "def", "linearLayer", "(", "opt", ",", "feat", ",", "outDim", ",", "final", "=", "False", ")", ":", "\n", "\t\t", "weight", ",", "bias", "=", "createVariable", "(", "opt", ",", "[", "int", "(", "feat", ".", "shape", "[", "-", "1", "]", ")", ",", "outDim", "]", ")", "\n", "fc", "=", "tf", ".", "matmul", "(", "feat", ",", "weight", ")", "+", "bias", "\n", "batchnorm", "=", "batchNormalization", "(", "opt", ",", "fc", ",", "type", "=", "\"fc\"", ")", "\n", "relu", "=", "tf", ".", "nn", ".", "relu", "(", "batchnorm", ")", "\n", "return", "relu", "if", "not", "final", "else", "fc", "\n", "", "with", "tf", ".", "variable_scope", "(", "\"encoder\"", ")", ":", "\n", "\t\t", "feat", "=", "image", "\n", "with", "tf", ".", "variable_scope", "(", "\"conv1\"", ")", ":", "feat", "=", "conv2Layer", "(", "opt", ",", "feat", ",", "32", ")", "# 32x32", "\n", "with", "tf", ".", "variable_scope", "(", "\"conv2\"", ")", ":", "feat", "=", "conv2Layer", "(", "opt", ",", "feat", ",", "64", ")", "# 16x16", "\n", "with", "tf", ".", "variable_scope", "(", "\"conv3\"", ")", ":", "feat", "=", "conv2Layer", "(", "opt", ",", "feat", ",", "128", ")", "# 8x8", "\n", "with", "tf", ".", "variable_scope", "(", "\"conv4\"", ")", ":", "feat", "=", "conv2Layer", "(", "opt", ",", "feat", ",", "256", ")", "# 4x4", "\n", "feat", "=", "tf", ".", "reshape", "(", "feat", ",", "[", "opt", ".", "batchSize", ",", "-", "1", "]", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"fc1\"", ")", ":", "feat", "=", "linearLayer", "(", "opt", ",", "feat", ",", "1024", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"fc2\"", ")", ":", "feat", "=", "linearLayer", "(", "opt", ",", "feat", ",", "256", ",", "final", "=", "True", ")", "\n", "latent", "=", "feat", "\n", "", "return", "latent", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.decoder_resnet": [[95, 148], ["graph.createVariable", "graph.batchNormalization", "tensorflow.nn.relu", "tensorflow.image.resize_images", "graph.createVariable", "graph.batchNormalization", "tensorflow.nn.relu", "int", "graph.createVariable", "tensorflow.variable_scope", "tensorflow.nn.relu", "tensorflow.reshape", "tensorflow.split", "tensorflow.matmul", "int", "int", "tensorflow.nn.conv2d", "tensorflow.variable_scope", "graph.createVariable", "graph.batchNormalization", "tensorflow.nn.relu", "tensorflow.variable_scope", "graph.createVariable", "graph.batchNormalization", "tensorflow.nn.relu", "tensorflow.nn.conv2d", "tensorflow.variable_scope", "graph.encoder.linearLayer"], "function", ["home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.createVariable", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.batchNormalization", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.createVariable", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.batchNormalization", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.createVariable", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.createVariable", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.batchNormalization", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.createVariable", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.batchNormalization"], ["", "def", "decoder_resnet", "(", "opt", ",", "latent", ")", ":", "\n", "\t", "def", "linearLayer", "(", "opt", ",", "feat", ",", "outDim", ")", ":", "\n", "\t\t", "weight", ",", "bias", "=", "createVariable", "(", "opt", ",", "[", "int", "(", "feat", ".", "shape", "[", "-", "1", "]", ")", ",", "outDim", "]", ")", "\n", "fc", "=", "tf", ".", "matmul", "(", "feat", ",", "weight", ")", "+", "bias", "\n", "batchnorm", "=", "batchNormalization", "(", "opt", ",", "fc", ",", "type", "=", "\"fc\"", ")", "\n", "relu", "=", "tf", ".", "nn", ".", "relu", "(", "batchnorm", ")", "\n", "return", "relu", "\n", "", "def", "deconv2Layer", "(", "opt", ",", "feat", ",", "outDim", ")", ":", "\n", "\t\t", "H", ",", "W", "=", "int", "(", "feat", ".", "shape", "[", "1", "]", ")", ",", "int", "(", "feat", ".", "shape", "[", "2", "]", ")", "\n", "resize", "=", "tf", ".", "image", ".", "resize_images", "(", "feat", ",", "[", "H", "*", "2", ",", "W", "*", "2", "]", ",", "method", "=", "tf", ".", "image", ".", "ResizeMethod", ".", "NEAREST_NEIGHBOR", ")", "\n", "weight", ",", "bias", "=", "createVariable", "(", "opt", ",", "[", "3", ",", "3", ",", "int", "(", "feat", ".", "shape", "[", "-", "1", "]", ")", ",", "outDim", "]", ",", "stddev", "=", "opt", ".", "std", ")", "\n", "conv", "=", "tf", ".", "nn", ".", "conv2d", "(", "resize", ",", "weight", ",", "strides", "=", "[", "1", ",", "1", ",", "1", ",", "1", "]", ",", "padding", "=", "\"SAME\"", ")", "+", "bias", "\n", "batchnorm", "=", "batchNormalization", "(", "opt", ",", "conv", ",", "type", "=", "\"conv\"", ")", "\n", "relu", "=", "tf", ".", "nn", ".", "relu", "(", "batchnorm", ")", "\n", "return", "relu", "\n", "", "def", "residualBlock", "(", "opt", ",", "feat", ")", ":", "\n", "\t\t", "dim", "=", "int", "(", "feat", ".", "shape", "[", "-", "1", "]", ")", "\n", "feat_identity", "=", "feat", "\n", "with", "tf", ".", "variable_scope", "(", "\"conva\"", ")", ":", "\n", "\t\t\t", "weight", ",", "bias", "=", "createVariable", "(", "opt", ",", "[", "3", ",", "3", ",", "dim", ",", "dim", "]", ",", "stddev", "=", "opt", ".", "std", ")", "\n", "conv", "=", "tf", ".", "nn", ".", "conv2d", "(", "feat", ",", "weight", ",", "strides", "=", "[", "1", ",", "1", ",", "1", ",", "1", "]", ",", "padding", "=", "\"SAME\"", ")", "+", "bias", "\n", "batchnorm", "=", "batchNormalization", "(", "opt", ",", "conv", ",", "type", "=", "\"conv\"", ")", "\n", "feat", "=", "tf", ".", "nn", ".", "relu", "(", "batchnorm", ")", "\n", "", "with", "tf", ".", "variable_scope", "(", "\"convb\"", ")", ":", "\n", "\t\t\t", "weight", ",", "bias", "=", "createVariable", "(", "opt", ",", "[", "3", ",", "3", ",", "dim", ",", "dim", "]", ",", "stddev", "=", "opt", ".", "std", ")", "\n", "conv", "=", "tf", ".", "nn", ".", "conv2d", "(", "feat", ",", "weight", ",", "strides", "=", "[", "1", ",", "1", ",", "1", ",", "1", "]", ",", "padding", "=", "\"SAME\"", ")", "+", "bias", "\n", "batchnorm", "=", "batchNormalization", "(", "opt", ",", "conv", ",", "type", "=", "\"conv\"", ")", "\n", "feat", "=", "tf", ".", "nn", ".", "relu", "(", "batchnorm", ")", "\n", "", "feat", "+=", "feat_identity", "\n", "return", "feat", "\n", "", "def", "pixelconv2Layer", "(", "opt", ",", "feat", ",", "outDim", ")", ":", "\n", "\t\t", "weight", ",", "bias", "=", "createVariable", "(", "opt", ",", "[", "1", ",", "1", ",", "int", "(", "feat", ".", "shape", "[", "-", "1", "]", ")", ",", "outDim", "]", ",", "gridInit", "=", "True", ")", "\n", "conv", "=", "tf", ".", "nn", ".", "conv2d", "(", "feat", ",", "weight", ",", "strides", "=", "[", "1", ",", "1", ",", "1", ",", "1", "]", ",", "padding", "=", "\"SAME\"", ")", "+", "bias", "\n", "return", "conv", "\n", "", "with", "tf", ".", "variable_scope", "(", "\"decoder\"", ")", ":", "\n", "\t\t", "feat", "=", "tf", ".", "nn", ".", "relu", "(", "latent", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"fc1\"", ")", ":", "feat", "=", "linearLayer", "(", "opt", ",", "feat", ",", "1024", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"fc2\"", ")", ":", "feat", "=", "linearLayer", "(", "opt", ",", "feat", ",", "4096", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"fc3\"", ")", ":", "feat", "=", "linearLayer", "(", "opt", ",", "feat", ",", "16384", ")", "\n", "feat", "=", "tf", ".", "reshape", "(", "feat", ",", "[", "opt", ".", "batchSize", ",", "4", ",", "4", ",", "-", "1", "]", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"resblock1\"", ")", ":", "feat", "=", "residualBlock", "(", "opt", ",", "feat", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"deconv1\"", ")", ":", "feat", "=", "deconv2Layer", "(", "opt", ",", "feat", ",", "512", ")", "# 8x8", "\n", "with", "tf", ".", "variable_scope", "(", "\"resblock2\"", ")", ":", "feat", "=", "residualBlock", "(", "opt", ",", "feat", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"deconv2\"", ")", ":", "feat", "=", "deconv2Layer", "(", "opt", ",", "feat", ",", "256", ")", "# 16x16", "\n", "with", "tf", ".", "variable_scope", "(", "\"resblock3\"", ")", ":", "feat", "=", "residualBlock", "(", "opt", ",", "feat", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"deconv3\"", ")", ":", "feat", "=", "deconv2Layer", "(", "opt", ",", "feat", ",", "128", ")", "# 32x32", "\n", "with", "tf", ".", "variable_scope", "(", "\"resblock4\"", ")", ":", "feat", "=", "residualBlock", "(", "opt", ",", "feat", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"deconv4\"", ")", ":", "feat", "=", "deconv2Layer", "(", "opt", ",", "feat", ",", "64", ")", "# 64x64", "\n", "with", "tf", ".", "variable_scope", "(", "\"resblock5\"", ")", ":", "feat", "=", "residualBlock", "(", "opt", ",", "feat", ")", "\n", "with", "tf", ".", "variable_scope", "(", "\"deconv5\"", ")", ":", "feat", "=", "deconv2Layer", "(", "opt", ",", "feat", ",", "32", ")", "# 128x128", "\n", "with", "tf", ".", "variable_scope", "(", "\"pixelconv\"", ")", ":", "feat", "=", "pixelconv2Layer", "(", "opt", ",", "feat", ",", "opt", ".", "outViewN", "*", "4", ")", "# 128x128", "\n", "XYZ", ",", "maskLogit", "=", "tf", ".", "split", "(", "feat", ",", "[", "opt", ".", "outViewN", "*", "3", ",", "opt", ".", "outViewN", "]", ",", "axis", "=", "3", ")", "# [B,H,W,3V],[B,H,W,V]", "\n", "", "return", "XYZ", ",", "maskLogit", "# [B,H,W,3V],[B,H,W,V]", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.createVariable": [[150, 165], ["tensorflow.Variable", "tensorflow.Variable", "tensorflow.random_normal", "numpy.meshgrid", "numpy.concatenate", "numpy.expand_dims", "tensorflow.constant", "range", "range", "X.astype", "Y.astype", "numpy.transpose", "numpy.tile", "numpy.tile", "numpy.zeros", "numpy.ones"], "function", ["None"], ["", "def", "createVariable", "(", "opt", ",", "weightShape", ",", "biasShape", "=", "None", ",", "stddev", "=", "None", ",", "gridInit", "=", "False", ")", ":", "\n", "\t", "if", "biasShape", "is", "None", ":", "biasShape", "=", "[", "weightShape", "[", "-", "1", "]", "]", "\n", "weight", "=", "tf", ".", "Variable", "(", "tf", ".", "random_normal", "(", "weightShape", ",", "stddev", "=", "opt", ".", "std", ")", ",", "dtype", "=", "np", ".", "float32", ",", "name", "=", "\"weight\"", ")", "\n", "if", "gridInit", ":", "\n", "\t\t", "X", ",", "Y", "=", "np", ".", "meshgrid", "(", "range", "(", "opt", ".", "outW", ")", ",", "range", "(", "opt", ".", "outH", ")", ",", "indexing", "=", "\"xy\"", ")", "# [H,W]", "\n", "X", ",", "Y", "=", "X", ".", "astype", "(", "np", ".", "float32", ")", ",", "Y", ".", "astype", "(", "np", ".", "float32", ")", "\n", "initTile", "=", "np", ".", "concatenate", "(", "[", "np", ".", "tile", "(", "X", ",", "[", "opt", ".", "outViewN", ",", "1", ",", "1", "]", ")", ",", "\n", "np", ".", "tile", "(", "Y", ",", "[", "opt", ".", "outViewN", ",", "1", ",", "1", "]", ")", ",", "\n", "np", ".", "ones", "(", "[", "opt", ".", "outViewN", ",", "opt", ".", "outH", ",", "opt", ".", "outW", "]", ",", "dtype", "=", "np", ".", "float32", ")", "*", "opt", ".", "renderDepth", ",", "\n", "np", ".", "zeros", "(", "[", "opt", ".", "outViewN", ",", "opt", ".", "outH", ",", "opt", ".", "outW", "]", ",", "dtype", "=", "np", ".", "float32", ")", "]", ",", "axis", "=", "0", ")", "# [4V,H,W]", "\n", "biasInit", "=", "np", ".", "expand_dims", "(", "np", ".", "transpose", "(", "initTile", ",", "axes", "=", "[", "1", ",", "2", ",", "0", "]", ")", ",", "axis", "=", "0", ")", "# [1,H,W,4V]", "\n", "", "else", ":", "\n", "\t\t", "biasInit", "=", "tf", ".", "constant", "(", "0.0", ",", "shape", "=", "biasShape", ")", "\n", "", "bias", "=", "tf", ".", "Variable", "(", "biasInit", ",", "dtype", "=", "np", ".", "float32", ",", "name", "=", "\"bias\"", ")", "\n", "return", "weight", ",", "bias", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.batchNormalization": [[167, 182], ["tensorflow.variable_scope", "tensorflow.get_variable", "tensorflow.get_variable", "tensorflow.assign_sub", "tensorflow.assign_sub", "tensorflow.nn.batch_normalization", "tensorflow.constant_initializer", "tensorflow.constant_initializer", "tensorflow.nn.moments", "tensorflow.control_dependencies", "tensorflow.nn.batch_normalization", "tensorflow.nn.moments"], "function", ["None"], ["", "def", "batchNormalization", "(", "opt", ",", "input", ",", "type", ")", ":", "\n", "\t", "with", "tf", ".", "variable_scope", "(", "\"batchNorm\"", ")", ":", "\n", "\t\t", "globalMean", "=", "tf", ".", "get_variable", "(", "\"mean\"", ",", "shape", "=", "[", "input", ".", "shape", "[", "-", "1", "]", "]", ",", "dtype", "=", "tf", ".", "float32", ",", "trainable", "=", "False", ",", "\n", "initializer", "=", "tf", ".", "constant_initializer", "(", "0.0", ")", ")", "\n", "globalVar", "=", "tf", ".", "get_variable", "(", "\"var\"", ",", "shape", "=", "[", "input", ".", "shape", "[", "-", "1", "]", "]", ",", "dtype", "=", "tf", ".", "float32", ",", "trainable", "=", "False", ",", "\n", "initializer", "=", "tf", ".", "constant_initializer", "(", "1.0", ")", ")", "\n", "if", "opt", ".", "training", ":", "\n", "\t\t\t", "if", "type", "==", "\"conv\"", ":", "batchMean", ",", "batchVar", "=", "tf", ".", "nn", ".", "moments", "(", "input", ",", "axes", "=", "[", "0", ",", "1", ",", "2", "]", ")", "\n", "elif", "type", "==", "\"fc\"", ":", "batchMean", ",", "batchVar", "=", "tf", ".", "nn", ".", "moments", "(", "input", ",", "axes", "=", "[", "0", "]", ")", "\n", "trainMean", "=", "tf", ".", "assign_sub", "(", "globalMean", ",", "(", "1", "-", "opt", ".", "BNdecay", ")", "*", "(", "globalMean", "-", "batchMean", ")", ")", "\n", "trainVar", "=", "tf", ".", "assign_sub", "(", "globalVar", ",", "(", "1", "-", "opt", ".", "BNdecay", ")", "*", "(", "globalVar", "-", "batchVar", ")", ")", "\n", "with", "tf", ".", "control_dependencies", "(", "[", "trainMean", ",", "trainVar", "]", ")", ":", "\n", "\t\t\t\t", "output", "=", "tf", ".", "nn", ".", "batch_normalization", "(", "input", ",", "batchMean", ",", "batchVar", ",", "None", ",", "None", ",", "opt", ".", "BNepsilon", ")", "\n", "", "", "else", ":", "output", "=", "tf", ".", "nn", ".", "batch_normalization", "(", "input", ",", "globalMean", ",", "globalVar", ",", "None", ",", "None", ",", "opt", ".", "BNepsilon", ")", "\n", "", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.l1_loss": [[184, 186], ["tensorflow.reduce_sum", "tensorflow.abs"], "function", ["None"], ["", "def", "l1_loss", "(", "input", ")", ":", "\n", "\t", "return", "tf", ".", "reduce_sum", "(", "tf", ".", "abs", "(", "input", ")", ")", "\n", "# L1 loss (masked)", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.masked_l1_loss": [[187, 189], ["graph.l1_loss", "tensorflow.boolean_mask"], "function", ["home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.l1_loss"], ["", "def", "masked_l1_loss", "(", "diff", ",", "mask", ")", ":", "\n", "\t", "return", "l1_loss", "(", "tf", ".", "boolean_mask", "(", "diff", ",", "mask", ")", ")", "\n", "# sigmoid cross-entropy loss", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.graph.cross_entropy_loss": [[190, 192], ["tensorflow.reduce_sum", "tensorflow.nn.sigmoid_cross_entropy_with_logits"], "function", ["None"], ["", "def", "cross_entropy_loss", "(", "logit", ",", "label", ")", ":", "\n", "\t", "return", "tf", ".", "reduce_sum", "(", "tf", ".", "nn", ".", "sigmoid_cross_entropy_with_logits", "(", "logits", "=", "logit", ",", "labels", "=", "label", ")", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.data.Loader.__init__": [[10, 21], ["data.Loader.CADs.sort", "open", "data.Loader.CADs.append", "line.strip().split", "line.strip"], "methods", ["None"], ["\t", "def", "__init__", "(", "self", ",", "opt", ",", "loadNovel", "=", "True", ",", "loadFixedOut", "=", "False", ",", "loadTest", "=", "False", ")", ":", "\n", "\t\t", "self", ".", "loadNovel", "=", "loadNovel", "\n", "self", ".", "loadFixedOut", "=", "loadFixedOut", "\n", "self", ".", "loadTest", "=", "loadTest", "\n", "listFile", "=", "\"data/{0}_{1}.list\"", ".", "format", "(", "opt", ".", "category", ",", "\"test\"", "if", "loadTest", "else", "\"train\"", ")", "\n", "self", ".", "CADs", "=", "[", "]", "\n", "with", "open", "(", "listFile", ")", "as", "file", ":", "\n", "\t\t\t", "for", "line", "in", "file", ":", "\n", "\t\t\t\t", "id", "=", "line", ".", "strip", "(", ")", ".", "split", "(", "\"/\"", ")", "[", "1", "]", "\n", "self", ".", "CADs", ".", "append", "(", "id", ")", "\n", "", "", "self", ".", "CADs", ".", "sort", "(", ")", "\n", "", "def", "loadChunk", "(", "self", ",", "opt", ",", "loadRange", "=", "None", ")", ":", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.data.Loader.loadChunk": [[21, 58], ["len", "numpy.ones", "range", "numpy.arange", "numpy.ones", "numpy.ones", "numpy.ones", "numpy.ones", "numpy.ones", "numpy.random.permutation", "numpy.load", "scipy.io.loadmat", "scipy.io.loadmat", "scipy.io.loadmat", "scipy.io.loadmat", "scipy.io.loadmat", "scipy.io.loadmat", "scipy.io.loadmat", "scipy.io.loadmat", "len"], "methods", ["None"], ["", "def", "loadChunk", "(", "self", ",", "opt", ",", "loadRange", "=", "None", ")", ":", "\n", "\t\t", "data", "=", "{", "}", "\n", "if", "loadRange", "is", "not", "None", ":", "idx", "=", "np", ".", "arange", "(", "loadRange", "[", "0", "]", ",", "loadRange", "[", "1", "]", ")", "\n", "else", ":", "idx", "=", "np", ".", "random", ".", "permutation", "(", "len", "(", "self", ".", "CADs", ")", ")", "[", ":", "opt", ".", "chunkSize", "]", "\n", "chunkSize", "=", "len", "(", "idx", ")", "\n", "# preallocate memory", "\n", "data", "[", "\"image_in\"", "]", "=", "np", ".", "ones", "(", "[", "chunkSize", ",", "24", ",", "opt", ".", "inH", ",", "opt", ".", "inW", ",", "3", "]", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "if", "self", ".", "loadNovel", ":", "\n", "\t\t\t", "data", "[", "\"depth\"", "]", "=", "np", ".", "ones", "(", "[", "chunkSize", ",", "opt", ".", "sampleN", ",", "opt", ".", "H", ",", "opt", ".", "W", "]", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "data", "[", "\"mask\"", "]", "=", "np", ".", "ones", "(", "[", "chunkSize", ",", "opt", ".", "sampleN", ",", "opt", ".", "H", ",", "opt", ".", "W", "]", ",", "dtype", "=", "np", ".", "bool", ")", "\n", "data", "[", "\"trans\"", "]", "=", "np", ".", "ones", "(", "[", "chunkSize", ",", "opt", ".", "sampleN", ",", "4", "]", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "", "if", "self", ".", "loadFixedOut", ":", "\n", "\t\t\t", "data", "[", "\"depth_fixedOut\"", "]", "=", "np", ".", "ones", "(", "[", "chunkSize", ",", "opt", ".", "outViewN", ",", "opt", ".", "outH", ",", "opt", ".", "outW", "]", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "data", "[", "\"mask_fixedOut\"", "]", "=", "np", ".", "ones", "(", "[", "chunkSize", ",", "opt", ".", "outViewN", ",", "opt", ".", "outH", ",", "opt", ".", "outW", "]", ",", "dtype", "=", "np", ".", "bool", ")", "\n", "# load data", "\n", "", "for", "c", "in", "range", "(", "chunkSize", ")", ":", "\n", "\t\t\t", "CAD", "=", "self", ".", "CADs", "[", "idx", "[", "c", "]", "]", "\n", "data", "[", "\"image_in\"", "]", "[", "c", "]", "=", "np", ".", "load", "(", "\"data/{0}_inputRGB/{1}.npy\"", ".", "format", "(", "opt", ".", "category", ",", "CAD", ")", ")", "/", "255.0", "\n", "if", "self", ".", "loadNovel", ":", "\n", "\t\t\t\t", "rawData", "=", "scipy", ".", "io", ".", "loadmat", "(", "\"data/{0}_depth/{1}.mat\"", ".", "format", "(", "opt", ".", "category", ",", "CAD", ")", ")", "\n", "depth", "=", "rawData", "[", "\"Z\"", "]", "\n", "trans", "=", "rawData", "[", "\"trans\"", "]", "\n", "mask", "=", "depth", "!=", "0", "\n", "depth", "[", "~", "mask", "]", "=", "opt", ".", "renderDepth", "\n", "# store data", "\n", "data", "[", "\"depth\"", "]", "[", "c", "]", "=", "depth", "\n", "data", "[", "\"mask\"", "]", "[", "c", "]", "=", "mask", "\n", "data", "[", "\"trans\"", "]", "[", "c", "]", "=", "trans", "\n", "", "if", "self", ".", "loadFixedOut", ":", "\n", "\t\t\t\t", "rawData_fixed", "=", "scipy", ".", "io", ".", "loadmat", "(", "\"data/{0}_depth_fixed{1}/{2}.mat\"", ".", "format", "(", "opt", ".", "category", ",", "opt", ".", "outViewN", ",", "CAD", ")", ")", "\n", "depth_fixed", "=", "rawData_fixed", "[", "\"Z\"", "]", "\n", "mask_fixed", "=", "depth_fixed", "!=", "0", "\n", "depth_fixed", "[", "~", "mask_fixed", "]", "=", "opt", ".", "renderDepth", "\n", "# store data", "\n", "data", "[", "\"depth_fixedOut\"", "]", "[", "c", "]", "=", "depth_fixed", "\n", "data", "[", "\"mask_fixedOut\"", "]", "[", "c", "]", "=", "mask_fixed", "\n", "", "", "self", ".", "pendingChunk", "=", "data", "\n", "", "def", "shipChunk", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.data.Loader.shipChunk": [[58, 60], ["None"], "methods", ["None"], ["", "def", "shipChunk", "(", "self", ")", ":", "\n", "\t\t", "self", ".", "readyChunk", ",", "self", ".", "pendingChunk", "=", "self", ".", "pendingChunk", ",", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.data.makeBatch": [[62, 76], ["numpy.random.randint", "numpy.random.randint", "numpy.random.permutation", "numpy.tile", "numpy.expand_dims", "numpy.expand_dims"], "function", ["None"], ["", "", "def", "makeBatch", "(", "opt", ",", "dataloader", ",", "PH", ")", ":", "\n", "\t", "data", "=", "dataloader", ".", "readyChunk", "\n", "inputImage", ",", "targetTrans", ",", "depthGT", ",", "maskGT", "=", "PH", "\n", "modelIdx", "=", "np", ".", "random", ".", "permutation", "(", "opt", ".", "chunkSize", ")", "[", ":", "opt", ".", "batchSize", "]", "\n", "modelIdxTile", "=", "np", ".", "tile", "(", "modelIdx", ",", "[", "opt", ".", "novelN", ",", "1", "]", ")", ".", "T", "\n", "angleIdx", "=", "np", ".", "random", ".", "randint", "(", "24", ",", "size", "=", "[", "opt", ".", "batchSize", "]", ")", "\n", "sampleIdx", "=", "np", ".", "random", ".", "randint", "(", "opt", ".", "sampleN", ",", "size", "=", "[", "opt", ".", "batchSize", ",", "opt", ".", "novelN", "]", ")", "\n", "batch", "=", "{", "\n", "inputImage", ":", "data", "[", "\"image_in\"", "]", "[", "modelIdx", ",", "angleIdx", "]", ",", "\n", "targetTrans", ":", "data", "[", "\"trans\"", "]", "[", "modelIdxTile", ",", "sampleIdx", "]", ",", "\n", "depthGT", ":", "np", ".", "expand_dims", "(", "data", "[", "\"depth\"", "]", "[", "modelIdxTile", ",", "sampleIdx", "]", ",", "axis", "=", "-", "1", ")", ",", "\n", "maskGT", ":", "np", ".", "expand_dims", "(", "data", "[", "\"mask\"", "]", "[", "modelIdxTile", ",", "sampleIdx", "]", ",", "axis", "=", "-", "1", ")", "\n", "}", "\n", "return", "batch", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.data.makeBatchFixed": [[78, 89], ["numpy.random.randint", "numpy.random.permutation", "numpy.transpose", "numpy.transpose"], "function", ["None"], ["", "def", "makeBatchFixed", "(", "opt", ",", "dataloader", ",", "PH", ")", ":", "\n", "\t", "data", "=", "dataloader", ".", "readyChunk", "\n", "inputImage", ",", "depthGT", ",", "maskGT", "=", "PH", "\n", "modelIdx", "=", "np", ".", "random", ".", "permutation", "(", "opt", ".", "chunkSize", ")", "[", ":", "opt", ".", "batchSize", "]", "\n", "angleIdx", "=", "np", ".", "random", ".", "randint", "(", "24", ",", "size", "=", "[", "opt", ".", "batchSize", "]", ")", "\n", "batch", "=", "{", "\n", "inputImage", ":", "data", "[", "\"image_in\"", "]", "[", "modelIdx", ",", "angleIdx", "]", ",", "\n", "depthGT", ":", "np", ".", "transpose", "(", "data", "[", "\"depth_fixedOut\"", "]", "[", "modelIdx", "]", ",", "axes", "=", "[", "0", ",", "2", ",", "3", ",", "1", "]", ")", ",", "\n", "maskGT", ":", "np", ".", "transpose", "(", "data", "[", "\"mask_fixedOut\"", "]", "[", "modelIdx", "]", ",", "axes", "=", "[", "0", ",", "2", ",", "3", ",", "1", "]", ")", "\n", "}", "\n", "return", "batch", "\n", "", ""]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.evaluate_dist.computeTestError": [[24, 44], ["int", "int", "range", "numpy.mean", "len", "len", "numpy.random.permutation", "numpy.ones", "numpy.ceil", "numpy.ceil", "range", "min", "min", "numpy.ones", "sess.run", "numpy.minimum", "len"], "function", ["None"], ["", "def", "computeTestError", "(", "Vs", ",", "Vt", ",", "type", ")", ":", "\n", "\t", "VsN", ",", "VtN", "=", "len", "(", "Vs", ")", ",", "len", "(", "Vt", ")", "\n", "if", "type", "==", "\"pred->GT\"", ":", "evalN", ",", "VsBatchSize", ",", "VtBatchSize", "=", "min", "(", "VsN", ",", "200", ")", ",", "200", ",", "100000", "\n", "if", "type", "==", "\"GT->pred\"", ":", "evalN", ",", "VsBatchSize", ",", "VtBatchSize", "=", "min", "(", "VsN", ",", "200", ")", ",", "200", ",", "40000", "\n", "# randomly sample 3D points to evaluate (for speed)", "\n", "randIdx", "=", "np", ".", "random", ".", "permutation", "(", "VsN", ")", "[", ":", "evalN", "]", "\n", "Vs_eval", "=", "Vs", "[", "randIdx", "]", "\n", "minDist_eval", "=", "np", ".", "ones", "(", "[", "evalN", "]", ")", "*", "np", ".", "inf", "\n", "# for batches of source vertices", "\n", "VsBatchN", "=", "int", "(", "np", ".", "ceil", "(", "evalN", "/", "VsBatchSize", ")", ")", "\n", "VtBatchN", "=", "int", "(", "np", ".", "ceil", "(", "VtN", "/", "VtBatchSize", ")", ")", "\n", "for", "b", "in", "range", "(", "VsBatchN", ")", ":", "\n", "\t\t", "VsBatch", "=", "Vs_eval", "[", "b", "*", "VsBatchSize", ":", "(", "b", "+", "1", ")", "*", "VsBatchSize", "]", "\n", "minDist_batch", "=", "np", ".", "ones", "(", "[", "len", "(", "VsBatch", ")", "]", ")", "*", "np", ".", "inf", "\n", "for", "b2", "in", "range", "(", "VtBatchN", ")", ":", "\n", "\t\t\t", "VtBatch", "=", "Vt", "[", "b2", "*", "VtBatchSize", ":", "(", "b2", "+", "1", ")", "*", "VtBatchSize", "]", "\n", "md", "=", "sess", ".", "run", "(", "minDist", ",", "feed_dict", "=", "{", "VsPH", ":", "VsBatch", ",", "VtPH", ":", "VtBatch", "}", ")", "\n", "minDist_batch", "=", "np", ".", "minimum", "(", "minDist_batch", ",", "md", ")", "\n", "", "minDist_eval", "[", "b", "*", "VsBatchSize", ":", "(", "b", "+", "1", ")", "*", "VsBatchSize", "]", "=", "minDist_batch", "\n", "", "return", "np", ".", "mean", "(", "minDist_eval", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.transform.fuse3D": [[6, 29], ["tensorflow.name_scope", "tensorflow.transpose", "tensorflow.transpose", "numpy.linalg.inv", "numpy.tile", "numpy.tile().astype", "transform.transParamsToHomMatrix", "tensorflow.tile", "tensorflow.matrix_inverse", "tensorflow.matmul", "tensorflow.reshape", "transform.get3DhomCoord", "tensorflow.matmul", "tensorflow.reshape", "tensorflow.expand_dims", "tensorflow.transpose", "numpy.tile"], "function", ["home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.transform.transParamsToHomMatrix", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.transform.get3DhomCoord"], ["def", "fuse3D", "(", "opt", ",", "XYZ", ",", "maskLogit", ",", "fuseTrans", ")", ":", "# [B,H,W,3V],[B,H,W,V]", "\n", "\t", "with", "tf", ".", "name_scope", "(", "\"transform_fuse3D\"", ")", ":", "\n", "\t\t", "XYZ", "=", "tf", ".", "transpose", "(", "XYZ", ",", "perm", "=", "[", "0", ",", "3", ",", "1", ",", "2", "]", ")", "# [B,3V,H,W]", "\n", "maskLogit", "=", "tf", ".", "transpose", "(", "maskLogit", ",", "perm", "=", "[", "0", ",", "3", ",", "1", ",", "2", "]", ")", "# [B,V,H,W]", "\n", "# 2D to 3D coordinate transformation", "\n", "invKhom", "=", "np", ".", "linalg", ".", "inv", "(", "opt", ".", "Khom2Dto3D", ")", "\n", "invKhomTile", "=", "np", ".", "tile", "(", "invKhom", ",", "[", "opt", ".", "batchSize", ",", "opt", ".", "outViewN", ",", "1", ",", "1", "]", ")", "\n", "# viewpoint rigid transformation", "\n", "q_view", "=", "fuseTrans", "\n", "t_view", "=", "np", ".", "tile", "(", "[", "0", ",", "0", ",", "-", "opt", ".", "renderDepth", "]", ",", "[", "opt", ".", "outViewN", ",", "1", "]", ")", ".", "astype", "(", "np", ".", "float32", ")", "\n", "RtHom_view", "=", "transParamsToHomMatrix", "(", "q_view", ",", "t_view", ")", "\n", "RtHomTile_view", "=", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "RtHom_view", ",", "0", ")", ",", "[", "opt", ".", "batchSize", ",", "1", ",", "1", ",", "1", "]", ")", "\n", "invRtHomTile_view", "=", "tf", ".", "matrix_inverse", "(", "RtHomTile_view", ")", "\n", "# effective transformation", "\n", "RtHomTile", "=", "tf", ".", "matmul", "(", "invRtHomTile_view", ",", "invKhomTile", ")", "# [B,V,4,4]", "\n", "RtTile", "=", "RtHomTile", "[", ":", ",", ":", ",", ":", "3", ",", ":", "]", "# [B,V,3,4]", "\n", "# transform depth stack", "\n", "ML", "=", "tf", ".", "reshape", "(", "maskLogit", ",", "[", "opt", ".", "batchSize", ",", "1", ",", "-", "1", "]", ")", "# [B,1,VHW]", "\n", "XYZhom", "=", "get3DhomCoord", "(", "XYZ", ",", "opt", ")", "# [B,V,4,HW]", "\n", "XYZid", "=", "tf", ".", "matmul", "(", "RtTile", ",", "XYZhom", ")", "# [B,V,3,HW]", "\n", "# fuse point clouds", "\n", "XYZid", "=", "tf", ".", "reshape", "(", "tf", ".", "transpose", "(", "XYZid", ",", "perm", "=", "[", "0", ",", "2", ",", "1", ",", "3", "]", ")", ",", "[", "opt", ".", "batchSize", ",", "3", ",", "-", "1", "]", ")", "# [B,3,VHW]", "\n", "", "return", "XYZid", ",", "ML", "# [B,1,VHW]", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.transform.render2D": [[31, 102], ["tensorflow.name_scope", "tensorflow.reshape", "numpy.tile().astype", "tensorflow.reshape", "numpy.tile", "tensorflow.matmul", "transform.get3DhomCoord2", "tensorflow.tile", "tensorflow.matmul", "tensorflow.split", "tensorflow.reshape", "tensorflow.reshape", "tensorflow.reshape", "tensorflow.reshape", "numpy.meshgrid", "tensorflow.to_int32", "tensorflow.to_int32", "tensorflow.stack", "tensorflow.stack", "tensorflow.boolean_mask", "tensorflow.boolean_mask", "tensorflow.unstack", "tensorflow.boolean_mask", "tensorflow.boolean_mask", "tensorflow.boolean_mask", "tensorflow.boolean_mask", "tensorflow.unstack", "tensorflow.unstack", "tensorflow.unstack", "tensorflow.unstack", "tensorflow.stack", "tensorflow.constant", "tensorflow.ones_like", "tensorflow.stack", "tensorflow.scatter_nd", "tensorflow.reshape", "tensorflow.nn.max_pool", "tensorflow.reshape", "tensorflow.split", "tensorflow.stack", "tensorflow.constant", "tensorflow.stack", "tensorflow.scatter_nd", "tensorflow.reshape", "tensorflow.nn.avg_pool", "tensorflow.reshape", "tensorflow.where", "transform.transParamsToHomMatrix", "numpy.array", "tensorflow.expand_dims", "tensorflow.tile", "range", "range", "range", "batchIdxCat.reshape", "novelIdxCat.reshape", "tensorflow.round", "tensorflow.round", "tensorflow.where", "numpy.tile", "tensorflow.ones_like"], "function", ["home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.transform.get3DhomCoord2", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.transform.transParamsToHomMatrix"], ["", "def", "render2D", "(", "opt", ",", "XYZid", ",", "ML", ",", "renderTrans", ")", ":", "# [B,1,VHW]", "\n", "\t", "offsetDepth", ",", "offsetMaskLogit", "=", "10.0", ",", "1.0", "\n", "with", "tf", ".", "name_scope", "(", "\"transform_render2D\"", ")", ":", "\n", "# target rigid transformation", "\n", "\t\t", "q_target", "=", "tf", ".", "reshape", "(", "renderTrans", ",", "[", "opt", ".", "batchSize", "*", "opt", ".", "novelN", ",", "4", "]", ")", "\n", "t_target", "=", "np", ".", "tile", "(", "[", "0", ",", "0", ",", "-", "opt", ".", "renderDepth", "]", ",", "[", "opt", ".", "batchSize", "*", "opt", ".", "novelN", ",", "1", "]", ")", ".", "astype", "(", "np", ".", "float32", ")", "\n", "RtHom_target", "=", "tf", ".", "reshape", "(", "transParamsToHomMatrix", "(", "q_target", ",", "t_target", ")", ",", "[", "opt", ".", "batchSize", ",", "opt", ".", "novelN", ",", "4", ",", "4", "]", ")", "\n", "# 3D to 2D coordinate transformation", "\n", "KupHom", "=", "opt", ".", "Khom3Dto2D", "*", "np", ".", "array", "(", "[", "[", "opt", ".", "upscale", "]", ",", "[", "opt", ".", "upscale", "]", ",", "[", "1", "]", ",", "[", "1", "]", "]", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "KupHomTile", "=", "np", ".", "tile", "(", "KupHom", ",", "[", "opt", ".", "batchSize", ",", "opt", ".", "novelN", ",", "1", ",", "1", "]", ")", "\n", "# effective transformation", "\n", "RtHomTile", "=", "tf", ".", "matmul", "(", "KupHomTile", ",", "RtHom_target", ")", "# [B,N,4,4]", "\n", "RtTile", "=", "RtHomTile", "[", ":", ",", ":", ",", ":", "3", ",", ":", "]", "# [B,N,3,4]", "\n", "# transform depth stack", "\n", "XYZidHom", "=", "get3DhomCoord2", "(", "XYZid", ",", "opt", ")", "# [B,4,VHW]", "\n", "XYZidHomTile", "=", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "XYZidHom", ",", "axis", "=", "1", ")", ",", "[", "1", ",", "opt", ".", "novelN", ",", "1", ",", "1", "]", ")", "# [B,N,4,VHW]", "\n", "XYZnew", "=", "tf", ".", "matmul", "(", "RtTile", ",", "XYZidHomTile", ")", "# [B,N,3,VHW]", "\n", "Xnew", ",", "Ynew", ",", "Znew", "=", "tf", ".", "split", "(", "XYZnew", ",", "3", ",", "axis", "=", "2", ")", "# [B,N,1,VHW]", "\n", "# concatenate all viewpoints", "\n", "MLcat", "=", "tf", ".", "reshape", "(", "tf", ".", "tile", "(", "ML", ",", "[", "1", ",", "opt", ".", "novelN", ",", "1", "]", ")", ",", "[", "-", "1", "]", ")", "# [BNVHW]", "\n", "XnewCat", "=", "tf", ".", "reshape", "(", "Xnew", ",", "[", "-", "1", "]", ")", "# [BNVHW]", "\n", "YnewCat", "=", "tf", ".", "reshape", "(", "Ynew", ",", "[", "-", "1", "]", ")", "# [BNVHW]", "\n", "ZnewCat", "=", "tf", ".", "reshape", "(", "Znew", ",", "[", "-", "1", "]", ")", "# [BNVHW]", "\n", "batchIdxCat", ",", "novelIdxCat", ",", "_", "=", "np", ".", "meshgrid", "(", "range", "(", "opt", ".", "batchSize", ")", ",", "range", "(", "opt", ".", "novelN", ")", ",", "range", "(", "opt", ".", "outViewN", "*", "opt", ".", "outH", "*", "opt", ".", "outW", ")", ",", "indexing", "=", "\"ij\"", ")", "\n", "batchIdxCat", ",", "novelIdxCat", "=", "batchIdxCat", ".", "reshape", "(", "[", "-", "1", "]", ")", ",", "novelIdxCat", ".", "reshape", "(", "[", "-", "1", "]", ")", "# [BNVHW]", "\n", "# apply in-range masks", "\n", "XnewCatInt", "=", "tf", ".", "to_int32", "(", "tf", ".", "round", "(", "XnewCat", ")", ")", "\n", "YnewCatInt", "=", "tf", ".", "to_int32", "(", "tf", ".", "round", "(", "YnewCat", ")", ")", "\n", "maskInside", "=", "(", "XnewCatInt", ">=", "0", ")", "&", "(", "XnewCatInt", "<", "opt", ".", "upscale", "*", "opt", ".", "W", ")", "&", "(", "YnewCatInt", ">=", "0", ")", "&", "(", "YnewCatInt", "<", "opt", ".", "upscale", "*", "opt", ".", "H", ")", "\n", "valueInt", "=", "tf", ".", "stack", "(", "[", "XnewCatInt", ",", "YnewCatInt", ",", "batchIdxCat", ",", "novelIdxCat", "]", ",", "axis", "=", "1", ")", "# [BNVHW,d]", "\n", "valueFloat", "=", "tf", ".", "stack", "(", "[", "1", "/", "(", "ZnewCat", "+", "offsetDepth", "+", "1e-8", ")", ",", "MLcat", "]", ",", "axis", "=", "1", ")", "# [BNVHW,d]", "\n", "insideInt", "=", "tf", ".", "boolean_mask", "(", "valueInt", ",", "maskInside", ")", "# [U,d]", "\n", "insideFloat", "=", "tf", ".", "boolean_mask", "(", "valueFloat", ",", "maskInside", ")", "# [U,d]", "\n", "_", ",", "MLnewValid", "=", "tf", ".", "unstack", "(", "insideFloat", ",", "axis", "=", "1", ")", "# [U]", "\n", "# apply visible masks", "\n", "maskExist", "=", "MLnewValid", ">", "0", "\n", "visInt", "=", "tf", ".", "boolean_mask", "(", "insideInt", ",", "maskExist", ")", "\n", "visFloat", "=", "tf", ".", "boolean_mask", "(", "insideFloat", ",", "maskExist", ")", "\n", "invisInt", "=", "tf", ".", "boolean_mask", "(", "insideInt", ",", "~", "maskExist", ")", "\n", "invisFloat", "=", "tf", ".", "boolean_mask", "(", "insideFloat", ",", "~", "maskExist", ")", "\n", "XnewVis", ",", "YnewVis", ",", "batchIdxVis", ",", "novelIdxVis", "=", "tf", ".", "unstack", "(", "visInt", ",", "axis", "=", "1", ")", "# [U]", "\n", "iZnewVis", ",", "MLnewVis", "=", "tf", ".", "unstack", "(", "visFloat", ",", "axis", "=", "1", ")", "# [U]", "\n", "XnewInvis", ",", "YnewInvis", ",", "batchIdxInvis", ",", "novelIdxInvis", "=", "tf", ".", "unstack", "(", "invisInt", ",", "axis", "=", "1", ")", "# [U]", "\n", "_", ",", "MLnewInvis", "=", "tf", ".", "unstack", "(", "invisFloat", ",", "axis", "=", "1", ")", "# [U]", "\n", "# map to upsampled inverse depth and mask (visible)", "\n", "scatterIdx", "=", "tf", ".", "stack", "(", "[", "batchIdxVis", ",", "novelIdxVis", ",", "YnewVis", ",", "XnewVis", "]", ",", "axis", "=", "1", ")", "# [U,4]", "\n", "scatterShape", "=", "tf", ".", "constant", "(", "[", "opt", ".", "batchSize", ",", "opt", ".", "novelN", ",", "opt", ".", "H", "*", "opt", ".", "upscale", ",", "opt", ".", "W", "*", "opt", ".", "upscale", ",", "3", "]", ")", "\n", "countOnes", "=", "tf", ".", "ones_like", "(", "iZnewVis", ")", "\n", "scatteriZMLCnt", "=", "tf", ".", "stack", "(", "[", "iZnewVis", ",", "MLnewVis", ",", "countOnes", "]", ",", "axis", "=", "1", ")", "# [U,3]", "\n", "upNewiZMLCnt", "=", "tf", ".", "scatter_nd", "(", "scatterIdx", ",", "scatteriZMLCnt", ",", "scatterShape", ")", "# [B,N,uH,uW,3]", "\n", "upNewiZMLCnt", "=", "tf", ".", "reshape", "(", "upNewiZMLCnt", ",", "[", "opt", ".", "batchSize", "*", "opt", ".", "novelN", ",", "opt", ".", "H", "*", "opt", ".", "upscale", ",", "opt", ".", "W", "*", "opt", ".", "upscale", ",", "3", "]", ")", "# [BN,uH,uW,3]", "\n", "# downsample back to original size", "\n", "newiZMLCnt", "=", "tf", ".", "nn", ".", "max_pool", "(", "upNewiZMLCnt", ",", "ksize", "=", "[", "1", ",", "opt", ".", "upscale", ",", "opt", ".", "upscale", ",", "1", "]", ",", "\n", "strides", "=", "[", "1", ",", "opt", ".", "upscale", ",", "opt", ".", "upscale", ",", "1", "]", ",", "padding", "=", "\"VALID\"", ")", "# [BN,H,W,3]", "\n", "newiZMLCnt", "=", "tf", ".", "reshape", "(", "newiZMLCnt", ",", "[", "opt", ".", "batchSize", ",", "opt", ".", "novelN", ",", "opt", ".", "H", ",", "opt", ".", "W", ",", "3", "]", ")", "# [B,N,H,W,3]", "\n", "newInvDepth", ",", "newMaskLogitVis", ",", "collision", "=", "tf", ".", "split", "(", "newiZMLCnt", ",", "3", ",", "axis", "=", "4", ")", "# [B,N,H,W,1]", "\n", "# map to upsampled inverse depth and mask (invisible)", "\n", "scatterIdx", "=", "tf", ".", "stack", "(", "[", "batchIdxInvis", ",", "novelIdxInvis", ",", "YnewInvis", ",", "XnewInvis", "]", ",", "axis", "=", "1", ")", "# [U,4]", "\n", "scatterShape", "=", "tf", ".", "constant", "(", "[", "opt", ".", "batchSize", ",", "opt", ".", "novelN", ",", "opt", ".", "H", "*", "opt", ".", "upscale", ",", "opt", ".", "W", "*", "opt", ".", "upscale", ",", "1", "]", ")", "\n", "scatterML", "=", "tf", ".", "stack", "(", "[", "MLnewInvis", "]", ",", "axis", "=", "1", ")", "# [U,1]", "\n", "upNewML", "=", "tf", ".", "scatter_nd", "(", "scatterIdx", ",", "scatterML", ",", "scatterShape", ")", "# [B,N,uH,uW,1]", "\n", "upNewML", "=", "tf", ".", "reshape", "(", "upNewML", ",", "[", "opt", ".", "batchSize", "*", "opt", ".", "novelN", ",", "opt", ".", "H", "*", "opt", ".", "upscale", ",", "opt", ".", "W", "*", "opt", ".", "upscale", ",", "1", "]", ")", "# [BN,uH,uW,1]", "\n", "# downsample back to original size", "\n", "newML", "=", "tf", ".", "nn", ".", "avg_pool", "(", "upNewML", ",", "ksize", "=", "[", "1", ",", "opt", ".", "upscale", ",", "opt", ".", "upscale", ",", "1", "]", ",", "\n", "strides", "=", "[", "1", ",", "opt", ".", "upscale", ",", "opt", ".", "upscale", ",", "1", "]", ",", "padding", "=", "\"VALID\"", ")", "# [BN,H,W,1]", "\n", "newMaskLogitInvis", "=", "tf", ".", "reshape", "(", "newML", ",", "[", "opt", ".", "batchSize", ",", "opt", ".", "novelN", ",", "opt", ".", "H", ",", "opt", ".", "W", ",", "1", "]", ")", "# [B,N,H,W,1]", "\n", "# combine visible/invisible", "\n", "newMaskLogit", "=", "tf", ".", "where", "(", "newMaskLogitVis", ">", "0", ",", "newMaskLogitVis", ",", "\n", "tf", ".", "where", "(", "newMaskLogitInvis", "<", "0", ",", "newMaskLogitInvis", ",", "tf", ".", "ones_like", "(", "newInvDepth", ")", "*", "(", "-", "offsetMaskLogit", ")", ")", ")", "\n", "newDepth", "=", "1", "/", "(", "newInvDepth", "+", "1e-8", ")", "-", "offsetDepth", "\n", "", "return", "newDepth", ",", "newMaskLogit", ",", "collision", "# [B,N,H,W,1]", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.transform.quaternionToRotMatrix": [[103, 110], ["tensorflow.name_scope", "tensorflow.unstack", "tensorflow.transpose", "tensorflow.stack"], "function", ["None"], ["", "def", "quaternionToRotMatrix", "(", "q", ")", ":", "\n", "\t", "with", "tf", ".", "name_scope", "(", "\"quaternionToRotMatrix\"", ")", ":", "\n", "\t\t", "qa", ",", "qb", ",", "qc", ",", "qd", "=", "tf", ".", "unstack", "(", "q", ",", "axis", "=", "1", ")", "\n", "R", "=", "tf", ".", "transpose", "(", "tf", ".", "stack", "(", "[", "[", "1", "-", "2", "*", "(", "qc", "**", "2", "+", "qd", "**", "2", ")", ",", "2", "*", "(", "qb", "*", "qc", "-", "qa", "*", "qd", ")", ",", "2", "*", "(", "qa", "*", "qc", "+", "qb", "*", "qd", ")", "]", ",", "\n", "[", "2", "*", "(", "qb", "*", "qc", "+", "qa", "*", "qd", ")", ",", "1", "-", "2", "*", "(", "qb", "**", "2", "+", "qd", "**", "2", ")", ",", "2", "*", "(", "qc", "*", "qd", "-", "qa", "*", "qb", ")", "]", ",", "\n", "[", "2", "*", "(", "qb", "*", "qd", "-", "qa", "*", "qc", ")", ",", "2", "*", "(", "qa", "*", "qb", "+", "qc", "*", "qd", ")", ",", "1", "-", "2", "*", "(", "qb", "**", "2", "+", "qc", "**", "2", ")", "]", "]", ")", ",", "perm", "=", "[", "2", ",", "0", ",", "1", "]", ")", "\n", "", "return", "R", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.transform.transParamsToHomMatrix": [[111, 119], ["tensorflow.name_scope", "transform.quaternionToRotMatrix", "tensorflow.concat", "tensorflow.concat", "tensorflow.concat", "tensorflow.shape", "tensorflow.expand_dims", "tensorflow.zeros", "tensorflow.ones"], "function", ["home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.util.quaternionToRotMatrix"], ["", "def", "transParamsToHomMatrix", "(", "q", ",", "t", ")", ":", "\n", "\t", "with", "tf", ".", "name_scope", "(", "\"transParamsToHomMatrix\"", ")", ":", "\n", "\t\t", "N", "=", "tf", ".", "shape", "(", "q", ")", "[", "0", "]", "\n", "R", "=", "quaternionToRotMatrix", "(", "q", ")", "\n", "Rt", "=", "tf", ".", "concat", "(", "[", "R", ",", "tf", ".", "expand_dims", "(", "t", ",", "-", "1", ")", "]", ",", "axis", "=", "2", ")", "\n", "hom_aug", "=", "tf", ".", "concat", "(", "[", "tf", ".", "zeros", "(", "[", "N", ",", "1", ",", "3", "]", ")", ",", "tf", ".", "ones", "(", "[", "N", ",", "1", ",", "1", "]", ")", "]", ",", "axis", "=", "2", ")", "\n", "RtHom", "=", "tf", ".", "concat", "(", "[", "Rt", ",", "hom_aug", "]", ",", "axis", "=", "1", ")", "\n", "", "return", "RtHom", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.transform.get3DhomCoord": [[120, 125], ["tensorflow.name_scope", "tensorflow.ones", "tensorflow.transpose", "tensorflow.reshape", "tensorflow.concat"], "function", ["None"], ["", "def", "get3DhomCoord", "(", "XYZ", ",", "opt", ")", ":", "\n", "\t", "with", "tf", ".", "name_scope", "(", "\"get3DhomCoord\"", ")", ":", "\n", "\t\t", "ones", "=", "tf", ".", "ones", "(", "[", "opt", ".", "batchSize", ",", "opt", ".", "outViewN", ",", "opt", ".", "outH", ",", "opt", ".", "outW", "]", ")", "\n", "XYZhom", "=", "tf", ".", "transpose", "(", "tf", ".", "reshape", "(", "tf", ".", "concat", "(", "[", "XYZ", ",", "ones", "]", ",", "axis", "=", "1", ")", ",", "[", "opt", ".", "batchSize", ",", "4", ",", "opt", ".", "outViewN", ",", "-", "1", "]", ")", ",", "perm", "=", "[", "0", ",", "2", ",", "1", ",", "3", "]", ")", "\n", "", "return", "XYZhom", "# [B,V,4,HW]", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.transform.get3DhomCoord2": [[126, 131], ["tensorflow.name_scope", "tensorflow.ones", "tensorflow.concat"], "function", ["None"], ["", "def", "get3DhomCoord2", "(", "XYZ", ",", "opt", ")", ":", "\n", "\t", "with", "tf", ".", "name_scope", "(", "\"get3DhomCoord\"", ")", ":", "\n", "\t\t", "ones", "=", "tf", ".", "ones", "(", "[", "opt", ".", "batchSize", ",", "1", ",", "opt", ".", "outViewN", "*", "opt", ".", "outH", "*", "opt", ".", "outW", "]", ")", "\n", "XYZhom", "=", "tf", ".", "concat", "(", "[", "XYZ", ",", "ones", "]", ",", "axis", "=", "1", ")", "\n", "", "return", "XYZhom", "# [B,4,VHW]", "\n", "", ""]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.projection": [[8, 19], ["tensorflow.tile", "tensorflow.tile", "tensorflow.sqrt", "tensorflow.to_int32", "tensorflow.gather_nd", "tensorflow.gather_nd", "tensorflow.shape", "tensorflow.shape", "tensorflow.reduce_sum", "tensorflow.argmin", "tensorflow.stack", "tensorflow.stack", "tensorflow.range", "tensorflow.range"], "function", ["None"], ["def", "projection", "(", "Vs", ",", "Vt", ")", ":", "\n", "\t", "VsN", "=", "tf", ".", "shape", "(", "Vs", ")", "[", "0", "]", "\n", "VtN", "=", "tf", ".", "shape", "(", "Vt", ")", "[", "0", "]", "\n", "Vt_rep", "=", "tf", ".", "tile", "(", "Vt", "[", "None", ",", ":", ",", ":", "]", ",", "[", "VsN", ",", "1", ",", "1", "]", ")", "# [VsN,VtN,3]", "\n", "Vs_rep", "=", "tf", ".", "tile", "(", "Vs", "[", ":", ",", "None", ",", ":", "]", ",", "[", "1", ",", "VtN", ",", "1", "]", ")", "# [VsN,VtN,3]", "\n", "diff", "=", "Vt_rep", "-", "Vs_rep", "\n", "dist", "=", "tf", ".", "sqrt", "(", "tf", ".", "reduce_sum", "(", "diff", "**", "2", ",", "axis", "=", "[", "2", "]", ")", ")", "# [VsN,VtN]", "\n", "idx", "=", "tf", ".", "to_int32", "(", "tf", ".", "argmin", "(", "dist", ",", "axis", "=", "1", ")", ")", "\n", "proj", "=", "tf", ".", "gather_nd", "(", "Vt_rep", ",", "tf", ".", "stack", "(", "[", "tf", ".", "range", "(", "VsN", ")", ",", "idx", "]", ",", "axis", "=", "1", ")", ")", "\n", "minDist", "=", "tf", ".", "gather_nd", "(", "dist", ",", "tf", ".", "stack", "(", "[", "tf", ".", "range", "(", "VsN", ")", ",", "idx", "]", ",", "axis", "=", "1", ")", ")", "\n", "return", "proj", ",", "minDist", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.mkdir": [[20, 22], ["os.path.exists", "os.makedirs"], "function", ["None"], ["", "def", "mkdir", "(", "path", ")", ":", "\n", "\t", "if", "not", "os", ".", "path", ".", "exists", "(", "path", ")", ":", "os", ".", "makedirs", "(", "path", ")", "\n", "", "def", "imread", "(", "fname", ")", ":", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.imread": [[22, 24], ["scipy.misc.imread"], "function", ["home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.imread"], ["", "def", "imread", "(", "fname", ")", ":", "\n", "\t", "return", "scipy", ".", "misc", ".", "imread", "(", "fname", ")", "/", "255.0", "\n", "", "def", "imsave", "(", "fname", ",", "array", ")", ":", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.imsave": [[24, 26], ["scipy.misc.toimage().save", "scipy.misc.toimage"], "function", ["None"], ["", "def", "imsave", "(", "fname", ",", "array", ")", ":", "\n", "\t", "scipy", ".", "misc", ".", "toimage", "(", "array", ",", "cmin", "=", "0.0", ",", "cmax", "=", "1.0", ")", ".", "save", "(", "fname", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toRed": [[28, 29], ["termcolor.colored"], "function", ["None"], ["", "def", "toRed", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"red\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n", "def", "toGreen", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"green\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toGreen": [[29, 30], ["termcolor.colored"], "function", ["None"], ["def", "toGreen", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"green\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n", "def", "toBlue", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"blue\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toBlue": [[30, 31], ["termcolor.colored"], "function", ["None"], ["def", "toBlue", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"blue\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n", "def", "toCyan", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"cyan\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toCyan": [[31, 32], ["termcolor.colored"], "function", ["None"], ["def", "toCyan", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"cyan\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n", "def", "toYellow", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"yellow\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toYellow": [[32, 33], ["termcolor.colored"], "function", ["None"], ["def", "toYellow", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"yellow\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n", "def", "toMagenta", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"magenta\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.toMagenta": [[33, 34], ["termcolor.colored"], "function", ["None"], ["def", "toMagenta", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"magenta\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.imageSummary": [[36, 44], ["tensorflow.batch_to_space", "tensorflow.reshape", "tensorflow.transpose", "tensorflow.reshape", "tensorflow.summary.image"], "function", ["None"], ["def", "imageSummary", "(", "opt", ",", "tag", ",", "image", ",", "H", ",", "W", ")", ":", "\n", "\t", "blockSize", "=", "opt", ".", "visBlockSize", "\n", "imageOne", "=", "tf", ".", "batch_to_space", "(", "image", "[", ":", "blockSize", "**", "2", "]", ",", "crops", "=", "[", "[", "0", ",", "0", "]", ",", "[", "0", ",", "0", "]", "]", ",", "block_size", "=", "blockSize", ")", "\n", "imagePermute", "=", "tf", ".", "reshape", "(", "imageOne", ",", "[", "H", ",", "blockSize", ",", "W", ",", "blockSize", ",", "-", "1", "]", ")", "\n", "imageTransp", "=", "tf", ".", "transpose", "(", "imagePermute", ",", "[", "1", ",", "0", ",", "3", ",", "2", ",", "4", "]", ")", "\n", "imageBlocks", "=", "tf", ".", "reshape", "(", "imageTransp", ",", "[", "1", ",", "H", "*", "blockSize", ",", "W", "*", "blockSize", ",", "-", "1", "]", ")", "\n", "summary", "=", "tf", ".", "summary", ".", "image", "(", "tag", ",", "imageBlocks", ")", "\n", "return", "summary", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.restoreModelFromIt": [[46, 48], ["saver.restore"], "function", ["None"], ["", "def", "restoreModelFromIt", "(", "opt", ",", "sess", ",", "saver", ",", "it", ")", ":", "\n", "\t", "saver", ".", "restore", "(", "sess", ",", "\"models_{0}/{1}_it{2}.ckpt\"", ".", "format", "(", "opt", ".", "group", ",", "opt", ".", "model", ",", "it", ")", ")", "\n", "# restore model", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.restoreModel": [[49, 51], ["saver.restore"], "function", ["None"], ["", "def", "restoreModel", "(", "opt", ",", "sess", ",", "saver", ")", ":", "\n", "\t", "saver", ".", "restore", "(", "sess", ",", "\"models_{0}/{1}.ckpt\"", ".", "format", "(", "opt", ".", "group", ",", "opt", ".", "load", ")", ")", "\n", "# save model", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.util.saveModel": [[52, 54], ["saver.save"], "function", ["None"], ["", "def", "saveModel", "(", "opt", ",", "sess", ",", "saver", ",", "it", ")", ":", "\n", "\t", "saver", ".", "save", "(", "sess", ",", "\"models_{0}/{1}_it{2}.ckpt\"", ".", "format", "(", "opt", ".", "group", ",", "opt", ".", "model", ",", "it", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.convertEXR.readEXR": [[13, 22], ["OpenEXR.InputFile", "Imath.PixelType", "vectors[].reshape", "OpenEXR.InputFile.header", "numpy.array", "array.array", "OpenEXR.InputFile.channel"], "function", ["None"], ["def", "readEXR", "(", "fname", ",", "RESOLUTION", ")", ":", "\n", "\t", "channel_list", "=", "[", "\"B\"", ",", "\"G\"", ",", "\"R\"", "]", "\n", "file", "=", "OpenEXR", ".", "InputFile", "(", "fname", ")", "\n", "dw", "=", "file", ".", "header", "(", ")", "[", "\"dataWindow\"", "]", "\n", "height", ",", "width", "=", "RESOLUTION", ",", "RESOLUTION", "\n", "FLOAT", "=", "Imath", ".", "PixelType", "(", "Imath", ".", "PixelType", ".", "FLOAT", ")", "\n", "vectors", "=", "[", "np", ".", "array", "(", "array", ".", "array", "(", "\"f\"", ",", "file", ".", "channel", "(", "c", ",", "FLOAT", ")", ")", ")", "for", "c", "in", "channel_list", "]", "\n", "depth", "=", "vectors", "[", "0", "]", ".", "reshape", "(", "[", "height", ",", "width", "]", ")", "\n", "return", "depth", "\n", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.util.setupBlender": [[4, 30], ["tree.nodes.new", "tree.nodes.new", "tree.nodes.new.file_slots.new", "tree.links.new", "tree.nodes.remove"], "function", ["None"], ["import", "os", "\n", "import", "termcolor", "\n", "\n", "# compute projection from source to target", "\n", "def", "projection", "(", "Vs", ",", "Vt", ")", ":", "\n", "\t", "VsN", "=", "tf", ".", "shape", "(", "Vs", ")", "[", "0", "]", "\n", "VtN", "=", "tf", ".", "shape", "(", "Vt", ")", "[", "0", "]", "\n", "Vt_rep", "=", "tf", ".", "tile", "(", "Vt", "[", "None", ",", ":", ",", ":", "]", ",", "[", "VsN", ",", "1", ",", "1", "]", ")", "# [VsN,VtN,3]", "\n", "Vs_rep", "=", "tf", ".", "tile", "(", "Vs", "[", ":", ",", "None", ",", ":", "]", ",", "[", "1", ",", "VtN", ",", "1", "]", ")", "# [VsN,VtN,3]", "\n", "diff", "=", "Vt_rep", "-", "Vs_rep", "\n", "dist", "=", "tf", ".", "sqrt", "(", "tf", ".", "reduce_sum", "(", "diff", "**", "2", ",", "axis", "=", "[", "2", "]", ")", ")", "# [VsN,VtN]", "\n", "idx", "=", "tf", ".", "to_int32", "(", "tf", ".", "argmin", "(", "dist", ",", "axis", "=", "1", ")", ")", "\n", "proj", "=", "tf", ".", "gather_nd", "(", "Vt_rep", ",", "tf", ".", "stack", "(", "[", "tf", ".", "range", "(", "VsN", ")", ",", "idx", "]", ",", "axis", "=", "1", ")", ")", "\n", "minDist", "=", "tf", ".", "gather_nd", "(", "dist", ",", "tf", ".", "stack", "(", "[", "tf", ".", "range", "(", "VsN", ")", ",", "idx", "]", ",", "axis", "=", "1", ")", ")", "\n", "return", "proj", ",", "minDist", "\n", "\n", "", "def", "mkdir", "(", "path", ")", ":", "\n", "\t", "if", "not", "os", ".", "path", ".", "exists", "(", "path", ")", ":", "os", ".", "makedirs", "(", "path", ")", "\n", "", "def", "imread", "(", "fname", ")", ":", "\n", "\t", "return", "scipy", ".", "misc", ".", "imread", "(", "fname", ")", "/", "255.0", "\n", "", "def", "imsave", "(", "fname", ",", "array", ")", ":", "\n", "\t", "scipy", ".", "misc", ".", "toimage", "(", "array", ",", "cmin", "=", "0.0", ",", "cmax", "=", "1.0", ")", ".", "save", "(", "fname", ")", "\n", "\n", "# convert to colored strings", "\n", "", "def", "toRed", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"red\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n", "def", "toGreen", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"green\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n", "def", "toBlue", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"blue\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.util.setCameraExtrinsics": [[31, 41], ["None"], "function", ["None"], ["def", "toCyan", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"cyan\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n", "def", "toYellow", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"yellow\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n", "def", "toMagenta", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"magenta\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n", "\n", "# make image summary from image batch", "\n", "def", "imageSummary", "(", "opt", ",", "tag", ",", "image", ",", "H", ",", "W", ")", ":", "\n", "\t", "blockSize", "=", "opt", ".", "visBlockSize", "\n", "imageOne", "=", "tf", ".", "batch_to_space", "(", "image", "[", ":", "blockSize", "**", "2", "]", ",", "crops", "=", "[", "[", "0", ",", "0", "]", ",", "[", "0", ",", "0", "]", "]", ",", "block_size", "=", "blockSize", ")", "\n", "imagePermute", "=", "tf", ".", "reshape", "(", "imageOne", ",", "[", "H", ",", "blockSize", ",", "W", ",", "blockSize", ",", "-", "1", "]", ")", "\n", "imageTransp", "=", "tf", ".", "transpose", "(", "imagePermute", ",", "[", "1", ",", "0", ",", "3", ",", "2", ",", "4", "]", ")", "\n", "imageBlocks", "=", "tf", ".", "reshape", "(", "imageTransp", ",", "[", "1", ",", "H", "*", "blockSize", ",", "W", "*", "blockSize", ",", "-", "1", "]", ")", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.util.projectionMatrix": [[42, 51], ["numpy.array"], "function", ["None"], ["summary", "=", "tf", ".", "summary", ".", "image", "(", "tag", ",", "imageBlocks", ")", "\n", "return", "summary", "\n", "\n", "# restore model", "\n", "", "def", "restoreModelFromIt", "(", "opt", ",", "sess", ",", "saver", ",", "it", ")", ":", "\n", "\t", "saver", ".", "restore", "(", "sess", ",", "\"models_{0}/{1}_it{2}.ckpt\"", ".", "format", "(", "opt", ".", "group", ",", "opt", ".", "model", ",", "it", ")", ")", "\n", "# restore model", "\n", "", "def", "restoreModel", "(", "opt", ",", "sess", ",", "saver", ")", ":", "\n", "\t", "saver", ".", "restore", "(", "sess", ",", "\"models_{0}/{1}.ckpt\"", ".", "format", "(", "opt", ".", "group", ",", "opt", ".", "load", ")", ")", "\n", "# save model", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.util.cameraExtrinsicMatrix": [[52, 63], ["numpy.array", "np.array.dot", "np.array.dot", "numpy.concatenate", "util.rotMatrixToQuaternion", "util.quaternionToRotMatrix", "R_world2bcam.dot", "numpy.expand_dims", "numpy.array"], "function", ["home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.util.rotMatrixToQuaternion", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.util.quaternionToRotMatrix"], ["", "def", "saveModel", "(", "opt", ",", "sess", ",", "saver", ",", "it", ")", ":", "\n", "\t", "saver", ".", "save", "(", "sess", ",", "\"models_{0}/{1}_it{2}.ckpt\"", ".", "format", "(", "opt", ".", "group", ",", "opt", ".", "model", ",", "it", ")", ")", "\n", "\n", "", ""]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.util.objectCenteredCamPos": [[64, 71], ["numpy.deg2rad", "numpy.deg2rad", "numpy.cos", "numpy.cos", "numpy.sin", "numpy.cos", "numpy.sin"], "function", ["None"], []], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.util.camPosToQuaternion": [[72, 87], ["numpy.linalg.norm", "numpy.linalg.norm", "numpy.arccos", "numpy.arccos", "util.quaternionFromYawPitchRoll", "util.quaternionProduct", "numpy.clip", "numpy.sqrt", "numpy.sqrt", "numpy.arccos"], "function", ["home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.util.quaternionFromYawPitchRoll", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.util.quaternionProduct"], []], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.util.camRotQuaternion": [[88, 98], ["numpy.deg2rad", "numpy.linalg.norm", "numpy.cos", "numpy.sin", "numpy.sin", "numpy.sin"], "function", ["None"], []], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.util.quaternionProduct": [[99, 105], ["None"], "function", ["None"], []], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.util.quaternionFromYawPitchRoll": [[106, 118], ["numpy.cos", "numpy.cos", "numpy.cos", "numpy.sin", "numpy.sin", "numpy.sin"], "function", ["None"], []], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.util.quaternionToRotMatrix": [[119, 124], ["numpy.array"], "function", ["None"], []], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.util.rotMatrixToQuaternion": [[125, 133], ["numpy.sqrt", "numpy.sign", "numpy.abs", "numpy.sign", "numpy.abs", "numpy.sign", "numpy.abs", "numpy.sqrt", "numpy.sqrt", "numpy.sqrt"], "function", ["None"], []], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.util.randomRotation": [[134, 147], ["numpy.linalg.norm", "numpy.arcsin", "numpy.arccos", "numpy.rad2deg", "numpy.rad2deg", "numpy.linalg.norm", "numpy.random.rand", "numpy.cos", "numpy.random.rand"], "function", ["None"], []], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.render.util.getFixedViews": [[148, 196], ["numpy.array", "numpy.sqrt", "numpy.array", "numpy.array", "numpy.sqrt", "numpy.array", "numpy.array", "numpy.sqrt", "numpy.sqrt", "numpy.sqrt", "numpy.sqrt", "numpy.sqrt", "numpy.sqrt", "numpy.sqrt", "numpy.sqrt"], "function", ["None"], []], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.densify.util.parseObj": [[3, 33], ["numpy.array", "numpy.array", "numpy.array", "open", "open", "np.array.append", "np.array.append", "np.array.append", "list", "line.strip().split", "line.strip().split", "set", "np.array.append", "min", "max", "min", "max", "min", "max", "line.strip", "line.strip", "len", "int", "int", "int", "numpy.linalg.matrix_rank", "np.array.append", "tuple", "float", "float", "float", "token[].split", "token[].split", "token[].split"], "function", ["home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.None.options.set"], ["import", "tensorflow", "as", "tf", "\n", "import", "os", "\n", "import", "termcolor", "\n", "\n", "# compute projection from source to target", "\n", "def", "projection", "(", "Vs", ",", "Vt", ")", ":", "\n", "\t", "VsN", "=", "tf", ".", "shape", "(", "Vs", ")", "[", "0", "]", "\n", "VtN", "=", "tf", ".", "shape", "(", "Vt", ")", "[", "0", "]", "\n", "Vt_rep", "=", "tf", ".", "tile", "(", "Vt", "[", "None", ",", ":", ",", ":", "]", ",", "[", "VsN", ",", "1", ",", "1", "]", ")", "# [VsN,VtN,3]", "\n", "Vs_rep", "=", "tf", ".", "tile", "(", "Vs", "[", ":", ",", "None", ",", ":", "]", ",", "[", "1", ",", "VtN", ",", "1", "]", ")", "# [VsN,VtN,3]", "\n", "diff", "=", "Vt_rep", "-", "Vs_rep", "\n", "dist", "=", "tf", ".", "sqrt", "(", "tf", ".", "reduce_sum", "(", "diff", "**", "2", ",", "axis", "=", "[", "2", "]", ")", ")", "# [VsN,VtN]", "\n", "idx", "=", "tf", ".", "to_int32", "(", "tf", ".", "argmin", "(", "dist", ",", "axis", "=", "1", ")", ")", "\n", "proj", "=", "tf", ".", "gather_nd", "(", "Vt_rep", ",", "tf", ".", "stack", "(", "[", "tf", ".", "range", "(", "VsN", ")", ",", "idx", "]", ",", "axis", "=", "1", ")", ")", "\n", "minDist", "=", "tf", ".", "gather_nd", "(", "dist", ",", "tf", ".", "stack", "(", "[", "tf", ".", "range", "(", "VsN", ")", ",", "idx", "]", ",", "axis", "=", "1", ")", ")", "\n", "return", "proj", ",", "minDist", "\n", "\n", "", "def", "mkdir", "(", "path", ")", ":", "\n", "\t", "if", "not", "os", ".", "path", ".", "exists", "(", "path", ")", ":", "os", ".", "makedirs", "(", "path", ")", "\n", "", "def", "imread", "(", "fname", ")", ":", "\n", "\t", "return", "scipy", ".", "misc", ".", "imread", "(", "fname", ")", "/", "255.0", "\n", "", "def", "imsave", "(", "fname", ",", "array", ")", ":", "\n", "\t", "scipy", ".", "misc", ".", "toimage", "(", "array", ",", "cmin", "=", "0.0", ",", "cmax", "=", "1.0", ")", ".", "save", "(", "fname", ")", "\n", "\n", "# convert to colored strings", "\n", "", "def", "toRed", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"red\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n", "def", "toGreen", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"green\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n", "def", "toBlue", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"blue\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n", "def", "toCyan", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"cyan\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n", "def", "toYellow", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"yellow\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n", "def", "toMagenta", "(", "content", ")", ":", "return", "termcolor", ".", "colored", "(", "content", ",", "\"magenta\"", ",", "attrs", "=", "[", "\"bold\"", "]", ")", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.densify.util.removeWeirdDuplicate": [[34, 43], ["F.sort", "F.sort", "len", "range", "F.pop"], "function", ["None"], ["\n", "# make image summary from image batch", "\n", "def", "imageSummary", "(", "opt", ",", "tag", ",", "image", ",", "H", ",", "W", ")", ":", "\n", "\t", "blockSize", "=", "opt", ".", "visBlockSize", "\n", "imageOne", "=", "tf", ".", "batch_to_space", "(", "image", "[", ":", "blockSize", "**", "2", "]", ",", "crops", "=", "[", "[", "0", ",", "0", "]", ",", "[", "0", ",", "0", "]", "]", ",", "block_size", "=", "blockSize", ")", "\n", "imagePermute", "=", "tf", ".", "reshape", "(", "imageOne", ",", "[", "H", ",", "blockSize", ",", "W", ",", "blockSize", ",", "-", "1", "]", ")", "\n", "imageTransp", "=", "tf", ".", "transpose", "(", "imagePermute", ",", "[", "1", ",", "0", ",", "3", ",", "2", ",", "4", "]", ")", "\n", "imageBlocks", "=", "tf", ".", "reshape", "(", "imageTransp", ",", "[", "1", ",", "H", "*", "blockSize", ",", "W", "*", "blockSize", ",", "-", "1", "]", ")", "\n", "summary", "=", "tf", ".", "summary", ".", "image", "(", "tag", ",", "imageBlocks", ")", "\n", "return", "summary", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.densify.util.edgeLength": [[44, 46], ["numpy.linalg.norm"], "function", ["None"], ["\n", "# restore model", "\n", "", "def", "restoreModelFromIt", "(", "opt", ",", "sess", ",", "saver", ",", "it", ")", ":", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.densify.util.pushEtoFandFtoE": [[47, 52], ["EtoF[].append", "FtoE[].append", "numpy.where", "numpy.all"], "function", ["None"], ["\t", "saver", ".", "restore", "(", "sess", ",", "\"models_{0}/{1}_it{2}.ckpt\"", ".", "format", "(", "opt", ".", "group", ",", "opt", ".", "model", ",", "it", ")", ")", "\n", "# restore model", "\n", "", "def", "restoreModel", "(", "opt", ",", "sess", ",", "saver", ")", ":", "\n", "\t", "saver", ".", "restore", "(", "sess", ",", "\"models_{0}/{1}.ckpt\"", ".", "format", "(", "opt", ".", "group", ",", "opt", ".", "load", ")", ")", "\n", "# save model", "\n", "", "def", "saveModel", "(", "opt", ",", "sess", ",", "saver", ",", "it", ")", ":", "\n"]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.densify.util.pushAndSort": [[53, 66], ["util.edgeLength", "util.edgeLength", "util.edgeLength", "Elist.insert", "Elist.insert", "len", "util.edgeLength", "util.edgeLength"], "function", ["home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.densify.util.edgeLength", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.densify.util.edgeLength", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.densify.util.edgeLength", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.densify.util.edgeLength", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.densify.util.edgeLength"], ["\t", "saver", ".", "save", "(", "sess", ",", "\"models_{0}/{1}_it{2}.ckpt\"", ".", "format", "(", "opt", ".", "group", ",", "opt", ".", "model", ",", "it", ")", ")", "\n", "\n", "", ""]], "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.densify.util.densify": [[67, 117], ["len", "len", "Elist.pop", "V.append", "numpy.array", "numpy.array", "E.append", "E.append", "EtoF.append", "EtoF.append", "util.pushAndSort", "util.pushAndSort", "len", "numpy.array", "numpy.array", "F.append", "F.append", "numpy.array", "E.append", "EtoF.append", "EtoF[].append", "EtoF[].append", "FtoE.append", "FtoE.append", "util.pushAndSort", "numpy.ones_like", "numpy.ones_like", "len", "min", "min", "max", "max", "min", "min", "max", "max", "len", "len"], "function", ["home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.densify.util.pushAndSort", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.densify.util.pushAndSort", "home.repos.pwc.inspect_result.chenhsuanlin_3D-point-cloud-generation.densify.util.pushAndSort"], []]}