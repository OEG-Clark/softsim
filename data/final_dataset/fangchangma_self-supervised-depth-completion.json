{"home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.main.iterate": [[151, 253], ["metrics.AverageMeter", "metrics.AverageMeter", "enumerate", "logger.conditional_save_info", "logger.rank_conditional_save_best", "logger.conditional_summarize", "model.train", "helper.adjust_learning_rate", "model.eval", "time.time", "time.time", "model", "logger.save_img_comparison_as_best", "val.to", "time.time", "optimizer.zero_grad", "loss.backward", "optimizer.step", "time.time", "torch.no_grad", "torch.no_grad", "torch.no_grad", "torch.no_grad", "next().size", "metrics.Result", "logger.conditional_print", "logger.conditional_save_img_comparison", "logger.conditional_save_pred", "batch_data.items", "depth_criterion", "helper.multiscale", "helper.multiscale", "helper.multiscale", "len", "range", "smoothness_criterion", "metrics.Result.evaluate", "m.update", "len", "depth_criterion", "helper.multiscale", "len", "kitti_intrinsics.scale", "inverse_warp.homography_from", "next", "pred_.size", "pred_.size", "photometric_criterion", "iter", "batch_data.values"], "function", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.conditional_save_info", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.rank_conditional_save_best", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.conditional_summarize", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.adjust_learning_rate", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.save_img_comparison_as_best", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.conditional_print", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.conditional_save_img_comparison", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.conditional_save_pred", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.multiscale", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.multiscale", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.multiscale", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.Result.evaluate", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.AverageMeter.update", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.multiscale", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.inverse_warp.Intrinsics.scale", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.inverse_warp.homography_from"], ["", "", "def", "iterate", "(", "mode", ",", "args", ",", "loader", ",", "model", ",", "optimizer", ",", "logger", ",", "epoch", ")", ":", "\n", "    ", "block_average_meter", "=", "AverageMeter", "(", ")", "\n", "average_meter", "=", "AverageMeter", "(", ")", "\n", "meters", "=", "[", "block_average_meter", ",", "average_meter", "]", "\n", "\n", "# switch to appropriate mode", "\n", "assert", "mode", "in", "[", "\"train\"", ",", "\"val\"", ",", "\"eval\"", ",", "\"test_prediction\"", ",", "\"test_completion\"", "]", ",", "\"unsupported mode: {}\"", ".", "format", "(", "mode", ")", "\n", "if", "mode", "==", "'train'", ":", "\n", "        ", "model", ".", "train", "(", ")", "\n", "lr", "=", "helper", ".", "adjust_learning_rate", "(", "args", ".", "lr", ",", "optimizer", ",", "epoch", ")", "\n", "", "else", ":", "\n", "        ", "model", ".", "eval", "(", ")", "\n", "lr", "=", "0", "\n", "\n", "", "for", "i", ",", "batch_data", "in", "enumerate", "(", "loader", ")", ":", "\n", "        ", "start", "=", "time", ".", "time", "(", ")", "\n", "batch_data", "=", "{", "\n", "key", ":", "val", ".", "to", "(", "device", ")", "\n", "for", "key", ",", "val", "in", "batch_data", ".", "items", "(", ")", "if", "val", "is", "not", "None", "\n", "}", "\n", "gt", "=", "batch_data", "[", "\n", "'gt'", "]", "if", "mode", "!=", "'test_prediction'", "and", "mode", "!=", "'test_completion'", "else", "None", "\n", "data_time", "=", "time", ".", "time", "(", ")", "-", "start", "\n", "\n", "start", "=", "time", ".", "time", "(", ")", "\n", "pred", "=", "model", "(", "batch_data", ")", "\n", "depth_loss", ",", "photometric_loss", ",", "smooth_loss", ",", "mask", "=", "0", ",", "0", ",", "0", ",", "None", "\n", "if", "mode", "==", "'train'", ":", "\n", "# Loss 1: the direct depth supervision from ground truth label", "\n", "# mask=1 indicates that a pixel does not ground truth labels", "\n", "            ", "if", "'sparse'", "in", "args", ".", "train_mode", ":", "\n", "                ", "depth_loss", "=", "depth_criterion", "(", "pred", ",", "batch_data", "[", "'d'", "]", ")", "\n", "mask", "=", "(", "batch_data", "[", "'d'", "]", "<", "1e-3", ")", ".", "float", "(", ")", "\n", "", "elif", "'dense'", "in", "args", ".", "train_mode", ":", "\n", "                ", "depth_loss", "=", "depth_criterion", "(", "pred", ",", "gt", ")", "\n", "mask", "=", "(", "gt", "<", "1e-3", ")", ".", "float", "(", ")", "\n", "\n", "# Loss 2: the self-supervised photometric loss", "\n", "", "if", "args", ".", "use_pose", ":", "\n", "# create multi-scale pyramids", "\n", "                ", "pred_array", "=", "helper", ".", "multiscale", "(", "pred", ")", "\n", "rgb_curr_array", "=", "helper", ".", "multiscale", "(", "batch_data", "[", "'rgb'", "]", ")", "\n", "rgb_near_array", "=", "helper", ".", "multiscale", "(", "batch_data", "[", "'rgb_near'", "]", ")", "\n", "if", "mask", "is", "not", "None", ":", "\n", "                    ", "mask_array", "=", "helper", ".", "multiscale", "(", "mask", ")", "\n", "", "num_scales", "=", "len", "(", "pred_array", ")", "\n", "\n", "# compute photometric loss at multiple scales", "\n", "for", "scale", "in", "range", "(", "len", "(", "pred_array", ")", ")", ":", "\n", "                    ", "pred_", "=", "pred_array", "[", "scale", "]", "\n", "rgb_curr_", "=", "rgb_curr_array", "[", "scale", "]", "\n", "rgb_near_", "=", "rgb_near_array", "[", "scale", "]", "\n", "mask_", "=", "None", "\n", "if", "mask", "is", "not", "None", ":", "\n", "                        ", "mask_", "=", "mask_array", "[", "scale", "]", "\n", "\n", "# compute the corresponding intrinsic parameters", "\n", "", "height_", ",", "width_", "=", "pred_", ".", "size", "(", "2", ")", ",", "pred_", ".", "size", "(", "3", ")", "\n", "intrinsics_", "=", "kitti_intrinsics", ".", "scale", "(", "height_", ",", "width_", ")", "\n", "\n", "# inverse warp from a nearby frame to the current frame", "\n", "warped_", "=", "homography_from", "(", "rgb_near_", ",", "pred_", ",", "\n", "batch_data", "[", "'r_mat'", "]", ",", "\n", "batch_data", "[", "'t_vec'", "]", ",", "intrinsics_", ")", "\n", "photometric_loss", "+=", "photometric_criterion", "(", "\n", "rgb_curr_", ",", "warped_", ",", "mask_", ")", "*", "(", "2", "**", "(", "scale", "-", "num_scales", ")", ")", "\n", "\n", "# Loss 3: the depth smoothness loss", "\n", "", "", "smooth_loss", "=", "smoothness_criterion", "(", "pred", ")", "if", "args", ".", "w2", ">", "0", "else", "0", "\n", "\n", "# backprop", "\n", "loss", "=", "depth_loss", "+", "args", ".", "w1", "*", "photometric_loss", "+", "args", ".", "w2", "*", "smooth_loss", "\n", "optimizer", ".", "zero_grad", "(", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "optimizer", ".", "step", "(", ")", "\n", "\n", "", "gpu_time", "=", "time", ".", "time", "(", ")", "-", "start", "\n", "\n", "# measure accuracy and record loss", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "            ", "mini_batch_size", "=", "next", "(", "iter", "(", "batch_data", ".", "values", "(", ")", ")", ")", ".", "size", "(", "0", ")", "\n", "result", "=", "Result", "(", ")", "\n", "if", "mode", "!=", "'test_prediction'", "and", "mode", "!=", "'test_completion'", ":", "\n", "                ", "result", ".", "evaluate", "(", "pred", ".", "data", ",", "gt", ".", "data", ",", "photometric_loss", ")", "\n", "", "[", "\n", "m", ".", "update", "(", "result", ",", "gpu_time", ",", "data_time", ",", "mini_batch_size", ")", "\n", "for", "m", "in", "meters", "\n", "]", "\n", "logger", ".", "conditional_print", "(", "mode", ",", "i", ",", "epoch", ",", "lr", ",", "len", "(", "loader", ")", ",", "\n", "block_average_meter", ",", "average_meter", ")", "\n", "logger", ".", "conditional_save_img_comparison", "(", "mode", ",", "i", ",", "batch_data", ",", "pred", ",", "\n", "epoch", ")", "\n", "logger", ".", "conditional_save_pred", "(", "mode", ",", "i", ",", "pred", ",", "epoch", ")", "\n", "\n", "", "", "avg", "=", "logger", ".", "conditional_save_info", "(", "mode", ",", "average_meter", ",", "epoch", ")", "\n", "is_best", "=", "logger", ".", "rank_conditional_save_best", "(", "mode", ",", "avg", ",", "epoch", ")", "\n", "if", "is_best", "and", "not", "(", "mode", "==", "\"train\"", ")", ":", "\n", "        ", "logger", ".", "save_img_comparison_as_best", "(", "mode", ",", "epoch", ")", "\n", "", "logger", ".", "conditional_summarize", "(", "mode", ",", "avg", ",", "is_best", ")", "\n", "\n", "return", "avg", ",", "is_best", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.main.main": [[255, 351], ["print", "model.DepthCompletionNet().to", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "print", "torch.nn.DataParallel", "torch.nn.DataParallel", "torch.nn.DataParallel", "torch.nn.DataParallel", "print", "dataloaders.kitti_loader.KittiDepth", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "print", "helper.logger", "print", "print", "range", "os.path.isfile", "torch.nn.DataParallel.load_state_dict", "torch.optim.Adam.load_state_dict", "print", "dataloaders.kitti_loader.KittiDepth", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "print", "print", "main.iterate", "print", "main.iterate", "main.iterate", "helper.save_checkpoint", "print", "torch.load", "torch.load", "torch.load", "torch.load", "print", "print", "os.path.isfile", "model.DepthCompletionNet", "torch.nn.DataParallel.named_parameters", "len", "print", "torch.load", "torch.load", "torch.load", "torch.load", "print", "print", "len", "torch.nn.DataParallel.module.state_dict", "torch.optim.Adam.state_dict"], "function", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.main.iterate", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.main.iterate", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.main.iterate", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.save_checkpoint"], ["", "def", "main", "(", ")", ":", "\n", "    ", "global", "args", "\n", "checkpoint", "=", "None", "\n", "is_eval", "=", "False", "\n", "if", "args", ".", "evaluate", ":", "\n", "        ", "args_new", "=", "args", "\n", "if", "os", ".", "path", ".", "isfile", "(", "args", ".", "evaluate", ")", ":", "\n", "            ", "print", "(", "\"=> loading checkpoint '{}' ... \"", ".", "format", "(", "args", ".", "evaluate", ")", ",", "\n", "end", "=", "''", ")", "\n", "checkpoint", "=", "torch", ".", "load", "(", "args", ".", "evaluate", ",", "map_location", "=", "device", ")", "\n", "args", "=", "checkpoint", "[", "'args'", "]", "\n", "args", ".", "data_folder", "=", "args_new", ".", "data_folder", "\n", "args", ".", "val", "=", "args_new", ".", "val", "\n", "is_eval", "=", "True", "\n", "print", "(", "\"Completed.\"", ")", "\n", "", "else", ":", "\n", "            ", "print", "(", "\"No model found at '{}'\"", ".", "format", "(", "args", ".", "evaluate", ")", ")", "\n", "return", "\n", "", "", "elif", "args", ".", "resume", ":", "# optionally resume from a checkpoint", "\n", "        ", "args_new", "=", "args", "\n", "if", "os", ".", "path", ".", "isfile", "(", "args", ".", "resume", ")", ":", "\n", "            ", "print", "(", "\"=> loading checkpoint '{}' ... \"", ".", "format", "(", "args", ".", "resume", ")", ",", "\n", "end", "=", "''", ")", "\n", "checkpoint", "=", "torch", ".", "load", "(", "args", ".", "resume", ",", "map_location", "=", "device", ")", "\n", "args", ".", "start_epoch", "=", "checkpoint", "[", "'epoch'", "]", "+", "1", "\n", "args", ".", "data_folder", "=", "args_new", ".", "data_folder", "\n", "args", ".", "val", "=", "args_new", ".", "val", "\n", "print", "(", "\"Completed. Resuming from epoch {}.\"", ".", "format", "(", "\n", "checkpoint", "[", "'epoch'", "]", ")", ")", "\n", "", "else", ":", "\n", "            ", "print", "(", "\"No checkpoint found at '{}'\"", ".", "format", "(", "args", ".", "resume", ")", ")", "\n", "return", "\n", "\n", "", "", "print", "(", "\"=> creating model and optimizer ... \"", ",", "end", "=", "''", ")", "\n", "model", "=", "DepthCompletionNet", "(", "args", ")", ".", "to", "(", "device", ")", "\n", "model_named_params", "=", "[", "\n", "p", "for", "_", ",", "p", "in", "model", ".", "named_parameters", "(", ")", "if", "p", ".", "requires_grad", "\n", "]", "\n", "optimizer", "=", "torch", ".", "optim", ".", "Adam", "(", "model_named_params", ",", "\n", "lr", "=", "args", ".", "lr", ",", "\n", "weight_decay", "=", "args", ".", "weight_decay", ")", "\n", "print", "(", "\"completed.\"", ")", "\n", "if", "checkpoint", "is", "not", "None", ":", "\n", "        ", "model", ".", "load_state_dict", "(", "checkpoint", "[", "'model'", "]", ")", "\n", "optimizer", ".", "load_state_dict", "(", "checkpoint", "[", "'optimizer'", "]", ")", "\n", "print", "(", "\"=> checkpoint state loaded.\"", ")", "\n", "\n", "", "model", "=", "torch", ".", "nn", ".", "DataParallel", "(", "model", ")", "\n", "\n", "# Data loading code", "\n", "print", "(", "\"=> creating data loaders ... \"", ")", "\n", "if", "not", "is_eval", ":", "\n", "        ", "train_dataset", "=", "KittiDepth", "(", "'train'", ",", "args", ")", "\n", "train_loader", "=", "torch", ".", "utils", ".", "data", ".", "DataLoader", "(", "train_dataset", ",", "\n", "batch_size", "=", "args", ".", "batch_size", ",", "\n", "shuffle", "=", "True", ",", "\n", "num_workers", "=", "args", ".", "workers", ",", "\n", "pin_memory", "=", "True", ",", "\n", "sampler", "=", "None", ")", "\n", "print", "(", "\"\\t==> train_loader size:{}\"", ".", "format", "(", "len", "(", "train_loader", ")", ")", ")", "\n", "", "val_dataset", "=", "KittiDepth", "(", "'val'", ",", "args", ")", "\n", "val_loader", "=", "torch", ".", "utils", ".", "data", ".", "DataLoader", "(", "\n", "val_dataset", ",", "\n", "batch_size", "=", "1", ",", "\n", "shuffle", "=", "False", ",", "\n", "num_workers", "=", "2", ",", "\n", "pin_memory", "=", "True", ")", "# set batch size to be 1 for validation", "\n", "print", "(", "\"\\t==> val_loader size:{}\"", ".", "format", "(", "len", "(", "val_loader", ")", ")", ")", "\n", "\n", "# create backups and results folder", "\n", "logger", "=", "helper", ".", "logger", "(", "args", ")", "\n", "if", "checkpoint", "is", "not", "None", ":", "\n", "        ", "logger", ".", "best_result", "=", "checkpoint", "[", "'best_result'", "]", "\n", "", "print", "(", "\"=> logger created.\"", ")", "\n", "\n", "if", "is_eval", ":", "\n", "        ", "print", "(", "\"=> starting model evaluation ...\"", ")", "\n", "result", ",", "is_best", "=", "iterate", "(", "\"val\"", ",", "args", ",", "val_loader", ",", "model", ",", "None", ",", "logger", ",", "\n", "checkpoint", "[", "'epoch'", "]", ")", "\n", "return", "\n", "\n", "# main loop", "\n", "", "print", "(", "\"=> starting main loop ...\"", ")", "\n", "for", "epoch", "in", "range", "(", "args", ".", "start_epoch", ",", "args", ".", "epochs", ")", ":", "\n", "        ", "print", "(", "\"=> starting training epoch {} ..\"", ".", "format", "(", "epoch", ")", ")", "\n", "iterate", "(", "\"train\"", ",", "args", ",", "train_loader", ",", "model", ",", "optimizer", ",", "logger", ",", "\n", "epoch", ")", "# train for one epoch", "\n", "result", ",", "is_best", "=", "iterate", "(", "\"val\"", ",", "args", ",", "val_loader", ",", "model", ",", "None", ",", "logger", ",", "\n", "epoch", ")", "# evaluate on validation set", "\n", "helper", ".", "save_checkpoint", "(", "{", "# save checkpoint", "\n", "'epoch'", ":", "epoch", ",", "\n", "'model'", ":", "model", ".", "module", ".", "state_dict", "(", ")", ",", "\n", "'best_result'", ":", "logger", ".", "best_result", ",", "\n", "'optimizer'", ":", "optimizer", ".", "state_dict", "(", ")", ",", "\n", "'args'", ":", "args", ",", "\n", "}", ",", "is_best", ",", "epoch", ",", "logger", ".", "output_directory", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.vis_utils.depth_colorize": [[13, 17], ["depth.astype", "numpy.min", "numpy.max", "numpy.min", "cmap"], "function", ["None"], ["def", "depth_colorize", "(", "depth", ")", ":", "\n", "    ", "depth", "=", "(", "depth", "-", "np", ".", "min", "(", "depth", ")", ")", "/", "(", "np", ".", "max", "(", "depth", ")", "-", "np", ".", "min", "(", "depth", ")", ")", "\n", "depth", "=", "255", "*", "cmap", "(", "depth", ")", "[", ":", ",", ":", ",", ":", "3", "]", "# H, W, C", "\n", "return", "depth", ".", "astype", "(", "'uint8'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.vis_utils.merge_into_row": [[19, 42], ["img_list.append", "numpy.hstack", "np.hstack.astype", "numpy.squeeze", "vis_utils.depth_colorize", "numpy.squeeze", "numpy.transpose", "img_list.append", "img_list.append", "vis_utils.merge_into_row.preprocess_depth"], "function", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.vis_utils.depth_colorize"], ["", "def", "merge_into_row", "(", "ele", ",", "pred", ")", ":", "\n", "    ", "def", "preprocess_depth", "(", "x", ")", ":", "\n", "        ", "y", "=", "np", ".", "squeeze", "(", "x", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ")", "\n", "return", "depth_colorize", "(", "y", ")", "\n", "\n", "# if is gray, transforms to rgb", "\n", "", "img_list", "=", "[", "]", "\n", "if", "'rgb'", "in", "ele", ":", "\n", "        ", "rgb", "=", "np", ".", "squeeze", "(", "ele", "[", "'rgb'", "]", "[", "0", ",", "...", "]", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ")", "\n", "rgb", "=", "np", ".", "transpose", "(", "rgb", ",", "(", "1", ",", "2", ",", "0", ")", ")", "\n", "img_list", ".", "append", "(", "rgb", ")", "\n", "", "elif", "'g'", "in", "ele", ":", "\n", "        ", "g", "=", "np", ".", "squeeze", "(", "ele", "[", "'g'", "]", "[", "0", ",", "...", "]", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ")", "\n", "g", "=", "np", ".", "array", "(", "Image", ".", "fromarray", "(", "g", ")", ".", "convert", "(", "'RGB'", ")", ")", "\n", "img_list", ".", "append", "(", "g", ")", "\n", "", "if", "'d'", "in", "ele", ":", "\n", "        ", "img_list", ".", "append", "(", "preprocess_depth", "(", "ele", "[", "'d'", "]", "[", "0", ",", "...", "]", ")", ")", "\n", "", "img_list", ".", "append", "(", "preprocess_depth", "(", "pred", "[", "0", ",", "...", "]", ")", ")", "\n", "if", "'gt'", "in", "ele", ":", "\n", "        ", "img_list", ".", "append", "(", "preprocess_depth", "(", "ele", "[", "'gt'", "]", "[", "0", ",", "...", "]", ")", ")", "\n", "\n", "", "img_merge", "=", "np", ".", "hstack", "(", "img_list", ")", "\n", "return", "img_merge", ".", "astype", "(", "'uint8'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.vis_utils.add_row": [[44, 46], ["numpy.vstack"], "function", ["None"], ["", "def", "add_row", "(", "img_merge", ",", "row", ")", ":", "\n", "    ", "return", "np", ".", "vstack", "(", "[", "img_merge", ",", "row", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.vis_utils.save_image": [[48, 51], ["cv2.cvtColor", "cv2.imwrite"], "function", ["None"], ["", "def", "save_image", "(", "img_merge", ",", "filename", ")", ":", "\n", "    ", "image_to_write", "=", "cv2", ".", "cvtColor", "(", "img_merge", ",", "cv2", ".", "COLOR_RGB2BGR", ")", "\n", "cv2", ".", "imwrite", "(", "filename", ",", "image_to_write", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.vis_utils.save_depth_as_uint16png": [[53, 56], ["cv2.imwrite"], "function", ["None"], ["", "def", "save_depth_as_uint16png", "(", "img", ",", "filename", ")", ":", "\n", "    ", "img", "=", "(", "img", "*", "256", ")", ".", "astype", "(", "'uint16'", ")", "\n", "cv2", ".", "imwrite", "(", "filename", ",", "img", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.vis_utils.display_warping": [[64, 114], ["vis_utils.display_warping.preprocess"], "function", ["None"], ["", "def", "display_warping", "(", "rgb_tgt", ",", "pred_tgt", ",", "warped", ")", ":", "\n", "    ", "def", "preprocess", "(", "rgb_tgt", ",", "pred_tgt", ",", "warped", ")", ":", "\n", "        ", "rgb_tgt", "=", "255", "*", "np", ".", "transpose", "(", "np", ".", "squeeze", "(", "rgb_tgt", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ")", ",", "\n", "(", "1", ",", "2", ",", "0", ")", ")", "# H, W, C", "\n", "# depth = np.squeeze(depth.cpu().numpy())", "\n", "# depth = depth_colorize(depth)", "\n", "\n", "# convert to log-scale", "\n", "pred_tgt", "=", "np", ".", "squeeze", "(", "pred_tgt", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ")", "\n", "# pred_tgt[pred_tgt<=0] = 0.9 # remove negative predictions", "\n", "# pred_tgt = np.log10(pred_tgt)", "\n", "\n", "pred_tgt", "=", "depth_colorize", "(", "pred_tgt", ")", "\n", "\n", "warped", "=", "255", "*", "np", ".", "transpose", "(", "np", ".", "squeeze", "(", "warped", ".", "data", ".", "cpu", "(", ")", ".", "numpy", "(", ")", ")", ",", "\n", "(", "1", ",", "2", ",", "0", ")", ")", "# H, W, C", "\n", "recon_err", "=", "np", ".", "absolute", "(", "\n", "warped", ".", "astype", "(", "'float'", ")", "-", "rgb_tgt", ".", "astype", "(", "'float'", ")", ")", "*", "(", "warped", ">", "0", ")", "\n", "recon_err", "=", "recon_err", "[", ":", ",", ":", ",", "0", "]", "+", "recon_err", "[", ":", ",", ":", ",", "1", "]", "+", "recon_err", "[", ":", ",", ":", ",", "2", "]", "\n", "recon_err", "=", "depth_colorize", "(", "recon_err", ")", "\n", "return", "rgb_tgt", ".", "astype", "(", "'uint8'", ")", ",", "warped", ".", "astype", "(", "\n", "'uint8'", ")", ",", "recon_err", ",", "pred_tgt", "\n", "\n", "", "rgb_tgt", ",", "warped", ",", "recon_err", ",", "pred_tgt", "=", "preprocess", "(", "rgb_tgt", ",", "pred_tgt", ",", "\n", "warped", ")", "\n", "\n", "# 1st column", "\n", "column", "=", "0", "\n", "axarr", "[", "0", "]", ".", "imshow", "(", "rgb_tgt", ")", "\n", "axarr", "[", "0", "]", ".", "axis", "(", "'off'", ")", "\n", "axarr", "[", "0", "]", ".", "axis", "(", "'equal'", ")", "\n", "# axarr[0, column].set_title('rgb_tgt')", "\n", "\n", "axarr", "[", "1", "]", ".", "imshow", "(", "warped", ")", "\n", "axarr", "[", "1", "]", ".", "axis", "(", "'off'", ")", "\n", "axarr", "[", "1", "]", ".", "axis", "(", "'equal'", ")", "\n", "# axarr[1, column].set_title('warped')", "\n", "\n", "axarr", "[", "2", "]", ".", "imshow", "(", "recon_err", ",", "'hot'", ")", "\n", "axarr", "[", "2", "]", ".", "axis", "(", "'off'", ")", "\n", "axarr", "[", "2", "]", ".", "axis", "(", "'equal'", ")", "\n", "# axarr[2, column].set_title('recon_err error')", "\n", "\n", "axarr", "[", "3", "]", ".", "imshow", "(", "pred_tgt", ",", "'hot'", ")", "\n", "axarr", "[", "3", "]", ".", "axis", "(", "'off'", ")", "\n", "axarr", "[", "3", "]", ".", "axis", "(", "'equal'", ")", "\n", "# axarr[3, column].set_title('pred_tgt')", "\n", "\n", "# plt.show()", "\n", "plt", ".", "pause", "(", "0.001", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.criteria.MaskedMSELoss.__init__": [[8, 10], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.KittiDepth.__init__"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", "MaskedMSELoss", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.criteria.MaskedMSELoss.forward": [[11, 18], ["pred.dim", "target.dim"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "pred", ",", "target", ")", ":", "\n", "        ", "assert", "pred", ".", "dim", "(", ")", "==", "target", ".", "dim", "(", ")", ",", "\"inconsistent dimensions\"", "\n", "valid_mask", "=", "(", "target", ">", "0", ")", ".", "detach", "(", ")", "\n", "diff", "=", "target", "-", "pred", "\n", "diff", "=", "diff", "[", "valid_mask", "]", "\n", "self", ".", "loss", "=", "(", "diff", "**", "2", ")", ".", "mean", "(", ")", "\n", "return", "self", ".", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.criteria.MaskedL1Loss.__init__": [[21, 23], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.KittiDepth.__init__"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", "MaskedL1Loss", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.criteria.MaskedL1Loss.forward": [[24, 31], ["diff.abs().mean", "pred.dim", "target.dim", "diff.abs"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "pred", ",", "target", ",", "weight", "=", "None", ")", ":", "\n", "        ", "assert", "pred", ".", "dim", "(", ")", "==", "target", ".", "dim", "(", ")", ",", "\"inconsistent dimensions\"", "\n", "valid_mask", "=", "(", "target", ">", "0", ")", ".", "detach", "(", ")", "\n", "diff", "=", "target", "-", "pred", "\n", "diff", "=", "diff", "[", "valid_mask", "]", "\n", "self", ".", "loss", "=", "diff", ".", "abs", "(", ")", ".", "mean", "(", ")", "\n", "return", "self", ".", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.criteria.PhotometricLoss.__init__": [[34, 36], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.KittiDepth.__init__"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", "PhotometricLoss", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.criteria.PhotometricLoss.forward": [[37, 69], ["torch.sum", "torch.sum", "torch.sum", "torch.sum", "valid_mask.byte().detach.byte().detach.byte().detach", "recon.dim", "recon.dim", "target.dim", "target.dim", "recon.size", "target.size", "recon.size", "target.size", "valid_mask.byte().detach.byte().detach.numel", "print", "torch.squeeze().float", "torch.squeeze().float", "torch.squeeze().float", "torch.squeeze().float", "valid_mask.byte().detach.byte().detach.byte", "torch.sum.nelement", "torch.sum.nelement", "torch.sum.mean", "torch.sum.mean", "print", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.squeeze", "torch.squeeze", "torch.squeeze", "torch.squeeze"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "target", ",", "recon", ",", "mask", "=", "None", ")", ":", "\n", "\n", "        ", "assert", "recon", ".", "dim", "(", "\n", ")", "==", "4", ",", "\"expected recon dimension to be 4, but instead got {}.\"", ".", "format", "(", "\n", "recon", ".", "dim", "(", ")", ")", "\n", "assert", "target", ".", "dim", "(", "\n", ")", "==", "4", ",", "\"expected target dimension to be 4, but instead got {}.\"", ".", "format", "(", "\n", "target", ".", "dim", "(", ")", ")", "\n", "assert", "recon", ".", "size", "(", ")", "==", "target", ".", "size", "(", ")", ",", "\"expected recon and target to have the same size, but got {} and {} instead\"", ".", "format", "(", "recon", ".", "size", "(", ")", ",", "target", ".", "size", "(", ")", ")", "\n", "diff", "=", "(", "target", "-", "recon", ")", ".", "abs", "(", ")", "\n", "diff", "=", "torch", ".", "sum", "(", "diff", ",", "1", ")", "# sum along the color channel", "\n", "\n", "# compare only pixels that are not black", "\n", "valid_mask", "=", "(", "torch", ".", "sum", "(", "recon", ",", "1", ")", ">", "0", ")", ".", "float", "(", ")", "*", "(", "torch", ".", "sum", "(", "target", ",", "1", ")", "\n", ">", "0", ")", ".", "float", "(", ")", "\n", "if", "mask", "is", "not", "None", ":", "\n", "            ", "valid_mask", "=", "valid_mask", "*", "torch", ".", "squeeze", "(", "mask", ")", ".", "float", "(", ")", "\n", "", "valid_mask", "=", "valid_mask", ".", "byte", "(", ")", ".", "detach", "(", ")", "\n", "if", "valid_mask", ".", "numel", "(", ")", ">", "0", ":", "\n", "            ", "diff", "=", "diff", "[", "valid_mask", "]", "\n", "if", "diff", ".", "nelement", "(", ")", ">", "0", ":", "\n", "                ", "self", ".", "loss", "=", "diff", ".", "mean", "(", ")", "\n", "", "else", ":", "\n", "                ", "print", "(", "\n", "\"warning: diff.nelement()==0 in PhotometricLoss (this is expected during early stage of training, try larger batch size).\"", "\n", ")", "\n", "self", ".", "loss", "=", "0", "\n", "", "", "else", ":", "\n", "            ", "print", "(", "\"warning: 0 valid pixel in PhotometricLoss\"", ")", "\n", "self", ".", "loss", "=", "0", "\n", "", "return", "self", ".", "loss", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.criteria.SmoothnessLoss.__init__": [[72, 74], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.KittiDepth.__init__"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", "SmoothnessLoss", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.criteria.SmoothnessLoss.forward": [[75, 89], ["criteria.SmoothnessLoss.forward.second_derivative"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "depth", ")", ":", "\n", "        ", "def", "second_derivative", "(", "x", ")", ":", "\n", "            ", "assert", "x", ".", "dim", "(", "\n", ")", "==", "4", ",", "\"expected 4-dimensional data, but instead got {}\"", ".", "format", "(", "\n", "x", ".", "dim", "(", ")", ")", "\n", "horizontal", "=", "2", "*", "x", "[", ":", ",", ":", ",", "1", ":", "-", "1", ",", "1", ":", "-", "1", "]", "-", "x", "[", ":", ",", ":", ",", "1", ":", "-", "1", ",", ":", "\n", "-", "2", "]", "-", "x", "[", ":", ",", ":", ",", "1", ":", "-", "1", ",", "2", ":", "]", "\n", "vertical", "=", "2", "*", "x", "[", ":", ",", ":", ",", "1", ":", "-", "1", ",", "1", ":", "-", "1", "]", "-", "x", "[", ":", ",", ":", ",", ":", "-", "2", ",", "1", ":", "\n", "-", "1", "]", "-", "x", "[", ":", ",", ":", ",", "2", ":", ",", "1", ":", "-", "1", "]", "\n", "der_2nd", "=", "horizontal", ".", "abs", "(", ")", "+", "vertical", ".", "abs", "(", ")", "\n", "return", "der_2nd", ".", "mean", "(", ")", "\n", "\n", "", "self", ".", "loss", "=", "second_derivative", "(", "depth", ")", "\n", "return", "self", ".", "loss", "\n", "", "", ""]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.Result.__init__": [[14, 30], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "irmse", "=", "0", "\n", "self", ".", "imae", "=", "0", "\n", "self", ".", "mse", "=", "0", "\n", "self", ".", "rmse", "=", "0", "\n", "self", ".", "mae", "=", "0", "\n", "self", ".", "absrel", "=", "0", "\n", "self", ".", "squared_rel", "=", "0", "\n", "self", ".", "lg10", "=", "0", "\n", "self", ".", "delta1", "=", "0", "\n", "self", ".", "delta2", "=", "0", "\n", "self", ".", "delta3", "=", "0", "\n", "self", ".", "data_time", "=", "0", "\n", "self", ".", "gpu_time", "=", "0", "\n", "self", ".", "silog", "=", "0", "# Scale invariant logarithmic error [log(m)*100]", "\n", "self", ".", "photometric", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.Result.set_to_worst": [[31, 46], ["None"], "methods", ["None"], ["", "def", "set_to_worst", "(", "self", ")", ":", "\n", "        ", "self", ".", "irmse", "=", "np", ".", "inf", "\n", "self", ".", "imae", "=", "np", ".", "inf", "\n", "self", ".", "mse", "=", "np", ".", "inf", "\n", "self", ".", "rmse", "=", "np", ".", "inf", "\n", "self", ".", "mae", "=", "np", ".", "inf", "\n", "self", ".", "absrel", "=", "np", ".", "inf", "\n", "self", ".", "squared_rel", "=", "np", ".", "inf", "\n", "self", ".", "lg10", "=", "np", ".", "inf", "\n", "self", ".", "silog", "=", "np", ".", "inf", "\n", "self", ".", "delta1", "=", "0", "\n", "self", ".", "delta2", "=", "0", "\n", "self", ".", "delta3", "=", "0", "\n", "self", ".", "data_time", "=", "0", "\n", "self", ".", "gpu_time", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.Result.update": [[47, 64], ["None"], "methods", ["None"], ["", "def", "update", "(", "self", ",", "irmse", ",", "imae", ",", "mse", ",", "rmse", ",", "mae", ",", "absrel", ",", "squared_rel", ",", "lg10", ",", "delta1", ",", "delta2", ",", "delta3", ",", "gpu_time", ",", "data_time", ",", "silog", ",", "photometric", "=", "0", ")", ":", "\n", "        ", "self", ".", "irmse", "=", "irmse", "\n", "self", ".", "imae", "=", "imae", "\n", "self", ".", "mse", "=", "mse", "\n", "self", ".", "rmse", "=", "rmse", "\n", "self", ".", "mae", "=", "mae", "\n", "self", ".", "absrel", "=", "absrel", "\n", "self", ".", "squared_rel", "=", "squared_rel", "\n", "self", ".", "lg10", "=", "lg10", "\n", "self", ".", "delta1", "=", "delta1", "\n", "self", ".", "delta2", "=", "delta2", "\n", "self", ".", "delta3", "=", "delta3", "\n", "self", ".", "data_time", "=", "data_time", "\n", "self", ".", "gpu_time", "=", "gpu_time", "\n", "self", ".", "silog", "=", "silog", "\n", "self", ".", "photometric", "=", "photometric", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.Result.evaluate": [[65, 103], ["float", "math.sqrt", "float", "float", "float", "float", "torch.max", "float", "float", "float", "err_log.mean", "math.sqrt", "float", "float", "torch.pow().mean", "abs_diff.mean", "torch.log", "torch.log", "math.sqrt", "torch.pow().mean", "abs_inv_diff.mean", "torch.pow", "torch.pow", "metrics.log10", "metrics.log10"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.log10", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.log10"], ["", "def", "evaluate", "(", "self", ",", "output", ",", "target", ",", "photometric", "=", "0", ")", ":", "\n", "        ", "valid_mask", "=", "target", ">", "0.1", "\n", "\n", "# convert from meters to mm", "\n", "output_mm", "=", "1e3", "*", "output", "[", "valid_mask", "]", "\n", "target_mm", "=", "1e3", "*", "target", "[", "valid_mask", "]", "\n", "\n", "abs_diff", "=", "(", "output_mm", "-", "target_mm", ")", ".", "abs", "(", ")", "\n", "\n", "self", ".", "mse", "=", "float", "(", "(", "torch", ".", "pow", "(", "abs_diff", ",", "2", ")", ")", ".", "mean", "(", ")", ")", "\n", "self", ".", "rmse", "=", "math", ".", "sqrt", "(", "self", ".", "mse", ")", "\n", "self", ".", "mae", "=", "float", "(", "abs_diff", ".", "mean", "(", ")", ")", "\n", "self", ".", "lg10", "=", "float", "(", "(", "log10", "(", "output_mm", ")", "-", "log10", "(", "target_mm", ")", ")", ".", "abs", "(", ")", ".", "mean", "(", ")", ")", "\n", "self", ".", "absrel", "=", "float", "(", "(", "abs_diff", "/", "target_mm", ")", ".", "mean", "(", ")", ")", "\n", "self", ".", "squared_rel", "=", "float", "(", "(", "(", "abs_diff", "/", "target_mm", ")", "**", "2", ")", ".", "mean", "(", ")", ")", "\n", "\n", "maxRatio", "=", "torch", ".", "max", "(", "output_mm", "/", "target_mm", ",", "target_mm", "/", "output_mm", ")", "\n", "self", ".", "delta1", "=", "float", "(", "(", "maxRatio", "<", "1.25", ")", ".", "float", "(", ")", ".", "mean", "(", ")", ")", "\n", "self", ".", "delta2", "=", "float", "(", "(", "maxRatio", "<", "1.25", "**", "2", ")", ".", "float", "(", ")", ".", "mean", "(", ")", ")", "\n", "self", ".", "delta3", "=", "float", "(", "(", "maxRatio", "<", "1.25", "**", "3", ")", ".", "float", "(", ")", ".", "mean", "(", ")", ")", "\n", "self", ".", "data_time", "=", "0", "\n", "self", ".", "gpu_time", "=", "0", "\n", "\n", "# silog uses meters", "\n", "err_log", "=", "torch", ".", "log", "(", "target", "[", "valid_mask", "]", ")", "-", "torch", ".", "log", "(", "output", "[", "valid_mask", "]", ")", "\n", "normalized_squared_log", "=", "(", "err_log", "**", "2", ")", ".", "mean", "(", ")", "\n", "log_mean", "=", "err_log", ".", "mean", "(", ")", "\n", "self", ".", "silog", "=", "math", ".", "sqrt", "(", "normalized_squared_log", "-", "\n", "log_mean", "*", "log_mean", ")", "*", "100", "\n", "\n", "# convert from meters to km", "\n", "inv_output_km", "=", "(", "1e-3", "*", "output", "[", "valid_mask", "]", ")", "**", "(", "-", "1", ")", "\n", "inv_target_km", "=", "(", "1e-3", "*", "target", "[", "valid_mask", "]", ")", "**", "(", "-", "1", ")", "\n", "abs_inv_diff", "=", "(", "inv_output_km", "-", "inv_target_km", ")", ".", "abs", "(", ")", "\n", "self", ".", "irmse", "=", "math", ".", "sqrt", "(", "(", "torch", ".", "pow", "(", "abs_inv_diff", ",", "2", ")", ")", ".", "mean", "(", ")", ")", "\n", "self", ".", "imae", "=", "float", "(", "abs_inv_diff", ".", "mean", "(", ")", ")", "\n", "\n", "self", ".", "photometric", "=", "float", "(", "photometric", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.AverageMeter.__init__": [[106, 108], ["metrics.AverageMeter.reset"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.AverageMeter.reset"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "reset", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.AverageMeter.reset": [[109, 126], ["None"], "methods", ["None"], ["", "def", "reset", "(", "self", ")", ":", "\n", "        ", "self", ".", "count", "=", "0.0", "\n", "self", ".", "sum_irmse", "=", "0", "\n", "self", ".", "sum_imae", "=", "0", "\n", "self", ".", "sum_mse", "=", "0", "\n", "self", ".", "sum_rmse", "=", "0", "\n", "self", ".", "sum_mae", "=", "0", "\n", "self", ".", "sum_absrel", "=", "0", "\n", "self", ".", "sum_squared_rel", "=", "0", "\n", "self", ".", "sum_lg10", "=", "0", "\n", "self", ".", "sum_delta1", "=", "0", "\n", "self", ".", "sum_delta2", "=", "0", "\n", "self", ".", "sum_delta3", "=", "0", "\n", "self", ".", "sum_data_time", "=", "0", "\n", "self", ".", "sum_gpu_time", "=", "0", "\n", "self", ".", "sum_photometric", "=", "0", "\n", "self", ".", "sum_silog", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.AverageMeter.update": [[127, 144], ["None"], "methods", ["None"], ["", "def", "update", "(", "self", ",", "result", ",", "gpu_time", ",", "data_time", ",", "n", "=", "1", ")", ":", "\n", "        ", "self", ".", "count", "+=", "n", "\n", "self", ".", "sum_irmse", "+=", "n", "*", "result", ".", "irmse", "\n", "self", ".", "sum_imae", "+=", "n", "*", "result", ".", "imae", "\n", "self", ".", "sum_mse", "+=", "n", "*", "result", ".", "mse", "\n", "self", ".", "sum_rmse", "+=", "n", "*", "result", ".", "rmse", "\n", "self", ".", "sum_mae", "+=", "n", "*", "result", ".", "mae", "\n", "self", ".", "sum_absrel", "+=", "n", "*", "result", ".", "absrel", "\n", "self", ".", "sum_squared_rel", "+=", "n", "*", "result", ".", "squared_rel", "\n", "self", ".", "sum_lg10", "+=", "n", "*", "result", ".", "lg10", "\n", "self", ".", "sum_delta1", "+=", "n", "*", "result", ".", "delta1", "\n", "self", ".", "sum_delta2", "+=", "n", "*", "result", ".", "delta2", "\n", "self", ".", "sum_delta3", "+=", "n", "*", "result", ".", "delta3", "\n", "self", ".", "sum_data_time", "+=", "n", "*", "data_time", "\n", "self", ".", "sum_gpu_time", "+=", "n", "*", "gpu_time", "\n", "self", ".", "sum_silog", "+=", "n", "*", "result", ".", "silog", "\n", "self", ".", "sum_photometric", "+=", "n", "*", "result", ".", "photometric", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.AverageMeter.average": [[145, 158], ["metrics.Result", "metrics.Result.update"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.AverageMeter.update"], ["", "def", "average", "(", "self", ")", ":", "\n", "        ", "avg", "=", "Result", "(", ")", "\n", "if", "self", ".", "count", ">", "0", ":", "\n", "            ", "avg", ".", "update", "(", "\n", "self", ".", "sum_irmse", "/", "self", ".", "count", ",", "self", ".", "sum_imae", "/", "self", ".", "count", ",", "\n", "self", ".", "sum_mse", "/", "self", ".", "count", ",", "self", ".", "sum_rmse", "/", "self", ".", "count", ",", "\n", "self", ".", "sum_mae", "/", "self", ".", "count", ",", "self", ".", "sum_absrel", "/", "self", ".", "count", ",", "\n", "self", ".", "sum_squared_rel", "/", "self", ".", "count", ",", "self", ".", "sum_lg10", "/", "self", ".", "count", ",", "\n", "self", ".", "sum_delta1", "/", "self", ".", "count", ",", "self", ".", "sum_delta2", "/", "self", ".", "count", ",", "\n", "self", ".", "sum_delta3", "/", "self", ".", "count", ",", "self", ".", "sum_gpu_time", "/", "self", ".", "count", ",", "\n", "self", ".", "sum_data_time", "/", "self", ".", "count", ",", "self", ".", "sum_silog", "/", "self", ".", "count", ",", "\n", "self", ".", "sum_photometric", "/", "self", ".", "count", ")", "\n", "", "return", "avg", "\n", "", "", ""]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.log10": [[8, 11], ["torch.log"], "function", ["None"], ["def", "log10", "(", "x", ")", ":", "\n", "    ", "\"\"\"Convert a new tensor with the base-10 logarithm of the elements of x. \"\"\"", "\n", "return", "torch", ".", "log", "(", "x", ")", "/", "lg_e_10", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.__init__": [[17, 46], ["helper.get_folder_name", "metrics.Result", "helper.logger.best_result.set_to_worst", "os.path.join", "os.path.join", "os.path.join", "os.path.exists", "os.makedirs", "print", "os.path.join", "helper.backup_source_code", "print", "open", "csv.DictWriter", "csv.DictWriter.writeheader", "open", "csv.DictWriter", "csv.DictWriter.writeheader"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.get_folder_name", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.Result.set_to_worst", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.backup_source_code"], ["    ", "def", "__init__", "(", "self", ",", "args", ",", "prepare", "=", "True", ")", ":", "\n", "        ", "self", ".", "args", "=", "args", "\n", "output_directory", "=", "get_folder_name", "(", "args", ")", "\n", "self", ".", "output_directory", "=", "output_directory", "\n", "self", ".", "best_result", "=", "Result", "(", ")", "\n", "self", ".", "best_result", ".", "set_to_worst", "(", ")", "\n", "\n", "if", "not", "prepare", ":", "\n", "            ", "return", "\n", "", "if", "not", "os", ".", "path", ".", "exists", "(", "output_directory", ")", ":", "\n", "            ", "os", ".", "makedirs", "(", "output_directory", ")", "\n", "", "self", ".", "train_csv", "=", "os", ".", "path", ".", "join", "(", "output_directory", ",", "'train.csv'", ")", "\n", "self", ".", "val_csv", "=", "os", ".", "path", ".", "join", "(", "output_directory", ",", "'val.csv'", ")", "\n", "self", ".", "best_txt", "=", "os", ".", "path", ".", "join", "(", "output_directory", ",", "'best.txt'", ")", "\n", "\n", "# backup the source code", "\n", "if", "args", ".", "resume", "==", "''", ":", "\n", "            ", "print", "(", "\"=> creating source code backup ...\"", ")", "\n", "backup_directory", "=", "os", ".", "path", ".", "join", "(", "output_directory", ",", "\"code_backup\"", ")", "\n", "self", ".", "backup_directory", "=", "backup_directory", "\n", "backup_source_code", "(", "backup_directory", ")", "\n", "# create new csv files with only header", "\n", "with", "open", "(", "self", ".", "train_csv", ",", "'w'", ")", "as", "csvfile", ":", "\n", "                ", "writer", "=", "csv", ".", "DictWriter", "(", "csvfile", ",", "fieldnames", "=", "fieldnames", ")", "\n", "writer", ".", "writeheader", "(", ")", "\n", "", "with", "open", "(", "self", ".", "val_csv", ",", "'w'", ")", "as", "csvfile", ":", "\n", "                ", "writer", "=", "csv", ".", "DictWriter", "(", "csvfile", ",", "fieldnames", "=", "fieldnames", ")", "\n", "writer", ".", "writeheader", "(", ")", "\n", "", "print", "(", "\"=> finished creating source code backup.\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.conditional_print": [[47, 75], ["avg_meter.average", "blk_avg_meter.average", "print", "print", "blk_avg_meter.reset", "split.capitalize"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.AverageMeter.average", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.AverageMeter.average", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.AverageMeter.reset"], ["", "", "def", "conditional_print", "(", "self", ",", "split", ",", "i", ",", "epoch", ",", "lr", ",", "n_set", ",", "blk_avg_meter", ",", "\n", "avg_meter", ")", ":", "\n", "        ", "if", "(", "i", "+", "1", ")", "%", "self", ".", "args", ".", "print_freq", "==", "0", ":", "\n", "            ", "avg", "=", "avg_meter", ".", "average", "(", ")", "\n", "blk_avg", "=", "blk_avg_meter", ".", "average", "(", ")", "\n", "print", "(", "'=> output: {}'", ".", "format", "(", "self", ".", "output_directory", ")", ")", "\n", "print", "(", "\n", "'{split} Epoch: {0} [{1}/{2}]\\tlr={lr} '", "\n", "'t_Data={blk_avg.data_time:.3f}({average.data_time:.3f}) '", "\n", "'t_GPU={blk_avg.gpu_time:.3f}({average.gpu_time:.3f})\\n\\t'", "\n", "'RMSE={blk_avg.rmse:.2f}({average.rmse:.2f}) '", "\n", "'MAE={blk_avg.mae:.2f}({average.mae:.2f}) '", "\n", "'iRMSE={blk_avg.irmse:.2f}({average.irmse:.2f}) '", "\n", "'iMAE={blk_avg.imae:.2f}({average.imae:.2f})\\n\\t'", "\n", "'silog={blk_avg.silog:.2f}({average.silog:.2f}) '", "\n", "'squared_rel={blk_avg.squared_rel:.2f}({average.squared_rel:.2f}) '", "\n", "'Delta1={blk_avg.delta1:.3f}({average.delta1:.3f}) '", "\n", "'REL={blk_avg.absrel:.3f}({average.absrel:.3f})\\n\\t'", "\n", "'Lg10={blk_avg.lg10:.3f}({average.lg10:.3f}) '", "\n", "'Photometric={blk_avg.photometric:.3f}({average.photometric:.3f}) '", "\n", ".", "format", "(", "epoch", ",", "\n", "i", "+", "1", ",", "\n", "n_set", ",", "\n", "lr", "=", "lr", ",", "\n", "blk_avg", "=", "blk_avg", ",", "\n", "average", "=", "avg", ",", "\n", "split", "=", "split", ".", "capitalize", "(", ")", ")", ")", "\n", "blk_avg_meter", ".", "reset", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.conditional_save_info": [[76, 111], ["average_meter.average", "open", "csv.DictWriter", "csv.DictWriter.writerow", "os.path.join", "helper.logger.save_single_txt", "ValueError"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.metrics.AverageMeter.average", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.save_single_txt"], ["", "", "def", "conditional_save_info", "(", "self", ",", "split", ",", "average_meter", ",", "epoch", ")", ":", "\n", "        ", "avg", "=", "average_meter", ".", "average", "(", ")", "\n", "if", "split", "==", "\"train\"", ":", "\n", "            ", "csvfile_name", "=", "self", ".", "train_csv", "\n", "", "elif", "split", "==", "\"val\"", ":", "\n", "            ", "csvfile_name", "=", "self", ".", "val_csv", "\n", "", "elif", "split", "==", "\"eval\"", ":", "\n", "            ", "eval_filename", "=", "os", ".", "path", ".", "join", "(", "self", ".", "output_directory", ",", "'eval.txt'", ")", "\n", "self", ".", "save_single_txt", "(", "eval_filename", ",", "avg", ",", "epoch", ")", "\n", "return", "avg", "\n", "", "elif", "\"test\"", "in", "split", ":", "\n", "            ", "return", "avg", "\n", "", "else", ":", "\n", "            ", "raise", "ValueError", "(", "\"wrong split provided to logger\"", ")", "\n", "", "with", "open", "(", "csvfile_name", ",", "'a'", ")", "as", "csvfile", ":", "\n", "            ", "writer", "=", "csv", ".", "DictWriter", "(", "csvfile", ",", "fieldnames", "=", "fieldnames", ")", "\n", "writer", ".", "writerow", "(", "{", "\n", "'epoch'", ":", "epoch", ",", "\n", "'rmse'", ":", "avg", ".", "rmse", ",", "\n", "'photo'", ":", "avg", ".", "photometric", ",", "\n", "'mae'", ":", "avg", ".", "mae", ",", "\n", "'irmse'", ":", "avg", ".", "irmse", ",", "\n", "'imae'", ":", "avg", ".", "imae", ",", "\n", "'mse'", ":", "avg", ".", "mse", ",", "\n", "'silog'", ":", "avg", ".", "silog", ",", "\n", "'squared_rel'", ":", "avg", ".", "squared_rel", ",", "\n", "'absrel'", ":", "avg", ".", "absrel", ",", "\n", "'lg10'", ":", "avg", ".", "lg10", ",", "\n", "'delta1'", ":", "avg", ".", "delta1", ",", "\n", "'delta2'", ":", "avg", ".", "delta2", ",", "\n", "'delta3'", ":", "avg", ".", "delta3", ",", "\n", "'gpu_time'", ":", "avg", ".", "gpu_time", ",", "\n", "'data_time'", ":", "avg", ".", "data_time", "\n", "}", ")", "\n", "", "return", "avg", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.save_single_txt": [[112, 125], ["open", "txtfile.write"], "methods", ["None"], ["", "def", "save_single_txt", "(", "self", ",", "filename", ",", "result", ",", "epoch", ")", ":", "\n", "        ", "with", "open", "(", "filename", ",", "'w'", ")", "as", "txtfile", ":", "\n", "            ", "txtfile", ".", "write", "(", "\n", "(", "\"rank_metric={}\\n\"", "+", "\"epoch={}\\n\"", "+", "\"rmse={:.3f}\\n\"", "+", "\n", "\"mae={:.3f}\\n\"", "+", "\"silog={:.3f}\\n\"", "+", "\"squared_rel={:.3f}\\n\"", "+", "\n", "\"irmse={:.3f}\\n\"", "+", "\"imae={:.3f}\\n\"", "+", "\"mse={:.3f}\\n\"", "+", "\n", "\"absrel={:.3f}\\n\"", "+", "\"lg10={:.3f}\\n\"", "+", "\"delta1={:.3f}\\n\"", "+", "\n", "\"t_gpu={:.4f}\"", ")", ".", "format", "(", "self", ".", "args", ".", "rank_metric", ",", "epoch", ",", "\n", "result", ".", "rmse", ",", "result", ".", "mae", ",", "result", ".", "silog", ",", "\n", "result", ".", "squared_rel", ",", "result", ".", "irmse", ",", "\n", "result", ".", "imae", ",", "result", ".", "mse", ",", "result", ".", "absrel", ",", "\n", "result", ".", "lg10", ",", "result", ".", "delta1", ",", "\n", "result", ".", "gpu_time", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.save_best_txt": [[126, 128], ["helper.logger.save_single_txt"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.save_single_txt"], ["", "", "def", "save_best_txt", "(", "self", ",", "result", ",", "epoch", ")", ":", "\n", "        ", "self", ".", "save_single_txt", "(", "self", ".", "best_txt", ",", "result", ",", "epoch", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger._get_img_comparison_name": [[129, 138], ["str"], "methods", ["None"], ["", "def", "_get_img_comparison_name", "(", "self", ",", "mode", ",", "epoch", ",", "is_best", "=", "False", ")", ":", "\n", "        ", "if", "mode", "==", "'eval'", ":", "\n", "            ", "return", "self", ".", "output_directory", "+", "'/comparison_eval.png'", "\n", "", "if", "mode", "==", "'val'", ":", "\n", "            ", "if", "is_best", ":", "\n", "                ", "return", "self", ".", "output_directory", "+", "'/comparison_best.png'", "\n", "", "else", ":", "\n", "                ", "return", "self", ".", "output_directory", "+", "'/comparison_'", "+", "str", "(", "\n", "epoch", ")", "+", "'.png'", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.conditional_save_img_comparison": [[139, 151], ["vis_utils.merge_into_row", "vis_utils.merge_into_row", "vis_utils.add_row", "helper.logger._get_img_comparison_name", "vis_utils.save_image"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.vis_utils.merge_into_row", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.vis_utils.merge_into_row", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.vis_utils.add_row", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger._get_img_comparison_name", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.vis_utils.save_image"], ["", "", "", "def", "conditional_save_img_comparison", "(", "self", ",", "mode", ",", "i", ",", "ele", ",", "pred", ",", "epoch", ")", ":", "\n", "# save 8 images for visualization", "\n", "        ", "if", "mode", "==", "'val'", "or", "mode", "==", "'eval'", ":", "\n", "            ", "skip", "=", "100", "\n", "if", "i", "==", "0", ":", "\n", "                ", "self", ".", "img_merge", "=", "vis_utils", ".", "merge_into_row", "(", "ele", ",", "pred", ")", "\n", "", "elif", "i", "%", "skip", "==", "0", "and", "i", "<", "8", "*", "skip", ":", "\n", "                ", "row", "=", "vis_utils", ".", "merge_into_row", "(", "ele", ",", "pred", ")", "\n", "self", ".", "img_merge", "=", "vis_utils", ".", "add_row", "(", "self", ".", "img_merge", ",", "row", ")", "\n", "", "elif", "i", "==", "8", "*", "skip", ":", "\n", "                ", "filename", "=", "self", ".", "_get_img_comparison_name", "(", "mode", ",", "epoch", ")", "\n", "vis_utils", ".", "save_image", "(", "self", ".", "img_merge", ",", "filename", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.save_img_comparison_as_best": [[152, 156], ["helper.logger._get_img_comparison_name", "vis_utils.save_image"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger._get_img_comparison_name", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.vis_utils.save_image"], ["", "", "", "def", "save_img_comparison_as_best", "(", "self", ",", "mode", ",", "epoch", ")", ":", "\n", "        ", "if", "mode", "==", "'val'", ":", "\n", "            ", "filename", "=", "self", ".", "_get_img_comparison_name", "(", "mode", ",", "epoch", ",", "is_best", "=", "True", ")", "\n", "vis_utils", ".", "save_image", "(", "self", ".", "img_merge", ",", "filename", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.get_ranking_error": [[157, 159], ["getattr"], "methods", ["None"], ["", "", "def", "get_ranking_error", "(", "self", ",", "result", ")", ":", "\n", "        ", "return", "getattr", "(", "result", ",", "self", ".", "args", ".", "rank_metric", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.rank_conditional_save_best": [[160, 169], ["helper.logger.get_ranking_error", "helper.logger.get_ranking_error", "helper.logger.save_best_txt"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.get_ranking_error", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.get_ranking_error", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.save_best_txt"], ["", "def", "rank_conditional_save_best", "(", "self", ",", "mode", ",", "result", ",", "epoch", ")", ":", "\n", "        ", "error", "=", "self", ".", "get_ranking_error", "(", "result", ")", "\n", "best_error", "=", "self", ".", "get_ranking_error", "(", "self", ".", "best_result", ")", "\n", "is_best", "=", "error", "<", "best_error", "\n", "if", "is_best", "and", "mode", "==", "\"val\"", ":", "\n", "            ", "self", ".", "old_best_result", "=", "self", ".", "best_result", "\n", "self", ".", "best_result", "=", "result", "\n", "self", ".", "save_best_txt", "(", "result", ",", "epoch", ")", "\n", "", "return", "is_best", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.conditional_save_pred": [[170, 181], ["os.path.join", "torch.squeeze().numpy", "os.path.join", "vis_utils.save_depth_as_uint16png", "os.path.exists", "os.makedirs", "torch.squeeze", "pred.data.cpu"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.vis_utils.save_depth_as_uint16png"], ["", "def", "conditional_save_pred", "(", "self", ",", "mode", ",", "i", ",", "pred", ",", "epoch", ")", ":", "\n", "        ", "if", "(", "\"test\"", "in", "mode", "or", "mode", "==", "\"eval\"", ")", "and", "self", ".", "args", ".", "save_pred", ":", "\n", "\n", "# save images for visualization/ testing", "\n", "            ", "image_folder", "=", "os", ".", "path", ".", "join", "(", "self", ".", "output_directory", ",", "\n", "mode", "+", "\"_output\"", ")", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "image_folder", ")", ":", "\n", "                ", "os", ".", "makedirs", "(", "image_folder", ")", "\n", "", "img", "=", "torch", ".", "squeeze", "(", "pred", ".", "data", ".", "cpu", "(", ")", ")", ".", "numpy", "(", ")", "\n", "filename", "=", "os", ".", "path", ".", "join", "(", "image_folder", ",", "'{0:010d}.png'", ".", "format", "(", "i", ")", ")", "\n", "vis_utils", ".", "save_depth_as_uint16png", "(", "img", ",", "filename", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.conditional_summarize": [[182, 205], ["print", "print", "print", "print", "print", "helper.logger.get_ranking_error", "helper.logger.get_ranking_error"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.get_ranking_error", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.logger.get_ranking_error"], ["", "", "def", "conditional_summarize", "(", "self", ",", "mode", ",", "avg", ",", "is_best", ")", ":", "\n", "        ", "print", "(", "\"\\n*\\nSummary of \"", ",", "mode", ",", "\"round\"", ")", "\n", "print", "(", "''", "\n", "'RMSE={average.rmse:.3f}\\n'", "\n", "'MAE={average.mae:.3f}\\n'", "\n", "'Photo={average.photometric:.3f}\\n'", "\n", "'iRMSE={average.irmse:.3f}\\n'", "\n", "'iMAE={average.imae:.3f}\\n'", "\n", "'squared_rel={average.squared_rel}\\n'", "\n", "'silog={average.silog}\\n'", "\n", "'Delta1={average.delta1:.3f}\\n'", "\n", "'REL={average.absrel:.3f}\\n'", "\n", "'Lg10={average.lg10:.3f}\\n'", "\n", "'t_GPU={time:.3f}'", ".", "format", "(", "average", "=", "avg", ",", "time", "=", "avg", ".", "gpu_time", ")", ")", "\n", "if", "is_best", "and", "mode", "==", "\"val\"", ":", "\n", "            ", "print", "(", "\"New best model by %s (was %.3f)\"", "%", "\n", "(", "self", ".", "args", ".", "rank_metric", ",", "\n", "self", ".", "get_ranking_error", "(", "self", ".", "old_best_result", ")", ")", ")", "\n", "", "elif", "mode", "==", "\"val\"", ":", "\n", "            ", "print", "(", "\"(best %s is %.3f)\"", "%", "\n", "(", "self", ".", "args", ".", "rank_metric", ",", "\n", "self", ".", "get_ranking_error", "(", "self", ".", "best_result", ")", ")", ")", "\n", "", "print", "(", "\"*\\n\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.backup_source_code": [[211, 215], ["os.path.exists", "shutil.copytree", "shutil.rmtree"], "function", ["None"], ["def", "backup_source_code", "(", "backup_directory", ")", ":", "\n", "    ", "if", "os", ".", "path", ".", "exists", "(", "backup_directory", ")", ":", "\n", "        ", "shutil", ".", "rmtree", "(", "backup_directory", ")", "\n", "", "shutil", ".", "copytree", "(", "'.'", ",", "backup_directory", ",", "ignore", "=", "ignore_hidden", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.adjust_learning_rate": [[217, 223], ["None"], "function", ["None"], ["", "def", "adjust_learning_rate", "(", "lr_init", ",", "optimizer", ",", "epoch", ")", ":", "\n", "    ", "\"\"\"Sets the learning rate to the initial LR decayed by 10 every 5 epochs\"\"\"", "\n", "lr", "=", "lr_init", "*", "(", "0.1", "**", "(", "epoch", "//", "5", ")", ")", "\n", "for", "param_group", "in", "optimizer", ".", "param_groups", ":", "\n", "        ", "param_group", "[", "'lr'", "]", "=", "lr", "\n", "", "return", "lr", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.save_checkpoint": [[225, 237], ["os.path.join", "torch.save", "os.path.join", "shutil.copyfile", "os.path.join", "os.path.exists", "os.remove", "str", "str"], "function", ["None"], ["", "def", "save_checkpoint", "(", "state", ",", "is_best", ",", "epoch", ",", "output_directory", ")", ":", "\n", "    ", "checkpoint_filename", "=", "os", ".", "path", ".", "join", "(", "output_directory", ",", "\n", "'checkpoint-'", "+", "str", "(", "epoch", ")", "+", "'.pth.tar'", ")", "\n", "torch", ".", "save", "(", "state", ",", "checkpoint_filename", ")", "\n", "if", "is_best", ":", "\n", "        ", "best_filename", "=", "os", ".", "path", ".", "join", "(", "output_directory", ",", "'model_best.pth.tar'", ")", "\n", "shutil", ".", "copyfile", "(", "checkpoint_filename", ",", "best_filename", ")", "\n", "", "if", "epoch", ">", "0", ":", "\n", "        ", "prev_checkpoint_filename", "=", "os", ".", "path", ".", "join", "(", "\n", "output_directory", ",", "'checkpoint-'", "+", "str", "(", "epoch", "-", "1", ")", "+", "'.pth.tar'", ")", "\n", "if", "os", ".", "path", ".", "exists", "(", "prev_checkpoint_filename", ")", ":", "\n", "            ", "os", ".", "remove", "(", "prev_checkpoint_filename", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.get_folder_name": [[239, 251], ["time.strftime", "os.path.join"], "function", ["None"], ["", "", "", "def", "get_folder_name", "(", "args", ")", ":", "\n", "    ", "current_time", "=", "time", ".", "strftime", "(", "'%Y-%m-%d@%H-%M'", ")", "\n", "if", "args", ".", "use_pose", ":", "\n", "        ", "prefix", "=", "\"mode={}.w1={}.w2={}.\"", ".", "format", "(", "args", ".", "train_mode", ",", "args", ".", "w1", ",", "\n", "args", ".", "w2", ")", "\n", "", "else", ":", "\n", "        ", "prefix", "=", "\"mode={}.\"", ".", "format", "(", "args", ".", "train_mode", ")", "\n", "", "return", "os", ".", "path", ".", "join", "(", "args", ".", "result", ",", "\n", "prefix", "+", "'input={}.resnet{}.criterion={}.lr={}.bs={}.wd={}.pretrained={}.jitter={}.time={}'", ".", "\n", "format", "(", "args", ".", "input", ",", "args", ".", "layers", ",", "args", ".", "criterion", ",", "args", ".", "lr", ",", "args", ".", "batch_size", ",", "args", ".", "weight_decay", ",", "args", ".", "pretrained", ",", "args", ".", "jitter", ",", "current_time", "\n", ")", ")", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.helper.multiscale": [[257, 264], ["avgpool", "avgpool", "avgpool", "avgpool", "avgpool"], "function", ["None"], ["def", "multiscale", "(", "img", ")", ":", "\n", "    ", "img1", "=", "avgpool", "(", "img", ")", "\n", "img2", "=", "avgpool", "(", "img1", ")", "\n", "img3", "=", "avgpool", "(", "img2", ")", "\n", "img4", "=", "avgpool", "(", "img3", ")", "\n", "img5", "=", "avgpool", "(", "img4", ")", "\n", "return", "img5", ",", "img4", ",", "img3", ",", "img2", ",", "img1", "\n", "", ""]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.model.DepthCompletionNet.__init__": [[70, 160], ["torch.Module.__init__", "model.conv_bn_relu", "model.convt_bn_relu", "model.convt_bn_relu", "model.convt_bn_relu", "model.convt_bn_relu", "model.convt_bn_relu", "model.conv_bn_relu", "model.conv_bn_relu", "model.conv_bn_relu", "pretrained_model.apply", "len", "len", "model.conv_bn_relu", "len"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.KittiDepth.__init__", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.model.conv_bn_relu", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.model.convt_bn_relu", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.model.convt_bn_relu", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.model.convt_bn_relu", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.model.convt_bn_relu", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.model.convt_bn_relu", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.model.conv_bn_relu", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.model.conv_bn_relu", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.model.conv_bn_relu", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.model.conv_bn_relu"], ["    ", "def", "__init__", "(", "self", ",", "args", ")", ":", "\n", "        ", "assert", "(", "\n", "args", ".", "layers", "in", "[", "18", ",", "34", ",", "50", ",", "101", ",", "152", "]", "\n", ")", ",", "'Only layers 18, 34, 50, 101, and 152 are defined, but got {}'", ".", "format", "(", "\n", "layers", ")", "\n", "super", "(", "DepthCompletionNet", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "modality", "=", "args", ".", "input", "\n", "\n", "if", "'d'", "in", "self", ".", "modality", ":", "\n", "            ", "channels", "=", "64", "//", "len", "(", "self", ".", "modality", ")", "\n", "self", ".", "conv1_d", "=", "conv_bn_relu", "(", "1", ",", "\n", "channels", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ")", "\n", "", "if", "'rgb'", "in", "self", ".", "modality", ":", "\n", "            ", "channels", "=", "64", "*", "3", "//", "len", "(", "self", ".", "modality", ")", "\n", "self", ".", "conv1_img", "=", "conv_bn_relu", "(", "3", ",", "\n", "channels", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ")", "\n", "", "elif", "'g'", "in", "self", ".", "modality", ":", "\n", "            ", "channels", "=", "64", "//", "len", "(", "self", ".", "modality", ")", "\n", "self", ".", "conv1_img", "=", "conv_bn_relu", "(", "1", ",", "\n", "channels", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ")", "\n", "\n", "", "pretrained_model", "=", "resnet", ".", "__dict__", "[", "'resnet{}'", ".", "format", "(", "\n", "args", ".", "layers", ")", "]", "(", "pretrained", "=", "args", ".", "pretrained", ")", "\n", "if", "not", "args", ".", "pretrained", ":", "\n", "            ", "pretrained_model", ".", "apply", "(", "init_weights", ")", "\n", "#self.maxpool = pretrained_model._modules['maxpool']", "\n", "", "self", ".", "conv2", "=", "pretrained_model", ".", "_modules", "[", "'layer1'", "]", "\n", "self", ".", "conv3", "=", "pretrained_model", ".", "_modules", "[", "'layer2'", "]", "\n", "self", ".", "conv4", "=", "pretrained_model", ".", "_modules", "[", "'layer3'", "]", "\n", "self", ".", "conv5", "=", "pretrained_model", ".", "_modules", "[", "'layer4'", "]", "\n", "del", "pretrained_model", "# clear memory", "\n", "\n", "# define number of intermediate channels", "\n", "if", "args", ".", "layers", "<=", "34", ":", "\n", "            ", "num_channels", "=", "512", "\n", "", "elif", "args", ".", "layers", ">=", "50", ":", "\n", "            ", "num_channels", "=", "2048", "\n", "", "self", ".", "conv6", "=", "conv_bn_relu", "(", "num_channels", ",", "\n", "512", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "2", ",", "\n", "padding", "=", "1", ")", "\n", "\n", "# decoding layers", "\n", "kernel_size", "=", "3", "\n", "stride", "=", "2", "\n", "self", ".", "convt5", "=", "convt_bn_relu", "(", "in_channels", "=", "512", ",", "\n", "out_channels", "=", "256", ",", "\n", "kernel_size", "=", "kernel_size", ",", "\n", "stride", "=", "stride", ",", "\n", "padding", "=", "1", ",", "\n", "output_padding", "=", "1", ")", "\n", "self", ".", "convt4", "=", "convt_bn_relu", "(", "in_channels", "=", "768", ",", "\n", "out_channels", "=", "128", ",", "\n", "kernel_size", "=", "kernel_size", ",", "\n", "stride", "=", "stride", ",", "\n", "padding", "=", "1", ",", "\n", "output_padding", "=", "1", ")", "\n", "self", ".", "convt3", "=", "convt_bn_relu", "(", "in_channels", "=", "(", "256", "+", "128", ")", ",", "\n", "out_channels", "=", "64", ",", "\n", "kernel_size", "=", "kernel_size", ",", "\n", "stride", "=", "stride", ",", "\n", "padding", "=", "1", ",", "\n", "output_padding", "=", "1", ")", "\n", "self", ".", "convt2", "=", "convt_bn_relu", "(", "in_channels", "=", "(", "128", "+", "64", ")", ",", "\n", "out_channels", "=", "64", ",", "\n", "kernel_size", "=", "kernel_size", ",", "\n", "stride", "=", "stride", ",", "\n", "padding", "=", "1", ",", "\n", "output_padding", "=", "1", ")", "\n", "self", ".", "convt1", "=", "convt_bn_relu", "(", "in_channels", "=", "128", ",", "\n", "out_channels", "=", "64", ",", "\n", "kernel_size", "=", "kernel_size", ",", "\n", "stride", "=", "1", ",", "\n", "padding", "=", "1", ")", "\n", "self", ".", "convtf", "=", "conv_bn_relu", "(", "in_channels", "=", "128", ",", "\n", "out_channels", "=", "1", ",", "\n", "kernel_size", "=", "1", ",", "\n", "stride", "=", "1", ",", "\n", "bn", "=", "False", ",", "\n", "relu", "=", "False", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.model.DepthCompletionNet.forward": [[161, 206], ["model.DepthCompletionNet.conv2", "model.DepthCompletionNet.conv3", "model.DepthCompletionNet.conv4", "model.DepthCompletionNet.conv5", "model.DepthCompletionNet.conv6", "model.DepthCompletionNet.convt5", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "model.DepthCompletionNet.convt4", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "model.DepthCompletionNet.convt3", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "model.DepthCompletionNet.convt2", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "model.DepthCompletionNet.convt1", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "model.DepthCompletionNet.convtf", "model.DepthCompletionNet.conv1_d", "model.DepthCompletionNet.conv1_img", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "model.DepthCompletionNet.conv1_img", "torch.relu", "torch.relu", "torch.relu"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "# first layer", "\n", "        ", "if", "'d'", "in", "self", ".", "modality", ":", "\n", "            ", "conv1_d", "=", "self", ".", "conv1_d", "(", "x", "[", "'d'", "]", ")", "\n", "", "if", "'rgb'", "in", "self", ".", "modality", ":", "\n", "            ", "conv1_img", "=", "self", ".", "conv1_img", "(", "x", "[", "'rgb'", "]", ")", "\n", "", "elif", "'g'", "in", "self", ".", "modality", ":", "\n", "            ", "conv1_img", "=", "self", ".", "conv1_img", "(", "x", "[", "'g'", "]", ")", "\n", "\n", "", "if", "self", ".", "modality", "==", "'rgbd'", "or", "self", ".", "modality", "==", "'gd'", ":", "\n", "            ", "conv1", "=", "torch", ".", "cat", "(", "(", "conv1_d", ",", "conv1_img", ")", ",", "1", ")", "\n", "", "else", ":", "\n", "            ", "conv1", "=", "conv1_d", "if", "(", "self", ".", "modality", "==", "'d'", ")", "else", "conv1_img", "\n", "\n", "", "conv2", "=", "self", ".", "conv2", "(", "conv1", ")", "\n", "conv3", "=", "self", ".", "conv3", "(", "conv2", ")", "# batchsize * ? * 176 * 608", "\n", "conv4", "=", "self", ".", "conv4", "(", "conv3", ")", "# batchsize * ? * 88 * 304", "\n", "conv5", "=", "self", ".", "conv5", "(", "conv4", ")", "# batchsize * ? * 44 * 152", "\n", "conv6", "=", "self", ".", "conv6", "(", "conv5", ")", "# batchsize * ? * 22 * 76", "\n", "\n", "# decoder", "\n", "convt5", "=", "self", ".", "convt5", "(", "conv6", ")", "\n", "y", "=", "torch", ".", "cat", "(", "(", "convt5", ",", "conv5", ")", ",", "1", ")", "\n", "\n", "convt4", "=", "self", ".", "convt4", "(", "y", ")", "\n", "y", "=", "torch", ".", "cat", "(", "(", "convt4", ",", "conv4", ")", ",", "1", ")", "\n", "\n", "convt3", "=", "self", ".", "convt3", "(", "y", ")", "\n", "y", "=", "torch", ".", "cat", "(", "(", "convt3", ",", "conv3", ")", ",", "1", ")", "\n", "\n", "convt2", "=", "self", ".", "convt2", "(", "y", ")", "\n", "y", "=", "torch", ".", "cat", "(", "(", "convt2", ",", "conv2", ")", ",", "1", ")", "\n", "\n", "convt1", "=", "self", ".", "convt1", "(", "y", ")", "\n", "y", "=", "torch", ".", "cat", "(", "(", "convt1", ",", "conv1", ")", ",", "1", ")", "\n", "\n", "y", "=", "self", ".", "convtf", "(", "y", ")", "\n", "\n", "if", "self", ".", "training", ":", "\n", "            ", "return", "100", "*", "y", "\n", "", "else", ":", "\n", "            ", "min_distance", "=", "0.9", "\n", "return", "F", ".", "relu", "(", "\n", "100", "*", "y", "-", "min_distance", "\n", ")", "+", "min_distance", "# the minimum range of Velodyne is around 3 feet ~= 0.9m", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.model.init_weights": [[8, 20], ["isinstance", "isinstance", "m.weight.data.normal_", "isinstance", "m.bias.data.zero_", "m.weight.data.normal_", "isinstance", "m.bias.data.zero_", "m.weight.data.fill_", "m.bias.data.zero_"], "function", ["None"], ["def", "init_weights", "(", "m", ")", ":", "\n", "    ", "if", "isinstance", "(", "m", ",", "nn", ".", "Conv2d", ")", "or", "isinstance", "(", "m", ",", "nn", ".", "Linear", ")", ":", "\n", "        ", "m", ".", "weight", ".", "data", ".", "normal_", "(", "0", ",", "1e-3", ")", "\n", "if", "m", ".", "bias", "is", "not", "None", ":", "\n", "            ", "m", ".", "bias", ".", "data", ".", "zero_", "(", ")", "\n", "", "", "elif", "isinstance", "(", "m", ",", "nn", ".", "ConvTranspose2d", ")", ":", "\n", "        ", "m", ".", "weight", ".", "data", ".", "normal_", "(", "0", ",", "1e-3", ")", "\n", "if", "m", ".", "bias", "is", "not", "None", ":", "\n", "            ", "m", ".", "bias", ".", "data", ".", "zero_", "(", ")", "\n", "", "", "elif", "isinstance", "(", "m", ",", "nn", ".", "BatchNorm2d", ")", ":", "\n", "        ", "m", ".", "weight", ".", "data", ".", "fill_", "(", "1", ")", "\n", "m", ".", "bias", ".", "data", ".", "zero_", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.model.conv_bn_relu": [[21, 43], ["nn.Sequential.append", "torch.Sequential", "nn.Sequential.modules", "torch.Conv2d", "nn.Sequential.append", "nn.Sequential.append", "model.init_weights", "torch.BatchNorm2d", "torch.LeakyReLU"], "function", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.model.init_weights"], ["", "", "def", "conv_bn_relu", "(", "in_channels", ",", "out_channels", ",", "kernel_size", ",", "stride", "=", "1", ",", "padding", "=", "0", ",", "bn", "=", "True", ",", "relu", "=", "True", ")", ":", "\n", "    ", "bias", "=", "not", "bn", "\n", "layers", "=", "[", "]", "\n", "layers", ".", "append", "(", "\n", "nn", ".", "Conv2d", "(", "in_channels", ",", "\n", "out_channels", ",", "\n", "kernel_size", ",", "\n", "stride", ",", "\n", "padding", ",", "\n", "bias", "=", "bias", ")", ")", "\n", "if", "bn", ":", "\n", "        ", "layers", ".", "append", "(", "nn", ".", "BatchNorm2d", "(", "out_channels", ")", ")", "\n", "", "if", "relu", ":", "\n", "        ", "layers", ".", "append", "(", "nn", ".", "LeakyReLU", "(", "0.2", ",", "inplace", "=", "True", ")", ")", "\n", "", "layers", "=", "nn", ".", "Sequential", "(", "*", "layers", ")", "\n", "\n", "# initialize the weights", "\n", "for", "m", "in", "layers", ".", "modules", "(", ")", ":", "\n", "        ", "init_weights", "(", "m", ")", "\n", "\n", "", "return", "layers", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.model.convt_bn_relu": [[44, 67], ["nn.Sequential.append", "torch.Sequential", "nn.Sequential.modules", "torch.ConvTranspose2d", "nn.Sequential.append", "nn.Sequential.append", "model.init_weights", "torch.BatchNorm2d", "torch.LeakyReLU"], "function", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.model.init_weights"], ["", "def", "convt_bn_relu", "(", "in_channels", ",", "out_channels", ",", "kernel_size", ",", "stride", "=", "1", ",", "padding", "=", "0", ",", "output_padding", "=", "0", ",", "bn", "=", "True", ",", "relu", "=", "True", ")", ":", "\n", "    ", "bias", "=", "not", "bn", "\n", "layers", "=", "[", "]", "\n", "layers", ".", "append", "(", "\n", "nn", ".", "ConvTranspose2d", "(", "in_channels", ",", "\n", "out_channels", ",", "\n", "kernel_size", ",", "\n", "stride", ",", "\n", "padding", ",", "\n", "output_padding", ",", "\n", "bias", "=", "bias", ")", ")", "\n", "if", "bn", ":", "\n", "        ", "layers", ".", "append", "(", "nn", ".", "BatchNorm2d", "(", "out_channels", ")", ")", "\n", "", "if", "relu", ":", "\n", "        ", "layers", ".", "append", "(", "nn", ".", "LeakyReLU", "(", "0.2", ",", "inplace", "=", "True", ")", ")", "\n", "", "layers", "=", "nn", ".", "Sequential", "(", "*", "layers", ")", "\n", "\n", "# initialize the weights", "\n", "for", "m", "in", "layers", ".", "modules", "(", ")", ":", "\n", "        ", "init_weights", "(", "m", ")", "\n", "\n", "", "return", "layers", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.inverse_warp.Intrinsics.__init__": [[6, 24], ["torch.arange().expand().float", "torch.arange().expand().float", "torch.arange().expand().float", "torch.arange().expand().float", "torch.arange().expand().t().float", "torch.arange().expand().t().float", "torch.arange().expand().t().float", "torch.arange().expand().t().float", "torch.arange().expand", "torch.arange().expand", "torch.arange().expand", "torch.arange().expand", "torch.arange().expand().t", "torch.arange().expand().t", "torch.arange().expand().t", "torch.arange().expand().t", "torch.arange", "torch.arange", "torch.arange", "torch.arange", "torch.arange().expand", "torch.arange().expand", "torch.arange().expand", "torch.arange().expand", "torch.arange", "torch.arange", "torch.arange", "torch.arange"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "width", ",", "height", ",", "fu", ",", "fv", ",", "cu", "=", "0", ",", "cv", "=", "0", ")", ":", "\n", "        ", "self", ".", "height", ",", "self", ".", "width", "=", "height", ",", "width", "\n", "self", ".", "fu", ",", "self", ".", "fv", "=", "fu", ",", "fv", "# fu, fv: focal length along the horizontal and vertical axes", "\n", "\n", "# cu, cv: optical center along the horizontal and vertical axes", "\n", "self", ".", "cu", "=", "cu", "if", "cu", ">", "0", "else", "(", "width", "-", "1", ")", "/", "2.0", "\n", "self", ".", "cv", "=", "cv", "if", "cv", ">", "0", "else", "(", "height", "-", "1", ")", "/", "2.0", "\n", "\n", "# U, V represent the homogeneous horizontal and vertical coordinates in the pixel space", "\n", "self", ".", "U", "=", "torch", ".", "arange", "(", "start", "=", "0", ",", "end", "=", "width", ")", ".", "expand", "(", "height", ",", "width", ")", ".", "float", "(", ")", "\n", "self", ".", "V", "=", "torch", ".", "arange", "(", "start", "=", "0", ",", "end", "=", "height", ")", ".", "expand", "(", "width", ",", "\n", "height", ")", ".", "t", "(", ")", ".", "float", "(", ")", "\n", "\n", "# X_cam, Y_cam represent the homogeneous x, y coordinates (assuming depth z=1) in the camera coordinate system", "\n", "self", ".", "X_cam", "=", "(", "self", ".", "U", "-", "self", ".", "cu", ")", "/", "self", ".", "fu", "\n", "self", ".", "Y_cam", "=", "(", "self", ".", "V", "-", "self", ".", "cv", ")", "/", "self", ".", "fv", "\n", "\n", "self", ".", "is_cuda", "=", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.inverse_warp.Intrinsics.cuda": [[25, 30], ["inverse_warp.Intrinsics.X_cam.data.cuda", "inverse_warp.Intrinsics.Y_cam.data.cuda"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.inverse_warp.Intrinsics.cuda", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.inverse_warp.Intrinsics.cuda"], ["", "def", "cuda", "(", "self", ")", ":", "\n", "        ", "self", ".", "X_cam", ".", "data", "=", "self", ".", "X_cam", ".", "data", ".", "cuda", "(", ")", "\n", "self", ".", "Y_cam", ".", "data", "=", "self", ".", "Y_cam", ".", "data", ".", "cuda", "(", ")", "\n", "self", ".", "is_cuda", "=", "True", "\n", "return", "self", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.inverse_warp.Intrinsics.scale": [[31, 43], ["inverse_warp.Intrinsics", "float", "float", "inverse_warp.Intrinsics.cuda"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.inverse_warp.Intrinsics.cuda"], ["", "def", "scale", "(", "self", ",", "height", ",", "width", ")", ":", "\n", "# return a new set of corresponding intrinsic parameters for the scaled image", "\n", "        ", "ratio_u", "=", "float", "(", "width", ")", "/", "self", ".", "width", "\n", "ratio_v", "=", "float", "(", "height", ")", "/", "self", ".", "height", "\n", "fu", "=", "ratio_u", "*", "self", ".", "fu", "\n", "fv", "=", "ratio_v", "*", "self", ".", "fv", "\n", "cu", "=", "ratio_u", "*", "self", ".", "cu", "\n", "cv", "=", "ratio_v", "*", "self", ".", "cv", "\n", "new_intrinsics", "=", "Intrinsics", "(", "width", ",", "height", ",", "fu", ",", "fv", ",", "cu", ",", "cv", ")", "\n", "if", "self", ".", "is_cuda", ":", "\n", "            ", "new_intrinsics", ".", "cuda", "(", ")", "\n", "", "return", "new_intrinsics", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.inverse_warp.Intrinsics.__print__": [[44, 48], ["print"], "methods", ["None"], ["", "def", "__print__", "(", "self", ")", ":", "\n", "        ", "print", "(", "'size=({},{})\\nfocal length=({},{})\\noptical center=({},{})'", ".", "\n", "format", "(", "self", ".", "height", ",", "self", ".", "width", ",", "self", ".", "fv", ",", "self", ".", "fu", ",", "self", ".", "cv", ",", "\n", "self", ".", "cu", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.inverse_warp.image_to_pointcloud": [[50, 57], ["torch.cat", "torch.cat", "depth.dim", "depth.size"], "function", ["None"], ["", "", "def", "image_to_pointcloud", "(", "depth", ",", "intrinsics", ")", ":", "\n", "    ", "assert", "depth", ".", "dim", "(", ")", "==", "4", "\n", "assert", "depth", ".", "size", "(", "1", ")", "==", "1", "\n", "\n", "X", "=", "depth", "*", "intrinsics", ".", "X_cam", "\n", "Y", "=", "depth", "*", "intrinsics", ".", "Y_cam", "\n", "return", "torch", ".", "cat", "(", "(", "X", ",", "Y", ",", "depth", ")", ",", "dim", "=", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.inverse_warp.pointcloud_to_image": [[59, 89], ["pointcloud.size", "pointcloud[].clamp", "torch.stack", "torch.stack", "torch.stack.view", "pointcloud.dim"], "function", ["None"], ["", "def", "pointcloud_to_image", "(", "pointcloud", ",", "intrinsics", ")", ":", "\n", "    ", "assert", "pointcloud", ".", "dim", "(", ")", "==", "4", "\n", "\n", "batch_size", "=", "pointcloud", ".", "size", "(", "0", ")", "\n", "X", "=", "pointcloud", "[", ":", ",", "0", ",", ":", ",", ":", "]", "#.view(batch_size, -1)", "\n", "Y", "=", "pointcloud", "[", ":", ",", "1", ",", ":", ",", ":", "]", "#.view(batch_size, -1)", "\n", "Z", "=", "pointcloud", "[", ":", ",", "2", ",", ":", ",", ":", "]", ".", "clamp", "(", "min", "=", "1e-3", ")", "#.view(batch_size, -1)", "\n", "\n", "# compute pixel coordinates", "\n", "U_proj", "=", "intrinsics", ".", "fu", "*", "X", "/", "Z", "+", "intrinsics", ".", "cu", "# horizontal pixel coordinate", "\n", "V_proj", "=", "intrinsics", ".", "fv", "*", "Y", "/", "Z", "+", "intrinsics", ".", "cv", "# vertical pixel coordinate", "\n", "\n", "# normalization to [-1, 1], required by torch.nn.functional.grid_sample", "\n", "U_proj_normalized", "=", "(", "2", "*", "U_proj", "/", "(", "intrinsics", ".", "width", "-", "1", ")", "-", "1", ")", ".", "view", "(", "\n", "batch_size", ",", "-", "1", ")", "\n", "V_proj_normalized", "=", "(", "2", "*", "V_proj", "/", "(", "intrinsics", ".", "height", "-", "1", ")", "-", "1", ")", ".", "view", "(", "\n", "batch_size", ",", "-", "1", ")", "\n", "\n", "# This was important since PyTorch didn't do as it claimed for points out of boundary", "\n", "# See https://github.com/ClementPinard/SfmLearner-Pytorch/blob/master/inverse_warp.py", "\n", "# Might not be necessary any more", "\n", "U_proj_mask", "=", "(", "(", "U_proj_normalized", ">", "1", ")", "+", "(", "U_proj_normalized", "<", "-", "1", ")", ")", ".", "detach", "(", ")", "\n", "U_proj_normalized", "[", "U_proj_mask", "]", "=", "2", "\n", "V_proj_mask", "=", "(", "(", "V_proj_normalized", ">", "1", ")", "+", "(", "V_proj_normalized", "<", "-", "1", ")", ")", ".", "detach", "(", ")", "\n", "V_proj_normalized", "[", "V_proj_mask", "]", "=", "2", "\n", "\n", "pixel_coords", "=", "torch", ".", "stack", "(", "[", "U_proj_normalized", ",", "V_proj_normalized", "]", ",", "\n", "dim", "=", "2", ")", "# [B, H*W, 2]", "\n", "return", "pixel_coords", ".", "view", "(", "batch_size", ",", "intrinsics", ".", "height", ",", "intrinsics", ".", "width", ",", "\n", "2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.inverse_warp.batch_multiply": [[91, 99], ["batch_scalar.size", "batch_matrix.clone", "range"], "function", ["None"], ["", "def", "batch_multiply", "(", "batch_scalar", ",", "batch_matrix", ")", ":", "\n", "# input: batch_scalar of size b, batch_matrix of size b * 3 * 3", "\n", "# output: batch_matrix of size b * 3 * 3", "\n", "    ", "batch_size", "=", "batch_scalar", ".", "size", "(", "0", ")", "\n", "output", "=", "batch_matrix", ".", "clone", "(", ")", "\n", "for", "i", "in", "range", "(", "batch_size", ")", ":", "\n", "        ", "output", "[", "i", "]", "=", "batch_scalar", "[", "i", "]", "*", "batch_matrix", "[", "i", "]", "\n", "", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.inverse_warp.transform_curr_to_near": [[101, 116], ["pointcloud_curr.size", "torch.bmm", "torch.bmm", "torch.cat", "torch.cat", "pointcloud_curr.view", "t_vec[].unsqueeze", "t_vec[].unsqueeze", "t_vec[].unsqueeze"], "function", ["None"], ["", "def", "transform_curr_to_near", "(", "pointcloud_curr", ",", "r_mat", ",", "t_vec", ",", "intrinsics", ")", ":", "\n", "# translation and rotmat represent the transformation from tgt pose to src pose", "\n", "    ", "batch_size", "=", "pointcloud_curr", ".", "size", "(", "0", ")", "\n", "XYZ_", "=", "torch", ".", "bmm", "(", "r_mat", ",", "pointcloud_curr", ".", "view", "(", "batch_size", ",", "3", ",", "-", "1", ")", ")", "\n", "\n", "X", "=", "(", "XYZ_", "[", ":", ",", "0", ",", ":", "]", "+", "t_vec", "[", ":", ",", "0", "]", ".", "unsqueeze", "(", "1", ")", ")", ".", "view", "(", "\n", "-", "1", ",", "1", ",", "intrinsics", ".", "height", ",", "intrinsics", ".", "width", ")", "\n", "Y", "=", "(", "XYZ_", "[", ":", ",", "1", ",", ":", "]", "+", "t_vec", "[", ":", ",", "1", "]", ".", "unsqueeze", "(", "1", ")", ")", ".", "view", "(", "\n", "-", "1", ",", "1", ",", "intrinsics", ".", "height", ",", "intrinsics", ".", "width", ")", "\n", "Z", "=", "(", "XYZ_", "[", ":", ",", "2", ",", ":", "]", "+", "t_vec", "[", ":", ",", "2", "]", ".", "unsqueeze", "(", "1", ")", ")", ".", "view", "(", "\n", "-", "1", ",", "1", ",", "intrinsics", ".", "height", ",", "intrinsics", ".", "width", ")", "\n", "\n", "pointcloud_near", "=", "torch", ".", "cat", "(", "(", "X", ",", "Y", ",", "Z", ")", ",", "dim", "=", "1", ")", "\n", "\n", "return", "pointcloud_near", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.inverse_warp.homography_from": [[118, 135], ["r_mat.view.view", "t_vec.view.view", "inverse_warp.image_to_pointcloud", "inverse_warp.transform_curr_to_near", "inverse_warp.pointcloud_to_image", "torch.grid_sample"], "function", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.inverse_warp.image_to_pointcloud", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.inverse_warp.transform_curr_to_near", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.None.inverse_warp.pointcloud_to_image"], ["", "def", "homography_from", "(", "rgb_near", ",", "depth_curr", ",", "r_mat", ",", "t_vec", ",", "intrinsics", ")", ":", "\n", "# inverse warp the RGB image from the nearby frame to the current frame", "\n", "\n", "# to ensure dimension consistency", "\n", "    ", "r_mat", "=", "r_mat", ".", "view", "(", "-", "1", ",", "3", ",", "3", ")", "\n", "t_vec", "=", "t_vec", ".", "view", "(", "-", "1", ",", "3", ")", "\n", "\n", "# compute source pixel coordinate", "\n", "pointcloud_curr", "=", "image_to_pointcloud", "(", "depth_curr", ",", "intrinsics", ")", "\n", "pointcloud_near", "=", "transform_curr_to_near", "(", "pointcloud_curr", ",", "r_mat", ",", "t_vec", ",", "\n", "intrinsics", ")", "\n", "pixel_coords_near", "=", "pointcloud_to_image", "(", "pointcloud_near", ",", "intrinsics", ")", "\n", "\n", "# the warping", "\n", "warped", "=", "F", ".", "grid_sample", "(", "rgb_near", ",", "pixel_coords_near", ")", "\n", "\n", "return", "warped", "\n", "", ""]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.Compose.__init__": [[189, 191], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "transforms", ")", ":", "\n", "        ", "self", ".", "transforms", "=", "transforms", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.Compose.__call__": [[192, 196], ["t"], "methods", ["None"], ["", "def", "__call__", "(", "self", ",", "img", ")", ":", "\n", "        ", "for", "t", "in", "self", ".", "transforms", ":", "\n", "            ", "img", "=", "t", "(", "img", ")", "\n", "", "return", "img", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.ToTensor.__call__": [[203, 227], ["isinstance", "transforms._is_numpy_image", "TypeError", "torch.from_numpy", "type", "torch.from_numpy.transpose().copy", "torch.from_numpy", "RuntimeError", "torch.from_numpy.copy", "torch.from_numpy.transpose"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms._is_numpy_image"], ["def", "__call__", "(", "self", ",", "img", ")", ":", "\n", "        ", "\"\"\"Convert a ``numpy.ndarray`` to tensor.\n\n        Args:\n            img (numpy.ndarray): Image to be converted to tensor.\n\n        Returns:\n            Tensor: Converted image.\n        \"\"\"", "\n", "if", "not", "(", "_is_numpy_image", "(", "img", ")", ")", ":", "\n", "            ", "raise", "TypeError", "(", "'img should be ndarray. Got {}'", ".", "format", "(", "type", "(", "img", ")", ")", ")", "\n", "\n", "", "if", "isinstance", "(", "img", ",", "np", ".", "ndarray", ")", ":", "\n", "# handle numpy array", "\n", "            ", "if", "img", ".", "ndim", "==", "3", ":", "\n", "                ", "img", "=", "torch", ".", "from_numpy", "(", "img", ".", "transpose", "(", "(", "2", ",", "0", ",", "1", ")", ")", ".", "copy", "(", ")", ")", "\n", "", "elif", "img", ".", "ndim", "==", "2", ":", "\n", "                ", "img", "=", "torch", ".", "from_numpy", "(", "img", ".", "copy", "(", ")", ")", "\n", "", "else", ":", "\n", "                ", "raise", "RuntimeError", "(", "\n", "'img should be ndarray with 2 or 3 dimensions. Got {}'", ".", "\n", "format", "(", "img", ".", "ndim", ")", ")", "\n", "\n", "", "return", "img", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.NormalizeNumpyArray.__init__": [[239, 242], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "mean", ",", "std", ")", ":", "\n", "        ", "self", ".", "mean", "=", "mean", "\n", "self", ".", "std", "=", "std", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.NormalizeNumpyArray.__call__": [[243, 258], ["print", "range", "transforms._is_numpy_image", "TypeError", "type"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms._is_numpy_image"], ["", "def", "__call__", "(", "self", ",", "img", ")", ":", "\n", "        ", "\"\"\"\n        Args:\n            img (numpy.ndarray): Image of size (H, W, C) to be normalized.\n\n        Returns:\n            Tensor: Normalized image.\n        \"\"\"", "\n", "if", "not", "(", "_is_numpy_image", "(", "img", ")", ")", ":", "\n", "            ", "raise", "TypeError", "(", "'img should be ndarray. Got {}'", ".", "format", "(", "type", "(", "img", ")", ")", ")", "\n", "# TODO: make efficient", "\n", "", "print", "(", "img", ".", "shape", ")", "\n", "for", "i", "in", "range", "(", "3", ")", ":", "\n", "            ", "img", "[", ":", ",", ":", ",", "i", "]", "=", "(", "img", "[", ":", ",", ":", ",", "i", "]", "-", "self", ".", "mean", "[", "i", "]", ")", "/", "self", ".", "std", "[", "i", "]", "\n", "", "return", "img", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.NormalizeTensor.__init__": [[270, 273], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "mean", ",", "std", ")", ":", "\n", "        ", "self", ".", "mean", "=", "mean", "\n", "self", ".", "std", "=", "std", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.NormalizeTensor.__call__": [[274, 288], ["zip", "transforms._is_tensor_image", "TypeError", "t.sub_().div_", "t.sub_"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms._is_tensor_image"], ["", "def", "__call__", "(", "self", ",", "tensor", ")", ":", "\n", "        ", "\"\"\"\n        Args:\n            tensor (Tensor): Tensor image of size (C, H, W) to be normalized.\n\n        Returns:\n            Tensor: Normalized Tensor image.\n        \"\"\"", "\n", "if", "not", "_is_tensor_image", "(", "tensor", ")", ":", "\n", "            ", "raise", "TypeError", "(", "'tensor is not a torch image.'", ")", "\n", "# TODO: make efficient", "\n", "", "for", "t", ",", "m", ",", "s", "in", "zip", "(", "tensor", ",", "self", ".", "mean", ",", "self", ".", "std", ")", ":", "\n", "            ", "t", ".", "sub_", "(", "m", ")", ".", "div_", "(", "s", ")", "\n", "", "return", "tensor", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.Rotate.__init__": [[296, 298], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "angle", ")", ":", "\n", "        ", "self", ".", "angle", "=", "angle", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.Rotate.__call__": [[299, 310], ["skimage.transform.rotate"], "methods", ["None"], ["", "def", "__call__", "(", "self", ",", "img", ")", ":", "\n", "        ", "\"\"\"\n        Args:\n            img (numpy.ndarray (C x H x W)): Image to be rotated.\n\n        Returns:\n            img (numpy.ndarray (C x H x W)): Rotated image.\n        \"\"\"", "\n", "\n", "# order=0 means nearest-neighbor type interpolation", "\n", "return", "skimage", ".", "transform", ".", "rotate", "(", "img", ",", "self", ".", "angle", ",", "resize", "=", "False", ",", "order", "=", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.Resize.__init__": [[323, 327], ["isinstance"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "size", ",", "interpolation", "=", "'nearest'", ")", ":", "\n", "        ", "assert", "isinstance", "(", "size", ",", "float", ")", "\n", "self", ".", "size", "=", "size", "\n", "self", ".", "interpolation", "=", "interpolation", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.Resize.__call__": [[328, 343], ["skimage.transform.rescale", "skimage.transform.rescale", "RuntimeError"], "methods", ["None"], ["", "def", "__call__", "(", "self", ",", "img", ")", ":", "\n", "        ", "\"\"\"\n        Args:\n            img (numpy.ndarray (C x H x W)): Image to be scaled.\n        Returns:\n            img (numpy.ndarray (C x H x W)): Rescaled image.\n        \"\"\"", "\n", "if", "img", ".", "ndim", "==", "3", ":", "\n", "            ", "return", "skimage", ".", "transform", ".", "rescale", "(", "img", ",", "self", ".", "size", ",", "order", "=", "0", ")", "\n", "", "elif", "img", ".", "ndim", "==", "2", ":", "\n", "            ", "return", "skimage", ".", "transform", ".", "rescale", "(", "img", ",", "self", ".", "size", ",", "order", "=", "0", ")", "\n", "", "else", ":", "\n", "            ", "RuntimeError", "(", "\n", "'img should be ndarray with 2 or 3 dimensions. Got {}'", ".", "format", "(", "\n", "img", ".", "ndim", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.CenterCrop.__init__": [[353, 358], ["isinstance", "int", "int"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "size", ")", ":", "\n", "        ", "if", "isinstance", "(", "size", ",", "numbers", ".", "Number", ")", ":", "\n", "            ", "self", ".", "size", "=", "(", "int", "(", "size", ")", ",", "int", "(", "size", ")", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "size", "=", "size", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.CenterCrop.get_params": [[359, 381], ["int", "int", "round", "round"], "methods", ["None"], ["", "", "@", "staticmethod", "\n", "def", "get_params", "(", "img", ",", "output_size", ")", ":", "\n", "        ", "\"\"\"Get parameters for ``crop`` for center crop.\n\n        Args:\n            img (numpy.ndarray (C x H x W)): Image to be cropped.\n            output_size (tuple): Expected output size of the crop.\n\n        Returns:\n            tuple: params (i, j, h, w) to be passed to ``crop`` for center crop.\n        \"\"\"", "\n", "h", "=", "img", ".", "shape", "[", "0", "]", "\n", "w", "=", "img", ".", "shape", "[", "1", "]", "\n", "th", ",", "tw", "=", "output_size", "\n", "i", "=", "int", "(", "round", "(", "(", "h", "-", "th", ")", "/", "2.", ")", ")", "\n", "j", "=", "int", "(", "round", "(", "(", "w", "-", "tw", ")", "/", "2.", ")", ")", "\n", "\n", "# # randomized cropping", "\n", "# i = np.random.randint(i-3, i+4)", "\n", "# j = np.random.randint(j-3, j+4)", "\n", "\n", "return", "i", ",", "j", ",", "th", ",", "tw", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.CenterCrop.__call__": [[382, 407], ["transforms.CenterCrop.get_params", "transforms._is_numpy_image", "TypeError", "RuntimeError", "type"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.Crop.get_params", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms._is_numpy_image"], ["", "def", "__call__", "(", "self", ",", "img", ")", ":", "\n", "        ", "\"\"\"\n        Args:\n            img (numpy.ndarray (C x H x W)): Image to be cropped.\n\n        Returns:\n            img (numpy.ndarray (C x H x W)): Cropped image.\n        \"\"\"", "\n", "i", ",", "j", ",", "h", ",", "w", "=", "self", ".", "get_params", "(", "img", ",", "self", ".", "size", ")", "\n", "\"\"\"\n        i: Upper pixel coordinate.\n        j: Left pixel coordinate.\n        h: Height of the cropped image.\n        w: Width of the cropped image.\n        \"\"\"", "\n", "if", "not", "(", "_is_numpy_image", "(", "img", ")", ")", ":", "\n", "            ", "raise", "TypeError", "(", "'img should be ndarray. Got {}'", ".", "format", "(", "type", "(", "img", ")", ")", ")", "\n", "", "if", "img", ".", "ndim", "==", "3", ":", "\n", "            ", "return", "img", "[", "i", ":", "i", "+", "h", ",", "j", ":", "j", "+", "w", ",", ":", "]", "\n", "", "elif", "img", ".", "ndim", "==", "2", ":", "\n", "            ", "return", "img", "[", "i", ":", "i", "+", "h", ",", "j", ":", "j", "+", "w", "]", "\n", "", "else", ":", "\n", "            ", "raise", "RuntimeError", "(", "\n", "'img should be ndarray with 2 or 3 dimensions. Got {}'", ".", "format", "(", "\n", "img", ".", "ndim", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.BottomCrop.__init__": [[417, 422], ["isinstance", "int", "int"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "size", ")", ":", "\n", "        ", "if", "isinstance", "(", "size", ",", "numbers", ".", "Number", ")", ":", "\n", "            ", "self", ".", "size", "=", "(", "int", "(", "size", ")", ",", "int", "(", "size", ")", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "size", "=", "size", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.BottomCrop.get_params": [[423, 445], ["int", "round"], "methods", ["None"], ["", "", "@", "staticmethod", "\n", "def", "get_params", "(", "img", ",", "output_size", ")", ":", "\n", "        ", "\"\"\"Get parameters for ``crop`` for bottom crop.\n\n        Args:\n            img (numpy.ndarray (C x H x W)): Image to be cropped.\n            output_size (tuple): Expected output size of the crop.\n\n        Returns:\n            tuple: params (i, j, h, w) to be passed to ``crop`` for bottom crop.\n        \"\"\"", "\n", "h", "=", "img", ".", "shape", "[", "0", "]", "\n", "w", "=", "img", ".", "shape", "[", "1", "]", "\n", "th", ",", "tw", "=", "output_size", "\n", "i", "=", "h", "-", "th", "\n", "j", "=", "int", "(", "round", "(", "(", "w", "-", "tw", ")", "/", "2.", ")", ")", "\n", "\n", "# randomized left and right cropping", "\n", "# i = np.random.randint(i-3, i+4)", "\n", "# j = np.random.randint(j-1, j+1)", "\n", "\n", "return", "i", ",", "j", ",", "th", ",", "tw", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.BottomCrop.__call__": [[446, 471], ["transforms.BottomCrop.get_params", "transforms._is_numpy_image", "TypeError", "RuntimeError", "type"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.Crop.get_params", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms._is_numpy_image"], ["", "def", "__call__", "(", "self", ",", "img", ")", ":", "\n", "        ", "\"\"\"\n        Args:\n            img (numpy.ndarray (C x H x W)): Image to be cropped.\n\n        Returns:\n            img (numpy.ndarray (C x H x W)): Cropped image.\n        \"\"\"", "\n", "i", ",", "j", ",", "h", ",", "w", "=", "self", ".", "get_params", "(", "img", ",", "self", ".", "size", ")", "\n", "\"\"\"\n        i: Upper pixel coordinate.\n        j: Left pixel coordinate.\n        h: Height of the cropped image.\n        w: Width of the cropped image.\n        \"\"\"", "\n", "if", "not", "(", "_is_numpy_image", "(", "img", ")", ")", ":", "\n", "            ", "raise", "TypeError", "(", "'img should be ndarray. Got {}'", ".", "format", "(", "type", "(", "img", ")", ")", ")", "\n", "", "if", "img", ".", "ndim", "==", "3", ":", "\n", "            ", "return", "img", "[", "i", ":", "i", "+", "h", ",", "j", ":", "j", "+", "w", ",", ":", "]", "\n", "", "elif", "img", ".", "ndim", "==", "2", ":", "\n", "            ", "return", "img", "[", "i", ":", "i", "+", "h", ",", "j", ":", "j", "+", "w", "]", "\n", "", "else", ":", "\n", "            ", "raise", "RuntimeError", "(", "\n", "'img should be ndarray with 2 or 3 dimensions. Got {}'", ".", "format", "(", "\n", "img", ".", "ndim", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.Crop.__init__": [[481, 483], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "crop", ")", ":", "\n", "        ", "self", ".", "crop", "=", "crop", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.Crop.get_params": [[484, 505], ["None"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "get_params", "(", "img", ",", "crop", ")", ":", "\n", "        ", "\"\"\"Get parameters for ``crop`` for center crop.\n\n        Args:\n            img (numpy.ndarray (C x H x W)): Image to be cropped.\n            output_size (tuple): Expected output size of the crop.\n\n        Returns:\n            tuple: params (i, j, h, w) to be passed to ``crop`` for center crop.\n        \"\"\"", "\n", "x_l", ",", "x_r", ",", "y_b", ",", "y_t", "=", "crop", "\n", "h", "=", "img", ".", "shape", "[", "0", "]", "\n", "w", "=", "img", ".", "shape", "[", "1", "]", "\n", "assert", "x_l", ">=", "0", "and", "x_l", "<", "w", "\n", "assert", "x_r", ">=", "0", "and", "x_r", "<", "w", "\n", "assert", "y_b", ">=", "0", "and", "y_b", "<", "h", "\n", "assert", "y_t", ">=", "0", "and", "y_t", "<", "h", "\n", "assert", "x_l", "<", "x_r", "and", "y_b", "<", "y_t", "\n", "\n", "return", "x_l", ",", "x_r", ",", "y_b", ",", "y_t", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.Crop.__call__": [[506, 531], ["transforms.Crop.get_params", "transforms._is_numpy_image", "TypeError", "RuntimeError", "type"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.Crop.get_params", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms._is_numpy_image"], ["", "def", "__call__", "(", "self", ",", "img", ")", ":", "\n", "        ", "\"\"\"\n        Args:\n            img (numpy.ndarray (C x H x W)): Image to be cropped.\n\n        Returns:\n            img (numpy.ndarray (C x H x W)): Cropped image.\n        \"\"\"", "\n", "x_l", ",", "x_r", ",", "y_b", ",", "y_t", "=", "self", ".", "get_params", "(", "img", ",", "self", ".", "crop", ")", "\n", "\"\"\"\n        i: Upper pixel coordinate.\n        j: Left pixel coordinate.\n        h: Height of the cropped image.\n        w: Width of the cropped image.\n        \"\"\"", "\n", "if", "not", "(", "_is_numpy_image", "(", "img", ")", ")", ":", "\n", "            ", "raise", "TypeError", "(", "'img should be ndarray. Got {}'", ".", "format", "(", "type", "(", "img", ")", ")", ")", "\n", "", "if", "img", ".", "ndim", "==", "3", ":", "\n", "            ", "return", "img", "[", "y_b", ":", "y_t", ",", "x_l", ":", "x_r", ",", ":", "]", "\n", "", "elif", "img", ".", "ndim", "==", "2", ":", "\n", "            ", "return", "img", "[", "y_b", ":", "y_t", ",", "x_l", ":", "x_r", "]", "\n", "", "else", ":", "\n", "            ", "raise", "RuntimeError", "(", "\n", "'img should be ndarray with 2 or 3 dimensions. Got {}'", ".", "format", "(", "\n", "img", ".", "ndim", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.Lambda.__init__": [[539, 542], ["isinstance"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "lambd", ")", ":", "\n", "        ", "assert", "isinstance", "(", "lambd", ",", "types", ".", "LambdaType", ")", "\n", "self", ".", "lambd", "=", "lambd", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.Lambda.__call__": [[543, 545], ["transforms.Lambda.lambd"], "methods", ["None"], ["", "def", "__call__", "(", "self", ",", "img", ")", ":", "\n", "        ", "return", "self", ".", "lambd", "(", "img", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.HorizontalFlip.__init__": [[554, 556], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "do_flip", ")", ":", "\n", "        ", "self", ".", "do_flip", "=", "do_flip", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.HorizontalFlip.__call__": [[557, 572], ["transforms._is_numpy_image", "TypeError", "numpy.fliplr", "type"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms._is_numpy_image"], ["", "def", "__call__", "(", "self", ",", "img", ")", ":", "\n", "        ", "\"\"\"\n        Args:\n            img (numpy.ndarray (C x H x W)): Image to be flipped.\n\n        Returns:\n            img (numpy.ndarray (C x H x W)): flipped image.\n        \"\"\"", "\n", "if", "not", "(", "_is_numpy_image", "(", "img", ")", ")", ":", "\n", "            ", "raise", "TypeError", "(", "'img should be ndarray. Got {}'", ".", "format", "(", "type", "(", "img", ")", ")", ")", "\n", "\n", "", "if", "self", ".", "do_flip", ":", "\n", "            ", "return", "np", ".", "fliplr", "(", "img", ")", "\n", "", "else", ":", "\n", "            ", "return", "img", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.ColorJitter.__init__": [[587, 597], ["transforms.append", "transforms.append", "transforms.append", "transforms.append", "numpy.random.shuffle", "transforms.Compose", "transforms.Lambda", "transforms.Lambda", "transforms.Lambda", "transforms.Lambda", "transforms.adjust_brightness", "transforms.adjust_contrast", "transforms.adjust_saturation", "transforms.adjust_hue"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.adjust_brightness", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.adjust_contrast", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.adjust_saturation", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.adjust_hue"], ["def", "__init__", "(", "self", ",", "brightness", "=", "0", ",", "contrast", "=", "0", ",", "saturation", "=", "0", ",", "hue", "=", "0", ")", ":", "\n", "        ", "transforms", "=", "[", "]", "\n", "transforms", ".", "append", "(", "\n", "Lambda", "(", "lambda", "img", ":", "adjust_brightness", "(", "img", ",", "brightness", ")", ")", ")", "\n", "transforms", ".", "append", "(", "Lambda", "(", "lambda", "img", ":", "adjust_contrast", "(", "img", ",", "contrast", ")", ")", ")", "\n", "transforms", ".", "append", "(", "\n", "Lambda", "(", "lambda", "img", ":", "adjust_saturation", "(", "img", ",", "saturation", ")", ")", ")", "\n", "transforms", ".", "append", "(", "Lambda", "(", "lambda", "img", ":", "adjust_hue", "(", "img", ",", "hue", ")", ")", ")", "\n", "np", ".", "random", ".", "shuffle", "(", "transforms", ")", "\n", "self", ".", "transform", "=", "Compose", "(", "transforms", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.ColorJitter.__call__": [[598, 611], ["PIL.Image.fromarray", "numpy.array", "transforms._is_numpy_image", "TypeError", "transforms.ColorJitter.transform", "type"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms._is_numpy_image"], ["", "def", "__call__", "(", "self", ",", "img", ")", ":", "\n", "        ", "\"\"\"\n        Args:\n            img (numpy.ndarray (C x H x W)): Input image.\n\n        Returns:\n            img (numpy.ndarray (C x H x W)): Color jittered image.\n        \"\"\"", "\n", "if", "not", "(", "_is_numpy_image", "(", "img", ")", ")", ":", "\n", "            ", "raise", "TypeError", "(", "'img should be ndarray. Got {}'", ".", "format", "(", "type", "(", "img", ")", ")", ")", "\n", "\n", "", "pil", "=", "Image", ".", "fromarray", "(", "img", ")", "\n", "return", "np", ".", "array", "(", "self", ".", "transform", "(", "pil", ")", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms._is_numpy_image": [[22, 24], ["isinstance"], "function", ["None"], ["def", "_is_numpy_image", "(", "img", ")", ":", "\n", "    ", "return", "isinstance", "(", "img", ",", "np", ".", "ndarray", ")", "and", "(", "img", ".", "ndim", "in", "{", "2", ",", "3", "}", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms._is_pil_image": [[26, 31], ["isinstance", "isinstance"], "function", ["None"], ["", "def", "_is_pil_image", "(", "img", ")", ":", "\n", "    ", "if", "accimage", "is", "not", "None", ":", "\n", "        ", "return", "isinstance", "(", "img", ",", "(", "Image", ".", "Image", ",", "accimage", ".", "Image", ")", ")", "\n", "", "else", ":", "\n", "        ", "return", "isinstance", "(", "img", ",", "Image", ".", "Image", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms._is_tensor_image": [[33, 35], ["torch.is_tensor", "img.ndimension"], "function", ["None"], ["", "", "def", "_is_tensor_image", "(", "img", ")", ":", "\n", "    ", "return", "torch", ".", "is_tensor", "(", "img", ")", "and", "img", ".", "ndimension", "(", ")", "==", "3", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.adjust_brightness": [[37, 55], ["PIL.ImageEnhance.Brightness", "ImageEnhance.Brightness.enhance", "transforms._is_pil_image", "TypeError", "type"], "function", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms._is_pil_image"], ["", "def", "adjust_brightness", "(", "img", ",", "brightness_factor", ")", ":", "\n", "    ", "\"\"\"Adjust brightness of an Image.\n\n    Args:\n        img (PIL Image): PIL Image to be adjusted.\n        brightness_factor (float):  How much to adjust the brightness. Can be\n            any non negative number. 0 gives a black image, 1 gives the\n            original image while 2 increases the brightness by a factor of 2.\n\n    Returns:\n        PIL Image: Brightness adjusted image.\n    \"\"\"", "\n", "if", "not", "_is_pil_image", "(", "img", ")", ":", "\n", "        ", "raise", "TypeError", "(", "'img should be PIL Image. Got {}'", ".", "format", "(", "type", "(", "img", ")", ")", ")", "\n", "\n", "", "enhancer", "=", "ImageEnhance", ".", "Brightness", "(", "img", ")", "\n", "img", "=", "enhancer", ".", "enhance", "(", "brightness_factor", ")", "\n", "return", "img", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.adjust_contrast": [[57, 75], ["PIL.ImageEnhance.Contrast", "ImageEnhance.Contrast.enhance", "transforms._is_pil_image", "TypeError", "type"], "function", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms._is_pil_image"], ["", "def", "adjust_contrast", "(", "img", ",", "contrast_factor", ")", ":", "\n", "    ", "\"\"\"Adjust contrast of an Image.\n\n    Args:\n        img (PIL Image): PIL Image to be adjusted.\n        contrast_factor (float): How much to adjust the contrast. Can be any\n            non negative number. 0 gives a solid gray image, 1 gives the\n            original image while 2 increases the contrast by a factor of 2.\n\n    Returns:\n        PIL Image: Contrast adjusted image.\n    \"\"\"", "\n", "if", "not", "_is_pil_image", "(", "img", ")", ":", "\n", "        ", "raise", "TypeError", "(", "'img should be PIL Image. Got {}'", ".", "format", "(", "type", "(", "img", ")", ")", ")", "\n", "\n", "", "enhancer", "=", "ImageEnhance", ".", "Contrast", "(", "img", ")", "\n", "img", "=", "enhancer", ".", "enhance", "(", "contrast_factor", ")", "\n", "return", "img", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.adjust_saturation": [[77, 95], ["PIL.ImageEnhance.Color", "ImageEnhance.Color.enhance", "transforms._is_pil_image", "TypeError", "type"], "function", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms._is_pil_image"], ["", "def", "adjust_saturation", "(", "img", ",", "saturation_factor", ")", ":", "\n", "    ", "\"\"\"Adjust color saturation of an image.\n\n    Args:\n        img (PIL Image): PIL Image to be adjusted.\n        saturation_factor (float):  How much to adjust the saturation. 0 will\n            give a black and white image, 1 will give the original image while\n            2 will enhance the saturation by a factor of 2.\n\n    Returns:\n        PIL Image: Saturation adjusted image.\n    \"\"\"", "\n", "if", "not", "_is_pil_image", "(", "img", ")", ":", "\n", "        ", "raise", "TypeError", "(", "'img should be PIL Image. Got {}'", ".", "format", "(", "type", "(", "img", ")", ")", ")", "\n", "\n", "", "enhancer", "=", "ImageEnhance", ".", "Color", "(", "img", ")", "\n", "img", "=", "enhancer", ".", "enhance", "(", "saturation_factor", ")", "\n", "return", "img", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.adjust_hue": [[97, 141], ["Image.merge().convert.convert().split", "numpy.array", "PIL.Image.fromarray", "PIL.Image.merge().convert", "ValueError", "transforms._is_pil_image", "TypeError", "numpy.errstate", "numpy.uint8", "Image.merge().convert.convert", "PIL.Image.merge", "type"], "function", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms._is_pil_image"], ["", "def", "adjust_hue", "(", "img", ",", "hue_factor", ")", ":", "\n", "    ", "\"\"\"Adjust hue of an image.\n\n    The image hue is adjusted by converting the image to HSV and\n    cyclically shifting the intensities in the hue channel (H).\n    The image is then converted back to original image mode.\n\n    `hue_factor` is the amount of shift in H channel and must be in the\n    interval `[-0.5, 0.5]`.\n\n    See https://en.wikipedia.org/wiki/Hue for more details on Hue.\n\n    Args:\n        img (PIL Image): PIL Image to be adjusted.\n        hue_factor (float):  How much to shift the hue channel. Should be in\n            [-0.5, 0.5]. 0.5 and -0.5 give complete reversal of hue channel in\n            HSV space in positive and negative direction respectively.\n            0 means no shift. Therefore, both -0.5 and 0.5 will give an image\n            with complementary colors while 0 gives the original image.\n\n    Returns:\n        PIL Image: Hue adjusted image.\n    \"\"\"", "\n", "if", "not", "(", "-", "0.5", "<=", "hue_factor", "<=", "0.5", ")", ":", "\n", "        ", "raise", "ValueError", "(", "\n", "'hue_factor is not in [-0.5, 0.5].'", ".", "format", "(", "hue_factor", ")", ")", "\n", "\n", "", "if", "not", "_is_pil_image", "(", "img", ")", ":", "\n", "        ", "raise", "TypeError", "(", "'img should be PIL Image. Got {}'", ".", "format", "(", "type", "(", "img", ")", ")", ")", "\n", "\n", "", "input_mode", "=", "img", ".", "mode", "\n", "if", "input_mode", "in", "{", "'L'", ",", "'1'", ",", "'I'", ",", "'F'", "}", ":", "\n", "        ", "return", "img", "\n", "\n", "", "h", ",", "s", ",", "v", "=", "img", ".", "convert", "(", "'HSV'", ")", ".", "split", "(", ")", "\n", "\n", "np_h", "=", "np", ".", "array", "(", "h", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "# uint8 addition take cares of rotation across boundaries", "\n", "with", "np", ".", "errstate", "(", "over", "=", "'ignore'", ")", ":", "\n", "        ", "np_h", "+=", "np", ".", "uint8", "(", "hue_factor", "*", "255", ")", "\n", "", "h", "=", "Image", ".", "fromarray", "(", "np_h", ",", "'L'", ")", "\n", "\n", "img", "=", "Image", ".", "merge", "(", "'HSV'", ",", "(", "h", ",", "s", ",", "v", ")", ")", ".", "convert", "(", "input_mode", ")", "\n", "return", "img", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms.adjust_gamma": [[143, 175], ["Image.fromarray().convert.convert", "numpy.array", "numpy.uint8", "PIL.Image.fromarray().convert", "transforms._is_pil_image", "TypeError", "ValueError", "numpy.clip", "PIL.Image.fromarray", "type"], "function", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.transforms._is_pil_image"], ["", "def", "adjust_gamma", "(", "img", ",", "gamma", ",", "gain", "=", "1", ")", ":", "\n", "    ", "\"\"\"Perform gamma correction on an image.\n\n    Also known as Power Law Transform. Intensities in RGB mode are adjusted\n    based on the following equation:\n\n        I_out = 255 * gain * ((I_in / 255) ** gamma)\n\n    See https://en.wikipedia.org/wiki/Gamma_correction for more details.\n\n    Args:\n        img (PIL Image): PIL Image to be adjusted.\n        gamma (float): Non negative real number. gamma larger than 1 make the\n            shadows darker, while gamma smaller than 1 make dark regions\n            lighter.\n        gain (float): The constant multiplier.\n    \"\"\"", "\n", "if", "not", "_is_pil_image", "(", "img", ")", ":", "\n", "        ", "raise", "TypeError", "(", "'img should be PIL Image. Got {}'", ".", "format", "(", "type", "(", "img", ")", ")", ")", "\n", "\n", "", "if", "gamma", "<", "0", ":", "\n", "        ", "raise", "ValueError", "(", "'Gamma should be a non-negative real number'", ")", "\n", "\n", "", "input_mode", "=", "img", ".", "mode", "\n", "img", "=", "img", ".", "convert", "(", "'RGB'", ")", "\n", "\n", "np_img", "=", "np", ".", "array", "(", "img", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "np_img", "=", "255", "*", "gain", "*", "(", "(", "np_img", "/", "255", ")", "**", "gamma", ")", "\n", "np_img", "=", "np", ".", "uint8", "(", "np", ".", "clip", "(", "np_img", ",", "0", ",", "255", ")", ")", "\n", "\n", "img", "=", "Image", ".", "fromarray", "(", "np_img", ",", "'RGB'", ")", ".", "convert", "(", "input_mode", ")", "\n", "return", "img", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.pose_estimator.rgb2gray": [[5, 7], ["numpy.dot"], "function", ["None"], ["def", "rgb2gray", "(", "rgb", ")", ":", "\n", "    ", "return", "np", ".", "dot", "(", "rgb", "[", "...", ",", ":", "3", "]", ",", "[", "0.299", ",", "0.587", ",", "0.114", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.pose_estimator.convert_2d_to_3d": [[9, 17], ["None"], "function", ["None"], ["", "def", "convert_2d_to_3d", "(", "u", ",", "v", ",", "z", ",", "K", ")", ":", "\n", "    ", "v0", "=", "K", "[", "1", "]", "[", "2", "]", "\n", "u0", "=", "K", "[", "0", "]", "[", "2", "]", "\n", "fy", "=", "K", "[", "1", "]", "[", "1", "]", "\n", "fx", "=", "K", "[", "0", "]", "[", "0", "]", "\n", "x", "=", "(", "u", "-", "u0", ")", "*", "z", "/", "fx", "\n", "y", "=", "(", "v", "-", "v0", ")", "*", "z", "/", "fy", "\n", "return", "(", "x", ",", "y", ",", "z", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.pose_estimator.feature_match": [[19, 60], ["cv2.xfeatures2d.SIFT_create", "cv2.xfeatures2d.SIFT_create.detectAndCompute", "cv2.xfeatures2d.SIFT_create.detectAndCompute", "des1.astype.astype", "des2.astype.astype", "enumerate", "numpy.int32", "numpy.int32", "dict", "dict", "cv2.FlannBasedMatcher", "cv2.FlannBasedMatcher.knnMatch", "cv2.DescriptorMatcher().create", "cv2.DescriptorMatcher().create.knnMatch", "good.append", "np.int32.append", "np.int32.append", "cv2.DescriptorMatcher"], "function", ["None"], ["", "def", "feature_match", "(", "img1", ",", "img2", ")", ":", "\n", "    ", "r''' Find features on both images and match them pairwise\n   '''", "\n", "max_n_features", "=", "1000", "\n", "# max_n_features = 500", "\n", "use_flann", "=", "False", "# better not use flann", "\n", "\n", "detector", "=", "cv2", ".", "xfeatures2d", ".", "SIFT_create", "(", "max_n_features", ")", "\n", "\n", "# find the keypoints and descriptors with SIFT", "\n", "kp1", ",", "des1", "=", "detector", ".", "detectAndCompute", "(", "img1", ",", "None", ")", "\n", "kp2", ",", "des2", "=", "detector", ".", "detectAndCompute", "(", "img2", ",", "None", ")", "\n", "if", "(", "des1", "is", "None", ")", "or", "(", "des2", "is", "None", ")", ":", "\n", "        ", "return", "[", "]", ",", "[", "]", "\n", "", "des1", "=", "des1", ".", "astype", "(", "np", ".", "float32", ")", "\n", "des2", "=", "des2", ".", "astype", "(", "np", ".", "float32", ")", "\n", "\n", "if", "use_flann", ":", "\n", "# FLANN parameters", "\n", "        ", "FLANN_INDEX_KDTREE", "=", "0", "\n", "index_params", "=", "dict", "(", "algorithm", "=", "FLANN_INDEX_KDTREE", ",", "trees", "=", "5", ")", "\n", "search_params", "=", "dict", "(", "checks", "=", "50", ")", "\n", "flann", "=", "cv2", ".", "FlannBasedMatcher", "(", "index_params", ",", "search_params", ")", "\n", "matches", "=", "flann", ".", "knnMatch", "(", "des1", ",", "des2", ",", "k", "=", "2", ")", "\n", "", "else", ":", "\n", "        ", "matcher", "=", "cv2", ".", "DescriptorMatcher", "(", ")", ".", "create", "(", "'BruteForce'", ")", "\n", "matches", "=", "matcher", ".", "knnMatch", "(", "des1", ",", "des2", ",", "k", "=", "2", ")", "\n", "\n", "", "good", "=", "[", "]", "\n", "pts1", "=", "[", "]", "\n", "pts2", "=", "[", "]", "\n", "# ratio test as per Lowe's paper", "\n", "for", "i", ",", "(", "m", ",", "n", ")", "in", "enumerate", "(", "matches", ")", ":", "\n", "        ", "if", "m", ".", "distance", "<", "0.8", "*", "n", ".", "distance", ":", "\n", "            ", "good", ".", "append", "(", "m", ")", "\n", "pts2", ".", "append", "(", "kp2", "[", "m", ".", "trainIdx", "]", ".", "pt", ")", "\n", "pts1", ".", "append", "(", "kp1", "[", "m", ".", "queryIdx", "]", ".", "pt", ")", "\n", "\n", "", "", "pts1", "=", "np", ".", "int32", "(", "pts1", ")", "\n", "pts2", "=", "np", ".", "int32", "(", "pts2", ")", "\n", "return", "pts1", ",", "pts2", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.pose_estimator.get_pose_pnp": [[62, 105], ["rgb2gray().astype", "rgb2gray().astype", "pose_estimator.feature_match", "numpy.ones", "cv2.dilate", "enumerate", "numpy.expand_dims", "numpy.expand_dims", "cv2.solvePnPRansac", "pose_estimator.rgb2gray", "pose_estimator.rgb2gray", "pose_estimator.convert_2d_to_3d", "np.expand_dims.append", "np.expand_dims.append", "len", "len", "numpy.array().astype", "numpy.array().astype", "numpy.array", "numpy.array"], "function", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.pose_estimator.feature_match", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.pose_estimator.rgb2gray", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.pose_estimator.rgb2gray", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.pose_estimator.convert_2d_to_3d"], ["", "def", "get_pose_pnp", "(", "rgb_curr", ",", "rgb_near", ",", "depth_curr", ",", "K", ")", ":", "\n", "    ", "gray_curr", "=", "rgb2gray", "(", "rgb_curr", ")", ".", "astype", "(", "np", ".", "uint8", ")", "\n", "gray_near", "=", "rgb2gray", "(", "rgb_near", ")", ".", "astype", "(", "np", ".", "uint8", ")", "\n", "height", ",", "width", "=", "gray_curr", ".", "shape", "\n", "\n", "pts2d_curr", ",", "pts2d_near", "=", "feature_match", "(", "gray_curr", ",", "\n", "gray_near", ")", "# feature matching", "\n", "\n", "# dilation of depth", "\n", "kernel", "=", "np", ".", "ones", "(", "(", "4", ",", "4", ")", ",", "np", ".", "uint8", ")", "\n", "depth_curr_dilated", "=", "cv2", ".", "dilate", "(", "depth_curr", ",", "kernel", ")", "\n", "\n", "# extract 3d pts", "\n", "pts3d_curr", "=", "[", "]", "\n", "pts2d_near_filtered", "=", "[", "\n", "]", "# keep only feature points with depth in the current frame", "\n", "for", "i", ",", "pt2d", "in", "enumerate", "(", "pts2d_curr", ")", ":", "\n", "# print(pt2d)", "\n", "        ", "u", ",", "v", "=", "pt2d", "[", "0", "]", ",", "pt2d", "[", "1", "]", "\n", "z", "=", "depth_curr_dilated", "[", "v", ",", "u", "]", "\n", "if", "z", ">", "0", ":", "\n", "            ", "xyz_curr", "=", "convert_2d_to_3d", "(", "u", ",", "v", ",", "z", ",", "K", ")", "\n", "pts3d_curr", ".", "append", "(", "xyz_curr", ")", "\n", "pts2d_near_filtered", ".", "append", "(", "pts2d_near", "[", "i", "]", ")", "\n", "\n", "# the minimal number of points accepted by solvePnP is 4:", "\n", "", "", "if", "len", "(", "pts3d_curr", ")", ">=", "4", "and", "len", "(", "pts2d_near_filtered", ")", ">=", "4", ":", "\n", "        ", "pts3d_curr", "=", "np", ".", "expand_dims", "(", "np", ".", "array", "(", "pts3d_curr", ")", ".", "astype", "(", "np", ".", "float32", ")", ",", "\n", "axis", "=", "1", ")", "\n", "pts2d_near_filtered", "=", "np", ".", "expand_dims", "(", "\n", "np", ".", "array", "(", "pts2d_near_filtered", ")", ".", "astype", "(", "np", ".", "float32", ")", ",", "axis", "=", "1", ")", "\n", "\n", "# ransac", "\n", "ret", "=", "cv2", ".", "solvePnPRansac", "(", "pts3d_curr", ",", "\n", "pts2d_near_filtered", ",", "\n", "K", ",", "\n", "distCoeffs", "=", "None", ")", "\n", "success", "=", "ret", "[", "0", "]", "\n", "rotation_vector", "=", "ret", "[", "1", "]", "\n", "translation_vector", "=", "ret", "[", "2", "]", "\n", "return", "(", "success", ",", "rotation_vector", ",", "translation_vector", ")", "\n", "", "else", ":", "\n", "        ", "return", "(", "0", ",", "None", ",", "None", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.KittiDepth.__init__": [[281, 289], ["kitti_loader.get_paths_and_transform", "kitti_loader.load_calib"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.get_paths_and_transform", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.load_calib"], ["def", "__init__", "(", "self", ",", "split", ",", "args", ")", ":", "\n", "        ", "self", ".", "args", "=", "args", "\n", "self", ".", "split", "=", "split", "\n", "paths", ",", "transform", "=", "get_paths_and_transform", "(", "split", ",", "args", ")", "\n", "self", ".", "paths", "=", "paths", "\n", "self", ".", "transform", "=", "transform", "\n", "self", ".", "K", "=", "load_calib", "(", ")", "\n", "self", ".", "threshold_translation", "=", "0.1", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.KittiDepth.__getraw__": [[290, 300], ["kitti_loader.rgb_read", "kitti_loader.depth_read", "kitti_loader.depth_read", "kitti_loader.get_rgb_near"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.rgb_read", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.depth_read", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.depth_read", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.get_rgb_near"], ["", "def", "__getraw__", "(", "self", ",", "index", ")", ":", "\n", "        ", "rgb", "=", "rgb_read", "(", "self", ".", "paths", "[", "'rgb'", "]", "[", "index", "]", ")", "if", "(", "self", ".", "paths", "[", "'rgb'", "]", "[", "index", "]", "is", "not", "None", "and", "(", "self", ".", "args", ".", "use_rgb", "or", "self", ".", "args", ".", "use_g", ")", ")", "else", "None", "\n", "sparse", "=", "depth_read", "(", "self", ".", "paths", "[", "'d'", "]", "[", "index", "]", ")", "if", "(", "self", ".", "paths", "[", "'d'", "]", "[", "index", "]", "is", "not", "None", "and", "self", ".", "args", ".", "use_d", ")", "else", "None", "\n", "target", "=", "depth_read", "(", "self", ".", "paths", "[", "'gt'", "]", "[", "index", "]", ")", "if", "self", ".", "paths", "[", "'gt'", "]", "[", "index", "]", "is", "not", "None", "else", "None", "\n", "rgb_near", "=", "get_rgb_near", "(", "self", ".", "paths", "[", "'rgb'", "]", "[", "index", "]", ",", "self", ".", "args", ")", "if", "self", ".", "split", "==", "'train'", "and", "self", ".", "args", ".", "use_pose", "else", "None", "\n", "return", "rgb", ",", "sparse", ",", "target", ",", "rgb_near", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.KittiDepth.__getitem__": [[301, 327], ["kitti_loader.KittiDepth.__getraw__", "kitti_loader.KittiDepth.transform", "kitti_loader.handle_gray", "dataloaders.pose_estimator.get_pose_pnp", "to_float_tensor", "cv2.Rodrigues", "numpy.zeros", "numpy.eye", "candidates.items", "numpy.linalg.norm"], "methods", ["home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.KittiDepth.__getraw__", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.handle_gray", "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.pose_estimator.get_pose_pnp"], ["", "def", "__getitem__", "(", "self", ",", "index", ")", ":", "\n", "        ", "rgb", ",", "sparse", ",", "target", ",", "rgb_near", "=", "self", ".", "__getraw__", "(", "index", ")", "\n", "rgb", ",", "sparse", ",", "target", ",", "rgb_near", "=", "self", ".", "transform", "(", "rgb", ",", "sparse", ",", "target", ",", "\n", "rgb_near", ",", "self", ".", "args", ")", "\n", "r_mat", ",", "t_vec", "=", "None", ",", "None", "\n", "if", "self", ".", "split", "==", "'train'", "and", "self", ".", "args", ".", "use_pose", ":", "\n", "            ", "success", ",", "r_vec", ",", "t_vec", "=", "get_pose_pnp", "(", "rgb", ",", "rgb_near", ",", "sparse", ",", "self", ".", "K", ")", "\n", "# discard if translation is too small", "\n", "success", "=", "success", "and", "LA", ".", "norm", "(", "t_vec", ")", ">", "self", ".", "threshold_translation", "\n", "if", "success", ":", "\n", "                ", "r_mat", ",", "_", "=", "cv2", ".", "Rodrigues", "(", "r_vec", ")", "\n", "", "else", ":", "\n", "# return the same image and no motion when PnP fails", "\n", "                ", "rgb_near", "=", "rgb", "\n", "t_vec", "=", "np", ".", "zeros", "(", "(", "3", ",", "1", ")", ")", "\n", "r_mat", "=", "np", ".", "eye", "(", "3", ")", "\n", "\n", "", "", "rgb", ",", "gray", "=", "handle_gray", "(", "rgb", ",", "self", ".", "args", ")", "\n", "candidates", "=", "{", "\"rgb\"", ":", "rgb", ",", "\"d\"", ":", "sparse", ",", "\"gt\"", ":", "target", ",", "\"g\"", ":", "gray", ",", "\"r_mat\"", ":", "r_mat", ",", "\"t_vec\"", ":", "t_vec", ",", "\"rgb_near\"", ":", "rgb_near", "}", "\n", "items", "=", "{", "\n", "key", ":", "to_float_tensor", "(", "val", ")", "\n", "for", "key", ",", "val", "in", "candidates", ".", "items", "(", ")", "if", "val", "is", "not", "None", "\n", "}", "\n", "\n", "return", "items", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.KittiDepth.__len__": [[328, 330], ["len"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "paths", "[", "'gt'", "]", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.load_calib": [[18, 40], ["open", "open.readlines", "numpy.reshape().astype", "[].split", "numpy.reshape", "numpy.array", "P_rect_line.split", "float"], "function", ["None"], ["def", "load_calib", "(", ")", ":", "\n", "    ", "\"\"\"\n    Temporarily hardcoding the calibration matrix using calib file from 2011_09_26\n    \"\"\"", "\n", "calib", "=", "open", "(", "\"dataloaders/calib_cam_to_cam.txt\"", ",", "\"r\"", ")", "\n", "lines", "=", "calib", ".", "readlines", "(", ")", "\n", "P_rect_line", "=", "lines", "[", "25", "]", "\n", "\n", "Proj_str", "=", "P_rect_line", ".", "split", "(", "\":\"", ")", "[", "1", "]", ".", "split", "(", "\" \"", ")", "[", "1", ":", "]", "\n", "Proj", "=", "np", ".", "reshape", "(", "np", ".", "array", "(", "[", "float", "(", "p", ")", "for", "p", "in", "Proj_str", "]", ")", ",", "\n", "(", "3", ",", "4", ")", ")", ".", "astype", "(", "np", ".", "float32", ")", "\n", "K", "=", "Proj", "[", ":", "3", ",", ":", "3", "]", "# camera matrix", "\n", "\n", "# note: we will take the center crop of the images during augmentation", "\n", "# that changes the optical centers, but not focal lengths", "\n", "K", "[", "0", ",", "2", "]", "=", "K", "[", "\n", "0", ",", "\n", "2", "]", "-", "13", "# from width = 1242 to 1216, with a 13-pixel cut on both sides", "\n", "K", "[", "1", ",", "2", "]", "=", "K", "[", "\n", "1", ",", "\n", "2", "]", "-", "11.5", "# from width = 375 to 352, with a 11.5-pixel cut on both sides", "\n", "return", "K", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.get_paths_and_transform": [[42, 137], ["os.path.join", "os.path.join", "os.path.join", "os.path.join", "sorted", "sorted", "sorted", "RuntimeError", "RuntimeError", "RuntimeError", "RuntimeError", "RuntimeError", "p.split", "glob.glob", "glob.glob", "kitti_loader.get_paths_and_transform.get_rgb_paths"], "function", ["None"], ["", "def", "get_paths_and_transform", "(", "split", ",", "args", ")", ":", "\n", "    ", "assert", "(", "args", ".", "use_d", "or", "args", ".", "use_rgb", "\n", "or", "args", ".", "use_g", ")", ",", "'no proper input selected'", "\n", "\n", "if", "split", "==", "\"train\"", ":", "\n", "        ", "transform", "=", "train_transform", "\n", "glob_d", "=", "os", ".", "path", ".", "join", "(", "\n", "args", ".", "data_folder", ",", "\n", "'data_depth_velodyne/train/*_sync/proj_depth/velodyne_raw/image_0[2,3]/*.png'", "\n", ")", "\n", "glob_gt", "=", "os", ".", "path", ".", "join", "(", "\n", "args", ".", "data_folder", ",", "\n", "'data_depth_annotated/train/*_sync/proj_depth/groundtruth/image_0[2,3]/*.png'", "\n", ")", "\n", "\n", "def", "get_rgb_paths", "(", "p", ")", ":", "\n", "            ", "ps", "=", "p", ".", "split", "(", "'/'", ")", "\n", "pnew", "=", "'/'", ".", "join", "(", "[", "args", ".", "data_folder", "]", "+", "[", "'data_rgb'", "]", "+", "ps", "[", "-", "6", ":", "-", "4", "]", "+", "\n", "ps", "[", "-", "2", ":", "-", "1", "]", "+", "[", "'data'", "]", "+", "ps", "[", "-", "1", ":", "]", ")", "\n", "return", "pnew", "\n", "", "", "elif", "split", "==", "\"val\"", ":", "\n", "        ", "if", "args", ".", "val", "==", "\"full\"", ":", "\n", "            ", "transform", "=", "val_transform", "\n", "glob_d", "=", "os", ".", "path", ".", "join", "(", "\n", "args", ".", "data_folder", ",", "\n", "'data_depth_velodyne/val/*_sync/proj_depth/velodyne_raw/image_0[2,3]/*.png'", "\n", ")", "\n", "glob_gt", "=", "os", ".", "path", ".", "join", "(", "\n", "args", ".", "data_folder", ",", "\n", "'data_depth_annotated/val/*_sync/proj_depth/groundtruth/image_0[2,3]/*.png'", "\n", ")", "\n", "def", "get_rgb_paths", "(", "p", ")", ":", "\n", "                ", "ps", "=", "p", ".", "split", "(", "'/'", ")", "\n", "pnew", "=", "'/'", ".", "join", "(", "ps", "[", ":", "-", "7", "]", "+", "\n", "[", "'data_rgb'", "]", "+", "ps", "[", "-", "6", ":", "-", "4", "]", "+", "ps", "[", "-", "2", ":", "-", "1", "]", "+", "[", "'data'", "]", "+", "ps", "[", "-", "1", ":", "]", ")", "\n", "return", "pnew", "\n", "", "", "elif", "args", ".", "val", "==", "\"select\"", ":", "\n", "            ", "transform", "=", "no_transform", "\n", "glob_d", "=", "os", ".", "path", ".", "join", "(", "\n", "args", ".", "data_folder", ",", "\n", "\"depth_selection/val_selection_cropped/velodyne_raw/*.png\"", ")", "\n", "glob_gt", "=", "os", ".", "path", ".", "join", "(", "\n", "args", ".", "data_folder", ",", "\n", "\"depth_selection/val_selection_cropped/groundtruth_depth/*.png\"", "\n", ")", "\n", "def", "get_rgb_paths", "(", "p", ")", ":", "\n", "                ", "return", "p", ".", "replace", "(", "\"groundtruth_depth\"", ",", "\"image\"", ")", "\n", "", "", "", "elif", "split", "==", "\"test_completion\"", ":", "\n", "        ", "transform", "=", "no_transform", "\n", "glob_d", "=", "os", ".", "path", ".", "join", "(", "\n", "args", ".", "data_folder", ",", "\n", "\"depth_selection/test_depth_completion_anonymous/velodyne_raw/*.png\"", "\n", ")", "\n", "glob_gt", "=", "None", "#\"test_depth_completion_anonymous/\"", "\n", "glob_rgb", "=", "os", ".", "path", ".", "join", "(", "\n", "args", ".", "data_folder", ",", "\n", "\"depth_selection/test_depth_completion_anonymous/image/*.png\"", ")", "\n", "", "elif", "split", "==", "\"test_prediction\"", ":", "\n", "        ", "transform", "=", "no_transform", "\n", "glob_d", "=", "None", "\n", "glob_gt", "=", "None", "#\"test_depth_completion_anonymous/\"", "\n", "glob_rgb", "=", "os", ".", "path", ".", "join", "(", "\n", "args", ".", "data_folder", ",", "\n", "\"depth_selection/test_depth_prediction_anonymous/image/*.png\"", ")", "\n", "", "else", ":", "\n", "        ", "raise", "ValueError", "(", "\"Unrecognized split \"", "+", "str", "(", "split", ")", ")", "\n", "\n", "", "if", "glob_gt", "is", "not", "None", ":", "\n", "# train or val-full or val-select", "\n", "        ", "paths_d", "=", "sorted", "(", "glob", ".", "glob", "(", "glob_d", ")", ")", "\n", "paths_gt", "=", "sorted", "(", "glob", ".", "glob", "(", "glob_gt", ")", ")", "\n", "paths_rgb", "=", "[", "get_rgb_paths", "(", "p", ")", "for", "p", "in", "paths_gt", "]", "\n", "", "else", ":", "\n", "# test only has d or rgb", "\n", "        ", "paths_rgb", "=", "sorted", "(", "glob", ".", "glob", "(", "glob_rgb", ")", ")", "\n", "paths_gt", "=", "[", "None", "]", "*", "len", "(", "paths_rgb", ")", "\n", "if", "split", "==", "\"test_prediction\"", ":", "\n", "            ", "paths_d", "=", "[", "None", "]", "*", "len", "(", "\n", "paths_rgb", ")", "# test_prediction has no sparse depth", "\n", "", "else", ":", "\n", "            ", "paths_d", "=", "sorted", "(", "glob", ".", "glob", "(", "glob_d", ")", ")", "\n", "\n", "", "", "if", "len", "(", "paths_d", ")", "==", "0", "and", "len", "(", "paths_rgb", ")", "==", "0", "and", "len", "(", "paths_gt", ")", "==", "0", ":", "\n", "        ", "raise", "(", "RuntimeError", "(", "\"Found 0 images under {}\"", ".", "format", "(", "glob_gt", ")", ")", ")", "\n", "", "if", "len", "(", "paths_d", ")", "==", "0", "and", "args", ".", "use_d", ":", "\n", "        ", "raise", "(", "RuntimeError", "(", "\"Requested sparse depth but none was found\"", ")", ")", "\n", "", "if", "len", "(", "paths_rgb", ")", "==", "0", "and", "args", ".", "use_rgb", ":", "\n", "        ", "raise", "(", "RuntimeError", "(", "\"Requested rgb images but none was found\"", ")", ")", "\n", "", "if", "len", "(", "paths_rgb", ")", "==", "0", "and", "args", ".", "use_g", ":", "\n", "        ", "raise", "(", "RuntimeError", "(", "\"Requested gray images but no rgb was found\"", ")", ")", "\n", "", "if", "len", "(", "paths_rgb", ")", "!=", "len", "(", "paths_d", ")", "or", "len", "(", "paths_rgb", ")", "!=", "len", "(", "paths_gt", ")", ":", "\n", "        ", "raise", "(", "RuntimeError", "(", "\"Produced different sizes for datasets\"", ")", ")", "\n", "\n", "", "paths", "=", "{", "\"rgb\"", ":", "paths_rgb", ",", "\"d\"", ":", "paths_d", ",", "\"gt\"", ":", "paths_gt", "}", "\n", "return", "paths", ",", "transform", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.rgb_read": [[139, 146], ["os.path.exists", "os.path.exists", "PIL.Image.open", "numpy.array", "Image.open.close"], "function", ["None"], ["", "def", "rgb_read", "(", "filename", ")", ":", "\n", "    ", "assert", "os", ".", "path", ".", "exists", "(", "filename", ")", ",", "\"file not found: {}\"", ".", "format", "(", "filename", ")", "\n", "img_file", "=", "Image", ".", "open", "(", "filename", ")", "\n", "# rgb_png = np.array(img_file, dtype=float) / 255.0 # scale pixels to the range [0,1]", "\n", "rgb_png", "=", "np", ".", "array", "(", "img_file", ",", "dtype", "=", "'uint8'", ")", "# in the range [0,255]", "\n", "img_file", ".", "close", "(", ")", "\n", "return", "rgb_png", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.depth_read": [[148, 164], ["os.path.exists", "os.path.exists", "PIL.Image.open", "numpy.array", "Image.open.close", "numpy.expand_dims", "numpy.max", "numpy.max", "np.array.astype"], "function", ["None"], ["", "def", "depth_read", "(", "filename", ")", ":", "\n", "# loads depth map D from png file", "\n", "# and returns it as a numpy array,", "\n", "# for details see readme.txt", "\n", "    ", "assert", "os", ".", "path", ".", "exists", "(", "filename", ")", ",", "\"file not found: {}\"", ".", "format", "(", "filename", ")", "\n", "img_file", "=", "Image", ".", "open", "(", "filename", ")", "\n", "depth_png", "=", "np", ".", "array", "(", "img_file", ",", "dtype", "=", "int", ")", "\n", "img_file", ".", "close", "(", ")", "\n", "# make sure we have a proper 16bit depth map here.. not 8bit!", "\n", "assert", "np", ".", "max", "(", "depth_png", ")", ">", "255", ",", "\"np.max(depth_png)={}, path={}\"", ".", "format", "(", "np", ".", "max", "(", "depth_png", ")", ",", "filename", ")", "\n", "\n", "depth", "=", "depth_png", ".", "astype", "(", "np", ".", "float", ")", "/", "256.", "\n", "# depth[depth_png == 0] = -1.", "\n", "depth", "=", "np", ".", "expand_dims", "(", "depth", ",", "-", "1", ")", "\n", "return", "depth", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.drop_depth_measurements": [[169, 173], ["numpy.random.binomial"], "function", ["None"], ["def", "drop_depth_measurements", "(", "depth", ",", "prob_keep", ")", ":", "\n", "    ", "mask", "=", "np", ".", "random", ".", "binomial", "(", "1", ",", "prob_keep", ",", "depth", ".", "shape", ")", "\n", "depth", "*=", "mask", "\n", "return", "depth", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.train_transform": [[175, 205], ["dataloaders.transforms.Compose", "transforms.Compose.", "numpy.random.uniform", "transforms.Compose.", "numpy.random.uniform", "numpy.random.uniform", "numpy.random.uniform", "dataloaders.transforms.Compose", "transforms.Compose.", "dataloaders.transforms.BottomCrop", "dataloaders.transforms.HorizontalFlip", "max", "max", "max", "transforms.Compose.", "dataloaders.transforms.ColorJitter"], "function", ["None"], ["", "def", "train_transform", "(", "rgb", ",", "sparse", ",", "target", ",", "rgb_near", ",", "args", ")", ":", "\n", "# s = np.random.uniform(1.0, 1.5) # random scaling", "\n", "# angle = np.random.uniform(-5.0, 5.0) # random rotation degrees", "\n", "    ", "do_flip", "=", "np", ".", "random", ".", "uniform", "(", "0.0", ",", "1.0", ")", "<", "0.5", "# random horizontal flip", "\n", "\n", "transform_geometric", "=", "transforms", ".", "Compose", "(", "[", "\n", "# transforms.Rotate(angle),", "\n", "# transforms.Resize(s),", "\n", "transforms", ".", "BottomCrop", "(", "(", "oheight", ",", "owidth", ")", ")", ",", "\n", "transforms", ".", "HorizontalFlip", "(", "do_flip", ")", "\n", "]", ")", "\n", "if", "sparse", "is", "not", "None", ":", "\n", "        ", "sparse", "=", "transform_geometric", "(", "sparse", ")", "\n", "", "target", "=", "transform_geometric", "(", "target", ")", "\n", "if", "rgb", "is", "not", "None", ":", "\n", "        ", "brightness", "=", "np", ".", "random", ".", "uniform", "(", "max", "(", "0", ",", "1", "-", "args", ".", "jitter", ")", ",", "\n", "1", "+", "args", ".", "jitter", ")", "\n", "contrast", "=", "np", ".", "random", ".", "uniform", "(", "max", "(", "0", ",", "1", "-", "args", ".", "jitter", ")", ",", "1", "+", "args", ".", "jitter", ")", "\n", "saturation", "=", "np", ".", "random", ".", "uniform", "(", "max", "(", "0", ",", "1", "-", "args", ".", "jitter", ")", ",", "\n", "1", "+", "args", ".", "jitter", ")", "\n", "transform_rgb", "=", "transforms", ".", "Compose", "(", "[", "\n", "transforms", ".", "ColorJitter", "(", "brightness", ",", "contrast", ",", "saturation", ",", "0", ")", ",", "\n", "transform_geometric", "\n", "]", ")", "\n", "rgb", "=", "transform_rgb", "(", "rgb", ")", "\n", "if", "rgb_near", "is", "not", "None", ":", "\n", "            ", "rgb_near", "=", "transform_rgb", "(", "rgb_near", ")", "\n", "# sparse = drop_depth_measurements(sparse, 0.9)", "\n", "\n", "", "", "return", "rgb", ",", "sparse", ",", "target", ",", "rgb_near", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.val_transform": [[207, 220], ["dataloaders.transforms.Compose", "transforms.Compose.", "transforms.Compose.", "transforms.Compose.", "transforms.Compose.", "dataloaders.transforms.BottomCrop"], "function", ["None"], ["", "def", "val_transform", "(", "rgb", ",", "sparse", ",", "target", ",", "rgb_near", ",", "args", ")", ":", "\n", "    ", "transform", "=", "transforms", ".", "Compose", "(", "[", "\n", "transforms", ".", "BottomCrop", "(", "(", "oheight", ",", "owidth", ")", ")", ",", "\n", "]", ")", "\n", "if", "rgb", "is", "not", "None", ":", "\n", "        ", "rgb", "=", "transform", "(", "rgb", ")", "\n", "", "if", "sparse", "is", "not", "None", ":", "\n", "        ", "sparse", "=", "transform", "(", "sparse", ")", "\n", "", "if", "target", "is", "not", "None", ":", "\n", "        ", "target", "=", "transform", "(", "target", ")", "\n", "", "if", "rgb_near", "is", "not", "None", ":", "\n", "        ", "rgb_near", "=", "transform", "(", "rgb_near", ")", "\n", "", "return", "rgb", ",", "sparse", ",", "target", ",", "rgb_near", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.no_transform": [[222, 224], ["None"], "function", ["None"], ["", "def", "no_transform", "(", "rgb", ",", "sparse", ",", "target", ",", "rgb_near", ",", "args", ")", ":", "\n", "    ", "return", "rgb", ",", "sparse", ",", "target", ",", "rgb_near", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.handle_gray": [[230, 243], ["numpy.array", "numpy.expand_dims", "PIL.Image.fromarray().convert", "PIL.Image.fromarray"], "function", ["None"], ["def", "handle_gray", "(", "rgb", ",", "args", ")", ":", "\n", "    ", "if", "rgb", "is", "None", ":", "\n", "        ", "return", "None", ",", "None", "\n", "", "if", "not", "args", ".", "use_g", ":", "\n", "        ", "return", "rgb", ",", "None", "\n", "", "else", ":", "\n", "        ", "img", "=", "np", ".", "array", "(", "Image", ".", "fromarray", "(", "rgb", ")", ".", "convert", "(", "'L'", ")", ")", "\n", "img", "=", "np", ".", "expand_dims", "(", "img", ",", "-", "1", ")", "\n", "if", "not", "args", ".", "use_rgb", ":", "\n", "            ", "rgb_ret", "=", "None", "\n", "", "else", ":", "\n", "            ", "rgb_ret", "=", "rgb", "\n", "", "return", "rgb_ret", ",", "img", "\n", "\n"]], "home.repos.pwc.inspect_result.fangchangma_self-supervised-depth-completion.dataloaders.kitti_loader.get_rgb_near": [[245, 276], ["kitti_loader.get_rgb_near.extract_frame_id"], "function", ["None"], ["", "", "def", "get_rgb_near", "(", "path", ",", "args", ")", ":", "\n", "    ", "assert", "path", "is", "not", "None", ",", "\"path is None\"", "\n", "\n", "def", "extract_frame_id", "(", "filename", ")", ":", "\n", "        ", "head", ",", "tail", "=", "os", ".", "path", ".", "split", "(", "filename", ")", "\n", "number_string", "=", "tail", "[", "0", ":", "tail", ".", "find", "(", "'.'", ")", "]", "\n", "number", "=", "int", "(", "number_string", ")", "\n", "return", "head", ",", "number", "\n", "\n", "", "def", "get_nearby_filename", "(", "filename", ",", "new_id", ")", ":", "\n", "        ", "head", ",", "_", "=", "os", ".", "path", ".", "split", "(", "filename", ")", "\n", "new_filename", "=", "os", ".", "path", ".", "join", "(", "head", ",", "'%010d.png'", "%", "new_id", ")", "\n", "return", "new_filename", "\n", "\n", "", "head", ",", "number", "=", "extract_frame_id", "(", "path", ")", "\n", "count", "=", "0", "\n", "max_frame_diff", "=", "3", "\n", "candidates", "=", "[", "\n", "i", "-", "max_frame_diff", "for", "i", "in", "range", "(", "max_frame_diff", "*", "2", "+", "1", ")", "\n", "if", "i", "-", "max_frame_diff", "!=", "0", "\n", "]", "\n", "while", "True", ":", "\n", "        ", "random_offset", "=", "choice", "(", "candidates", ")", "\n", "path_near", "=", "get_nearby_filename", "(", "path", ",", "number", "+", "random_offset", ")", "\n", "if", "os", ".", "path", ".", "exists", "(", "path_near", ")", ":", "\n", "            ", "break", "\n", "", "assert", "count", "<", "20", ",", "\"cannot find a nearby frame in 20 trials for {}\"", ".", "format", "(", "\n", "path", ")", "\n", "count", "+=", "1", "\n", "\n", "", "return", "rgb_read", "(", "path_near", ")", "\n", "\n"]]}