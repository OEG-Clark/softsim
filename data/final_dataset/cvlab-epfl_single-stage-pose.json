{"home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.train.quaternion2rotation": [[19, 53], ["torch.stack().view", "torch.stack().view", "torch.stack().view", "torch.stack().view", "quat.norm().view", "torch.stack", "torch.stack", "torch.stack", "torch.stack", "quat.norm"], "function", ["None"], ["def", "quaternion2rotation", "(", "quat", ")", ":", "\n", "    ", "assert", "(", "quat", ".", "shape", "[", "1", "]", "==", "4", ")", "\n", "# normalize first", "\n", "quat", "=", "quat", "/", "quat", ".", "norm", "(", "p", "=", "2", ",", "dim", "=", "1", ")", ".", "view", "(", "-", "1", ",", "1", ")", "\n", "\n", "a", "=", "quat", "[", ":", ",", "0", "]", "\n", "b", "=", "quat", "[", ":", ",", "1", "]", "\n", "c", "=", "quat", "[", ":", ",", "2", "]", "\n", "d", "=", "quat", "[", ":", ",", "3", "]", "\n", "\n", "a2", "=", "a", "*", "a", "\n", "b2", "=", "b", "*", "b", "\n", "c2", "=", "c", "*", "c", "\n", "d2", "=", "d", "*", "d", "\n", "ab", "=", "a", "*", "b", "\n", "ac", "=", "a", "*", "c", "\n", "ad", "=", "a", "*", "d", "\n", "bc", "=", "b", "*", "c", "\n", "bd", "=", "b", "*", "d", "\n", "cd", "=", "c", "*", "d", "\n", "\n", "# s = a2 + b2 + c2 + d2", "\n", "\n", "m0", "=", "a2", "+", "b2", "-", "c2", "-", "d2", "\n", "m1", "=", "2", "*", "(", "bc", "-", "ad", ")", "\n", "m2", "=", "2", "*", "(", "bd", "+", "ac", ")", "\n", "m3", "=", "2", "*", "(", "bc", "+", "ad", ")", "\n", "m4", "=", "a2", "-", "b2", "+", "c2", "-", "d2", "\n", "m5", "=", "2", "*", "(", "cd", "-", "ab", ")", "\n", "m6", "=", "2", "*", "(", "bd", "-", "ac", ")", "\n", "m7", "=", "2", "*", "(", "cd", "+", "ab", ")", "\n", "m8", "=", "a2", "-", "b2", "-", "c2", "+", "d2", "\n", "\n", "return", "torch", ".", "stack", "(", "(", "m0", ",", "m1", ",", "m2", ",", "m3", ",", "m4", ",", "m5", ",", "m6", ",", "m7", ",", "m8", ")", ",", "dim", "=", "1", ")", ".", "view", "(", "-", "1", ",", "3", ",", "3", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.train.compute_loss": [[54, 68], ["dataset.quaternion2rotation", "dataset.quaternion2rotation", "diff.mean", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "t1.unsqueeze", "torch.bmm", "torch.bmm", "torch.bmm", "torch.bmm", "t2.unsqueeze", "pt_3d.transpose", "pt_3d.transpose"], "function", ["home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.quaternion2rotation", "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.quaternion2rotation"], ["", "def", "compute_loss", "(", "pt_3d", ",", "predQ", ",", "predT", ",", "gtQ", ",", "gtT", ")", ":", "\n", "    ", "q1", "=", "predQ", "\n", "t1", "=", "predT", "\n", "q2", "=", "gtQ", "\n", "t2", "=", "gtT", "\n", "r1", "=", "quaternion2rotation", "(", "q1", ")", "\n", "r2", "=", "quaternion2rotation", "(", "q2", ")", "\n", "# ", "\n", "# compute error in 3D", "\n", "res1", "=", "torch", ".", "bmm", "(", "r1", ",", "pt_3d", ".", "transpose", "(", "1", ",", "2", ")", ")", "+", "t1", ".", "unsqueeze", "(", "dim", "=", "2", ")", "\n", "res2", "=", "torch", ".", "bmm", "(", "r2", ",", "pt_3d", ".", "transpose", "(", "1", ",", "2", ")", ")", "+", "t2", ".", "unsqueeze", "(", "dim", "=", "2", ")", "\n", "\n", "diff", "=", "(", "res1", "-", "res2", ")", ".", "norm", "(", "dim", "=", "1", ")", ".", "mean", "(", "dim", "=", "1", ")", "\n", "return", "diff", ".", "mean", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.train.train": [[69, 159], ["tensorboardX.SummaryWriter", "print", "model.SimplePnPNet", "model.cuda.cuda", "torch.Adam", "torch.MultiStepLR", "dataset.PnP_Data_Simulator", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.utils.data.DataLoader", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "torch.FloatTensor", "model.cuda.train", "range", "model.cuda.parameters", "enumerate", "torch.save", "torch.save", "torch.save", "torch.save", "lr_scheduler.MultiStepLR.step", "intrinsic.cuda.cuda", "quat.cuda.cuda", "trans.cuda.cuda", "sxy.cuda.cuda", "dxy.cuda.cuda", "p3d.cuda.cuda", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "inData.transpose.transpose", "model.cuda.", "torch.FloatTensor.type_as().view", "torch.FloatTensor.type_as().view", "loss.backward", "optim.Adam.step", "optim.Adam.zero_grad", "tensorboardX.SummaryWriter.add_scalar", "model.cuda.state_dict", "round", "train.compute_loss", "print", "torch.FloatTensor.type_as", "torch.FloatTensor.type_as", "len", "len", "lr_scheduler.MultiStepLR.get_lr"], "function", ["home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.train.train", "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.train.compute_loss"], ["", "def", "train", "(", ")", ":", "\n", "    ", "os", ".", "environ", "[", "'CUDA_VISIBLE_DEVICES'", "]", "=", "'0'", "\n", "\n", "tag", "=", "'xydxdy'", "\n", "\n", "logger", "=", "SummaryWriter", "(", "'logs_'", "+", "tag", ")", "\n", "\n", "print", "(", "'start training ...'", ")", "\n", "model", "=", "SimplePnPNet", "(", "nIn", "=", "4", ")", "\n", "model", "=", "model", ".", "cuda", "(", ")", "\n", "\n", "desired_epoch", "=", "200", "\n", "batch_size", "=", "32", "\n", "learning_rate", "=", "1e-4", "\n", "alpha", "=", "1", "\n", "# optimizer = optim.SGD(model.parameters(), lr=learning_rate, momentum=0.9, weight_decay=0.0005)", "\n", "optimizer", "=", "optim", ".", "Adam", "(", "model", ".", "parameters", "(", ")", ",", "lr", "=", "learning_rate", ")", "\n", "\n", "scheduler", "=", "lr_scheduler", ".", "MultiStepLR", "(", "optimizer", ",", "milestones", "=", "[", "round", "(", "desired_epoch", "*", "x", ")", "for", "x", "in", "[", "0.5", ",", "0.8", ",", "0.9", "]", "]", ",", "gamma", "=", "0.1", ")", "\n", "# ", "\n", "dataset", "=", "PnP_Data_Simulator", "(", "sampleCnt", "=", "20000", ",", "minNoiseSigma", "=", "0", ",", "maxNoiseSigma", "=", "15", ",", "minOutlier", "=", "0", ",", "maxOutlier", "=", "0.3", ")", "\n", "data_loader", "=", "torch", ".", "utils", ".", "data", ".", "DataLoader", "(", "dataset", ",", "shuffle", "=", "True", ",", "batch_size", "=", "batch_size", ",", "num_workers", "=", "4", ")", "\n", "# ", "\n", "translation_min", "=", "torch", ".", "FloatTensor", "(", "dataset", ".", "translation_min", ")", "\n", "translation_max", "=", "torch", ".", "FloatTensor", "(", "dataset", ".", "translation_max", ")", "\n", "# ", "\n", "model", ".", "train", "(", ")", "\n", "for", "epoch", "in", "range", "(", "desired_epoch", ")", ":", "\n", "# Update scheduler", "\n", "        ", "if", "epoch", ">", "0", ":", "\n", "            ", "scheduler", ".", "step", "(", ")", "\n", "", "for", "batch_idx", ",", "batch_data", "in", "enumerate", "(", "data_loader", ")", ":", "\n", "            ", "intrinsic", ",", "quat", ",", "trans", ",", "sxy", ",", "dxy", ",", "p3d", "=", "batch_data", "\n", "intrinsic", "=", "intrinsic", ".", "cuda", "(", ")", "\n", "quat", "=", "quat", ".", "cuda", "(", ")", "\n", "trans", "=", "trans", ".", "cuda", "(", ")", "\n", "sxy", "=", "sxy", ".", "cuda", "(", ")", "\n", "dxy", "=", "dxy", ".", "cuda", "(", ")", "\n", "p3d", "=", "p3d", ".", "cuda", "(", ")", "\n", "\n", "# normalize according to width and height", "\n", "# xy = sxy+dxy", "\n", "# normalize xy to [-0.5, 0.5]", "\n", "xy", "=", "sxy", "\n", "xy", "[", "...", ",", "0", "]", "=", "xy", "[", "...", ",", "0", "]", "-", "(", "dataset", ".", "width", "/", "2", ")", "\n", "xy", "[", "...", ",", "0", "]", "=", "xy", "[", "...", ",", "0", "]", "/", "dataset", ".", "width", "\n", "xy", "[", "...", ",", "1", "]", "=", "xy", "[", "...", ",", "1", "]", "-", "(", "dataset", ".", "height", "/", "2", ")", "\n", "xy", "[", "...", ",", "1", "]", "=", "xy", "[", "...", ",", "1", "]", "/", "dataset", ".", "height", "\n", "\n", "# normalize dxdy to [-0.5, 0.5]", "\n", "# dxy = dxy / ( 2* dxy.norm(dim=-1).unsqueeze(-1))", "\n", "dxy", "[", "...", ",", "0", "]", "=", "dxy", "[", "...", ",", "0", "]", "/", "dataset", ".", "width", "\n", "dxy", "[", "...", ",", "1", "]", "=", "dxy", "[", "...", ",", "1", "]", "/", "dataset", ".", "height", "\n", "# ", "\n", "# theta = torch.atan2(dxy[..., 1], dxy[..., 0])", "\n", "# theta = theta.unsqueeze(-1) / math.pi", "\n", "# inData = torch.cat((xy, theta), dim=-1)", "\n", "\n", "inData", "=", "torch", ".", "cat", "(", "(", "xy", ",", "dxy", ")", ",", "dim", "=", "-", "1", ")", "\n", "# inData = torch.cat((p3d.repeat(1,dataset.gridCnt,1), inData), dim=-1)", "\n", "# ", "\n", "inData", "=", "inData", ".", "transpose", "(", "1", ",", "2", ")", "\n", "\n", "# inData = expandFeatures(inData,deg=2)", "\n", "# target = torch.cat((gt_q,gt_t), dim=1)", "\n", "# predQ = model(inData)", "\n", "# loss = compute_loss(pt_3d, predQ, gt_t, gt_q, gt_t)", "\n", "# predT = model(inData)", "\n", "# loss = compute_loss(pt_3d, gt_q, predT, gt_q, gt_t)", "\n", "out", "=", "model", "(", "inData", ")", "\n", "predQ", "=", "out", "[", ":", ",", ":", "4", "]", "\n", "predT", "=", "out", "[", ":", ",", "4", ":", "]", "\n", "\n", "# recover predicted translation", "\n", "minT", "=", "translation_min", ".", "type_as", "(", "out", ")", ".", "view", "(", "-", "1", ",", "3", ")", "\n", "maxT", "=", "translation_max", ".", "type_as", "(", "out", ")", ".", "view", "(", "-", "1", ",", "3", ")", "\n", "predT", "=", "(", "predT", "+", "0.5", ")", "*", "(", "maxT", "-", "minT", ")", "+", "minT", "\n", "\n", "loss", "=", "alpha", "*", "compute_loss", "(", "p3d", ",", "predQ", ",", "predT", ",", "quat", ",", "trans", ")", "\n", "\n", "loss", ".", "backward", "(", ")", "\n", "optimizer", ".", "step", "(", ")", "\n", "optimizer", ".", "zero_grad", "(", ")", "\n", "\n", "logger", ".", "add_scalar", "(", "'loss'", ",", "loss", ",", "epoch", "*", "len", "(", "data_loader", ")", "+", "batch_idx", ")", "\n", "\n", "if", "batch_idx", "%", "10", "==", "0", ":", "\n", "                ", "print", "(", "'epoch %d/%d, batch %d/%d, lr %f, %f'", "%", "(", "epoch", ",", "desired_epoch", ",", "batch_idx", ",", "len", "(", "data_loader", ")", ",", "scheduler", ".", "get_lr", "(", ")", "[", "0", "]", ",", "loss", ")", ")", "\n", "# ", "\n", "", "", "torch", ".", "save", "(", "model", ".", "state_dict", "(", ")", ",", "tag", "+", "'.pth'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.PnP_Data_Simulator.__init__": [[70, 88], ["torch.from_numpy().float", "dataset.PnP_Data_Simulator.point_3d.view", "torch.from_numpy().float", "torch.from_numpy", "numpy.array", "torch.from_numpy", "numpy.array"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "sampleCnt", "=", "20000", ",", "gridCnt", "=", "200", ",", "minNoiseSigma", "=", "0", ",", "maxNoiseSigma", "=", "0", ",", "minOutlier", "=", "0", ",", "maxOutlier", "=", "0", ")", ":", "\n", "        ", "self", ".", "width", "=", "640", "\n", "self", ".", "height", "=", "480", "\n", "self", ".", "intrinsic", "=", "torch", ".", "from_numpy", "(", "np", ".", "array", "(", "[", "[", "800", ",", "0", ",", "self", ".", "width", "/", "2", "]", ",", "\n", "[", "0", ",", "800", ",", "self", ".", "height", "/", "2", "]", ",", "\n", "[", "0", ",", "0", ",", "1", "]", "]", ")", ")", ".", "float", "(", ")", "\n", "self", ".", "point_3d", "=", "0.5", "*", "torch", ".", "from_numpy", "(", "np", ".", "array", "(", "[", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "-", "1", ",", "1", ",", "-", "1", ",", "1", ",", "1", ",", "-", "1", ",", "-", "1", ",", "-", "1", ",", "1", ",", "1", ",", "-", "1", ",", "1", ",", "-", "1", ",", "-", "1", ",", "-", "1", ",", "1", ",", "-", "1", ",", "-", "1", ",", "-", "1", "]", ")", ")", ".", "float", "(", ")", "\n", "self", ".", "point_3d", "=", "self", ".", "point_3d", ".", "view", "(", "-", "1", ",", "3", ")", "\n", "\n", "self", ".", "gridCnt", "=", "gridCnt", "\n", "self", ".", "minNoiseSigma", "=", "minNoiseSigma", "\n", "self", ".", "maxNoiseSigma", "=", "maxNoiseSigma", "\n", "self", ".", "minOutlier", "=", "minOutlier", "\n", "self", ".", "maxOutlier", "=", "maxOutlier", "\n", "self", ".", "sampleCnt", "=", "sampleCnt", "\n", "# ", "\n", "self", ".", "translation_min", "=", "[", "-", "2", ",", "-", "2", ",", "4", "]", "\n", "self", ".", "translation_max", "=", "[", "2", ",", "2", ",", "8", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.PnP_Data_Simulator.__len__": [[89, 91], ["None"], "methods", ["None"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "sampleCnt", "\n", "\n"]], "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.PnP_Data_Simulator.__getitem__": [[92, 133], ["dataset.PnP_Data_Simulator.RandomRotation", "torch.from_numpy().float", "torch.from_numpy().float", "torch.from_numpy().float", "numpy.random.randint", "numpy.random.randint", "torch.from_numpy().float", "torch.from_numpy().float", "torch.mm", "torch.cat", "torch.cat", "numpy.random.uniform", "int", "numpy.random.choice", "torch.from_numpy().float", "torch.from_numpy().float", "torch.from_numpy().float", "torch.from_numpy().float", "numpy.random.uniform", "numpy.random.normal().astype", "len", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.mm", "torch.from_numpy().float.view", "torch.from_numpy().float.view", "torch.from_numpy().float.view", "dx.view", "dy.view", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "numpy.random.normal", "dataset.rotation2quaternion", "dataset.PnP_Data_Simulator.RandomTranslation", "torch.from_numpy().float.reshape().repeat", "torch.from_numpy().float.reshape().repeat", "dataset.PnP_Data_Simulator.point_3d.t", "len", "numpy.random.uniform", "numpy.random.uniform", "numpy.random.uniform", "numpy.random.uniform", "len", "len", "len", "torch.from_numpy().float.reshape", "torch.from_numpy().float.reshape"], "methods", ["home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.PnP_Data_Simulator.RandomRotation", "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.rotation2quaternion", "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.PnP_Data_Simulator.RandomTranslation"], ["", "def", "__getitem__", "(", "self", ",", "index", ")", ":", "\n", "        ", "gt_r", "=", "self", ".", "RandomRotation", "(", ")", "\n", "gt_q", "=", "torch", ".", "from_numpy", "(", "rotation2quaternion", "(", "gt_r", ")", ")", ".", "float", "(", ")", "\n", "gt_r", "=", "torch", ".", "from_numpy", "(", "gt_r", ")", ".", "float", "(", ")", "\n", "gt_t", "=", "torch", ".", "from_numpy", "(", "self", ".", "RandomTranslation", "(", ")", ")", ".", "float", "(", ")", "\n", "\n", "# ", "\n", "# select grids randomly within the image plane", "\n", "sy", "=", "np", ".", "random", ".", "randint", "(", "self", ".", "height", ",", "size", "=", "self", ".", "gridCnt", ")", "\n", "sx", "=", "np", ".", "random", ".", "randint", "(", "self", ".", "width", ",", "size", "=", "self", ".", "gridCnt", ")", "\n", "sy", "=", "torch", ".", "from_numpy", "(", "sy", ".", "reshape", "(", "-", "1", ",", "1", ")", ".", "repeat", "(", "len", "(", "self", ".", "point_3d", ")", ",", "axis", "=", "1", ")", ")", ".", "float", "(", ")", "\n", "sx", "=", "torch", ".", "from_numpy", "(", "sx", ".", "reshape", "(", "-", "1", ",", "1", ")", ".", "repeat", "(", "len", "(", "self", ".", "point_3d", ")", ",", "axis", "=", "1", ")", ")", ".", "float", "(", ")", "\n", "# ", "\n", "# 2d reprojection", "\n", "p", "=", "torch", ".", "mm", "(", "self", ".", "intrinsic", ",", "torch", ".", "mm", "(", "gt_r", ",", "self", ".", "point_3d", ".", "t", "(", ")", ")", "+", "gt_t", ".", "view", "(", "-", "1", ",", "1", ")", ")", "\n", "tx", "=", "(", "p", "[", "0", "]", "/", "p", "[", "2", "]", ")", ".", "view", "(", "1", ",", "-", "1", ")", "\n", "ty", "=", "(", "p", "[", "1", "]", "/", "p", "[", "2", "]", ")", ".", "view", "(", "1", ",", "-", "1", ")", "\n", "dx", "=", "tx", "-", "sx", "\n", "dy", "=", "ty", "-", "sy", "\n", "\n", "sxy", "=", "torch", ".", "cat", "(", "(", "sx", ".", "view", "(", "-", "1", ",", "1", ")", ",", "sy", ".", "view", "(", "-", "1", ",", "1", ")", ")", ",", "1", ")", "\n", "dxy", "=", "torch", ".", "cat", "(", "(", "dx", ".", "view", "(", "-", "1", ",", "1", ")", ",", "dy", ".", "view", "(", "-", "1", ",", "1", ")", ")", ",", "1", ")", "\n", "\n", "# add outlier", "\n", "outlierRatio", "=", "np", ".", "random", ".", "uniform", "(", "self", ".", "minOutlier", ",", "self", ".", "maxOutlier", ")", "\n", "outlierCnt", "=", "int", "(", "len", "(", "dxy", ")", "*", "outlierRatio", "+", "0.5", ")", "\n", "outlierChoice", "=", "np", ".", "random", ".", "choice", "(", "len", "(", "dxy", ")", ",", "outlierCnt", ",", "replace", "=", "False", ")", "\n", "\n", "sxy", "[", "outlierChoice", ",", "0", "]", "=", "torch", ".", "from_numpy", "(", "np", ".", "random", ".", "uniform", "(", "0", ",", "self", ".", "width", "-", "1", ",", "size", "=", "outlierCnt", ")", ")", ".", "float", "(", ")", "\n", "sxy", "[", "outlierChoice", ",", "1", "]", "=", "torch", ".", "from_numpy", "(", "np", ".", "random", ".", "uniform", "(", "0", ",", "self", ".", "height", "-", "1", ",", "size", "=", "outlierCnt", ")", ")", ".", "float", "(", ")", "\n", "# ", "\n", "dxy", "[", "outlierChoice", ",", "0", "]", "=", "torch", ".", "from_numpy", "(", "np", ".", "random", ".", "uniform", "(", "0", ",", "self", ".", "width", "-", "1", ",", "size", "=", "outlierCnt", ")", ")", ".", "float", "(", ")", "\n", "dxy", "[", "outlierChoice", ",", "1", "]", "=", "torch", ".", "from_numpy", "(", "np", ".", "random", ".", "uniform", "(", "0", ",", "self", ".", "height", "-", "1", ",", "size", "=", "outlierCnt", ")", ")", ".", "float", "(", ")", "\n", "\n", "# add noise to 2d", "\n", "noiseSigma", "=", "np", ".", "random", ".", "uniform", "(", "self", ".", "minNoiseSigma", ",", "self", ".", "maxNoiseSigma", ")", "\n", "noise", "=", "np", ".", "random", ".", "normal", "(", "0", ",", "noiseSigma", ",", "(", "len", "(", "dxy", ")", ",", "2", ")", ")", ".", "astype", "(", "np", ".", "float32", ")", "\n", "# ", "\n", "dxy", "=", "dxy", "+", "torch", ".", "from_numpy", "(", "noise", ")", "\n", "\n", "return", "self", ".", "intrinsic", ",", "gt_q", ",", "gt_t", ",", "sxy", ",", "dxy", ",", "self", ".", "point_3d", "\n", "\n"]], "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.PnP_Data_Simulator.Rand": [[134, 136], ["random.random"], "methods", ["None"], ["", "def", "Rand", "(", "self", ",", "min", ",", "max", ")", ":", "\n", "        ", "return", "min", "+", "(", "max", "-", "min", ")", "*", "random", ".", "random", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.PnP_Data_Simulator.RandomRotation": [[137, 165], ["dataset.PnP_Data_Simulator.Rand", "dataset.PnP_Data_Simulator.Rand", "dataset.PnP_Data_Simulator.Rand", "R0.append", "R0.append", "R0.append", "R1.append", "R1.append", "R1.append", "R2.append", "R2.append", "R2.append", "R.append", "R.append", "R.append", "numpy.array", "math.cos", "math.sin", "math.sin", "math.cos", "math.sin", "math.sin", "math.sin", "math.cos", "math.cos", "math.cos", "math.sin", "math.cos", "math.sin", "math.sin", "math.cos", "math.cos", "math.sin", "math.cos", "math.sin", "math.cos", "math.sin", "math.cos", "math.cos", "math.sin", "math.cos", "math.sin", "math.sin", "math.cos", "math.cos"], "methods", ["home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.PnP_Data_Simulator.Rand", "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.PnP_Data_Simulator.Rand", "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.PnP_Data_Simulator.Rand"], ["", "def", "RandomRotation", "(", "self", ")", ":", "\n", "        ", "range", "=", "1", "\n", "\n", "# use eular formulation, three different rotation angles on 3 axis", "\n", "phi", "=", "self", ".", "Rand", "(", "0", ",", "range", "*", "math", ".", "pi", "*", "2", ")", "\n", "theta", "=", "self", ".", "Rand", "(", "0", ",", "range", "*", "math", ".", "pi", ")", "\n", "psi", "=", "self", ".", "Rand", "(", "0", ",", "range", "*", "math", ".", "pi", "*", "2", ")", "\n", "\n", "R0", "=", "[", "]", "\n", "R0", ".", "append", "(", "math", ".", "cos", "(", "psi", ")", "*", "math", ".", "cos", "(", "phi", ")", "-", "math", ".", "cos", "(", "theta", ")", "*", "math", ".", "sin", "(", "phi", ")", "*", "math", ".", "sin", "(", "psi", ")", ")", "\n", "R0", ".", "append", "(", "math", ".", "cos", "(", "psi", ")", "*", "math", ".", "sin", "(", "phi", ")", "+", "math", ".", "cos", "(", "theta", ")", "*", "math", ".", "cos", "(", "phi", ")", "*", "math", ".", "sin", "(", "psi", ")", ")", "\n", "R0", ".", "append", "(", "math", ".", "sin", "(", "psi", ")", "*", "math", ".", "sin", "(", "theta", ")", ")", "\n", "\n", "R1", "=", "[", "]", "\n", "R1", ".", "append", "(", "-", "math", ".", "sin", "(", "psi", ")", "*", "math", ".", "cos", "(", "phi", ")", "-", "math", ".", "cos", "(", "theta", ")", "*", "math", ".", "sin", "(", "phi", ")", "*", "math", ".", "cos", "(", "psi", ")", ")", "\n", "R1", ".", "append", "(", "-", "math", ".", "sin", "(", "psi", ")", "*", "math", ".", "sin", "(", "phi", ")", "+", "math", ".", "cos", "(", "theta", ")", "*", "math", ".", "cos", "(", "phi", ")", "*", "math", ".", "cos", "(", "psi", ")", ")", "\n", "R1", ".", "append", "(", "math", ".", "cos", "(", "psi", ")", "*", "math", ".", "sin", "(", "theta", ")", ")", "\n", "\n", "R2", "=", "[", "]", "\n", "R2", ".", "append", "(", "math", ".", "sin", "(", "theta", ")", "*", "math", ".", "sin", "(", "phi", ")", ")", "\n", "R2", ".", "append", "(", "-", "math", ".", "sin", "(", "theta", ")", "*", "math", ".", "cos", "(", "phi", ")", ")", "\n", "R2", ".", "append", "(", "math", ".", "cos", "(", "theta", ")", ")", "\n", "\n", "R", "=", "[", "]", "\n", "R", ".", "append", "(", "R0", ")", "\n", "R", ".", "append", "(", "R1", ")", "\n", "R", ".", "append", "(", "R2", ")", "\n", "return", "np", ".", "array", "(", "R", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.PnP_Data_Simulator.RandomTranslation": [[166, 171], ["dataset.PnP_Data_Simulator.Rand", "dataset.PnP_Data_Simulator.Rand", "dataset.PnP_Data_Simulator.Rand", "numpy.array().reshape", "numpy.array"], "methods", ["home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.PnP_Data_Simulator.Rand", "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.PnP_Data_Simulator.Rand", "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.PnP_Data_Simulator.Rand"], ["", "def", "RandomTranslation", "(", "self", ")", ":", "\n", "        ", "tx", "=", "self", ".", "Rand", "(", "self", ".", "translation_min", "[", "0", "]", ",", "self", ".", "translation_max", "[", "0", "]", ")", "\n", "ty", "=", "self", ".", "Rand", "(", "self", ".", "translation_min", "[", "1", "]", ",", "self", ".", "translation_max", "[", "1", "]", ")", "\n", "tz", "=", "self", ".", "Rand", "(", "self", ".", "translation_min", "[", "2", "]", ",", "self", ".", "translation_max", "[", "2", "]", ")", "\n", "return", "np", ".", "array", "(", "[", "tx", ",", "ty", ",", "tz", "]", ")", ".", "reshape", "(", "-", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.rotation2quaternion": [[8, 37], ["numpy.trace", "M.reshape", "numpy.array().reshape", "numpy.sqrt", "numpy.array", "numpy.sqrt", "numpy.sqrt", "numpy.sqrt"], "function", ["None"], ["def", "rotation2quaternion", "(", "M", ")", ":", "\n", "    ", "tr", "=", "np", ".", "trace", "(", "M", ")", "\n", "m", "=", "M", ".", "reshape", "(", "-", "1", ")", "\n", "if", "tr", ">", "0", ":", "\n", "        ", "s", "=", "np", ".", "sqrt", "(", "tr", "+", "1.0", ")", "*", "2", "\n", "w", "=", "0.25", "*", "s", "\n", "x", "=", "(", "m", "[", "7", "]", "-", "m", "[", "5", "]", ")", "/", "s", "\n", "y", "=", "(", "m", "[", "2", "]", "-", "m", "[", "6", "]", ")", "/", "s", "\n", "z", "=", "(", "m", "[", "3", "]", "-", "m", "[", "1", "]", ")", "/", "s", "\n", "", "elif", "m", "[", "0", "]", ">", "m", "[", "4", "]", "and", "m", "[", "0", "]", ">", "m", "[", "8", "]", ":", "\n", "        ", "s", "=", "np", ".", "sqrt", "(", "1.0", "+", "m", "[", "0", "]", "-", "m", "[", "4", "]", "-", "m", "[", "8", "]", ")", "*", "2", "\n", "w", "=", "(", "m", "[", "7", "]", "-", "m", "[", "5", "]", ")", "/", "s", "\n", "x", "=", "0.25", "*", "s", "\n", "y", "=", "(", "m", "[", "1", "]", "+", "m", "[", "3", "]", ")", "/", "s", "\n", "z", "=", "(", "m", "[", "2", "]", "+", "m", "[", "6", "]", ")", "/", "s", "\n", "", "elif", "m", "[", "4", "]", ">", "m", "[", "8", "]", ":", "\n", "        ", "s", "=", "np", ".", "sqrt", "(", "1.0", "+", "m", "[", "4", "]", "-", "m", "[", "0", "]", "-", "m", "[", "8", "]", ")", "*", "2", "\n", "w", "=", "(", "m", "[", "2", "]", "-", "m", "[", "6", "]", ")", "/", "s", "\n", "x", "=", "(", "m", "[", "1", "]", "+", "m", "[", "3", "]", ")", "/", "s", "\n", "y", "=", "0.25", "*", "s", "\n", "z", "=", "(", "m", "[", "5", "]", "+", "m", "[", "7", "]", ")", "/", "s", "\n", "", "else", ":", "\n", "        ", "s", "=", "np", ".", "sqrt", "(", "1.0", "+", "m", "[", "8", "]", "-", "m", "[", "0", "]", "-", "m", "[", "4", "]", ")", "*", "2", "\n", "w", "=", "(", "m", "[", "3", "]", "-", "m", "[", "1", "]", ")", "/", "s", "\n", "x", "=", "(", "m", "[", "2", "]", "+", "m", "[", "6", "]", ")", "/", "s", "\n", "y", "=", "(", "m", "[", "5", "]", "+", "m", "[", "7", "]", ")", "/", "s", "\n", "z", "=", "0.25", "*", "s", "\n", "", "Q", "=", "np", ".", "array", "(", "[", "w", ",", "x", ",", "y", ",", "z", "]", ")", ".", "reshape", "(", "-", "1", ")", "\n", "return", "Q", "\n", "\n"]], "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.quaternion2rotation": [[38, 68], ["numpy.array().reshape", "len", "numpy.linalg.norm", "numpy.array"], "function", ["None"], ["", "def", "quaternion2rotation", "(", "quat", ")", ":", "\n", "    ", "assert", "(", "len", "(", "quat", ")", "==", "4", ")", "\n", "# normalize first", "\n", "quat", "=", "quat", "/", "np", ".", "linalg", ".", "norm", "(", "quat", ")", "\n", "a", ",", "b", ",", "c", ",", "d", "=", "quat", "\n", "\n", "a2", "=", "a", "*", "a", "\n", "b2", "=", "b", "*", "b", "\n", "c2", "=", "c", "*", "c", "\n", "d2", "=", "d", "*", "d", "\n", "ab", "=", "a", "*", "b", "\n", "ac", "=", "a", "*", "c", "\n", "ad", "=", "a", "*", "d", "\n", "bc", "=", "b", "*", "c", "\n", "bd", "=", "b", "*", "d", "\n", "cd", "=", "c", "*", "d", "\n", "\n", "# s = a2 + b2 + c2 + d2", "\n", "\n", "m0", "=", "a2", "+", "b2", "-", "c2", "-", "d2", "\n", "m1", "=", "2", "*", "(", "bc", "-", "ad", ")", "\n", "m2", "=", "2", "*", "(", "bd", "+", "ac", ")", "\n", "m3", "=", "2", "*", "(", "bc", "+", "ad", ")", "\n", "m4", "=", "a2", "-", "b2", "+", "c2", "-", "d2", "\n", "m5", "=", "2", "*", "(", "cd", "-", "ab", ")", "\n", "m6", "=", "2", "*", "(", "bd", "-", "ac", ")", "\n", "m7", "=", "2", "*", "(", "cd", "+", "ab", ")", "\n", "m8", "=", "a2", "-", "b2", "-", "c2", "+", "d2", "\n", "\n", "return", "np", ".", "array", "(", "[", "m0", ",", "m1", ",", "m2", ",", "m3", ",", "m4", ",", "m5", ",", "m6", ",", "m7", ",", "m8", "]", ")", ".", "reshape", "(", "3", ",", "3", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.test.pose_err_3d": [[12, 20], ["t.reshape.reshape", "gt.reshape.reshape", "numpy.linalg.norm", "np.linalg.norm.mean", "numpy.matmul", "numpy.matmul"], "function", ["None"], ["def", "pose_err_3d", "(", "kpts3d", ",", "r", ",", "t", ",", "gr", ",", "gt", ")", ":", "\n", "    ", "t", "=", "t", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "gt", "=", "gt", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "# error metric in 3D space", "\n", "res1", "=", "np", ".", "matmul", "(", "r", ",", "kpts3d", ".", "T", ")", "+", "t", "\n", "res2", "=", "np", ".", "matmul", "(", "gr", ",", "kpts3d", ".", "T", ")", "+", "gt", "\n", "diff", "=", "np", ".", "linalg", ".", "norm", "(", "res1", "-", "res2", ",", "axis", "=", "0", ")", "\n", "return", "diff", ".", "mean", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.test.pose_err_2d": [[21, 33], ["t.reshape.reshape", "gt.reshape.reshape", "numpy.matmul", "numpy.matmul", "numpy.sqrt", "np.sqrt.mean", "numpy.matmul", "numpy.matmul"], "function", ["None"], ["", "def", "pose_err_2d", "(", "kpts3d", ",", "r", ",", "t", ",", "gr", ",", "gt", ",", "K", ")", ":", "\n", "    ", "t", "=", "t", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "gt", "=", "gt", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "# error metric in 3D space", "\n", "res1", "=", "np", ".", "matmul", "(", "K", ",", "np", ".", "matmul", "(", "r", ",", "kpts3d", ".", "T", ")", "+", "t", ")", "\n", "x1", "=", "res1", "[", "0", "]", "/", "res1", "[", "2", "]", "\n", "y1", "=", "res1", "[", "1", "]", "/", "res1", "[", "2", "]", "\n", "res2", "=", "np", ".", "matmul", "(", "K", ",", "np", ".", "matmul", "(", "gr", ",", "kpts3d", ".", "T", ")", "+", "gt", ")", "\n", "x2", "=", "res2", "[", "0", "]", "/", "res2", "[", "2", "]", "\n", "y2", "=", "res2", "[", "1", "]", "/", "res2", "[", "2", "]", "\n", "diff", "=", "np", ".", "sqrt", "(", "(", "x1", "-", "x2", ")", "*", "(", "x1", "-", "x2", ")", "+", "(", "y1", "-", "y2", ")", "*", "(", "y1", "-", "y2", ")", ")", "\n", "return", "diff", ".", "mean", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.test.PnP_OpenCV_EPNP": [[34, 47], ["len", "cv2.solvePnPRansac", "trans.reshape", "print", "numpy.eye", "numpy.array().reshape", "cv2.Rodrigues", "numpy.array"], "function", ["None"], ["", "def", "PnP_OpenCV_EPNP", "(", "p3d", ",", "p2d", ",", "intrinsics", ")", ":", "\n", "    ", "ptCnt", "=", "len", "(", "p3d", ")", "\n", "retval", ",", "rot", ",", "trans", ",", "inliers", "=", "cv2", ".", "solvePnPRansac", "(", "p3d", ",", "p2d", ",", "intrinsics", ",", "None", ",", "flags", "=", "cv2", ".", "SOLVEPNP_EPNP", ")", "\n", "# retval, rot, trans, inliers = cv2.solvePnPRansac(p3d, p2d, intrinsics, None, flags=cv2.SOLVEPNP_P3P)", "\n", "\n", "if", "not", "retval", ":", "\n", "        ", "print", "(", "'PnP Failed'", ")", "\n", "R", "=", "np", ".", "eye", "(", "3", ")", "\n", "T", "=", "np", ".", "array", "(", "[", "0", ",", "0", ",", "1", "]", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "return", "R", ",", "T", "\n", "", "R", "=", "cv2", ".", "Rodrigues", "(", "rot", ")", "[", "0", "]", "# convert to rotation matrix", "\n", "T", "=", "trans", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "return", "R", ",", "T", "\n", "\n"]], "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.test.PnP_Learning": [[48, 77], ["torch.from_numpy().float().unsqueeze", "torch.from_numpy().float().unsqueeze", "torch.from_numpy().float().unsqueeze", "torch.cat", "inData.transpose.transpose", "model", "dataset.quaternion2rotation", "translation_min.type_as().view", "translation_max.type_as().view", "predR[].detach().numpy", "predT[].detach().numpy().reshape", "torch.from_numpy().float", "torch.from_numpy().float", "torch.from_numpy().float", "translation_min.type_as", "translation_max.type_as", "predR[].detach", "predT[].detach().numpy", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "predT[].detach"], "function", ["home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.dataset.quaternion2rotation"], ["", "def", "PnP_Learning", "(", "p3d", ",", "sxy", ",", "dxy", ",", "intrinsics", ",", "width", ",", "height", ",", "translation_min", ",", "translation_max", ",", "model", "=", "None", ")", ":", "\n", "    ", "p3d", "=", "torch", ".", "from_numpy", "(", "p3d", ")", ".", "float", "(", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "sxy", "=", "torch", ".", "from_numpy", "(", "sxy", ")", ".", "float", "(", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "dxy", "=", "torch", ".", "from_numpy", "(", "dxy", ")", ".", "float", "(", ")", ".", "unsqueeze", "(", "dim", "=", "0", ")", "\n", "\n", "sxy", "[", "...", ",", "0", "]", "=", "sxy", "[", "...", ",", "0", "]", "-", "(", "width", "/", "2", ")", "\n", "sxy", "[", "...", ",", "1", "]", "=", "sxy", "[", "...", ",", "1", "]", "-", "(", "height", "/", "2", ")", "\n", "sxy", "[", "...", ",", "0", "]", "=", "sxy", "[", "...", ",", "0", "]", "/", "width", "\n", "sxy", "[", "...", ",", "1", "]", "=", "sxy", "[", "...", ",", "1", "]", "/", "height", "\n", "\n", "# dxy = dxy / ( 2* dxy.norm(dim=-1).unsqueeze(-1) )", "\n", "dxy", "[", "...", ",", "0", "]", "=", "dxy", "[", "...", ",", "0", "]", "/", "width", "\n", "dxy", "[", "...", ",", "1", "]", "=", "dxy", "[", "...", ",", "1", "]", "/", "height", "\n", "\n", "inData", "=", "torch", ".", "cat", "(", "(", "sxy", ",", "dxy", ")", ",", "dim", "=", "-", "1", ")", "\n", "# inData = torch.cat((p3d, inData), dim=-1)", "\n", "inData", "=", "inData", ".", "transpose", "(", "1", ",", "2", ")", "\n", "\n", "out", "=", "model", "(", "inData", ")", "\n", "predQ", "=", "out", "[", ":", ",", ":", "4", "]", "\n", "predT", "=", "out", "[", ":", ",", "4", ":", "]", "\n", "predR", "=", "quaternion2rotation", "(", "predQ", ")", "\n", "\n", "# recover predicted translation", "\n", "minT", "=", "translation_min", ".", "type_as", "(", "out", ")", ".", "view", "(", "-", "1", ",", "3", ")", "\n", "maxT", "=", "translation_max", ".", "type_as", "(", "out", ")", ".", "view", "(", "-", "1", ",", "3", ")", "\n", "predT", "=", "(", "predT", "+", "0.5", ")", "*", "(", "maxT", "-", "minT", ")", "+", "minT", "\n", "\n", "return", "predR", "[", "0", "]", ".", "detach", "(", ")", ".", "numpy", "(", ")", ",", "predT", "[", "0", "]", ".", "detach", "(", ")", ".", "numpy", "(", ")", ".", "reshape", "(", "-", "1", ",", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.model.SimplePnPNet.__init__": [[6, 17], ["torch.Module.__init__", "torch.nn.Conv1d", "torch.nn.Conv1d", "torch.nn.Conv1d", "torch.nn.Conv1d", "torch.nn.Conv1d", "torch.nn.Conv1d", "torch.nn.Conv1d", "torch.nn.Conv1d", "torch.nn.Conv1d", "torch.nn.Conv1d", "torch.nn.Conv1d", "torch.nn.Conv1d", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.LeakyReLU", "torch.LeakyReLU"], "methods", ["home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.model.SimplePnPNet.__init__"], ["    ", "def", "__init__", "(", "self", ",", "nIn", ")", ":", "\n", "        ", "super", "(", "SimplePnPNet", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "self", ".", "conv1", "=", "torch", ".", "nn", ".", "Conv1d", "(", "nIn", ",", "128", ",", "1", ")", "\n", "self", ".", "conv2", "=", "torch", ".", "nn", ".", "Conv1d", "(", "128", ",", "128", ",", "1", ")", "\n", "self", ".", "conv3", "=", "torch", ".", "nn", ".", "Conv1d", "(", "128", ",", "128", ",", "1", ")", "\n", "\n", "self", ".", "fc1", "=", "nn", ".", "Linear", "(", "1024", ",", "512", ")", "\n", "self", ".", "fc2", "=", "nn", ".", "Linear", "(", "512", ",", "256", ")", "\n", "self", ".", "fc_qt", "=", "nn", ".", "Linear", "(", "256", ",", "7", ")", "\n", "self", ".", "act", "=", "nn", ".", "LeakyReLU", "(", "0.1", ",", "inplace", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.cvlab-epfl_single-stage-pose.None.model.SimplePnPNet.forward": [[18, 37], ["model.SimplePnPNet.size", "model.SimplePnPNet.size", "model.SimplePnPNet.act", "model.SimplePnPNet.act", "model.SimplePnPNet.conv3", "model.SimplePnPNet.view", "model.SimplePnPNet.view", "model.SimplePnPNet.act", "model.SimplePnPNet.act", "model.SimplePnPNet.fc_qt", "model.SimplePnPNet.conv1", "model.SimplePnPNet.conv2", "torch.max", "torch.max", "torch.max", "torch.max", "model.SimplePnPNet.fc1", "model.SimplePnPNet.fc2"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "batch_size", "=", "x", ".", "size", "(", "0", ")", "\n", "data_size", "=", "x", ".", "size", "(", "2", ")", "# number of correspondences", "\n", "\n", "x", "=", "self", ".", "act", "(", "self", ".", "conv1", "(", "x", ")", ")", "\n", "x", "=", "self", ".", "act", "(", "self", ".", "conv2", "(", "x", ")", ")", "\n", "x", "=", "self", ".", "conv3", "(", "x", ")", "\n", "\n", "x", "=", "x", ".", "view", "(", "batch_size", ",", "128", ",", "-", "1", ",", "8", ")", "\n", "x", "=", "torch", ".", "max", "(", "x", ",", "dim", "=", "2", ",", "keepdim", "=", "True", ")", "[", "0", "]", "\n", "# x = torch.mean(x, dim=2, keepdim=True)", "\n", "\n", "x", "=", "x", ".", "view", "(", "batch_size", ",", "1024", ")", "\n", "# ", "\n", "x", "=", "self", ".", "act", "(", "self", ".", "fc1", "(", "x", ")", ")", "\n", "x", "=", "self", ".", "act", "(", "self", ".", "fc2", "(", "x", ")", ")", "\n", "# ", "\n", "qt", "=", "self", ".", "fc_qt", "(", "x", ")", "\n", "return", "qt", "", "", "", ""]]}