{"home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.None.transfer_measure.Transfer_hparam.__init__": [[22, 29], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "batch_size", "=", "64", ",", "delta", "=", "2.0", ",", "num_epochs", "=", "30", ",", "optim", "=", "'SGD'", ")", ":", "\n", "       ", "dict_", "=", "{", "}", "\n", "dict_", "[", "'delta'", "]", "=", "delta", "\n", "dict_", "[", "'num_epochs'", "]", "=", "num_epochs", "\n", "dict_", "[", "'optimizer'", "]", "=", "optim", "\n", "dict_", "[", "'batch_size'", "]", "=", "batch_size", "\n", "self", ".", "dict_", "=", "dict_", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.None.transfer_measure.Transfer_hparam.__repr__": [[30, 32], ["None"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "dict_", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.None.transfer_measure.save_checkpoint": [[34, 38], ["torch.save", "torch.save", "torch.save", "algorithm.cpu().state_dict", "os.path.join", "algorithm.cpu"], "function", ["None"], ["", "", "def", "save_checkpoint", "(", "checkpoint_dir", ",", "filename", ",", "algorithm", ",", "epoch", ")", ":", "\n", "    ", "save_dict", "=", "{", "'next_epoch'", ":", "epoch", ",", "\n", "'model_dict'", ":", "algorithm", ".", "cpu", "(", ")", ".", "state_dict", "(", ")", "}", "\n", "torch", ".", "save", "(", "save_dict", ",", "os", ".", "path", ".", "join", "(", "checkpoint_dir", ",", "filename", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.None.transfer_measure.local_classifier": [[41, 120], ["min", "int", "print", "os.path.join", "model.to", "copy.deepcopy", "copy.deepcopy", "range", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "domainbed.lib.fast_data_loader.InfiniteDataLoader", "domainbed.lib.fast_data_loader.FastDataLoader", "os.path.exists", "os.makedirs", "os.path.exists", "os.remove", "model.to", "zip", "range", "domainbed.misc_t.loss_acc", "domainbed.misc_t.distance().item", "print", "transfer_measure.save_checkpoint", "os.path.join", "os.path.join", "os.replace", "model.classifier.parameters", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "enumerate", "enumerate", "domainbed.misc_t.loss_gap_batch", "torch.optim.SGD.zero_grad", "domainbed.misc_t.loss_gap_batch.backward", "torch.optim.SGD.step", "domainbed.misc_t.proj", "domainbed.misc_t.loss_acc", "max", "min", "max", "min", "domainbed.misc_t.argmax", "domainbed.misc_t.argmin", "print", "print", "open", "f.write", "len", "model.classifier.parameters", "str", "max", "min", "max", "min", "domainbed.misc_t.distance", "x.to", "y.to", "next", "json.dumps", "str", "domainbed.misc_t.distance().item", "domainbed.misc_t.distance().item", "domainbed.misc_t.loss_gap_batch.item", "domainbed.misc_t.loss_gap_batch.item", "domainbed.misc_t.distance", "int", "int", "int", "int", "domainbed.misc_t.distance", "int", "int"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.min", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.loss_acc", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.None.transfer_measure.save_checkpoint", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.loss_gap_batch", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.proj", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.loss_acc", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.max", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.min", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.max", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.min", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.argmax", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.argmin", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.Tee.write", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.max", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.min", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.max", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.min", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.distance", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.distance", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.distance"], ["", "def", "local_classifier", "(", "args", ",", "dir_to_save", ",", "num_domains", ",", "in_splits", ",", "out_splits", ",", "model", ",", "device", ",", "transfer_hparam", ",", "hparams", ",", "start_epoch", ",", "optimizer", "=", "'Adam'", ",", "seed", "=", "0", ")", ":", "\n", "    ", "''' compute sup_{|h' - h| leq delta} (max_i loss_i(h) - min_j loss_j(h))'''", "\n", "''' this is the test phase so we using both training and testing data of each env'''", "\n", "delta", "=", "transfer_hparam", ".", "dict_", "[", "'delta'", "]", "\n", "num_epochs", "=", "transfer_hparam", ".", "dict_", "[", "'num_epochs'", "]", "\n", "batch_size", "=", "transfer_hparam", ".", "dict_", "[", "'batch_size'", "]", "\n", "steps_per_epoch", "=", "min", "(", "[", "len", "(", "env", ")", "/", "hparams", "[", "'batch_size'", "]", "for", "env", ",", "_", "in", "in_splits", "]", ")", "\n", "steps_per_epoch", "=", "int", "(", "steps_per_epoch", "+", "1", ")", "\n", "if", "optimizer", "==", "'Adam'", ":", "\n", "        ", "optimizer", "=", "torch", ".", "optim", ".", "Adam", "(", "model", ".", "classifier", ".", "parameters", "(", ")", ",", "lr", "=", "hparams", "[", "'lr'", "]", ",", "weight_decay", "=", "hparams", "[", "'weight_decay'", "]", ")", "\n", "", "elif", "optimizer", "==", "'SGD'", ":", "\n", "        ", "optimizer", "=", "torch", ".", "optim", ".", "SGD", "(", "model", ".", "classifier", ".", "parameters", "(", ")", ",", "lr", "=", "0.01", ",", "momentum", "=", "0.9", ")", "\n", "", "'''projection, compute max_index and min_index, load data, compute grad '''", "\n", "''' the following loader is for evaluation'''", "\n", "env_in_loaders", "=", "[", "InfiniteDataLoader", "(", "dataset", "=", "env", ",", "weights", "=", "env_weights", ",", "\n", "batch_size", "=", "batch_size", ",", "num_workers", "=", "dataset", ".", "N_WORKERS", ")", "\n", "for", "i", ",", "(", "env", ",", "env_weights", ")", "in", "enumerate", "(", "in_splits", ")", "]", "\n", "env_out_loaders", "=", "[", "FastDataLoader", "(", "\n", "dataset", "=", "env", ",", "batch_size", "=", "batch_size", ",", "num_workers", "=", "dataset", ".", "N_WORKERS", ")", "\n", "for", "i", ",", "(", "env", ",", "env_weights", ")", "in", "enumerate", "(", "out_splits", ")", "]", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "dir_to_save", ")", ":", "\n", "        ", "os", ".", "makedirs", "(", "dir_to_save", ")", "\n", "", "print", "(", "'save to directory: '", ",", "dir_to_save", ")", "\n", "path", "=", "os", ".", "path", ".", "join", "(", "dir_to_save", ",", "'delta_'", "+", "str", "(", "delta", ")", "+", "'_seed_'", "+", "str", "(", "seed", ")", "+", "'.jsonl'", ")", "\n", "if", "start_epoch", "==", "0", "and", "os", ".", "path", ".", "exists", "(", "path", ")", ":", "\n", "        ", "os", ".", "remove", "(", "path", ")", "\n", "\n", "", "''' computing of sup starts here'''", "\n", "model", ".", "to", "(", "device", ")", "\n", "learned_featurizer", "=", "copy", ".", "deepcopy", "(", "model", ".", "featurizer", ")", "\n", "learned_classifier", "=", "copy", ".", "deepcopy", "(", "model", ".", "classifier", ")", "\n", "if", "delta", "==", "0.0", ":", "\n", "        ", "num_epochs", "=", "1", "\n", "", "if", "start_epoch", ">=", "num_epochs", ":", "\n", "        ", "return", "\n", "\n", "", "for", "epoch", "in", "range", "(", "start_epoch", ",", "num_epochs", ")", ":", "\n", "        ", "model", ".", "to", "(", "device", ")", "\n", "test_minibatches_iterator", "=", "zip", "(", "*", "env_in_loaders", ")", "\n", "# train on the training data from each domain", "\n", "for", "step", "in", "range", "(", "steps_per_epoch", ")", ":", "\n", "            ", "minibatches_device", "=", "[", "(", "x", ".", "to", "(", "device", ")", ",", "y", ".", "to", "(", "device", ")", ")", "for", "x", ",", "y", "in", "next", "(", "test_minibatches_iterator", ")", "]", "\n", "loss_gap_", "=", "loss_gap_batch", "(", "num_domains", ",", "minibatches_device", ",", "model", ",", "device", ")", "# compute the loss_gap_ ", "\n", "optimizer", ".", "zero_grad", "(", ")", "\n", "loss_gap_", ".", "backward", "(", ")", "\n", "optimizer", ".", "step", "(", ")", "\n", "model", ".", "classifier", "=", "proj", "(", "delta", ",", "model", ".", "classifier", ",", "learned_classifier", ")", "\n", "", "if", "not", "args", ".", "out_only", ":", "\n", "            ", "loss_all_in", ",", "acc_all_in", "=", "loss_acc", "(", "num_domains", ",", "env_in_loaders", ",", "model", ",", "device", ")", "\n", "max_loss_in", ",", "min_loss_in", "=", "max", "(", "loss_all_in", ")", ",", "min", "(", "loss_all_in", ")", "\n", "max_acc_in", ",", "min_acc_in", "=", "max", "(", "acc_all_in", ")", ",", "min", "(", "acc_all_in", ")", "\n", "", "loss_all_out", ",", "acc_all_out", "=", "loss_acc", "(", "num_domains", ",", "env_out_loaders", ",", "model", ",", "device", ")", "\n", "max_loss_out", ",", "min_loss_out", "=", "max", "(", "loss_all_out", ")", ",", "min", "(", "loss_all_out", ")", "\n", "max_acc_out", ",", "min_acc_out", "=", "max", "(", "acc_all_out", ")", ",", "min", "(", "acc_all_out", ")", "\n", "max_index", ",", "min_index", "=", "argmax", "(", "acc_all_out", ")", ",", "argmin", "(", "acc_all_out", ")", "\n", "\n", "if", "not", "args", ".", "out_only", ":", "\n", "            ", "print", "(", "f\"seed: {seed} epoch: {epoch} step: {step} distance: {distance(model.classifier, learned_classifier).item():4f}, max_index: {max_index}, min_index: {min_index}, loss gap: {-loss_gap_.item():4f} losses_in: {[int(loss*10000)/10000 for loss in loss_all_in]} accs_in: {[int(acc*10000)/10000 for acc in acc_all_in]}, losses_out: {[int(loss*10000)/10000 for loss in loss_all_out]} accs_out: {[int(acc*10000)/10000 for acc in acc_all_out]}, max loss_in: {max_loss_in:4f}, min loss_in: {min_loss_in:4f}, max_acc_in: {max_acc_in:4f}, min_acc_in: {min_acc_in:4f}, max loss_out: {max_loss_out:4f}, min loss_out: {min_loss_out:4f}, max_acc_out: {max_acc_out:4f}, min_acc_out: {min_acc_out:4f}\"", ")", "\n", "", "else", ":", "\n", "            ", "print", "(", "f\"seed: {seed} epoch: {epoch} step: {step} distance: {distance(model.classifier, learned_classifier).item():4f}, max_index: {max_index}, min_index: {min_index}, loss gap: {-loss_gap_.item():4f}, losses_out: {[int(loss*10000)/10000 for loss in loss_all_out]} accs_out: {[int(acc*10000)/10000 for acc in acc_all_out]}, max loss_out: {max_loss_out:4f}, min loss_out: {min_loss_out:4f}, max_acc_out: {max_acc_out:4f}, min_acc_out: {min_acc_out:4f}\"", ")", "\n", "", "distance_", "=", "distance", "(", "model", ".", "classifier", ",", "learned_classifier", ")", ".", "item", "(", ")", "\n", "print", "(", "f'saving to checkpoint'", ")", "\n", "'''safe save'''", "\n", "dict_", "=", "{", "}", "\n", "if", "not", "args", ".", "out_only", ":", "\n", "            ", "dict_", "[", "'loss_in'", "]", "=", "loss_all_in", "\n", "dict_", "[", "'acc_in'", "]", "=", "acc_all_in", "\n", "", "dict_", "[", "'loss_out'", "]", "=", "loss_all_out", "\n", "dict_", "[", "'acc_out'", "]", "=", "acc_all_out", "\n", "dict_", "[", "'max_index'", "]", "=", "max_index", "\n", "dict_", "[", "'min_index'", "]", "=", "min_index", "\n", "dict_", "[", "'epoch'", "]", "=", "epoch", "\n", "dict_", "[", "'distance'", "]", "=", "distance_", "\n", "with", "open", "(", "path", ",", "'a'", ")", "as", "f", ":", "\n", "            ", "f", ".", "write", "(", "json", ".", "dumps", "(", "dict_", ",", "sort_keys", "=", "True", ")", "+", "'\\n'", ")", "\n", "", "save_checkpoint", "(", "args", ".", "checkpoint_dir", ",", "'model_temp.pkl'", ",", "model", ",", "epoch", "+", "1", ")", "\n", "check_path", "=", "os", ".", "path", ".", "join", "(", "args", ".", "checkpoint_dir", ",", "'model.pkl'", ")", "\n", "temp_path", "=", "os", ".", "path", ".", "join", "(", "args", ".", "checkpoint_dir", ",", "'model_temp.pkl'", ")", "\n", "os", ".", "replace", "(", "temp_path", ",", "check_path", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.command_launchers.local_launcher": [[13, 17], ["subprocess.call"], "function", ["None"], ["def", "local_launcher", "(", "commands", ")", ":", "\n", "    ", "\"\"\"Launch commands serially on the local machine.\"\"\"", "\n", "for", "cmd", "in", "commands", ":", "\n", "        ", "subprocess", ".", "call", "(", "cmd", ",", "shell", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.command_launchers.dummy_launcher": [[18, 25], ["print"], "function", ["None"], ["", "", "def", "dummy_launcher", "(", "commands", ")", ":", "\n", "    ", "\"\"\"\n    Doesn't run anything; instead, prints each command.\n    Useful for testing.\n    \"\"\"", "\n", "for", "cmd", "in", "commands", ":", "\n", "        ", "print", "(", "f'Dummy launcher: {cmd}'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.command_launchers.multi_gpu_launcher": [[26, 50], ["print", "torch.cuda.device_count", "len", "range", "time.sleep", "p.wait", "commands.pop", "subprocess.Popen", "proc.poll"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "", "def", "multi_gpu_launcher", "(", "commands", ")", ":", "\n", "    ", "\"\"\"\n    Launch commands on the local machine, using all GPUs in parallel.\n    \"\"\"", "\n", "print", "(", "'WARNING: using experimental multi_gpu_launcher.'", ")", "\n", "n_gpus", "=", "torch", ".", "cuda", ".", "device_count", "(", ")", "\n", "procs_by_gpu", "=", "[", "None", "]", "*", "n_gpus", "\n", "\n", "while", "len", "(", "commands", ")", ">", "0", ":", "\n", "        ", "for", "gpu_idx", "in", "range", "(", "n_gpus", ")", ":", "\n", "            ", "proc", "=", "procs_by_gpu", "[", "gpu_idx", "]", "\n", "if", "(", "proc", "is", "None", ")", "or", "(", "proc", ".", "poll", "(", ")", "is", "not", "None", ")", ":", "\n", "# Nothing is running on this GPU; launch a command.", "\n", "                ", "cmd", "=", "commands", ".", "pop", "(", "0", ")", "\n", "new_proc", "=", "subprocess", ".", "Popen", "(", "\n", "f'CUDA_VISIBLE_DEVICES={gpu_idx} {cmd}'", ",", "shell", "=", "True", ")", "\n", "procs_by_gpu", "[", "gpu_idx", "]", "=", "new_proc", "\n", "break", "\n", "", "", "time", ".", "sleep", "(", "1", ")", "\n", "\n", "# Wait for the last few tasks to finish before returning", "\n", "", "for", "p", "in", "procs_by_gpu", ":", "\n", "        ", "if", "p", "is", "not", "None", ":", "\n", "            ", "p", ".", "wait", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.model_selection.SelectionMethod.__init__": [[15, 17], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "raise", "TypeError", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.model_selection.SelectionMethod.run_acc": [[18, 25], ["None"], "methods", ["None"], ["", "@", "classmethod", "\n", "def", "run_acc", "(", "self", ",", "run_records", ")", ":", "\n", "        ", "\"\"\"\n        Given records from a run, return a {val_acc, test_acc} dict representing\n        the best val-acc and corresponding test-acc for that run.\n        \"\"\"", "\n", "raise", "NotImplementedError", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.model_selection.SelectionMethod.hparams_accs": [[26, 40], ["records.group().map().filter().sorted", "records.group().map().filter", "records.group().map", "records.group", "model_selection.SelectionMethod.run_acc"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sorted", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.filter", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.map", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.group", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.model_selection.LeaveOneOutSelectionMethod.run_acc"], ["", "@", "classmethod", "\n", "def", "hparams_accs", "(", "self", ",", "records", ")", ":", "\n", "        ", "\"\"\"\n        Given all records from a single (dataset, algorithm, test env) pair,\n        return a sorted list of (run_acc, records) tuples.\n        \"\"\"", "\n", "return", "(", "records", ".", "group", "(", "'args.hparams_seed'", ")", "\n", ".", "map", "(", "lambda", "_", ",", "run_records", ":", "\n", "(", "\n", "self", ".", "run_acc", "(", "run_records", ")", ",", "\n", "run_records", "\n", ")", "\n", ")", ".", "filter", "(", "lambda", "x", ":", "x", "[", "0", "]", "is", "not", "None", ")", "\n", ".", "sorted", "(", "key", "=", "lambda", "x", ":", "x", "[", "0", "]", "[", "'val_acc'", "]", ")", "[", ":", ":", "-", "1", "]", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.model_selection.SelectionMethod.sweep_acc": [[42, 53], ["model_selection.SelectionMethod.hparams_accs", "len"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.model_selection.SelectionMethod.hparams_accs", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "@", "classmethod", "\n", "def", "sweep_acc", "(", "self", ",", "records", ")", ":", "\n", "        ", "\"\"\"\n        Given all records from a single (dataset, algorithm, test env) pair,\n        return the mean test acc of the k runs with the top val accs.\n        \"\"\"", "\n", "_hparams_accs", "=", "self", ".", "hparams_accs", "(", "records", ")", "\n", "if", "len", "(", "_hparams_accs", ")", ":", "\n", "            ", "return", "_hparams_accs", "[", "0", "]", "[", "0", "]", "[", "'test_acc'", "]", "\n", "", "else", ":", "\n", "            ", "return", "None", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.model_selection.OracleSelectionMethod.run_acc": [[60, 73], ["run_records.filter.filter.filter", "len", "run_records.filter.filter.sorted", "len"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.filter", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sorted", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["@", "classmethod", "\n", "def", "run_acc", "(", "self", ",", "run_records", ")", ":", "\n", "        ", "run_records", "=", "run_records", ".", "filter", "(", "lambda", "r", ":", "\n", "len", "(", "r", "[", "'args'", "]", "[", "'test_envs'", "]", ")", "==", "1", ")", "\n", "if", "not", "len", "(", "run_records", ")", ":", "\n", "            ", "return", "None", "\n", "", "test_env", "=", "run_records", "[", "0", "]", "[", "'args'", "]", "[", "'test_envs'", "]", "[", "0", "]", "\n", "test_out_acc_key", "=", "'env{}_out_acc'", ".", "format", "(", "test_env", ")", "\n", "test_in_acc_key", "=", "'env{}_in_acc'", ".", "format", "(", "test_env", ")", "\n", "chosen_record", "=", "run_records", ".", "sorted", "(", "lambda", "r", ":", "r", "[", "'step'", "]", ")", "[", "-", "1", "]", "\n", "return", "{", "\n", "'val_acc'", ":", "chosen_record", "[", "test_out_acc_key", "]", ",", "\n", "'test_acc'", ":", "chosen_record", "[", "test_in_acc_key", "]", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.model_selection.IIDAccuracySelectionMethod._step_acc": [[79, 93], ["itertools.count", "numpy.mean", "val_env_keys.append"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean"], ["@", "classmethod", "\n", "def", "_step_acc", "(", "self", ",", "record", ")", ":", "\n", "        ", "\"\"\"Given a single record, return a {val_acc, test_acc} dict.\"\"\"", "\n", "test_env", "=", "record", "[", "'args'", "]", "[", "'test_envs'", "]", "[", "0", "]", "\n", "val_env_keys", "=", "[", "]", "\n", "for", "i", "in", "itertools", ".", "count", "(", ")", ":", "\n", "            ", "if", "f'env{i}_out_acc'", "not", "in", "record", ":", "\n", "                ", "break", "\n", "", "if", "i", "!=", "test_env", ":", "\n", "                ", "val_env_keys", ".", "append", "(", "f'env{i}_out_acc'", ")", "\n", "", "", "test_in_acc_key", "=", "'env{}_in_acc'", ".", "format", "(", "test_env", ")", "\n", "return", "{", "\n", "'val_acc'", ":", "np", ".", "mean", "(", "[", "record", "[", "key", "]", "for", "key", "in", "val_env_keys", "]", ")", ",", "\n", "'test_acc'", ":", "record", "[", "test_in_acc_key", "]", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.model_selection.IIDAccuracySelectionMethod.run_acc": [[95, 101], ["model_selection.get_test_records", "get_test_records.map().argmax", "len", "get_test_records.map"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.model_selection.get_test_records", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.argmax", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.map"], ["", "@", "classmethod", "\n", "def", "run_acc", "(", "self", ",", "run_records", ")", ":", "\n", "        ", "test_records", "=", "get_test_records", "(", "run_records", ")", "\n", "if", "not", "len", "(", "test_records", ")", ":", "\n", "            ", "return", "None", "\n", "", "return", "test_records", ".", "map", "(", "self", ".", "_step_acc", ")", ".", "argmax", "(", "'val_acc'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.model_selection.LeaveOneOutSelectionMethod._step_acc": [[106, 131], ["model_selection.get_test_records", "itertools.count", "records.filter", "any", "len", "numpy.zeros", "list", "list", "numpy.sum", "len", "set", "set"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.model_selection.get_test_records", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.filter", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["@", "classmethod", "\n", "def", "_step_acc", "(", "self", ",", "records", ")", ":", "\n", "        ", "\"\"\"Return the {val_acc, test_acc} for a group of records corresponding\n        to a single step.\"\"\"", "\n", "test_records", "=", "get_test_records", "(", "records", ")", "\n", "if", "len", "(", "test_records", ")", "!=", "1", ":", "\n", "            ", "return", "None", "\n", "\n", "", "test_env", "=", "test_records", "[", "0", "]", "[", "'args'", "]", "[", "'test_envs'", "]", "[", "0", "]", "\n", "n_envs", "=", "0", "\n", "for", "i", "in", "itertools", ".", "count", "(", ")", ":", "\n", "            ", "if", "f'env{i}_out_acc'", "not", "in", "records", "[", "0", "]", ":", "\n", "                ", "break", "\n", "", "n_envs", "+=", "1", "\n", "", "val_accs", "=", "np", ".", "zeros", "(", "n_envs", ")", "-", "1", "\n", "for", "r", "in", "records", ".", "filter", "(", "lambda", "r", ":", "len", "(", "r", "[", "'args'", "]", "[", "'test_envs'", "]", ")", "==", "2", ")", ":", "\n", "            ", "val_env", "=", "(", "set", "(", "r", "[", "'args'", "]", "[", "'test_envs'", "]", ")", "-", "set", "(", "[", "test_env", "]", ")", ")", ".", "pop", "(", ")", "\n", "val_accs", "[", "val_env", "]", "=", "r", "[", "'env{}_in_acc'", ".", "format", "(", "val_env", ")", "]", "\n", "", "val_accs", "=", "list", "(", "val_accs", "[", ":", "test_env", "]", ")", "+", "list", "(", "val_accs", "[", "test_env", "+", "1", ":", "]", ")", "\n", "if", "any", "(", "[", "v", "==", "-", "1", "for", "v", "in", "val_accs", "]", ")", ":", "\n", "            ", "return", "None", "\n", "", "val_acc", "=", "np", ".", "sum", "(", "val_accs", ")", "/", "(", "n_envs", "-", "1", ")", "\n", "return", "{", "\n", "'val_acc'", ":", "val_acc", ",", "\n", "'test_acc'", ":", "test_records", "[", "0", "]", "[", "'env{}_in_acc'", ".", "format", "(", "test_env", ")", "]", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.model_selection.LeaveOneOutSelectionMethod.run_acc": [[133, 142], ["records.group().map().filter_not_none", "len", "records.group().map().filter_not_none.argmax", "records.group().map", "records.group", "model_selection.LeaveOneOutSelectionMethod._step_acc"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.filter_not_none", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.argmax", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.map", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.group", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.model_selection.LeaveOneOutSelectionMethod._step_acc"], ["", "@", "classmethod", "\n", "def", "run_acc", "(", "self", ",", "records", ")", ":", "\n", "        ", "step_accs", "=", "records", ".", "group", "(", "'step'", ")", ".", "map", "(", "lambda", "step", ",", "step_records", ":", "\n", "self", ".", "_step_acc", "(", "step_records", ")", "\n", ")", ".", "filter_not_none", "(", ")", "\n", "if", "len", "(", "step_accs", ")", ":", "\n", "            ", "return", "step_accs", ".", "argmax", "(", "'val_acc'", ")", "\n", "", "else", ":", "\n", "            ", "return", "None", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.model_selection.get_test_records": [[6, 10], ["records.filter", "len"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.filter", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["def", "get_test_records", "(", "records", ")", ":", "\n", "    ", "\"\"\"Given records with a common test env, get the test records (i.e. the\n    records with *only* that single test env and no other test envs)\"\"\"", "\n", "return", "records", ".", "filter", "(", "lambda", "r", ":", "len", "(", "r", "[", "'args'", "]", "[", "'test_envs'", "]", ")", "==", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.Identity.__init__": [[14, 16], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", "Identity", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.Identity.forward": [[17, 19], ["None"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.SqueezeLastTwo.__init__": [[22, 24], ["torch.Module.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", "SqueezeLastTwo", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.SqueezeLastTwo.forward": [[25, 27], ["x.view"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "x", ".", "view", "(", "x", ".", "shape", "[", "0", "]", ",", "x", ".", "shape", "[", "1", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.MLP.__init__": [[31, 40], ["torch.Module.__init__", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.ModuleList", "torch.ModuleList", "torch.ModuleList", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "torch.Linear", "range"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "n_inputs", ",", "n_outputs", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "MLP", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "input", "=", "nn", ".", "Linear", "(", "n_inputs", ",", "hparams", "[", "'mlp_width'", "]", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "hparams", "[", "'mlp_dropout'", "]", ")", "\n", "self", ".", "hiddens", "=", "nn", ".", "ModuleList", "(", "[", "\n", "nn", ".", "Linear", "(", "hparams", "[", "'mlp_width'", "]", ",", "hparams", "[", "'mlp_width'", "]", ")", "\n", "for", "_", "in", "range", "(", "hparams", "[", "'mlp_depth'", "]", "-", "2", ")", "]", ")", "\n", "self", ".", "output", "=", "nn", ".", "Linear", "(", "hparams", "[", "'mlp_width'", "]", ",", "n_outputs", ")", "\n", "self", ".", "n_outputs", "=", "n_outputs", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.MLP.forward": [[41, 51], ["networks.MLP.input", "networks.MLP.dropout", "torch.relu", "torch.relu", "torch.relu", "networks.MLP.output", "hidden", "networks.MLP.dropout", "torch.relu", "torch.relu", "torch.relu"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "x", "=", "self", ".", "input", "(", "x", ")", "\n", "x", "=", "self", ".", "dropout", "(", "x", ")", "\n", "x", "=", "F", ".", "relu", "(", "x", ")", "\n", "for", "hidden", "in", "self", ".", "hiddens", ":", "\n", "            ", "x", "=", "hidden", "(", "x", ")", "\n", "x", "=", "self", ".", "dropout", "(", "x", ")", "\n", "x", "=", "F", ".", "relu", "(", "x", ")", "\n", "", "x", "=", "self", ".", "output", "(", "x", ")", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.ResNet.__init__": [[54, 82], ["super().__init__", "networks.Identity", "networks.ResNet.freeze_bn", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torchvision.models.resnet18", "torchvision.models.resnet50", "networks.ResNet.network.conv1.weight.data.clone", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "range"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.ResNet.freeze_bn"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "ResNet", ",", "self", ")", ".", "__init__", "(", ")", "\n", "if", "hparams", "[", "'resnet18'", "]", ":", "\n", "            ", "self", ".", "network", "=", "torchvision", ".", "models", ".", "resnet18", "(", "pretrained", "=", "True", ")", "\n", "self", ".", "n_outputs", "=", "512", "\n", "", "else", ":", "\n", "            ", "self", ".", "network", "=", "torchvision", ".", "models", ".", "resnet50", "(", "pretrained", "=", "True", ")", "\n", "self", ".", "n_outputs", "=", "2048", "\n", "\n", "# adapt number of channels", "\n", "", "nc", "=", "input_shape", "[", "0", "]", "\n", "if", "nc", "!=", "3", ":", "\n", "            ", "tmp", "=", "self", ".", "network", ".", "conv1", ".", "weight", ".", "data", ".", "clone", "(", ")", "\n", "\n", "self", ".", "network", ".", "conv1", "=", "nn", ".", "Conv2d", "(", "\n", "nc", ",", "64", ",", "kernel_size", "=", "(", "7", ",", "7", ")", ",", "\n", "stride", "=", "(", "2", ",", "2", ")", ",", "padding", "=", "(", "3", ",", "3", ")", ",", "bias", "=", "False", ")", "\n", "\n", "for", "i", "in", "range", "(", "nc", ")", ":", "\n", "                ", "self", ".", "network", ".", "conv1", ".", "weight", ".", "data", "[", ":", ",", "i", ",", ":", ",", ":", "]", "=", "tmp", "[", ":", ",", "i", "%", "3", ",", ":", ",", ":", "]", "\n", "\n", "# save memory", "\n", "", "", "del", "self", ".", "network", ".", "fc", "\n", "self", ".", "network", ".", "fc", "=", "Identity", "(", ")", "\n", "\n", "self", ".", "freeze_bn", "(", ")", "\n", "self", ".", "hparams", "=", "hparams", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "hparams", "[", "'resnet_dropout'", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.ResNet.forward": [[83, 86], ["networks.ResNet.dropout", "networks.ResNet.network"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "\"\"\"Encode x into a feature vector of size n_outputs.\"\"\"", "\n", "return", "self", ".", "dropout", "(", "self", ".", "network", "(", "x", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.ResNet.train": [[87, 93], ["super().train", "networks.ResNet.freeze_bn"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.ResNet.train", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.ResNet.freeze_bn"], ["", "def", "train", "(", "self", ",", "mode", "=", "True", ")", ":", "\n", "        ", "\"\"\"\n        Override the default train() to freeze the BN parameters\n        \"\"\"", "\n", "super", "(", ")", ".", "train", "(", "mode", ")", "\n", "self", ".", "freeze_bn", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.ResNet.freeze_bn": [[94, 98], ["networks.ResNet.network.modules", "isinstance", "m.eval"], "methods", ["None"], ["", "def", "freeze_bn", "(", "self", ")", ":", "\n", "        ", "for", "m", "in", "self", ".", "network", ".", "modules", "(", ")", ":", "\n", "            ", "if", "isinstance", "(", "m", ",", "nn", ".", "BatchNorm2d", ")", ":", "\n", "                ", "m", ".", "eval", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.MNIST_CNN.__init__": [[108, 122], ["torch.Module.__init__", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.GroupNorm", "torch.GroupNorm", "torch.GroupNorm", "torch.GroupNorm", "torch.GroupNorm", "torch.GroupNorm", "torch.GroupNorm", "torch.GroupNorm", "torch.GroupNorm", "torch.GroupNorm", "torch.GroupNorm", "torch.GroupNorm", "torch.AdaptiveAvgPool2d", "torch.AdaptiveAvgPool2d", "torch.AdaptiveAvgPool2d", "networks.SqueezeLastTwo"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "input_shape", ")", ":", "\n", "        ", "super", "(", "MNIST_CNN", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "conv1", "=", "nn", ".", "Conv2d", "(", "input_shape", "[", "0", "]", ",", "64", ",", "3", ",", "1", ",", "padding", "=", "1", ")", "\n", "self", ".", "conv2", "=", "nn", ".", "Conv2d", "(", "64", ",", "128", ",", "3", ",", "stride", "=", "2", ",", "padding", "=", "1", ")", "\n", "self", ".", "conv3", "=", "nn", ".", "Conv2d", "(", "128", ",", "128", ",", "3", ",", "1", ",", "padding", "=", "1", ")", "\n", "self", ".", "conv4", "=", "nn", ".", "Conv2d", "(", "128", ",", "128", ",", "3", ",", "1", ",", "padding", "=", "1", ")", "\n", "\n", "self", ".", "bn0", "=", "nn", ".", "GroupNorm", "(", "8", ",", "64", ")", "\n", "self", ".", "bn1", "=", "nn", ".", "GroupNorm", "(", "8", ",", "128", ")", "\n", "self", ".", "bn2", "=", "nn", ".", "GroupNorm", "(", "8", ",", "128", ")", "\n", "self", ".", "bn3", "=", "nn", ".", "GroupNorm", "(", "8", ",", "128", ")", "\n", "\n", "self", ".", "avgpool", "=", "nn", ".", "AdaptiveAvgPool2d", "(", "(", "1", ",", "1", ")", ")", "\n", "self", ".", "squeezeLastTwo", "=", "SqueezeLastTwo", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.MNIST_CNN.forward": [[123, 143], ["networks.MNIST_CNN.conv1", "torch.relu", "torch.relu", "torch.relu", "networks.MNIST_CNN.bn0", "networks.MNIST_CNN.conv2", "torch.relu", "torch.relu", "torch.relu", "networks.MNIST_CNN.bn1", "networks.MNIST_CNN.conv3", "torch.relu", "torch.relu", "torch.relu", "networks.MNIST_CNN.bn2", "networks.MNIST_CNN.conv4", "torch.relu", "torch.relu", "torch.relu", "networks.MNIST_CNN.bn3", "networks.MNIST_CNN.avgpool", "networks.MNIST_CNN.squeezeLastTwo"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "x", "=", "self", ".", "conv1", "(", "x", ")", "\n", "x", "=", "F", ".", "relu", "(", "x", ")", "\n", "x", "=", "self", ".", "bn0", "(", "x", ")", "\n", "\n", "x", "=", "self", ".", "conv2", "(", "x", ")", "\n", "x", "=", "F", ".", "relu", "(", "x", ")", "\n", "x", "=", "self", ".", "bn1", "(", "x", ")", "\n", "\n", "x", "=", "self", ".", "conv3", "(", "x", ")", "\n", "x", "=", "F", ".", "relu", "(", "x", ")", "\n", "x", "=", "self", ".", "bn2", "(", "x", ")", "\n", "\n", "x", "=", "self", ".", "conv4", "(", "x", ")", "\n", "x", "=", "F", ".", "relu", "(", "x", ")", "\n", "x", "=", "self", ".", "bn3", "(", "x", ")", "\n", "\n", "x", "=", "self", ".", "avgpool", "(", "x", ")", "\n", "x", "=", "self", ".", "squeezeLastTwo", "(", "x", ")", "\n", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.ContextNet.__init__": [[145, 158], ["torch.Module.__init__", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.ReLU", "torch.ReLU", "torch.ReLU", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.ReLU", "torch.ReLU", "torch.ReLU", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input_shape", ")", ":", "\n", "        ", "super", "(", "ContextNet", ",", "self", ")", ".", "__init__", "(", ")", "\n", "\n", "# Keep same dimensions", "\n", "padding", "=", "(", "5", "-", "1", ")", "//", "2", "\n", "self", ".", "context_net", "=", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Conv2d", "(", "input_shape", "[", "0", "]", ",", "64", ",", "5", ",", "padding", "=", "padding", ")", ",", "\n", "nn", ".", "BatchNorm2d", "(", "64", ")", ",", "\n", "nn", ".", "ReLU", "(", ")", ",", "\n", "nn", ".", "Conv2d", "(", "64", ",", "64", ",", "5", ",", "padding", "=", "padding", ")", ",", "\n", "nn", ".", "BatchNorm2d", "(", "64", ")", ",", "\n", "nn", ".", "ReLU", "(", ")", ",", "\n", "nn", ".", "Conv2d", "(", "64", ",", "1", ",", "5", ",", "padding", "=", "padding", ")", ",", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.ContextNet.forward": [[160, 162], ["networks.ContextNet.context_net"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "self", ".", "context_net", "(", "x", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.Featurizer": [[164, 176], ["len", "networks.MLP", "networks.MNIST_CNN", "domainbed.lib.wide_resnet.Wide_ResNet", "networks.ResNet"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "", "def", "Featurizer", "(", "input_shape", ",", "hparams", ")", ":", "\n", "    ", "\"\"\"Auto-select an appropriate featurizer for the given input shape.\"\"\"", "\n", "if", "len", "(", "input_shape", ")", "==", "1", ":", "\n", "        ", "return", "MLP", "(", "input_shape", "[", "0", "]", ",", "128", ",", "hparams", ")", "\n", "", "elif", "input_shape", "[", "1", ":", "3", "]", "==", "(", "28", ",", "28", ")", ":", "\n", "        ", "return", "MNIST_CNN", "(", "input_shape", ")", "\n", "", "elif", "input_shape", "[", "1", ":", "3", "]", "==", "(", "32", ",", "32", ")", ":", "\n", "        ", "return", "wide_resnet", ".", "Wide_ResNet", "(", "input_shape", ",", "16", ",", "2", ",", "0.", ")", "\n", "", "elif", "input_shape", "[", "1", ":", "3", "]", "==", "(", "224", ",", "224", ")", ":", "\n", "        ", "return", "ResNet", "(", "input_shape", ",", "hparams", ")", "\n", "", "else", ":", "\n", "        ", "raise", "NotImplementedError", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.Classifier": [[178, 188], ["torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Sequential", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.ReLU", "torch.nn.ReLU", "torch.nn.ReLU", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.ReLU", "torch.nn.ReLU", "torch.nn.ReLU", "torch.nn.Linear", "torch.nn.Linear", "torch.nn.Linear"], "function", ["None"], ["", "", "def", "Classifier", "(", "in_features", ",", "out_features", ",", "is_nonlinear", "=", "False", ")", ":", "\n", "    ", "if", "is_nonlinear", ":", "\n", "        ", "return", "torch", ".", "nn", ".", "Sequential", "(", "\n", "torch", ".", "nn", ".", "Linear", "(", "in_features", ",", "in_features", "//", "2", ")", ",", "\n", "torch", ".", "nn", ".", "ReLU", "(", ")", ",", "\n", "torch", ".", "nn", ".", "Linear", "(", "in_features", "//", "2", ",", "in_features", "//", "4", ")", ",", "\n", "torch", ".", "nn", ".", "ReLU", "(", ")", ",", "\n", "torch", ".", "nn", ".", "Linear", "(", "in_features", "//", "4", ",", "out_features", ")", ")", "\n", "", "else", ":", "\n", "        ", "return", "torch", ".", "nn", ".", "Linear", "(", "in_features", ",", "out_features", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.hparams_registry._define_hparam": [[6, 8], ["None"], "function", ["None"], ["def", "_define_hparam", "(", "hparams", ",", "hparam_name", ",", "default_val", ",", "random_val_fn", ")", ":", "\n", "    ", "hparams", "[", "hparam_name", "]", "=", "(", "hparams", ",", "hparam_name", ",", "default_val", ",", "random_val_fn", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.hparams_registry._hparams": [[10, 142], ["hparams_registry._hparams._hparam"], "function", ["None"], ["", "def", "_hparams", "(", "algorithm", ",", "dataset", ",", "random_seed", ")", ":", "\n", "    ", "\"\"\"\n    Global registry of hyperparams. Each entry is a (default, random) tuple.\n    New algorithms / networks / etc. should add entries here.\n    \"\"\"", "\n", "SMALL_IMAGES", "=", "[", "'Debug28'", ",", "'RotatedMNIST'", ",", "'ColoredMNIST'", "]", "\n", "\n", "hparams", "=", "{", "}", "\n", "def", "_hparam", "(", "name", ",", "default_val", ",", "random_val_fn", ")", ":", "\n", "        ", "\"\"\"Define a hyperparameter. random_val_fn takes a RandomState and\n        returns a random hyperparameter value.\"\"\"", "\n", "assert", "(", "name", "not", "in", "hparams", ")", "\n", "random_state", "=", "np", ".", "random", ".", "RandomState", "(", "\n", "misc", ".", "seed_hash", "(", "random_seed", ",", "name", ")", "\n", ")", "\n", "hparams", "[", "name", "]", "=", "(", "default_val", ",", "random_val_fn", "(", "random_state", ")", ")", "\n", "\n", "# Unconditional hparam definitions.", "\n", "\n", "", "_hparam", "(", "'data_augmentation'", ",", "True", ",", "lambda", "r", ":", "True", ")", "\n", "_hparam", "(", "'resnet18'", ",", "False", ",", "lambda", "r", ":", "False", ")", "\n", "_hparam", "(", "'resnet_dropout'", ",", "0.", ",", "lambda", "r", ":", "r", ".", "choice", "(", "[", "0.", ",", "0.1", ",", "0.5", "]", ")", ")", "\n", "_hparam", "(", "'class_balanced'", ",", "False", ",", "lambda", "r", ":", "False", ")", "\n", "_hparam", "(", "'nonlinear_classifier'", ",", "False", ",", "lambda", "r", ":", "bool", "(", "r", ".", "choice", "(", "[", "False", ",", "True", "]", ")", ")", ")", "\n", "\n", "# Algorithm-specific hparam definitions. Each block of code below", "\n", "# corresponds to exactly one algorithm.", "\n", "\n", "if", "algorithm", "in", "[", "'DANN'", ",", "'CDANN'", "]", ":", "\n", "        ", "_hparam", "(", "'lambda'", ",", "1.0", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "2", ",", "2", ")", ")", "\n", "_hparam", "(", "'weight_decay_d'", ",", "0.", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "6", ",", "-", "2", ")", ")", "\n", "_hparam", "(", "'d_steps_per_g_step'", ",", "1", ",", "lambda", "r", ":", "int", "(", "2", "**", "r", ".", "uniform", "(", "0", ",", "3", ")", ")", ")", "\n", "_hparam", "(", "'grad_penalty'", ",", "0.", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "2", ",", "1", ")", ")", "\n", "_hparam", "(", "'beta1'", ",", "0.5", ",", "lambda", "r", ":", "r", ".", "choice", "(", "[", "0.", ",", "0.5", "]", ")", ")", "\n", "_hparam", "(", "'mlp_width'", ",", "256", ",", "lambda", "r", ":", "int", "(", "2", "**", "r", ".", "uniform", "(", "6", ",", "10", ")", ")", ")", "\n", "_hparam", "(", "'mlp_depth'", ",", "3", ",", "lambda", "r", ":", "int", "(", "r", ".", "choice", "(", "[", "3", ",", "4", ",", "5", "]", ")", ")", ")", "\n", "_hparam", "(", "'mlp_dropout'", ",", "0.", ",", "lambda", "r", ":", "r", ".", "choice", "(", "[", "0.", ",", "0.1", ",", "0.5", "]", ")", ")", "\n", "\n", "", "elif", "algorithm", "==", "\"RSC\"", ":", "\n", "        ", "_hparam", "(", "'rsc_f_drop_factor'", ",", "1", "/", "3", ",", "lambda", "r", ":", "r", ".", "uniform", "(", "0", ",", "0.5", ")", ")", "\n", "_hparam", "(", "'rsc_b_drop_factor'", ",", "1", "/", "3", ",", "lambda", "r", ":", "r", ".", "uniform", "(", "0", ",", "0.5", ")", ")", "\n", "\n", "", "elif", "algorithm", "==", "\"SagNet\"", ":", "\n", "        ", "_hparam", "(", "'sag_w_adv'", ",", "0.1", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "2", ",", "1", ")", ")", "\n", "\n", "", "elif", "algorithm", "==", "\"IRM\"", ":", "\n", "        ", "if", "dataset", "in", "SMALL_IMAGES", ":", "\n", "            ", "_hparam", "(", "'irm_lambda'", ",", "1e1", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "1", ",", "5", ")", ")", "\n", "", "else", ":", "\n", "            ", "_hparam", "(", "'irm_lambda'", ",", "1e2", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "1", ",", "5", ")", ")", "\n", "\n", "", "_hparam", "(", "'irm_penalty_anneal_iters'", ",", "500", ",", "lambda", "r", ":", "int", "(", "10", "**", "r", ".", "uniform", "(", "0", ",", "4", ")", ")", ")", "\n", "\n", "", "elif", "algorithm", "==", "\"Transfer\"", ":", "\n", "        ", "_hparam", "(", "'t_lambda'", ",", "1.0", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "2", ",", "1", ")", ")", "\n", "_hparam", "(", "'delta'", ",", "2.0", ",", "lambda", "r", ":", "r", ".", "uniform", "(", "0.1", ",", "3.0", ")", ")", "\n", "_hparam", "(", "'d_steps_per_g'", ",", "10", ",", "lambda", "r", ":", "int", "(", "r", ".", "choice", "(", "[", "1", ",", "2", ",", "5", "]", ")", ")", ")", "\n", "_hparam", "(", "'weight_decay_d'", ",", "0.", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "6", ",", "-", "2", ")", ")", "\n", "_hparam", "(", "'gda'", ",", "False", ",", "lambda", "r", ":", "True", ")", "\n", "_hparam", "(", "'beta1'", ",", "0.5", ",", "lambda", "r", ":", "r", ".", "choice", "(", "[", "0.", ",", "0.5", "]", ")", ")", "\n", "_hparam", "(", "'lr_d'", ",", "1e-3", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "4.5", ",", "-", "2.5", ")", ")", "\n", "\n", "", "elif", "algorithm", "==", "\"Mixup\"", ":", "\n", "        ", "_hparam", "(", "'mixup_alpha'", ",", "0.2", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "1", ",", "-", "1", ")", ")", "\n", "\n", "", "elif", "algorithm", "==", "\"GroupDRO\"", ":", "\n", "        ", "_hparam", "(", "'groupdro_eta'", ",", "1e-2", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "3", ",", "-", "1", ")", ")", "\n", "\n", "", "elif", "algorithm", "==", "\"MMD\"", "or", "algorithm", "==", "\"CORAL\"", ":", "\n", "        ", "_hparam", "(", "'mmd_gamma'", ",", "1.", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "1", ",", "1", ")", ")", "\n", "\n", "", "elif", "algorithm", "==", "\"MLDG\"", ":", "\n", "        ", "_hparam", "(", "'mldg_beta'", ",", "1.", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "1", ",", "1", ")", ")", "\n", "\n", "", "elif", "algorithm", "==", "\"MTL\"", ":", "\n", "        ", "_hparam", "(", "'mtl_ema'", ",", ".99", ",", "lambda", "r", ":", "r", ".", "choice", "(", "[", "0.5", ",", "0.9", ",", "0.99", ",", "1.", "]", ")", ")", "\n", "\n", "", "elif", "algorithm", "==", "\"VREx\"", ":", "\n", "        ", "_hparam", "(", "'vrex_lambda'", ",", "1e1", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "1", ",", "5", ")", ")", "\n", "_hparam", "(", "'vrex_penalty_anneal_iters'", ",", "500", ",", "lambda", "r", ":", "int", "(", "10", "**", "r", ".", "uniform", "(", "0", ",", "4", ")", ")", ")", "\n", "\n", "", "elif", "algorithm", "==", "\"SD\"", ":", "\n", "        ", "_hparam", "(", "'sd_reg'", ",", "0.1", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "5", ",", "-", "1", ")", ")", "\n", "\n", "\n", "# Dataset-and-algorithm-specific hparam definitions. Each block of code", "\n", "# below corresponds to exactly one hparam. Avoid nested conditionals.", "\n", "\n", "", "if", "dataset", "in", "SMALL_IMAGES", ":", "\n", "        ", "_hparam", "(", "'lr'", ",", "1e-3", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "4.5", ",", "-", "2.5", ")", ")", "\n", "", "else", ":", "\n", "        ", "_hparam", "(", "'lr'", ",", "5e-5", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "5", ",", "-", "3.5", ")", ")", "\n", "\n", "\n", "", "if", "dataset", "in", "SMALL_IMAGES", ":", "\n", "        ", "_hparam", "(", "'weight_decay'", ",", "0.", ",", "lambda", "r", ":", "0.", ")", "\n", "", "else", ":", "\n", "        ", "_hparam", "(", "'weight_decay'", ",", "0.", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "6", ",", "-", "2", ")", ")", "\n", "\n", "\n", "", "if", "dataset", "in", "SMALL_IMAGES", ":", "\n", "        ", "_hparam", "(", "'batch_size'", ",", "64", ",", "lambda", "r", ":", "int", "(", "2", "**", "r", ".", "uniform", "(", "3", ",", "9", ")", ")", ")", "\n", "", "elif", "dataset", "==", "'WILDSFMoW'", ":", "\n", "        ", "_hparam", "(", "'batch_size'", ",", "16", ",", "lambda", "r", ":", "int", "(", "2", "**", "r", ".", "uniform", "(", "3", ",", "5", ")", ")", ")", "\n", "", "elif", "algorithm", "==", "'ARM'", ":", "\n", "        ", "_hparam", "(", "'batch_size'", ",", "8", ",", "lambda", "r", ":", "8", ")", "\n", "", "elif", "dataset", "==", "'DomainNet'", ":", "\n", "        ", "_hparam", "(", "'batch_size'", ",", "32", ",", "lambda", "r", ":", "int", "(", "2", "**", "r", ".", "uniform", "(", "3", ",", "5", ")", ")", ")", "\n", "", "else", ":", "\n", "        ", "_hparam", "(", "'batch_size'", ",", "32", ",", "lambda", "r", ":", "int", "(", "2", "**", "r", ".", "uniform", "(", "3", ",", "5.5", ")", ")", ")", "\n", "\n", "\n", "\n", "", "if", "algorithm", "in", "[", "'DANN'", ",", "'CDANN'", "]", "and", "dataset", "in", "SMALL_IMAGES", ":", "\n", "        ", "_hparam", "(", "'lr_g'", ",", "1e-3", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "4.5", ",", "-", "2.5", ")", ")", "\n", "", "elif", "algorithm", "in", "[", "'DANN'", ",", "'CDANN'", "]", ":", "\n", "        ", "_hparam", "(", "'lr_g'", ",", "1e-5", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "5", ",", "-", "3.5", ")", ")", "\n", "\n", "\n", "", "if", "algorithm", "in", "[", "'DANN'", ",", "'CDANN'", "]", "and", "dataset", "in", "SMALL_IMAGES", ":", "\n", "        ", "_hparam", "(", "'lr_d'", ",", "1e-3", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "4.5", ",", "-", "2.5", ")", ")", "\n", "", "elif", "algorithm", "in", "[", "'DANN'", ",", "'CDANN'", "]", ":", "\n", "        ", "_hparam", "(", "'lr_d'", ",", "1e-5", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "5", ",", "-", "3.5", ")", ")", "\n", "\n", "\n", "", "if", "algorithm", "in", "[", "'DANN'", ",", "'CDANN'", "]", "and", "dataset", "in", "SMALL_IMAGES", ":", "\n", "        ", "_hparam", "(", "'weight_decay_g'", ",", "0.", ",", "lambda", "r", ":", "0.", ")", "\n", "", "elif", "algorithm", "in", "[", "'DANN'", ",", "'CDANN'", "]", ":", "\n", "        ", "_hparam", "(", "'weight_decay_g'", ",", "0.", ",", "lambda", "r", ":", "10", "**", "r", ".", "uniform", "(", "-", "6", ",", "-", "2", ")", ")", "\n", "\n", "\n", "", "return", "hparams", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.hparams_registry.default_hparams": [[143, 146], ["_hparams().items", "hparams_registry._hparams"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.hparams_registry._hparams"], ["", "def", "default_hparams", "(", "algorithm", ",", "dataset", ")", ":", "\n", "    ", "return", "{", "a", ":", "b", "for", "a", ",", "(", "b", ",", "c", ")", "in", "\n", "_hparams", "(", "algorithm", ",", "dataset", ",", "0", ")", ".", "items", "(", ")", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.hparams_registry.random_hparams": [[147, 149], ["_hparams().items", "hparams_registry._hparams"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.hparams_registry._hparams"], ["", "def", "random_hparams", "(", "algorithm", ",", "dataset", ",", "seed", ")", ":", "\n", "    ", "return", "{", "a", ":", "c", "for", "a", ",", "(", "b", ",", "c", ")", "in", "_hparams", "(", "algorithm", ",", "dataset", ",", "seed", ")", ".", "items", "(", ")", "}", "\n", "", ""]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.Algorithm.__init__": [[46, 49], ["super().__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "Algorithm", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "hparams", "=", "hparams", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.Algorithm.update": [[50, 59], ["None"], "methods", ["None"], ["", "def", "update", "(", "self", ",", "minibatches", ",", "unlabeled", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n        Perform one update step, given a list of (x, y) tuples for all\n        environments.\n\n        Admits an optional list of unlabeled minibatches from the test domains,\n        when task is domain_adaptation.\n        \"\"\"", "\n", "raise", "NotImplementedError", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.Algorithm.predict": [[60, 62], ["None"], "methods", ["None"], ["", "def", "predict", "(", "self", ",", "x", ")", ":", "\n", "        ", "raise", "NotImplementedError", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.ERM.__init__": [[68, 82], ["algorithms.Algorithm.__init__", "domainbed.networks.Featurizer", "domainbed.networks.Classifier", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "algorithms.ERM.network.parameters"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.Featurizer", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.Classifier"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "ERM", ",", "self", ")", ".", "__init__", "(", "input_shape", ",", "num_classes", ",", "num_domains", ",", "\n", "hparams", ")", "\n", "self", ".", "featurizer", "=", "networks", ".", "Featurizer", "(", "input_shape", ",", "self", ".", "hparams", ")", "\n", "self", ".", "classifier", "=", "networks", ".", "Classifier", "(", "\n", "self", ".", "featurizer", ".", "n_outputs", ",", "\n", "num_classes", ",", "\n", "self", ".", "hparams", "[", "'nonlinear_classifier'", "]", ")", "\n", "\n", "self", ".", "network", "=", "nn", ".", "Sequential", "(", "self", ".", "featurizer", ",", "self", ".", "classifier", ")", "\n", "self", ".", "optimizer", "=", "torch", ".", "optim", ".", "Adam", "(", "\n", "self", ".", "network", ".", "parameters", "(", ")", ",", "\n", "lr", "=", "self", ".", "hparams", "[", "\"lr\"", "]", ",", "\n", "weight_decay", "=", "self", ".", "hparams", "[", "'weight_decay'", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.ERM.update": [[83, 93], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "algorithms.ERM.optimizer.zero_grad", "torch.cross_entropy.backward", "algorithms.ERM.optimizer.step", "algorithms.ERM.predict", "torch.cross_entropy.item"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.predict"], ["", "def", "update", "(", "self", ",", "minibatches", ",", "unlabeled", "=", "None", ")", ":", "\n", "        ", "all_x", "=", "torch", ".", "cat", "(", "[", "x", "for", "x", ",", "y", "in", "minibatches", "]", ")", "\n", "all_y", "=", "torch", ".", "cat", "(", "[", "y", "for", "x", ",", "y", "in", "minibatches", "]", ")", "\n", "loss", "=", "F", ".", "cross_entropy", "(", "self", ".", "predict", "(", "all_x", ")", ",", "all_y", ")", "\n", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "return", "{", "'loss'", ":", "loss", ".", "item", "(", ")", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.ERM.predict": [[94, 96], ["algorithms.ERM.classifier", "algorithms.ERM.featurizer"], "methods", ["None"], ["", "def", "predict", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "self", ".", "classifier", "(", "self", ".", "featurizer", "(", "x", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.ARM.__init__": [[102, 109], ["algorithms.ERM.__init__", "domainbed.networks.ContextNet"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ")", ":", "\n", "        ", "original_input_shape", "=", "input_shape", "\n", "input_shape", "=", "(", "1", "+", "original_input_shape", "[", "0", "]", ",", ")", "+", "original_input_shape", "[", "1", ":", "]", "\n", "super", "(", "ARM", ",", "self", ")", ".", "__init__", "(", "input_shape", ",", "num_classes", ",", "num_domains", ",", "\n", "hparams", ")", "\n", "self", ".", "context_net", "=", "networks", ".", "ContextNet", "(", "original_input_shape", ")", "\n", "self", ".", "support_size", "=", "hparams", "[", "'batch_size'", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.ARM.predict": [[110, 123], ["algorithms.ARM.context_net", "torch.repeat_interleave.reshape", "torch.repeat_interleave.reshape", "torch.repeat_interleave.reshape", "torch.repeat_interleave.reshape", "torch.repeat_interleave.mean", "torch.repeat_interleave.mean", "torch.repeat_interleave.mean", "torch.repeat_interleave.mean", "torch.repeat_interleave", "torch.repeat_interleave", "torch.repeat_interleave", "torch.repeat_interleave", "torch.repeat_interleave", "torch.repeat_interleave", "torch.repeat_interleave", "torch.repeat_interleave", "torch.repeat_interleave", "torch.repeat_interleave", "torch.repeat_interleave", "torch.repeat_interleave", "torch.repeat_interleave", "torch.repeat_interleave", "torch.repeat_interleave", "torch.repeat_interleave", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "algorithms.ARM.network"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean"], ["", "def", "predict", "(", "self", ",", "x", ")", ":", "\n", "        ", "batch_size", ",", "c", ",", "h", ",", "w", "=", "x", ".", "shape", "\n", "if", "batch_size", "%", "self", ".", "support_size", "==", "0", ":", "\n", "            ", "meta_batch_size", "=", "batch_size", "//", "self", ".", "support_size", "\n", "support_size", "=", "self", ".", "support_size", "\n", "", "else", ":", "\n", "            ", "meta_batch_size", ",", "support_size", "=", "1", ",", "batch_size", "\n", "", "context", "=", "self", ".", "context_net", "(", "x", ")", "\n", "context", "=", "context", ".", "reshape", "(", "(", "meta_batch_size", ",", "support_size", ",", "1", ",", "h", ",", "w", ")", ")", "\n", "context", "=", "context", ".", "mean", "(", "dim", "=", "1", ")", "\n", "context", "=", "torch", ".", "repeat_interleave", "(", "context", ",", "repeats", "=", "support_size", ",", "dim", "=", "0", ")", "\n", "x", "=", "torch", ".", "cat", "(", "[", "x", ",", "context", "]", ",", "dim", "=", "1", ")", "\n", "return", "self", ".", "network", "(", "x", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.AbstractDANN.__init__": [[128, 163], ["algorithms.Algorithm.__init__", "algorithms.AbstractDANN.register_buffer", "domainbed.networks.Featurizer", "domainbed.networks.Classifier", "domainbed.networks.MLP", "torch.Embedding", "torch.Embedding", "torch.Embedding", "torch.Embedding", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "list", "list", "list", "list", "algorithms.AbstractDANN.discriminator.parameters", "algorithms.AbstractDANN.class_embeddings.parameters", "algorithms.AbstractDANN.featurizer.parameters", "algorithms.AbstractDANN.classifier.parameters"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.Featurizer", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.Classifier"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "\n", "hparams", ",", "conditional", ",", "class_balance", ")", ":", "\n", "\n", "        ", "super", "(", "AbstractDANN", ",", "self", ")", ".", "__init__", "(", "input_shape", ",", "num_classes", ",", "num_domains", ",", "\n", "hparams", ")", "\n", "\n", "self", ".", "register_buffer", "(", "'update_count'", ",", "torch", ".", "tensor", "(", "[", "0", "]", ")", ")", "\n", "self", ".", "conditional", "=", "conditional", "\n", "self", ".", "class_balance", "=", "class_balance", "\n", "\n", "# Algorithms", "\n", "self", ".", "featurizer", "=", "networks", ".", "Featurizer", "(", "input_shape", ",", "self", ".", "hparams", ")", "\n", "self", ".", "classifier", "=", "networks", ".", "Classifier", "(", "\n", "self", ".", "featurizer", ".", "n_outputs", ",", "\n", "num_classes", ",", "\n", "self", ".", "hparams", "[", "'nonlinear_classifier'", "]", ")", "\n", "self", ".", "discriminator", "=", "networks", ".", "MLP", "(", "self", ".", "featurizer", ".", "n_outputs", ",", "\n", "num_domains", ",", "self", ".", "hparams", ")", "\n", "self", ".", "class_embeddings", "=", "nn", ".", "Embedding", "(", "num_classes", ",", "\n", "self", ".", "featurizer", ".", "n_outputs", ")", "\n", "\n", "# Optimizers", "\n", "self", ".", "disc_opt", "=", "torch", ".", "optim", ".", "Adam", "(", "\n", "(", "list", "(", "self", ".", "discriminator", ".", "parameters", "(", ")", ")", "+", "\n", "list", "(", "self", ".", "class_embeddings", ".", "parameters", "(", ")", ")", ")", ",", "\n", "lr", "=", "self", ".", "hparams", "[", "\"lr_d\"", "]", ",", "\n", "weight_decay", "=", "self", ".", "hparams", "[", "'weight_decay_d'", "]", ",", "\n", "betas", "=", "(", "self", ".", "hparams", "[", "'beta1'", "]", ",", "0.9", ")", ")", "\n", "\n", "self", ".", "gen_opt", "=", "torch", ".", "optim", ".", "Adam", "(", "\n", "(", "list", "(", "self", ".", "featurizer", ".", "parameters", "(", ")", ")", "+", "\n", "list", "(", "self", ".", "classifier", ".", "parameters", "(", ")", ")", ")", ",", "\n", "lr", "=", "self", ".", "hparams", "[", "\"lr_g\"", "]", ",", "\n", "weight_decay", "=", "self", ".", "hparams", "[", "'weight_decay_g'", "]", ",", "\n", "betas", "=", "(", "self", ".", "hparams", "[", "'beta1'", "]", ",", "0.9", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.AbstractDANN.update": [[164, 211], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "algorithms.AbstractDANN.featurizer", "algorithms.AbstractDANN.discriminator", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.softmax", "torch.softmax", "torch.softmax", "torch.softmax", "torch.one_hot().sum", "torch.one_hot().sum", "torch.one_hot().sum", "torch.one_hot().sum", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.grad", "torch.grad", "torch.grad", "torch.grad", "algorithms.AbstractDANN.disc_opt.zero_grad", "torch.cross_entropy.backward", "algorithms.AbstractDANN.disc_opt.step", "algorithms.AbstractDANN.classifier", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "algorithms.AbstractDANN.disc_opt.zero_grad", "algorithms.AbstractDANN.gen_opt.zero_grad", "gen_loss.backward", "algorithms.AbstractDANN.gen_opt.step", "algorithms.AbstractDANN.class_embeddings", "torch.full", "torch.full", "torch.full", "torch.full", "torch.full", "torch.full", "torch.full", "torch.full", "torch.full", "torch.full", "torch.full", "torch.full", "torch.full", "torch.full", "torch.full", "torch.full", "disc_softmax[].sum", "algorithms.AbstractDANN.update_count.item", "torch.cross_entropy.item", "gen_loss.item", "enumerate", "torch.one_hot", "torch.one_hot", "torch.one_hot", "torch.one_hot"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum"], ["", "def", "update", "(", "self", ",", "minibatches", ",", "unlabeled", "=", "None", ")", ":", "\n", "        ", "device", "=", "\"cuda\"", "if", "minibatches", "[", "0", "]", "[", "0", "]", ".", "is_cuda", "else", "\"cpu\"", "\n", "self", ".", "update_count", "+=", "1", "\n", "all_x", "=", "torch", ".", "cat", "(", "[", "x", "for", "x", ",", "y", "in", "minibatches", "]", ")", "\n", "all_y", "=", "torch", ".", "cat", "(", "[", "y", "for", "x", ",", "y", "in", "minibatches", "]", ")", "\n", "all_z", "=", "self", ".", "featurizer", "(", "all_x", ")", "\n", "if", "self", ".", "conditional", ":", "\n", "            ", "disc_input", "=", "all_z", "+", "self", ".", "class_embeddings", "(", "all_y", ")", "\n", "", "else", ":", "\n", "            ", "disc_input", "=", "all_z", "\n", "", "disc_out", "=", "self", ".", "discriminator", "(", "disc_input", ")", "\n", "disc_labels", "=", "torch", ".", "cat", "(", "[", "\n", "torch", ".", "full", "(", "(", "x", ".", "shape", "[", "0", "]", ",", ")", ",", "i", ",", "dtype", "=", "torch", ".", "int64", ",", "device", "=", "device", ")", "\n", "for", "i", ",", "(", "x", ",", "y", ")", "in", "enumerate", "(", "minibatches", ")", "\n", "]", ")", "\n", "\n", "if", "self", ".", "class_balance", ":", "\n", "            ", "y_counts", "=", "F", ".", "one_hot", "(", "all_y", ")", ".", "sum", "(", "dim", "=", "0", ")", "\n", "weights", "=", "1.", "/", "(", "y_counts", "[", "all_y", "]", "*", "y_counts", ".", "shape", "[", "0", "]", ")", ".", "float", "(", ")", "\n", "disc_loss", "=", "F", ".", "cross_entropy", "(", "disc_out", ",", "disc_labels", ",", "reduction", "=", "'none'", ")", "\n", "disc_loss", "=", "(", "weights", "*", "disc_loss", ")", ".", "sum", "(", ")", "\n", "", "else", ":", "\n", "            ", "disc_loss", "=", "F", ".", "cross_entropy", "(", "disc_out", ",", "disc_labels", ")", "\n", "\n", "", "disc_softmax", "=", "F", ".", "softmax", "(", "disc_out", ",", "dim", "=", "1", ")", "\n", "input_grad", "=", "autograd", ".", "grad", "(", "disc_softmax", "[", ":", ",", "disc_labels", "]", ".", "sum", "(", ")", ",", "\n", "[", "disc_input", "]", ",", "create_graph", "=", "True", ")", "[", "0", "]", "\n", "grad_penalty", "=", "(", "input_grad", "**", "2", ")", ".", "sum", "(", "dim", "=", "1", ")", ".", "mean", "(", "dim", "=", "0", ")", "\n", "disc_loss", "+=", "self", ".", "hparams", "[", "'grad_penalty'", "]", "*", "grad_penalty", "\n", "\n", "d_steps_per_g", "=", "self", ".", "hparams", "[", "'d_steps_per_g_step'", "]", "\n", "if", "(", "self", ".", "update_count", ".", "item", "(", ")", "%", "(", "1", "+", "d_steps_per_g", ")", "<", "d_steps_per_g", ")", ":", "\n", "\n", "            ", "self", ".", "disc_opt", ".", "zero_grad", "(", ")", "\n", "disc_loss", ".", "backward", "(", ")", "\n", "self", ".", "disc_opt", ".", "step", "(", ")", "\n", "return", "{", "'disc_loss'", ":", "disc_loss", ".", "item", "(", ")", "}", "\n", "", "else", ":", "\n", "            ", "all_preds", "=", "self", ".", "classifier", "(", "all_z", ")", "\n", "classifier_loss", "=", "F", ".", "cross_entropy", "(", "all_preds", ",", "all_y", ")", "\n", "gen_loss", "=", "(", "classifier_loss", "+", "\n", "(", "self", ".", "hparams", "[", "'lambda'", "]", "*", "-", "disc_loss", ")", ")", "\n", "self", ".", "disc_opt", ".", "zero_grad", "(", ")", "\n", "self", ".", "gen_opt", ".", "zero_grad", "(", ")", "\n", "gen_loss", ".", "backward", "(", ")", "\n", "self", ".", "gen_opt", ".", "step", "(", ")", "\n", "return", "{", "'gen_loss'", ":", "gen_loss", ".", "item", "(", ")", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.AbstractDANN.predict": [[212, 214], ["algorithms.AbstractDANN.classifier", "algorithms.AbstractDANN.featurizer"], "methods", ["None"], ["", "", "def", "predict", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "self", ".", "classifier", "(", "self", ".", "featurizer", "(", "x", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.DANN.__init__": [[217, 220], ["algorithms.AbstractDANN.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "DANN", ",", "self", ")", ".", "__init__", "(", "input_shape", ",", "num_classes", ",", "num_domains", ",", "\n", "hparams", ",", "conditional", "=", "False", ",", "class_balance", "=", "False", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.CDANN.__init__": [[224, 227], ["algorithms.AbstractDANN.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "CDANN", ",", "self", ")", ".", "__init__", "(", "input_shape", ",", "num_classes", ",", "num_domains", ",", "\n", "hparams", ",", "conditional", "=", "True", ",", "class_balance", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.IRM.__init__": [[232, 236], ["algorithms.ERM.__init__", "algorithms.IRM.register_buffer", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "IRM", ",", "self", ")", ".", "__init__", "(", "input_shape", ",", "num_classes", ",", "num_domains", ",", "\n", "hparams", ")", "\n", "self", ".", "register_buffer", "(", "'update_count'", ",", "torch", ".", "tensor", "(", "[", "0", "]", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.IRM._irm_penalty": [[237, 247], ["torch.tensor().to().requires_grad_", "torch.tensor().to().requires_grad_", "torch.tensor().to().requires_grad_", "torch.tensor().to().requires_grad_", "torch.tensor().to().requires_grad_", "torch.tensor().to().requires_grad_", "torch.tensor().to().requires_grad_", "torch.tensor().to().requires_grad_", "torch.tensor().to().requires_grad_", "torch.tensor().to().requires_grad_", "torch.tensor().to().requires_grad_", "torch.tensor().to().requires_grad_", "torch.tensor().to().requires_grad_", "torch.tensor().to().requires_grad_", "torch.tensor().to().requires_grad_", "torch.tensor().to().requires_grad_", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.sum", "torch.grad", "torch.grad", "torch.grad", "torch.grad", "torch.grad", "torch.grad", "torch.grad", "torch.grad", "torch.tensor().to", "torch.tensor().to", "torch.tensor().to", "torch.tensor().to", "torch.tensor().to", "torch.tensor().to", "torch.tensor().to", "torch.tensor().to", "torch.tensor().to", "torch.tensor().to", "torch.tensor().to", "torch.tensor().to", "torch.tensor().to", "torch.tensor().to", "torch.tensor().to", "torch.tensor().to", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum"], ["", "@", "staticmethod", "\n", "def", "_irm_penalty", "(", "logits", ",", "y", ")", ":", "\n", "        ", "device", "=", "\"cuda\"", "if", "logits", "[", "0", "]", "[", "0", "]", ".", "is_cuda", "else", "\"cpu\"", "\n", "scale", "=", "torch", ".", "tensor", "(", "1.", ")", ".", "to", "(", "device", ")", ".", "requires_grad_", "(", ")", "\n", "loss_1", "=", "F", ".", "cross_entropy", "(", "logits", "[", ":", ":", "2", "]", "*", "scale", ",", "y", "[", ":", ":", "2", "]", ")", "\n", "loss_2", "=", "F", ".", "cross_entropy", "(", "logits", "[", "1", ":", ":", "2", "]", "*", "scale", ",", "y", "[", "1", ":", ":", "2", "]", ")", "\n", "grad_1", "=", "autograd", ".", "grad", "(", "loss_1", ",", "[", "scale", "]", ",", "create_graph", "=", "True", ")", "[", "0", "]", "\n", "grad_2", "=", "autograd", ".", "grad", "(", "loss_2", ",", "[", "scale", "]", ",", "create_graph", "=", "True", ")", "[", "0", "]", "\n", "result", "=", "torch", ".", "sum", "(", "grad_1", "*", "grad_2", ")", "\n", "return", "result", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.IRM.update": [[248, 283], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "algorithms.IRM.network", "enumerate", "len", "len", "algorithms.IRM.optimizer.zero_grad", "loss.backward", "algorithms.IRM.optimizer.step", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "algorithms.IRM._irm_penalty", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "loss.item", "nll.item", "penalty.item", "algorithms.IRM.network.parameters"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.IRM._irm_penalty"], ["", "def", "update", "(", "self", ",", "minibatches", ",", "unlabeled", "=", "None", ")", ":", "\n", "        ", "device", "=", "\"cuda\"", "if", "minibatches", "[", "0", "]", "[", "0", "]", ".", "is_cuda", "else", "\"cpu\"", "\n", "penalty_weight", "=", "(", "self", ".", "hparams", "[", "'irm_lambda'", "]", "if", "self", ".", "update_count", "\n", ">=", "self", ".", "hparams", "[", "'irm_penalty_anneal_iters'", "]", "else", "\n", "1.0", ")", "\n", "nll", "=", "0.", "\n", "penalty", "=", "0.", "\n", "\n", "all_x", "=", "torch", ".", "cat", "(", "[", "x", "for", "x", ",", "y", "in", "minibatches", "]", ")", "\n", "all_logits", "=", "self", ".", "network", "(", "all_x", ")", "\n", "all_logits_idx", "=", "0", "\n", "for", "i", ",", "(", "x", ",", "y", ")", "in", "enumerate", "(", "minibatches", ")", ":", "\n", "            ", "logits", "=", "all_logits", "[", "all_logits_idx", ":", "all_logits_idx", "+", "x", ".", "shape", "[", "0", "]", "]", "\n", "all_logits_idx", "+=", "x", ".", "shape", "[", "0", "]", "\n", "nll", "+=", "F", ".", "cross_entropy", "(", "logits", ",", "y", ")", "\n", "penalty", "+=", "self", ".", "_irm_penalty", "(", "logits", ",", "y", ")", "\n", "", "nll", "/=", "len", "(", "minibatches", ")", "\n", "penalty", "/=", "len", "(", "minibatches", ")", "\n", "loss", "=", "nll", "+", "(", "penalty_weight", "*", "penalty", ")", "\n", "\n", "if", "self", ".", "update_count", "==", "self", ".", "hparams", "[", "'irm_penalty_anneal_iters'", "]", ":", "\n", "# Reset Adam, because it doesn't like the sharp jump in gradient", "\n", "# magnitudes that happens at this step.", "\n", "            ", "self", ".", "optimizer", "=", "torch", ".", "optim", ".", "Adam", "(", "\n", "self", ".", "network", ".", "parameters", "(", ")", ",", "\n", "lr", "=", "self", ".", "hparams", "[", "\"lr\"", "]", ",", "\n", "weight_decay", "=", "self", ".", "hparams", "[", "'weight_decay'", "]", ")", "\n", "\n", "", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "self", ".", "update_count", "+=", "1", "\n", "return", "{", "'loss'", ":", "loss", ".", "item", "(", ")", ",", "'nll'", ":", "nll", ".", "item", "(", ")", ",", "\n", "'penalty'", ":", "penalty", ".", "item", "(", ")", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.VREx.__init__": [[287, 291], ["algorithms.ERM.__init__", "algorithms.VREx.register_buffer", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "VREx", ",", "self", ")", ".", "__init__", "(", "input_shape", ",", "num_classes", ",", "num_domains", ",", "\n", "hparams", ")", "\n", "self", ".", "register_buffer", "(", "'update_count'", ",", "torch", ".", "tensor", "(", "[", "0", "]", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.VREx.update": [[292, 329], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "algorithms.VREx.network", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "enumerate", "torch.zeros.mean", "torch.zeros.mean", "torch.zeros.mean", "torch.zeros.mean", "algorithms.VREx.optimizer.zero_grad", "loss.backward", "algorithms.VREx.optimizer.step", "len", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "loss.item", "torch.cross_entropy.item", "penalty.item", "algorithms.VREx.network.parameters"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "def", "update", "(", "self", ",", "minibatches", ",", "unlabeled", "=", "None", ")", ":", "\n", "        ", "if", "self", ".", "update_count", ">=", "self", ".", "hparams", "[", "\"vrex_penalty_anneal_iters\"", "]", ":", "\n", "            ", "penalty_weight", "=", "self", ".", "hparams", "[", "\"vrex_lambda\"", "]", "\n", "", "else", ":", "\n", "            ", "penalty_weight", "=", "1.0", "\n", "\n", "", "nll", "=", "0.", "\n", "\n", "all_x", "=", "torch", ".", "cat", "(", "[", "x", "for", "x", ",", "y", "in", "minibatches", "]", ")", "\n", "all_logits", "=", "self", ".", "network", "(", "all_x", ")", "\n", "all_logits_idx", "=", "0", "\n", "losses", "=", "torch", ".", "zeros", "(", "len", "(", "minibatches", ")", ")", "\n", "for", "i", ",", "(", "x", ",", "y", ")", "in", "enumerate", "(", "minibatches", ")", ":", "\n", "            ", "logits", "=", "all_logits", "[", "all_logits_idx", ":", "all_logits_idx", "+", "x", ".", "shape", "[", "0", "]", "]", "\n", "all_logits_idx", "+=", "x", ".", "shape", "[", "0", "]", "\n", "nll", "=", "F", ".", "cross_entropy", "(", "logits", ",", "y", ")", "\n", "losses", "[", "i", "]", "=", "nll", "\n", "\n", "", "mean", "=", "losses", ".", "mean", "(", ")", "\n", "penalty", "=", "(", "(", "losses", "-", "mean", ")", "**", "2", ")", ".", "mean", "(", ")", "\n", "loss", "=", "mean", "+", "penalty_weight", "*", "penalty", "\n", "\n", "if", "self", ".", "update_count", "==", "self", ".", "hparams", "[", "'vrex_penalty_anneal_iters'", "]", ":", "\n", "# Reset Adam (like IRM), because it doesn't like the sharp jump in", "\n", "# gradient magnitudes that happens at this step.", "\n", "            ", "self", ".", "optimizer", "=", "torch", ".", "optim", ".", "Adam", "(", "\n", "self", ".", "network", ".", "parameters", "(", ")", ",", "\n", "lr", "=", "self", ".", "hparams", "[", "\"lr\"", "]", ",", "\n", "weight_decay", "=", "self", ".", "hparams", "[", "'weight_decay'", "]", ")", "\n", "\n", "", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "self", ".", "update_count", "+=", "1", "\n", "return", "{", "'loss'", ":", "loss", ".", "item", "(", ")", ",", "'nll'", ":", "nll", ".", "item", "(", ")", ",", "\n", "'penalty'", ":", "penalty", ".", "item", "(", ")", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.Mixup.__init__": [[337, 340], ["algorithms.ERM.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "Mixup", ",", "self", ")", ".", "__init__", "(", "input_shape", ",", "num_classes", ",", "num_domains", ",", "\n", "hparams", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.Mixup.update": [[341, 361], ["domainbed.lib.misc.random_pairs_of_minibatches", "len", "algorithms.Mixup.optimizer.zero_grad", "objective.backward", "algorithms.Mixup.optimizer.step", "numpy.random.beta", "algorithms.Mixup.predict", "objective.item", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.random_pairs_of_minibatches", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.predict"], ["", "def", "update", "(", "self", ",", "minibatches", ",", "unlabeled", "=", "None", ")", ":", "\n", "        ", "objective", "=", "0", "\n", "\n", "for", "(", "xi", ",", "yi", ")", ",", "(", "xj", ",", "yj", ")", "in", "random_pairs_of_minibatches", "(", "minibatches", ")", ":", "\n", "            ", "lam", "=", "np", ".", "random", ".", "beta", "(", "self", ".", "hparams", "[", "\"mixup_alpha\"", "]", ",", "\n", "self", ".", "hparams", "[", "\"mixup_alpha\"", "]", ")", "\n", "\n", "x", "=", "lam", "*", "xi", "+", "(", "1", "-", "lam", ")", "*", "xj", "\n", "predictions", "=", "self", ".", "predict", "(", "x", ")", "\n", "\n", "objective", "+=", "lam", "*", "F", ".", "cross_entropy", "(", "predictions", ",", "yi", ")", "\n", "objective", "+=", "(", "1", "-", "lam", ")", "*", "F", ".", "cross_entropy", "(", "predictions", ",", "yj", ")", "\n", "\n", "", "objective", "/=", "len", "(", "minibatches", ")", "\n", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "objective", ".", "backward", "(", ")", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "return", "{", "'loss'", ":", "objective", ".", "item", "(", ")", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.Transfer.__init__": [[381, 408], ["algorithms.Algorithm.__init__", "algorithms.Transfer.register_buffer", "domainbed.networks.Featurizer", "domainbed.networks.Classifier", "domainbed.networks.Classifier", "algorithms.Transfer.adv_classifier.load_state_dict", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "algorithms.Transfer.classifier.state_dict", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.SGD", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "algorithms.Transfer.adv_classifier.parameters", "algorithms.Transfer.adv_classifier.parameters", "list", "list", "algorithms.Transfer.featurizer.parameters", "algorithms.Transfer.classifier.parameters"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.Featurizer", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.Classifier", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.Classifier"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "Transfer", ",", "self", ")", ".", "__init__", "(", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ")", "\n", "self", ".", "register_buffer", "(", "'update_count'", ",", "torch", ".", "tensor", "(", "[", "0", "]", ")", ")", "\n", "self", ".", "d_steps_per_g", "=", "hparams", "[", "'d_steps_per_g'", "]", "\n", "\n", "# Architecture ", "\n", "self", ".", "featurizer", "=", "networks", ".", "Featurizer", "(", "input_shape", ",", "self", ".", "hparams", ")", "\n", "self", ".", "classifier", "=", "networks", ".", "Classifier", "(", "\n", "self", ".", "featurizer", ".", "n_outputs", ",", "\n", "num_classes", ",", "\n", "self", ".", "hparams", "[", "'nonlinear_classifier'", "]", ")", "\n", "self", ".", "adv_classifier", "=", "networks", ".", "Classifier", "(", "\n", "self", ".", "featurizer", ".", "n_outputs", ",", "\n", "num_classes", ",", "\n", "self", ".", "hparams", "[", "'nonlinear_classifier'", "]", ")", "\n", "self", ".", "adv_classifier", ".", "load_state_dict", "(", "self", ".", "classifier", ".", "state_dict", "(", ")", ")", "\n", "\n", "# Optimizers", "\n", "if", "self", ".", "hparams", "[", "'gda'", "]", ":", "\n", "            ", "self", ".", "optimizer", "=", "torch", ".", "optim", ".", "SGD", "(", "self", ".", "adv_classifier", ".", "parameters", "(", ")", ",", "lr", "=", "self", ".", "hparams", "[", "'lr'", "]", ")", "\n", "", "else", ":", "\n", "            ", "self", ".", "optimizer", "=", "torch", ".", "optim", ".", "Adam", "(", "\n", "(", "list", "(", "self", ".", "featurizer", ".", "parameters", "(", ")", ")", "+", "list", "(", "self", ".", "classifier", ".", "parameters", "(", ")", ")", ")", ",", "\n", "lr", "=", "self", ".", "hparams", "[", "\"lr\"", "]", ",", "\n", "weight_decay", "=", "self", ".", "hparams", "[", "'weight_decay'", "]", ")", "\n", "\n", "", "self", ".", "adv_opt", "=", "torch", ".", "optim", ".", "SGD", "(", "self", ".", "adv_classifier", ".", "parameters", "(", ")", ",", "lr", "=", "self", ".", "hparams", "[", "'lr_d'", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.Transfer.update": [[411, 434], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "algorithms.Transfer.optimizer.zero_grad", "torch.cross_entropy.backward", "algorithms.Transfer.optimizer.step", "algorithms.Transfer.optimizer.zero_grad", "gap.backward", "algorithms.Transfer.optimizer.step", "algorithms.Transfer.adv_classifier.load_state_dict", "range", "algorithms.Transfer.predict", "algorithms.loss_gap", "algorithms.Transfer.classifier.state_dict", "algorithms.Transfer.adv_opt.zero_grad", "gap.backward", "algorithms.Transfer.adv_opt.step", "domainbed.misc_t.proj", "torch.cross_entropy.item", "algorithms.loss_gap", "gap.item"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.predict", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.loss_gap", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.proj", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.loss_gap"], ["", "def", "update", "(", "self", ",", "minibatches", ",", "unlabeled", "=", "None", ")", ":", "\n", "        ", "device", "=", "\"cuda\"", "if", "minibatches", "[", "0", "]", "[", "0", "]", ".", "is_cuda", "else", "\"cpu\"", "\n", "# outer loop", "\n", "all_x", "=", "torch", ".", "cat", "(", "[", "x", "for", "x", ",", "y", "in", "minibatches", "]", ")", "\n", "all_y", "=", "torch", ".", "cat", "(", "[", "y", "for", "x", ",", "y", "in", "minibatches", "]", ")", "\n", "loss", "=", "F", ".", "cross_entropy", "(", "self", ".", "predict", "(", "all_x", ")", ",", "all_y", ")", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "del", "all_x", ",", "all_y", "\n", "gap", "=", "self", ".", "hparams", "[", "'t_lambda'", "]", "*", "loss_gap", "(", "minibatches", ",", "self", ",", "device", ")", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "gap", ".", "backward", "(", ")", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "self", ".", "adv_classifier", ".", "load_state_dict", "(", "self", ".", "classifier", ".", "state_dict", "(", ")", ")", "\n", "for", "_", "in", "range", "(", "self", ".", "d_steps_per_g", ")", ":", "\n", "            ", "self", ".", "adv_opt", ".", "zero_grad", "(", ")", "\n", "gap", "=", "-", "self", ".", "hparams", "[", "'t_lambda'", "]", "*", "loss_gap", "(", "minibatches", ",", "self", ",", "device", ")", "\n", "gap", ".", "backward", "(", ")", "\n", "self", ".", "adv_opt", ".", "step", "(", ")", "\n", "self", ".", "adv_classifier", "=", "proj", "(", "self", ".", "hparams", "[", "'delta'", "]", ",", "self", ".", "adv_classifier", ",", "self", ".", "classifier", ")", "\n", "", "return", "{", "'loss'", ":", "loss", ".", "item", "(", ")", ",", "'gap'", ":", "-", "gap", ".", "item", "(", ")", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.Transfer.update_second": [[435, 460], ["algorithms.Transfer.update_count.item", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "algorithms.Transfer.optimizer.zero_grad", "torch.cross_entropy.backward", "algorithms.Transfer.optimizer.step", "algorithms.Transfer.optimizer.zero_grad", "gap.backward", "algorithms.Transfer.optimizer.step", "algorithms.Transfer.adv_classifier.load_state_dict", "algorithms.Transfer.adv_opt.zero_grad", "gap.backward", "algorithms.Transfer.adv_opt.step", "domainbed.misc_t.proj", "algorithms.Transfer.predict", "algorithms.loss_gap", "algorithms.Transfer.classifier.state_dict", "torch.cross_entropy.item", "gap.item", "algorithms.loss_gap", "gap.item"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.proj", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.predict", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.loss_gap", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.loss_gap"], ["", "def", "update_second", "(", "self", ",", "minibatches", ",", "unlabeled", "=", "None", ")", ":", "\n", "        ", "device", "=", "\"cuda\"", "if", "minibatches", "[", "0", "]", "[", "0", "]", ".", "is_cuda", "else", "\"cpu\"", "\n", "self", ".", "update_count", "=", "(", "self", ".", "update_count", "+", "1", ")", "%", "(", "1", "+", "self", ".", "d_steps_per_g", ")", "\n", "if", "self", ".", "update_count", ".", "item", "(", ")", "==", "1", ":", "\n", "            ", "all_x", "=", "torch", ".", "cat", "(", "[", "x", "for", "x", ",", "y", "in", "minibatches", "]", ")", "\n", "all_y", "=", "torch", ".", "cat", "(", "[", "y", "for", "x", ",", "y", "in", "minibatches", "]", ")", "\n", "loss", "=", "F", ".", "cross_entropy", "(", "self", ".", "predict", "(", "all_x", ")", ",", "all_y", ")", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "del", "all_x", ",", "all_y", "\n", "gap", "=", "self", ".", "hparams", "[", "'t_lambda'", "]", "*", "loss_gap", "(", "minibatches", ",", "self", ",", "device", ")", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "gap", ".", "backward", "(", ")", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "self", ".", "adv_classifier", ".", "load_state_dict", "(", "self", ".", "classifier", ".", "state_dict", "(", ")", ")", "\n", "return", "{", "'loss'", ":", "loss", ".", "item", "(", ")", ",", "'gap'", ":", "gap", ".", "item", "(", ")", "}", "\n", "", "else", ":", "\n", "            ", "self", ".", "adv_opt", ".", "zero_grad", "(", ")", "\n", "gap", "=", "-", "self", ".", "hparams", "[", "'t_lambda'", "]", "*", "loss_gap", "(", "minibatches", ",", "self", ",", "device", ")", "\n", "gap", ".", "backward", "(", ")", "\n", "self", ".", "adv_opt", ".", "step", "(", ")", "\n", "self", ".", "adv_classifier", "=", "proj", "(", "self", ".", "hparams", "[", "'delta'", "]", ",", "self", ".", "adv_classifier", ",", "self", ".", "classifier", ")", "\n", "return", "{", "'gap'", ":", "-", "gap", ".", "item", "(", ")", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.Transfer.predict": [[462, 464], ["algorithms.Transfer.classifier", "algorithms.Transfer.featurizer"], "methods", ["None"], ["", "", "def", "predict", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "self", ".", "classifier", "(", "self", ".", "featurizer", "(", "x", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.GroupDRO.__init__": [[474, 478], ["algorithms.ERM.__init__", "algorithms.GroupDRO.register_buffer", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "GroupDRO", ",", "self", ")", ".", "__init__", "(", "input_shape", ",", "num_classes", ",", "num_domains", ",", "\n", "hparams", ")", "\n", "self", ".", "register_buffer", "(", "\"q\"", ",", "torch", ".", "Tensor", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.GroupDRO.update": [[479, 501], ["torch.zeros().to", "torch.zeros().to", "torch.zeros().to", "torch.zeros().to", "torch.zeros().to", "torch.zeros().to", "torch.zeros().to", "torch.zeros().to", "torch.zeros().to", "torch.zeros().to", "torch.zeros().to", "torch.zeros().to", "torch.zeros().to", "torch.zeros().to", "torch.zeros().to", "torch.zeros().to", "range", "algorithms.GroupDRO.q.sum", "torch.dot", "torch.dot", "torch.dot", "torch.dot", "torch.dot", "torch.dot", "torch.dot", "torch.dot", "torch.dot", "torch.dot", "torch.dot", "torch.dot", "torch.dot", "torch.dot", "torch.dot", "torch.dot", "algorithms.GroupDRO.optimizer.zero_grad", "torch.dot.backward", "torch.dot.backward", "torch.dot.backward", "torch.dot.backward", "algorithms.GroupDRO.optimizer.step", "len", "torch.ones().to", "torch.ones().to", "torch.ones().to", "torch.ones().to", "torch.ones().to", "torch.ones().to", "torch.ones().to", "torch.ones().to", "torch.ones().to", "torch.ones().to", "torch.ones().to", "torch.ones().to", "torch.ones().to", "torch.ones().to", "torch.ones().to", "torch.ones().to", "len", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.dot.item", "torch.dot.item", "torch.dot.item", "torch.dot.item", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "algorithms.GroupDRO.predict", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "torch.ones", "len", "len"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.predict", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "def", "update", "(", "self", ",", "minibatches", ",", "unlabeled", "=", "None", ")", ":", "\n", "        ", "device", "=", "\"cuda\"", "if", "minibatches", "[", "0", "]", "[", "0", "]", ".", "is_cuda", "else", "\"cpu\"", "\n", "\n", "if", "not", "len", "(", "self", ".", "q", ")", ":", "\n", "            ", "self", ".", "q", "=", "torch", ".", "ones", "(", "len", "(", "minibatches", ")", ")", ".", "to", "(", "device", ")", "\n", "\n", "", "losses", "=", "torch", ".", "zeros", "(", "len", "(", "minibatches", ")", ")", ".", "to", "(", "device", ")", "\n", "\n", "for", "m", "in", "range", "(", "len", "(", "minibatches", ")", ")", ":", "\n", "            ", "x", ",", "y", "=", "minibatches", "[", "m", "]", "\n", "losses", "[", "m", "]", "=", "F", ".", "cross_entropy", "(", "self", ".", "predict", "(", "x", ")", ",", "y", ")", "\n", "self", ".", "q", "[", "m", "]", "*=", "(", "self", ".", "hparams", "[", "\"groupdro_eta\"", "]", "*", "losses", "[", "m", "]", ".", "data", ")", ".", "exp", "(", ")", "\n", "\n", "", "self", ".", "q", "/=", "self", ".", "q", ".", "sum", "(", ")", "\n", "\n", "loss", "=", "torch", ".", "dot", "(", "losses", ",", "self", ".", "q", ")", "\n", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "return", "{", "'loss'", ":", "loss", ".", "item", "(", ")", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.MLDG.__init__": [[510, 513], ["algorithms.ERM.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "MLDG", ",", "self", ")", ".", "__init__", "(", "input_shape", ",", "num_classes", ",", "num_domains", ",", "\n", "hparams", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.MLDG.update": [[514, 585], ["len", "algorithms.MLDG.optimizer.zero_grad", "algorithms.MLDG.network.parameters", "domainbed.lib.misc.random_pairs_of_minibatches", "len", "algorithms.MLDG.optimizer.step", "copy.deepcopy", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.optim.Adam.zero_grad", "torch.optim.Adam.zero_grad", "torch.optim.Adam.zero_grad", "torch.optim.Adam.zero_grad", "torch.cross_entropy.backward", "torch.optim.Adam.step", "torch.optim.Adam.step", "torch.optim.Adam.step", "torch.optim.Adam.step", "zip", "torch.cross_entropy.item", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.grad", "torch.grad", "torch.grad", "torch.grad", "zip", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "copy.deepcopy.parameters", "copy.deepcopy.", "algorithms.MLDG.network.parameters", "copy.deepcopy.parameters", "copy.deepcopy.", "copy.deepcopy.parameters", "algorithms.MLDG.network.parameters", "p_tgt.grad.data.add_", "p.grad.data.add_"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.random_pairs_of_minibatches", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "def", "update", "(", "self", ",", "minibatches", ",", "unlabeled", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n        Terms being computed:\n            * Li = Loss(xi, yi, params)\n            * Gi = Grad(Li, params)\n\n            * Lj = Loss(xj, yj, Optimizer(params, grad(Li, params)))\n            * Gj = Grad(Lj, params)\n\n            * params = Optimizer(params, Grad(Li + beta * Lj, params))\n            *        = Optimizer(params, Gi + beta * Gj)\n\n        That is, when calling .step(), we want grads to be Gi + beta * Gj\n\n        For computational efficiency, we do not compute second derivatives.\n        \"\"\"", "\n", "num_mb", "=", "len", "(", "minibatches", ")", "\n", "objective", "=", "0", "\n", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "for", "p", "in", "self", ".", "network", ".", "parameters", "(", ")", ":", "\n", "            ", "if", "p", ".", "grad", "is", "None", ":", "\n", "                ", "p", ".", "grad", "=", "torch", ".", "zeros_like", "(", "p", ")", "\n", "\n", "", "", "for", "(", "xi", ",", "yi", ")", ",", "(", "xj", ",", "yj", ")", "in", "random_pairs_of_minibatches", "(", "minibatches", ")", ":", "\n", "# fine tune clone-network on task \"i\"", "\n", "            ", "inner_net", "=", "copy", ".", "deepcopy", "(", "self", ".", "network", ")", "\n", "\n", "inner_opt", "=", "torch", ".", "optim", ".", "Adam", "(", "\n", "inner_net", ".", "parameters", "(", ")", ",", "\n", "lr", "=", "self", ".", "hparams", "[", "\"lr\"", "]", ",", "\n", "weight_decay", "=", "self", ".", "hparams", "[", "'weight_decay'", "]", "\n", ")", "\n", "\n", "inner_obj", "=", "F", ".", "cross_entropy", "(", "inner_net", "(", "xi", ")", ",", "yi", ")", "\n", "\n", "inner_opt", ".", "zero_grad", "(", ")", "\n", "inner_obj", ".", "backward", "(", ")", "\n", "inner_opt", ".", "step", "(", ")", "\n", "\n", "# The network has now accumulated gradients Gi", "\n", "# The clone-network has now parameters P - lr * Gi", "\n", "for", "p_tgt", ",", "p_src", "in", "zip", "(", "self", ".", "network", ".", "parameters", "(", ")", ",", "\n", "inner_net", ".", "parameters", "(", ")", ")", ":", "\n", "                ", "if", "p_src", ".", "grad", "is", "not", "None", ":", "\n", "                    ", "p_tgt", ".", "grad", ".", "data", ".", "add_", "(", "p_src", ".", "grad", ".", "data", "/", "num_mb", ")", "\n", "\n", "# `objective` is populated for reporting purposes", "\n", "", "", "objective", "+=", "inner_obj", ".", "item", "(", ")", "\n", "\n", "# this computes Gj on the clone-network", "\n", "loss_inner_j", "=", "F", ".", "cross_entropy", "(", "inner_net", "(", "xj", ")", ",", "yj", ")", "\n", "grad_inner_j", "=", "autograd", ".", "grad", "(", "loss_inner_j", ",", "inner_net", ".", "parameters", "(", ")", ",", "\n", "allow_unused", "=", "True", ")", "\n", "\n", "# `objective` is populated for reporting purposes", "\n", "objective", "+=", "(", "self", ".", "hparams", "[", "'mldg_beta'", "]", "*", "loss_inner_j", ")", ".", "item", "(", ")", "\n", "\n", "for", "p", ",", "g_j", "in", "zip", "(", "self", ".", "network", ".", "parameters", "(", ")", ",", "grad_inner_j", ")", ":", "\n", "                ", "if", "g_j", "is", "not", "None", ":", "\n", "                    ", "p", ".", "grad", ".", "data", ".", "add_", "(", "\n", "self", ".", "hparams", "[", "'mldg_beta'", "]", "*", "g_j", ".", "data", "/", "num_mb", ")", "\n", "\n", "# The network has now accumulated gradients Gi + beta * Gj", "\n", "# Repeat for all train-test splits, do .step()", "\n", "\n", "", "", "", "objective", "/=", "len", "(", "minibatches", ")", "\n", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "return", "{", "'loss'", ":", "objective", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.AbstractMMD.__init__": [[623, 630], ["algorithms.ERM.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ",", "gaussian", ")", ":", "\n", "        ", "super", "(", "AbstractMMD", ",", "self", ")", ".", "__init__", "(", "input_shape", ",", "num_classes", ",", "num_domains", ",", "\n", "hparams", ")", "\n", "if", "gaussian", ":", "\n", "            ", "self", ".", "kernel_type", "=", "\"gaussian\"", "\n", "", "else", ":", "\n", "            ", "self", ".", "kernel_type", "=", "\"mean_cov\"", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.AbstractMMD.my_cdist": [[631, 638], ["x1.pow().sum", "x2.pow().sum", "torch.addmm().add_", "torch.addmm().add_", "torch.addmm().add_", "torch.addmm().add_", "torch.addmm().add_", "torch.addmm().add_", "torch.addmm().add_", "torch.addmm().add_", "torch.addmm().add_", "torch.addmm().add_", "torch.addmm().add_", "torch.addmm().add_", "torch.addmm().add_", "torch.addmm().add_", "torch.addmm().add_", "torch.addmm().add_", "torch.addmm().add_.clamp_min_", "torch.addmm().add_.clamp_min_", "torch.addmm().add_.clamp_min_", "torch.addmm().add_.clamp_min_", "x1.pow", "x2.pow", "torch.addmm", "torch.addmm", "torch.addmm", "torch.addmm", "torch.addmm", "torch.addmm", "torch.addmm", "torch.addmm", "torch.addmm", "torch.addmm", "torch.addmm", "torch.addmm", "torch.addmm", "torch.addmm", "torch.addmm", "torch.addmm", "x2.pow().sum.transpose", "x2.transpose"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum"], ["", "", "def", "my_cdist", "(", "self", ",", "x1", ",", "x2", ")", ":", "\n", "        ", "x1_norm", "=", "x1", ".", "pow", "(", "2", ")", ".", "sum", "(", "dim", "=", "-", "1", ",", "keepdim", "=", "True", ")", "\n", "x2_norm", "=", "x2", ".", "pow", "(", "2", ")", ".", "sum", "(", "dim", "=", "-", "1", ",", "keepdim", "=", "True", ")", "\n", "res", "=", "torch", ".", "addmm", "(", "x2_norm", ".", "transpose", "(", "-", "2", ",", "-", "1", ")", ",", "\n", "x1", ",", "\n", "x2", ".", "transpose", "(", "-", "2", ",", "-", "1", ")", ",", "alpha", "=", "-", "2", ")", ".", "add_", "(", "x1_norm", ")", "\n", "return", "res", ".", "clamp_min_", "(", "1e-30", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.AbstractMMD.gaussian_kernel": [[639, 648], ["algorithms.AbstractMMD.my_cdist", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like", "torch.zeros_like.add_", "torch.zeros_like.add_", "torch.zeros_like.add_", "torch.zeros_like.add_", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "torch.exp", "algorithms.AbstractMMD.mul"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.AbstractMMD.my_cdist"], ["", "def", "gaussian_kernel", "(", "self", ",", "x", ",", "y", ",", "gamma", "=", "[", "0.001", ",", "0.01", ",", "0.1", ",", "1", ",", "10", ",", "100", ",", "\n", "1000", "]", ")", ":", "\n", "        ", "D", "=", "self", ".", "my_cdist", "(", "x", ",", "y", ")", "\n", "K", "=", "torch", ".", "zeros_like", "(", "D", ")", "\n", "\n", "for", "g", "in", "gamma", ":", "\n", "            ", "K", ".", "add_", "(", "torch", ".", "exp", "(", "D", ".", "mul", "(", "-", "g", ")", ")", ")", "\n", "\n", "", "return", "K", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.AbstractMMD.mmd": [[649, 667], ["algorithms.AbstractMMD.gaussian_kernel().mean", "algorithms.AbstractMMD.gaussian_kernel().mean", "algorithms.AbstractMMD.gaussian_kernel().mean", "x.mean", "y.mean", "algorithms.AbstractMMD.gaussian_kernel", "algorithms.AbstractMMD.gaussian_kernel", "algorithms.AbstractMMD.gaussian_kernel", "cent_x.t", "len", "cent_y.t", "len"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.AbstractMMD.gaussian_kernel", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.AbstractMMD.gaussian_kernel", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.AbstractMMD.gaussian_kernel", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "def", "mmd", "(", "self", ",", "x", ",", "y", ")", ":", "\n", "        ", "if", "self", ".", "kernel_type", "==", "\"gaussian\"", ":", "\n", "            ", "Kxx", "=", "self", ".", "gaussian_kernel", "(", "x", ",", "x", ")", ".", "mean", "(", ")", "\n", "Kyy", "=", "self", ".", "gaussian_kernel", "(", "y", ",", "y", ")", ".", "mean", "(", ")", "\n", "Kxy", "=", "self", ".", "gaussian_kernel", "(", "x", ",", "y", ")", ".", "mean", "(", ")", "\n", "return", "Kxx", "+", "Kyy", "-", "2", "*", "Kxy", "\n", "", "else", ":", "\n", "            ", "mean_x", "=", "x", ".", "mean", "(", "0", ",", "keepdim", "=", "True", ")", "\n", "mean_y", "=", "y", ".", "mean", "(", "0", ",", "keepdim", "=", "True", ")", "\n", "cent_x", "=", "x", "-", "mean_x", "\n", "cent_y", "=", "y", "-", "mean_y", "\n", "cova_x", "=", "(", "cent_x", ".", "t", "(", ")", "@", "cent_x", ")", "/", "(", "len", "(", "x", ")", "-", "1", ")", "\n", "cova_y", "=", "(", "cent_y", ".", "t", "(", ")", "@", "cent_y", ")", "/", "(", "len", "(", "y", ")", "-", "1", ")", "\n", "\n", "mean_diff", "=", "(", "mean_x", "-", "mean_y", ")", ".", "pow", "(", "2", ")", ".", "mean", "(", ")", "\n", "cova_diff", "=", "(", "cova_x", "-", "cova_y", ")", ".", "pow", "(", "2", ")", ".", "mean", "(", ")", "\n", "\n", "return", "mean_diff", "+", "cova_diff", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.AbstractMMD.update": [[668, 694], ["len", "range", "algorithms.AbstractMMD.optimizer.zero_grad", "algorithms.AbstractMMD.optimizer.step", "torch.is_tensor", "torch.is_tensor", "torch.is_tensor", "torch.is_tensor", "torch.is_tensor", "torch.is_tensor", "torch.is_tensor", "torch.is_tensor", "torch.is_tensor", "torch.is_tensor", "torch.is_tensor", "torch.is_tensor", "torch.is_tensor", "torch.is_tensor", "torch.is_tensor", "torch.is_tensor", "algorithms.AbstractMMD.featurizer", "algorithms.AbstractMMD.classifier", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "range", "penalty.item.item.item", "objective.item", "algorithms.AbstractMMD.mmd"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.AbstractMMD.mmd"], ["", "", "def", "update", "(", "self", ",", "minibatches", ",", "unlabeled", "=", "None", ")", ":", "\n", "        ", "objective", "=", "0", "\n", "penalty", "=", "0", "\n", "nmb", "=", "len", "(", "minibatches", ")", "\n", "\n", "features", "=", "[", "self", ".", "featurizer", "(", "xi", ")", "for", "xi", ",", "_", "in", "minibatches", "]", "\n", "classifs", "=", "[", "self", ".", "classifier", "(", "fi", ")", "for", "fi", "in", "features", "]", "\n", "targets", "=", "[", "yi", "for", "_", ",", "yi", "in", "minibatches", "]", "\n", "\n", "for", "i", "in", "range", "(", "nmb", ")", ":", "\n", "            ", "objective", "+=", "F", ".", "cross_entropy", "(", "classifs", "[", "i", "]", ",", "targets", "[", "i", "]", ")", "\n", "for", "j", "in", "range", "(", "i", "+", "1", ",", "nmb", ")", ":", "\n", "                ", "penalty", "+=", "self", ".", "mmd", "(", "features", "[", "i", "]", ",", "features", "[", "j", "]", ")", "\n", "\n", "", "", "objective", "/=", "nmb", "\n", "if", "nmb", ">", "1", ":", "\n", "            ", "penalty", "/=", "(", "nmb", "*", "(", "nmb", "-", "1", ")", "/", "2", ")", "\n", "\n", "", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "(", "objective", "+", "(", "self", ".", "hparams", "[", "'mmd_gamma'", "]", "*", "penalty", ")", ")", ".", "backward", "(", ")", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "if", "torch", ".", "is_tensor", "(", "penalty", ")", ":", "\n", "            ", "penalty", "=", "penalty", ".", "item", "(", ")", "\n", "\n", "", "return", "{", "'loss'", ":", "objective", ".", "item", "(", ")", ",", "'penalty'", ":", "penalty", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.MMD.__init__": [[701, 704], ["algorithms.AbstractMMD.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "MMD", ",", "self", ")", ".", "__init__", "(", "input_shape", ",", "num_classes", ",", "\n", "num_domains", ",", "hparams", ",", "gaussian", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.CORAL.__init__": [[711, 714], ["algorithms.AbstractMMD.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "CORAL", ",", "self", ")", ".", "__init__", "(", "input_shape", ",", "num_classes", ",", "\n", "num_domains", ",", "hparams", ",", "gaussian", "=", "False", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.MTL.__init__": [[723, 743], ["algorithms.Algorithm.__init__", "domainbed.networks.Featurizer", "domainbed.networks.Classifier", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "torch.optim.Adam", "algorithms.MTL.register_buffer", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "torch.zeros", "list", "list", "algorithms.MTL.featurizer.parameters", "algorithms.MTL.classifier.parameters"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.Featurizer", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.Classifier"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "MTL", ",", "self", ")", ".", "__init__", "(", "input_shape", ",", "num_classes", ",", "num_domains", ",", "\n", "hparams", ")", "\n", "self", ".", "featurizer", "=", "networks", ".", "Featurizer", "(", "input_shape", ",", "self", ".", "hparams", ")", "\n", "self", ".", "classifier", "=", "networks", ".", "Classifier", "(", "\n", "self", ".", "featurizer", ".", "n_outputs", "*", "2", ",", "\n", "num_classes", ",", "\n", "self", ".", "hparams", "[", "'nonlinear_classifier'", "]", ")", "\n", "self", ".", "optimizer", "=", "torch", ".", "optim", ".", "Adam", "(", "\n", "list", "(", "self", ".", "featurizer", ".", "parameters", "(", ")", ")", "+", "list", "(", "self", ".", "classifier", ".", "parameters", "(", ")", ")", ",", "\n", "lr", "=", "self", ".", "hparams", "[", "\"lr\"", "]", ",", "\n", "weight_decay", "=", "self", ".", "hparams", "[", "'weight_decay'", "]", "\n", ")", "\n", "\n", "self", ".", "register_buffer", "(", "'embeddings'", ",", "\n", "torch", ".", "zeros", "(", "num_domains", ",", "\n", "self", ".", "featurizer", ".", "n_outputs", ")", ")", "\n", "\n", "self", ".", "ema", "=", "self", ".", "hparams", "[", "'mtl_ema'", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.MTL.update": [[744, 754], ["enumerate", "algorithms.MTL.optimizer.zero_grad", "loss.backward", "algorithms.MTL.optimizer.step", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "loss.item", "algorithms.MTL.predict"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.predict"], ["", "def", "update", "(", "self", ",", "minibatches", ",", "unlabeled", "=", "None", ")", ":", "\n", "        ", "loss", "=", "0", "\n", "for", "env", ",", "(", "x", ",", "y", ")", "in", "enumerate", "(", "minibatches", ")", ":", "\n", "            ", "loss", "+=", "F", ".", "cross_entropy", "(", "self", ".", "predict", "(", "x", ",", "env", ")", ",", "y", ")", "\n", "\n", "", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "return", "{", "'loss'", ":", "loss", ".", "item", "(", ")", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.MTL.update_embeddings_": [[755, 765], ["features.mean", "features.mean.view().repeat", "features.mean.clone().detach", "len", "features.mean.view", "features.mean.clone"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "def", "update_embeddings_", "(", "self", ",", "features", ",", "env", "=", "None", ")", ":", "\n", "        ", "return_embedding", "=", "features", ".", "mean", "(", "0", ")", "\n", "\n", "if", "env", "is", "not", "None", ":", "\n", "            ", "return_embedding", "=", "self", ".", "ema", "*", "return_embedding", "+", "(", "1", "-", "self", ".", "ema", ")", "*", "self", ".", "embeddings", "[", "env", "]", "\n", "\n", "self", ".", "embeddings", "[", "env", "]", "=", "return_embedding", ".", "clone", "(", ")", ".", "detach", "(", ")", "\n", "\n", "", "return", "return_embedding", ".", "view", "(", "1", ",", "-", "1", ")", ".", "repeat", "(", "len", "(", "features", ")", ",", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.MTL.predict": [[766, 770], ["algorithms.MTL.featurizer", "algorithms.MTL.update_embeddings_().normal_", "algorithms.MTL.classifier", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "algorithms.MTL.update_embeddings_"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.MTL.update_embeddings_"], ["", "def", "predict", "(", "self", ",", "x", ",", "env", "=", "None", ")", ":", "\n", "        ", "features", "=", "self", ".", "featurizer", "(", "x", ")", "\n", "embedding", "=", "self", ".", "update_embeddings_", "(", "features", ",", "env", ")", ".", "normal_", "(", ")", "\n", "return", "self", ".", "classifier", "(", "torch", ".", "cat", "(", "(", "features", ",", "embedding", ")", ",", "1", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.__init__": [[777, 828], ["algorithms.Algorithm.__init__", "domainbed.networks.Featurizer", "domainbed.networks.Classifier", "domainbed.networks.Classifier", "algorithms.SagNet.__init__.opt"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.Featurizer", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.Classifier", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.networks.Classifier"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "SagNet", ",", "self", ")", ".", "__init__", "(", "input_shape", ",", "num_classes", ",", "num_domains", ",", "\n", "hparams", ")", "\n", "# featurizer network", "\n", "self", ".", "featurizer", "=", "networks", ".", "Featurizer", "(", "input_shape", ",", "self", ".", "hparams", ")", "\n", "# content network", "\n", "self", ".", "classifier", "=", "networks", ".", "Classifier", "(", "\n", "self", ".", "featurizer", ".", "n_outputs", ",", "\n", "num_classes", ",", "\n", "self", ".", "hparams", "[", "'nonlinear_classifier'", "]", ")", "\n", "# style network", "\n", "self", ".", "network_s", "=", "networks", ".", "Classifier", "(", "\n", "self", ".", "featurizer", ".", "n_outputs", ",", "\n", "num_classes", ",", "\n", "self", ".", "hparams", "[", "'nonlinear_classifier'", "]", ")", "\n", "\n", "# # This commented block of code implements something closer to the", "\n", "# # original paper, but is specific to ResNet and puts in disadvantage", "\n", "# # the other algorithms.", "\n", "# resnet_c = networks.Featurizer(input_shape, self.hparams)", "\n", "# resnet_s = networks.Featurizer(input_shape, self.hparams)", "\n", "# # featurizer network", "\n", "# self.featurizer = torch.nn.Sequential(", "\n", "#         resnet_c.network.conv1,", "\n", "#         resnet_c.network.bn1,", "\n", "#         resnet_c.network.relu,", "\n", "#         resnet_c.network.maxpool,", "\n", "#         resnet_c.network.layer1,", "\n", "#         resnet_c.network.layer2,", "\n", "#         resnet_c.network.layer3)", "\n", "# # content network", "\n", "# self.classifier = torch.nn.Sequential(", "\n", "#         resnet_c.network.layer4,", "\n", "#         resnet_c.network.avgpool,", "\n", "#         networks.Flatten(),", "\n", "#         resnet_c.network.fc)", "\n", "# # style network", "\n", "# self.network_s = torch.nn.Sequential(", "\n", "#         resnet_s.network.layer4,", "\n", "#         resnet_s.network.avgpool,", "\n", "#         networks.Flatten(),", "\n", "#         resnet_s.network.fc)", "\n", "\n", "def", "opt", "(", "p", ")", ":", "\n", "            ", "return", "torch", ".", "optim", ".", "Adam", "(", "p", ",", "lr", "=", "hparams", "[", "\"lr\"", "]", ",", "\n", "weight_decay", "=", "hparams", "[", "\"weight_decay\"", "]", ")", "\n", "\n", "", "self", ".", "optimizer_f", "=", "opt", "(", "self", ".", "featurizer", ".", "parameters", "(", ")", ")", "\n", "self", ".", "optimizer_c", "=", "opt", "(", "self", ".", "classifier", ".", "parameters", "(", ")", ")", "\n", "self", ".", "optimizer_s", "=", "opt", "(", "self", ".", "network_s", ".", "parameters", "(", ")", ")", "\n", "self", ".", "weight_adv", "=", "hparams", "[", "\"sag_w_adv\"", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.forward_c": [[829, 832], ["algorithms.SagNet.classifier", "algorithms.SagNet.randomize", "algorithms.SagNet.featurizer"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.randomize"], ["", "def", "forward_c", "(", "self", ",", "x", ")", ":", "\n", "# learning content network on randomized style", "\n", "        ", "return", "self", ".", "classifier", "(", "self", ".", "randomize", "(", "self", ".", "featurizer", "(", "x", ")", ",", "\"style\"", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.forward_s": [[833, 836], ["algorithms.SagNet.network_s", "algorithms.SagNet.randomize", "algorithms.SagNet.featurizer"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.randomize"], ["", "def", "forward_s", "(", "self", ",", "x", ")", ":", "\n", "# learning style network on randomized content", "\n", "        ", "return", "self", ".", "network_s", "(", "self", ".", "randomize", "(", "self", ".", "featurizer", "(", "x", ")", ",", "\"content\"", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.randomize": [[837, 860], ["x[].detach.size", "torch.rand().to", "torch.rand().to", "torch.rand().to", "torch.rand().to", "torch.rand().to", "torch.rand().to", "torch.rand().to", "torch.rand().to", "torch.rand().to", "torch.rand().to", "torch.rand().to", "torch.rand().to", "torch.rand().to", "torch.rand().to", "torch.rand().to", "torch.rand().to", "x[].detach.mean", "x[].detach.var", "torch.randperm", "torch.randperm", "torch.randperm", "torch.randperm", "torch.randperm", "torch.randperm", "torch.randperm", "torch.randperm", "torch.randperm", "torch.randperm", "torch.randperm", "torch.randperm", "torch.randperm", "torch.randperm", "torch.randperm", "torch.randperm", "x[].detach.view", "len", "x[].detach.view", "alpha.unsqueeze.unsqueeze.unsqueeze", "x[].detach", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand", "torch.rand"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "def", "randomize", "(", "self", ",", "x", ",", "what", "=", "\"style\"", ",", "eps", "=", "1e-5", ")", ":", "\n", "        ", "device", "=", "\"cuda\"", "if", "x", ".", "is_cuda", "else", "\"cpu\"", "\n", "sizes", "=", "x", ".", "size", "(", ")", "\n", "alpha", "=", "torch", ".", "rand", "(", "sizes", "[", "0", "]", ",", "1", ")", ".", "to", "(", "device", ")", "\n", "\n", "if", "len", "(", "sizes", ")", "==", "4", ":", "\n", "            ", "x", "=", "x", ".", "view", "(", "sizes", "[", "0", "]", ",", "sizes", "[", "1", "]", ",", "-", "1", ")", "\n", "alpha", "=", "alpha", ".", "unsqueeze", "(", "-", "1", ")", "\n", "\n", "", "mean", "=", "x", ".", "mean", "(", "-", "1", ",", "keepdim", "=", "True", ")", "\n", "var", "=", "x", ".", "var", "(", "-", "1", ",", "keepdim", "=", "True", ")", "\n", "\n", "x", "=", "(", "x", "-", "mean", ")", "/", "(", "var", "+", "eps", ")", ".", "sqrt", "(", ")", "\n", "\n", "idx_swap", "=", "torch", ".", "randperm", "(", "sizes", "[", "0", "]", ")", "\n", "if", "what", "==", "\"style\"", ":", "\n", "            ", "mean", "=", "alpha", "*", "mean", "+", "(", "1", "-", "alpha", ")", "*", "mean", "[", "idx_swap", "]", "\n", "var", "=", "alpha", "*", "var", "+", "(", "1", "-", "alpha", ")", "*", "var", "[", "idx_swap", "]", "\n", "", "else", ":", "\n", "            ", "x", "=", "x", "[", "idx_swap", "]", ".", "detach", "(", ")", "\n", "\n", "", "x", "=", "x", "*", "(", "var", "+", "eps", ")", ".", "sqrt", "(", ")", "+", "mean", "\n", "return", "x", ".", "view", "(", "*", "sizes", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.update": [[861, 888], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "algorithms.SagNet.optimizer_f.zero_grad", "algorithms.SagNet.optimizer_c.zero_grad", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy.backward", "algorithms.SagNet.optimizer_f.step", "algorithms.SagNet.optimizer_c.step", "algorithms.SagNet.optimizer_s.zero_grad", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy.backward", "algorithms.SagNet.optimizer_s.step", "algorithms.SagNet.optimizer_f.zero_grad", "loss_adv.backward", "algorithms.SagNet.optimizer_f.step", "algorithms.SagNet.forward_c", "algorithms.SagNet.forward_s", "torch.log_softmax().mean().mean", "torch.log_softmax().mean().mean", "torch.log_softmax().mean().mean", "torch.log_softmax().mean().mean", "torch.cross_entropy.item", "torch.cross_entropy.item", "loss_adv.item", "torch.log_softmax().mean", "torch.log_softmax().mean", "torch.log_softmax().mean", "torch.log_softmax().mean", "torch.log_softmax", "torch.log_softmax", "torch.log_softmax", "torch.log_softmax", "algorithms.SagNet.forward_s"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.forward_c", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.forward_s", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.forward_s"], ["", "def", "update", "(", "self", ",", "minibatches", ",", "unlabeled", "=", "None", ")", ":", "\n", "        ", "all_x", "=", "torch", ".", "cat", "(", "[", "x", "for", "x", ",", "y", "in", "minibatches", "]", ")", "\n", "all_y", "=", "torch", ".", "cat", "(", "[", "y", "for", "x", ",", "y", "in", "minibatches", "]", ")", "\n", "\n", "# learn content", "\n", "self", ".", "optimizer_f", ".", "zero_grad", "(", ")", "\n", "self", ".", "optimizer_c", ".", "zero_grad", "(", ")", "\n", "loss_c", "=", "F", ".", "cross_entropy", "(", "self", ".", "forward_c", "(", "all_x", ")", ",", "all_y", ")", "\n", "loss_c", ".", "backward", "(", ")", "\n", "self", ".", "optimizer_f", ".", "step", "(", ")", "\n", "self", ".", "optimizer_c", ".", "step", "(", ")", "\n", "\n", "# learn style", "\n", "self", ".", "optimizer_s", ".", "zero_grad", "(", ")", "\n", "loss_s", "=", "F", ".", "cross_entropy", "(", "self", ".", "forward_s", "(", "all_x", ")", ",", "all_y", ")", "\n", "loss_s", ".", "backward", "(", ")", "\n", "self", ".", "optimizer_s", ".", "step", "(", ")", "\n", "\n", "# learn adversary", "\n", "self", ".", "optimizer_f", ".", "zero_grad", "(", ")", "\n", "loss_adv", "=", "-", "F", ".", "log_softmax", "(", "self", ".", "forward_s", "(", "all_x", ")", ",", "dim", "=", "1", ")", ".", "mean", "(", "1", ")", ".", "mean", "(", ")", "\n", "loss_adv", "=", "loss_adv", "*", "self", ".", "weight_adv", "\n", "loss_adv", ".", "backward", "(", ")", "\n", "self", ".", "optimizer_f", ".", "step", "(", ")", "\n", "\n", "return", "{", "'loss_c'", ":", "loss_c", ".", "item", "(", ")", ",", "'loss_s'", ":", "loss_s", ".", "item", "(", ")", ",", "\n", "'loss_adv'", ":", "loss_adv", ".", "item", "(", ")", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.predict": [[889, 891], ["algorithms.SagNet.classifier", "algorithms.SagNet.featurizer"], "methods", ["None"], ["", "def", "predict", "(", "self", ",", "x", ")", ":", "\n", "        ", "return", "self", ".", "classifier", "(", "self", ".", "featurizer", "(", "x", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.RSC.__init__": [[894, 900], ["algorithms.ERM.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["    ", "def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "RSC", ",", "self", ")", ".", "__init__", "(", "input_shape", ",", "num_classes", ",", "num_domains", ",", "\n", "hparams", ")", "\n", "self", ".", "drop_f", "=", "(", "1", "-", "hparams", "[", "'rsc_f_drop_factor'", "]", ")", "*", "100", "\n", "self", ".", "drop_b", "=", "(", "1", "-", "hparams", "[", "'rsc_b_drop_factor'", "]", ")", "*", "100", "\n", "self", ".", "num_classes", "=", "num_classes", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.RSC.update": [[901, 948], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.nn.functional.one_hot", "torch.nn.functional.one_hot", "torch.nn.functional.one_hot", "torch.nn.functional.one_hot", "torch.nn.functional.one_hot", "torch.nn.functional.one_hot", "torch.nn.functional.one_hot", "torch.nn.functional.one_hot", "torch.nn.functional.one_hot", "torch.nn.functional.one_hot", "torch.nn.functional.one_hot", "torch.nn.functional.one_hot", "torch.nn.functional.one_hot", "torch.nn.functional.one_hot", "torch.nn.functional.one_hot", "torch.nn.functional.one_hot", "algorithms.RSC.featurizer", "algorithms.RSC.classifier", "numpy.percentile", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "torch.Tensor", "percentiles.unsqueeze().repeat.unsqueeze().repeat.unsqueeze().repeat", "all_g.lt().float", "algorithms.RSC.classifier", "torch.softmax", "torch.softmax", "torch.softmax", "torch.softmax", "torch.softmax", "torch.softmax", "torch.softmax", "torch.softmax", "numpy.percentile", "changes.lt().float().view", "torch.logical_or().float", "torch.logical_or().float", "torch.logical_or().float", "torch.logical_or().float", "torch.logical_or().float", "torch.logical_or().float", "torch.logical_or().float", "torch.logical_or().float", "torch.logical_or().float", "torch.logical_or().float", "torch.logical_or().float", "torch.logical_or().float", "torch.logical_or().float", "torch.logical_or().float", "torch.logical_or().float", "torch.logical_or().float", "algorithms.RSC.classifier", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "algorithms.RSC.optimizer.zero_grad", "torch.cross_entropy.backward", "algorithms.RSC.optimizer.step", "torch.grad", "torch.grad", "torch.grad", "torch.grad", "all_g.cpu", "all_g.size", "changes.detach().cpu", "torch.cross_entropy.item", "percentiles.unsqueeze().repeat.unsqueeze().repeat.unsqueeze", "all_g.lt", "changes.lt().float", "torch.logical_or", "torch.logical_or", "torch.logical_or", "torch.logical_or", "torch.logical_or", "torch.logical_or", "torch.logical_or", "torch.logical_or", "torch.logical_or", "torch.logical_or", "torch.logical_or", "torch.logical_or", "torch.logical_or", "torch.logical_or", "torch.logical_or", "torch.logical_or", "percentiles.unsqueeze().repeat.unsqueeze().repeat.to", "changes.detach", "changes.lt"], "methods", ["None"], ["", "def", "update", "(", "self", ",", "minibatches", ",", "unlabeled", "=", "None", ")", ":", "\n", "        ", "device", "=", "\"cuda\"", "if", "minibatches", "[", "0", "]", "[", "0", "]", ".", "is_cuda", "else", "\"cpu\"", "\n", "\n", "# inputs", "\n", "all_x", "=", "torch", ".", "cat", "(", "[", "x", "for", "x", ",", "y", "in", "minibatches", "]", ")", "\n", "# labels", "\n", "all_y", "=", "torch", ".", "cat", "(", "[", "y", "for", "_", ",", "y", "in", "minibatches", "]", ")", "\n", "# one-hot labels", "\n", "all_o", "=", "torch", ".", "nn", ".", "functional", ".", "one_hot", "(", "all_y", ",", "self", ".", "num_classes", ")", "\n", "# features", "\n", "all_f", "=", "self", ".", "featurizer", "(", "all_x", ")", "\n", "# predictions", "\n", "all_p", "=", "self", ".", "classifier", "(", "all_f", ")", "\n", "\n", "# Equation (1): compute gradients with respect to representation", "\n", "all_g", "=", "autograd", ".", "grad", "(", "(", "all_p", "*", "all_o", ")", ".", "sum", "(", ")", ",", "all_f", ")", "[", "0", "]", "\n", "\n", "# Equation (2): compute top-gradient-percentile mask", "\n", "percentiles", "=", "np", ".", "percentile", "(", "all_g", ".", "cpu", "(", ")", ",", "self", ".", "drop_f", ",", "axis", "=", "1", ")", "\n", "percentiles", "=", "torch", ".", "Tensor", "(", "percentiles", ")", "\n", "percentiles", "=", "percentiles", ".", "unsqueeze", "(", "1", ")", ".", "repeat", "(", "1", ",", "all_g", ".", "size", "(", "1", ")", ")", "\n", "mask_f", "=", "all_g", ".", "lt", "(", "percentiles", ".", "to", "(", "device", ")", ")", ".", "float", "(", ")", "\n", "\n", "# Equation (3): mute top-gradient-percentile activations", "\n", "all_f_muted", "=", "all_f", "*", "mask_f", "\n", "\n", "# Equation (4): compute muted predictions", "\n", "all_p_muted", "=", "self", ".", "classifier", "(", "all_f_muted", ")", "\n", "\n", "# Section 3.3: Batch Percentage", "\n", "all_s", "=", "F", ".", "softmax", "(", "all_p", ",", "dim", "=", "1", ")", "\n", "all_s_muted", "=", "F", ".", "softmax", "(", "all_p_muted", ",", "dim", "=", "1", ")", "\n", "changes", "=", "(", "all_s", "*", "all_o", ")", ".", "sum", "(", "1", ")", "-", "(", "all_s_muted", "*", "all_o", ")", ".", "sum", "(", "1", ")", "\n", "percentile", "=", "np", ".", "percentile", "(", "changes", ".", "detach", "(", ")", ".", "cpu", "(", ")", ",", "self", ".", "drop_b", ")", "\n", "mask_b", "=", "changes", ".", "lt", "(", "percentile", ")", ".", "float", "(", ")", ".", "view", "(", "-", "1", ",", "1", ")", "\n", "mask", "=", "torch", ".", "logical_or", "(", "mask_f", ",", "mask_b", ")", ".", "float", "(", ")", "\n", "\n", "# Equations (3) and (4) again, this time mutting over examples", "\n", "all_p_muted_again", "=", "self", ".", "classifier", "(", "all_f", "*", "mask", ")", "\n", "\n", "# Equation (5): update", "\n", "loss", "=", "F", ".", "cross_entropy", "(", "all_p_muted_again", ",", "all_y", ")", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "loss", ".", "backward", "(", ")", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "return", "{", "'loss'", ":", "loss", ".", "item", "(", ")", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SD.__init__": [[955, 959], ["algorithms.ERM.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "num_classes", ",", "num_domains", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "SD", ",", "self", ")", ".", "__init__", "(", "input_shape", ",", "num_classes", ",", "num_domains", ",", "\n", "hparams", ")", "\n", "self", ".", "sd_reg", "=", "hparams", "[", "\"sd_reg\"", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SD.update": [[960, 974], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "algorithms.SD.predict", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "torch.cross_entropy", "algorithms.SD.optimizer.zero_grad", "objective.backward", "algorithms.SD.optimizer.step", "torch.cross_entropy.item", "penalty.item"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.predict"], ["", "def", "update", "(", "self", ",", "minibatches", ",", "unlabeled", "=", "None", ")", ":", "\n", "        ", "all_x", "=", "torch", ".", "cat", "(", "[", "x", "for", "x", ",", "y", "in", "minibatches", "]", ")", "\n", "all_y", "=", "torch", ".", "cat", "(", "[", "y", "for", "x", ",", "y", "in", "minibatches", "]", ")", "\n", "all_p", "=", "self", ".", "predict", "(", "all_x", ")", "\n", "\n", "loss", "=", "F", ".", "cross_entropy", "(", "all_p", ",", "all_y", ")", "\n", "penalty", "=", "(", "all_p", "**", "2", ")", ".", "mean", "(", ")", "\n", "objective", "=", "loss", "+", "self", ".", "sd_reg", "*", "penalty", "\n", "\n", "self", ".", "optimizer", ".", "zero_grad", "(", ")", "\n", "objective", ".", "backward", "(", ")", "\n", "self", ".", "optimizer", ".", "step", "(", ")", "\n", "\n", "return", "{", "'loss'", ":", "loss", ".", "item", "(", ")", ",", "'penalty'", ":", "penalty", ".", "item", "(", ")", "}", "\n", "", "", ""]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.get_algorithm_class": [[32, 37], ["globals", "NotImplementedError", "globals"], "function", ["None"], ["def", "get_algorithm_class", "(", "algorithm_name", ")", ":", "\n", "    ", "\"\"\"Return the algorithm class with the given name.\"\"\"", "\n", "if", "algorithm_name", "not", "in", "globals", "(", ")", ":", "\n", "        ", "raise", "NotImplementedError", "(", "\"Algorithm not found: {}\"", ".", "format", "(", "algorithm_name", ")", ")", "\n", "", "return", "globals", "(", ")", "[", "algorithm_name", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.loss_gap": [[364, 375], ["torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "torch.tensor", "model.adv_classifier", "torch.cross_entropy", "model.featurizer", "float", "float"], "function", ["None"], ["", "", "def", "loss_gap", "(", "minibatches", ",", "model", ",", "device", ")", ":", "\n", "    ", "''' compute gap = max_i loss_i(h) - min_j loss_j(h), return i, j, and the gap for a single batch'''", "\n", "max_env_loss", ",", "min_env_loss", "=", "torch", ".", "tensor", "(", "[", "-", "float", "(", "'inf'", ")", "]", ",", "device", "=", "device", ")", ",", "torch", ".", "tensor", "(", "[", "float", "(", "'inf'", ")", "]", ",", "device", "=", "device", ")", "\n", "for", "x", ",", "y", "in", "minibatches", ":", "\n", "        ", "p", "=", "model", ".", "adv_classifier", "(", "model", ".", "featurizer", "(", "x", ")", ")", "\n", "loss", "=", "F", ".", "cross_entropy", "(", "p", ",", "y", ")", "\n", "if", "loss", ">", "max_env_loss", ":", "\n", "            ", "max_env_loss", "=", "loss", "\n", "", "if", "loss", "<", "min_env_loss", ":", "\n", "            ", "min_env_loss", "=", "loss", "\n", "", "", "return", "max_env_loss", "-", "min_env_loss", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.argmax": [[8, 10], ["max", "enumerate"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.max"], ["def", "argmax", "(", "iterable", ")", ":", "\n", "    ", "return", "max", "(", "enumerate", "(", "iterable", ")", ",", "key", "=", "lambda", "x", ":", "x", "[", "1", "]", ")", "[", "0", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.argmin": [[11, 13], ["min", "enumerate"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.min"], ["", "def", "argmin", "(", "iterable", ")", ":", "\n", "    ", "return", "min", "(", "enumerate", "(", "iterable", ")", ",", "key", "=", "lambda", "x", ":", "x", "[", "1", "]", ")", "[", "0", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.percent": [[14, 17], ["round"], "function", ["None"], ["", "def", "percent", "(", "number", ")", ":", "\n", "    ", "number", "=", "round", "(", "number", ",", "4", ")", "*", "100", "\n", "return", "f\"{number:.2f}\\\\%\"", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.percent_no": [[18, 21], ["round"], "function", ["None"], ["", "def", "percent_no", "(", "number", ")", ":", "\n", "    ", "number", "=", "round", "(", "number", ",", "4", ")", "*", "100", "\n", "return", "f\"{number:.2f}\"", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.round_l": [[22, 24], ["round"], "function", ["None"], ["", "def", "round_l", "(", "num_list", ",", "digit", "=", "4", ")", ":", "\n", "    ", "return", "[", "round", "(", "num", ",", "digit", ")", "for", "num", "in", "num_list", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.loss_gap": [[25, 43], ["enumerate", "domainbed.lib.misc.loss"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.loss"], ["", "def", "loss_gap", "(", "num_domains", ",", "env_loaders", ",", "model", ",", "device", ",", "whole", "=", "False", ")", ":", "\n", "    ", "''' compute gap = max_i loss_i(h) - min_j loss_j(h), return i, j, and the gap for the whole dataset'''", "\n", "''' model = h, index are from 1 ... n'''", "\n", "max_env_loss", ",", "min_env_loss", "=", "-", "np", ".", "inf", ",", "np", ".", "inf", "\n", "max_index", "=", "min_index", "=", "0", "\n", "index", "=", "0", "\n", "for", "index", ",", "loader", "in", "enumerate", "(", "env_loaders", ")", ":", "\n", "        ", "loss", "=", "misc", ".", "loss", "(", "algorithm", ",", "loader", ",", "device", ")", "\n", "# print(\"index: \", index, \"loss: \", loss)", "\n", "if", "index", "==", "0", "and", "not", "whole", ":", "\n", "            ", "continue", "\n", "", "if", "loss", ">", "max_env_loss", ":", "\n", "            ", "max_env_loss", "=", "loss", "\n", "max_index", "=", "index", "\n", "", "if", "loss", "<", "min_env_loss", ":", "\n", "            ", "min_env_loss", "=", "loss", "\n", "min_index", "=", "index", "\n", "", "", "return", "max_index", ",", "min_index", ",", "max_env_loss", ",", "min_env_loss", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.loss_gap_batch": [[45, 62], ["enumerate", "x.to.to", "y.to.to", "model.predict", "torch.ones().to", "torch.ones().to", "torch.ones().to.sum().item", "torch.ones", "torch.ones", "torch.ones().to.sum", "torch.cross_entropy", "len", "len"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.predict", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "def", "loss_gap_batch", "(", "num_domains", ",", "minibatches", ",", "model", ",", "device", ")", ":", "\n", "    ", "''' compute gap = max_i loss_i(h) - min_j loss_j(h), return i, j, and the gap for a single batch'''", "\n", "''' because we will compute sup_{h'} (rather than min), the return value is the opposite'''", "\n", "''' model = h, index are from 1 ... n, minibatches is a list of iterators for a given batch'''", "\n", "max_env_loss", ",", "min_env_loss", "=", "-", "np", ".", "inf", ",", "np", ".", "inf", "\n", "for", "index", ",", "(", "x", ",", "y", ")", "in", "enumerate", "(", "minibatches", ")", ":", "\n", "        ", "x", "=", "x", ".", "to", "(", "device", ")", "\n", "y", "=", "y", ".", "to", "(", "device", ")", "\n", "p", "=", "model", ".", "predict", "(", "x", ")", "\n", "batch", "=", "torch", ".", "ones", "(", "len", "(", "x", ")", ")", ".", "to", "(", "device", ")", "\n", "total", "=", "batch", ".", "sum", "(", ")", ".", "item", "(", ")", "\n", "loss", "=", "F", ".", "cross_entropy", "(", "p", ",", "y", ")", "*", "len", "(", "y", ")", "/", "total", "\n", "if", "loss", ">", "max_env_loss", ":", "\n", "            ", "max_env_loss", "=", "loss", "\n", "", "if", "loss", "<", "min_env_loss", ":", "\n", "            ", "min_env_loss", "=", "loss", "\n", "", "", "return", "min_env_loss", "-", "max_env_loss", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.distance": [[64, 71], ["h1.state_dict", "torch.sqrt", "torch.sqrt", "torch.norm", "torch.norm", "h1.state_dict", "h2.state_dict"], "function", ["None"], ["", "def", "distance", "(", "h1", ",", "h2", ")", ":", "\n", "    ", "''' distance of two networks (h1, h2 are classifiers)'''", "\n", "dist", "=", "0.", "\n", "for", "param", "in", "h1", ".", "state_dict", "(", ")", ":", "\n", "        ", "h1_param", ",", "h2_param", "=", "h1", ".", "state_dict", "(", ")", "[", "param", "]", ",", "h2", ".", "state_dict", "(", ")", "[", "param", "]", "\n", "dist", "+=", "torch", ".", "norm", "(", "h1_param", "-", "h2_param", ")", "**", "2", "# use Frobenius norms for matrices", "\n", "", "return", "torch", ".", "sqrt", "(", "dist", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.proj": [[73, 85], ["misc_t.distance", "zip", "h.parameters", "adv_h.parameters"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.distance"], ["", "def", "proj", "(", "delta", ",", "adv_h", ",", "h", ")", ":", "\n", "    ", "''' return proj_{B(h, \\delta)}(adv_h), Euclidean projection to Euclidean ball'''", "\n", "''' adv_h and h are two classifiers'''", "\n", "dist", "=", "distance", "(", "adv_h", ",", "h", ")", "\n", "if", "dist", "<=", "delta", ":", "\n", "        ", "return", "adv_h", "\n", "", "else", ":", "\n", "        ", "ratio", "=", "delta", "/", "dist", "\n", "for", "param_h", ",", "param_adv_h", "in", "zip", "(", "h", ".", "parameters", "(", ")", ",", "adv_h", ".", "parameters", "(", ")", ")", ":", "\n", "            ", "param_adv_h", ".", "data", "=", "param_h", "+", "ratio", "*", "(", "param_adv_h", "-", "param_h", ")", "\n", "# print(\"distance: \", distance(adv_h, h))", "\n", "", "return", "adv_h", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.misc_t.loss_acc": [[86, 97], ["range", "print", "domainbed.lib.misc.loss", "domainbed.lib.misc.accuracy", "losses.append", "accs.append"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.loss", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.accuracy"], ["", "", "def", "loss_acc", "(", "num_domains", ",", "env_loaders", ",", "model", ",", "device", ")", ":", "\n", "    ", "'''evaluate a tuple of losses (of each domain) and a tuple of accs (of each domain)'''", "\n", "losses", ",", "accs", "=", "[", "]", ",", "[", "]", "\n", "for", "i", "in", "range", "(", "num_domains", ")", ":", "\n", "        ", "print", "(", "f'domain {i}'", ")", "\n", "env", "=", "env_loaders", "[", "i", "]", "\n", "loss", "=", "misc", ".", "loss", "(", "model", ",", "env", ",", "device", ")", "\n", "acc", "=", "misc", ".", "accuracy", "(", "model", ",", "env", ",", "None", ",", "device", ")", "\n", "losses", ".", "append", "(", "loss", ")", "\n", "accs", ".", "append", "(", "acc", ")", "\n", "", "return", "losses", ",", "accs", "\n", "", ""]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.MultipleDomainDataset.__getitem__": [[54, 56], ["None"], "methods", ["None"], ["def", "__getitem__", "(", "self", ",", "index", ")", ":", "\n", "        ", "return", "self", ".", "datasets", "[", "index", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.MultipleDomainDataset.__len__": [[57, 59], ["len"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "datasets", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.Debug.__init__": [[62, 72], ["super().__init__", "datasets.Debug.datasets.append", "torch.utils.data.TensorDataset", "torch.randn", "torch.randint"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["    ", "def", "__init__", "(", "self", ",", "root", ",", "test_envs", ",", "hparams", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "self", ".", "input_shape", "=", "self", ".", "INPUT_SHAPE", "\n", "self", ".", "num_classes", "=", "2", "\n", "self", ".", "datasets", "=", "[", "]", "\n", "for", "_", "in", "[", "0", ",", "1", ",", "2", "]", ":", "\n", "            ", "self", ".", "datasets", ".", "append", "(", "\n", "TensorDataset", "(", "\n", "torch", ".", "randn", "(", "16", ",", "*", "self", ".", "INPUT_SHAPE", ")", ",", "\n", "torch", ".", "randint", "(", "0", ",", "self", ".", "num_classes", ",", "(", "16", ",", ")", ")", "\n", ")", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.MultipleEnvironmentMNIST.__init__": [[85, 114], ["super().__init__", "torchvision.datasets.MNIST", "torchvision.datasets.MNIST", "torch.cat", "torch.cat", "torch.randperm", "range", "ValueError", "len", "len", "datasets.MultipleEnvironmentMNIST.datasets.append", "dataset_transform", "len", "len"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["    ", "def", "__init__", "(", "self", ",", "root", ",", "environments", ",", "dataset_transform", ",", "input_shape", ",", "\n", "num_classes", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "if", "root", "is", "None", ":", "\n", "            ", "raise", "ValueError", "(", "'Data directory not specified!'", ")", "\n", "\n", "", "original_dataset_tr", "=", "MNIST", "(", "root", ",", "train", "=", "True", ",", "download", "=", "True", ")", "\n", "original_dataset_te", "=", "MNIST", "(", "root", ",", "train", "=", "False", ",", "download", "=", "True", ")", "\n", "\n", "original_images", "=", "torch", ".", "cat", "(", "(", "original_dataset_tr", ".", "data", ",", "\n", "original_dataset_te", ".", "data", ")", ")", "\n", "\n", "original_labels", "=", "torch", ".", "cat", "(", "(", "original_dataset_tr", ".", "targets", ",", "\n", "original_dataset_te", ".", "targets", ")", ")", "\n", "\n", "shuffle", "=", "torch", ".", "randperm", "(", "len", "(", "original_images", ")", ")", "\n", "\n", "original_images", "=", "original_images", "[", "shuffle", "]", "\n", "original_labels", "=", "original_labels", "[", "shuffle", "]", "\n", "\n", "self", ".", "datasets", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "len", "(", "environments", ")", ")", ":", "\n", "            ", "images", "=", "original_images", "[", "i", ":", ":", "len", "(", "environments", ")", "]", "\n", "labels", "=", "original_labels", "[", "i", ":", ":", "len", "(", "environments", ")", "]", "\n", "self", ".", "datasets", ".", "append", "(", "dataset_transform", "(", "images", ",", "labels", ",", "environments", "[", "i", "]", ")", ")", "\n", "\n", "", "self", ".", "input_shape", "=", "input_shape", "\n", "self", ".", "num_classes", "=", "num_classes", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.ColoredMNIST.__init__": [[119, 125], ["datasets.MultipleEnvironmentMNIST.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "root", ",", "test_envs", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "ColoredMNIST", ",", "self", ")", ".", "__init__", "(", "root", ",", "[", "0.1", ",", "0.2", ",", "0.9", "]", ",", "\n", "self", ".", "color_dataset", ",", "(", "2", ",", "28", ",", "28", ",", ")", ",", "2", ")", "\n", "\n", "self", ".", "input_shape", "=", "(", "2", ",", "28", ",", "28", ",", ")", "\n", "self", ".", "num_classes", "=", "2", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.ColoredMNIST.color_dataset": [[126, 148], ["datasets.ColoredMNIST.torch_xor_", "datasets.ColoredMNIST.torch_xor_", "torch.stack", "torch.stack.float().div_", "datasets.ColoredMNIST.view().long", "torch.utils.data.TensorDataset", "datasets.ColoredMNIST.torch_bernoulli_", "datasets.ColoredMNIST.torch_bernoulli_", "len", "len", "torch.stack.float", "datasets.ColoredMNIST.view", "torch.tensor", "range", "len"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.ColoredMNIST.torch_xor_", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.ColoredMNIST.torch_xor_", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.ColoredMNIST.torch_bernoulli_", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.ColoredMNIST.torch_bernoulli_", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "def", "color_dataset", "(", "self", ",", "images", ",", "labels", ",", "environment", ")", ":", "\n", "# # Subsample 2x for computational convenience", "\n", "# images = images.reshape((-1, 28, 28))[:, ::2, ::2]", "\n", "# Assign a binary label based on the digit", "\n", "        ", "labels", "=", "(", "labels", "<", "5", ")", ".", "float", "(", ")", "\n", "# Flip label with probability 0.25", "\n", "labels", "=", "self", ".", "torch_xor_", "(", "labels", ",", "\n", "self", ".", "torch_bernoulli_", "(", "0.25", ",", "len", "(", "labels", ")", ")", ")", "\n", "\n", "# Assign a color based on the label; flip the color with probability e", "\n", "colors", "=", "self", ".", "torch_xor_", "(", "labels", ",", "\n", "self", ".", "torch_bernoulli_", "(", "environment", ",", "\n", "len", "(", "labels", ")", ")", ")", "\n", "images", "=", "torch", ".", "stack", "(", "[", "images", ",", "images", "]", ",", "dim", "=", "1", ")", "\n", "# Apply the color to the image by zeroing out the other color channel", "\n", "images", "[", "torch", ".", "tensor", "(", "range", "(", "len", "(", "images", ")", ")", ")", ",", "(", "\n", "1", "-", "colors", ")", ".", "long", "(", ")", ",", ":", ",", ":", "]", "*=", "0", "\n", "\n", "x", "=", "images", ".", "float", "(", ")", ".", "div_", "(", "255.0", ")", "\n", "y", "=", "labels", ".", "view", "(", "-", "1", ")", ".", "long", "(", ")", "\n", "\n", "return", "TensorDataset", "(", "x", ",", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.ColoredMNIST.torch_bernoulli_": [[149, 151], ["torch.rand"], "methods", ["None"], ["", "def", "torch_bernoulli_", "(", "self", ",", "p", ",", "size", ")", ":", "\n", "        ", "return", "(", "torch", ".", "rand", "(", "size", ")", "<", "p", ")", ".", "float", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.ColoredMNIST.torch_xor_": [[152, 154], ["None"], "methods", ["None"], ["", "def", "torch_xor_", "(", "self", ",", "a", ",", "b", ")", ":", "\n", "        ", "return", "(", "a", "-", "b", ")", ".", "abs", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.RotatedMNIST.__init__": [[159, 162], ["datasets.MultipleEnvironmentMNIST.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "root", ",", "test_envs", ",", "hparams", ")", ":", "\n", "        ", "super", "(", "RotatedMNIST", ",", "self", ")", ".", "__init__", "(", "root", ",", "[", "0", ",", "15", ",", "30", ",", "45", ",", "60", ",", "75", "]", ",", "\n", "self", ".", "rotate_dataset", ",", "(", "1", ",", "28", ",", "28", ",", ")", ",", "10", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.RotatedMNIST.rotate_dataset": [[163, 177], ["torchvision.transforms.Compose", "torch.zeros", "range", "labels.view", "torch.utils.data.TensorDataset", "len", "len", "torchvision.transforms.Compose.", "torchvision.transforms.ToPILImage", "torchvision.transforms.Lambda", "torchvision.transforms.ToTensor", "torchvision.transforms.functional.rotate"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "def", "rotate_dataset", "(", "self", ",", "images", ",", "labels", ",", "angle", ")", ":", "\n", "        ", "rotation", "=", "transforms", ".", "Compose", "(", "[", "\n", "transforms", ".", "ToPILImage", "(", ")", ",", "\n", "transforms", ".", "Lambda", "(", "lambda", "x", ":", "rotate", "(", "x", ",", "angle", ",", "fill", "=", "(", "0", ",", ")", ",", "\n", "resample", "=", "Image", ".", "BICUBIC", ")", ")", ",", "\n", "transforms", ".", "ToTensor", "(", ")", "]", ")", "\n", "\n", "x", "=", "torch", ".", "zeros", "(", "len", "(", "images", ")", ",", "1", ",", "28", ",", "28", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "images", ")", ")", ":", "\n", "            ", "x", "[", "i", "]", "=", "rotation", "(", "images", "[", "i", "]", ")", "\n", "\n", "", "y", "=", "labels", ".", "view", "(", "-", "1", ")", "\n", "\n", "return", "TensorDataset", "(", "x", ",", "y", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.MultipleEnvironmentImageFolder.__init__": [[179, 218], ["super().__init__", "sorted", "torchvision.transforms.Compose", "torchvision.transforms.Compose", "enumerate", "len", "os.path.join", "torchvision.datasets.ImageFolder", "datasets.MultipleEnvironmentImageFolder.datasets.append", "os.scandir", "f.is_dir", "torchvision.transforms.Resize", "torchvision.transforms.ToTensor", "torchvision.transforms.Normalize", "torchvision.transforms.RandomResizedCrop", "torchvision.transforms.RandomHorizontalFlip", "torchvision.transforms.ColorJitter", "torchvision.transforms.RandomGrayscale", "torchvision.transforms.ToTensor", "torchvision.transforms.Normalize"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sorted", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["    ", "def", "__init__", "(", "self", ",", "root", ",", "test_envs", ",", "augment", ",", "hparams", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "environments", "=", "[", "f", ".", "name", "for", "f", "in", "os", ".", "scandir", "(", "root", ")", "if", "f", ".", "is_dir", "(", ")", "]", "\n", "environments", "=", "sorted", "(", "environments", ")", "\n", "\n", "transform", "=", "transforms", ".", "Compose", "(", "[", "\n", "transforms", ".", "Resize", "(", "(", "224", ",", "224", ")", ")", ",", "\n", "transforms", ".", "ToTensor", "(", ")", ",", "\n", "transforms", ".", "Normalize", "(", "\n", "mean", "=", "[", "0.485", ",", "0.456", ",", "0.406", "]", ",", "std", "=", "[", "0.229", ",", "0.224", ",", "0.225", "]", ")", "\n", "]", ")", "\n", "\n", "augment_transform", "=", "transforms", ".", "Compose", "(", "[", "\n", "# transforms.Resize((224,224)),", "\n", "transforms", ".", "RandomResizedCrop", "(", "224", ",", "scale", "=", "(", "0.7", ",", "1.0", ")", ")", ",", "\n", "transforms", ".", "RandomHorizontalFlip", "(", ")", ",", "\n", "transforms", ".", "ColorJitter", "(", "0.3", ",", "0.3", ",", "0.3", ",", "0.3", ")", ",", "\n", "transforms", ".", "RandomGrayscale", "(", ")", ",", "\n", "transforms", ".", "ToTensor", "(", ")", ",", "\n", "transforms", ".", "Normalize", "(", "\n", "mean", "=", "[", "0.485", ",", "0.456", ",", "0.406", "]", ",", "std", "=", "[", "0.229", ",", "0.224", ",", "0.225", "]", ")", ",", "\n", "]", ")", "\n", "\n", "self", ".", "datasets", "=", "[", "]", "\n", "for", "i", ",", "environment", "in", "enumerate", "(", "environments", ")", ":", "\n", "\n", "            ", "if", "augment", "and", "(", "i", "not", "in", "test_envs", ")", ":", "\n", "                ", "env_transform", "=", "augment_transform", "\n", "", "else", ":", "\n", "                ", "env_transform", "=", "transform", "\n", "\n", "", "path", "=", "os", ".", "path", ".", "join", "(", "root", ",", "environment", ")", "\n", "env_dataset", "=", "ImageFolder", "(", "path", ",", "\n", "transform", "=", "env_transform", ")", "\n", "\n", "self", ".", "datasets", ".", "append", "(", "env_dataset", ")", "\n", "\n", "", "self", ".", "input_shape", "=", "(", "3", ",", "224", ",", "224", ",", ")", "\n", "self", ".", "num_classes", "=", "len", "(", "self", ".", "datasets", "[", "-", "1", "]", ".", "classes", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.VLCS.__init__": [[222, 225], ["os.path.join", "datasets.MultipleEnvironmentImageFolder.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "root", ",", "test_envs", ",", "hparams", ")", ":", "\n", "        ", "self", ".", "dir", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"VLCS/\"", ")", "\n", "super", "(", ")", ".", "__init__", "(", "self", ".", "dir", ",", "test_envs", ",", "hparams", "[", "'data_augmentation'", "]", ",", "hparams", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.PACS.__init__": [[229, 232], ["os.path.join", "datasets.MultipleEnvironmentImageFolder.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "root", ",", "test_envs", ",", "hparams", ")", ":", "\n", "        ", "self", ".", "dir", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"PACS/\"", ")", "\n", "super", "(", ")", ".", "__init__", "(", "self", ".", "dir", ",", "test_envs", ",", "hparams", "[", "'data_augmentation'", "]", ",", "hparams", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.DomainNet.__init__": [[236, 239], ["os.path.join", "datasets.MultipleEnvironmentImageFolder.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "root", ",", "test_envs", ",", "hparams", ")", ":", "\n", "        ", "self", ".", "dir", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"domain_net/\"", ")", "\n", "super", "(", ")", ".", "__init__", "(", "self", ".", "dir", ",", "test_envs", ",", "hparams", "[", "'data_augmentation'", "]", ",", "hparams", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.OfficeHome.__init__": [[243, 246], ["os.path.join", "datasets.MultipleEnvironmentImageFolder.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "root", ",", "test_envs", ",", "hparams", ")", ":", "\n", "        ", "self", ".", "dir", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"office_home/\"", ")", "\n", "super", "(", ")", ".", "__init__", "(", "self", ".", "dir", ",", "test_envs", ",", "hparams", "[", "'data_augmentation'", "]", ",", "hparams", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.TerraIncognita.__init__": [[250, 253], ["os.path.join", "datasets.MultipleEnvironmentImageFolder.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "root", ",", "test_envs", ",", "hparams", ")", ":", "\n", "        ", "self", ".", "dir", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"terra_incognita/\"", ")", "\n", "super", "(", ")", ".", "__init__", "(", "self", ".", "dir", ",", "test_envs", ",", "hparams", "[", "'data_augmentation'", "]", ",", "hparams", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.SVIRO.__init__": [[257, 260], ["os.path.join", "datasets.MultipleEnvironmentImageFolder.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "root", ",", "test_envs", ",", "hparams", ")", ":", "\n", "        ", "self", ".", "dir", "=", "os", ".", "path", ".", "join", "(", "root", ",", "\"sviro/\"", ")", "\n", "super", "(", ")", ".", "__init__", "(", "self", ".", "dir", ",", "test_envs", ",", "hparams", "[", "'data_augmentation'", "]", ",", "hparams", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.WILDSEnvironment.__init__": [[263, 279], ["wilds_dataset.metadata_fields.index", "str", "torch.where"], "methods", ["None"], ["    ", "def", "__init__", "(", "\n", "self", ",", "\n", "wilds_dataset", ",", "\n", "metadata_name", ",", "\n", "metadata_value", ",", "\n", "transform", "=", "None", ")", ":", "\n", "        ", "self", ".", "name", "=", "metadata_name", "+", "\"_\"", "+", "str", "(", "metadata_value", ")", "\n", "\n", "metadata_index", "=", "wilds_dataset", ".", "metadata_fields", ".", "index", "(", "metadata_name", ")", "\n", "metadata_array", "=", "wilds_dataset", ".", "metadata_array", "\n", "subset_indices", "=", "torch", ".", "where", "(", "\n", "metadata_array", "[", ":", ",", "metadata_index", "]", "==", "metadata_value", ")", "[", "0", "]", "\n", "\n", "self", ".", "dataset", "=", "wilds_dataset", "\n", "self", ".", "indices", "=", "subset_indices", "\n", "self", ".", "transform", "=", "transform", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.WILDSEnvironment.__getitem__": [[280, 289], ["datasets.WILDSEnvironment.dataset.get_input", "PIL.Image.fromarray", "datasets.WILDSEnvironment.transform", "type"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "i", ")", ":", "\n", "        ", "x", "=", "self", ".", "dataset", ".", "get_input", "(", "self", ".", "indices", "[", "i", "]", ")", "\n", "if", "type", "(", "x", ")", ".", "__name__", "!=", "\"Image\"", ":", "\n", "            ", "x", "=", "Image", ".", "fromarray", "(", "x", ")", "\n", "\n", "", "y", "=", "self", ".", "dataset", ".", "y_array", "[", "self", ".", "indices", "[", "i", "]", "]", "\n", "if", "self", ".", "transform", "is", "not", "None", ":", "\n", "            ", "x", "=", "self", ".", "transform", "(", "x", ")", "\n", "", "return", "x", ",", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.WILDSEnvironment.__len__": [[290, 292], ["len"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "indices", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.WILDSDataset.__init__": [[296, 333], ["super().__init__", "torchvision.transforms.Compose", "torchvision.transforms.Compose", "enumerate", "datasets.WILDSDataset.metadata_values", "datasets.WILDSEnvironment", "datasets.WILDSDataset.datasets.append", "torchvision.transforms.Resize", "torchvision.transforms.ToTensor", "torchvision.transforms.Normalize", "torchvision.transforms.Resize", "torchvision.transforms.RandomResizedCrop", "torchvision.transforms.RandomHorizontalFlip", "torchvision.transforms.ColorJitter", "torchvision.transforms.RandomGrayscale", "torchvision.transforms.ToTensor", "torchvision.transforms.Normalize"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.WILDSDataset.metadata_values"], ["def", "__init__", "(", "self", ",", "dataset", ",", "metadata_name", ",", "test_envs", ",", "augment", ",", "hparams", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\n", "transform", "=", "transforms", ".", "Compose", "(", "[", "\n", "transforms", ".", "Resize", "(", "(", "224", ",", "224", ")", ")", ",", "\n", "transforms", ".", "ToTensor", "(", ")", ",", "\n", "transforms", ".", "Normalize", "(", "\n", "mean", "=", "[", "0.485", ",", "0.456", ",", "0.406", "]", ",", "std", "=", "[", "0.229", ",", "0.224", ",", "0.225", "]", ")", "\n", "]", ")", "\n", "\n", "augment_transform", "=", "transforms", ".", "Compose", "(", "[", "\n", "transforms", ".", "Resize", "(", "(", "224", ",", "224", ")", ")", ",", "\n", "transforms", ".", "RandomResizedCrop", "(", "224", ",", "scale", "=", "(", "0.7", ",", "1.0", ")", ")", ",", "\n", "transforms", ".", "RandomHorizontalFlip", "(", ")", ",", "\n", "transforms", ".", "ColorJitter", "(", "0.3", ",", "0.3", ",", "0.3", ",", "0.3", ")", ",", "\n", "transforms", ".", "RandomGrayscale", "(", ")", ",", "\n", "transforms", ".", "ToTensor", "(", ")", ",", "\n", "transforms", ".", "Normalize", "(", "\n", "mean", "=", "[", "0.485", ",", "0.456", ",", "0.406", "]", ",", "std", "=", "[", "0.229", ",", "0.224", ",", "0.225", "]", ")", ",", "\n", "]", ")", "\n", "\n", "self", ".", "datasets", "=", "[", "]", "\n", "\n", "for", "i", ",", "metadata_value", "in", "enumerate", "(", "\n", "self", ".", "metadata_values", "(", "dataset", ",", "metadata_name", ")", ")", ":", "\n", "            ", "if", "augment", "and", "(", "i", "not", "in", "test_envs", ")", ":", "\n", "                ", "env_transform", "=", "augment_transform", "\n", "", "else", ":", "\n", "                ", "env_transform", "=", "transform", "\n", "\n", "", "env_dataset", "=", "WILDSEnvironment", "(", "\n", "dataset", ",", "metadata_name", ",", "metadata_value", ",", "env_transform", ")", "\n", "\n", "self", ".", "datasets", ".", "append", "(", "env_dataset", ")", "\n", "\n", "", "self", ".", "input_shape", "=", "(", "3", ",", "224", ",", "224", ",", ")", "\n", "self", ".", "num_classes", "=", "dataset", ".", "n_classes", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.WILDSDataset.metadata_values": [[334, 338], ["wilds_dataset.metadata_fields.index", "sorted", "list", "set", "metadata_vals.view().tolist", "metadata_vals.view"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sorted"], ["", "def", "metadata_values", "(", "self", ",", "wilds_dataset", ",", "metadata_name", ")", ":", "\n", "        ", "metadata_index", "=", "wilds_dataset", ".", "metadata_fields", ".", "index", "(", "metadata_name", ")", "\n", "metadata_vals", "=", "wilds_dataset", ".", "metadata_array", "[", ":", ",", "metadata_index", "]", "\n", "return", "sorted", "(", "list", "(", "set", "(", "metadata_vals", ".", "view", "(", "-", "1", ")", ".", "tolist", "(", ")", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.WILDSCamelyon.__init__": [[343, 347], ["Camelyon17Dataset", "datasets.WILDSDataset.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "root", ",", "test_envs", ",", "hparams", ")", ":", "\n", "        ", "dataset", "=", "Camelyon17Dataset", "(", "root_dir", "=", "root", ")", "\n", "super", "(", ")", ".", "__init__", "(", "\n", "dataset", ",", "\"hospital\"", ",", "test_envs", ",", "hparams", "[", "'data_augmentation'", "]", ",", "hparams", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.WILDSFMoW.__init__": [[353, 357], ["wilds.datasets.fmow_dataset.FMoWDataset", "datasets.WILDSDataset.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "root", ",", "test_envs", ",", "hparams", ")", ":", "\n", "        ", "dataset", "=", "FMoWDataset", "(", "root_dir", "=", "root", ")", "\n", "super", "(", ")", ".", "__init__", "(", "\n", "dataset", ",", "\"region\"", ",", "test_envs", ",", "hparams", "[", "'data_augmentation'", "]", ",", "hparams", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.get_dataset_class": [[36, 41], ["globals", "NotImplementedError", "globals"], "function", ["None"], ["def", "get_dataset_class", "(", "dataset_name", ")", ":", "\n", "    ", "\"\"\"Return the dataset class with the given name.\"\"\"", "\n", "if", "dataset_name", "not", "in", "globals", "(", ")", ":", "\n", "        ", "raise", "NotImplementedError", "(", "\"Dataset not found: {}\"", ".", "format", "(", "dataset_name", ")", ")", "\n", "", "return", "globals", "(", ")", "[", "dataset_name", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.num_environments": [[43, 45], ["len", "datasets.get_dataset_class"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.get_dataset_class"], ["", "def", "num_environments", "(", "dataset_name", ")", ":", "\n", "    ", "return", "len", "(", "get_dataset_class", "(", "dataset_name", ")", ".", "ENVIRONMENTS", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.fast_data_loader._InfiniteSampler.__init__": [[8, 10], ["None"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "sampler", ")", ":", "\n", "        ", "self", ".", "sampler", "=", "sampler", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.fast_data_loader._InfiniteSampler.__iter__": [[11, 15], ["None"], "methods", ["None"], ["", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "while", "True", ":", "\n", "            ", "for", "batch", "in", "self", ".", "sampler", ":", "\n", "                ", "yield", "batch", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.fast_data_loader.InfiniteDataLoader.__init__": [[18, 42], ["super().__init__", "torch.utils.data.BatchSampler", "iter", "torch.utils.data.WeightedRandomSampler", "torch.utils.data.RandomSampler", "torch.ones", "torch.utils.data.DataLoader", "len", "fast_data_loader._InfiniteSampler"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["    ", "def", "__init__", "(", "self", ",", "dataset", ",", "weights", ",", "batch_size", ",", "num_workers", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\n", "\n", "if", "weights", ":", "\n", "            ", "sampler", "=", "WeightedRandomSampler", "(", "weights", ",", "\n", "replacement", "=", "True", ",", "\n", "num_samples", "=", "batch_size", ")", "\n", "", "else", ":", "\n", "            ", "sampler", "=", "RandomSampler", "(", "dataset", ",", "\n", "replacement", "=", "True", ")", "\n", "\n", "", "if", "weights", "==", "None", ":", "\n", "            ", "weights", "=", "torch", ".", "ones", "(", "len", "(", "dataset", ")", ")", "\n", "\n", "", "batch_sampler", "=", "BatchSampler", "(", "\n", "sampler", ",", "\n", "batch_size", "=", "batch_size", ",", "\n", "drop_last", "=", "True", ")", "\n", "\n", "self", ".", "_infinite_iterator", "=", "iter", "(", "DataLoader", "(", "\n", "dataset", ",", "\n", "num_workers", "=", "num_workers", ",", "\n", "batch_sampler", "=", "_InfiniteSampler", "(", "batch_sampler", ")", "\n", ")", ")", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.fast_data_loader.InfiniteDataLoader.__iter__": [[44, 47], ["next"], "methods", ["None"], ["", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "while", "True", ":", "\n", "            ", "yield", "next", "(", "self", ".", "_infinite_iterator", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.fast_data_loader.InfiniteDataLoader.__len__": [[48, 50], ["None"], "methods", ["None"], ["", "", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "raise", "ValueError", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.fast_data_loader.InfiniteSubDataLoader.__init__": [[52, 68], ["super().__init__", "torch.utils.data.SubsetRandomSampler", "torch.utils.data.BatchSampler", "iter", "torch.utils.data.DataLoader", "range", "len", "fast_data_loader._InfiniteSampler"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["    ", "def", "__init__", "(", "self", ",", "dataset", ",", "weights", ",", "batch_size", ",", "num_workers", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\n", "indexset", "=", "[", "i", "for", "i", "in", "range", "(", "0", ",", "len", "(", "dataset", ")", ",", "100", ")", "]", "\n", "sampler", "=", "SubsetRandomSampler", "(", "indexset", ")", "\n", "\n", "\n", "batch_sampler", "=", "BatchSampler", "(", "\n", "sampler", ",", "\n", "batch_size", "=", "batch_size", ",", "\n", "drop_last", "=", "True", ")", "\n", "\n", "self", ".", "_infinite_iterator", "=", "iter", "(", "DataLoader", "(", "\n", "dataset", ",", "\n", "num_workers", "=", "num_workers", ",", "\n", "batch_sampler", "=", "_InfiniteSampler", "(", "batch_sampler", ")", "\n", ")", ")", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.fast_data_loader.InfiniteSubDataLoader.__iter__": [[70, 73], ["next"], "methods", ["None"], ["", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "while", "True", ":", "\n", "            ", "yield", "next", "(", "self", ".", "_infinite_iterator", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.fast_data_loader.InfiniteSubDataLoader.__len__": [[74, 76], ["None"], "methods", ["None"], ["", "", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "raise", "ValueError", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.fast_data_loader.FastDataLoader.__init__": [[80, 96], ["super().__init__", "torch.utils.data.BatchSampler", "iter", "len", "torch.utils.data.RandomSampler", "torch.utils.data.DataLoader", "fast_data_loader._InfiniteSampler"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["def", "__init__", "(", "self", ",", "dataset", ",", "batch_size", ",", "num_workers", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\n", "batch_sampler", "=", "BatchSampler", "(", "\n", "RandomSampler", "(", "dataset", ",", "replacement", "=", "False", ")", ",", "\n", "batch_size", "=", "batch_size", ",", "\n", "drop_last", "=", "False", "\n", ")", "\n", "\n", "self", ".", "_infinite_iterator", "=", "iter", "(", "DataLoader", "(", "\n", "dataset", ",", "\n", "num_workers", "=", "num_workers", ",", "\n", "batch_sampler", "=", "_InfiniteSampler", "(", "batch_sampler", ")", "\n", ")", ")", "\n", "\n", "self", ".", "_length", "=", "len", "(", "batch_sampler", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.fast_data_loader.FastDataLoader.__iter__": [[97, 100], ["range", "len", "next"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "for", "_", "in", "range", "(", "len", "(", "self", ")", ")", ":", "# for _ in range(len(self)/10)", "\n", "            ", "yield", "next", "(", "self", ".", "_infinite_iterator", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.fast_data_loader.FastDataLoader.__len__": [[101, 103], ["None"], "methods", ["None"], ["", "", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_length", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.fast_data_loader.FastSubDataLoader.__init__": [[107, 125], ["super().__init__", "torch.utils.data.BatchSampler", "iter", "len", "torch.utils.data.SubsetRandomSampler", "torch.utils.data.DataLoader", "range", "len", "fast_data_loader._InfiniteSampler"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["def", "__init__", "(", "self", ",", "dataset", ",", "batch_size", ",", "num_workers", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", ")", "\n", "\n", "indexset", "=", "[", "i", "for", "i", "in", "range", "(", "0", ",", "len", "(", "dataset", ")", ",", "10", ")", "]", "\n", "\n", "batch_sampler", "=", "BatchSampler", "(", "\n", "SubsetRandomSampler", "(", "indexset", ")", ",", "\n", "batch_size", "=", "batch_size", ",", "\n", "drop_last", "=", "False", "\n", ")", "\n", "\n", "self", ".", "_infinite_iterator", "=", "iter", "(", "DataLoader", "(", "\n", "dataset", ",", "\n", "num_workers", "=", "num_workers", ",", "\n", "batch_sampler", "=", "_InfiniteSampler", "(", "batch_sampler", ")", "\n", ")", ")", "\n", "\n", "self", ".", "_length", "=", "len", "(", "batch_sampler", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.fast_data_loader.FastSubDataLoader.__iter__": [[126, 129], ["range", "len", "next"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "def", "__iter__", "(", "self", ")", ":", "\n", "        ", "for", "_", "in", "range", "(", "len", "(", "self", ")", ")", ":", "# for _ in range(len(self)/10)", "\n", "            ", "yield", "next", "(", "self", ".", "_infinite_iterator", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.fast_data_loader.FastSubDataLoader.__len__": [[130, 132], ["None"], "methods", ["None"], ["", "", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "_length", "\n", "", "", ""]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.__init__": [[54, 57], ["object.__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["    ", "def", "__init__", "(", "self", ",", "list_", ")", ":", "\n", "        ", "super", "(", "Q", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "_list", "=", "list_", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.__len__": [[58, 60], ["query.Q.len"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "_list", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.__getitem__": [[61, 63], ["None"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "key", ")", ":", "\n", "        ", "return", "self", ".", "_list", "[", "key", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.__eq__": [[64, 69], ["isinstance"], "methods", ["None"], ["", "def", "__eq__", "(", "self", ",", "other", ")", ":", "\n", "        ", "if", "isinstance", "(", "other", ",", "self", ".", "__class__", ")", ":", "\n", "            ", "return", "self", ".", "_list", "==", "other", ".", "_list", "\n", "", "else", ":", "\n", "            ", "return", "self", ".", "_list", "==", "other", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.__str__": [[70, 72], ["str"], "methods", ["None"], ["", "", "def", "__str__", "(", "self", ")", ":", "\n", "        ", "return", "str", "(", "self", ".", "_list", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.__repr__": [[73, 75], ["repr"], "methods", ["None"], ["", "def", "__repr__", "(", "self", ")", ":", "\n", "        ", "return", "repr", "(", "self", ".", "_list", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q._append": [[76, 79], ["query.Q._list.append"], "methods", ["None"], ["", "def", "_append", "(", "self", ",", "item", ")", ":", "\n", "        ", "\"\"\"Unsafe, be careful you know what you're doing.\"\"\"", "\n", "self", ".", "_list", ".", "append", "(", "item", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.group": [[80, 95], ["query.make_selector_fn", "query.Q", "make_selector_fn.", "query.hashable", "[]._append", "query.Q.sorted"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.make_selector_fn", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.hashable", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q._append", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sorted"], ["", "def", "group", "(", "self", ",", "selector", ")", ":", "\n", "        ", "\"\"\"\n        Group elements by selector and return a list of (group, group_records)\n        tuples.\n        \"\"\"", "\n", "selector", "=", "make_selector_fn", "(", "selector", ")", "\n", "groups", "=", "{", "}", "\n", "for", "x", "in", "self", ".", "_list", ":", "\n", "            ", "group", "=", "selector", "(", "x", ")", "\n", "group_key", "=", "hashable", "(", "group", ")", "\n", "if", "group_key", "not", "in", "groups", ":", "\n", "                ", "groups", "[", "group_key", "]", "=", "(", "group", ",", "Q", "(", "[", "]", ")", ")", "\n", "", "groups", "[", "group_key", "]", "[", "1", "]", ".", "_append", "(", "x", ")", "\n", "", "results", "=", "[", "groups", "[", "key", "]", "for", "key", "in", "sorted", "(", "groups", ".", "keys", "(", ")", ")", "]", "\n", "return", "Q", "(", "results", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.group_map": [[96, 102], ["query.Q.group().map", "query.Q.group"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.map", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.group"], ["", "def", "group_map", "(", "self", ",", "selector", ",", "fn", ")", ":", "\n", "        ", "\"\"\"\n        Group elements by selector, apply fn to each group, and return a list\n        of the results.\n        \"\"\"", "\n", "return", "self", ".", "group", "(", "selector", ")", ".", "map", "(", "fn", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.map": [[103, 112], ["query.Q.len"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "def", "map", "(", "self", ",", "fn", ")", ":", "\n", "        ", "\"\"\"\n        map self onto fn. If fn takes multiple args, tuple-unpacking\n        is applied.\n        \"\"\"", "\n", "if", "len", "(", "inspect", ".", "signature", "(", "fn", ")", ".", "parameters", ")", ">", "1", ":", "\n", "            ", "return", "Q", "(", "[", "fn", "(", "*", "x", ")", "for", "x", "in", "self", ".", "_list", "]", ")", "\n", "", "else", ":", "\n", "            ", "return", "Q", "(", "[", "fn", "(", "x", ")", "for", "x", "in", "self", ".", "_list", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.select": [[113, 116], ["query.make_selector_fn", "query.Q", "make_selector_fn."], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.make_selector_fn"], ["", "", "def", "select", "(", "self", ",", "selector", ")", ":", "\n", "        ", "selector", "=", "make_selector_fn", "(", "selector", ")", "\n", "return", "Q", "(", "[", "selector", "(", "x", ")", "for", "x", "in", "self", ".", "_list", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.min": [[117, 119], ["query.Q.min"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.min"], ["", "def", "min", "(", "self", ")", ":", "\n", "        ", "return", "min", "(", "self", ".", "_list", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.max": [[120, 122], ["query.Q.max"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.max"], ["", "def", "max", "(", "self", ")", ":", "\n", "        ", "return", "max", "(", "self", ".", "_list", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum": [[123, 125], ["query.Q.sum"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum"], ["", "def", "sum", "(", "self", ")", ":", "\n", "        ", "return", "sum", "(", "self", ".", "_list", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len": [[126, 128], ["query.Q.len"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "def", "len", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "_list", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean": [[129, 133], ["warnings.catch_warnings", "warnings.simplefilter", "float", "numpy.mean"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean"], ["", "def", "mean", "(", "self", ")", ":", "\n", "        ", "with", "warnings", ".", "catch_warnings", "(", ")", ":", "\n", "            ", "warnings", ".", "simplefilter", "(", "\"ignore\"", ")", "\n", "return", "float", "(", "np", ".", "mean", "(", "self", ".", "_list", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.std": [[134, 138], ["warnings.catch_warnings", "warnings.simplefilter", "float", "numpy.std"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.std"], ["", "", "def", "std", "(", "self", ")", ":", "\n", "        ", "with", "warnings", ".", "catch_warnings", "(", ")", ":", "\n", "            ", "warnings", ".", "simplefilter", "(", "\"ignore\"", ")", "\n", "return", "float", "(", "np", ".", "std", "(", "self", ".", "_list", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean_std": [[139, 141], ["query.Q.mean", "query.Q.std"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.std"], ["", "", "def", "mean_std", "(", "self", ")", ":", "\n", "        ", "return", "(", "self", ".", "mean", "(", ")", ",", "self", ".", "std", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.argmax": [[142, 145], ["query.make_selector_fn", "query.Q.max"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.make_selector_fn", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.max"], ["", "def", "argmax", "(", "self", ",", "selector", ")", ":", "\n", "        ", "selector", "=", "make_selector_fn", "(", "selector", ")", "\n", "return", "max", "(", "self", ".", "_list", ",", "key", "=", "selector", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.filter": [[146, 148], ["query.Q", "fn"], "methods", ["None"], ["", "def", "filter", "(", "self", ",", "fn", ")", ":", "\n", "        ", "return", "Q", "(", "[", "x", "for", "x", "in", "self", ".", "_list", "if", "fn", "(", "x", ")", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.filter_equals": [[149, 153], ["query.make_selector_fn", "query.Q.filter", "make_selector_fn."], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.make_selector_fn", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.filter"], ["", "def", "filter_equals", "(", "self", ",", "selector", ",", "value", ")", ":", "\n", "        ", "\"\"\"like [x for x in y if x.selector == value]\"\"\"", "\n", "selector", "=", "make_selector_fn", "(", "selector", ")", "\n", "return", "self", ".", "filter", "(", "lambda", "r", ":", "selector", "(", "r", ")", "==", "value", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.filter_not_none": [[154, 156], ["query.Q.filter"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.filter"], ["", "def", "filter_not_none", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "filter", "(", "lambda", "r", ":", "r", "is", "not", "None", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.filter_not_nan": [[157, 159], ["query.Q.filter", "numpy.isnan"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.filter"], ["", "def", "filter_not_nan", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "filter", "(", "lambda", "r", ":", "not", "np", ".", "isnan", "(", "r", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.flatten": [[160, 162], ["query.Q"], "methods", ["None"], ["", "def", "flatten", "(", "self", ")", ":", "\n", "        ", "return", "Q", "(", "[", "y", "for", "x", "in", "self", ".", "_list", "for", "y", "in", "x", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.unique": [[163, 172], ["set", "query.Q", "query.hashable", "set.add", "result.append"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.hashable"], ["", "def", "unique", "(", "self", ")", ":", "\n", "        ", "result", "=", "[", "]", "\n", "result_set", "=", "set", "(", ")", "\n", "for", "x", "in", "self", ".", "_list", ":", "\n", "            ", "hashable_x", "=", "hashable", "(", "x", ")", "\n", "if", "hashable_x", "not", "in", "result_set", ":", "\n", "                ", "result_set", ".", "add", "(", "hashable_x", ")", "\n", "result", ".", "append", "(", "x", ")", "\n", "", "", "return", "Q", "(", "result", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sorted": [[173, 183], ["query.Q", "key", "query.Q.sorted"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sorted"], ["", "def", "sorted", "(", "self", ",", "key", "=", "None", ")", ":", "\n", "        ", "if", "key", "is", "None", ":", "\n", "            ", "key", "=", "lambda", "x", ":", "x", "\n", "", "def", "key2", "(", "x", ")", ":", "\n", "            ", "x", "=", "key", "(", "x", ")", "\n", "if", "isinstance", "(", "x", ",", "(", "np", ".", "floating", ",", "float", ")", ")", "and", "np", ".", "isnan", "(", "x", ")", ":", "\n", "                ", "return", "float", "(", "'-inf'", ")", "\n", "", "else", ":", "\n", "                ", "return", "x", "\n", "", "", "return", "Q", "(", "sorted", "(", "self", ".", "_list", ",", "key", "=", "key2", ")", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.make_selector_fn": [[16, 45], ["isinstance", "isinstance", "selector.split", "query.make_selector_fn", "tuple", "selector.split", "selector.strip", "query.make_selector_fn", "sel", "sel"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.make_selector_fn", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.make_selector_fn"], ["def", "make_selector_fn", "(", "selector", ")", ":", "\n", "    ", "\"\"\"\n    If selector is a function, return selector.\n    Otherwise, return a function corresponding to the selector string. Examples\n    of valid selector strings and the corresponding functions:\n        x       lambda obj: obj['x']\n        x.y     lambda obj: obj['x']['y']\n        x,y     lambda obj: (obj['x'], obj['y'])\n    \"\"\"", "\n", "if", "isinstance", "(", "selector", ",", "str", ")", ":", "\n", "        ", "if", "','", "in", "selector", ":", "\n", "            ", "parts", "=", "selector", ".", "split", "(", "','", ")", "\n", "part_selectors", "=", "[", "make_selector_fn", "(", "part", ")", "for", "part", "in", "parts", "]", "\n", "return", "lambda", "obj", ":", "tuple", "(", "sel", "(", "obj", ")", "for", "sel", "in", "part_selectors", ")", "\n", "", "elif", "'.'", "in", "selector", ":", "\n", "            ", "parts", "=", "selector", ".", "split", "(", "'.'", ")", "\n", "part_selectors", "=", "[", "make_selector_fn", "(", "part", ")", "for", "part", "in", "parts", "]", "\n", "def", "f", "(", "obj", ")", ":", "\n", "                ", "for", "sel", "in", "part_selectors", ":", "\n", "                    ", "obj", "=", "sel", "(", "obj", ")", "\n", "", "return", "obj", "\n", "", "return", "f", "\n", "", "else", ":", "\n", "            ", "key", "=", "selector", ".", "strip", "(", ")", "\n", "return", "lambda", "obj", ":", "obj", "[", "key", "]", "\n", "", "", "elif", "isinstance", "(", "selector", ",", "types", ".", "FunctionType", ")", ":", "\n", "        ", "return", "selector", "\n", "", "else", ":", "\n", "        ", "raise", "TypeError", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.hashable": [[46, 52], ["hash", "json.dumps"], "function", ["None"], ["", "", "def", "hashable", "(", "obj", ")", ":", "\n", "    ", "try", ":", "\n", "        ", "hash", "(", "obj", ")", "\n", "return", "obj", "\n", "", "except", "TypeError", ":", "\n", "        ", "return", "json", ".", "dumps", "(", "{", "'_'", ":", "obj", "}", ",", "sort_keys", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.wide_resnet.wide_basic.__init__": [[38, 54], ["torch.Module.__init__", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.Dropout", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d", "torch.Conv2d"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["    ", "def", "__init__", "(", "self", ",", "in_planes", ",", "planes", ",", "dropout_rate", ",", "stride", "=", "1", ")", ":", "\n", "        ", "super", "(", "wide_basic", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "bn1", "=", "nn", ".", "BatchNorm2d", "(", "in_planes", ")", "\n", "self", ".", "conv1", "=", "nn", ".", "Conv2d", "(", "\n", "in_planes", ",", "planes", ",", "kernel_size", "=", "3", ",", "padding", "=", "1", ",", "bias", "=", "True", ")", "\n", "self", ".", "dropout", "=", "nn", ".", "Dropout", "(", "p", "=", "dropout_rate", ")", "\n", "self", ".", "bn2", "=", "nn", ".", "BatchNorm2d", "(", "planes", ")", "\n", "self", ".", "conv2", "=", "nn", ".", "Conv2d", "(", "\n", "planes", ",", "planes", ",", "kernel_size", "=", "3", ",", "stride", "=", "stride", ",", "padding", "=", "1", ",", "bias", "=", "True", ")", "\n", "\n", "self", ".", "shortcut", "=", "nn", ".", "Sequential", "(", ")", "\n", "if", "stride", "!=", "1", "or", "in_planes", "!=", "planes", ":", "\n", "            ", "self", ".", "shortcut", "=", "nn", ".", "Sequential", "(", "\n", "nn", ".", "Conv2d", "(", "\n", "in_planes", ",", "planes", ",", "kernel_size", "=", "1", ",", "stride", "=", "stride", ",", "\n", "bias", "=", "True", ")", ",", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.wide_resnet.wide_basic.forward": [[55, 61], ["wide_resnet.wide_basic.dropout", "wide_resnet.wide_basic.conv2", "wide_resnet.wide_basic.shortcut", "wide_resnet.wide_basic.conv1", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "wide_resnet.wide_basic.bn2", "wide_resnet.wide_basic.bn1"], "methods", ["None"], ["", "", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "out", "=", "self", ".", "dropout", "(", "self", ".", "conv1", "(", "F", ".", "relu", "(", "self", ".", "bn1", "(", "x", ")", ")", ")", ")", "\n", "out", "=", "self", ".", "conv2", "(", "F", ".", "relu", "(", "self", ".", "bn2", "(", "out", ")", ")", ")", "\n", "out", "+=", "self", ".", "shortcut", "(", "x", ")", "\n", "\n", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.wide_resnet.Wide_ResNet.__init__": [[65, 86], ["torch.Module.__init__", "wide_resnet.conv3x3", "wide_resnet.Wide_ResNet._wide_layer", "wide_resnet.Wide_ResNet._wide_layer", "wide_resnet.Wide_ResNet._wide_layer", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.BatchNorm2d", "torch.BatchNorm2d"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.wide_resnet.conv3x3", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.wide_resnet.Wide_ResNet._wide_layer", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.wide_resnet.Wide_ResNet._wide_layer", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.wide_resnet.Wide_ResNet._wide_layer"], ["def", "__init__", "(", "self", ",", "input_shape", ",", "depth", ",", "widen_factor", ",", "dropout_rate", ")", ":", "\n", "        ", "super", "(", "Wide_ResNet", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "in_planes", "=", "16", "\n", "\n", "assert", "(", "(", "depth", "-", "4", ")", "%", "6", "==", "0", ")", ",", "'Wide-resnet depth should be 6n+4'", "\n", "n", "=", "(", "depth", "-", "4", ")", "/", "6", "\n", "k", "=", "widen_factor", "\n", "\n", "# print('| Wide-Resnet %dx%d' % (depth, k))", "\n", "nStages", "=", "[", "16", ",", "16", "*", "k", ",", "32", "*", "k", ",", "64", "*", "k", "]", "\n", "\n", "self", ".", "conv1", "=", "conv3x3", "(", "input_shape", "[", "0", "]", ",", "nStages", "[", "0", "]", ")", "\n", "self", ".", "layer1", "=", "self", ".", "_wide_layer", "(", "\n", "wide_basic", ",", "nStages", "[", "1", "]", ",", "n", ",", "dropout_rate", ",", "stride", "=", "1", ")", "\n", "self", ".", "layer2", "=", "self", ".", "_wide_layer", "(", "\n", "wide_basic", ",", "nStages", "[", "2", "]", ",", "n", ",", "dropout_rate", ",", "stride", "=", "2", ")", "\n", "self", ".", "layer3", "=", "self", ".", "_wide_layer", "(", "\n", "wide_basic", ",", "nStages", "[", "3", "]", ",", "n", ",", "dropout_rate", ",", "stride", "=", "2", ")", "\n", "self", ".", "bn1", "=", "nn", ".", "BatchNorm2d", "(", "nStages", "[", "3", "]", ",", "momentum", "=", "0.9", ")", "\n", "\n", "self", ".", "n_outputs", "=", "nStages", "[", "3", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.wide_resnet.Wide_ResNet._wide_layer": [[87, 96], ["torch.Sequential", "torch.Sequential", "torch.Sequential", "torch.Sequential", "layers.append", "block", "int"], "methods", ["None"], ["", "def", "_wide_layer", "(", "self", ",", "block", ",", "planes", ",", "num_blocks", ",", "dropout_rate", ",", "stride", ")", ":", "\n", "        ", "strides", "=", "[", "stride", "]", "+", "[", "1", "]", "*", "(", "int", "(", "num_blocks", ")", "-", "1", ")", "\n", "layers", "=", "[", "]", "\n", "\n", "for", "stride", "in", "strides", ":", "\n", "            ", "layers", ".", "append", "(", "block", "(", "self", ".", "in_planes", ",", "planes", ",", "dropout_rate", ",", "stride", ")", ")", "\n", "self", ".", "in_planes", "=", "planes", "\n", "\n", "", "return", "nn", ".", "Sequential", "(", "*", "layers", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.wide_resnet.Wide_ResNet.forward": [[97, 105], ["wide_resnet.Wide_ResNet.conv1", "wide_resnet.Wide_ResNet.layer1", "wide_resnet.Wide_ResNet.layer2", "wide_resnet.Wide_ResNet.layer3", "torch.relu", "torch.relu", "torch.relu", "torch.relu", "torch.avg_pool2d", "torch.avg_pool2d", "torch.avg_pool2d", "torch.avg_pool2d", "wide_resnet.Wide_ResNet.bn1"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "x", ")", ":", "\n", "        ", "out", "=", "self", ".", "conv1", "(", "x", ")", "\n", "out", "=", "self", ".", "layer1", "(", "out", ")", "\n", "out", "=", "self", ".", "layer2", "(", "out", ")", "\n", "out", "=", "self", ".", "layer3", "(", "out", ")", "\n", "out", "=", "F", ".", "relu", "(", "self", ".", "bn1", "(", "out", ")", ")", "\n", "out", "=", "F", ".", "avg_pool2d", "(", "out", ",", "8", ")", "\n", "return", "out", "[", ":", ",", ":", ",", "0", ",", "0", "]", "\n", "", "", ""]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.wide_resnet.conv3x3": [[17, 25], ["torch.Conv2d"], "function", ["None"], ["def", "conv3x3", "(", "in_planes", ",", "out_planes", ",", "stride", "=", "1", ")", ":", "\n", "    ", "return", "nn", ".", "Conv2d", "(", "\n", "in_planes", ",", "\n", "out_planes", ",", "\n", "kernel_size", "=", "3", ",", "\n", "stride", "=", "stride", ",", "\n", "padding", "=", "1", ",", "\n", "bias", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.wide_resnet.conv_init": [[27, 35], ["classname.find", "torch.xavier_uniform_", "torch.constant_", "classname.find", "torch.constant_", "torch.constant_", "numpy.sqrt"], "function", ["None"], ["", "def", "conv_init", "(", "m", ")", ":", "\n", "    ", "classname", "=", "m", ".", "__class__", ".", "__name__", "\n", "if", "classname", ".", "find", "(", "'Conv'", ")", "!=", "-", "1", ":", "\n", "        ", "init", ".", "xavier_uniform_", "(", "m", ".", "weight", ",", "gain", "=", "np", ".", "sqrt", "(", "2", ")", ")", "\n", "init", ".", "constant_", "(", "m", ".", "bias", ",", "0", ")", "\n", "", "elif", "classname", ".", "find", "(", "'BatchNorm'", ")", "!=", "-", "1", ":", "\n", "        ", "init", ".", "constant_", "(", "m", ".", "weight", ",", "1", ")", "\n", "init", ".", "constant_", "(", "m", ".", "bias", ",", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc._SplitDataset.__init__": [[72, 76], ["super().__init__"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__"], ["def", "__init__", "(", "self", ",", "underlying_dataset", ",", "keys", ")", ":", "\n", "        ", "super", "(", "_SplitDataset", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "underlying_dataset", "=", "underlying_dataset", "\n", "self", ".", "keys", "=", "keys", "\n", "", "def", "__getitem__", "(", "self", ",", "key", ")", ":", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc._SplitDataset.__getitem__": [[76, 78], ["None"], "methods", ["None"], ["", "def", "__getitem__", "(", "self", ",", "key", ")", ":", "\n", "        ", "return", "self", ".", "underlying_dataset", "[", "self", ".", "keys", "[", "key", "]", "]", "\n", "", "def", "__len__", "(", "self", ")", ":", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc._SplitDataset.__len__": [[78, 80], ["len"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "def", "__len__", "(", "self", ")", ":", "\n", "        ", "return", "len", "(", "self", ".", "keys", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.Tee.__init__": [[159, 162], ["open"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "fname", ",", "mode", "=", "\"a\"", ")", ":", "\n", "        ", "self", ".", "stdout", "=", "sys", ".", "stdout", "\n", "self", ".", "file", "=", "open", "(", "fname", ",", "mode", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.Tee.write": [[163, 167], ["misc.Tee.stdout.write", "misc.Tee.file.write", "misc.Tee.flush"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.Tee.write", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.Tee.write", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.Tee.flush"], ["", "def", "write", "(", "self", ",", "message", ")", ":", "\n", "        ", "self", ".", "stdout", ".", "write", "(", "message", ")", "\n", "self", ".", "file", ".", "write", "(", "message", ")", "\n", "self", ".", "flush", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.Tee.flush": [[168, 171], ["misc.Tee.stdout.flush", "misc.Tee.file.flush"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.Tee.flush", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.Tee.flush"], ["", "def", "flush", "(", "self", ")", ":", "\n", "        ", "self", ".", "stdout", ".", "flush", "(", ")", "\n", "self", ".", "file", ".", "flush", "(", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.make_weights_for_balanced_classes": [[20, 39], ["collections.Counter", "len", "torch.zeros", "torch.zeros", "enumerate", "int", "classes.append", "len", "int"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["def", "make_weights_for_balanced_classes", "(", "dataset", ")", ":", "\n", "    ", "counts", "=", "Counter", "(", ")", "\n", "classes", "=", "[", "]", "\n", "for", "_", ",", "y", "in", "dataset", ":", "\n", "        ", "y", "=", "int", "(", "y", ")", "\n", "counts", "[", "y", "]", "+=", "1", "\n", "classes", ".", "append", "(", "y", ")", "\n", "\n", "", "n_classes", "=", "len", "(", "counts", ")", "\n", "\n", "weight_per_class", "=", "{", "}", "\n", "for", "y", "in", "counts", ":", "\n", "        ", "weight_per_class", "[", "y", "]", "=", "1", "/", "(", "counts", "[", "y", "]", "*", "n_classes", ")", "\n", "\n", "", "weights", "=", "torch", ".", "zeros", "(", "len", "(", "dataset", ")", ")", "\n", "for", "i", ",", "y", "in", "enumerate", "(", "classes", ")", ":", "\n", "        ", "weights", "[", "i", "]", "=", "weight_per_class", "[", "int", "(", "y", ")", "]", "\n", "\n", "", "return", "weights", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.pdb": [[40, 45], ["print", "pdb.set_trace"], "function", ["None"], ["", "def", "pdb", "(", ")", ":", "\n", "    ", "sys", ".", "stdout", "=", "sys", ".", "__stdout__", "\n", "import", "pdb", "\n", "print", "(", "\"Launching PDB, enter 'n' to step to parent function.\"", ")", "\n", "pdb", ".", "set_trace", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.seed_hash": [[46, 52], ["str", "int", "hashlib.md5().hexdigest", "hashlib.md5", "str.encode"], "function", ["None"], ["", "def", "seed_hash", "(", "*", "args", ")", ":", "\n", "    ", "\"\"\"\n    Derive an integer hash from all args, for use as a random seed.\n    \"\"\"", "\n", "args_str", "=", "str", "(", "args", ")", "\n", "return", "int", "(", "hashlib", ".", "md5", "(", "args_str", ".", "encode", "(", "\"utf-8\"", ")", ")", ".", "hexdigest", "(", ")", ",", "16", ")", "%", "(", "2", "**", "31", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.print_separator": [[53, 55], ["print"], "function", ["None"], ["", "def", "print_separator", "(", ")", ":", "\n", "    ", "print", "(", "\"=\"", "*", "80", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.print_row": [[56, 69], ["print", "numpy.issubdtype", "sep.join", "type", "str().ljust", "misc.print_row.format_val"], "function", ["None"], ["", "def", "print_row", "(", "row", ",", "colwidth", "=", "10", ",", "latex", "=", "False", ")", ":", "\n", "    ", "if", "latex", ":", "\n", "        ", "sep", "=", "\" & \"", "\n", "end_", "=", "\"\\\\\\\\\"", "\n", "", "else", ":", "\n", "        ", "sep", "=", "\"  \"", "\n", "end_", "=", "\"\"", "\n", "\n", "", "def", "format_val", "(", "x", ")", ":", "\n", "        ", "if", "np", ".", "issubdtype", "(", "type", "(", "x", ")", ",", "np", ".", "floating", ")", ":", "\n", "            ", "x", "=", "\"{:.10f}\"", ".", "format", "(", "x", ")", "\n", "", "return", "str", "(", "x", ")", ".", "ljust", "(", "colwidth", ")", "[", ":", "colwidth", "]", "\n", "", "print", "(", "sep", ".", "join", "(", "[", "format_val", "(", "x", ")", "for", "x", "in", "row", "]", ")", ",", "end_", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.split_dataset": [[81, 93], ["list", "numpy.random.RandomState().shuffle", "len", "range", "misc._SplitDataset", "misc._SplitDataset", "len", "numpy.random.RandomState"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "", "def", "split_dataset", "(", "dataset", ",", "n", ",", "seed", "=", "0", ")", ":", "\n", "    ", "\"\"\"\n    Return a pair of datasets corresponding to a random split of the given\n    dataset, with n datapoints in the first dataset and the rest in the last,\n    using the given random seed\n    \"\"\"", "\n", "assert", "(", "n", "<=", "len", "(", "dataset", ")", ")", "\n", "keys", "=", "list", "(", "range", "(", "len", "(", "dataset", ")", ")", ")", "\n", "np", ".", "random", ".", "RandomState", "(", "seed", ")", ".", "shuffle", "(", "keys", ")", "\n", "keys_1", "=", "keys", "[", ":", "n", "]", "\n", "keys_2", "=", "keys", "[", "n", ":", "]", "\n", "return", "_SplitDataset", "(", "dataset", ",", "keys_1", ")", ",", "_SplitDataset", "(", "dataset", ",", "keys_2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.random_pairs_of_minibatches": [[94, 109], ["torch.randperm().tolist", "torch.randperm().tolist", "range", "len", "min", "pairs.append", "torch.randperm", "torch.randperm", "len", "len", "len", "len"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.min", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "def", "random_pairs_of_minibatches", "(", "minibatches", ")", ":", "\n", "    ", "perm", "=", "torch", ".", "randperm", "(", "len", "(", "minibatches", ")", ")", ".", "tolist", "(", ")", "\n", "pairs", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "len", "(", "minibatches", ")", ")", ":", "\n", "        ", "j", "=", "i", "+", "1", "if", "i", "<", "(", "len", "(", "minibatches", ")", "-", "1", ")", "else", "0", "\n", "\n", "xi", ",", "yi", "=", "minibatches", "[", "perm", "[", "i", "]", "]", "[", "0", "]", ",", "minibatches", "[", "perm", "[", "i", "]", "]", "[", "1", "]", "\n", "xj", ",", "yj", "=", "minibatches", "[", "perm", "[", "j", "]", "]", "[", "0", "]", ",", "minibatches", "[", "perm", "[", "j", "]", "]", "[", "1", "]", "\n", "\n", "min_n", "=", "min", "(", "len", "(", "xi", ")", ",", "len", "(", "xj", ")", ")", "\n", "\n", "pairs", ".", "append", "(", "(", "(", "xi", "[", ":", "min_n", "]", ",", "yi", "[", ":", "min_n", "]", ")", ",", "(", "xj", "[", ":", "min_n", "]", ",", "yj", "[", ":", "min_n", "]", ")", ")", ")", "\n", "\n", "", "return", "pairs", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.accuracy": [[110, 136], ["torch.no_grad", "torch.no_grad", "x.to.to", "y.to.to", "network.predict", "torch.ones.to", "torch.ones.sum().item", "torch.ones", "torch.ones", "len", "network.predict.size", "len", "torch.ones.sum", "len", "network.predict.gt().eq().float", "torch.ones.view", "network.predict.argmax().eq().float", "network.predict.gt().eq", "network.predict.argmax().eq", "network.predict.gt", "network.predict.argmax"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.predict", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.argmax"], ["", "def", "accuracy", "(", "network", ",", "loader", ",", "weights", ",", "device", ")", ":", "\n", "    ", "correct", "=", "0", "\n", "total", "=", "0", "\n", "weights_offset", "=", "0", "\n", "\n", "\n", "'''network.eval()'''", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "        ", "for", "x", ",", "y", "in", "loader", ":", "\n", "            ", "x", "=", "x", ".", "to", "(", "device", ")", "\n", "y", "=", "y", ".", "to", "(", "device", ")", "\n", "p", "=", "network", ".", "predict", "(", "x", ")", "\n", "if", "weights", "is", "None", ":", "\n", "                ", "batch_weights", "=", "torch", ".", "ones", "(", "len", "(", "x", ")", ")", "\n", "", "else", ":", "\n", "                ", "batch_weights", "=", "weights", "[", "weights_offset", ":", "weights_offset", "+", "len", "(", "x", ")", "]", "\n", "weights_offset", "+=", "len", "(", "x", ")", "\n", "", "batch_weights", "=", "batch_weights", ".", "to", "(", "device", ")", "\n", "if", "p", ".", "size", "(", "1", ")", "==", "1", ":", "\n", "                ", "correct", "+=", "(", "p", ".", "gt", "(", "0", ")", ".", "eq", "(", "y", ")", ".", "float", "(", ")", "*", "batch_weights", ".", "view", "(", "-", "1", ",", "1", ")", ")", ".", "sum", "(", ")", ".", "item", "(", ")", "\n", "", "else", ":", "\n", "                ", "correct", "+=", "(", "p", ".", "argmax", "(", "1", ")", ".", "eq", "(", "y", ")", ".", "float", "(", ")", "*", "batch_weights", ")", ".", "sum", "(", ")", ".", "item", "(", ")", "\n", "", "total", "+=", "batch_weights", ".", "sum", "(", ")", ".", "item", "(", ")", "\n", "", "", "'''network.train()'''", "\n", "\n", "return", "correct", "/", "total", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.loss": [[138, 156], ["loss.item.item", "torch.no_grad", "torch.no_grad", "x.to.to", "y.to.to", "network.predict", "torch.ones", "torch.ones", "batch.to.to", "batch.to.sum().item", "len", "torch.cross_entropy", "len", "batch.to.sum"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.algorithms.SagNet.predict", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum"], ["", "def", "loss", "(", "network", ",", "loader", ",", "device", ")", ":", "\n", "    ", "loss", "=", "0.", "\n", "total", "=", "0.", "\n", "step", "=", "0", "\n", "\n", "with", "torch", ".", "no_grad", "(", ")", ":", "\n", "        ", "for", "x", ",", "y", "in", "loader", ":", "\n", "            ", "x", "=", "x", ".", "to", "(", "device", ")", "\n", "y", "=", "y", ".", "to", "(", "device", ")", "\n", "p", "=", "network", ".", "predict", "(", "x", ")", "\n", "batch", "=", "torch", ".", "ones", "(", "len", "(", "x", ")", ",", "dtype", "=", "torch", ".", "float64", ")", "\n", "batch", "=", "batch", ".", "to", "(", "device", ")", "\n", "total", "+=", "batch", ".", "sum", "(", ")", ".", "item", "(", ")", "\n", "loss", "+=", "F", ".", "cross_entropy", "(", "p", ",", "y", ")", "*", "len", "(", "y", ")", "\n", "# the cross entropy is avged over the minibatch", "\n", "step", "+=", "1", "\n", "", "", "loss", "=", "loss", ".", "item", "(", ")", "\n", "return", "loss", "/", "total", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.reporting.load_records": [[12, 26], ["tqdm.tqdm", "domainbed.lib.query.Q", "list", "os.path.join", "enumerate", "os.listdir", "open", "records.append", "json.loads"], "function", ["None"], ["def", "load_records", "(", "path", ")", ":", "\n", "    ", "records", "=", "[", "]", "\n", "for", "i", ",", "subdir", "in", "tqdm", ".", "tqdm", "(", "list", "(", "enumerate", "(", "os", ".", "listdir", "(", "path", ")", ")", ")", ",", "\n", "ncols", "=", "80", ",", "\n", "leave", "=", "False", ")", ":", "\n", "        ", "results_path", "=", "os", ".", "path", ".", "join", "(", "path", ",", "subdir", ",", "\"results.jsonl\"", ")", "\n", "try", ":", "\n", "            ", "with", "open", "(", "results_path", ",", "\"r\"", ")", "as", "f", ":", "\n", "                ", "for", "line", "in", "f", ":", "\n", "                    ", "records", ".", "append", "(", "json", ".", "loads", "(", "line", "[", ":", "-", "1", "]", ")", ")", "\n", "", "", "", "except", "IOError", ":", "\n", "            ", "pass", "\n", "\n", "", "", "return", "Q", "(", "records", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.reporting.get_grouped_records": [[27, 41], ["collections.defaultdict", "domainbed.lib.query.Q", "result[].append", "domainbed.lib.query.Q", "collections.defaultdict.items"], "function", ["None"], ["", "def", "get_grouped_records", "(", "records", ")", ":", "\n", "    ", "\"\"\"Group records by (trial_seed, dataset, algorithm, test_env). Because\n    records can have multiple test envs, a given record may appear in more than\n    one group.\"\"\"", "\n", "result", "=", "collections", ".", "defaultdict", "(", "lambda", ":", "[", "]", ")", "\n", "for", "r", "in", "records", ":", "\n", "        ", "for", "test_env", "in", "r", "[", "\"args\"", "]", "[", "\"test_envs\"", "]", ":", "\n", "            ", "group", "=", "(", "r", "[", "\"args\"", "]", "[", "\"trial_seed\"", "]", ",", "\n", "r", "[", "\"args\"", "]", "[", "\"dataset\"", "]", ",", "\n", "r", "[", "\"args\"", "]", "[", "\"algorithm\"", "]", ",", "\n", "test_env", ")", "\n", "result", "[", "group", "]", ".", "append", "(", "r", ")", "\n", "", "", "return", "Q", "(", "[", "{", "\"trial_seed\"", ":", "t", ",", "\"dataset\"", ":", "d", ",", "\"algorithm\"", ":", "a", ",", "\"test_env\"", ":", "e", ",", "\n", "\"records\"", ":", "Q", "(", "r", ")", "}", "for", "(", "t", ",", "d", ",", "a", ",", "e", ")", ",", "r", "in", "result", ".", "items", "(", ")", "]", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.list_top_hparams.todo_rename": [[33, 107], ["domainbed.lib.reporting.get_grouped_records().map().filter", "domainbed.lib.query.Q().select().unique", "domainbed.lib.query.Q().select().unique().sorted", "enumerate", "print_table", "range", "enumerate", "print_table", "print", "print", "enumerate", "domainbed.lib.reporting.get_grouped_records().map", "domainbed.lib.query.Q().select", "domainbed.lib.query.Q().select().unique", "print", "print", "domainbed.datasets.num_environments", "enumerate", "list", "reporting.get_grouped_records().map().filter.filter_equals().group().map", "format_mean", "means.append", "reporting.get_grouped_records().map().filter.filter_equals().select", "format_mean", "means.append", "domainbed.lib.reporting.get_grouped_records", "domainbed.lib.query.Q", "domainbed.lib.query.Q().select", "domainbed.datasets.get_dataset_class", "reporting.get_grouped_records().map().filter.filter_equals().group", "group.select().mean", "sum", "len", "selection_method.sweep_acc", "reporting.get_grouped_records().map().filter.filter_equals", "sum", "len", "domainbed.lib.query.Q", "reporting.get_grouped_records().map().filter.filter_equals", "group.select"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.filter", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.unique", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sorted", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.collect_results.print_table", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.collect_results.print_table", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.map", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.select", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.unique", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.num_environments", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.map", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.collect_results.format_mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.select", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.collect_results.format_mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.reporting.get_grouped_records", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.select", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.get_dataset_class", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.group", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.model_selection.SelectionMethod.sweep_acc", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.filter_equals", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.filter_equals", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.select"], ["def", "todo_rename", "(", "records", ",", "selection_method", ",", "latex", ")", ":", "\n", "\n", "    ", "grouped_records", "=", "reporting", ".", "get_grouped_records", "(", "records", ")", ".", "map", "(", "lambda", "group", ":", "\n", "{", "**", "group", ",", "\"sweep_acc\"", ":", "selection_method", ".", "sweep_acc", "(", "group", "[", "\"records\"", "]", ")", "}", "\n", ")", ".", "filter", "(", "lambda", "g", ":", "g", "[", "\"sweep_acc\"", "]", "is", "not", "None", ")", "\n", "\n", "# read algorithm names and sort (predefined order)", "\n", "alg_names", "=", "Q", "(", "records", ")", ".", "select", "(", "\"args.algorithm\"", ")", ".", "unique", "(", ")", "\n", "alg_names", "=", "(", "[", "n", "for", "n", "in", "algorithms", ".", "ALGORITHMS", "if", "n", "in", "alg_names", "]", "+", "\n", "[", "n", "for", "n", "in", "alg_names", "if", "n", "not", "in", "algorithms", ".", "ALGORITHMS", "]", ")", "\n", "\n", "# read dataset names and sort (lexicographic order)", "\n", "dataset_names", "=", "Q", "(", "records", ")", ".", "select", "(", "\"args.dataset\"", ")", ".", "unique", "(", ")", ".", "sorted", "(", ")", "\n", "dataset_names", "=", "[", "d", "for", "d", "in", "datasets", ".", "DATASETS", "if", "d", "in", "dataset_names", "]", "\n", "\n", "for", "dataset", "in", "dataset_names", ":", "\n", "        ", "if", "latex", ":", "\n", "            ", "print", "(", ")", "\n", "print", "(", "\"\\\\subsubsection{{{}}}\"", ".", "format", "(", "dataset", ")", ")", "\n", "", "test_envs", "=", "range", "(", "datasets", ".", "num_environments", "(", "dataset", ")", ")", "\n", "\n", "table", "=", "[", "[", "None", "for", "_", "in", "[", "*", "test_envs", ",", "\"Avg\"", "]", "]", "for", "_", "in", "alg_names", "]", "\n", "for", "i", ",", "algorithm", "in", "enumerate", "(", "alg_names", ")", ":", "\n", "            ", "means", "=", "[", "]", "\n", "for", "j", ",", "test_env", "in", "enumerate", "(", "test_envs", ")", ":", "\n", "                ", "trial_accs", "=", "(", "grouped_records", "\n", ".", "filter_equals", "(", "\n", "\"dataset, algorithm, test_env\"", ",", "\n", "(", "dataset", ",", "algorithm", ",", "test_env", ")", "\n", ")", ".", "select", "(", "\"sweep_acc\"", ")", ")", "\n", "mean", ",", "err", ",", "table", "[", "i", "]", "[", "j", "]", "=", "format_mean", "(", "trial_accs", ",", "latex", ")", "\n", "means", ".", "append", "(", "mean", ")", "\n", "", "if", "None", "in", "means", ":", "\n", "                ", "table", "[", "i", "]", "[", "-", "1", "]", "=", "\"X\"", "\n", "", "else", ":", "\n", "                ", "table", "[", "i", "]", "[", "-", "1", "]", "=", "\"{:.1f}\"", ".", "format", "(", "sum", "(", "means", ")", "/", "len", "(", "means", ")", ")", "\n", "\n", "", "", "col_labels", "=", "[", "\n", "\"Algorithm\"", ",", "\n", "*", "datasets", ".", "get_dataset_class", "(", "dataset", ")", ".", "ENVIRONMENTS", ",", "\n", "\"Avg\"", "\n", "]", "\n", "header_text", "=", "(", "f\"Dataset: {dataset}, \"", "\n", "f\"model selection method: {selection_method.name}\"", ")", "\n", "print_table", "(", "table", ",", "header_text", ",", "alg_names", ",", "list", "(", "col_labels", ")", ",", "\n", "colwidth", "=", "20", ",", "latex", "=", "latex", ")", "\n", "\n", "# Print an \"averages\" table", "\n", "", "if", "latex", ":", "\n", "        ", "print", "(", ")", "\n", "print", "(", "\"\\\\subsubsection{Averages}\"", ")", "\n", "\n", "", "table", "=", "[", "[", "None", "for", "_", "in", "[", "*", "dataset_names", ",", "\"Avg\"", "]", "]", "for", "_", "in", "alg_names", "]", "\n", "for", "i", ",", "algorithm", "in", "enumerate", "(", "alg_names", ")", ":", "\n", "        ", "means", "=", "[", "]", "\n", "for", "j", ",", "dataset", "in", "enumerate", "(", "dataset_names", ")", ":", "\n", "            ", "trial_averages", "=", "(", "grouped_records", "\n", ".", "filter_equals", "(", "\"algorithm, dataset\"", ",", "(", "algorithm", ",", "dataset", ")", ")", "\n", ".", "group", "(", "\"trial_seed\"", ")", "\n", ".", "map", "(", "lambda", "trial_seed", ",", "group", ":", "\n", "group", ".", "select", "(", "\"sweep_acc\"", ")", ".", "mean", "(", ")", "\n", ")", "\n", ")", "\n", "mean", ",", "err", ",", "table", "[", "i", "]", "[", "j", "]", "=", "format_mean", "(", "trial_averages", ",", "latex", ")", "\n", "means", ".", "append", "(", "mean", ")", "\n", "", "if", "None", "in", "means", ":", "\n", "            ", "table", "[", "i", "]", "[", "-", "1", "]", "=", "\"X\"", "\n", "", "else", ":", "\n", "            ", "table", "[", "i", "]", "[", "-", "1", "]", "=", "\"{:.1f}\"", ".", "format", "(", "sum", "(", "means", ")", "/", "len", "(", "means", ")", ")", "\n", "\n", "", "", "col_labels", "=", "[", "\"Algorithm\"", ",", "*", "dataset_names", ",", "\"Avg\"", "]", "\n", "header_text", "=", "f\"Averages, model selection method: {selection_method.name}\"", "\n", "print_table", "(", "table", ",", "header_text", ",", "alg_names", ",", "col_labels", ",", "colwidth", "=", "25", ",", "\n", "latex", "=", "latex", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__init__": [[35, 57], ["json.dumps", "hashlib.md5().hexdigest", "os.path.join", "copy.deepcopy", "sorted", "os.path.exists", "sweep.Job.train_args.items", "isinstance", "command.append", "os.path.join", "os.path.exists", "hashlib.md5", "isinstance", "json.dumps.encode", "shlex.quote", "str"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sorted"], ["def", "__init__", "(", "self", ",", "train_args", ",", "sweep_output_dir", ")", ":", "\n", "        ", "args_str", "=", "json", ".", "dumps", "(", "train_args", ",", "sort_keys", "=", "True", ")", "\n", "args_hash", "=", "hashlib", ".", "md5", "(", "args_str", ".", "encode", "(", "'utf-8'", ")", ")", ".", "hexdigest", "(", ")", "\n", "self", ".", "output_dir", "=", "os", ".", "path", ".", "join", "(", "sweep_output_dir", ",", "args_hash", ")", "\n", "\n", "self", ".", "train_args", "=", "copy", ".", "deepcopy", "(", "train_args", ")", "\n", "self", ".", "train_args", "[", "'output_dir'", "]", "=", "self", ".", "output_dir", "\n", "command", "=", "[", "'python'", ",", "'-m'", ",", "'domainbed.scripts.train'", "]", "\n", "for", "k", ",", "v", "in", "sorted", "(", "self", ".", "train_args", ".", "items", "(", ")", ")", ":", "\n", "            ", "if", "isinstance", "(", "v", ",", "list", ")", ":", "\n", "                ", "v", "=", "' '", ".", "join", "(", "[", "str", "(", "v_", ")", "for", "v_", "in", "v", "]", ")", "\n", "", "elif", "isinstance", "(", "v", ",", "str", ")", ":", "\n", "                ", "v", "=", "shlex", ".", "quote", "(", "v", ")", "\n", "", "command", ".", "append", "(", "f'--{k} {v}'", ")", "\n", "", "self", ".", "command_str", "=", "' '", ".", "join", "(", "command", ")", "\n", "\n", "if", "os", ".", "path", ".", "exists", "(", "os", ".", "path", ".", "join", "(", "self", ".", "output_dir", ",", "'done'", ")", ")", ":", "\n", "            ", "self", ".", "state", "=", "Job", ".", "DONE", "\n", "", "elif", "os", ".", "path", ".", "exists", "(", "self", ".", "output_dir", ")", ":", "\n", "            ", "self", ".", "state", "=", "Job", ".", "INCOMPLETE", "\n", "", "else", ":", "\n", "            ", "self", ".", "state", "=", "Job", ".", "NOT_LAUNCHED", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.__str__": [[58, 67], ["None"], "methods", ["None"], ["", "", "def", "__str__", "(", "self", ")", ":", "\n", "        ", "job_info", "=", "(", "self", ".", "train_args", "[", "'dataset'", "]", ",", "\n", "self", ".", "train_args", "[", "'algorithm'", "]", ",", "\n", "self", ".", "train_args", "[", "'test_envs'", "]", ",", "\n", "self", ".", "train_args", "[", "'hparams_seed'", "]", ")", "\n", "return", "'{}: {} {}'", ".", "format", "(", "\n", "self", ".", "state", ",", "\n", "self", ".", "output_dir", ",", "\n", "job_info", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.launch": [[68, 79], ["print", "jobs.copy.copy.copy", "numpy.random.shuffle", "print", "tqdm.tqdm", "launcher_fn", "print", "os.makedirs", "len"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "@", "staticmethod", "\n", "def", "launch", "(", "jobs", ",", "launcher_fn", ")", ":", "\n", "        ", "print", "(", "'Launching...'", ")", "\n", "jobs", "=", "jobs", ".", "copy", "(", ")", "\n", "np", ".", "random", ".", "shuffle", "(", "jobs", ")", "\n", "print", "(", "'Making job directories:'", ")", "\n", "for", "job", "in", "tqdm", ".", "tqdm", "(", "jobs", ",", "leave", "=", "False", ")", ":", "\n", "            ", "os", ".", "makedirs", "(", "job", ".", "output_dir", ",", "exist_ok", "=", "True", ")", "\n", "", "commands", "=", "[", "job", ".", "command_str", "for", "job", "in", "jobs", "]", "\n", "launcher_fn", "(", "commands", ")", "\n", "print", "(", "f'Launched {len(jobs)} jobs!'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.Job.delete": [[80, 86], ["print", "print", "shutil.rmtree", "len"], "methods", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["", "@", "staticmethod", "\n", "def", "delete", "(", "jobs", ")", ":", "\n", "        ", "print", "(", "'Deleting...'", ")", "\n", "for", "job", "in", "jobs", ":", "\n", "            ", "shutil", ".", "rmtree", "(", "job", ".", "output_dir", ")", "\n", "", "print", "(", "f'Deleted {len(jobs)} jobs!'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.all_test_env_combinations": [[87, 97], ["range", "range"], "function", ["None"], ["", "", "def", "all_test_env_combinations", "(", "n", ")", ":", "\n", "    ", "\"\"\"\n    For a dataset with n >= 3 envs, return all combinations of 1 and 2 test\n    envs.\n    \"\"\"", "\n", "assert", "(", "n", ">=", "3", ")", "\n", "for", "i", "in", "range", "(", "n", ")", ":", "\n", "        ", "yield", "[", "i", "]", "\n", "for", "j", "in", "range", "(", "i", "+", "1", ",", "n", ")", ":", "\n", "            ", "yield", "[", "i", ",", "j", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.make_args_list": [[98, 129], ["range", "sweep.all_test_env_combinations", "range", "domainbed.datasets.num_environments", "domainbed.lib.misc.seed_hash", "args_list.append", "range", "domainbed.datasets.num_environments"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.all_test_env_combinations", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.num_environments", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.seed_hash", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.num_environments"], ["", "", "", "def", "make_args_list", "(", "n_trials", ",", "dataset_names", ",", "algorithms", ",", "n_hparams", ",", "steps", ",", "\n", "data_dir", ",", "task", ",", "holdout_fraction", ",", "single_test_envs", ",", "hparams", ")", ":", "\n", "    ", "args_list", "=", "[", "]", "\n", "for", "trial_seed", "in", "range", "(", "n_trials", ")", ":", "\n", "        ", "for", "dataset", "in", "dataset_names", ":", "\n", "            ", "for", "algorithm", "in", "algorithms", ":", "\n", "                ", "if", "single_test_envs", ":", "\n", "                    ", "all_test_envs", "=", "[", "\n", "[", "i", "]", "for", "i", "in", "range", "(", "datasets", ".", "num_environments", "(", "dataset", ")", ")", "]", "\n", "", "else", ":", "\n", "                    ", "all_test_envs", "=", "all_test_env_combinations", "(", "\n", "datasets", ".", "num_environments", "(", "dataset", ")", ")", "\n", "", "for", "test_envs", "in", "all_test_envs", ":", "\n", "                    ", "for", "hparams_seed", "in", "range", "(", "n_hparams", ")", ":", "\n", "                        ", "train_args", "=", "{", "}", "\n", "train_args", "[", "'dataset'", "]", "=", "dataset", "\n", "train_args", "[", "'algorithm'", "]", "=", "algorithm", "\n", "train_args", "[", "'test_envs'", "]", "=", "test_envs", "\n", "train_args", "[", "'holdout_fraction'", "]", "=", "holdout_fraction", "\n", "train_args", "[", "'hparams_seed'", "]", "=", "hparams_seed", "\n", "train_args", "[", "'data_dir'", "]", "=", "data_dir", "\n", "train_args", "[", "'task'", "]", "=", "task", "\n", "train_args", "[", "'trial_seed'", "]", "=", "trial_seed", "\n", "train_args", "[", "'seed'", "]", "=", "misc", ".", "seed_hash", "(", "dataset", ",", "\n", "algorithm", ",", "test_envs", ",", "hparams_seed", ",", "trial_seed", ")", "\n", "if", "steps", "is", "not", "None", ":", "\n", "                            ", "train_args", "[", "'steps'", "]", "=", "steps", "\n", "", "if", "hparams", "is", "not", "None", ":", "\n", "                            ", "train_args", "[", "'hparams'", "]", "=", "hparams", "\n", "", "args_list", ".", "append", "(", "train_args", ")", "\n", "", "", "", "", "", "return", "args_list", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.sweep.ask_for_confirmation": [[130, 135], ["input", "print", "exit", "input.lower().strip", "input.lower"], "function", ["None"], ["", "def", "ask_for_confirmation", "(", ")", ":", "\n", "    ", "response", "=", "input", "(", "'Are you sure? (y/n) '", ")", "\n", "if", "not", "response", ".", "lower", "(", ")", ".", "strip", "(", ")", "[", ":", "1", "]", "==", "\"y\"", ":", "\n", "        ", "print", "(", "'Nevermind!'", ")", "\n", "exit", "(", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.stage_path": [[20, 27], ["os.path.join", "os.path.exists", "os.makedirs"], "function", ["None"], ["def", "stage_path", "(", "data_dir", ",", "name", ")", ":", "\n", "    ", "full_path", "=", "os", ".", "path", ".", "join", "(", "data_dir", ",", "name", ")", "\n", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "full_path", ")", ":", "\n", "        ", "os", ".", "makedirs", "(", "full_path", ")", "\n", "\n", "", "return", "full_path", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.download_and_extract": [[29, 49], ["gdown.download", "dst.endswith", "dst.endswith", "dst.endswith", "tarfile.open", "tarfile.open.extractall", "tarfile.open.close", "tarfile.open", "tarfile.open.extractall", "tarfile.open.close", "zipfile.ZipFile", "zipfile.ZipFile.extractall", "zipfile.ZipFile.close", "os.remove", "os.path.dirname", "os.path.dirname", "os.path.dirname"], "function", ["None"], ["", "def", "download_and_extract", "(", "url", ",", "dst", ",", "remove", "=", "True", ")", ":", "\n", "    ", "gdown", ".", "download", "(", "url", ",", "dst", ",", "quiet", "=", "False", ")", "\n", "\n", "if", "dst", ".", "endswith", "(", "\".tar.gz\"", ")", ":", "\n", "        ", "tar", "=", "tarfile", ".", "open", "(", "dst", ",", "\"r:gz\"", ")", "\n", "tar", ".", "extractall", "(", "os", ".", "path", ".", "dirname", "(", "dst", ")", ")", "\n", "tar", ".", "close", "(", ")", "\n", "\n", "", "if", "dst", ".", "endswith", "(", "\".tar\"", ")", ":", "\n", "        ", "tar", "=", "tarfile", ".", "open", "(", "dst", ",", "\"r:\"", ")", "\n", "tar", ".", "extractall", "(", "os", ".", "path", ".", "dirname", "(", "dst", ")", ")", "\n", "tar", ".", "close", "(", ")", "\n", "\n", "", "if", "dst", ".", "endswith", "(", "\".zip\"", ")", ":", "\n", "        ", "zf", "=", "ZipFile", "(", "dst", ",", "\"r\"", ")", "\n", "zf", ".", "extractall", "(", "os", ".", "path", ".", "dirname", "(", "dst", ")", ")", "\n", "zf", ".", "close", "(", ")", "\n", "\n", "", "if", "remove", ":", "\n", "        ", "os", ".", "remove", "(", "dst", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.download_vlcs": [[97, 103], ["download.stage_path", "download.download_and_extract", "os.path.join"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.stage_path", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.download_and_extract"], ["", "", "def", "download_vlcs", "(", "data_dir", ")", ":", "\n", "# Original URL: http://www.eecs.qmul.ac.uk/~dl307/project_iccv2017", "\n", "    ", "full_path", "=", "stage_path", "(", "data_dir", ",", "\"VLCS\"", ")", "\n", "\n", "download_and_extract", "(", "\"https://drive.google.com/uc?id=1skwblH1_okBwxWxmRsp9_qi15hyPpxg8\"", ",", "\n", "os", ".", "path", ".", "join", "(", "data_dir", ",", "\"VLCS.tar.gz\"", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.download_mnist": [[107, 111], ["download.stage_path", "torchvision.datasets.MNIST"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.stage_path"], ["", "def", "download_mnist", "(", "data_dir", ")", ":", "\n", "# Original URL: http://yann.lecun.com/exdb/mnist/", "\n", "    ", "full_path", "=", "stage_path", "(", "data_dir", ",", "\"MNIST\"", ")", "\n", "MNIST", "(", "full_path", ",", "download", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.download_pacs": [[115, 124], ["download.stage_path", "download.download_and_extract", "os.rename", "os.path.join", "os.path.join"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.stage_path", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.download_and_extract"], ["", "def", "download_pacs", "(", "data_dir", ")", ":", "\n", "# Original URL: http://www.eecs.qmul.ac.uk/~dl307/project_iccv2017", "\n", "    ", "full_path", "=", "stage_path", "(", "data_dir", ",", "\"PACS\"", ")", "\n", "\n", "download_and_extract", "(", "\"https://drive.google.com/uc?id=0B6x7gtvErXgfbF9CSk53UkRxVzg\"", ",", "\n", "os", ".", "path", ".", "join", "(", "data_dir", ",", "\"PACS.zip\"", ")", ")", "\n", "\n", "os", ".", "rename", "(", "os", ".", "path", ".", "join", "(", "data_dir", ",", "\"kfold\"", ")", ",", "\n", "full_path", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.download_office_home": [[128, 137], ["download.stage_path", "download.download_and_extract", "os.rename", "os.path.join", "os.path.join"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.stage_path", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.download_and_extract"], ["", "def", "download_office_home", "(", "data_dir", ")", ":", "\n", "# Original URL: http://hemanthdv.org/OfficeHome-Dataset/", "\n", "    ", "full_path", "=", "stage_path", "(", "data_dir", ",", "\"office_home\"", ")", "\n", "\n", "download_and_extract", "(", "\"https://drive.google.com/uc?id=0B81rNlvomiwed0V1YUxQdC1uOTg\"", ",", "\n", "os", ".", "path", ".", "join", "(", "data_dir", ",", "\"office_home.zip\"", ")", ")", "\n", "\n", "os", ".", "rename", "(", "os", ".", "path", ".", "join", "(", "data_dir", ",", "\"OfficeHomeDataset_10072016\"", ")", ",", "\n", "full_path", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.download_domain_net": [[141, 163], ["download.stage_path", "download.download_and_extract", "open", "f.readlines", "os.path.join", "os.remove", "url.split", "os.path.join", "line.strip"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.stage_path", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.download_and_extract"], ["", "def", "download_domain_net", "(", "data_dir", ")", ":", "\n", "# Original URL: http://ai.bu.edu/M3SDA/", "\n", "    ", "full_path", "=", "stage_path", "(", "data_dir", ",", "\"domain_net\"", ")", "\n", "\n", "urls", "=", "[", "\n", "\"http://csr.bu.edu/ftp/visda/2019/multi-source/groundtruth/clipart.zip\"", ",", "\n", "\"http://csr.bu.edu/ftp/visda/2019/multi-source/infograph.zip\"", ",", "\n", "\"http://csr.bu.edu/ftp/visda/2019/multi-source/groundtruth/painting.zip\"", ",", "\n", "\"http://csr.bu.edu/ftp/visda/2019/multi-source/quickdraw.zip\"", ",", "\n", "\"http://csr.bu.edu/ftp/visda/2019/multi-source/real.zip\"", ",", "\n", "\"http://csr.bu.edu/ftp/visda/2019/multi-source/sketch.zip\"", "\n", "]", "\n", "\n", "for", "url", "in", "urls", ":", "\n", "        ", "download_and_extract", "(", "url", ",", "os", ".", "path", ".", "join", "(", "full_path", ",", "url", ".", "split", "(", "\"/\"", ")", "[", "-", "1", "]", ")", ")", "\n", "\n", "", "with", "open", "(", "\"domainbed/misc/domain_net_duplicates.txt\"", ",", "\"r\"", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "f", ".", "readlines", "(", ")", ":", "\n", "            ", "try", ":", "\n", "                ", "os", ".", "remove", "(", "os", ".", "path", ".", "join", "(", "full_path", ",", "line", ".", "strip", "(", ")", ")", ")", "\n", "", "except", "OSError", ":", "\n", "                ", "pass", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.download_terra_incognita": [[167, 244], ["download.stage_path", "download.download_and_extract", "download.download_and_extract", "os.path.join", "os.path.join", "shutil.rmtree", "os.remove", "os.path.join", "os.path.join", "os.path.exists", "os.mkdir", "open", "json.load", "os.path.join", "os.path.exists", "os.mkdir", "os.path.join", "os.path.join", "os.path.join", "shutil.copyfile", "str", "os.path.exists", "os.mkdir"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.stage_path", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.download_and_extract", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.download_and_extract"], ["", "", "", "", "def", "download_terra_incognita", "(", "data_dir", ")", ":", "\n", "# Original URL: https://beerys.github.io/CaltechCameraTraps/", "\n", "    ", "full_path", "=", "stage_path", "(", "data_dir", ",", "\"terra_incognita\"", ")", "\n", "\n", "download_and_extract", "(", "\n", "\"http://www.vision.caltech.edu/~sbeery/datasets/caltechcameratraps18/eccv_18_all_images_sm.tar.gz\"", ",", "\n", "os", ".", "path", ".", "join", "(", "full_path", ",", "\"terra_incognita_images.tar.gz\"", ")", ")", "\n", "\n", "download_and_extract", "(", "\n", "\"http://www.vision.caltech.edu/~sbeery/datasets/caltechcameratraps18/eccv_18_all_annotations.tar.gz\"", ",", "\n", "os", ".", "path", ".", "join", "(", "full_path", ",", "\"terra_incognita_annotations.tar.gz\"", ")", ")", "\n", "\n", "include_locations", "=", "[", "38", ",", "46", ",", "100", ",", "43", "]", "\n", "\n", "include_categories", "=", "[", "\n", "\"bird\"", ",", "\"bobcat\"", ",", "\"cat\"", ",", "\"coyote\"", ",", "\"dog\"", ",", "\"empty\"", ",", "\"opossum\"", ",", "\"rabbit\"", ",", "\n", "\"raccoon\"", ",", "\"squirrel\"", "\n", "]", "\n", "\n", "images_folder", "=", "os", ".", "path", ".", "join", "(", "full_path", ",", "\"eccv_18_all_images_sm/\"", ")", "\n", "annotations_file", "=", "os", ".", "path", ".", "join", "(", "full_path", ",", "\"CaltechCameraTrapsECCV18.json\"", ")", "\n", "destination_folder", "=", "full_path", "\n", "\n", "stats", "=", "{", "}", "\n", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "destination_folder", ")", ":", "\n", "        ", "os", ".", "mkdir", "(", "destination_folder", ")", "\n", "\n", "", "with", "open", "(", "annotations_file", ",", "\"r\"", ")", "as", "f", ":", "\n", "        ", "data", "=", "json", ".", "load", "(", "f", ")", "\n", "\n", "", "category_dict", "=", "{", "}", "\n", "for", "item", "in", "data", "[", "'categories'", "]", ":", "\n", "        ", "category_dict", "[", "item", "[", "'id'", "]", "]", "=", "item", "[", "'name'", "]", "\n", "\n", "", "for", "image", "in", "data", "[", "'images'", "]", ":", "\n", "        ", "image_location", "=", "image", "[", "'location'", "]", "\n", "\n", "if", "image_location", "not", "in", "include_locations", ":", "\n", "            ", "continue", "\n", "\n", "", "loc_folder", "=", "os", ".", "path", ".", "join", "(", "destination_folder", ",", "\n", "'location_'", "+", "str", "(", "image_location", ")", "+", "'/'", ")", "\n", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "loc_folder", ")", ":", "\n", "            ", "os", ".", "mkdir", "(", "loc_folder", ")", "\n", "\n", "", "image_id", "=", "image", "[", "'id'", "]", "\n", "image_fname", "=", "image", "[", "'file_name'", "]", "\n", "\n", "for", "annotation", "in", "data", "[", "'annotations'", "]", ":", "\n", "            ", "if", "annotation", "[", "'image_id'", "]", "==", "image_id", ":", "\n", "                ", "if", "image_location", "not", "in", "stats", ":", "\n", "                    ", "stats", "[", "image_location", "]", "=", "{", "}", "\n", "\n", "", "category", "=", "category_dict", "[", "annotation", "[", "'category_id'", "]", "]", "\n", "\n", "if", "category", "not", "in", "include_categories", ":", "\n", "                    ", "continue", "\n", "\n", "", "if", "category", "not", "in", "stats", "[", "image_location", "]", ":", "\n", "                    ", "stats", "[", "image_location", "]", "[", "category", "]", "=", "0", "\n", "", "else", ":", "\n", "                    ", "stats", "[", "image_location", "]", "[", "category", "]", "+=", "1", "\n", "\n", "", "loc_cat_folder", "=", "os", ".", "path", ".", "join", "(", "loc_folder", ",", "category", "+", "'/'", ")", "\n", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "loc_cat_folder", ")", ":", "\n", "                    ", "os", ".", "mkdir", "(", "loc_cat_folder", ")", "\n", "\n", "", "dst_path", "=", "os", ".", "path", ".", "join", "(", "loc_cat_folder", ",", "image_fname", ")", "\n", "src_path", "=", "os", ".", "path", ".", "join", "(", "images_folder", ",", "image_fname", ")", "\n", "\n", "shutil", ".", "copyfile", "(", "src_path", ",", "dst_path", ")", "\n", "\n", "", "", "", "shutil", ".", "rmtree", "(", "images_folder", ")", "\n", "os", ".", "remove", "(", "annotations_file", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.download_sviro": [[248, 257], ["download.stage_path", "download.download_and_extract", "os.rename", "os.path.join", "os.path.join"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.stage_path", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.download.download_and_extract"], ["", "def", "download_sviro", "(", "data_dir", ")", ":", "\n", "# Original URL: https://sviro.kl.dfki.de", "\n", "    ", "full_path", "=", "stage_path", "(", "data_dir", ",", "\"sviro\"", ")", "\n", "\n", "download_and_extract", "(", "\"https://sviro.kl.dfki.de/?wpdmdl=1731\"", ",", "\n", "os", ".", "path", ".", "join", "(", "data_dir", ",", "\"sviro_grayscale_rectangle_classification.zip\"", ")", ")", "\n", "\n", "os", ".", "rename", "(", "os", ".", "path", ".", "join", "(", "data_dir", ",", "\"SVIRO_DOMAINBED\"", ")", ",", "\n", "full_path", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.collect_results.format_mean": [[26, 37], ["len", "numpy.mean", "numpy.std", "list", "list", "numpy.sqrt", "len"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.std", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len"], ["def", "format_mean", "(", "data", ",", "latex", ")", ":", "\n", "    ", "\"\"\"Given a list of datapoints, return a string describing their mean and\n    standard error\"\"\"", "\n", "if", "len", "(", "data", ")", "==", "0", ":", "\n", "        ", "return", "None", ",", "None", ",", "\"X\"", "\n", "", "mean", "=", "100", "*", "np", ".", "mean", "(", "list", "(", "data", ")", ")", "\n", "err", "=", "100", "*", "np", ".", "std", "(", "list", "(", "data", ")", "/", "np", ".", "sqrt", "(", "len", "(", "data", ")", ")", ")", "\n", "if", "latex", ":", "\n", "        ", "return", "mean", ",", "err", ",", "\"{:.1f} $\\\\pm$ {:.1f}\"", ".", "format", "(", "mean", ",", "err", ")", "\n", "", "else", ":", "\n", "        ", "return", "mean", ",", "err", ",", "\"{:.1f} +/- {:.1f}\"", ".", "format", "(", "mean", ",", "err", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.collect_results.print_table": [[38, 68], ["print", "zip", "table.insert", "enumerate", "len", "print", "print", "print", "print", "print", "row.insert", "domainbed.lib.misc.print_row", "print", "print", "print", "print", "str().replace", "str"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.misc.print_row"], ["", "", "def", "print_table", "(", "table", ",", "header_text", ",", "row_labels", ",", "col_labels", ",", "colwidth", "=", "10", ",", "\n", "latex", "=", "True", ")", ":", "\n", "    ", "\"\"\"Pretty-print a 2D array of data, optionally with row/col labels\"\"\"", "\n", "print", "(", "\"\"", ")", "\n", "\n", "if", "latex", ":", "\n", "        ", "num_cols", "=", "len", "(", "table", "[", "0", "]", ")", "\n", "print", "(", "\"\\\\begin{center}\"", ")", "\n", "print", "(", "\"\\\\adjustbox{max width=\\\\textwidth}{%\"", ")", "\n", "print", "(", "\"\\\\begin{tabular}{l\"", "+", "\"c\"", "*", "num_cols", "+", "\"}\"", ")", "\n", "print", "(", "\"\\\\toprule\"", ")", "\n", "", "else", ":", "\n", "        ", "print", "(", "\"--------\"", ",", "header_text", ")", "\n", "\n", "", "for", "row", ",", "label", "in", "zip", "(", "table", ",", "row_labels", ")", ":", "\n", "        ", "row", ".", "insert", "(", "0", ",", "label", ")", "\n", "\n", "", "if", "latex", ":", "\n", "        ", "col_labels", "=", "[", "\"\\\\textbf{\"", "+", "str", "(", "col_label", ")", ".", "replace", "(", "\"%\"", ",", "\"\\\\%\"", ")", "+", "\"}\"", "\n", "for", "col_label", "in", "col_labels", "]", "\n", "", "table", ".", "insert", "(", "0", ",", "col_labels", ")", "\n", "\n", "for", "r", ",", "row", "in", "enumerate", "(", "table", ")", ":", "\n", "        ", "misc", ".", "print_row", "(", "row", ",", "colwidth", "=", "colwidth", ",", "latex", "=", "latex", ")", "\n", "if", "latex", "and", "r", "==", "0", ":", "\n", "            ", "print", "(", "\"\\\\midrule\"", ")", "\n", "", "", "if", "latex", ":", "\n", "        ", "print", "(", "\"\\\\bottomrule\"", ")", "\n", "print", "(", "\"\\\\end{tabular}}\"", ")", "\n", "print", "(", "\"\\\\end{center}\"", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.collect_results.print_results_tables": [[69, 143], ["domainbed.lib.reporting.get_grouped_records().map().filter", "domainbed.lib.query.Q().select().unique", "domainbed.lib.query.Q().select().unique().sorted", "enumerate", "collect_results.print_table", "range", "enumerate", "collect_results.print_table", "print", "print", "enumerate", "domainbed.lib.reporting.get_grouped_records().map", "domainbed.lib.query.Q().select", "domainbed.lib.query.Q().select().unique", "print", "print", "domainbed.datasets.num_environments", "enumerate", "list", "reporting.get_grouped_records().map().filter.filter_equals().group().map", "collect_results.format_mean", "means.append", "reporting.get_grouped_records().map().filter.filter_equals().select", "collect_results.format_mean", "means.append", "domainbed.lib.reporting.get_grouped_records", "domainbed.lib.query.Q", "domainbed.lib.query.Q().select", "domainbed.datasets.get_dataset_class", "reporting.get_grouped_records().map().filter.filter_equals().group", "group.select().mean", "sum", "len", "selection_method.sweep_acc", "reporting.get_grouped_records().map().filter.filter_equals", "sum", "len", "domainbed.lib.query.Q", "reporting.get_grouped_records().map().filter.filter_equals", "group.select"], "function", ["home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.filter", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.unique", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sorted", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.collect_results.print_table", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.collect_results.print_table", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.map", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.select", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.unique", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.num_environments", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.map", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.collect_results.format_mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.select", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.scripts.collect_results.format_mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.reporting.get_grouped_records", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.select", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.datasets.get_dataset_class", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.group", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.mean", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.domainbed.model_selection.SelectionMethod.sweep_acc", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.filter_equals", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.sum", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.len", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.filter_equals", "home.repos.pwc.inspect_result.gordon-guojun-zhang_transferability-neurips2021.lib.query.Q.select"], ["", "", "def", "print_results_tables", "(", "records", ",", "selection_method", ",", "latex", ")", ":", "\n", "    ", "\"\"\"Given all records, print a results table for each dataset.\"\"\"", "\n", "grouped_records", "=", "reporting", ".", "get_grouped_records", "(", "records", ")", ".", "map", "(", "lambda", "group", ":", "\n", "{", "**", "group", ",", "\"sweep_acc\"", ":", "selection_method", ".", "sweep_acc", "(", "group", "[", "\"records\"", "]", ")", "}", "\n", ")", ".", "filter", "(", "lambda", "g", ":", "g", "[", "\"sweep_acc\"", "]", "is", "not", "None", ")", "\n", "\n", "# read algorithm names and sort (predefined order)", "\n", "alg_names", "=", "Q", "(", "records", ")", ".", "select", "(", "\"args.algorithm\"", ")", ".", "unique", "(", ")", "\n", "alg_names", "=", "(", "[", "n", "for", "n", "in", "algorithms", ".", "ALGORITHMS", "if", "n", "in", "alg_names", "]", "+", "\n", "[", "n", "for", "n", "in", "alg_names", "if", "n", "not", "in", "algorithms", ".", "ALGORITHMS", "]", ")", "\n", "\n", "# read dataset names and sort (lexicographic order)", "\n", "dataset_names", "=", "Q", "(", "records", ")", ".", "select", "(", "\"args.dataset\"", ")", ".", "unique", "(", ")", ".", "sorted", "(", ")", "\n", "dataset_names", "=", "[", "d", "for", "d", "in", "datasets", ".", "DATASETS", "if", "d", "in", "dataset_names", "]", "\n", "\n", "for", "dataset", "in", "dataset_names", ":", "\n", "        ", "if", "latex", ":", "\n", "            ", "print", "(", ")", "\n", "print", "(", "\"\\\\subsubsection{{{}}}\"", ".", "format", "(", "dataset", ")", ")", "\n", "", "test_envs", "=", "range", "(", "datasets", ".", "num_environments", "(", "dataset", ")", ")", "\n", "\n", "table", "=", "[", "[", "None", "for", "_", "in", "[", "*", "test_envs", ",", "\"Avg\"", "]", "]", "for", "_", "in", "alg_names", "]", "\n", "for", "i", ",", "algorithm", "in", "enumerate", "(", "alg_names", ")", ":", "\n", "            ", "means", "=", "[", "]", "\n", "for", "j", ",", "test_env", "in", "enumerate", "(", "test_envs", ")", ":", "\n", "                ", "trial_accs", "=", "(", "grouped_records", "\n", ".", "filter_equals", "(", "\n", "\"dataset, algorithm, test_env\"", ",", "\n", "(", "dataset", ",", "algorithm", ",", "test_env", ")", "\n", ")", ".", "select", "(", "\"sweep_acc\"", ")", ")", "\n", "mean", ",", "err", ",", "table", "[", "i", "]", "[", "j", "]", "=", "format_mean", "(", "trial_accs", ",", "latex", ")", "\n", "means", ".", "append", "(", "mean", ")", "\n", "", "if", "None", "in", "means", ":", "\n", "                ", "table", "[", "i", "]", "[", "-", "1", "]", "=", "\"X\"", "\n", "", "else", ":", "\n", "                ", "table", "[", "i", "]", "[", "-", "1", "]", "=", "\"{:.1f}\"", ".", "format", "(", "sum", "(", "means", ")", "/", "len", "(", "means", ")", ")", "\n", "\n", "", "", "col_labels", "=", "[", "\n", "\"Algorithm\"", ",", "\n", "*", "datasets", ".", "get_dataset_class", "(", "dataset", ")", ".", "ENVIRONMENTS", ",", "\n", "\"Avg\"", "\n", "]", "\n", "header_text", "=", "(", "f\"Dataset: {dataset}, \"", "\n", "f\"model selection method: {selection_method.name}\"", ")", "\n", "print_table", "(", "table", ",", "header_text", ",", "alg_names", ",", "list", "(", "col_labels", ")", ",", "\n", "colwidth", "=", "20", ",", "latex", "=", "latex", ")", "\n", "\n", "# Print an \"averages\" table", "\n", "", "if", "latex", ":", "\n", "        ", "print", "(", ")", "\n", "print", "(", "\"\\\\subsubsection{Averages}\"", ")", "\n", "\n", "", "table", "=", "[", "[", "None", "for", "_", "in", "[", "*", "dataset_names", ",", "\"Avg\"", "]", "]", "for", "_", "in", "alg_names", "]", "\n", "for", "i", ",", "algorithm", "in", "enumerate", "(", "alg_names", ")", ":", "\n", "        ", "means", "=", "[", "]", "\n", "for", "j", ",", "dataset", "in", "enumerate", "(", "dataset_names", ")", ":", "\n", "            ", "trial_averages", "=", "(", "grouped_records", "\n", ".", "filter_equals", "(", "\"algorithm, dataset\"", ",", "(", "algorithm", ",", "dataset", ")", ")", "\n", ".", "group", "(", "\"trial_seed\"", ")", "\n", ".", "map", "(", "lambda", "trial_seed", ",", "group", ":", "\n", "group", ".", "select", "(", "\"sweep_acc\"", ")", ".", "mean", "(", ")", "\n", ")", "\n", ")", "\n", "mean", ",", "err", ",", "table", "[", "i", "]", "[", "j", "]", "=", "format_mean", "(", "trial_averages", ",", "latex", ")", "\n", "means", ".", "append", "(", "mean", ")", "\n", "", "if", "None", "in", "means", ":", "\n", "            ", "table", "[", "i", "]", "[", "-", "1", "]", "=", "\"X\"", "\n", "", "else", ":", "\n", "            ", "table", "[", "i", "]", "[", "-", "1", "]", "=", "\"{:.1f}\"", ".", "format", "(", "sum", "(", "means", ")", "/", "len", "(", "means", ")", ")", "\n", "\n", "", "", "col_labels", "=", "[", "\"Algorithm\"", ",", "*", "dataset_names", ",", "\"Avg\"", "]", "\n", "header_text", "=", "f\"Averages, model selection method: {selection_method.name}\"", "\n", "print_table", "(", "table", ",", "header_text", ",", "alg_names", ",", "col_labels", ",", "colwidth", "=", "25", ",", "\n", "latex", "=", "latex", ")", "\n", "\n"]]}