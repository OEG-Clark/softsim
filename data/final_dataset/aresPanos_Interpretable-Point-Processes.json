{"home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.load_dataset": [[7, 60], ["len", "numpy.arange", "numpy.random.shuffle", "int", "int", "ValueError", "numpy.isclose", "ValueError", "open", "pickle.load", "numpy.random.seed", "times_list_train.append", "marks_list_train.append", "times_list_val.append", "marks_list_val.append", "times_list_test.append", "marks_list_test.append", "max", "mark.max"], "function", ["None"], ["def", "load_dataset", "(", "full_path", ":", "str", ",", "seed", ":", "int", "=", "None", ",", "train_size", "=", "0.7", ",", "val_size", "=", "0.1", ",", "test_size", "=", "0.2", ",", "shuffle", ":", "bool", "=", "True", ")", ":", "\n", "    ", "\"\"\"\n    Dataset loading function\n    Arguments:\n    ----------\n    full_path: (str) Full path name of the dataset location\n    seed: (int) Seed value of the random number generator\n    train_size: (float) Proportion of the original dataset which is used for training\n    val_size: (float) Proportion of the original dataset which is used for validation\n    test_size: (float) Proportion of the original dataset which is used for testing\n    shuffle: (bool) Falog indicating whether to shuffle or not the original dataset\n    \"\"\"", "\n", "\n", "if", "train_size", "<", "0", "or", "val_size", "<", "0", "or", "test_size", "<", "0", ":", "\n", "        ", "raise", "ValueError", "(", "\"train_size, val_size, and test_size must be >= 0.\"", ")", "\n", "", "if", "not", "np", ".", "isclose", "(", "train_size", "+", "val_size", "+", "test_size", ",", "1.0", ")", ":", "\n", "        ", "raise", "ValueError", "(", "\"train_size, val_size, and test_size must add up to 1.\"", ")", "\n", "\n", "", "with", "open", "(", "full_path", ",", "'rb'", ")", "as", "f", ":", "\n", "        ", "full_data", "=", "pickle", ".", "load", "(", "f", ")", "\n", "\n", "", "times_all", ",", "marks_all", "=", "full_data", "[", "'timestamps'", "]", ",", "full_data", "[", "'types'", "]", "\n", "\n", "N", "=", "len", "(", "times_all", ")", "\n", "if", "seed", "is", "not", "None", ":", "\n", "        ", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "", "all_idx", "=", "np", ".", "arange", "(", "N", ")", "\n", "np", ".", "random", ".", "shuffle", "(", "all_idx", ")", "\n", "\n", "train_end", "=", "int", "(", "train_size", "*", "N", ")", "\n", "val_end", "=", "int", "(", "(", "train_size", "+", "val_size", ")", "*", "N", ")", "\n", "\n", "train_idx", "=", "all_idx", "[", ":", "train_end", "]", "\n", "val_idx", "=", "all_idx", "[", "train_end", ":", "val_end", "]", "\n", "test_idx", "=", "all_idx", "[", "val_end", ":", "]", "\n", "\n", "times_list_train", ",", "marks_list_train", "=", "[", "]", ",", "[", "]", "\n", "times_list_val", ",", "marks_list_val", "=", "[", "]", ",", "[", "]", "\n", "times_list_test", ",", "marks_list_test", "=", "[", "]", ",", "[", "]", "\n", "\n", "for", "idx", "in", "train_idx", ":", "\n", "        ", "times_list_train", ".", "append", "(", "times_all", "[", "idx", "]", ")", "\n", "marks_list_train", ".", "append", "(", "marks_all", "[", "idx", "]", ")", "\n", "\n", "", "for", "idx", "in", "val_idx", ":", "\n", "        ", "times_list_val", ".", "append", "(", "times_all", "[", "idx", "]", ")", "\n", "marks_list_val", ".", "append", "(", "marks_all", "[", "idx", "]", ")", "\n", "\n", "", "for", "idx", "in", "test_idx", ":", "\n", "        ", "times_list_test", ".", "append", "(", "times_all", "[", "idx", "]", ")", "\n", "marks_list_test", ".", "append", "(", "marks_all", "[", "idx", "]", ")", "\n", "\n", "", "return", "times_list_train", ",", "marks_list_train", ",", "times_list_val", ",", "marks_list_val", ",", "times_list_test", ",", "marks_list_test", ",", "max", "(", "[", "mark", ".", "max", "(", ")", "for", "mark", "in", "marks_all", "]", ")", "+", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.log_likelihood_marks": [[62, 96], ["range", "len", "min", "numpy.zeros", "numpy.zeros", "range", "numpy.log().sum", "numpy.log", "numpy.log().sum", "numpy.exp", "numpy.log", "numpy.log", "numpy.exp", "np.zeros.sum", "np.zeros.sum"], "function", ["None"], ["", "def", "log_likelihood_marks", "(", "times_list", ":", "list", ",", "marks_list", ":", "list", ",", "alpha", ",", "beta_mtr", ",", "delta_vec", ",", "Gamma_mtr", ",", "Q", ":", "int", "=", "200", ")", ":", "\n", "    ", "\"\"\"\n    Computation of the log likelihood of marks\n    Arguments:\n    ----------\n    times_list: (list) A list of ndarrays containing the event occurence times\n    marks_list: (list) A list of ndarrays containing the corresponding event marks\n    alpha: (float) The excitation factor\n    delta_vec: The U x 1 background propability vector\n    beta_mtr: (ndarrays)  A U x U matrix that contains the decay rates\n    Gamma_mtr: (ndarrays) A U x U stochastic matrix that contains the conversion rates\n    Q: (int) Proportion of the original dataset which is used for testing\n    \"\"\"", "\n", "log_lkl_org", "=", "0.", "\n", "jumps_N", "=", "0", "\n", "for", "s", "in", "range", "(", "len", "(", "times_list", ")", ")", ":", "\n", "        ", "times", "=", "times_list", "[", "s", "]", "\n", "marks", "=", "marks_list", "[", "s", "]", "\n", "N", "=", "times", ".", "size", "\n", "jumps_N", "+=", "N", "\n", "Q_", "=", "min", "(", "Q", ",", "N", "-", "1", ")", "\n", "Q_mtr", "=", "np", ".", "zeros", "(", "(", "Q_", ",", "N", "-", "1", ")", ")", "\n", "Q_denom", "=", "np", ".", "zeros", "(", "(", "N", "-", "1", ",", "Q_", ")", ")", "\n", "for", "q", "in", "range", "(", "Q_", ")", ":", "\n", "            ", "tij", "=", "times", "[", ":", "N", "-", "q", "-", "1", "]", "-", "times", "[", "q", "+", "1", ":", "N", "]", "\n", "Q_mtr", "[", "q", ",", "q", ":", "]", "=", "Gamma_mtr", "[", "marks", "[", ":", "-", "1", "-", "q", "]", ",", "marks", "[", "1", "+", "q", ":", "]", "]", "*", "np", ".", "exp", "(", "beta_mtr", "[", "marks", "[", ":", "-", "1", "-", "q", "]", ",", "marks", "[", "1", "+", "q", ":", "]", "]", "*", "tij", ")", "\n", "Q_denom", "[", "q", ":", ",", "q", "]", "=", "(", "Gamma_mtr", "[", "marks", "[", ":", "-", "1", "-", "q", "]", "]", "*", "np", ".", "exp", "(", "beta_mtr", "[", "marks", "[", ":", "-", "1", "-", "q", "]", "]", "*", "tij", "[", ":", ",", "None", "]", ")", ")", ".", "sum", "(", "1", ")", "\n", "\n", "", "numer", "=", "np", ".", "log", "(", "delta_vec", "[", "marks", "[", "0", "]", "]", ")", "+", "np", ".", "log", "(", "delta_vec", "[", "marks", "[", "1", ":", "]", "]", "+", "alpha", "*", "Q_mtr", ".", "sum", "(", "0", ")", ")", ".", "sum", "(", ")", "\n", "denom", "=", "np", ".", "log", "(", "1", "+", "alpha", "*", "Q_denom", ".", "sum", "(", "1", ")", ")", ".", "sum", "(", ")", "\n", "\n", "log_lkl_org", "+=", "numer", "-", "denom", "\n", "\n", "", "return", "log_lkl_org", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.pos_constraint": [[98, 106], ["numpy.log", "numpy.exp"], "function", ["None"], ["", "def", "pos_constraint", "(", "input", ")", ":", "\n", "    ", "\"\"\"\n    Softplus function\n    Arguments:\n    ----------\n    input: scalar or ndarray\n    \"\"\"", "\n", "return", "np", ".", "log", "(", "1.", "+", "np", ".", "exp", "(", "input", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.compute_f1_score": [[108, 149], ["len", "numpy.zeros", "numpy.zeros", "range", "sklearn.metrics.f1_score", "numpy.arange", "numpy.zeros", "min", "numpy.zeros", "range", "np.zeros.sum", "range", "numpy.argmax", "numpy.ones", "numpy.exp", "np.zeros.sum"], "function", ["None"], ["", "def", "compute_f1_score", "(", "times_list", ":", "list", ",", "marks_list", ":", "list", ",", "alpha", ",", "beta_mtr", ",", "delta_vec", ",", "Gamma_mtr", ",", "Q", ":", "int", "=", "200", ")", ":", "\n", "    ", "\"\"\"\n    Computation of F1 score\n    Arguments:\n    ----------\n    times_list: (list) A list of ndarrays containing the event occurence times\n    marks_list: (list) A list of ndarrays containing the corresponding event marks\n    alpha: (float) The excitation factor\n    delta_vec: The U x 1 background propability vector\n    beta_mtr: (ndarrays)  A U x U matrix that contains the decay rates\n    Gamma_mtr: (ndarrays) A U x U stochastic matrix that contains the conversion rates\n    Q: (int) Proportion of the original dataset which is used for testing\n    \"\"\"", "\n", "S", "=", "len", "(", "times_list", ")", "\n", "U_dim", "=", "delta_vec", ".", "size", "\n", "true_marks", "=", "np", ".", "zeros", "(", "S", ",", "dtype", "=", "np", ".", "int32", ")", "\n", "predicted_marks", "=", "np", ".", "zeros", "(", "S", ",", "dtype", "=", "np", ".", "int32", ")", "\n", "\n", "for", "s", "in", "range", "(", "S", ")", ":", "\n", "        ", "times", "=", "times_list", "[", "s", "]", "\n", "marks", "=", "marks_list", "[", "s", "]", "\n", "true_marks", "[", "s", "]", "=", "marks", "[", "-", "1", "]", "\n", "N", "=", "times", ".", "size", "\n", "ar_x", "=", "np", ".", "arange", "(", "N", ")", "\n", "prob_all", "=", "np", ".", "zeros", "(", "(", "N", ",", "U_dim", ")", ")", "\n", "prob_all", "[", "0", "]", "=", "delta_vec", "\n", "Q_", "=", "min", "(", "Q", ",", "N", "-", "1", ")", "\n", "Q_mtr", "=", "np", ".", "zeros", "(", "(", "Q_", ",", "N", "-", "1", ")", ")", "\n", "\n", "for", "u", "in", "range", "(", "U_dim", ")", ":", "\n", "            ", "for", "q", "in", "range", "(", "Q_", ")", ":", "\n", "                ", "marks_pred", "=", "u", "*", "np", ".", "ones", "(", "N", "-", "1", "-", "q", ",", "dtype", "=", "np", ".", "int32", ")", "\n", "tij", "=", "times", "[", ":", "N", "-", "q", "-", "1", "]", "-", "times", "[", "q", "+", "1", ":", "N", "]", "\n", "Q_mtr", "[", "q", ",", "q", ":", "]", "=", "Gamma_mtr", "[", "marks", "[", ":", "-", "1", "-", "q", "]", ",", "marks_pred", "]", "*", "np", ".", "exp", "(", "beta_mtr", "[", "marks", "[", ":", "-", "1", "-", "q", "]", ",", "marks_pred", "]", "*", "tij", ")", "\n", "\n", "", "prob_all", "[", "1", ":", ",", "u", "]", "=", "delta_vec", "[", "u", "]", "+", "alpha", "*", "Q_mtr", ".", "sum", "(", "0", ")", "\n", "", "prob_all", "/=", "prob_all", ".", "sum", "(", "axis", "=", "1", ",", "keepdims", "=", "True", ")", "\n", "\n", "predicted_marks", "[", "s", "]", "=", "np", ".", "argmax", "(", "prob_all", ",", "axis", "=", "1", ")", "[", "-", "1", "]", "\n", "\n", "", "return", "f1_score", "(", "true_marks", ",", "predicted_marks", ",", "average", "=", "'macro'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.compute_model_mode": [[151, 170], ["model_vi.coeffs.detach().numpy", "utilities.pos_constraint", "pos_constraint().reshape", "numpy.exp", "numpy.exp().reshape", "model_vi.coeffs.detach", "utilities.pos_constraint", "numpy.exp", "pos_constraint().reshape.sum"], "function", ["home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.pos_constraint", "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.pos_constraint"], ["", "def", "compute_model_mode", "(", "model_vi", ":", "VI_model", ")", ":", "\n", "    ", "\"\"\"\n    Computation of the mode for each variational distribution\n    Arguments:\n    ----------\n    model_vi: VI_model\n    \"\"\"", "\n", "\n", "x_opt", "=", "model_vi", ".", "coeffs", ".", "detach", "(", ")", ".", "numpy", "(", ")", "\n", "\n", "m_betas_alpha_opt", "=", "x_opt", "[", ":", "(", "model_vi", ".", "U_dim", "**", "2", "+", "1", ")", "]", "\n", "sigma_betas_alpha_opt", "=", "pos_constraint", "(", "x_opt", "[", "(", "model_vi", ".", "U_dim", "**", "2", "+", "1", ")", ":", "2", "*", "(", "model_vi", ".", "U_dim", "**", "2", "+", "1", ")", "]", ")", "\n", "concent_deltas_Gammas_opt", "=", "pos_constraint", "(", "x_opt", "[", "2", "*", "(", "model_vi", ".", "U_dim", "**", "2", "+", "1", ")", ":", "]", ")", ".", "reshape", "(", "model_vi", ".", "U_dim", "+", "1", ",", "model_vi", ".", "U_dim", ")", "\n", "\n", "mode_alpha", "=", "np", ".", "exp", "(", "m_betas_alpha_opt", "[", "-", "1", "]", "-", "sigma_betas_alpha_opt", "[", "-", "1", "]", "**", "2", ")", "\n", "mode_betas", "=", "np", ".", "exp", "(", "m_betas_alpha_opt", "[", ":", "-", "1", "]", "-", "sigma_betas_alpha_opt", "[", ":", "-", "1", "]", "**", "2", ")", ".", "reshape", "(", "model_vi", ".", "U_dim", ",", "model_vi", ".", "U_dim", ")", "\n", "mean_deltas_Gammas", "=", "concent_deltas_Gammas_opt", "/", "concent_deltas_Gammas_opt", ".", "sum", "(", "1", ")", "[", ":", ",", "None", "]", "\n", "\n", "return", "mode_alpha", ",", "mode_betas", ",", "mean_deltas_Gammas", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.compute_scores_marks": [[172, 187], ["utilities.compute_model_mode", "utilities.log_likelihood_marks", "utilities.compute_f1_score"], "function", ["home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.compute_model_mode", "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.log_likelihood_marks", "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.compute_f1_score"], ["", "def", "compute_scores_marks", "(", "model_vi", ":", "VI_model", ",", "times_list", ":", "list", ",", "marks_list", ":", "list", ")", ":", "\n", "    ", "\"\"\"\n    Computation of the log-likelihood of marks and F1 score over the dataset (times_list, marks_list)\n    Arguments:\n    ----------\n    model_vi: VI_model\n    times_list: (list) A list of ndarrays containing the event occurence times\n    marks_list: (list) A list of ndarrays containing the corresponding event marks\n    \"\"\"", "\n", "mode_alpha", ",", "mode_betas", ",", "mean_deltas_Gammas", "=", "compute_model_mode", "(", "model_vi", ")", "\n", "\n", "log_lkl_marks", "=", "log_likelihood_marks", "(", "times_list", ",", "marks_list", ",", "mode_alpha", ",", "mode_betas", ",", "mean_deltas_Gammas", "[", "0", "]", ",", "mean_deltas_Gammas", "[", "1", ":", "]", ",", "Q", "=", "model_vi", ".", "Q", ")", "\n", "f1_score", "=", "compute_f1_score", "(", "times_list", ",", "marks_list", ",", "mode_alpha", ",", "mode_betas", ",", "mean_deltas_Gammas", "[", "0", "]", ",", "mean_deltas_Gammas", "[", "1", ":", "]", ",", "Q", "=", "model_vi", ".", "Q", ")", "\n", "\n", "return", "log_lkl_marks", ",", "f1_score", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.mle_lognormal": [[189, 205], ["LogNormalDistribution", "numpy.exp", "LogNormalDistribution", "LogNormalDistribution.fit", "numpy.exp", "times.mean", "times.mean", "times.var", "times.mean"], "function", ["home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.fit"], ["", "def", "mle_lognormal", "(", "times", ":", "np", ".", "ndarray", ")", ":", "\n", "    ", "\"\"\"\n    Maximum likelihood estimation of the parameters of a mixture of log-Normal distributions\n    Arguments:\n    ----------\n    times: (ndarray) A ndarray containing all the event occurence times for all sequences\n    \"\"\"", "\n", "if", "times", ".", "size", "<", "2", ":", "\n", "        ", "lognorm", "=", "LogNormalDistribution", "(", "times", ".", "mean", "(", ")", ",", "1", ")", "\n", "mode_lognorm", "=", "np", ".", "exp", "(", "times", ".", "mean", "(", ")", "-", "1", ")", "\n", "", "else", ":", "\n", "        ", "lognorm", "=", "LogNormalDistribution", "(", "times", ".", "mean", "(", ")", ",", "times", ".", "var", "(", ")", ")", "\n", "lognorm", ".", "fit", "(", "times", ")", "\n", "mode_lognorm", "=", "np", ".", "exp", "(", "lognorm", ".", "parameters", "[", "0", "]", "-", "lognorm", ".", "parameters", "[", "1", "]", "**", "2", ")", "\n", "\n", "", "return", "mode_lognorm", ",", "lognorm", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.mode_lognormal": [[207, 230], ["numpy.concatenate", "numpy.concatenate", "numpy.ones", "numpy.zeros", "range", "utilities.mle_lognormal"], "function", ["home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.mle_lognormal"], ["", "def", "mode_lognormal", "(", "times_list", ":", "list", ",", "marks_list", ":", "list", ",", "U", ":", "int", ")", ":", "\n", "    ", "\"\"\"\n    Computation of the mode of a log-Normal distribution (for each mark) after\n    finding the optimized parameters by MLE over the data (times_list, marks_list)\n    Arguments:\n    ----------\n    times_list: (list) A list of ndarrays containing the event occurence times\n    marks_list: (list) A list of ndarrays containing the corresponding event marks\n    U: (int) Dimension of the mark space\n    \"\"\"", "\n", "\n", "inter_arrival", "=", "np", ".", "concatenate", "(", "[", "(", "times", "[", "1", ":", "]", "-", "times", "[", ":", "-", "1", "]", ")", "for", "times", "in", "times_list", "]", ")", "\n", "inter_arrival", "[", "inter_arrival", "<=", "0", "]", "+=", "1e-8", "# For numerical stability", "\n", "marks", "=", "np", ".", "concatenate", "(", "[", "marks", "[", ":", "-", "1", "]", "for", "marks", "in", "marks_list", "]", ")", "\n", "\n", "modes", "=", "np", ".", "ones", "(", "U", ")", "\n", "models_vec", "=", "np", ".", "zeros", "(", "U", ",", "dtype", "=", "object", ")", "\n", "for", "u", "in", "range", "(", "U", ")", ":", "\n", "        ", "data", "=", "inter_arrival", "[", "marks", "==", "u", "]", "\n", "if", "data", ".", "size", ">", "0", ":", "\n", "                ", "modes", "[", "u", "]", ",", "models_vec", "[", "u", "]", "=", "mle_lognormal", "(", "data", ")", "\n", "\n", "", "", "return", "modes", ",", "models_vec", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.compute_scores_times": [[232, 268], ["utilities.mode_lognormal", "numpy.zeros", "numpy.zeros", "range", "numpy.sqrt", "len", "len", "len", "range", "numpy.square().mean", "models_vec[].log_probability().sum", "numpy.square", "models_vec[].log_probability"], "function", ["home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.mode_lognormal"], ["", "def", "compute_scores_times", "(", "times_list", ":", "list", ",", "marks_list", ":", "list", ",", "times_list_val", ":", "list", ",", "marks_list_val", ":", "list", ",", "U", ":", "int", ")", ":", "\n", "    ", "\"\"\"\n    Computation of the times log-likelihood and RMSE over the dataset (times_list_val, marks_list_val).\n    We use (times_list, marks_list) for training U log-normal distributions, one for each mark\n    Arguments:\n    ----------\n    times_list: (list) A list of ndarrays containing the event occurence times used for training\n    marks_list: (list) A list of ndarrays containing the corresponding event marks used for training\n    times_list_val: (list) A list of ndarrays containing the event occurence times used for computing the two scores\n    marks_list_val: (list) A list of ndarrays containing the corresponding event marks used for computing the two scores\n    U: (int) Dimension of the mark space\n    \"\"\"", "\n", "\n", "modes", ",", "models_vec", "=", "mode_lognormal", "(", "times_list", ",", "marks_list", ",", "U", ")", "\n", "\n", "log_lkl_times", "=", "0.", "\n", "predicted_taus", "=", "np", ".", "zeros", "(", "len", "(", "times_list_val", ")", ")", "\n", "true_taus", "=", "np", ".", "zeros", "(", "len", "(", "times_list_val", ")", ")", "\n", "for", "s", "in", "range", "(", "len", "(", "times_list_val", ")", ")", ":", "\n", "        ", "times", "=", "times_list_val", "[", "s", "]", "\n", "marks", "=", "marks_list_val", "[", "s", "]", "\n", "inter_arrival", "=", "times", "[", "1", ":", "]", "-", "times", "[", ":", "-", "1", "]", "\n", "inter_arrival", "[", "inter_arrival", "<=", "0.", "]", "=", "1e-8", "\n", "marks_inter", "=", "marks", "[", ":", "-", "1", "]", "\n", "\n", "true_taus", "[", "s", "]", "=", "inter_arrival", "[", "-", "1", "]", "\n", "predicted_taus", "[", "s", "]", "=", "modes", "[", "marks", "[", "-", "2", "]", "]", "\n", "\n", "for", "u", "in", "range", "(", "U", ")", ":", "\n", "            ", "data", "=", "inter_arrival", "[", "marks_inter", "==", "u", "]", "\n", "if", "data", ".", "size", ">", "0", "and", "models_vec", "[", "u", "]", "!=", "0.", ":", "\n", "                ", "log_lkl_times", "+=", "models_vec", "[", "u", "]", ".", "log_probability", "(", "data", "[", ":", ",", "None", "]", ")", ".", "sum", "(", ")", "\n", "\n", "", "", "", "rmse", "=", "np", ".", "sqrt", "(", "np", ".", "square", "(", "(", "predicted_taus", "-", "true_taus", ")", "/", "true_taus", ")", ".", "mean", "(", ")", ")", "\n", "\n", "return", "log_lkl_times", ",", "rmse", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.compute_all_scores": [[270, 290], ["utilities.compute_scores_times", "utilities.compute_scores_marks", "sum"], "function", ["home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.compute_scores_times", "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.compute_scores_marks"], ["", "def", "compute_all_scores", "(", "model_vi", ":", "VI_model", ",", "times_list", ":", "list", ",", "marks_list", ":", "list", ",", "times_list_val", ":", "list", ",", "marks_list_val", ":", "list", ",", "U", ":", "int", ")", ":", "\n", "    ", "\"\"\"\n    Computation of the mean log-likelihood (times and marks included), F1 score, and RMSE over the dataset (times_list_val, marks_list_val).\n    We use (times_list, marks_list) for training\n    Arguments:\n    ----------\n    model_vi: VI_model\n    times_list: (list) A list of ndarrays containing the event occurence times used for training\n    marks_list: (list) A list of ndarrays containing the corresponding event marks used for training\n    times_list_val: (list) A list of ndarrays containing the event occurence times used for computing the two scores\n    marks_list_val: (list) A list of ndarrays containing the corresponding event marks used for computing the two scores\n    U: (int) Dimension of the mark space\n    \"\"\"", "\n", "\n", "log_lkl_times", ",", "rmse", "=", "compute_scores_times", "(", "times_list", ",", "marks_list", ",", "times_list_val", ",", "marks_list_val", ",", "model_vi", ".", "U_dim", ")", "\n", "log_lkl_marks", ",", "f1_score", "=", "compute_scores_marks", "(", "model_vi", ",", "times_list_val", ",", "marks_list_val", ")", "\n", "\n", "num_events", "=", "sum", "(", "times_seq", ".", "size", "for", "times_seq", "in", "times_list_val", ")", "\n", "\n", "return", "(", "log_lkl_times", "+", "log_lkl_marks", ")", "/", "num_events", ",", "rmse", ",", "f1_score", "\n", "", ""]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.__init__": [[32, 90], ["len", "numpy.zeros", "model.VI_model.cache_data", "torch.nn.Softplus", "torch.ones", "isinstance", "TypeError", "isinstance", "TypeError", "numpy.log"], "methods", ["home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.cache_data"], ["def", "__init__", "(", "self", ",", "\n", "data_times", ":", "list", ",", "\n", "data_marks", ":", "list", ",", "\n", "data_times_val", ":", "list", ",", "\n", "data_marks_val", ":", "list", ",", "\n", "U_dim", ":", "int", ",", "\n", "Q", ":", "int", ",", "\n", "num_samples", ":", "int", ",", "\n", "num_weights", ":", "int", ",", "\n", "threshold", "=", "1.", ",", "\n", "weight_temp", "=", "1.", ",", "\n", "lr_gamma", "=", "0.9999", ",", "\n", "batch_size", ":", "int", "=", "64", ",", "\n", "max_epochs", ":", "int", "=", "100", ",", "\n", "interval", ":", "int", "=", "5", ",", "\n", "print_every", ":", "int", "=", "1", ",", "\n", "patience", ":", "int", "=", "100", ",", "\n", "use_prior", ":", "bool", "=", "False", ",", "\n", "verbose", ":", "bool", "=", "False", ")", ":", "\n", "\n", "        ", "if", "not", "isinstance", "(", "data_times", "[", "0", "]", ",", "np", ".", "ndarray", ")", ":", "\n", "            ", "raise", "TypeError", "(", "\"Invalid 'data_times' provided\"", ")", "\n", "\n", "", "if", "not", "isinstance", "(", "data_marks", "[", "0", "]", ",", "np", ".", "ndarray", ")", ":", "\n", "            ", "raise", "TypeError", "(", "\"Invalid 'data_marks' provided\"", ")", "\n", "\n", "", "self", ".", "num_samples", "=", "num_samples", "\n", "self", ".", "num_weights", "=", "num_weights", "\n", "self", ".", "threshold", "=", "threshold", "\n", "self", ".", "batch_size", "=", "batch_size", "\n", "self", ".", "max_epochs", "=", "max_epochs", "\n", "self", ".", "interval", "=", "interval", "\n", "self", ".", "print_every", "=", "print_every", "\n", "self", ".", "weight_temp", "=", "weight_temp", "\n", "self", ".", "lr_gamma", "=", "lr_gamma", "\n", "self", ".", "patience", "=", "patience", "\n", "self", ".", "use_prior", "=", "use_prior", "\n", "self", ".", "verbose", "=", "verbose", "\n", "self", ".", "Q", "=", "Q", "\n", "\n", "self", ".", "U_dim", "=", "U_dim", "\n", "self", ".", "n_params", "=", "1", "+", "(", "2", "*", "self", ".", "U_dim", "+", "1", ")", "*", "self", ".", "U_dim", "\n", "self", ".", "n_var_params", "=", "2", "+", "(", "3", "*", "self", ".", "U_dim", "+", "1", ")", "*", "self", ".", "U_dim", "\n", "self", ".", "size_alpha_betas", "=", "1", "+", "self", ".", "U_dim", "**", "2", "\n", "self", ".", "data_marks", "=", "data_marks", "\n", "self", ".", "num_seqs", "=", "len", "(", "data_marks", ")", "\n", "self", ".", "num_jumps", "=", "[", "mark_vec", ".", "size", "for", "mark_vec", "in", "data_marks", "]", "\n", "self", ".", "elbo_history", "=", "np", ".", "zeros", "(", "self", ".", "max_epochs", ")", "\n", "self", ".", "log_sqrt2pi", "=", "0.5", "*", "np", ".", "log", "(", "2", "*", "np", ".", "pi", ")", "\n", "self", ".", "data_times_val", "=", "data_times_val", "\n", "self", ".", "data_marks_val", "=", "data_marks_val", "\n", "\n", "self", ".", "cache_data", "(", "data_times", ",", "Q", ")", "\n", "\n", "self", ".", "positive_constraint", "=", "torch", ".", "nn", ".", "Softplus", "(", ")", "\n", "self", ".", "coeffs", "=", "None", "\n", "self", ".", "coeffs_old", "=", "None", "\n", "self", ".", "prior_sigma_betas_alpha", "=", "torch", ".", "ones", "(", "self", ".", "size_alpha_betas", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.cache_data": [[92, 108], ["range", "min", "numpy.zeros", "range", "model.VI_model.tau_ij_minus_list.append", "model.VI_model.Q_list.append", "torch.tensor"], "methods", ["None"], ["", "def", "cache_data", "(", "self", ",", "data_times", ",", "Q_in", ")", ":", "\n", "        ", "\"\"\"\n        Cache computations needed for optimization\n        \"\"\"", "\n", "self", ".", "tau_ij_minus_list", "=", "[", "]", "\n", "self", ".", "Q_list", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "self", ".", "num_seqs", ")", ":", "\n", "            ", "vec_times", "=", "data_times", "[", "i", "]", "\n", "N", "=", "vec_times", ".", "size", "\n", "Q", "=", "min", "(", "Q_in", ",", "N", "-", "1", ")", "\n", "minus_tau_ij", "=", "np", ".", "zeros", "(", "(", "Q", ",", "N", "-", "1", ")", ")", "\n", "for", "q", "in", "range", "(", "Q", ")", ":", "\n", "                ", "minus_tau_ij", "[", "q", ",", "q", ":", "N", "-", "1", "]", "=", "vec_times", "[", ":", "N", "-", "q", "-", "1", "]", "-", "vec_times", "[", "q", "+", "1", ":", "N", "]", "# change sign - used in likelihood computation", "\n", "\n", "", "self", ".", "tau_ij_minus_list", ".", "append", "(", "torch", ".", "tensor", "(", "minus_tau_ij", ")", ")", "\n", "self", ".", "Q_list", ".", "append", "(", "Q", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.check_convergence": [[110, 123], ["None"], "methods", ["None"], ["", "", "def", "check_convergence", "(", "self", ")", ":", "\n", "        ", "\"\"\"\n        Check if the algorithm converged\n        \"\"\"", "\n", "if", "self", ".", "best_loss", "-", "self", ".", "loss_val", "<", "self", ".", "threshold", ":", "\n", "            ", "self", ".", "impatient", "+=", "1", "\n", "", "else", ":", "\n", "            ", "self", ".", "best_loss", "=", "self", ".", "loss_val", "\n", "self", ".", "impatient", "=", "0", "\n", "\n", "", "if", "self", ".", "impatient", "==", "self", ".", "patience", ":", "\n", "           ", "return", "True", "\n", "", "return", "False", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.callback": [[125, 136], ["print", "model.VI_model.compute_metrics_val", "print"], "methods", ["home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.compute_metrics_val"], ["", "def", "callback", "(", "self", ",", "it", ",", "coeffs", "=", "None", ",", "end", "=", "\"\"", ")", ":", "\n", "        ", "\"\"\"\n        Print values of interest (ELBO, log-lkl, F1, training time)'\n        \"\"\"", "\n", "if", "(", "it", "+", "1", ")", "%", "self", ".", "print_every", "==", "0", "or", "it", "==", "0", ":", "\n", "            ", "if", "coeffs", "is", "None", ":", "\n", "                ", "print", "(", "'Epoch: {:d}/{:d} | ELBO: {:.4f} | dx: {:.4f}'", ".", "format", "(", "it", "+", "1", ",", "self", ".", "max_epochs", ",", "self", ".", "elbo_history", "[", "it", "]", ",", "self", ".", "max_norm", ")", ")", "\n", "", "else", ":", "\n", "                ", "log_lkl_val", ",", "f1_val", "=", "self", ".", "compute_metrics_val", "(", "coeffs", ")", "\n", "print", "(", "'Epoch: {:d}/{:d} | ELBO: {:.4f}  | log-lkl-val: {:.4f}  | F1 val: {:.4f} | training time: {:.4f}s'", "\n", ".", "format", "(", "it", "+", "1", ",", "self", ".", "max_epochs", ",", "self", ".", "elbo_history", "[", "it", "]", ",", "log_lkl_val", ",", "f1_val", ",", "self", ".", "train_time", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.compute_metrics_val": [[138, 153], ["numpy.log", "numpy.log().reshape", "numpy.exp", "numpy.exp().reshape", "model.VI_model.log_likelihood_acc", "numpy.exp", "numpy.log", "numpy.exp", "numpy.log().reshape.sum", "numpy.exp"], "methods", ["home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.log_likelihood_acc"], ["", "", "", "def", "compute_metrics_val", "(", "self", ",", "x_opt", ")", ":", "\n", "        ", "\"\"\"\n        Compute the value of log-likelihood nad the F1 score over the validation dataset\n        \"\"\"", "\n", "m_betas_alpha_opt", "=", "x_opt", "[", ":", "(", "self", ".", "U_dim", "**", "2", "+", "1", ")", "]", "\n", "sigma_betas_alpha_opt", "=", "np", ".", "log", "(", "1.", "+", "np", ".", "exp", "(", "x_opt", "[", "(", "self", ".", "U_dim", "**", "2", "+", "1", ")", ":", "2", "*", "(", "self", ".", "U_dim", "**", "2", "+", "1", ")", "]", ")", ")", "\n", "concent_deltas_Gammas_opt", "=", "np", ".", "log", "(", "1.", "+", "np", ".", "exp", "(", "x_opt", "[", "2", "*", "(", "self", ".", "U_dim", "**", "2", "+", "1", ")", ":", "]", ")", ")", ".", "reshape", "(", "self", ".", "U_dim", "+", "1", ",", "self", ".", "U_dim", ")", "\n", "\n", "mode_alpha", "=", "np", ".", "exp", "(", "m_betas_alpha_opt", "[", "-", "1", "]", "-", "sigma_betas_alpha_opt", "[", "-", "1", "]", "**", "2", ")", "\n", "mode_betas", "=", "np", ".", "exp", "(", "m_betas_alpha_opt", "[", ":", "-", "1", "]", "-", "sigma_betas_alpha_opt", "[", ":", "-", "1", "]", "**", "2", ")", ".", "reshape", "(", "self", ".", "U_dim", ",", "self", ".", "U_dim", ")", "\n", "mean_deltas_Gammas", "=", "concent_deltas_Gammas_opt", "/", "concent_deltas_Gammas_opt", ".", "sum", "(", "1", ")", "[", ":", ",", "None", "]", "\n", "\n", "log_lkl_tst", ",", "f1_tst", "=", "self", ".", "log_likelihood_acc", "(", "mode_alpha", ",", "mode_betas", ",", "mean_deltas_Gammas", "[", "0", "]", ",", "mean_deltas_Gammas", "[", "1", ":", "]", ")", "\n", "\n", "return", "log_lkl_tst", ",", "f1_tst", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.log_likelihood_acc": [[155, 197], ["max", "numpy.zeros", "numpy.zeros", "range", "len", "len", "len", "numpy.arange", "min", "numpy.zeros", "numpy.zeros", "range", "numpy.log().sum", "numpy.zeros", "range", "numpy.zeros.sum", "sklearn.metrics.f1_score", "numpy.log", "numpy.log().sum", "range", "numpy.argmax", "numpy.exp", "numpy.log", "numpy.log", "numpy.ones", "numpy.exp", "numpy.zeros.sum", "numpy.exp", "numpy.zeros.sum", "numpy.zeros.sum"], "methods", ["None"], ["", "def", "log_likelihood_acc", "(", "self", ",", "alpha", ",", "beta_mtr", ",", "delta_vec", ",", "Gamma_mtr", ")", ":", "\n", "        ", "\"\"\"\n        Helper function to compute the value of log-likelihood nad the F1 score over the validation dataset\n        \"\"\"", "\n", "log_lkl_org", "=", "0.", "\n", "Q", "=", "max", "(", "self", ".", "Q_list", ")", "\n", "sum_N", "=", "0", "\n", "predicted_marks", "=", "np", ".", "zeros", "(", "len", "(", "self", ".", "data_times_val", ")", ",", "dtype", "=", "np", ".", "int32", ")", "\n", "true_marks", "=", "np", ".", "zeros", "(", "len", "(", "self", ".", "data_times_val", ")", ",", "dtype", "=", "np", ".", "int32", ")", "\n", "for", "s", "in", "range", "(", "len", "(", "self", ".", "data_times_val", ")", ")", ":", "\n", "            ", "times", "=", "self", ".", "data_times_val", "[", "s", "]", "\n", "marks", "=", "self", ".", "data_marks_val", "[", "s", "]", "\n", "true_marks", "[", "s", "]", "=", "marks", "[", "-", "1", "]", "\n", "N", "=", "times", ".", "size", "\n", "ar_x", "=", "np", ".", "arange", "(", "N", ")", "\n", "Q_", "=", "min", "(", "Q", ",", "N", "-", "1", ")", "\n", "Q_mtr", "=", "np", ".", "zeros", "(", "(", "Q_", ",", "N", "-", "1", ")", ")", "\n", "Q_denom", "=", "np", ".", "zeros", "(", "(", "N", "-", "1", ",", "Q_", ")", ")", "\n", "for", "q", "in", "range", "(", "Q_", ")", ":", "\n", "                ", "tij", "=", "times", "[", ":", "N", "-", "q", "-", "1", "]", "-", "times", "[", "q", "+", "1", ":", "N", "]", "\n", "Q_mtr", "[", "q", ",", "q", ":", "]", "=", "Gamma_mtr", "[", "marks", "[", ":", "-", "1", "-", "q", "]", ",", "marks", "[", "1", "+", "q", ":", "]", "]", "*", "np", ".", "exp", "(", "beta_mtr", "[", "marks", "[", ":", "-", "1", "-", "q", "]", ",", "marks", "[", "1", "+", "q", ":", "]", "]", "*", "tij", ")", "\n", "Q_denom", "[", "q", ":", ",", "q", "]", "=", "(", "Gamma_mtr", "[", "marks", "[", ":", "-", "1", "-", "q", "]", "]", "*", "np", ".", "exp", "(", "beta_mtr", "[", "marks", "[", ":", "-", "1", "-", "q", "]", "]", "*", "tij", "[", ":", ",", "None", "]", ")", ")", ".", "sum", "(", "1", ")", "\n", "\n", "", "numer", "=", "np", ".", "log", "(", "delta_vec", "[", "marks", "[", "0", "]", "]", ")", "+", "np", ".", "log", "(", "delta_vec", "[", "marks", "[", "1", ":", "]", "]", "+", "alpha", "*", "Q_mtr", ".", "sum", "(", "0", ")", ")", ".", "sum", "(", ")", "\n", "denom", "=", "np", ".", "log", "(", "1", "+", "alpha", "*", "Q_denom", ".", "sum", "(", "1", ")", ")", ".", "sum", "(", ")", "\n", "\n", "log_lkl_org", "+=", "numer", "-", "denom", "\n", "\n", "prob_all", "=", "np", ".", "zeros", "(", "(", "N", ",", "self", ".", "U_dim", ")", ")", "\n", "prob_all", "[", "0", "]", "=", "delta_vec", "\n", "for", "u", "in", "range", "(", "self", ".", "U_dim", ")", ":", "\n", "                ", "for", "q", "in", "range", "(", "Q_", ")", ":", "\n", "                    ", "marks_pred", "=", "u", "*", "np", ".", "ones", "(", "N", "-", "1", "-", "q", ",", "dtype", "=", "np", ".", "int32", ")", "\n", "tij", "=", "times", "[", ":", "N", "-", "q", "-", "1", "]", "-", "times", "[", "q", "+", "1", ":", "N", "]", "\n", "Q_mtr", "[", "q", ",", "q", ":", "]", "=", "Gamma_mtr", "[", "marks", "[", ":", "-", "1", "-", "q", "]", ",", "marks_pred", "]", "*", "np", ".", "exp", "(", "beta_mtr", "[", "marks", "[", ":", "-", "1", "-", "q", "]", ",", "marks_pred", "]", "*", "tij", ")", "\n", "\n", "", "prob_all", "[", "1", ":", ",", "u", "]", "=", "delta_vec", "[", "u", "]", "+", "alpha", "*", "Q_mtr", ".", "sum", "(", "0", ")", "\n", "", "prob_all", "/=", "prob_all", ".", "sum", "(", "axis", "=", "1", ",", "keepdims", "=", "True", ")", "\n", "\n", "predicted_marks", "[", "s", "]", "=", "np", ".", "argmax", "(", "prob_all", ",", "axis", "=", "1", ")", "[", "-", "1", "]", "\n", "\n", "", "return", "log_lkl_org", ",", "f1_score", "(", "true_marks", ",", "predicted_marks", ",", "average", "=", "'macro'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.stable_softmax": [[199, 205], ["e_x.sum", "input.max"], "methods", ["None"], ["", "def", "stable_softmax", "(", "self", ",", "input", ")", ":", "\n", "        ", "\"\"\"\n        Compute softmax values for a 1-d torch.Tensor 'input'.\n        \"\"\"", "\n", "e_x", "=", "(", "input", "-", "input", ".", "max", "(", ")", ")", ".", "exp", "(", ")", "\n", "return", "e_x", "/", "e_x", ".", "sum", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.log_posterior": [[207, 215], ["betas_alpha.log", "log_pdf_betas_alpha.sum", "sigma_betas_alpha.square", "sigma_betas_alpha.log"], "methods", ["None"], ["", "def", "log_posterior", "(", "self", ",", "betas_alpha", ",", "m_betas_alpha", ",", "sigma_betas_alpha", ")", ":", "\n", "        ", "\"\"\"\n        Compute the value of log-posterior\n        \"\"\"", "\n", "betas_alpha_log", "=", "betas_alpha", ".", "log", "(", ")", "\n", "log_pdf_betas_alpha", "=", "-", "0.5", "*", "(", "betas_alpha_log", "-", "m_betas_alpha", ")", ".", "square", "(", ")", "/", "sigma_betas_alpha", ".", "square", "(", ")", "-", "(", "betas_alpha_log", "+", "sigma_betas_alpha", ".", "log", "(", ")", "+", "self", ".", "log_sqrt2pi", ")", "\n", "\n", "return", "log_pdf_betas_alpha", ".", "sum", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.log_likelihood": [[217, 245], ["betas_alpha[].reshape", "torch.zeros", "torch.zeros", "range", "deltas[].log", "torch.zeros.sum", "torch.zeros.sum"], "methods", ["None"], ["", "def", "log_likelihood", "(", "self", ",", "batch_inds", ",", "betas_alpha", ",", "deltas", ",", "Gammas", ")", ":", "\n", "        ", "\"\"\"\n        Compute the value of log-likelihood\n        \"\"\"", "\n", "alpha", "=", "betas_alpha", "[", "-", "1", "]", "\n", "beta_mtr", "=", "betas_alpha", "[", ":", "-", "1", "]", ".", "reshape", "(", "self", ".", "U_dim", ",", "self", ".", "U_dim", ")", "\n", "log_lkl", "=", "0.", "\n", "for", "s", "in", "batch_inds", ":", "\n", "            ", "marks", "=", "self", ".", "data_marks", "[", "s", "]", "\n", "minus_tau_ij", "=", "self", ".", "tau_ij_minus_list", "[", "s", "]", "\n", "N", "=", "self", ".", "num_jumps", "[", "s", "]", "\n", "Q", "=", "self", ".", "Q_list", "[", "s", "]", "\n", "\n", "Q_mtr", "=", "torch", ".", "zeros", "(", "(", "Q", ",", "N", "-", "1", ")", ")", "\n", "Q_denom", "=", "torch", ".", "zeros", "(", "(", "N", "-", "1", ",", "Q", ")", ")", "\n", "for", "q", "in", "range", "(", "Q", ")", ":", "\n", "                ", "tij", "=", "minus_tau_ij", "[", "q", ",", "q", ":", "]", "\n", "marks_minus", "=", "marks", "[", ":", "-", "1", "-", "q", "]", "\n", "marks_plus", "=", "marks", "[", "1", "+", "q", ":", "]", "\n", "Q_mtr", "[", "q", ",", "q", ":", "]", "=", "Gammas", "[", "marks_minus", ",", "marks_plus", "]", "*", "(", "beta_mtr", "[", "marks_minus", ",", "marks_plus", "]", "*", "tij", ")", ".", "exp", "(", ")", "\n", "Q_denom", "[", "q", ":", ",", "q", "]", "=", "(", "Gammas", "[", "marks_minus", "]", "*", "(", "beta_mtr", "[", "marks_minus", "]", "*", "tij", "[", ":", ",", "None", "]", ")", ".", "exp", "(", ")", ")", ".", "sum", "(", "1", ")", "\n", "\n", "", "numer", "=", "deltas", "[", "marks", "[", "0", "]", "]", ".", "log", "(", ")", "+", "(", "deltas", "[", "marks", "[", "1", ":", "]", "]", "+", "alpha", "*", "Q_mtr", ".", "sum", "(", "0", ")", ")", ".", "log", "(", ")", ".", "sum", "(", ")", "\n", "denom", "=", "(", "1.", "+", "alpha", "*", "Q_denom", ".", "sum", "(", "1", ")", ")", ".", "log", "(", ")", ".", "sum", "(", ")", "\n", "\n", "log_lkl", "+=", "numer", "-", "denom", "\n", "\n", "", "return", "self", ".", "num_seqs", "*", "log_lkl", "/", "batch_inds", ".", "size", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.log_prior": [[247, 254], ["log_pdf_betas_alpha.sum", "betas_alpha.square"], "methods", ["None"], ["", "def", "log_prior", "(", "self", ",", "betas_alpha", ")", ":", "\n", "        ", "\"\"\"\n        Compute the value of log-prior\n        \"\"\"", "\n", "# log-pdf betas, alpha ~ N(0, C**2)", "\n", "log_pdf_betas_alpha", "=", "-", "0.5", "*", "betas_alpha", ".", "square", "(", ")", "/", "self", ".", "prior_sigma_betas_alpha", "\n", "return", "log_pdf_betas_alpha", ".", "sum", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.log_importance_weight": [[256, 270], ["model.VI_model.log_likelihood", "model.VI_model.log_posterior", "model.VI_model.log_prior"], "methods", ["home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.log_likelihood", "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.log_posterior", "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.log_prior"], ["", "def", "log_importance_weight", "(", "self", ",", "batch_inds", ",", "samples_betas_alpha_l_i", ",", "samples_deltas_l_i", ",", "samples_Gammas_l_i", ",", "m_betas_alpha", ",", "sigma_betas_alpha", ")", ":", "\n", "        ", "\"\"\"\n        Compute the value of a single importance weight 'log(w_i)'\n        \"\"\"", "\n", "# Compute the log-posterior and log-prior", "\n", "logpost", ",", "logprior", "=", "0.", ",", "0.", "\n", "if", "self", ".", "use_prior", ":", "\n", "            ", "logpost", "=", "self", ".", "log_posterior", "(", "samples_betas_alpha_l_i", ",", "m_betas_alpha", ",", "sigma_betas_alpha", ")", "\n", "logprior", "=", "self", ".", "log_prior", "(", "samples_betas_alpha_l_i", ")", "\n", "\n", "# Compute the log-likelihood", "\n", "", "loglik", "=", "self", ".", "log_likelihood", "(", "batch_inds", ",", "samples_betas_alpha_l_i", ",", "samples_deltas_l_i", ",", "samples_Gammas_l_i", ")", "\n", "\n", "return", "loglik", "+", "logprior", "-", "logpost", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.objective_l": [[272, 283], ["torch.zeros", "range", "model.VI_model.stable_softmax().detach", "value_i.sum", "model.VI_model.log_importance_weight", "model.VI_model.stable_softmax"], "methods", ["home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.log_importance_weight", "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.stable_softmax"], ["", "def", "objective_l", "(", "self", ",", "batch_inds", ",", "samples_betas_alpha_l", ",", "samples_deltas_l", ",", "samples_Gammas_l", ",", "m_betas_alpha", ",", "sigma_betas_alpha", ")", ":", "\n", "        ", "log_w_arr", "=", "torch", ".", "zeros", "(", "self", ".", "num_weights", ")", "\n", "for", "i", "in", "range", "(", "self", ".", "num_weights", ")", ":", "\n", "# Compute the importance weights (and their gradients)", "\n", "            ", "log_w_arr", "[", "i", "]", "=", "self", ".", "log_importance_weight", "(", "batch_inds", ",", "samples_betas_alpha_l", "[", "i", "]", ",", "samples_deltas_l", "[", "i", "]", ",", "samples_Gammas_l", "[", "i", "]", ",", "m_betas_alpha", ",", "sigma_betas_alpha", ")", "\n", "# Temper the weights", "\n", "", "log_w_arr", "/=", "self", ".", "weight_temp", "\n", "w_tilde", "=", "self", ".", "stable_softmax", "(", "log_w_arr", ")", ".", "detach", "(", ")", "# Detach 'w_tilde' from backward computations", "\n", "# Compute the weighted average over all `num_weights` samples", "\n", "value_i", "=", "w_tilde", "*", "log_w_arr", "\n", "return", "value_i", ".", "sum", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.objective": [[285, 313], ["model.VI_model.positive_constraint", "model.VI_model.positive_constraint().reshape", "torch.distributions.dirichlet.Dirichlet", "torch.distributions.dirichlet.Dirichlet.rsample", "range", "model.VI_model.objective_l", "model.VI_model.positive_constraint", "torch.randn"], "methods", ["home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.objective_l"], ["", "def", "objective", "(", "self", ",", "x", ",", "batch_inds", ")", ":", "\n", "        ", "\"\"\"\n        Importance weighted variational objective function\n        Arguments:\n        ----------\n        x: (torch.Tensor) The variational parameters to be optimized\n        batch_inds: (np.ndarray) The indexes of the selected batch\n        \"\"\"", "\n", "# Split the parameters into concentration parameters and means/stds", "\n", "m_betas_alpha", "=", "x", "[", ":", "self", ".", "size_alpha_betas", "]", "\n", "sigma_betas_alpha", "=", "self", ".", "positive_constraint", "(", "x", "[", "self", ".", "size_alpha_betas", ":", "2", "*", "self", ".", "size_alpha_betas", "]", ")", "\n", "concent_deltas_Gammas", "=", "self", ".", "positive_constraint", "(", "x", "[", "2", "*", "self", ".", "size_alpha_betas", ":", "]", ")", ".", "reshape", "(", "self", ".", "U_dim", "+", "1", ",", "self", ".", "U_dim", ")", "\n", "\n", "# Sample noise and Dirichlet distributed probability vectors", "\n", "samples_betas_alpha", "=", "(", "m_betas_alpha", "+", "sigma_betas_alpha", "*", "torch", ".", "randn", "(", "self", ".", "num_samples", ",", "self", ".", "num_weights", ",", "self", ".", "size_alpha_betas", ")", ")", ".", "exp", "(", ")", "\n", "\n", "dirichlet_dist", "=", "torch", ".", "distributions", ".", "dirichlet", ".", "Dirichlet", "(", "concent_deltas_Gammas", ")", "\n", "samples_dirichlet", "=", "dirichlet_dist", ".", "rsample", "(", "(", "self", ".", "num_samples", ",", "self", ".", "num_weights", ")", ")", "# num_samples x num_weights x U+1 x U", "\n", "\n", "samples_deltas", "=", "samples_dirichlet", "[", ":", ",", ":", ",", "0", ",", ":", "]", "# num_samples x num_weights x U", "\n", "samples_Gammas", "=", "samples_dirichlet", "[", ":", ",", ":", ",", "1", ":", ",", ":", "]", "# num_samples x num_weights x U x U", "\n", "\n", "elbo_value", "=", "0.0", "\n", "# Compute a Monte Carlo estimate of ELBO", "\n", "for", "l", "in", "range", "(", "self", ".", "num_samples", ")", ":", "\n", "            ", "elbo_value", "+=", "self", ".", "objective_l", "(", "batch_inds", ",", "samples_betas_alpha", "[", "l", "]", ",", "samples_deltas", "[", "l", "]", ",", "samples_Gammas", "[", "l", "]", ",", "m_betas_alpha", ",", "sigma_betas_alpha", ")", "\n", "", "elbo_value", "/=", "self", ".", "num_samples", "\n", "return", "elbo_value", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.hyperparameter_optimize": [[315, 348], ["torch.zeros", "model.VI_model.positive_constraint", "model.VI_model.positive_constraint().reshape", "torch.distributions.dirichlet.Dirichlet", "torch.distributions.dirichlet.Dirichlet.sample", "samples_betas_alpha.square", "range", "model.VI_model.stable_softmax().detach", "model.VI_model.log_importance_weight", "model.VI_model.positive_constraint", "model.VI_model.stable_softmax", "model.VI_model.unsqueeze", "torch.randn"], "methods", ["home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.log_importance_weight", "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.stable_softmax"], ["", "def", "hyperparameter_optimize", "(", "self", ",", "x", ",", "batch_inds", ")", ":", "\n", "        ", "\"\"\"\n        Update prior's hyperparameters\n        Arguments:\n        ----------\n        x: (torch.Tensor) The variational parameters to be optimized\n        batch_inds: (np.ndarray) The indexes of the selected batch\n        \"\"\"", "\n", "log_w_arr", "=", "torch", ".", "zeros", "(", "self", ".", "num_weights", ")", "\n", "\n", "m_betas_alpha", "=", "x", "[", ":", "self", ".", "size_alpha_betas", "]", "\n", "sigma_betas_alpha", "=", "self", ".", "positive_constraint", "(", "x", "[", "self", ".", "size_alpha_betas", ":", "2", "*", "self", ".", "size_alpha_betas", "]", ")", "\n", "concent_deltas_Gammas", "=", "self", ".", "positive_constraint", "(", "x", "[", "2", "*", "self", ".", "size_alpha_betas", ":", "]", ")", ".", "reshape", "(", "self", ".", "U_dim", "+", "1", ",", "self", ".", "U_dim", ")", "\n", "\n", "# Sample noise and Dirichlet distributed probability vectors", "\n", "samples_betas_alpha", "=", "(", "m_betas_alpha", "+", "sigma_betas_alpha", "*", "torch", ".", "randn", "(", "self", ".", "num_weights", ",", "self", ".", "size_alpha_betas", ")", ")", ".", "exp", "(", ")", "\n", "\n", "dirichlet_dist", "=", "torch", ".", "distributions", ".", "dirichlet", ".", "Dirichlet", "(", "concent_deltas_Gammas", ")", "\n", "samples_dirichlet", "=", "dirichlet_dist", ".", "sample", "(", "(", "self", ".", "num_weights", ",", ")", ")", "# num_weights x U+1 x U", "\n", "\n", "samples_deltas", "=", "samples_dirichlet", "[", ":", ",", "0", ",", ":", "]", "# num_weights x U", "\n", "samples_Gammas", "=", "samples_dirichlet", "[", ":", ",", "1", ":", ",", ":", "]", "# num_weights x U x U", "\n", "\n", "opt_sigma_now", "=", "samples_betas_alpha", ".", "square", "(", ")", "\n", "\n", "for", "i", "in", "range", "(", "self", ".", "num_weights", ")", ":", "\n", "            ", "log_w_arr", "[", "i", "]", "=", "self", ".", "log_importance_weight", "(", "batch_inds", ",", "samples_betas_alpha", "[", "i", "]", ",", "samples_deltas", "[", "i", "]", ",", "samples_Gammas", "[", "i", "]", ",", "m_betas_alpha", ",", "sigma_betas_alpha", ")", "\n", "\n", "", "log_w_arr", "/=", "self", ".", "weight_temp", "\n", "w_tilde", "=", "self", ".", "stable_softmax", "(", "log_w_arr", ")", ".", "detach", "(", ")", "\n", "opt_sigma", "=", "(", "w_tilde", ".", "unsqueeze", "(", "1", ")", "*", "opt_sigma_now", ")", ".", "sum", "(", "0", ")", "\n", "\n", "self", ".", "prior_sigma_betas_alpha", "=", "0.5", "*", "(", "opt_sigma", "+", "self", ".", "prior_sigma_betas_alpha", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.fit": [[350, 421], ["torch.tensor", "model.VI_model.coeffs.detach().clone", "torch.optim.Adam", "torch.optim.lr_scheduler.ExponentialLR", "numpy.arange", "range", "print", "torch.manual_seed", "numpy.random.seed", "numpy.zeros", "numpy.random.normal", "numpy.log", "numpy.log", "isinstance", "TypeError", "ValueError", "time.time", "numpy.random.permutation", "range", "model.VI_model.coeffs.detach", "model.VI_model.numpy", "model.VI_model.compute_metrics_val", "torch.isnan().any", "model.VI_model.check_convergence", "model.VI_model.coeffs.detach", "min", "torch.optim.Adam.zero_grad", "elbo.backward", "torch.optim.Adam.step", "torch.optim.lr_scheduler.ExponentialLR.step", "time.time", "elbo.detach().numpy", "ValueError", "time.time", "model.VI_model.hyperparameter_optimize", "numpy.exp", "numpy.exp", "model.VI_model.objective", "torch.isnan", "model.VI_model.callback", "print", "model.VI_model.callback", "time.time", "numpy.clip", "str", "elbo.detach", "numpy.random.normal", "numpy.random.rand"], "methods", ["home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.compute_metrics_val", "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.check_convergence", "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.hyperparameter_optimize", "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.objective", "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.callback", "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.callback"], ["", "def", "fit", "(", "self", ",", "coeffs_0", "=", "None", ",", "seed", "=", "None", ")", ":", "\n", "        ", "\"\"\"\n        Training the model\n        Arguments:\n        ----------\n        \"\"\"", "\n", "if", "seed", "is", "not", "None", ":", "\n", "            ", "torch", ".", "manual_seed", "(", "seed", ")", "\n", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "\n", "", "if", "coeffs_0", "is", "None", ":", "\n", "            ", "coeffs_0", "=", "np", ".", "zeros", "(", "2", "+", "(", "self", ".", "U_dim", "+", "1", ")", "*", "self", ".", "U_dim", "+", "2", "*", "self", ".", "U_dim", "**", "2", ")", "\n", "coeffs_0", "[", ":", "(", "self", ".", "U_dim", "**", "2", "+", "1", ")", "]", "=", "np", ".", "random", ".", "normal", "(", "loc", "=", "2.1", ",", "scale", "=", "0.1", ",", "size", "=", "self", ".", "U_dim", "**", "2", "+", "1", ")", "\n", "coeffs_0", "[", "(", "self", ".", "U_dim", "**", "2", "+", "1", ")", ":", "2", "*", "(", "self", ".", "U_dim", "**", "2", "+", "1", ")", "]", "=", "np", ".", "log", "(", "np", ".", "exp", "(", "np", ".", "clip", "(", "np", ".", "random", ".", "normal", "(", "loc", "=", "0.2", ",", "scale", "=", "0.1", ",", "size", "=", "self", ".", "U_dim", "**", "2", "+", "1", ")", ",", "1e-1", ",", "2.0", ")", ")", "-", "1.", ")", "\n", "coeffs_0", "[", "2", "*", "(", "self", ".", "U_dim", "**", "2", "+", "1", ")", ":", "]", "=", "np", ".", "log", "(", "np", ".", "exp", "(", "0.5", "+", "2", "*", "np", ".", "random", ".", "rand", "(", "(", "self", ".", "U_dim", "+", "1", ")", "*", "self", ".", "U_dim", ")", ")", "-", "1.", ")", "\n", "\n", "", "if", "not", "isinstance", "(", "coeffs_0", ",", "np", ".", "ndarray", ")", ":", "\n", "            ", "raise", "TypeError", "(", "\"Invalid 'coeffs_0' provided. Coeffs must be a numpy array\"", ")", "\n", "\n", "", "if", "coeffs_0", ".", "size", "!=", "self", ".", "n_var_params", "or", "coeffs_0", ".", "ndim", "!=", "1", ":", "\n", "            ", "raise", "ValueError", "(", "\"Invalid size of 'coeffs_0' provided. 'coeffs_0' must be a numpy array of size (\"", "+", "str", "(", "self", ".", "n_var_params", ")", "+", "\", )\"", ")", "\n", "\n", "\n", "", "self", ".", "coeffs", "=", "torch", ".", "tensor", "(", "coeffs_0", ",", "requires_grad", "=", "True", ")", "\n", "self", ".", "coeffs_old", "=", "self", ".", "coeffs", ".", "detach", "(", ")", ".", "clone", "(", ")", "\n", "\n", "optimizer", "=", "torch", ".", "optim", ".", "Adam", "(", "[", "self", ".", "coeffs", "]", ",", "lr", "=", "0.03", ")", "\n", "scheduler", "=", "torch", ".", "optim", ".", "lr_scheduler", ".", "ExponentialLR", "(", "optimizer", ",", "gamma", "=", "self", ".", "lr_gamma", ")", "\n", "self", ".", "train_time", "=", "0.", "\n", "all_seqs", "=", "np", ".", "arange", "(", "self", ".", "num_seqs", ")", "\n", "self", ".", "impatient", "=", "0", "\n", "self", ".", "best_loss", "=", "np", ".", "inf", "\n", "\n", "for", "epoch", "in", "range", "(", "self", ".", "max_epochs", ")", ":", "\n", "            ", "start_t", "=", "time", ".", "time", "(", ")", "\n", "# Variational parameters update", "\n", "rand_inds", "=", "np", ".", "random", ".", "permutation", "(", "self", ".", "num_seqs", ")", "\n", "for", "first", "in", "range", "(", "0", ",", "self", ".", "num_seqs", ",", "self", ".", "batch_size", ")", ":", "\n", "                ", "final_ind", "=", "min", "(", "first", "+", "self", ".", "batch_size", ",", "self", ".", "num_seqs", ")", "\n", "batch_ind", "=", "rand_inds", "[", "first", ":", "final_ind", "]", "\n", "optimizer", ".", "zero_grad", "(", ")", "\n", "elbo", "=", "-", "1.0", "*", "self", ".", "objective", "(", "self", ".", "coeffs", ",", "batch_ind", ")", "\n", "elbo", ".", "backward", "(", ")", "\n", "optimizer", ".", "step", "(", ")", "\n", "scheduler", ".", "step", "(", ")", "\n", "", "self", ".", "train_time", "+=", "time", ".", "time", "(", ")", "-", "start_t", "\n", "coeffs", "=", "self", ".", "coeffs", ".", "detach", "(", ")", "\n", "coeffs_np", "=", "coeffs", ".", "numpy", "(", ")", "\n", "self", ".", "elbo_history", "[", "epoch", "]", "=", "-", "elbo", ".", "detach", "(", ")", ".", "numpy", "(", ")", "\n", "lkl_val", ",", "_", "=", "self", ".", "compute_metrics_val", "(", "coeffs_np", ")", "\n", "self", ".", "loss_val", "=", "-", "1.0", "*", "lkl_val", "\n", "\n", "# Check that no NaN values are present after the variational parameters update", "\n", "if", "torch", ".", "isnan", "(", "coeffs", ")", ".", "any", "(", ")", ":", "\n", "                ", "raise", "ValueError", "(", "'NaNs in coeffs! Stop optimization...'", ")", "\n", "\n", "# Convergence check", "\n", "", "if", "self", ".", "check_convergence", "(", ")", ":", "\n", "                ", "if", "self", ".", "verbose", ":", "\n", "                    ", "self", ".", "callback", "(", "epoch", ",", "coeffs_np", ")", "\n", "print", "(", "'Converged!'", ")", "\n", "", "break", "\n", "", "elif", "self", ".", "verbose", ":", "\n", "                ", "self", ".", "callback", "(", "epoch", ",", "coeffs_np", ")", "\n", "\n", "# Update hyper-parameters", "\n", "", "if", "(", "epoch", "+", "1", ")", "%", "self", ".", "interval", "==", "0", ":", "\n", "                ", "start_t", "=", "time", ".", "time", "(", ")", "\n", "self", ".", "hyperparameter_optimize", "(", "coeffs", ",", "all_seqs", ")", "\n", "self", ".", "train_time", "+=", "time", ".", "time", "(", ")", "-", "start_t", "\n", "", "", "print", "(", ")", "\n", "", "", ""]], "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.example.train.run_experiment": [[6, 38], ["print", "print", "print", "vi_dpp.load_dataset", "print", "print", "print", "print", "print", "vi_dpp.VI_model", "print", "vi_dpp.VI_model.fit", "print", "print", "vi_dpp.compute_all_scores", "print", "print", "print", "print", "print", "print", "sum", "sum", "sum", "os.path.abspath"], "function", ["home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.load_dataset", "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.model.VI_model.fit", "home.repos.pwc.inspect_result.aresPanos_Interpretable-Point-Processes.vi_dpp.utilities.compute_all_scores"], ["def", "run_experiment", "(", "args_in", ")", ":", "\n", "    ", "print", "(", "'============\\nConfiguration\\n============'", ")", "\n", "print", "(", "args_in", ")", "\n", "print", "(", "'============\\n'", ")", "\n", "\n", "dir_dataset", "=", "os", ".", "path", ".", "abspath", "(", "__file__", "+", "\"/../../data/\"", ")", "+", "'/'", "+", "args_in", ".", "dataset", "+", "'.pkl'", "\n", "times_list_tr", ",", "marks_list_tr", ",", "times_list_val", ",", "marks_list_val", ",", "times_list_tst", ",", "marks_list_tst", ",", "U_dim", "=", "load_dataset", "(", "dir_dataset", ",", "seed", "=", "args_in", ".", "seed", ")", "\n", "print", "(", "7", "*", "'='", ")", "\n", "print", "(", "'Dataset: '", ",", "args_in", ".", "dataset", ")", "\n", "print", "(", "'Number of events Train: {}  Val: {}  Test: {} '", ".", "format", "(", "sum", "(", "time_seq", ".", "size", "for", "time_seq", "in", "times_list_tr", ")", ",", "sum", "(", "time_seq", ".", "size", "for", "time_seq", "in", "times_list_val", ")", ",", "sum", "(", "time_seq", ".", "size", "for", "time_seq", "in", "times_list_tst", ")", ")", ")", "\n", "print", "(", "'U: '", ",", "U_dim", ")", "\n", "print", "(", "7", "*", "'='", ")", "\n", "\n", "model", "=", "VI_model", "(", "times_list_tr", ",", "marks_list_tr", ",", "times_list_val", ",", "marks_list_val", ",", "\n", "U_dim", "=", "U_dim", ",", "Q", "=", "args_in", ".", "Q", ",", "num_samples", "=", "args_in", ".", "num_samples", ",", "num_weights", "=", "args_in", ".", "num_weights", ",", "\n", "max_epochs", "=", "args_in", ".", "max_epochs", ",", "batch_size", "=", "args_in", ".", "batch_size", ",", "interval", "=", "args_in", ".", "interval", ",", "\n", "print_every", "=", "args_in", ".", "print_every", ",", "use_prior", "=", "args_in", ".", "use_prior", ",", "verbose", "=", "args_in", ".", "verbose", ")", "\n", "\n", "print", "(", "'\\nTraining VI-DPP...'", ")", "\n", "model", ".", "fit", "(", "seed", "=", "args_in", ".", "seed", ")", "\n", "print", "(", "'Done!'", ")", "\n", "\n", "print", "(", "'\\nTraining log-Normal model...'", ")", "\n", "log_lkl", ",", "rmse", ",", "f1_score", "=", "compute_all_scores", "(", "model", ",", "times_list_tr", ",", "marks_list_tr", ",", "times_list_tst", ",", "marks_list_tst", ",", "model", ".", "U_dim", ")", "\n", "print", "(", "'Done!'", ")", "\n", "\n", "print", "(", "'Training time: %.4f seconds'", "%", "model", ".", "train_time", ")", "\n", "\n", "print", "(", "'\\nPredictive performance'", ")", "\n", "print", "(", "'======================='", ")", "\n", "print", "(", "'average log-lkl: {:.4f} | F1: {:.4f} | RMSE: {:.4f}'", ".", "format", "(", "log_lkl", ",", "f1_score", ",", "rmse", ")", ")", "\n", "print", "(", "'Done!'", ")", "\n", "\n"]]}