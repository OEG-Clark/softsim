{"home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.__init__": [[14, 32], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "epoch", "=", "parameters", ".", "EPOCH_NUM", "\n", "self", ".", "real_data_path", "=", "parameters", ".", "REAL_DATA_PATH", "\n", "self", ".", "training_data_path", "=", "parameters", ".", "TRAINING_DATA_PATH", "\n", "self", ".", "testing_data_path", "=", "parameters", ".", "TESTING_DATA_PATH", "\n", "self", ".", "batch_size", "=", "parameters", ".", "BATCH_SIZE", "\n", "self", ".", "training_train_file", "=", "parameters", ".", "TRAINING_TRAIN_FILE", "\n", "self", ".", "subfolder_groundtruth", "=", "parameters", ".", "SUBFOLDER_GROUNDTRUTH", "\n", "self", ".", "subfolder_trainingdata", "=", "parameters", ".", "SUBFOLDER_TRAININGDATA", "\n", "self", ".", "subfolder_isp", "=", "parameters", ".", "SUBFOLDER_ISP", "\n", "self", ".", "crop_size", "=", "parameters", ".", "CROP_SIZE", "\n", "self", ".", "test_train_file", "=", "parameters", ".", "TESTING_TRAIN_FILE", "\n", "self", ".", "result_path", "=", "parameters", ".", "RESULT_PATH", "\n", "self", ".", "file_report", "=", "parameters", ".", "FILENAME_REPORT", "\n", "self", ".", "test_image_folder", "=", "parameters", ".", "TEST_IMAGE_FOLDER", "\n", "self", ".", "test_step", "=", "parameters", ".", "TEST_STEP", "\n", "self", ".", "train_subfolder", "=", "'subfolder'", "\n", "self", ".", "folder_num", "=", "100", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.gamma": [[33, 38], ["image.astype", "numpy.power"], "methods", ["None"], ["", "def", "gamma", "(", "self", ",", "image", ")", ":", "\n", "        ", "image", "=", "image", ".", "astype", "(", "np", ".", "float32", ")", "/", "255.", "\n", "y", "=", "(", "1", "+", "0.055", ")", "*", "np", ".", "power", "(", "image", ",", "1", "/", "2.4", ")", "-", "0.055", "\n", "y", "[", "image", "<", "0.0031308", "]", "=", "12.92", "*", "image", "[", "image", "<", "0.0031308", "]", "\n", "return", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.bayerprocess": [[39, 47], ["numpy.copy", "rgb.astype"], "methods", ["None"], ["", "def", "bayerprocess", "(", "self", ",", "rgb", ")", ":", "\n", "        ", "rgb", "=", "rgb", ".", "astype", "(", "np", ".", "float32", ")", "/", "65535.", "\n", "bayer", "=", "np", ".", "copy", "(", "rgb", "[", ":", ",", ":", ",", "0", "]", ")", "\n", "bayer", "[", "0", ":", ":", "2", ",", "0", ":", ":", "2", "]", "=", "rgb", "[", "0", ":", ":", "2", ",", "0", ":", ":", "2", ",", "0", "]", "\n", "bayer", "[", "1", ":", ":", "2", ",", "0", ":", ":", "2", "]", "=", "rgb", "[", "1", ":", ":", "2", ",", "0", ":", ":", "2", ",", "1", "]", "\n", "bayer", "[", "0", ":", ":", "2", ",", "1", ":", ":", "2", "]", "=", "rgb", "[", "0", ":", ":", "2", ",", "1", ":", ":", "2", ",", "1", "]", "\n", "bayer", "[", "1", ":", ":", "2", ",", "1", ":", ":", "2", "]", "=", "rgb", "[", "1", ":", ":", "2", ",", "1", ":", ":", "2", ",", "2", "]", "\n", "return", "bayer", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.new_shape": [[48, 53], ["len"], "methods", ["None"], ["", "def", "new_shape", "(", "self", ",", "shape", ")", ":", "\n", "        ", "if", "len", "(", "shape", ")", "==", "2", ":", "\n", "            ", "return", "[", "shape", "[", "0", "]", "/", "2", "*", "2", ",", "shape", "[", "1", "]", "/", "2", "*", "2", "]", "\n", "", "else", ":", "\n", "            ", "return", "[", "shape", "[", "0", "]", ",", "shape", "[", "1", "]", "/", "2", "*", "2", ",", "shape", "[", "2", "]", "/", "2", "*", "2", ",", "shape", "[", "3", "]", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.load_test_data": [[54, 82], ["numpy.load", "numpy.load", "numpy.zeros", "range", "os.path.join", "os.path.join", "scipy.misc.imread().astype", "numpy.expand_dims", "range", "numpy.stack", "numpy.stack", "min", "min", "train_data.append", "isp_data.append", "scipy.misc.imread", "os.path.join"], "methods", ["None"], ["", "", "def", "load_test_data", "(", "self", ",", "batch_index", ")", ":", "\n", "        ", "train_data", "=", "[", "]", "\n", "isp_data", "=", "[", "]", "\n", "name_train", "=", "self", ".", "test_train_file", "[", "batch_index", "]", "\n", "name_train", "=", "name_train", "[", ":", "-", "3", "]", "\n", "name", "=", "name_train", "[", ":", "-", "5", "]", "+", "'.'", "\n", "scale", "=", "parameters", ".", "Scale", "\n", "train_img", "=", "np", ".", "load", "(", "os", ".", "path", ".", "join", "(", "self", ".", "testing_data_path", ",", "self", ".", "subfolder_trainingdata", ",", "name_train", "+", "'npy'", ")", ")", "\n", "ground_img", "=", "np", ".", "load", "(", "os", ".", "path", ".", "join", "(", "self", ".", "testing_data_path", ",", "self", ".", "subfolder_groundtruth", ",", "name", "+", "'npy'", ")", ")", "\n", "isp_img", "=", "imread", "(", "os", ".", "path", ".", "join", "(", "self", ".", "testing_data_path", ",", "self", ".", "subfolder_isp", ",", "name_train", "+", "'jpeg'", ")", ")", ".", "astype", "(", "np", ".", "float32", ")", "/", "255.", "\n", "h", "=", "train_img", ".", "shape", "[", "0", "]", "//", "2", "*", "2", "\n", "w", "=", "train_img", ".", "shape", "[", "1", "]", "//", "2", "*", "2", "\n", "train_img", "=", "np", ".", "expand_dims", "(", "train_img", ",", "axis", "=", "2", ")", "[", ":", "h", ",", ":", "w", ",", ":", "]", "\n", "ground_img", "=", "ground_img", "[", ":", "scale", "*", "h", ",", ":", "scale", "*", "w", ",", ":", "]", "\n", "isp_img", "=", "isp_img", "[", ":", "h", ",", ":", "w", ",", ":", "]", "\n", "mask", "=", "np", ".", "zeros", "(", "shape", "=", "[", "scale", "*", "h", ",", "scale", "*", "w", ",", "3", "]", ")", "\n", "for", "i", "in", "range", "(", "0", ",", "h", "-", "self", ".", "crop_size", "+", "self", ".", "test_step", ",", "self", ".", "test_step", ")", ":", "\n", "            ", "for", "j", "in", "range", "(", "0", ",", "w", "-", "self", ".", "crop_size", "+", "self", ".", "test_step", ",", "self", ".", "test_step", ")", ":", "\n", "                ", "i", "=", "min", "(", "h", "-", "self", ".", "crop_size", ",", "i", ")", "\n", "j", "=", "min", "(", "w", "-", "self", ".", "crop_size", ",", "j", ")", "\n", "ie", "=", "i", "+", "self", ".", "crop_size", "\n", "je", "=", "j", "+", "self", ".", "crop_size", "\n", "mask", "[", "scale", "*", "i", ":", "scale", "*", "ie", ",", "scale", "*", "j", ":", "scale", "*", "je", ",", ":", "]", "+=", "1", "\n", "t_data", "=", "train_img", "[", "i", ":", "ie", ",", "j", ":", "je", ",", ":", "]", "\n", "i_data", "=", "isp_img", "[", "i", ":", "ie", ",", "j", ":", "je", ",", ":", "]", "\n", "train_data", ".", "append", "(", "t_data", ")", "\n", "isp_data", ".", "append", "(", "i_data", ")", "\n", "", "", "return", "np", ".", "stack", "(", "train_data", ")", ",", "np", ".", "stack", "(", "isp_data", ")", ",", "h", ",", "w", ",", "name_train", ",", "ground_img", ",", "mask", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.load_test_real": [[83, 112], ["rawpy.imread", "rawpy.imread.postprocess", "tools.tools.bayerprocess", "rawpy.imread.postprocess", "tools.tools.gamma", "numpy.zeros", "range", "tools.tools.imgsave", "os.path.join", "name_train.split", "numpy.expand_dims", "range", "numpy.stack", "numpy.stack", "min", "min", "train_data.append", "isp_data.append"], "methods", ["home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.bayerprocess", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.gamma", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.imgsave"], ["", "def", "load_test_real", "(", "self", ",", "batch_index", ")", ":", "\n", "        ", "train_data", "=", "[", "]", "\n", "isp_data", "=", "[", "]", "\n", "name_train", "=", "self", ".", "test_train_file", "[", "batch_index", "]", "\n", "raw", "=", "rawpy", ".", "imread", "(", "os", ".", "path", ".", "join", "(", "self", ".", "real_data_path", ",", "name_train", ")", ")", "\n", "rgb", "=", "raw", ".", "postprocess", "(", "gamma", "=", "(", "1", ",", "1", ")", ",", "user_wb", "=", "[", "1", ",", "1", ",", "1", ",", "1", "]", ",", "output_bps", "=", "16", ",", "output_color", "=", "rawpy", ".", "ColorSpace", ".", "raw", ",", "\n", "demosaic_algorithm", "=", "rawpy", ".", "DemosaicAlgorithm", ".", "AHD", ",", "no_auto_scale", "=", "False", ",", "no_auto_bright", "=", "True", ")", "\n", "name_train", "=", "name_train", ".", "split", "(", "'.'", ")", "[", "0", "]", "\n", "train_img", "=", "self", ".", "bayerprocess", "(", "rgb", "=", "rgb", ")", "\n", "isp_ungamma", "=", "raw", ".", "postprocess", "(", "gamma", "=", "(", "1", ",", "1", ")", ")", "\n", "isp_img", "=", "self", ".", "gamma", "(", "isp_ungamma", ")", "\n", "h", "=", "train_img", ".", "shape", "[", "0", "]", "//", "2", "*", "2", "\n", "w", "=", "train_img", ".", "shape", "[", "1", "]", "//", "2", "*", "2", "\n", "train_img", "=", "np", ".", "expand_dims", "(", "train_img", ",", "axis", "=", "2", ")", "[", ":", "h", ",", ":", "w", ",", ":", "]", "\n", "isp_img", "=", "isp_img", "[", ":", "h", ",", ":", "w", ",", ":", "]", "\n", "mask", "=", "np", ".", "zeros", "(", "shape", "=", "[", "2", "*", "h", ",", "2", "*", "w", ",", "3", "]", ")", "\n", "for", "i", "in", "range", "(", "0", ",", "h", "-", "self", ".", "crop_size", "+", "self", ".", "test_step", ",", "self", ".", "test_step", ")", ":", "\n", "            ", "for", "j", "in", "range", "(", "0", ",", "w", "-", "self", ".", "crop_size", "+", "self", ".", "test_step", ",", "self", ".", "test_step", ")", ":", "\n", "                ", "i", "=", "min", "(", "h", "-", "self", ".", "crop_size", ",", "i", ")", "\n", "j", "=", "min", "(", "w", "-", "self", ".", "crop_size", ",", "j", ")", "\n", "ie", "=", "i", "+", "self", ".", "crop_size", "\n", "je", "=", "j", "+", "self", ".", "crop_size", "\n", "mask", "[", "2", "*", "i", ":", "2", "*", "ie", ",", "2", "*", "j", ":", "2", "*", "je", ",", ":", "]", "+=", "1", "\n", "t_data", "=", "train_img", "[", "i", ":", "ie", ",", "j", ":", "je", ",", ":", "]", "\n", "i_data", "=", "isp_img", "[", "i", ":", "ie", ",", "j", ":", "je", ",", ":", "]", "\n", "train_data", ".", "append", "(", "t_data", ")", "\n", "isp_data", ".", "append", "(", "i_data", ")", "\n", "", "", "self", ".", "imgsave", "(", "isp_img", "*", "255.", ",", "self", ".", "epoch", ",", "'{}_lowresolution.'", ".", "format", "(", "name_train", ")", ")", "\n", "return", "np", ".", "stack", "(", "train_data", ")", ",", "np", ".", "stack", "(", "isp_data", ")", ",", "h", ",", "w", ",", "name_train", ",", "mask", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.merge": [[113, 127], ["numpy.zeros", "range", "range", "mask.astype", "numpy.maximum", "min", "min", "numpy.minimum"], "methods", ["None"], ["", "def", "merge", "(", "self", ",", "res_list", ",", "h", ",", "w", ",", "mask", ")", ":", "\n", "        ", "scale", "=", "parameters", ".", "Scale", "\n", "res", "=", "np", ".", "zeros", "(", "[", "scale", "*", "h", ",", "scale", "*", "w", ",", "3", "]", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "index", "=", "0", "\n", "for", "i", "in", "range", "(", "0", ",", "scale", "*", "(", "h", "-", "self", ".", "crop_size", "+", "self", ".", "test_step", ")", ",", "scale", "*", "self", ".", "test_step", ")", ":", "\n", "            ", "for", "j", "in", "range", "(", "0", ",", "scale", "*", "(", "w", "-", "self", ".", "crop_size", "+", "self", ".", "test_step", ")", ",", "scale", "*", "self", ".", "test_step", ")", ":", "\n", "                ", "i", "=", "min", "(", "scale", "*", "(", "h", "-", "self", ".", "crop_size", ")", ",", "i", ")", "\n", "j", "=", "min", "(", "scale", "*", "(", "w", "-", "self", ".", "crop_size", ")", ",", "j", ")", "\n", "ie", "=", "i", "+", "scale", "*", "self", ".", "crop_size", "\n", "je", "=", "j", "+", "scale", "*", "self", ".", "crop_size", "\n", "res", "[", "i", ":", "ie", ",", "j", ":", "je", ",", ":", "]", "+=", "res_list", "[", "index", ",", ":", "ie", "-", "i", ",", ":", "je", "-", "j", ",", ":", "]", "\n", "index", "+=", "1", "\n", "", "", "res", "=", "res", "/", "mask", ".", "astype", "(", "np", ".", "float32", ")", "\n", "return", "np", ".", "maximum", "(", "np", ".", "minimum", "(", "res", ",", "1.", ")", ",", "0.", ")", "*", "255.", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.load_train_data": [[128, 156], ["os.path.split", "numpy.expand_dims", "numpy.load", "random.choice", "random.choice", "train_data.append", "ground_data.append", "isp_data.append", "numpy.stack", "numpy.stack", "numpy.stack", "numpy.load", "os.path.join", "scipy.misc.imread().astype", "range", "range", "os.path.join", "scipy.misc.imread", "os.path.join"], "methods", ["None"], ["", "def", "load_train_data", "(", "self", ",", "batch_index", ")", ":", "\n", "        ", "train_data", "=", "[", "]", "\n", "ground_data", "=", "[", "]", "\n", "isp_data", "=", "[", "]", "\n", "for", "i", "in", "batch_index", ":", "\n", "            ", "_", ",", "name_train", "=", "os", ".", "path", ".", "split", "(", "self", ".", "training_train_file", "[", "i", "]", ")", "\n", "name_train", "=", "name_train", "[", ":", "-", "3", "]", "\n", "name", "=", "name_train", "[", ":", "-", "5", "]", "+", "'.'", "\n", "\n", "train_img", "=", "np", ".", "expand_dims", "(", "np", ".", "load", "(", "os", ".", "path", ".", "join", "(", "self", ".", "training_data_path", ",", "\n", "self", ".", "subfolder_trainingdata", ",", "name_train", "+", "'npy'", ")", ")", ",", "axis", "=", "2", ")", "\n", "ground_img", "=", "np", ".", "load", "(", "os", ".", "path", ".", "join", "(", "self", ".", "training_data_path", ",", "\n", "self", ".", "subfolder_groundtruth", ",", "name", "\n", "+", "'npy'", ")", ")", "\n", "isp_img", "=", "imread", "(", "os", ".", "path", ".", "join", "(", "self", ".", "training_data_path", ",", "\n", "self", ".", "subfolder_isp", ",", "name_train", "+", "'jpeg'", ")", ")", ".", "astype", "(", "np", ".", "float32", ")", "/", "255.", "\n", "h", ",", "w", ",", "_", "=", "train_img", ".", "shape", "\n", "\n", "hi", "=", "random", ".", "choice", "(", "range", "(", "0", ",", "h", "-", "self", ".", "crop_size", ",", "2", ")", ")", "\n", "wi", "=", "random", ".", "choice", "(", "range", "(", "0", ",", "w", "-", "self", ".", "crop_size", ",", "2", ")", ")", "\n", "train_img", "=", "train_img", "[", "hi", ":", "hi", "+", "self", ".", "crop_size", ",", "wi", ":", "wi", "+", "self", ".", "crop_size", "]", "\n", "ground_img", "=", "ground_img", "[", "2", "*", "hi", ":", "2", "*", "(", "hi", "+", "self", ".", "crop_size", ")", ",", "2", "*", "wi", ":", "2", "*", "(", "wi", "+", "self", ".", "crop_size", ")", "]", "\n", "isp_img", "=", "isp_img", "[", "hi", ":", "hi", "+", "self", ".", "crop_size", ",", "wi", ":", "wi", "+", "self", ".", "crop_size", "]", "\n", "\n", "train_data", ".", "append", "(", "train_img", ")", "\n", "ground_data", ".", "append", "(", "ground_img", ")", "\n", "isp_data", ".", "append", "(", "isp_img", ")", "\n", "", "return", "np", ".", "stack", "(", "train_data", ")", ",", "np", ".", "stack", "(", "ground_data", ")", ",", "np", ".", "stack", "(", "isp_data", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.write_test": [[157, 170], ["str", "os.path.join", "open", "open.write", "open.close", "os.path.join", "open.write", "open.write", "open.write", "float", "float"], "methods", ["home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.write", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.write", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.write", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.write"], ["", "def", "write_test", "(", "self", ",", "epoch", ",", "**", "kwargs", ")", ":", "\n", "        ", "epoch", "=", "str", "(", "epoch", ")", "\n", "path", "=", "os", ".", "path", ".", "join", "(", "self", ".", "result_path", ",", "epoch", ",", "self", ".", "test_image_folder", ")", "\n", "record", "=", "open", "(", "os", ".", "path", ".", "join", "(", "path", ",", "self", ".", "file_report", ")", ",", "'a+'", ")", "\n", "for", "key", "in", "[", "'name'", ",", "'testing_sad_loss'", ",", "'testing_psnr_loss'", "]", ":", "\n", "            ", "if", "key", "in", "kwargs", "and", "key", "==", "'name'", ":", "\n", "                ", "record", ".", "write", "(", "'name: %s\\t'", "%", "kwargs", "[", "key", "]", ")", "\n", "", "elif", "key", "in", "kwargs", "and", "key", "==", "'testing_sad_loss'", ":", "\n", "                ", "record", ".", "write", "(", "'testing_sad_loss: %.6f\\t'", "%", "float", "(", "kwargs", "[", "key", "]", ")", ")", "\n", "", "elif", "key", "in", "kwargs", "and", "key", "==", "'testing_psnr_loss'", ":", "\n", "                ", "record", ".", "write", "(", "'testing_psnr_loss: %.6f\\t'", "%", "float", "(", "kwargs", "[", "key", "]", ")", ")", "\n", "", "", "record", ".", "write", "(", "'\\n'", ")", "\n", "record", ".", "close", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.write": [[171, 190], ["str", "open", "open.write", "kwargs.keys", "open.write", "open.close", "os.path.join", "open.write", "open.write", "open.write", "open.write", "open.write", "open.write", "float", "float", "float", "float", "float", "float"], "methods", ["home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.write", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.write", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.write", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.write", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.write", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.write", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.write", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.write"], ["", "def", "write", "(", "self", ",", "epoch", ",", "**", "kwargs", ")", ":", "\n", "        ", "epoch", "=", "str", "(", "epoch", ")", "\n", "record", "=", "open", "(", "os", ".", "path", ".", "join", "(", "self", ".", "result_path", ",", "self", ".", "file_report", ")", ",", "'a+'", ")", "\n", "record", ".", "write", "(", "'epoch_num: %s\\t'", "%", "epoch", ")", "\n", "keys", "=", "kwargs", ".", "keys", "(", ")", "\n", "if", "'training_sad_loss'", "in", "keys", ":", "\n", "            ", "record", ".", "write", "(", "'train_sad_loss: %.6f\\t'", "%", "float", "(", "kwargs", "[", "'training_sad_loss'", "]", ")", ")", "\n", "", "if", "'training_psnr_loss'", "in", "keys", ":", "\n", "            ", "record", ".", "write", "(", "'train_psnr_loss: %.6f\\t'", "%", "float", "(", "kwargs", "[", "'training_psnr_loss'", "]", ")", ")", "\n", "", "if", "'training_ssim_loss'", "in", "keys", ":", "\n", "            ", "record", ".", "write", "(", "'train_ssim_loss: %.6f\\t'", "%", "float", "(", "kwargs", "[", "'training_ssim_loss'", "]", ")", ")", "\n", "", "if", "'testing_sad_loss'", "in", "keys", ":", "\n", "            ", "record", ".", "write", "(", "'test_sad_loss: %.6f\\t'", "%", "float", "(", "kwargs", "[", "'testing_sad_loss'", "]", ")", ")", "\n", "", "if", "'testing_psnr_loss'", "in", "keys", ":", "\n", "            ", "record", ".", "write", "(", "'test_psnr_loss: %.6f\\t'", "%", "float", "(", "kwargs", "[", "'testing_psnr_loss'", "]", ")", ")", "\n", "", "if", "'testing_ssim_loss'", "in", "keys", ":", "\n", "            ", "record", ".", "write", "(", "'test_ssim_loss: %.6f\\t'", "%", "float", "(", "kwargs", "[", "'testing_ssim_loss'", "]", ")", ")", "\n", "", "record", ".", "write", "(", "'\\n'", ")", "\n", "record", ".", "close", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.imgsave": [[191, 200], ["str", "scipy.misc.imsave", "os.path.isdir", "os.mkdir", "len", "img.reshape.reshape.reshape", "os.path.join", "numpy.uint8", "os.path.join", "os.path.isdir", "os.mkdir", "os.path.join", "os.path.join", "os.path.join"], "methods", ["None"], ["", "def", "imgsave", "(", "self", ",", "img", ",", "epoch", ",", "name", ")", ":", "\n", "        ", "epoch", "=", "str", "(", "epoch", ")", "\n", "if", "not", "os", ".", "path", ".", "isdir", "(", "os", ".", "path", ".", "join", "(", "self", ".", "result_path", ",", "epoch", ",", "self", ".", "test_image_folder", ")", ")", ":", "\n", "            ", "if", "not", "os", ".", "path", ".", "isdir", "(", "os", ".", "path", ".", "join", "(", "self", ".", "result_path", ",", "epoch", ")", ")", ":", "\n", "                ", "os", ".", "mkdir", "(", "os", ".", "path", ".", "join", "(", "self", ".", "result_path", ",", "epoch", ")", ")", "\n", "", "os", ".", "mkdir", "(", "os", ".", "path", ".", "join", "(", "self", ".", "result_path", ",", "epoch", ",", "self", ".", "test_image_folder", ")", ")", "\n", "", "if", "len", "(", "img", ".", "shape", ")", "==", "4", ":", "\n", "            ", "img", "=", "img", ".", "reshape", "(", "[", "img", ".", "shape", "[", "1", "]", ",", "img", ".", "shape", "[", "2", "]", ",", "img", ".", "shape", "[", "3", "]", "]", ")", "\n", "", "imsave", "(", "os", ".", "path", ".", "join", "(", "self", ".", "result_path", ",", "epoch", ",", "self", ".", "test_image_folder", ",", "name", "+", "'png'", ")", ",", "np", ".", "uint8", "(", "img", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.parameters.check_and_make_folder": [[90, 93], ["os.path.isdir", "os.mkdir"], "function", ["None"], ["", "def", "check_and_make_folder", "(", "path", ")", ":", "\n", "    ", "if", "not", "os", ".", "path", ".", "isdir", "(", "path", ")", ":", "\n", "        ", "os", ".", "mkdir", "(", "path", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model_tools.lrelu": [[14, 17], ["tensorflow.maximum"], "methods", ["None"], ["    ", "@", "staticmethod", "\n", "def", "lrelu", "(", "x", ",", "coef", "=", "0.2", ")", ":", "\n", "        ", "return", "tf", ".", "maximum", "(", "x", ",", "coef", "*", "x", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model_tools.l1_loss": [[18, 21], ["tensorflow.reduce_mean", "tensorflow.abs"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "l1_loss", "(", "x", ",", "gt", ")", ":", "\n", "        ", "return", "tf", ".", "reduce_mean", "(", "tf", ".", "abs", "(", "x", "-", "gt", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model_tools.l2_loss": [[22, 25], ["tensorflow.reduce_mean", "tensorflow.square"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "l2_loss", "(", "x", ",", "gt", ")", ":", "\n", "        ", "return", "tf", ".", "reduce_mean", "(", "tf", ".", "square", "(", "x", "-", "gt", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model_tools.pack_raw": [[26, 48], ["range", "tensorflow.stack", "tensorflow.concat", "output.append", "x.get_shape().as_list", "x.get_shape"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "pack_raw", "(", "x", ")", ":", "\n", "        ", "'''\n        input is a raw image or rgb image, and \n        :param x: input image, raw or rgb\n        :return: a four channel image with r, g, g, b\n        '''", "\n", "img_shape", "=", "x", ".", "shape", "\n", "H", "=", "img_shape", "[", "1", "]", "\n", "W", "=", "img_shape", "[", "2", "]", "\n", "output", "=", "[", "]", "\n", "\n", "for", "i", "in", "range", "(", "x", ".", "get_shape", "(", ")", ".", "as_list", "(", ")", "[", "0", "]", ")", ":", "\n", "            ", "im", "=", "x", "[", "i", ",", ":", ",", ":", ",", ":", "]", "\n", "out", "=", "tf", ".", "concat", "(", "(", "im", "[", "0", ":", "H", ":", "2", ",", "0", ":", "W", ":", "2", ",", ":", "]", ",", "\n", "im", "[", "0", ":", "H", ":", "2", ",", "1", ":", "W", ":", "2", ",", ":", "]", ",", "\n", "im", "[", "1", ":", "H", ":", "2", ",", "0", ":", "W", ":", "2", ",", ":", "]", ",", "\n", "im", "[", "1", ":", "H", ":", "2", ",", "1", ":", "W", ":", "2", ",", ":", "]", "\n", ")", ",", "axis", "=", "2", ")", "\n", "\n", "output", ".", "append", "(", "out", ")", "\n", "", "return", "tf", ".", "stack", "(", "output", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model_tools.add_SE": [[49, 59], ["input.get_shape().as_list", "tensorflow.contrib.slim.avg_pool2d", "tensorflow.contrib.slim.fully_connected", "tensorflow.contrib.slim.fully_connected", "input.get_shape"], "methods", ["None"], ["", "@", "staticmethod", "\n", "def", "add_SE", "(", "input", ",", "reuse", ")", ":", "\n", "        ", "_", ",", "h", ",", "w", ",", "c", "=", "input", ".", "get_shape", "(", ")", ".", "as_list", "(", ")", "\n", "next_0", "=", "slim", ".", "avg_pool2d", "(", "inputs", "=", "input", ",", "kernel_size", "=", "(", "h", ",", "w", ")", ",", "stride", "=", "1", ",", "scope", "=", "'SE_pooling'", ")", "\n", "next_fc0", "=", "slim", ".", "fully_connected", "(", "inputs", "=", "next_0", ",", "num_outputs", "=", "c", ",", "scope", "=", "'next_fc0'", ",", "reuse", "=", "reuse", ",", "\n", "activation_fn", "=", "nn", ".", "relu", ")", "\n", "next_fc1", "=", "slim", ".", "fully_connected", "(", "inputs", "=", "next_fc0", ",", "num_outputs", "=", "c", ",", "scope", "=", "'next_fc1'", ",", "reuse", "=", "reuse", ",", "\n", "activation_fn", "=", "nn", ".", "sigmoid", ")", "\n", "out", "=", "next_fc1", "*", "input", "\n", "return", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model_tools.block": [[60, 75], ["tensorflow.variable_scope", "range", "x.get_shape().as_list", "tensorflow.contrib.slim.conv2d", "model_tools.add_SE", "tensorflow.concat", "tensorflow.contrib.slim.conv2d", "conv_in.append", "x.get_shape", "tensorflow.concat"], "methods", ["home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model_tools.add_SE"], ["", "@", "staticmethod", "\n", "def", "block", "(", "x", ",", "growth_rate", ",", "layers_per_block", ",", "kernel_size", ",", "reuse", ",", "scope_name", ")", ":", "\n", "        ", "with", "tf", ".", "variable_scope", "(", "scope_name", ",", "reuse", "=", "reuse", ")", ":", "\n", "            ", "conv_in", "=", "[", "x", "]", "\n", "for", "i", "in", "range", "(", "1", ",", "layers_per_block", "+", "1", ")", ":", "\n", "                ", "next_layer", "=", "tf", ".", "concat", "(", "conv_in", ",", "axis", "=", "3", ")", "\n", "conv", "=", "slim", ".", "conv2d", "(", "inputs", "=", "next_layer", ",", "num_outputs", "=", "growth_rate", ",", "kernel_size", "=", "kernel_size", ",", "\n", "rate", "=", "1", ",", "scope", "=", "'conv_%d'", "%", "i", ",", "reuse", "=", "reuse", ",", "activation_fn", "=", "model_tools", ".", "lrelu", ")", "\n", "conv_in", ".", "append", "(", "conv", ")", "\n", "", "_", ",", "_", ",", "_", ",", "c", "=", "x", ".", "get_shape", "(", ")", ".", "as_list", "(", ")", "\n", "dense_next", "=", "slim", ".", "conv2d", "(", "inputs", "=", "tf", ".", "concat", "(", "conv_in", ",", "axis", "=", "3", ")", ",", "num_outputs", "=", "c", ",", "kernel_size", "=", "1", ",", "\n", "rate", "=", "1", ",", "scope", "=", "'conv_bottle'", ",", "reuse", "=", "reuse", ",", "activation_fn", "=", "None", ")", "\n", "dense", "=", "model_tools", ".", "add_SE", "(", "dense_next", ",", "reuse", "=", "reuse", ")", "\n", "out", "=", "dense", "+", "x", "\n", "return", "out", ",", "out", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model.__init__": [[79, 90], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "input_img", ",", "input_isp", ",", "gt_img", ",", "reuse", ")", ":", "\n", "        ", "self", ".", "input_img", "=", "input_img", "\n", "self", ".", "input_isp", "=", "input_isp", "\n", "self", ".", "gt_img", "=", "gt_img", "\n", "self", ".", "reuse", "=", "reuse", "\n", "self", ".", "growth_rate", "=", "GROWTH_RATE", "\n", "self", ".", "kernel_size_dense", "=", "KERNEL_SIZE_DENSE", "\n", "self", ".", "kernel_size_pool", "=", "KERNEL_SIZE_POOLING", "\n", "self", ".", "kernel_size", "=", "KERNEL_SIZE_NORMAL", "\n", "self", ".", "layers_per_block", "=", "LAYER_PER_BLOCK_DENSE", "\n", "self", ".", "bottle_output", "=", "BOTTLE_OUTPUT", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model.branch_1": [[91, 146], ["tensorflow.variable_scope", "model_tools.pack_raw", "tensorflow.contrib.slim.conv2d", "model_tools.block", "tensorflow.contrib.slim.conv2d", "model_tools.block", "model_tools.block", "tensorflow.contrib.slim.conv2d", "tensorflow.concat", "tensorflow.contrib.slim.conv2d_transpose", "tensorflow.contrib.slim.conv2d", "model_tools.block", "tensorflow.contrib.slim.conv2d", "tensorflow.contrib.slim.conv2d", "tensorflow.concat", "tensorflow.depth_to_space", "tensorflow.depth_to_space", "tensorflow.depth_to_space", "tensorflow.depth_to_space", "tensorflow.depth_to_space", "tensorflow.depth_to_space", "tensorflow.concat", "tensorflow.concat", "tensorflow.depth_to_space", "tensorflow.depth_to_space", "tensorflow.depth_to_space"], "methods", ["home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model_tools.pack_raw", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model_tools.block", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model_tools.block", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model_tools.block", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model_tools.block"], ["", "def", "branch_1", "(", "self", ")", ":", "\n", "################################################################################################################", "\n", "####    Branch_1_0: Input: RawImage Output: fc1: bottle layer output just before  deconv                    ####", "\n", "####                                        helper1: concat of feature map with size H*W for final deconv   ####", "\n", "################################################################################################################", "\n", "        ", "with", "tf", ".", "variable_scope", "(", "'branch_1_0'", ",", "reuse", "=", "self", ".", "reuse", ")", ":", "\n", "            ", "pack_img", "=", "model_tools", ".", "pack_raw", "(", "self", ".", "input_img", ")", "\n", "\n", "conv_1_0_low", "=", "slim", ".", "conv2d", "(", "inputs", "=", "pack_img", ",", "num_outputs", "=", "128", ",", "kernel_size", "=", "self", ".", "kernel_size", ",", "\n", "scope", "=", "'conv_1_0_low'", ",", "reuse", "=", "self", ".", "reuse", ",", "activation_fn", "=", "model_tools", ".", "lrelu", ")", "\n", "\n", "dense_1_0", ",", "next_in_0", "=", "model_tools", ".", "block", "(", "conv_1_0_low", ",", "self", ".", "growth_rate", ",", "self", ".", "layers_per_block", ",", "\n", "self", ".", "kernel_size_dense", ",", "self", ".", "reuse", ",", "'dense_1_0'", ")", "\n", "pool_in_0", "=", "slim", ".", "conv2d", "(", "inputs", "=", "next_in_0", ",", "num_outputs", "=", "128", ",", "kernel_size", "=", "self", ".", "kernel_size", ",", "\n", "stride", "=", "2", ",", "scope", "=", "'pool_in_0'", ",", "reuse", "=", "self", ".", "reuse", ",", "activation_fn", "=", "model_tools", ".", "lrelu", ")", "\n", "dense_1_1", ",", "next_in_1", "=", "model_tools", ".", "block", "(", "pool_in_0", ",", "self", ".", "growth_rate", ",", "self", ".", "layers_per_block", ",", "\n", "self", ".", "kernel_size_dense", ",", "self", ".", "reuse", ",", "'dense_1_1'", ")", "\n", "dense_1_2", ",", "next_in_2", "=", "model_tools", ".", "block", "(", "next_in_1", ",", "self", ".", "growth_rate", ",", "self", ".", "layers_per_block", ",", "\n", "self", ".", "kernel_size_dense", ",", "self", ".", "reuse", ",", "'dense_1_2'", ")", "\n", "bottle_1_0", "=", "slim", ".", "conv2d", "(", "inputs", "=", "tf", ".", "concat", "(", "[", "dense_1_2", ",", "dense_1_1", ",", "pool_in_0", "]", ",", "axis", "=", "3", ")", ",", "\n", "num_outputs", "=", "128", ",", "kernel_size", "=", "1", ",", "scope", "=", "'bottle_1_0'", ",", "reuse", "=", "self", ".", "reuse", ",", "\n", "activation_fn", "=", "model_tools", ".", "lrelu", ")", "\n", "fc11", "=", "bottle_1_0", "\n", "helper1", "=", "tf", ".", "concat", "(", "[", "conv_1_0_low", ",", "dense_1_0", "]", ",", "axis", "=", "3", ")", "\n", "################################################################################################################", "\n", "####    Branch_1_0: Input: RawImage Output: fc1: bottle layer output just before  deconv                    ####", "\n", "####                                        helper1: concat of feature map with size H*W for final deconv   ####", "\n", "################################################################################################################", "\n", "# with tf.variable_scope('branch_1_1', reuse=self.reuse):", "\n", "deconv_1_1_0", "=", "slim", ".", "conv2d_transpose", "(", "inputs", "=", "fc11", ",", "num_outputs", "=", "128", ",", "kernel_size", "=", "[", "4", ",", "4", "]", ",", "stride", "=", "2", ",", "\n", "reuse", "=", "self", ".", "reuse", ",", "scope", "=", "'deconv_1_1_0'", ",", "\n", "activation_fn", "=", "model_tools", ".", "lrelu", ")", "\n", "conv_1_1_0", "=", "slim", ".", "conv2d", "(", "inputs", "=", "deconv_1_1_0", ",", "num_outputs", "=", "128", ",", "kernel_size", "=", "self", ".", "kernel_size", ",", "\n", "scope", "=", "'conv_1_1_0'", ",", "reuse", "=", "self", ".", "reuse", ",", "activation_fn", "=", "model_tools", ".", "lrelu", ")", "\n", "dense_1_3", ",", "next_in_0", "=", "model_tools", ".", "block", "(", "conv_1_1_0", ",", "self", ".", "growth_rate", ",", "self", ".", "layers_per_block", ",", "\n", "self", ".", "kernel_size_dense", ",", "self", ".", "reuse", ",", "'dense_1_3'", ")", "\n", "bottle_1_1", "=", "slim", ".", "conv2d", "(", "inputs", "=", "tf", ".", "concat", "(", "[", "helper1", ",", "conv_1_1_0", ",", "dense_1_3", "]", ",", "axis", "=", "3", ")", ",", "\n", "num_outputs", "=", "self", ".", "bottle_output", ",", "kernel_size", "=", "1", ",", "scope", "=", "'bottle_1_1'", ",", "\n", "reuse", "=", "self", ".", "reuse", ",", "\n", "activation_fn", "=", "model_tools", ".", "lrelu", ")", "\n", "fc12", "=", "bottle_1_1", "\n", "#conv_1_1_1 = bottle_1_1", "\n", "conv_1_1_1", "=", "slim", ".", "conv2d", "(", "inputs", "=", "bottle_1_1", ",", "num_outputs", "=", "12", "*", "Scale", "**", "2", ",", "kernel_size", "=", "self", ".", "kernel_size", ",", "\n", "scope", "=", "'conv_1_1_1'", ",", "\n", "reuse", "=", "self", ".", "reuse", ",", "activation_fn", "=", "model_tools", ".", "lrelu", ")", "\n", "if", "Scale", "==", "4", ":", "\n", "                ", "conv_r", "=", "tf", ".", "depth_to_space", "(", "conv_1_1_1", "[", "...", ",", ":", "4", "*", "Scale", "**", "2", "]", ",", "Scale", "*", "2", ")", "\n", "conv_g", "=", "tf", ".", "depth_to_space", "(", "conv_1_1_1", "[", "...", ",", "4", "*", "Scale", "**", "2", ":", "8", "*", "Scale", "**", "2", "]", ",", "Scale", "*", "2", ")", "\n", "conv_b", "=", "tf", ".", "depth_to_space", "(", "conv_1_1_1", "[", "...", ",", "8", "*", "Scale", "**", "2", ":", "]", ",", "Scale", "*", "2", ")", "\n", "", "else", ":", "\n", "                ", "conv_r", "=", "tf", ".", "depth_to_space", "(", "tf", ".", "depth_to_space", "(", "conv_1_1_1", "[", "...", ",", ":", "4", "*", "Scale", "**", "2", "]", ",", "2", ")", ",", "Scale", ")", "\n", "conv_g", "=", "tf", ".", "depth_to_space", "(", "tf", ".", "depth_to_space", "(", "conv_1_1_1", "[", "...", ",", "4", "*", "Scale", "**", "2", ":", "8", "*", "Scale", "**", "2", "]", ",", "Scale", ")", ",", "Scale", ")", "\n", "conv_b", "=", "tf", ".", "depth_to_space", "(", "tf", ".", "depth_to_space", "(", "conv_1_1_1", "[", "...", ",", "8", "*", "Scale", "**", "2", ":", "]", ",", "Scale", ")", ",", "Scale", ")", "\n", "", "rgb", "=", "tf", ".", "concat", "(", "[", "conv_r", ",", "conv_g", ",", "conv_b", "]", ",", "axis", "=", "3", ")", "\n", "return", "rgb", ",", "fc11", ",", "fc12", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model.branch_2_0": [[147, 161], ["tensorflow.variable_scope", "tensorflow.contrib.slim.conv2d", "tensorflow.contrib.slim.avg_pool2d", "tensorflow.contrib.slim.conv2d", "tensorflow.contrib.slim.avg_pool2d", "tensorflow.contrib.slim.conv2d", "tensorflow.concat"], "methods", ["None"], ["", "", "def", "branch_2_0", "(", "self", ")", ":", "\n", "        ", "with", "tf", ".", "variable_scope", "(", "'branch_2_0'", ",", "reuse", "=", "self", ".", "reuse", ")", ":", "\n", "            ", "conv_2_0_0", "=", "slim", ".", "conv2d", "(", "inputs", "=", "self", ".", "input_isp", ",", "num_outputs", "=", "128", ",", "kernel_size", "=", "self", ".", "kernel_size", ",", "\n", "reuse", "=", "self", ".", "reuse", ",", "scope", "=", "'conv_2_0_0'", ",", "activation_fn", "=", "model_tools", ".", "lrelu", ")", "\n", "pool_2_0_0", "=", "slim", ".", "avg_pool2d", "(", "inputs", "=", "conv_2_0_0", ",", "kernel_size", "=", "2", ",", "scope", "=", "'pool_2_0_0'", ")", "\n", "\n", "conv_2_0_1", "=", "slim", ".", "conv2d", "(", "inputs", "=", "pool_2_0_0", ",", "num_outputs", "=", "128", ",", "kernel_size", "=", "self", ".", "kernel_size", ",", "\n", "reuse", "=", "self", ".", "reuse", ",", "scope", "=", "'conv_2_0_1'", ",", "activation_fn", "=", "model_tools", ".", "lrelu", ")", "\n", "pool_2_0_1", "=", "slim", ".", "avg_pool2d", "(", "inputs", "=", "conv_2_0_1", ",", "kernel_size", "=", "2", ",", "scope", "=", "'pool_2_0_1'", ")", "\n", "\n", "conv_2_0_2", "=", "slim", ".", "conv2d", "(", "inputs", "=", "pool_2_0_1", ",", "num_outputs", "=", "128", ",", "kernel_size", "=", "self", ".", "kernel_size", ",", "\n", "reuse", "=", "self", ".", "reuse", ",", "scope", "=", "'conv_2_0_2'", ",", "activation_fn", "=", "model_tools", ".", "lrelu", ")", "\n", "fc21", "=", "tf", ".", "concat", "(", "[", "conv_2_0_2", ",", "pool_2_0_1", "]", ",", "axis", "=", "3", ")", "\n", "return", "fc21", ",", "pool_2_0_0", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model.branch_2_1": [[162, 173], ["tensorflow.variable_scope", "tensorflow.contrib.slim.conv2d", "tensorflow.contrib.slim.conv2d_transpose", "tensorflow.contrib.slim.conv2d", "tensorflow.concat"], "methods", ["None"], ["", "", "def", "branch_2_1", "(", "self", ",", "fcin21", ",", "pool_2_0_0", ")", ":", "\n", "        ", "with", "tf", ".", "variable_scope", "(", "'branch_2_1'", ",", "reuse", "=", "self", ".", "reuse", ")", ":", "\n", "            ", "conv_2_1_2_nFF", "=", "slim", ".", "conv2d", "(", "inputs", "=", "fcin21", ",", "num_outputs", "=", "256", ",", "kernel_size", "=", "3", ",", "reuse", "=", "self", ".", "reuse", ",", "stride", "=", "1", ",", "\n", "scope", "=", "'conv_2_1_2_nFF'", ",", "activation_fn", "=", "model_tools", ".", "lrelu", ")", "\n", "deconv_2_1_0", "=", "slim", ".", "conv2d_transpose", "(", "inputs", "=", "conv_2_1_2_nFF", ",", "num_outputs", "=", "128", ",", "\n", "kernel_size", "=", "[", "4", ",", "4", "]", ",", "reuse", "=", "self", ".", "reuse", ",", "stride", "=", "2", ",", "scope", "=", "'deconv_2_0_0'", ",", "\n", "activation_fn", "=", "model_tools", ".", "lrelu", ")", "\n", "conv_2_1_3", "=", "slim", ".", "conv2d", "(", "inputs", "=", "deconv_2_1_0", ",", "num_outputs", "=", "128", ",", "kernel_size", "=", "self", ".", "kernel_size", ",", "\n", "reuse", "=", "self", ".", "reuse", ",", "scope", "=", "'conv_2_0_3'", ",", "activation_fn", "=", "model_tools", ".", "lrelu", ")", "\n", "fc22", "=", "tf", ".", "concat", "(", "[", "conv_2_1_3", ",", "pool_2_0_0", "]", ",", "axis", "=", "3", ")", "\n", "return", "fc22", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model.branch_2_2": [[174, 193], ["tensorflow.variable_scope", "tensorflow.contrib.slim.conv2d", "tensorflow.contrib.slim.conv2d_transpose", "tensorflow.contrib.slim.conv2d", "tensorflow.contrib.slim.conv2d_transpose", "tensorflow.contrib.slim.conv2d"], "methods", ["None"], ["", "", "def", "branch_2_2", "(", "self", ",", "fcin22", ")", ":", "\n", "        ", "with", "tf", ".", "variable_scope", "(", "'branch_2_2'", ",", "reuse", "=", "self", ".", "reuse", ")", ":", "\n", "            ", "conv_2_1_3_nFF", "=", "slim", ".", "conv2d", "(", "inputs", "=", "fcin22", ",", "num_outputs", "=", "256", ",", "kernel_size", "=", "3", ",", "reuse", "=", "self", ".", "reuse", ",", "stride", "=", "1", ",", "\n", "scope", "=", "'conv_2_1_3_nFF'", ",", "activation_fn", "=", "model_tools", ".", "lrelu", ")", "\n", "deconv_2_1_1", "=", "slim", ".", "conv2d_transpose", "(", "inputs", "=", "conv_2_1_3_nFF", ",", "num_outputs", "=", "128", ",", "\n", "kernel_size", "=", "[", "4", ",", "4", "]", ",", "reuse", "=", "self", ".", "reuse", ",", "stride", "=", "2", ",", "scope", "=", "'deconv_2_0_1'", ",", "\n", "activation_fn", "=", "model_tools", ".", "lrelu", ")", "\n", "conv_2_1_4", "=", "slim", ".", "conv2d", "(", "inputs", "=", "deconv_2_1_1", ",", "num_outputs", "=", "128", ",", "kernel_size", "=", "self", ".", "kernel_size", ",", "\n", "reuse", "=", "self", ".", "reuse", ",", "scope", "=", "'deconv_2_0_4'", ",", "activation_fn", "=", "model_tools", ".", "lrelu", ")", "\n", "\n", "deconv_2_1_2", "=", "slim", ".", "conv2d_transpose", "(", "inputs", "=", "conv_2_1_4", ",", "num_outputs", "=", "128", ",", "kernel_size", "=", "[", "4", ",", "4", "]", ",", "\n", "reuse", "=", "self", ".", "reuse", ",", "\n", "stride", "=", "Scale", ",", "scope", "=", "'deconv_2_0_2'", ",", "activation_fn", "=", "model_tools", ".", "lrelu", ")", "\n", "conv_2_1_5", "=", "slim", ".", "conv2d", "(", "inputs", "=", "deconv_2_1_2", ",", "num_outputs", "=", "12", ",", "kernel_size", "=", "self", ".", "kernel_size", ",", "\n", "reuse", "=", "self", ".", "reuse", ",", "\n", "scope", "=", "'conv_2_0_5'", ",", "activation_fn", "=", "None", ")", "\n", "\n", "color_matrix_per_pixel", "=", "conv_2_1_5", "\n", "return", "color_matrix_per_pixel", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model.branch_3": [[194, 212], ["tensorflow.variable_scope", "tensorflow.expand_dims", "tensorflow.expand_dims", "tensorflow.expand_dims", "tensorflow.concat", "tensorflow.reduce_sum", "tensorflow.reduce_sum", "tensorflow.reduce_sum"], "methods", ["None"], ["", "", "def", "branch_3", "(", "self", ",", "rgb", ",", "color_matrix_per_pixel", ")", ":", "\n", "        ", "with", "tf", ".", "variable_scope", "(", "'branch_3'", ",", "reuse", "=", "self", ".", "reuse", ")", ":", "\n", "\n", "############################################################################################################", "\n", "####                                Use perpixel color matrix to rgb                                    ####", "\n", "############################################################################################################", "\n", "            ", "r_matrix", "=", "color_matrix_per_pixel", "[", ":", ",", ":", ",", ":", ",", ":", "3", "]", "\n", "g_matrix", "=", "color_matrix_per_pixel", "[", ":", ",", ":", ",", ":", ",", "3", ":", "6", "]", "\n", "b_matrix", "=", "color_matrix_per_pixel", "[", ":", ",", ":", ",", ":", ",", "6", ":", "9", "]", "\n", "r_m", "=", "tf", ".", "reduce_sum", "(", "r_matrix", "*", "rgb", ",", "axis", "=", "3", ")", "+", "color_matrix_per_pixel", "[", ":", ",", ":", ",", ":", ",", "9", "]", "\n", "g_m", "=", "tf", ".", "reduce_sum", "(", "g_matrix", "*", "rgb", ",", "axis", "=", "3", ")", "+", "color_matrix_per_pixel", "[", ":", ",", ":", ",", ":", ",", "10", "]", "\n", "b_m", "=", "tf", ".", "reduce_sum", "(", "b_matrix", "*", "rgb", ",", "axis", "=", "3", ")", "+", "color_matrix_per_pixel", "[", ":", ",", ":", ",", ":", ",", "11", "]", "\n", "\n", "r", "=", "tf", ".", "expand_dims", "(", "r_m", ",", "axis", "=", "3", ")", "\n", "g", "=", "tf", ".", "expand_dims", "(", "g_m", ",", "axis", "=", "3", ")", "\n", "b", "=", "tf", ".", "expand_dims", "(", "b_m", ",", "axis", "=", "3", ")", "\n", "srgb", "=", "tf", ".", "concat", "(", "[", "r", ",", "g", ",", "b", "]", ",", "axis", "=", "3", ")", "\n", "return", "srgb", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model.build_model": [[213, 239], ["tensorflow.variable_scope", "model.branch_1", "model.branch_2_0", "model.branch_2_1", "model.branch_2_2", "model.branch_3", "model_tools.l1_loss", "tensorflow.reduce_mean", "tensorflow.reduce_mean", "tensorflow.contrib.slim.conv2d", "tensorflow.contrib.slim.conv2d", "tensorflow.image.psnr", "tensorflow.image.ssim", "tensorflow.python.ops.init_ops.zeros_initializer", "tensorflow.python.ops.init_ops.zeros_initializer", "tensorflow.python.ops.init_ops.zeros_initializer", "tensorflow.python.ops.init_ops.zeros_initializer"], "methods", ["home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model.branch_1", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model.branch_2_0", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model.branch_2_1", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model.branch_2_2", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model.branch_3", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model_tools.l1_loss"], ["", "", "def", "build_model", "(", "self", ")", ":", "\n", "        ", "with", "tf", ".", "variable_scope", "(", "'main_model'", ",", "reuse", "=", "self", ".", "reuse", ")", ":", "\n", "            ", "rgb", ",", "fc11", ",", "fc12", "=", "model", ".", "branch_1", "(", "self", ")", "\n", "fc21", ",", "pool_2_0_0", "=", "model", ".", "branch_2_0", "(", "self", ")", "\n", "fin21", "=", "slim", ".", "conv2d", "(", "inputs", "=", "fc11", ",", "num_outputs", "=", "256", ",", "kernel_size", "=", "1", ",", "activation_fn", "=", "model_tools", ".", "lrelu", ",", "\n", "reuse", "=", "self", ".", "reuse", ",", "scope", "=", "'w_fin21'", ",", "\n", "weights_initializer", "=", "init_ops", ".", "zeros_initializer", "(", "dtype", "=", "tf", ".", "float32", ")", ",", "\n", "biases_initializer", "=", "init_ops", ".", "zeros_initializer", "(", "dtype", "=", "tf", ".", "float32", ")", ")", "+", "fc21", "if", "FF", "else", "fc21", "\n", "fc22", "=", "model", ".", "branch_2_1", "(", "self", ",", "fcin21", "=", "fin21", ",", "pool_2_0_0", "=", "pool_2_0_0", ")", "\n", "fin22", "=", "slim", ".", "conv2d", "(", "inputs", "=", "fc12", ",", "num_outputs", "=", "256", ",", "kernel_size", "=", "1", ",", "activation_fn", "=", "model_tools", ".", "lrelu", ",", "\n", "reuse", "=", "self", ".", "reuse", ",", "scope", "=", "'w_fin22'", ",", "\n", "weights_initializer", "=", "init_ops", ".", "zeros_initializer", "(", "dtype", "=", "tf", ".", "float32", ")", ",", "\n", "biases_initializer", "=", "init_ops", ".", "zeros_initializer", "(", "dtype", "=", "tf", ".", "float32", ")", ")", "+", "fc22", "if", "FF", "else", "fc22", "\n", "color_matrix_per_pixel", "=", "model", ".", "branch_2_2", "(", "self", ",", "fcin22", "=", "fin22", ")", "\n", "srgb", "=", "model", ".", "branch_3", "(", "self", ",", "rgb", "=", "rgb", ",", "color_matrix_per_pixel", "=", "color_matrix_per_pixel", ")", "\n", "if", "self", ".", "gt_img", "is", "not", "None", ":", "\n", "                ", "loss", "=", "model_tools", ".", "l1_loss", "(", "srgb", ",", "self", ".", "gt_img", ")", "\n", "psnr", "=", "tf", ".", "reduce_mean", "(", "tf", ".", "image", ".", "psnr", "(", "srgb", ",", "self", ".", "gt_img", ",", "max_val", "=", "1.0", ")", ",", "axis", "=", "0", ")", "\n", "ssim", "=", "tf", ".", "reduce_mean", "(", "tf", ".", "image", ".", "ssim", "(", "srgb", ",", "self", ".", "gt_img", ",", "max_val", "=", "1.0", ")", ",", "axis", "=", "0", ")", "\n", "", "else", ":", "\n", "                ", "loss", "=", "None", "\n", "psnr", "=", "None", "\n", "ssim", "=", "None", "\n", "", "res", "=", "srgb", "\n", "\n", "return", "loss", ",", "psnr", ",", "ssim", ",", "res", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.train_and_test.train.__init__": [[10, 31], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "real", "=", "parameters", ".", "REAL", "\n", "self", ".", "training", "=", "parameters", ".", "TRAINING", "\n", "self", ".", "testing", "=", "parameters", ".", "TESTING", "\n", "self", ".", "training_capacity", "=", "parameters", ".", "TRAINING_CAPACITY", "\n", "self", ".", "batch_size", "=", "parameters", ".", "BATCH_SIZE", "\n", "self", ".", "batch_per_epoch", "=", "parameters", ".", "BATCH_PER_EPOCH", "\n", "self", ".", "epoch_num", "=", "parameters", ".", "EPOCH_NUM", "\n", "self", ".", "pretrained", "=", "parameters", ".", "PRETRAINED", "\n", "self", ".", "crop_size", "=", "parameters", ".", "CROP_SIZE", "\n", "self", ".", "switch_epoch", "=", "parameters", ".", "SWITCH_EPOCH", "\n", "self", ".", "decay_coef", "=", "parameters", ".", "DECAY_COEF", "\n", "self", ".", "result_path", "=", "parameters", ".", "RESULT_PATH", "\n", "self", ".", "max_epoch", "=", "parameters", ".", "MAX_EPOCH", "\n", "self", ".", "learning_rate", "=", "parameters", ".", "LEARNING_RATE", "\n", "self", ".", "switch_learning_rate", "=", "parameters", ".", "SWITCH_LEARNING_RATE", "\n", "self", ".", "test_ratio", "=", "parameters", ".", "TEST_RATIO", "\n", "self", ".", "testing_capacity", "=", "parameters", ".", "TESTING_CAPACITY", "\n", "self", ".", "save_freq", "=", "parameters", ".", "SAVE_FREQ", "\n", "self", ".", "test_image_folder", "=", "parameters", ".", "TEST_IMAGE_FOLDER", "\n", "self", ".", "log_dir", "=", "parameters", ".", "LOG_DIR", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.train_and_test.train.help_eval": [[32, 42], ["tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.reduce_mean", "tensorflow.reduce_mean", "tensorflow.reduce_mean", "sess.run", "tensorflow.abs", "tensorflow.image.psnr", "tensorflow.image.ssim", "gt_img.reshape", "res_img.reshape"], "methods", ["None"], ["", "def", "help_eval", "(", "self", ",", "gt_img", ",", "res_img", ",", "sess", ")", ":", "\n", "        ", "h", ",", "w", ",", "_", "=", "res_img", ".", "shape", "\n", "gt_img_pd", "=", "tf", ".", "placeholder", "(", "dtype", "=", "tf", ".", "float32", ",", "shape", "=", "[", "1", ",", "h", ",", "w", ",", "3", "]", ")", "\n", "res_img_pd", "=", "tf", ".", "placeholder", "(", "dtype", "=", "tf", ".", "float32", ",", "shape", "=", "[", "1", ",", "h", ",", "w", ",", "3", "]", ")", "\n", "l1_loss", "=", "tf", ".", "reduce_mean", "(", "tf", ".", "abs", "(", "gt_img_pd", "-", "res_img_pd", ")", ")", "\n", "psnr", "=", "tf", ".", "reduce_mean", "(", "tf", ".", "image", ".", "psnr", "(", "gt_img_pd", ",", "res_img_pd", ",", "max_val", "=", "1.", ")", ")", "\n", "ssim", "=", "tf", ".", "reduce_mean", "(", "tf", ".", "image", ".", "ssim", "(", "gt_img_pd", ",", "res_img_pd", ",", "max_val", "=", "1.", ")", ")", "\n", "feed_dict", "=", "{", "gt_img_pd", ":", "gt_img", ".", "reshape", "(", "[", "1", ",", "h", ",", "w", ",", "3", "]", ")", "/", "255.", ",", "res_img_pd", ":", "res_img", ".", "reshape", "(", "[", "1", ",", "h", ",", "w", ",", "3", "]", ")", "/", "255.", "}", "\n", "l1", ",", "p", ",", "s", "=", "sess", ".", "run", "(", "[", "l1_loss", ",", "psnr", ",", "ssim", "]", ",", "feed_dict", "=", "feed_dict", ")", "\n", "return", "l1", ",", "p", ",", "s", "\n", "\n"]], "home.repos.pwc.inspect_result.xuxy09_RawSR.None.train_and_test.train.train": [[43, 180], ["tensorflow.Graph().as_default", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "model.model.model", "tools.tools.tools", "model.model.model.build_model", "tensorflow.train.range_input_producer", "tensorflow.train.range_input_producer.dequeue_many", "tensorflow.Variable", "tensorflow.train.AdamOptimizer().minimize", "tensorflow.GPUOptions", "tensorflow.Session", "tensorflow.train.Saver", "tensorflow.train.Coordinator", "tensorflow.train.start_queue_runners", "range", "tensorflow.train.Saver.restore", "print", "tensorflow.Session.run", "tensorflow.Graph", "tensorflow.train.AdamOptimizer", "tensorflow.ConfigProto", "tensorflow.get_default_graph", "tensorflow.global_variables_initializer", "range", "tensorflow.train.Saver.save", "print", "tensorflow.placeholder", "tensorflow.placeholder", "model.model.model", "model.model.model.build_model", "range", "tools.tools.tools.write", "tensorflow.placeholder", "tensorflow.placeholder", "model.model.model", "model.model.model.build_model", "range", "print", "exit", "tensorflow.train.latest_checkpoint", "int", "tensorflow.Session.run", "tools.tools.tools.load_train_data", "print", "tensorflow.Session.run", "print", "train_loss.append", "train_psnr.append", "train_ssim.append", "print", "tools.tools.tools.load_test_data", "range", "tools.tools.tools.merge", "train_and_test.train.help_eval", "test_loss.append", "test_psnr.append", "test_ssim.append", "tools.tools.tools.write", "tools.tools.tools.load_test_real", "range", "tools.tools.tools.merge", "tools.tools.tools.imgsave", "max", "tensorflow.Session.run", "numpy.array", "rt.reshape.reshape.reshape", "res_list.append", "numpy.stack", "tools.tools.tools.imgsave", "tools.tools.tools.write_test", "numpy.mean", "numpy.mean", "numpy.mean", "numpy.mean", "numpy.mean", "numpy.mean", "tensorflow.Session.run", "numpy.array", "rt.reshape.reshape.reshape", "res_list.append", "numpy.stack", "numpy.expand_dims", "numpy.expand_dims", "os.path.isdir", "os.mkdir", "os.mkdir", "numpy.mean", "numpy.mean", "numpy.mean", "numpy.expand_dims", "numpy.expand_dims", "pow", "os.path.join", "os.path.join", "os.path.join", "str", "str", "str"], "methods", ["home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model.build_model", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model.build_model", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.write", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.model.model.build_model", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.load_train_data", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.load_test_data", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.merge", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.train_and_test.train.help_eval", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.write", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.load_test_real", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.merge", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.imgsave", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.imgsave", "home.repos.pwc.inspect_result.xuxy09_RawSR.None.tools.tools.write_test"], ["", "def", "train", "(", "self", ")", ":", "\n", "        ", "with", "tf", ".", "Graph", "(", ")", ".", "as_default", "(", ")", ":", "\n", "            ", "input_isp", "=", "tf", ".", "placeholder", "(", "dtype", "=", "tf", ".", "float32", ",", "shape", "=", "[", "self", ".", "batch_size", ",", "self", ".", "crop_size", ",", "self", ".", "crop_size", ",", "3", "]", ",", "\n", "name", "=", "'input_isp'", ")", "\n", "input_img", "=", "tf", ".", "placeholder", "(", "dtype", "=", "tf", ".", "float32", ",", "shape", "=", "[", "self", ".", "batch_size", ",", "self", ".", "crop_size", ",", "self", ".", "crop_size", ",", "1", "]", ",", "\n", "name", "=", "'input_img'", ")", "\n", "gt_img", "=", "tf", ".", "placeholder", "(", "dtype", "=", "tf", ".", "float32", ",", "\n", "shape", "=", "[", "self", ".", "batch_size", ",", "parameters", ".", "Scale", "*", "self", ".", "crop_size", ",", "\n", "parameters", ".", "Scale", "*", "self", ".", "crop_size", ",", "3", "]", ",", "\n", "name", "=", "'gt_img'", ")", "\n", "learning_rate", "=", "tf", ".", "placeholder", "(", "dtype", "=", "tf", ".", "float32", ",", "name", "=", "'learning_rate'", ")", "\n", "mymodel", "=", "model", "(", "input_img", "=", "input_img", ",", "input_isp", "=", "input_isp", ",", "gt_img", "=", "gt_img", ",", "reuse", "=", "None", ")", "\n", "mytool", "=", "tools", "(", ")", "\n", "loss", ",", "psnr", ",", "ssim", ",", "res", "=", "mymodel", ".", "build_model", "(", ")", "\n", "index_queue", "=", "tf", ".", "train", ".", "range_input_producer", "(", "limit", "=", "self", ".", "training_capacity", ",", "shuffle", "=", "True", ")", "\n", "queue_op", "=", "index_queue", ".", "dequeue_many", "(", "self", ".", "batch_size", ")", "\n", "step", "=", "tf", ".", "Variable", "(", "0", ",", "trainable", "=", "False", ")", "\n", "training_op", "=", "tf", ".", "train", ".", "AdamOptimizer", "(", "learning_rate", ")", ".", "minimize", "(", "loss", "=", "loss", ",", "global_step", "=", "step", ")", "\n", "gpu_options", "=", "tf", ".", "GPUOptions", "(", "per_process_gpu_memory_fraction", "=", "1", ")", "\n", "sess", "=", "tf", ".", "Session", "(", "config", "=", "tf", ".", "ConfigProto", "(", "gpu_options", "=", "gpu_options", ")", ",", "graph", "=", "tf", ".", "get_default_graph", "(", ")", ")", "\n", "saver", "=", "tf", ".", "train", ".", "Saver", "(", ")", "\n", "\n", "coord", "=", "tf", ".", "train", ".", "Coordinator", "(", ")", "\n", "tf", ".", "train", ".", "start_queue_runners", "(", "sess", "=", "sess", ",", "coord", "=", "coord", ")", "\n", "\n", "if", "self", ".", "pretrained", ":", "\n", "# sess.run(tf.global_variables_initializer())", "\n", "                ", "saver", ".", "restore", "(", "sess", "=", "sess", ",", "save_path", "=", "tf", ".", "train", ".", "latest_checkpoint", "(", "self", ".", "log_dir", ")", ")", "\n", "print", "(", "'Finish loading pretrained model!'", ")", "\n", "", "else", ":", "\n", "                ", "sess", ".", "run", "(", "tf", ".", "global_variables_initializer", "(", ")", ")", "\n", "\n", "", "for", "num_epoch", "in", "range", "(", "self", ".", "epoch_num", ",", "self", ".", "max_epoch", "+", "1", ")", ":", "\n", "                ", "train_loss", "=", "[", "]", "\n", "train_psnr", "=", "[", "]", "\n", "train_ssim", "=", "[", "]", "\n", "if", "self", ".", "training", ":", "\n", "                    ", "for", "batch_num", "in", "range", "(", "0", ",", "int", "(", "self", ".", "batch_per_epoch", ")", ")", ":", "\n", "                        ", "batch_index", "=", "sess", ".", "run", "(", "queue_op", ")", "\n", "train_data", ",", "ground_data", ",", "isp_data", "=", "mytool", ".", "load_train_data", "(", "batch_index", ")", "\n", "\n", "l_r", "=", "max", "(", "self", ".", "learning_rate", "*", "pow", "(", "self", ".", "decay_coef", ",", "num_epoch", ")", ",", "self", ".", "switch_learning_rate", ")", "if", "num_epoch", "<", "self", ".", "switch_epoch", "else", "self", ".", "switch_learning_rate", "\n", "print", "(", "l_r", ")", "\n", "\n", "feed_dict", "=", "{", "input_img", ":", "train_data", ",", "input_isp", ":", "isp_data", ",", "gt_img", ":", "ground_data", ",", "\n", "learning_rate", ":", "l_r", "}", "\n", "_", ",", "l", ",", "p", ",", "s", ",", "ss", ",", "r", "=", "sess", ".", "run", "(", "[", "training_op", ",", "loss", ",", "psnr", ",", "ssim", ",", "step", ",", "res", "]", ",", "\n", "feed_dict", "=", "feed_dict", ")", "\n", "print", "(", "'epoch: %d, batch: %d, l1 loss: %.6f, psnr: %.6f, ssim: %.6f'", "%", "(", "\n", "num_epoch", ",", "batch_num", ",", "l", ",", "p", ",", "s", ")", ")", "\n", "\n", "train_loss", ".", "append", "(", "l", ")", "\n", "train_psnr", ".", "append", "(", "p", ")", "\n", "train_ssim", ".", "append", "(", "s", ")", "\n", "", "saver", ".", "save", "(", "sess", "=", "sess", ",", "save_path", "=", "self", ".", "log_dir", "+", "'/model.ckpt'", ",", "global_step", "=", "step", ")", "\n", "\n", "", "if", "num_epoch", "%", "self", ".", "test_ratio", "==", "0", "and", "self", ".", "testing", "and", "not", "self", ".", "real", ":", "\n", "                    ", "print", "(", "'Come to test'", ")", "\n", "test_loss", "=", "[", "]", "\n", "test_psnr", "=", "[", "]", "\n", "test_ssim", "=", "[", "]", "\n", "\n", "test_input_img", "=", "tf", ".", "placeholder", "(", "dtype", "=", "tf", ".", "float32", ",", "shape", "=", "[", "1", ",", "self", ".", "crop_size", ",", "self", ".", "crop_size", ",", "1", "]", ",", "\n", "name", "=", "'test_input_img'", ")", "\n", "test_input_isp", "=", "tf", ".", "placeholder", "(", "dtype", "=", "tf", ".", "float32", ",", "shape", "=", "[", "1", ",", "self", ".", "crop_size", ",", "self", ".", "crop_size", ",", "3", "]", ",", "\n", "name", "=", "'test_input_isp'", ")", "\n", "\n", "test_model", "=", "model", "(", "input_img", "=", "test_input_img", ",", "input_isp", "=", "test_input_isp", ",", "gt_img", "=", "None", ",", "reuse", "=", "True", ")", "\n", "t_loss", ",", "t_psnr", ",", "t_ssim", ",", "t_res", "=", "test_model", ".", "build_model", "(", ")", "\n", "\n", "for", "i", "in", "range", "(", "self", ".", "testing_capacity", ")", ":", "\n", "                        ", "print", "(", "i", ")", "\n", "\n", "test_train_data", ",", "test_isp_data", ",", "h", ",", "w", ",", "test_name", ",", "gt_img_", ",", "mask", "=", "mytool", ".", "load_test_data", "(", "i", ")", "\n", "res_list", "=", "[", "]", "\n", "for", "j", "in", "range", "(", "test_train_data", ".", "shape", "[", "0", "]", ")", ":", "\n", "                            ", "feed_dict", "=", "{", "test_input_img", ":", "np", ".", "expand_dims", "(", "test_train_data", "[", "j", ",", ":", ",", ":", ",", ":", "]", ",", "axis", "=", "0", ")", ",", "\n", "test_input_isp", ":", "np", ".", "expand_dims", "(", "test_isp_data", "[", "j", ",", ":", ",", ":", ",", ":", "]", ",", "axis", "=", "0", ")", "}", "\n", "\n", "rt", "=", "sess", ".", "run", "(", "[", "t_res", "]", ",", "feed_dict", "=", "feed_dict", ")", "\n", "rt", "=", "np", ".", "array", "(", "rt", ")", "\n", "h_", ",", "w_", ",", "c", "=", "rt", ".", "shape", "[", "-", "3", ":", "]", "\n", "rt", "=", "rt", ".", "reshape", "(", "[", "h_", ",", "w_", ",", "c", "]", ")", "\n", "res_list", ".", "append", "(", "rt", ")", "\n", "", "res_img", "=", "mytool", ".", "merge", "(", "np", ".", "stack", "(", "res_list", ")", ",", "h", ",", "w", ",", "mask", ")", "\n", "gtr_img", "=", "gt_img_", "*", "255.", "\n", "l1", ",", "p", ",", "s", "=", "train", ".", "help_eval", "(", "self", ",", "gtr_img", ",", "res_img", ",", "sess", ")", "\n", "test_loss", ".", "append", "(", "l1", ")", "\n", "test_psnr", ".", "append", "(", "p", ")", "\n", "test_ssim", ".", "append", "(", "s", ")", "\n", "if", "num_epoch", "%", "self", ".", "save_freq", "==", "0", ":", "\n", "                            ", "rt_img", "=", "res_img", "\n", "if", "not", "os", ".", "path", ".", "isdir", "(", "os", ".", "path", ".", "join", "(", "self", ".", "result_path", ",", "str", "(", "num_epoch", ")", ")", ")", ":", "\n", "                                ", "os", ".", "mkdir", "(", "os", ".", "path", ".", "join", "(", "self", ".", "result_path", ",", "str", "(", "num_epoch", ")", ")", ")", "\n", "os", ".", "mkdir", "(", "os", ".", "path", ".", "join", "(", "self", ".", "result_path", ",", "str", "(", "num_epoch", ")", ",", "self", ".", "test_image_folder", ")", ")", "\n", "", "mytool", ".", "imgsave", "(", "rt_img", ",", "num_epoch", ",", "test_name", ")", "\n", "mytool", ".", "write_test", "(", "epoch", "=", "num_epoch", ",", "name", "=", "test_name", ",", "testing_sad_loss", "=", "l1", ",", "\n", "testing_psnr_loss", "=", "p", ")", "\n", "", "", "mytool", ".", "write", "(", "epoch", "=", "num_epoch", ",", "training_sad_loss", "=", "np", ".", "mean", "(", "train_loss", ")", ",", "\n", "training_psnr_loss", "=", "np", ".", "mean", "(", "train_psnr", ")", ",", "training_ssim_loss", "=", "np", ".", "mean", "(", "train_ssim", ")", ",", "\n", "testing_sad_loss", "=", "np", ".", "mean", "(", "test_loss", ")", ",", "\n", "testing_psnr_loss", "=", "np", ".", "mean", "(", "test_psnr", ")", ",", "testing_ssim_loss", "=", "np", ".", "mean", "(", "test_ssim", ")", ")", "\n", "", "elif", "not", "self", ".", "real", ":", "\n", "                    ", "mytool", ".", "write", "(", "epoch", "=", "num_epoch", ",", "training_sad_loss", "=", "np", ".", "mean", "(", "train_loss", ")", ",", "\n", "training_ssim_loss", "=", "np", ".", "mean", "(", "train_ssim", ")", ",", "\n", "training_psnr_loss", "=", "np", ".", "mean", "(", "train_psnr", ")", ")", "\n", "\n", "", "if", "self", ".", "real", ":", "\n", "                    ", "test_input_img", "=", "tf", ".", "placeholder", "(", "dtype", "=", "tf", ".", "float32", ",", "shape", "=", "[", "1", ",", "self", ".", "crop_size", ",", "self", ".", "crop_size", ",", "1", "]", ",", "\n", "name", "=", "'test_input_img'", ")", "\n", "test_input_isp", "=", "tf", ".", "placeholder", "(", "dtype", "=", "tf", ".", "float32", ",", "shape", "=", "[", "1", ",", "self", ".", "crop_size", ",", "self", ".", "crop_size", ",", "3", "]", ",", "\n", "name", "=", "'test_input_isp'", ")", "\n", "\n", "test_model", "=", "model", "(", "input_img", "=", "test_input_img", ",", "input_isp", "=", "test_input_isp", ",", "gt_img", "=", "None", ",", "reuse", "=", "True", ")", "\n", "t_loss", ",", "t_psnr", ",", "t_ssim", ",", "t_res", "=", "test_model", ".", "build_model", "(", ")", "\n", "\n", "for", "i", "in", "range", "(", "self", ".", "testing_capacity", ")", ":", "\n", "\n", "                        ", "test_train_data", ",", "test_isp_data", ",", "h", ",", "w", ",", "test_name", ",", "mask", "=", "mytool", ".", "load_test_real", "(", "i", ")", "\n", "res_list", "=", "[", "]", "\n", "for", "j", "in", "range", "(", "test_train_data", ".", "shape", "[", "0", "]", ")", ":", "\n", "                            ", "feed_dict", "=", "{", "test_input_img", ":", "np", ".", "expand_dims", "(", "test_train_data", "[", "j", ",", ":", ",", ":", ",", ":", "]", ",", "axis", "=", "0", ")", ",", "\n", "test_input_isp", ":", "np", ".", "expand_dims", "(", "test_isp_data", "[", "j", ",", ":", ",", ":", ",", ":", "]", ",", "axis", "=", "0", ")", "}", "\n", "\n", "rt", "=", "sess", ".", "run", "(", "[", "t_res", "]", ",", "feed_dict", "=", "feed_dict", ")", "\n", "rt", "=", "np", ".", "array", "(", "rt", ")", "\n", "h_", ",", "w_", ",", "c", "=", "rt", ".", "shape", "[", "-", "3", ":", "]", "\n", "rt", "=", "rt", ".", "reshape", "(", "[", "h_", ",", "w_", ",", "c", "]", ")", "\n", "res_list", ".", "append", "(", "rt", ")", "\n", "", "res_img", "=", "mytool", ".", "merge", "(", "np", ".", "stack", "(", "res_list", ")", ",", "h", ",", "w", ",", "mask", ")", "\n", "rt_img", "=", "res_img", "\n", "mytool", ".", "imgsave", "(", "rt_img", ",", "num_epoch", ",", "'{}_highresolution.'", ".", "format", "(", "test_name", ")", ")", "\n", "", "", "if", "not", "self", ".", "training", ":", "\n", "                    ", "print", "(", "'Validation finished!'", ")", "\n", "exit", "(", "0", ")", "\n", "\n"]]}