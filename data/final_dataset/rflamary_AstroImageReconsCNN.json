{"home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.visu_images_rec.get_fname": [[17, 19], ["None"], "function", ["None"], ["def", "get_fname", "(", "method", ",", "n", ",", "npsf", ",", "sigma", ",", "img", ")", ":", "\n", "    ", "return", "'res/{}_{}x{}_PSF{}_sigma{:1.3f}_{}.mat'", ".", "format", "(", "method", ",", "n", ",", "n", ",", "npsf", ",", "sigma", ",", "img", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.visu_images_rec.get_fname_all": [[20, 22], ["None"], "function", ["None"], ["", "def", "get_fname_all", "(", "method", ",", "n", ",", "npsf", ",", "sigma", ")", ":", "\n", "    ", "return", "'res/{}_{}x{}_PSF{}_sigma{:1.3f}_all.mat'", ".", "format", "(", "method", ",", "n", ",", "n", ",", "npsf", ",", "sigma", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.visu_images_rec.sel": [[57, 59], ["None"], "function", ["None"], ["def", "sel", "(", "I", ")", ":", "\n", "    ", "return", "I", "[", "300", ":", "-", "cr", "-", "100", ",", "300", ":", "-", "cr", "-", "100", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.visu_filters_deconv.get_fname": [[19, 21], ["None"], "function", ["None"], ["def", "get_fname", "(", "method", ",", "n", ",", "npsf", ",", "sigma", ",", "img", ")", ":", "\n", "    ", "return", "'res/{}_{}x{}_PSF{}_sigma{:1.3f}_{}.mat'", ".", "format", "(", "method", ",", "n", ",", "n", ",", "npsf", ",", "sigma", ",", "img", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.visu_filters_deconv.get_fname_all": [[22, 24], ["None"], "function", ["None"], ["", "def", "get_fname_all", "(", "method", ",", "n", ",", "npsf", ",", "sigma", ")", ":", "\n", "    ", "return", "'res/{}_{}x{}_PSF{}_sigma{:1.3f}_all.mat'", ".", "format", "(", "method", ",", "n", ",", "n", ",", "npsf", ",", "sigma", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.visu_filters_deconv.sel": [[38, 40], ["None"], "function", ["None"], ["def", "sel", "(", "I", ")", ":", "\n", "    ", "return", "I", "[", "300", ":", "-", "cr", "-", "100", ",", "300", ":", "-", "cr", "-", "100", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.run_cnn_all.get_fname": [[19, 21], ["None"], "function", ["None"], ["def", "get_fname", "(", "modelname", ",", "npsf", ",", "sigma", ",", "img", ")", ":", "\n", "    ", "return", "'{}_PSF{}_sigma{:1.3f}_{}'", ".", "format", "(", "modelname", ",", "npsf", ",", "sigma", ",", "img", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.run_cnn_all.get_callback_string": [[22, 24], ["None"], "function", ["None"], ["", "def", "get_callback_string", "(", "fname", ")", ":", "\n", "    ", "return", "'models/'", "+", "fname", "+", "'e{epoch:02d}-loss{val_loss:.4f}.hd5'", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.visu_images_all.get_fname": [[17, 19], ["None"], "function", ["None"], ["def", "get_fname", "(", "method", ",", "n", ",", "npsf", ",", "sigma", ",", "img", ")", ":", "\n", "    ", "return", "'res/{}_{}x{}_PSF{}_sigma{:1.3f}_{}.mat'", ".", "format", "(", "method", ",", "n", ",", "n", ",", "npsf", ",", "sigma", ",", "img", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.visu_images_all.get_fname_all": [[20, 22], ["None"], "function", ["None"], ["", "def", "get_fname_all", "(", "method", ",", "n", ",", "npsf", ",", "sigma", ")", ":", "\n", "    ", "return", "'res/{}_{}x{}_PSF{}_sigma{:1.3f}_all.mat'", ".", "format", "(", "method", ",", "n", ",", "n", ",", "npsf", ",", "sigma", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.visu_comp_perfs.get_fname": [[15, 17], ["None"], "function", ["None"], ["def", "get_fname", "(", "method", ",", "n", ",", "npsf", ",", "sigma", ",", "img", ")", ":", "\n", "    ", "return", "'res/{}_{}x{}_PSF{}_sigma{:1.3f}_{}.mat'", ".", "format", "(", "method", ",", "n", ",", "n", ",", "npsf", ",", "sigma", ",", "img", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.visu_comp_perfs.get_fname_all": [[18, 20], ["None"], "function", ["None"], ["", "def", "get_fname_all", "(", "method", ",", "n", ",", "npsf", ",", "sigma", ")", ":", "\n", "    ", "return", "'res/{}_{}x{}_PSF{}_sigma{:1.3f}_all.mat'", ".", "format", "(", "method", ",", "n", ",", "n", ",", "npsf", ",", "sigma", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.run_linear_cnn_all.get_fname": [[19, 21], ["None"], "function", ["None"], ["def", "get_fname", "(", "modelname", ",", "npsf", ",", "sigma", ",", "img", ")", ":", "\n", "    ", "return", "'{}_PSF{}_sigma{:1.3f}_{}'", ".", "format", "(", "modelname", ",", "npsf", ",", "sigma", ",", "img", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.run_linear_cnn_all.get_callback_string": [[22, 24], ["None"], "function", ["None"], ["", "def", "get_callback_string", "(", "fname", ")", ":", "\n", "    ", "return", "'models/'", "+", "fname", "+", "'e{epoch:02d}-loss{val_loss:.4f}.hd5'", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.tic": [[25, 28], ["time.time"], "function", ["None"], ["def", "tic", "(", ")", ":", "\n", "    ", "global", "_tictocstart", "\n", "_tictocstart", "=", "time", ".", "time", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.toc": [[29, 34], ["print", "time.time"], "function", ["None"], ["", "def", "toc", "(", "str_print", "=", "''", ")", ":", "\n", "    ", "global", "_tictocstart", "\n", "tp", "=", "time", ".", "time", "(", ")", "-", "_tictocstart", "\n", "print", "(", "'{}{:1.3f}s elapsed'", ".", "format", "(", "str_print", ",", "tp", ")", ")", "\n", "return", "tp", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.toq": [[35, 39], ["time.time"], "function", ["None"], ["", "def", "toq", "(", "str_print", "=", "''", ")", ":", "\n", "    ", "global", "_tictocstart", "\n", "tp", "=", "time", ".", "time", "(", ")", "-", "_tictocstart", "\n", "return", "tp", "\n", "#%% utils PSF/image", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.get_PSF_airy": [[41, 48], ["numpy.linspace", "numpy.meshgrid", "PSF.sum", "numpy.sqrt", "scipy.special.j1"], "function", ["None"], ["", "def", "get_PSF_airy", "(", "n", ",", "nr", ")", ":", "\n", "    ", "xpsf", "=", "np", ".", "linspace", "(", "-", "1", ",", "1", ",", "n", ")", "\n", "Xg", ",", "Yg", "=", "np", ".", "meshgrid", "(", "xpsf", ",", "xpsf", ")", "\n", "R", "=", "np", ".", "sqrt", "(", "Xg", "**", "2", "+", "Yg", "**", "2", ")", "*", "np", ".", "pi", "*", "nr", "\n", "PSF", "=", "(", "sp", ".", "special", ".", "j1", "(", "R", ")", "/", "R", ")", "**", "2", "\n", "PSF", "=", "PSF", "/", "PSF", ".", "sum", "(", ")", "\n", "return", "PSF", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.load_fits_image": [[52, 58], ["astropy.io.fits.getdata"], "function", ["None"], ["", "def", "load_fits_image", "(", "name", ")", ":", "\n", "    ", "path", "=", "'data/{}.fits'", ".", "format", "(", "name", ")", "\n", "\n", "dat", "=", "getdata", "(", "path", ")", "\n", "#pl.imshow(dat)", "\n", "return", "1.0", "*", "dat", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.crop": [[60, 62], ["None"], "function", ["None"], ["", "def", "crop", "(", "I", ",", "cr", ")", ":", "\n", "    ", "return", "I", "[", "cr", ":", "-", "cr", ",", "cr", ":", "-", "cr", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.mse_crop": [[63, 65], ["numpy.mean", "deconv.crop", "deconv.crop"], "function", ["home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.crop", "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.crop"], ["", "def", "mse_crop", "(", "I1", ",", "I2", ",", "cr", ")", ":", "\n", "    ", "return", "np", ".", "mean", "(", "(", "crop", "(", "I1", ",", "cr", ")", "-", "crop", "(", "I2", ",", "cr", ")", ")", "**", "2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.mse": [[66, 68], ["numpy.mean"], "function", ["None"], ["", "def", "mse", "(", "I1", ",", "I2", ")", ":", "\n", "    ", "return", "np", ".", "mean", "(", "(", "I1", "-", "I2", ")", "**", "2", ")", "\n", "#%% decon algorithms", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.richardson_lucy": [[70, 83], ["image.astype.astype", "psf.astype.astype", "range", "numpy.ones", "scipy.signal.fftconvolve", "scipy.signal.fftconvolve"], "function", ["None"], ["", "def", "richardson_lucy", "(", "image", ",", "psf", ",", "itermax", "=", "50", ")", ":", "\n", "\n", "    ", "image", "=", "image", ".", "astype", "(", "np", ".", "float", ")", "\n", "psf", "=", "psf", ".", "astype", "(", "np", ".", "float", ")", "\n", "im_deconv", "=", "0.5", "*", "np", ".", "ones", "(", "image", ".", "shape", ")", "\n", "psf_mirror", "=", "psf", "[", ":", ":", "-", "1", ",", ":", ":", "-", "1", "]", "\n", "\n", "for", "_", "in", "range", "(", "itermax", ")", ":", "\n", "        ", "relative_blur", "=", "image", "/", "sp", ".", "signal", ".", "fftconvolve", "(", "im_deconv", ",", "psf", ",", "'same'", ")", "\n", "im_deconv", "*=", "sp", ".", "signal", ".", "fftconvolve", "(", "relative_blur", ",", "psf_mirror", ",", "'same'", ")", "\n", "\n", "\n", "", "return", "im_deconv", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.richardson_lucy_path": [[84, 102], ["image.astype.astype", "psf.astype.astype", "numpy.zeros", "range", "numpy.ones", "scipy.signal.fftconvolve", "deconv.mse_crop", "scipy.signal.fftconvolve", "np.zeros.min", "im_deconv.copy"], "function", ["home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.mse_crop"], ["", "def", "richardson_lucy_path", "(", "image", ",", "psf", ",", "imagetrue", ",", "itermax", "=", "50", ",", "cr", "=", "1", ")", ":", "\n", "\n", "    ", "image", "=", "image", ".", "astype", "(", "np", ".", "float", ")", "\n", "psf", "=", "psf", ".", "astype", "(", "np", ".", "float", ")", "\n", "im_deconv", "=", "0.5", "*", "np", ".", "ones", "(", "image", ".", "shape", ")", "\n", "psf_mirror", "=", "psf", "[", ":", ":", "-", "1", ",", ":", ":", "-", "1", "]", "\n", "im_deconv_best", "=", "im_deconv", ";", "\n", "err", "=", "np", ".", "zeros", "(", "(", "itermax", ",", ")", ")", "\n", "\n", "\n", "for", "i", "in", "range", "(", "itermax", ")", ":", "\n", "        ", "relative_blur", "=", "image", "/", "sp", ".", "signal", ".", "fftconvolve", "(", "im_deconv", ",", "psf", ",", "'same'", ")", "\n", "im_deconv", "*=", "sp", ".", "signal", ".", "fftconvolve", "(", "relative_blur", ",", "psf_mirror", ",", "'same'", ")", "\n", "err", "[", "i", "]", "=", "mse_crop", "(", "im_deconv", ",", "imagetrue", ",", "cr", ")", "\n", "if", "err", "[", "i", "]", "==", "err", ".", "min", "(", ")", ":", "\n", "            ", "im_deconv_best", "=", "im_deconv", ".", "copy", "(", ")", "\n", "\n", "", "", "return", "im_deconv_best", ",", "err", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.total_variation": [[103, 112], ["numpy.zeros_like", "numpy.zeros_like", "numpy.sum", "numpy.sqrt"], "function", ["None"], ["", "def", "total_variation", "(", "x", ")", ":", "\n", "\n", "    ", "uh", "=", "np", ".", "zeros_like", "(", "x", ")", "\n", "uh", "[", ":", ",", ":", "-", "1", "]", "=", "x", "[", ":", ",", "1", ":", "]", "-", "x", "[", ":", ",", ":", "-", "1", "]", "\n", "\n", "uv", "=", "np", ".", "zeros_like", "(", "x", ")", "\n", "uv", "[", ":", "-", "1", ",", ":", "]", "=", "x", "[", "1", ":", ",", ":", "]", "-", "x", "[", ":", "-", "1", ",", ":", "]", "\n", "\n", "return", "np", ".", "sum", "(", "np", ".", "sqrt", "(", "uh", "**", "2", "+", "uv", "**", "2", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.vc_recons_tv": [[114, 174], ["numpy.zeros_like", "numpy.zeros_like", "range", "scipy.signal.fftconvolve", "numpy.zeros", "numpy.zeros", "deconv.vc_recons_tv.cost"], "function", ["None"], ["", "def", "vc_recons_tv", "(", "imgf", ",", "psf", ",", "mu", "=", "1e-4", ",", "x", "=", "None", ",", "itermax", "=", "1000", ",", "compcost", "=", "False", ",", "sky", "=", "None", ")", ":", "\n", "# A Generic Proximal Algorithm for Convex Optimization\u2014Application to Total Variation Minimization.", "\n", "# Condat, L. (2014). IEEE Signal Processing Letters, 21(8), 985\u2013989.", "\n", "\n", "    ", "sigmac", "=", "mu", "\n", "tauc", "=", "0.99", "/", "(", "0.5", "*", "10", "+", "8.0", "*", "sigmac", ")", "# ok for gaussian psf normalized to 1", "\n", "\n", "if", "x", "==", "None", ":", "\n", "        ", "x", "=", "imgf", "\n", "\n", "", "psfadj", "=", "psf", "[", ":", ":", "-", "1", ",", ":", ":", "-", "1", "]", "\n", "\n", "nx", ",", "ny", "=", "imgf", ".", "shape", "\n", "u1", "=", "np", ".", "zeros_like", "(", "x", ")", "\n", "u2", "=", "np", ".", "zeros_like", "(", "x", ")", "\n", "conv", "=", "lambda", "x", ",", "psf", ":", "sp", ".", "signal", ".", "fftconvolve", "(", "x", ",", "psf", ",", "'same'", ")", "\n", "if", "compcost", ":", "\n", "        ", "cost_condat", "=", "np", ".", "zeros", "(", "(", "itermax", "+", "1", ",", ")", ")", "\n", "err_condat", "=", "np", ".", "zeros", "(", "(", "itermax", "+", "1", ",", ")", ")", "\n", "def", "cost", "(", "x", ")", ":", "\n", "            ", "return", "0.5", "*", "np", ".", "sum", "(", "(", "imgf", "-", "conv", "(", "x", ",", "psf", ")", ")", "**", "2", ")", "+", "mu", "*", "total_variation", "(", "x", ")", "\n", "\n", "", "cost_condat", "[", "0", "]", "=", "cost", "(", "x", ")", "\n", "if", "not", "sky", "==", "None", ":", "\n", "            ", "err_condat", "[", "0", "]", "=", "np", ".", "mean", "(", "(", "sky", "-", "x", ")", "**", "2", ")", "\n", "\n", "", "", "for", "it", "in", "range", "(", "itermax", ")", ":", "\n", "\n", "# compute gradient", "\n", "        ", "grad", "=", "conv", "(", "conv", "(", "x", ",", "psf", ")", "-", "imgf", ",", "psfadj", ")", "\n", "\n", "# compute adjunct of tv applied to u = (u1, u2)", "\n", "lsu1u2", "=", "np", ".", "hstack", "(", "(", "-", "u1", "[", ":", ",", "0", ":", "1", "]", ",", "u1", "[", ":", ",", ":", "-", "1", "]", "-", "u1", "[", ":", ",", "1", ":", "]", ")", ")", "+", "np", ".", "vstack", "(", "(", "-", "u2", "[", "0", ":", "1", ",", ":", "]", ",", "u2", "[", ":", "-", "1", ",", ":", "]", "-", "u2", "[", "1", ":", ",", ":", "]", ")", ")", "\n", "\n", "# update x\\tilde", "\n", "xt", "=", "np", ".", "maximum", "(", "0", ",", "x", "-", "tauc", "*", "(", "grad", "+", "lsu1u2", ")", ")", "\n", "\n", "# update utilde = (utilde 1, utilde 2)", "\n", "dx", "=", "2", "*", "x", "-", "xt", "\n", "ut1", "=", "u1", "+", "sigmac", "*", "np", ".", "hstack", "(", "(", "dx", "[", ":", ",", "1", ":", "]", "-", "dx", "[", ":", ",", ":", "-", "1", "]", ",", "np", ".", "zeros", "(", "(", "nx", ",", "1", ")", ")", ")", ")", "\n", "ut2", "=", "u2", "+", "sigmac", "*", "np", ".", "vstack", "(", "(", "dx", "[", "1", ":", ",", ":", "]", "-", "dx", "[", ":", "-", "1", ",", ":", "]", ",", "np", ".", "zeros", "(", "(", "1", ",", "ny", ")", ")", ")", ")", "\n", "\n", "den", "=", "np", ".", "maximum", "(", "1.0", ",", "np", ".", "sqrt", "(", "ut1", "**", "2", "+", "ut2", "**", "2", ")", ")", "\n", "ut1", "=", "ut1", "/", "den", "\n", "ut2", "=", "ut2", "/", "den", "\n", "\n", "u1", "=", "ut1", "\n", "u2", "=", "ut2", "\n", "\n", "x", "=", "xt", "\n", "\n", "if", "compcost", ":", "\n", "            ", "cost_condat", "[", "it", "+", "1", "]", "=", "cost", "(", "x", ")", "\n", "if", "not", "sky", "==", "None", ":", "\n", "                ", "err_condat", "[", "it", "+", "1", "]", "=", "np", ".", "mean", "(", "(", "sky", "-", "x", ")", "**", "2", ")", "\n", "\n", "", "", "", "if", "compcost", ":", "\n", "        ", "return", "x", ",", "cost_condat", ",", "err_condat", "\n", "", "else", ":", "\n", "        ", "return", "x", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.wiener": [[177, 179], ["skimage.restoration.wiener"], "function", ["home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.wiener"], ["", "", "def", "wiener", "(", "I", ",", "PSF", ",", "lambd", "=", "1", ")", ":", "\n", "    ", "return", "ski", ".", "restoration", ".", "wiener", "(", "I", ",", "PSF", ",", "lambd", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.richardson_lucyl": [[180, 182], ["skimage.restoration.richardson_lucy"], "function", ["home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.richardson_lucy"], ["", "def", "richardson_lucyl", "(", "I", ",", "PSF", ",", "itermax", "=", "50", ")", ":", "\n", "    ", "return", "ski", ".", "restoration", ".", "richardson_lucy", "(", "I", ",", "PSF", ",", "iterations", "=", "itermax", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.deconv.wiener0": [[183, 186], ["numpy.fft.fft2", "numpy.real", "numpy.fft.ifft2", "numpy.fft.fft2", "numpy.abs"], "function", ["None"], ["", "def", "wiener0", "(", "I", ",", "PSF", ",", "lambd", "=", "1", ")", ":", "\n", "    ", "fPSF", "=", "np", ".", "fft", ".", "fft2", "(", "PSF", ",", "I", ".", "shape", ")", "\n", "return", "np", ".", "real", "(", "np", ".", "fft", ".", "ifft2", "(", "np", ".", "fft", ".", "fft2", "(", "I", ")", "*", "fPSF", "/", "(", "np", ".", "abs", "(", "fPSF", ")", "**", "2", "+", "lambd", ")", ")", ")", "\n", "", ""]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.LossHistory.on_train_begin": [[25, 27], ["None"], "methods", ["None"], ["    ", "def", "on_train_begin", "(", "self", ",", "logs", "=", "{", "}", ")", ":", "\n", "        ", "self", ".", "losses", "=", "[", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.LossHistory.on_batch_end": [[28, 30], ["dsutils.LossHistory.losses.append", "logs.get"], "methods", ["None"], ["", "def", "on_batch_end", "(", "self", ",", "batch", ",", "logs", "=", "{", "}", ")", ":", "\n", "        ", "self", ".", "losses", ".", "append", "(", "logs", ".", "get", "(", "'loss'", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.save_model": [[32, 35], ["model.save_weights", "open().write", "model.to_json", "open"], "function", ["None"], ["", "", "def", "save_model", "(", "model", ",", "fname", "=", "'mymodel'", ")", ":", "\n", "    ", "model", ".", "save_weights", "(", "fname", "+", "'.h5'", ")", "\n", "open", "(", "fname", "+", "'.json'", ",", "'w'", ")", ".", "write", "(", "model", ".", "to_json", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.load_model": [[36, 40], ["keras.models.model_from_json", "keras.models.model_from_json.load_weights", "open().read", "open"], "function", ["None"], ["", "def", "load_model", "(", "fname", ")", ":", "\n", "    ", "model", "=", "model_from_json", "(", "open", "(", "fname", "+", "'.json'", ")", ".", "read", "(", ")", ")", "\n", "model", ".", "load_weights", "(", "fname", "+", "'.h5'", ")", "\n", "return", "model", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.get_dnn_szo": [[43, 48], ["None"], "function", ["None"], ["", "def", "get_dnn_szo", "(", "szi", ",", "lst_size", ")", ":", "\n", "    ", "szo", "=", "szi", "\n", "for", "i", ",", "j", "in", "lst_size", ":", "\n", "        ", "szo", "-=", "j", "-", "1", "\n", "", "return", "szo", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.get_dnn_model": [[49, 67], ["keras.models.Sequential", "range", "keras.models.Sequential.add", "len", "keras.models.Sequential.add", "keras.layers.Convolution2D", "keras.layers.Convolution2D"], "function", ["None"], ["", "def", "get_dnn_model", "(", "szi", ",", "lst_size", ",", "lst_act", "=", "None", ",", "szf", "=", "1", ")", ":", "\n", "    ", "\"\"\"\n    Return deconvolutionnal neural network model for input umage (szf,szi,szi)\n    \n    lstsize is a lits  of length depth of the network\n    \n    for layer k:\n        - lstsize[k][0] : number of output image (nb of filters)\n        - lstsize[k][0] : size of the filters  (square filters)\n    \"\"\"", "\n", "model", "=", "Sequential", "(", ")", "\n", "if", "lst_act", "==", "None", ":", "\n", "        ", "lst_act", "=", "[", "'relu'", "for", "i", "in", "lst_size", "]", "\n", "", "if", "lst_size", ":", "\n", "        ", "model", ".", "add", "(", "Convolution2D", "(", "lst_size", "[", "0", "]", "[", "0", "]", ",", "lst_size", "[", "0", "]", "[", "1", "]", ",", "lst_size", "[", "0", "]", "[", "1", "]", ",", "border_mode", "=", "'valid'", ",", "activation", "=", "lst_act", "[", "0", "]", ",", "input_shape", "=", "(", "1", ",", "szi", ",", "szi", ")", ")", ")", "\n", "", "for", "i", "in", "range", "(", "1", ",", "len", "(", "lst_size", ")", ")", ":", "\n", "        ", "model", ".", "add", "(", "Convolution2D", "(", "lst_size", "[", "i", "]", "[", "0", "]", ",", "lst_size", "[", "i", "]", "[", "1", "]", ",", "lst_size", "[", "i", "]", "[", "1", "]", ",", "border_mode", "=", "'valid'", ",", "activation", "=", "lst_act", "[", "i", "]", ")", ")", "\n", "", "return", "model", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.get_dnn_name": [[68, 73], ["None"], "function", ["None"], ["", "def", "get_dnn_name", "(", "szi", ",", "lst_size", ",", "lst_act", "=", "None", ")", ":", "\n", "    ", "if", "lst_act", "==", "None", ":", "\n", "        ", "layers", "=", "'_'", ".", "join", "(", "[", "'{}x{}-{}'", ".", "format", "(", "szf", ",", "szf", ",", "nbf", ")", "for", "nbf", ",", "szf", "in", "lst_size", "]", ")", "\n", "", "res", "=", "'{}x{}_{}'", ".", "format", "(", "szi", ",", "szi", ",", "layers", ")", "\n", "return", "res", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.get_sample": [[76, 89], ["numpy.random.randint", "numpy.random.randint", "int", "numpy.ceil"], "function", ["None"], ["", "def", "get_sample", "(", "I", ",", "Ip", ",", "sz", ",", "szp", ")", ":", "\n", "    ", "\"\"\"\n    geta  random sample (small image from I of size sz*sz and its corresponding \n    smaller image from Ip of size szp*szp)\n    \"\"\"", "\n", "i", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "I", ".", "shape", "[", "0", "]", "-", "sz", ")", "\n", "j", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "I", ".", "shape", "[", "1", "]", "-", "sz", ")", "\n", "delt", "=", "int", "(", "np", ".", "ceil", "(", "(", "sz", "-", "szp", ")", "*", "1.0", "/", "2", ")", ")", "\n", "if", "szp", "==", "1", ":", "\n", "        ", "y", "=", "Ip", "[", "i", "+", "delt", ",", "j", "+", "delt", "]", "\n", "", "else", ":", "\n", "        ", "y", "=", "Ip", "[", "i", "+", "delt", ":", "i", "+", "sz", "-", "delt", ",", "j", "+", "delt", ":", "j", "+", "sz", "-", "delt", "]", "\n", "", "return", "I", "[", "i", ":", "i", "+", "sz", ",", "j", ":", "j", "+", "sz", "]", ",", "y", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.get_data": [[91, 97], ["numpy.zeros", "numpy.zeros", "range", "dsutils.get_sample"], "function", ["home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.get_sample"], ["", "def", "get_data", "(", "I", ",", "Ip", ",", "sz", ",", "szp", ",", "n", ")", ":", "\n", "    ", "xapp", "=", "np", ".", "zeros", "(", "(", "n", ",", "1", ",", "sz", ",", "sz", ")", ")", "\n", "xtest", "=", "np", ".", "zeros", "(", "(", "n", ",", "1", ",", "szp", ",", "szp", ")", ")", "\n", "for", "i", "in", "range", "(", "n", ")", ":", "\n", "        ", "xapp", "[", "i", ",", ":", ",", ":", ",", ":", "]", ",", "xtest", "[", "i", ",", ":", ",", ":", ",", ":", "]", "=", "get_sample", "(", "I", ",", "Ip", ",", "sz", ",", "szp", ")", "\n", "", "return", "xapp", ",", "xtest", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.get_data_multi": [[98, 106], ["len", "numpy.zeros", "numpy.zeros", "range", "numpy.random.randint", "dsutils.get_sample"], "function", ["home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.get_sample"], ["", "def", "get_data_multi", "(", "I", ",", "Ip", ",", "sz", ",", "szp", ",", "n", ")", ":", "\n", "    ", "nbi", "=", "len", "(", "I", ")", "\n", "xapp", "=", "np", ".", "zeros", "(", "(", "n", ",", "1", ",", "sz", ",", "sz", ")", ")", "\n", "xtest", "=", "np", ".", "zeros", "(", "(", "n", ",", "1", ",", "szp", ",", "szp", ")", ")", "\n", "for", "i", "in", "range", "(", "n", ")", ":", "\n", "        ", "im", "=", "np", ".", "random", ".", "randint", "(", "0", ",", "nbi", ")", "\n", "xapp", "[", "i", ",", ":", ",", ":", ",", ":", "]", ",", "xtest", "[", "i", ",", ":", ",", ":", ",", ":", "]", "=", "get_sample", "(", "I", "[", "im", "]", ",", "Ip", "[", "im", "]", ",", "sz", ",", "szp", ")", "\n", "", "return", "xapp", ",", "xtest", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.im2patch_sklearn": [[108, 112], ["sklearn.feature_extraction.image.extract_patches_2d", "temp.reshape.reshape"], "function", ["None"], ["", "def", "im2patch_sklearn", "(", "I", ",", "sz", ")", ":", "\n", "    ", "temp", "=", "sklearn", ".", "feature_extraction", ".", "image", ".", "extract_patches_2d", "(", "I", ",", "(", "sz", ",", "sz", ")", ")", "\n", "temp", "=", "temp", ".", "reshape", "(", "(", "temp", ".", "shape", "[", "0", "]", ",", "1", ",", "temp", ".", "shape", "[", "1", "]", ",", "temp", ".", "shape", "[", "2", "]", ")", ")", "\n", "return", "temp", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.im2patch": [[113, 122], ["dsutils.im2patch_len", "numpy.zeros", "range", "range"], "function", ["home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.im2patch_len"], ["", "def", "im2patch", "(", "I", ",", "sz", ",", "szp", ")", ":", "\n", "    ", "delt", ",", "n1", ",", "n2", "=", "im2patch_len", "(", "I", ".", "shape", ",", "sz", ",", "szp", ")", "\n", "idx", "=", "0", "\n", "patches", "=", "np", ".", "zeros", "(", "(", "n1", "*", "n2", ",", "1", ",", "sz", ",", "sz", ")", ")", "\n", "for", "i", "in", "range", "(", "n1", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "n2", ")", ":", "\n", "            ", "patches", "[", "idx", ",", ":", ",", ":", ",", ":", "]", "=", "I", "[", "i", "*", "szp", ":", "i", "*", "szp", "+", "sz", ",", "j", "*", "szp", ":", "j", "*", "szp", "+", "sz", "]", "\n", "idx", "+=", "1", "\n", "", "", "return", "patches", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.im2subpatch": [[123, 132], ["dsutils.im2patch_len", "numpy.zeros", "range", "range"], "function", ["home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.im2patch_len"], ["", "def", "im2subpatch", "(", "I", ",", "sz", ",", "szp", ")", ":", "\n", "    ", "delt", ",", "n1", ",", "n2", "=", "im2patch_len", "(", "I", ".", "shape", ",", "sz", ",", "szp", ")", "\n", "patches", "=", "np", ".", "zeros", "(", "(", "n1", "*", "n2", ",", "1", ",", "szp", ",", "szp", ")", ")", "\n", "idx", "=", "0", "\n", "for", "i", "in", "range", "(", "n1", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "n2", ")", ":", "\n", "            ", "patches", "[", "idx", ",", ":", ",", ":", ",", ":", "]", "=", "I", "[", "i", "*", "szp", "+", "delt", ":", "(", "i", "+", "1", ")", "*", "szp", "+", "delt", ",", "j", "*", "szp", "+", "delt", ":", "(", "j", "+", "1", ")", "*", "szp", "+", "delt", "]", "\n", "idx", "+=", "1", "\n", "", "", "return", "patches", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.patch2im": [[134, 143], ["dsutils.im2patch_len", "numpy.zeros", "range", "range"], "function", ["home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.im2patch_len"], ["", "def", "patch2im", "(", "patches", ",", "imsize", ",", "sz", ",", "szp", ")", ":", "\n", "    ", "delt", ",", "n1", ",", "n2", "=", "im2patch_len", "(", "imsize", ",", "sz", ",", "szp", ")", "\n", "I", "=", "np", ".", "zeros", "(", "imsize", ")", "\n", "idx", "=", "0", "\n", "for", "i", "in", "range", "(", "n1", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "n2", ")", ":", "\n", "            ", "I", "[", "i", "*", "szp", "+", "delt", ":", "(", "i", "+", "1", ")", "*", "szp", "+", "delt", ",", "j", "*", "szp", "+", "delt", ":", "(", "j", "+", "1", ")", "*", "szp", "+", "delt", "]", "=", "patches", "[", "idx", ",", ":", ",", ":", ",", ":", "]", "\n", "idx", "+=", "1", "\n", "", "", "return", "I", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.im2patch_len": [[145, 150], ["int", "int", "int", "numpy.ceil", "numpy.floor", "numpy.floor"], "function", ["None"], ["", "def", "im2patch_len", "(", "imzize", ",", "sz", ",", "szp", ")", ":", "\n", "    ", "delt", "=", "int", "(", "np", ".", "ceil", "(", "(", "sz", "-", "szp", ")", "*", "1.0", "/", "2", ")", ")", "\n", "n1", "=", "int", "(", "np", ".", "floor", "(", "(", "imzize", "[", "0", "]", "-", "2", "*", "delt", ")", "*", "1.0", "/", "szp", ")", ")", "\n", "n2", "=", "int", "(", "np", ".", "floor", "(", "(", "imzize", "[", "1", "]", "-", "2", "*", "delt", ")", "*", "1.0", "/", "szp", ")", ")", "\n", "return", "delt", ",", "n1", ",", "n2", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.apply_model": [[152, 156], ["dsutils.im2patch", "model.predict", "dsutils.patch2im"], "function", ["home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.im2patch", "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.dsutils.patch2im"], ["", "def", "apply_model", "(", "I", ",", "model", ",", "sz", ",", "szp", ")", ":", "\n", "    ", "Ipatch", "=", "im2patch", "(", "I", ",", "sz", ",", "szp", ")", "\n", "Ipred", "=", "model", ".", "predict", "(", "Ipatch", ")", "\n", "return", "patch2im", "(", "Ipred", ",", "I", ".", "shape", ",", "sz", ",", "szp", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.run_deconv_all.get_fname": [[17, 19], ["None"], "function", ["None"], ["def", "get_fname", "(", "method", ",", "n", ",", "npsf", ",", "sigma", ",", "img", ")", ":", "\n", "    ", "return", "'res/{}_{}x{}_PSF{}_sigma{:1.3f}_{}.mat'", ".", "format", "(", "method", ",", "n", ",", "n", ",", "npsf", ",", "sigma", ",", "img", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.rflamary_AstroImageReconsCNN.None.run_deconv_all.get_fname_all": [[20, 22], ["None"], "function", ["None"], ["", "def", "get_fname_all", "(", "method", ",", "n", ",", "npsf", ",", "sigma", ")", ":", "\n", "    ", "return", "'res/{}_{}x{}_PSF{}_sigma{:1.3f}_all.mat'", ".", "format", "(", "method", ",", "n", ",", "n", ",", "npsf", ",", "sigma", ")", "\n", "\n"]]}