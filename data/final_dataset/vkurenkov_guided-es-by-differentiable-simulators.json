{"home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_object": [[5, 8], ["objects.append", "len"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append"], ["def", "add_object", "(", "x", ")", ":", "\n", "    ", "objects", ".", "append", "(", "x", ")", "\n", "return", "len", "(", "objects", ")", "-", "1", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_spring": [[10, 15], ["springs.append"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append"], ["", "def", "add_spring", "(", "a", ",", "b", ",", "length", "=", "None", ",", "stiffness", "=", "1", ",", "actuation", "=", "0.1", ")", ":", "\n", "    ", "if", "length", "==", "None", ":", "\n", "        ", "length", "=", "(", "(", "objects", "[", "a", "]", "[", "0", "]", "-", "objects", "[", "b", "]", "[", "0", "]", ")", "**", "2", "+", "\n", "(", "objects", "[", "a", "]", "[", "1", "]", "-", "objects", "[", "b", "]", "[", "1", "]", ")", "**", "2", ")", "**", "0.5", "\n", "", "springs", ".", "append", "(", "[", "a", ",", "b", ",", "length", ",", "stiffness", ",", "actuation", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.robotA": [[17, 43], ["mass_spring_robot_config.add_object", "mass_spring_robot_config.add_object", "mass_spring_robot_config.add_object", "mass_spring_robot_config.add_object", "mass_spring_robot_config.add_object", "mass_spring_robot_config.add_object", "mass_spring_robot_config.robotA.link"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_object", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_object", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_object", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_object", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_object", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_object"], ["", "def", "robotA", "(", ")", ":", "\n", "    ", "add_object", "(", "[", "0.2", ",", "0.1", "]", ")", "\n", "add_object", "(", "[", "0.3", ",", "0.13", "]", ")", "\n", "add_object", "(", "[", "0.4", ",", "0.1", "]", ")", "\n", "add_object", "(", "[", "0.2", ",", "0.2", "]", ")", "\n", "add_object", "(", "[", "0.3", ",", "0.2", "]", ")", "\n", "add_object", "(", "[", "0.4", ",", "0.2", "]", ")", "\n", "\n", "s", "=", "14000", "\n", "\n", "def", "link", "(", "a", ",", "b", ",", "actuation", "=", "0.1", ")", ":", "\n", "        ", "add_spring", "(", "a", ",", "b", ",", "stiffness", "=", "s", ",", "actuation", "=", "actuation", ")", "\n", "\n", "", "link", "(", "0", ",", "1", ")", "\n", "link", "(", "1", ",", "2", ")", "\n", "link", "(", "3", ",", "4", ")", "\n", "link", "(", "4", ",", "5", ")", "\n", "link", "(", "0", ",", "3", ")", "\n", "link", "(", "2", ",", "5", ")", "\n", "link", "(", "0", ",", "4", ")", "\n", "link", "(", "1", ",", "4", ")", "\n", "link", "(", "2", ",", "4", ")", "\n", "link", "(", "3", ",", "1", ")", "\n", "link", "(", "5", ",", "1", ")", "\n", "\n", "return", "objects", ",", "springs", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_point": [[50, 56], ["mass_spring_robot_config.add_object", "points.append", "point_id.append", "points.index"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_object", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append"], ["def", "add_mesh_point", "(", "i", ",", "j", ")", ":", "\n", "    ", "if", "(", "i", ",", "j", ")", "not", "in", "points", ":", "\n", "        ", "id", "=", "add_object", "(", "(", "i", "*", "0.05", "+", "0.1", ",", "j", "*", "0.05", "+", "0.1", ")", ")", "\n", "points", ".", "append", "(", "(", "i", ",", "j", ")", ")", "\n", "point_id", ".", "append", "(", "id", ")", "\n", "", "return", "point_id", "[", "points", ".", "index", "(", "(", "i", ",", "j", ")", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_spring": [[58, 64], ["mesh_springs.append", "mass_spring_robot_config.add_spring"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_spring"], ["", "def", "add_mesh_spring", "(", "a", ",", "b", ",", "s", ",", "act", ")", ":", "\n", "    ", "if", "(", "a", ",", "b", ")", "in", "mesh_springs", "or", "(", "b", ",", "a", ")", "in", "mesh_springs", ":", "\n", "        ", "return", "\n", "\n", "", "mesh_springs", ".", "append", "(", "(", "a", ",", "b", ")", ")", "\n", "add_spring", "(", "a", ",", "b", ",", "stiffness", "=", "s", ",", "actuation", "=", "act", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square": [[66, 81], ["mass_spring_robot_config.add_mesh_point", "mass_spring_robot_config.add_mesh_point", "mass_spring_robot_config.add_mesh_point", "mass_spring_robot_config.add_mesh_point", "mass_spring_robot_config.add_mesh_spring", "mass_spring_robot_config.add_mesh_spring", "mass_spring_robot_config.add_mesh_spring"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_point", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_point", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_point", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_point", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_spring", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_spring", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_spring"], ["", "def", "add_mesh_square", "(", "i", ",", "j", ",", "actuation", "=", "0.0", ")", ":", "\n", "    ", "a", "=", "add_mesh_point", "(", "i", ",", "j", ")", "\n", "b", "=", "add_mesh_point", "(", "i", ",", "j", "+", "1", ")", "\n", "c", "=", "add_mesh_point", "(", "i", "+", "1", ",", "j", ")", "\n", "d", "=", "add_mesh_point", "(", "i", "+", "1", ",", "j", "+", "1", ")", "\n", "\n", "# b d", "\n", "# a c", "\n", "add_mesh_spring", "(", "a", ",", "b", ",", "3e4", ",", "actuation", ")", "\n", "add_mesh_spring", "(", "c", ",", "d", ",", "3e4", ",", "actuation", ")", "\n", "\n", "for", "i", "in", "[", "a", ",", "b", ",", "c", ",", "d", "]", ":", "\n", "        ", "for", "j", "in", "[", "a", ",", "b", ",", "c", ",", "d", "]", ":", "\n", "            ", "if", "i", "!=", "j", ":", "\n", "                ", "add_mesh_spring", "(", "i", ",", "j", ",", "3e4", ",", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_triangle": [[83, 92], ["mass_spring_robot_config.add_mesh_point", "mass_spring_robot_config.add_mesh_point", "mass_spring_robot_config.add_mesh_point", "mass_spring_robot_config.add_mesh_spring"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_point", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_point", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_point", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_spring"], ["", "", "", "", "def", "add_mesh_triangle", "(", "i", ",", "j", ",", "actuation", "=", "0.0", ")", ":", "\n", "    ", "a", "=", "add_mesh_point", "(", "i", "+", "0.5", ",", "j", "+", "0.5", ")", "\n", "b", "=", "add_mesh_point", "(", "i", ",", "j", "+", "1", ")", "\n", "d", "=", "add_mesh_point", "(", "i", "+", "1", ",", "j", "+", "1", ")", "\n", "\n", "for", "i", "in", "[", "a", ",", "b", ",", "d", "]", ":", "\n", "        ", "for", "j", "in", "[", "a", ",", "b", ",", "d", "]", ":", "\n", "            ", "if", "i", "!=", "j", ":", "\n", "                ", "add_mesh_spring", "(", "i", ",", "j", ",", "3e4", ",", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.robotB": [[94, 106], ["mass_spring_robot_config.add_mesh_triangle", "mass_spring_robot_config.add_mesh_triangle", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_triangle", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_triangle", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square"], ["", "", "", "", "def", "robotB", "(", ")", ":", "\n", "    ", "add_mesh_triangle", "(", "2", ",", "0", ",", "actuation", "=", "0.15", ")", "\n", "add_mesh_triangle", "(", "0", ",", "0", ",", "actuation", "=", "0.15", ")", "\n", "add_mesh_square", "(", "0", ",", "1", ",", "actuation", "=", "0.15", ")", "\n", "add_mesh_square", "(", "0", ",", "2", ")", "\n", "add_mesh_square", "(", "1", ",", "2", ")", "\n", "add_mesh_square", "(", "2", ",", "1", ",", "actuation", "=", "0.15", ")", "\n", "add_mesh_square", "(", "2", ",", "2", ")", "\n", "# add_mesh_square(2, 3)", "\n", "# add_mesh_square(2, 4)", "\n", "\n", "return", "objects", ",", "springs", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.robotC": [[108, 120], ["mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square"], ["", "def", "robotC", "(", ")", ":", "\n", "    ", "add_mesh_square", "(", "2", ",", "0", ",", "actuation", "=", "0.15", ")", "\n", "add_mesh_square", "(", "0", ",", "0", ",", "actuation", "=", "0.15", ")", "\n", "add_mesh_square", "(", "0", ",", "1", ",", "actuation", "=", "0.15", ")", "\n", "add_mesh_square", "(", "0", ",", "2", ")", "\n", "add_mesh_square", "(", "1", ",", "2", ")", "\n", "add_mesh_square", "(", "2", ",", "1", ",", "actuation", "=", "0.15", ")", "\n", "add_mesh_square", "(", "2", ",", "2", ")", "\n", "add_mesh_square", "(", "2", ",", "3", ")", "\n", "add_mesh_square", "(", "2", ",", "4", ")", "\n", "\n", "return", "objects", ",", "springs", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.robotD": [[122, 137], ["mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square", "mass_spring_robot_config.add_mesh_square"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring_robot_config.add_mesh_square"], ["", "def", "robotD", "(", ")", ":", "\n", "    ", "add_mesh_square", "(", "2", ",", "0", ",", "actuation", "=", "0.15", ")", "\n", "add_mesh_square", "(", "0", ",", "0", ",", "actuation", "=", "0.15", ")", "\n", "add_mesh_square", "(", "0", ",", "1", ",", "actuation", "=", "0.15", ")", "\n", "add_mesh_square", "(", "0", ",", "2", ")", "\n", "add_mesh_square", "(", "1", ",", "2", ")", "\n", "add_mesh_square", "(", "2", ",", "1", ",", "actuation", "=", "0.15", ")", "\n", "add_mesh_square", "(", "2", ",", "2", ")", "\n", "add_mesh_square", "(", "2", ",", "3", ")", "\n", "add_mesh_square", "(", "2", ",", "4", ")", "\n", "add_mesh_square", "(", "3", ",", "1", ")", "\n", "add_mesh_square", "(", "4", ",", "0", ",", "actuation", "=", "0.15", ")", "\n", "add_mesh_square", "(", "4", ",", "1", ",", "actuation", "=", "0.15", ")", "\n", "\n", "return", "objects", ",", "springs", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.GuidingBuffer.__init__": [[532, 540], ["numpy.linalg.qr", "q.astype", "numpy.stack().transpose", "numpy.zeros", "numpy.stack"], "methods", ["None"], ["  ", "def", "__init__", "(", "self", ",", "num_params", ",", "size", ")", ":", "\n", "    ", "self", ".", "_replay", "=", "[", "np", ".", "zeros", "(", "num_params", ")", "]", "*", "size", "\n", "self", ".", "_size", "=", "size", "\n", "\n", "self", ".", "_cur_size", "=", "0", "\n", "self", ".", "_index", "=", "0", "\n", "q", ",", "_", "=", "np", ".", "linalg", ".", "qr", "(", "np", ".", "stack", "(", "self", ".", "_replay", ")", ".", "transpose", "(", ")", ")", "\n", "self", ".", "q", "=", "q", ".", "astype", "(", "np", ".", "float32", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.GuidingBuffer.append": [[541, 545], ["min"], "methods", ["None"], ["", "def", "append", "(", "self", ",", "memento", ")", ":", "\n", "    ", "self", ".", "_replay", "[", "self", ".", "_index", "]", "=", "memento", "\n", "self", ".", "_index", "=", "(", "self", ".", "_index", "+", "1", ")", "%", "self", ".", "_size", "\n", "self", ".", "_cur_size", "=", "min", "(", "self", ".", "_cur_size", "+", "1", ",", "self", ".", "_size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.GuidingBuffer.update_orthogonal": [[547, 550], ["numpy.linalg.qr", "q.astype", "numpy.stack().transpose", "numpy.stack"], "methods", ["None"], ["", "def", "update_orthogonal", "(", "self", ")", ":", "\n", "    ", "q", ",", "_", "=", "np", ".", "linalg", ".", "qr", "(", "np", ".", "stack", "(", "self", ".", "_replay", ")", ".", "transpose", "(", ")", ")", "\n", "self", ".", "q", "=", "q", ".", "astype", "(", "np", ".", "float32", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.n_input_states": [[67, 69], ["None"], "function", ["None"], ["def", "n_input_states", "(", ")", ":", "\n", "    ", "return", "n_sin_waves", "+", "4", "*", "n_objects", "+", "2", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.place": [[71, 86], ["taichi.root.dense().dense().place", "taichi.root.dense().place", "taichi.root.dense().place", "taichi.root.dense().place", "taichi.root.dense().place", "taichi.root.dense().place", "taichi.root.dense().place", "taichi.root.dense().place", "taichi.root.dense().place", "taichi.root.place", "taichi.root.lazy_grad", "taichi.root.dense().dense", "taichi.root.dense", "taichi.root.dense", "taichi.root.dense", "taichi.root.dense", "taichi.root.dense", "taichi.root.dense", "taichi.root.dense", "taichi.root.dense", "taichi.root.dense", "mass_spring.n_input_states"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.place", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.place", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.place", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.place", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.place", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.place", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.place", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.place", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.place", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.place", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.n_input_states"], ["", "@", "ti", ".", "layout", "\n", "def", "place", "(", ")", ":", "\n", "    ", "ti", ".", "root", ".", "dense", "(", "ti", ".", "l", ",", "max_steps", ")", ".", "dense", "(", "ti", ".", "i", ",", "n_objects", ")", ".", "place", "(", "x", ",", "v", ",", "v_inc", ")", "\n", "ti", ".", "root", ".", "dense", "(", "ti", ".", "i", ",", "n_springs", ")", ".", "place", "(", "spring_anchor_a", ",", "spring_anchor_b", ",", "\n", "spring_length", ",", "spring_stiffness", ",", "\n", "spring_actuation", ")", "\n", "ti", ".", "root", ".", "dense", "(", "ti", ".", "ij", ",", "(", "n_hidden", ",", "n_input_states", "(", ")", ")", ")", ".", "place", "(", "weights1", ")", "\n", "ti", ".", "root", ".", "dense", "(", "ti", ".", "i", ",", "n_hidden", ")", ".", "place", "(", "bias1", ")", "\n", "ti", ".", "root", ".", "dense", "(", "ti", ".", "ij", ",", "(", "n_springs", ",", "n_hidden", ")", ")", ".", "place", "(", "weights2", ")", "\n", "ti", ".", "root", ".", "dense", "(", "ti", ".", "i", ",", "n_springs", ")", ".", "place", "(", "bias2", ")", "\n", "ti", ".", "root", ".", "dense", "(", "ti", ".", "ij", ",", "(", "max_steps", ",", "n_hidden", ")", ")", ".", "place", "(", "hidden", ")", "\n", "ti", ".", "root", ".", "dense", "(", "ti", ".", "ij", ",", "(", "max_steps", ",", "n_springs", ")", ")", ".", "place", "(", "act", ")", "\n", "ti", ".", "root", ".", "dense", "(", "ti", ".", "i", ",", "max_steps", ")", ".", "place", "(", "center", ")", "\n", "ti", ".", "root", ".", "place", "(", "loss", ",", "goal", ")", "\n", "ti", ".", "root", ".", "lazy_grad", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.compute_center": [[92, 99], ["range", "taichi.Vector", "taichi.static", "range"], "function", ["None"], ["@", "ti", ".", "kernel", "\n", "def", "compute_center", "(", "t", ":", "ti", ".", "i32", ")", ":", "\n", "    ", "for", "_", "in", "range", "(", "1", ")", ":", "\n", "        ", "c", "=", "ti", ".", "Vector", "(", "[", "0.0", ",", "0.0", "]", ")", "\n", "for", "i", "in", "ti", ".", "static", "(", "range", "(", "n_objects", ")", ")", ":", "\n", "            ", "c", "+=", "x", "[", "t", ",", "i", "]", "\n", "", "center", "[", "t", "]", "=", "(", "1.0", "/", "n_objects", ")", "*", "c", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.nn1": [[101, 125], ["range", "taichi.static", "taichi.static", "taichi.tanh", "range", "range", "taichi.sin"], "function", ["None"], ["", "", "@", "ti", ".", "kernel", "\n", "def", "nn1", "(", "t", ":", "ti", ".", "i32", ")", ":", "\n", "    ", "for", "i", "in", "range", "(", "n_hidden", ")", ":", "\n", "        ", "actuation", "=", "0.0", "\n", "for", "j", "in", "ti", ".", "static", "(", "range", "(", "n_sin_waves", ")", ")", ":", "\n", "            ", "actuation", "+=", "weights1", "[", "i", ",", "j", "]", "*", "ti", ".", "sin", "(", "spring_omega", "*", "t", "*", "dt", "+", "\n", "2", "*", "math", ".", "pi", "/", "n_sin_waves", "*", "j", ")", "\n", "", "for", "j", "in", "ti", ".", "static", "(", "range", "(", "n_objects", ")", ")", ":", "\n", "            ", "offset", "=", "x", "[", "t", ",", "j", "]", "-", "center", "[", "t", "]", "\n", "# use a smaller weight since there are too many of them", "\n", "actuation", "+=", "weights1", "[", "i", ",", "j", "*", "4", "+", "n_sin_waves", "]", "*", "offset", "[", "0", "]", "*", "0.05", "\n", "actuation", "+=", "weights1", "[", "i", ",", "\n", "j", "*", "4", "+", "n_sin_waves", "+", "1", "]", "*", "offset", "[", "1", "]", "*", "0.05", "\n", "actuation", "+=", "weights1", "[", "i", ",", "j", "*", "4", "+", "n_sin_waves", "+", "2", "]", "*", "v", "[", "t", ",", "\n", "j", "]", "[", "0", "]", "*", "0.05", "\n", "actuation", "+=", "weights1", "[", "i", ",", "j", "*", "4", "+", "n_sin_waves", "+", "3", "]", "*", "v", "[", "t", ",", "\n", "j", "]", "[", "1", "]", "*", "0.05", "\n", "", "actuation", "+=", "weights1", "[", "i", ",", "n_objects", "*", "4", "+", "\n", "n_sin_waves", "]", "*", "(", "goal", "[", "None", "]", "[", "0", "]", "-", "center", "[", "t", "]", "[", "0", "]", ")", "\n", "actuation", "+=", "weights1", "[", "i", ",", "n_objects", "*", "4", "+", "n_sin_waves", "+", "\n", "1", "]", "*", "(", "goal", "[", "None", "]", "[", "1", "]", "-", "center", "[", "t", "]", "[", "1", "]", ")", "\n", "actuation", "+=", "bias1", "[", "i", "]", "\n", "actuation", "=", "ti", ".", "tanh", "(", "actuation", ")", "\n", "hidden", "[", "t", ",", "i", "]", "=", "actuation", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.nn2": [[127, 136], ["range", "taichi.static", "taichi.tanh", "range"], "function", ["None"], ["", "", "@", "ti", ".", "kernel", "\n", "def", "nn2", "(", "t", ":", "ti", ".", "i32", ")", ":", "\n", "    ", "for", "i", "in", "range", "(", "n_springs", ")", ":", "\n", "        ", "actuation", "=", "0.0", "\n", "for", "j", "in", "ti", ".", "static", "(", "range", "(", "n_hidden", ")", ")", ":", "\n", "            ", "actuation", "+=", "weights2", "[", "i", ",", "j", "]", "*", "hidden", "[", "t", ",", "j", "]", "\n", "", "actuation", "+=", "bias2", "[", "i", "]", "\n", "actuation", "=", "ti", ".", "tanh", "(", "actuation", ")", "\n", "act", "[", "t", ",", "i", "]", "=", "actuation", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.apply_spring_force": [[138, 155], ["range", "taichi.atomic_add", "taichi.atomic_add", "dist.norm"], "function", ["None"], ["", "", "@", "ti", ".", "kernel", "\n", "def", "apply_spring_force", "(", "t", ":", "ti", ".", "i32", ")", ":", "\n", "    ", "for", "i", "in", "range", "(", "n_springs", ")", ":", "\n", "        ", "a", "=", "spring_anchor_a", "[", "i", "]", "\n", "b", "=", "spring_anchor_b", "[", "i", "]", "\n", "pos_a", "=", "x", "[", "t", ",", "a", "]", "\n", "pos_b", "=", "x", "[", "t", ",", "b", "]", "\n", "dist", "=", "pos_a", "-", "pos_b", "\n", "length", "=", "dist", ".", "norm", "(", ")", "+", "1e-4", "\n", "\n", "target_length", "=", "spring_length", "[", "i", "]", "*", "(", "1.0", "+", "\n", "spring_actuation", "[", "i", "]", "*", "act", "[", "t", ",", "i", "]", ")", "\n", "impulse", "=", "dt", "*", "(", "length", "-", "\n", "target_length", ")", "*", "spring_stiffness", "[", "i", "]", "/", "length", "*", "dist", "\n", "\n", "ti", ".", "atomic_add", "(", "v_inc", "[", "t", "+", "1", ",", "a", "]", ",", "-", "impulse", ")", "\n", "ti", ".", "atomic_add", "(", "v_inc", "[", "t", "+", "1", ",", "b", "]", ",", "impulse", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.advance_toi": [[160, 177], ["range", "math.exp", "taichi.Vector", "taichi.Vector"], "function", ["None"], ["@", "ti", ".", "kernel", "\n", "def", "advance_toi", "(", "t", ":", "ti", ".", "i32", ")", ":", "\n", "    ", "for", "i", "in", "range", "(", "n_objects", ")", ":", "\n", "        ", "s", "=", "math", ".", "exp", "(", "-", "dt", "*", "damping", ")", "\n", "old_v", "=", "s", "*", "v", "[", "t", "-", "1", ",", "i", "]", "+", "dt", "*", "gravity", "*", "ti", ".", "Vector", "(", "[", "0.0", ",", "1.0", "\n", "]", ")", "+", "v_inc", "[", "t", ",", "i", "]", "\n", "old_x", "=", "x", "[", "t", "-", "1", ",", "i", "]", "\n", "new_x", "=", "old_x", "+", "dt", "*", "old_v", "\n", "toi", "=", "0.0", "\n", "new_v", "=", "old_v", "\n", "if", "new_x", "[", "1", "]", "<", "ground_height", "and", "old_v", "[", "1", "]", "<", "-", "1e-4", ":", "\n", "            ", "toi", "=", "-", "(", "old_x", "[", "1", "]", "-", "ground_height", ")", "/", "old_v", "[", "1", "]", "\n", "new_v", "=", "ti", ".", "Vector", "(", "[", "0.0", ",", "0.0", "]", ")", "\n", "", "new_x", "=", "old_x", "+", "toi", "*", "old_v", "+", "(", "dt", "-", "toi", ")", "*", "new_v", "\n", "\n", "v", "[", "t", ",", "i", "]", "=", "new_v", "\n", "x", "[", "t", ",", "i", "]", "=", "new_x", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.advance_no_toi": [[179, 195], ["range", "math.exp", "taichi.Vector"], "function", ["None"], ["", "", "@", "ti", ".", "kernel", "\n", "def", "advance_no_toi", "(", "t", ":", "ti", ".", "i32", ")", ":", "\n", "    ", "for", "i", "in", "range", "(", "n_objects", ")", ":", "\n", "        ", "s", "=", "math", ".", "exp", "(", "-", "dt", "*", "damping", ")", "\n", "old_v", "=", "s", "*", "v", "[", "t", "-", "1", ",", "i", "]", "+", "dt", "*", "gravity", "*", "ti", ".", "Vector", "(", "[", "0.0", ",", "1.0", "\n", "]", ")", "+", "v_inc", "[", "t", ",", "i", "]", "\n", "old_x", "=", "x", "[", "t", "-", "1", ",", "i", "]", "\n", "new_v", "=", "old_v", "\n", "depth", "=", "old_x", "[", "1", "]", "-", "ground_height", "\n", "if", "depth", "<", "0", "and", "new_v", "[", "1", "]", "<", "0", ":", "\n", "# friction projection", "\n", "            ", "new_v", "[", "0", "]", "=", "0", "\n", "new_v", "[", "1", "]", "=", "0", "\n", "", "new_x", "=", "old_x", "+", "dt", "*", "new_v", "\n", "v", "[", "t", ",", "i", "]", "=", "new_v", "\n", "x", "[", "t", ",", "i", "]", "=", "new_x", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.compute_loss": [[197, 200], ["None"], "function", ["None"], ["", "", "@", "ti", ".", "kernel", "\n", "def", "compute_loss", "(", "t", ":", "ti", ".", "i32", ")", ":", "\n", "    ", "loss", "[", "None", "]", "=", "-", "x", "[", "t", ",", "head_id", "]", "[", "0", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.forward": [[205, 270], ["range", "mass_spring.compute_loss", "random.random", "os.makedirs", "mass_spring.compute_center", "mass_spring.nn1", "mass_spring.nn2", "mass_spring.apply_spring_force", "mass_spring.advance_toi", "mass_spring.advance_no_toi", "gui.line", "range", "range", "gui.circle", "gui.line", "mass_spring.forward.circle"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.compute_loss", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.compute_center", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.nn1", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.nn2", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.apply_spring_force", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.advance_toi", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.advance_no_toi"], ["", "def", "forward", "(", "output", "=", "None", ",", "visualize", "=", "True", ")", ":", "\n", "    ", "if", "random", ".", "random", "(", ")", ">", "0.5", ":", "\n", "        ", "goal", "[", "None", "]", "=", "[", "0.9", ",", "0.2", "]", "\n", "", "else", ":", "\n", "        ", "goal", "[", "None", "]", "=", "[", "0.1", ",", "0.2", "]", "\n", "", "goal", "[", "None", "]", "=", "[", "0.9", ",", "0.2", "]", "\n", "\n", "interval", "=", "vis_interval", "\n", "if", "output", ":", "\n", "        ", "interval", "=", "output_vis_interval", "\n", "os", ".", "makedirs", "(", "'mass_spring/{}/'", ".", "format", "(", "output", ")", ",", "exist_ok", "=", "True", ")", "\n", "\n", "", "total_steps", "=", "steps", "if", "not", "output", "else", "steps", "*", "2", "\n", "\n", "for", "t", "in", "range", "(", "1", ",", "total_steps", ")", ":", "\n", "        ", "compute_center", "(", "t", "-", "1", ")", "\n", "nn1", "(", "t", "-", "1", ")", "\n", "nn2", "(", "t", "-", "1", ")", "\n", "apply_spring_force", "(", "t", "-", "1", ")", "\n", "if", "use_toi", ":", "\n", "            ", "advance_toi", "(", "t", ")", "\n", "", "else", ":", "\n", "            ", "advance_no_toi", "(", "t", ")", "\n", "\n", "", "if", "(", "t", "+", "1", ")", "%", "interval", "==", "0", "and", "visualize", ":", "\n", "            ", "gui", ".", "line", "(", "begin", "=", "(", "0", ",", "ground_height", ")", ",", "\n", "end", "=", "(", "1", ",", "ground_height", ")", ",", "\n", "color", "=", "0x0", ",", "\n", "radius", "=", "3", ")", "\n", "\n", "def", "circle", "(", "x", ",", "y", ",", "color", ")", ":", "\n", "                ", "gui", ".", "circle", "(", "(", "x", ",", "y", ")", ",", "ti", ".", "rgb_to_hex", "(", "color", ")", ",", "7", ")", "\n", "\n", "", "for", "i", "in", "range", "(", "n_springs", ")", ":", "\n", "\n", "                ", "def", "get_pt", "(", "x", ")", ":", "\n", "                    ", "return", "(", "x", "[", "0", "]", ",", "x", "[", "1", "]", ")", "\n", "\n", "", "a", "=", "act", "[", "t", "-", "1", ",", "i", "]", "*", "0.5", "\n", "r", "=", "2", "\n", "if", "spring_actuation", "[", "i", "]", "==", "0", ":", "\n", "                    ", "a", "=", "0", "\n", "c", "=", "0x222222", "\n", "", "else", ":", "\n", "                    ", "r", "=", "4", "\n", "c", "=", "ti", ".", "rgb_to_hex", "(", "(", "0.5", "+", "a", ",", "0.5", "-", "abs", "(", "a", ")", ",", "0.5", "-", "a", ")", ")", "\n", "", "gui", ".", "line", "(", "begin", "=", "get_pt", "(", "x", "[", "t", ",", "spring_anchor_a", "[", "i", "]", "]", ")", ",", "\n", "end", "=", "get_pt", "(", "x", "[", "t", ",", "spring_anchor_b", "[", "i", "]", "]", ")", ",", "\n", "radius", "=", "r", ",", "\n", "color", "=", "c", ")", "\n", "\n", "", "for", "i", "in", "range", "(", "n_objects", ")", ":", "\n", "                ", "color", "=", "(", "0.4", ",", "0.6", ",", "0.6", ")", "\n", "if", "i", "==", "head_id", ":", "\n", "                    ", "color", "=", "(", "0.8", ",", "0.2", ",", "0.3", ")", "\n", "", "circle", "(", "x", "[", "t", ",", "i", "]", "[", "0", "]", ",", "x", "[", "t", ",", "i", "]", "[", "1", "]", ",", "color", ")", "\n", "# circle(goal[None][0], goal[None][1], (0.6, 0.2, 0.2))", "\n", "\n", "", "if", "output", ":", "\n", "                ", "gui", ".", "show", "(", "'mass_spring/{}/{:04d}.png'", ".", "format", "(", "output", ",", "t", ")", ")", "\n", "", "else", ":", "\n", "                ", "gui", ".", "show", "(", ")", "\n", "\n", "", "", "", "loss", "[", "None", "]", "=", "0", "\n", "compute_loss", "(", "steps", "-", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.clear_states": [[272, 277], ["range", "range", "taichi.Vector"], "function", ["None"], ["", "@", "ti", ".", "kernel", "\n", "def", "clear_states", "(", ")", ":", "\n", "    ", "for", "t", "in", "range", "(", "0", ",", "max_steps", ")", ":", "\n", "        ", "for", "i", "in", "range", "(", "0", ",", "n_objects", ")", ":", "\n", "            ", "v_inc", "[", "t", ",", "i", "]", "=", "ti", ".", "Vector", "(", "[", "0.0", ",", "0.0", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.clear": [[279, 281], ["mass_spring.clear_states"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.clear_states"], ["", "", "", "def", "clear", "(", ")", ":", "\n", "    ", "clear_states", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.setup_robot": [[283, 300], ["len", "len", "print", "range", "range"], "function", ["None"], ["", "def", "setup_robot", "(", "objects", ",", "springs", ")", ":", "\n", "    ", "global", "n_objects", ",", "n_springs", "\n", "n_objects", "=", "len", "(", "objects", ")", "\n", "n_springs", "=", "len", "(", "springs", ")", "\n", "\n", "print", "(", "'n_objects='", ",", "n_objects", ",", "'   n_springs='", ",", "n_springs", ")", "\n", "\n", "for", "i", "in", "range", "(", "n_objects", ")", ":", "\n", "        ", "x", "[", "0", ",", "i", "]", "=", "objects", "[", "i", "]", "\n", "\n", "", "for", "i", "in", "range", "(", "n_springs", ")", ":", "\n", "        ", "s", "=", "springs", "[", "i", "]", "\n", "spring_anchor_a", "[", "i", "]", "=", "s", "[", "0", "]", "\n", "spring_anchor_b", "[", "i", "]", "=", "s", "[", "1", "]", "\n", "spring_length", "[", "i", "]", "=", "s", "[", "2", "]", "\n", "spring_stiffness", "[", "i", "]", "=", "s", "[", "3", "]", "\n", "spring_actuation", "[", "i", "]", "=", "s", "[", "4", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.initialize_weights": [[301, 314], ["range", "range", "range", "range", "mass_spring.n_input_states", "numpy.random.randn", "math.sqrt", "numpy.random.randn", "math.sqrt", "mass_spring.n_input_states"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.n_input_states", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.randn", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.randn", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.n_input_states"], ["", "", "def", "initialize_weights", "(", ")", ":", "\n", "    ", "for", "i", "in", "range", "(", "n_hidden", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "n_input_states", "(", ")", ")", ":", "\n", "            ", "weights1", "[", "i", ",", "j", "]", "=", "np", ".", "random", ".", "randn", "(", ")", "*", "math", ".", "sqrt", "(", "\n", "2", "/", "(", "n_hidden", "+", "n_input_states", "(", ")", ")", ")", "*", "2", "\n", "", "bias1", "[", "i", "]", "=", "0.0", "\n", "\n", "", "for", "i", "in", "range", "(", "n_springs", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "n_hidden", ")", ":", "\n", "# TODO: n_springs should be n_actuators", "\n", "            ", "weights2", "[", "i", ",", "j", "]", "=", "np", ".", "random", ".", "randn", "(", ")", "*", "math", ".", "sqrt", "(", "\n", "2", "/", "(", "n_hidden", "+", "n_springs", ")", ")", "*", "3", "\n", "", "bias2", "[", "i", "]", "=", "0.0", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.update_weights_simple": [[315, 341], ["range", "range", "print", "range", "range", "range", "range", "range", "range", "mass_spring.n_input_states", "mass_spring.n_input_states"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.n_input_states", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.n_input_states"], ["", "", "def", "update_weights_simple", "(", "lr", ")", ":", "\n", "    ", "total_norm_sqr", "=", "0", "\n", "for", "i", "in", "range", "(", "n_hidden", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "n_input_states", "(", ")", ")", ":", "\n", "            ", "total_norm_sqr", "+=", "weights1", ".", "grad", "[", "i", ",", "j", "]", "**", "2", "\n", "", "total_norm_sqr", "+=", "bias1", ".", "grad", "[", "i", "]", "**", "2", "\n", "\n", "", "for", "i", "in", "range", "(", "n_springs", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "n_hidden", ")", ":", "\n", "            ", "total_norm_sqr", "+=", "weights2", ".", "grad", "[", "i", ",", "j", "]", "**", "2", "\n", "", "total_norm_sqr", "+=", "bias2", ".", "grad", "[", "i", "]", "**", "2", "\n", "\n", "", "print", "(", "total_norm_sqr", ")", "\n", "\n", "# scale = learning_rate * min(1.0, gradient_clip / total_norm_sqr ** 0.5)", "\n", "gradient_clip", "=", "0.2", "\n", "scale", "=", "gradient_clip", "/", "(", "total_norm_sqr", "**", "0.5", "+", "1e-6", ")", "\n", "for", "i", "in", "range", "(", "n_hidden", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "n_input_states", "(", ")", ")", ":", "\n", "            ", "weights1", "[", "i", ",", "j", "]", "-=", "scale", "*", "weights1", ".", "grad", "[", "i", ",", "j", "]", "\n", "", "bias1", "[", "i", "]", "-=", "scale", "*", "bias1", ".", "grad", "[", "i", "]", "\n", "\n", "", "for", "i", "in", "range", "(", "n_springs", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "n_hidden", ")", ":", "\n", "            ", "weights2", "[", "i", ",", "j", "]", "-=", "scale", "*", "weights2", ".", "grad", "[", "i", ",", "j", "]", "\n", "", "bias2", "[", "i", "]", "-=", "scale", "*", "bias2", ".", "grad", "[", "i", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.optimize": [[342, 363], ["mass_spring.initialize_weights", "range", "mass_spring.clear", "print", "mass_spring.update_weights_simple", "losses.append", "taichi.Tape", "mass_spring.forward"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_weights", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.clear", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_weights_simple", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPolicy.forward"], ["", "", "def", "optimize", "(", "toi", ",", "visualize", ")", ":", "\n", "    ", "global", "use_toi", "\n", "use_toi", "=", "toi", "\n", "\n", "initialize_weights", "(", ")", "\n", "\n", "losses", "=", "[", "]", "\n", "# forward('initial{}'.format(robot_id), visualize=visualize)", "\n", "for", "iter", "in", "range", "(", "100", ")", ":", "\n", "        ", "clear", "(", ")", "\n", "# with ti.Tape(loss) automatically clears all gradients", "\n", "with", "ti", ".", "Tape", "(", "loss", ")", ":", "\n", "            ", "forward", "(", "visualize", "=", "visualize", ")", "\n", "\n", "", "print", "(", "'Iter='", ",", "iter", ",", "'Loss='", ",", "loss", "[", "None", "]", ")", "\n", "\n", "update_weights_simple", "(", "lr", "=", "None", ")", "\n", "\n", "losses", ".", "append", "(", "loss", "[", "None", "]", ")", "\n", "\n", "", "return", "losses", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.train_taichi": [[365, 399], ["numpy.random.seed", "random.seed", "mass_spring.setup_robot", "mass_spring.initialize_weights", "range", "numpy.save", "mass_spring.clear", "mass_spring.update_weights_simple", "wandb.log", "print", "mass_spring.clear_states", "mass_spring.extract_current_policy", "taichi.Tape", "mass_spring.forward", "numpy.save", "mass_spring.extract_current_policy"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.setup_robot", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_weights", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.clear", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_weights_simple", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.clear_states", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.extract_current_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPolicy.forward", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.extract_current_policy"], ["", "def", "train_taichi", "(", "lr", ",", "seed", ",", "num_iterations", ",", "robot_id", ",", "toi", ")", ":", "\n", "# Fix seeds", "\n", "    ", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "random", ".", "seed", "(", "seed", ")", "\n", "\n", "# Load the robot and check whether to use toi", "\n", "setup_robot", "(", "*", "robots", "[", "robot_id", "]", "(", ")", ")", "\n", "global", "use_toi", "\n", "use_toi", "=", "toi", "\n", "\n", "# Initialize the system and policy", "\n", "initialize_weights", "(", ")", "\n", "\n", "for", "epoch", "in", "range", "(", "num_iterations", ")", ":", "\n", "        ", "clear", "(", ")", "\n", "with", "ti", ".", "Tape", "(", "loss", ")", ":", "\n", "            ", "forward", "(", "visualize", "=", "False", ")", "\n", "\n", "# Optimize", "\n", "", "update_weights_simple", "(", "lr", ")", "\n", "\n", "# Logging", "\n", "wandb", ".", "log", "(", "{", "\"Loss\"", ":", "loss", "[", "None", "]", ",", "\"Num Samples\"", ":", "epoch", "+", "1", "}", ")", "\n", "print", "(", "f\"Epoch: {epoch}; Mean loss: {loss[None]}\"", ")", "\n", "\n", "# Reset", "\n", "clear_states", "(", ")", "\n", "\n", "# Save model at some points", "\n", "if", "epoch", "%", "10", "==", "0", ":", "\n", "            ", "np", ".", "save", "(", "f\"models/policy-{wandb.run.id}\"", ",", "extract_current_policy", "(", ")", ")", "\n", "\n", "# Save the latest model", "\n", "", "", "np", ".", "save", "(", "f\"models/policy-{wandb.run.id}\"", ",", "extract_current_policy", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.extract_current_policy": [[426, 432], ["numpy.hstack", "np_weights.append", "weights.to_numpy().flatten", "weights.to_numpy"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append"], ["def", "extract_current_policy", "(", ")", ":", "\n", "    ", "np_weights", "=", "[", "]", "\n", "for", "weights", "in", "TI_WEIGHTS", ":", "\n", "        ", "np_weights", ".", "append", "(", "weights", ".", "to_numpy", "(", ")", ".", "flatten", "(", ")", ")", "\n", "\n", "", "return", "np", ".", "hstack", "(", "np_weights", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.extract_current_policy_grads": [[433, 439], ["numpy.hstack", "np_grads.append", "weights.grad.to_numpy().flatten", "weights.grad.to_numpy"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append"], ["", "def", "extract_current_policy_grads", "(", ")", ":", "\n", "    ", "np_grads", "=", "[", "]", "\n", "for", "weights", "in", "TI_WEIGHTS", ":", "\n", "        ", "np_grads", ".", "append", "(", "weights", ".", "grad", ".", "to_numpy", "(", ")", ".", "flatten", "(", ")", ")", "\n", "\n", "", "return", "np", ".", "hstack", "(", "np_grads", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.init_zero_gradients": [[440, 442], ["numpy.zeros"], "function", ["None"], ["", "def", "init_zero_gradients", "(", ")", ":", "\n", "    ", "return", "np", ".", "zeros", "(", "NUM_PARAMETERS", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.sample_perturbation": [[443, 450], ["numpy.random.randn", "numpy.random.randn", "numpy.matmul", "numpy.sqrt", "numpy.sqrt", "numpy.random.randn"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.randn", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.randn", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.randn"], ["", "def", "sample_perturbation", "(", "std", ",", "guided_config", "=", "None", ")", ":", "\n", "    ", "if", "guided_config", "is", "None", ":", "\n", "        ", "return", "np", ".", "random", ".", "randn", "(", "NUM_PARAMETERS", ")", "*", "std", "\n", "", "else", ":", "\n", "        ", "perturbation", "=", "std", "*", "np", ".", "sqrt", "(", "guided_config", "[", "\"a\"", "]", "/", "NUM_PARAMETERS", ")", "*", "np", ".", "random", ".", "randn", "(", "NUM_PARAMETERS", ")", "\n", "perturbation", "+=", "std", "*", "np", ".", "sqrt", "(", "(", "1", "-", "guided_config", "[", "\"a\"", "]", ")", "/", "guided_config", "[", "\"k\"", "]", ")", "*", "np", ".", "matmul", "(", "guided_config", "[", "\"u\"", "]", ",", "np", ".", "random", ".", "randn", "(", "guided_config", "[", "\"k\"", "]", ")", ")", "\n", "return", "perturbation", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.set_policy_weights_from_numpy": [[451, 460], ["range", "len", "np_weights[].reshape", "numpy.prod", "TI_WEIGHTS[].from_numpy", "numpy.prod"], "function", ["None"], ["", "", "def", "set_policy_weights_from_numpy", "(", "np_weights", ")", ":", "\n", "    ", "shapes", "=", "[", "w", ".", "shape", "for", "w", "in", "TI_WEIGHTS", "]", "\n", "result", "=", "[", "]", "\n", "prev_ind", "=", "0", "\n", "for", "i", "in", "range", "(", "len", "(", "shapes", ")", ")", ":", "\n", "        ", "np_i_weights", "=", "np_weights", "[", "prev_ind", ":", "prev_ind", "+", "np", ".", "prod", "(", "shapes", "[", "i", "]", ")", "]", ".", "reshape", "(", "shapes", "[", "i", "]", ")", "\n", "prev_ind", "+=", "np", ".", "prod", "(", "shapes", "[", "i", "]", ")", "\n", "\n", "TI_WEIGHTS", "[", "i", "]", ".", "from_numpy", "(", "np_i_weights", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.set_policy_grads_from_numpy": [[461, 469], ["range", "len", "np_grads[].reshape", "numpy.prod", "TI_WEIGHTS[].grad.from_numpy", "numpy.prod"], "function", ["None"], ["", "", "def", "set_policy_grads_from_numpy", "(", "np_grads", ")", ":", "\n", "    ", "shapes", "=", "[", "w", ".", "shape", "for", "w", "in", "TI_WEIGHTS", "]", "\n", "result", "=", "[", "]", "\n", "prev_ind", "=", "0", "\n", "for", "i", "in", "range", "(", "len", "(", "shapes", ")", ")", ":", "\n", "        ", "np_i_grads", "=", "np_grads", "[", "prev_ind", ":", "prev_ind", "+", "np", ".", "prod", "(", "shapes", "[", "i", "]", ")", "]", ".", "reshape", "(", "shapes", "[", "i", "]", ")", "\n", "prev_ind", "+=", "np", ".", "prod", "(", "shapes", "[", "i", "]", ")", "\n", "TI_WEIGHTS", "[", "i", "]", ".", "grad", ".", "from_numpy", "(", "np_i_grads", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.estimate_policy": [[470, 477], ["mass_spring.set_policy_weights_from_numpy", "mass_spring.clear", "mass_spring.forward"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.set_policy_weights_from_numpy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.clear", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPolicy.forward"], ["", "", "def", "estimate_policy", "(", "weights", ")", ":", "\n", "    ", "set_policy_weights_from_numpy", "(", "weights", ")", "\n", "\n", "clear", "(", ")", "\n", "forward", "(", "visualize", "=", "False", ")", "\n", "\n", "return", "loss", "[", "None", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.train_es": [[478, 528], ["numpy.random.seed", "random.seed", "mass_spring.setup_robot", "mass_spring.initialize_weights", "range", "numpy.save", "mass_spring.extract_current_policy", "mass_spring.init_zero_gradients", "range", "mass_spring.set_policy_weights_from_numpy", "mass_spring.set_policy_grads_from_numpy", "mass_spring.update_weights_simple", "wandb.log", "print", "mass_spring.sample_perturbation", "mass_spring.estimate_policy", "mass_spring.estimate_policy", "policy_losses.extend", "numpy.save", "numpy.mean", "numpy.mean"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.setup_robot", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_weights", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.extract_current_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.init_zero_gradients", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.set_policy_weights_from_numpy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.set_policy_grads_from_numpy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_weights_simple", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.sample_perturbation", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.estimate_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.estimate_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean"], ["", "def", "train_es", "(", "lr", ",", "seed", ",", "std", ",", "num_perturbations", ",", "num_iterations", ",", "robot_id", ",", "toi", ")", ":", "\n", "# Fix seeds", "\n", "    ", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "random", ".", "seed", "(", "seed", ")", "\n", "\n", "# Load the robot and check whether to use toi", "\n", "setup_robot", "(", "*", "robots", "[", "robot_id", "]", "(", ")", ")", "\n", "global", "use_toi", "\n", "use_toi", "=", "toi", "\n", "\n", "# Initialize the system and policy", "\n", "initialize_weights", "(", ")", "\n", "\n", "for", "epoch", "in", "range", "(", "num_iterations", ")", ":", "\n", "        ", "policy_weights", "=", "extract_current_policy", "(", ")", "\n", "policy_grads", "=", "init_zero_gradients", "(", ")", "\n", "policy_losses", "=", "[", "]", "\n", "for", "_", "in", "range", "(", "num_perturbations", ")", ":", "\n", "            ", "policy_perturb", "=", "sample_perturbation", "(", "std", "=", "std", ")", "\n", "\n", "# Positive perturbation", "\n", "pos_loss", "=", "estimate_policy", "(", "policy_weights", "+", "policy_perturb", ")", "\n", "\n", "# Negative perturbation", "\n", "neg_loss", "=", "estimate_policy", "(", "policy_weights", "-", "policy_perturb", ")", "\n", "\n", "# Compute grads", "\n", "policy_grads", "+=", "policy_perturb", "*", "(", "pos_loss", "-", "neg_loss", ")", "\n", "\n", "# For logging", "\n", "policy_losses", ".", "extend", "(", "[", "pos_loss", ",", "neg_loss", "]", ")", "\n", "\n", "# Compute grads", "\n", "", "policy_grads", "=", "policy_grads", "/", "(", "2", "*", "std", "**", "2", ")", "\n", "set_policy_weights_from_numpy", "(", "policy_weights", ")", "\n", "set_policy_grads_from_numpy", "(", "policy_grads", ")", "\n", "\n", "# Optimize", "\n", "update_weights_simple", "(", "lr", ")", "\n", "\n", "# Log current loss", "\n", "wandb", ".", "log", "(", "{", "\"Loss\"", ":", "np", ".", "mean", "(", "policy_losses", ")", ",", "\"Num Samples\"", ":", "(", "epoch", "+", "1", ")", "*", "num_perturbations", "*", "2", "}", ")", "\n", "print", "(", "f\"Epoch: {epoch}; Mean loss: {np.mean(policy_losses)}\"", ")", "\n", "\n", "# Save model at some points", "\n", "if", "epoch", "%", "10", "==", "0", ":", "\n", "            ", "np", ".", "save", "(", "f\"models/policy-{wandb.run.id}\"", ",", "policy_weights", ")", "\n", "\n", "# Save the latest model", "\n", "", "", "np", ".", "save", "(", "f\"models/policy-{wandb.run.id}\"", ",", "policy_weights", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.train_guided_es": [[551, 613], ["numpy.random.seed", "random.seed", "mass_spring.setup_robot", "mass_spring.initialize_weights", "mass_spring.GuidingBuffer", "range", "numpy.save", "mass_spring.clear", "mass_spring.GuidingBuffer.append", "mass_spring.GuidingBuffer.update_orthogonal", "mass_spring.extract_current_policy", "mass_spring.init_zero_gradients", "range", "mass_spring.set_policy_weights_from_numpy", "mass_spring.set_policy_grads_from_numpy", "mass_spring.update_weights_simple", "wandb.log", "print", "taichi.Tape", "mass_spring.forward", "mass_spring.extract_current_policy_grads", "mass_spring.sample_perturbation", "mass_spring.estimate_policy", "mass_spring.estimate_policy", "policy_losses.extend", "numpy.save", "numpy.mean", "numpy.mean"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.setup_robot", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_weights", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.mass_spring.mass_spring.clear", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.GuidingBuffer.update_orthogonal", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.extract_current_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.init_zero_gradients", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.set_policy_weights_from_numpy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.set_policy_grads_from_numpy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_weights_simple", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPolicy.forward", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.extract_current_policy_grads", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.sample_perturbation", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.estimate_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.estimate_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean"], ["", "", "def", "train_guided_es", "(", "lr", ",", "seed", ",", "std", ",", "num_perturbations", ",", "k", ",", "alpha", ",", "beta", ",", "num_iterations", ",", "robot_id", ",", "toi", ")", ":", "\n", "# Fix seeds", "\n", "    ", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "random", ".", "seed", "(", "seed", ")", "\n", "\n", "# Load the robot and check whether to use toi", "\n", "setup_robot", "(", "*", "robots", "[", "robot_id", "]", "(", ")", ")", "\n", "global", "use_toi", "\n", "use_toi", "=", "toi", "\n", "\n", "# Initialize the system and policy", "\n", "initialize_weights", "(", ")", "\n", "\n", "# Create buffer for guding distribution", "\n", "guiding_buffer", "=", "GuidingBuffer", "(", "num_params", "=", "NUM_PARAMETERS", ",", "size", "=", "k", ")", "\n", "\n", "# Guided ES", "\n", "for", "epoch", "in", "range", "(", "num_iterations", ")", ":", "\n", "# Update guiding space with taichi gradient", "\n", "        ", "clear", "(", ")", "\n", "with", "ti", ".", "Tape", "(", "loss", ")", ":", "\n", "            ", "forward", "(", "visualize", "=", "False", ")", "\n", "", "guiding_buffer", ".", "append", "(", "extract_current_policy_grads", "(", ")", ")", "\n", "guiding_buffer", ".", "update_orthogonal", "(", ")", "\n", "\n", "# Do ES", "\n", "policy_weights", "=", "extract_current_policy", "(", ")", "\n", "policy_grads", "=", "init_zero_gradients", "(", ")", "\n", "policy_losses", "=", "[", "]", "\n", "for", "_", "in", "range", "(", "num_perturbations", ")", ":", "\n", "            ", "policy_perturb", "=", "sample_perturbation", "(", "std", "=", "std", ",", "guided_config", "=", "{", "\"a\"", ":", "alpha", ",", "\"k\"", ":", "k", ",", "\"u\"", ":", "guiding_buffer", ".", "q", "}", ")", "\n", "\n", "# Positive perturbation", "\n", "pos_loss", "=", "estimate_policy", "(", "policy_weights", "+", "policy_perturb", ")", "\n", "\n", "# Negative perturbation", "\n", "neg_loss", "=", "estimate_policy", "(", "policy_weights", "-", "policy_perturb", ")", "\n", "\n", "# Compute grads", "\n", "policy_grads", "+=", "policy_perturb", "*", "(", "pos_loss", "-", "neg_loss", ")", "\n", "\n", "# For logging", "\n", "policy_losses", ".", "extend", "(", "[", "pos_loss", ",", "neg_loss", "]", ")", "\n", "\n", "# Compute grads", "\n", "", "policy_grads", "=", "(", "beta", "*", "policy_grads", ")", "/", "(", "2", "*", "std", "**", "2", ")", "\n", "set_policy_weights_from_numpy", "(", "policy_weights", ")", "\n", "set_policy_grads_from_numpy", "(", "policy_grads", ")", "\n", "\n", "# Optimize", "\n", "update_weights_simple", "(", "lr", ")", "\n", "\n", "# Log current loss", "\n", "wandb", ".", "log", "(", "{", "\"Loss\"", ":", "np", ".", "mean", "(", "policy_losses", ")", ",", "\"Num Samples\"", ":", "(", "epoch", "+", "1", ")", "*", "num_perturbations", "*", "2", "+", "1", "}", ")", "\n", "print", "(", "f\"Epoch: {epoch}; Mean loss: {np.mean(policy_losses)}\"", ")", "\n", "\n", "# Save model at some points", "\n", "if", "epoch", "%", "10", "==", "0", ":", "\n", "            ", "np", ".", "save", "(", "f\"models/policy-{wandb.run.id}\"", ",", "policy_weights", ")", "\n", "\n", "# Save the latest model", "\n", "", "", "np", ".", "save", "(", "f\"models/policy-{wandb.run.id}\"", ",", "policy_weights", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.GuidingBuffer.__init__": [[731, 740], ["numpy.linalg.qr", "q.astype", "numpy.stack().transpose", "numpy.zeros", "numpy.stack"], "methods", ["None"], ["  ", "def", "__init__", "(", "self", ",", "num_params", ",", "size", ")", ":", "\n", "    ", "self", ".", "_replay", "=", "[", "np", ".", "zeros", "(", "num_params", ")", "]", "*", "size", "\n", "self", ".", "_size", "=", "size", "\n", "self", ".", "_num_params", "=", "num_params", "\n", "\n", "self", ".", "_cur_size", "=", "0", "\n", "self", ".", "_index", "=", "0", "\n", "q", ",", "_", "=", "np", ".", "linalg", ".", "qr", "(", "np", ".", "stack", "(", "self", ".", "_replay", ")", ".", "transpose", "(", ")", ")", "\n", "self", ".", "q", "=", "q", ".", "astype", "(", "np", ".", "float32", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.GuidingBuffer.reset": [[741, 745], ["numpy.zeros"], "methods", ["None"], ["", "def", "reset", "(", "self", ")", ":", "\n", "      ", "self", ".", "_replay", "=", "[", "np", ".", "zeros", "(", "self", ".", "_num_params", ")", "]", "*", "self", ".", "_size", "\n", "self", ".", "_cur_size", "=", "0", "\n", "self", ".", "_index", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.GuidingBuffer.append": [[746, 750], ["min"], "methods", ["None"], ["", "def", "append", "(", "self", ",", "memento", ")", ":", "\n", "    ", "self", ".", "_replay", "[", "self", ".", "_index", "]", "=", "memento", "\n", "self", ".", "_index", "=", "(", "self", ".", "_index", "+", "1", ")", "%", "self", ".", "_size", "\n", "self", ".", "_cur_size", "=", "min", "(", "self", ".", "_cur_size", "+", "1", ",", "self", ".", "_size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.GuidingBuffer.update_orthogonal": [[752, 755], ["numpy.linalg.qr", "q.astype", "numpy.stack().transpose", "numpy.stack"], "methods", ["None"], ["", "def", "update_orthogonal", "(", "self", ")", ":", "\n", "    ", "q", ",", "_", "=", "np", ".", "linalg", ".", "qr", "(", "np", ".", "stack", "(", "self", ".", "_replay", ")", ".", "transpose", "(", ")", ")", "\n", "self", ".", "q", "=", "q", ".", "astype", "(", "np", ".", "float32", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_system_params": [[105, 125], ["None"], "function", ["None"], ["@", "ti", ".", "kernel", "\n", "def", "initialize_system_params", "(", ")", ":", "\n", "# System", "\n", "    ", "g", "[", "None", "]", "=", "9.8", "\n", "l", "[", "None", "]", "=", "0.31", "/", "2.0", "#0.36", "\n", "m", "[", "None", "]", "=", "0.125", "\n", "\n", "# Coefficients", "\n", "J", "[", "None", "]", "=", "0.00475", "#0.0047#0.0045", "\n", "k_j", "[", "None", "]", "=", "0.06499285", "#0.0306", "\n", "k_q", "[", "None", "]", "=", "0.00109", "\n", "if", "args", ".", "env", "==", "\"pendulum\"", ":", "\n", "        ", "k_s", "[", "None", "]", "=", "0.0", "\n", "target_q", "[", "None", "]", "=", "0.0", "\n", "", "elif", "args", ".", "env", "==", "\"jumper\"", ":", "\n", "        ", "k_s", "[", "None", "]", "=", "2.0", "*", "100", "\n", "target_q", "[", "None", "]", "=", "np", ".", "pi", "*", "(", "3.0", "/", "4.0", ")", "\n", "\n", "# Angles", "\n", "", "contact_q", "[", "None", "]", "=", "np", ".", "pi", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_weights": [[126, 160], ["range", "range", "range", "range", "numpy.random.randn", "range", "numpy.random.randn", "range", "numpy.sqrt", "numpy.sqrt", "numpy.sqrt", "numpy.random.randn", "numpy.random.randn", "numpy.random.randn"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.randn", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.randn", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.randn", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.randn", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.randn"], ["", "def", "initialize_weights", "(", ")", ":", "\n", "    ", "for", "i", "in", "range", "(", "INTERNAL_SHAPE", ")", ":", "\n", "# print(np.random.randn())", "\n", "        ", "for", "j", "in", "range", "(", "INPUT_SHAPE", ")", ":", "\n", "            ", "std", "=", "np", ".", "sqrt", "(", "2", "/", "(", "INTERNAL_SHAPE", "+", "INPUT_SHAPE", ")", ")", "\n", "# print(np.random.randn())", "\n", "\n", "weights_1", "[", "i", ",", "j", "]", "=", "np", ".", "random", ".", "randn", "(", ")", "*", "std", "\n", "weights_1_m", "[", "i", ",", "j", "]", "=", "0.0", "\n", "weights_1_v", "[", "i", ",", "j", "]", "=", "0.0", "\n", "# for _ in range()", "\n", "", "bias_1", "[", "i", "]", "=", "np", ".", "random", ".", "randn", "(", ")", "\n", "bias_1_m", "[", "i", "]", "=", "0.0", "\n", "bias_1_v", "[", "i", "]", "=", "0.0", "\n", "\n", "", "for", "i", "in", "range", "(", "INTERNAL_SHAPE", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "INTERNAL_SHAPE", ")", ":", "\n", "            ", "std", "=", "np", ".", "sqrt", "(", "2", "/", "(", "INTERNAL_SHAPE", "+", "INTERNAL_SHAPE", ")", ")", "\n", "weights_2", "[", "i", ",", "j", "]", "=", "np", ".", "random", ".", "randn", "(", ")", "*", "std", "\n", "weights_2_m", "[", "i", ",", "j", "]", "=", "0.0", "\n", "weights_2_v", "[", "i", ",", "j", "]", "=", "0.0", "\n", "", "bias_2", "[", "i", "]", "=", "np", ".", "random", ".", "randn", "(", ")", "\n", "bias_2_m", "[", "i", "]", "=", "0.0", "\n", "bias_2_v", "[", "i", "]", "=", "0.0", "\n", "\n", "", "for", "i", "in", "range", "(", "OUTPUT_SHAPE", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "INTERNAL_SHAPE", ")", ":", "\n", "            ", "std", "=", "np", ".", "sqrt", "(", "2", "/", "(", "INTERNAL_SHAPE", "+", "OUTPUT_SHAPE", ")", ")", "\n", "weights_3", "[", "i", ",", "j", "]", "=", "np", ".", "random", ".", "randn", "(", ")", "*", "std", "\n", "weights_3_m", "[", "i", ",", "j", "]", "=", "0.0", "\n", "weights_3_v", "[", "i", ",", "j", "]", "=", "0.0", "\n", "", "bias_3", "[", "i", "]", "=", "0.0", "#np.random.randn()", "\n", "bias_3_m", "[", "i", "]", "=", "0.0", "\n", "bias_3_v", "[", "i", "]", "=", "0.0", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_normalization_buffers": [[162, 169], ["utils.RunningStat", "range"], "function", ["None"], ["", "", "def", "initialize_normalization_buffers", "(", ")", ":", "\n", "    ", "global", "normalization_stat", "\n", "normalization_stat", "=", "RunningStat", "(", "shape", "=", "INPUT_SHAPE", ",", "eps", "=", "1e-2", ")", "\n", "mean", ",", "std", "=", "normalization_stat", ".", "mean", ",", "normalization_stat", ".", "std", "\n", "for", "i", "in", "range", "(", "INPUT_SHAPE", ")", ":", "\n", "        ", "normalized_inp_mean", "[", "i", "]", "=", "mean", "[", "i", "]", "\n", "normalized_inp_std", "[", "i", "]", "=", "std", "[", "i", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_normalization_buffers": [[170, 180], ["range", "range", "numpy.array", "normalization_stat.increment"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.increment"], ["", "", "def", "update_normalization_buffers", "(", ")", ":", "\n", "    ", "if", "args", ".", "obs_normalize", "and", "not", "args", ".", "real", ":", "\n", "        ", "for", "t", "in", "range", "(", "3", ",", "SIMULATION_TRAINING_STEPS", "-", "1", ")", ":", "\n", "            ", "inp", "=", "np", ".", "array", "(", "[", "q_1", "[", "t", "]", ",", "dq_1", "[", "t", "]", ",", "q_1", "[", "t", "-", "1", "]", ",", "dq_1", "[", "t", "-", "1", "]", ",", "q_1", "[", "t", "-", "2", "]", ",", "dq_1", "[", "t", "-", "2", "]", ",", "q_1", "[", "t", "-", "3", "]", ",", "dq_1", "[", "t", "-", "3", "]", "]", ")", "\n", "normalization_stat", ".", "increment", "(", "s", "=", "inp", ",", "ssq", "=", "inp", "**", "2", ",", "c", "=", "1", ")", "\n", "\n", "", "mean", ",", "std", "=", "normalization_stat", ".", "mean", ",", "normalization_stat", ".", "std", "\n", "for", "i", "in", "range", "(", "INPUT_SHAPE", ")", ":", "\n", "            ", "normalized_inp_mean", "[", "i", "]", "=", "mean", "[", "i", "]", "\n", "normalized_inp_std", "[", "i", "]", "=", "std", "[", "i", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.relu": [[181, 185], ["taichi.max"], "function", ["None"], ["", "", "", "@", "ti", ".", "func", "\n", "def", "relu", "(", "x", ":", "ti", ".", "f32", ")", "->", "ti", ".", "f32", ":", "\n", "# print(x)", "\n", "    ", "return", "ti", ".", "max", "(", "0", ",", "x", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.clamp": [[186, 201], ["min", "max"], "function", ["None"], ["", "@", "ti", ".", "func", "\n", "def", "clamp", "(", "x", ",", "xmin", ":", "ti", ".", "f32", ",", "xmax", "=", "ti", ".", "f32", ")", ":", "\n", "    ", "'''\n    Constrain a value to lie between two further values.\n    `clamp` returns the value of x constrained to the range xmin to xmax.\n    :parameter x:\n        Specify the value to constrain.\n    :parameter xmin:\n        Specify the lower end of the range into which to constrain x.\n    :parameter xmax:\n        Specify the upper end of the range into which to constrain x.\n    :return:\n        The returned value is computed as `min(xmax, max(xmin, x))`.\n    '''", "\n", "return", "min", "(", "xmax", ",", "max", "(", "xmin", ",", "x", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.sigmoid": [[202, 205], ["taichi.exp", "taichi.exp"], "function", ["None"], ["", "@", "ti", ".", "func", "\n", "def", "sigmoid", "(", "x", ":", "ti", ".", "f32", ")", "->", "ti", ".", "f32", ":", "\n", "    ", "return", "ti", ".", "exp", "(", "x", ")", "/", "(", "ti", ".", "exp", "(", "x", ")", "+", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.randn": [[206, 211], ["taichi.sqrt", "taichi.cos", "taichi.log", "taichi.random", "taichi.random"], "function", ["None"], ["", "@", "ti", ".", "func", "\n", "def", "randn", "(", "mean", "=", "0.0", ",", "std", "=", "1.0", ")", ":", "\n", "    ", "pi", "=", "3.1415926535", "\n", "n_distributed", "=", "ti", ".", "sqrt", "(", "-", "2", "*", "ti", ".", "log", "(", "ti", ".", "random", "(", ")", ")", ")", "*", "ti", ".", "cos", "(", "2", "*", "pi", "*", "ti", ".", "random", "(", ")", ")", "\n", "return", "mean", "+", "std", "*", "n_distributed", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.layer1_forward": [[212, 229], ["range", "taichi.tanh"], "function", ["None"], ["", "@", "ti", ".", "kernel", "\n", "def", "layer1_forward", "(", "t", ":", "ti", ".", "i32", ")", ":", "\n", "    ", "for", "i", "in", "range", "(", "INTERNAL_SHAPE", ")", ":", "\n", "        ", "pi", "=", "3.1415926535", "\n", "activation", "=", "0.0", "\n", "activation", "+=", "weights_1", "[", "i", ",", "0", "]", "*", "(", "q_1", "[", "t", "]", "-", "normalized_inp_mean", "[", "0", "]", ")", "/", "normalized_inp_std", "[", "0", "]", "\n", "activation", "+=", "weights_1", "[", "i", ",", "1", "]", "*", "(", "dq_1", "[", "t", "]", "-", "normalized_inp_mean", "[", "1", "]", ")", "/", "normalized_inp_std", "[", "1", "]", "\n", "activation", "+=", "weights_1", "[", "i", ",", "2", "]", "*", "(", "q_1", "[", "t", "-", "1", "]", "-", "normalized_inp_mean", "[", "2", "]", ")", "/", "normalized_inp_std", "[", "2", "]", "\n", "activation", "+=", "weights_1", "[", "i", ",", "3", "]", "*", "(", "dq_1", "[", "t", "-", "1", "]", "-", "normalized_inp_mean", "[", "3", "]", ")", "/", "normalized_inp_std", "[", "3", "]", "\n", "activation", "+=", "weights_1", "[", "i", ",", "4", "]", "*", "(", "q_1", "[", "t", "-", "2", "]", "-", "normalized_inp_mean", "[", "4", "]", ")", "/", "normalized_inp_std", "[", "4", "]", "\n", "activation", "+=", "weights_1", "[", "i", ",", "5", "]", "*", "(", "dq_1", "[", "t", "-", "2", "]", "-", "normalized_inp_mean", "[", "5", "]", ")", "/", "normalized_inp_std", "[", "5", "]", "\n", "activation", "+=", "weights_1", "[", "i", ",", "6", "]", "*", "(", "q_1", "[", "t", "-", "3", "]", "-", "normalized_inp_mean", "[", "6", "]", ")", "/", "normalized_inp_std", "[", "6", "]", "\n", "activation", "+=", "weights_1", "[", "i", ",", "7", "]", "*", "(", "dq_1", "[", "t", "-", "3", "]", "-", "normalized_inp_mean", "[", "7", "]", ")", "/", "normalized_inp_std", "[", "7", "]", "\n", "\n", "activation", "+=", "bias_1", "[", "i", "]", "\n", "activation", "=", "ti", ".", "tanh", "(", "activation", ")", "\n", "internal1", "[", "t", ",", "i", "]", "=", "activation", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.layer2_forward": [[230, 238], ["range", "taichi.static", "taichi.tanh", "range"], "function", ["None"], ["", "", "@", "ti", ".", "kernel", "\n", "def", "layer2_forward", "(", "t", ":", "ti", ".", "i32", ")", ":", "\n", "    ", "for", "i", "in", "range", "(", "INTERNAL_SHAPE", ")", ":", "\n", "        ", "activation", "=", "0.0", "\n", "for", "j", "in", "ti", ".", "static", "(", "range", "(", "INTERNAL_SHAPE", ")", ")", ":", "\n", "            ", "activation", "+=", "weights_2", "[", "i", ",", "j", "]", "*", "internal1", "[", "t", ",", "j", "]", "\n", "", "activation", "+=", "bias_2", "[", "i", "]", "\n", "internal2", "[", "t", ",", "i", "]", "=", "ti", ".", "tanh", "(", "activation", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.layer3_forward": [[239, 257], ["range", "taichi.static", "range", "taichi.tanh", "train.clamp", "train.sigmoid", "train.clamp"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.clamp", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.sigmoid", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.clamp"], ["", "", "@", "ti", ".", "kernel", "\n", "def", "layer3_forward", "(", "t", ":", "ti", ".", "i32", ")", ":", "\n", "    ", "for", "i", "in", "range", "(", "OUTPUT_SHAPE", ")", ":", "\n", "        ", "activation", "=", "0.0", "\n", "for", "j", "in", "ti", ".", "static", "(", "range", "(", "INTERNAL_SHAPE", ")", ")", ":", "\n", "            ", "activation", "+=", "weights_3", "[", "i", ",", "j", "]", "*", "internal2", "[", "t", ",", "j", "]", "\n", "", "activation", "+=", "bias_3", "[", "i", "]", "\n", "\n", "if", "args", ".", "env", "==", "\"pendulum\"", ":", "\n", "            ", "if", "args", ".", "smooth", ":", "\n", "                ", "u", "[", "t", "]", "=", "ti", ".", "tanh", "(", "activation", ")", "\n", "", "else", ":", "\n", "                ", "u", "[", "t", "]", "=", "clamp", "(", "activation", ",", "-", "1", ",", "1", ")", "\n", "", "", "elif", "args", ".", "env", "==", "\"jumper\"", ":", "\n", "            ", "if", "args", ".", "smooth", ":", "\n", "                ", "u", "[", "t", "]", "=", "sigmoid", "(", "activation", ")", "\n", "", "else", ":", "\n", "                ", "u", "[", "t", "]", "=", "clamp", "(", "activation", ",", "0", ",", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.cost_function_energy": [[258, 265], ["range", "taichi.sin"], "function", ["None"], ["", "", "", "", "@", "ti", ".", "kernel", "\n", "def", "cost_function_energy", "(", ")", ":", "\n", "    ", "for", "t", "in", "range", "(", "SIMULATION_TRAINING_STEPS", "-", "1", ")", ":", "\n", "        ", "target_energy", "=", "m", "*", "g", "*", "ti", ".", "sin", "(", "target_q", ")", "*", "l", "\n", "# current_energy = 0.5 * J * dq_1[t]**2 + 0.5 * m * g * ti.sin(q_1[t]) * l", "\n", "# print(current_energy)", "\n", "loss", "[", "None", "]", "+=", "(", "energy", "[", "t", "]", "-", "target_energy", ")", "**", "2", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.cost_function_position": [[266, 272], ["range"], "function", ["None"], ["", "", "@", "ti", ".", "kernel", "\n", "def", "cost_function_position", "(", ")", ":", "\n", "    ", "for", "t", "in", "range", "(", "SIMULATION_TRAINING_STEPS", "-", "1", ")", ":", "\n", "        ", "target_position", "=", "target_q", "\n", "current_position", "=", "q_1", "[", "t", "]", "\n", "loss", "[", "None", "]", "+=", "(", "current_position", "-", "target_position", ")", "**", "2", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.compute_energy": [[273, 277], ["taichi.sin"], "function", ["None"], ["", "", "@", "ti", ".", "kernel", "\n", "def", "compute_energy", "(", "t", ":", "ti", ".", "i32", ")", ":", "\n", "# Compute energy", "\n", "    ", "energy", "[", "t", "]", "=", "0.5", "*", "J", "*", "dq_1", "[", "t", "]", "**", "2", "+", "m", "*", "g", "*", "ti", ".", "sin", "(", "q_1", "[", "t", "]", ")", "*", "l", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.simulate_dynamics": [[279, 291], ["taichi.cos", "taichi.cos"], "function", ["None"], ["", "@", "ti", ".", "kernel", "\n", "def", "simulate_dynamics", "(", "t", ":", "ti", ".", "i32", ")", ":", "\n", "# No contact", "\n", "    ", "if", "q_1", "[", "t", "]", "<", "contact_q", ":", "\n", "        ", "ddq_1", "[", "t", "]", "=", "(", "k_j", "*", "u", "[", "t", "]", "-", "m", "*", "g", "*", "l", "*", "ti", ".", "cos", "(", "q_1", "[", "t", "]", ")", "-", "k_q", "*", "dq_1", "[", "t", "]", ")", "/", "J", "\n", "# Contact", "\n", "", "else", ":", "\n", "        ", "ddq_1", "[", "t", "]", "=", "(", "k_j", "*", "u", "[", "t", "]", "-", "m", "*", "g", "*", "l", "*", "ti", ".", "cos", "(", "q_1", "[", "t", "]", ")", "-", "k_q", "*", "dq_1", "[", "t", "]", "-", "k_s", "*", "(", "q_1", "[", "t", "]", "-", "contact_q", ")", ")", "/", "J", "\n", "\n", "# Semi-implicit euler", "\n", "", "dq_1", "[", "t", "+", "1", "]", "=", "dq_1", "[", "t", "]", "+", "ddq_1", "[", "t", "]", "*", "dt", "\n", "q_1", "[", "t", "+", "1", "]", "=", "q_1", "[", "t", "]", "+", "dq_1", "[", "t", "+", "1", "]", "*", "dt", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.clear_states": [[292, 306], ["range", "train.randn"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.randn"], ["", "@", "ti", ".", "kernel", "\n", "def", "clear_states", "(", ")", ":", "\n", "    ", "for", "i", "in", "range", "(", "SIMULATION_TRAINING_STEPS", ")", ":", "\n", "        ", "if", "args", ".", "env", "==", "\"pendulum\"", ":", "\n", "            ", "q_1", "[", "i", "]", "=", "1.5", "*", "np", ".", "pi", "\n", "", "elif", "args", ".", "env", "==", "\"jumper\"", ":", "\n", "            ", "q_1", "[", "i", "]", "=", "np", ".", "pi", "/", "1.5", "\n", "\n", "", "dq_1", "[", "i", "]", "=", "0.0", "\n", "ddq_1", "[", "i", "]", "=", "0.0", "\n", "energy", "[", "i", "]", "=", "0.0", "\n", "u", "[", "i", "]", "=", "0.0", "\n", "time", "[", "i", "]", "=", "i", "\n", "rand_force", "[", "i", "]", "=", "randn", "(", "0.0", ",", "0.001", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.forward": [[307, 322], ["range", "train.compute_energy", "train.simulate_dynamics", "train.layer1_forward", "train.layer2_forward", "train.layer3_forward", "print", "train.render", "train.cost_function_energy"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.compute_energy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.simulate_dynamics", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.layer1_forward", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.layer2_forward", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.layer3_forward", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.render", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.cost_function_energy"], ["", "", "def", "forward", "(", "loss_func", ",", "visualize", "=", "False", ")", ":", "\n", "    ", "loss", "[", "None", "]", "=", "0.0", "\n", "for", "t", "in", "range", "(", "SIMULATION_TRAINING_STEPS", "-", "1", ")", ":", "\n", "        ", "compute_energy", "(", "t", ")", "\n", "if", "t", ">", "3", ":", "\n", "            ", "layer1_forward", "(", "t", ")", "\n", "layer2_forward", "(", "t", ")", "\n", "layer3_forward", "(", "t", ")", "\n", "", "simulate_dynamics", "(", "t", ")", "\n", "\n", "if", "visualize", ":", "\n", "            ", "print", "(", "f\"Timestep: {t}; U: {u[t]}; Q: {q_1[t]}; dQ: {dq_1[t]}\"", ")", "\n", "render", "(", "t", ")", "\n", "\n", "", "", "loss_func", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.forward_real": [[323, 336], ["real_env.reset", "real_env.cost", "real_policy.forward", "real_env.step", "all_observations.append"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPendulum.reset", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPendulum.cost", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPolicy.forward", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPendulum.step", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append"], ["", "def", "forward_real", "(", ")", ":", "\n", "    ", "obs", "=", "real_env", ".", "reset", "(", ")", "\n", "all_observations", "=", "[", "]", "\n", "done", "=", "False", "\n", "t", "=", "0", "\n", "while", "not", "done", ":", "\n", "        ", "action", "=", "real_policy", ".", "forward", "(", "obs", ")", "\n", "obs", ",", "done", "=", "real_env", ".", "step", "(", "action", ")", "\n", "all_observations", ".", "append", "(", "obs", ")", "\n", "\n", "# print(f\"Timestep: {t}; U: {action}; Q: {obs[0]}; dQ: {obs[1]}\")", "\n", "t", "+=", "1", "\n", "", "return", "real_env", ".", "cost", "(", "all_observations", ",", "cost", "=", "args", ".", "loss", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_layer_weights_fromage": [[337, 373], ["range", "numpy.sqrt", "numpy.sqrt", "range", "range", "range", "numpy.sqrt", "numpy.sqrt"], "function", ["None"], ["", "def", "update_layer_weights_fromage", "(", "weights", ",", "bias", ",", "lr", ")", ":", "\n", "    ", "\"\"\"\n    https://jeremybernste.in/blog/getting-to-the-bottom\n    https://github.com/jxbz/fromage/blob/master/fromage.py\n    \"\"\"", "\n", "# Compute layer norm", "\n", "layer_norm", "=", "0.0", "\n", "layer_grad_norm", "=", "0.0", "\n", "for", "i", "in", "range", "(", "weights", ".", "shape", "[", "0", "]", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "weights", ".", "shape", "[", "1", "]", ")", ":", "\n", "            ", "layer_norm", "+=", "weights", "[", "i", ",", "j", "]", "**", "2", "\n", "layer_grad_norm", "+=", "weights", ".", "grad", "[", "i", ",", "j", "]", "**", "2", "\n", "", "layer_norm", "+=", "bias", "[", "i", "]", "**", "2", "\n", "layer_grad_norm", "+=", "bias", ".", "grad", "[", "i", "]", "**", "2", "\n", "\n", "", "layer_norm", "=", "np", ".", "sqrt", "(", "layer_norm", ")", "\n", "layer_grad_norm", "=", "np", ".", "sqrt", "(", "layer_grad_norm", ")", "\n", "\n", "#print(f\"Layer norm: {layer_norm}; Layer grad norm: {layer_grad_norm}\")", "\n", "\n", "# Fromage update", "\n", "for", "i", "in", "range", "(", "weights", ".", "shape", "[", "0", "]", ")", ":", "\n", "# Weights update", "\n", "        ", "for", "j", "in", "range", "(", "weights", ".", "shape", "[", "1", "]", ")", ":", "\n", "            ", "if", "layer_norm", ">", "0", "and", "layer_grad_norm", ">", "0", ":", "\n", "                ", "weights", "[", "i", ",", "j", "]", "+=", "-", "lr", "*", "(", "weights", ".", "grad", "[", "i", ",", "j", "]", ")", "*", "(", "layer_norm", ")", "/", "(", "layer_grad_norm", ")", "\n", "", "else", ":", "\n", "                ", "weights", "[", "i", ",", "j", "]", "+=", "-", "lr", "*", "(", "weights", ".", "grad", "[", "i", ",", "j", "]", ")", "\n", "", "weights", "[", "i", ",", "j", "]", "*=", "1.0", "/", "np", ".", "sqrt", "(", "1", "+", "lr", "**", "2", ")", "\n", "\n", "# Bias update", "\n", "", "if", "layer_norm", ">", "0", "and", "layer_grad_norm", ">", "0", ":", "\n", "            ", "bias", "[", "i", "]", "+=", "-", "lr", "*", "(", "bias", ".", "grad", "[", "i", "]", ")", "*", "(", "layer_norm", ")", "/", "(", "layer_grad_norm", ")", "\n", "", "else", ":", "\n", "            ", "bias", "[", "i", "]", "+=", "-", "lr", "*", "(", "bias", ".", "grad", "[", "i", "]", ")", "\n", "", "bias", "[", "i", "]", "*=", "1.0", "/", "np", ".", "sqrt", "(", "1", "+", "lr", "**", "2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_layer_weights_adam": [[374, 402], ["range", "range", "pow", "pow", "numpy.sqrt", "pow", "pow", "numpy.sqrt"], "function", ["None"], ["", "", "def", "update_layer_weights_adam", "(", "weights", ",", "bias", ",", "m_w", ",", "m_b", ",", "v_w", ",", "v_b", ",", "epoch", ",", "lr", ",", "b1", "=", "0.9", ",", "b2", "=", "0.99", ")", ":", "\n", "    ", "for", "i", "in", "range", "(", "weights", ".", "shape", "[", "0", "]", ")", ":", "\n", "# Weights update", "\n", "        ", "for", "j", "in", "range", "(", "weights", ".", "shape", "[", "1", "]", ")", ":", "\n", "# Compute first and second moment", "\n", "            ", "m_w", "[", "i", ",", "j", "]", "=", "b1", "*", "m_w", "[", "i", ",", "j", "]", "+", "(", "1.0", "-", "b1", ")", "*", "weights", ".", "grad", "[", "i", ",", "j", "]", "\n", "v_w", "[", "i", ",", "j", "]", "=", "b2", "*", "v_w", "[", "i", ",", "j", "]", "+", "(", "1.0", "-", "b2", ")", "*", "weights", ".", "grad", "[", "i", ",", "j", "]", "**", "2", "\n", "\n", "# Compute the gradient based on the first and second moments", "\n", "m_hat", "=", "m_w", "[", "i", ",", "j", "]", "/", "(", "1", "-", "pow", "(", "b1", ",", "epoch", ")", ")", "\n", "v_hat", "=", "v_w", "[", "i", ",", "j", "]", "/", "(", "1", "-", "pow", "(", "b2", ",", "epoch", ")", ")", "\n", "grad", "=", "lr", "/", "np", ".", "sqrt", "(", "v_hat", "+", "1e-6", ")", "*", "m_hat", "\n", "\n", "# Apply gradient", "\n", "weights", "[", "i", ",", "j", "]", "-=", "grad", "\n", "\n", "# Bias update", "\n", "# Compute first and second moment", "\n", "", "m_b", "[", "i", "]", "=", "b1", "*", "m_b", "[", "i", "]", "+", "(", "1.0", "-", "b1", ")", "*", "bias", ".", "grad", "[", "i", "]", "\n", "v_b", "[", "i", "]", "=", "b2", "*", "v_b", "[", "i", "]", "+", "(", "1.0", "-", "b2", ")", "*", "bias", ".", "grad", "[", "i", "]", "**", "2", "\n", "\n", "# Compute the gradient based on the first and second moments", "\n", "m_hat", "=", "m_b", "[", "i", "]", "/", "(", "1", "-", "pow", "(", "b1", ",", "epoch", ")", ")", "\n", "v_hat", "=", "v_b", "[", "i", "]", "/", "(", "1", "-", "pow", "(", "b2", ",", "epoch", ")", ")", "\n", "grad", "=", "lr", "/", "np", ".", "sqrt", "(", "v_hat", "+", "1e-6", ")", "*", "m_hat", "\n", "\n", "# Apply gradient", "\n", "bias", "[", "i", "]", "-=", "grad", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_weights_simple": [[403, 428], ["train.update_layer_weights_fromage", "train.update_layer_weights_fromage", "train.update_layer_weights_fromage", "train.update_layer_weights_adam", "train.update_layer_weights_adam", "train.update_layer_weights_adam", "range", "range", "range", "range", "range", "range"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_layer_weights_fromage", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_layer_weights_fromage", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_layer_weights_fromage", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_layer_weights_adam", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_layer_weights_adam", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_layer_weights_adam"], ["", "", "def", "update_weights_simple", "(", "lr", ":", "ti", ".", "f32", ",", "epoch", ")", ":", "\n", "    ", "if", "args", ".", "optimizer", "==", "\"fromage\"", ":", "\n", "        ", "update_layer_weights_fromage", "(", "weights", "=", "weights_1", ",", "bias", "=", "bias_1", ",", "lr", "=", "lr", ")", "\n", "update_layer_weights_fromage", "(", "weights", "=", "weights_2", ",", "bias", "=", "bias_2", ",", "lr", "=", "lr", ")", "\n", "update_layer_weights_fromage", "(", "weights", "=", "weights_3", ",", "bias", "=", "bias_3", ",", "lr", "=", "lr", ")", "\n", "", "elif", "args", ".", "optimizer", "==", "\"adam\"", ":", "\n", "        ", "update_layer_weights_adam", "(", "weights", "=", "weights_1", ",", "bias", "=", "bias_1", ",", "m_w", "=", "weights_1_m", ",", "m_b", "=", "bias_1_m", ",", "v_w", "=", "weights_1_v", ",", "v_b", "=", "bias_1_v", ",", "epoch", "=", "epoch", "+", "1", ",", "lr", "=", "lr", ")", "\n", "update_layer_weights_adam", "(", "weights", "=", "weights_2", ",", "bias", "=", "bias_2", ",", "m_w", "=", "weights_2_m", ",", "m_b", "=", "bias_2_m", ",", "v_w", "=", "weights_2_v", ",", "v_b", "=", "bias_2_v", ",", "epoch", "=", "epoch", "+", "1", ",", "lr", "=", "lr", ")", "\n", "update_layer_weights_adam", "(", "weights", "=", "weights_3", ",", "bias", "=", "bias_3", ",", "m_w", "=", "weights_3_m", ",", "m_b", "=", "bias_3_m", ",", "v_w", "=", "weights_3_v", ",", "v_b", "=", "bias_3_v", ",", "epoch", "=", "epoch", "+", "1", ",", "lr", "=", "lr", ")", "\n", "", "elif", "args", ".", "optimizer", "==", "\"sgd\"", ":", "\n", "        ", "for", "i", "in", "range", "(", "INTERNAL_SHAPE", ")", ":", "\n", "            ", "for", "j", "in", "range", "(", "INPUT_SHAPE", ")", ":", "\n", "                ", "weights_1", "[", "i", ",", "j", "]", "-=", "lr", "*", "weights_1", ".", "grad", "[", "i", ",", "j", "]", "\n", "\n", "", "bias_1", "[", "i", "]", "-=", "lr", "*", "bias_1", ".", "grad", "[", "i", "]", "\n", "\n", "", "for", "i", "in", "range", "(", "INTERNAL_SHAPE", ")", ":", "\n", "            ", "for", "j", "in", "range", "(", "INTERNAL_SHAPE", ")", ":", "\n", "                ", "weights_2", "[", "i", ",", "j", "]", "-=", "lr", "*", "weights_2", ".", "grad", "[", "i", ",", "j", "]", "\n", "", "bias_2", "[", "i", "]", "-=", "lr", "*", "bias_2", ".", "grad", "[", "i", "]", "\n", "\n", "", "for", "i", "in", "range", "(", "OUTPUT_SHAPE", ")", ":", "\n", "            ", "for", "j", "in", "range", "(", "INTERNAL_SHAPE", ")", ":", "\n", "                ", "weights_3", "[", "i", ",", "j", "]", "-=", "lr", "*", "weights_3", ".", "grad", "[", "i", ",", "j", "]", "\n", "", "bias_3", "[", "i", "]", "-=", "lr", "*", "bias_3", ".", "grad", "[", "i", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.normalize_grads": [[429, 463], ["range", "numpy.sqrt", "numpy.sqrt", "range", "range", "range"], "function", ["None"], ["", "", "", "def", "normalize_grads", "(", "weights", ",", "bias", ")", ":", "\n", "    ", "\"\"\"\n    https://jeremybernste.in/blog/getting-to-the-bottom\n    https://github.com/jxbz/fromage/blob/master/fromage.py\n    \"\"\"", "\n", "# Compute layer norm", "\n", "layer_norm", "=", "0.0", "\n", "layer_grad_norm", "=", "0.0", "\n", "for", "i", "in", "range", "(", "weights", ".", "shape", "[", "0", "]", ")", ":", "\n", "        ", "for", "j", "in", "range", "(", "weights", ".", "shape", "[", "1", "]", ")", ":", "\n", "            ", "layer_norm", "+=", "weights", "[", "i", ",", "j", "]", "**", "2", "\n", "layer_grad_norm", "+=", "weights", ".", "grad", "[", "i", ",", "j", "]", "**", "2", "\n", "", "layer_norm", "+=", "bias", "[", "i", "]", "**", "2", "\n", "layer_grad_norm", "+=", "bias", ".", "grad", "[", "i", "]", "**", "2", "\n", "\n", "", "layer_norm", "=", "np", ".", "sqrt", "(", "layer_norm", ")", "\n", "layer_grad_norm", "=", "np", ".", "sqrt", "(", "layer_grad_norm", ")", "\n", "\n", "#print(f\"Layer norm: {layer_norm}; Layer grad norm: {layer_grad_norm}\")", "\n", "\n", "# Fromage update", "\n", "for", "i", "in", "range", "(", "weights", ".", "shape", "[", "0", "]", ")", ":", "\n", "# Weights update", "\n", "        ", "for", "j", "in", "range", "(", "weights", ".", "shape", "[", "1", "]", ")", ":", "\n", "            ", "if", "layer_norm", ">", "0", "and", "layer_grad_norm", ">", "0", ":", "\n", "                ", "weights", ".", "grad", "[", "i", ",", "j", "]", "=", "(", "weights", ".", "grad", "[", "i", ",", "j", "]", ")", "*", "(", "layer_norm", ")", "/", "(", "layer_grad_norm", ")", "\n", "", "else", ":", "\n", "                ", "weights", ".", "grad", "[", "i", ",", "j", "]", "=", "(", "weights", ".", "grad", "[", "i", ",", "j", "]", ")", "\n", "\n", "# Bias update", "\n", "", "", "if", "layer_norm", ">", "0", "and", "layer_grad_norm", ">", "0", ":", "\n", "            ", "bias", ".", "grad", "[", "i", "]", "=", "(", "bias", ".", "grad", "[", "i", "]", ")", "*", "(", "layer_norm", ")", "/", "(", "layer_grad_norm", ")", "\n", "", "else", ":", "\n", "            ", "bias", ".", "grad", "[", "i", "]", "=", "(", "bias", ".", "grad", "[", "i", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.normalize_all_grads": [[464, 468], ["train.normalize_grads", "train.normalize_grads", "train.normalize_grads"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.normalize_grads", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.normalize_grads", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.normalize_grads"], ["", "", "", "def", "normalize_all_grads", "(", ")", ":", "\n", "    ", "normalize_grads", "(", "weights_1", ",", "bias_1", ")", "\n", "normalize_grads", "(", "weights_2", ",", "bias_2", ")", "\n", "normalize_grads", "(", "weights_3", ",", "bias_3", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.render": [[471, 510], ["gym.envs.classic_control.rendering.Transform", "rendering.Viewer.draw_polygon", "viewer.draw_polygon.add_attr", "viewer.draw_polygon.set_color", "rendering.Viewer.draw_circle", "viewer.draw_circle.set_color", "viewer.draw_circle.add_attr", "gym.envs.classic_control.rendering.Transform", "rendering.Viewer.draw_circle", "viewer.draw_circle.set_color", "viewer.draw_circle.add_attr", "gym.envs.classic_control.rendering.Transform", "rendering.Viewer.draw_circle", "viewer.draw_circle.set_color", "viewer.draw_circle.add_attr", "rendering.Viewer.render", "gym.envs.classic_control.rendering.Viewer", "rendering.Viewer.set_bounds", "numpy.cos", "numpy.sin", "numpy.cos", "numpy.sin", "numpy.cos", "numpy.sin"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.render"], ["def", "render", "(", "t", ",", "mode", "=", "'human'", ")", ":", "\n", "    ", "global", "viewer", "\n", "\n", "if", "viewer", "is", "None", ":", "\n", "        ", "viewer", "=", "rendering", ".", "Viewer", "(", "500", ",", "500", ")", "\n", "bound", "=", "l", "[", "None", "]", "*", "1.4", "\n", "viewer", ".", "set_bounds", "(", "-", "bound", ",", "bound", ",", "-", "bound", ",", "bound", ")", "\n", "\n", "# Reference width", "\n", "", "WIDTH", "=", "0.05", "\n", "\n", "# Link position in the frame", "\n", "origin_point", "=", "(", "0", ",", "0", ")", "\n", "end_point", "=", "(", "l", "[", "None", "]", "*", "np", ".", "cos", "(", "q_1", "[", "t", "]", ")", ",", "l", "[", "None", "]", "*", "np", ".", "sin", "(", "q_1", "[", "t", "]", ")", ")", "\n", "\n", "# Draw the link", "\n", "transform", "=", "rendering", ".", "Transform", "(", "rotation", "=", "q_1", "[", "t", "]", ",", "translation", "=", "origin_point", ")", "\n", "link", "=", "viewer", ".", "draw_polygon", "(", "[", "(", "0", ",", "-", "WIDTH", ")", ",", "(", "0", ",", "WIDTH", ")", ",", "(", "l", "[", "None", "]", ",", "WIDTH", ")", ",", "(", "l", "[", "None", "]", ",", "-", "WIDTH", ")", "]", ")", "\n", "link", ".", "add_attr", "(", "transform", ")", "\n", "link", ".", "set_color", "(", "0", ",", "0.8", ",", "0.8", ")", "\n", "\n", "# Draw a circle about the origin of the link", "\n", "circ", "=", "viewer", ".", "draw_circle", "(", "WIDTH", ")", "\n", "circ", ".", "set_color", "(", "0.8", ",", "0.8", ",", "0.0", ")", "\n", "circ", ".", "add_attr", "(", "transform", ")", "\n", "\n", "# Draw a circle about the target angle", "\n", "target_transform", "=", "rendering", ".", "Transform", "(", "translation", "=", "(", "l", "[", "None", "]", "*", "np", ".", "cos", "(", "target_q", "[", "None", "]", ")", ",", "l", "[", "None", "]", "*", "np", ".", "sin", "(", "target_q", "[", "None", "]", ")", ")", ")", "\n", "target_circ", "=", "viewer", ".", "draw_circle", "(", "WIDTH", "/", "1.25", ")", "\n", "target_circ", ".", "set_color", "(", "1.0", ",", "0.0", ",", "0.0", ")", "\n", "target_circ", ".", "add_attr", "(", "target_transform", ")", "\n", "\n", "# Draw a contact circle", "\n", "contact_transform", "=", "rendering", ".", "Transform", "(", "translation", "=", "(", "l", "[", "None", "]", "*", "np", ".", "cos", "(", "contact_q", "[", "None", "]", ")", ",", "l", "[", "None", "]", "*", "np", ".", "sin", "(", "contact_q", "[", "None", "]", ")", ")", ")", "\n", "contact_circ", "=", "viewer", ".", "draw_circle", "(", "WIDTH", "/", "1.25", ")", "\n", "contact_circ", ".", "set_color", "(", "0.0", ",", "0.0", ",", "1.0", ")", "\n", "contact_circ", ".", "add_attr", "(", "contact_transform", ")", "\n", "\n", "return", "viewer", ".", "render", "(", "return_rgb_array", "=", "mode", "==", "'rgb_array'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.train_taichi": [[512, 558], ["numpy.random.seed", "random.seed", "train.initialize_weights", "train.initialize_system_params", "train.initialize_normalization_buffers", "train.clear_states", "range", "numpy.save", "Exception", "train.set_policy_weights_from_numpy", "train.update_normalization_buffers", "train.update_weights_simple", "wandb.log", "print", "train.clear_states", "train.extract_current_policy", "numpy.load", "taichi.Tape", "train.forward", "numpy.save", "train.extract_current_policy", "time.asctime"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_weights", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_system_params", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_normalization_buffers", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.clear_states", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.set_policy_weights_from_numpy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_normalization_buffers", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_weights_simple", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.clear_states", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.extract_current_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPolicy.forward", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.extract_current_policy"], ["", "def", "train_taichi", "(", "lr", ",", "seed", ",", "loss_func", ",", "num_iterations", ",", "real_robot", "=", "False", ",", "resume", "=", "None", ")", ":", "\n", "# Direct training on real robot with this method is impossible", "\n", "    ", "if", "real_robot", ":", "\n", "        ", "raise", "Exception", "(", "\"Direct training on real robot directly using differentiable robot simulator is not possible.\"", ")", "\n", "\n", "", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "random", ".", "seed", "(", "seed", ")", "\n", "\n", "initialize_weights", "(", ")", "\n", "initialize_system_params", "(", ")", "\n", "initialize_normalization_buffers", "(", ")", "\n", "clear_states", "(", ")", "\n", "\n", "# Load policy to resume the training", "\n", "if", "resume", "is", "not", "None", ":", "\n", "        ", "set_policy_weights_from_numpy", "(", "np", ".", "load", "(", "resume", ")", ")", "\n", "\n", "# Save best policies", "\n", "", "best_loss", "=", "10000000", "\n", "\n", "for", "epoch", "in", "range", "(", "num_iterations", ")", ":", "\n", "        ", "with", "ti", ".", "Tape", "(", "loss", ")", ":", "\n", "            ", "forward", "(", "loss_func", ",", "visualize", "=", "False", ")", "\n", "\n", "# Update normalization buffers", "\n", "", "update_normalization_buffers", "(", ")", "\n", "\n", "# Optimize", "\n", "update_weights_simple", "(", "lr", ",", "epoch", "=", "epoch", ")", "\n", "\n", "# Logging", "\n", "average_loss", "=", "loss", "[", "None", "]", "\n", "wandb", ".", "log", "(", "{", "\"Loss\"", ":", "average_loss", ",", "\"Min Loss\"", ":", "average_loss", ",", "\"Num Samples\"", ":", "(", "epoch", "+", "1", ")", "}", ")", "\n", "print", "(", "f\"Epoch: {epoch}; Mean loss: {loss[None]}; Time: {ptime.asctime()}\"", ")", "\n", "\n", "# Reset", "\n", "clear_states", "(", ")", "\n", "\n", "# Save best model", "\n", "if", "average_loss", "<", "best_loss", "and", "epoch", "%", "1", "==", "0", ":", "\n", "            ", "best_loss", "=", "average_loss", "\n", "np", ".", "save", "(", "f\"models/{wandb.run.id}/best-policy-{wandb.run.id}-{average_loss}\"", ",", "extract_current_policy", "(", ")", ")", "\n", "\n", "\n", "# Save the latest model", "\n", "", "", "np", ".", "save", "(", "f\"models/{wandb.run.id}/latest-policy-{wandb.run.id}\"", ",", "extract_current_policy", "(", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.extract_current_policy": [[564, 573], ["weights_1.to_numpy", "weights_2.to_numpy", "weights_3.to_numpy", "bias_1.to_numpy", "bias_2.to_numpy", "bias_3.to_numpy", "numpy.hstack", "weights_1.to_numpy.flatten", "weights_2.to_numpy.flatten", "weights_3.to_numpy.flatten", "bias_1.to_numpy.flatten", "bias_2.to_numpy.flatten", "bias_3.to_numpy.flatten"], "function", ["None"], ["def", "extract_current_policy", "(", ")", ":", "\n", "    ", "w1", "=", "weights_1", ".", "to_numpy", "(", ")", "\n", "w2", "=", "weights_2", ".", "to_numpy", "(", ")", "\n", "w3", "=", "weights_3", ".", "to_numpy", "(", ")", "\n", "b1", "=", "bias_1", ".", "to_numpy", "(", ")", "\n", "b2", "=", "bias_2", ".", "to_numpy", "(", ")", "\n", "b3", "=", "bias_3", ".", "to_numpy", "(", ")", "\n", "\n", "return", "np", ".", "hstack", "(", "[", "w1", ".", "flatten", "(", ")", ",", "w2", ".", "flatten", "(", ")", ",", "w3", ".", "flatten", "(", ")", ",", "b1", ".", "flatten", "(", ")", ",", "b2", ".", "flatten", "(", ")", ",", "b3", ".", "flatten", "(", ")", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.extract_current_policy_grads": [[574, 583], ["weights_1.grad.to_numpy", "weights_2.grad.to_numpy", "weights_3.grad.to_numpy", "bias_1.grad.to_numpy", "bias_2.grad.to_numpy", "bias_3.grad.to_numpy", "numpy.hstack", "weights_1.grad.to_numpy.flatten", "weights_2.grad.to_numpy.flatten", "weights_3.grad.to_numpy.flatten", "bias_1.grad.to_numpy.flatten", "bias_2.grad.to_numpy.flatten", "bias_3.grad.to_numpy.flatten"], "function", ["None"], ["", "def", "extract_current_policy_grads", "(", ")", ":", "\n", "    ", "w1g", "=", "weights_1", ".", "grad", ".", "to_numpy", "(", ")", "\n", "w2g", "=", "weights_2", ".", "grad", ".", "to_numpy", "(", ")", "\n", "w3g", "=", "weights_3", ".", "grad", ".", "to_numpy", "(", ")", "\n", "b1g", "=", "bias_1", ".", "grad", ".", "to_numpy", "(", ")", "\n", "b2g", "=", "bias_2", ".", "grad", ".", "to_numpy", "(", ")", "\n", "b3g", "=", "bias_3", ".", "grad", ".", "to_numpy", "(", ")", "\n", "\n", "return", "np", ".", "hstack", "(", "[", "w1g", ".", "flatten", "(", ")", ",", "w2g", ".", "flatten", "(", ")", ",", "w3g", ".", "flatten", "(", ")", ",", "b1g", ".", "flatten", "(", ")", ",", "b2g", ".", "flatten", "(", ")", ",", "b3g", ".", "flatten", "(", ")", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.init_zero_gradients": [[584, 586], ["numpy.zeros"], "function", ["None"], ["", "def", "init_zero_gradients", "(", ")", ":", "\n", "    ", "return", "np", ".", "zeros", "(", "NUM_PARAMETERS", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.sample_perturbation": [[587, 594], ["numpy.random.randn", "numpy.random.randn", "numpy.matmul", "numpy.sqrt", "numpy.sqrt", "numpy.random.randn"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.randn", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.randn", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.randn"], ["", "def", "sample_perturbation", "(", "std", ",", "guided_config", "=", "None", ")", ":", "\n", "    ", "if", "guided_config", "is", "None", ":", "\n", "        ", "return", "np", ".", "random", ".", "randn", "(", "NUM_PARAMETERS", ")", "*", "std", "\n", "", "else", ":", "\n", "        ", "perturbation", "=", "std", "*", "np", ".", "sqrt", "(", "guided_config", "[", "\"a\"", "]", "/", "NUM_PARAMETERS", ")", "*", "np", ".", "random", ".", "randn", "(", "NUM_PARAMETERS", ")", "\n", "perturbation", "+=", "std", "*", "np", ".", "sqrt", "(", "(", "1", "-", "guided_config", "[", "\"a\"", "]", ")", "/", "guided_config", "[", "\"k\"", "]", ")", "*", "np", ".", "matmul", "(", "guided_config", "[", "\"u\"", "]", ",", "np", ".", "random", ".", "randn", "(", "guided_config", "[", "\"k\"", "]", ")", ")", "\n", "return", "perturbation", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.set_policy_weights_from_numpy": [[595, 609], ["range", "weights_1.from_numpy", "weights_2.from_numpy", "weights_3.from_numpy", "bias_1.from_numpy", "bias_2.from_numpy", "bias_3.from_numpy", "len", "result.append", "numpy.prod", "weights[].reshape", "numpy.prod"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append"], ["", "", "def", "set_policy_weights_from_numpy", "(", "weights", ")", ":", "\n", "    ", "shapes", "=", "[", "weights_1", ".", "shape", ",", "weights_2", ".", "shape", ",", "weights_3", ".", "shape", ",", "bias_1", ".", "shape", ",", "bias_2", ".", "shape", ",", "bias_3", ".", "shape", "]", "\n", "result", "=", "[", "]", "\n", "prev_ind", "=", "0", "\n", "for", "i", "in", "range", "(", "len", "(", "shapes", ")", ")", ":", "\n", "        ", "result", ".", "append", "(", "weights", "[", "prev_ind", ":", "prev_ind", "+", "np", ".", "prod", "(", "shapes", "[", "i", "]", ")", "]", ".", "reshape", "(", "shapes", "[", "i", "]", ")", ")", "\n", "prev_ind", "+=", "np", ".", "prod", "(", "shapes", "[", "i", "]", ")", "\n", "\n", "", "weights_1", ".", "from_numpy", "(", "result", "[", "0", "]", ")", "\n", "weights_2", ".", "from_numpy", "(", "result", "[", "1", "]", ")", "\n", "weights_3", ".", "from_numpy", "(", "result", "[", "2", "]", ")", "\n", "bias_1", ".", "from_numpy", "(", "result", "[", "3", "]", ")", "\n", "bias_2", ".", "from_numpy", "(", "result", "[", "4", "]", ")", "\n", "bias_3", ".", "from_numpy", "(", "result", "[", "5", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.set_policy_grads_from_numpy": [[610, 624], ["range", "weights_1.grad.from_numpy", "weights_2.grad.from_numpy", "weights_3.grad.from_numpy", "bias_1.grad.from_numpy", "bias_2.grad.from_numpy", "bias_3.grad.from_numpy", "len", "result.append", "numpy.prod", "grads[].reshape", "numpy.prod"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append"], ["", "def", "set_policy_grads_from_numpy", "(", "grads", ")", ":", "\n", "    ", "shapes", "=", "[", "weights_1", ".", "shape", ",", "weights_2", ".", "shape", ",", "weights_3", ".", "shape", ",", "bias_1", ".", "shape", ",", "bias_2", ".", "shape", ",", "bias_3", ".", "shape", "]", "\n", "result", "=", "[", "]", "\n", "prev_ind", "=", "0", "\n", "for", "i", "in", "range", "(", "len", "(", "shapes", ")", ")", ":", "\n", "        ", "result", ".", "append", "(", "grads", "[", "prev_ind", ":", "prev_ind", "+", "np", ".", "prod", "(", "shapes", "[", "i", "]", ")", "]", ".", "reshape", "(", "shapes", "[", "i", "]", ")", ")", "\n", "prev_ind", "+=", "np", ".", "prod", "(", "shapes", "[", "i", "]", ")", "\n", "\n", "", "weights_1", ".", "grad", ".", "from_numpy", "(", "result", "[", "0", "]", ")", "\n", "weights_2", ".", "grad", ".", "from_numpy", "(", "result", "[", "1", "]", ")", "\n", "weights_3", ".", "grad", ".", "from_numpy", "(", "result", "[", "2", "]", ")", "\n", "bias_1", ".", "grad", ".", "from_numpy", "(", "result", "[", "3", "]", ")", "\n", "bias_2", ".", "grad", ".", "from_numpy", "(", "result", "[", "4", "]", ")", "\n", "bias_3", ".", "grad", ".", "from_numpy", "(", "result", "[", "5", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.estimate_policy": [[625, 636], ["real_policy.set_weights", "train.forward_real", "train.set_policy_weights_from_numpy", "train.clear_states", "train.forward"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPolicy.set_weights", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.forward_real", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.set_policy_weights_from_numpy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.clear_states", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPolicy.forward"], ["", "def", "estimate_policy", "(", "weights", ",", "loss_func", ",", "real_robot", "=", "False", ")", ":", "\n", "    ", "if", "real_robot", ":", "\n", "        ", "real_policy", ".", "set_weights", "(", "weights", ")", "\n", "cost", "=", "forward_real", "(", ")", "\n", "return", "cost", "\n", "", "else", ":", "\n", "        ", "set_policy_weights_from_numpy", "(", "weights", ")", "\n", "clear_states", "(", ")", "\n", "forward", "(", "loss_func", ")", "\n", "\n", "return", "loss", "[", "None", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.train_es": [[637, 727], ["numpy.random.seed", "random.seed", "train.initialize_weights", "train.initialize_system_params", "train.initialize_normalization_buffers", "range", "numpy.save", "train.set_policy_weights_from_numpy", "train.extract_current_policy", "train.init_zero_gradients", "range", "numpy.save", "numpy.mean", "numpy.copy", "range", "numpy.save", "train.set_policy_weights_from_numpy", "train.set_policy_grads_from_numpy", "train.update_weights_simple", "numpy.mean", "wandb.log", "print", "numpy.load", "cur_costs.append", "train.sample_perturbation", "train.estimate_policy", "train.update_normalization_buffers", "train.estimate_policy", "train.update_normalization_buffers", "policy_losses.extend", "numpy.mean", "range", "train.estimate_policy", "numpy.copy", "numpy.copy", "min_costs.append", "numpy.mean", "numpy.std", "numpy.mean", "numpy.std", "numpy.mean", "train.estimate_policy", "numpy.mean", "numpy.mean", "time.asctime"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_weights", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_system_params", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_normalization_buffers", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.set_policy_weights_from_numpy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.extract_current_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.init_zero_gradients", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.set_policy_weights_from_numpy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.set_policy_grads_from_numpy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_weights_simple", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.sample_perturbation", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.estimate_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_normalization_buffers", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.estimate_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_normalization_buffers", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.estimate_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.std", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.std", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.estimate_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean"], ["", "", "def", "train_es", "(", "lr", ",", "seed", ",", "loss_func", ",", "std", ",", "num_perturbations", ",", "num_iterations", ",", "real_robot", "=", "False", ",", "resume", "=", "None", ",", "num_evals", "=", "1", ")", ":", "\n", "# Fix seeds", "\n", "    ", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "random", ".", "seed", "(", "seed", ")", "\n", "\n", "# Log best policy", "\n", "best_loss", "=", "1000000", "\n", "\n", "# Initialize the system and policy", "\n", "initialize_weights", "(", ")", "\n", "initialize_system_params", "(", ")", "\n", "initialize_normalization_buffers", "(", ")", "\n", "\n", "# Load policy to resume the training", "\n", "if", "resume", "is", "not", "None", ":", "\n", "        ", "set_policy_weights_from_numpy", "(", "np", ".", "load", "(", "resume", ")", ")", "\n", "\n", "", "for", "epoch", "in", "range", "(", "num_iterations", ")", ":", "\n", "        ", "policy_weights", "=", "extract_current_policy", "(", ")", "\n", "policy_grads", "=", "init_zero_gradients", "(", ")", "\n", "policy_losses", "=", "[", "]", "\n", "\n", "# Evaluate current policy and save it", "\n", "cur_costs", "=", "[", "]", "\n", "for", "_", "in", "range", "(", "num_evals", ")", ":", "\n", "            ", "cur_costs", ".", "append", "(", "estimate_policy", "(", "weights", "=", "policy_weights", ",", "loss_func", "=", "loss_func", ",", "real_robot", "=", "real_robot", ")", ")", "\n", "", "np", ".", "save", "(", "f\"models/{wandb.run.id}/epoch{epoch}-cur-{wandb.run.id}-{np.mean(cur_costs)}\"", ",", "policy_weights", ")", "\n", "\n", "# Find current smallest loss", "\n", "cur_best_loss", "=", "np", ".", "mean", "(", "cur_costs", ")", "\n", "cur_best_weights", "=", "np", ".", "copy", "(", "policy_weights", ")", "\n", "\n", "# Compute perturbations", "\n", "for", "_", "in", "range", "(", "num_perturbations", ")", ":", "\n", "            ", "policy_perturb", "=", "sample_perturbation", "(", "std", "=", "std", ")", "\n", "\n", "# Positive perturbation", "\n", "pos_loss", "=", "estimate_policy", "(", "policy_weights", "+", "policy_perturb", ",", "loss_func", "=", "loss_func", ",", "real_robot", "=", "real_robot", ")", "\n", "# Save best model", "\n", "if", "pos_loss", "<", "cur_best_loss", ":", "\n", "                ", "cur_best_loss", "=", "pos_loss", "\n", "cur_best_weights", "=", "np", ".", "copy", "(", "policy_weights", "+", "policy_perturb", ")", "\n", "", "update_normalization_buffers", "(", ")", "\n", "\n", "# Negative perturbation", "\n", "neg_loss", "=", "estimate_policy", "(", "policy_weights", "-", "policy_perturb", ",", "loss_func", "=", "loss_func", ",", "real_robot", "=", "real_robot", ")", "\n", "# Save best model", "\n", "if", "neg_loss", "<", "cur_best_loss", ":", "\n", "                ", "cur_best_loss", "=", "neg_loss", "\n", "cur_best_weights", "=", "np", ".", "copy", "(", "policy_weights", "-", "policy_perturb", ")", "\n", "", "update_normalization_buffers", "(", ")", "\n", "\n", "# Compute grads", "\n", "policy_grads", "+=", "policy_perturb", "*", "(", "pos_loss", "-", "neg_loss", ")", "\n", "# print(pos_loss - neg_loss)", "\n", "\n", "# For logging", "\n", "policy_losses", ".", "extend", "(", "[", "pos_loss", ",", "neg_loss", "]", ")", "\n", "\n", "# Evaluate current smallest loss and save it", "\n", "", "min_costs", "=", "[", "]", "\n", "if", "np", ".", "mean", "(", "cur_costs", ")", ">", "cur_best_loss", ":", "\n", "            ", "for", "_", "in", "range", "(", "num_evals", ")", ":", "\n", "                ", "min_costs", ".", "append", "(", "estimate_policy", "(", "weights", "=", "cur_best_weights", ",", "loss_func", "=", "loss_func", ",", "real_robot", "=", "real_robot", ")", ")", "\n", "", "", "else", ":", "\n", "            ", "min_costs", "=", "cur_costs", "\n", "", "np", ".", "save", "(", "f\"models/{wandb.run.id}/epoch{epoch}-min-{wandb.run.id}-{np.mean(min_costs)}\"", ",", "cur_best_weights", ")", "\n", "\n", "# Compute grads", "\n", "policy_grads", "=", "policy_grads", "/", "(", "2", "*", "std", "**", "2", "*", "num_perturbations", ")", "\n", "set_policy_weights_from_numpy", "(", "policy_weights", ")", "\n", "set_policy_grads_from_numpy", "(", "policy_grads", ")", "\n", "\n", "# Optimize", "\n", "update_weights_simple", "(", "lr", ",", "epoch", "=", "epoch", ")", "\n", "\n", "# Log current loss", "\n", "average_loss", "=", "np", ".", "mean", "(", "policy_losses", ")", "\n", "wandb", ".", "log", "(", "{", "\n", "\"Loss\"", ":", "average_loss", ",", "\n", "\"Min Loss\"", ":", "np", ".", "mean", "(", "min_costs", ")", ",", "\n", "\"Min Loss Std\"", ":", "np", ".", "std", "(", "min_costs", ")", ",", "\n", "\"Centroid Loss\"", ":", "np", ".", "mean", "(", "cur_costs", ")", ",", "\n", "\"Centroid Loss Std\"", ":", "np", ".", "std", "(", "cur_costs", ")", ",", "\n", "\"Num Samples\"", ":", "(", "epoch", "+", "1", ")", "*", "num_perturbations", "*", "2", ",", "\n", "}", ")", "\n", "print", "(", "f\"Epoch: {epoch}; Mean loss: {np.mean(policy_losses)}; Time: {ptime.asctime()}\"", ")", "\n", "\n", "# Save the latest model", "\n", "", "np", ".", "save", "(", "f\"models/{wandb.run.id}/latest-policy-{wandb.run.id}\"", ",", "policy_weights", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.compute_difsim_gradient": [[756, 791], ["train.clear_states", "train.extract_current_policy_grads", "train.extract_current_policy", "range", "train.extract_current_policy", "taichi.Tape", "train.forward", "train.clear_states", "train.update_normalization_buffers", "taichi.Tape", "train.forward", "NotImplementedError", "train.update_weights_simple"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.clear_states", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.extract_current_policy_grads", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.extract_current_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.extract_current_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPolicy.forward", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.clear_states", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_normalization_buffers", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPolicy.forward", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_weights_simple"], ["", "", "def", "compute_difsim_gradient", "(", "n_steps", ",", "loss_func", ",", "lr", ")", ":", "\n", "    ", "\"\"\"\n    Side-effect: Does not restore the starting point of the shooting.\n    So you need to do it after yourself.\n    \"\"\"", "\n", "if", "n_steps", "==", "0", ":", "\n", "        ", "clear_states", "(", ")", "\n", "with", "ti", ".", "Tape", "(", "loss", ")", ":", "\n", "            ", "forward", "(", "loss_func", ",", "visualize", "=", "False", ")", "\n", "\n", "", "return", "extract_current_policy_grads", "(", ")", "\n", "", "else", ":", "\n", "# Starting point of shooting", "\n", "        ", "start_weights", "=", "extract_current_policy", "(", ")", "\n", "\n", "# Do n optimization steps", "\n", "for", "step", "in", "range", "(", "n_steps", ")", ":", "\n", "            ", "clear_states", "(", ")", "\n", "with", "ti", ".", "Tape", "(", "loss", ")", ":", "\n", "                ", "forward", "(", "loss_func", ",", "visualize", "=", "False", ")", "\n", "\n", "# Update normalization buffers", "\n", "", "update_normalization_buffers", "(", ")", "\n", "\n", "# Step gradient", "\n", "if", "args", ".", "optimizer", "==", "\"adam\"", ":", "\n", "                ", "raise", "NotImplementedError", "(", "\"Adam is not supported in this setting.\"", ")", "\n", "", "else", ":", "\n", "                ", "update_weights_simple", "(", "lr", ",", "epoch", "=", "step", ")", "\n", "\n", "# Compute \"gradient\"", "\n", "", "", "final_weights", "=", "extract_current_policy", "(", ")", "\n", "difsim_grad", "=", "final_weights", "-", "start_weights", "\n", "\n", "return", "difsim_grad", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.train_guided_es": [[792, 903], ["numpy.random.seed", "random.seed", "train.initialize_weights", "train.initialize_system_params", "train.initialize_normalization_buffers", "train.GuidingBuffer", "range", "numpy.save", "train.set_policy_weights_from_numpy", "train.extract_current_policy", "train.init_zero_gradients", "train.compute_difsim_gradient", "print", "range", "numpy.save", "numpy.mean", "numpy.copy", "range", "numpy.save", "train.set_policy_weights_from_numpy", "train.set_policy_grads_from_numpy", "train.update_weights_simple", "numpy.mean", "wandb.log", "print", "numpy.load", "numpy.count_nonzero", "numpy.any", "train.GuidingBuffer.reset", "train.GuidingBuffer.update_orthogonal", "print", "train.GuidingBuffer.append", "train.GuidingBuffer.update_orthogonal", "cur_costs.append", "train.sample_perturbation", "train.estimate_policy", "train.update_normalization_buffers", "train.estimate_policy", "train.update_normalization_buffers", "policy_losses.extend", "numpy.mean", "range", "numpy.isnan", "numpy.count_nonzero", "train.estimate_policy", "numpy.copy", "numpy.copy", "min_costs.append", "numpy.mean", "numpy.std", "numpy.mean", "numpy.std", "numpy.mean", "train.estimate_policy", "numpy.mean", "numpy.mean", "time.asctime"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_weights", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_system_params", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_normalization_buffers", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.set_policy_weights_from_numpy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.extract_current_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.init_zero_gradients", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.compute_difsim_gradient", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.set_policy_weights_from_numpy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.set_policy_grads_from_numpy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_weights_simple", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPendulum.reset", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.GuidingBuffer.update_orthogonal", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.GuidingBuffer.update_orthogonal", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.sample_perturbation", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.estimate_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_normalization_buffers", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.estimate_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.update_normalization_buffers", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.estimate_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.std", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.std", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.estimate_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean"], ["", "", "def", "train_guided_es", "(", "lr", ",", "seed", ",", "loss_func", ",", "std", ",", "num_perturbations", ",", "k", ",", "alpha", ",", "\n", "beta", ",", "num_iterations", ",", "real_robot", "=", "False", ",", "resume", "=", "None", ",", "num_evals", "=", "1", ")", ":", "\n", "# Fix seeds", "\n", "    ", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "random", ".", "seed", "(", "seed", ")", "\n", "\n", "# Initialize the system and policy", "\n", "initialize_weights", "(", ")", "\n", "initialize_system_params", "(", ")", "\n", "initialize_normalization_buffers", "(", ")", "\n", "\n", "# Load policy to resume the training", "\n", "if", "resume", "is", "not", "None", ":", "\n", "        ", "set_policy_weights_from_numpy", "(", "np", ".", "load", "(", "resume", ")", ")", "\n", "\n", "# Create buffer for guding distribution", "\n", "", "guiding_buffer", "=", "GuidingBuffer", "(", "num_params", "=", "NUM_PARAMETERS", ",", "size", "=", "k", ")", "\n", "\n", "# Log best policies", "\n", "best_loss", "=", "1000000", "\n", "\n", "# Guided ES", "\n", "for", "epoch", "in", "range", "(", "num_iterations", ")", ":", "\n", "        ", "policy_weights", "=", "extract_current_policy", "(", ")", "\n", "policy_grads", "=", "init_zero_gradients", "(", ")", "\n", "policy_losses", "=", "[", "]", "\n", "\n", "# Update guiding space with taichi gradient", "\n", "difsim_grad", "=", "compute_difsim_gradient", "(", "n_steps", "=", "args", ".", "shooting_n", ",", "loss_func", "=", "loss_func", ",", "lr", "=", "lr", ")", "\n", "\n", "# Protect against nan values", "\n", "print", "(", "np", ".", "count_nonzero", "(", "difsim_grad", ")", ")", "\n", "if", "np", ".", "any", "(", "np", ".", "isnan", "(", "difsim_grad", ")", ")", "or", "np", ".", "count_nonzero", "(", "difsim_grad", ")", "==", "0", ":", "\n", "            ", "guiding_buffer", ".", "reset", "(", ")", "\n", "guiding_buffer", ".", "update_orthogonal", "(", ")", "\n", "print", "(", "f\"Differentiable simulator produced nans or zeros :(\"", ")", "\n", "", "else", ":", "\n", "            ", "guiding_buffer", ".", "append", "(", "difsim_grad", ")", "\n", "guiding_buffer", ".", "update_orthogonal", "(", ")", "\n", "\n", "# Evaluate current policy and save it", "\n", "", "cur_costs", "=", "[", "]", "\n", "for", "_", "in", "range", "(", "num_evals", ")", ":", "\n", "            ", "cur_costs", ".", "append", "(", "estimate_policy", "(", "weights", "=", "policy_weights", ",", "loss_func", "=", "loss_func", ",", "real_robot", "=", "real_robot", ")", ")", "\n", "", "np", ".", "save", "(", "f\"models/{wandb.run.id}/epoch{epoch}-cur-{wandb.run.id}-{np.mean(cur_costs)}\"", ",", "policy_weights", ")", "\n", "\n", "# Find current smallest loss", "\n", "cur_best_loss", "=", "np", ".", "mean", "(", "cur_costs", ")", "\n", "cur_best_weights", "=", "np", ".", "copy", "(", "policy_weights", ")", "\n", "\n", "# Compute perturbations", "\n", "for", "_", "in", "range", "(", "num_perturbations", ")", ":", "\n", "            ", "policy_perturb", "=", "sample_perturbation", "(", "std", "=", "std", ",", "guided_config", "=", "{", "\"a\"", ":", "alpha", ",", "\"k\"", ":", "k", ",", "\"u\"", ":", "guiding_buffer", ".", "q", "}", ")", "\n", "\n", "# Positive perturbation", "\n", "pos_loss", "=", "estimate_policy", "(", "policy_weights", "+", "policy_perturb", ",", "loss_func", "=", "loss_func", ",", "real_robot", "=", "real_robot", ")", "\n", "# Update normalization buffers", "\n", "update_normalization_buffers", "(", ")", "\n", "# Save best model", "\n", "if", "pos_loss", "<", "cur_best_loss", ":", "\n", "                ", "cur_best_loss", "=", "pos_loss", "\n", "cur_best_weights", "=", "np", ".", "copy", "(", "policy_weights", "+", "policy_perturb", ")", "\n", "\n", "# Negative perturbation", "\n", "", "neg_loss", "=", "estimate_policy", "(", "policy_weights", "-", "policy_perturb", ",", "loss_func", "=", "loss_func", ",", "real_robot", "=", "real_robot", ")", "\n", "# Update normalization buffers", "\n", "update_normalization_buffers", "(", ")", "\n", "# Save best model", "\n", "if", "neg_loss", "<", "cur_best_loss", ":", "\n", "                ", "cur_best_loss", "=", "neg_loss", "\n", "cur_best_weights", "=", "np", ".", "copy", "(", "policy_weights", "-", "policy_perturb", ")", "\n", "\n", "# print(f\"Pos loss: {pos_loss}; Neg loss: {neg_loss}\")", "\n", "# Compute grads", "\n", "", "policy_grads", "+=", "policy_perturb", "*", "(", "pos_loss", "-", "neg_loss", ")", "\n", "# print(policy_perturb * (pos_loss - neg_loss))", "\n", "\n", "# For logging", "\n", "policy_losses", ".", "extend", "(", "[", "pos_loss", ",", "neg_loss", "]", ")", "\n", "\n", "# Evaluate current smallest loss and save it", "\n", "", "min_costs", "=", "[", "]", "\n", "if", "np", ".", "mean", "(", "cur_costs", ")", ">", "cur_best_loss", ":", "\n", "            ", "for", "_", "in", "range", "(", "num_evals", ")", ":", "\n", "                ", "min_costs", ".", "append", "(", "estimate_policy", "(", "weights", "=", "cur_best_weights", ",", "loss_func", "=", "loss_func", ",", "real_robot", "=", "real_robot", ")", ")", "\n", "", "", "else", ":", "\n", "            ", "min_costs", "=", "cur_costs", "\n", "", "np", ".", "save", "(", "f\"models/{wandb.run.id}/epoch{epoch}-min-{wandb.run.id}-{np.mean(min_costs)}\"", ",", "cur_best_weights", ")", "\n", "\n", "# Compute grads", "\n", "policy_grads", "=", "(", "beta", "*", "policy_grads", ")", "/", "(", "2", "*", "std", "**", "2", "*", "num_perturbations", ")", "\n", "set_policy_weights_from_numpy", "(", "policy_weights", ")", "\n", "set_policy_grads_from_numpy", "(", "policy_grads", ")", "\n", "\n", "# Optimize", "\n", "update_weights_simple", "(", "lr", ",", "epoch", "=", "epoch", ")", "\n", "\n", "# Log current loss", "\n", "average_loss", "=", "np", ".", "mean", "(", "policy_losses", ")", "\n", "wandb", ".", "log", "(", "{", "\n", "\"Loss\"", ":", "average_loss", ",", "\n", "\"Min Loss\"", ":", "np", ".", "mean", "(", "min_costs", ")", ",", "\n", "\"Min Loss Std\"", ":", "np", ".", "std", "(", "min_costs", ")", ",", "\n", "\"Centroid Loss\"", ":", "np", ".", "mean", "(", "cur_costs", ")", ",", "\n", "\"Centroid Loss Std\"", ":", "np", ".", "std", "(", "cur_costs", ")", ",", "\n", "\"Num Samples\"", ":", "(", "epoch", "+", "1", ")", "*", "num_perturbations", "*", "2", ",", "\n", "}", ")", "\n", "print", "(", "f\"Epoch: {epoch}; Mean loss: {np.mean(policy_losses)}; Time: {ptime.asctime()}\"", ")", "\n", "\n", "# Save the latest model", "\n", "", "np", ".", "save", "(", "f\"models/{wandb.run.id}/latest-policy-{wandb.run.id}\"", ",", "policy_weights", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.train_cma_es": [[905, 983], ["numpy.random.seed", "random.seed", "train.initialize_weights", "train.initialize_system_params", "train.initialize_normalization_buffers", "cma.CMAEvolutionStrategy", "range", "numpy.save", "train.set_policy_weights_from_numpy", "train.extract_current_policy", "numpy.copy", "range", "numpy.save", "numpy.mean", "numpy.copy", "cma.CMAEvolutionStrategy.ask", "cma.CMAEvolutionStrategy.tell", "numpy.save", "numpy.mean", "wandb.log", "print", "numpy.load", "cur_costs.append", "train.estimate_policy", "policy_losses.extend", "numpy.mean", "range", "train.estimate_policy", "numpy.copy", "min_costs.append", "numpy.mean", "numpy.std", "numpy.mean", "numpy.std", "numpy.mean", "train.estimate_policy", "numpy.mean", "numpy.mean", "time.asctime"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_weights", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_system_params", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_normalization_buffers", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.set_policy_weights_from_numpy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.extract_current_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.estimate_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.estimate_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.std", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.std", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.estimate_policy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean"], ["", "def", "train_cma_es", "(", "lr", ",", "seed", ",", "loss_func", ",", "std", ",", "num_perturbations", ",", "num_iterations", ",", "real_robot", "=", "False", ",", "resume", "=", "None", ",", "num_evals", "=", "1", ")", ":", "\n", "# Fix seeds", "\n", "    ", "np", ".", "random", ".", "seed", "(", "seed", ")", "\n", "random", ".", "seed", "(", "seed", ")", "\n", "\n", "# Log best policy", "\n", "best_loss", "=", "1000000", "\n", "\n", "# Initialize the system and policy", "\n", "initialize_weights", "(", ")", "\n", "initialize_system_params", "(", ")", "\n", "initialize_normalization_buffers", "(", ")", "\n", "\n", "# Load policy to resume the training", "\n", "if", "resume", "is", "not", "None", ":", "\n", "        ", "set_policy_weights_from_numpy", "(", "np", ".", "load", "(", "resume", ")", ")", "\n", "\n", "# Initialize CMA-ES", "\n", "", "es", "=", "cma", ".", "CMAEvolutionStrategy", "(", "\n", "extract_current_policy", "(", ")", ",", "\n", "std", ",", "\n", "{", "\"popsize\"", ":", "num_perturbations", "*", "2", ",", "\"seed\"", ":", "np", ".", "nan", ",", "\"CMA_cmean\"", ":", "lr", "}", "\n", ")", "\n", "\n", "for", "epoch", "in", "range", "(", "num_iterations", ")", ":", "\n", "        ", "policy_weights", "=", "np", ".", "copy", "(", "es", ".", "mean", ")", "\n", "policy_losses", "=", "[", "]", "\n", "\n", "# Evaluate current policy and save it", "\n", "cur_costs", "=", "[", "]", "\n", "for", "_", "in", "range", "(", "num_evals", ")", ":", "\n", "            ", "cur_costs", ".", "append", "(", "estimate_policy", "(", "weights", "=", "policy_weights", ",", "loss_func", "=", "loss_func", ",", "real_robot", "=", "real_robot", ")", ")", "\n", "", "np", ".", "save", "(", "f\"models/{wandb.run.id}/epoch{epoch}-cur-{wandb.run.id}-{np.mean(cur_costs)}\"", ",", "policy_weights", ")", "\n", "\n", "# Find current smallest loss", "\n", "cur_best_loss", "=", "np", ".", "mean", "(", "cur_costs", ")", "\n", "cur_best_weights", "=", "np", ".", "copy", "(", "policy_weights", ")", "\n", "\n", "# Estimate solutions", "\n", "solutions", "=", "es", ".", "ask", "(", "num_perturbations", "*", "2", ")", "\n", "for", "solution", "in", "solutions", ":", "\n", "# Positive perturbation", "\n", "            ", "loss", "=", "estimate_policy", "(", "solution", ",", "loss_func", "=", "loss_func", ",", "real_robot", "=", "real_robot", ")", "\n", "# update_normalization_buffers()", "\n", "# Save best model", "\n", "if", "loss", "<", "cur_best_loss", ":", "\n", "                ", "cur_best_loss", "=", "loss", "\n", "cur_best_weights", "=", "np", ".", "copy", "(", "solution", ")", "\n", "\n", "# For logging", "\n", "", "policy_losses", ".", "extend", "(", "[", "loss", "]", ")", "\n", "\n", "# Make a step with CMA-ES", "\n", "", "es", ".", "tell", "(", "solutions", ",", "policy_losses", ")", "\n", "\n", "# Evaluate current smallest loss and save it", "\n", "min_costs", "=", "[", "]", "\n", "if", "np", ".", "mean", "(", "cur_costs", ")", ">", "cur_best_loss", ":", "\n", "            ", "for", "_", "in", "range", "(", "num_evals", ")", ":", "\n", "                ", "min_costs", ".", "append", "(", "estimate_policy", "(", "weights", "=", "cur_best_weights", ",", "loss_func", "=", "loss_func", ",", "real_robot", "=", "real_robot", ")", ")", "\n", "", "", "else", ":", "\n", "            ", "min_costs", "=", "cur_costs", "\n", "", "np", ".", "save", "(", "f\"models/{wandb.run.id}/epoch{epoch}-min-{wandb.run.id}-{np.mean(min_costs)}\"", ",", "cur_best_weights", ")", "\n", "\n", "# Log current loss", "\n", "average_loss", "=", "np", ".", "mean", "(", "policy_losses", ")", "\n", "wandb", ".", "log", "(", "{", "\n", "\"Loss\"", ":", "average_loss", ",", "\n", "\"Min Loss\"", ":", "np", ".", "mean", "(", "min_costs", ")", ",", "\n", "\"Min Loss Std\"", ":", "np", ".", "std", "(", "min_costs", ")", ",", "\n", "\"Centroid Loss\"", ":", "np", ".", "mean", "(", "cur_costs", ")", ",", "\n", "\"Centroid Loss Std\"", ":", "np", ".", "std", "(", "cur_costs", ")", ",", "\n", "\"Num Samples\"", ":", "(", "epoch", "+", "1", ")", "*", "num_perturbations", "*", "2", ",", "\n", "}", ")", "\n", "print", "(", "f\"Epoch: {epoch}; Mean loss: {np.mean(policy_losses)}; Time: {ptime.asctime()}\"", ")", "\n", "\n", "# Save the latest model", "\n", "", "np", ".", "save", "(", "f\"models/{wandb.run.id}/latest-policy-{wandb.run.id}\"", ",", "policy_weights", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.visualize_policy": [[984, 999], ["train.initialize_weights", "train.initialize_system_params", "train.clear_states", "train.set_policy_weights_from_numpy", "real_policy.set_weights", "train.forward_real", "print", "train.forward", "numpy.load", "train.extract_current_policy"], "function", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_weights", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.initialize_system_params", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.clear_states", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.set_policy_weights_from_numpy", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPolicy.set_weights", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.forward_real", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPolicy.forward", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.train.extract_current_policy"], ["", "def", "visualize_policy", "(", "path", "=", "None", ",", "real_robot", "=", "False", ")", ":", "\n", "    ", "initialize_weights", "(", ")", "\n", "initialize_system_params", "(", ")", "\n", "clear_states", "(", ")", "\n", "# Visualize loaded policy, otherwise vis random", "\n", "if", "path", "is", "not", "None", ":", "\n", "        ", "set_policy_weights_from_numpy", "(", "np", ".", "load", "(", "path", ")", ")", "\n", "\n", "# Real robot vs simulation", "\n", "", "if", "real_robot", ":", "\n", "        ", "real_policy", ".", "set_weights", "(", "extract_current_policy", "(", ")", ")", "\n", "cost", "=", "forward_real", "(", ")", "\n", "print", "(", "f\"Real robot cost: {cost}\"", ")", "\n", "", "else", ":", "\n", "        ", "forward", "(", "cost_function_energy", ",", "visualize", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.hyperparams_search.sample_hyperparams": [[22, 30], ["numpy.round", "num_perturbations.rvs", "random.choice", "numpy.round", "random.choice", "shooting_ns.rvs", "learning_rates.rvs", "stds.rvs"], "function", ["None"], ["def", "sample_hyperparams", "(", ")", ":", "\n", "    ", "return", "{", "\n", "\"lr\"", ":", "np", ".", "round", "(", "learning_rates", ".", "rvs", "(", ")", ",", "decimals", "=", "4", ")", ",", "\n", "\"num_per\"", ":", "num_perturbations", ".", "rvs", "(", ")", ",", "\n", "\"opt\"", ":", "random", ".", "choice", "(", "optimizers", ")", ",", "\n", "\"std\"", ":", "np", ".", "round", "(", "stds", ".", "rvs", "(", ")", ",", "decimals", "=", "4", ")", ",", "\n", "\"smooth\"", ":", "random", ".", "choice", "(", "smooth", ")", ",", "\n", "\"shoot_n\"", ":", "shooting_ns", ".", "rvs", "(", ")", "\n", "}", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.hyperparams_search.run_command": [[32, 42], ["math.ceil", "os.system"], "function", ["None"], ["", "def", "run_command", "(", "params", ",", "alg", ",", "env", ",", "seed", ",", "codename", ")", ":", "\n", "    ", "n_iters", "=", "ceil", "(", "SAMPLE_EPISODES_BUDGET", "/", "(", "params", "[", "\"num_per\"", "]", "*", "2", ")", ")", "\n", "cmd", "=", "f'python3 train.py --alg=\\\"{alg}\\\" --iterations={n_iters} --seed={seed} --env=\\\"{env}\\\" --std={params[\"std\"]} --optimizer=\\\"{params[\"opt\"]}\\\" --lr={params[\"lr\"]} --num-perturbs={params[\"num_per\"]} '", "\n", "if", "params", "[", "\"smooth\"", "]", ":", "\n", "        ", "cmd", "+=", "\" --smooth\"", "\n", "", "if", "REAL", ":", "\n", "        ", "cmd", "+=", "\" --real\"", "\n", "", "cmd", "+=", "f\" --codename={codename}\"", "\n", "cmd", "+=", "f\" --shooting-n={params['shoot_n']}\"", "\n", "os", ".", "system", "(", "cmd", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.__init__": [[4, 10], ["None"], "methods", ["None"], ["  ", "def", "__init__", "(", "self", ",", "size", ")", ":", "\n", "    ", "self", ".", "_replay", "=", "[", "0", "]", "*", "size", "\n", "self", ".", "_size", "=", "size", "\n", "\n", "self", ".", "_cur_size", "=", "0", "\n", "self", ".", "_index", "=", "0", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.reset": [[11, 13], ["None"], "methods", ["None"], ["", "def", "reset", "(", "self", ")", ":", "\n", "      ", "self", ".", "_replay", "=", "[", "0", "]", "*", "self", ".", "_size", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append": [[14, 18], ["min"], "methods", ["None"], ["", "def", "append", "(", "self", ",", "memento", ")", ":", "\n", "    ", "self", ".", "_replay", "[", "self", ".", "_index", "]", "=", "memento", "\n", "self", ".", "_index", "=", "(", "self", ".", "_index", "+", "1", ")", "%", "self", ".", "_size", "\n", "self", ".", "_cur_size", "=", "min", "(", "self", ".", "_cur_size", "+", "1", ",", "self", ".", "_size", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.mean_std": [[19, 25], ["range", "vals.append", "numpy.mean", "numpy.std"], "methods", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.std"], ["", "def", "mean_std", "(", "self", ")", ":", "\n", "    ", "vals", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "self", ".", "_cur_size", ")", ":", "\n", "        ", "vals", ".", "append", "(", "self", ".", "_replay", "[", "i", "]", ")", "\n", "\n", "", "return", "np", ".", "mean", "(", "vals", ")", ",", "np", ".", "std", "(", "vals", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.__init__": [[27, 31], ["numpy.zeros", "numpy.full"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "shape", ",", "eps", ")", ":", "\n", "        ", "self", ".", "sum", "=", "np", ".", "zeros", "(", "shape", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "self", ".", "sumsq", "=", "np", ".", "full", "(", "shape", ",", "eps", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "self", ".", "count", "=", "eps", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.increment": [[32, 36], ["None"], "methods", ["None"], ["", "def", "increment", "(", "self", ",", "s", ",", "ssq", ",", "c", ")", ":", "\n", "        ", "self", ".", "sum", "+=", "s", "\n", "self", ".", "sumsq", "+=", "ssq", "\n", "self", ".", "count", "+=", "c", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.mean": [[37, 40], ["None"], "methods", ["None"], ["", "@", "property", "\n", "def", "mean", "(", "self", ")", ":", "\n", "        ", "return", "self", ".", "sum", "/", "self", ".", "count", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.std": [[41, 44], ["numpy.sqrt", "numpy.maximum", "numpy.square"], "methods", ["None"], ["", "@", "property", "\n", "def", "std", "(", "self", ")", ":", "\n", "        ", "return", "np", ".", "sqrt", "(", "np", ".", "maximum", "(", "self", ".", "sumsq", "/", "self", ".", "count", "-", "np", ".", "square", "(", "self", ".", "mean", ")", ",", "1e-2", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.RunningStat.set_from_init": [[45, 49], ["numpy.square", "numpy.square"], "methods", ["None"], ["", "def", "set_from_init", "(", "self", ",", "init_mean", ",", "init_std", ",", "init_count", ")", ":", "\n", "        ", "self", ".", "sum", "[", ":", "]", "=", "init_mean", "*", "init_count", "\n", "self", ".", "sumsq", "[", ":", "]", "=", "(", "np", ".", "square", "(", "init_mean", ")", "+", "np", ".", "square", "(", "init_std", ")", ")", "*", "init_count", "\n", "self", ".", "count", "=", "init_count", "", "", "", ""]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.pendulum.Pendulum.__init__": [[6, 25], ["print"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "m", "=", "0.125", ",", "l", "=", "0.155", ")", ":", "\n", "        ", "self", ".", "k_m", "=", "0.06499285", "#0.0512#0.0306", "\n", "self", ".", "m", "=", "m", "\n", "self", ".", "l", "=", "l", "\n", "self", ".", "g", "=", "9.8", "\n", "m_ad", "=", "0.46", "\n", "self", ".", "mgl", "=", "self", ".", "m", "*", "self", ".", "g", "*", "self", ".", "l", "\n", "\n", "self", ".", "w", "=", "0.41", "\n", "self", ".", "h", "=", "0.02", "\n", "self", ".", "I", "=", "m", "*", "(", "self", ".", "w", "**", "2", "+", "self", ".", "h", "**", "2", ")", "/", "12", "+", "self", ".", "m", "*", "self", ".", "l", "**", "2", "\n", "print", "(", "self", ".", "I", ")", "\n", "# self.I = 0.0045 + m_ad*self.l**2 + m_ad*0.055**2/2  # self.I", "\n", "self", ".", "k_x", "=", "0.00109", "\n", "\n", "self", ".", "Kp", "=", "1.1", "\n", "self", ".", "Kd", "=", "0.11", "\n", "\n", "self", ".", "u_max", "=", "3", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.pendulum.Pendulum.ff_control": [[26, 30], ["numpy.sin"], "methods", ["None"], ["", "def", "ff_control", "(", "self", ",", "X_des", ")", ":", "\n", "        ", "u", "=", "(", "self", ".", "mgl", "*", "np", ".", "sin", "(", "X_des", "[", "0", "]", ")", "+", "self", ".", "I", "*", "\n", "X_des", "[", "2", "]", "+", "self", ".", "k_x", "*", "X_des", "[", "1", "]", ")", "/", "self", ".", "k_m", "\n", "return", "u", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.pendulum.Pendulum.cont_pd": [[31, 36], ["numpy.array", "numpy.dot", "numpy.clip"], "methods", ["None"], ["", "def", "cont_pd", "(", "self", ",", "X_des", ",", "X", ",", "kp", "=", "1", ",", "kd", "=", "0.11", ")", ":", "\n", "        ", "K", "=", "np", ".", "array", "(", "[", "[", "kp", ",", "kd", "]", "]", ")", "\n", "u", "=", "np", ".", "dot", "(", "K", ",", "X_des", "[", "0", ":", "2", "]", "-", "X", ")", "\n", "u", "=", "np", ".", "clip", "(", "u", ",", "-", "self", ".", "u_max", ",", "self", ".", "u_max", ")", "\n", "return", "u", "[", "0", "]", "[", "0", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.pendulum.Pendulum.control_pd": [[37, 42], ["numpy.array", "numpy.clip", "pendulum.Pendulum.ff_control", "numpy.dot"], "methods", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.pendulum.Pendulum.ff_control"], ["", "def", "control_pd", "(", "self", ",", "X_des", ",", "X", ",", "kp", "=", "1", ",", "kd", "=", "0.11", ")", ":", "\n", "        ", "K", "=", "np", ".", "array", "(", "[", "[", "kp", ",", "kd", "]", "]", ")", "\n", "u", "=", "self", ".", "ff_control", "(", "X_des", ")", "+", "np", ".", "dot", "(", "K", ",", "X_des", "[", "0", ":", "2", "]", "-", "X", ")", "/", "self", ".", "k_m", "\n", "u", "=", "np", ".", "clip", "(", "u", ",", "-", "self", ".", "u_max", ",", "self", ".", "u_max", ")", "\n", "return", "u", "[", "0", "]", "[", "0", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.pendulum.Pendulum.control_pd_g": [[43, 49], ["numpy.array", "numpy.clip", "numpy.dot", "numpy.sin"], "methods", ["None"], ["", "def", "control_pd_g", "(", "self", ",", "X_des", ",", "X", ",", "kp", "=", "1", ",", "kd", "=", "0.2", ")", ":", "\n", "        ", "K", "=", "np", ".", "array", "(", "[", "[", "kp", ",", "kd", "]", "]", ")", "\n", "u", "=", "(", "self", ".", "mgl", "*", "np", ".", "sin", "(", "X", "[", "0", "]", ")", "+", "self", ".", "k_x", "*", "X", "[", "1", "]", ")", "/", "self", ".", "k_m", "+", "np", ".", "dot", "(", "K", ",", "X_des", "[", "0", ":", "2", "]", "-", "X", ")", "/", "self", ".", "k_m", "\n", "u", "=", "np", ".", "clip", "(", "u", ",", "-", "self", ".", "u_max", ",", "self", ".", "u_max", ")", "\n", "return", "u", "[", "0", "]", "[", "0", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.pendulum.Pendulum.control_sl_mod": [[50, 63], ["numpy.array", "numpy.clip", "numpy.clip", "abs", "pendulum.Pendulum.ff_control", "numpy.dot"], "methods", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.pendulum.Pendulum.ff_control"], ["", "def", "control_sl_mod", "(", "self", ",", "X_des", ",", "X", ")", ":", "\n", "        ", "K", "=", "np", ".", "array", "(", "[", "[", "self", ".", "Kp", ",", "self", ".", "Kd", "]", "]", ")", "\n", "e", "=", "X_des", "[", "0", ":", "2", "]", "-", "X", "\n", "\n", "k_sl", "=", "0.1", "+", "0.01", "*", "abs", "(", "e", "[", "1", "]", ")", "\n", "a", "=", "50", "\n", "s", "=", "a", "*", "e", "[", "0", "]", "+", "e", "[", "1", "]", "\n", "u_sl", "=", "-", "k_sl", "*", "s", "\n", "u_sl", "=", "np", ".", "clip", "(", "u_sl", ",", "-", "0.1", ",", "0.1", ")", "\n", "u", "=", "self", ".", "ff_control", "(", "X_des", ")", "+", "np", ".", "dot", "(", "K", ",", "X_des", "[", "0", ":", "2", "]", "-", "X", ")", "/", "self", ".", "k_m", "-", "u_sl", "/", "self", ".", "k_m", "\n", "u", "=", "np", ".", "clip", "(", "u", ",", "-", "self", ".", "u_max", ",", "self", ".", "u_max", ")", "\n", "return", "u", "[", "0", "]", "[", "0", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.pendulum.Pendulum.control": [[64, 71], ["numpy.array", "numpy.clip", "numpy.dot", "numpy.sin"], "methods", ["None"], ["", "def", "control", "(", "self", ",", "X_des", ",", "X", ")", ":", "\n", "        ", "K", "=", "np", ".", "array", "(", "[", "[", "self", ".", "Kp", ",", "self", ".", "Kd", "]", "]", ")", "\n", "u", "=", "(", "self", ".", "mgl", "*", "np", ".", "sin", "(", "X", "[", "0", "]", ")", "+", "self", ".", "I", "*", "X_des", "[", "2", "]", "+", "\n", "self", ".", "k_x", "*", "X", "[", "1", "]", "+", "np", ".", "dot", "(", "K", ",", "X_des", "[", "0", ":", "2", "]", "-", "X", ")", ")", "/", "self", ".", "k_m", "\n", "u", "=", "np", ".", "clip", "(", "u", ",", "-", "self", ".", "u_max", ",", "self", ".", "u_max", ")", "\n", "# print(u)", "\n", "return", "u", "[", "0", "]", "[", "0", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.pendulum.chirp_traj": [[73, 79], ["numpy.array", "numpy.cos", "numpy.sin", "numpy.cos", "numpy.sin"], "function", ["None"], ["", "", "def", "chirp_traj", "(", "a0", ",", "a", ",", "w0", ",", "nu", ",", "t", ")", ":", "\n", "    ", "omega", "=", "2", "*", "np", ".", "pi", "*", "(", "w0", "+", "nu", "*", "t", ")", "\n", "X_des", "=", "np", ".", "array", "(", "[", "a0", "+", "a", "*", "np", ".", "sin", "(", "omega", "*", "t", ")", ",", "\n", "a", "*", "(", "omega", "+", "2", "*", "np", ".", "pi", "*", "nu", "*", "t", ")", "*", "np", ".", "cos", "(", "omega", "*", "t", ")", ",", "\n", "4", "*", "a", "*", "nu", "*", "np", ".", "pi", "*", "np", ".", "cos", "(", "omega", "*", "t", ")", "-", "4", "*", "a", "*", "np", ".", "pi", "**", "2", "*", "np", ".", "sin", "(", "omega", "*", "t", ")", "*", "(", "w0", "+", "2", "*", "nu", "*", "t", ")", "**", "2", "]", ")", "\n", "return", "X_des", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.pendulum.sin_traj": [[81, 87], ["numpy.array", "numpy.cos", "numpy.sin", "numpy.sin"], "function", ["None"], ["", "def", "sin_traj", "(", "a0", ",", "a", ",", "w", ",", "t", ")", ":", "\n", "    ", "omega", "=", "2", "*", "np", ".", "pi", "*", "w", "\n", "X_des", "=", "np", ".", "array", "(", "[", "a0", "+", "a", "*", "np", ".", "sin", "(", "omega", "*", "t", ")", ",", "\n", "a", "*", "omega", "*", "np", ".", "cos", "(", "omega", "*", "t", ")", ",", "\n", "-", "a", "*", "omega", "**", "2", "*", "np", ".", "sin", "(", "omega", "*", "t", ")", "]", ")", "\n", "return", "X_des", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.pendulum.ident_traj": [[89, 102], ["numpy.array", "range", "numpy.sin", "numpy.cos", "numpy.sin"], "function", ["None"], ["", "def", "ident_traj", "(", "t", ")", ":", "\n", "#a = [1.54, 0.0081, 0.0078, 0.24]", "\n", "    ", "a", "=", "[", "2.96", ",", "-", "0.96", ",", "0.35", ",", "0.06", "]", "\n", "f0", "=", "2", "*", "np", ".", "pi", "*", "0.2", "\n", "X_des", "=", "np", ".", "array", "(", "[", "0", "*", "t", ",", "\n", "0", "*", "t", ",", "\n", "0", "*", "t", "]", ")", "\n", "#X_des = np.zeros((3,len(t)))", "\n", "for", "i", "in", "range", "(", "4", ")", ":", "\n", "        ", "X_des", "[", "0", "]", "+=", "a", "[", "i", "]", "*", "np", ".", "sin", "(", "(", "i", "+", "1", ")", "*", "f0", "*", "t", ")", "\n", "X_des", "[", "1", "]", "+=", "a", "[", "i", "]", "*", "f0", "*", "(", "i", "+", "1", ")", "*", "np", ".", "cos", "(", "(", "i", "+", "1", ")", "*", "f0", "*", "t", ")", "\n", "X_des", "[", "2", "]", "+=", "-", "a", "[", "i", "]", "*", "f0", "**", "2", "*", "(", "i", "+", "1", ")", "**", "2", "*", "np", ".", "sin", "(", "(", "i", "+", "1", ")", "*", "f0", "*", "t", ")", "\n", "", "return", "X_des", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.pendulum.step_traj": [[104, 114], ["numpy.array", "numpy.array", "int", "int"], "function", ["None"], ["", "def", "step_traj", "(", "t", ")", ":", "\n", "    ", "if", "t", "%", "80", "<", "40", ":", "\n", "        ", "X_des", "=", "np", ".", "array", "(", "[", "[", "-", "np", ".", "pi", "/", "2", "+", "int", "(", "(", "t", "/", "2", ")", "%", "20", ")", "*", "np", ".", "pi", "/", "20", "]", ",", "\n", "[", "0", "]", ",", "\n", "[", "0", "]", "]", ")", "\n", "", "if", "t", "%", "80", ">", "40", ":", "\n", "        ", "X_des", "=", "np", ".", "array", "(", "[", "[", "np", ".", "pi", "/", "2", "-", "int", "(", "(", "t", "/", "2", ")", "%", "20", ")", "*", "np", ".", "pi", "/", "20", "]", ",", "\n", "[", "0", "]", ",", "\n", "[", "0", "]", "]", ")", "\n", "", "return", "X_des", "\n", "", ""]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.actuator.State.__init__": [[6, 10], ["numpy.zeros"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "time", "=", "0", "\n", "self", ".", "current", "=", "0", "\n", "self", ".", "X", "=", "np", ".", "zeros", "(", "(", "2", ",", "1", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.actuator.Actuator.__init__": [[13, 23], ["actuator.State", "time.time"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "id", ",", "bus", ")", ":", "\n", "        ", "self", ".", "rev_n", "=", "0", "\n", "self", ".", "id", "=", "id", "\n", "self", ".", "bus", "=", "bus", "\n", "self", ".", "state", "=", "State", "(", ")", "\n", "self", ".", "start_time", "=", "time", ".", "time", "(", ")", "\n", "self", ".", "cur_scale", "=", "33", "/", "2048", "\n", "self", ".", "vel_scale", "=", "2", "*", "np", ".", "pi", "/", "16384", "*", "32", "*", "3", "/", "2", "\n", "self", ".", "pos_scale", "=", "2", "*", "np", ".", "pi", "/", "16384", "\n", "self", ".", "pos_offset", "=", "8175", "#6198", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.actuator.Actuator.__del__": [[24, 26], ["actuator.Actuator.send_current"], "methods", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.actuator.Actuator.send_current"], ["", "def", "__del__", "(", "self", ")", ":", "\n", "        ", "self", ".", "send_current", "(", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.actuator.Actuator.act_time": [[27, 29], ["time.time"], "methods", ["None"], ["", "def", "act_time", "(", "self", ")", ":", "\n", "        ", "return", "time", ".", "time", "(", ")", "-", "self", ".", "state", ".", "time", "-", "self", ".", "start_time", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.actuator.Actuator.recv_can_answ": [[30, 54], ["actuator.Actuator.bus.recv", "time.time", "abs", "numpy.sign", "numpy.sign", "numpy.sign", "time.time"], "methods", ["None"], ["", "def", "recv_can_answ", "(", "self", ")", ":", "\n", "        ", "res", "=", "self", ".", "bus", ".", "recv", "(", ")", "\n", "res_ar", "=", "[", "x", "for", "x", "in", "res", ".", "data", "]", "\n", "\n", "cur", "=", "res_ar", "[", "2", "]", "+", "(", "res_ar", "[", "3", "]", "<<", "8", ")", "\n", "self", ".", "state", ".", "current", "=", "(", "cur", "-", "(", "cur", ">>", "15", ")", "*", "65536", ")", "*", "self", ".", "cur_scale", "\n", "\n", "vel", "=", "res_ar", "[", "4", "]", "+", "(", "res_ar", "[", "5", "]", "<<", "8", ")", "\n", "vel", "=", "(", "vel", "-", "(", "vel", ">>", "15", ")", "*", "65536", ")", "*", "self", ".", "vel_scale", "\n", "self", ".", "state", ".", "X", "[", "1", "]", "=", "vel", "\n", "\n", "new_pos", "=", "(", "res_ar", "[", "6", "]", "+", "(", "res_ar", "[", "7", "]", "<<", "8", ")", "-", "\n", "self", ".", "pos_offset", ")", "*", "self", ".", "pos_scale", "\n", "# print(res_ar[6] + (res_ar[7] << 8))", "\n", "rel_pos", "=", "self", ".", "state", ".", "X", "[", "0", "]", "-", "self", ".", "rev_n", "*", "2", "*", "np", ".", "pi", "\n", "if", "abs", "(", "new_pos", "-", "rel_pos", ")", ">", "np", ".", "pi", "and", "np", ".", "sign", "(", "vel", ")", "==", "np", ".", "sign", "(", "rel_pos", "-", "new_pos", ")", ":", "\n", "#print(new_pos,self.state.X[0] - self.rev_n*2*np.pi)", "\n", "            ", "self", ".", "rev_n", "=", "self", ".", "rev_n", "-", "np", ".", "sign", "(", "new_pos", "-", "rel_pos", ")", "\n", "", "vel", "=", "(", "new_pos", "+", "self", ".", "rev_n", "*", "2", "*", "np", ".", "pi", "-", "\n", "self", ".", "state", ".", "X", "[", "0", "]", ")", "/", "(", "time", ".", "time", "(", ")", "-", "self", ".", "state", ".", "time", ")", "\n", "self", ".", "state", ".", "time", "=", "time", ".", "time", "(", ")", "-", "self", ".", "start_time", "\n", "self", ".", "state", ".", "X", "[", "0", "]", "=", "new_pos", "+", "self", ".", "rev_n", "*", "2", "*", "np", ".", "pi", "\n", "\n", "return", "self", ".", "state", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.actuator.Actuator.send_current": [[55, 65], ["int", "can.Message", "actuator.Actuator.bus.send", "actuator.Actuator.recv_can_answ"], "methods", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.actuator.Actuator.recv_can_answ"], ["", "def", "send_current", "(", "self", ",", "current", ")", ":", "\n", "        ", "current", "=", "int", "(", "current", "/", "self", ".", "cur_scale", ")", "\n", "current", "=", "-", "(", "(", "current", ">>", "15", ")", "*", "2", "**", "16", "-", "current", ")", "\n", "msg", "=", "can", ".", "Message", "(", "arbitration_id", "=", "self", ".", "id", ",", "\n", "data", "=", "[", "0xA1", ",", "0", ",", "0", ",", "0", ",", "current", "&", "\n", "0x00FF", ",", "current", ">>", "8", ",", "0", ",", "0", "]", ",", "\n", "is_extended_id", "=", "False", ")", "\n", "self", ".", "bus", ".", "send", "(", "msg", ")", "\n", "state", "=", "self", ".", "recv_can_answ", "(", ")", "\n", "return", "state", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.actuator.Actuator.get_state": [[66, 73], ["can.Message", "actuator.Actuator.bus.send", "actuator.Actuator.recv_can_answ"], "methods", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.actuator.Actuator.recv_can_answ"], ["", "def", "get_state", "(", "self", ")", ":", "\n", "        ", "msg", "=", "can", ".", "Message", "(", "arbitration_id", "=", "self", ".", "id", ",", "\n", "data", "=", "[", "0x9c", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", "]", ",", "\n", "is_extended_id", "=", "False", ")", "\n", "self", ".", "bus", ".", "send", "(", "msg", ")", "\n", "state", "=", "self", ".", "recv_can_answ", "(", ")", "\n", "return", "state", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.actuator.Encoder.__init__": [[76, 87], ["spidev.SpiDev", "actuator.Encoder.spi.open", "actuator.State", "time.time"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "self", ".", "spi", "=", "spidev", ".", "SpiDev", "(", ")", "\n", "self", ".", "spi", ".", "open", "(", "0", ",", "1", ")", "\n", "self", ".", "spi", ".", "max_speed_hz", "=", "3000000", "\n", "self", ".", "spi", ".", "mode", "=", "0b00", "\n", "self", ".", "state", "=", "State", "(", ")", "\n", "self", ".", "rev_n", "=", "0", "\n", "self", ".", "cpr", "=", "524287", "\n", "self", ".", "pos_scale", "=", "2", "*", "np", ".", "pi", "/", "self", ".", "cpr", "\n", "self", ".", "start_time", "=", "time", ".", "time", "(", ")", "\n", "self", ".", "pos_offset", "=", "-", "175768", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.actuator.Encoder.get_state": [[88, 109], ["actuator.Encoder.spi.readbytes", "abs", "time.time", "numpy.sign", "time.time"], "methods", ["None"], ["", "def", "get_state", "(", "self", ")", ":", "\n", "        ", "arr", "=", "self", ".", "spi", ".", "readbytes", "(", "5", ")", "\n", "bit_pos", "=", "arr", "[", "0", "]", "\n", "bit_pos", "=", "bit_pos", "<<", "8", "\n", "bit_pos", "=", "bit_pos", "|", "arr", "[", "1", "]", "\n", "bit_pos", "=", "bit_pos", "<<", "4", "\n", "bit_pos", "=", "bit_pos", "|", "(", "arr", "[", "2", "]", ">>", "4", ")", "\n", "bit_pos", "=", "-", "bit_pos", "\n", "# print(bit_pos)", "\n", "new_pos", "=", "(", "bit_pos", "-", "self", ".", "pos_offset", ")", "*", "self", ".", "pos_scale", "\n", "rel_pos", "=", "self", ".", "state", ".", "X", "[", "0", "]", "-", "self", ".", "rev_n", "*", "2", "*", "np", ".", "pi", "\n", "if", "abs", "(", "new_pos", "-", "rel_pos", ")", ">", "np", ".", "pi", ":", "\n", "            ", "self", ".", "rev_n", "=", "self", ".", "rev_n", "-", "np", ".", "sign", "(", "new_pos", "-", "rel_pos", ")", "\n", "\n", "", "vel", "=", "(", "new_pos", "+", "self", ".", "rev_n", "*", "2", "*", "np", ".", "pi", "-", "\n", "self", ".", "state", ".", "X", "[", "0", "]", ")", "/", "(", "time", ".", "time", "(", ")", "-", "self", ".", "state", ".", "time", "-", "self", ".", "start_time", ")", "\n", "\n", "self", ".", "state", ".", "X", "[", "0", "]", "=", "new_pos", "+", "self", ".", "rev_n", "*", "2", "*", "np", ".", "pi", "\n", "self", ".", "state", ".", "X", "[", "1", "]", "=", "vel", "\n", "self", ".", "state", ".", "time", "=", "time", ".", "time", "(", ")", "-", "self", ".", "start_time", "\n", "return", "self", ".", "state", "\n", "", "", ""]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPendulum.__init__": [[9, 21], ["os.sched_param", "os.sched_setscheduler", "can.interface.Bus", "Actuator", "Pendulum", "os.sched_get_priority_max"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "target_q", "=", "0.0", ",", "n_seconds", "=", "1", ",", "action_frequency", "=", "200", ")", ":", "\n", "# Initialize all that needed for real robot", "\n", "        ", "self", ".", "_param", "=", "os", ".", "sched_param", "(", "os", ".", "sched_get_priority_max", "(", "os", ".", "SCHED_FIFO", ")", ")", "\n", "os", ".", "sched_setscheduler", "(", "0", ",", "os", ".", "SCHED_FIFO", ",", "self", ".", "_param", ")", "\n", "self", ".", "_bus", "=", "can", ".", "interface", ".", "Bus", "(", "bustype", "=", "'socketcan'", ",", "channel", "=", "'can0'", ",", "bitrate", "=", "1000000", ")", "\n", "self", ".", "_motor", "=", "Actuator", "(", "0x141", ",", "self", ".", "_bus", ")", "\n", "self", ".", "_pendulum", "=", "Pendulum", "(", ")", "\n", "\n", "# Define episode parameters", "\n", "self", ".", "n_seconds", "=", "n_seconds", "\n", "self", ".", "action_frequency", "=", "action_frequency", "\n", "self", ".", "target_q", "=", "target_q", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPendulum.reset": [[22, 61], ["env.RealPendulum._motor.get_state", "time.time", "env.RealPendulum._motor.send_current", "time.time", "time.time", "env.RealPendulum._build_observation", "time.time", "numpy.array", "env.RealPendulum._pendulum.control_pd", "env.RealPendulum._motor.send_current", "numpy.abs", "numpy.abs", "time.time", "time.time", "numpy.abs"], "methods", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.actuator.Encoder.get_state", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.actuator.Actuator.send_current", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPendulum._build_observation", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.pendulum.Pendulum.control_pd", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.actuator.Actuator.send_current"], ["", "def", "reset", "(", "self", ")", ":", "\n", "# Move the controller to the target position", "\n", "        ", "state", "=", "self", ".", "_motor", ".", "get_state", "(", ")", "\n", "q", ",", "dq", ",", "ddq", "=", "state", ".", "X", "[", "0", "]", "[", "0", "]", ",", "state", ".", "X", "[", "1", "]", "[", "0", "]", ",", "0.0", "\n", "prev_time", "=", "time", ".", "time", "(", ")", "\n", "q_des", "=", "0.0", "\n", "u", "=", "0.0", "\n", "n", "=", "0", "\n", "while", "np", ".", "abs", "(", "q", ")", ">", "1e-2", "or", "np", ".", "abs", "(", "dq", ")", ">", "1e-2", ":", "\n", "# Wait until we should act", "\n", "            ", "while", "time", ".", "time", "(", ")", "-", "prev_time", "<", "0.01", ":", "\n", "                ", "pass", "\n", "", "prev_time", "=", "time", ".", "time", "(", ")", "\n", "\n", "# Find control signal using pd", "\n", "X_des", "=", "np", ".", "array", "(", "[", "[", "q_des", "]", ",", "\n", "[", "0", "]", ",", "\n", "[", "0", "]", "]", ")", "\n", "X", "=", "state", ".", "X", "\n", "u", "=", "self", ".", "_pendulum", ".", "control_pd", "(", "X_des", ",", "X", ",", "1.0", ",", "0.1", ")", "\n", "\n", "# Send the signal to the motor", "\n", "state", "=", "self", ".", "_motor", ".", "send_current", "(", "u", ")", "\n", "ddq", "+=", "(", "np", ".", "abs", "(", "(", "state", ".", "X", "[", "1", "]", "[", "0", "]", "-", "dq", ")", "/", "(", "0.01", ")", ")", "-", "ddq", ")", "/", "(", "n", "+", "1", ")", "\n", "q", ",", "dq", "=", "state", ".", "X", "[", "0", "]", "[", "0", "]", ",", "state", ".", "X", "[", "1", "]", "[", "0", "]", "\n", "n", "+=", "1", "\n", "\n", "# Reset the current", "\n", "", "state", "=", "self", ".", "_motor", ".", "send_current", "(", "0", ")", "\n", "prev_time", "=", "time", ".", "time", "(", ")", "\n", "while", "time", ".", "time", "(", ")", "-", "prev_time", "<", "0.2", ":", "\n", "            ", "pass", "\n", "\n", "# Start acting", "\n", "", "self", ".", "_prev_time", "=", "time", ".", "time", "(", ")", "\n", "self", ".", "_start_time", "=", "self", ".", "_prev_time", "\n", "self", ".", "_observation", "=", "None", "\n", "\n", "return", "self", ".", "_build_observation", "(", "state", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPendulum.step": [[62, 81], ["time.time", "env.RealPendulum._motor.send_current", "env.RealPendulum._build_observation", "env.RealPendulum._motor.send_current", "time.time", "time.time"], "methods", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.actuator.Actuator.send_current", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPendulum._build_observation", "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.actuator.Actuator.send_current"], ["", "def", "step", "(", "self", ",", "action", ")", ":", "\n", "# Wait until we should act", "\n", "        ", "while", "time", ".", "time", "(", ")", "-", "self", ".", "_prev_time", "<", "1.0", "/", "self", ".", "action_frequency", ":", "\n", "            ", "pass", "\n", "", "self", ".", "_prev_time", "=", "time", ".", "time", "(", ")", "\n", "\n", "# Act and wait for the response", "\n", "raw_state", "=", "self", ".", "_motor", ".", "send_current", "(", "action", ")", "\n", "\n", "# Construct an observation", "\n", "obs", "=", "self", ".", "_build_observation", "(", "raw_state", ")", "\n", "\n", "# End the simulation", "\n", "done", "=", "False", "\n", "if", "time", ".", "time", "(", ")", "-", "self", ".", "_start_time", ">=", "self", ".", "n_seconds", ":", "\n", "            ", "self", ".", "_motor", ".", "send_current", "(", "0", ")", "\n", "done", "=", "True", "\n", "\n", "", "return", "obs", ",", "done", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPendulum.cost": [[82, 97], ["NotImplementedError", "numpy.sin", "numpy.sin"], "methods", ["None"], ["", "def", "cost", "(", "self", ",", "observations", ",", "cost", "=", "\"total-energy\"", ")", ":", "\n", "        ", "if", "cost", "!=", "\"total-energy\"", ":", "\n", "            ", "raise", "NotImplementedError", "(", ")", "\n", "\n", "# Target energy (should be matched at every timestep)", "\n", "", "target_energy", "=", "np", ".", "sin", "(", "self", ".", "target_q", ")", "*", "self", ".", "_pendulum", ".", "l", "*", "self", ".", "_pendulum", ".", "m", "*", "self", ".", "_pendulum", ".", "g", "\n", "\n", "# Compute quadratic cost", "\n", "total_cost", "=", "0.0", "\n", "for", "observation", "in", "observations", ":", "\n", "            ", "q", ",", "dq", "=", "observation", "[", "0", "]", ",", "observation", "[", "1", "]", "\n", "energy", "=", "0.5", "*", "self", ".", "_pendulum", ".", "I", "*", "dq", "**", "2", "+", "self", ".", "_pendulum", ".", "m", "*", "self", ".", "_pendulum", ".", "g", "*", "np", ".", "sin", "(", "q", ")", "*", "self", ".", "_pendulum", ".", "l", "\n", "total_cost", "+=", "(", "target_energy", "-", "energy", ")", "**", "2", "\n", "\n", "", "return", "total_cost", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPendulum._build_observation": [[98, 109], ["range"], "methods", ["None"], ["", "def", "_build_observation", "(", "self", ",", "raw_state", ")", ":", "\n", "        ", "if", "self", ".", "_observation", "is", "None", ":", "\n", "            ", "self", ".", "_observation", "=", "[", "raw_state", ".", "X", "[", "0", "]", "[", "0", "]", "+", "1.5", "*", "np", ".", "pi", ",", "raw_state", ".", "X", "[", "1", "]", "[", "0", "]", "]", "*", "4", "\n", "", "else", ":", "\n", "            ", "for", "i", "in", "range", "(", "3", ",", "0", ",", "-", "1", ")", ":", "\n", "                ", "self", ".", "_observation", "[", "i", "*", "2", "]", "=", "self", ".", "_observation", "[", "(", "i", "-", "1", ")", "*", "2", "]", "\n", "self", ".", "_observation", "[", "i", "*", "2", "+", "1", "]", "=", "self", ".", "_observation", "[", "(", "i", "-", "1", ")", "*", "2", "+", "1", "]", "\n", "", "self", ".", "_observation", "[", "0", "]", "=", "raw_state", ".", "X", "[", "0", "]", "[", "0", "]", "+", "1.5", "*", "np", ".", "pi", "\n", "self", ".", "_observation", "[", "1", "]", "=", "raw_state", ".", "X", "[", "1", "]", "[", "0", "]", "\n", "\n", "", "return", "self", ".", "_observation", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPendulum.close": [[110, 113], ["print", "env.RealPendulum._motor.send_current"], "methods", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.actuator.Actuator.send_current"], ["", "def", "close", "(", "self", ")", ":", "\n", "        ", "print", "(", "\"am i dead?\"", ")", "\n", "self", ".", "_motor", ".", "send_current", "(", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPolicy.__init__": [[119, 127], ["numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros"], "methods", ["None"], ["def", "__init__", "(", "self", ",", "tanh", "=", "False", ")", ":", "\n", "        ", "self", ".", "w1", "=", "np", ".", "zeros", "(", "shape", "=", "(", "self", ".", "INTERNAL_SHAPE", ",", "self", ".", "INPUT_SHAPE", ")", ")", "\n", "self", ".", "b1", "=", "np", ".", "zeros", "(", "shape", "=", "(", "self", ".", "INTERNAL_SHAPE", ")", ")", "\n", "self", ".", "w2", "=", "np", ".", "zeros", "(", "shape", "=", "(", "self", ".", "INTERNAL_SHAPE", ",", "self", ".", "INTERNAL_SHAPE", ")", ")", "\n", "self", ".", "b2", "=", "np", ".", "zeros", "(", "shape", "=", "(", "self", ".", "INTERNAL_SHAPE", ")", ")", "\n", "self", ".", "w3", "=", "np", ".", "zeros", "(", "shape", "=", "(", "self", ".", "OUTPUT_SHAPE", ",", "self", ".", "INTERNAL_SHAPE", ")", ")", "\n", "self", ".", "b3", "=", "np", ".", "zeros", "(", "shape", "=", "(", "self", ".", "OUTPUT_SHAPE", ")", ")", "\n", "self", ".", "_tanh", "=", "tanh", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPolicy.forward": [[128, 137], ["numpy.tanh", "numpy.tanh", "numpy.tanh", "numpy.clip"], "methods", ["None"], ["", "def", "forward", "(", "self", ",", "obs", ")", ":", "\n", "        ", "h", "=", "np", ".", "tanh", "(", "self", ".", "w1", "@", "obs", "+", "self", ".", "b1", ")", "\n", "h", "=", "np", ".", "tanh", "(", "self", ".", "w2", "@", "h", "+", "self", ".", "b2", ")", "\n", "h", "=", "self", ".", "w3", "@", "h", "+", "self", ".", "b3", "\n", "\n", "if", "self", ".", "_tanh", ":", "\n", "            ", "return", "np", ".", "tanh", "(", "h", ")", "\n", "", "else", ":", "\n", "            ", "return", "np", ".", "clip", "(", "h", ",", "-", "1", ",", "1", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.real.env.RealPolicy.set_weights": [[138, 152], ["range", "len", "result.append", "numpy.prod", "weights[].reshape", "numpy.prod"], "methods", ["home.repos.pwc.inspect_result.vkurenkov_guided-es-by-differentiable-simulators.pendulum.utils.NormalizationBuffer.append"], ["", "", "def", "set_weights", "(", "self", ",", "weights", ")", ":", "\n", "        ", "shapes", "=", "[", "self", ".", "w1", ".", "shape", ",", "self", ".", "w2", ".", "shape", ",", "self", ".", "w3", ".", "shape", ",", "self", ".", "b1", ".", "shape", ",", "self", ".", "b2", ".", "shape", ",", "self", ".", "b3", ".", "shape", "]", "\n", "result", "=", "[", "]", "\n", "prev_ind", "=", "0", "\n", "for", "i", "in", "range", "(", "len", "(", "shapes", ")", ")", ":", "\n", "            ", "result", ".", "append", "(", "weights", "[", "prev_ind", ":", "prev_ind", "+", "np", ".", "prod", "(", "shapes", "[", "i", "]", ")", "]", ".", "reshape", "(", "shapes", "[", "i", "]", ")", ")", "\n", "prev_ind", "+=", "np", ".", "prod", "(", "shapes", "[", "i", "]", ")", "\n", "\n", "", "self", ".", "w1", "=", "result", "[", "0", "]", "\n", "self", ".", "w2", "=", "result", "[", "1", "]", "\n", "self", ".", "w3", "=", "result", "[", "2", "]", "\n", "self", ".", "b1", "=", "result", "[", "3", "]", "\n", "self", ".", "b2", "=", "result", "[", "4", "]", "\n", "self", ".", "b3", "=", "result", "[", "5", "]", "\n", "\n"]]}