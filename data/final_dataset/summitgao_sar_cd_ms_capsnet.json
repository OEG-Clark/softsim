{"home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.data_prepare.load_data": [[9, 21], ["scipy.loadmat", "scipy.loadmat", "image.astype.astype", "numpy.min", "numpy.max", "numpy.min"], "function", ["None"], ["def", "load_data", "(", "image_file", ",", "label_file", ")", ":", "\n", "\n", "    ", "image_data", "=", "sio", ".", "loadmat", "(", "image_file", ")", "\n", "label_data", "=", "sio", ".", "loadmat", "(", "label_file", ")", "\n", "\n", "image", "=", "image_data", "[", "'nrmap'", "]", "\n", "label", "=", "label_data", "[", "'im_gt'", "]", "\n", "\n", "image", "=", "image", ".", "astype", "(", "np", ".", "float32", ")", "\n", "image", "=", "(", "image", "-", "np", ".", "min", "(", "image", ")", ")", "/", "(", "np", ".", "max", "(", "image", ")", "-", "np", ".", "min", "(", "image", ")", ")", "\n", "\n", "return", "image", ",", "label", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.data_prepare.one_hot_transform": [[23, 27], ["numpy.zeros", "int"], "function", ["None"], ["", "def", "one_hot_transform", "(", "x", ",", "length", ")", ":", "\n", "    ", "ont_hot_array", "=", "np", ".", "zeros", "(", "[", "1", ",", "length", "]", ")", "\n", "ont_hot_array", "[", "0", ",", "int", "(", "x", ")", "-", "1", "]", "=", "1", "\n", "return", "ont_hot_array", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.data_prepare.readdata": [[29, 105], ["data_prepare.load_data", "numpy.shape", "int", "numpy.max", "numpy.zeros", "label.nonzero", "len", "len", "ValueError", "numpy.arange", "numpy.random.shuffle", "print", "numpy.shape", "print", "numpy.zeros", "numpy.zeros", "numpy.zeros", "numpy.zeros", "range", "range", "data_prepare.one_hot_transform", "data_prepare.one_hot_transform", "numpy.zeros", "numpy.zeros", "range", "numpy.zeros", "numpy.zeros", "range", "data_prepare.one_hot_transform", "data_prepare.one_hot_transform"], "function", ["home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.data_prepare.load_data", "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.data_prepare.one_hot_transform", "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.data_prepare.one_hot_transform", "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.data_prepare.one_hot_transform", "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.data_prepare.one_hot_transform"], ["", "def", "readdata", "(", "image_file", ",", "label_file", ",", "train_nsamples", "=", "1000", ",", "validation_nsamples", "=", "1000", ",", "\n", "windowsize", "=", "9", ",", "istraining", "=", "True", ",", "shuffle_number", "=", "None", ",", "batchnumber", "=", "5000", ",", "times", "=", "0", ")", ":", "\n", "\n", "    ", "image", ",", "label", "=", "load_data", "(", "image_file", ",", "label_file", ")", "\n", "shape", "=", "np", ".", "shape", "(", "image", ")", "\n", "halfsize", "=", "int", "(", "(", "windowsize", "-", "1", ")", "/", "2", ")", "\n", "number_class", "=", "np", ".", "max", "(", "label", ")", "\n", "Mask", "=", "np", ".", "zeros", "(", "[", "shape", "[", "0", "]", ",", "shape", "[", "1", "]", "]", ")", "\n", "Mask", "[", "halfsize", ":", "shape", "[", "0", "]", "-", "halfsize", ",", "halfsize", ":", "shape", "[", "1", "]", "-", "halfsize", "]", "=", "1", "\n", "label", "=", "label", "*", "Mask", "\n", "not_zero_raw", ",", "not_zero_col", "=", "label", ".", "nonzero", "(", ")", "\n", "number_samples", "=", "len", "(", "not_zero_raw", ")", "\n", "number_samples11111", "=", "len", "(", "not_zero_col", ")", "\n", "test_nsamples", "=", "number_samples", "-", "train_nsamples", "-", "validation_nsamples", "\n", "if", "train_nsamples", "+", "validation_nsamples", ">=", "number_samples", ":", "\n", "        ", "raise", "ValueError", "(", "'train_nsamples + validation_nsamples bigger than total samples'", ")", "\n", "\n", "", "if", "istraining", ":", "\n", "\n", "        ", "shuffle_number", "=", "np", ".", "arange", "(", "number_samples", ")", "\n", "np", ".", "random", ".", "shuffle", "(", "shuffle_number", ")", "\n", "print", "(", "'shuffle_number'", ",", "shuffle_number", ")", "\n", "shape1", "=", "np", ".", "shape", "(", "shuffle_number", ")", "\n", "print", "(", "'shuffle_number.size:'", ",", "shape1", "[", "0", "]", ")", "\n", "train_image", "=", "np", ".", "zeros", "(", "[", "train_nsamples", ",", "windowsize", ",", "windowsize", ",", "shape", "[", "2", "]", "]", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "validation_image", "=", "np", ".", "zeros", "(", "[", "validation_nsamples", ",", "windowsize", ",", "windowsize", ",", "shape", "[", "2", "]", "]", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "\n", "train_label", "=", "np", ".", "zeros", "(", "[", "train_nsamples", ",", "number_class", "]", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "validation_label", "=", "np", ".", "zeros", "(", "[", "validation_nsamples", ",", "number_class", "]", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "\n", "for", "i", "in", "range", "(", "train_nsamples", ")", ":", "\n", "            ", "train_image", "[", "i", ",", ":", ",", ":", ",", ":", "]", "=", "image", "[", "(", "not_zero_raw", "[", "shuffle_number", "[", "i", "]", "]", "-", "halfsize", ")", ":", "(", "not_zero_raw", "[", "shuffle_number", "[", "i", "]", "]", "+", "halfsize", "+", "1", ")", ",", "\n", "(", "not_zero_col", "[", "shuffle_number", "[", "i", "]", "]", "-", "halfsize", ")", ":", "(", "not_zero_col", "[", "shuffle_number", "[", "i", "]", "]", "+", "halfsize", "+", "1", ")", ",", ":", "]", "\n", "train_label", "[", "i", ",", ":", "]", "=", "one_hot_transform", "(", "label", "[", "not_zero_raw", "[", "shuffle_number", "[", "i", "]", "]", ",", "\n", "not_zero_col", "[", "shuffle_number", "[", "i", "]", "]", "]", ",", "number_class", ")", "\n", "\n", "", "for", "i", "in", "range", "(", "validation_nsamples", ")", ":", "\n", "            ", "validation_image", "[", "i", ",", ":", ",", ":", ",", ":", "]", "=", "image", "[", "(", "not_zero_raw", "[", "shuffle_number", "[", "i", "+", "train_nsamples", "]", "]", "-", "halfsize", ")", ":", "(", "not_zero_raw", "[", "shuffle_number", "[", "i", "+", "train_nsamples", "]", "]", "+", "halfsize", "+", "1", ")", ",", "\n", "(", "not_zero_col", "[", "shuffle_number", "[", "i", "+", "train_nsamples", "]", "]", "-", "halfsize", ")", ":", "(", "not_zero_col", "[", "shuffle_number", "[", "i", "+", "train_nsamples", "]", "]", "+", "halfsize", "+", "1", ")", ",", ":", "]", "\n", "validation_label", "[", "i", ",", ":", "]", "=", "one_hot_transform", "(", "label", "[", "not_zero_raw", "[", "shuffle_number", "[", "i", "+", "train_nsamples", "]", "]", ",", "\n", "not_zero_col", "[", "shuffle_number", "[", "i", "+", "train_nsamples", "]", "]", "]", ",", "number_class", ")", "\n", "\n", "", "return", "[", "train_image", ",", "train_label", ",", "validation_image", ",", "validation_label", "]", ",", "shuffle_number", "\n", "\n", "", "else", ":", "\n", "        ", "n_batch", "=", "test_nsamples", "//", "batchnumber", "\n", "if", "times", ">", "n_batch", ":", "\n", "\n", "            ", "return", "None", "\n", "\n", "", "if", "n_batch", "==", "times", ":", "\n", "\n", "            ", "batchnumber_test", "=", "test_nsamples", "-", "n_batch", "*", "batchnumber", "\n", "test_image", "=", "np", ".", "zeros", "(", "[", "batchnumber_test", ",", "windowsize", ",", "windowsize", ",", "shape", "[", "2", "]", "]", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "test_label", "=", "np", ".", "zeros", "(", "[", "batchnumber_test", ",", "number_class", "]", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "\n", "for", "i", "in", "range", "(", "batchnumber_test", ")", ":", "\n", "                ", "test_image", "[", "i", ",", ":", ",", ":", ",", ":", "]", "=", "image", "[", "(", "not_zero_raw", "[", "shuffle_number", "[", "batchnumber", "*", "times", "+", "i", "+", "train_nsamples", "+", "validation_nsamples", "]", "]", "-", "halfsize", ")", ":", "(", "not_zero_raw", "[", "shuffle_number", "[", "batchnumber", "*", "times", "+", "i", "+", "train_nsamples", "+", "validation_nsamples", "]", "]", "+", "halfsize", "+", "1", ")", ",", "\n", "(", "not_zero_col", "[", "shuffle_number", "[", "batchnumber", "*", "times", "+", "i", "+", "train_nsamples", "+", "validation_nsamples", "]", "]", "-", "halfsize", ")", ":", "(", "not_zero_col", "[", "shuffle_number", "[", "batchnumber", "*", "times", "+", "i", "+", "train_nsamples", "+", "validation_nsamples", "]", "]", "+", "halfsize", "+", "1", ")", ",", ":", "]", "\n", "test_label", "[", "i", ",", ":", "]", "=", "one_hot_transform", "(", "label", "[", "not_zero_raw", "[", "shuffle_number", "[", "batchnumber", "*", "times", "+", "i", "+", "train_nsamples", "+", "validation_nsamples", "]", "]", ",", "\n", "not_zero_col", "[", "shuffle_number", "[", "batchnumber", "*", "times", "+", "i", "+", "train_nsamples", "+", "validation_nsamples", "]", "]", "]", ",", "number_class", ")", "\n", "\n", "", "return", "[", "test_image", ",", "test_label", "]", "\n", "\n", "", "if", "times", "<", "n_batch", ":", "\n", "\n", "            ", "test_image", "=", "np", ".", "zeros", "(", "[", "batchnumber", ",", "windowsize", ",", "windowsize", ",", "shape", "[", "2", "]", "]", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "test_label", "=", "np", ".", "zeros", "(", "[", "batchnumber", ",", "number_class", "]", ",", "dtype", "=", "np", ".", "uint8", ")", "\n", "\n", "for", "i", "in", "range", "(", "batchnumber", ")", ":", "\n", "                ", "test_image", "[", "i", ",", ":", ",", ":", ",", ":", "]", "=", "image", "[", "(", "not_zero_raw", "[", "shuffle_number", "[", "batchnumber", "*", "times", "+", "i", "+", "train_nsamples", "+", "validation_nsamples", "]", "]", "-", "halfsize", ")", ":", "(", "not_zero_raw", "[", "shuffle_number", "[", "batchnumber", "*", "times", "+", "i", "+", "train_nsamples", "+", "validation_nsamples", "]", "]", "+", "halfsize", "+", "1", ")", ",", "\n", "(", "not_zero_col", "[", "shuffle_number", "[", "batchnumber", "*", "times", "+", "i", "+", "train_nsamples", "+", "validation_nsamples", "]", "]", "-", "halfsize", ")", ":", "(", "not_zero_col", "[", "shuffle_number", "[", "batchnumber", "*", "times", "+", "i", "+", "train_nsamples", "+", "validation_nsamples", "]", "]", "+", "halfsize", "+", "1", ")", ",", ":", "]", "\n", "test_label", "[", "i", ",", ":", "]", "=", "one_hot_transform", "(", "label", "[", "not_zero_raw", "[", "shuffle_number", "[", "batchnumber", "*", "times", "+", "i", "+", "train_nsamples", "+", "validation_nsamples", "]", "]", ",", "\n", "not_zero_col", "[", "shuffle_number", "[", "batchnumber", "*", "times", "+", "i", "+", "train_nsamples", "+", "validation_nsamples", "]", "]", "]", ",", "number_class", ")", "\n", "\n", "", "return", "[", "test_image", ",", "test_label", "]", "\n", "", "", "", ""]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.Ms_CapsNet.Ms_CapsNet": [[11, 33], ["keras.layers.Input", "capsulelayer_keras.AFC_layer", "capsulelayer_keras.PrimaryCap1", "capsulelayer_keras.PrimaryCap2", "keras.layers.merge.add", "keras.models.Model", "capsulelayer_keras.Conv_Capsule", "capsulelayer_keras.Conv_Capsule", "capsulelayer_keras.Class_Capsule", "capsulelayer_keras.Class_Capsule", "capsulelayer_keras.Length"], "function", ["home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.AFC_layer", "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.PrimaryCap1", "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.PrimaryCap2"], ["def", "Ms_CapsNet", "(", "input_shape", ",", "n_class", ",", "num_routing", ")", ":", "\n", "\n", "    ", "x", "=", "layers", ".", "Input", "(", "shape", "=", "input_shape", ")", "\n", "#  feature extraction by AFC", "\n", "out_afc", "=", "AFC_layer", "(", "x", ")", "\n", "#  dim_vector is the dimensions of capsules, n_channels is number of feature maps", "\n", "Primary_caps1", "=", "PrimaryCap1", "(", "out_afc", ",", "dim_vector", "=", "8", ",", "n_channels", "=", "4", ",", "kernel_size", "=", "3", ",", "strides", "=", "2", ",", "padding", "=", "'VALID'", ")", "\n", "Primary_caps2", "=", "PrimaryCap2", "(", "out_afc", ",", "dim_vector", "=", "8", ",", "n_channels", "=", "4", ",", "kernel_size", "=", "5", ",", "strides", "=", "2", ",", "padding", "=", "'VALID'", ")", "\n", "\n", "Conv_caps1", "=", "Conv_Capsule", "(", "kernel_shape", "=", "[", "3", ",", "3", ",", "4", ",", "8", "]", ",", "dim_vector", "=", "8", ",", "strides", "=", "[", "1", ",", "2", ",", "2", ",", "1", "]", ",", "\n", "num_routing", "=", "num_routing", ",", "batchsize", "=", "args", ".", "batch_size", ",", "name", "=", "'Conv_caps1'", ")", "(", "Primary_caps1", ")", "\n", "Conv_caps2", "=", "Conv_Capsule", "(", "kernel_shape", "=", "[", "3", ",", "3", ",", "4", ",", "8", "]", ",", "dim_vector", "=", "8", ",", "strides", "=", "[", "1", ",", "2", ",", "2", ",", "1", "]", ",", "\n", "num_routing", "=", "num_routing", ",", "batchsize", "=", "args", ".", "batch_size", ",", "name", "=", "'Conv_caps2'", ")", "(", "Primary_caps2", ")", "\n", "\n", "Class_caps1", "=", "Class_Capsule", "(", "num_capsule", "=", "n_class", ",", "dim_vector", "=", "16", ",", "num_routing", "=", "num_routing", ",", "name", "=", "'class_caps1'", ")", "(", "Conv_caps1", ")", "\n", "Class_caps2", "=", "Class_Capsule", "(", "num_capsule", "=", "n_class", ",", "dim_vector", "=", "16", ",", "num_routing", "=", "num_routing", ",", "name", "=", "'class_caps2'", ")", "(", "Conv_caps2", ")", "\n", "#  fuse the output of class capsule  ", "\n", "Class_caps_add", "=", "add", "(", "[", "Class_caps1", ",", "Class_caps2", "]", ")", ";", "\n", "\n", "out_caps", "=", "Length", "(", "name", "=", "'out_caps'", ")", "(", "Class_caps_add", ")", "\n", "\n", "return", "models", ".", "Model", "(", "x", ",", "out_caps", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.Ms_CapsNet.margin_loss": [[35, 40], ["keras.backend.mean", "keras.backend.sum", "keras.backend.square", "keras.backend.square", "keras.backend.maximum", "keras.backend.maximum"], "function", ["None"], ["", "def", "margin_loss", "(", "y_true", ",", "y_pred", ")", ":", "\n", "    ", "L", "=", "y_true", "*", "K", ".", "square", "(", "K", ".", "maximum", "(", "0.", ",", "0.9", "-", "y_pred", ")", ")", "+", "0.5", "*", "(", "1", "-", "y_true", ")", "*", "K", ".", "square", "(", "K", ".", "maximum", "(", "0.", ",", "y_pred", "-", "0.1", ")", ")", "\n", "\n", "return", "K", ".", "mean", "(", "K", ".", "sum", "(", "L", ",", "1", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.Ms_CapsNet.train": [[42, 61], ["callbacks.TensorBoard", "callbacks.ModelCheckpoint", "model.compile", "model.fit", "keras.optimizers.Adam"], "function", ["None"], ["", "def", "train", "(", "model", ",", "data", ",", "args", ")", ":", "\n", "\n", "    ", "(", "x_train", ",", "y_train", ")", ",", "(", "x_valid", ",", "y_valid", ")", "=", "data", "\n", "\n", "# callbacks and save the training model", "\n", "tb", "=", "callbacks", ".", "TensorBoard", "(", "log_dir", "=", "args", ".", "save_dir", "+", "'/tensorboard-logs'", ",", "\n", "batch_size", "=", "args", ".", "batch_size", ")", "\n", "checkpoint", "=", "callbacks", ".", "ModelCheckpoint", "(", "args", ".", "save_dir", "+", "'/weights-test.h5'", ",", "\n", "save_best_only", "=", "True", ",", "save_weights_only", "=", "True", ",", "verbose", "=", "1", ")", "\n", "\n", "# compile the model", "\n", "model", ".", "compile", "(", "optimizer", "=", "optimizers", ".", "Adam", "(", "lr", "=", "args", ".", "lr", ")", ",", "\n", "loss", "=", "[", "margin_loss", "]", ",", "\n", "metrics", "=", "{", "' '", ":", "'accuracy'", "}", ")", "\n", "\n", "model", ".", "fit", "(", "x_train", ",", "y_train", ",", "batch_size", "=", "args", ".", "batch_size", ",", "epochs", "=", "args", ".", "epochs", ",", "\n", "validation_data", "=", "[", "x_valid", ",", "y_valid", "]", ",", "callbacks", "=", "[", "tb", ",", "checkpoint", "]", ",", "verbose", "=", "2", ")", "\n", "\n", "return", "model", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.Ms_CapsNet.test": [[63, 75], ["np.concatenate", "np.concatenate", "model.predict", "np.argmax", "np.argmax", "confusion_matrix"], "function", ["None"], ["", "def", "test", "(", "model", ",", "data", ")", ":", "\n", "    ", "from", "sklearn", ".", "metrics", "import", "confusion_matrix", "\n", "x_test", ",", "y_test", "=", "data", "[", "0", "]", ",", "data", "[", "1", "]", "\n", "n_samples", "=", "y_test", ".", "shape", "[", "0", "]", "\n", "add_samples", "=", "args", ".", "batch_size", "-", "n_samples", "%", "args", ".", "batch_size", "\n", "x_test", "=", "np", ".", "concatenate", "(", "(", "x_test", "[", "0", ":", "add_samples", ",", ":", ",", ":", ",", ":", "]", ",", "x_test", ")", ",", "axis", "=", "0", ")", "\n", "y_test", "=", "np", ".", "concatenate", "(", "(", "y_test", "[", "0", ":", "add_samples", ",", ":", "]", ",", "y_test", ")", ",", "axis", "=", "0", ")", "\n", "y_pred", "=", "model", ".", "predict", "(", "x_test", ",", "batch_size", "=", "args", ".", "batch_size", ")", "\n", "ypred", "=", "np", ".", "argmax", "(", "y_pred", ",", "1", ")", "\n", "y", "=", "np", ".", "argmax", "(", "y_test", ",", "1", ")", "\n", "matrix", "=", "confusion_matrix", "(", "y", "[", "add_samples", ":", "]", ",", "ypred", "[", "add_samples", ":", "]", ")", "\n", "return", "matrix", ",", "ypred", ",", "add_samples", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.Ms_CapsNet.cal_results": [[77, 91], ["np.shape", "np.zeros", "range", "np.mean", "np.sum", "np.sum", "np.sum", "np.sum", "np.sum"], "function", ["None"], ["", "def", "cal_results", "(", "matrix", ")", ":", "\n", "    ", "shape", "=", "np", ".", "shape", "(", "matrix", ")", "\n", "number", "=", "0", "\n", "sum", "=", "0", "\n", "AA", "=", "np", ".", "zeros", "(", "[", "shape", "[", "0", "]", "]", ",", "dtype", "=", "np", ".", "float", ")", "\n", "for", "i", "in", "range", "(", "shape", "[", "0", "]", ")", ":", "\n", "        ", "number", "+=", "matrix", "[", "i", ",", "i", "]", "\n", "AA", "[", "i", "]", "=", "matrix", "[", "i", ",", "i", "]", "/", "np", ".", "sum", "(", "matrix", "[", "i", ",", ":", "]", ")", "\n", "sum", "+=", "np", ".", "sum", "(", "matrix", "[", "i", ",", ":", "]", ")", "*", "np", ".", "sum", "(", "matrix", "[", ":", ",", "i", "]", ")", "\n", "", "OA", "=", "number", "/", "np", ".", "sum", "(", "matrix", ")", "\n", "AA_mean", "=", "np", ".", "mean", "(", "AA", ")", "\n", "pe", "=", "sum", "/", "(", "np", ".", "sum", "(", "matrix", ")", "**", "2", ")", "\n", "Kappa", "=", "(", "OA", "-", "pe", ")", "/", "(", "1", "-", "pe", ")", "\n", "return", "OA", ",", "AA_mean", ",", "Kappa", ",", "AA", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Length.call": [[19, 21], ["keras.sqrt", "keras.sum", "keras.square"], "methods", ["None"], ["    ", "def", "call", "(", "self", ",", "inputs", ",", "**", "kwargs", ")", ":", "\n", "        ", "return", "K", ".", "sqrt", "(", "K", ".", "sum", "(", "K", ".", "square", "(", "inputs", ")", ",", "-", "1", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Length.compute_output_shape": [[22, 24], ["None"], "methods", ["None"], ["", "def", "compute_output_shape", "(", "self", ",", "input_shape", ")", ":", "\n", "        ", "return", "input_shape", "[", ":", "-", "1", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Mask.call": [[28, 42], ["keras.batch_dot", "type", "keras.clip", "len", "keras.epsilon", "keras.max"], "methods", ["None"], ["    ", "def", "call", "(", "self", ",", "inputs", ",", "**", "kwargs", ")", ":", "\n", "# use true label to select target capsule, shape=[batch_size, num_capsule]", "\n", "        ", "if", "type", "(", "inputs", ")", "is", "list", ":", "# true label is provided with shape = [batch_size, n_classes], i.e. one-hot code.", "\n", "            ", "assert", "len", "(", "inputs", ")", "==", "2", "\n", "inputs", ",", "mask", "=", "inputs", "\n", "", "else", ":", "# if no true label, mask by the max length of vectors of capsules", "\n", "            ", "x", "=", "inputs", "\n", "# Enlarge the range of values in x to make max(new_x)=1 and others < 0", "\n", "x", "=", "(", "x", "-", "K", ".", "max", "(", "x", ",", "1", ",", "True", ")", ")", "/", "K", ".", "epsilon", "(", ")", "+", "1", "\n", "mask", "=", "K", ".", "clip", "(", "x", ",", "0", ",", "1", ")", "# the max value in x clipped to 1 and other to 0", "\n", "\n", "# masked inputs, shape = [batch_size, dim_vector]", "\n", "", "inputs_masked", "=", "K", ".", "batch_dot", "(", "inputs", ",", "mask", ",", "[", "1", ",", "1", "]", ")", "\n", "return", "inputs_masked", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Mask.compute_output_shape": [[43, 48], ["type", "tuple", "tuple"], "methods", ["None"], ["", "def", "compute_output_shape", "(", "self", ",", "input_shape", ")", ":", "\n", "        ", "if", "type", "(", "input_shape", "[", "0", "]", ")", "is", "tuple", ":", "# true label provided", "\n", "            ", "return", "tuple", "(", "[", "None", ",", "input_shape", "[", "0", "]", "[", "-", "1", "]", "]", ")", "\n", "", "else", ":", "\n", "            ", "return", "tuple", "(", "[", "None", ",", "input_shape", "[", "-", "1", "]", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Conv_Capsule.__init__": [[58, 74], ["keras.layers.Layer.__init__", "keras.initializers.get", "keras.initializers.get", "keras.regularizers.get"], "methods", ["home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Class_Capsule.__init__"], ["    ", "def", "__init__", "(", "self", ",", "kernel_shape", ",", "strides", ",", "dim_vector", ",", "\n", "num_routing", "=", "3", ",", "batchsize", "=", "50", ",", "name", "=", "'conv_caps'", ",", "\n", "kernel_initializer", "=", "'glorot_uniform'", ",", "\n", "bias_initializer", "=", "'zeros'", ",", "\n", "kernel_regularizer", "=", "'l2'", ",", "\n", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "Conv_Capsule", ",", "self", ")", ".", "__init__", "(", "**", "kwargs", ")", "\n", "self", ".", "kernel_shape", "=", "kernel_shape", "\n", "self", ".", "strides", "=", "strides", "\n", "self", ".", "dim_vector", "=", "dim_vector", "\n", "self", ".", "num_routing", "=", "num_routing", "\n", "self", ".", "batchsize", "=", "batchsize", "\n", "self", ".", "name", "=", "name", "\n", "self", ".", "kernel_initializer", "=", "initializers", ".", "get", "(", "kernel_initializer", ")", "\n", "self", ".", "bias_initializer", "=", "initializers", ".", "get", "(", "bias_initializer", ")", "\n", "self", ".", "kernel_regularizer", "=", "regularizers", ".", "get", "(", "kernel_regularizer", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Conv_Capsule.build": [[75, 94], ["capsulelayer_keras.Conv_Capsule.add_weight", "capsulelayer_keras.Conv_Capsule.add_weight", "len", "tensorflow.truncated_normal_initializer"], "methods", ["None"], ["", "def", "build", "(", "self", ",", "input_shape", ")", ":", "\n", "        ", "assert", "len", "(", "input_shape", ")", ">=", "5", ",", "\"The input Tensor should have shape=[None, height, width, input_num_capsule, input_dim_vector]\"", "\n", "self", ".", "caps_num_i", "=", "self", ".", "kernel_shape", "[", "0", "]", "*", "self", ".", "kernel_shape", "[", "1", "]", "*", "self", ".", "kernel_shape", "[", "2", "]", "\n", "self", ".", "output_cap_channel", "=", "self", ".", "kernel_shape", "[", "3", "]", "\n", "self", ".", "input_dim_vector", "=", "input_shape", "[", "4", "]", "\n", "\n", "# Transform matrix", "\n", "self", ".", "W", "=", "self", ".", "add_weight", "(", "\n", "shape", "=", "[", "1", ",", "self", ".", "caps_num_i", ",", "self", ".", "output_cap_channel", ",", "self", ".", "input_dim_vector", ",", "self", ".", "dim_vector", "]", ",", "\n", "initializer", "=", "tf", ".", "truncated_normal_initializer", "(", "mean", "=", "0.", ",", "stddev", "=", "1.", ")", ",", "\n", "# regularizer=regularizers.l2(5e-4),", "\n", "name", "=", "self", ".", "name", "+", "'W'", ")", "\n", "\n", "# Coupling coefficient.", "\n", "self", ".", "bias", "=", "self", ".", "add_weight", "(", "shape", "=", "[", "1", ",", "1", ",", "1", ",", "self", ".", "caps_num_i", ",", "self", ".", "output_cap_channel", ",", "1", ",", "1", "]", ",", "\n", "initializer", "=", "self", ".", "bias_initializer", ",", "\n", "name", "=", "self", ".", "name", "+", "'bias'", ",", "\n", "trainable", "=", "False", ")", "\n", "self", ".", "built", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Conv_Capsule.call": [[95, 117], ["capsulelayer_keras.Conv_Capsule.kernel_tile", "keras.reshape", "capsulelayer_keras.Conv_Capsule.mat_transform", "keras.reshape", "capsulelayer_keras.Conv_Capsule.capsules_dynamic_routing"], "methods", ["home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Conv_Capsule.kernel_tile", "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Conv_Capsule.mat_transform", "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Conv_Capsule.capsules_dynamic_routing"], ["", "def", "call", "(", "self", ",", "inputs", ",", "training", "=", "None", ")", ":", "\n", "        ", "inputs_poses", "=", "inputs", "\n", "\n", "i_pose_dim", "=", "inputs_poses", ".", "shape", "[", "-", "1", "]", ".", "value", "\n", "\n", "inputs_poses", "=", "self", ".", "kernel_tile", "(", "inputs_poses", ")", "\n", "\n", "spatial_x", "=", "inputs_poses", ".", "shape", "[", "1", "]", ".", "value", "\n", "spatial_y", "=", "inputs_poses", ".", "shape", "[", "2", "]", ".", "value", "\n", "\n", "inputs_poses", "=", "K", ".", "reshape", "(", "inputs_poses", ",", "shape", "=", "[", "-", "1", ",", "self", ".", "kernel_shape", "[", "0", "]", "*", "self", ".", "kernel_shape", "[", "1", "]", "*", "self", ".", "kernel_shape", "[", "2", "]", ",", "\n", "i_pose_dim", "]", ")", "\n", "\n", "votes", "=", "self", ".", "mat_transform", "(", "inputs_poses", ",", "size", "=", "self", ".", "batchsize", "*", "spatial_x", "*", "spatial_y", ")", "\n", "\n", "votes_shape", "=", "votes", ".", "shape", "\n", "votes", "=", "K", ".", "reshape", "(", "votes", ",", "shape", "=", "[", "-", "1", ",", "spatial_x", ",", "spatial_y", ",", "votes_shape", "[", "-", "3", "]", ".", "value", ",", "\n", "votes_shape", "[", "-", "2", "]", ".", "value", ",", "votes_shape", "[", "-", "1", "]", ".", "value", "]", ")", "\n", "\n", "poses", "=", "self", ".", "capsules_dynamic_routing", "(", "votes", ")", "\n", "\n", "return", "poses", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Conv_Capsule.compute_output_shape": [[118, 122], ["tuple"], "methods", ["None"], ["", "def", "compute_output_shape", "(", "self", ",", "input_shape", ")", ":", "\n", "        ", "h", "=", "(", "input_shape", "[", "1", "]", "-", "self", ".", "kernel_shape", "[", "0", "]", ")", "//", "self", ".", "strides", "[", "1", "]", "+", "1", "\n", "w", "=", "(", "input_shape", "[", "2", "]", "-", "self", ".", "kernel_shape", "[", "1", "]", ")", "//", "self", ".", "strides", "[", "2", "]", "+", "1", "\n", "return", "tuple", "(", "[", "self", ".", "batchsize", ",", "h", ",", "w", ",", "self", ".", "kernel_shape", "[", "-", "1", "]", ",", "self", ".", "dim_vector", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Conv_Capsule.kernel_tile": [[123, 145], ["tensorflow.reshape", "numpy.zeros", "range", "keras.constant", "tensorflow.nn.depthwise_conv2d", "keras.reshape", "tensorflow.transpose", "range"], "methods", ["None"], ["", "def", "kernel_tile", "(", "self", ",", "input", ")", ":", "\n", "\n", "        ", "input_shape", "=", "input", ".", "shape", "\n", "input", "=", "tf", ".", "reshape", "(", "input", ",", "shape", "=", "[", "-", "1", ",", "input_shape", "[", "1", "]", ".", "value", ",", "input_shape", "[", "2", "]", ".", "value", ",", "\n", "input_shape", "[", "3", "]", ".", "value", "*", "input_shape", "[", "4", "]", ".", "value", "]", ")", "\n", "\n", "input_shape", "=", "input", ".", "shape", "\n", "tile_filter", "=", "np", ".", "zeros", "(", "shape", "=", "[", "self", ".", "kernel_shape", "[", "0", "]", ",", "self", ".", "kernel_shape", "[", "1", "]", ",", "input_shape", "[", "3", "]", ".", "value", ",", "\n", "self", ".", "kernel_shape", "[", "0", "]", "*", "self", ".", "kernel_shape", "[", "1", "]", "]", ",", "dtype", "=", "np", ".", "float32", ")", "\n", "for", "i", "in", "range", "(", "self", ".", "kernel_shape", "[", "0", "]", ")", ":", "\n", "            ", "for", "j", "in", "range", "(", "self", ".", "kernel_shape", "[", "1", "]", ")", ":", "\n", "                ", "tile_filter", "[", "i", ",", "j", ",", ":", ",", "i", "*", "self", ".", "kernel_shape", "[", "0", "]", "+", "j", "]", "=", "1.0", "\n", "\n", "", "", "tile_filter_op", "=", "K", ".", "constant", "(", "tile_filter", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "\n", "output", "=", "tf", ".", "nn", ".", "depthwise_conv2d", "(", "input", ",", "tile_filter_op", ",", "strides", "=", "self", ".", "strides", ",", "padding", "=", "'VALID'", ")", "\n", "output_shape", "=", "output", ".", "shape", "\n", "output", "=", "K", ".", "reshape", "(", "output", ",", "shape", "=", "[", "-", "1", ",", "output_shape", "[", "1", "]", ".", "value", ",", "output_shape", "[", "2", "]", ".", "value", ",", "input_shape", "[", "3", "]", ".", "value", ",", "\n", "self", ".", "kernel_shape", "[", "0", "]", "*", "self", ".", "kernel_shape", "[", "1", "]", "]", ")", "\n", "output", "=", "tf", ".", "transpose", "(", "output", ",", "perm", "=", "[", "0", ",", "1", ",", "2", ",", "4", ",", "3", "]", ")", "\n", "\n", "return", "output", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Conv_Capsule.mat_transform": [[146, 161], ["keras.reshape", "keras.tile", "keras.tile", "tensorflow.matmul", "keras.reshape"], "methods", ["None"], ["", "def", "mat_transform", "(", "self", ",", "input", ",", "size", ")", ":", "\n", "\n", "        ", "shape", "=", "input", ".", "shape", "\n", "caps_num_i", "=", "shape", "[", "1", "]", ".", "value", "\n", "output", "=", "K", ".", "reshape", "(", "input", ",", "shape", "=", "[", "-", "1", ",", "caps_num_i", ",", "1", ",", "1", ",", "shape", "[", "2", "]", ".", "value", "]", ")", "\n", "\n", "self", ".", "W", "=", "K", ".", "tile", "(", "self", ".", "W", ",", "[", "size", ",", "1", ",", "1", ",", "1", ",", "1", "]", ")", "\n", "\n", "output", "=", "K", ".", "tile", "(", "output", ",", "[", "1", ",", "1", ",", "self", ".", "kernel_shape", "[", "-", "1", "]", ",", "1", ",", "1", "]", ")", "\n", "\n", "votes", "=", "tf", ".", "matmul", "(", "output", ",", "self", ".", "W", ")", "\n", "\n", "votes", "=", "K", ".", "reshape", "(", "votes", ",", "[", "size", ",", "caps_num_i", ",", "self", ".", "kernel_shape", "[", "-", "1", "]", ",", "self", ".", "dim_vector", "]", ")", "\n", "\n", "return", "votes", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Conv_Capsule.capsules_dynamic_routing": [[162, 180], ["keras.expand_dims", "keras.stop_gradient", "range", "keras.reshape", "tensorflow.nn.softmax", "capsulelayer_keras.squash", "capsulelayer_keras.squash", "tensorflow.reduce_sum", "tensorflow.reduce_sum", "tensorflow.reduce_sum"], "methods", ["home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.squash", "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.squash"], ["", "def", "capsules_dynamic_routing", "(", "self", ",", "votes", ")", ":", "\n", "\n", "        ", "shape", "=", "votes", ".", "shape", "\n", "\n", "votes", "=", "K", ".", "expand_dims", "(", "votes", ",", "axis", "=", "5", ")", "\n", "\n", "votes_stopped", "=", "K", ".", "stop_gradient", "(", "votes", ")", "\n", "for", "i", "in", "range", "(", "self", ".", "num_routing", ")", ":", "\n", "            ", "c", "=", "tf", ".", "nn", ".", "softmax", "(", "self", ".", "bias", ",", "dim", "=", "4", ")", "# dim=4 is the num_capsule dimension", "\n", "\n", "if", "i", "==", "self", ".", "num_routing", "-", "1", ":", "\n", "                ", "outputs", "=", "squash", "(", "tf", ".", "reduce_sum", "(", "c", "*", "votes", ",", "3", ",", "keep_dims", "=", "True", ")", ")", "\n", "\n", "", "else", ":", "\n", "                ", "outputs", "=", "squash", "(", "tf", ".", "reduce_sum", "(", "c", "*", "votes_stopped", ",", "3", ",", "keep_dims", "=", "True", ")", ")", "\n", "self", ".", "bias", "+=", "tf", ".", "reduce_sum", "(", "votes", "*", "outputs", ",", "-", "1", ",", "keep_dims", "=", "True", ")", "\n", "\n", "", "", "return", "K", ".", "reshape", "(", "outputs", ",", "[", "-", "1", ",", "shape", "[", "1", "]", ".", "value", ",", "shape", "[", "2", "]", ".", "value", ",", "shape", "[", "4", "]", ".", "value", ",", "shape", "[", "5", "]", ".", "value", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Class_Capsule.__init__": [[184, 198], ["keras.layers.Layer.__init__", "keras.initializers.get", "keras.initializers.get", "keras.regularizers.get", "keras.regularizers.get"], "methods", ["home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Class_Capsule.__init__"], ["    ", "def", "__init__", "(", "self", ",", "num_capsule", ",", "dim_vector", ",", "num_routing", "=", "3", ",", "\n", "kernel_initializer", "=", "'glorot_uniform'", ",", "\n", "bias_initializer", "=", "'zeros'", ",", "\n", "kernel_regularizer", "=", "'l2'", ",", "\n", "bias_regularizer", "=", "'l2'", ",", "\n", "**", "kwargs", ")", ":", "\n", "        ", "super", "(", "Class_Capsule", ",", "self", ")", ".", "__init__", "(", "**", "kwargs", ")", "\n", "self", ".", "num_capsule", "=", "num_capsule", "\n", "self", ".", "dim_vector", "=", "dim_vector", "\n", "self", ".", "num_routing", "=", "num_routing", "\n", "self", ".", "kernel_initializer", "=", "initializers", ".", "get", "(", "kernel_initializer", ")", "\n", "self", ".", "bias_initializer", "=", "initializers", ".", "get", "(", "bias_initializer", ")", "\n", "self", ".", "kernel_regularizer", "=", "regularizers", ".", "get", "(", "kernel_regularizer", ")", "\n", "self", ".", "bias_regularizer", "=", "regularizers", ".", "get", "(", "bias_regularizer", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Class_Capsule.build": [[199, 216], ["capsulelayer_keras.Class_Capsule.add_weight", "capsulelayer_keras.Class_Capsule.add_weight", "len"], "methods", ["None"], ["", "def", "build", "(", "self", ",", "input_shape", ")", ":", "\n", "        ", "assert", "len", "(", "input_shape", ")", ">=", "5", ",", "\"The input Tensor should have shape=[None, height, width, input_num_capsule, input_dim_vector]\"", "\n", "self", ".", "input_num_capsule", "=", "input_shape", "[", "1", "]", "*", "input_shape", "[", "2", "]", "*", "input_shape", "[", "3", "]", "\n", "self", ".", "input_dim_vector", "=", "input_shape", "[", "4", "]", "\n", "\n", "# Transform matrix", "\n", "self", ".", "W", "=", "self", ".", "add_weight", "(", "\n", "shape", "=", "[", "self", ".", "input_num_capsule", ",", "self", ".", "num_capsule", ",", "self", ".", "input_dim_vector", ",", "self", ".", "dim_vector", "]", ",", "\n", "initializer", "=", "self", ".", "kernel_initializer", ",", "\n", "name", "=", "'W'", ")", "\n", "\n", "# Coupling coefficient.", "\n", "self", ".", "bias", "=", "self", ".", "add_weight", "(", "shape", "=", "[", "1", ",", "self", ".", "input_num_capsule", ",", "self", ".", "num_capsule", ",", "1", ",", "1", "]", ",", "\n", "initializer", "=", "self", ".", "bias_initializer", ",", "\n", "name", "=", "'bias'", ",", "\n", "trainable", "=", "False", ")", "\n", "self", ".", "built", "=", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Class_Capsule.call": [[217, 242], ["keras.reshape", "keras.expand_dims", "keras.tile", "tensorflow.scan", "keras.stop_gradient", "range", "keras.reshape", "keras.expand_dims", "tensorflow.nn.softmax", "keras.batch_dot", "keras.zeros", "capsulelayer_keras.squash", "capsulelayer_keras.squash", "keras.sum", "keras.sum", "keras.sum"], "methods", ["home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.squash", "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.squash"], ["", "def", "call", "(", "self", ",", "inputs", ",", "training", "=", "None", ")", ":", "\n", "\n", "        ", "shape", "=", "inputs", ".", "shape", "\n", "inputs", "=", "K", ".", "reshape", "(", "inputs", ",", "[", "-", "1", ",", "shape", "[", "1", "]", ".", "value", "*", "shape", "[", "2", "]", ".", "value", "*", "shape", "[", "3", "]", ".", "value", ",", "shape", "[", "4", "]", ".", "value", "]", ")", "\n", "inputs_expand", "=", "K", ".", "expand_dims", "(", "K", ".", "expand_dims", "(", "inputs", ",", "2", ")", ",", "2", ")", "\n", "\n", "inputs_tiled", "=", "K", ".", "tile", "(", "inputs_expand", ",", "[", "1", ",", "1", ",", "self", ".", "num_capsule", ",", "1", ",", "1", "]", ")", "\n", "\n", "inputs_hat", "=", "tf", ".", "scan", "(", "lambda", "ac", ",", "x", ":", "K", ".", "batch_dot", "(", "x", ",", "self", ".", "W", ",", "[", "3", ",", "2", "]", ")", ",", "\n", "elems", "=", "inputs_tiled", ",", "\n", "initializer", "=", "K", ".", "zeros", "(", "[", "self", ".", "input_num_capsule", ",", "self", ".", "num_capsule", ",", "1", ",", "self", ".", "dim_vector", "]", ")", ")", "\n", "\n", "inputs_hat_stopped", "=", "K", ".", "stop_gradient", "(", "inputs_hat", ")", "\n", "\n", "assert", "self", ".", "num_routing", ">", "0", ",", "'The num_routing should be > 0.'", "\n", "for", "i", "in", "range", "(", "self", ".", "num_routing", ")", ":", "\n", "            ", "c", "=", "tf", ".", "nn", ".", "softmax", "(", "self", ".", "bias", ",", "dim", "=", "2", ")", "\n", "\n", "if", "i", "==", "self", ".", "num_routing", "-", "1", ":", "\n", "                ", "outputs", "=", "squash", "(", "K", ".", "sum", "(", "c", "*", "inputs_hat", ",", "1", ",", "keepdims", "=", "True", ")", ")", "\n", "\n", "", "else", ":", "\n", "                ", "outputs", "=", "squash", "(", "K", ".", "sum", "(", "c", "*", "inputs_hat_stopped", ",", "1", ",", "keepdims", "=", "True", ")", ")", "\n", "self", ".", "bias", "+=", "K", ".", "sum", "(", "inputs_hat", "*", "outputs", ",", "-", "1", ",", "keepdims", "=", "True", ")", "\n", "", "", "return", "K", ".", "reshape", "(", "outputs", ",", "[", "-", "1", ",", "self", ".", "num_capsule", ",", "self", ".", "dim_vector", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.Class_Capsule.compute_output_shape": [[243, 245], ["tuple"], "methods", ["None"], ["", "def", "compute_output_shape", "(", "self", ",", "input_shape", ")", ":", "\n", "        ", "return", "tuple", "(", "[", "None", ",", "self", ".", "num_capsule", ",", "self", ".", "dim_vector", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.squash": [[50, 54], ["tensorflow.reduce_sum", "tensorflow.multiply", "tensorflow.square", "tensorflow.sqrt", "keras.epsilon"], "function", ["None"], ["", "", "", "def", "squash", "(", "vectors", ",", "axis", "=", "-", "1", ")", ":", "\n", "    ", "s_squared_norm", "=", "tf", ".", "reduce_sum", "(", "tf", ".", "square", "(", "vectors", ")", ",", "axis", ",", "keep_dims", "=", "True", ")", "\n", "scale", "=", "s_squared_norm", "/", "(", "1", "+", "s_squared_norm", ")", "/", "tf", ".", "sqrt", "(", "s_squared_norm", "+", "K", ".", "epsilon", "(", ")", ")", "\n", "return", "tf", ".", "multiply", "(", "scale", ",", "vectors", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.PrimaryCap1": [[247, 258], ["numpy.shape", "keras.layers.Conv2D", "keras.layers.BatchNormalization", "keras.layers.Activation", "keras.layers.Reshape", "keras.layers.Lambda"], "function", ["None"], ["", "", "def", "PrimaryCap1", "(", "inputs", ",", "dim_vector", ",", "n_channels", ",", "kernel_size", ",", "strides", ",", "padding", ")", ":", "\n", "\n", "    ", "output", "=", "layers", ".", "Conv2D", "(", "filters", "=", "dim_vector", "*", "n_channels", ",", "kernel_size", "=", "kernel_size", ",", "strides", "=", "strides", ",", "padding", "=", "padding", ",", "\n", "name", "=", "'primarycap_conv2d'", ")", "(", "inputs", ")", "\n", "\n", "output", "=", "layers", ".", "BatchNormalization", "(", "momentum", "=", "0.9", ",", "name", "=", "'primarycap_bn'", ")", "(", "output", ")", "\n", "output", "=", "layers", ".", "Activation", "(", "'relu'", ",", "name", "=", "'primarycap_relu'", ")", "(", "output", ")", "\n", "shape", "=", "np", ".", "shape", "(", "output", ")", "\n", "\n", "outputs", "=", "layers", ".", "Reshape", "(", "target_shape", "=", "[", "shape", "[", "1", "]", ".", "value", ",", "shape", "[", "2", "]", ".", "value", ",", "n_channels", ",", "dim_vector", "]", ",", "name", "=", "'primarycap_reshape'", ")", "(", "output", ")", "\n", "return", "layers", ".", "Lambda", "(", "squash", ",", "name", "=", "'primarycap_squash'", ")", "(", "outputs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.PrimaryCap2": [[259, 269], ["numpy.shape", "keras.layers.Conv2D", "keras.layers.BatchNormalization", "keras.layers.Activation", "keras.layers.Reshape", "keras.layers.Lambda"], "function", ["None"], ["", "def", "PrimaryCap2", "(", "inputs", ",", "dim_vector", ",", "n_channels", ",", "kernel_size", ",", "strides", ",", "padding", ")", ":", "\n", "\n", "    ", "output", "=", "layers", ".", "Conv2D", "(", "filters", "=", "dim_vector", "*", "n_channels", ",", "kernel_size", "=", "kernel_size", ",", "strides", "=", "strides", ",", "padding", "=", "padding", ",", "\n", "name", "=", "'primarycap_conv2d_1'", ")", "(", "inputs", ")", "\n", "output", "=", "layers", ".", "BatchNormalization", "(", "momentum", "=", "0.9", ",", "name", "=", "'primarycap_bn_1'", ")", "(", "output", ")", "\n", "output", "=", "layers", ".", "Activation", "(", "'relu'", ",", "name", "=", "'primarycap_relu_1'", ")", "(", "output", ")", "\n", "shape", "=", "np", ".", "shape", "(", "output", ")", "\n", "\n", "outputs", "=", "layers", ".", "Reshape", "(", "target_shape", "=", "[", "shape", "[", "1", "]", ".", "value", ",", "shape", "[", "2", "]", ".", "value", ",", "n_channels", ",", "dim_vector", "]", ",", "name", "=", "'primarycap_reshape_1'", ")", "(", "output", ")", "\n", "return", "layers", ".", "Lambda", "(", "squash", ",", "name", "=", "'primarycap_squash_1'", ")", "(", "outputs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.ecanet_layer": [[270, 288], ["numpy.shape", "keras.layers.GlobalAveragePooling2D", "keras.layers.Reshape", "keras.layers.Conv1D", "keras.layers.Activation", "keras.layers.Reshape", "keras.layers.Lambda", "keras.layers.BatchNormalization"], "function", ["None"], ["", "def", "ecanet_layer", "(", "x", ",", "out_dim", ")", ":", "\n", "    ", "'''\n    ECA module performs inter-channel weighting.\n    '''", "\n", "k_size", "=", "3", "\n", "squeeze", "=", "layers", ".", "GlobalAveragePooling2D", "(", ")", "(", "x", ")", "\n", "shape", "=", "np", ".", "shape", "(", "squeeze", ")", "\n", "\n", "squeeze", "=", "layers", ".", "Reshape", "(", "target_shape", "=", "[", "shape", "[", "1", "]", ".", "value", ",", "1", "]", ")", "(", "squeeze", ")", "\n", "excitation", "=", "layers", ".", "Conv1D", "(", "filters", "=", "1", ",", "kernel_size", "=", "k_size", ",", "strides", "=", "1", ",", "padding", "=", "'same'", ",", ")", "(", "squeeze", ")", "\n", "excitation", "=", "layers", ".", "Activation", "(", "'sigmoid'", ")", "(", "excitation", ")", "\n", "\n", "excitation", "=", "layers", ".", "Reshape", "(", "(", "1", ",", "1", ",", "out_dim", ")", ")", "(", "excitation", ")", "\n", "\n", "#scale = tf.multiply(x,excitation)", "\n", "scale", "=", "Lambda", "(", "lambda", "x", ":", "x", "[", "0", "]", "*", "x", "[", "1", "]", ")", "(", "[", "x", ",", "excitation", "]", ")", "\n", "scale", "=", "layers", ".", "BatchNormalization", "(", "momentum", "=", "0.9", ")", "(", "scale", ")", "\n", "return", "scale", "\n", "", "def", "AFC_layer", "(", "x", ")", ":", "\n"]], "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.AFC_layer": [[288, 313], ["capsulelayer_keras.ecanet_layer", "capsulelayer_keras.ecanet_layer", "capsulelayer_keras.ecanet_layer", "keras.layers.merge.add", "keras.layers.Conv2D", "keras.layers.BatchNormalization", "keras.layers.Activation", "keras.layers.Conv2D", "keras.layers.BatchNormalization", "keras.layers.Activation", "keras.layers.Conv2D", "keras.layers.BatchNormalization", "keras.layers.Conv2D", "keras.layers.Conv2D", "keras.layers.Activation"], "function", ["home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.ecanet_layer", "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.ecanet_layer", "home.repos.pwc.inspect_result.summitgao_sar_cd_ms_capsnet.None.capsulelayer_keras.ecanet_layer"], ["", "def", "AFC_layer", "(", "x", ")", ":", "\n", "\n", "    ", "conv1", "=", "layers", ".", "Conv2D", "(", "filters", "=", "8", ",", "kernel_size", "=", "3", ",", "strides", "=", "1", ",", "padding", "=", "'same'", ",", "name", "=", "'conv1'", ")", "(", "x", ")", "\n", "conv1", "=", "layers", ".", "BatchNormalization", "(", "momentum", "=", "0.9", ",", "name", "=", "'bn1'", ")", "(", "conv1", ")", "\n", "conv1", "=", "layers", ".", "Activation", "(", "'relu'", ",", "name", "=", "'conv1_relu'", ")", "(", "conv1", ")", "\n", "\n", "conv2", "=", "layers", ".", "Conv2D", "(", "filters", "=", "16", ",", "kernel_size", "=", "3", ",", "dilation_rate", "=", "2", ",", "strides", "=", "1", ",", "padding", "=", "'same'", ",", "name", "=", "'conv2'", ")", "(", "conv1", ")", "\n", "conv2", "=", "layers", ".", "BatchNormalization", "(", "momentum", "=", "0.9", ",", "name", "=", "'bn2'", ")", "(", "conv2", ")", "\n", "conv2", "=", "layers", ".", "Activation", "(", "'relu'", ",", "name", "=", "'conv2_relu'", ")", "(", "conv2", ")", "\n", "\n", "conv3", "=", "layers", ".", "Conv2D", "(", "filters", "=", "32", ",", "kernel_size", "=", "3", ",", "dilation_rate", "=", "3", ",", "strides", "=", "1", ",", "padding", "=", "'same'", ",", "name", "=", "'conv3'", ")", "(", "conv2", ")", "\n", "conv3", "=", "layers", ".", "BatchNormalization", "(", "momentum", "=", "0.9", ",", "name", "=", "'bn3'", ")", "(", "conv3", ")", "\n", "\n", "\n", "conv1_d", "=", "layers", ".", "Conv2D", "(", "filters", "=", "32", ",", "kernel_size", "=", "1", ",", "strides", "=", "1", ",", "padding", "=", "'same'", ",", "name", "=", "'conv1_1'", ")", "(", "conv1", ")", "\n", "conv2_d", "=", "layers", ".", "Conv2D", "(", "filters", "=", "32", ",", "kernel_size", "=", "1", ",", "strides", "=", "1", ",", "padding", "=", "'same'", ",", "name", "=", "'conv2_1'", ")", "(", "conv2", ")", "\n", "\n", "conv1_d", "=", "ecanet_layer", "(", "conv1_d", ",", "out_dim", "=", "32", ")", "\n", "conv2_d", "=", "ecanet_layer", "(", "conv2_d", ",", "out_dim", "=", "32", ")", "\n", "conv3_d", "=", "ecanet_layer", "(", "conv3", ",", "out_dim", "=", "32", ")", "\n", "\n", "conv_fuse", "=", "add", "(", "[", "conv1_d", ",", "conv2_d", ",", "conv3_d", "]", ")", "\n", "conv_afc", "=", "layers", ".", "Activation", "(", "'relu'", ",", "name", "=", "'conv3_relu'", ")", "(", "conv_fuse", ")", "\n", "\n", "return", "conv_afc", "", "", ""]]}