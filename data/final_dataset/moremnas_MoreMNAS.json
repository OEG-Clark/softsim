{"home.repos.pwc.inspect_result.moremnas_MoreMNAS.None.calculate.calculate_metrics": [[19, 106], ["range", "len", "len", "len", "image.copy", "numpy.around().astype", "list", "calculate..image_preprocess", "calculate..image_preprocess", "skimage.measure.compare_psnr", "skimage.measure.compare_psnr", "calculate..image_preprocess", "calculate..image_preprocess", "esrgan_ssim"], "function", ["None"], ["def", "calculate_metrics", "(", "hr_y_list", ",", "sr_y_list", ",", "bnd", "=", "2", ")", ":", "\n", "    ", "class", "BaseMetric", ":", "\n", "        ", "def", "__init__", "(", "self", ")", ":", "\n", "            ", "self", ".", "name", "=", "'base'", "\n", "\n", "", "def", "image_preprocess", "(", "self", ",", "image", ")", ":", "\n", "            ", "image_copy", "=", "image", ".", "copy", "(", ")", "\n", "image_copy", "[", "image_copy", "<", "0", "]", "=", "0", "\n", "image_copy", "[", "image_copy", ">", "255", "]", "=", "255", "\n", "image_copy", "=", "np", ".", "around", "(", "image_copy", ")", ".", "astype", "(", "np", ".", "double", ")", "\n", "return", "image_copy", "\n", "\n", "", "def", "evaluate", "(", "self", ",", "gt", ",", "pr", ")", ":", "\n", "            ", "pass", "\n", "\n", "", "def", "evaluate_list", "(", "self", ",", "gtlst", ",", "prlst", ")", ":", "\n", "            ", "resultlist", "=", "list", "(", "map", "(", "lambda", "gt", ",", "pr", ":", "self", ".", "evaluate", "(", "gt", ",", "pr", ")", ",", "gtlst", ",", "prlst", ")", ")", "\n", "return", "sum", "(", "resultlist", ")", "/", "len", "(", "resultlist", ")", "\n", "\n", "\n", "", "", "class", "PSNRMetric", "(", "BaseMetric", ")", ":", "\n", "        ", "def", "__init__", "(", "self", ")", ":", "\n", "            ", "self", ".", "name", "=", "'psnr'", "\n", "\n", "", "def", "evaluate", "(", "self", ",", "gt", ",", "pr", ")", ":", "\n", "            ", "gt", "=", "self", ".", "image_preprocess", "(", "gt", ")", "\n", "pr", "=", "self", ".", "image_preprocess", "(", "pr", ")", "\n", "return", "skimage", ".", "measure", ".", "compare_psnr", "(", "gt", ",", "pr", ",", "data_range", "=", "255", ")", "\n", "\n", "\n", "", "", "class", "SSIMMetric", "(", "BaseMetric", ")", ":", "\n", "        ", "def", "__init__", "(", "self", ")", ":", "\n", "            ", "self", ".", "name", "=", "'ssim'", "\n", "\n", "", "def", "evaluate", "(", "self", ",", "gt", ",", "pr", ")", ":", "\n", "            ", "def", "ssim", "(", "img1", ",", "img2", ")", ":", "\n", "                ", "C1", "=", "(", "0.01", "*", "255", ")", "**", "2", "\n", "C2", "=", "(", "0.03", "*", "255", ")", "**", "2", "\n", "\n", "img1", "=", "img1", ".", "astype", "(", "np", ".", "float64", ")", "\n", "img2", "=", "img2", ".", "astype", "(", "np", ".", "float64", ")", "\n", "kernel", "=", "cv2", ".", "getGaussianKernel", "(", "11", ",", "1.5", ")", "\n", "window", "=", "np", ".", "outer", "(", "kernel", ",", "kernel", ".", "transpose", "(", ")", ")", "\n", "\n", "mu1", "=", "cv2", ".", "filter2D", "(", "img1", ",", "-", "1", ",", "window", ")", "[", "5", ":", "-", "5", ",", "5", ":", "-", "5", "]", "# valid", "\n", "mu2", "=", "cv2", ".", "filter2D", "(", "img2", ",", "-", "1", ",", "window", ")", "[", "5", ":", "-", "5", ",", "5", ":", "-", "5", "]", "\n", "mu1_sq", "=", "mu1", "**", "2", "\n", "mu2_sq", "=", "mu2", "**", "2", "\n", "mu1_mu2", "=", "mu1", "*", "mu2", "\n", "sigma1_sq", "=", "cv2", ".", "filter2D", "(", "img1", "**", "2", ",", "-", "1", ",", "window", ")", "[", "5", ":", "-", "5", ",", "5", ":", "-", "5", "]", "-", "mu1_sq", "\n", "sigma2_sq", "=", "cv2", ".", "filter2D", "(", "img2", "**", "2", ",", "-", "1", ",", "window", ")", "[", "5", ":", "-", "5", ",", "5", ":", "-", "5", "]", "-", "mu2_sq", "\n", "sigma12", "=", "cv2", ".", "filter2D", "(", "img1", "*", "img2", ",", "-", "1", ",", "window", ")", "[", "5", ":", "-", "5", ",", "5", ":", "-", "5", "]", "-", "mu1_mu2", "\n", "\n", "ssim_map", "=", "(", "(", "2", "*", "mu1_mu2", "+", "C1", ")", "*", "(", "2", "*", "sigma12", "+", "C2", ")", ")", "/", "(", "(", "mu1_sq", "+", "mu2_sq", "+", "C1", ")", "*", "(", "sigma1_sq", "+", "sigma2_sq", "+", "C2", ")", ")", "\n", "return", "ssim_map", ".", "mean", "(", ")", "\n", "\n", "", "def", "esrgan_ssim", "(", "img1", ",", "img2", ")", ":", "\n", "                ", "if", "not", "img1", ".", "shape", "==", "img2", ".", "shape", ":", "\n", "                    ", "raise", "ValueError", "(", "'Input images must have the same dimensions.'", ")", "\n", "", "if", "img1", ".", "ndim", "==", "2", ":", "\n", "                    ", "return", "ssim", "(", "img1", ",", "img2", ")", "\n", "", "elif", "img1", ".", "ndim", "==", "3", ":", "\n", "                    ", "if", "img1", ".", "shape", "[", "2", "]", "==", "3", ":", "\n", "                        ", "ssims", "=", "[", "]", "\n", "for", "i", "in", "range", "(", "3", ")", ":", "\n", "                            ", "ssims", ".", "append", "(", "ssim", "(", "img1", ",", "img2", ")", ")", "\n", "", "return", "np", ".", "array", "(", "ssims", ")", ".", "mean", "(", ")", "\n", "", "elif", "img1", ".", "shape", "[", "2", "]", "==", "1", ":", "\n", "                        ", "return", "ssim", "(", "np", ".", "squeeze", "(", "img1", ")", ",", "np", ".", "squeeze", "(", "img2", ")", ")", "\n", "", "", "else", ":", "\n", "                    ", "raise", "ValueError", "(", "'Wrong input image dimensions.'", ")", "\n", "\n", "", "", "gt", "=", "self", ".", "image_preprocess", "(", "gt", ")", "\n", "pr", "=", "self", ".", "image_preprocess", "(", "pr", ")", "\n", "return", "esrgan_ssim", "(", "gt", "[", "...", ",", "0", "]", ",", "pr", "[", "...", ",", "0", "]", ")", "\n", "\n", "\n", "", "", "y_mean_psnr", "=", "0", "\n", "y_mean_ssim", "=", "0", "\n", "assert", "len", "(", "hr_y_list", ")", "==", "len", "(", "sr_y_list", ")", "\n", "for", "i", "in", "range", "(", "len", "(", "hr_y_list", ")", ")", ":", "\n", "        ", "hr_y", ",", "sr_y", "=", "hr_y_list", "[", "i", "]", ",", "sr_y_list", "[", "i", "]", "\n", "hr_y", "=", "hr_y", "[", "bnd", ":", "-", "bnd", ",", "bnd", ":", "-", "bnd", ",", ":", "]", "\n", "sr_y", "=", "sr_y", "[", "bnd", ":", "-", "bnd", ",", "bnd", ":", "-", "bnd", ",", ":", "]", "\n", "y_mean_psnr", "+=", "PSNRMetric", "(", ")", ".", "evaluate", "(", "sr_y", ",", "hr_y", ")", "/", "len", "(", "sr_y_list", ")", "\n", "y_mean_ssim", "+=", "SSIMMetric", "(", ")", ".", "evaluate", "(", "sr_y", ",", "hr_y", ")", "/", "len", "(", "sr_y_list", ")", "\n", "", "return", "y_mean_psnr", ",", "y_mean_ssim", "\n", "\n"]], "home.repos.pwc.inspect_result.moremnas_MoreMNAS.None.calculate.exists_or_mkdir": [[109, 119], ["os.path.exists", "os.makedirs", "logging.info", "logging.info"], "function", ["None"], ["", "def", "exists_or_mkdir", "(", "path", ",", "verbose", "=", "True", ")", ":", "\n", "    ", "if", "not", "os", ".", "path", ".", "exists", "(", "path", ")", ":", "\n", "        ", "if", "verbose", ":", "\n", "            ", "logging", ".", "info", "(", "\"[*] creates %s ...\"", "%", "path", ")", "\n", "", "os", ".", "makedirs", "(", "path", ")", "\n", "return", "False", "\n", "", "else", ":", "\n", "        ", "if", "verbose", ":", "\n", "            ", "logging", ".", "info", "(", "\"[!] %s exists ...\"", "%", "path", ")", "\n", "", "return", "True", "\n", "\n"]], "home.repos.pwc.inspect_result.moremnas_MoreMNAS.None.calculate.load_file_list": [[122, 137], ["os.listdir", "enumerate", "os.getcwd", "re.search", "enumerate", "logging.info", "logging.info", "return_list.append", "os.path.join", "len"], "function", ["None"], ["", "", "def", "load_file_list", "(", "path", "=", "None", ",", "regx", "=", "'\\.jpg'", ",", "printable", "=", "True", ",", "keep_prefix", "=", "False", ")", ":", "\n", "    ", "if", "path", "is", "None", ":", "\n", "        ", "path", "=", "os", ".", "getcwd", "(", ")", "\n", "", "file_list", "=", "os", ".", "listdir", "(", "path", ")", "\n", "return_list", "=", "[", "]", "\n", "for", "_", ",", "f", "in", "enumerate", "(", "file_list", ")", ":", "\n", "        ", "if", "re", ".", "search", "(", "regx", ",", "f", ")", ":", "\n", "            ", "return_list", ".", "append", "(", "f", ")", "\n", "", "", "if", "keep_prefix", ":", "\n", "        ", "for", "i", ",", "f", "in", "enumerate", "(", "return_list", ")", ":", "\n", "            ", "return_list", "[", "i", "]", "=", "os", ".", "path", ".", "join", "(", "path", ",", "f", ")", "\n", "", "", "if", "printable", ":", "\n", "        ", "logging", ".", "info", "(", "'Match file list = %s'", "%", "return_list", ")", "\n", "logging", ".", "info", "(", "'Number of files = %d'", "%", "len", "(", "return_list", ")", ")", "\n", "", "return", "return_list", "\n", "\n"]], "home.repos.pwc.inspect_result.moremnas_MoreMNAS.None.calculate.evaluate": [[139, 182], ["scipy.misc.imread", "scipy.misc.imread", "tensorflow.Graph().as_default", "tensorflow.GraphDef", "open", "tf.GraphDef.ParseFromString", "tensorflow.import_graph_def", "tensorflow.Session", "sess.graph.get_tensor_by_name", "sess.graph.get_tensor_by_name", "sess.graph.get_tensor_by_name", "sess.run", "enumerate", "tensorflow.Graph", "f.read", "tensorflow.global_variables_initializer", "skimage.rgb2ypbpr", "scipy.misc.imresize", "numpy.expand_dims", "sess.run", "numpy.clip", "out.astype.astype", "skimage.rgb2ycbcr", "skimage.rgb2ycbcr", "metrics.append", "sum", "len", "sum", "len", "calculate.exists_or_mkdir", "scipy.misc.toimage", "scipy.misc.toimage.save", "calculate.calculate_metrics", "skimage.rgb2ypbpr", "[].replace", "calculate_hr_img_list[].split"], "function", ["home.repos.pwc.inspect_result.moremnas_MoreMNAS.None.calculate.exists_or_mkdir", "home.repos.pwc.inspect_result.moremnas_MoreMNAS.None.calculate.calculate_metrics"], ["", "def", "evaluate", "(", "calculate_lr_img_list", ",", "calculate_hr_img_list", ",", "pb_path", ",", "save_path", ",", "save", "=", "False", ")", ":", "\n", "    ", "calculate_hr_imgs", "=", "[", "scipy", ".", "misc", ".", "imread", "(", "p", ",", "mode", "=", "'RGB'", ")", "for", "p", "in", "calculate_hr_img_list", "]", "\n", "calculate_lr_imgs", "=", "[", "scipy", ".", "misc", ".", "imread", "(", "p", ",", "mode", "=", "'RGB'", ")", "for", "p", "in", "calculate_lr_img_list", "]", "\n", "\n", "\n", "with", "tf", ".", "Graph", "(", ")", ".", "as_default", "(", ")", ":", "\n", "        ", "output_graph_def", "=", "tf", ".", "GraphDef", "(", ")", "\n", "with", "open", "(", "pb_path", ",", "\"rb\"", ")", "as", "f", ":", "\n", "            ", "output_graph_def", ".", "ParseFromString", "(", "f", ".", "read", "(", ")", ")", "\n", "tf", ".", "import_graph_def", "(", "output_graph_def", ",", "name", "=", "\"\"", ")", "\n", "", "with", "tf", ".", "Session", "(", ")", "as", "sess", ":", "\n", "            ", "y_image", "=", "sess", ".", "graph", ".", "get_tensor_by_name", "(", "\"input_image_evaluate_y:0\"", ")", "\n", "pbpr_image", "=", "sess", ".", "graph", ".", "get_tensor_by_name", "(", "\"input_image_evaluate_pbpr:0\"", ")", "\n", "output_tensor", "=", "sess", ".", "graph", ".", "get_tensor_by_name", "(", "'test_sr_evaluator_i1_b0_g/target:0'", ")", "\n", "sess", ".", "run", "(", "tf", ".", "global_variables_initializer", "(", ")", ")", "\n", "metrics", "=", "[", "]", "\n", "for", "index", ",", "calculate_lr_img", "in", "enumerate", "(", "calculate_lr_imgs", ")", ":", "\n", "                ", "calculate_hr_img", "=", "calculate_hr_imgs", "[", "index", "]", "\n", "size", "=", "calculate_lr_img", ".", "shape", "\n", "ypbpr", "=", "sc", ".", "rgb2ypbpr", "(", "calculate_lr_img", "/", "255.0", ")", "\n", "x_scale", "=", "scipy", ".", "misc", ".", "imresize", "(", "calculate_lr_img", ",", "[", "size", "[", "0", "]", "*", "scale", ",", "size", "[", "1", "]", "*", "scale", "]", ",", "interp", "=", "'bicubic'", ",", "mode", "=", "None", ")", "\n", "y", ",", "pbpr", "=", "ypbpr", "[", "...", ",", "0", "]", ",", "sc", ".", "rgb2ypbpr", "(", "x_scale", "/", "255", ")", "[", "...", ",", "1", ":", "]", "\n", "y", "=", "np", ".", "expand_dims", "(", "y", ",", "-", "1", ")", "\n", "paras", "=", "{", "y_image", ":", "[", "y", "]", ",", "pbpr_image", ":", "[", "pbpr", "]", "}", "\n", "\n", "out", "=", "sess", ".", "run", "(", "output_tensor", ",", "paras", ")", "\n", "out", "=", "out", "[", "0", "]", "\n", "\n", "out", "=", "out", "*", "255", "\n", "out", "=", "np", ".", "clip", "(", "out", ",", "0", ",", "255", ")", "\n", "out", "=", "out", ".", "astype", "(", "np", ".", "uint8", ")", "\n", "\n", "if", "save", ":", "\n", "                    ", "exists_or_mkdir", "(", "save_path", ")", "\n", "im", "=", "scipy", ".", "misc", ".", "toimage", "(", "out", ",", "high", "=", "255", ",", "low", "=", "0", ")", "\n", "im", ".", "save", "(", "save_path", "+", "os", ".", "sep", "+", "calculate_hr_img_list", "[", "index", "]", ".", "split", "(", "os", ".", "sep", ")", "[", "-", "1", "]", ".", "replace", "(", "'HR'", ",", "'SR'", ")", ")", "\n", "", "out_ycbcr", "=", "sc", ".", "rgb2ycbcr", "(", "out", ")", "\n", "hr_ycbcr", "=", "sc", ".", "rgb2ycbcr", "(", "calculate_hr_img", ")", "\n", "metrics", ".", "append", "(", "calculate_metrics", "(", "[", "out_ycbcr", "[", ":", ",", ":", ",", "0", ":", "1", "]", "]", ",", "[", "hr_ycbcr", "[", ":", ",", ":", ",", "0", ":", "1", "]", "]", ")", ")", "\n", "", "avg_psnr", "=", "sum", "(", "[", "m", "[", "0", "]", "for", "m", "in", "metrics", "]", ")", "/", "len", "(", "metrics", ")", "\n", "avg_ssim", "=", "sum", "(", "[", "m", "[", "1", "]", "for", "m", "in", "metrics", "]", ")", "/", "len", "(", "metrics", ")", "\n", "\n", "return", "avg_psnr", ",", "avg_ssim", "\n", "\n"]], "home.repos.pwc.inspect_result.moremnas_MoreMNAS.None.calculate.parse_args": [[184, 189], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args"], "function", ["home.repos.pwc.inspect_result.moremnas_MoreMNAS.None.calculate.parse_args"], ["", "", "", "def", "parse_args", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", ")", "\n", "parser", ".", "add_argument", "(", "\"--pb_path\"", ",", "type", "=", "str", ",", "default", "=", "'./pretrained_model/MoreMNAS-B.pb'", ")", "\n", "parser", ".", "add_argument", "(", "\"--save_path\"", ",", "type", "=", "str", ",", "default", "=", "'./result/'", ")", "\n", "return", "parser", ".", "parse_args", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.moremnas_MoreMNAS.None.plot_comparison.plot_sr_comparison": [[29, 57], ["matplotlib.rc", "matplotlib.rc", "matplotlib.subplots", "range", "matplotlib.tight_layout", "matplotlib.subplots_adjust", "matplotlib.savefig", "matplotlib.show", "scipy.misc.imread", "scipy.misc.imread", "range", "range", "moremnas_imgs.append", "[].imshow", "[].set_title", "[].axis", "[].set_aspect", "scipy.misc.imread"], "function", ["None"], ["def", "plot_sr_comparison", "(", ")", ":", "\n", "    ", "rc", "(", "'font'", ",", "**", "{", "'family'", ":", "'serif'", "}", ")", "\n", "rc", "(", "'text'", ",", "usetex", "=", "True", ")", "\n", "fig", ",", "axes", "=", "plt", ".", "subplots", "(", "5", ",", "6", ",", "figsize", "=", "(", "7", ",", "6", ")", ")", "#, ", "\n", "\n", "for", "i", "in", "range", "(", "1", ",", "6", ")", ":", "\n", "        ", "gt_img", "=", "scipy", ".", "misc", ".", "imread", "(", "GT_HR_IMAGES", "%", "i", ")", "\n", "vdsr_img", "=", "scipy", ".", "misc", ".", "imread", "(", "VDSR_SR_IMAGES", "%", "vdsr_labels", "[", "i", "-", "1", "]", ")", "\n", "moremnas_imgs", "=", "[", "]", "\n", "for", "k", "in", "range", "(", "4", ")", ":", "\n", "            ", "moremnas_imgs", ".", "append", "(", "scipy", ".", "misc", ".", "imread", "(", "MOREMNAS_SR_IMAGES", "%", "(", "moremnas_models", "[", "k", "]", ",", "i", ")", ")", ")", "\n", "\n", "", "imgs", "=", "[", "gt_img", ",", "vdsr_img", "]", "+", "moremnas_imgs", "\n", "\n", "region", "=", "REGIONS", "[", "i", "-", "1", "]", "\n", "[", "x1", ",", "y1", "]", ",", "[", "x2", ",", "y2", "]", "=", "region", "\n", "for", "j", "in", "range", "(", "6", ")", ":", "\n", "# print(imgs[j].shape, x1,y1, x2,y2)", "\n", "            ", "axes", "[", "i", "-", "1", "]", "[", "j", "]", ".", "imshow", "(", "imgs", "[", "j", "]", "[", "x1", ":", "x2", ",", "y1", ":", "y2", ",", ":", "]", ")", "\n", "axes", "[", "i", "-", "1", "]", "[", "j", "]", ".", "set_title", "(", "METHODS", "[", "j", "]", ",", "fontsize", "=", "'small'", ")", "\n", "axes", "[", "i", "-", "1", "]", "[", "j", "]", ".", "axis", "(", "'off'", ")", "\n", "axes", "[", "i", "-", "1", "]", "[", "j", "]", ".", "set_aspect", "(", "'equal'", ")", "\n", "\n", "", "", "plt", ".", "tight_layout", "(", "pad", "=", "0", ")", "\n", "plt", ".", "subplots_adjust", "(", "hspace", "=", "0.3", ",", "wspace", "=", "0", ")", "\n", "\n", "plt", ".", "savefig", "(", "'sr_comparison_x2.png'", ")", "\n", "plt", ".", "show", "(", ")", "\n", "\n"]]}