{"home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.load_annots": [[26, 30], ["os.path.join", "numpy.load"], "function", ["None"], ["def", "load_annots", "(", "dataset_dir", ",", "split_name", "=", "'val'", ")", ":", "\n", "    ", "path", "=", "os", ".", "path", ".", "join", "(", "dataset_dir", ",", "f'{split_name}_annots.npz'", ")", "\n", "annots", "=", "np", ".", "load", "(", "path", ",", "allow_pickle", "=", "True", ")", "[", "'annots'", "]", "[", "(", ")", "]", "\n", "return", "annots", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.load_image": [[31, 34], ["os.path.join", "cv2.imread"], "function", ["None"], ["", "def", "load_image", "(", "image_name", ")", ":", "\n", "    ", "image_path", "=", "os", ".", "path", ".", "join", "(", "image_folder", ",", "image_name", ")", "\n", "return", "cv2", ".", "imread", "(", "image_path", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.print_annots_info": [[35, 43], ["print", "print", "print", "print", "print", "print"], "function", ["None"], ["", "def", "print_annots_info", "(", "packed_annots", ")", ":", "\n", "    ", "kp2ds", ",", "bboxes", ",", "meta_info", "=", "packed_annots", "\n", "print", "(", "name_dict", ")", "\n", "print", "(", "'kp2ds'", ",", "kp2ds", ")", "\n", "print", "(", "'bbox:'", ",", "bboxes", ")", "\n", "print", "(", "'Depth Layers number:'", ",", "meta_info", "[", ":", ",", "0", "]", ")", "\n", "print", "(", "'Age type:'", ",", "meta_info", "[", ":", ",", "1", "]", ")", "\n", "print", "(", "'Gender:'", ",", "meta_info", "[", ":", ",", "2", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.determine_skeleton_type": [[58, 68], ["len", "len", "len", "os.path.basename().replace", "os.path.basename"], "function", ["None"], ["def", "determine_skeleton_type", "(", "img_name", ",", "joint", ")", ":", "\n", "    ", "if", "len", "(", "joint", ")", "==", "19", ":", "\n", "        ", "is_BK", "=", "len", "(", "os", ".", "path", ".", "basename", "(", "img_name", ")", ".", "replace", "(", "'.jpg'", ",", "''", ")", ")", "==", "7", "\n", "if", "is_BK", ":", "\n", "            ", "skeleton", "=", "BK_19", "\n", "", "else", ":", "\n", "            ", "skeleton", "=", "OCHuman_19", "\n", "", "", "elif", "len", "(", "joint", ")", "==", "14", ":", "\n", "        ", "skeleton", "=", "Crowdpose_14", "\n", "", "return", "skeleton", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.prepare_annots": [[69, 91], ["enumerate", "numpy.array", "numpy.array", "bboxes.append", "kp2ds.append", "np.array.append", "numpy.array", "numpy.array().reshape", "demo.determine_skeleton_type", "numpy.array"], "function", ["home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.determine_skeleton_type"], ["", "def", "prepare_annots", "(", "annots", ",", "img_name", ")", ":", "\n", "    ", "kp2ds", ",", "bboxes", ",", "meta_info", "=", "[", "]", ",", "[", "]", ",", "[", "]", "\n", "\n", "for", "ind", ",", "annot", "in", "enumerate", "(", "annots", ")", ":", "\n", "        ", "vbox", "=", "np", ".", "array", "(", "annot", "[", "'bbox'", "]", ")", "# rough bbox for visible body parts only", "\n", "fbox", "=", "np", ".", "array", "(", "annot", "[", "'bbox_wb'", "]", ")", "if", "'bbox_wb'", "in", "annot", "else", "None", "# bbox for the whole body", "\n", "bboxes", ".", "append", "(", "[", "vbox", ",", "fbox", "]", ")", "\n", "\n", "joint", ",", "skeleton", "=", "None", ",", "None", "\n", "if", "'kp2d'", "in", "annot", ":", "\n", "            ", "if", "annot", "[", "'kp2d'", "]", "is", "not", "None", ":", "\n", "                ", "joint", "=", "np", ".", "array", "(", "annot", "[", "'kp2d'", "]", ")", ".", "reshape", "(", "(", "-", "1", ",", "3", ")", ")", "\n", "invalid_kp_mask", "=", "joint", "[", ":", ",", "2", "]", "==", "0", "\n", "joint", "[", "invalid_kp_mask", "]", "=", "-", "2.", "\n", "joint", "[", ":", ",", "2", "]", "=", "joint", "[", ":", ",", "2", "]", ">", "0", "\n", "skeleton", "=", "determine_skeleton_type", "(", "img_name", ",", "joint", ")", "\n", "", "", "kp2ds", ".", "append", "(", "[", "joint", ",", "skeleton", "]", ")", "\n", "\n", "meta_info", ".", "append", "(", "[", "annot", "[", "'depth_id'", "]", ",", "annot", "[", "'age'", "]", ",", "annot", "[", "'gender'", "]", "]", ")", "\n", "\n", "", "meta_info", "=", "np", ".", "array", "(", "meta_info", ")", "\n", "return", "(", "kp2ds", ",", "bboxes", ",", "meta_info", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.joint_mapping": [[125, 131], ["numpy.array", "numpy.ones", "len"], "function", ["None"], ["def", "joint_mapping", "(", "source_format", ",", "target_format", ")", ":", "\n", "    ", "mapping", "=", "np", ".", "ones", "(", "len", "(", "target_format", ")", ",", "dtype", "=", "np", ".", "int", ")", "*", "-", "1", "\n", "for", "joint_name", "in", "target_format", ":", "\n", "        ", "if", "joint_name", "in", "source_format", ":", "\n", "            ", "mapping", "[", "target_format", "[", "joint_name", "]", "]", "=", "source_format", "[", "joint_name", "]", "\n", "", "", "return", "np", ".", "array", "(", "mapping", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.draw_skeleton": [[133, 152], ["enumerate", "numpy.array().astype", "numpy.concatenate().tolist", "len", "cv2.circle", "numpy.array", "numpy.concatenate", "cv2.line", "cv2.putText", "int", "int", "int", "int", "int", "int", "str", "int", "int", "int", "int", "int", "range", "len"], "function", ["None"], ["", "def", "draw_skeleton", "(", "image", ",", "pts", ",", "bones", "=", "None", ",", "cm", "=", "None", ",", "label_kp_order", "=", "False", ",", "r", "=", "6", ")", ":", "\n", "    ", "for", "i", ",", "pt", "in", "enumerate", "(", "pts", ")", ":", "\n", "        ", "if", "len", "(", "pt", ")", ">", "1", ":", "\n", "            ", "if", "pt", "[", "0", "]", ">", "0", "and", "pt", "[", "1", "]", ">", "0", ":", "\n", "                ", "image", "=", "cv2", ".", "circle", "(", "image", ",", "(", "int", "(", "pt", "[", "0", "]", ")", ",", "int", "(", "pt", "[", "1", "]", ")", ")", ",", "r", ",", "cm", ",", "-", "1", ")", "\n", "if", "label_kp_order", "and", "i", "in", "bones", ":", "\n", "                    ", "img", "=", "cv2", ".", "putText", "(", "image", ",", "str", "(", "i", ")", ",", "(", "int", "(", "pt", "[", "0", "]", ")", ",", "int", "(", "pt", "[", "1", "]", ")", ")", ",", "cv2", ".", "FONT_HERSHEY_COMPLEX", ",", "1", ",", "(", "255", ",", "215", ",", "0", ")", ",", "1", ")", "\n", "\n", "", "", "", "", "if", "bones", "is", "not", "None", ":", "\n", "        ", "set_colors", "=", "np", ".", "array", "(", "[", "cm", "for", "i", "in", "range", "(", "len", "(", "bones", ")", ")", "]", ")", ".", "astype", "(", "np", ".", "int", ")", "\n", "\n", "bones", "=", "np", ".", "concatenate", "(", "[", "bones", ",", "set_colors", "]", ",", "1", ")", ".", "tolist", "(", ")", "\n", "for", "line", "in", "bones", ":", "\n", "            ", "pa", "=", "pts", "[", "line", "[", "0", "]", "]", "\n", "pb", "=", "pts", "[", "line", "[", "1", "]", "]", "\n", "if", "(", "pa", ">", "0", ")", ".", "all", "(", ")", "and", "(", "pb", ">", "0", ")", ".", "all", "(", ")", ":", "\n", "                ", "xa", ",", "ya", ",", "xb", ",", "yb", "=", "int", "(", "pa", "[", "0", "]", ")", ",", "int", "(", "pa", "[", "1", "]", ")", ",", "int", "(", "pb", "[", "0", "]", ")", ",", "int", "(", "pb", "[", "1", "]", ")", "\n", "image", "=", "cv2", ".", "line", "(", "image", ",", "(", "xa", ",", "ya", ")", ",", "(", "xb", ",", "yb", ")", ",", "(", "int", "(", "line", "[", "2", "]", ")", ",", "int", "(", "line", "[", "3", "]", ")", ",", "int", "(", "line", "[", "4", "]", ")", ")", ",", "r", ")", "\n", "", "", "", "return", "image", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.draw_skeleton_multiperson": [[172, 183], ["zip", "numpy.array", "demo.joint_mapping", "demo.draw_skeleton", "range", "len", "len"], "function", ["home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.joint_mapping", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.draw_skeleton"], ["def", "draw_skeleton_multiperson", "(", "image", ",", "pts_group", ",", "skeletons", ",", "colors", "=", "None", ")", ":", "\n", "    ", "if", "colors", "is", "None", ":", "\n", "        ", "colors", "=", "np", ".", "array", "(", "[", "color_table", "[", "i", "%", "len", "(", "color_table", ")", "]", "for", "i", "in", "range", "(", "len", "(", "pts_group", ")", ")", "]", ")", "\n", "", "for", "pts", ",", "skeleton", ",", "color", "in", "zip", "(", "pts_group", ",", "skeletons", ",", "colors", ")", ":", "\n", "        ", "if", "pts", "is", "None", ":", "\n", "            ", "continue", "\n", "", "kp2d_mapping", "=", "joint_mapping", "(", "skeleton", ",", "SMPL_ALL_54", ")", "\n", "kp2d", "=", "pts", "[", "kp2d_mapping", "]", "\n", "kp2d", "[", "kp2d_mapping", "==", "-", "1", "]", "=", "-", "2", "\n", "image", "=", "draw_skeleton", "(", "image", ",", "kp2d", ",", "bones", "=", "All54_connMat", ",", "cm", "=", "color", ")", "\n", "", "return", "image", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.visualize_2d": [[184, 198], ["numpy.array().astype", "numpy.array", "demo.draw_skeleton_multiperson", "enumerate", "cv2.imshow", "cv2.waitKey", "cv2.putText", "numpy.array", "tuple", "tuple", "range", "len", "numpy.array", "len"], "function", ["home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.draw_skeleton_multiperson"], ["", "def", "visualize_2d", "(", "image", ",", "packed_annots", ")", ":", "\n", "    ", "kp2ds_info", ",", "bboxes", ",", "meta_info", "=", "packed_annots", "\n", "kp2ds", ",", "skeletons", "=", "[", "kp", "[", "0", "]", "for", "kp", "in", "kp2ds_info", "]", ",", "[", "kp", "[", "1", "]", "for", "kp", "in", "kp2ds_info", "]", "\n", "vboxes", "=", "np", ".", "array", "(", "[", "bbox", "[", "0", "]", "for", "bbox", "in", "bboxes", "]", ")", ".", "astype", "(", "np", ".", "int", ")", "\n", "\n", "colors", "=", "np", ".", "array", "(", "[", "color_table", "[", "i", "%", "len", "(", "color_table", ")", "]", "for", "i", "in", "range", "(", "len", "(", "kp2ds", ")", ")", "]", ")", "\n", "skeleton_image", "=", "draw_skeleton_multiperson", "(", "image", ",", "kp2ds", ",", "skeletons", ",", "colors", "=", "colors", ")", "\n", "for", "ind", ",", "vbox", "in", "enumerate", "(", "vboxes", ")", ":", "\n", "#cv2.rectangle(image, tuple(vbox[:2]), tuple(vbox[2:]), tuple(colors[ind]), 2)", "\n", "        ", "depth", ",", "age", ",", "gender", "=", "meta_info", "[", "ind", "]", "\n", "info", "=", "'D{}, {}, {}'", ".", "format", "(", "depth", ",", "name_dict", "[", "'age'", "]", "[", "age", "]", ",", "name_dict", "[", "'gender'", "]", "[", "gender", "]", ")", "\n", "cv2", ".", "putText", "(", "image", ",", "info", ",", "tuple", "(", "vbox", "[", ":", "2", "]", "+", "np", ".", "array", "(", "[", "0", ",", "24", "]", ")", ")", ",", "cv2", ".", "FONT_HERSHEY_COMPLEX", ",", "1", ",", "tuple", "(", "colors", "[", "ind", "]", ")", ",", "2", ")", "\n", "", "cv2", ".", "imshow", "(", "'skeleton'", ",", "skeleton_image", ")", "\n", "cv2", ".", "waitKey", "(", "0", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.calc_crop_bbox": [[199, 212], ["numpy.array", "numpy.zeros", "enumerate", "kp2d[].min", "kp2d[].max", "kp2d[].min", "kp2d[].max", "numpy.array", "numpy.array", "len", "numpy.array"], "function", ["None"], ["", "def", "calc_crop_bbox", "(", "kp2ds", ",", "expand_ratio", "=", "np", ".", "array", "(", "[", "1.1", ",", "1.2", "]", ")", ")", ":", "\n", "    ", "vis_masks", "=", "(", "kp2ds", ">", "0", ")", ".", "sum", "(", "-", "1", ")", ">", "1", "\n", "bboxes", "=", "np", ".", "zeros", "(", "(", "len", "(", "kp2ds", ")", ",", "3", ",", "2", ")", ",", "dtype", "=", "np", ".", "int", ")", "\n", "for", "ind", ",", "kp2d", "in", "enumerate", "(", "kp2ds", ")", ":", "\n", "        ", "left", "=", "kp2d", "[", "vis_masks", "[", "ind", "]", ",", "0", "]", ".", "min", "(", ")", "\n", "right", "=", "kp2d", "[", "vis_masks", "[", "ind", "]", ",", "0", "]", ".", "max", "(", ")", "\n", "top", "=", "kp2d", "[", "vis_masks", "[", "ind", "]", ",", "1", "]", ".", "min", "(", ")", "\n", "bottom", "=", "kp2d", "[", "vis_masks", "[", "ind", "]", ",", "1", "]", ".", "max", "(", ")", "\n", "center", "=", "np", ".", "array", "(", "[", "(", "left", "+", "right", ")", "/", "2", ",", "(", "top", "+", "bottom", ")", "/", "2", "]", ")", "\n", "width_height", "=", "np", ".", "array", "(", "[", "right", "-", "left", ",", "bottom", "-", "top", "]", ")", "*", "expand_ratio", "\n", "ltrbxy", "=", "np", ".", "array", "(", "[", "center", "-", "width_height", "/", "2", ",", "center", "+", "width_height", "/", "2", ",", "center", "]", ")", "\n", "bboxes", "[", "ind", "]", "=", "ltrbxy", "\n", "", "return", "bboxes", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.visualize_3d": [[213, 259], ["vedo.Plotter", "numpy.array", "demo.calc_crop_bbox", "numpy.array", "vedo.Picture", "vedo.Picture.z", "enumerate", "vedo.Plotter.show", "vedo.Plotter.close", "copy.deepcopy", "demo.draw_skeleton_multiperson", "vedo.Text3D", "vedo.Picture", "vedo.Picture.z().x().y", "os.system", "range", "vedo.Picture.z().x", "len", "meta_info[].max", "len", "vedo.Picture.z"], "function", ["home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.calc_crop_bbox", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.draw_skeleton_multiperson"], ["", "def", "visualize_3d", "(", "image", ",", "packed_annots", ",", "interactive_show", "=", "True", ")", ":", "\n", "    ", "try", ":", "\n", "        ", "import", "vedo", "\n", "", "except", ":", "\n", "        ", "os", ".", "system", "(", "'pip install vedo'", ")", "\n", "import", "vedo", "\n", "", "plt", "=", "vedo", ".", "Plotter", "(", "bg", "=", "[", "255", ",", "255", ",", "255", "]", ",", "axes", "=", "1", ",", "offscreen", "=", "not", "interactive_show", ")", "\n", "kp2ds_info", ",", "bboxes", ",", "meta_info", "=", "packed_annots", "\n", "if", "kp2ds_info", "[", "0", "]", "[", "0", "]", "is", "None", ":", "\n", "        ", "return", "\n", "", "kp2ds", "=", "np", ".", "array", "(", "[", "kp", "[", "0", "]", "for", "kp", "in", "kp2ds_info", "]", ")", "\n", "skeletons", "=", "[", "kp", "[", "1", "]", "for", "kp", "in", "kp2ds_info", "]", "\n", "bboxes", "=", "calc_crop_bbox", "(", "kp2ds", ")", "\n", "colors", "=", "np", ".", "array", "(", "[", "color_table", "[", "i", "%", "len", "(", "color_table", ")", "]", "for", "i", "in", "range", "(", "len", "(", "kp2ds", ")", ")", "]", ")", "\n", "\n", "height", "=", "image", ".", "shape", "[", "0", "]", "\n", "depth_interval", "=", "300", "\n", "pic", "=", "vedo", ".", "Picture", "(", "image", "[", ":", ",", ":", ",", ":", ":", "-", "1", "]", ")", "\n", "pic", ".", "z", "(", "-", "(", "meta_info", "[", ":", ",", "0", "]", ".", "max", "(", ")", "+", "1", ")", "*", "depth_interval", ")", "\n", "plt", "+=", "pic", "\n", "\n", "for", "ind", ",", "bbox", "in", "enumerate", "(", "bboxes", ")", ":", "\n", "        ", "(", "l", ",", "t", ")", ",", "(", "r", ",", "b", ")", ",", "(", "cx", ",", "cy", ")", "=", "bbox", "[", "0", "]", ",", "bbox", "[", "1", "]", ",", "bbox", "[", "2", "]", "\n", "crop_image_patch", "=", "copy", ".", "deepcopy", "(", "image", "[", "t", ":", "b", ",", "l", ":", "r", "]", ")", "\n", "kp2d", "=", "kp2ds", "[", "ind", "]", "\n", "kp2d", "[", ":", ",", "0", "]", "-=", "l", "\n", "kp2d", "[", ":", ",", "1", "]", "-=", "t", "\n", "skeleton_image", "=", "draw_skeleton_multiperson", "(", "crop_image_patch", ",", "[", "kp2d", "]", ",", "[", "skeletons", "[", "ind", "]", "]", ",", "colors", "=", "[", "colors", "[", "ind", "]", "]", ")", "\n", "depth", ",", "age", ",", "gender", "=", "meta_info", "[", "ind", "]", "\n", "#info = '{}, {}'.format(name_dict['age'][age], name_dict['gender'][gender])", "\n", "#cv2.putText(skeleton_image, info, (30,30), cv2.FONT_HERSHEY_COMPLEX, 1, tuple(colors[ind]), 2)", "\n", "\n", "crop_h", ",", "crop_w", "=", "crop_image_patch", ".", "shape", "[", ":", "2", "]", "\n", "z", "=", "-", "depth", "*", "depth_interval", "\n", "x", "=", "cx", "-", "crop_w", "/", "2", "\n", "y", "=", "height", "-", "cy", "-", "crop_h", "/", "2", "\n", "depth_text", "=", "'DL={}'", ".", "format", "(", "depth", ")", "\n", "text", "=", "vedo", ".", "Text3D", "(", "depth_text", ",", "(", "cx", "-", "100", ",", "y", "+", "crop_h", "+", "100", ",", "z", ")", ",", "s", "=", "40", ",", "depth", "=", "0.2", ")", "\n", "plt", "+=", "text", "\n", "\n", "pic", "=", "vedo", ".", "Picture", "(", "skeleton_image", "[", ":", ",", ":", ",", ":", ":", "-", "1", "]", ")", "\n", "pic", ".", "z", "(", "z", ")", ".", "x", "(", "x", ")", ".", "y", "(", "y", ")", "\n", "plt", "+=", "pic", "\n", "\n", "", "plt", ".", "show", "(", ")", "\n", "plt", ".", "close", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.main": [[260, 271], ["demo.load_annots", "print", "demo.prepare_annots", "demo.load_image", "demo.visualize_2d", "demo.visualize_3d", "copy.deepcopy", "copy.deepcopy"], "function", ["home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.load_annots", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.prepare_annots", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.load_image", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.visualize_2d", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.None.demo.visualize_3d"], ["", "def", "main", "(", ")", ":", "\n", "    ", "annots", "=", "load_annots", "(", "dataset_dir", ",", "split_name", "=", "'train'", ")", "\n", "for", "example_image_name", "in", "[", "'6182308.jpg'", "]", ":", "#list(annots.keys())", "\n", "        ", "print", "(", "example_image_name", ")", "\n", "packed_annots", "=", "prepare_annots", "(", "annots", "[", "example_image_name", "]", ",", "example_image_name", ")", "\n", "#print_annots_info(packed_annots)", "\n", "\n", "if", "visualiztion", ":", "\n", "            ", "image", "=", "load_image", "(", "example_image_name", ")", "\n", "visualize_2d", "(", "copy", ".", "deepcopy", "(", "image", ")", ",", "packed_annots", ")", "\n", "visualize_3d", "(", "copy", ".", "deepcopy", "(", "image", ")", ",", "packed_annots", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.matching.l2_error": [[4, 6], ["numpy.linalg.norm"], "function", ["None"], ["def", "l2_error", "(", "j1", ",", "j2", ")", ":", "\n", "    ", "return", "np", ".", "linalg", ".", "norm", "(", "j1", "-", "j2", ",", "2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.matching.get_bbx_overlap": [[7, 50], ["numpy.min", "numpy.min", "numpy.max", "numpy.max", "max", "max", "min", "min", "max", "max", "float"], "function", ["None"], ["", "def", "get_bbx_overlap", "(", "p1", ",", "p2", ",", "imgpath", ",", "baseline", "=", "None", ")", ":", "\n", "    ", "min_p1", "=", "np", ".", "min", "(", "p1", ",", "axis", "=", "0", ")", "\n", "min_p2", "=", "np", ".", "min", "(", "p2", ",", "axis", "=", "0", ")", "\n", "max_p1", "=", "np", ".", "max", "(", "p1", ",", "axis", "=", "0", ")", "\n", "max_p2", "=", "np", ".", "max", "(", "p2", ",", "axis", "=", "0", ")", "\n", "\n", "bb1", "=", "{", "}", "\n", "bb2", "=", "{", "}", "\n", "\n", "bb1", "[", "'x1'", "]", "=", "min_p1", "[", "0", "]", "\n", "bb1", "[", "'x2'", "]", "=", "max_p1", "[", "0", "]", "\n", "bb1", "[", "'y1'", "]", "=", "min_p1", "[", "1", "]", "\n", "bb1", "[", "'y2'", "]", "=", "max_p1", "[", "1", "]", "\n", "bb2", "[", "'x1'", "]", "=", "min_p2", "[", "0", "]", "\n", "bb2", "[", "'x2'", "]", "=", "max_p2", "[", "0", "]", "\n", "bb2", "[", "'y1'", "]", "=", "min_p2", "[", "1", "]", "\n", "bb2", "[", "'y2'", "]", "=", "max_p2", "[", "1", "]", "\n", "\n", "assert", "bb1", "[", "'x1'", "]", "<", "bb1", "[", "'x2'", "]", "\n", "assert", "bb1", "[", "'y1'", "]", "<", "bb1", "[", "'y2'", "]", "\n", "assert", "bb2", "[", "'x1'", "]", "<", "bb2", "[", "'x2'", "]", "\n", "assert", "bb2", "[", "'y1'", "]", "<", "bb2", "[", "'y2'", "]", "\n", "# determine the coordinates of the intersection rectangle", "\n", "x_left", "=", "max", "(", "bb1", "[", "'x1'", "]", ",", "bb2", "[", "'x1'", "]", ")", "\n", "y_top", "=", "max", "(", "bb1", "[", "'y1'", "]", ",", "bb2", "[", "'y1'", "]", ")", "\n", "x_right", "=", "min", "(", "bb1", "[", "'x2'", "]", ",", "bb2", "[", "'x2'", "]", ")", "\n", "y_bottom", "=", "min", "(", "bb1", "[", "'y2'", "]", ",", "bb2", "[", "'y2'", "]", ")", "\n", "\n", "# The intersection of two axis-aligned bounding boxes is always an", "\n", "# axis-aligned bounding box", "\n", "intersection_area", "=", "max", "(", "0", ",", "x_right", "-", "x_left", "+", "1", ")", "*", "max", "(", "0", ",", "y_bottom", "-", "y_top", "+", "1", ")", "\n", "\n", "# compute the area of both AABBs", "\n", "bb1_area", "=", "(", "bb1", "[", "'x2'", "]", "-", "bb1", "[", "'x1'", "]", "+", "1", ")", "*", "(", "bb1", "[", "'y2'", "]", "-", "bb1", "[", "'y1'", "]", "+", "1", ")", "\n", "bb2_area", "=", "(", "bb2", "[", "'x2'", "]", "-", "bb2", "[", "'x1'", "]", "+", "1", ")", "*", "(", "bb2", "[", "'y2'", "]", "-", "bb2", "[", "'y1'", "]", "+", "1", ")", "\n", "\n", "# compute the intersection over union by taking the intersection", "\n", "# area and dividing it by the sum of prediction + ground-truth", "\n", "# areas - the interesection area", "\n", "iou", "=", "intersection_area", "/", "float", "(", "bb1_area", "+", "bb2_area", "-", "intersection_area", ")", "\n", "\n", "return", "iou", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.matching.match_2d_greedy": [[51, 172], ["numpy.arange", "numpy.arange", "list", "numpy.zeros", "numpy.zeros", "numpy.array", "numpy.array", "np.zeros.sort", "np.zeros.sort", "numpy.arange", "numpy.setdiff1d", "numpy.arange", "numpy.setdiff1d", "len", "len", "itertools.product", "print", "matching.l2_error", "np.array.append", "np.zeros.append", "np.zeros.append", "len", "falsePositives.append", "len", "vmask.sum", "len", "len", "numpy.sum", "len", "len", "numpy.argmin", "matching.get_bbx_overlap", "misses.append", "str", "numpy.sum", "sum", "len", "print", "excludedGtBecauseInvalid.append", "np.array.append", "misses.append", "excludedGtBecauseInvalid.append", "str", "np.array.append"], "function", ["home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_3DMPPE_RH_results.l2_error", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results.get_bbx_overlap"], ["", "def", "match_2d_greedy", "(", "\n", "pred_kps", ",", "\n", "gtkp", ",", "\n", "valid_mask", ",", "\n", "imgPath", "=", "None", ",", "\n", "baseline", "=", "None", ",", "\n", "iou_thresh", "=", "0.05", ",", "\n", "valid", "=", "None", ",", "\n", "ind", "=", "-", "1", ")", ":", "\n", "    ", "'''\n    matches groundtruth keypoints to the detection by considering all possible matchings.\n    :return: best possible matching, a list of tuples, where each tuple corresponds to one match of pred_person.to gt_person.\n            the order within one tuple is as follows (idx_pred_kps, idx_gt_kps)\n    '''", "\n", "predList", "=", "np", ".", "arange", "(", "len", "(", "pred_kps", ")", ")", "\n", "gtList", "=", "np", ".", "arange", "(", "len", "(", "gtkp", ")", ")", "\n", "# get all pairs of elements in pred_kps, gtkp", "\n", "# all combinations of 2 elements from l1 and l2", "\n", "combs", "=", "list", "(", "product", "(", "predList", ",", "gtList", ")", ")", "\n", "\n", "errors_per_pair", "=", "{", "}", "\n", "errors_per_pair_list", "=", "[", "]", "\n", "for", "comb", "in", "combs", ":", "\n", "        ", "vmask", "=", "valid_mask", "[", "comb", "[", "1", "]", "]", "\n", "assert", "vmask", ".", "sum", "(", ")", ">", "0", ",", "print", "(", "'no valid points'", ")", "\n", "errors_per_pair", "[", "str", "(", "comb", ")", "]", "=", "l2_error", "(", "\n", "pred_kps", "[", "comb", "[", "0", "]", "]", "[", "vmask", ",", ":", "2", "]", ",", "gtkp", "[", "comb", "[", "1", "]", "]", "[", "vmask", ",", ":", "2", "]", ")", "\n", "errors_per_pair_list", ".", "append", "(", "errors_per_pair", "[", "str", "(", "comb", ")", "]", ")", "\n", "\n", "", "gtAssigned", "=", "np", ".", "zeros", "(", "(", "len", "(", "gtkp", ")", ",", ")", ",", "dtype", "=", "bool", ")", "\n", "opAssigned", "=", "np", ".", "zeros", "(", "(", "len", "(", "pred_kps", ")", ",", ")", ",", "dtype", "=", "bool", ")", "\n", "errors_per_pair_list", "=", "np", ".", "array", "(", "errors_per_pair_list", ")", "\n", "\n", "bestMatch", "=", "[", "]", "\n", "excludedGtBecauseInvalid", "=", "[", "]", "\n", "falsePositiveCounter", "=", "0", "\n", "while", "np", ".", "sum", "(", "gtAssigned", ")", "<", "len", "(", "gtAssigned", ")", "and", "np", ".", "sum", "(", "\n", "opAssigned", ")", "+", "falsePositiveCounter", "<", "len", "(", "pred_kps", ")", ":", "\n", "        ", "found", "=", "False", "\n", "falsePositive", "=", "False", "\n", "while", "not", "(", "found", ")", ":", "\n", "            ", "if", "sum", "(", "np", ".", "inf", "==", "errors_per_pair_list", ")", "==", "len", "(", "\n", "errors_per_pair_list", ")", ":", "\n", "                ", "print", "(", "'something went wrong here'", ")", "\n", "\n", "", "minIdx", "=", "np", ".", "argmin", "(", "errors_per_pair_list", ")", "\n", "minComb", "=", "combs", "[", "minIdx", "]", "\n", "# compute IOU", "\n", "iou", "=", "get_bbx_overlap", "(", "\n", "pred_kps", "[", "minComb", "[", "0", "]", "]", ",", "gtkp", "[", "minComb", "[", "1", "]", "]", ",", "imgPath", ",", "baseline", ")", "\n", "# if neither prediction nor ground truth has been matched before and iou", "\n", "# is larger than threshold", "\n", "if", "not", "(", "opAssigned", "[", "minComb", "[", "0", "]", "]", ")", "and", "not", "(", "\n", "gtAssigned", "[", "minComb", "[", "1", "]", "]", ")", "and", "iou", ">=", "iou_thresh", ":", "\n", "#print(imgPath + ': found matching')", "\n", "                ", "found", "=", "True", "\n", "errors_per_pair_list", "[", "minIdx", "]", "=", "np", ".", "inf", "\n", "", "else", ":", "\n", "                ", "errors_per_pair_list", "[", "minIdx", "]", "=", "np", ".", "inf", "\n", "# if errors_per_pair_list[minIdx] >", "\n", "# matching_threshold*headBboxs[combs[minIdx][1]]:", "\n", "if", "iou", "<", "iou_thresh", ":", "\n", "#print(", "\n", "#   imgPath + ': false positive detected using threshold')", "\n", "                    ", "found", "=", "True", "\n", "falsePositive", "=", "True", "\n", "falsePositiveCounter", "+=", "1", "\n", "\n", "# if ground truth of combination is valid keep the match, else exclude", "\n", "# gt from matching", "\n", "", "", "", "if", "not", "(", "valid", "is", "None", ")", ":", "\n", "            ", "if", "valid", "[", "minComb", "[", "1", "]", "]", ":", "\n", "                ", "if", "not", "falsePositive", ":", "\n", "                    ", "bestMatch", ".", "append", "(", "minComb", ")", "\n", "opAssigned", "[", "minComb", "[", "0", "]", "]", "=", "True", "\n", "gtAssigned", "[", "minComb", "[", "1", "]", "]", "=", "True", "\n", "", "", "else", ":", "\n", "                ", "gtAssigned", "[", "minComb", "[", "1", "]", "]", "=", "True", "\n", "excludedGtBecauseInvalid", ".", "append", "(", "minComb", "[", "1", "]", ")", "\n", "\n", "", "", "elif", "not", "falsePositive", ":", "\n", "# same as above but without checking for valid", "\n", "            ", "bestMatch", ".", "append", "(", "minComb", ")", "\n", "opAssigned", "[", "minComb", "[", "0", "]", "]", "=", "True", "\n", "gtAssigned", "[", "minComb", "[", "1", "]", "]", "=", "True", "\n", "\n", "", "", "bestMatch", "=", "np", ".", "array", "(", "bestMatch", ")", "\n", "# add false positives and false negatives to the matching", "\n", "# find which elements have been successfully assigned", "\n", "opAssigned", "=", "[", "]", "\n", "gtAssigned", "=", "[", "]", "\n", "for", "pair", "in", "bestMatch", ":", "\n", "        ", "opAssigned", ".", "append", "(", "pair", "[", "0", "]", ")", "\n", "gtAssigned", ".", "append", "(", "pair", "[", "1", "]", ")", "\n", "", "opAssigned", ".", "sort", "(", ")", "\n", "gtAssigned", ".", "sort", "(", ")", "\n", "\n", "falsePositives", "=", "[", "]", "\n", "misses", "=", "[", "]", "\n", "\n", "# handle false positives", "\n", "opIds", "=", "np", ".", "arange", "(", "len", "(", "pred_kps", ")", ")", "\n", "# returns values of oIds that are not in opAssigned", "\n", "notAssignedIds", "=", "np", ".", "setdiff1d", "(", "opIds", ",", "opAssigned", ")", "\n", "for", "notAssignedId", "in", "notAssignedIds", ":", "\n", "        ", "falsePositives", ".", "append", "(", "notAssignedId", ")", "\n", "", "gtIds", "=", "np", ".", "arange", "(", "len", "(", "gtList", ")", ")", "\n", "# returns values of gtIds that are not in gtAssigned", "\n", "notAssignedIdsGt", "=", "np", ".", "setdiff1d", "(", "gtIds", ",", "gtAssigned", ")", "\n", "\n", "# handle false negatives/misses", "\n", "for", "notAssignedIdGt", "in", "notAssignedIdsGt", ":", "\n", "        ", "if", "not", "(", "valid", "is", "None", ")", ":", "# if using the new matching", "\n", "            ", "if", "valid", "[", "notAssignedIdGt", "]", ":", "\n", "                ", "misses", ".", "append", "(", "notAssignedIdGt", ")", "\n", "", "else", ":", "\n", "                ", "excludedGtBecauseInvalid", ".", "append", "(", "notAssignedIdGt", ")", "\n", "", "", "else", ":", "\n", "            ", "misses", ".", "append", "(", "notAssignedIdGt", ")", "\n", "\n", "", "", "return", "bestMatch", ",", "falsePositives", ",", "misses", "# tuples are (idx_pred_kps, idx_gt_kps)", "", "", ""]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results.Evaluate.__init__": [[80, 92], ["object.__init__", "eval_SMAP_RH_results.Evaluate.load_gt", "eval_SMAP_RH_results.Evaluate.collect_results", "eval_SMAP_RH_results.joint_mapping", "eval_SMAP_RH_results.joint_mapping", "eval_SMAP_RH_results.joint_mapping", "eval_SMAP_RH_results.Evaluate.match_kp2ds", "print", "eval_SMAP_RH_results.Evaluate.calc_error"], "methods", ["home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.__init__", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.load_gt", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.collect_results", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.joint_mapping", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.joint_mapping", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.joint_mapping", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.match_kp2ds", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.calc_error"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", "Evaluate", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "set_name", "=", "[", "'val'", ",", "'test'", "]", "[", "1", "]", "\n", "self", ".", "load_gt", "(", ")", "\n", "self", ".", "collect_results", "(", ")", "\n", "\n", "self", ".", "kp2d_mapper_BK", "=", "joint_mapping", "(", "BK_19", ",", "Crowdpose_14", ")", "\n", "self", ".", "kp2d_mapper_OCH", "=", "joint_mapping", "(", "OCHuman_19", ",", "Crowdpose_14", ")", "\n", "self", ".", "kp2d_mapper_MPI", "=", "joint_mapping", "(", "SMAP_15", ",", "Crowdpose_14", ")", "\n", "self", ".", "match_kp2ds", "(", ")", "\n", "print", "(", "'Results on {} set'", ".", "format", "(", "self", ".", "set_name", ")", ")", "\n", "self", ".", "calc_error", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results.Evaluate.collect_results": [[93, 95], ["numpy.load"], "methods", ["None"], ["", "def", "collect_results", "(", "self", ")", ":", "\n", "        ", "self", ".", "results", "=", "np", ".", "load", "(", "results_path", ",", "allow_pickle", "=", "True", ")", "[", "'results'", "]", "[", "(", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results.Evaluate.collect_results2": [[96, 108], ["print", "list", "numpy.savez", "json.load", "eval_SMAP_RH_results.Evaluate.results.keys", "open", "numpy.array", "numpy.array", "numpy.array"], "methods", ["None"], ["", "def", "collect_results2", "(", "self", ")", ":", "\n", "        ", "print", "(", "'loading results..'", ")", "\n", "outputs", "=", "json", ".", "load", "(", "open", "(", "\"/home/yusun/data_drive/evaluation_results/Relative_results/zip_files/SMAP_relative_human_results.json\"", ",", "'r'", ")", ")", "[", "'3d_pairs'", "]", "\n", "self", ".", "results", "=", "{", "}", "\n", "for", "out", "in", "outputs", ":", "\n", "            ", "img_name", "=", "out", "[", "'image_path'", "]", "\n", "self", ".", "results", "[", "img_name", "]", "=", "{", "'kp3ds'", ":", "np", ".", "array", "(", "out", "[", "'pred_3d'", "]", ")", ",", "'kp2ds'", ":", "np", ".", "array", "(", "out", "[", "'pred_2d'", "]", ")", ",", "'root_depth'", ":", "np", ".", "array", "(", "out", "[", "'root_d'", "]", ")", "}", "\n", "", "img_names", "=", "list", "(", "self", ".", "results", ".", "keys", "(", ")", ")", "\n", "for", "img_name", "in", "img_names", ":", "\n", "            ", "if", "img_name", "not", "in", "self", ".", "annots", ":", "\n", "                ", "del", "self", ".", "results", "[", "img_name", "]", "\n", "", "", "np", ".", "savez", "(", "'/home/yusun/data_drive/evaluation_results/Relative_results/zip_files/SMAP_RH_results.npz'", ",", "results", "=", "self", ".", "results", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results.Evaluate.load_gt": [[109, 114], ["print", "os.path.join", "numpy.load"], "methods", ["None"], ["", "def", "load_gt", "(", "self", ")", ":", "\n", "        ", "print", "(", "'loading gt ..'", ")", "\n", "self", ".", "annotations", "=", "{", "}", "\n", "annot_dir", "=", "os", ".", "path", ".", "join", "(", "RH_dir", ",", "'{}_annots.npz'", ".", "format", "(", "self", ".", "set_name", ")", ")", "\n", "self", ".", "annots", "=", "np", ".", "load", "(", "annot_dir", ",", "allow_pickle", "=", "True", ")", "[", "'annots'", "]", "[", "(", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results.Evaluate.no_predictions": [[115, 119], ["eval_SMAP_RH_results.Evaluate.pr[].append", "eval_SMAP_RH_results.Evaluate.pr[].append", "eval_SMAP_RH_results.Evaluate.pr[].append"], "methods", ["None"], ["", "def", "no_predictions", "(", "self", ",", "miss_num", ")", ":", "\n", "        ", "self", ".", "pr", "[", "'all'", "]", ".", "append", "(", "0", ")", "\n", "self", ".", "pr", "[", "'falsePositive'", "]", ".", "append", "(", "0", ")", "\n", "self", ".", "pr", "[", "'miss'", "]", ".", "append", "(", "miss_num", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results.Evaluate.match_kp2ds": [[120, 192], ["eval_SMAP_RH_results.Evaluate.annots.keys", "eval_SMAP_RH_results.compute_prf1", "print", "enumerate", "numpy.array", "print", "eval_SMAP_RH_results.match_2d_greedy", "eval_SMAP_RH_results.Evaluate.pr[].append", "eval_SMAP_RH_results.Evaluate.pr[].append", "eval_SMAP_RH_results.Evaluate.pr[].append", "sum", "sum", "sum", "numpy.array", "print", "eval_SMAP_RH_results.Evaluate.no_predictions", "valid_gtkps.sum", "valid_predkps.sum", "len", "print", "eval_SMAP_RH_results.Evaluate.no_predictions", "len", "len", "numpy.array", "len", "len", "len", "len", "len", "numpy.array().reshape", "numpy.array.append", "gt_inds.append", "len", "numpy.array", "len", "len", "os.path.basename().replace", "os.path.basename"], "methods", ["home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.compute_prf1", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results.match_2d_greedy", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.no_predictions", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.no_predictions"], ["", "def", "match_kp2ds", "(", "self", ")", ":", "\n", "        ", "self", ".", "match_results", "=", "{", "}", "\n", "self", ".", "pr", "=", "{", "'all'", ":", "[", "]", ",", "'falsePositive'", ":", "[", "]", ",", "'miss'", ":", "[", "]", ",", "}", "\n", "self", ".", "kp2ds", "=", "{", "'gts'", ":", "{", "}", ",", "'preds'", ":", "{", "}", "}", "\n", "for", "img_name", "in", "self", ".", "annots", ".", "keys", "(", ")", ":", "\n", "            ", "annots", "=", "self", ".", "annots", "[", "img_name", "]", "\n", "gt_kp2ds", "=", "[", "]", "\n", "gt_inds", "=", "[", "]", "\n", "for", "idx", ",", "annot", "in", "enumerate", "(", "annots", ")", ":", "\n", "                ", "vbox", "=", "np", ".", "array", "(", "annot", "[", "'bbox'", "]", ")", "\n", "fbox", "=", "vbox", "\n", "if", "'kp2d'", "in", "annot", ":", "\n", "                    ", "if", "annot", "[", "'kp2d'", "]", "is", "not", "None", ":", "\n", "                        ", "joint", "=", "np", ".", "array", "(", "annot", "[", "'kp2d'", "]", ")", ".", "reshape", "(", "(", "-", "1", ",", "3", ")", ")", "\n", "invalid_kp_mask", "=", "joint", "[", ":", ",", "2", "]", "==", "0", "\n", "joint", "[", "invalid_kp_mask", "]", "=", "-", "2.", "\n", "joint", "[", ":", ",", "2", "]", "=", "joint", "[", ":", ",", "2", "]", ">", "0", "\n", "if", "len", "(", "joint", ")", "==", "19", ":", "\n", "                            ", "is_BK", "=", "len", "(", "os", ".", "path", ".", "basename", "(", "img_name", ")", ".", "replace", "(", "'.jpg'", ",", "''", ")", ")", "==", "7", "\n", "if", "is_BK", ":", "\n", "                                ", "joints", "=", "joint", "[", "self", ".", "kp2d_mapper_BK", "]", "\n", "joints", "[", "self", ".", "kp2d_mapper_BK", "==", "-", "1", "]", "=", "-", "2", "\n", "", "else", ":", "\n", "                                ", "joints", "=", "joint", "[", "self", ".", "kp2d_mapper_OCH", "]", "\n", "joints", "[", "self", ".", "kp2d_mapper_OCH", "==", "-", "1", "]", "=", "-", "2", "\n", "", "", "elif", "len", "(", "joint", ")", "==", "14", ":", "\n", "                            ", "joints", "=", "joint", "\n", "", "gt_kp2ds", ".", "append", "(", "joints", ")", "\n", "gt_inds", ".", "append", "(", "idx", ")", "\n", "", "", "", "gt_kp2ds", "=", "np", ".", "array", "(", "gt_kp2ds", ")", "\n", "\n", "if", "img_name", "not", "in", "self", ".", "results", ":", "\n", "                ", "print", "(", "'{} missing from predictions'", ".", "format", "(", "img_name", ")", ")", "\n", "self", ".", "no_predictions", "(", "len", "(", "gt_kp2ds", ")", ")", "\n", "continue", "\n", "", "results", "=", "self", ".", "results", "[", "img_name", "]", "\n", "pred_kp2ds", "=", "results", "[", "'kp2ds'", "]", "\n", "pred_kp2ds", "[", "pred_kp2ds", "[", ":", ",", ":", ",", "3", "]", "<=", "0", "]", "=", "-", "2.", "\n", "pred_kp2ds", "=", "pred_kp2ds", "[", ":", ",", ":", ",", ":", "2", "]", "\n", "pred_kp2ds", "=", "pred_kp2ds", "[", ":", ",", "self", ".", "kp2d_mapper_MPI", "]", "\n", "pred_kp2ds", "[", ":", ",", "self", ".", "kp2d_mapper_MPI", "==", "-", "1", "]", "=", "-", "2", "\n", "\n", "valid_gtkps", "=", "gt_kp2ds", "[", ":", ",", ":", ",", "2", "]", ">", "0", "\n", "valid_person", "=", "valid_gtkps", ".", "sum", "(", "-", "1", ")", ">", "0", "\n", "valid_gtkps", "=", "valid_gtkps", "[", "valid_person", "]", "\n", "gt_kp2ds", "=", "gt_kp2ds", "[", "valid_person", "]", "\n", "\n", "valid_predkps", "=", "pred_kp2ds", "[", ":", ",", ":", ",", "0", "]", ">", "0", "\n", "valid_person", "=", "valid_predkps", ".", "sum", "(", "-", "1", ")", ">", "0", "\n", "valid_predkps", "=", "valid_predkps", "[", "valid_person", "]", "\n", "pred_kp2ds", "=", "pred_kp2ds", "[", "valid_person", "]", "\n", "if", "len", "(", "pred_kp2ds", ")", "==", "0", ":", "\n", "                ", "print", "(", "'no prediction after processed'", ")", "\n", "self", ".", "no_predictions", "(", "len", "(", "gt_kp2ds", ")", ")", "\n", "continue", "\n", "\n", "", "assert", "len", "(", "gt_kp2ds", ")", ">", "0", ",", "print", "(", "'no GT'", ")", "\n", "bestMatch", ",", "falsePositives", ",", "misses", "=", "match_2d_greedy", "(", "pred_kp2ds", ",", "gt_kp2ds", "[", ":", ",", ":", ",", ":", "2", "]", ",", "valid_gtkps", ",", "valid_predkps", ",", "imgPath", "=", "img_name", ")", "\n", "\n", "if", "len", "(", "bestMatch", ")", ">", "0", ":", "\n", "                ", "pred_ids", ",", "gt_ids", "=", "bestMatch", "[", ":", ",", "0", "]", ",", "bestMatch", "[", ":", ",", "1", "]", "\n", "self", ".", "kp2ds", "[", "'gts'", "]", "[", "img_name", "]", "=", "gt_kp2ds", "[", "gt_ids", ",", ":", ",", ":", "2", "]", "\n", "self", ".", "kp2ds", "[", "'preds'", "]", "[", "img_name", "]", "=", "pred_kp2ds", "[", "pred_ids", "]", "\n", "bestMatch", "[", ":", ",", "1", "]", "=", "np", ".", "array", "(", "[", "gt_inds", "[", "ind", "]", "for", "ind", "in", "gt_ids", "]", ")", "\n", "", "self", ".", "match_results", "[", "img_name", "]", "=", "bestMatch", "\n", "self", ".", "pr", "[", "'all'", "]", ".", "append", "(", "len", "(", "pred_kp2ds", ")", ")", "\n", "self", ".", "pr", "[", "'falsePositive'", "]", ".", "append", "(", "len", "(", "falsePositives", ")", ")", "\n", "self", ".", "pr", "[", "'miss'", "]", ".", "append", "(", "len", "(", "misses", ")", ")", "\n", "\n", "", "all_precision", ",", "all_recall", ",", "all_f1_score", "=", "compute_prf1", "(", "sum", "(", "self", ".", "pr", "[", "'all'", "]", ")", ",", "sum", "(", "self", ".", "pr", "[", "'miss'", "]", ")", ",", "sum", "(", "self", ".", "pr", "[", "'falsePositive'", "]", ")", ")", "\n", "\n", "print", "(", "'Precision: {} | Recall: {} | F1 score: {}'", ".", "format", "(", "all_precision", ",", "all_recall", ",", "all_f1_score", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results.Evaluate.calc_error": [[194, 222], ["eval_SMAP_RH_results.Evaluate.match_results.items", "eval_SMAP_RH_results.get_results", "get_results.items", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.zeros", "torch.ones().bool", "eval_SMAP_RH_results._calc_relative_depth_error_weak_", "print", "len", "numpy.array", "numpy.array", "numpy.array", "len", "torch.ones", "torch.ones().bool.cpu", "len", "float", "item.item"], "methods", ["home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.get_results", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation._calc_relative_depth_error_weak_"], ["", "def", "calc_error", "(", "self", ")", ":", "\n", "        ", "self", ".", "mPCKh", "=", "[", "]", "\n", "depth_relative", "=", "{", "'eq'", ":", "[", "]", ",", "'cd'", ":", "[", "]", ",", "'fd'", ":", "[", "]", ",", "'eq_age'", ":", "[", "]", ",", "'cd_age'", ":", "[", "]", ",", "'fd_age'", ":", "[", "]", "}", "\n", "for", "img_name", ",", "match_mat", "in", "self", ".", "match_results", ".", "items", "(", ")", ":", "\n", "            ", "if", "len", "(", "match_mat", ")", "==", "0", ":", "\n", "                ", "continue", "\n", "", "pred_ids", ",", "gt_ids", "=", "match_mat", "[", ":", ",", "0", "]", ",", "match_mat", "[", ":", ",", "1", "]", "\n", "annots", "=", "self", ".", "annots", "[", "img_name", "]", "\n", "results", "=", "self", ".", "results", "[", "img_name", "]", "\n", "depth_ids", "=", "torch", ".", "from_numpy", "(", "np", ".", "array", "(", "[", "annots", "[", "ind", "]", "[", "'depth_id'", "]", "for", "ind", "in", "gt_ids", "]", ")", ")", "\n", "pred_depth", "=", "torch", ".", "from_numpy", "(", "np", ".", "array", "(", "[", "results", "[", "'root_depth'", "]", "[", "ind", "]", "for", "ind", "in", "pred_ids", "]", ")", ")", "\n", "age_ids", "=", "torch", ".", "from_numpy", "(", "np", ".", "array", "(", "[", "annots", "[", "ind", "]", "[", "'age'", "]", "for", "ind", "in", "gt_ids", "]", ")", ")", "\n", "default_organize_idx", "=", "torch", ".", "zeros", "(", "len", "(", "depth_ids", ")", ")", "\n", "\n", "# mPCKh = _calc_matched_PCKh_(torch.from_numpy(self.kp2ds['gts'][img_name]).float(), torch.from_numpy(self.kp2ds['preds'][img_name]).float(), torch.ones(len(self.kp2ds['gts'][img_name])).bool())", "\n", "# self.mPCKh.append(mPCKh)", "\n", "# matched_mask = mPCKh > args().matching_pckh_thresh", "\n", "matched_mask", "=", "torch", ".", "ones", "(", "len", "(", "depth_ids", ")", ")", ".", "bool", "(", ")", "\n", "relative_depth_errors", "=", "_calc_relative_depth_error_weak_", "(", "pred_depth", ",", "depth_ids", ",", "default_organize_idx", ",", "age_ids", ",", "matched_mask", "=", "matched_mask", ".", "cpu", "(", ")", ")", "\n", "for", "dr_type", "in", "relative_depth_types", ":", "\n", "                ", "depth_relative", "[", "dr_type", "]", "+=", "relative_depth_errors", "[", "dr_type", "]", "\n", "depth_relative", "[", "dr_type", "+", "'_age'", "]", "+=", "relative_depth_errors", "[", "dr_type", "+", "'_age'", "]", "\n", "# SMAP mPCKh really bad", "\n", "# all_mPCKh = torch.cat(self.mPCKh).mean()", "\n", "# print('mPCKh_0.6: {:.2f}'.format(all_mPCKh * 100))", "\n", "", "", "eval_results", "=", "get_results", "(", "depth_relative", ")", "\n", "for", "key", ",", "item", "in", "eval_results", ".", "items", "(", ")", ":", "\n", "            ", "print", "(", "'{}: {:.2f}'", ".", "format", "(", "key", ",", "float", "(", "item", ".", "item", "(", ")", ")", "*", "100", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results.l2_error": [[12, 14], ["numpy.linalg.norm"], "function", ["None"], ["def", "l2_error", "(", "j1", ",", "j2", ")", ":", "\n", "    ", "return", "np", ".", "linalg", ".", "norm", "(", "j1", "-", "j2", ",", "2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results._calc_relative_depth_error_weak_": [[15, 48], ["depth_ids.to.to", "torch.unique", "sample_inds.sum", "torch.triu().bool", "error_dict[].append", "error_dict[].append", "error_dict[].append", "error_dict[].append", "error_dict[].append", "error_dict[].append", "torch.triu", "pred_depths_sample.unsqueeze().repeat", "pred_depths_sample.unsqueeze().repeat", "depth_ids[].unsqueeze().repeat", "depth_ids[].unsqueeze().repeat", "torch.cat", "torch.ones", "pred_depths_sample.unsqueeze", "pred_depths_sample.unsqueeze", "depth_ids[].unsqueeze", "depth_ids[].unsqueeze", "age_sample.unsqueeze().repeat().unsqueeze", "age_sample.unsqueeze().repeat().unsqueeze", "age_sample.unsqueeze().repeat", "age_sample.unsqueeze().repeat", "age_sample.unsqueeze", "age_sample.unsqueeze"], "function", ["None"], ["", "def", "_calc_relative_depth_error_weak_", "(", "pred_depths", ",", "depth_ids", ",", "reorganize_idx", ",", "age_gts", "=", "None", ",", "matched_mask", "=", "None", ")", ":", "\n", "    ", "depth_ids", "=", "depth_ids", ".", "to", "(", "pred_depths", ".", "device", ")", "\n", "depth_ids_vmask", "=", "depth_ids", "!=", "-", "1", "\n", "pred_depths_valid", "=", "pred_depths", "[", "depth_ids_vmask", "]", "\n", "valid_inds", "=", "reorganize_idx", "[", "depth_ids_vmask", "]", "\n", "depth_ids", "=", "depth_ids", "[", "depth_ids_vmask", "]", "\n", "age_gts", "=", "age_gts", "[", "depth_ids_vmask", "]", "\n", "error_dict", "=", "{", "'eq'", ":", "[", "]", ",", "'cd'", ":", "[", "]", ",", "'fd'", ":", "[", "]", ",", "'eq_age'", ":", "[", "]", ",", "'cd_age'", ":", "[", "]", ",", "'fd_age'", ":", "[", "]", "}", "\n", "error_each_age", "=", "{", "age_type", ":", "[", "]", "for", "age_type", "in", "relative_age_types", "}", "\n", "for", "b_ind", "in", "torch", ".", "unique", "(", "valid_inds", ")", ":", "\n", "        ", "sample_inds", "=", "valid_inds", "==", "b_ind", "\n", "if", "matched_mask", "is", "not", "None", ":", "\n", "            ", "sample_inds", "*=", "matched_mask", "[", "depth_ids_vmask", "]", "\n", "", "did_num", "=", "sample_inds", ".", "sum", "(", ")", "\n", "if", "did_num", ">", "1", ":", "\n", "            ", "pred_depths_sample", "=", "pred_depths_valid", "[", "sample_inds", "]", "\n", "triu_mask", "=", "torch", ".", "triu", "(", "torch", ".", "ones", "(", "did_num", ",", "did_num", ")", ",", "diagonal", "=", "1", ")", ".", "bool", "(", ")", "\n", "dist_mat", "=", "(", "pred_depths_sample", ".", "unsqueeze", "(", "0", ")", ".", "repeat", "(", "did_num", ",", "1", ")", "-", "pred_depths_sample", ".", "unsqueeze", "(", "1", ")", ".", "repeat", "(", "1", ",", "did_num", ")", ")", "[", "triu_mask", "]", "\n", "did_mat", "=", "(", "depth_ids", "[", "sample_inds", "]", ".", "unsqueeze", "(", "0", ")", ".", "repeat", "(", "did_num", ",", "1", ")", "-", "depth_ids", "[", "sample_inds", "]", ".", "unsqueeze", "(", "1", ")", ".", "repeat", "(", "1", ",", "did_num", ")", ")", "[", "triu_mask", "]", "\n", "\n", "error_dict", "[", "'eq'", "]", ".", "append", "(", "dist_mat", "[", "did_mat", "==", "0", "]", ")", "\n", "error_dict", "[", "'cd'", "]", ".", "append", "(", "dist_mat", "[", "did_mat", "<", "0", "]", ")", "\n", "error_dict", "[", "'fd'", "]", ".", "append", "(", "dist_mat", "[", "did_mat", ">", "0", "]", ")", "\n", "if", "age_gts", "is", "not", "None", ":", "\n", "                ", "age_sample", "=", "age_gts", "[", "sample_inds", "]", "\n", "age_mat", "=", "torch", ".", "cat", "(", "[", "age_sample", ".", "unsqueeze", "(", "0", ")", ".", "repeat", "(", "did_num", ",", "1", ")", ".", "unsqueeze", "(", "-", "1", ")", ",", "age_sample", ".", "unsqueeze", "(", "1", ")", ".", "repeat", "(", "1", ",", "did_num", ")", ".", "unsqueeze", "(", "-", "1", ")", "]", ",", "-", "1", ")", "[", "triu_mask", "]", "\n", "error_dict", "[", "'eq_age'", "]", ".", "append", "(", "age_mat", "[", "did_mat", "==", "0", "]", ")", "\n", "error_dict", "[", "'cd_age'", "]", ".", "append", "(", "age_mat", "[", "did_mat", "<", "0", "]", ")", "\n", "error_dict", "[", "'fd_age'", "]", ".", "append", "(", "age_mat", "[", "did_mat", ">", "0", "]", ")", "\n", "# error_dict['all'].append([len(eq_dists), len(cd_dists), len(fd_dists)]) ", "\n", "# error_dict['correct'].append([(torch.abs(eq_dists)<thresh).sum().item(), (cd_dists<-thresh).sum().item(), (fd_dists>thresh).sum().item()])", "\n", "\n", "", "", "", "return", "error_dict", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results.joint_mapping": [[72, 78], ["numpy.array", "numpy.ones", "len"], "function", ["None"], ["def", "joint_mapping", "(", "source_format", ",", "target_format", ")", ":", "\n", "    ", "mapping", "=", "np", ".", "ones", "(", "len", "(", "target_format", ")", ",", "dtype", "=", "np", ".", "int", ")", "*", "-", "1", "\n", "for", "joint_name", "in", "target_format", ":", "\n", "        ", "if", "joint_name", "in", "source_format", ":", "\n", "            ", "mapping", "[", "target_format", "[", "joint_name", "]", "]", "=", "source_format", "[", "joint_name", "]", "\n", "", "", "return", "np", ".", "array", "(", "mapping", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results.get_results": [[224, 244], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "numpy.array", "print", "torch.cat", "enumerate", "torch.cat.sum", "np.array.sum", "len", "len", "len", "torch.abs", "age_mask.sum", "dr_corrects[].sum", "age_mask.sum", "dr_corrects[].sum().item", "dr_corrects[].sum().item", "dr_corrects[].sum().item", "dr_corrects[].sum", "dr_corrects[].sum", "dr_corrects[].sum"], "function", ["None"], ["", "", "", "def", "get_results", "(", "depth_relative", ",", "dr_thresh", "=", "0.2", ")", ":", "\n", "    ", "eval_results", "=", "{", "}", "\n", "eq_dists", "=", "torch", ".", "cat", "(", "depth_relative", "[", "'eq'", "]", ",", "0", ")", "\n", "cd_dists", "=", "torch", ".", "cat", "(", "depth_relative", "[", "'cd'", "]", ",", "0", ")", "\n", "fd_dists", "=", "torch", ".", "cat", "(", "depth_relative", "[", "'fd'", "]", ",", "0", ")", "\n", "eq_age_ids", "=", "torch", ".", "cat", "(", "depth_relative", "[", "'eq_age'", "]", ",", "0", ")", "\n", "cd_age_ids", "=", "torch", ".", "cat", "(", "depth_relative", "[", "'cd_age'", "]", ",", "0", ")", "\n", "fd_age_ids", "=", "torch", ".", "cat", "(", "depth_relative", "[", "'fd_age'", "]", ",", "0", ")", "\n", "dr_age_ids", "=", "torch", ".", "cat", "(", "[", "eq_age_ids", ",", "cd_age_ids", ",", "fd_age_ids", "]", ",", "0", ")", "\n", "dr_all", "=", "np", ".", "array", "(", "[", "len", "(", "eq_dists", ")", ",", "len", "(", "cd_dists", ")", ",", "len", "(", "fd_dists", ")", "]", ")", "\n", "dr_corrects", "=", "[", "torch", ".", "abs", "(", "eq_dists", ")", "<", "dr_thresh", ",", "cd_dists", "<", "-", "dr_thresh", ",", "fd_dists", ">", "dr_thresh", "]", "\n", "print", "(", "'Thresh: {} | Equal {:.2f} close {:.2f} far {:.2f}'", ".", "format", "(", "dr_thresh", ",", "dr_corrects", "[", "0", "]", ".", "sum", "(", ")", ".", "item", "(", ")", "/", "dr_all", "[", "0", "]", "*", "100", ",", "dr_corrects", "[", "1", "]", ".", "sum", "(", ")", ".", "item", "(", ")", "/", "dr_all", "[", "1", "]", "*", "100", ",", "dr_corrects", "[", "2", "]", ".", "sum", "(", ")", ".", "item", "(", ")", "/", "dr_all", "[", "2", "]", "*", "100", ")", ")", "\n", "dr_corrects", "=", "torch", ".", "cat", "(", "dr_corrects", ",", "0", ")", "\n", "eval_results", "[", "'PCRD_{}'", ".", "format", "(", "dr_thresh", ")", "]", "=", "dr_corrects", ".", "sum", "(", ")", "/", "dr_all", ".", "sum", "(", ")", "\n", "for", "age_ind", ",", "age_name", "in", "enumerate", "(", "relative_age_types", ")", ":", "\n", "        ", "age_mask", "=", "(", "dr_age_ids", "==", "age_ind", ")", ".", "sum", "(", "-", "1", ")", ".", "bool", "(", ")", "\n", "if", "age_mask", ".", "sum", "(", ")", ">", "0", ":", "\n", "            ", "eval_results", "[", "'PCRD_{}_{}'", ".", "format", "(", "dr_thresh", ",", "age_name", ")", "]", "=", "dr_corrects", "[", "age_mask", "]", ".", "sum", "(", ")", "/", "age_mask", ".", "sum", "(", ")", "\n", "", "", "return", "eval_results", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results.get_bbx_overlap": [[245, 293], ["numpy.min", "numpy.min", "numpy.max", "numpy.max", "max", "max", "min", "min", "max", "max", "float", "print", "logging.fatal"], "function", ["None"], ["", "def", "get_bbx_overlap", "(", "p1", ",", "p2", ",", "imgpath", ",", "baseline", "=", "None", ")", ":", "\n", "    ", "min_p1", "=", "np", ".", "min", "(", "p1", ",", "axis", "=", "0", ")", "\n", "min_p2", "=", "np", ".", "min", "(", "p2", ",", "axis", "=", "0", ")", "\n", "max_p1", "=", "np", ".", "max", "(", "p1", ",", "axis", "=", "0", ")", "\n", "max_p2", "=", "np", ".", "max", "(", "p2", ",", "axis", "=", "0", ")", "\n", "\n", "bb1", "=", "{", "}", "\n", "bb2", "=", "{", "}", "\n", "\n", "bb1", "[", "'x1'", "]", "=", "min_p1", "[", "0", "]", "\n", "bb1", "[", "'x2'", "]", "=", "max_p1", "[", "0", "]", "\n", "bb1", "[", "'y1'", "]", "=", "min_p1", "[", "1", "]", "\n", "bb1", "[", "'y2'", "]", "=", "max_p1", "[", "1", "]", "\n", "bb2", "[", "'x1'", "]", "=", "min_p2", "[", "0", "]", "\n", "bb2", "[", "'x2'", "]", "=", "max_p2", "[", "0", "]", "\n", "bb2", "[", "'y1'", "]", "=", "min_p2", "[", "1", "]", "\n", "bb2", "[", "'y2'", "]", "=", "max_p2", "[", "1", "]", "\n", "\n", "try", ":", "\n", "        ", "assert", "bb1", "[", "'x1'", "]", "<", "bb1", "[", "'x2'", "]", "\n", "assert", "bb1", "[", "'y1'", "]", "<", "bb1", "[", "'y2'", "]", "\n", "assert", "bb2", "[", "'x1'", "]", "<", "bb2", "[", "'x2'", "]", "\n", "assert", "bb2", "[", "'y1'", "]", "<", "bb2", "[", "'y2'", "]", "\n", "", "except", "BaseException", ":", "\n", "        ", "print", "(", "bb1", ",", "bb2", ")", "\n", "logging", ".", "fatal", "(", "'why'", ")", "\n", "\n", "# determine the coordinates of the intersection rectangle", "\n", "", "x_left", "=", "max", "(", "bb1", "[", "'x1'", "]", ",", "bb2", "[", "'x1'", "]", ")", "\n", "y_top", "=", "max", "(", "bb1", "[", "'y1'", "]", ",", "bb2", "[", "'y1'", "]", ")", "\n", "x_right", "=", "min", "(", "bb1", "[", "'x2'", "]", ",", "bb2", "[", "'x2'", "]", ")", "\n", "y_bottom", "=", "min", "(", "bb1", "[", "'y2'", "]", ",", "bb2", "[", "'y2'", "]", ")", "\n", "\n", "# The intersection of two axis-aligned bounding boxes is always an", "\n", "# axis-aligned bounding box", "\n", "intersection_area", "=", "max", "(", "0", ",", "x_right", "-", "x_left", "+", "1", ")", "*", "max", "(", "0", ",", "y_bottom", "-", "y_top", "+", "1", ")", "\n", "\n", "# compute the area of both AABBs", "\n", "bb1_area", "=", "(", "bb1", "[", "'x2'", "]", "-", "bb1", "[", "'x1'", "]", "+", "1", ")", "*", "(", "bb1", "[", "'y2'", "]", "-", "bb1", "[", "'y1'", "]", "+", "1", ")", "\n", "bb2_area", "=", "(", "bb2", "[", "'x2'", "]", "-", "bb2", "[", "'x1'", "]", "+", "1", ")", "*", "(", "bb2", "[", "'y2'", "]", "-", "bb2", "[", "'y1'", "]", "+", "1", ")", "\n", "\n", "# compute the intersection over union by taking the intersection", "\n", "# area and dividing it by the sum of prediction + ground-truth", "\n", "# areas - the interesection area", "\n", "iou", "=", "intersection_area", "/", "float", "(", "bb1_area", "+", "bb2_area", "-", "intersection_area", ")", "\n", "\n", "return", "iou", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results.scatter2d": [[295, 329], ["cv2.imread", "cm.tab20c", "plt.figure", "plt.figure.add_subplot", "plt.figure.add_subplot", "fig.add_subplot.imshow", "fig.add_subplot.imshow", "range", "range", "os.path.exists", "os.makedirs", "numpy.linspace", "len", "range", "len", "range", "savename.replace.replace", "plt.savefig", "plt.close", "fig.add_subplot.scatter", "fig.add_subplot.scatter", "imgPath.split", "os.path.join", "baseline.lower"], "function", ["None"], ["", "def", "scatter2d", "(", "gtkp", ",", "openpose", ",", "imgPath", ",", "debug_path", ",", "baseline", ")", ":", "\n", "    ", "import", "cv2", "\n", "import", "matplotlib", ".", "cm", "as", "cm", "\n", "import", "matplotlib", ".", "pyplot", "as", "plt", "\n", "\n", "if", "not", "os", ".", "path", ".", "exists", "(", "debug_path", ")", ":", "\n", "        ", "os", ".", "makedirs", "(", "debug_path", ")", "\n", "", "img", "=", "cv2", ".", "imread", "(", "imgPath", ")", "\n", "img", "=", "img", "[", ":", ",", ":", ",", ":", ":", "-", "1", "]", "\n", "\n", "colors", "=", "cm", ".", "tab20c", "(", "np", ".", "linspace", "(", "0", ",", "1", ",", "25", ")", ")", "\n", "fig", "=", "plt", ".", "figure", "(", "dpi", "=", "300", ")", "\n", "ax", "=", "fig", ".", "add_subplot", "(", "121", ")", "\n", "ax2", "=", "fig", ".", "add_subplot", "(", "122", ")", "\n", "ax", ".", "imshow", "(", "img", ")", "\n", "ax2", ".", "imshow", "(", "img", ")", "\n", "\n", "nkps", "=", "24", "\n", "\n", "for", "pNum", "in", "range", "(", "len", "(", "openpose", ")", ")", ":", "\n", "        ", "for", "i", "in", "range", "(", "nkps", ")", ":", "\n", "            ", "ax", ".", "scatter", "(", "openpose", "[", "pNum", "]", "[", "i", ",", "0", "]", ",", "openpose", "[", "pNum", "]", "\n", "[", "i", ",", "1", "]", ",", "c", "=", "colors", "[", "i", "]", ",", "s", "=", "0.05", ")", "\n", "\n", "", "", "for", "pNum", "in", "range", "(", "len", "(", "gtkp", ")", ")", ":", "\n", "        ", "for", "i", "in", "range", "(", "nkps", ")", ":", "\n", "            ", "ax2", ".", "scatter", "(", "gtkp", "[", "pNum", "]", "[", "i", ",", "0", "]", ",", "gtkp", "[", "pNum", "]", "\n", "[", "i", ",", "1", "]", ",", "c", "=", "colors", "[", "i", "]", ",", "s", "=", "0.05", ")", "\n", "\n", "", "", "if", "not", "(", "imgPath", "is", "None", ")", ":", "\n", "        ", "savename", "=", "imgPath", ".", "split", "(", "'/'", ")", "[", "-", "1", "]", "\n", "savename", "=", "savename", ".", "replace", "(", "'.pkl'", ",", "'.jpg'", ")", "\n", "plt", ".", "savefig", "(", "os", ".", "path", ".", "join", "(", "debug_path", ",", "baseline", ".", "lower", "(", ")", "+", "savename", ")", ")", "\n", "plt", ".", "close", "(", "'all'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results.compute_prf1": [[330, 340], ["round", "round", "round"], "function", ["None"], ["", "", "def", "compute_prf1", "(", "count", ",", "miss", ",", "fp", ")", ":", "\n", "    ", "if", "count", "==", "0", ":", "\n", "        ", "return", "0", ",", "0", ",", "0", "\n", "", "all_tp", "=", "count", "-", "miss", "\n", "all_fp", "=", "fp", "\n", "all_fn", "=", "miss", "\n", "all_f1_score", "=", "round", "(", "all_tp", "/", "(", "all_tp", "+", "0.5", "*", "(", "all_fp", "+", "all_fn", ")", ")", ",", "2", ")", "\n", "all_recall", "=", "round", "(", "all_tp", "/", "(", "all_tp", "+", "all_fn", ")", ",", "2", ")", "\n", "all_precision", "=", "round", "(", "all_tp", "/", "(", "all_tp", "+", "all_fp", ")", ",", "2", ")", "\n", "return", "all_precision", ",", "all_recall", ",", "all_f1_score", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results.match_2d_greedy": [[342, 470], ["numpy.arange", "numpy.arange", "list", "numpy.zeros", "numpy.zeros", "numpy.array", "numpy.array", "np.zeros.sort", "np.zeros.sort", "numpy.arange", "numpy.setdiff1d", "numpy.arange", "numpy.setdiff1d", "len", "len", "itertools.product", "np.array.append", "np.zeros.append", "np.zeros.append", "len", "falsePositives.append", "len", "vmask.sum", "print", "eval_SMAP_RH_results.l2_error", "print", "len", "len", "numpy.sum", "len", "len", "numpy.argmin", "eval_SMAP_RH_results.get_bbx_overlap", "misses.append", "vmask.sum", "numpy.sum", "sum", "len", "print", "excludedGtBecauseInvalid.append", "np.array.append", "misses.append", "excludedGtBecauseInvalid.append", "str", "str", "str", "np.array.append"], "function", ["home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_3DMPPE_RH_results.l2_error", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results.get_bbx_overlap"], ["", "def", "match_2d_greedy", "(", "\n", "pred_kps", ",", "\n", "gtkp", ",", "\n", "valid_gtkps", ",", "valid_predkps", ",", "\n", "imgPath", "=", "None", ",", "\n", "baseline", "=", "None", ",", "\n", "iou_thresh", "=", "0.05", ",", "\n", "valid", "=", "None", ",", "\n", "ind", "=", "-", "1", ")", ":", "\n", "    ", "'''\n    matches groundtruth keypoints to the detection by considering all possible matchings.\n    :return: best possible matching, a list of tuples, where each tuple corresponds to one match of pred_person.to gt_person.\n            the order within one tuple is as follows (idx_pred_kps, idx_gt_kps)\n    '''", "\n", "predList", "=", "np", ".", "arange", "(", "len", "(", "pred_kps", ")", ")", "\n", "gtList", "=", "np", ".", "arange", "(", "len", "(", "gtkp", ")", ")", "\n", "# get all pairs of elements in pred_kps, gtkp", "\n", "# all combinations of 2 elements from l1 and l2", "\n", "combs", "=", "list", "(", "product", "(", "predList", ",", "gtList", ")", ")", "\n", "\n", "errors_per_pair", "=", "{", "}", "\n", "errors_per_pair_list", "=", "[", "]", "\n", "for", "comb", "in", "combs", ":", "\n", "        ", "vmask", "=", "valid_gtkps", "[", "comb", "[", "1", "]", "]", "*", "valid_predkps", "[", "comb", "[", "0", "]", "]", "\n", "if", "vmask", ".", "sum", "(", ")", ">", "0", ":", "\n", "            ", "assert", "vmask", ".", "sum", "(", ")", ">", "0", ",", "print", "(", "'no valid points'", ")", "\n", "errors_per_pair", "[", "str", "(", "comb", ")", "]", "=", "l2_error", "(", "\n", "pred_kps", "[", "comb", "[", "0", "]", "]", "[", "vmask", ",", ":", "2", "]", ",", "gtkp", "[", "comb", "[", "1", "]", "]", "[", "vmask", ",", ":", "2", "]", ")", "\n", "\n", "", "else", ":", "\n", "            ", "print", "(", "'no valid points'", ")", "\n", "errors_per_pair", "[", "str", "(", "comb", ")", "]", "=", "1000.", "\n", "", "errors_per_pair_list", ".", "append", "(", "errors_per_pair", "[", "str", "(", "comb", ")", "]", ")", "\n", "\n", "", "gtAssigned", "=", "np", ".", "zeros", "(", "(", "len", "(", "gtkp", ")", ",", ")", ",", "dtype", "=", "bool", ")", "\n", "opAssigned", "=", "np", ".", "zeros", "(", "(", "len", "(", "pred_kps", ")", ",", ")", ",", "dtype", "=", "bool", ")", "\n", "errors_per_pair_list", "=", "np", ".", "array", "(", "errors_per_pair_list", ")", "\n", "\n", "bestMatch", "=", "[", "]", "\n", "excludedGtBecauseInvalid", "=", "[", "]", "\n", "falsePositiveCounter", "=", "0", "\n", "while", "np", ".", "sum", "(", "gtAssigned", ")", "<", "len", "(", "gtAssigned", ")", "and", "np", ".", "sum", "(", "\n", "opAssigned", ")", "+", "falsePositiveCounter", "<", "len", "(", "pred_kps", ")", ":", "\n", "        ", "found", "=", "False", "\n", "falsePositive", "=", "False", "\n", "while", "not", "(", "found", ")", ":", "\n", "            ", "if", "sum", "(", "np", ".", "inf", "==", "errors_per_pair_list", ")", "==", "len", "(", "\n", "errors_per_pair_list", ")", ":", "\n", "                ", "print", "(", "'something went wrong here'", ")", "\n", "\n", "", "minIdx", "=", "np", ".", "argmin", "(", "errors_per_pair_list", ")", "\n", "minComb", "=", "combs", "[", "minIdx", "]", "\n", "# compute IOU", "\n", "iou", "=", "get_bbx_overlap", "(", "\n", "pred_kps", "[", "minComb", "[", "0", "]", "]", ",", "gtkp", "[", "minComb", "[", "1", "]", "]", ",", "imgPath", ",", "baseline", ")", "\n", "# if neither prediction nor ground truth has been matched before and iou", "\n", "# is larger than threshold", "\n", "if", "not", "(", "opAssigned", "[", "minComb", "[", "0", "]", "]", ")", "and", "not", "(", "\n", "gtAssigned", "[", "minComb", "[", "1", "]", "]", ")", "and", "iou", ">=", "iou_thresh", ":", "\n", "#print(imgPath + ': found matching')", "\n", "                ", "found", "=", "True", "\n", "errors_per_pair_list", "[", "minIdx", "]", "=", "np", ".", "inf", "\n", "", "else", ":", "\n", "                ", "errors_per_pair_list", "[", "minIdx", "]", "=", "np", ".", "inf", "\n", "# if errors_per_pair_list[minIdx] >", "\n", "# matching_threshold*headBboxs[combs[minIdx][1]]:", "\n", "if", "iou", "<", "iou_thresh", ":", "\n", "#print(", "\n", "#   imgPath + ': false positive detected using threshold')", "\n", "                    ", "found", "=", "True", "\n", "falsePositive", "=", "True", "\n", "falsePositiveCounter", "+=", "1", "\n", "\n", "# if ground truth of combination is valid keep the match, else exclude", "\n", "# gt from matching", "\n", "", "", "", "if", "not", "(", "valid", "is", "None", ")", ":", "\n", "            ", "if", "valid", "[", "minComb", "[", "1", "]", "]", ":", "\n", "                ", "if", "not", "falsePositive", ":", "\n", "                    ", "bestMatch", ".", "append", "(", "minComb", ")", "\n", "opAssigned", "[", "minComb", "[", "0", "]", "]", "=", "True", "\n", "gtAssigned", "[", "minComb", "[", "1", "]", "]", "=", "True", "\n", "", "", "else", ":", "\n", "                ", "gtAssigned", "[", "minComb", "[", "1", "]", "]", "=", "True", "\n", "excludedGtBecauseInvalid", ".", "append", "(", "minComb", "[", "1", "]", ")", "\n", "\n", "", "", "elif", "not", "falsePositive", ":", "\n", "# same as above but without checking for valid", "\n", "            ", "bestMatch", ".", "append", "(", "minComb", ")", "\n", "opAssigned", "[", "minComb", "[", "0", "]", "]", "=", "True", "\n", "gtAssigned", "[", "minComb", "[", "1", "]", "]", "=", "True", "\n", "\n", "", "", "bestMatch", "=", "np", ".", "array", "(", "bestMatch", ")", "\n", "# add false positives and false negatives to the matching", "\n", "# find which elements have been successfully assigned", "\n", "opAssigned", "=", "[", "]", "\n", "gtAssigned", "=", "[", "]", "\n", "for", "pair", "in", "bestMatch", ":", "\n", "        ", "opAssigned", ".", "append", "(", "pair", "[", "0", "]", ")", "\n", "gtAssigned", ".", "append", "(", "pair", "[", "1", "]", ")", "\n", "", "opAssigned", ".", "sort", "(", ")", "\n", "gtAssigned", ".", "sort", "(", ")", "\n", "\n", "falsePositives", "=", "[", "]", "\n", "misses", "=", "[", "]", "\n", "\n", "# handle false positives", "\n", "opIds", "=", "np", ".", "arange", "(", "len", "(", "pred_kps", ")", ")", "\n", "# returns values of oIds that are not in opAssigned", "\n", "notAssignedIds", "=", "np", ".", "setdiff1d", "(", "opIds", ",", "opAssigned", ")", "\n", "for", "notAssignedId", "in", "notAssignedIds", ":", "\n", "        ", "falsePositives", ".", "append", "(", "notAssignedId", ")", "\n", "", "gtIds", "=", "np", ".", "arange", "(", "len", "(", "gtList", ")", ")", "\n", "# returns values of gtIds that are not in gtAssigned", "\n", "notAssignedIdsGt", "=", "np", ".", "setdiff1d", "(", "gtIds", ",", "gtAssigned", ")", "\n", "\n", "# handle false negatives/misses", "\n", "for", "notAssignedIdGt", "in", "notAssignedIdsGt", ":", "\n", "        ", "if", "not", "(", "valid", "is", "None", ")", ":", "# if using the new matching", "\n", "            ", "if", "valid", "[", "notAssignedIdGt", "]", ":", "\n", "#print(imgPath + ': miss')", "\n", "                ", "misses", ".", "append", "(", "notAssignedIdGt", ")", "\n", "", "else", ":", "\n", "                ", "excludedGtBecauseInvalid", ".", "append", "(", "notAssignedIdGt", ")", "\n", "", "", "else", ":", "\n", "#print(imgPath + ': miss')", "\n", "            ", "misses", ".", "append", "(", "notAssignedIdGt", ")", "\n", "\n", "", "", "return", "bestMatch", ",", "falsePositives", ",", "misses", "# tuples are (idx_pred_kps, idx_gt_kps)", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_3DMPPE_RH_results.Evaluate.__init__": [[51, 59], ["object.__init__", "eval_3DMPPE_RH_results.Evaluate.load_gt", "eval_3DMPPE_RH_results.Evaluate.collect_results", "print", "eval_3DMPPE_RH_results.Evaluate.calc_error"], "methods", ["home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.__init__", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.load_gt", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.collect_results", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.calc_error"], ["    ", "def", "__init__", "(", "self", ")", ":", "\n", "        ", "super", "(", "Evaluate", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "set_name", "=", "[", "'val'", ",", "'test'", "]", "[", "1", "]", "\n", "self", ".", "load_gt", "(", ")", "\n", "self", ".", "collect_results", "(", ")", "\n", "\n", "print", "(", "'Results on {} set'", ".", "format", "(", "self", ".", "set_name", ")", ")", "\n", "self", ".", "calc_error", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_3DMPPE_RH_results.Evaluate.collect_results": [[60, 62], ["numpy.load"], "methods", ["None"], ["", "def", "collect_results", "(", "self", ")", ":", "\n", "        ", "self", ".", "root_depths", "=", "np", ".", "load", "(", "results_path", ",", "allow_pickle", "=", "True", ")", "[", "'results'", "]", "[", "(", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_3DMPPE_RH_results.Evaluate.collect_results2": [[63, 71], ["print", "list", "numpy.savez", "eval_3DMPPE_RH_results.Evaluate.root_depths.keys", "numpy.load"], "methods", ["None"], ["", "def", "collect_results2", "(", "self", ")", ":", "\n", "        ", "print", "(", "'loading results..'", ")", "\n", "self", ".", "root_depths", "=", "np", ".", "load", "(", "\"/home/yusun/data_drive/evaluation_results/Relative_results/zip_files/3DMPPE_Relative_human_{}_root_depths.npz\"", ".", "format", "(", "self", ".", "set_name", ")", ",", "allow_pickle", "=", "True", ")", "[", "'results'", "]", "[", "(", ")", "]", "\n", "img_names", "=", "list", "(", "self", ".", "root_depths", ".", "keys", "(", ")", ")", "\n", "for", "img_name", "in", "img_names", ":", "\n", "            ", "if", "img_name", "not", "in", "self", ".", "annots", ":", "\n", "                ", "del", "self", ".", "root_depths", "[", "img_name", "]", "\n", "", "", "np", ".", "savez", "(", "results_path", ",", "results", "=", "self", ".", "root_depths", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_3DMPPE_RH_results.Evaluate.load_gt": [[72, 77], ["print", "os.path.join", "numpy.load"], "methods", ["None"], ["", "def", "load_gt", "(", "self", ")", ":", "\n", "        ", "print", "(", "'loading gt ..'", ")", "\n", "self", ".", "annotations", "=", "{", "}", "\n", "annot_dir", "=", "os", ".", "path", ".", "join", "(", "RH_dir", ",", "'{}_annots.npz'", ".", "format", "(", "self", ".", "set_name", ")", ")", "\n", "self", ".", "annots", "=", "np", ".", "load", "(", "annot_dir", ",", "allow_pickle", "=", "True", ")", "[", "'annots'", "]", "[", "(", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_3DMPPE_RH_results.Evaluate.calc_error": [[78, 95], ["eval_3DMPPE_RH_results.Evaluate.annots.items", "eval_3DMPPE_RH_results.get_results", "get_results.items", "torch.from_numpy", "torch.from_numpy", "torch.from_numpy", "torch.zeros", "torch.ones().bool", "eval_3DMPPE_RH_results._calc_relative_depth_error_weak_", "print", "numpy.array", "numpy.array", "numpy.array", "len", "torch.ones", "len", "float", "item.item"], "methods", ["home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.get_results", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation._calc_relative_depth_error_weak_"], ["", "def", "calc_error", "(", "self", ")", ":", "\n", "        ", "depth_relative", "=", "{", "'eq'", ":", "[", "]", ",", "'cd'", ":", "[", "]", ",", "'fd'", ":", "[", "]", ",", "'eq_age'", ":", "[", "]", ",", "'cd_age'", ":", "[", "]", ",", "'fd_age'", ":", "[", "]", "}", "\n", "for", "img_name", ",", "annots", "in", "self", ".", "annots", ".", "items", "(", ")", ":", "\n", "            ", "gt_ids", ",", "pred_depth", "=", "self", ".", "root_depths", "[", "img_name", "]", "\n", "pred_depth", "=", "torch", ".", "from_numpy", "(", "np", ".", "array", "(", "pred_depth", ")", ")", "\n", "depth_ids", "=", "torch", ".", "from_numpy", "(", "np", ".", "array", "(", "[", "annots", "[", "ind", "]", "[", "'depth_id'", "]", "for", "ind", "in", "gt_ids", "]", ")", ")", "\n", "age_ids", "=", "torch", ".", "from_numpy", "(", "np", ".", "array", "(", "[", "annots", "[", "ind", "]", "[", "'age'", "]", "for", "ind", "in", "gt_ids", "]", ")", ")", "\n", "default_organize_idx", "=", "torch", ".", "zeros", "(", "len", "(", "depth_ids", ")", ")", "\n", "matched_mask", "=", "torch", ".", "ones", "(", "len", "(", "depth_ids", ")", ")", ".", "bool", "(", ")", "\n", "relative_depth_errors", "=", "_calc_relative_depth_error_weak_", "(", "pred_depth", ",", "depth_ids", ",", "default_organize_idx", ",", "age_ids", ",", "matched_mask", "=", "matched_mask", ")", "\n", "for", "dr_type", "in", "relative_depth_types", ":", "\n", "                ", "depth_relative", "[", "dr_type", "]", "+=", "relative_depth_errors", "[", "dr_type", "]", "\n", "depth_relative", "[", "dr_type", "+", "'_age'", "]", "+=", "relative_depth_errors", "[", "dr_type", "+", "'_age'", "]", "\n", "\n", "", "", "eval_results", "=", "get_results", "(", "depth_relative", ")", "\n", "for", "key", ",", "item", "in", "eval_results", ".", "items", "(", ")", ":", "\n", "            ", "print", "(", "'{}: {:.2f}'", ".", "format", "(", "key", ",", "float", "(", "item", ".", "item", "(", ")", ")", "*", "100", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_3DMPPE_RH_results.l2_error": [[13, 15], ["numpy.linalg.norm"], "function", ["None"], ["def", "l2_error", "(", "j1", ",", "j2", ")", ":", "\n", "    ", "return", "np", ".", "linalg", ".", "norm", "(", "j1", "-", "j2", ",", "2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_3DMPPE_RH_results._calc_relative_depth_error_weak_": [[16, 49], ["depth_ids.to.to", "torch.unique", "sample_inds.sum", "torch.triu().bool", "error_dict[].append", "error_dict[].append", "error_dict[].append", "error_dict[].append", "error_dict[].append", "error_dict[].append", "torch.triu", "pred_depths_sample.unsqueeze().repeat", "pred_depths_sample.unsqueeze().repeat", "depth_ids[].unsqueeze().repeat", "depth_ids[].unsqueeze().repeat", "torch.cat", "torch.ones", "pred_depths_sample.unsqueeze", "pred_depths_sample.unsqueeze", "depth_ids[].unsqueeze", "depth_ids[].unsqueeze", "age_sample.unsqueeze().repeat().unsqueeze", "age_sample.unsqueeze().repeat().unsqueeze", "age_sample.unsqueeze().repeat", "age_sample.unsqueeze().repeat", "age_sample.unsqueeze", "age_sample.unsqueeze"], "function", ["None"], ["", "def", "_calc_relative_depth_error_weak_", "(", "pred_depths", ",", "depth_ids", ",", "reorganize_idx", ",", "age_gts", "=", "None", ",", "matched_mask", "=", "None", ")", ":", "\n", "    ", "depth_ids", "=", "depth_ids", ".", "to", "(", "pred_depths", ".", "device", ")", "\n", "depth_ids_vmask", "=", "depth_ids", "!=", "-", "1", "\n", "pred_depths_valid", "=", "pred_depths", "[", "depth_ids_vmask", "]", "\n", "valid_inds", "=", "reorganize_idx", "[", "depth_ids_vmask", "]", "\n", "depth_ids", "=", "depth_ids", "[", "depth_ids_vmask", "]", "\n", "age_gts", "=", "age_gts", "[", "depth_ids_vmask", "]", "\n", "error_dict", "=", "{", "'eq'", ":", "[", "]", ",", "'cd'", ":", "[", "]", ",", "'fd'", ":", "[", "]", ",", "'eq_age'", ":", "[", "]", ",", "'cd_age'", ":", "[", "]", ",", "'fd_age'", ":", "[", "]", "}", "\n", "error_each_age", "=", "{", "age_type", ":", "[", "]", "for", "age_type", "in", "relative_age_types", "}", "\n", "for", "b_ind", "in", "torch", ".", "unique", "(", "valid_inds", ")", ":", "\n", "        ", "sample_inds", "=", "valid_inds", "==", "b_ind", "\n", "if", "matched_mask", "is", "not", "None", ":", "\n", "            ", "sample_inds", "*=", "matched_mask", "[", "depth_ids_vmask", "]", "\n", "", "did_num", "=", "sample_inds", ".", "sum", "(", ")", "\n", "if", "did_num", ">", "1", ":", "\n", "            ", "pred_depths_sample", "=", "pred_depths_valid", "[", "sample_inds", "]", "\n", "triu_mask", "=", "torch", ".", "triu", "(", "torch", ".", "ones", "(", "did_num", ",", "did_num", ")", ",", "diagonal", "=", "1", ")", ".", "bool", "(", ")", "\n", "dist_mat", "=", "(", "pred_depths_sample", ".", "unsqueeze", "(", "0", ")", ".", "repeat", "(", "did_num", ",", "1", ")", "-", "pred_depths_sample", ".", "unsqueeze", "(", "1", ")", ".", "repeat", "(", "1", ",", "did_num", ")", ")", "[", "triu_mask", "]", "\n", "did_mat", "=", "(", "depth_ids", "[", "sample_inds", "]", ".", "unsqueeze", "(", "0", ")", ".", "repeat", "(", "did_num", ",", "1", ")", "-", "depth_ids", "[", "sample_inds", "]", ".", "unsqueeze", "(", "1", ")", ".", "repeat", "(", "1", ",", "did_num", ")", ")", "[", "triu_mask", "]", "\n", "\n", "error_dict", "[", "'eq'", "]", ".", "append", "(", "dist_mat", "[", "did_mat", "==", "0", "]", ")", "\n", "error_dict", "[", "'cd'", "]", ".", "append", "(", "dist_mat", "[", "did_mat", "<", "0", "]", ")", "\n", "error_dict", "[", "'fd'", "]", ".", "append", "(", "dist_mat", "[", "did_mat", ">", "0", "]", ")", "\n", "if", "age_gts", "is", "not", "None", ":", "\n", "                ", "age_sample", "=", "age_gts", "[", "sample_inds", "]", "\n", "age_mat", "=", "torch", ".", "cat", "(", "[", "age_sample", ".", "unsqueeze", "(", "0", ")", ".", "repeat", "(", "did_num", ",", "1", ")", ".", "unsqueeze", "(", "-", "1", ")", ",", "age_sample", ".", "unsqueeze", "(", "1", ")", ".", "repeat", "(", "1", ",", "did_num", ")", ".", "unsqueeze", "(", "-", "1", ")", "]", ",", "-", "1", ")", "[", "triu_mask", "]", "\n", "error_dict", "[", "'eq_age'", "]", ".", "append", "(", "age_mat", "[", "did_mat", "==", "0", "]", ")", "\n", "error_dict", "[", "'cd_age'", "]", ".", "append", "(", "age_mat", "[", "did_mat", "<", "0", "]", ")", "\n", "error_dict", "[", "'fd_age'", "]", ".", "append", "(", "age_mat", "[", "did_mat", ">", "0", "]", ")", "\n", "# error_dict['all'].append([len(eq_dists), len(cd_dists), len(fd_dists)]) ", "\n", "# error_dict['correct'].append([(torch.abs(eq_dists)<thresh).sum().item(), (cd_dists<-thresh).sum().item(), (fd_dists>thresh).sum().item()])", "\n", "\n", "", "", "", "return", "error_dict", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_3DMPPE_RH_results.get_results": [[96, 117], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "numpy.array", "print", "torch.cat", "enumerate", "torch.cat.sum", "np.array.sum", "len", "len", "len", "torch.abs", "age_mask.sum", "dr_corrects[].sum", "age_mask.sum", "dr_corrects[].sum().item", "dr_corrects[].sum().item", "dr_corrects[].sum().item", "dr_corrects[].sum", "dr_corrects[].sum", "dr_corrects[].sum"], "function", ["None"], ["", "", "", "def", "get_results", "(", "depth_relative", ",", "dr_thresh", "=", "0.2", ")", ":", "\n", "    ", "eval_results", "=", "{", "}", "\n", "eq_dists", "=", "torch", ".", "cat", "(", "depth_relative", "[", "'eq'", "]", ",", "0", ")", "\n", "cd_dists", "=", "torch", ".", "cat", "(", "depth_relative", "[", "'cd'", "]", ",", "0", ")", "\n", "fd_dists", "=", "torch", ".", "cat", "(", "depth_relative", "[", "'fd'", "]", ",", "0", ")", "\n", "eq_age_ids", "=", "torch", ".", "cat", "(", "depth_relative", "[", "'eq_age'", "]", ",", "0", ")", "\n", "cd_age_ids", "=", "torch", ".", "cat", "(", "depth_relative", "[", "'cd_age'", "]", ",", "0", ")", "\n", "fd_age_ids", "=", "torch", ".", "cat", "(", "depth_relative", "[", "'fd_age'", "]", ",", "0", ")", "\n", "dr_age_ids", "=", "torch", ".", "cat", "(", "[", "eq_age_ids", ",", "cd_age_ids", ",", "fd_age_ids", "]", ",", "0", ")", "\n", "dr_all", "=", "np", ".", "array", "(", "[", "len", "(", "eq_dists", ")", ",", "len", "(", "cd_dists", ")", ",", "len", "(", "fd_dists", ")", "]", ")", "\n", "\n", "dr_corrects", "=", "[", "torch", ".", "abs", "(", "eq_dists", ")", "<", "dr_thresh", ",", "cd_dists", "<", "-", "dr_thresh", ",", "fd_dists", ">", "dr_thresh", "]", "\n", "print", "(", "'Thresh: {} | Equal {:.2f} close {:.2f} far {:.2f}'", ".", "format", "(", "dr_thresh", ",", "dr_corrects", "[", "0", "]", ".", "sum", "(", ")", ".", "item", "(", ")", "/", "dr_all", "[", "0", "]", "*", "100", ",", "dr_corrects", "[", "1", "]", ".", "sum", "(", ")", ".", "item", "(", ")", "/", "dr_all", "[", "1", "]", "*", "100", ",", "dr_corrects", "[", "2", "]", ".", "sum", "(", ")", ".", "item", "(", ")", "/", "dr_all", "[", "2", "]", "*", "100", ")", ")", "\n", "dr_corrects", "=", "torch", ".", "cat", "(", "dr_corrects", ",", "0", ")", "\n", "eval_results", "[", "'PCRD_{}'", ".", "format", "(", "dr_thresh", ")", "]", "=", "dr_corrects", ".", "sum", "(", ")", "/", "dr_all", ".", "sum", "(", ")", "\n", "for", "age_ind", ",", "age_name", "in", "enumerate", "(", "relative_age_types", ")", ":", "\n", "        ", "age_mask", "=", "(", "dr_age_ids", "==", "age_ind", ")", ".", "sum", "(", "-", "1", ")", ".", "bool", "(", ")", "\n", "if", "age_mask", ".", "sum", "(", ")", ">", "0", ":", "\n", "            ", "eval_results", "[", "'PCRD_{}_{}'", ".", "format", "(", "dr_thresh", ",", "age_name", ")", "]", "=", "dr_corrects", "[", "age_mask", "]", ".", "sum", "(", ")", "/", "age_mask", ".", "sum", "(", ")", "\n", "", "", "return", "eval_results", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.__init__": [[131, 143], ["object.__init__", "evaluation.RH_Evaluation.load_gt", "evaluation.RH_Evaluation.collect_results", "results_path.replace", "evaluation.joint_mapping", "evaluation.joint_mapping", "evaluation.RH_Evaluation.match_kp2ds", "print", "evaluation.RH_Evaluation.calc_error"], "methods", ["home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.__init__", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.load_gt", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.collect_results", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.joint_mapping", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.joint_mapping", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.match_kp2ds", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.calc_error"], ["    ", "def", "__init__", "(", "self", ",", "results_path", ",", "RH_dir", ",", "set_name", "=", "'test'", ")", ":", "\n", "        ", "super", "(", "RH_Evaluation", ",", "self", ")", ".", "__init__", "(", ")", "\n", "self", ".", "set_name", "=", "set_name", "\n", "self", ".", "load_gt", "(", "RH_dir", ")", "\n", "self", ".", "collect_results", "(", "results_path", ")", "\n", "self", ".", "results_txt_save_path", "=", "results_path", ".", "replace", "(", "'.npz'", ",", "'_results.txt'", ")", "\n", "\n", "self", ".", "kp2d_mapper_BK", "=", "joint_mapping", "(", "BK_19", ",", "Crowdpose_14", ")", "\n", "self", ".", "kp2d_mapper_OCH", "=", "joint_mapping", "(", "OCHuman_19", ",", "Crowdpose_14", ")", "\n", "self", ".", "match_kp2ds", "(", ")", "\n", "print", "(", "'Results on {} set'", ".", "format", "(", "self", ".", "set_name", ")", ")", "\n", "self", ".", "calc_error", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.collect_results": [[144, 147], ["print", "numpy.load"], "methods", ["None"], ["", "def", "collect_results", "(", "self", ",", "results_path", ")", ":", "\n", "        ", "print", "(", "'loading results ...'", ")", "\n", "self", ".", "results", "=", "np", ".", "load", "(", "results_path", ",", "allow_pickle", "=", "True", ")", "[", "'results'", "]", "[", "(", ")", "]", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.no_predictions": [[148, 152], ["evaluation.RH_Evaluation.pr[].append", "evaluation.RH_Evaluation.pr[].append", "evaluation.RH_Evaluation.pr[].append"], "methods", ["None"], ["", "def", "no_predictions", "(", "self", ",", "miss_num", ")", ":", "\n", "        ", "self", ".", "pr", "[", "'all'", "]", ".", "append", "(", "0", ")", "\n", "self", ".", "pr", "[", "'falsePositive'", "]", ".", "append", "(", "0", ")", "\n", "self", ".", "pr", "[", "'miss'", "]", ".", "append", "(", "miss_num", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.load_gt": [[153, 158], ["print", "os.join", "os.join", "print", "numpy.load", "len"], "methods", ["None"], ["", "def", "load_gt", "(", "self", ",", "RH_dir", ")", ":", "\n", "        ", "print", "(", "'loading gts ...'", ")", "\n", "annot_dir", "=", "osp", ".", "join", "(", "RH_dir", ",", "'{}_annots.npz'", ".", "format", "(", "self", ".", "set_name", ")", ")", "\n", "self", ".", "annots", "=", "np", ".", "load", "(", "annot_dir", ",", "allow_pickle", "=", "True", ")", "[", "'annots'", "]", "[", "(", ")", "]", "\n", "print", "(", "f'We got GTs of {len(self.annots)} images for evaluation.'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.miss_mat": [[159, 161], ["numpy.stack().astype", "numpy.stack", "numpy.ones", "len"], "methods", ["None"], ["", "def", "miss_mat", "(", "self", ",", "miss_gt_ids", ")", ":", "\n", "        ", "return", "np", ".", "stack", "(", "[", "np", ".", "ones", "(", "len", "(", "miss_gt_ids", ")", ")", "*", "-", "1", ",", "miss_gt_ids", "]", ",", "1", ")", ".", "astype", "(", "np", ".", "int", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.match_kp2ds": [[162, 225], ["evaluation.RH_Evaluation.annots.keys", "evaluation.compute_prf1", "print", "enumerate", "numpy.array", "isinstance", "print", "print", "matching.match_2d_greedy", "evaluation.RH_Evaluation.pr[].append", "evaluation.RH_Evaluation.pr[].append", "evaluation.RH_Evaluation.pr[].append", "sum", "sum", "sum", "numpy.array", "evaluation.RH_Evaluation.no_predictions", "numpy.array", "numpy.array", "isinstance", "valid_kps.sum", "len", "len", "len", "numpy.array", "len", "numpy.array", "len", "len", "len", "len", "numpy.array().reshape", "numpy.array.append", "gt_inds.append", "len", "numpy.array", "len", "len", "os.path.basename().replace", "os.path.basename().replace", "os.path.basename().replace", "os.path.basename().replace", "os.path.basename", "os.path.basename", "os.path.basename", "os.path.basename"], "methods", ["home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.compute_prf1", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.eval_SMAP_RH_results.match_2d_greedy", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.no_predictions"], ["", "def", "match_kp2ds", "(", "self", ")", ":", "\n", "        ", "self", ".", "match_results", "=", "{", "}", "\n", "self", ".", "missed_ids", "=", "{", "}", "\n", "self", ".", "pr", "=", "{", "'all'", ":", "[", "]", ",", "'falsePositive'", ":", "[", "]", ",", "'miss'", ":", "[", "]", ",", "}", "\n", "self", ".", "kp2ds", "=", "{", "'gts'", ":", "{", "}", ",", "'preds'", ":", "{", "}", "}", "\n", "for", "img_name", "in", "self", ".", "annots", ".", "keys", "(", ")", ":", "\n", "            ", "annots", "=", "self", ".", "annots", "[", "img_name", "]", "\n", "gt_kp2ds", "=", "[", "]", "\n", "gt_inds", "=", "[", "]", "\n", "for", "idx", ",", "annot", "in", "enumerate", "(", "annots", ")", ":", "\n", "                ", "vbox", "=", "np", ".", "array", "(", "annot", "[", "'bbox'", "]", ")", "\n", "if", "'kp2d'", "in", "annot", ":", "\n", "                    ", "if", "annot", "[", "'kp2d'", "]", "is", "not", "None", ":", "\n", "                        ", "joint", "=", "np", ".", "array", "(", "annot", "[", "'kp2d'", "]", ")", ".", "reshape", "(", "(", "-", "1", ",", "3", ")", ")", "\n", "invalid_kp_mask", "=", "joint", "[", ":", ",", "2", "]", "==", "0", "\n", "joint", "[", "invalid_kp_mask", "]", "=", "-", "2.", "\n", "joint", "[", ":", ",", "2", "]", "=", "joint", "[", ":", ",", "2", "]", ">", "0", "\n", "if", "len", "(", "joint", ")", "==", "19", ":", "\n", "                            ", "is_BK", "=", "len", "(", "os", ".", "path", ".", "basename", "(", "img_name", ")", ".", "replace", "(", "'.jpg'", ",", "''", ")", ")", "==", "7", "\n", "if", "is_BK", ":", "\n", "                                ", "joints", "=", "joint", "[", "self", ".", "kp2d_mapper_BK", "]", "\n", "joints", "[", "self", ".", "kp2d_mapper_BK", "==", "-", "1", "]", "=", "-", "2", "\n", "", "else", ":", "\n", "                                ", "joints", "=", "joint", "[", "self", ".", "kp2d_mapper_OCH", "]", "\n", "joints", "[", "self", ".", "kp2d_mapper_BK", "==", "-", "1", "]", "=", "-", "2", "\n", "", "", "elif", "len", "(", "joint", ")", "==", "14", ":", "\n", "                            ", "joints", "=", "joint", "\n", "", "gt_kp2ds", ".", "append", "(", "joints", ")", "\n", "gt_inds", ".", "append", "(", "idx", ")", "\n", "", "", "", "gt_kp2ds", "=", "np", ".", "array", "(", "gt_kp2ds", ")", "\n", "\n", "if", "img_name", "not", "in", "self", ".", "results", ":", "\n", "                ", "self", ".", "no_predictions", "(", "len", "(", "gt_inds", ")", ")", "\n", "self", ".", "missed_ids", "[", "img_name", "]", "=", "np", ".", "array", "(", "gt_inds", ")", "\n", "continue", "\n", "", "results", "=", "self", ".", "results", "[", "img_name", "]", "\n", "if", "isinstance", "(", "results", ",", "list", ")", ":", "\n", "                ", "pred_kp2ds", "=", "np", ".", "array", "(", "[", "r", "[", "'kp2ds'", "]", "for", "r", "in", "results", "]", ")", "\n", "", "elif", "isinstance", "(", "results", ",", "dict", ")", ":", "\n", "                ", "pred_kp2ds", "=", "results", "[", "'kp2ds'", "]", "\n", "\n", "", "valid_kps", "=", "gt_kp2ds", "[", ":", ",", ":", ",", "2", "]", ">", "0", "\n", "valid_person", "=", "valid_kps", ".", "sum", "(", "-", "1", ")", ">", "0", "\n", "valid_kps", "=", "valid_kps", "[", "valid_person", "]", "\n", "gt_kp2ds", "=", "gt_kp2ds", "[", "valid_person", "]", "\n", "assert", "len", "(", "pred_kp2ds", ")", ">", "0", ",", "print", "(", "'no prediction'", ")", "\n", "assert", "len", "(", "gt_kp2ds", ")", ">", "0", ",", "print", "(", "'no GT'", ")", "\n", "bestMatch", ",", "falsePositives", ",", "misses", "=", "match_2d_greedy", "(", "pred_kp2ds", ",", "gt_kp2ds", "[", ":", ",", ":", ",", ":", "2", "]", ",", "valid_kps", ",", "imgPath", "=", "img_name", ")", "\n", "if", "len", "(", "bestMatch", ")", ">", "0", ":", "\n", "                ", "pred_ids", ",", "gt_ids", "=", "bestMatch", "[", ":", ",", "0", "]", ",", "bestMatch", "[", ":", ",", "1", "]", "\n", "self", ".", "kp2ds", "[", "'gts'", "]", "[", "img_name", "]", "=", "gt_kp2ds", "[", "gt_ids", ",", ":", ",", ":", "2", "]", "\n", "self", ".", "kp2ds", "[", "'preds'", "]", "[", "img_name", "]", "=", "pred_kp2ds", "[", "pred_ids", "]", "\n", "bestMatch", "[", ":", ",", "1", "]", "=", "np", ".", "array", "(", "[", "gt_inds", "[", "ind", "]", "for", "ind", "in", "gt_ids", "]", ")", "\n", "", "if", "len", "(", "misses", ")", ">", "0", ":", "\n", "                ", "self", ".", "missed_ids", "[", "img_name", "]", "=", "np", ".", "array", "(", "[", "gt_inds", "[", "ind", "]", "for", "ind", "in", "misses", "]", ")", "\n", "", "self", ".", "match_results", "[", "img_name", "]", "=", "bestMatch", "\n", "self", ".", "pr", "[", "'all'", "]", ".", "append", "(", "len", "(", "pred_kp2ds", ")", ")", "\n", "self", ".", "pr", "[", "'falsePositive'", "]", ".", "append", "(", "len", "(", "falsePositives", ")", ")", "\n", "self", ".", "pr", "[", "'miss'", "]", ".", "append", "(", "len", "(", "misses", ")", ")", "\n", "\n", "", "all_precision", ",", "all_recall", ",", "all_f1_score", "=", "compute_prf1", "(", "sum", "(", "self", ".", "pr", "[", "'all'", "]", ")", ",", "sum", "(", "self", ".", "pr", "[", "'miss'", "]", ")", ",", "sum", "(", "self", ".", "pr", "[", "'falsePositive'", "]", ")", ")", "\n", "\n", "print", "(", "'Precision: {} | Recall: {} | F1 score: {}'", ".", "format", "(", "all_precision", ",", "all_recall", ",", "all_f1_score", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.RH_Evaluation.calc_error": [[226, 267], ["evaluation.RH_Evaluation.match_results.items", "evaluation.RH_Evaluation.missed_ids.items", "torch.from_numpy", "torch.cat().mean", "print_results.append", "evaluation.get_results", "get_results.items", "evaluation.write2txt", "torch.from_numpy", "torch.from_numpy", "isinstance", "torch.zeros", "evaluation._calc_matched_PCKh_", "evaluation.RH_Evaluation.mPCKh.append", "torch.ones().bool", "evaluation._calc_relative_depth_error_weak_", "torch.from_numpy.append", "numpy.concatenate", "print_results.append", "print", "len", "numpy.array", "numpy.array", "torch.from_numpy", "isinstance", "len", "torch.from_numpy().float", "torch.from_numpy().float", "torch.ones().bool", "numpy.array", "torch.cat", "numpy.array", "torch.from_numpy", "torch.ones", "torch.ones().bool.cpu", "torch.from_numpy", "torch.from_numpy", "torch.ones", "len", "float", "len", "item.item"], "methods", ["home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.get_results", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.write2txt", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation._calc_matched_PCKh_", "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation._calc_relative_depth_error_weak_"], ["", "def", "calc_error", "(", "self", ")", ":", "\n", "        ", "self", ".", "mPCKh", "=", "[", "]", "\n", "depth_relative", "=", "{", "'eq'", ":", "[", "]", ",", "'cd'", ":", "[", "]", ",", "'fd'", ":", "[", "]", ",", "'eq_age'", ":", "[", "]", ",", "'cd_age'", ":", "[", "]", ",", "'fd_age'", ":", "[", "]", "}", "\n", "for", "img_name", ",", "match_mat", "in", "self", ".", "match_results", ".", "items", "(", ")", ":", "\n", "            ", "if", "len", "(", "match_mat", ")", "==", "0", ":", "\n", "                ", "continue", "\n", "", "pred_ids", ",", "gt_ids", "=", "match_mat", "[", ":", ",", "0", "]", ",", "match_mat", "[", ":", ",", "1", "]", "\n", "annots", "=", "self", ".", "annots", "[", "img_name", "]", "\n", "depth_ids", "=", "torch", ".", "from_numpy", "(", "np", ".", "array", "(", "[", "annots", "[", "ind", "]", "[", "'depth_id'", "]", "for", "ind", "in", "gt_ids", "]", ")", ")", "\n", "age_ids", "=", "torch", ".", "from_numpy", "(", "np", ".", "array", "(", "[", "annots", "[", "ind", "]", "[", "'age'", "]", "for", "ind", "in", "gt_ids", "]", ")", ")", "\n", "\n", "results", "=", "self", ".", "results", "[", "img_name", "]", "\n", "if", "isinstance", "(", "results", ",", "list", ")", ":", "\n", "                ", "pred_depth", "=", "torch", ".", "from_numpy", "(", "np", ".", "array", "(", "[", "results", "[", "ind", "]", "[", "'trans'", "]", "[", "2", "]", "for", "ind", "in", "pred_ids", "]", ")", ")", "\n", "", "elif", "isinstance", "(", "results", ",", "dict", ")", ":", "\n", "                ", "pred_depth", "=", "torch", ".", "from_numpy", "(", "results", "[", "'trans'", "]", "[", "pred_ids", ",", "2", "]", ")", "\n", "", "default_organize_idx", "=", "torch", ".", "zeros", "(", "len", "(", "depth_ids", ")", ")", "\n", "\n", "mPCKh", "=", "_calc_matched_PCKh_", "(", "torch", ".", "from_numpy", "(", "self", ".", "kp2ds", "[", "'gts'", "]", "[", "img_name", "]", ")", ".", "float", "(", ")", ",", "torch", ".", "from_numpy", "(", "self", ".", "kp2ds", "[", "'preds'", "]", "[", "img_name", "]", ")", ".", "float", "(", ")", ",", "torch", ".", "ones", "(", "len", "(", "self", ".", "kp2ds", "[", "'gts'", "]", "[", "img_name", "]", ")", ")", ".", "bool", "(", ")", ")", "\n", "self", ".", "mPCKh", ".", "append", "(", "mPCKh", ")", "\n", "matched_mask", "=", "torch", ".", "ones", "(", "len", "(", "depth_ids", ")", ")", ".", "bool", "(", ")", "\n", "relative_depth_errors", "=", "_calc_relative_depth_error_weak_", "(", "pred_depth", ",", "depth_ids", ",", "default_organize_idx", ",", "age_ids", ",", "matched_mask", "=", "matched_mask", ".", "cpu", "(", ")", ")", "\n", "for", "dr_type", "in", "relative_depth_types", ":", "\n", "                ", "depth_relative", "[", "dr_type", "]", "+=", "relative_depth_errors", "[", "dr_type", "]", "\n", "depth_relative", "[", "dr_type", "+", "'_age'", "]", "+=", "relative_depth_errors", "[", "dr_type", "+", "'_age'", "]", "\n", "\n", "", "", "missed_age_ids", "=", "[", "]", "\n", "for", "img_name", ",", "missed_id", "in", "self", ".", "missed_ids", ".", "items", "(", ")", ":", "\n", "            ", "annots", "=", "self", ".", "annots", "[", "img_name", "]", "\n", "missed_age_ids", ".", "append", "(", "np", ".", "array", "(", "[", "annots", "[", "ind", "]", "[", "'age'", "]", "for", "ind", "in", "missed_id", "]", ")", ")", "\n", "", "missed_age_ids", "=", "torch", ".", "from_numpy", "(", "np", ".", "concatenate", "(", "missed_age_ids", ",", "0", ")", ")", "\n", "\n", "print_results", "=", "[", "]", "\n", "all_mPCKh", "=", "torch", ".", "cat", "(", "self", ".", "mPCKh", ")", ".", "mean", "(", ")", "\n", "print_results", ".", "append", "(", "'mPCKh_0.6: {:.2f}'", ".", "format", "(", "all_mPCKh", "*", "100", ")", ")", "\n", "eval_results", "=", "get_results", "(", "depth_relative", ",", "missed_age_ids", ")", "\n", "for", "key", ",", "item", "in", "eval_results", ".", "items", "(", ")", ":", "\n", "            ", "print_results", ".", "append", "(", "'{}: {:.2f}'", ".", "format", "(", "key", ",", "float", "(", "item", ".", "item", "(", ")", ")", "*", "100", ")", ")", "\n", "", "for", "numbers", "in", "print_results", ":", "\n", "            ", "print", "(", "numbers", ")", "\n", "", "write2txt", "(", "self", ".", "results_txt_save_path", ",", "print_results", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.joint_mapping": [[30, 36], ["numpy.array", "numpy.ones", "len"], "function", ["None"], ["def", "joint_mapping", "(", "source_format", ",", "target_format", ")", ":", "\n", "    ", "mapping", "=", "np", ".", "ones", "(", "len", "(", "target_format", ")", ",", "dtype", "=", "np", ".", "int", ")", "*", "-", "1", "\n", "for", "joint_name", "in", "target_format", ":", "\n", "        ", "if", "joint_name", "in", "source_format", ":", "\n", "            ", "mapping", "[", "target_format", "[", "joint_name", "]", "]", "=", "source_format", "[", "joint_name", "]", "\n", "", "", "return", "np", ".", "array", "(", "mapping", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation._calc_relative_depth_error_weak_": [[37, 70], ["depth_ids.to.to", "torch.unique", "sample_inds.sum", "torch.triu().bool", "error_dict[].append", "error_dict[].append", "error_dict[].append", "error_dict[].append", "error_dict[].append", "error_dict[].append", "torch.triu", "pred_depths_sample.unsqueeze().repeat", "pred_depths_sample.unsqueeze().repeat", "depth_ids[].unsqueeze().repeat", "depth_ids[].unsqueeze().repeat", "torch.cat", "torch.ones", "pred_depths_sample.unsqueeze", "pred_depths_sample.unsqueeze", "depth_ids[].unsqueeze", "depth_ids[].unsqueeze", "age_sample.unsqueeze().repeat().unsqueeze", "age_sample.unsqueeze().repeat().unsqueeze", "age_sample.unsqueeze().repeat", "age_sample.unsqueeze().repeat", "age_sample.unsqueeze", "age_sample.unsqueeze"], "function", ["None"], ["", "def", "_calc_relative_depth_error_weak_", "(", "pred_depths", ",", "depth_ids", ",", "reorganize_idx", ",", "age_gts", "=", "None", ",", "matched_mask", "=", "None", ")", ":", "\n", "    ", "depth_ids", "=", "depth_ids", ".", "to", "(", "pred_depths", ".", "device", ")", "\n", "depth_ids_vmask", "=", "depth_ids", "!=", "-", "1", "\n", "pred_depths_valid", "=", "pred_depths", "[", "depth_ids_vmask", "]", "\n", "valid_inds", "=", "reorganize_idx", "[", "depth_ids_vmask", "]", "\n", "depth_ids", "=", "depth_ids", "[", "depth_ids_vmask", "]", "\n", "age_gts", "=", "age_gts", "[", "depth_ids_vmask", "]", "\n", "error_dict", "=", "{", "'eq'", ":", "[", "]", ",", "'cd'", ":", "[", "]", ",", "'fd'", ":", "[", "]", ",", "'eq_age'", ":", "[", "]", ",", "'cd_age'", ":", "[", "]", ",", "'fd_age'", ":", "[", "]", "}", "\n", "error_each_age", "=", "{", "age_type", ":", "[", "]", "for", "age_type", "in", "relative_age_types", "}", "\n", "for", "b_ind", "in", "torch", ".", "unique", "(", "valid_inds", ")", ":", "\n", "        ", "sample_inds", "=", "valid_inds", "==", "b_ind", "\n", "if", "matched_mask", "is", "not", "None", ":", "\n", "            ", "sample_inds", "*=", "matched_mask", "[", "depth_ids_vmask", "]", "\n", "", "did_num", "=", "sample_inds", ".", "sum", "(", ")", "\n", "if", "did_num", ">", "1", ":", "\n", "            ", "pred_depths_sample", "=", "pred_depths_valid", "[", "sample_inds", "]", "\n", "triu_mask", "=", "torch", ".", "triu", "(", "torch", ".", "ones", "(", "did_num", ",", "did_num", ")", ",", "diagonal", "=", "1", ")", ".", "bool", "(", ")", "\n", "dist_mat", "=", "(", "pred_depths_sample", ".", "unsqueeze", "(", "0", ")", ".", "repeat", "(", "did_num", ",", "1", ")", "-", "pred_depths_sample", ".", "unsqueeze", "(", "1", ")", ".", "repeat", "(", "1", ",", "did_num", ")", ")", "[", "triu_mask", "]", "\n", "did_mat", "=", "(", "depth_ids", "[", "sample_inds", "]", ".", "unsqueeze", "(", "0", ")", ".", "repeat", "(", "did_num", ",", "1", ")", "-", "depth_ids", "[", "sample_inds", "]", ".", "unsqueeze", "(", "1", ")", ".", "repeat", "(", "1", ",", "did_num", ")", ")", "[", "triu_mask", "]", "\n", "\n", "error_dict", "[", "'eq'", "]", ".", "append", "(", "dist_mat", "[", "did_mat", "==", "0", "]", ")", "\n", "error_dict", "[", "'cd'", "]", ".", "append", "(", "dist_mat", "[", "did_mat", "<", "0", "]", ")", "\n", "error_dict", "[", "'fd'", "]", ".", "append", "(", "dist_mat", "[", "did_mat", ">", "0", "]", ")", "\n", "if", "age_gts", "is", "not", "None", ":", "\n", "                ", "age_sample", "=", "age_gts", "[", "sample_inds", "]", "\n", "age_mat", "=", "torch", ".", "cat", "(", "[", "age_sample", ".", "unsqueeze", "(", "0", ")", ".", "repeat", "(", "did_num", ",", "1", ")", ".", "unsqueeze", "(", "-", "1", ")", ",", "age_sample", ".", "unsqueeze", "(", "1", ")", ".", "repeat", "(", "1", ",", "did_num", ")", ".", "unsqueeze", "(", "-", "1", ")", "]", ",", "-", "1", ")", "[", "triu_mask", "]", "\n", "error_dict", "[", "'eq_age'", "]", ".", "append", "(", "age_mat", "[", "did_mat", "==", "0", "]", ")", "\n", "error_dict", "[", "'cd_age'", "]", ".", "append", "(", "age_mat", "[", "did_mat", "<", "0", "]", ")", "\n", "error_dict", "[", "'fd_age'", "]", ".", "append", "(", "age_mat", "[", "did_mat", ">", "0", "]", ")", "\n", "# error_dict['all'].append([len(eq_dists), len(cd_dists), len(fd_dists)]) ", "\n", "# error_dict['correct'].append([(torch.abs(eq_dists)<thresh).sum().item(), (cd_dists<-thresh).sum().item(), (fd_dists>thresh).sum().item()])", "\n", "\n", "", "", "", "return", "error_dict", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation._calc_matched_PCKh_": [[71, 89], ["torch.ones().float().cuda", "kp2d_mask.sum", "torch.norm", "enumerate", "zip", "torch.sqrt", "torch.ones().float", "v.sum", "correct_kp_mask.sum", "len", "torch.ones", "len", "real_valid[].max", "real_valid[].min", "real_valid[].max", "real_valid[].min"], "function", ["None"], ["", "def", "_calc_matched_PCKh_", "(", "real", ",", "pred", ",", "kp2d_mask", ",", "error_thresh", "=", "0.143", ")", ":", "\n", "# error_thresh is set as the ratio between the head and the body.", "\n", "# he head / body for normal people are between 6~8, therefore, we set it to 1/7=0.143", "\n", "    ", "PCKs", "=", "torch", ".", "ones", "(", "len", "(", "kp2d_mask", ")", ")", ".", "float", "(", ")", ".", "cuda", "(", ")", "*", "-", "1.", "\n", "if", "kp2d_mask", ".", "sum", "(", ")", ">", "0", ":", "\n", "        ", "vis", "=", "(", "real", ">", "-", "1.", ")", ".", "sum", "(", "-", "1", ")", "==", "real", ".", "shape", "[", "-", "1", "]", "\n", "error", "=", "torch", ".", "norm", "(", "real", "-", "pred", ",", "p", "=", "2", ",", "dim", "=", "-", "1", ")", "\n", "\n", "for", "ind", ",", "(", "e", ",", "v", ")", "in", "enumerate", "(", "zip", "(", "error", ",", "vis", ")", ")", ":", "\n", "            ", "if", "v", ".", "sum", "(", ")", "<", "2", ":", "\n", "                ", "continue", "\n", "", "real_valid", "=", "real", "[", "ind", ",", "v", "]", "\n", "person_scales", "=", "torch", ".", "sqrt", "(", "(", "real_valid", "[", ":", ",", "0", "]", ".", "max", "(", "-", "1", ")", ".", "values", "-", "real_valid", "[", ":", ",", "0", "]", ".", "min", "(", "-", "1", ")", ".", "values", ")", "**", "2", "+", "(", "real_valid", "[", ":", ",", "1", "]", ".", "max", "(", "-", "1", ")", ".", "values", "-", "real_valid", "[", ":", ",", "1", "]", ".", "min", "(", "-", "1", ")", ".", "values", ")", "**", "2", ")", "\n", "error_valid", "=", "e", "[", "v", "]", "\n", "correct_kp_mask", "=", "(", "(", "error_valid", "/", "person_scales", ")", "<", "error_thresh", ")", ".", "float", "(", ")", "\n", "PCKs", "[", "ind", "]", "=", "correct_kp_mask", ".", "sum", "(", ")", "/", "len", "(", "correct_kp_mask", ")", "\n", "", "", "return", "PCKs", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.compute_prf1": [[90, 100], ["round", "round", "round"], "function", ["None"], ["", "def", "compute_prf1", "(", "count", ",", "miss", ",", "fp", ")", ":", "\n", "    ", "if", "count", "==", "0", ":", "\n", "        ", "return", "0", ",", "0", ",", "0", "\n", "", "all_tp", "=", "count", "-", "miss", "\n", "all_fp", "=", "fp", "\n", "all_fn", "=", "miss", "\n", "all_f1_score", "=", "round", "(", "all_tp", "/", "(", "all_tp", "+", "0.5", "*", "(", "all_fp", "+", "all_fn", ")", ")", ",", "2", ")", "\n", "all_recall", "=", "round", "(", "all_tp", "/", "(", "all_tp", "+", "all_fn", ")", ",", "2", ")", "\n", "all_precision", "=", "round", "(", "all_tp", "/", "(", "all_tp", "+", "all_fp", ")", ",", "2", ")", "\n", "return", "all_precision", ",", "all_recall", ",", "all_f1_score", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.get_results": [[101, 124], ["torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "torch.cat", "numpy.array", "print", "torch.cat", "enumerate", "torch.cat.sum", "np.array.sum", "len", "len", "len", "torch.abs", "age_mask.sum", "len", "dr_corrects[].sum", "dr_corrects[].sum().item", "dr_corrects[].sum().item", "dr_corrects[].sum().item", "age_mask.sum", "dr_corrects[].sum", "dr_corrects[].sum", "dr_corrects[].sum"], "function", ["None"], ["", "def", "get_results", "(", "depth_relative", ",", "missed_age_ids", ",", "dr_thresh", "=", "0.2", ",", "miss_fine", "=", "0.3", ")", ":", "\n", "    ", "eval_results", "=", "{", "}", "\n", "eq_dists", "=", "torch", ".", "cat", "(", "depth_relative", "[", "'eq'", "]", ",", "0", ")", "\n", "cd_dists", "=", "torch", ".", "cat", "(", "depth_relative", "[", "'cd'", "]", ",", "0", ")", "\n", "fd_dists", "=", "torch", ".", "cat", "(", "depth_relative", "[", "'fd'", "]", ",", "0", ")", "\n", "eq_age_ids", "=", "torch", ".", "cat", "(", "depth_relative", "[", "'eq_age'", "]", ",", "0", ")", "\n", "cd_age_ids", "=", "torch", ".", "cat", "(", "depth_relative", "[", "'cd_age'", "]", ",", "0", ")", "\n", "fd_age_ids", "=", "torch", ".", "cat", "(", "depth_relative", "[", "'fd_age'", "]", ",", "0", ")", "\n", "dr_age_ids", "=", "torch", ".", "cat", "(", "[", "eq_age_ids", ",", "cd_age_ids", ",", "fd_age_ids", "]", ",", "0", ")", "\n", "dr_all", "=", "np", ".", "array", "(", "[", "len", "(", "eq_dists", ")", ",", "len", "(", "cd_dists", ")", ",", "len", "(", "fd_dists", ")", ",", "len", "(", "missed_age_ids", ")", "*", "miss_fine", "]", ")", "\n", "\n", "dr_corrects", "=", "[", "torch", ".", "abs", "(", "eq_dists", ")", "<", "dr_thresh", ",", "cd_dists", "<", "-", "dr_thresh", ",", "fd_dists", ">", "dr_thresh", "]", "\n", "print", "(", "'Thresh: {} | Equal {:.2f} close {:.2f} far {:.2f}'", ".", "format", "(", "dr_thresh", ",", "dr_corrects", "[", "0", "]", ".", "sum", "(", ")", ".", "item", "(", ")", "/", "dr_all", "[", "0", "]", "*", "100", ",", "dr_corrects", "[", "1", "]", ".", "sum", "(", ")", ".", "item", "(", ")", "/", "dr_all", "[", "1", "]", "*", "100", ",", "dr_corrects", "[", "2", "]", ".", "sum", "(", ")", ".", "item", "(", ")", "/", "dr_all", "[", "2", "]", "*", "100", ")", ")", "\n", "dr_corrects", "=", "torch", ".", "cat", "(", "dr_corrects", ",", "0", ")", "\n", "\n", "eval_results", "[", "'PCRD_{}'", ".", "format", "(", "dr_thresh", ")", "]", "=", "dr_corrects", ".", "sum", "(", ")", "/", "dr_all", ".", "sum", "(", ")", "\n", "for", "age_ind", ",", "age_name", "in", "enumerate", "(", "relative_age_types", ")", ":", "\n", "        ", "age_mask", "=", "(", "dr_age_ids", "==", "age_ind", ")", ".", "sum", "(", "-", "1", ")", ".", "bool", "(", ")", "\n", "if", "age_mask", ".", "sum", "(", ")", ">", "0", ":", "\n", "            ", "missed_num", "=", "(", "missed_age_ids", "==", "age_ind", ")", ".", "sum", "(", ")", "*", "miss_fine", "\n", "eval_results", "[", "'PCRD_{}_{}'", ".", "format", "(", "dr_thresh", ",", "age_name", ")", "]", "=", "dr_corrects", "[", "age_mask", "]", ".", "sum", "(", ")", "/", "(", "age_mask", ".", "sum", "(", ")", "+", "missed_num", ")", "\n", "", "", "return", "eval_results", "\n", "\n"]], "home.repos.pwc.inspect_result.Arthur151_Relative_Human.RH_evaluation.evaluation.write2txt": [[125, 129], ["open", "f.write"], "function", ["None"], ["", "def", "write2txt", "(", "path", ",", "contents", ")", ":", "\n", "    ", "with", "open", "(", "path", ",", "'w'", ")", "as", "f", ":", "\n", "        ", "for", "line", "in", "contents", ":", "\n", "            ", "f", ".", "write", "(", "line", "+", "\"\\n\"", ")", "\n", "\n"]]}