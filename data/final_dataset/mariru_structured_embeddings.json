{"home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.emb_model.__init__": [[13, 67], ["print", "os.path.join", "pickle.load", "open", "text_file.write", "text_file.write", "fname.replace.replace.replace", "fname.replace.replace.replace", "open", "os.path.join", "str", "numpy.random.randn", "numpy.random.randn", "numpy.random.randn", "numpy.random.randn"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "args", ",", "d", ",", "logdir", ")", ":", "\n", "        ", "self", ".", "args", "=", "args", "\n", "\n", "self", ".", "K", "=", "args", ".", "K", "\n", "self", ".", "H0", "=", "args", ".", "H0", "\n", "self", ".", "cs", "=", "args", ".", "cs", "\n", "self", ".", "ns", "=", "args", ".", "ns", "\n", "self", ".", "n_minibatch", "=", "d", ".", "n_train", "\n", "self", ".", "n_test", "=", "d", ".", "n_test", "\n", "self", ".", "sig", "=", "args", ".", "sig", "\n", "self", ".", "unigram", "=", "d", ".", "unigram", "\n", "self", ".", "N", "=", "d", ".", "N", "\n", "self", ".", "L", "=", "d", ".", "L", "\n", "self", ".", "logdir", "=", "logdir", "\n", "self", ".", "train_feed", "=", "d", ".", "train_feed", "\n", "self", ".", "eval_states", "=", "d", ".", "eval_states", "\n", "self", ".", "valid_data", "=", "d", ".", "valid_data", "\n", "self", ".", "test_data", "=", "d", ".", "test_data", "\n", "self", ".", "n_iter", "=", "args", ".", "n_iter", "\n", "self", ".", "n_epochs", "=", "d", ".", "n_epochs", "\n", "self", ".", "n_test", "=", "d", ".", "n_test", "\n", "self", ".", "n_valid", "=", "d", ".", "n_valid", "\n", "if", "d", ".", "name", "==", "'arxiv'", ":", "\n", "            ", "print", "(", "'ONLY USING 10th OF TEST DATA'", ")", "\n", "self", ".", "n_test", "=", "d", ".", "n_test", "/", "10", "\n", "self", ".", "n_valid", "=", "d", ".", "n_valid", "/", "10", "\n", "", "self", ".", "states", "=", "d", ".", "states", "\n", "self", ".", "n_states", "=", "d", ".", "T", "\n", "self", ".", "amortized", "=", "args", ".", "amortized", "\n", "self", ".", "resnet", "=", "args", ".", "resnet", "\n", "self", ".", "alpha_trainable", "=", "True", "\n", "self", ".", "rho_trainable", "=", "True", "\n", "if", "args", ".", "init", ":", "\n", "            ", "fname", "=", "os", ".", "path", ".", "join", "(", "'fits'", ",", "d", ".", "name", ",", "args", ".", "init", ")", "\n", "if", "'rho_constant'", "in", "args", ".", "init", ":", "\n", "                ", "self", ".", "rho_trainable", "=", "False", "\n", "fname", "=", "fname", ".", "replace", "(", "'/rho_constant'", ",", "''", ")", "\n", "", "if", "'alpha_constant'", "in", "args", ".", "init", ":", "\n", "                ", "self", ".", "alpha_trainable", "=", "False", "\n", "fname", "=", "fname", ".", "replace", "(", "'/alpha_constant'", ",", "''", ")", "\n", "", "fit", "=", "pickle", ".", "load", "(", "open", "(", "fname", ")", ")", "\n", "self", ".", "rho_init", "=", "fit", "[", "'rho'", "]", "\n", "self", ".", "alpha_init", "=", "fit", "[", "'alpha'", "]", "\n", "", "else", ":", "\n", "            ", "self", ".", "rho_init", "=", "(", "0.1", "*", "np", ".", "random", ".", "randn", "(", "self", ".", "L", ",", "self", ".", "K", ")", "/", "self", ".", "K", ")", ".", "astype", "(", "'float32'", ")", "\n", "self", ".", "alpha_init", "=", "(", "0.1", "*", "np", ".", "random", ".", "randn", "(", "self", ".", "L", ",", "self", ".", "K", ")", "/", "self", ".", "K", ")", ".", "astype", "(", "'float32'", ")", "\n", "", "if", "not", "self", ".", "rho_trainable", ":", "\n", "            ", "self", ".", "alpha_init", "=", "(", "0.1", "*", "np", ".", "random", ".", "randn", "(", "self", ".", "L", ",", "self", ".", "K", ")", "/", "self", ".", "K", ")", ".", "astype", "(", "'float32'", ")", "\n", "", "if", "not", "self", ".", "alpha_trainable", ":", "\n", "            ", "self", ".", "rho_init", "=", "(", "0.1", "*", "np", ".", "random", ".", "randn", "(", "self", ".", "L", ",", "self", ".", "K", ")", "/", "self", ".", "K", ")", ".", "astype", "(", "'float32'", ")", "\n", "\n", "", "with", "open", "(", "os", ".", "path", ".", "join", "(", "self", ".", "logdir", ",", "\"log_file.txt\"", ")", ",", "\"a\"", ")", "as", "text_file", ":", "\n", "            ", "text_file", ".", "write", "(", "str", "(", "self", ".", "args", ")", ")", "\n", "text_file", ".", "write", "(", "'\\n'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.emb_model.init_eval_model": [[68, 117], ["tensorflow.name_scope", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.placeholder", "tensorflow.contrib.distributions.Bernoulli", "tensorflow.contrib.distributions.Bernoulli", "tensorflow.contrib.distributions.Bernoulli.log_prob", "tensorflow.reduce_mean", "tensorflow.nn.moments", "tensorflow.name_scope", "tensorflow.placeholder", "tensorflow.name_scope", "tensorflow.cast", "tensorflow.cast", "tensorflow.cast", "tensorflow.concat", "tensorflow.name_scope", "tensorflow.reduce_sum", "tensorflow.expand_dims", "tensorflow.reduce_sum", "tensorflow.contrib.distributions.Bernoulli.log_prob", "tensorflow.range", "tensorflow.tile", "tensorflow.tile", "tensorflow.name_scope", "tensorflow.gather", "tensorflow.squeeze", "tensorflow.name_scope", "tensorflow.placeholder", "tensorflow.gather", "tensorflow.name_scope", "tensorflow.squeeze", "tensorflow.gather", "tensorflow.reduce_sum", "tensorflow.multiply", "tensorflow.expand_dims", "tensorflow.expand_dims", "tensorflow.gather", "tensorflow.gather", "tensorflow.multiply", "tensorflow.tile", "tensorflow.range", "tensorflow.range", "tensorflow.expand_dims"], "methods", ["None"], ["", "", "def", "init_eval_model", "(", "self", ")", ":", "\n", "        ", "with", "tf", ".", "name_scope", "(", "'eval_model'", ")", ":", "\n", "            ", "self", ".", "eval_alpha_state", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ")", "\n", "self", ".", "eval_rho_state", "=", "tf", ".", "placeholder", "(", "tf", ".", "float32", ")", "\n", "self", ".", "eval_n_test", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ")", "\n", "eval_n_minibatch", "=", "self", ".", "eval_n_test", "-", "self", ".", "cs", "\n", "\n", "# Data Placeholder", "\n", "with", "tf", ".", "name_scope", "(", "'input'", ")", ":", "\n", "                ", "self", ".", "eval_ph", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ")", "\n", "words", "=", "self", ".", "eval_ph", "\n", "\n", "\n", "# Index Masks", "\n", "", "with", "tf", ".", "name_scope", "(", "'context_mask'", ")", ":", "\n", "                ", "p_mask", "=", "tf", ".", "cast", "(", "tf", ".", "range", "(", "self", ".", "cs", "/", "2", ",", "eval_n_minibatch", "+", "self", ".", "cs", "/", "2", ")", ",", "tf", ".", "int32", ")", "\n", "rows", "=", "tf", ".", "cast", "(", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "tf", ".", "range", "(", "0", ",", "self", ".", "cs", "/", "2", ")", ",", "[", "0", "]", ")", ",", "[", "eval_n_minibatch", ",", "1", "]", ")", ",", "tf", ".", "int32", ")", "\n", "columns", "=", "tf", ".", "cast", "(", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "tf", ".", "range", "(", "0", ",", "eval_n_minibatch", ")", ",", "[", "1", "]", ")", ",", "[", "1", ",", "self", ".", "cs", "/", "2", "]", ")", ",", "tf", ".", "int32", ")", "\n", "ctx_mask", "=", "tf", ".", "concat", "(", "[", "rows", "+", "columns", ",", "rows", "+", "columns", "+", "self", ".", "cs", "/", "2", "+", "1", "]", ",", "1", ")", "\n", "\n", "\n", "", "with", "tf", ".", "name_scope", "(", "'natural_param'", ")", ":", "\n", "                ", "with", "tf", ".", "name_scope", "(", "'target_word'", ")", ":", "\n", "                    ", "p_idx", "=", "tf", ".", "gather", "(", "words", ",", "p_mask", ")", "\n", "p_rho", "=", "tf", ".", "squeeze", "(", "tf", ".", "gather", "(", "self", ".", "eval_rho_state", ",", "p_idx", ")", ")", "\n", "\n", "# Negative samples", "\n", "", "with", "tf", ".", "name_scope", "(", "'negative_samples'", ")", ":", "\n", "                    ", "self", ".", "eval_n_idx", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ")", "\n", "n_rho", "=", "tf", ".", "gather", "(", "self", ".", "eval_rho_state", ",", "self", ".", "eval_n_idx", ")", "\n", "\n", "", "with", "tf", ".", "name_scope", "(", "'context'", ")", ":", "\n", "                    ", "ctx_idx", "=", "tf", ".", "squeeze", "(", "tf", ".", "gather", "(", "words", ",", "ctx_mask", ")", ")", "\n", "ctx_alphas", "=", "tf", ".", "gather", "(", "self", ".", "eval_alpha_state", ",", "ctx_idx", ")", "\n", "\n", "\n", "# Natural parameter", "\n", "", "ctx_sum", "=", "tf", ".", "reduce_sum", "(", "ctx_alphas", ",", "[", "1", "]", ")", "\n", "p_eta", "=", "tf", ".", "expand_dims", "(", "tf", ".", "reduce_sum", "(", "tf", ".", "multiply", "(", "p_rho", ",", "ctx_sum", ")", ",", "-", "1", ")", ",", "1", ")", "\n", "n_eta", "=", "tf", ".", "reduce_sum", "(", "tf", ".", "multiply", "(", "n_rho", ",", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "ctx_sum", ",", "1", ")", ",", "[", "1", ",", "self", ".", "ns", ",", "1", "]", ")", ")", ",", "-", "1", ")", "\n", "\n", "# Conditional likelihood", "\n", "", "y_pos", "=", "Bernoulli", "(", "logits", "=", "p_eta", ")", "\n", "y_neg", "=", "Bernoulli", "(", "logits", "=", "n_eta", ")", "\n", "\n", "ll_pos", "=", "y_pos", ".", "log_prob", "(", "1.0", ")", "\n", "ll_neg", "=", "tf", ".", "reduce_mean", "(", "y_neg", ".", "log_prob", "(", "0.0", ")", ",", "axis", "=", "1", ")", "\n", "\n", "self", ".", "eval_ll", "=", "tf", ".", "nn", ".", "moments", "(", "ll_pos", "+", "ll_neg", ",", "axes", "=", "[", "0", ",", "1", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.emb_model.dump": [[118, 120], ["NotImplementedError"], "methods", ["None"], ["", "", "def", "dump", "(", "self", ",", "fname", ")", ":", "\n", "        ", "raise", "NotImplementedError", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.emb_model.tf_log_likelihood": [[121, 137], ["data.next", "models.emb_model.sess.run", "models.emb_model.sess.as_default", "models.emb_model.alpha.eval", "len", "models.emb_model.geo_rho[].eval", "models.emb_model.rho.eval"], "methods", ["None"], ["", "def", "tf_log_likelihood", "(", "self", ",", "data", ",", "t", ")", ":", "\n", "        ", "words", ",", "neg_words", "=", "data", ".", "next", "(", ")", "\n", "words", "=", "words", "[", ":", "self", ".", "n_test", "[", "t", "]", "]", "\n", "neg_words", "=", "neg_words", "[", ":", "self", ".", "n_test", "[", "t", "]", "-", "self", ".", "cs", ",", ":", "self", ".", "ns", "]", "\n", "with", "self", ".", "sess", ".", "as_default", "(", ")", ":", "\n", "            ", "if", "len", "(", "self", ".", "states", ")", ">", "0", ":", "\n", "                ", "rho_state", "=", "self", ".", "geo_rho", "[", "self", ".", "states", "[", "t", "]", "]", ".", "eval", "(", ")", "\n", "", "else", ":", "\n", "                ", "rho_state", "=", "self", ".", "rho", ".", "eval", "(", ")", "\n", "", "alpha_state", "=", "self", ".", "alpha", ".", "eval", "(", ")", "\n", "\n", "", "return", "self", ".", "sess", ".", "run", "(", "self", ".", "eval_ll", ",", "feed_dict", "=", "{", "self", ".", "eval_ph", ":", "words", ",", "\n", "self", ".", "eval_n_idx", ":", "neg_words", ",", "\n", "self", ".", "eval_n_test", ":", "self", ".", "n_test", "[", "t", "]", ",", "\n", "self", ".", "eval_alpha_state", ":", "alpha_state", ",", "\n", "self", ".", "eval_rho_state", ":", "rho_state", "}", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.emb_model.evaluate_embeddings": [[138, 161], ["numpy.array", "numpy.array", "numpy.array", "numpy.array", "enumerate", "models.emb_model.tf_log_likelihood", "models.emb_model.tf_log_likelihood", "open", "text_file.write", "text_file.write", "text_file.write", "text_file.write", "text_file.write", "text_file.write", "len", "len", "len", "len", "open", "text_file.write", "text_file.write", "text_file.write", "os.path.join", "str", "os.path.join", "numpy.average", "numpy.average", "numpy.mean", "numpy.sqrt", "numpy.mean", "numpy.sqrt", "numpy.sqrt", "numpy.sqrt", "models.emb_model.n_valid.sum", "models.emb_model.n_test.sum"], "methods", ["home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.emb_model.tf_log_likelihood", "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.emb_model.tf_log_likelihood"], ["", "def", "evaluate_embeddings", "(", "self", ")", ":", "\n", "        ", "t_mean", "=", "np", ".", "array", "(", "[", "0.0", "]", "*", "len", "(", "self", ".", "eval_states", ")", ")", "\n", "t_std", "=", "np", ".", "array", "(", "[", "0.0", "]", "*", "len", "(", "self", ".", "eval_states", ")", ")", "\n", "v_mean", "=", "np", ".", "array", "(", "[", "0.0", "]", "*", "len", "(", "self", ".", "eval_states", ")", ")", "\n", "v_std", "=", "np", ".", "array", "(", "[", "0.0", "]", "*", "len", "(", "self", ".", "eval_states", ")", ")", "\n", "for", "t", ",", "state", "in", "enumerate", "(", "self", ".", "eval_states", ")", ":", "\n", "            ", "vm", ",", "vs", "=", "self", ".", "tf_log_likelihood", "(", "self", ".", "valid_data", "[", "state", "]", ",", "t", ")", "\n", "tm", ",", "ts", "=", "self", ".", "tf_log_likelihood", "(", "self", ".", "test_data", "[", "state", "]", ",", "t", ")", "\n", "t_mean", "[", "t", "]", "=", "tm", "\n", "t_std", "[", "t", "]", "=", "ts", "\n", "v_mean", "[", "t", "]", "=", "vm", "\n", "v_std", "[", "t", "]", "=", "vs", "\n", "with", "open", "(", "os", ".", "path", ".", "join", "(", "self", ".", "logdir", ",", "\"log_file.txt\"", ")", ",", "\"a\"", ")", "as", "text_file", ":", "\n", "                ", "text_file", ".", "write", "(", "state", ")", "\n", "text_file", ".", "write", "(", "\"\\t{:0.5f}\\t{:0.5f}\"", ".", "format", "(", "v_mean", "[", "t", "]", ",", "v_std", "[", "t", "]", "/", "np", ".", "sqrt", "(", "self", ".", "n_valid", "[", "t", "]", ")", ")", ")", "\n", "text_file", ".", "write", "(", "\"\\t{:0.5f}\\t{:0.5f}\\n\"", ".", "format", "(", "t_mean", "[", "t", "]", ",", "t_std", "[", "t", "]", "/", "np", ".", "sqrt", "(", "self", ".", "n_test", "[", "t", "]", ")", ")", ")", "\n", "", "", "with", "open", "(", "os", ".", "path", ".", "join", "(", "self", ".", "logdir", ",", "\"..\"", ",", "\"log_file.txt\"", ")", ",", "\"a\"", ")", "as", "text_file", ":", "\n", "            ", "text_file", ".", "write", "(", "'\\n'", ")", "\n", "text_file", ".", "write", "(", "self", ".", "logdir", ")", "\n", "text_file", ".", "write", "(", "'\\n'", ")", "\n", "text_file", ".", "write", "(", "str", "(", "self", ".", "args", ")", ")", "\n", "text_file", ".", "write", "(", "\"\\nvalid loss: {:0.5f} +- {:0.5f}\\n\"", ".", "format", "(", "np", ".", "average", "(", "v_mean", ",", "weights", "=", "self", ".", "n_valid", ")", ",", "np", ".", "mean", "(", "v_std", ")", "/", "np", ".", "sqrt", "(", "self", ".", "n_valid", ".", "sum", "(", ")", ")", ")", ")", "\n", "text_file", ".", "write", "(", "\"\\ntest loss: {:0.5f} +- {:0.5f}\\n\"", ".", "format", "(", "np", ".", "average", "(", "t_mean", ",", "weights", "=", "self", ".", "n_test", ")", ",", "np", ".", "mean", "(", "t_std", ")", "/", "np", ".", "sqrt", "(", "self", ".", "n_test", ".", "sum", "(", ")", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.emb_model.initialize_training": [[163, 208], ["tensorflow.train.AdamOptimizer", "tensorflow.train.AdamOptimizer.minimize", "tensorflow.Session", "tensorflow.summary.merge_all", "tensorflow.summary.FileWriter", "tensorflow.train.Saver", "tensorflow.contrib.tensorboard.plugins.projector.ProjectorConfig", "tensorflow.contrib.tensorboard.plugins.projector.ProjectorConfig.embeddings.add", "tensorflow.contrib.tensorboard.plugins.projector.ProjectorConfig.embeddings.add", "tensorflow.contrib.tensorboard.plugins.projector.visualize_embeddings", "models.emb_model.sess.as_default", "tensorflow.global_variables_initializer().run", "utils.variable_summaries", "utils.variable_summaries", "utils.variable_summaries", "range", "tensorflow.name_scope", "tensorflow.summary.scalar", "tensorflow.summary.scalar", "tensorflow.summary.scalar", "tensorflow.summary.scalar", "tensorflow.contrib.tensorboard.plugins.projector.ProjectorConfig.embeddings.add", "tensorflow.contrib.tensorboard.plugins.projector.ProjectorConfig.embeddings.add", "utils.variable_summaries", "utils.variable_summaries", "tensorflow.global_variables_initializer", "models.neural_network", "tensorflow.abs", "models.neural_network"], "methods", ["home.repos.pwc.inspect_result.mariru_structured_embeddings.src.utils.variable_summaries", "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.utils.variable_summaries", "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.utils.variable_summaries", "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.utils.variable_summaries", "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.utils.variable_summaries", "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.neural_network", "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.neural_network"], ["", "", "def", "initialize_training", "(", "self", ")", ":", "\n", "#optimizer = tf.train.GradientDescentOptimizer(self.eta)", "\n", "        ", "optimizer", "=", "tf", ".", "train", ".", "AdamOptimizer", "(", ")", "\n", "self", ".", "train", "=", "optimizer", ".", "minimize", "(", "self", ".", "loss", ")", "\n", "self", ".", "sess", "=", "tf", ".", "Session", "(", ")", "\n", "with", "self", ".", "sess", ".", "as_default", "(", ")", ":", "\n", "            ", "tf", ".", "global_variables_initializer", "(", ")", ".", "run", "(", ")", "\n", "\n", "#if self.hierarchical:", "\n", "#    for t in range(4):", "\n", "#        variable_summaries(self.states[t]+'_diff', tf.abs(self.rho ", "\n", "#                  -  self.geo_rho[self.states[t]]))", "\n", "", "if", "self", ".", "amortized", ":", "\n", "            ", "variable_summaries", "(", "'phi'", ",", "self", ".", "phi", ")", "\n", "variable_summaries", "(", "'rho'", ",", "self", ".", "rho", ")", "\n", "variable_summaries", "(", "'alpha'", ",", "self", ".", "alpha", ")", "\n", "for", "t", "in", "range", "(", "self", ".", "n_states", ")", ":", "\n", "                ", "variable_summaries", "(", "self", ".", "states", "[", "t", "]", "+", "'_rho'", ",", "\n", "neural_network", "(", "self", ".", "rho", ",", "self", ".", "phi", ",", "self", ".", "K", ",", "t", ",", "self", ".", "H0", ",", "self", ".", "resnet", ")", ")", "\n", "variable_summaries", "(", "self", ".", "states", "[", "t", "]", "+", "'_diff'", ",", "tf", ".", "abs", "(", "self", ".", "rho", "\n", "-", "neural_network", "(", "self", ".", "rho", ",", "self", ".", "phi", ",", "self", ".", "K", ",", "t", ",", "self", ".", "H0", ",", "self", ".", "resnet", ")", ")", ")", "\n", "", "", "with", "tf", ".", "name_scope", "(", "'objective'", ")", ":", "\n", "            ", "tf", ".", "summary", ".", "scalar", "(", "'loss'", ",", "self", ".", "loss", ")", "\n", "tf", ".", "summary", ".", "scalar", "(", "'priors'", ",", "self", ".", "log_prior", ")", "\n", "tf", ".", "summary", ".", "scalar", "(", "'ll_pos'", ",", "self", ".", "ll_pos", ")", "\n", "tf", ".", "summary", ".", "scalar", "(", "'ll_neg'", ",", "self", ".", "ll_neg", ")", "\n", "", "self", ".", "summaries", "=", "tf", ".", "summary", ".", "merge_all", "(", ")", "\n", "self", ".", "train_writer", "=", "tf", ".", "summary", ".", "FileWriter", "(", "self", ".", "logdir", ",", "self", ".", "sess", ".", "graph", ")", "\n", "self", ".", "saver", "=", "tf", ".", "train", ".", "Saver", "(", ")", "\n", "config", "=", "projector", ".", "ProjectorConfig", "(", ")", "\n", "alpha", "=", "config", ".", "embeddings", ".", "add", "(", ")", "\n", "alpha", ".", "tensor_name", "=", "'model/embeddings/alpha'", "\n", "alpha", ".", "metadata_path", "=", "'../vocab.tsv'", "\n", "if", "self", ".", "amortized", ":", "\n", "            ", "phi", "=", "config", ".", "embeddings", ".", "add", "(", ")", "\n", "phi", ".", "tensor_name", "=", "'model/embeddings/phi'", "\n", "phi", ".", "metadata_path", "=", "'../states.tsv'", "\n", "", "rho", "=", "config", ".", "embeddings", ".", "add", "(", ")", "\n", "rho", ".", "tensor_name", "=", "'model/embeddings/rho'", "\n", "rho", ".", "metadata_path", "=", "'../vocab.tsv'", "\n", "for", "state", "in", "self", ".", "states", ":", "\n", "            ", "rho", "=", "config", ".", "embeddings", ".", "add", "(", ")", "\n", "rho", ".", "tensor_name", "=", "'model/embeddings/'", "+", "state", "+", "'_rho'", "\n", "rho", ".", "metadata_path", "=", "'../vocab.tsv'", "\n", "", "projector", ".", "visualize_embeddings", "(", "self", ".", "train_writer", ",", "config", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.emb_model.train_embeddings": [[210, 226], ["range", "range", "models.emb_model.dump", "models.emb_model.saver.save", "models.emb_model.sess.run", "models.emb_model.saver.save", "models.emb_model.sess.run", "os.path.join", "os.path.join", "print", "models.emb_model.sess.run", "models.emb_model.train_writer.add_summary", "models.emb_model.sess.run", "str", "str", "models.emb_model.train_feed", "models.emb_model.train_feed", "str", "str"], "methods", ["home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.amortized_bern_emb_model.dump"], ["", "def", "train_embeddings", "(", "self", ")", ":", "\n", "        ", "for", "data_pass", "in", "range", "(", "self", ".", "n_iter", ")", ":", "\n", "            ", "if", "self", ".", "amortized", ":", "\n", "                ", "self", ".", "sess", ".", "run", "(", "self", ".", "assign_ops", ")", "\n", "self", ".", "saver", ".", "save", "(", "self", ".", "sess", ",", "os", ".", "path", ".", "join", "(", "self", ".", "logdir", ",", "\"model.ckpt\"", ")", ",", "100", ")", "\n", "", "for", "step", "in", "range", "(", "self", ".", "n_epochs", ")", ":", "\n", "                ", "if", "step", "%", "10", "==", "0", ":", "\n", "                    ", "print", "(", "str", "(", "step", ")", "+", "'/'", "+", "str", "(", "self", ".", "n_epochs", ")", "+", "'   iter '", "+", "str", "(", "data_pass", ")", ")", "\n", "summary", ",", "_", "=", "self", ".", "sess", ".", "run", "(", "[", "self", ".", "summaries", ",", "self", ".", "train", "]", ",", "feed_dict", "=", "self", ".", "train_feed", "(", "self", ".", "placeholders", ")", ")", "\n", "self", ".", "train_writer", ".", "add_summary", "(", "summary", ",", "data_pass", "*", "(", "self", ".", "n_epochs", ")", "+", "step", ")", "\n", "", "else", ":", "\n", "                    ", "self", ".", "sess", ".", "run", "(", "[", "self", ".", "train", "]", ",", "feed_dict", "=", "self", ".", "train_feed", "(", "self", ".", "placeholders", ")", ")", "\n", "", "", "if", "self", ".", "amortized", ":", "\n", "                ", "self", ".", "sess", ".", "run", "(", "self", ".", "assign_ops", ")", "\n", "", "self", ".", "dump", "(", "self", ".", "logdir", "+", "\"/variational\"", "+", "str", "(", "data_pass", ")", "+", "\".dat\"", ")", "\n", "self", ".", "saver", ".", "save", "(", "self", ".", "sess", ",", "os", ".", "path", ".", "join", "(", "self", ".", "logdir", ",", "\"model.ckpt\"", ")", ",", "data_pass", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.bern_emb_model.__init__": [[230, 295], ["models.emb_model.__init__", "models.bern_emb_model.n_minibatch.sum", "models.bern_emb_model.init_eval_model", "tensorflow.name_scope", "tensorflow.contrib.distributions.Bernoulli", "tensorflow.contrib.distributions.Bernoulli", "tensorflow.reduce_sum", "tensorflow.reduce_sum", "tensorflow.name_scope", "tensorflow.placeholder", "tensorflow.name_scope", "tensorflow.cast", "tensorflow.cast", "tensorflow.cast", "tensorflow.concat", "tensorflow.name_scope", "tensorflow.Variable", "tensorflow.Variable", "tensorflow.name_scope", "tensorflow.reduce_sum", "tensorflow.expand_dims", "tensorflow.reduce_sum", "models.bern_emb_model.y_pos.log_prob", "models.bern_emb_model.y_neg.log_prob", "tensorflow.range", "tensorflow.tile", "tensorflow.tile", "tensorflow.name_scope", "tensorflow.contrib.distributions.Normal", "tensorflow.name_scope", "tensorflow.gather", "tensorflow.squeeze", "tensorflow.name_scope", "tensorflow.tile", "tensorflow.multinomial", "tensorflow.gather", "tensorflow.name_scope", "tensorflow.squeeze", "tensorflow.gather", "tensorflow.reduce_sum", "tensorflow.multiply", "tensorflow.expand_dims", "tensorflow.expand_dims", "tensorflow.reduce_sum", "tensorflow.reduce_sum", "tensorflow.gather", "tensorflow.expand_dims", "tensorflow.gather", "tensorflow.multiply", "tensorflow.tile", "tensorflow.range", "tensorflow.range", "tensorflow.contrib.distributions.Normal.log_prob", "tensorflow.log", "tensorflow.expand_dims", "tensorflow.contrib.distributions.Normal.log_prob", "tensorflow.contrib.distributions.Normal.log_prob", "tensorflow.constant"], "methods", ["home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.amortized_bern_emb_model.__init__", "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.emb_model.init_eval_model"], ["    ", "def", "__init__", "(", "self", ",", "args", ",", "d", ",", "logdir", ")", ":", "\n", "        ", "super", "(", "bern_emb_model", ",", "self", ")", ".", "__init__", "(", "args", ",", "d", ",", "logdir", ")", "\n", "self", ".", "states", "=", "[", "]", "\n", "self", ".", "n_minibatch", "=", "self", ".", "n_minibatch", ".", "sum", "(", ")", "\n", "\n", "with", "tf", ".", "name_scope", "(", "'model'", ")", ":", "\n", "# Data Placeholder", "\n", "            ", "with", "tf", ".", "name_scope", "(", "'input'", ")", ":", "\n", "                ", "self", ".", "placeholders", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ")", "\n", "self", ".", "words", "=", "self", ".", "placeholders", "\n", "\n", "\n", "# Index Masks", "\n", "", "with", "tf", ".", "name_scope", "(", "'context_mask'", ")", ":", "\n", "                ", "self", ".", "p_mask", "=", "tf", ".", "cast", "(", "tf", ".", "range", "(", "self", ".", "cs", "/", "2", ",", "self", ".", "n_minibatch", "+", "self", ".", "cs", "/", "2", ")", ",", "tf", ".", "int32", ")", "\n", "rows", "=", "tf", ".", "cast", "(", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "tf", ".", "range", "(", "0", ",", "self", ".", "cs", "/", "2", ")", ",", "[", "0", "]", ")", ",", "[", "self", ".", "n_minibatch", ",", "1", "]", ")", ",", "tf", ".", "int32", ")", "\n", "columns", "=", "tf", ".", "cast", "(", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "tf", ".", "range", "(", "0", ",", "self", ".", "n_minibatch", ")", ",", "[", "1", "]", ")", ",", "[", "1", ",", "self", ".", "cs", "/", "2", "]", ")", ",", "tf", ".", "int32", ")", "\n", "self", ".", "ctx_mask", "=", "tf", ".", "concat", "(", "[", "rows", "+", "columns", ",", "rows", "+", "columns", "+", "self", ".", "cs", "/", "2", "+", "1", "]", ",", "1", ")", "\n", "\n", "", "with", "tf", ".", "name_scope", "(", "'embeddings'", ")", ":", "\n", "                ", "self", ".", "rho", "=", "tf", ".", "Variable", "(", "self", ".", "rho_init", ",", "name", "=", "'rho'", ",", "trainable", "=", "self", ".", "rho_trainable", ")", "\n", "self", ".", "alpha", "=", "tf", ".", "Variable", "(", "self", ".", "alpha_init", ",", "name", "=", "'alpha'", ",", "trainable", "=", "self", ".", "alpha_trainable", ")", "\n", "\n", "with", "tf", ".", "name_scope", "(", "'priors'", ")", ":", "\n", "                    ", "prior", "=", "Normal", "(", "loc", "=", "0.0", ",", "scale", "=", "self", ".", "sig", ")", "\n", "if", "self", ".", "alpha_trainable", ":", "\n", "                        ", "self", ".", "log_prior", "=", "tf", ".", "reduce_sum", "(", "prior", ".", "log_prob", "(", "self", ".", "rho", ")", "+", "prior", ".", "log_prob", "(", "self", ".", "alpha", ")", ")", "\n", "", "else", ":", "\n", "                        ", "self", ".", "log_prior", "=", "tf", ".", "reduce_sum", "(", "prior", ".", "log_prob", "(", "self", ".", "rho", ")", ")", "\n", "\n", "", "", "", "with", "tf", ".", "name_scope", "(", "'natural_param'", ")", ":", "\n", "# Taget and Context Indices", "\n", "                ", "with", "tf", ".", "name_scope", "(", "'target_word'", ")", ":", "\n", "                    ", "self", ".", "p_idx", "=", "tf", ".", "gather", "(", "self", ".", "words", ",", "self", ".", "p_mask", ")", "\n", "self", ".", "p_rho", "=", "tf", ".", "squeeze", "(", "tf", ".", "gather", "(", "self", ".", "rho", ",", "self", ".", "p_idx", ")", ")", "\n", "\n", "# Negative samples", "\n", "", "with", "tf", ".", "name_scope", "(", "'negative_samples'", ")", ":", "\n", "                    ", "unigram_logits", "=", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "tf", ".", "log", "(", "tf", ".", "constant", "(", "self", ".", "unigram", ")", ")", ",", "[", "0", "]", ")", ",", "[", "self", ".", "n_minibatch", ",", "1", "]", ")", "\n", "self", ".", "n_idx", "=", "tf", ".", "multinomial", "(", "unigram_logits", ",", "self", ".", "ns", ")", "\n", "self", ".", "n_rho", "=", "tf", ".", "gather", "(", "self", ".", "rho", ",", "self", ".", "n_idx", ")", "\n", "\n", "", "with", "tf", ".", "name_scope", "(", "'context'", ")", ":", "\n", "                    ", "self", ".", "ctx_idx", "=", "tf", ".", "squeeze", "(", "tf", ".", "gather", "(", "self", ".", "words", ",", "self", ".", "ctx_mask", ")", ")", "\n", "self", ".", "ctx_alphas", "=", "tf", ".", "gather", "(", "self", ".", "alpha", ",", "self", ".", "ctx_idx", ")", "\n", "\n", "\n", "# Natural parameter", "\n", "", "ctx_sum", "=", "tf", ".", "reduce_sum", "(", "self", ".", "ctx_alphas", ",", "[", "1", "]", ")", "\n", "self", ".", "p_eta", "=", "tf", ".", "expand_dims", "(", "tf", ".", "reduce_sum", "(", "tf", ".", "multiply", "(", "self", ".", "p_rho", ",", "ctx_sum", ")", ",", "-", "1", ")", ",", "1", ")", "\n", "self", ".", "n_eta", "=", "tf", ".", "reduce_sum", "(", "tf", ".", "multiply", "(", "self", ".", "n_rho", ",", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "ctx_sum", ",", "1", ")", ",", "[", "1", ",", "self", ".", "ns", ",", "1", "]", ")", ")", ",", "-", "1", ")", "\n", "\n", "# Conditional likelihood", "\n", "", "self", ".", "y_pos", "=", "Bernoulli", "(", "logits", "=", "self", ".", "p_eta", ")", "\n", "self", ".", "y_neg", "=", "Bernoulli", "(", "logits", "=", "self", ".", "n_eta", ")", "\n", "\n", "self", ".", "ll_pos", "=", "tf", ".", "reduce_sum", "(", "self", ".", "y_pos", ".", "log_prob", "(", "1.0", ")", ")", "\n", "self", ".", "ll_neg", "=", "tf", ".", "reduce_sum", "(", "self", ".", "y_neg", ".", "log_prob", "(", "0.0", ")", ")", "\n", "\n", "self", ".", "log_likelihood", "=", "self", ".", "ll_pos", "+", "self", ".", "ll_neg", "\n", "\n", "scale", "=", "1.0", "*", "self", ".", "N", "/", "self", ".", "n_minibatch", "\n", "self", ".", "loss", "=", "-", "(", "self", ".", "n_epochs", "*", "self", ".", "log_likelihood", "+", "self", ".", "log_prior", ")", "\n", "\n", "", "self", ".", "init_eval_model", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.bern_emb_model.dump": [[297, 302], ["pickle.dump", "models.bern_emb_model.sess.as_default", "open", "models.bern_emb_model.rho.eval", "models.bern_emb_model.alpha.eval"], "methods", ["home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.amortized_bern_emb_model.dump"], ["", "def", "dump", "(", "self", ",", "fname", ")", ":", "\n", "            ", "with", "self", ".", "sess", ".", "as_default", "(", ")", ":", "\n", "              ", "dat", "=", "{", "'rho'", ":", "self", ".", "rho", ".", "eval", "(", ")", ",", "\n", "'alpha'", ":", "self", ".", "alpha", ".", "eval", "(", ")", "}", "\n", "", "pickle", ".", "dump", "(", "dat", ",", "open", "(", "fname", ",", "\"a+\"", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.hierarchical_bern_emb_model.__init__": [[304, 373], ["models.emb_model.__init__", "models.hierarchical_bern_emb_model.init_eval_model", "tensorflow.name_scope", "tensorflow.name_scope", "tensorflow.Variable", "tensorflow.Variable", "enumerate", "tensorflow.name_scope", "enumerate", "tensorflow.Variable", "tensorflow.name_scope", "tensorflow.contrib.distributions.Normal", "tensorflow.contrib.distributions.Normal", "tensorflow.range", "tensorflow.tile", "tensorflow.tile", "tensorflow.concat", "tensorflow.placeholder", "tensorflow.gather", "tensorflow.squeeze", "tensorflow.tile", "tensorflow.multinomial", "tensorflow.gather", "tensorflow.squeeze", "tensorflow.gather", "tensorflow.reduce_sum", "tensorflow.expand_dims", "tensorflow.reduce_sum", "tensorflow.contrib.distributions.Bernoulli", "tensorflow.contrib.distributions.Bernoulli", "tensorflow.reduce_sum", "tensorflow.reduce_sum", "tensorflow.reduce_sum", "tensorflow.reduce_sum", "tensorflow.reduce_sum", "tensorflow.expand_dims", "tensorflow.expand_dims", "tensorflow.gather", "tensorflow.expand_dims", "tensorflow.gather", "tensorflow.reduce_sum", "tensorflow.multiply", "models.hierarchical_bern_emb_model.y_pos[].log_prob", "models.hierarchical_bern_emb_model.y_neg[].log_prob", "tensorflow.contrib.distributions.Normal.log_prob", "tensorflow.contrib.distributions.Normal.log_prob", "tensorflow.range", "tensorflow.range", "tensorflow.log", "tensorflow.multiply", "tensorflow.tile", "tensorflow.contrib.distributions.Normal.log_prob", "tensorflow.contrib.distributions.Normal.log_prob", "tensorflow.constant", "tensorflow.expand_dims", "tensorflow.random_normal"], "methods", ["home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.amortized_bern_emb_model.__init__", "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.emb_model.init_eval_model"], ["    ", "def", "__init__", "(", "self", ",", "args", ",", "d", ",", "logdir", ")", ":", "\n", "        ", "super", "(", "hierarchical_bern_emb_model", ",", "self", ")", ".", "__init__", "(", "args", ",", "d", ",", "logdir", ")", "\n", "\n", "with", "tf", ".", "name_scope", "(", "'model'", ")", ":", "\n", "            ", "with", "tf", ".", "name_scope", "(", "'embeddings'", ")", ":", "\n", "                ", "self", ".", "alpha", "=", "tf", ".", "Variable", "(", "self", ".", "alpha_init", ",", "name", "=", "'alpha'", ",", "trainable", "=", "self", ".", "alpha_trainable", ")", "\n", "self", ".", "rho", "=", "tf", ".", "Variable", "(", "self", ".", "rho_init", ",", "name", "=", "'rho'", ",", "trainable", "=", "self", ".", "rho_trainable", ")", "\n", "self", ".", "geo_rho", "=", "{", "}", "\n", "for", "t", ",", "state", "in", "enumerate", "(", "d", ".", "states", ")", ":", "\n", "                    ", "self", ".", "geo_rho", "[", "state", "]", "=", "tf", ".", "Variable", "(", "self", ".", "rho_init", "\n", "+", "0.001", "*", "tf", ".", "random_normal", "(", "[", "d", ".", "L", ",", "self", ".", "K", "]", ")", "/", "self", ".", "K", ",", "\n", "name", "=", "state", "+", "'_rho'", ")", "\n", "\n", "", "with", "tf", ".", "name_scope", "(", "'priors'", ")", ":", "\n", "                    ", "prior", "=", "Normal", "(", "loc", "=", "0.0", ",", "scale", "=", "self", ".", "sig", ")", "\n", "if", "self", ".", "alpha_trainable", ":", "\n", "                        ", "self", ".", "log_prior", "=", "tf", ".", "reduce_sum", "(", "prior", ".", "log_prob", "(", "self", ".", "rho", ")", "+", "prior", ".", "log_prob", "(", "self", ".", "alpha", ")", ")", "\n", "", "else", ":", "\n", "                        ", "self", ".", "log_prior", "=", "tf", ".", "reduce_sum", "(", "prior", ".", "log_prob", "(", "self", ".", "rho", ")", ")", "\n", "\n", "", "local_prior", "=", "Normal", "(", "loc", "=", "0.0", ",", "scale", "=", "self", ".", "sig", "/", "100.0", ")", "\n", "for", "state", "in", "d", ".", "states", ":", "\n", "                        ", "self", ".", "log_prior", "+=", "tf", ".", "reduce_sum", "(", "local_prior", ".", "log_prob", "(", "self", ".", "rho", "-", "self", ".", "geo_rho", "[", "state", "]", ")", ")", "\n", "\n", "", "", "", "with", "tf", ".", "name_scope", "(", "'likelihood'", ")", ":", "\n", "                ", "self", ".", "placeholders", "=", "{", "}", "\n", "self", ".", "y_pos", "=", "{", "}", "\n", "self", ".", "y_neg", "=", "{", "}", "\n", "self", ".", "ll_pos", "=", "0.0", "\n", "self", ".", "ll_neg", "=", "0.0", "\n", "for", "t", ",", "state", "in", "enumerate", "(", "self", ".", "states", ")", ":", "\n", "# Index Masks", "\n", "                    ", "p_mask", "=", "tf", ".", "range", "(", "self", ".", "cs", "/", "2", ",", "self", ".", "n_minibatch", "[", "t", "]", "+", "self", ".", "cs", "/", "2", ")", "\n", "rows", "=", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "tf", ".", "range", "(", "0", ",", "self", ".", "cs", "/", "2", ")", ",", "[", "0", "]", ")", ",", "[", "self", ".", "n_minibatch", "[", "t", "]", ",", "1", "]", ")", "\n", "columns", "=", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "tf", ".", "range", "(", "0", ",", "self", ".", "n_minibatch", "[", "t", "]", ")", ",", "[", "1", "]", ")", ",", "[", "1", ",", "self", ".", "cs", "/", "2", "]", ")", "\n", "\n", "ctx_mask", "=", "tf", ".", "concat", "(", "[", "rows", "+", "columns", ",", "rows", "+", "columns", "+", "self", ".", "cs", "/", "2", "+", "1", "]", ",", "1", ")", "\n", "\n", "# Data Placeholder", "\n", "self", ".", "placeholders", "[", "state", "]", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "shape", "=", "(", "self", ".", "n_minibatch", "[", "t", "]", "+", "self", ".", "cs", ")", ")", "\n", "\n", "# Taget and Context Indices", "\n", "p_idx", "=", "tf", ".", "gather", "(", "self", ".", "placeholders", "[", "state", "]", ",", "p_mask", ")", "\n", "ctx_idx", "=", "tf", ".", "squeeze", "(", "tf", ".", "gather", "(", "self", ".", "placeholders", "[", "state", "]", ",", "ctx_mask", ")", ")", "\n", "\n", "# Negative samples", "\n", "unigram_logits", "=", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "tf", ".", "log", "(", "tf", ".", "constant", "(", "d", ".", "unigram", ")", ")", ",", "[", "0", "]", ")", ",", "[", "self", ".", "n_minibatch", "[", "t", "]", ",", "1", "]", ")", "\n", "n_idx", "=", "tf", ".", "multinomial", "(", "unigram_logits", ",", "self", ".", "ns", ")", "\n", "\n", "# Context vectors", "\n", "ctx_alphas", "=", "tf", ".", "gather", "(", "self", ".", "alpha", ",", "ctx_idx", ")", "\n", "\n", "p_rho", "=", "tf", ".", "squeeze", "(", "tf", ".", "gather", "(", "self", ".", "geo_rho", "[", "state", "]", ",", "p_idx", ")", ")", "\n", "n_rho", "=", "tf", ".", "gather", "(", "self", ".", "geo_rho", "[", "state", "]", ",", "n_idx", ")", "\n", "\n", "# Natural parameter", "\n", "ctx_sum", "=", "tf", ".", "reduce_sum", "(", "ctx_alphas", ",", "[", "1", "]", ")", "\n", "self", ".", "p_eta", "=", "tf", ".", "expand_dims", "(", "tf", ".", "reduce_sum", "(", "tf", ".", "multiply", "(", "p_rho", ",", "ctx_sum", ")", ",", "-", "1", ")", ",", "1", ")", "\n", "self", ".", "n_eta", "=", "tf", ".", "reduce_sum", "(", "tf", ".", "multiply", "(", "n_rho", ",", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "ctx_sum", ",", "1", ")", ",", "[", "1", ",", "self", ".", "ns", ",", "1", "]", ")", ")", ",", "-", "1", ")", "\n", "\n", "# Conditional likelihood", "\n", "self", ".", "y_pos", "[", "state", "]", "=", "Bernoulli", "(", "logits", "=", "self", ".", "p_eta", ")", "\n", "self", ".", "y_neg", "[", "state", "]", "=", "Bernoulli", "(", "logits", "=", "self", ".", "n_eta", ")", "\n", "\n", "self", ".", "ll_pos", "+=", "tf", ".", "reduce_sum", "(", "self", ".", "y_pos", "[", "state", "]", ".", "log_prob", "(", "1.0", ")", ")", "\n", "self", ".", "ll_neg", "+=", "tf", ".", "reduce_sum", "(", "self", ".", "y_neg", "[", "state", "]", ".", "log_prob", "(", "0.0", ")", ")", "\n", "\n", "", "", "self", ".", "loss", "=", "-", "(", "self", ".", "n_epochs", "*", "(", "self", ".", "ll_pos", "+", "self", ".", "ll_neg", ")", "+", "self", ".", "log_prior", ")", "\n", "", "self", ".", "init_eval_model", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.hierarchical_bern_emb_model.dump": [[376, 383], ["pickle.dump", "models.hierarchical_bern_emb_model.sess.as_default", "open", "models.hierarchical_bern_emb_model.alpha.eval", "models.hierarchical_bern_emb_model.rho.eval", "models.hierarchical_bern_emb_model.geo_rho[].eval"], "methods", ["home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.amortized_bern_emb_model.dump"], ["", "def", "dump", "(", "self", ",", "fname", ")", ":", "\n", "            ", "with", "self", ".", "sess", ".", "as_default", "(", ")", ":", "\n", "                ", "dat", "=", "{", "'alpha'", ":", "self", ".", "alpha", ".", "eval", "(", ")", ",", "\n", "'rho'", ":", "self", ".", "rho", ".", "eval", "(", ")", "}", "\n", "for", "state", "in", "self", ".", "states", ":", "\n", "                    ", "dat", "[", "state", "+", "'_rho'", "]", "=", "self", ".", "geo_rho", "[", "state", "]", ".", "eval", "(", ")", "\n", "", "", "pickle", ".", "dump", "(", "dat", ",", "open", "(", "fname", ",", "\"a+\"", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.amortized_bern_emb_model.__init__": [[394, 475], ["models.emb_model.__init__", "models.amortized_bern_emb_model.init_eval_model", "tensorflow.name_scope", "tensorflow.name_scope", "tensorflow.Variable", "tensorflow.Variable", "numpy.random.uniform().astype", "tensorflow.Variable", "enumerate", "enumerate", "tensorflow.name_scope", "enumerate", "numpy.sqrt", "numpy.sqrt", "tensorflow.Variable", "tensorflow.name_scope", "tensorflow.contrib.distributions.Normal", "tensorflow.contrib.distributions.Normal", "enumerate", "models.amortized_bern_emb_model.geo_rho[].assign", "tensorflow.range", "tensorflow.tile", "tensorflow.tile", "tensorflow.concat", "tensorflow.placeholder", "tensorflow.gather", "tensorflow.squeeze", "tensorflow.tile", "tensorflow.multinomial", "tensorflow.gather", "models.neural_network", "tensorflow.squeeze", "tensorflow.gather", "tensorflow.reduce_sum", "tensorflow.expand_dims", "tensorflow.reduce_sum", "tensorflow.contrib.distributions.Bernoulli", "tensorflow.contrib.distributions.Bernoulli", "tensorflow.reduce_sum", "tensorflow.reduce_sum", "numpy.random.uniform", "tensorflow.random_normal", "tensorflow.reduce_sum", "tensorflow.reduce_sum", "models.neural_network", "tensorflow.expand_dims", "tensorflow.expand_dims", "tensorflow.gather", "tensorflow.expand_dims", "tensorflow.gather", "tensorflow.reduce_sum", "tensorflow.multiply", "models.amortized_bern_emb_model.y_pos[].log_prob", "models.amortized_bern_emb_model.y_neg[].log_prob", "tensorflow.reduce_sum", "tensorflow.reduce_sum", "tensorflow.contrib.distributions.Normal.log_prob", "tensorflow.range", "tensorflow.range", "tensorflow.log", "tensorflow.multiply", "tensorflow.tile", "tensorflow.reduce_sum", "tensorflow.contrib.distributions.Normal.log_prob", "tensorflow.contrib.distributions.Normal.log_prob", "tensorflow.constant", "tensorflow.expand_dims", "tensorflow.contrib.distributions.Normal.log_prob", "tensorflow.reduce_sum", "tensorflow.contrib.distributions.Normal.log_prob", "models.neural_network", "tensorflow.contrib.distributions.Normal.log_prob"], "methods", ["home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.amortized_bern_emb_model.__init__", "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.emb_model.init_eval_model", "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.neural_network", "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.neural_network", "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.neural_network"], ["    ", "def", "__init__", "(", "self", ",", "args", ",", "d", ",", "logdir", ")", ":", "\n", "        ", "super", "(", "amortized_bern_emb_model", ",", "self", ")", ".", "__init__", "(", "args", ",", "d", ",", "logdir", ")", "\n", "with", "tf", ".", "name_scope", "(", "'model'", ")", ":", "\n", "\n", "            ", "with", "tf", ".", "name_scope", "(", "'embeddings'", ")", ":", "\n", "                ", "self", ".", "alpha", "=", "tf", ".", "Variable", "(", "self", ".", "alpha_init", ",", "name", "=", "'alpha'", ",", "trainable", "=", "self", ".", "alpha_trainable", ")", "\n", "self", ".", "rho", "=", "tf", ".", "Variable", "(", "self", ".", "rho_init", ",", "name", "=", "'rho'", ",", "trainable", "=", "self", ".", "rho_trainable", ")", "\n", "\n", "trunc", "=", "np", ".", "sqrt", "(", "6", ")", "/", "np", ".", "sqrt", "(", "self", ".", "K", "+", "self", ".", "H0", ")", "\n", "phi_init", "=", "np", ".", "random", ".", "uniform", "(", "-", "trunc", ",", "trunc", ",", "\n", "[", "self", ".", "n_states", ",", "2", "*", "self", ".", "K", "*", "self", ".", "H0", "]", ")", ".", "astype", "(", "'float32'", ")", "\n", "self", ".", "phi", "=", "tf", ".", "Variable", "(", "phi_init", ",", "name", "=", "'phi'", ")", "\n", "\n", "self", ".", "geo_rho", "=", "{", "}", "\n", "for", "t", ",", "state", "in", "enumerate", "(", "d", ".", "states", ")", ":", "\n", "                    ", "self", ".", "geo_rho", "[", "state", "]", "=", "tf", ".", "Variable", "(", "tf", ".", "random_normal", "(", "self", ".", "rho_init", ".", "shape", ")", ",", "trainable", "=", "False", ",", "name", "=", "state", "+", "'_rho'", ")", "\n", "\n", "", "with", "tf", ".", "name_scope", "(", "'priors'", ")", ":", "\n", "                    ", "prior", "=", "Normal", "(", "loc", "=", "0.0", ",", "scale", "=", "self", ".", "sig", ")", "\n", "if", "self", ".", "alpha_trainable", ":", "\n", "                        ", "self", ".", "log_prior", "=", "tf", ".", "reduce_sum", "(", "prior", ".", "log_prob", "(", "self", ".", "rho", ")", "+", "tf", ".", "reduce_sum", "(", "prior", ".", "log_prob", "(", "self", ".", "alpha", ")", ")", "+", "tf", ".", "reduce_sum", "(", "prior", ".", "log_prob", "(", "self", ".", "phi", ")", ")", ")", "\n", "", "else", ":", "\n", "                        ", "self", ".", "log_prior", "=", "tf", ".", "reduce_sum", "(", "prior", ".", "log_prob", "(", "self", ".", "rho", ")", ")", "+", "tf", ".", "reduce_sum", "(", "prior", ".", "log_prob", "(", "self", ".", "phi", ")", ")", "\n", "\n", "", "local_prior", "=", "Normal", "(", "loc", "=", "0.0", ",", "scale", "=", "self", ".", "sig", "/", "100.0", ")", "\n", "for", "t", ",", "state", "in", "enumerate", "(", "d", ".", "states", ")", ":", "\n", "                        ", "self", ".", "log_prior", "+=", "tf", ".", "reduce_sum", "(", "local_prior", ".", "log_prob", "(", "self", ".", "rho", "\n", "-", "neural_network", "(", "self", ".", "rho", ",", "self", ".", "phi", ",", "self", ".", "K", ",", "t", ",", "self", ".", "H0", ",", "self", ".", "resnet", ")", ")", ")", "\n", "\n", "", "", "self", ".", "assign_ops", "=", "d", ".", "T", "*", "[", "0", "]", "\n", "for", "t", ",", "state", "in", "enumerate", "(", "d", ".", "states", ")", ":", "\n", "                    ", "self", ".", "assign_ops", "[", "t", "]", "=", "self", ".", "geo_rho", "[", "state", "]", ".", "assign", "(", "\n", "neural_network", "(", "self", ".", "rho", ",", "self", ".", "phi", ",", "self", ".", "K", ",", "t", ",", "self", ".", "H0", ",", "self", ".", "resnet", ")", ")", "\n", "\n", "\n", "", "", "with", "tf", ".", "name_scope", "(", "'likelihood'", ")", ":", "\n", "                ", "self", ".", "placeholders", "=", "{", "}", "\n", "self", ".", "y_pos", "=", "{", "}", "\n", "self", ".", "y_neg", "=", "{", "}", "\n", "self", ".", "ll_pos", "=", "0.0", "\n", "self", ".", "ll_neg", "=", "0.0", "\n", "for", "t", ",", "state", "in", "enumerate", "(", "self", ".", "states", ")", ":", "\n", "# Index Masks", "\n", "                    ", "p_mask", "=", "tf", ".", "range", "(", "self", ".", "cs", "/", "2", ",", "self", ".", "n_minibatch", "[", "t", "]", "+", "self", ".", "cs", "/", "2", ")", "\n", "rows", "=", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "tf", ".", "range", "(", "0", ",", "self", ".", "cs", "/", "2", ")", ",", "[", "0", "]", ")", ",", "[", "self", ".", "n_minibatch", "[", "t", "]", ",", "1", "]", ")", "\n", "columns", "=", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "tf", ".", "range", "(", "0", ",", "self", ".", "n_minibatch", "[", "t", "]", ")", ",", "[", "1", "]", ")", ",", "[", "1", ",", "self", ".", "cs", "/", "2", "]", ")", "\n", "\n", "ctx_mask", "=", "tf", ".", "concat", "(", "[", "rows", "+", "columns", ",", "rows", "+", "columns", "+", "self", ".", "cs", "/", "2", "+", "1", "]", ",", "1", ")", "\n", "\n", "# Data Placeholder", "\n", "self", ".", "placeholders", "[", "state", "]", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ",", "shape", "=", "(", "self", ".", "n_minibatch", "[", "t", "]", "+", "self", ".", "cs", ")", ")", "\n", "\n", "# Taget and Context Indices", "\n", "p_idx", "=", "tf", ".", "gather", "(", "self", ".", "placeholders", "[", "state", "]", ",", "p_mask", ")", "\n", "ctx_idx", "=", "tf", ".", "squeeze", "(", "tf", ".", "gather", "(", "self", ".", "placeholders", "[", "state", "]", ",", "ctx_mask", ")", ")", "\n", "\n", "# Negative samples", "\n", "unigram_logits", "=", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "tf", ".", "log", "(", "tf", ".", "constant", "(", "d", ".", "unigram", ")", ")", ",", "[", "0", "]", ")", ",", "[", "self", ".", "n_minibatch", "[", "t", "]", ",", "1", "]", ")", "\n", "n_idx", "=", "tf", ".", "multinomial", "(", "unigram_logits", ",", "self", ".", "ns", ")", "\n", "\n", "# Context vectors", "\n", "ctx_alphas", "=", "tf", ".", "gather", "(", "self", ".", "alpha", ",", "ctx_idx", ")", "\n", "\n", "rho_state", "=", "neural_network", "(", "self", ".", "rho", ",", "self", ".", "phi", ",", "self", ".", "K", ",", "t", ",", "self", ".", "H0", ",", "self", ".", "resnet", ")", "\n", "p_rho", "=", "tf", ".", "squeeze", "(", "tf", ".", "gather", "(", "rho_state", ",", "p_idx", ")", ")", "\n", "n_rho", "=", "tf", ".", "gather", "(", "rho_state", ",", "n_idx", ")", "\n", "\n", "# Natural parameter", "\n", "ctx_sum", "=", "tf", ".", "reduce_sum", "(", "ctx_alphas", ",", "[", "1", "]", ")", "\n", "p_eta", "=", "tf", ".", "expand_dims", "(", "tf", ".", "reduce_sum", "(", "tf", ".", "multiply", "(", "p_rho", ",", "ctx_sum", ")", ",", "-", "1", ")", ",", "1", ")", "\n", "n_eta", "=", "tf", ".", "reduce_sum", "(", "tf", ".", "multiply", "(", "n_rho", ",", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "ctx_sum", ",", "1", ")", ",", "[", "1", ",", "self", ".", "ns", ",", "1", "]", ")", ")", ",", "-", "1", ")", "\n", "\n", "# Conditional likelihood", "\n", "self", ".", "y_pos", "[", "state", "]", "=", "Bernoulli", "(", "logits", "=", "p_eta", ")", "\n", "self", ".", "y_neg", "[", "state", "]", "=", "Bernoulli", "(", "logits", "=", "n_eta", ")", "\n", "\n", "self", ".", "ll_pos", "+=", "tf", ".", "reduce_sum", "(", "self", ".", "y_pos", "[", "state", "]", ".", "log_prob", "(", "1.0", ")", ")", "\n", "self", ".", "ll_neg", "+=", "tf", ".", "reduce_sum", "(", "self", ".", "y_neg", "[", "state", "]", ".", "log_prob", "(", "0.0", ")", ")", "\n", "\n", "", "", "self", ".", "loss", "=", "-", "(", "self", ".", "n_epochs", "*", "(", "self", ".", "ll_pos", "+", "self", ".", "ll_neg", ")", "+", "self", ".", "log_prior", ")", "\n", "", "self", ".", "init_eval_model", "(", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.amortized_bern_emb_model.dump": [[476, 484], ["pickle.dump", "models.amortized_bern_emb_model.sess.as_default", "open", "models.amortized_bern_emb_model.alpha.eval", "models.amortized_bern_emb_model.phi.eval", "models.amortized_bern_emb_model.rho.eval", "models.amortized_bern_emb_model.geo_rho[].eval"], "methods", ["home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.amortized_bern_emb_model.dump"], ["", "def", "dump", "(", "self", ",", "fname", ")", ":", "\n", "            ", "with", "self", ".", "sess", ".", "as_default", "(", ")", ":", "\n", "                ", "dat", "=", "{", "'alpha'", ":", "self", ".", "alpha", ".", "eval", "(", ")", ",", "\n", "'phi'", ":", "self", ".", "phi", ".", "eval", "(", ")", ",", "\n", "'rho'", ":", "self", ".", "rho", ".", "eval", "(", ")", "}", "\n", "for", "state", "in", "self", ".", "states", ":", "\n", "                    ", "dat", "[", "state", "+", "'_rho'", "]", "=", "self", ".", "geo_rho", "[", "state", "]", ".", "eval", "(", ")", "\n", "", "", "pickle", ".", "dump", "(", "dat", ",", "open", "(", "fname", ",", "\"a+\"", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.neural_network": [[384, 392], ["tensorflow.reshape", "tensorflow.reshape", "tensorflow.tanh", "tensorflow.slice", "tensorflow.slice", "tensorflow.matmul", "tensorflow.matmul", "tensorflow.matmul"], "function", ["None"], ["", "", "def", "neural_network", "(", "rho", ",", "phi", ",", "K", ",", "s", ",", "H0", ",", "resnet", ")", ":", "\n", "    ", "phi_w_1", "=", "tf", ".", "reshape", "(", "tf", ".", "slice", "(", "phi", ",", "[", "s", ",", "0", "]", ",", "[", "1", ",", "K", "*", "H0", "]", ")", ",", "[", "K", ",", "H0", "]", ")", "\n", "phi_w_2", "=", "tf", ".", "reshape", "(", "tf", ".", "slice", "(", "phi", ",", "[", "s", ",", "K", "*", "H0", "]", ",", "[", "1", ",", "K", "*", "H0", "]", ")", ",", "[", "H0", ",", "K", "]", ")", "\n", "hidden", "=", "tf", ".", "tanh", "(", "tf", ".", "matmul", "(", "rho", ",", "phi_w_1", ")", ")", "\n", "if", "resnet", ":", "\n", "        ", "return", "rho", "+", "tf", ".", "matmul", "(", "hidden", ",", "phi_w_2", ")", "\n", "", "else", ":", "\n", "        ", "return", "tf", ".", "matmul", "(", "hidden", ",", "phi_w_2", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.models.define_model": [[486, 497], ["models.hierarchical_bern_emb_model", "models.amortized_bern_emb_model", "models.bern_emb_model", "NotImplementedError"], "function", ["None"], ["", "", "def", "define_model", "(", "args", ",", "d", ",", "logdir", ")", ":", "\n", "# hierarchical model", "\n", "    ", "if", "args", ".", "hierarchical", "and", "not", "args", ".", "amortized", ":", "\n", "        ", "m", "=", "hierarchical_bern_emb_model", "(", "args", ",", "d", ",", "logdir", ")", "\n", "", "elif", "args", ".", "amortized", "and", "not", "args", ".", "hierarchical", ":", "\n", "        ", "m", "=", "amortized_bern_emb_model", "(", "args", ",", "d", ",", "logdir", ")", "\n", "", "elif", "not", "(", "args", ".", "amortized", "or", "args", ".", "hierarchical", ")", ":", "\n", "        ", "m", "=", "bern_emb_model", "(", "args", ",", "d", ",", "logdir", ")", "\n", "", "else", ":", "\n", "        ", "raise", "NotImplementedError", "(", ")", "\n", "", "return", "m", "\n", "\n"]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.utils.make_dir": [[10, 17], ["os.path.join", "os.path.isdir", "os.makedirs", "time.sleep", "os.path.join", "time.strftime", "numpy.random.randint", "time.strftime"], "function", ["None"], ["def", "make_dir", "(", "name", ")", ":", "\n", "    ", "dir_name", "=", "os", ".", "path", ".", "join", "(", "'fits'", ",", "name", ",", "'EF_EMB_'", "+", "time", ".", "strftime", "(", "\"%y_%m_%d_%H_%M_%S\"", ")", ")", "\n", "while", "os", ".", "path", ".", "isdir", "(", "dir_name", ")", ":", "\n", "        ", "time", ".", "sleep", "(", "np", ".", "random", ".", "randint", "(", "10", ")", ")", "\n", "dir_name", "=", "os", ".", "path", ".", "join", "(", "'fits'", ",", "name", ",", "'EF_EMB_'", "+", "time", ".", "strftime", "(", "\"%y_%m_%d_%H_%M_%S\"", ")", ")", "\n", "", "os", ".", "makedirs", "(", "dir_name", ")", "\n", "return", "dir_name", "\n", "\n"]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.utils.variable_summaries": [[18, 27], ["tensorflow.name_scope", "tensorflow.reduce_mean", "tensorflow.summary.scalar", "tensorflow.summary.scalar", "tensorflow.summary.scalar", "tensorflow.summary.scalar", "tensorflow.name_scope", "tensorflow.sqrt", "tensorflow.reduce_max", "tensorflow.reduce_min", "tensorflow.reduce_mean", "tensorflow.square"], "function", ["None"], ["", "def", "variable_summaries", "(", "summary_name", ",", "var", ")", ":", "\n", "    ", "with", "tf", ".", "name_scope", "(", "summary_name", ")", ":", "\n", "        ", "mean", "=", "tf", ".", "reduce_mean", "(", "var", ")", "\n", "tf", ".", "summary", ".", "scalar", "(", "'mean'", ",", "mean", ")", "\n", "with", "tf", ".", "name_scope", "(", "'stddev'", ")", ":", "\n", "            ", "stddev", "=", "tf", ".", "sqrt", "(", "tf", ".", "reduce_mean", "(", "tf", ".", "square", "(", "var", "-", "mean", ")", ")", ")", "\n", "", "tf", ".", "summary", ".", "scalar", "(", "'stddev'", ",", "stddev", ")", "\n", "tf", ".", "summary", ".", "scalar", "(", "'max'", ",", "tf", ".", "reduce_max", "(", "var", ")", ")", "\n", "tf", ".", "summary", ".", "scalar", "(", "'min'", ",", "tf", ".", "reduce_min", "(", "var", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.src.args.parse_args": [[3, 48], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.parse_args", "print"], "function", ["home.repos.pwc.inspect_result.mariru_structured_embeddings.src.args.parse_args"], ["def", "parse_args", "(", ")", ":", "\n", "        ", "parser", "=", "argparse", ".", "ArgumentParser", "(", "description", "=", "\"run exponential family embeddings on text\"", ")", "\n", "\n", "parser", ".", "add_argument", "(", "'--K'", ",", "type", "=", "int", ",", "default", "=", "100", ",", "\n", "help", "=", "'Number of dimensions. Default is 100.'", ")", "\n", "\n", "parser", ".", "add_argument", "(", "'--H0'", ",", "type", "=", "int", ",", "default", "=", "5", ",", "\n", "help", "=", "'Number of units in modulation network. Default is 5.'", ")", "\n", "\n", "parser", ".", "add_argument", "(", "'--sig'", ",", "type", "=", "float", ",", "default", "=", "10.0", ",", "\n", "help", "=", "'Regularization on global embeddings. Default is 10.'", ")", "\n", "\n", "parser", ".", "add_argument", "(", "'--n_iter'", ",", "type", "=", "int", ",", "default", "=", "1", ",", "\n", "help", "=", "'Number of passes over the data. Default is 1.'", ")", "\n", "\n", "parser", ".", "add_argument", "(", "'--n_epochs'", ",", "type", "=", "int", ",", "default", "=", "100", ",", "\n", "help", "=", "'Number of epochs. Default is 100.'", ")", "\n", "\n", "parser", ".", "add_argument", "(", "'--cs'", ",", "type", "=", "int", ",", "default", "=", "4", ",", "\n", "help", "=", "'Context size. Default is 4.'", ")", "\n", "\n", "parser", ".", "add_argument", "(", "'--ns'", ",", "type", "=", "int", ",", "default", "=", "10", ",", "\n", "help", "=", "'Number of negative samples. Default is 10. You will get a difficult to read tensorflow error if you use more negative samples than you generated in step 4 of the data preparation.'", ")", "\n", "\n", "parser", ".", "add_argument", "(", "'--hierarchical'", ",", "type", "=", "bool", ",", "default", "=", "False", ",", "\n", "help", "=", "'hierarchical embedding model. Default is False.'", ")", "\n", "\n", "parser", ".", "add_argument", "(", "'--amortized'", ",", "type", "=", "bool", ",", "default", "=", "False", ",", "\n", "help", "=", "'amortized embedding model. Default is False.'", ")", "\n", "\n", "parser", ".", "add_argument", "(", "'--resnet'", ",", "type", "=", "bool", ",", "default", "=", "False", ",", "\n", "help", "=", "'Use resnet architecture for amortization. Default is False.'", ")", "\n", "\n", "parser", ".", "add_argument", "(", "'--debug'", ",", "type", "=", "bool", ",", "default", "=", "False", ",", "\n", "help", "=", "'Debug mode (10th of data). Default is False.'", ")", "\n", "\n", "parser", ".", "add_argument", "(", "'--init'", ",", "type", "=", "str", ",", "default", "=", "''", ",", "\n", "help", "=", "'Folder name to load variational.dat for initialization. Default is \\'\\' for no initialization'", ")", "\n", "\n", "parser", ".", "add_argument", "(", "'--fpath'", ",", "type", "=", "str", ",", "default", "=", "'../dat/lorem_ipsum/'", ",", "\n", "help", "=", "'path to data'", ")", "\n", "\n", "args", "=", "parser", ".", "parse_args", "(", ")", "\n", "print", "(", "args", ")", "\n", "return", "args", "\n", "", ""]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.dat.step_3_create_data_stats.count_words": [[22, 30], ["numpy.zeros", "glob.glob", "enumerate", "numpy.load", "len", "os.path.basename().split", "os.path.basename"], "function", ["None"], ["def", "count_words", "(", "split", ")", ":", "\n", "    ", "dat_stats", "[", "split", "]", "=", "np", ".", "zeros", "(", "T", ")", "\n", "files", "=", "glob", ".", "glob", "(", "dataset_name", "+", "'/'", "+", "split", "+", "'/*.npy'", ")", "\n", "for", "t", ",", "i", "in", "enumerate", "(", "dat_stats", "[", "'T_bins'", "]", ")", ":", "\n", "        ", "dat_files", "=", "[", "f", "for", "f", "in", "files", "if", "os", ".", "path", ".", "basename", "(", "f", ")", ".", "split", "(", "'_'", ")", "[", "0", "]", "==", "i", "]", "\n", "for", "fname", "in", "dat_files", ":", "\n", "            ", "dat", "=", "np", ".", "load", "(", "fname", ")", "\n", "dat_stats", "[", "split", "]", "[", "t", "]", "+=", "len", "(", "dat", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.mariru_structured_embeddings.dat.step_4_negative_samples.negative_samples": [[20, 36], ["glob.glob", "pickle.load", "numpy.sum().astype", "pandas.read_csv", "tensorflow.placeholder", "tensorflow.tile", "tensorflow.multinomial", "tensorflow.Session", "open", "os.path.join", "tensorflow.expand_dims", "numpy.load", "tf.Session.run", "numpy.save", "os.path.join", "numpy.sum", "tensorflow.log", "fn.replace", "sess.run.astype", "tensorflow.constant", "len", "len"], "function", ["None"], ["def", "negative_samples", "(", "split", ",", "fpath", "=", "''", ",", "ns", "=", "negative_samples", ")", ":", "\n", "    ", "files", "=", "glob", ".", "glob", "(", "fpath", "+", "split", "+", "'/*.npy'", ")", "\n", "dat_stats", "=", "pickle", ".", "load", "(", "open", "(", "os", ".", "path", ".", "join", "(", "fpath", ",", "\"dat_stats.pkl\"", ")", ",", "\"rb\"", ")", ")", "\n", "N", "=", "np", ".", "sum", "(", "dat_stats", "[", "'train'", "]", ")", ".", "astype", "(", "'int32'", ")", "\n", "df", "=", "pd", ".", "read_csv", "(", "os", ".", "path", ".", "join", "(", "fpath", ",", "'unigram.txt'", ")", ",", "delimiter", "=", "'\\t'", ",", "header", "=", "None", ")", "\n", "counts", "=", "df", "[", "len", "(", "df", ".", "columns", ")", "-", "1", "]", ".", "values", "\n", "counts", "=", "(", "1.0", "*", "counts", "/", "N", ")", "**", "(", "3.0", "/", "4", ")", "\n", "unigram", "=", "counts", "/", "N", "\n", "size", "=", "tf", ".", "placeholder", "(", "tf", ".", "int32", ")", "\n", "unigram_logits", "=", "tf", ".", "tile", "(", "tf", ".", "expand_dims", "(", "tf", ".", "log", "(", "tf", ".", "constant", "(", "unigram", ")", ")", ",", "[", "0", "]", ")", ",", "[", "size", ",", "1", "]", ")", "\n", "n_idx", "=", "tf", ".", "multinomial", "(", "unigram_logits", ",", "ns", ")", "\n", "sess", "=", "tf", ".", "Session", "(", ")", "\n", "for", "fn", "in", "files", ":", "\n", "        ", "dat", "=", "np", ".", "load", "(", "fn", ")", "\n", "neg_words", "=", "sess", ".", "run", "(", "n_idx", ",", "feed_dict", "=", "{", "size", ":", "len", "(", "dat", ")", "}", ")", "\n", "np", ".", "save", "(", "fn", ".", "replace", "(", "split", ",", "split", "+", "'/neg'", ")", ",", "neg_words", ".", "astype", "(", "'int32'", ")", ")", "\n", "\n"]]}