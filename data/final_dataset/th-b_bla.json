{"home.repos.pwc.inspect_result.th-b_bla.None.experiment.DataSetLoader.__init__": [[21, 25], ["None"], "methods", ["None"], ["    ", "def", "__init__", "(", "self", ",", "batch_size", "=", "32", ",", "size", "=", "(", "224", ",", "224", ")", ",", "preprocess_image", "=", "(", "lambda", "x", ":", "x", ")", ")", ":", "\n", "        ", "self", ".", "size", "=", "size", "\n", "self", ".", "batch_size", "=", "batch_size", "\n", "self", ".", "preprocess_image", "=", "preprocess_image", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.TfDataSetLoader.__init__": [[28, 51], ["experiment.DataSetLoader.__init__", "tensorflow_datasets.load", "info.features[].int2str", "len", "int", "dataset[].shuffle", "experiment.TfDataSetLoader.prepare_dataset", "range", "dataset[].shuffle.take", "dataset[].shuffle.skip"], "methods", ["home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.__init__", "home.repos.pwc.inspect_result.th-b_bla.None.experiment.TfDataSetLoader.prepare_dataset"], ["    ", "def", "__init__", "(", "self", ",", "name", ",", "batch_size", "=", "32", ",", "size", "=", "(", "224", ",", "224", ")", ",", "preprocess_image", "=", "(", "lambda", "x", ":", "x", ")", ")", ":", "\n", "        ", "super", "(", ")", ".", "__init__", "(", "batch_size", "=", "batch_size", ",", "size", "=", "size", ",", "preprocess_image", "=", "preprocess_image", ")", "\n", "\n", "dataset", ",", "info", "=", "tfds", ".", "load", "(", "name", "=", "name", ",", "with_info", "=", "True", ")", "\n", "\n", "self", ".", "num_classes", "=", "info", ".", "features", "[", "'label'", "]", ".", "num_classes", "\n", "self", ".", "label_dict", "=", "{", "i", ":", "info", ".", "features", "[", "'label'", "]", ".", "int2str", "(", "i", ")", "for", "i", "in", "range", "(", "self", ".", "num_classes", ")", "}", "\n", "\n", "if", "name", "==", "'cats_vs_dogs'", ":", "\n", "            ", "split", "=", ".8", "\n", "\n", "s", "=", "len", "(", "dataset", "[", "'train'", "]", ")", "\n", "s", "=", "int", "(", "s", "*", "split", ")", "\n", "\n", "d", "=", "dataset", "[", "'train'", "]", ".", "shuffle", "(", "buffer_size", "=", "1000", ",", "seed", "=", "42", ",", "reshuffle_each_iteration", "=", "False", ")", "\n", "dataset", "=", "{", "\n", "'train'", ":", "d", ".", "take", "(", "s", ")", ",", "\n", "'test'", ":", "d", ".", "skip", "(", "s", ")", "\n", "}", "\n", "\n", "\n", "", "self", ".", "dataset", "=", "{", "key", ":", "self", ".", "prepare_dataset", "(", "dataset", "[", "key", "]", ",", "shuffle", "=", "(", "key", "==", "'train'", ")", ")", "\n", "for", "key", "in", "[", "'train'", ",", "'test'", "]", "}", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.TfDataSetLoader.preprocess": [[52, 61], ["tensorflow.image.convert_image_dtype", "tensorflow.image.resize", "experiment.TfDataSetLoader.preprocess_image"], "methods", ["None"], ["", "def", "preprocess", "(", "self", ",", "data", ")", ":", "\n", "        ", "image", "=", "tf", ".", "image", ".", "convert_image_dtype", "(", "data", "[", "'image'", "]", ",", "dtype", "=", "tf", ".", "float32", ")", "\n", "image", "=", "tf", ".", "image", ".", "resize", "(", "image", ",", "self", ".", "size", ")", "\n", "image", "*=", "255.", "\n", "image", "=", "self", ".", "preprocess_image", "(", "image", ")", "\n", "\n", "label", "=", "data", "[", "'label'", "]", "\n", "\n", "return", "image", ",", "label", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.TfDataSetLoader.prepare_dataset": [[62, 71], ["dataset.shuffle.shuffle.map", "dataset.shuffle.shuffle.batch", "dataset.shuffle.shuffle.prefetch", "dataset.shuffle.shuffle.shuffle", "dataset.shuffle.shuffle.shuffle"], "methods", ["None"], ["", "def", "prepare_dataset", "(", "self", ",", "dataset", ",", "shuffle", ")", ":", "\n", "        ", "dataset", "=", "dataset", ".", "map", "(", "self", ".", "preprocess", ",", "num_parallel_calls", "=", "4", ")", "\n", "if", "shuffle", ":", "\n", "            ", "dataset", "=", "dataset", ".", "shuffle", "(", "buffer_size", "=", "1000", ")", "\n", "", "else", ":", "\n", "            ", "dataset", "=", "dataset", ".", "shuffle", "(", "buffer_size", "=", "1000", ",", "seed", "=", "42", ",", "reshuffle_each_iteration", "=", "False", ")", "\n", "", "dataset", "=", "dataset", ".", "batch", "(", "self", ".", "batch_size", ")", "\n", "dataset", "=", "dataset", ".", "prefetch", "(", "buffer_size", "=", "1000", ")", "\n", "return", "dataset", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.__init__": [[159, 196], ["experiment.ModelWrapper.make_head", "experiment.ModelWrapper.make_head", "tensorflow.keras.layers.Input", "experiment.ModelWrapper.conv_stack", "experiment.ModelWrapper.base_head", "tensorflow.keras.Model", "experiment.ModelWrapper.x_block", "experiment.ModelWrapper.x_head", "tensorflow.keras.Model", "tensorflow.keras.Model", "experiment.ModelWrapper.x_head", "tensorflow.keras.Model", "tensorflow.keras.Model", "tensorflow.keras.Model"], "methods", ["home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.make_head", "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.make_head"], ["    ", "def", "__init__", "(", "self", ",", "data_loader", ",", "conv_stack", ",", "x_block", ",", "name", ",", "\n", "weights_dir", "=", "'weights_dir/'", ",", "input_shape", "=", "(", "224", ",", "224", ",", "3", ")", ",", "prefix", "=", "''", ",", "dropout", "=", "True", ")", ":", "\n", "        ", "self", ".", "data_loader", "=", "data_loader", "\n", "self", ".", "conv_stack", "=", "conv_stack", "\n", "self", ".", "input_shape", "=", "input_shape", "\n", "self", ".", "num_classes", "=", "self", ".", "data_loader", ".", "num_classes", "\n", "self", ".", "x_block", "=", "x_block", "\n", "self", ".", "name", "=", "name", "\n", "self", ".", "weights_dir", "=", "weights_dir", "\n", "self", ".", "prefix", "=", "prefix", "\n", "self", ".", "dropout", "=", "dropout", "\n", "\n", "self", ".", "conv_stack", ".", "trainable", "=", "False", "\n", "\n", "self", ".", "base_head", "=", "self", ".", "make_head", "(", "'mean'", ",", "'base_head'", ")", "\n", "self", ".", "x_head", "=", "self", ".", "make_head", "(", "'sum'", ",", "'x_head'", ",", "dropout", "=", "self", ".", "dropout", ")", "\n", "\n", "\n", "i", "=", "tf", ".", "keras", ".", "layers", ".", "Input", "(", "shape", "=", "input_shape", ")", "\n", "features", "=", "self", ".", "conv_stack", "(", "i", ")", "\n", "x", "=", "self", ".", "base_head", "(", "features", ")", "\n", "self", ".", "base_model", "=", "tf", ".", "keras", ".", "Model", "(", "i", ",", "x", ")", "\n", "\n", "g", ",", "p", ",", "discrete_g", "=", "self", ".", "x_block", "(", "features", ")", "\n", "masked_features", "=", "features", "*", "g", "\n", "\n", "o", "=", "self", ".", "x_head", "(", "masked_features", ")", "\n", "self", ".", "x_model", "=", "tf", ".", "keras", ".", "Model", "(", "i", ",", "o", ")", "\n", "self", ".", "x_model_full", "=", "tf", ".", "keras", ".", "Model", "(", "i", ",", "outputs", "=", "[", "o", ",", "g", ",", "p", "]", ")", "\n", "\n", "\n", "masked_features", "=", "features", "*", "discrete_g", "\n", "o", "=", "self", ".", "x_head", "(", "masked_features", ")", "\n", "self", ".", "x_model_discrete", "=", "tf", ".", "keras", ".", "Model", "(", "i", ",", "o", ")", "\n", "self", ".", "x_model_full_discrete", "=", "tf", ".", "keras", ".", "Model", "(", "i", ",", "outputs", "=", "[", "o", ",", "discrete_g", ",", "p", "]", ")", "\n", "\n", "self", ".", "x_cam_model", "=", "tf", ".", "keras", ".", "Model", "(", "i", ",", "masked_features", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.predict_base": [[197, 199], ["experiment.ModelWrapper.base_model.predict"], "methods", ["None"], ["", "def", "predict_base", "(", "self", ",", "imgs", ")", ":", "\n", "        ", "return", "self", ".", "base_model", ".", "predict", "(", "imgs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.predict_features": [[200, 202], ["experiment.ModelWrapper.conv_stack.predict"], "methods", ["None"], ["", "def", "predict_features", "(", "self", ",", "imgs", ")", ":", "\n", "        ", "return", "self", ".", "conv_stack", ".", "predict", "(", "imgs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.predict_x_soft": [[203, 205], ["experiment.ModelWrapper.x_model_full.predict"], "methods", ["None"], ["", "def", "predict_x_soft", "(", "self", ",", "imgs", ")", ":", "\n", "        ", "return", "self", ".", "x_model_full", ".", "predict", "(", "imgs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.predict_x_hard": [[206, 208], ["experiment.ModelWrapper.x_model_full_discrete.predict"], "methods", ["None"], ["", "def", "predict_x_hard", "(", "self", ",", "imgs", ")", ":", "\n", "        ", "return", "self", ".", "x_model_full_discrete", ".", "predict", "(", "imgs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.predict_x_features": [[209, 211], ["experiment.ModelWrapper.x_cam_model.predict"], "methods", ["None"], ["", "def", "predict_x_features", "(", "self", ",", "imgs", ")", ":", "\n", "        ", "return", "self", ".", "x_cam_model", ".", "predict", "(", "imgs", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.compile_model": [[212, 215], ["model.compile"], "methods", ["None"], ["", "def", "compile_model", "(", "self", ",", "model", ")", ":", "\n", "        ", "model", ".", "compile", "(", "optimizer", "=", "'adam'", ",", "loss", "=", "'sparse_categorical_crossentropy'", ",", "\n", "metrics", "=", "[", "'accuracy'", ",", "'sparse_top_k_categorical_accuracy'", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.make_head": [[216, 235], ["tensorflow.keras.layers.Input", "tensorflow.keras.Model", "tensorflow.math.reduce_mean", "tensorflow.keras.layers.Dense", "tensorflow.keras.layers.Activation", "tensorflow.math.reduce_sum", "tensorflow.keras.layers.Dropout", "tensorflow.math.reduce_max"], "methods", ["None"], ["", "def", "make_head", "(", "self", ",", "pooling_mode", ",", "name", ",", "dropout", "=", "True", ")", ":", "\n", "        ", "input_shape", "=", "self", ".", "conv_stack", ".", "output", ".", "shape", "[", "1", ":", "]", "\n", "\n", "i", "=", "tf", ".", "keras", ".", "layers", ".", "Input", "(", "shape", "=", "input_shape", ")", "\n", "if", "pooling_mode", "==", "'mean'", ":", "\n", "            ", "x", "=", "tf", ".", "math", ".", "reduce_mean", "(", "i", ",", "axis", "=", "(", "1", ",", "2", ")", ")", "\n", "", "elif", "pooling_mode", "==", "'sum'", ":", "\n", "            ", "x", "=", "tf", ".", "math", ".", "reduce_sum", "(", "i", ",", "axis", "=", "(", "1", ",", "2", ")", ")", "\n", "", "elif", "pooling_mode", "==", "'max'", ":", "\n", "            ", "x", "=", "tf", ".", "math", ".", "reduce_max", "(", "i", ",", "axis", "=", "(", "1", ",", "2", ")", ")", "\n", "", "else", ":", "\n", "            ", "assert", "(", "False", ")", "\n", "\n", "", "if", "dropout", ":", "\n", "            ", "x", "=", "tf", ".", "keras", ".", "layers", ".", "Dropout", "(", ".2", ")", "(", "x", ")", "\n", "", "x", "=", "tf", ".", "keras", ".", "layers", ".", "Dense", "(", "self", ".", "num_classes", ",", "name", "=", "'logits'", ")", "(", "x", ")", "\n", "x", "=", "tf", ".", "keras", ".", "layers", ".", "Activation", "(", "'softmax'", ")", "(", "x", ")", "\n", "\n", "return", "tf", ".", "keras", ".", "Model", "(", "i", ",", "x", ",", "name", "=", "name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.head_file_name": [[236, 238], ["os.path.join"], "methods", ["None"], ["", "def", "head_file_name", "(", "self", ")", ":", "\n", "        ", "return", "os", ".", "path", ".", "join", "(", "self", ".", "weights_dir", ",", "self", ".", "name", "+", "'_head.h5'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.unfrozen_head_file_name": [[239, 241], ["os.path.join"], "methods", ["None"], ["", "def", "unfrozen_head_file_name", "(", "self", ")", ":", "\n", "        ", "return", "os", ".", "path", ".", "join", "(", "self", ".", "weights_dir", ",", "self", ".", "name", "+", "'_'", "+", "self", ".", "prefix", "+", "'x_unfrozen_head.h5'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.x_file_name": [[242, 244], ["os.path.join"], "methods", ["None"], ["", "def", "x_file_name", "(", "self", ")", ":", "\n", "        ", "return", "os", ".", "path", ".", "join", "(", "self", ".", "weights_dir", ",", "self", ".", "name", "+", "'_'", "+", "self", ".", "prefix", "+", "'x_block.h5'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.train_head": [[245, 257], ["experiment.ModelWrapper.compile_model", "experiment.ModelWrapper.head_file_name", "experiment.ModelWrapper.base_model.fit", "experiment.ModelWrapper.base_head.save_weights", "print", "experiment.ModelWrapper.base_head.load_weights", "os.path.exists"], "methods", ["home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.compile_model", "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.head_file_name"], ["", "def", "train_head", "(", "self", ",", "epochs", ",", "force_retrain", "=", "False", ")", ":", "\n", "        ", "self", ".", "compile_model", "(", "self", ".", "base_model", ")", "\n", "\n", "file", "=", "self", ".", "head_file_name", "(", ")", "\n", "\n", "if", "(", "not", "os", ".", "path", ".", "exists", "(", "file", ")", ")", "or", "force_retrain", ":", "\n", "            ", "self", ".", "base_model", ".", "fit", "(", "self", ".", "data_loader", ".", "dataset", "[", "'train'", "]", ",", "\n", "validation_data", "=", "None", ",", "epochs", "=", "epochs", ")", "\n", "self", ".", "base_head", ".", "save_weights", "(", "file", ")", "\n", "", "else", ":", "\n", "            ", "print", "(", "'Reloading head weights from'", ",", "file", ")", "\n", "self", ".", "base_head", ".", "load_weights", "(", "file", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.train_x": [[258, 287], ["experiment.ModelWrapper.compile_model", "experiment.ModelWrapper.unfrozen_head_file_name", "experiment.ModelWrapper.head_file_name", "experiment.ModelWrapper.x_file_name", "experiment.ModelWrapper.x_head.load_weights", "experiment.ModelWrapper.x_model.fit", "experiment.ModelWrapper.x_block.save_weights", "print", "experiment.ModelWrapper.x_block.load_weights", "os.path.exists", "experiment.ModelWrapper.x_head.save_weights", "print", "experiment.ModelWrapper.x_head.load_weights", "experiment.ModelWrapper.x_head.load_weights", "os.path.exists", "print"], "methods", ["home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.compile_model", "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.unfrozen_head_file_name", "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.head_file_name", "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.x_file_name"], ["", "", "def", "train_x", "(", "self", ",", "epochs", ",", "force_retrain", "=", "False", ",", "train_head", "=", "False", ")", ":", "\n", "        ", "self", ".", "compile_model", "(", "self", ".", "x_model", ")", "\n", "\n", "unfrozen_head_file", "=", "self", ".", "unfrozen_head_file_name", "(", ")", "\n", "head_file", "=", "self", ".", "head_file_name", "(", ")", "\n", "x_file", "=", "self", ".", "x_file_name", "(", ")", "\n", "\n", "if", "(", "not", "os", ".", "path", ".", "exists", "(", "x_file", ")", ")", "or", "force_retrain", ":", "\n", "            ", "self", ".", "x_head", ".", "load_weights", "(", "head_file", ")", "\n", "self", ".", "x_head", ".", "trainable", "=", "train_head", "\n", "\n", "self", ".", "x_model", ".", "fit", "(", "self", ".", "data_loader", ".", "dataset", "[", "'train'", "]", ",", "\n", "validation_data", "=", "None", ",", "epochs", "=", "epochs", ")", "\n", "\n", "self", ".", "x_block", ".", "save_weights", "(", "x_file", ")", "\n", "if", "train_head", ":", "\n", "                ", "self", ".", "x_head", ".", "save_weights", "(", "unfrozen_head_file", ")", "\n", "\n", "", "", "else", ":", "\n", "            ", "print", "(", "'Reloading x-block weights from'", ",", "x_file", ")", "\n", "self", ".", "x_block", ".", "load_weights", "(", "x_file", ")", "\n", "if", "train_head", ":", "\n", "                ", "if", "(", "not", "os", ".", "path", ".", "exists", "(", "unfrozen_head_file", ")", ")", ":", "\n", "                    ", "print", "(", "'Cannot find unfrozen head file'", ",", "unfrozen_head_file", ")", "\n", "assert", "False", "\n", "", "print", "(", "'Reloading unfrozen head weights from'", ",", "unfrozen_head_file", ")", "\n", "self", ".", "x_head", ".", "load_weights", "(", "unfrozen_head_file", ")", "\n", "", "else", ":", "\n", "                ", "self", ".", "x_head", ".", "load_weights", "(", "head_file", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.evaluate_base": [[288, 292], ["print", "experiment.ModelWrapper.compile_model", "experiment.ModelWrapper.base_model.evaluate"], "methods", ["home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.compile_model"], ["", "", "", "def", "evaluate_base", "(", "self", ")", ":", "\n", "        ", "print", "(", "'\\nEvaluating uninterpretable baseline:'", ")", "\n", "self", ".", "compile_model", "(", "self", ".", "base_model", ")", "\n", "return", "self", ".", "base_model", ".", "evaluate", "(", "self", ".", "data_loader", ".", "dataset", "[", "'test'", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.evaluate_x_soft": [[293, 297], ["print", "experiment.ModelWrapper.compile_model", "experiment.ModelWrapper.x_model.evaluate"], "methods", ["home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.compile_model"], ["", "def", "evaluate_x_soft", "(", "self", ")", ":", "\n", "        ", "print", "(", "'\\nEvaluating with soft explanations:'", ")", "\n", "self", ".", "compile_model", "(", "self", ".", "x_model", ")", "\n", "return", "self", ".", "x_model", ".", "evaluate", "(", "self", ".", "data_loader", ".", "dataset", "[", "'test'", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.evaluate_x_hard": [[298, 302], ["print", "experiment.ModelWrapper.compile_model", "experiment.ModelWrapper.x_model_discrete.evaluate"], "methods", ["home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.compile_model"], ["", "def", "evaluate_x_hard", "(", "self", ")", ":", "\n", "        ", "print", "(", "'\\nEvaluating with hard explanations:'", ")", "\n", "self", ".", "compile_model", "(", "self", ".", "x_model_discrete", ")", "\n", "return", "self", ".", "x_model_discrete", ".", "evaluate", "(", "self", ".", "data_loader", ".", "dataset", "[", "'test'", "]", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.evaluate_all": [[303, 308], ["experiment.ModelWrapper.evaluate_base", "experiment.ModelWrapper.evaluate_x_soft", "experiment.ModelWrapper.evaluate_x_hard"], "methods", ["home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.evaluate_base", "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.evaluate_x_soft", "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.evaluate_x_hard"], ["", "def", "evaluate_all", "(", "self", ")", ":", "\n", "        ", "b", "=", "self", ".", "evaluate_base", "(", ")", "\n", "s", "=", "self", ".", "evaluate_x_soft", "(", ")", "\n", "h", "=", "self", ".", "evaluate_x_hard", "(", ")", "\n", "return", "b", ",", "s", ",", "h", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.global_softmax": [[72, 78], ["tensorflow.reshape", "tensorflow.nn.softmax", "tensorflow.reshape"], "function", ["None"], ["", "", "def", "global_softmax", "(", "i", ")", ":", "\n", "    ", "o", "=", "tf", ".", "reshape", "(", "i", ",", "[", "-", "1", ",", "i", ".", "shape", "[", "1", "]", "*", "i", ".", "shape", "[", "2", "]", "]", ")", "\n", "o", "=", "tf", ".", "nn", ".", "softmax", "(", "o", ")", "\n", "o", "=", "tf", ".", "reshape", "(", "o", ",", "[", "-", "1", ",", "i", ".", "shape", "[", "1", "]", ",", "i", ".", "shape", "[", "2", "]", "]", ")", "\n", "\n", "return", "o", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.gumbel": [[79, 81], ["tensorflow.math.log", "tensorflow.math.log", "tensorflow.random.uniform"], "function", ["None"], ["", "def", "gumbel", "(", "shape", ")", ":", "\n", "  ", "return", "-", "(", "tf", ".", "math", ".", "log", "(", "-", "tf", ".", "math", ".", "log", "(", "tf", ".", "random", ".", "uniform", "(", "shape", "=", "shape", ")", ")", ")", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.make_x_block": [[82, 153], ["tensorflow.keras.layers.Input", "tensorflow.keras.Model", "print", "tensorflow.reshape", "tensorflow.keras.layers.Conv2D", "tensorflow.keras.layers.Activation", "range", "tensorflow.stack", "tensorflow.math.reduce_max", "tensorflow.expand_dims", "tensorflow.reshape", "tensorflow.math.top_k", "tensorflow.cast", "tensorflow.math.reduce_sum", "tensorflow.transpose", "tensorflow.keras.layers.Flatten", "tensorflow.keras.layers.Dense", "tensorflow.keras.layers.Conv2D", "print", "experiment.gumbel", "experiment.global_softmax", "gs.append", "tensorflow.math.sigmoid", "experiment.global_softmax", "tensorflow.expand_dims", "tensorflow.keras.layers.Activation", "tensorflow.greater_equal", "tensorflow.cast", "tensorflow.transpose", "tensorflow.math.reduce_max", "tensorflow.cast", "tensorflow.math.reduce_sum", "tensorflow.transpose", "tensorflow.shape", "tensorflow.transpose", "tensorflow.transpose", "tensorflow.greater_equal", "tensorflow.greater_equal", "tensorflow.transpose", "tensorflow.transpose", "tensorflow.transpose", "tensorflow.math.sigmoid"], "function", ["home.repos.pwc.inspect_result.th-b_bla.None.experiment.gumbel", "home.repos.pwc.inspect_result.th-b_bla.None.experiment.global_softmax", "home.repos.pwc.inspect_result.th-b_bla.None.experiment.global_softmax"], ["", "def", "make_x_block", "(", "input_shape", ",", "k", "=", "4", ",", "tau", "=", ".1", ",", "pre_tau", "=", "-", "1.", ",", "threshold", "=", "None", ",", "auto_threshold_factor", "=", ".98", ",", "\n", "extra_layers_channels", "=", "[", "]", ",", "name", "=", "'x_block'", ",", "sampling", "=", "False", ",", "activation", "=", "'relu'", ",", "fixed_k_sampling", "=", "False", ",", "\n", "concept_vector", "=", "False", ",", "sigmoid", "=", "False", ")", ":", "\n", "    ", "i", "=", "tf", ".", "keras", ".", "layers", ".", "Input", "(", "shape", "=", "input_shape", ")", "\n", "\n", "if", "threshold", "is", "None", ":", "\n", "        ", "threshold", "=", "auto_threshold_factor", "/", "(", "input_shape", "[", "0", "]", "*", "input_shape", "[", "1", "]", ")", "\n", "print", "(", "'Auto threshold'", ",", "threshold", ")", "\n", "\n", "", "p", "=", "i", "\n", "\n", "if", "concept_vector", ":", "\n", "        ", "f", "=", "tf", ".", "keras", ".", "layers", ".", "Flatten", "(", ")", "(", "i", ")", "\n", "f", "=", "tf", ".", "keras", ".", "layers", ".", "Dense", "(", "p", ".", "shape", "[", "-", "1", "]", ",", "activation", "=", "'relu'", ")", "(", "f", ")", "\n", "f", "=", "tf", ".", "reshape", "(", "f", ",", "[", "-", "1", ",", "1", ",", "1", ",", "f", ".", "shape", "[", "-", "1", "]", "]", ")", "\n", "\n", "p", "=", "p", "+", "f", "\n", "\n", "", "for", "c", "in", "extra_layers_channels", ":", "\n", "        ", "p", "=", "tf", ".", "keras", ".", "layers", ".", "Conv2D", "(", "c", ",", "1", ",", "activation", "=", "'relu'", ")", "(", "p", ")", "\n", "\n", "\n", "", "p", "=", "tf", ".", "keras", ".", "layers", ".", "Conv2D", "(", "1", ",", "1", ",", "activation", "=", "'linear'", ")", "(", "p", ")", "\n", "p", "=", "tf", ".", "keras", ".", "layers", ".", "Activation", "(", "activation", ")", "(", "p", ")", "\n", "p", "=", "p", "*", "pre_tau", "\n", "\n", "if", "sampling", ":", "\n", "        ", "if", "sigmoid", ":", "\n", "            ", "print", "(", "'Warning: sigmoid option does not do anything while sampling'", ")", "\n", "", "gs", "=", "[", "]", "\n", "\n", "for", "_", "in", "range", "(", "k", ")", ":", "\n", "          ", "g", "=", "gumbel", "(", "tf", ".", "shape", "(", "p", ")", ")", "\n", "g", "=", "global_softmax", "(", "(", "g", "+", "p", ")", "*", "tau", ")", "\n", "gs", ".", "append", "(", "g", ")", "\n", "\n", "", "g", "=", "tf", ".", "stack", "(", "gs", ",", "axis", "=", "-", "1", ")", "\n", "g", "=", "tf", ".", "math", ".", "reduce_max", "(", "g", ",", "axis", "=", "-", "1", ")", "\n", "g", "=", "tf", ".", "expand_dims", "(", "g", ",", "-", "1", ")", "\n", "\n", "", "elif", "sigmoid", ":", "\n", "        ", "g", "=", "tf", ".", "math", ".", "sigmoid", "(", "p", "*", "tau", ")", "\n", "", "else", ":", "\n", "        ", "g", "=", "global_softmax", "(", "p", "*", "tau", ")", "\n", "g", "=", "tf", ".", "expand_dims", "(", "g", ",", "-", "1", ")", "\n", "\n", "", "if", "threshold", ">", "0", ":", "\n", "        ", "g", "=", "g", "-", "threshold", "\n", "g", "=", "tf", ".", "keras", ".", "layers", ".", "Activation", "(", "'relu'", ")", "(", "g", ")", "\n", "\n", "\n", "", "if", "fixed_k_sampling", ":", "\n", "        ", "p_flat", "=", "tf", ".", "reshape", "(", "p", ",", "[", "-", "1", ",", "p", ".", "shape", "[", "1", "]", "*", "p", ".", "shape", "[", "2", "]", "*", "p", ".", "shape", "[", "3", "]", "]", ")", "\n", "v", ",", "_", "=", "tf", ".", "math", ".", "top_k", "(", "p_flat", ",", "k", "=", "k", ",", "sorted", "=", "True", ")", "\n", "v", "=", "v", "[", ":", ",", "-", "1", "]", "\n", "discrete_g", "=", "tf", ".", "cast", "(", "tf", ".", "greater_equal", "(", "tf", ".", "transpose", "(", "p", ")", ",", "tf", ".", "transpose", "(", "v", ")", ")", ",", "tf", ".", "float32", ")", "\n", "sum_vals", "=", "tf", ".", "math", ".", "reduce_sum", "(", "discrete_g", ",", "axis", "=", "(", "1", ",", "2", ")", ")", "\n", "discrete_g", "=", "discrete_g", "/", "sum_vals", "\n", "discrete_g", "=", "tf", ".", "transpose", "(", "discrete_g", ")", "\n", "", "elif", "sigmoid", ":", "\n", "        ", "discrete_g", "=", "tf", ".", "cast", "(", "tf", ".", "greater_equal", "(", "tf", ".", "transpose", "(", "tf", ".", "math", ".", "sigmoid", "(", "p", "*", "tau", ")", ")", ",", ".5", ")", ",", "tf", ".", "float32", ")", "\n", "discrete_g", "=", "tf", ".", "transpose", "(", "discrete_g", ")", "\n", "", "else", ":", "\n", "        ", "max_vals", "=", "tf", ".", "math", ".", "reduce_max", "(", "p", ",", "axis", "=", "(", "1", ",", "2", ")", ")", "\n", "discrete_g", "=", "tf", ".", "cast", "(", "tf", ".", "greater_equal", "(", "tf", ".", "transpose", "(", "p", ")", ",", "tf", ".", "transpose", "(", "max_vals", ")", ")", ",", "tf", ".", "float32", ")", "\n", "sum_vals", "=", "tf", ".", "math", ".", "reduce_sum", "(", "discrete_g", ",", "axis", "=", "(", "1", ",", "2", ")", ")", "\n", "discrete_g", "=", "discrete_g", "/", "sum_vals", "\n", "discrete_g", "=", "tf", ".", "transpose", "(", "discrete_g", ")", "\n", "\n", "\n", "", "return", "tf", ".", "keras", ".", "Model", "(", "i", ",", "outputs", "=", "[", "g", ",", "p", ",", "discrete_g", "]", ",", "name", "=", "name", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.make_fixed_size_block": [[310, 321], ["experiment.make_x_block"], "function", ["home.repos.pwc.inspect_result.th-b_bla.None.experiment.make_x_block"], ["", "", "def", "make_fixed_size_block", "(", "conv_stack", ",", "use_threshold", "=", "False", ")", ":", "\n", "    ", "if", "use_threshold", ":", "\n", "        ", "threshold", "=", "None", "\n", "", "else", ":", "\n", "        ", "threshold", "=", "0", "\n", "\n", "", "return", "make_x_block", "(", "conv_stack", ".", "output", ".", "shape", "[", "1", ":", "]", ",", "threshold", "=", "threshold", ",", "\n", "k", "=", "8", ",", "\n", "sampling", "=", "True", ",", "\n", "activation", "=", "'linear'", ",", "\n", "fixed_k_sampling", "=", "True", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.make_bounded_logit_block": [[322, 329], ["experiment.make_x_block"], "function", ["home.repos.pwc.inspect_result.th-b_bla.None.experiment.make_x_block"], ["", "def", "make_bounded_logit_block", "(", "conv_stack", ",", "use_threshold", "=", "False", ")", ":", "\n", "    ", "if", "use_threshold", ":", "\n", "        ", "threshold", "=", "None", "\n", "", "else", ":", "\n", "        ", "threshold", "=", "0", "\n", "\n", "", "return", "make_x_block", "(", "conv_stack", ".", "output", ".", "shape", "[", "1", ":", "]", ",", "threshold", "=", "threshold", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.make_prefix": [[338, 343], ["None"], "function", ["None"], ["def", "make_prefix", "(", "fixed_size", ",", "threshold", ",", "train_head", ",", "dropout", "=", "True", ")", ":", "\n", "    ", "return", "(", "'auto_threshold_'", "if", "threshold", "else", "'no_threshold_'", ")", "+", "(", "'fixed_size'", "if", "fixed_size", "else", "'bounded_logit'", ")", "+", "(", "'trained_head'", "if", "train_head", "else", "'frozen_head'", ")", "+", "(", "''", "if", "dropout", "else", "'no_dropout'", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.make_model": [[344, 355], ["experiment.make_prefix", "experiment.TfDataSetLoader", "experiment.ModelWrapper", "str", "experiment.make_fixed_size_block", "experiment.make_bounded_logit_block"], "function", ["home.repos.pwc.inspect_result.th-b_bla.None.experiment.make_prefix", "home.repos.pwc.inspect_result.th-b_bla.None.experiment.make_fixed_size_block", "home.repos.pwc.inspect_result.th-b_bla.None.experiment.make_bounded_logit_block"], ["", "def", "make_model", "(", "ds", ",", "fixed_size", ",", "threshold", ",", "train_head", ",", "run", "=", "0", ",", "dropout", "=", "True", ")", ":", "\n", "    ", "model_string", "=", "ds", "+", "str", "(", "run", ")", "\n", "prefix", "=", "make_prefix", "(", "fixed_size", ",", "threshold", ",", "train_head", ",", "dropout", "=", "dropout", ")", "\n", "if", "fixed_size", ":", "\n", "        ", "block", "=", "make_fixed_size_block", "(", "conv_stack", ",", "use_threshold", "=", "threshold", ")", "\n", "", "else", ":", "\n", "        ", "block", "=", "make_bounded_logit_block", "(", "conv_stack", ",", "use_threshold", "=", "threshold", ")", "\n", "\n", "", "loader", "=", "TfDataSetLoader", "(", "ds", ")", "\n", "wrapper", "=", "ModelWrapper", "(", "loader", ",", "conv_stack", ",", "block", ",", "model_string", ",", "prefix", "=", "prefix", ",", "dropout", "=", "dropout", ")", "\n", "return", "wrapper", ",", "model_string", ",", "prefix", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.make_wrapper": [[356, 380], ["experiment.make_model", "print", "print", "print", "wrapper.train_head", "wrapper.train_x", "wrapper.evaluate_all", "open", "myfile.write", "myfile.write", "os.path.join", "str"], "function", ["home.repos.pwc.inspect_result.th-b_bla.None.experiment.make_model", "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.train_head", "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.train_x", "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.evaluate_all"], ["", "def", "make_wrapper", "(", "ds", ",", "\n", "fixed_size", ",", "\n", "threshold", ",", "\n", "train_head", ",", "\n", "force_retrain", "=", "False", ")", ":", "\n", "\n", "\n", "    ", "wrapper", ",", "model_string", ",", "prefix", "=", "make_model", "(", "ds", ",", "fixed_size", ",", "threshold", ",", "train_head", ")", "\n", "\n", "print", "(", "'\\n-----------------'", ")", "\n", "print", "(", "model_string", ",", "prefix", ")", "\n", "print", "(", "'-----------------\\n'", ")", "\n", "\n", "epochs", "=", "2", "if", "ds", "==", "'cats_vs_dogs'", "else", "5", "\n", "wrapper", ".", "train_head", "(", "epochs", ",", "force_retrain", "=", "force_retrain", ")", "\n", "wrapper", ".", "train_x", "(", "epochs", ",", "force_retrain", "=", "force_retrain", ",", "train_head", "=", "train_head", ")", "\n", "\n", "b", ",", "s", ",", "h", "=", "wrapper", ".", "evaluate_all", "(", ")", "\n", "\n", "with", "open", "(", "os", ".", "path", ".", "join", "(", "log_dir", ",", "ds", "+", "'_'", "+", "prefix", ")", ",", "\"a\"", ")", "as", "myfile", ":", "\n", "        ", "myfile", ".", "write", "(", "','", ".", "join", "(", "[", "','", ".", "join", "(", "[", "str", "(", "x", ")", "for", "x", "in", "xs", "]", ")", "for", "xs", "in", "[", "b", ",", "s", ",", "h", "]", "]", ")", ")", "\n", "myfile", ".", "write", "(", "'\\n'", ")", "\n", "\n", "", "return", "wrapper", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.experiment.load_model": [[382, 389], ["experiment.make_model", "wrapper.train_head", "wrapper.train_x"], "function", ["home.repos.pwc.inspect_result.th-b_bla.None.experiment.make_model", "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.train_head", "home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.train_x"], ["", "def", "load_model", "(", "ds", ",", "fixed_size", ",", "threshold", ",", "train_head", ",", "run", "=", "0", ")", ":", "\n", "    ", "wrapper", ",", "_", ",", "_", "=", "make_model", "(", "ds", ",", "fixed_size", ",", "threshold", ",", "train_head", ",", "run", "=", "run", ")", "\n", "\n", "wrapper", ".", "train_head", "(", "0", ",", "force_retrain", "=", "False", ")", "\n", "wrapper", ".", "train_x", "(", "0", ",", "force_retrain", "=", "False", ",", "train_head", "=", "train_head", ")", "\n", "\n", "return", "wrapper", "", "", ""]], "home.repos.pwc.inspect_result.th-b_bla.None.run.main": [[20, 69], ["argparse.ArgumentParser", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "argparse.ArgumentParser.add_argument", "vars", "experiment.make_wrapper", "vis.visualize", "argparse.ArgumentParser.parse_args"], "function", ["home.repos.pwc.inspect_result.th-b_bla.None.experiment.make_wrapper", "home.repos.pwc.inspect_result.th-b_bla.None.vis.visualize"], ["def", "main", "(", ")", ":", "\n", "    ", "parser", "=", "argparse", ".", "ArgumentParser", "(", "description", "=", "'Bounded logit attention.'", ")", "\n", "\n", "parser", ".", "add_argument", "(", "'-d'", ",", "'--dataset'", ",", "required", "=", "False", ",", "default", "=", "'cats_vs_dogs'", ",", "\n", "choices", "=", "[", "'cats_vs_dogs'", ",", "'stanford_dogs'", ",", "'caltech_birds2011'", "]", ")", "\n", "\n", "parser", ".", "add_argument", "(", "'-f'", ",", "'--fixed-size'", ",", "action", "=", "'store_true'", ")", "\n", "parser", ".", "add_argument", "(", "'-t'", ",", "'--threshold'", ",", "action", "=", "'store_true'", ")", "\n", "parser", ".", "add_argument", "(", "'-p'", ",", "'--post-hoc'", ",", "action", "=", "'store_true'", ")", "\n", "parser", ".", "add_argument", "(", "'-r'", ",", "'--force-retraining'", ",", "action", "=", "'store_true'", ")", "\n", "\n", "parser", ".", "add_argument", "(", "'-s'", ",", "'--preset'", ",", "required", "=", "False", ",", "\n", "choices", "=", "[", "'L2X-F'", ",", "'BLA'", ",", "'BLA-T'", ",", "'BLA-PH'", "]", ")", "\n", "\n", "args", "=", "vars", "(", "parser", ".", "parse_args", "(", ")", ")", "\n", "\n", "fixed_size", "=", "args", "[", "'fixed_size'", "]", "\n", "threshold", "=", "args", "[", "'threshold'", "]", "\n", "train_head", "=", "not", "args", "[", "'post_hoc'", "]", "\n", "force_retrain", "=", "args", "[", "'force_retraining'", "]", "\n", "\n", "ds", "=", "args", "[", "'dataset'", "]", "\n", "\n", "preset", "=", "args", "[", "'preset'", "]", "\n", "if", "preset", "==", "'L2X-F'", ":", "\n", "        ", "fixed_size", "=", "True", "\n", "threshold", "=", "False", "\n", "train_head", "=", "True", "\n", "", "elif", "preset", "==", "'BLA'", ":", "\n", "        ", "fixed_size", "=", "False", "\n", "threshold", "=", "False", "\n", "train_head", "=", "True", "\n", "", "elif", "preset", "==", "'BLA-T'", ":", "\n", "        ", "fixed_size", "=", "False", "\n", "threshold", "=", "True", "\n", "train_head", "=", "True", "\n", "", "elif", "preset", "==", "'BLA-PH'", ":", "\n", "        ", "fixed_size", "=", "False", "\n", "threshold", "=", "True", "\n", "train_head", "=", "False", "\n", "\n", "", "wrapper", "=", "experiment", ".", "make_wrapper", "(", "ds", ",", "\n", "fixed_size", "=", "fixed_size", ",", "\n", "threshold", "=", "threshold", ",", "\n", "train_head", "=", "train_head", ",", "\n", "force_retrain", "=", "force_retrain", "\n", ")", "\n", "\n", "vis", ".", "visualize", "(", "wrapper", ")", "\n", "\n"]], "home.repos.pwc.inspect_result.th-b_bla.None.vis.visualize": [[20, 75], ["isinstance", "matplotlib.pyplot.figure", "matplotlib.pyplot.tight_layout", "matplotlib.pyplot.show", "wrapper.predict_x_hard", "numpy.argmax", "matplotlib.pyplot.subplot", "matplotlib.pyplot.title", "matplotlib.pyplot.axis", "matplotlib.pyplot.imshow", "matplotlib.pyplot.subplot", "matplotlib.pyplot.title", "plt.subplot.set_xticks", "plt.subplot.set_yticks", "matplotlib.pyplot.imshow", "matplotlib.pyplot.colorbar", "matplotlib.pyplot.subplot", "matplotlib.pyplot.axis", "matplotlib.pyplot.title", "matplotlib.pyplot.imshow", "matplotlib.pyplot.colorbar", "matplotlib.pyplot.subplot", "matplotlib.pyplot.axis", "matplotlib.pyplot.title", "numpy.squeeze", "cv2.applyColorMap.max", "cv2.resize", "cv2.applyColorMap", "matplotlib.pyplot.imshow", "matplotlib.pyplot.savefig", "wrapper.data_loader.preprocess_image", "len", "len", "numpy.squeeze", "len", "len", "wrapper.data_loader.dataset[].take", "numpy.squeeze", "mask.max", "len"], "function", ["home.repos.pwc.inspect_result.th-b_bla.None.experiment.ModelWrapper.predict_x_hard"], ["def", "visualize", "(", "wrapper", ",", "images", "=", "5", ",", "file", "=", "None", ")", ":", "\n", "\n", "    ", "if", "isinstance", "(", "images", ",", "int", ")", ":", "\n", "        ", "images", "=", "[", "imgs", "[", "0", "]", "for", "imgs", ",", "_", "in", "wrapper", ".", "data_loader", ".", "dataset", "[", "'test'", "]", ".", "take", "(", "images", ")", "]", "\n", "\n", "", "plt", ".", "figure", "(", "figsize", "=", "(", "4", "*", "2", ",", "len", "(", "images", ")", "*", "2", ")", ")", "\n", "\n", "a", "=", "-", "1", "\n", "for", "img", "in", "images", ":", "\n", "        ", "a", "+=", "1", "\n", "pred", ",", "mask", ",", "prob", "=", "wrapper", ".", "predict_x_hard", "(", "wrapper", ".", "data_loader", ".", "preprocess_image", "(", "img", "[", "None", "]", ")", ")", "\n", "\n", "HEIGHT", "=", "img", ".", "shape", "[", "0", "]", "\n", "WIDTH", "=", "img", ".", "shape", "[", "1", "]", "\n", "\n", "pred_cl", "=", "np", ".", "argmax", "(", "pred", "[", "0", "]", ")", "\n", "\n", "ax", "=", "plt", ".", "subplot", "(", "len", "(", "images", ")", ",", "4", ",", "1", "+", "4", "*", "a", ")", "\n", "plt", ".", "title", "(", "'Input'", ")", "\n", "plt", ".", "axis", "(", "'off'", ")", "\n", "plt", ".", "imshow", "(", "img", "/", "255.", ")", "\n", "\n", "ax", "=", "plt", ".", "subplot", "(", "len", "(", "images", ")", ",", "4", ",", "2", "+", "4", "*", "a", ")", "\n", "plt", ".", "title", "(", "'Soft'", ")", "\n", "ax", ".", "set_xticks", "(", "[", "]", ")", "\n", "ax", ".", "set_yticks", "(", "[", "]", ")", "\n", "plt", ".", "imshow", "(", "np", ".", "squeeze", "(", "prob", ")", ")", "\n", "plt", ".", "colorbar", "(", "fraction", "=", "0.046", ",", "pad", "=", "0.04", ")", "\n", "\n", "ax", "=", "plt", ".", "subplot", "(", "len", "(", "images", ")", ",", "4", ",", "3", "+", "4", "*", "a", ")", "\n", "plt", ".", "axis", "(", "'off'", ")", "\n", "plt", ".", "title", "(", "'Hard'", ")", "\n", "plt", ".", "imshow", "(", "np", ".", "squeeze", "(", "mask", ")", "/", "mask", ".", "max", "(", ")", ")", "\n", "\n", "plt", ".", "colorbar", "(", "fraction", "=", "0.046", ",", "pad", "=", "0.04", ")", "\n", "\n", "ax", "=", "plt", ".", "subplot", "(", "len", "(", "images", ")", ",", "4", ",", "4", "+", "4", "*", "a", ")", "\n", "plt", ".", "axis", "(", "'off'", ")", "\n", "plt", ".", "title", "(", "'Visualization'", ")", "\n", "\n", "h", "=", "np", ".", "squeeze", "(", "mask", ")", "\n", "h", "/=", "h", ".", "max", "(", ")", "\n", "h", "=", "(", "h", "*", "255", ")", ".", "astype", "(", "'uint8'", ")", "\n", "h", "=", "cv2", ".", "resize", "(", "h", ",", "(", "HEIGHT", ",", "WIDTH", ")", ")", "\n", "h", "=", "cv2", ".", "applyColorMap", "(", "h", ",", "cv2", ".", "COLORMAP_TURBO", ")", "\n", "h", "=", "h", "[", ":", ",", ":", ",", ":", ":", "-", "1", "]", "\n", "\n", "plt", ".", "imshow", "(", "(", "img", "*", ".5", "+", "h", "*", ".5", ")", "/", "255", ")", "\n", "\n", "", "plt", ".", "tight_layout", "(", ")", "\n", "\n", "if", "file", "is", "not", "None", ":", "\n", "        ", "plt", ".", "savefig", "(", "file", ")", "\n", "\n", "", "plt", ".", "show", "(", ")", "", "", ""]]}